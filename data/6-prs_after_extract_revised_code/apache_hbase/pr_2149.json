{"pr_number": 2149, "pr_title": "HBASE-24760 Add a config hbase.rsgroup.fallback.enable for RSGroup fallback feature", "pr_createdAt": "2020-07-27T07:31:50Z", "pr_url": "https://github.com/apache/hbase/pull/2149", "timeline": [{"oid": "e1c82ffe0c94ace1ce4ea171a4f97020d5dfb758", "url": "https://github.com/apache/hbase/commit/e1c82ffe0c94ace1ce4ea171a4f97020d5dfb758", "message": "HBASE-24760 Allow system tables fallback to any rs groups", "committedDate": "2020-07-27T10:18:57Z", "type": "forcePushed"}, {"oid": "b5c82e21c982c98ec804a0a4aecd2319497afd2e", "url": "https://github.com/apache/hbase/commit/b5c82e21c982c98ec804a0a4aecd2319497afd2e", "message": "HBASE-24760 Allow system tables fallback to any rs groups", "committedDate": "2020-07-28T01:55:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1OTA4OQ==", "url": "https://github.com/apache/hbase/pull/2149#discussion_r473659089", "bodyText": "I thought this is not released now. For Availability, how about allow any table fallback to any other rsgroups? And only introduced one config.", "author": "infraio", "createdAt": "2020-08-20T06:46:27Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java", "diffHunk": "@@ -88,9 +87,15 @@\n    */\n   public static final String FALLBACK_GROUPS_KEY = \"hbase.rsgroup.fallback.groups\";", "originalCommit": "b5c82e21c982c98ec804a0a4aecd2319497afd2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk0MDg4NA==", "url": "https://github.com/apache/hbase/pull/2149#discussion_r473940884", "bodyText": "OK, I'll refactor this feature. For all tables, whether or not system tables, have same logic: priority fallback to the default group, and then fallback to any group.", "author": "ddupg", "createdAt": "2020-08-20T12:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1OTA4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "0b4f846e6f82651699a3c6e2112f0ecfcd72044a", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java\nindex 3ecdf1add5..70b30be88d 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java\n\n@@ -80,21 +78,15 @@ public class RSGroupBasedLoadBalancer implements LoadBalancer {\n   private LoadBalancer internalBalancer;\n \n   /**\n-   * Define the config key of fallback groups\n-   * Enabled only if this property is set\n+   * Set this key to {@code true} to allow region fallback.\n+   * Priority fallback to the default rsgroup, then fallback to any group if no online servers in\n+   * default rsgroup.\n    * Please keep balancer switch on at the same time, which is relied on to correct misplaced\n    * regions\n    */\n-  public static final String FALLBACK_GROUPS_KEY = \"hbase.rsgroup.fallback.groups\";\n-\n-  public static final String FALLBACK_SYSTEM_TABLES_TO_ANY_RSGROUP_KEY =\n-      \"hbase.rsgroup.fallback.systemtable.anyrsgroup.enabled\";\n-  public static final boolean DEFAULT_FALLBACK_SYSTEM_TABLES_TO_ANY_RSGROUP_KEY = false;\n+  public static final String FALLBACK_GROUP_ENABLE_KEY = \"hbase.rsgroup.fallback.enable\";\n \n   private boolean fallbackEnabled = false;\n-  private Set<String> fallbackGroups;\n-\n-  private boolean systemTablesFallbackToAnyGroupsEnabled;\n \n   /**\n    * Used by reflection in {@link org.apache.hadoop.hbase.master.balancer.LoadBalancerFactory}.\n"}}, {"oid": "0b4f846e6f82651699a3c6e2112f0ecfcd72044a", "url": "https://github.com/apache/hbase/commit/0b4f846e6f82651699a3c6e2112f0ecfcd72044a", "message": "HBASE-24760 Refactor RSGroup fallback", "committedDate": "2020-08-24T06:45:21Z", "type": "forcePushed"}, {"oid": "8d0a36ad90b2b084f5ca9681bddca56f3c19fb6c", "url": "https://github.com/apache/hbase/commit/8d0a36ad90b2b084f5ca9681bddca56f3c19fb6c", "message": "HBASE-24760 Refactor RSGroup fallback", "committedDate": "2020-08-24T07:02:35Z", "type": "forcePushed"}, {"oid": "b7592c5b70f9a18d5ddc2d5d8fcccf12af416f6f", "url": "https://github.com/apache/hbase/commit/b7592c5b70f9a18d5ddc2d5d8fcccf12af416f6f", "message": "HBASE-24760 Refactor RSGroup fallback", "committedDate": "2020-08-25T03:18:43Z", "type": "forcePushed"}, {"oid": "5e96f7efca4ffc97fdd54e64ad129b756f23771a", "url": "https://github.com/apache/hbase/commit/5e96f7efca4ffc97fdd54e64ad129b756f23771a", "message": "HBASE-24760 Refactor RSGroup fallback", "committedDate": "2020-08-27T08:30:38Z", "type": "forcePushed"}, {"oid": "ee602f81cd1c54dcf87905fa0820906380821f06", "url": "https://github.com/apache/hbase/commit/ee602f81cd1c54dcf87905fa0820906380821f06", "message": "HBASE-24760 Add a config hbase.rsgroup.fallback.enable for RSGroup fallback feature", "committedDate": "2020-08-28T03:17:29Z", "type": "commit"}, {"oid": "ee602f81cd1c54dcf87905fa0820906380821f06", "url": "https://github.com/apache/hbase/commit/ee602f81cd1c54dcf87905fa0820906380821f06", "message": "HBASE-24760 Add a config hbase.rsgroup.fallback.enable for RSGroup fallback feature", "committedDate": "2020-08-28T03:17:29Z", "type": "forcePushed"}]}