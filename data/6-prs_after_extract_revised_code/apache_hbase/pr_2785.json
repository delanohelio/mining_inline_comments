{"pr_number": 2785, "pr_title": "HBASE-25371: When openRegion fails during initial verification(before\u2026", "pr_createdAt": "2020-12-17T19:19:29Z", "pr_url": "https://github.com/apache/hbase/pull/2785", "timeline": [{"oid": "5f57555dbc6d2557335533fa8edd5f21af8864c9", "url": "https://github.com/apache/hbase/commit/5f57555dbc6d2557335533fa8edd5f21af8864c9", "message": "HBASE-25371: When openRegion fails during initial verification(before initializing and setting seq num), exception is observed during region close.", "committedDate": "2020-12-17T19:19:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI3Nzg2NA==", "url": "https://github.com/apache/hbase/pull/2785#discussion_r546277864", "bodyText": "Did you mean to leave the @ignore in place?", "author": "saintstack", "createdAt": "2020-12-19T20:10:02Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionOpen.java", "diffHunk": "@@ -135,4 +139,36 @@ public void testNonExistentRegionReplica() throws Exception {\n     }\n     fail(\"Should have thrown IOE when attempting to open a non-existing region.\");\n   }\n+\n+  /*\n+   * Before applying the fix run this test case, error message\n+   * \"java.io.IOException: The new max sequence id 1 is less than the old max sequence id 17\"\n+   * can be found the log.\n+   * After applying the fix run this test case above message should not be logged.\n+   */\n+  //@Test(timeout = 60000)\n+  @Ignore", "originalCommit": "5f57555dbc6d2557335533fa8edd5f21af8864c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY5ODY2Mw==", "url": "https://github.com/apache/hbase/pull/2785#discussion_r546698663", "bodyText": "I was thinking not to run that test case in the CI as it is not doing any assert, will be of no use In CI.\nIt was written to reproduce the issue. I think better to remove it from PR.", "author": "arshadmohammad", "createdAt": "2020-12-21T13:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI3Nzg2NA=="}], "type": "inlineReview", "revised_code": {"commit": "449cbda50a2e33cc8f0ff5d826469bb84f8ff799", "chunk": "diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionOpen.java b/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionOpen.java\nindex 2cc51e1019..4719d1c5dc 100644\n--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionOpen.java\n+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionOpen.java\n\n@@ -139,36 +135,4 @@ public class TestRegionOpen {\n     }\n     fail(\"Should have thrown IOE when attempting to open a non-existing region.\");\n   }\n-\n-  /*\n-   * Before applying the fix run this test case, error message\n-   * \"java.io.IOException: The new max sequence id 1 is less than the old max sequence id 17\"\n-   * can be found the log.\n-   * After applying the fix run this test case above message should not be logged.\n-   */\n-  //@Test(timeout = 60000)\n-  @Ignore\n-  public void testRegionOpenFailure() throws Exception {\n-    final TableName tableName = TableName.valueOf(name.getMethodName());\n-    final byte[] FAMILY = Bytes.toBytes(\"fq\");\n-    Admin admin = HTU.getAdmin();\n-    admin.createTable(TableDescriptorBuilder.newBuilder(tableName)\n-      .setColumnFamily(ColumnFamilyDescriptorBuilder.of(FAMILY)).build());\n-    assertTrue(\"Table creation was not success\", admin.tableExists(tableName));\n-\n-    // Put some records to increase the read sequence id\n-    final Table table = HTU.getConnection().getTable(tableName);\n-    for (int i = 0; i < 10; i++) {\n-      Put put = new Put(Bytes.toBytes(\"row\" + i));\n-      put.addColumn(FAMILY, Bytes.toBytes(\"q1\"), Bytes.toBytes(\"value\" + i));\n-      table.put(put);\n-    }\n-    admin.flush(tableName);\n-\n-    TableDescriptorBuilder.newBuilder(table.getDescriptor());\n-    final ColumnFamilyDescriptorBuilder newFamilyDesc =\n-      ColumnFamilyDescriptorBuilder.newBuilder(table.getDescriptor().getColumnFamily(FAMILY));\n-    newFamilyDesc.setEncryptionType(\"InvalidEncryptionType\");\n-    admin.modifyColumnFamily(tableName, newFamilyDesc.build());\n-  }\n }\n"}}, {"oid": "449cbda50a2e33cc8f0ff5d826469bb84f8ff799", "url": "https://github.com/apache/hbase/commit/449cbda50a2e33cc8f0ff5d826469bb84f8ff799", "message": "Removed test case, added code comment", "committedDate": "2020-12-21T14:33:33Z", "type": "commit"}]}