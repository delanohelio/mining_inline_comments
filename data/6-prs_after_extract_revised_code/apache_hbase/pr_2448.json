{"pr_number": 2448, "pr_title": "HBASE-25088 CatalogFamilyFormat/MetaTableAccessor.parseRegionInfoFrom\u2026", "pr_createdAt": "2020-09-23T16:34:39Z", "pr_url": "https://github.com/apache/hbase/pull/2448", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk3Nzk5MA==", "url": "https://github.com/apache/hbase/pull/2448#discussion_r493977990", "bodyText": "Add ut for this?", "author": "infraio", "createdAt": "2020-09-24T00:52:26Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java", "diffHunk": "@@ -101,7 +101,7 @@ public static RegionInfo parseRegionInfoFromRegionName(byte[] regionName) throws\n     long regionId = Long.parseLong(Bytes.toString(fields[2]));\n     int replicaId = fields.length > 3 ? Integer.parseInt(Bytes.toString(fields[3]), 16) : 0;\n     return RegionInfoBuilder.newBuilder(TableName.valueOf(fields[0])).setStartKey(fields[1])\n-      .setEndKey(fields[2]).setSplit(false).setRegionId(regionId).setReplicaId(replicaId).build();\n+      .setSplit(false).setRegionId(regionId).setReplicaId(replicaId).build();", "originalCommit": "9dee7eedcb889ab20e94d302a110ad557561a5e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1969e5a782af9260629a5f8c7d3e9c86cfaca0f1", "chunk": "diff --git a/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java b/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java\nindex 5d3eaa3f14..d0ee3dc833 100644\n--- a/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java\n+++ b/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java\n\n@@ -101,7 +101,7 @@ public class CatalogFamilyFormat {\n     long regionId = Long.parseLong(Bytes.toString(fields[2]));\n     int replicaId = fields.length > 3 ? Integer.parseInt(Bytes.toString(fields[3]), 16) : 0;\n     return RegionInfoBuilder.newBuilder(TableName.valueOf(fields[0])).setStartKey(fields[1])\n-      .setSplit(false).setRegionId(regionId).setReplicaId(replicaId).build();\n+      .setRegionId(regionId).setReplicaId(replicaId).build();\n   }\n \n   /**\n"}}, {"oid": "752977a893b80d23ea4fda258b502b5a83aa3b83", "url": "https://github.com/apache/hbase/commit/752977a893b80d23ea4fda258b502b5a83aa3b83", "message": "HBASE-25088 CatalogFamilyFormat/MetaTableAccessor.parseRegionInfoFromRegionName incorrectly setEndKey to regionId", "committedDate": "2020-09-24T15:17:13Z", "type": "forcePushed"}, {"oid": "66e7e0a68d063bfca4389b56d1eb8c16bf84c554", "url": "https://github.com/apache/hbase/commit/66e7e0a68d063bfca4389b56d1eb8c16bf84c554", "message": "HBASE-25088 CatalogFamilyFormat/MetaTableAccessor.parseRegionInfoFromRegionName incorrectly setEndKey to regionId", "committedDate": "2020-09-24T15:19:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYyNjQwNg==", "url": "https://github.com/apache/hbase/pull/2448#discussion_r494626406", "bodyText": "NIT: As these variables are only used in the builder (and with that their purpose is also visible) below they can be directly used in the builder.", "author": "HorizonNet", "createdAt": "2020-09-24T21:40:12Z", "path": "hbase-client/src/test/java/org/apache/hadoop/hbase/TestCatalogFamilyFormat.java", "diffHunk": "@@ -70,4 +79,32 @@ public void testMetaReaderGetColumnMethods() {\n         HConstants.SEQNUM_QUALIFIER_STR + CatalogFamilyFormat.META_REPLICA_ID_DELIMITER + \"002A\"),\n       CatalogFamilyFormat.getSeqNumColumn(42));\n   }\n+\n+  /**\n+   * The info we can get from the regionName is: table name, start key, regionId, replicaId.\n+   */\n+  @Test\n+  public void testparseRegionInfoFromRegionName() throws IOException  {\n+    TableName tableName = TableName.valueOf(name.getMethodName());\n+    long regionId = 999999L;", "originalCommit": "66e7e0a68d063bfca4389b56d1eb8c16bf84c554", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef90262f4066da88cffccfe24dc1e19d6b33e8cf", "chunk": "diff --git a/hbase-client/src/test/java/org/apache/hadoop/hbase/TestCatalogFamilyFormat.java b/hbase-client/src/test/java/org/apache/hadoop/hbase/TestCatalogFamilyFormat.java\nindex e318cd8e17..eecc6446f5 100644\n--- a/hbase-client/src/test/java/org/apache/hadoop/hbase/TestCatalogFamilyFormat.java\n+++ b/hbase-client/src/test/java/org/apache/hadoop/hbase/TestCatalogFamilyFormat.java\n\n@@ -85,15 +85,10 @@ public class TestCatalogFamilyFormat {\n    */\n   @Test\n   public void testparseRegionInfoFromRegionName() throws IOException  {\n-    TableName tableName = TableName.valueOf(name.getMethodName());\n-    long regionId = 999999L;\n-    String startKey = \"2\";\n-    String endKey = \"3\";\n-    int replicaId = 1;\n-\n-    RegionInfo originalRegionInfo = RegionInfoBuilder.newBuilder(tableName).setRegionId(regionId)\n-      .setStartKey(Bytes.toBytes(startKey)).setEndKey(Bytes.toBytes(endKey))\n-      .setReplicaId(replicaId).build();\n+    RegionInfo originalRegionInfo = RegionInfoBuilder.newBuilder(\n+        TableName.valueOf(name.getMethodName())).setRegionId(999999L)\n+      .setStartKey(Bytes.toBytes(\"2\")).setEndKey(Bytes.toBytes(\"3\"))\n+      .setReplicaId(1).build();\n     RegionInfo newParsedRegionInfo = CatalogFamilyFormat\n       .parseRegionInfoFromRegionName(originalRegionInfo.getRegionName());\n     assertEquals(\"Parse TableName error\", originalRegionInfo.getTable(),\n"}}, {"oid": "ef90262f4066da88cffccfe24dc1e19d6b33e8cf", "url": "https://github.com/apache/hbase/commit/ef90262f4066da88cffccfe24dc1e19d6b33e8cf", "message": "HBASE-25088 CatalogFamilyFormat/MetaTableAccessor.parseRegionInfoFromRegionName incorrectly setEndKey to regionId", "committedDate": "2020-09-25T06:05:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk5NzI4Mg==", "url": "https://github.com/apache/hbase/pull/2448#discussion_r494997282", "bodyText": "I think the setSplit(false) could also be removed. The default value is false.", "author": "Apache9", "createdAt": "2020-09-25T13:44:11Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java", "diffHunk": "@@ -101,7 +101,7 @@ public static RegionInfo parseRegionInfoFromRegionName(byte[] regionName) throws\n     long regionId = Long.parseLong(Bytes.toString(fields[2]));\n     int replicaId = fields.length > 3 ? Integer.parseInt(Bytes.toString(fields[3]), 16) : 0;\n     return RegionInfoBuilder.newBuilder(TableName.valueOf(fields[0])).setStartKey(fields[1])\n-      .setEndKey(fields[2]).setSplit(false).setRegionId(regionId).setReplicaId(replicaId).build();\n+      .setSplit(false).setRegionId(regionId).setReplicaId(replicaId).build();", "originalCommit": "ef90262f4066da88cffccfe24dc1e19d6b33e8cf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1969e5a782af9260629a5f8c7d3e9c86cfaca0f1", "chunk": "diff --git a/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java b/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java\nindex 5d3eaa3f14..d0ee3dc833 100644\n--- a/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java\n+++ b/hbase-client/src/main/java/org/apache/hadoop/hbase/CatalogFamilyFormat.java\n\n@@ -101,7 +101,7 @@ public class CatalogFamilyFormat {\n     long regionId = Long.parseLong(Bytes.toString(fields[2]));\n     int replicaId = fields.length > 3 ? Integer.parseInt(Bytes.toString(fields[3]), 16) : 0;\n     return RegionInfoBuilder.newBuilder(TableName.valueOf(fields[0])).setStartKey(fields[1])\n-      .setSplit(false).setRegionId(regionId).setReplicaId(replicaId).build();\n+      .setRegionId(regionId).setReplicaId(replicaId).build();\n   }\n \n   /**\n"}}, {"oid": "1969e5a782af9260629a5f8c7d3e9c86cfaca0f1", "url": "https://github.com/apache/hbase/commit/1969e5a782af9260629a5f8c7d3e9c86cfaca0f1", "message": "HBASE-25088 CatalogFamilyFormat/MetaTableAccessor.parseRegionInfoFromRegionName incorrectly setEndKey to regionId", "committedDate": "2020-09-25T14:14:46Z", "type": "commit"}, {"oid": "1969e5a782af9260629a5f8c7d3e9c86cfaca0f1", "url": "https://github.com/apache/hbase/commit/1969e5a782af9260629a5f8c7d3e9c86cfaca0f1", "message": "HBASE-25088 CatalogFamilyFormat/MetaTableAccessor.parseRegionInfoFromRegionName incorrectly setEndKey to regionId", "committedDate": "2020-09-25T14:14:46Z", "type": "forcePushed"}]}