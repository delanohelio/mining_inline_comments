{"pr_number": 424, "pr_title": "fix: improve numeric range checks", "pr_createdAt": "2020-09-14T10:05:23Z", "pr_url": "https://github.com/googleapis/java-spanner/pull/424", "timeline": [{"oid": "7e0054527f69df209850ace6bb53fa7f7cf04769", "url": "https://github.com/googleapis/java-spanner/commit/7e0054527f69df209850ace6bb53fa7f7cf04769", "message": "fix: improve numeric range checks", "committedDate": "2020-09-14T10:01:03Z", "type": "commit"}, {"oid": "abb579c4e86cb3053096b2cef4310c70cf21faec", "url": "https://github.com/googleapis/java-spanner/commit/abb579c4e86cb3053096b2cef4310c70cf21faec", "message": "fix: skip numeric ITs on emulator", "committedDate": "2020-09-14T10:35:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxNjQzOA==", "url": "https://github.com/googleapis/java-spanner/pull/424#discussion_r488416438", "bodyText": "Is this all necessary because BigDecimal has arbitrary precision but NUMERIC doesn't?\nJust as an FYI, we chose not to do this explicit check in other clients just because we wanted to make sure that the backend threw errors in case they decide to change the precision later on. In practice, they wouldn't change it without notifying us so it's not a big deal.", "author": "skuruppu", "createdAt": "2020-09-15T06:27:39Z", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/Value.java", "diffHunk": "@@ -123,11 +123,37 @@ public static Value float64(double v) {\n   }\n \n   /**\n-   * Returns a {@code NUMERIC} value.\n+   * Returns a {@code NUMERIC} value. The valid value range for the whole component of the {@link\n+   * BigDecimal} is from -9,999,999,999,999,999,999,999,999 to +9,999,999,999,999,999,999,999,999\n+   * (both inclusive), i.e. the max length of the whole component is 29 digits. The max length of\n+   * the fractional part is 9 digits. Trailing zeros in the fractional part are not considered and\n+   * will be lost, as Cloud Spanner does not preserve the precision of a numeric value.\n+   *\n+   * <p>If you set a numeric value of a record to for example 0.10, Cloud Spanner will return this\n+   * value as 0.1 in subsequent queries. Use {@link BigDecimal#stripTrailingZeros()} to compare\n+   * inserted values with retrieved values if your application might insert numeric values with\n+   * trailing zeros.", "originalCommit": "abb579c4e86cb3053096b2cef4310c70cf21faec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyMzA3OA==", "url": "https://github.com/googleapis/java-spanner/pull/424#discussion_r488423078", "bodyText": "I added the check because the error messages from the backend are not very clear (at the moment). If you send an out-of-range NUMERIC value to Cloud Spanner, it will respond with a generic io.grpc.StatusRuntimeException: INVALID_ARGUMENT: Invalid value for bind parameter p1: Expected NUMERIC. That already confused one of the engineers at the Java frameworks team as he was sending a NUMERIC value, but it was out of range.", "author": "olavloite", "createdAt": "2020-09-15T06:43:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxNjQzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcxNDQ4Mw==", "url": "https://github.com/googleapis/java-spanner/pull/424#discussion_r490714483", "bodyText": "Thanks @olavloite. @thiagotnunes has informed the backend team asking them to return a more meaningful error. But in the meantime, it's ok for us to do this in the client. We can remove it when the backend returns a better error message.", "author": "skuruppu", "createdAt": "2020-09-18T05:42:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxNjQzOA=="}], "type": "inlineReview", "revised_code": null}]}