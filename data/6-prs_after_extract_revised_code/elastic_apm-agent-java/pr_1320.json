{"pr_number": 1320, "pr_title": "Fix log4j2 indy plugin context issues", "pr_createdAt": "2020-07-30T11:47:15Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1320", "timeline": [{"oid": "097676e8e0165a4718933964e80697bdf9705d2b", "url": "https://github.com/elastic/apm-agent-java/commit/097676e8e0165a4718933964e80697bdf9705d2b", "message": "Fix log4j2 indy plugin context issues\n\nBy calling classLoader.getParent() log4j tries to determine the logging context of a class loader\nThe IndyPluginClassLoader, having a MultipleParentClassLoader as it's parent, always retured null,\nmaking it impossible to reuse context from the agent classloader", "committedDate": "2020-07-30T11:45:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk4OTY1OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1320#discussion_r462989658", "bodyText": "The javadoc for this constructor says about the single-parent argument: \"This explicit parent should only be set if the current platform does not allow creating a class loader that extends the bootstrap loader\". Do you know why?", "author": "eyalkoren", "createdAt": "2020-07-30T13:19:20Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/bci/classloading/IndyPluginClassLoader.java", "diffHunk": "@@ -40,7 +40,7 @@\n  */\n public class IndyPluginClassLoader extends ByteArrayClassLoader.ChildFirst {\n     public IndyPluginClassLoader(@Nullable ClassLoader targetClassLoader, ClassLoader agentClassLoader, Map<String, byte[]> typeDefinitions) {\n-        super(new MultipleParentClassLoader(Arrays.asList(agentClassLoader, targetClassLoader)), true, typeDefinitions, PersistenceHandler.MANIFEST);\n+        super(new MultipleParentClassLoader(agentClassLoader, Arrays.asList(agentClassLoader, targetClassLoader)), true, typeDefinitions, PersistenceHandler.MANIFEST);", "originalCommit": "097676e8e0165a4718933964e80697bdf9705d2b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk5MzUzMg==", "url": "https://github.com/elastic/apm-agent-java/pull/1320#discussion_r462993532", "bodyText": "Not sure. Haven't noticed any issues with providing an explicit parent so far.", "author": "felixbarny", "createdAt": "2020-07-30T13:25:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk4OTY1OA=="}], "type": "inlineReview", "revised_code": null}]}