{"pr_number": 995, "pr_title": "Enforce consistent naming for agent threads", "pr_createdAt": "2020-01-15T10:50:53Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/995", "timeline": [{"oid": "6874ff1943ccc5afd85afe2298f39f366331ce68", "url": "https://github.com/elastic/apm-agent-java/commit/6874ff1943ccc5afd85afe2298f39f366331ce68", "message": "added ThreadUtils. Added prefix for all threads generating by agent.", "committedDate": "2020-01-15T10:48:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNDQzMA==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r366814430", "bodyText": "Do this within createSingleThreadSchedulingDeamonPool", "author": "felixbarny", "createdAt": "2020-01-15T10:58:15Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java", "diffHunk": "@@ -61,7 +62,7 @@\n     public SoftlyReferencingTypePoolCache(final TypePool.Default.ReaderMode readerMode,\n                                           final int clearIfNotAccessedSinceMinutes, ElementMatcher.Junction<ClassLoader> ignoredClassLoaders) {\n         super(readerMode);\n-        ExecutorUtils.createSingleThreadSchedulingDeamonPool(\"type-cache-pool-cleaner\", 1)\n+        ExecutorUtils.createSingleThreadSchedulingDeamonPool(ThreadUtils.addElasticApmThreadPrefix(\"type-cache-pool-cleaner\"), 1)", "originalCommit": "6874ff1943ccc5afd85afe2298f39f366331ce68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgzMDE0Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r366830146", "bodyText": "fixed", "author": "kananindzya", "createdAt": "2020-01-15T11:37:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNDQzMA=="}], "type": "inlineReview", "revised_code": {"commit": "b6a260012a15e9d7a2a6536c7484b8e5459f41ed", "chunk": "diff --git a/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java b/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java\nindex 02d39bf42..16d55719c 100644\n--- a/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java\n+++ b/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java\n\n@@ -62,7 +62,7 @@ public class SoftlyReferencingTypePoolCache extends AgentBuilder.PoolStrategy.Wi\n     public SoftlyReferencingTypePoolCache(final TypePool.Default.ReaderMode readerMode,\n                                           final int clearIfNotAccessedSinceMinutes, ElementMatcher.Junction<ClassLoader> ignoredClassLoaders) {\n         super(readerMode);\n-        ExecutorUtils.createSingleThreadSchedulingDeamonPool(ThreadUtils.addElasticApmThreadPrefix(\"type-cache-pool-cleaner\"), 1)\n+        ExecutorUtils.createSingleThreadSchedulingDeamonPool(\"type-cache-pool-cleaner\", 1)\n             .scheduleWithFixedDelay(new Runnable() {\n                 @Override\n                 public void run() {\n"}}, {"oid": "188db457d01b19ff68e212ec0dba650d87f818b8", "url": "https://github.com/elastic/apm-agent-java/commit/188db457d01b19ff68e212ec0dba650d87f818b8", "message": "added test", "committedDate": "2020-01-15T11:07:24Z", "type": "commit"}, {"oid": "b6a260012a15e9d7a2a6536c7484b8e5459f41ed", "url": "https://github.com/elastic/apm-agent-java/commit/b6a260012a15e9d7a2a6536c7484b8e5459f41ed", "message": "fixed according to comments.", "committedDate": "2020-01-15T11:35:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NjI0NA==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r366846244", "bodyText": "remove unused import", "author": "felixbarny", "createdAt": "2020-01-15T12:20:11Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java", "diffHunk": "@@ -25,6 +25,7 @@\n package co.elastic.apm.agent.bci.bytebuddy;\n \n import co.elastic.apm.agent.util.ExecutorUtils;\n+import co.elastic.apm.agent.util.ThreadUtils;", "originalCommit": "b6a260012a15e9d7a2a6536c7484b8e5459f41ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0MjAyNw==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r367342027", "bodyText": "removed", "author": "kananindzya", "createdAt": "2020-01-16T10:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NjI0NA=="}], "type": "inlineReview", "revised_code": {"commit": "38ddb43fd303959c9b268448ad96128edc3932ec", "chunk": "diff --git a/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java b/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java\nindex 16d55719c..edc948dbb 100644\n--- a/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java\n+++ b/apm-agent-core/src/main/java/co/elastic/apm/agent/bci/bytebuddy/SoftlyReferencingTypePoolCache.java\n\n@@ -25,7 +25,6 @@\n package co.elastic.apm.agent.bci.bytebuddy;\n \n import co.elastic.apm.agent.util.ExecutorUtils;\n-import co.elastic.apm.agent.util.ThreadUtils;\n import com.blogspot.mydailyjava.weaklockfree.WeakConcurrentMap;\n import net.bytebuddy.agent.builder.AgentBuilder;\n import net.bytebuddy.description.type.TypeDescription;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NjI5NQ==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r366846295", "bodyText": "remove unused import", "author": "felixbarny", "createdAt": "2020-01-15T12:20:17Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/configuration/ApmServerConfigurationSource.java", "diffHunk": "@@ -30,6 +30,7 @@\n import co.elastic.apm.agent.report.ApmServerClient;\n import co.elastic.apm.agent.report.serialize.PayloadSerializer;\n import co.elastic.apm.agent.util.ExecutorUtils;\n+import co.elastic.apm.agent.util.ThreadUtils;", "originalCommit": "b6a260012a15e9d7a2a6536c7484b8e5459f41ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0MjA3Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r367342076", "bodyText": "removed", "author": "kananindzya", "createdAt": "2020-01-16T10:29:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NjI5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "38ddb43fd303959c9b268448ad96128edc3932ec", "chunk": "diff --git a/apm-agent-core/src/main/java/co/elastic/apm/agent/configuration/ApmServerConfigurationSource.java b/apm-agent-core/src/main/java/co/elastic/apm/agent/configuration/ApmServerConfigurationSource.java\nindex d8c5b22a2..a0e504369 100644\n--- a/apm-agent-core/src/main/java/co/elastic/apm/agent/configuration/ApmServerConfigurationSource.java\n+++ b/apm-agent-core/src/main/java/co/elastic/apm/agent/configuration/ApmServerConfigurationSource.java\n\n@@ -30,7 +30,6 @@ import co.elastic.apm.agent.impl.MetaData;\n import co.elastic.apm.agent.report.ApmServerClient;\n import co.elastic.apm.agent.report.serialize.PayloadSerializer;\n import co.elastic.apm.agent.util.ExecutorUtils;\n-import co.elastic.apm.agent.util.ThreadUtils;\n import com.dslplatform.json.DslJson;\n import com.dslplatform.json.JsonReader;\n import com.dslplatform.json.MapConverter;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NjM3OQ==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r366846379", "bodyText": "remove unused import", "author": "felixbarny", "createdAt": "2020-01-15T12:20:27Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/report/ApmServerHealthChecker.java", "diffHunk": "@@ -25,6 +25,7 @@\n package co.elastic.apm.agent.report;\n \n import co.elastic.apm.agent.util.ExecutorUtils;\n+import co.elastic.apm.agent.util.ThreadUtils;", "originalCommit": "b6a260012a15e9d7a2a6536c7484b8e5459f41ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0MjExNg==", "url": "https://github.com/elastic/apm-agent-java/pull/995#discussion_r367342116", "bodyText": "removed", "author": "kananindzya", "createdAt": "2020-01-16T10:29:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NjM3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "38ddb43fd303959c9b268448ad96128edc3932ec", "chunk": "diff --git a/apm-agent-core/src/main/java/co/elastic/apm/agent/report/ApmServerHealthChecker.java b/apm-agent-core/src/main/java/co/elastic/apm/agent/report/ApmServerHealthChecker.java\nindex 33803e8ce..368f6cbeb 100644\n--- a/apm-agent-core/src/main/java/co/elastic/apm/agent/report/ApmServerHealthChecker.java\n+++ b/apm-agent-core/src/main/java/co/elastic/apm/agent/report/ApmServerHealthChecker.java\n\n@@ -25,7 +25,6 @@\n package co.elastic.apm.agent.report;\n \n import co.elastic.apm.agent.util.ExecutorUtils;\n-import co.elastic.apm.agent.util.ThreadUtils;\n import co.elastic.apm.agent.util.Version;\n import com.dslplatform.json.DslJson;\n import com.dslplatform.json.JsonReader;\n"}}, {"oid": "38ddb43fd303959c9b268448ad96128edc3932ec", "url": "https://github.com/elastic/apm-agent-java/commit/38ddb43fd303959c9b268448ad96128edc3932ec", "message": "added new method for creating WeakConcurrentSet with overrided cleaner thread name.", "committedDate": "2020-01-16T10:29:04Z", "type": "commit"}, {"oid": "fdc01978821aa2b130d71b19b3429625feb4cc59", "url": "https://github.com/elastic/apm-agent-java/commit/fdc01978821aa2b130d71b19b3429625feb4cc59", "message": "Consistently name config reloader thread", "committedDate": "2020-01-16T14:43:01Z", "type": "commit"}, {"oid": "7bc2f2e08de8a81aac1275851b9f84b5b5171581", "url": "https://github.com/elastic/apm-agent-java/commit/7bc2f2e08de8a81aac1275851b9f84b5b5171581", "message": "Merge pull request #3 from felixbarny/issue-960-consistent-namming-for-agent-threads\n\nConsistently name config reloader thread", "committedDate": "2020-01-16T16:21:10Z", "type": "commit"}, {"oid": "44a9f378e7c0fe4b87d382dfd6e611c3fa8b4dff", "url": "https://github.com/elastic/apm-agent-java/commit/44a9f378e7c0fe4b87d382dfd6e611c3fa8b4dff", "message": "make var final", "committedDate": "2020-01-16T16:27:40Z", "type": "commit"}]}