{"pr_number": 958, "pr_title": "Gg 23528", "pr_createdAt": "2020-02-28T07:22:44Z", "pr_url": "https://github.com/gridgain/gridgain/pull/958", "timeline": [{"oid": "a2110e636933b3c815b18d47c6d5359b840b3c36", "url": "https://github.com/gridgain/gridgain/commit/a2110e636933b3c815b18d47c6d5359b840b3c36", "message": "GG-23528 First impl", "committedDate": "2020-02-23T07:05:58Z", "type": "commit"}, {"oid": "e1d214301023e4abfe47ea422bac23dbbf3d9589", "url": "https://github.com/gridgain/gridgain/commit/e1d214301023e4abfe47ea422bac23dbbf3d9589", "message": "GG-23528 Fix first impl and add 2 test", "committedDate": "2020-02-26T09:40:48Z", "type": "commit"}, {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032", "url": "https://github.com/gridgain/gridgain/commit/5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032", "message": "Merge branch 'master' into gg-23528", "committedDate": "2020-02-26T09:42:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA==", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385547164", "bodyText": "May be more proper use F.exist(rawArgs, (arg) -> CMD_PRINT_ERR_STACK_TRACE.equals(CMD_PRINT_ERR_STACK_TRACE))", "author": "vldpyatkov", "createdAt": "2020-02-28T07:40:19Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n \n+        Throwable err = null;\n+        boolean printErrStackTrace = false;\n+\n         try {\n             if (F.isEmpty(rawArgs) || (rawArgs.size() == 1 && CMD_HELP.equalsIgnoreCase(rawArgs.get(0)))) {\n                 printHelp();\n \n                 return EXIT_CODE_OK;\n             }\n \n+            printErrStackTrace = rawArgs.stream().anyMatch(CMD_PRINT_ERR_STACK_TRACE::equals);", "originalCommit": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NDQzOA==", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385554438", "bodyText": "I think to use parser instead of go through console args manually.", "author": "vldpyatkov", "createdAt": "2020-02-28T08:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5MzE1MA==", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386093150", "bodyText": "Remade to F#exist.\nIn the beginning I did through the parser, but then I realized that while parsing can also appear error, stack where you want to watch, so I made also the argument \"--print-err-stack-trace\" may be at the end and it not get.", "author": "tkalkirill", "createdAt": "2020-03-01T09:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA=="}], "type": "inlineReview", "revised_code": {"commit": "589ce3e023a6010f5047d6d5c8922c53db148cbd", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java b/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java\nindex 275db22996d..d4148247284 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java\n\n@@ -235,7 +235,7 @@ public class CommandHandler {\n                 return EXIT_CODE_OK;\n             }\n \n-            printErrStackTrace = rawArgs.stream().anyMatch(CMD_PRINT_ERR_STACK_TRACE::equals);\n+            printErrStackTrace = F.exist(rawArgs, CMD_PRINT_ERR_STACK_TRACE::equalsIgnoreCase);\n \n             ConnectionAndSslParameters args = new CommonArgParser(logger).parseAndValidate(rawArgs.iterator());\n \n"}}, {"oid": "0fff2eccf5ca25ac4f1a3ee5eebd23809d05c174", "url": "https://github.com/gridgain/gridgain/commit/0fff2eccf5ca25ac4f1a3ee5eebd23809d05c174", "message": "GG-23528 Fix by review", "committedDate": "2020-03-01T08:03:13Z", "type": "commit"}, {"oid": "589ce3e023a6010f5047d6d5c8922c53db148cbd", "url": "https://github.com/gridgain/gridgain/commit/589ce3e023a6010f5047d6d5c8922c53db148cbd", "message": "GG-23528 Fix by review #2", "committedDate": "2020-03-01T09:29:56Z", "type": "commit"}, {"oid": "273c1624eff9c72e1d4357451df366a191c1140e", "url": "https://github.com/gridgain/gridgain/commit/273c1624eff9c72e1d4357451df366a191c1140e", "message": "Merge branch 'master' into gg-23528", "committedDate": "2020-03-01T09:37:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NjA1MQ==", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386976051", "bodyText": "Does this logger have an issue with printing several lines?\nLike this manner:\nlogger.info(\"Error stack trace:\\n\" +\nX.getFullStackTrace(err));", "author": "vldpyatkov", "createdAt": "2020-03-03T12:05:43Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -319,34 +331,45 @@ public int execute(List<String> rawArgs) {\n                     if (isSSLMisconfigurationError(cause))\n                         e = cause;\n \n-                    logger.severe(\"Connection to cluster failed. \" + CommandLogger.errorMessage(e));\n+                    logger.severe(\"Connection to cluster failed. \" + errorMessage(e));\n \n                 }\n \n                 logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_CONNECTION_FAILED);\n \n+                err = e;\n+\n                 return EXIT_CODE_CONNECTION_FAILED;\n             }\n \n             if (X.hasCause(e, VisorIllegalStateException.class)) {\n                 VisorIllegalStateException vise = X.cause(e, VisorIllegalStateException.class);\n \n-                logger.severe(CommandLogger.errorMessage(vise));\n+                logger.severe(errorMessage(vise));\n                 logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_ILLEGAL_STATE_ERROR);\n \n+                err = e;\n+\n                 return EXIT_CODE_ILLEGAL_STATE_ERROR;\n             }\n \n-            logger.severe(CommandLogger.errorMessage(e));\n+            logger.severe(errorMessage(e));\n             logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_UNEXPECTED_ERROR);\n \n+            err = e;\n+\n             return EXIT_CODE_UNEXPECTED_ERROR;\n         }\n         finally {\n             LocalDateTime endTime = LocalDateTime.now();\n \n             Duration diff = Duration.between(startTime, endTime);\n \n+            if (printErrStackTrace && nonNull(err)) {\n+                logger.info(\"Error stack trace:\");\n+                logger.info(X.getFullStackTrace(err));", "originalCommit": "273c1624eff9c72e1d4357451df366a191c1140e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fde551c397179637e1c8a7bd15530b1548e46fdd", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java b/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java\nindex d4148247284..80df3d208a9 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java\n\n@@ -365,10 +365,8 @@ public class CommandHandler {\n \n             Duration diff = Duration.between(startTime, endTime);\n \n-            if (printErrStackTrace && nonNull(err)) {\n-                logger.info(\"Error stack trace:\");\n-                logger.info(X.getFullStackTrace(err));\n-            }\n+            if (printErrStackTrace && nonNull(err))\n+                logger.info(\"Error stack trace:\" + System.lineSeparator() + X.getFullStackTrace(err));\n \n             logger.info(\"Control utility has completed execution at: \" + endTime);\n             logger.info(\"Execution time: \" + diff.toMillis() + \" ms\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NzgzOA==", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386977838", "bodyText": "Excess empty line.", "author": "vldpyatkov", "createdAt": "2020-03-03T12:09:43Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n ", "originalCommit": "273c1624eff9c72e1d4357451df366a191c1140e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA5MzEyOQ==", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r387093129", "bodyText": "I think there should be an empty string here.", "author": "tkalkirill", "createdAt": "2020-03-03T15:22:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NzgzOA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "fde551c397179637e1c8a7bd15530b1548e46fdd", "url": "https://github.com/gridgain/gridgain/commit/fde551c397179637e1c8a7bd15530b1548e46fdd", "message": "GG-23528 Fix by new review", "committedDate": "2020-03-03T15:36:55Z", "type": "commit"}]}