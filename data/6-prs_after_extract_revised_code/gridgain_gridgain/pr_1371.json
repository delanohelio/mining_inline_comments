{"pr_number": 1371, "pr_title": "GG-30524 unified interface to open files (from configuration, especially)", "pr_createdAt": "2020-08-14T13:18:00Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1371", "timeline": [{"oid": "b50e093d970f1783e624790b07ada956d8d0ffa8", "url": "https://github.com/gridgain/gridgain/commit/b50e093d970f1783e624790b07ada956d8d0ffa8", "message": "GG-30524 add U.openFileInputStream and use it to find files", "committedDate": "2020-08-14T12:57:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYyMTE3Mw==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r470621173", "bodyText": "Let's use try-finally for streams.", "author": "AMashenkov", "createdAt": "2020-08-14T13:24:38Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java", "diffHunk": "@@ -1056,6 +1058,52 @@ public void testDoInParallelBatch() {\n         }\n     }\n \n+    /**\n+     * Test open file:\n+     * 1. by relative path\n+     * 2. by absolute path\n+     * 3. by classpath path\n+     * 4. by non existing path\n+     *\n+     * @throws Throwable\n+     */\n+    @Test\n+    public void testOpenFileInputStream() throws Throwable{\n+        // 1. by relative path\n+        InputStream relative = U.openFileInputStream(\"org.apache.ignite.util/bigUtf.txt\");\n+\n+        assertNotNull(\"Can't open input stream by relative path org.apache.ignite.util/bigUtf.txt\", relative);\n+\n+        relative.close();\n+\n+        // 2. by absolute path\n+        String absolutePath = U.getIgniteHome() + \"/pom.xml\";\n+        InputStream absolute = U.openFileInputStream(absolutePath);", "originalCommit": "b50e093d970f1783e624790b07ada956d8d0ffa8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM4NjQ4OA==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r471386488", "bodyText": "Switch to try with resources", "author": "Berkof", "createdAt": "2020-08-17T10:27:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYyMTE3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "7f95a232fd33fec7d0eb7166c2376cff2024b141", "chunk": "diff --git a/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java b/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java\nindex 947536d1847..053ad5a3731 100644\n--- a/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java\n+++ b/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java\n\n@@ -1070,34 +1070,26 @@ public class IgniteUtilsSelfTest extends GridCommonAbstractTest {\n     @Test\n     public void testOpenFileInputStream() throws Throwable{\n         // 1. by relative path\n-        InputStream relative = U.openFileInputStream(\"org.apache.ignite.util/bigUtf.txt\");\n-\n-        assertNotNull(\"Can't open input stream by relative path org.apache.ignite.util/bigUtf.txt\", relative);\n-\n-        relative.close();\n+        try(InputStream relative = U.openFileInputStream(\"org.apache.ignite.util/bigUtf.txt\")) {\n+            assertNotNull(\"Can't open input stream by relative path org.apache.ignite.util/bigUtf.txt\", relative);\n+        }\n \n         // 2. by absolute path\n         String absolutePath = U.getIgniteHome() + \"/pom.xml\";\n-        InputStream absolute = U.openFileInputStream(absolutePath);\n-\n-        assertNotNull(\"Can't open input stream by absolute path \" + absolutePath, absolute);\n-\n-        absolute.close();\n+        try (InputStream absolute = U.openFileInputStream(absolutePath)) {\n+            assertNotNull(\"Can't open input stream by absolute path \" + absolutePath, absolute);\n+        }\n \n \n         // 3. by classpath path\n \n-        InputStream classpath = U.openFileInputStream(\"org/apache/ignite/internal/util/IgniteUtils.class\");\n-\n-        assertNotNull(\"Can't open input stream to IgniteUtils.class resource\", classpath);\n-\n-        classpath.close();\n+        try(InputStream classpath = U.openFileInputStream(\"org/apache/ignite/internal/util/IgniteUtils.class\")) {\n+            assertNotNull(\"Can't open input stream to IgniteUtils.class resource\", classpath);\n+        }\n \n         // 4. by non existing path\n \n-        try {\n-            InputStream notExisting = U.openFileInputStream(\"Open/Source/In-Memory/Computing/Platform/Apache/Ignite\");\n-\n+        try(InputStream notExisting = U.openFileInputStream(\"Open/Source/In-Memory/Computing/Platform/Apache/Ignite\");) {\n             fail(\"Open input stream to not existing resource\");\n         } catch (FileNotFoundException e) {\n             // No-op.\n"}}, {"oid": "7f95a232fd33fec7d0eb7166c2376cff2024b141", "url": "https://github.com/gridgain/gridgain/commit/7f95a232fd33fec7d0eb7166c2376cff2024b141", "message": "GG-30524 use try with resources in U tests", "committedDate": "2020-08-17T10:26:25Z", "type": "commit"}, {"oid": "93ee8977a656bf222e3c1906cb19c7b7a50ddbf2", "url": "https://github.com/gridgain/gridgain/commit/93ee8977a656bf222e3c1906cb19c7b7a50ddbf2", "message": "GG-30524 formatting", "committedDate": "2020-08-17T10:30:04Z", "type": "commit"}, {"oid": "6d5e186891dbbdb1237a97fd97232e3a03801142", "url": "https://github.com/gridgain/gridgain/commit/6d5e186891dbbdb1237a97fd97232e3a03801142", "message": "GG-30524 fix checkstyle", "committedDate": "2020-08-20T08:45:34Z", "type": "commit"}, {"oid": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "url": "https://github.com/gridgain/gridgain/commit/3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "message": "GG-30524 return public API method and deprecate it", "committedDate": "2020-08-20T09:43:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTI4Mw==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473931283", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 */\n          \n          \n            \n                 * @deprecated Use {@link U#openFileInputStream(String)} instead.\n          \n          \n            \n                 */", "author": "AMashenkov", "createdAt": "2020-08-20T12:27:11Z", "path": "modules/core/src/main/java/org/apache/ignite/ssl/SslContextFactory.java", "diffHunk": "@@ -476,6 +477,7 @@ private void checkNullParameter(Object param, String name) throws SSLException {\n      * @return Opened input stream.\n      * @throws IOException If stream could not be opened.\n      */", "originalCommit": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMzUyMA==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473933520", "bodyText": "we can't offer to use internal class from public API", "author": "Berkof", "createdAt": "2020-08-20T12:31:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTI4Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTYwMw==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473931603", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @throws Throwable\n          \n          \n            \n                 * @throws Throwable If fails.", "author": "AMashenkov", "createdAt": "2020-08-20T12:27:43Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java", "diffHunk": "@@ -1056,6 +1058,41 @@ public void testDoInParallelBatch() {\n         }\n     }\n \n+    /**\n+     * Test open file:\n+     * 1. by relative path\n+     * 2. by absolute path\n+     * 3. by classpath path\n+     * 4. by non existing path\n+     *\n+     * @throws Throwable", "originalCommit": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzODQ4MQ==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473938481", "bodyText": "DONE", "author": "Berkof", "createdAt": "2020-08-20T12:40:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTYwMw=="}], "type": "inlineReview", "revised_code": {"commit": "3caa5a04447b5b003a3aa27d932c33d2a8f58c98", "chunk": "diff --git a/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java b/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java\nindex f73b1e240aa..d106e1b45c7 100644\n--- a/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java\n+++ b/modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java\n\n@@ -1065,7 +1065,7 @@ public class IgniteUtilsSelfTest extends GridCommonAbstractTest {\n      * 3. by classpath path\n      * 4. by non existing path\n      *\n-     * @throws Throwable\n+     * @throws Throwable If fails.\n      */\n     @Test\n     public void testOpenFileInputStream() throws Throwable {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMjA1NQ==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473932055", "bodyText": "Suggested change", "author": "AMashenkov", "createdAt": "2020-08-20T12:28:31Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java", "diffHunk": "@@ -3593,6 +3593,28 @@ public static void onGridStop() throws InterruptedException {\n         }\n     }\n \n+    /**\n+     * Find file (by path or in resources) and open input stream to it.\n+     *\n+     * @param filePath Path to the file.\n+     * @return Opened input stream.\n+     * @throws IOException If stream could not be opened.\n+     */\n+    public static InputStream openFileInputStream(String filePath) throws IOException {\n+", "originalCommit": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzNzg4Ng==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473937886", "bodyText": "DONE", "author": "Berkof", "createdAt": "2020-08-20T12:39:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMjA1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "3caa5a04447b5b003a3aa27d932c33d2a8f58c98", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java b/modules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java\nindex 4d71312f9c6..31829ca9bee 100755\n--- a/modules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java\n\n@@ -3601,7 +3601,6 @@ public abstract class IgniteUtils {\n      * @throws IOException If stream could not be opened.\n      */\n     public static InputStream openFileInputStream(String filePath) throws IOException {\n-\n         File abs = new File(filePath);\n \n         if (abs.exists())\n"}}, {"oid": "3caa5a04447b5b003a3aa27d932c33d2a8f58c98", "url": "https://github.com/gridgain/gridgain/commit/3caa5a04447b5b003a3aa27d932c33d2a8f58c98", "message": "GG-30524 code review fixes", "committedDate": "2020-08-20T12:41:47Z", "type": "commit"}, {"oid": "2e4fbc83282331ea664f60d424523b9249d43c3e", "url": "https://github.com/gridgain/gridgain/commit/2e4fbc83282331ea664f60d424523b9249d43c3e", "message": "Merge branch 'master' into gg-30524", "committedDate": "2020-08-20T12:44:02Z", "type": "commit"}, {"oid": "327c51b2ab8e1f20cc1fa23b230662ce0618f146", "url": "https://github.com/gridgain/gridgain/commit/327c51b2ab8e1f20cc1fa23b230662ce0618f146", "message": "Merge remote-tracking branch 'gridgain-ce/master' into gg-30524", "committedDate": "2020-08-20T13:08:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjkwMQ==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r474546901", "bodyText": "And why did you decided to deprecate this? It's looks useful to me in case when you are needed to provide custom place from which you have to load a keystore.", "author": "korlov42", "createdAt": "2020-08-21T08:57:54Z", "path": "modules/core/src/main/java/org/apache/ignite/ssl/SslContextFactory.java", "diffHunk": "@@ -476,6 +477,7 @@ private void checkNullParameter(Object param, String name) throws SSLException {\n      * @return Opened input stream.\n      * @throws IOException If stream could not be opened.\n      */\n+    @Deprecated", "originalCommit": "327c51b2ab8e1f20cc1fa23b230662ce0618f146", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzNTcyMg==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r475335722", "bodyText": "Only because I suppose we should use the same way to load any configuration parts, not only for SslContextFactory. But now we haven't such mehanism.", "author": "Berkof", "createdAt": "2020-08-24T04:28:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjkwMQ=="}], "type": "inlineReview", "revised_code": null}]}