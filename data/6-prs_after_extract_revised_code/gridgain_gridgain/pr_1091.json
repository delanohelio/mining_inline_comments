{"pr_number": 1091, "pr_title": "GG-28826 [IGNITE-12468] Java thin: deserialization of collections fixed", "pr_createdAt": "2020-04-21T02:22:01Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1091", "timeline": [{"oid": "66b96780790e90fc5eb78077402107d397822528", "url": "https://github.com/gridgain/gridgain/commit/66b96780790e90fc5eb78077402107d397822528", "message": "IGNITE-12468 Java thin: deserialization of collections fixed\n\n(cherry picked from commit 4433485d74adc109ac5f435569e18578bc9f351f)", "committedDate": "2020-04-21T02:23:30Z", "type": "commit"}, {"oid": "66b96780790e90fc5eb78077402107d397822528", "url": "https://github.com/gridgain/gridgain/commit/66b96780790e90fc5eb78077402107d397822528", "message": "IGNITE-12468 Java thin: deserialization of collections fixed\n\n(cherry picked from commit 4433485d74adc109ac5f435569e18578bc9f351f)", "committedDate": "2020-04-21T02:23:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA==", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412743174", "bodyText": "This does not look correct to me:\n\nWhy do we use special unmarshal logic for thin client? It is supposed to be reused from thick, right?\nWe should not need to unwrap things like that. When keepBinary is false, we should deserialize correctly right away, without intermediate BinaryObjects that need to be unwrapped.", "author": "ptupitsyn", "createdAt": "2020-04-22T07:35:21Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -495,12 +501,73 @@ void writeObject(BinaryOutputStream out, Object obj) {\n \n     /** Read Ignite binary object from input stream. */\n     <T> T readObject(BinaryInputStream in, boolean keepBinary) {\n-        Object val = marsh.unmarshal(in);\n+        if (keepBinary)\n+            return (T)marsh.unmarshal(in);\n+        else {\n+            BinaryReaderHandles hnds = new BinaryReaderHandles();\n+\n+            return (T)unwrapBinary(marsh.deserialize(in, hnds), hnds);\n+        }\n+    }\n+\n+    /**\n+     * Unwrap binary object.\n+     */\n+    private Object unwrapBinary(Object obj, BinaryReaderHandles hnds) {", "originalCommit": "66b96780790e90fc5eb78077402107d397822528", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk0OTg3NQ==", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412949875", "bodyText": "Well, now we need to decide what should we do with this, considering this is backport from Ignite.", "author": "isapego", "createdAt": "2020-04-22T12:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk1NzgyNQ==", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412957825", "bodyText": "I propose to properly fix this in separate patch so it can be donated in Ignite. What do you think?", "author": "isapego", "createdAt": "2020-04-22T12:56:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA0NDY5Mw==", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r413044693", "bodyText": "Agree.", "author": "ptupitsyn", "createdAt": "2020-04-22T14:43:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA=="}], "type": "inlineReview", "revised_code": null}]}