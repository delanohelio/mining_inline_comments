{"pr_number": 1011, "pr_title": "GG-28214 Renamed default schema field.", "pr_createdAt": "2020-03-25T14:15:00Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1011", "timeline": [{"oid": "aaa8ab7f3c115b46ae0d9c852f94456cb3ea6065", "url": "https://github.com/gridgain/gridgain/commit/aaa8ab7f3c115b46ae0d9c852f94456cb3ea6065", "message": "GG-28214 Renamed default schema field.", "committedDate": "2020-03-25T13:41:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMzA1OA==", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398303058", "bodyText": "org.apache.ignite.internal.processors.cache.GridCacheProcessor#cache use the cache name as an argument, but you pass schema name. How this will work?", "author": "nva", "createdAt": "2020-03-26T03:51:57Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java", "diffHunk": "@@ -132,9 +133,13 @@ public QueryActionsController(GridKernalContext ctx) {\n \n                 SqlFieldsQuery qry = prepareQuery(arg);\n \n-                GridCacheContext cctx = F.isEmpty(arg.getCacheName())\n+                IgniteInternalCache<Object, Object> cache = F.isEmpty(arg.getDefaultSchema())\n+                    ? null\n+                    : ctx.cache().cache(arg.getDefaultSchema());", "originalCommit": "aaa8ab7f3c115b46ae0d9c852f94456cb3ea6065", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM2MzMyMA==", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398363320", "bodyText": "Expected that cache name will be sent and its context will be used.", "author": "vsisko", "createdAt": "2020-03-26T07:29:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMzA1OA=="}], "type": "inlineReview", "revised_code": {"commit": "37172077e8b2108bb3eaa20e70a714ddd37c300e", "chunk": "diff --git a/modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java b/modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java\nindex ce43096df29..e3c3a7a80d1 100644\n--- a/modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java\n+++ b/modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java\n\n@@ -133,15 +133,7 @@ public class QueryActionsController {\n \n                 SqlFieldsQuery qry = prepareQuery(arg);\n \n-                IgniteInternalCache<Object, Object> cache = F.isEmpty(arg.getDefaultSchema())\n-                    ? null\n-                    : ctx.cache().cache(arg.getDefaultSchema());\n-\n-                GridCacheContext cctx = cache == null\n-                        ? null\n-                        : cache.context();\n-\n-                for (FieldsQueryCursor<List<?>> cur : qryProc.querySqlFields(cctx, qry, null, true, false, qryHolder.cancelHook())) {\n+                for (FieldsQueryCursor<List<?>> cur : qryProc.querySqlFields(null, qry, null, true, false, qryHolder.cancelHook())) {\n                     CursorHolder cursorHolder = new CursorHolder(cur);\n \n                     QueryResult res = fetchSqlQueryResult(cursorHolder, arg.getPageSize());\n"}}, {"oid": "37172077e8b2108bb3eaa20e70a714ddd37c300e", "url": "https://github.com/gridgain/gridgain/commit/37172077e8b2108bb3eaa20e70a714ddd37c300e", "message": "GG-28214 Renamed default schema field.", "committedDate": "2020-03-26T10:57:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ5NzQyMg==", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398497422", "bodyText": "Let's add test where schema is removed from query and set we set default schema", "author": "nva", "createdAt": "2020-03-26T11:23:54Z", "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/action/controller/QueryActionsControllerTest.java", "diffHunk": "@@ -365,7 +453,7 @@ public void shouldReturnRunningQueriesFromAllNodes() {\n                         .setQueryId(UUID.randomUUID().toString())\n                         .setQueryText(\"SELECT count(*), sleep() AS \\\"\" + nid + \"\\\" FROM \\\"TestCache\\\".STRING\")\n                         .setPageSize(1)\n-                        .setCacheName(\"TestCache\")\n+                        .setDefaultSchema(\"TestCache\")", "originalCommit": "37172077e8b2108bb3eaa20e70a714ddd37c300e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU5Mzc5OQ==", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398593799", "bodyText": "This variant is already implemented in my test:\ngetSelectQuery(fullTestTable) + getSelectQuery(testTable)", "author": "vsisko", "createdAt": "2020-03-26T13:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ5NzQyMg=="}], "type": "inlineReview", "revised_code": null}]}