{"pr_number": 965, "pr_title": "PLANNER-2203 Add <Solution_> to various classes", "pr_createdAt": "2020-10-11T21:48:51Z", "pr_url": "https://github.com/kiegroup/optaplanner/pull/965", "timeline": [{"oid": "461c86403dc54a99d8c3ec71316d2cbd7e0c3bcc", "url": "https://github.com/kiegroup/optaplanner/commit/461c86403dc54a99d8c3ec71316d2cbd7e0c3bcc", "message": "Phase 1", "committedDate": "2020-10-11T17:52:42Z", "type": "commit"}, {"oid": "5e3e150e7be21e294ed21902391eda3a89603cda", "url": "https://github.com/kiegroup/optaplanner/commit/5e3e150e7be21e294ed21902391eda3a89603cda", "message": "Configs get <Solution_> too", "committedDate": "2020-10-11T21:32:36Z", "type": "commit"}, {"oid": "797e5d6cee9eaff99a10372c1f6dc13610650680", "url": "https://github.com/kiegroup/optaplanner/commit/797e5d6cee9eaff99a10372c1f6dc13610650680", "message": "Fix Revapi", "committedDate": "2020-10-11T21:39:51Z", "type": "commit"}, {"oid": "cf5983de82617f3f9f6dcd2647151a08bbaeaec9", "url": "https://github.com/kiegroup/optaplanner/commit/cf5983de82617f3f9f6dcd2647151a08bbaeaec9", "message": "Code formatting", "committedDate": "2020-10-11T21:41:15Z", "type": "commit"}, {"oid": "d1cca9139635a127b3958c9d0014c81e9e5d1d13", "url": "https://github.com/kiegroup/optaplanner/commit/d1cca9139635a127b3958c9d0014c81e9e5d1d13", "message": "Benchmark Revapi", "committedDate": "2020-10-11T21:43:51Z", "type": "commit"}, {"oid": "5801665310142a2f94b00fc12cd9e10c9ceb2ea4", "url": "https://github.com/kiegroup/optaplanner/commit/5801665310142a2f94b00fc12cd9e10c9ceb2ea4", "message": "Fix imports", "committedDate": "2020-10-11T21:58:54Z", "type": "commit"}, {"oid": "5142210fa5d75952cc76dd435591703ca6021089", "url": "https://github.com/kiegroup/optaplanner/commit/5142210fa5d75952cc76dd435591703ca6021089", "message": "Remove some redundant casts", "committedDate": "2020-10-12T08:53:46Z", "type": "commit"}, {"oid": "143a461a031b89fc770fc9afa5c1e68327613c7a", "url": "https://github.com/kiegroup/optaplanner/commit/143a461a031b89fc770fc9afa5c1e68327613c7a", "message": "I still need to go over many tests", "committedDate": "2020-10-12T11:27:53Z", "type": "commit"}, {"oid": "44a7238e621af834f717b612977674adc1f1ec17", "url": "https://github.com/kiegroup/optaplanner/commit/44a7238e621af834f717b612977674adc1f1ec17", "message": "Remove config changes", "committedDate": "2020-10-12T15:16:05Z", "type": "commit"}, {"oid": "59ee84bfa7330ef114b7cbc22d2c911283ca31b1", "url": "https://github.com/kiegroup/optaplanner/commit/59ee84bfa7330ef114b7cbc22d2c911283ca31b1", "message": "Adjust some formatting", "committedDate": "2020-10-12T15:40:03Z", "type": "commit"}, {"oid": "0dc4a255197cc79345eb044ec0ed44373e3bc2b8", "url": "https://github.com/kiegroup/optaplanner/commit/0dc4a255197cc79345eb044ec0ed44373e3bc2b8", "message": "Remove redundant casts", "committedDate": "2020-10-12T15:40:23Z", "type": "commit"}, {"oid": "16bd919b686e7b5237db15b93b1a92064de95029", "url": "https://github.com/kiegroup/optaplanner/commit/16bd919b686e7b5237db15b93b1a92064de95029", "message": "Formatting", "committedDate": "2020-10-12T15:44:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM4OTU5NQ==", "url": "https://github.com/kiegroup/optaplanner/pull/965#discussion_r503389595", "bodyText": "Nitpick: I don't mind the explicit cast from int to double here. Autocasting for primitives has been shown to be dangerous. For example double a = 9007199254740993L becomes 9007199254740992.0 (1 off error)", "author": "ge0ffrey", "createdAt": "2020-10-12T15:57:20Z", "path": "optaplanner-benchmark/src/main/java/org/optaplanner/benchmark/impl/result/SolverBenchmarkResult.java", "diffHunk": "@@ -337,7 +337,7 @@ protected void determineTotalsAndAverages() {\n         if (!firstNonFailure) {\n             int successCount = getSuccessCount();\n             averageScore = totalScore.divide(successCount);\n-            averageWorstScoreDifferencePercentage = totalWorstScoreDifferencePercentage.divide((double) successCount);\n+            averageWorstScoreDifferencePercentage = totalWorstScoreDifferencePercentage.divide(successCount);", "originalCommit": "16bd919b686e7b5237db15b93b1a92064de95029", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f340b7231516adbed66de682c4ffc345b09ce545", "chunk": "diff --git a/optaplanner-benchmark/src/main/java/org/optaplanner/benchmark/impl/result/SolverBenchmarkResult.java b/optaplanner-benchmark/src/main/java/org/optaplanner/benchmark/impl/result/SolverBenchmarkResult.java\nindex 899464129..086376082 100644\n--- a/optaplanner-benchmark/src/main/java/org/optaplanner/benchmark/impl/result/SolverBenchmarkResult.java\n+++ b/optaplanner-benchmark/src/main/java/org/optaplanner/benchmark/impl/result/SolverBenchmarkResult.java\n\n@@ -337,7 +337,7 @@ public class SolverBenchmarkResult {\n         if (!firstNonFailure) {\n             int successCount = getSuccessCount();\n             averageScore = totalScore.divide(successCount);\n-            averageWorstScoreDifferencePercentage = totalWorstScoreDifferencePercentage.divide(successCount);\n+            averageWorstScoreDifferencePercentage = totalWorstScoreDifferencePercentage.divide((double) successCount);\n             averageScoreCalculationSpeed = totalScoreCalculationSpeed / (long) successCount;\n             averageTimeMillisSpent = totalTimeMillisSpent / (long) successCount;\n             averageWorstScoreCalculationSpeedDifferencePercentage = totalWorstScoreCalculationSpeedDifferencePercentage\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MTk3NA==", "url": "https://github.com/kiegroup/optaplanner/pull/965#discussion_r503391974", "bodyText": "Will affect upgrade recipe and docs", "author": "ge0ffrey", "createdAt": "2020-10-12T16:01:19Z", "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/heuristic/selector/move/factory/MoveIteratorFactory.java", "diffHunk": "@@ -32,7 +32,7 @@\n  *\n  * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n  */\n-public interface MoveIteratorFactory<Solution_> {\n+public interface MoveIteratorFactory<Solution_, Move_ extends Move<Solution_>> {", "originalCommit": "16bd919b686e7b5237db15b93b1a92064de95029", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MzU1Mw==", "url": "https://github.com/kiegroup/optaplanner/pull/965#discussion_r503393553", "bodyText": "-1 veto. This is a bug. Given scorediffLevel 4 and totalDiffLevel 5, the levelTimeGradient changes from 0.8 to 0.0.", "author": "ge0ffrey", "createdAt": "2020-10-12T16:04:10Z", "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/ScoreUtils.java", "diffHunk": "@@ -118,7 +118,7 @@ public static double calculateTimeGradient(Number[] totalDiffNumbers, Number[] s\n                 // timeGradient += 0.0\n                 break;\n             } else {\n-                double levelTimeGradient = (double) scoreDiffLevel / (double) totalDiffLevel;\n+                double levelTimeGradient = scoreDiffLevel / totalDiffLevel;", "originalCommit": "16bd919b686e7b5237db15b93b1a92064de95029", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5Mzg4OA==", "url": "https://github.com/kiegroup/optaplanner/pull/965#discussion_r503393888", "bodyText": "nevermind, it isn't. those aren't ints, but doubles already. Ignore the comment above.", "author": "ge0ffrey", "createdAt": "2020-10-12T16:04:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MzU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NTE4NA==", "url": "https://github.com/kiegroup/optaplanner/pull/965#discussion_r503395184", "bodyText": "Not true. Both of those values are already doubles, the casts do nothing.", "author": "triceo", "createdAt": "2020-10-12T16:07:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MzU1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "f340b7231516adbed66de682c4ffc345b09ce545", "chunk": "diff --git a/optaplanner-core/src/main/java/org/optaplanner/core/impl/score/ScoreUtils.java b/optaplanner-core/src/main/java/org/optaplanner/core/impl/score/ScoreUtils.java\nindex fcd998880..764f433b9 100644\n--- a/optaplanner-core/src/main/java/org/optaplanner/core/impl/score/ScoreUtils.java\n+++ b/optaplanner-core/src/main/java/org/optaplanner/core/impl/score/ScoreUtils.java\n\n@@ -118,7 +118,7 @@ public class ScoreUtils {\n                 // timeGradient += 0.0\n                 break;\n             } else {\n-                double levelTimeGradient = scoreDiffLevel / totalDiffLevel;\n+                double levelTimeGradient = (double) scoreDiffLevel / (double) totalDiffLevel;\n                 timeGradient += levelTimeGradient * levelTimeGradientWeight;\n             }\n \n"}}, {"oid": "f340b7231516adbed66de682c4ffc345b09ce545", "url": "https://github.com/kiegroup/optaplanner/commit/f340b7231516adbed66de682c4ffc345b09ce545", "message": "Revert \"Remove redundant casts\"\n\nThis reverts commit 0dc4a255", "committedDate": "2020-10-12T16:12:39Z", "type": "commit"}, {"oid": "918836fa0acfc41448fe6a05e6d887b41e0cad20", "url": "https://github.com/kiegroup/optaplanner/commit/918836fa0acfc41448fe6a05e6d887b41e0cad20", "message": "Adress some Sonar warnings", "committedDate": "2020-10-12T17:03:35Z", "type": "commit"}]}