{"pr_number": 1881, "pr_title": "GH-1808 Iteration stream support", "pr_createdAt": "2020-01-28T09:26:34Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/1881", "timeline": [{"oid": "14b5716dd4255dc206cc45f36b305be54b694ee3", "url": "https://github.com/eclipse/rdf4j/commit/14b5716dd4255dc206cc45f36b305be54b694ee3", "message": "#1808 add methods for .stream()\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-01-28T08:46:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4NTkxOA==", "url": "https://github.com/eclipse/rdf4j/pull/1881#discussion_r372185918", "bodyText": "Calling close() yourself is only necessary if the stream is not fully consumed: the Spliterator implementation we use automatically closes the iteration under the hood when exhausted (or when an exception occurs). Perhaps we can reword to something like:\n\nThe stream should be closed (by calling Stream#close()) if it is not fully consumed.\n\nArguably, that is something that should be done with every Stream object anyway, so this could just be added to the javadoc of Iteration.stream, removing the need for the override here.", "author": "jeenbroekstra", "createdAt": "2020-01-29T04:40:47Z", "path": "core/util/src/main/java/org/eclipse/rdf4j/common/iteration/CloseableIteration.java", "diffHunk": "@@ -33,4 +35,15 @@\n \t@Override\n \tpublic void close() throws X;\n \n+\t/**\n+\t *\n+\t * Convert the results to a Java 8 Stream. Stream should be closed by calling .close().", "originalCommit": "bab4d4eb369fe74364491ad6bb62b64871b80a70", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "faa3b37bc64e31135a0e11fcbca38dccd646f8df", "chunk": "diff --git a/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/CloseableIteration.java b/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/CloseableIteration.java\nindex 7f9112d91..a1121fb6f 100644\n--- a/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/CloseableIteration.java\n+++ b/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/CloseableIteration.java\n\n@@ -35,15 +33,4 @@ public interface CloseableIteration<E, X extends Exception> extends Iteration<E,\n \t@Override\n \tpublic void close() throws X;\n \n-\t/**\n-\t *\n-\t * Convert the results to a Java 8 Stream. Stream should be closed by calling .close().\n-\t *\n-\t * @return stream\n-\t */\n-\t@Override\n-\tdefault Stream<E> stream() {\n-\t\treturn Iterations.stream(this);\n-\t}\n-\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3MzIyNg==", "url": "https://github.com/eclipse/rdf4j/pull/1881#discussion_r373773226", "bodyText": "@jeenbroekstra\nThe javadocs say that most streams don't need to be closed:\n\nStreams have a BaseStream.close() method and implement AutoCloseable, but nearly all stream instances do not actually need to be closed after use. Generally, only streams whose source is an IO channel (such as those returned by Files.lines(Path, Charset)) will require closing. Most streams are backed by collections, arrays, or generating functions, which require no special resource management. (If a stream does require closing, it can be declared as a resource in a try-with-resources statement.)\n\nI have removed the duplicate method and modified the docs (see above) to make it up to the user to decide what they want to do.", "author": "hmottestad", "createdAt": "2020-02-01T10:45:13Z", "path": "core/util/src/main/java/org/eclipse/rdf4j/common/iteration/Iteration.java", "diffHunk": "@@ -44,11 +45,22 @@\n \t/**\n \t * Removes from the underlying collection the last element returned by the iteration (optional operation). This\n \t * method can be called only once per call to next.\n-\t * \n+\t *\n \t * @throws UnsupportedOperationException if the remove operation is not supported by this Iteration.\n \t * @throws IllegalStateException         If the Iteration has been closed, or if <tt>next()</tt> has not yet been\n \t *                                       called, or <tt>remove()</tt> has already been called after the last call to\n \t *                                       <tt>next()</tt>.\n \t */\n \tpublic void remove() throws X;\n+\n+\t/**\n+\t *\n+\t * Convert the results to a Java 8 Stream. If this iteration implements CloseableIteration it should be closed (by\n+\t * calling Stream#close() or using try-with-resource) if it is not fully consumed.\n+\t *\n+\t * @return stream\n+\t */\n+\tdefault Stream<E> stream() {\n+\t\treturn Iterations.stream(this);\n+\t}", "originalCommit": "d30bd0a6cb1127d1122ed1b8f0347b17f49abe55", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "faa3b37bc64e31135a0e11fcbca38dccd646f8df", "chunk": "diff --git a/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/Iteration.java b/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/Iteration.java\nindex b05b5ca9b..07d5cc0be 100644\n--- a/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/Iteration.java\n+++ b/core/util/src/main/java/org/eclipse/rdf4j/common/iteration/Iteration.java\n\n@@ -45,22 +44,11 @@ public interface Iteration<E, X extends Exception> {\n \t/**\n \t * Removes from the underlying collection the last element returned by the iteration (optional operation). This\n \t * method can be called only once per call to next.\n-\t *\n+\t * \n \t * @throws UnsupportedOperationException if the remove operation is not supported by this Iteration.\n \t * @throws IllegalStateException         If the Iteration has been closed, or if <tt>next()</tt> has not yet been\n \t *                                       called, or <tt>remove()</tt> has already been called after the last call to\n \t *                                       <tt>next()</tt>.\n \t */\n \tpublic void remove() throws X;\n-\n-\t/**\n-\t *\n-\t * Convert the results to a Java 8 Stream. If this iteration implements CloseableIteration it should be closed (by\n-\t * calling Stream#close() or using try-with-resource) if it is not fully consumed.\n-\t *\n-\t * @return stream\n-\t */\n-\tdefault Stream<E> stream() {\n-\t\treturn Iterations.stream(this);\n-\t}\n }\n"}}, {"oid": "faa3b37bc64e31135a0e11fcbca38dccd646f8df", "url": "https://github.com/eclipse/rdf4j/commit/faa3b37bc64e31135a0e11fcbca38dccd646f8df", "message": "#1808 benchmark\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-02-01T10:59:19Z", "type": "commit"}, {"oid": "c30fc0066512af57bf95283aaa6175d8b8d31bad", "url": "https://github.com/eclipse/rdf4j/commit/c30fc0066512af57bf95283aaa6175d8b8d31bad", "message": "#1808 moved the .stream to a higher level in the RDF4J stack making it more universably available\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-02-01T10:59:19Z", "type": "commit"}, {"oid": "d58f121343aed937d8c999fc018dab5436dd1520", "url": "https://github.com/eclipse/rdf4j/commit/d58f121343aed937d8c999fc018dab5436dd1520", "message": "#1808 use .stream where Iterations.stream was used before\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-02-01T10:59:19Z", "type": "commit"}, {"oid": "b98a33a44e9cacb340c19b7284f6e71d21f835da", "url": "https://github.com/eclipse/rdf4j/commit/b98a33a44e9cacb340c19b7284f6e71d21f835da", "message": "#1808 simplified QueryResults slightly\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-02-01T10:59:19Z", "type": "commit"}, {"oid": "afffe9c0bfd5ce4c20f20a1a2600356014ce9d31", "url": "https://github.com/eclipse/rdf4j/commit/afffe9c0bfd5ce4c20f20a1a2600356014ce9d31", "message": "#1808 simplify interfaces and align the automatic closing of failing streams with how finally works\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-02-01T10:59:19Z", "type": "commit"}, {"oid": "afffe9c0bfd5ce4c20f20a1a2600356014ce9d31", "url": "https://github.com/eclipse/rdf4j/commit/afffe9c0bfd5ce4c20f20a1a2600356014ce9d31", "message": "#1808 simplify interfaces and align the automatic closing of failing streams with how finally works\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-02-01T10:59:19Z", "type": "forcePushed"}]}