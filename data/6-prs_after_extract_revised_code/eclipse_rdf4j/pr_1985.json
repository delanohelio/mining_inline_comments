{"pr_number": 1985, "pr_title": "GH-1960 treat commit as no-op if no updates in the txn", "pr_createdAt": "2020-03-09T00:49:46Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/1985", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzMDAxMg==", "url": "https://github.com/eclipse/rdf4j/pull/1985#discussion_r389530012", "bodyText": "Would be nice if you could add a comment here.\n// empty transactions commit as no-op, some SPARQL endpoints don't handle empty transactions", "author": "hmottestad", "createdAt": "2020-03-09T09:00:05Z", "path": "core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java", "diffHunk": "@@ -391,11 +392,13 @@ public void commit() throws RepositoryException {\n \t\tsynchronized (transactionLock) {\n \t\t\tif (isActive()) {\n \t\t\t\tsynchronized (transactionLock) {\n-\t\t\t\t\tSPARQLUpdate transaction = new SPARQLUpdate(client, null, sparqlTransaction.toString());\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\ttransaction.execute();\n-\t\t\t\t\t} catch (UpdateExecutionException e) {\n-\t\t\t\t\t\tthrow new RepositoryException(\"error executing transaction\", e);\n+\t\t\t\t\tif (sparqlTransaction.length() > 0) {", "originalCommit": "5955bfb3ab8c87cdf7e32d4c4f42c5a49cb18c77", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "802b4cb09c4dd60c20e3246e535f1fabe75624fd", "chunk": "diff --git a/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java b/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java\nindex 0c7e356c0d..3a44742dc1 100644\n--- a/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java\n+++ b/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java\n\n@@ -392,6 +392,7 @@ public class SPARQLConnection extends AbstractRepositoryConnection implements Ht\n \t\tsynchronized (transactionLock) {\n \t\t\tif (isActive()) {\n \t\t\t\tsynchronized (transactionLock) {\n+\t\t\t\t\t// treat commit as a no-op if transaction string is empty\n \t\t\t\t\tif (sparqlTransaction.length() > 0) {\n \t\t\t\t\t\tSPARQLUpdate transaction = new SPARQLUpdate(client, null, sparqlTransaction.toString());\n \t\t\t\t\t\ttry {\n"}}, {"oid": "802b4cb09c4dd60c20e3246e535f1fabe75624fd", "url": "https://github.com/eclipse/rdf4j/commit/802b4cb09c4dd60c20e3246e535f1fabe75624fd", "message": "GH-1960 treat commit as no-op if no updates in the txn\n\n- check if txn string has content before sending update\n- added regression test\n- minor refactor: use StringBuilder instead of StringBuffer", "committedDate": "2020-03-09T22:46:47Z", "type": "commit"}, {"oid": "802b4cb09c4dd60c20e3246e535f1fabe75624fd", "url": "https://github.com/eclipse/rdf4j/commit/802b4cb09c4dd60c20e3246e535f1fabe75624fd", "message": "GH-1960 treat commit as no-op if no updates in the txn\n\n- check if txn string has content before sending update\n- added regression test\n- minor refactor: use StringBuilder instead of StringBuffer", "committedDate": "2020-03-09T22:46:47Z", "type": "forcePushed"}]}