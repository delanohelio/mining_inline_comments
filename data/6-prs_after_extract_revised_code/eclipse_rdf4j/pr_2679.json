{"pr_number": 2679, "pr_title": "GH-2675 add new RepositoryConnection.prepare method", "pr_createdAt": "2020-11-27T04:39:58Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2679", "timeline": [{"oid": "b4e9ca28dae50d00ce52de4bee3f5df09d7a1dfc", "url": "https://github.com/eclipse/rdf4j/commit/b4e9ca28dae50d00ce52de4bee3f5df09d7a1dfc", "message": "GH-2675 add new RepositoryConnection.prepare method", "committedDate": "2020-11-28T05:37:44Z", "type": "commit"}, {"oid": "b4e9ca28dae50d00ce52de4bee3f5df09d7a1dfc", "url": "https://github.com/eclipse/rdf4j/commit/b4e9ca28dae50d00ce52de4bee3f5df09d7a1dfc", "message": "GH-2675 add new RepositoryConnection.prepare method", "committedDate": "2020-11-28T05:37:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAwOTQzMg==", "url": "https://github.com/eclipse/rdf4j/pull/2679#discussion_r532009432", "bodyText": "Could you log an error message here?", "author": "hmottestad", "createdAt": "2020-11-28T09:18:08Z", "path": "core/repository/http/src/main/java/org/eclipse/rdf4j/repository/http/HTTPRepositoryConnection.java", "diffHunk": "@@ -294,6 +294,23 @@ public long size(Resource... contexts) throws RepositoryException {\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic void prepare() throws RepositoryException {\n+\t\tif (this.getRepository().getServerProtocolVersion() < 12) {\n+\t\t\t// Action.PREPARE is not supported in Servers using protocols older than version 12.", "originalCommit": "b4e9ca28dae50d00ce52de4bee3f5df09d7a1dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "181fb2b3a5b40c2fddcfbddf8016ee35b23a4e82", "chunk": "diff --git a/core/repository/http/src/main/java/org/eclipse/rdf4j/repository/http/HTTPRepositoryConnection.java b/core/repository/http/src/main/java/org/eclipse/rdf4j/repository/http/HTTPRepositoryConnection.java\nindex 8a69397ae8..2cc9d69c05 100644\n--- a/core/repository/http/src/main/java/org/eclipse/rdf4j/repository/http/HTTPRepositoryConnection.java\n+++ b/core/repository/http/src/main/java/org/eclipse/rdf4j/repository/http/HTTPRepositoryConnection.java\n\n@@ -298,6 +298,7 @@ class HTTPRepositoryConnection extends AbstractRepositoryConnection implements H\n \tpublic void prepare() throws RepositoryException {\n \t\tif (this.getRepository().getServerProtocolVersion() < 12) {\n \t\t\t// Action.PREPARE is not supported in Servers using protocols older than version 12.\n+\t\t\tlogger.warn(\"Prepare operation not supported by server (requires protocol version 12)\");\n \t\t\treturn;\n \t\t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAwOTUyNw==", "url": "https://github.com/eclipse/rdf4j/pull/2679#discussion_r532009527", "bodyText": "I would prefer an unsupported operation exception, so users don\u2019t spend time trying to figure out why prepare isn\u2019t doing anything.", "author": "hmottestad", "createdAt": "2020-11-28T09:19:29Z", "path": "core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java", "diffHunk": "@@ -405,6 +404,11 @@ public TupleQuery prepareTupleQuery(QueryLanguage ql, String query, String base)\n \t\tthrow new UnsupportedQueryLanguageException(\"Unsupported query language \" + ql);\n \t}\n \n+\t@Override\n+\tpublic void prepare() throws RepositoryException {\n+\t\t// no-op, not supported in SPARQL protocol", "originalCommit": "b4e9ca28dae50d00ce52de4bee3f5df09d7a1dfc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNTYxNQ==", "url": "https://github.com/eclipse/rdf4j/pull/2679#discussion_r532025615", "bodyText": "Yeah good point, I'll do the same for the default method.", "author": "jeenbroekstra", "createdAt": "2020-11-28T10:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAwOTUyNw=="}], "type": "inlineReview", "revised_code": {"commit": "181fb2b3a5b40c2fddcfbddf8016ee35b23a4e82", "chunk": "diff --git a/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java b/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java\nindex 53d3a843f6..7469590f96 100644\n--- a/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java\n+++ b/core/repository/sparql/src/main/java/org/eclipse/rdf4j/repository/sparql/SPARQLConnection.java\n\n@@ -406,7 +406,7 @@ public class SPARQLConnection extends AbstractRepositoryConnection implements Ht\n \n \t@Override\n \tpublic void prepare() throws RepositoryException {\n-\t\t// no-op, not supported in SPARQL protocol\n+\t\tthrow new UnsupportedOperationException(\"SPARQL protocol has no support for 2-phase commit\");\n \t}\n \n \t@Override\n"}}, {"oid": "181fb2b3a5b40c2fddcfbddf8016ee35b23a4e82", "url": "https://github.com/eclipse/rdf4j/commit/181fb2b3a5b40c2fddcfbddf8016ee35b23a4e82", "message": "GH-2675 throw UnsupportedOperationException and/or log warning", "committedDate": "2020-11-29T02:20:07Z", "type": "commit"}]}