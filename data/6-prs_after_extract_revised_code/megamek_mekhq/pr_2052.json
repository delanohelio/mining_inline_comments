{"pr_number": 2052, "pr_title": "Bloodname GM Tools", "pr_createdAt": "2020-09-25T14:23:53Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2052", "timeline": [{"oid": "da549bd5753997853644a303ac00f5abdeeb74cd", "url": "https://github.com/MegaMek/mekhq/commit/da549bd5753997853644a303ac00f5abdeeb74cd", "message": "Adding Bloodname GM Dialog", "committedDate": "2020-09-24T18:02:21Z", "type": "commit"}, {"oid": "189e8628be2acef8f15d49f632cd9a39cd9abb30", "url": "https://github.com/MegaMek/mekhq/commit/189e8628be2acef8f15d49f632cd9a39cd9abb30", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_BloodnameGMDialog", "committedDate": "2020-09-24T21:03:50Z", "type": "commit"}, {"oid": "4217bca36dbb667e1471b0cae0dd772660e1f3b4", "url": "https://github.com/MegaMek/mekhq/commit/4217bca36dbb667e1471b0cae0dd772660e1f3b4", "message": "Bloodname bugfixes", "committedDate": "2020-09-25T14:17:20Z", "type": "commit"}, {"oid": "b26c5d6feaddbaa517ceb61acf93d1f1d1a45cd4", "url": "https://github.com/MegaMek/mekhq/commit/b26c5d6feaddbaa517ceb61acf93d1f1d1a45cd4", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_BloodnameGMDialog", "committedDate": "2020-09-25T14:22:24Z", "type": "commit"}, {"oid": "813cb72d238d74aed1666eb88592681519e34445", "url": "https://github.com/MegaMek/mekhq/commit/813cb72d238d74aed1666eb88592681519e34445", "message": "Fixing merge conflicts", "committedDate": "2020-09-29T13:51:44Z", "type": "commit"}, {"oid": "f88328bf7788c9c8946c52e8ad302079290a74be", "url": "https://github.com/MegaMek/mekhq/commit/f88328bf7788c9c8946c52e8ad302079290a74be", "message": "Merge branch 'master' into dev_Windchild_BloodnameGMDialog", "committedDate": "2020-09-29T15:12:11Z", "type": "commit"}, {"oid": "8c11bb2632671b81df9f31b5fc5ed046318bbf3e", "url": "https://github.com/MegaMek/mekhq/commit/8c11bb2632671b81df9f31b5fc5ed046318bbf3e", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_BloodnameGMDialog", "committedDate": "2020-10-03T17:39:53Z", "type": "commit"}, {"oid": "92fde75e75a6d7c2f377510c11c0f3d474e01ece", "url": "https://github.com/MegaMek/mekhq/commit/92fde75e75a6d7c2f377510c11c0f3d474e01ece", "message": "Modernizing logger", "committedDate": "2020-10-03T17:41:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2OTMzNQ==", "url": "https://github.com/MegaMek/mekhq/pull/2052#discussion_r499169335", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                int originClan;\n          \n          \n            \n                Phenotype selectedPhenotype;\n          \n          \n            \n                int bloodnameYear;\n          \n          \n            \n                private int originClan;\n          \n          \n            \n                private Phenotype selectedPhenotype;\n          \n          \n            \n                private int bloodnameYear;", "author": "sixlettervariables", "createdAt": "2020-10-03T18:08:59Z", "path": "MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java", "diffHunk": "@@ -84,28 +90,58 @@\n     private JLabel currentCallsign;\n     private JLabel callsignGenerated;\n \n-    private CampaignGUI gui;\n-    private Person person;\n-\n+    private JComboBox<String> originClanPicker;\n+    private JComboBox<Integer> bloodnameEraPicker;\n+    private JComboBox<Phenotype> phenotypePicker;\n+    private JLabel currentBloodname;\n+    private JLabel bloodnameGenerated;\n+    private JLabel originClanGenerated;\n+    private JLabel phenotypeGenerated;\n+    private JLabel bloodnameWarningLabel;\n+    //endregion GUI Variables\n+\n+    //region Previously Generated Information\n     /**\n      * The last unit rolled, used when clicking 'Add Random Unit' after Roll for RAT is clicked\n      */\n     private MechSummary lastRolledUnit;\n \n     /**\n-     * The last name rolled, used when clocking 'Set Generated Name' after Generate Name is clicked\n+     * The last name rolled, used when clicking 'Set Generated Name' after Generate Name is clicked\n      */\n     private String[] lastGeneratedName;\n \n     /**\n-     * The last callsign rolled, used when clocking 'Set Generated Callsign' after Generate Callsign is clicked\n+     * The last callsign rolled, used when clicking 'Set Generated Callsign' after Generate Callsign is clicked\n      */\n     private String lastGeneratedCallsign;\n \n+    /**\n+     * The last bloodname rolled, used when clicking 'Set Generated Bloodname' after Generate Bloodname is clicked\n+     */\n+    private String lastGeneratedBloodname;\n+    //endregion Previously Generated Information\n+\n+    //region Data Sources\n+    private CampaignGUI gui;\n+    private Person person;\n+    private List<Clan> clans = new ArrayList<>();\n+    //endregion Data Sources\n+\n+    //region Bloodname Information\n+    int originClan;\n+    Phenotype selectedPhenotype;\n+    int bloodnameYear;", "originalCommit": "92fde75e75a6d7c2f377510c11c0f3d474e01ece", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "35dfef550dafb8239dc9eaa0c40b2415690df4d6", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java b/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\nindex e15360860..c0ee3d6c3 100644\n--- a/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n+++ b/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n\n@@ -129,9 +129,9 @@ public class GMToolsDialog extends JDialog {\n     //endregion Data Sources\n \n     //region Bloodname Information\n-    int originClan;\n-    Phenotype selectedPhenotype;\n-    int bloodnameYear;\n+    private int originClan;\n+    private Phenotype selectedPhenotype;\n+    private int bloodnameYear;\n     //endregion Bloodname Information\n \n     //region Constants\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2OTU2Mg==", "url": "https://github.com/MegaMek/mekhq/pull/2052#discussion_r499169562", "bodyText": "I get errors when building with DefaultLookup.* under JDK11. Perhaps this should move to UIManager?", "author": "sixlettervariables", "createdAt": "2020-10-03T18:11:37Z", "path": "MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java", "diffHunk": "@@ -413,6 +451,151 @@ private JPanel getCallsignGenerator() {\n     }\n     //endregion Callsign Generator Panel Initialization\n \n+    //region Bloodname Generator Panel Initialization\n+    private JPanel getBloodnameGenerator() {\n+        JPanel namePanel = new JPanel(new GridBagLayout());\n+        namePanel.setName(\"bloodnamePanel\");\n+        namePanel.setBorder(BorderFactory.createTitledBorder(resources.getString(\"bloodnamePanel.text\")));\n+\n+        int gridx = 0, gridy = 0, gridxMax;\n+\n+        JLabel originClanLabel = new JLabel(resources.getString(\"originClanLabel.text\"));\n+        originClanLabel.setName(\"originClanLabel\");\n+        namePanel.add(originClanLabel, newGridBagConstraints(gridx, gridy));\n+\n+        clans.addAll(Clan.getClans());\n+        clans.sort(Comparator.comparing(o -> o.getFullName(bloodnameYear)));\n+        DefaultComboBoxModel<String> originClanModel = new DefaultComboBoxModel<>();\n+        for (Clan clan : clans) {\n+            originClanModel.addElement(clan.getFullName(bloodnameYear));\n+        }\n+        originClanPicker = new JComboBox<>(originClanModel);\n+        originClanPicker.setName(\"originClanPicker\");\n+        originClanPicker.setSelectedIndex(0);\n+        originClanPicker.addActionListener(evt -> validateBloodnameInput());\n+        namePanel.add(originClanPicker, newGridBagConstraints(gridx++, gridy + 1));\n+\n+        JLabel bloodnameEraLabel = new JLabel(resources.getString(\"bloodnameEraLabel.text\"));\n+        bloodnameEraLabel.setName(\"bloodnameEraLabel\");\n+        namePanel.add(bloodnameEraLabel, newGridBagConstraints(gridx, gridy));\n+\n+        bloodnameEraPicker = new JComboBox<>(ERAS);\n+        bloodnameEraPicker.setName(\"bloodnameEraPicker\");\n+        bloodnameEraPicker.setSelectedIndex(0);\n+        bloodnameEraPicker.addActionListener(evt -> validateBloodnameInput());\n+        namePanel.add(bloodnameEraPicker, newGridBagConstraints(gridx++, gridy + 1));\n+\n+        JLabel phenotypeLabel = new JLabel(resources.getString(\"phenotypeLabel.text\"));\n+        phenotypeLabel.setName(\"phenotypeLabel\");\n+        namePanel.add(phenotypeLabel, newGridBagConstraints(gridx, gridy));\n+\n+        DefaultComboBoxModel<Phenotype> phenotypeModel = new DefaultComboBoxModel<>();\n+        phenotypeModel.addElement(Phenotype.GENERAL);\n+        for (Phenotype phenotype : Phenotype.getExternalPhenotypes()) {\n+            phenotypeModel.addElement(phenotype);\n+        }\n+        phenotypePicker = new JComboBox<>(phenotypeModel);\n+        phenotypePicker.setName(\"phenotypePicker\");\n+        phenotypePicker.setSelectedItem(Phenotype.GENERAL);\n+        phenotypePicker.setRenderer(new DefaultListCellRenderer() {\n+            @Override\n+            public Component getListCellRendererComponent(JList<?> list, Object value, int index,\n+                                                          boolean isSelected, boolean cellHasFocus) {\n+                setOpaque(list.isOpaque());\n+                if (isSelected) {\n+                    setBackground(list.getSelectionBackground());\n+                    setForeground(list.getSelectionForeground());\n+                } else {\n+                    setBackground(list.getBackground());\n+                    setForeground(list.getForeground());\n+                }\n+                setFont(list.getFont());\n+\n+                setText((value == null) ? \"\"\n+                        : (value instanceof Phenotype ? ((Phenotype) value).getGroupingName() : \"ERROR\"));\n+\n+                setEnabled(list.isEnabled());\n+\n+                if (cellHasFocus) {\n+                    Border border = null;\n+                    if (isSelected) {\n+                        border = DefaultLookup.getBorder(this, ui, \"List.focusSelectedCellHighlightBorder\");\n+                    }\n+                    if (border == null) {\n+                        border = DefaultLookup.getBorder(this, ui, \"List.focusCellHighlightBorder\");", "originalCommit": "92fde75e75a6d7c2f377510c11c0f3d474e01ece", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3MTM3Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2052#discussion_r499171377", "bodyText": "Fixed by reworking how the override works", "author": "Windchild292", "createdAt": "2020-10-03T18:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2OTU2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "43ede68f1ca8697623b72862b2073a8c0dbe3e00", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java b/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\nindex e15360860..746ddb968 100644\n--- a/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n+++ b/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n\n@@ -501,32 +499,10 @@ public class GMToolsDialog extends JDialog {\n             @Override\n             public Component getListCellRendererComponent(JList<?> list, Object value, int index,\n                                                           boolean isSelected, boolean cellHasFocus) {\n-                setOpaque(list.isOpaque());\n-                if (isSelected) {\n-                    setBackground(list.getSelectionBackground());\n-                    setForeground(list.getSelectionForeground());\n-                } else {\n-                    setBackground(list.getBackground());\n-                    setForeground(list.getForeground());\n-                }\n-                setFont(list.getFont());\n-\n+                super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);\n                 setText((value == null) ? \"\"\n                         : (value instanceof Phenotype ? ((Phenotype) value).getGroupingName() : \"ERROR\"));\n \n-                setEnabled(list.isEnabled());\n-\n-                if (cellHasFocus) {\n-                    Border border = null;\n-                    if (isSelected) {\n-                        border = DefaultLookup.getBorder(this, ui, \"List.focusSelectedCellHighlightBorder\");\n-                    }\n-                    if (border == null) {\n-                        border = DefaultLookup.getBorder(this, ui, \"List.focusCellHighlightBorder\");\n-                    }\n-                    setBorder(border);\n-                }\n-\n                 return this;\n             }\n         });\n"}}, {"oid": "35dfef550dafb8239dc9eaa0c40b2415690df4d6", "url": "https://github.com/MegaMek/mekhq/commit/35dfef550dafb8239dc9eaa0c40b2415690df4d6", "message": "Update MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n\nCo-authored-by: Christopher Watford <christopher.watford@gmail.com>", "committedDate": "2020-10-03T18:23:29Z", "type": "commit"}, {"oid": "43ede68f1ca8697623b72862b2073a8c0dbe3e00", "url": "https://github.com/MegaMek/mekhq/commit/43ede68f1ca8697623b72862b2073a8c0dbe3e00", "message": "Removing DefaultLookup and simplifying code", "committedDate": "2020-10-03T18:33:19Z", "type": "commit"}]}