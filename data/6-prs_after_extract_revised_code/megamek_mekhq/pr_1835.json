{"pr_number": 1835, "pr_title": "DateTime to LocalDate Switchover", "pr_createdAt": "2020-07-03T15:33:56Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1835", "timeline": [{"oid": "eb9fb3859a75d21512fe203f595807052a953010", "url": "https://github.com/MegaMek/mekhq/commit/eb9fb3859a75d21512fe203f595807052a953010", "message": "Switching Injuries to LocalDate", "committedDate": "2020-06-20T15:27:44Z", "type": "commit"}, {"oid": "d9986c8575667a8b2777855382ac1ceab15feeea", "url": "https://github.com/MegaMek/mekhq/commit/d9986c8575667a8b2777855382ac1ceab15feeea", "message": "Starting to move Planetary Systems to LocalDate", "committedDate": "2020-06-20T17:03:19Z", "type": "commit"}, {"oid": "8ece1d1e504e13a24589f2bc4eb7b75c284a805c", "url": "https://github.com/MegaMek/mekhq/commit/8ece1d1e504e13a24589f2bc4eb7b75c284a805c", "message": "Moving more files to LocalDate and removing DateTime", "committedDate": "2020-06-20T17:40:42Z", "type": "commit"}, {"oid": "b1fa2174f6b9518beb164534f29b6d61a7254c8e", "url": "https://github.com/MegaMek/mekhq/commit/b1fa2174f6b9518beb164534f29b6d61a7254c8e", "message": "Removing DateTime from Campaign", "committedDate": "2020-06-20T17:41:06Z", "type": "commit"}, {"oid": "c268496826c1ed4b5d3bb5e35285a5d5a81ab6a4", "url": "https://github.com/MegaMek/mekhq/commit/c268496826c1ed4b5d3bb5e35285a5d5a81ab6a4", "message": "Starting to wrap up removing DateTime", "committedDate": "2020-06-20T18:49:04Z", "type": "commit"}, {"oid": "9c9afac9f6f8fb43be75f4959c709dd2906f6b6a", "url": "https://github.com/MegaMek/mekhq/commit/9c9afac9f6f8fb43be75f4959c709dd2906f6b6a", "message": "Finishing switch to LocalDate instead of Joda DateTime", "committedDate": "2020-06-21T13:26:21Z", "type": "commit"}, {"oid": "039ab3c338404a8015837e242249c86c175b19d6", "url": "https://github.com/MegaMek/mekhq/commit/039ab3c338404a8015837e242249c86c175b19d6", "message": "Fixing name spelling issue", "committedDate": "2020-06-21T13:52:16Z", "type": "commit"}, {"oid": "5f68c2b610efed096c2b564a43bb0e99916da4ab", "url": "https://github.com/MegaMek/mekhq/commit/5f68c2b610efed096c2b564a43bb0e99916da4ab", "message": "Fixing planetary events following LocalDate transition", "committedDate": "2020-06-21T14:16:12Z", "type": "commit"}, {"oid": "29badf2047a87bb7c6dc6be2281bb275145e24a3", "url": "https://github.com/MegaMek/mekhq/commit/29badf2047a87bb7c6dc6be2281bb275145e24a3", "message": "Fixing unit tests", "committedDate": "2020-06-21T14:16:36Z", "type": "commit"}, {"oid": "d32083c7e6dc1f51f5c96df1923ef870f4438957", "url": "https://github.com/MegaMek/mekhq/commit/d32083c7e6dc1f51f5c96df1923ef870f4438957", "message": "Adding active tracing for LocalDate", "committedDate": "2020-06-21T15:11:39Z", "type": "commit"}, {"oid": "0e1bfe8a46bf8722cf02fb153176ca831e3fad9c", "url": "https://github.com/MegaMek/mekhq/commit/0e1bfe8a46bf8722cf02fb153176ca831e3fad9c", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_DateTime", "committedDate": "2020-06-21T15:19:47Z", "type": "commit"}, {"oid": "67b83fb6393a53e1c000a3770f0b546700cf8ba8", "url": "https://github.com/MegaMek/mekhq/commit/67b83fb6393a53e1c000a3770f0b546700cf8ba8", "message": "Applying changes from personal review", "committedDate": "2020-06-21T16:01:24Z", "type": "commit"}, {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57", "url": "https://github.com/MegaMek/mekhq/commit/618da4a9b5b8c69fe8967107936b0d18bd561e57", "message": "Fixing LocalDate calculation issue", "committedDate": "2020-07-03T15:24:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MDg4NA==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449690884", "bodyText": "This seems more awkward than the previous syntax, is there any way to make it less, uh...", "author": "NickAragua", "createdAt": "2020-07-03T19:42:58Z", "path": "MekHQ/src/mekhq/gui/view/ContractSummaryPanel.java", "diffHunk": "@@ -226,7 +226,9 @@ public void mouseClicked(MouseEvent e) {\n             mainPanel.add(lblDistance, gridBagConstraintsLabels);\n \n             JumpPath path = campaign.calculateJumpPath(campaign.getCurrentSystem(), contract.getSystem());\n-            int days = (int) Math.ceil(path.getTotalTime(Utilities.getDateTimeDay(contract.getStartDate()),\n+\n+            int days = (int) Math.ceil(path.getTotalTime(\n+                    contract.getStartDate().toInstant().atZone(ZoneId.systemDefault()).toLocalDate(),", "originalCommit": "618da4a9b5b8c69fe8967107936b0d18bd561e57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTU1MA==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449691550", "bodyText": "This is temporary, until I switch contracts to LocalDate", "author": "Windchild292", "createdAt": "2020-07-03T19:46:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MDg4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTQ4OQ==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449725489", "bodyText": "Sounds good.", "author": "NickAragua", "createdAt": "2020-07-04T01:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MDg4NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449691306", "bodyText": "This seems like it's a behavior change from existing behavior, can you go into a little detail on why it was done?", "author": "NickAragua", "createdAt": "2020-07-03T19:45:33Z", "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "originalCommit": "618da4a9b5b8c69fe8967107936b0d18bd561e57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc3NzE1Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449777156", "bodyText": "This was done to improve the code in question (as a single event can change anything on a given day) by removing the same day event hack of placing an event slightly later in the day, which is no longer possible (LocalDate only stores year, month, day). It was also significantly easier to do this than replace it with LocalDateTime, which would require conversions.", "author": "Windchild292", "createdAt": "2020-07-04T14:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4NzQzMQ==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449887431", "bodyText": "Sounds good in theory, although in practice, we'll need to take a look at the planetary events data and see if we have any events like that which will need to be merged (in order to avoid throwing away any events past the first).", "author": "NickAragua", "createdAt": "2020-07-05T15:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5Njc5Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449896792", "bodyText": "That is already handled in the code, this is just a place that was missed.", "author": "Windchild292", "createdAt": "2020-07-05T16:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5Njg1NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449896855", "bodyText": "Although the changes should use that method, so I'll fit that bit.", "author": "Windchild292", "createdAt": "2020-07-05T16:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NzgxNw==", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449897817", "bodyText": "And the changes are fixed, it properly adds it to the eventList now without causing issues from duplicate events (which currently will occur).", "author": "Windchild292", "createdAt": "2020-07-05T16:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}], "type": "inlineReview", "revised_code": {"commit": "976211ce7bce04f8f6ea545d2437afbb3a7d318b", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/universe/Planet.java b/MekHQ/src/mekhq/campaign/universe/Planet.java\nindex da4ac6323..e70ada8ae 100644\n--- a/MekHQ/src/mekhq/campaign/universe/Planet.java\n+++ b/MekHQ/src/mekhq/campaign/universe/Planet.java\n\n@@ -304,10 +301,7 @@ public class Planet implements Serializable {\n                     pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n \n-                    if (!events.containsKey(eventDate)) {\n-                        pe.date = eventDate;\n-\n-                        events.put(eventDate, pe);\n+                    if (!eventList.contains(pe)) {\n                         eventList.add(pe);\n                     }\n                 }\n"}}, {"oid": "61acc12bc3be21692834dc6d84f2ab5640f1e5f1", "url": "https://github.com/MegaMek/mekhq/commit/61acc12bc3be21692834dc6d84f2ab5640f1e5f1", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_DateTime", "committedDate": "2020-07-04T14:23:56Z", "type": "commit"}, {"oid": "976211ce7bce04f8f6ea545d2437afbb3a7d318b", "url": "https://github.com/MegaMek/mekhq/commit/976211ce7bce04f8f6ea545d2437afbb3a7d318b", "message": "Fixing the name change and faction change events so they uses getOrDefault properly", "committedDate": "2020-07-05T16:58:27Z", "type": "commit"}]}