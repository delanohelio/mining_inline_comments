{"pr_number": 1852, "pr_title": "Moving Retirement to LocalDate", "pr_createdAt": "2020-07-09T17:10:28Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1852", "timeline": [{"oid": "086fdb59312212997dd5267d6f26b2a12d091b8c", "url": "https://github.com/MegaMek/mekhq/commit/086fdb59312212997dd5267d6f26b2a12d091b8c", "message": "Moving Retirement to LocalDate", "committedDate": "2020-07-09T16:34:54Z", "type": "commit"}, {"oid": "9151f3911666dc97921babdae50614da148581c9", "url": "https://github.com/MegaMek/mekhq/commit/9151f3911666dc97921babdae50614da148581c9", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_RetirementLocalDate", "committedDate": "2020-07-09T16:35:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1MDg4Mw==", "url": "https://github.com/MegaMek/mekhq/pull/1852#discussion_r454050883", "bodyText": "ChronoUnit.YEARS.between returns the whole number of years between two dates. This isn't the same logic as before (but perhaps roughly the same logic).", "author": "sixlettervariables", "createdAt": "2020-07-14T01:54:42Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -8395,8 +8395,8 @@ public boolean checkRetirementDefections() {\n \n     public boolean checkYearlyRetirements() {\n         if (getCampaignOptions().getUseAtB()\n-                && Utilities.getDaysBetween(getRetirementDefectionTracker()\n-                        .getLastRetirementRoll().getTime(), getDate()) == 365) {\n+                && (Math.toIntExact(ChronoUnit.YEARS.between(getRetirementDefectionTracker()\n+                .getLastRetirementRoll(), getLocalDate())) == 1)) {", "originalCommit": "9151f3911666dc97921babdae50614da148581c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA2OTc3Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1852#discussion_r454069776", "bodyText": "That is correct, but the rules do say yearly so this is proper", "author": "Windchild292", "createdAt": "2020-07-14T03:01:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1MDg4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "336d0cc92c224c83f61ba8655dccd09361142669", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/Campaign.java b/MekHQ/src/mekhq/campaign/Campaign.java\nindex c87f5f927..c990c95b5 100644\n--- a/MekHQ/src/mekhq/campaign/Campaign.java\n+++ b/MekHQ/src/mekhq/campaign/Campaign.java\n\n@@ -8395,8 +8407,8 @@ public class Campaign implements Serializable, ITechManager {\n \n     public boolean checkYearlyRetirements() {\n         if (getCampaignOptions().getUseAtB()\n-                && (Math.toIntExact(ChronoUnit.YEARS.between(getRetirementDefectionTracker()\n-                .getLastRetirementRoll(), getLocalDate())) == 1)) {\n+                && (ChronoUnit.YEARS.between(getRetirementDefectionTracker()\n+                .getLastRetirementRoll(), getLocalDate()) == 1L)) {\n             Object[] options = { \"Show Retirement Dialog\", \"Not Now\" };\n             return JOptionPane.YES_OPTION == JOptionPane\n                     .showOptionDialog(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1MTU3Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1852#discussion_r454051572", "bodyText": "Why toInt here and above, Is long not going to work?", "author": "sixlettervariables", "createdAt": "2020-07-14T01:57:01Z", "path": "MekHQ/src/mekhq/gui/dialog/RetirementDefectionDialog.java", "diffHunk": "@@ -173,8 +184,8 @@ private void initComponents(boolean doRetirement) {\n             }\n             if (null == contract) {\n                 instructions += \"\\n\\nDays since last retirement roll: \"\n-                        + Utilities.countDaysBetween(rdTracker.getLastRetirementRoll().getTime(),\n-                                hqView.getCampaign().getDate());\n+                        + Math.toIntExact(ChronoUnit.DAYS.between(rdTracker.getLastRetirementRoll(),", "originalCommit": "9151f3911666dc97921babdae50614da148581c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMTM0NA==", "url": "https://github.com/MegaMek/mekhq/pull/1852#discussion_r454411344", "bodyText": "Force of habit to move from long to int, swapped them both to long because they do work as intended as longs.", "author": "Windchild292", "createdAt": "2020-07-14T14:45:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1MTU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "336d0cc92c224c83f61ba8655dccd09361142669", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/RetirementDefectionDialog.java b/MekHQ/src/mekhq/gui/dialog/RetirementDefectionDialog.java\nindex 602d662f2..293a80f0a 100644\n--- a/MekHQ/src/mekhq/gui/dialog/RetirementDefectionDialog.java\n+++ b/MekHQ/src/mekhq/gui/dialog/RetirementDefectionDialog.java\n\n@@ -184,8 +184,8 @@ public class RetirementDefectionDialog extends JDialog {\n             }\n             if (null == contract) {\n                 instructions += \"\\n\\nDays since last retirement roll: \"\n-                        + Math.toIntExact(ChronoUnit.DAYS.between(rdTracker.getLastRetirementRoll(),\n-                        hqView.getCampaign().getLocalDate()));\n+                        + ChronoUnit.DAYS.between(rdTracker.getLastRetirementRoll(),\n+                        hqView.getCampaign().getLocalDate());\n             }\n             txtInstructions.setText(instructions);\n         } else {\n"}}, {"oid": "9db4c4bd1b590b607141f04b33a8ea656d9bc900", "url": "https://github.com/MegaMek/mekhq/commit/9db4c4bd1b590b607141f04b33a8ea656d9bc900", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_RetirementLocalDate", "committedDate": "2020-07-14T14:04:19Z", "type": "commit"}, {"oid": "336d0cc92c224c83f61ba8655dccd09361142669", "url": "https://github.com/MegaMek/mekhq/commit/336d0cc92c224c83f61ba8655dccd09361142669", "message": "Removing unnecessary long to int conversions", "committedDate": "2020-07-14T14:43:17Z", "type": "commit"}]}