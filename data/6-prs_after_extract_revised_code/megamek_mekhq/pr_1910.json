{"pr_number": 1910, "pr_title": "retain force structure in destination campaign", "pr_createdAt": "2020-08-07T18:55:12Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1910", "timeline": [{"oid": "0d46ca431c51a32a93d109fba41029a283d90a24", "url": "https://github.com/MegaMek/mekhq/commit/0d46ca431c51a32a93d109fba41029a283d90a24", "message": "retain force structure in destination campaign", "committedDate": "2020-08-07T18:52:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjA1Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216056", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(sourceForce == null) {\n          \n          \n            \n                    if (sourceForce == null) {", "author": "Windchild292", "createdAt": "2020-08-07T18:57:50Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjEwNA==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216104", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(sourceForce.getParentForce() == null) {\n          \n          \n            \n                        destinationCampaign.getForces().addUnit(unit.getId());\n          \n          \n            \n                    if (sourceForce.getParentForce() == null) {\n          \n          \n            \n                        destinationCampaign.getForces().addUnit(unit.getId());", "author": "Windchild292", "createdAt": "2020-08-07T18:57:57Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjE2Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216166", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(destForce != null) {\n          \n          \n            \n                    if (destForce != null) {", "author": "Windchild292", "createdAt": "2020-08-07T18:58:05Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjM0Nw==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216347", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(int x = parentForces.size() - 1; x >= 0; x--) {\n          \n          \n            \n                        for (int x = parentForces.size() - 1; x >= 0; x--) {", "author": "Windchild292", "createdAt": "2020-08-07T18:58:26Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjQ4Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216482", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(nextDestinationForce == null) {\n          \n          \n            \n                            if (nextDestinationForce == null) {", "author": "Windchild292", "createdAt": "2020-08-07T18:58:43Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjU0Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216546", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(force.getFullName().equals(forceName)) {\n          \n          \n            \n                    if (force.getFullName().equals(forceName)) {", "author": "Windchild292", "createdAt": "2020-08-07T18:58:52Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjYyNw==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216627", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(Force subForce : force.getSubForces()) {\n          \n          \n            \n                        for (Force subForce : force.getSubForces()) {", "author": "Windchild292", "createdAt": "2020-08-07T18:59:00Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjY2NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216665", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(foundForce != null) {\n          \n          \n            \n                            if (foundForce != null) {", "author": "Windchild292", "createdAt": "2020-08-07T18:59:05Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {\n+                Force foundForce = findForce(forceName, subForce);\n+                \n+                if(foundForce != null) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjczMw==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216733", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    while(force.getParentForce() != null) {\n          \n          \n            \n                    while (force.getParentForce() != null) {", "author": "Windchild292", "createdAt": "2020-08-07T18:59:13Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {\n+                Force foundForce = findForce(forceName, subForce);\n+                \n+                if(foundForce != null) {\n+                    return foundForce;\n+                }\n+            }\n+            \n+            return null;\n+        }\n+    }\n \n+    /** \n+     * Moves through a force's ancestors and returns a flattened list of force names in order\n+     * from me to furtherst ancestor.\n+     */\n+    private List<Force> getForceAndParents(Force force) {\n+        List<Force> retval = new ArrayList<>();\n+        retval.add(force);\n+        \n+        Force ancestorForce;\n+        while(force.getParentForce() != null) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjc5Nw==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216797", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(ancestorForce.getParentForce() != null) {\n          \n          \n            \n                        if (ancestorForce.getParentForce() != null) {", "author": "Windchild292", "createdAt": "2020-08-07T18:59:22Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {\n+                Force foundForce = findForce(forceName, subForce);\n+                \n+                if(foundForce != null) {\n+                    return foundForce;\n+                }\n+            }\n+            \n+            return null;\n+        }\n+    }\n \n+    /** \n+     * Moves through a force's ancestors and returns a flattened list of force names in order\n+     * from me to furtherst ancestor.\n+     */\n+    private List<Force> getForceAndParents(Force force) {\n+        List<Force> retval = new ArrayList<>();\n+        retval.add(force);\n+        \n+        Force ancestorForce;\n+        while(force.getParentForce() != null) {\n+            ancestorForce = force.getParentForce();\n+            \n+            // we don't want the top-level force\n+            if(ancestorForce.getParentForce() != null) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5db636f63ec34e60bbf05f4acb87cc086a452077", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..6e23649a8 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -655,8 +659,12 @@ public class CampaignExportWizard extends JDialog {\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n+        \n+        Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if(destForce != null) {\n             destForce.addUnit(unit.getId());\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjkxMA==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216910", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {\n          \n          \n            \n                        if ((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {", "author": "Windchild292", "createdAt": "2020-08-07T18:59:37Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -704,7 +794,15 @@ public Component getListCellRendererComponent(JList<?> list, Object value, int i\n                                                       boolean isSelected, boolean cellHasFocus) {\n             Component cmp = super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);\n             Person person = (Person) value;\n-            String cellValue = String.format(\"%s (%s)\", person.getFullName(), person.getPrimaryRoleDesc());\n+            String callsign = \"\";\n+            if((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {", "originalCommit": "0d46ca431c51a32a93d109fba41029a283d90a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e72155460f1711af9115ecd735b86cacf245806", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 30fe746f9..60434ecaf 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -795,7 +812,7 @@ public class CampaignExportWizard extends JDialog {\n             Component cmp = super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);\n             Person person = (Person) value;\n             String callsign = \"\";\n-            if((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {\n+            if ((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {\n                 callsign = String.format(\"\\\"%s\\\" \", person.getCallsign());\n             }\n             \n"}}, {"oid": "5db636f63ec34e60bbf05f4acb87cc086a452077", "url": "https://github.com/MegaMek/mekhq/commit/5db636f63ec34e60bbf05f4acb87cc086a452077", "message": "fix export issue when root campaign names don't match", "committedDate": "2020-08-08T03:15:59Z", "type": "commit"}, {"oid": "91fa9b8b62cdc9dffbb3cdb5a32099a462f7dc9b", "url": "https://github.com/MegaMek/mekhq/commit/91fa9b8b62cdc9dffbb3cdb5a32099a462f7dc9b", "message": "whitespace", "committedDate": "2020-08-08T03:18:39Z", "type": "commit"}, {"oid": "2265642c1403c06e6698d4e7c921e0be64481c62", "url": "https://github.com/MegaMek/mekhq/commit/2265642c1403c06e6698d4e7c921e0be64481c62", "message": "whitespace", "committedDate": "2020-08-08T03:20:12Z", "type": "commit"}, {"oid": "6e72155460f1711af9115ecd735b86cacf245806", "url": "https://github.com/MegaMek/mekhq/commit/6e72155460f1711af9115ecd735b86cacf245806", "message": "whitespace", "committedDate": "2020-08-08T03:21:09Z", "type": "commit"}, {"oid": "e0d61d5719942ef1b63f420f27bdb7d71408363f", "url": "https://github.com/MegaMek/mekhq/commit/e0d61d5719942ef1b63f420f27bdb7d71408363f", "message": "merge from upstream", "committedDate": "2020-08-09T03:06:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDE2Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467660162", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String sourceForceFullName = getDestinationFullName (sourceForce, sourceCampaign, destinationCampaign);\n          \n          \n            \n                    String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);", "author": "Windchild292", "createdAt": "2020-08-10T02:04:37Z", "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -644,31 +648,36 @@ private boolean exportToCampaign(File file) {\n     \n     private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n         Force sourceForce = sourceCampaign.getForce(sourceForceID);\n-        if(sourceForce == null) {\n+        if (sourceForce == null) {\n             return;\n         }\n         \n         // this indicates a unit assigned to the root-level force\n-        if(sourceForce.getParentForce() == null) {\n+        if (sourceForce.getParentForce() == null) {\n             destinationCampaign.getForces().addUnit(unit.getId());\n         }\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n-        if(destForce != null) {\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName (sourceForce, sourceCampaign, destinationCampaign);", "originalCommit": "e0d61d5719942ef1b63f420f27bdb7d71408363f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9d023a67b1e6c873eda558df5aee389ad802363e", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\nindex 60434ecaf..975231ecc 100644\n--- a/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n+++ b/MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\n@@ -662,7 +662,7 @@ public class CampaignExportWizard extends JDialog {\n         // otherwise, chain-add forces\n \n         // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n-        String sourceForceFullName = getDestinationFullName (sourceForce, sourceCampaign, destinationCampaign);\n+        String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);\n         \n         Force destForce = findForce(sourceForceFullName, destinationCampaign.getForces());\n         if (destForce != null) {\n"}}, {"oid": "9d023a67b1e6c873eda558df5aee389ad802363e", "url": "https://github.com/MegaMek/mekhq/commit/9d023a67b1e6c873eda558df5aee389ad802363e", "message": "Update MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-10T04:08:58Z", "type": "commit"}]}