{"pr_number": 2282, "pr_title": "Issue #2141: Subcontracts don't reference parent contract after campaign load", "pr_createdAt": "2020-12-13T07:46:45Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2282", "timeline": [{"oid": "f5f298c41a602b3e60c4f7a6f97cbe1ec8c967e2", "url": "https://github.com/MegaMek/mekhq/commit/f5f298c41a602b3e60c4f7a6f97cbe1ec8c967e2", "message": "Ensure sub-contracts reference their parent contract, fixes #2141", "committedDate": "2020-12-13T06:56:54Z", "type": "commit"}, {"oid": "1efa86189c0807e17f8ba945eab186b6b05a3350", "url": "https://github.com/MegaMek/mekhq/commit/1efa86189c0807e17f8ba945eab186b6b05a3350", "message": "Add tests for #2141", "committedDate": "2020-12-13T07:38:24Z", "type": "commit"}, {"oid": "c88ca2c1c698dfe730b493048b630ef6d20ce973", "url": "https://github.com/MegaMek/mekhq/commit/c88ca2c1c698dfe730b493048b630ef6d20ce973", "message": "Restore AtBContract references in the ContractMarket #2141", "committedDate": "2020-12-13T07:45:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTg2OTYwMw==", "url": "https://github.com/MegaMek/mekhq/pull/2282#discussion_r541869603", "bodyText": "Use the MekHqXmlUtil.writeSimpleXmlTag instead, it handled UUID with a null check (And doesn't write otherwise)", "author": "Windchild292", "createdAt": "2020-12-13T07:49:08Z", "path": "MekHQ/src/mekhq/campaign/mission/AtBContract.java", "diffHunk": "@@ -1193,6 +1193,12 @@ protected void writeToXmlBegin(PrintWriter pw1, int indent) {\n                 +\"<nextWeekBattleTypeMod>\"\n                 +nextWeekBattleTypeMod\n                 +\"</nextWeekBattleTypeMod>\");\n+        if (parentContract != null) {\n+            pw1.println(MekHqXmlUtil.indentStr(indent+1)\n+                    + \"<parentContractId>\"\n+                    + parentContract.getId()\n+                    + \"</parentContractId>\");", "originalCommit": "c88ca2c1c698dfe730b493048b630ef6d20ce973", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTg3MTQ5Ng==", "url": "https://github.com/MegaMek/mekhq/pull/2282#discussion_r541871496", "bodyText": "The ID is an integer in this case.", "author": "sixlettervariables", "createdAt": "2020-12-13T08:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTg2OTYwMw=="}], "type": "inlineReview", "revised_code": {"commit": "48125fe0b4885563f2b517104509fa55db156587", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/mission/AtBContract.java b/MekHQ/src/mekhq/campaign/mission/AtBContract.java\nindex c52a7837f..cbe3391f1 100644\n--- a/MekHQ/src/mekhq/campaign/mission/AtBContract.java\n+++ b/MekHQ/src/mekhq/campaign/mission/AtBContract.java\n\n@@ -1194,10 +1194,7 @@ public class AtBContract extends Contract implements Serializable {\n                 +nextWeekBattleTypeMod\n                 +\"</nextWeekBattleTypeMod>\");\n         if (parentContract != null) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent+1)\n-                    + \"<parentContractId>\"\n-                    + parentContract.getId()\n-                    + \"</parentContractId>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent + 1, \"parentContractId\", parentContract.getId());\n         }\n \n         if (null != specialEventScenarioDate) {\n"}}, {"oid": "48125fe0b4885563f2b517104509fa55db156587", "url": "https://github.com/MegaMek/mekhq/commit/48125fe0b4885563f2b517104509fa55db156587", "message": "Address PR feedback and fix LGTM nit", "committedDate": "2020-12-13T08:07:48Z", "type": "commit"}]}