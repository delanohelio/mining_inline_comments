{"pr_number": 2151, "pr_title": "MissionStatus Enum", "pr_createdAt": "2020-10-16T21:01:01Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2151", "timeline": [{"oid": "32ae6b7120de58adad1ff2ac03fecb73c0951ab5", "url": "https://github.com/MegaMek/mekhq/commit/32ae6b7120de58adad1ff2ac03fecb73c0951ab5", "message": "Heavy refactor of CompleteMissionDialog", "committedDate": "2020-10-16T20:13:41Z", "type": "commit"}, {"oid": "75e396b885c6008c6f6a7d72f1bbd7aad8099970", "url": "https://github.com/MegaMek/mekhq/commit/75e396b885c6008c6f6a7d72f1bbd7aad8099970", "message": "Moving to an enum for mission status", "committedDate": "2020-10-16T20:29:27Z", "type": "commit"}, {"oid": "f3516bcd7c5c2808e0cc85da79465f3af2dfe940", "url": "https://github.com/MegaMek/mekhq/commit/f3516bcd7c5c2808e0cc85da79465f3af2dfe940", "message": "Bugfixing and changes from personal review", "committedDate": "2020-10-16T20:58:56Z", "type": "commit"}, {"oid": "f34ac06c3db416f5e852246e928d3b1c6c132500", "url": "https://github.com/MegaMek/mekhq/commit/f34ac06c3db416f5e852246e928d3b1c6c132500", "message": "Merge branch 'master' into dev_Windchild_MissionStatus", "committedDate": "2020-10-21T01:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyMTcxMg==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r509821712", "bodyText": "I would suggest retaining the isActive() method, but having it call getStatus().isActive(). That way you can reduce the footprint of this PR quite a bit while keeping the spirit.", "author": "NickAragua", "createdAt": "2020-10-22T01:10:02Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3064,7 +3064,7 @@ public void readNews() {\n     }\n \n     public int getDeploymentDeficit(AtBContract contract) {\n-        if (!contract.isActive()) {\n+        if (!contract.getStatus().isActive()) {", "originalCommit": "f34ac06c3db416f5e852246e928d3b1c6c132500", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTkyMzYwMg==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r509923602", "bodyText": "That is purposeful. I'd rather have the code in the enum in question to prevent future problems... This is especially for tracing, as I've seen what happens when coders go over-the-top with putting methods that do this and the sheer amount of effort that it adds to tracing [especially for enums], and thus would prefer to avoid it in our code base.", "author": "Windchild292", "createdAt": "2020-10-22T07:00:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyMTcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE0MzY4Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r510143687", "bodyText": "My preference would be Contract::isActive as well. It is more intuitive and benefits from intellisense (etc). Much like Person::isDeployed which wraps a similar check for convenience.", "author": "sixlettervariables", "createdAt": "2020-10-22T13:04:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyMTcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE0NjIyOA==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r510146228", "bodyText": "A compromise could be Contract::isActiveOn(LocalDate date) which would handle a lot of these call sites.", "author": "sixlettervariables", "createdAt": "2020-10-22T13:07:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyMTcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI1NjI3Mg==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r510256272", "bodyText": "I'm actually planning on implementing contact end date nag and removing most uses of isActive in the near future. This originally contained them, but it got too busy for the PR so I reverted it.\nFuther, Person::isDeployed isn't an enum check but rather a unit value check. Because it is an enum check is why this is implemented as it is.\nAs for isActiveOn, that's a nice way to handle it that will simplify some of the logic for my next changes, but it should be handled by getActiveContract if it is simply an active state check that does not currently need to be handled based only on start date.", "author": "Windchild292", "createdAt": "2020-10-22T15:30:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyMTcxMg=="}], "type": "inlineReview", "revised_code": {"commit": "bac1ae00109056ac5aaf4ddf35370fb62657e4ed", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/Campaign.java b/MekHQ/src/mekhq/campaign/Campaign.java\nindex 79322be94..5e6660edf 100644\n--- a/MekHQ/src/mekhq/campaign/Campaign.java\n+++ b/MekHQ/src/mekhq/campaign/Campaign.java\n\n@@ -3064,10 +3002,7 @@ public class Campaign implements Serializable, ITechManager {\n     }\n \n     public int getDeploymentDeficit(AtBContract contract) {\n-        if (!contract.getStatus().isActive()) {\n-            // Inactive contracts have no deficits.\n-            return 0;\n-        } else if (contract.getStartDate().compareTo(getLocalDate()) >= 0) {\n+        if (contract.getStartDate().compareTo(getLocalDate()) >= 0) {\n             // Do not check for deficits if the contract has not started or\n             // it is the first day of the contract, as players won't have\n             // had time to assign forces to the contract yet\n"}}, {"oid": "7c0dd98fed591d24803031e815a39480fae3da18", "url": "https://github.com/MegaMek/mekhq/commit/7c0dd98fed591d24803031e815a39480fae3da18", "message": "Fixing merge conflitcs", "committedDate": "2020-12-04T17:24:21Z", "type": "commit"}, {"oid": "461f2e03e5c7b7e233ccb188ab3acbea84217051", "url": "https://github.com/MegaMek/mekhq/commit/461f2e03e5c7b7e233ccb188ab3acbea84217051", "message": "Fixing merge conflicts", "committedDate": "2021-01-09T17:33:02Z", "type": "commit"}, {"oid": "df4a29544f45765ee44363e2c9f2efd950b394f7", "url": "https://github.com/MegaMek/mekhq/commit/df4a29544f45765ee44363e2c9f2efd950b394f7", "message": "Fixing unit testing", "committedDate": "2021-01-09T17:45:59Z", "type": "commit"}, {"oid": "b395926d66b44f814eeccbcdf238377754b3497f", "url": "https://github.com/MegaMek/mekhq/commit/b395926d66b44f814eeccbcdf238377754b3497f", "message": "Swapping to using streams for missions", "committedDate": "2021-01-16T17:03:30Z", "type": "commit"}, {"oid": "3c08e5b43761cd85a411618df940a669f43b0f74", "url": "https://github.com/MegaMek/mekhq/commit/3c08e5b43761cd85a411618df940a669f43b0f74", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_MissionStatus", "committedDate": "2021-01-16T17:03:41Z", "type": "commit"}, {"oid": "56075ee22d31cf6645cfbc078f6d0059a7c35a2e", "url": "https://github.com/MegaMek/mekhq/commit/56075ee22d31cf6645cfbc078f6d0059a7c35a2e", "message": "Swapping to stream implementation", "committedDate": "2021-01-16T18:07:08Z", "type": "commit"}, {"oid": "c56982c6b4c7590fa58659f5739adb6fb98c38b3", "url": "https://github.com/MegaMek/mekhq/commit/c56982c6b4c7590fa58659f5739adb6fb98c38b3", "message": "Applying changes from personal review", "committedDate": "2021-01-16T18:20:27Z", "type": "commit"}, {"oid": "bac1ae00109056ac5aaf4ddf35370fb62657e4ed", "url": "https://github.com/MegaMek/mekhq/commit/bac1ae00109056ac5aaf4ddf35370fb62657e4ed", "message": "Moving to only use getMissions when necessary", "committedDate": "2021-01-16T18:40:07Z", "type": "commit"}, {"oid": "6a6ab7d22aae49fceae02409ae8f3121e890ccc1", "url": "https://github.com/MegaMek/mekhq/commit/6a6ab7d22aae49fceae02409ae8f3121e890ccc1", "message": "Moving to isActiveOn", "committedDate": "2021-01-16T18:57:34Z", "type": "commit"}, {"oid": "6d4d08116905e9d574934a7d8247c24b09a64244", "url": "https://github.com/MegaMek/mekhq/commit/6d4d08116905e9d574934a7d8247c24b09a64244", "message": "Fixing unit testing", "committedDate": "2021-01-16T19:31:44Z", "type": "commit"}, {"oid": "746917d1bc29c5ba0115356897777a78c6dc3e68", "url": "https://github.com/MegaMek/mekhq/commit/746917d1bc29c5ba0115356897777a78c6dc3e68", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_MissionStatus", "committedDate": "2021-02-11T19:16:07Z", "type": "commit"}, {"oid": "d5767fac16735b748124c2759fa7e02388f3e3e0", "url": "https://github.com/MegaMek/mekhq/commit/d5767fac16735b748124c2759fa7e02388f3e3e0", "message": "Applying changes from personal review", "committedDate": "2021-02-11T19:52:56Z", "type": "commit"}, {"oid": "9eca5ea7a7d0fe44db02d1ce091f5bf294cb156d", "url": "https://github.com/MegaMek/mekhq/commit/9eca5ea7a7d0fe44db02d1ce091f5bf294cb156d", "message": "Fixing merge conflicts", "committedDate": "2021-03-09T16:07:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjg2OTAxOQ==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r592869019", "bodyText": "Looks like you missed a .isActiveOn() call here", "author": "NickAragua", "createdAt": "2021-03-12T02:34:46Z", "path": "MekHQ/src/mekhq/gui/dialog/ContractMarketDialog.java", "diffHunk": "@@ -104,16 +103,15 @@ public ContractMarketDialog(Frame frame, Campaign c) {\n      */\n     private void countSuccessfulContracts() {\n         HashMap<String, Integer> successfulContracts = new HashMap<>();\n-        for (Mission m : campaign.getMissions()) {\n-            if (m.isActive() || !(m instanceof AtBContract)\n-                    || ((AtBContract) m).getEmployerCode().equals(campaign.getRetainerEmployerCode())) {\n+        for (AtBContract contract : campaign.getAtBContracts()) {\n+            if (contract.getStatus().isActive()", "originalCommit": "9eca5ea7a7d0fe44db02d1ce091f5bf294cb156d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjg3NjY2Mg==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r592876662", "bodyText": "That's a bug", "author": "Windchild292", "createdAt": "2021-03-12T02:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjg2OTAxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "98253ba4fbbd681dca588b7cb766e8439c19d880", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/ContractMarketDialog.java b/MekHQ/src/mekhq/gui/dialog/ContractMarketDialog.java\nindex def7628d9..76d66dfc2 100644\n--- a/MekHQ/src/mekhq/gui/dialog/ContractMarketDialog.java\n+++ b/MekHQ/src/mekhq/gui/dialog/ContractMarketDialog.java\n\n@@ -103,9 +103,8 @@ public class ContractMarketDialog extends JDialog {\n      */\n     private void countSuccessfulContracts() {\n         HashMap<String, Integer> successfulContracts = new HashMap<>();\n-        for (AtBContract contract : campaign.getAtBContracts()) {\n-            if (contract.getStatus().isActive()\n-                    || contract.getEmployerCode().equals(campaign.getRetainerEmployerCode())) {\n+        for (AtBContract contract : campaign.getCompletedAtBContracts()) {\n+            if (contract.getEmployerCode().equals(campaign.getRetainerEmployerCode())) {\n                 continue;\n             }\n             int num;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjg2OTUwNg==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r592869506", "bodyText": "Is this a good place for isActiveOn()?", "author": "NickAragua", "createdAt": "2021-03-12T02:36:07Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -2939,11 +2998,12 @@ public void readNews() {\n         }\n     }\n \n+    /**\n+     * @param contract an active AtBContract\n+     * @return the current deployment deficit for the contract\n+     */\n     public int getDeploymentDeficit(AtBContract contract) {\n-        if (!contract.isActive()) {\n-            // Inactive contracts have no deficits.\n-            return 0;\n-        } else if (contract.getStartDate().compareTo(getLocalDate()) >= 0) {\n+        if (contract.getStartDate().compareTo(getLocalDate()) >= 0) {", "originalCommit": "9eca5ea7a7d0fe44db02d1ce091f5bf294cb156d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjg3NzEyNQ==", "url": "https://github.com/MegaMek/mekhq/pull/2151#discussion_r592877125", "bodyText": "It would be", "author": "Windchild292", "createdAt": "2021-03-12T02:59:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjg2OTUwNg=="}], "type": "inlineReview", "revised_code": {"commit": "98253ba4fbbd681dca588b7cb766e8439c19d880", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/Campaign.java b/MekHQ/src/mekhq/campaign/Campaign.java\nindex b74080384..a9823e9d3 100644\n--- a/MekHQ/src/mekhq/campaign/Campaign.java\n+++ b/MekHQ/src/mekhq/campaign/Campaign.java\n\n@@ -3003,7 +3010,7 @@ public class Campaign implements Serializable, ITechManager {\n      * @return the current deployment deficit for the contract\n      */\n     public int getDeploymentDeficit(AtBContract contract) {\n-        if (contract.getStartDate().compareTo(getLocalDate()) >= 0) {\n+        if (contract.isActiveOn(getLocalDate())) {\n             // Do not check for deficits if the contract has not started or\n             // it is the first day of the contract, as players won't have\n             // had time to assign forces to the contract yet\n"}}, {"oid": "64b151aab1a311e538c895526ba3f807216917c1", "url": "https://github.com/MegaMek/mekhq/commit/64b151aab1a311e538c895526ba3f807216917c1", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_MissionStatus", "committedDate": "2021-03-12T02:48:54Z", "type": "commit"}, {"oid": "98253ba4fbbd681dca588b7cb766e8439c19d880", "url": "https://github.com/MegaMek/mekhq/commit/98253ba4fbbd681dca588b7cb766e8439c19d880", "message": "Applying bugfixes from review", "committedDate": "2021-03-12T02:59:41Z", "type": "commit"}]}