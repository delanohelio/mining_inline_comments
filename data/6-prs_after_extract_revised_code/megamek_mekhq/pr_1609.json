{"pr_number": 1609, "pr_title": "Person LocalDate", "pr_createdAt": "2020-04-01T20:45:48Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1609", "timeline": [{"oid": "2d5d6a9c3d8f9c64c420a259f4f6433a39d49986", "url": "https://github.com/MegaMek/mekhq/commit/2d5d6a9c3d8f9c64c420a259f4f6433a39d49986", "message": "Cleaning up FormerSpouse", "committedDate": "2020-04-01T16:36:05Z", "type": "commit"}, {"oid": "e7317296f0ffcd04b0582ea90077d92e92eb7291", "url": "https://github.com/MegaMek/mekhq/commit/e7317296f0ffcd04b0582ea90077d92e92eb7291", "message": "Implementing local date for personnel, part 1", "committedDate": "2020-04-01T17:52:37Z", "type": "commit"}, {"oid": "74d6c197a39ed99c6247aaeaba4a1c9216b0dc42", "url": "https://github.com/MegaMek/mekhq/commit/74d6c197a39ed99c6247aaeaba4a1c9216b0dc42", "message": "Adding personnel LocalDate to HireBulkPersonnel and fixing potential NPEs in the class", "committedDate": "2020-04-01T17:53:48Z", "type": "commit"}, {"oid": "47330f018528c8cc6291dedd77d2048f6a53e418", "url": "https://github.com/MegaMek/mekhq/commit/47330f018528c8cc6291dedd77d2048f6a53e418", "message": "Fixing for local date in customizepersondialog", "committedDate": "2020-04-01T18:12:22Z", "type": "commit"}, {"oid": "0cecb33fcb0f55bcb8119a83bc18e4fa3b0cad14", "url": "https://github.com/MegaMek/mekhq/commit/0cecb33fcb0f55bcb8119a83bc18e4fa3b0cad14", "message": "Removing unused import", "committedDate": "2020-04-01T18:13:06Z", "type": "commit"}, {"oid": "7a18fd69fe2075c523455b49cacac897c7acd7c2", "url": "https://github.com/MegaMek/mekhq/commit/7a18fd69fe2075c523455b49cacac897c7acd7c2", "message": "Fixing bugs in localdate implementation\n:", "committedDate": "2020-04-01T19:05:28Z", "type": "commit"}, {"oid": "308bf9cfb2c74a3e594cc11b35686e2e58097578", "url": "https://github.com/MegaMek/mekhq/commit/308bf9cfb2c74a3e594cc11b35686e2e58097578", "message": "Fixing incorrect ordering for Time in Serviceg", "committedDate": "2020-04-01T19:06:30Z", "type": "commit"}, {"oid": "a661feb787326b8d905446b791a7cd720e60ff7b", "url": "https://github.com/MegaMek/mekhq/commit/a661feb787326b8d905446b791a7cd720e60ff7b", "message": "Fixing tab spacing in CustomizePersonDialog", "committedDate": "2020-04-01T19:12:21Z", "type": "commit"}, {"oid": "e30a8a14abb8630a9e0678b3847375e8b78802c5", "url": "https://github.com/MegaMek/mekhq/commit/e30a8a14abb8630a9e0678b3847375e8b78802c5", "message": "Fixing merge conflicts", "committedDate": "2020-04-01T20:28:58Z", "type": "commit"}, {"oid": "48b38872c1d2d9c47112ba0a9f31c2b89139a3b1", "url": "https://github.com/MegaMek/mekhq/commit/48b38872c1d2d9c47112ba0a9f31c2b89139a3b1", "message": "Fixing minor bugs", "committedDate": "2020-04-01T20:42:18Z", "type": "commit"}, {"oid": "092bf0b3c2d3cc396fe22e09ac9df5df8c8030db", "url": "https://github.com/MegaMek/mekhq/commit/092bf0b3c2d3cc396fe22e09ac9df5df8c8030db", "message": "Switching to using ChronoUnit.WEEKS to properly calculate the number of weeks at one time", "committedDate": "2020-04-01T21:02:08Z", "type": "commit"}, {"oid": "15e06bd4da93656043a8d82e5ef53fa45722c69f", "url": "https://github.com/MegaMek/mekhq/commit/15e06bd4da93656043a8d82e5ef53fa45722c69f", "message": "Switching to using a ternary for leap year days", "committedDate": "2020-04-01T21:05:26Z", "type": "commit"}, {"oid": "1a194dc02c90a5464a0d090e08dbf309c297597b", "url": "https://github.com/MegaMek/mekhq/commit/1a194dc02c90a5464a0d090e08dbf309c297597b", "message": "Removing unused import", "committedDate": "2020-04-01T21:06:37Z", "type": "commit"}, {"oid": "7b3846bc891dfc3097e386ead0b859ea47122c80", "url": "https://github.com/MegaMek/mekhq/commit/7b3846bc891dfc3097e386ead0b859ea47122c80", "message": "Removing unused imports", "committedDate": "2020-04-01T21:07:18Z", "type": "commit"}, {"oid": "4b253d89a41501c955429c062be4f7b91a0047da", "url": "https://github.com/MegaMek/mekhq/commit/4b253d89a41501c955429c062be4f7b91a0047da", "message": "removing old import in former spouse", "committedDate": "2020-04-01T21:08:45Z", "type": "commit"}, {"oid": "377462bc827fec47a6896f05bcd32eecd01c2b37", "url": "https://github.com/MegaMek/mekhq/commit/377462bc827fec47a6896f05bcd32eecd01c2b37", "message": "Removing more unused imports", "committedDate": "2020-04-01T21:11:23Z", "type": "commit"}, {"oid": "ba2c7fcedd7415e167c7e83cc23ea9ba41e644e2", "url": "https://github.com/MegaMek/mekhq/commit/ba2c7fcedd7415e167c7e83cc23ea9ba41e644e2", "message": "Fixing capitalization of two private constants", "committedDate": "2020-04-01T21:19:23Z", "type": "commit"}, {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21", "url": "https://github.com/MegaMek/mekhq/commit/89f8d8f2e5be002e107ae0c7958b6295b486af21", "message": "Fixing capitalization of two private constants", "committedDate": "2020-04-01T21:19:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MjI2NA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402682264", "bodyText": "I hate to ask, but is this going to impact this type of export? Not that I've ever even heard of a MercRoster database, but...", "author": "NickAragua", "createdAt": "2020-04-03T01:09:51Z", "path": "MekHQ/src/mekhq/campaign/MercRosterAccess.java", "diffHunk": "@@ -473,10 +473,10 @@ private void writePersonnelData() {\n                 preparedStatement.setInt(6, forceId);\n                 preparedStatement.setInt(7, 1);\n                 //TODO: get joining date right\n-                preparedStatement.setDate(8, new java.sql.Date(p.getBirthday().getTimeInMillis()));\n+                preparedStatement.setDate(8, java.sql.Date.valueOf(p.getBirthday()));", "originalCommit": "89f8d8f2e5be002e107ae0c7958b6295b486af21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4NDA4NA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402684084", "bodyText": "MercRoster that is a name I haven't heard in a long time. It was one of Taharqa projects.\nhttps://sourceforge.net/projects/mercroster/", "author": "HammerGS", "createdAt": "2020-04-03T01:16:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MjI2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4NDIwMA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402684200", "bodyText": "This method was added for reverse compatibility, so it shouldn't?\nhttps://www.javatpoint.com/java-sql-date-valueof-method", "author": "Windchild292", "createdAt": "2020-04-03T01:17:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MjI2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4NDQ4OA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402684488", "bodyText": "As for MercRoster, see Hammer's reply... although I've seen it surprisingly often when looking at personnel (probably because of how tied in the two are)", "author": "Windchild292", "createdAt": "2020-04-03T01:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MjI2NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402683403", "bodyText": "Is there a way to just parse a date without specifying the exact format? Seems like a built-in library should be smart enough to contain that logic already.", "author": "NickAragua", "createdAt": "2020-04-03T01:14:11Z", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -2228,13 +2209,27 @@ public static Person generateInstanceFromXML(Node wn, Campaign c, Version versio\n                         retVal.formerSpouses.add(FormerSpouse.generateInstanceFromXML(wn3));\n                     }\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"dueDate\")) {\n-                    SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n-                    retVal.dueDate = (GregorianCalendar) GregorianCalendar.getInstance();\n-                    retVal.dueDate.setTime(df.parse(wn2.getTextContent().trim()));\n+                    if (version.isLowerThan(\"0.47.6\")) {\n+                        try {\n+                            retVal.dueDate = LocalDate.parse(wn2.getTextContent().trim(),\n+                                    DateTimeFormatter.ofPattern(\"yyyy-MM-dd hh:mm:ss\"));\n+                        } catch (Exception ignored) {\n+                        }\n+                    } else {\n+                        retVal.dueDate = LocalDate.parse(wn2.getTextContent().trim(),\n+                                DateTimeFormatter.ofPattern(DATE_SAVE_FORMAT));\n+                    }\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"expectedDueDate\")) {\n-                    SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n-                    retVal.expectedDueDate = (GregorianCalendar) GregorianCalendar.getInstance();\n-                    retVal.expectedDueDate.setTime(df.parse(wn2.getTextContent().trim()));\n+                    if (version.isLowerThan(\"0.47.6\")) {", "originalCommit": "89f8d8f2e5be002e107ae0c7958b6295b486af21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4Mzc4NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402683785", "bodyText": "I didn't find one while researching, annoyingly.", "author": "Windchild292", "createdAt": "2020-04-03T01:15:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4NDExNA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402684114", "bodyText": "You can but it fails on machines with different cultures from what wrote the date, can't pass around CPNX's.", "author": "sixlettervariables", "createdAt": "2020-04-03T01:17:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4Nzc3MA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402687770", "bodyText": "All right, in that case, let's consolidate this logic into a separate function.", "author": "NickAragua", "createdAt": "2020-04-03T01:30:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4ODI3NA==", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402688274", "bodyText": "I plan on doing so for all of the personnel migration cases, but that will be in a different PR.", "author": "Windchild292", "createdAt": "2020-04-03T01:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw=="}], "type": "inlineReview", "revised_code": null}]}