{"pr_number": 1399, "pr_title": "Cleaning up code in GMTools and RAT Management files", "pr_createdAt": "2020-01-18T22:51:41Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1399", "timeline": [{"oid": "c76143508d0f306445e3d5844d406b777419ef1f", "url": "https://github.com/MegaMek/mekhq/commit/c76143508d0f306445e3d5844d406b777419ef1f", "message": "Cleaning up code in GMTools and RAT Management files", "committedDate": "2020-01-18T21:44:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MTIyNA==", "url": "https://github.com/MegaMek/mekhq/pull/1399#discussion_r368261224", "bodyText": "The second null check is here because performRollRat() can return null.", "author": "neoancient", "createdAt": "2020-01-19T02:44:07Z", "path": "MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java", "diffHunk": "@@ -331,72 +331,60 @@ private void setUserPreferences() {\n         this.setName(\"dialog\");\n         preferences.manage(new JWindowPreference(this));\n     }\n-    \n+\n     @Override\n     public void actionPerformed(ActionEvent event) {\n         final String METHOD_NAME = \"actionPerformed(ActionEvent)\"; //$NON-NLS-1$\n \n         if(event.getActionCommand().equals(GM_TOOL_DICE)) {\n             performDiceRoll();\n         }\n-        \n+\n         if(event.getActionCommand().equals(RAT_ROLLER_TOOL)) {\n             lastRolledUnit = performRollRat();\n         }\n-        \n+\n         if(event.getActionCommand().equals(RAT_ADDER_TOOL)) {\n-            if (null == lastRolledUnit) {\n+            if (lastRolledUnit == null) {\n                 lastRolledUnit = performRollRat();\n             }\n \n-            if (null != lastRolledUnit) {", "originalCommit": "c76143508d0f306445e3d5844d406b777419ef1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MjE1OQ==", "url": "https://github.com/MegaMek/mekhq/pull/1399#discussion_r368262159", "bodyText": "You are correct, this is a dumb mistake on my side. It has been fixed.", "author": "Windchild292", "createdAt": "2020-01-19T03:10:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MTIyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MjIyNQ==", "url": "https://github.com/MegaMek/mekhq/pull/1399#discussion_r368262225", "bodyText": "We all miss simple stuff. That's why we double-check each others' work.", "author": "neoancient", "createdAt": "2020-01-19T03:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MTIyNA=="}], "type": "inlineReview", "revised_code": {"commit": "2ec1045403dc952a6194a31b05d7092b1c26085d", "chunk": "diff --git a/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java b/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\nindex 3d9a9d22b..703073cd3 100644\n--- a/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n+++ b/MekHQ/src/mekhq/gui/dialog/GMToolsDialog.java\n\n@@ -349,21 +349,23 @@ public class GMToolsDialog extends JDialog implements ActionListener {\n                 lastRolledUnit = performRollRat();\n             }\n \n-            Entity e;\n-            try {\n-                e = new MechFileParser(lastRolledUnit.getSourceFile(), lastRolledUnit.getEntryName()).getEntity();\n-                Unit u = gui.getCampaign().addUnit(e, false, 0);\n-                if (person != null) {\n-                    u.addPilotOrSoldier(person);\n-                    person.setOriginalUnit(u);\n-                    setVisible(false);\n+            if (lastRolledUnit != null) {\n+                Entity e;\n+                try {\n+                    e = new MechFileParser(lastRolledUnit.getSourceFile(), lastRolledUnit.getEntryName()).getEntity();\n+                    Unit u = gui.getCampaign().addUnit(e, false, 0);\n+                    if (person != null) {\n+                        u.addPilotOrSoldier(person);\n+                        person.setOriginalUnit(u);\n+                        setVisible(false);\n+                    }\n+                    lastRolledUnit = null;\n+                } catch (EntityLoadingException e1) {\n+                    MekHQ.getLogger().log(getClass(), METHOD_NAME, LogLevel.ERROR,\n+                            \"Failed to load entity \" + lastRolledUnit.getName() + \" from \" + lastRolledUnit.getSourceFile().toString()); //$NON-NLS-1$\n+                    MekHQ.getLogger().error(getClass(), METHOD_NAME, e1);\n+                    unitPicked.setText(\"Failed to load entity \" + lastRolledUnit.getName());\n                 }\n-                lastRolledUnit = null;\n-            } catch (EntityLoadingException e1) {\n-                MekHQ.getLogger().log(getClass(), METHOD_NAME, LogLevel.ERROR,\n-                        \"Failed to load entity \" + lastRolledUnit.getName() + \" from \" + lastRolledUnit.getSourceFile().toString()); //$NON-NLS-1$\n-                MekHQ.getLogger().error(getClass(), METHOD_NAME, e1);\n-                unitPicked.setText(\"Failed to load entity \" + lastRolledUnit.getName());\n             }\n         }\n     }\n"}}, {"oid": "2ec1045403dc952a6194a31b05d7092b1c26085d", "url": "https://github.com/MegaMek/mekhq/commit/2ec1045403dc952a6194a31b05d7092b1c26085d", "message": "Reverting change that removed the lastRolledUnit null check after rerolling", "committedDate": "2020-01-19T03:11:35Z", "type": "commit"}]}