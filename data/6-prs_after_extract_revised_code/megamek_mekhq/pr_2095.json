{"pr_number": 2095, "pr_title": "Preserve hip and shoulder damage on a refit", "pr_createdAt": "2020-10-02T15:14:27Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2095", "timeline": [{"oid": "a9c338b8918ab029b1313721f2ed00cbeb9a5cd5", "url": "https://github.com/MegaMek/mekhq/commit/a9c338b8918ab029b1313721f2ed00cbeb9a5cd5", "message": "preserve hip and shoulder damage on a refit", "committedDate": "2020-10-02T15:10:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg4ODY1Ng==", "url": "https://github.com/MegaMek/mekhq/pull/2095#discussion_r498888656", "bodyText": "What if we actually replaced the location? e.g. changed structure type from endo-steel to standard or vice versa.", "author": "NickAragua", "createdAt": "2020-10-02T15:20:50Z", "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -1433,6 +1434,15 @@ private void complete() {\n                 MekHQ.getLogger().error(this, \"part with id \" + pid + \" not found for refit of \" + getDesc());\n                 continue;\n             }\n+            if (part instanceof MekLocation) {", "originalCommit": "a9c338b8918ab029b1313721f2ed00cbeb9a5cd5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MjQ0Ng==", "url": "https://github.com/MegaMek/mekhq/pull/2095#discussion_r498942446", "bodyText": "Good catch - I'll add a check for that. I'll probably also need to ensure the old location with the broken joint doesn't get stored in the warehouse.", "author": "RexPearce", "createdAt": "2020-10-02T17:03:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg4ODY1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ecbf2be9365235cc84bc6795053b530f17f739b2", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/parts/Refit.java b/MekHQ/src/mekhq/campaign/parts/Refit.java\nindex f520020c0..db9867ee8 100644\n--- a/MekHQ/src/mekhq/campaign/parts/Refit.java\n+++ b/MekHQ/src/mekhq/campaign/parts/Refit.java\n\n@@ -1434,7 +1435,7 @@ public class Refit extends Part implements IPartWork, IAcquisitionWork {\n                 MekHQ.getLogger().error(this, \"part with id \" + pid + \" not found for refit of \" + getDesc());\n                 continue;\n             }\n-            if (part instanceof MekLocation) {\n+            if ((!replacingLocations) && (part instanceof MekLocation)) {\n                 // Preserve any hip or shoulder damage\n                 int loc = ((MekLocation) part).getLoc();\n                 if ((oldEntity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM, Mech.ACTUATOR_HIP, loc) > 0) ||\n"}}, {"oid": "ecbf2be9365235cc84bc6795053b530f17f739b2", "url": "https://github.com/MegaMek/mekhq/commit/ecbf2be9365235cc84bc6795053b530f17f739b2", "message": "don't preserve joint damage when refit replaces a location (i.e. endo <-> std)", "committedDate": "2020-10-02T19:08:35Z", "type": "commit"}, {"oid": "c35cb8882de722d3e350619919a9e98e088c6135", "url": "https://github.com/MegaMek/mekhq/commit/c35cb8882de722d3e350619919a9e98e088c6135", "message": "don't add locations with joint damage to warehouse", "committedDate": "2020-10-02T19:09:52Z", "type": "commit"}]}