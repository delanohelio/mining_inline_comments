{"pr_number": 1656, "pr_title": "Avoid NPE in Person::isMothballing", "pr_createdAt": "2020-04-10T19:42:02Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1656", "timeline": [{"oid": "688d0583687a3f31d31eb3ac266bc9eb4f503a4e", "url": "https://github.com/MegaMek/mekhq/commit/688d0583687a3f31d31eb3ac266bc9eb4f503a4e", "message": "Avoid NPE in Person::isMothballing\n\n- Sometimes a unit would be marked as mothballing but the tech would be\ncleared, leading to an NPE when checking\nif the IDs matched.\n- This switches the logic to only search\nthe units the person is tech'ing.", "committedDate": "2020-04-10T19:40:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkxMjY0MQ==", "url": "https://github.com/MegaMek/mekhq/pull/1656#discussion_r406912641", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (u != null && u.isMothballing()) {\n          \n          \n            \n                        if ((u != null) && u.isMothballing()) {", "author": "Windchild292", "createdAt": "2020-04-10T19:43:06Z", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -3635,8 +3635,9 @@ public boolean isMothballing() {\n         if (!isTech()) {\n             return false;\n         }\n-        for (Unit u : campaign.getUnits()) {\n-            if (u.isMothballing() && u.getTech().getId().equals(id)) {\n+        for (UUID unitId : techUnitIds) {\n+            Unit u = campaign.getUnit(unitId);\n+            if (u != null && u.isMothballing()) {", "originalCommit": "688d0583687a3f31d31eb3ac266bc9eb4f503a4e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1d88a13cdd087e7bc933e2dc60e3f6e0162fc43b", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/personnel/Person.java b/MekHQ/src/mekhq/campaign/personnel/Person.java\nindex 62a5576c7..aabc97579 100644\n--- a/MekHQ/src/mekhq/campaign/personnel/Person.java\n+++ b/MekHQ/src/mekhq/campaign/personnel/Person.java\n\n@@ -3637,7 +3637,7 @@ public class Person implements Serializable, MekHqXmlSerializable {\n         }\n         for (UUID unitId : techUnitIds) {\n             Unit u = campaign.getUnit(unitId);\n-            if (u != null && u.isMothballing()) {\n+            if ((u != null) && u.isMothballing()) {\n                 return true;\n             }\n         }\n"}}, {"oid": "1d88a13cdd087e7bc933e2dc60e3f6e0162fc43b", "url": "https://github.com/MegaMek/mekhq/commit/1d88a13cdd087e7bc933e2dc60e3f6e0162fc43b", "message": "Update MekHQ/src/mekhq/campaign/personnel/Person.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-10T19:48:26Z", "type": "commit"}]}