{"pr_number": 1490, "pr_title": "Ship Autoload ui fixes 2", "pr_createdAt": "2020-02-16T18:14:45Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1490", "timeline": [{"oid": "a18abdc1593efd2e511cf5a27e7c44fcdfbbcaeb", "url": "https://github.com/MegaMek/mekhq/commit/a18abdc1593efd2e511cf5a27e7c44fcdfbbcaeb", "message": "Set up static check for all units of same type", "committedDate": "2020-02-10T16:28:14Z", "type": "commit"}, {"oid": "4a5b02fded0a45946f41e20744a635746a701d7f", "url": "https://github.com/MegaMek/mekhq/commit/4a5b02fded0a45946f41e20744a635746a701d7f", "message": "Add weight check to areAllUnitsSameType", "committedDate": "2020-02-10T17:17:23Z", "type": "commit"}, {"oid": "fb5fd1a599f1d423cad3040388cd1101516d7406", "url": "https://github.com/MegaMek/mekhq/commit/fb5fd1a599f1d423cad3040388cd1101516d7406", "message": "WIP show bay capacity and restrict ship shown by selection", "committedDate": "2020-02-10T17:18:53Z", "type": "commit"}, {"oid": "f86b9285c25a20984bc83223c945b7290525b08c", "url": "https://github.com/MegaMek/mekhq/commit/f86b9285c25a20984bc83223c945b7290525b08c", "message": "Display current bay space by ship correctly", "committedDate": "2020-02-10T17:31:29Z", "type": "commit"}, {"oid": "fcecbf0a856926e11ad9f3b3e496ae2723d2b558", "url": "https://github.com/MegaMek/mekhq/commit/fcecbf0a856926e11ad9f3b3e496ae2723d2b558", "message": "Refresh forceViewPanel when transport assignment changes", "committedDate": "2020-02-11T17:17:26Z", "type": "commit"}, {"oid": "cfbf3fb7163c1a7c5621cd6d9a2b7187fe9d7f17", "url": "https://github.com/MegaMek/mekhq/commit/cfbf3fb7163c1a7c5621cd6d9a2b7187fe9d7f17", "message": "Set up single unit type menus", "committedDate": "2020-02-15T17:29:47Z", "type": "commit"}, {"oid": "e6482aff226892cb6eda0b18ec7c4cee188a66af", "url": "https://github.com/MegaMek/mekhq/commit/e6482aff226892cb6eda0b18ec7c4cee188a66af", "message": "Fix NPE and title update for single unit ship menu", "committedDate": "2020-02-15T17:49:20Z", "type": "commit"}, {"oid": "e061da0e0647970f8919f91975619cd9c187bf33", "url": "https://github.com/MegaMek/mekhq/commit/e061da0e0647970f8919f91975619cd9c187bf33", "message": "Fix single and group unit assign to ship menus", "committedDate": "2020-02-16T16:31:40Z", "type": "commit"}, {"oid": "fca8774d632d45d2b38096ce6c656e77b99f48b8", "url": "https://github.com/MegaMek/mekhq/commit/fca8774d632d45d2b38096ce6c656e77b99f48b8", "message": "Fix tank bay processing to handle support vees", "committedDate": "2020-02-16T18:05:14Z", "type": "commit"}, {"oid": "7078d3ee2f11bf7040423b11bc6cfd8c27d2ccf2", "url": "https://github.com/MegaMek/mekhq/commit/7078d3ee2f11bf7040423b11bc6cfd8c27d2ccf2", "message": "Fix bug preventing non-force infantry assignment to ships", "committedDate": "2020-02-16T18:11:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkyNDc2Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r379924762", "bodyText": "Why are you initializing this with a \"\" instead of just not including text?", "author": "Windchild292", "createdAt": "2020-02-16T18:54:57Z", "path": "MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java", "diffHunk": "@@ -1168,15 +1172,30 @@ private void maybeShowPopup(MouseEvent e) {\n                 JMenu i_trn = new JMenu(TOEMouseAdapter.INFANTRY_CARRIERS);\n                 JMenu a_trn = new JMenu(TOEMouseAdapter.ASF_CARRIERS);\n                 JMenu sc_trn = new JMenu(TOEMouseAdapter.SC_CARRIERS);\n+                JMenu singleUnitMenu = new JMenu(\"\");", "originalCommit": "7078d3ee2f11bf7040423b11bc6cfd8c27d2ccf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk0NTE2NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r379945165", "bodyText": "No reason...     Fixed.", "author": "mkerensky", "createdAt": "2020-02-16T23:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkyNDc2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "eca41edaa680b2d68d7e61fb5ebb5d52f0085182", "chunk": "diff --git a/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java b/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java\nindex 943b5de06..e5ce0a102 100644\n--- a/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java\n+++ b/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java\n\n@@ -1172,7 +1172,7 @@ public class TOEMouseAdapter extends MouseInputAdapter implements ActionListener\n                 JMenu i_trn = new JMenu(TOEMouseAdapter.INFANTRY_CARRIERS);\n                 JMenu a_trn = new JMenu(TOEMouseAdapter.ASF_CARRIERS);\n                 JMenu sc_trn = new JMenu(TOEMouseAdapter.SC_CARRIERS);\n-                JMenu singleUnitMenu = new JMenu(\"\");\n+                JMenu singleUnitMenu = new JMenu();\n                 \n                 if (unitsInForces.size() > 0) {\n                     Unit unit = unitsInForces.get(0);\n"}}, {"oid": "eca41edaa680b2d68d7e61fb5ebb5d52f0085182", "url": "https://github.com/MegaMek/mekhq/commit/eca41edaa680b2d68d7e61fb5ebb5d52f0085182", "message": "Remove unneeded quotes from JMenu text", "committedDate": "2020-02-16T23:53:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTQxMw==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382869413", "bodyText": "This should exit early if units is empty.", "author": "sixlettervariables", "createdAt": "2020-02-22T01:00:39Z", "path": "MekHQ/src/mekhq/gui/utilities/StaticChecks.java", "diffHunk": "@@ -405,6 +405,42 @@ public static boolean doAllUnitsHaveC3Master(Vector<Unit> units) {\n         return true;\n \n     }\n+    \n+    /**\n+     * Used to test a selection of Units provided by the player and determine whether they all share a designated unitType. \n+     * @param units Vector of units that the player has selected\n+     * @return false if any unit in the passed-in Vector does not have the specified unit type\n+     */\n+    public static boolean areAllUnitsSameType(Vector<Unit> units, int unitType) {\n+        // For our purposes, a selection of tanks isn't the same unless they're all the same weight class\n+        // Set this based on the first unit in the selection\n+        double firstUnitWeight = units.get(0).getEntity() != null ? units.get(0).getEntity().getWeight() : 0;", "originalCommit": "eca41edaa680b2d68d7e61fb5ebb5d52f0085182", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyNTYyMg==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382925622", "bodyText": "Fixed.  I thought I only called this in the first place after checking that in TOEMouseAdapter, but that is only done in one of two locations.", "author": "mkerensky", "createdAt": "2020-02-22T16:48:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTQxMw=="}], "type": "inlineReview", "revised_code": {"commit": "9c361f47a252c292ff8bdfe4d96a67aeaa37ae66", "chunk": "diff --git a/MekHQ/src/mekhq/gui/utilities/StaticChecks.java b/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\nindex eff809526..d7435accf 100644\n--- a/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\n+++ b/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\n\n@@ -412,6 +412,9 @@ public class StaticChecks {\n      * @return false if any unit in the passed-in Vector does not have the specified unit type\n      */\n     public static boolean areAllUnitsSameType(Vector<Unit> units, int unitType) {\n+        if (units.isEmpty()) {\n+            return false;\n+        }\n         // For our purposes, a selection of tanks isn't the same unless they're all the same weight class\n         // Set this based on the first unit in the selection\n         double firstUnitWeight = units.get(0).getEntity() != null ? units.get(0).getEntity().getWeight() : 0;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTUwMg==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382869502", "bodyText": "Is the > 0 necessary? Won't they all have at least some weight (if you have some unit).", "author": "sixlettervariables", "createdAt": "2020-02-22T01:01:18Z", "path": "MekHQ/src/mekhq/gui/utilities/StaticChecks.java", "diffHunk": "@@ -405,6 +405,42 @@ public static boolean doAllUnitsHaveC3Master(Vector<Unit> units) {\n         return true;\n \n     }\n+    \n+    /**\n+     * Used to test a selection of Units provided by the player and determine whether they all share a designated unitType. \n+     * @param units Vector of units that the player has selected\n+     * @return false if any unit in the passed-in Vector does not have the specified unit type\n+     */\n+    public static boolean areAllUnitsSameType(Vector<Unit> units, int unitType) {\n+        // For our purposes, a selection of tanks isn't the same unless they're all the same weight class\n+        // Set this based on the first unit in the selection\n+        double firstUnitWeight = units.get(0).getEntity() != null ? units.get(0).getEntity().getWeight() : 0;\n+        boolean light = firstUnitWeight > 0 && firstUnitWeight <= 50;", "originalCommit": "eca41edaa680b2d68d7e61fb5ebb5d52f0085182", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyNjQ1MA==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382926450", "bodyText": "Seemed like a good idea, in case we managed to get a botched unit with negative or 0 weight", "author": "mkerensky", "createdAt": "2020-02-22T17:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTUwMg=="}], "type": "inlineReview", "revised_code": {"commit": "9c361f47a252c292ff8bdfe4d96a67aeaa37ae66", "chunk": "diff --git a/MekHQ/src/mekhq/gui/utilities/StaticChecks.java b/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\nindex eff809526..d7435accf 100644\n--- a/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\n+++ b/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\n\n@@ -412,6 +412,9 @@ public class StaticChecks {\n      * @return false if any unit in the passed-in Vector does not have the specified unit type\n      */\n     public static boolean areAllUnitsSameType(Vector<Unit> units, int unitType) {\n+        if (units.isEmpty()) {\n+            return false;\n+        }\n         // For our purposes, a selection of tanks isn't the same unless they're all the same weight class\n         // Set this based on the first unit in the selection\n         double firstUnitWeight = units.get(0).getEntity() != null ? units.get(0).getEntity().getWeight() : 0;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTYwMg==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382869602", "bodyText": "Is there something > 200 for units?", "author": "sixlettervariables", "createdAt": "2020-02-22T01:01:57Z", "path": "MekHQ/src/mekhq/gui/utilities/StaticChecks.java", "diffHunk": "@@ -405,6 +405,42 @@ public static boolean doAllUnitsHaveC3Master(Vector<Unit> units) {\n         return true;\n \n     }\n+    \n+    /**\n+     * Used to test a selection of Units provided by the player and determine whether they all share a designated unitType. \n+     * @param units Vector of units that the player has selected\n+     * @return false if any unit in the passed-in Vector does not have the specified unit type\n+     */\n+    public static boolean areAllUnitsSameType(Vector<Unit> units, int unitType) {\n+        // For our purposes, a selection of tanks isn't the same unless they're all the same weight class\n+        // Set this based on the first unit in the selection\n+        double firstUnitWeight = units.get(0).getEntity() != null ? units.get(0).getEntity().getWeight() : 0;\n+        boolean light = firstUnitWeight > 0 && firstUnitWeight <= 50;\n+        boolean heavy = firstUnitWeight > 50 && firstUnitWeight <= 100;\n+        boolean superheavy = firstUnitWeight > 100 && firstUnitWeight <= 200;", "originalCommit": "eca41edaa680b2d68d7e61fb5ebb5d52f0085182", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyNDExMQ==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382924111", "bodyText": "There is not. I know you can construct such units, but the SH Vehicle bay only holds up to 200 tons - anything heavier is Cargo - so I think I'm ok here.", "author": "mkerensky", "createdAt": "2020-02-22T16:23:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTYwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyNDI4Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382924286", "bodyText": "There are a few examples, like the Koi and Ryu WiGE.", "author": "Windchild292", "createdAt": "2020-02-22T16:26:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTYwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyNDU3MQ==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382924571", "bodyText": "But mkerensky is correct that vehicles over 200 tons cannot be transported in a bay.", "author": "neoancient", "createdAt": "2020-02-22T16:31:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2OTYwMg=="}], "type": "inlineReview", "revised_code": {"commit": "9c361f47a252c292ff8bdfe4d96a67aeaa37ae66", "chunk": "diff --git a/MekHQ/src/mekhq/gui/utilities/StaticChecks.java b/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\nindex eff809526..d7435accf 100644\n--- a/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\n+++ b/MekHQ/src/mekhq/gui/utilities/StaticChecks.java\n\n@@ -412,6 +412,9 @@ public class StaticChecks {\n      * @return false if any unit in the passed-in Vector does not have the specified unit type\n      */\n     public static boolean areAllUnitsSameType(Vector<Unit> units, int unitType) {\n+        if (units.isEmpty()) {\n+            return false;\n+        }\n         // For our purposes, a selection of tanks isn't the same unless they're all the same weight class\n         // Set this based on the first unit in the selection\n         double firstUnitWeight = units.get(0).getEntity() != null ? units.get(0).getEntity().getWeight() : 0;\n"}}, {"oid": "3578abed33c886f0deefa48212cbe021106f0b3a", "url": "https://github.com/MegaMek/mekhq/commit/3578abed33c886f0deefa48212cbe021106f0b3a", "message": "Merge branch 'master' of https://github.com/megamek/mekhq into\nAutoload_UI_Fixes_2\n\nConflicts:\n\tMekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java", "committedDate": "2020-02-22T17:02:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyNzA3OA==", "url": "https://github.com/MegaMek/mekhq/pull/1490#discussion_r382927078", "bodyText": "This is superfluous with the for loop below. It'll do nothing if units is empty.", "author": "sixlettervariables", "createdAt": "2020-02-22T17:12:06Z", "path": "MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java", "diffHunk": "@@ -280,22 +281,27 @@ public void actionPerformed(ActionEvent action) {\n                             if (oldShip != null) {\n                                 oldShip.unloadFromTransportShip(u);\n                                 MekHQ.triggerEvent(new UnitChangedEvent(oldShip));\n+                                gui.getTOETab().refreshForceView();\n                             }\n                         }\n                     }\n                     //now load the units\n                     ship.loadTransportShip(units);\n                     MekHQ.triggerEvent(new UnitChangedEvent(ship));\n+                    gui.getTOETab().refreshForceView();\n                 }\n             }\n         }\n         if (command.contains(UNASSIGN_FROM_SHIP)) {\n-            for (Unit u : units) {\n-                for (UUID oldShipId : u.getTransportShipId().keySet()) {\n-                    Unit oldShip = gui.getCampaign().getUnit(oldShipId);\n-                    if (oldShip != null) {\n-                        oldShip.unloadFromTransportShip(u);\n-                        MekHQ.triggerEvent(new UnitChangedEvent(oldShip));\n+            if (!units.isEmpty()) {", "originalCommit": "3578abed33c886f0deefa48212cbe021106f0b3a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ec8445fcd102631efa12e82a469eb3836ff22ae2", "chunk": "diff --git a/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java b/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java\nindex e36319444..d25d3c2db 100644\n--- a/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java\n+++ b/MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java\n\n@@ -293,15 +293,13 @@ public class TOEMouseAdapter extends MouseInputAdapter implements ActionListener\n             }\n         }\n         if (command.contains(UNASSIGN_FROM_SHIP)) {\n-            if (!units.isEmpty()) {\n-                for (Unit u : units) {\n-                    for (UUID oldShipId : u.getTransportShipId().keySet()) {\n-                        Unit oldShip = gui.getCampaign().getUnit(oldShipId);\n-                        if (oldShip != null) {\n-                            oldShip.unloadFromTransportShip(u);\n-                            MekHQ.triggerEvent(new UnitChangedEvent(oldShip));\n-                            gui.getTOETab().refreshForceView();\n-                        }\n+            for (Unit u : units) {\n+                for (UUID oldShipId : u.getTransportShipId().keySet()) {\n+                    Unit oldShip = gui.getCampaign().getUnit(oldShipId);\n+                    if (oldShip != null) {\n+                       oldShip.unloadFromTransportShip(u);\n+                        MekHQ.triggerEvent(new UnitChangedEvent(oldShip));\n+                        gui.getTOETab().refreshForceView();\n                     }\n                 }\n             }\n"}}, {"oid": "ec8445fcd102631efa12e82a469eb3836ff22ae2", "url": "https://github.com/MegaMek/mekhq/commit/ec8445fcd102631efa12e82a469eb3836ff22ae2", "message": "Remove unneeded empty check", "committedDate": "2020-02-22T17:37:00Z", "type": "commit"}, {"oid": "9c361f47a252c292ff8bdfe4d96a67aeaa37ae66", "url": "https://github.com/MegaMek/mekhq/commit/9c361f47a252c292ff8bdfe4d96a67aeaa37ae66", "message": "Check for empty vector in sametypeunit", "committedDate": "2020-02-22T17:43:48Z", "type": "commit"}]}