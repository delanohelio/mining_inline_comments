{"pr_number": 2263, "pr_title": "2200: Moving Rank System Name to Data", "pr_createdAt": "2020-12-04T23:03:05Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2263", "timeline": [{"oid": "d770e67e26237234553967696e546ef4cd5e6c4a", "url": "https://github.com/MegaMek/mekhq/commit/d770e67e26237234553967696e546ef4cd5e6c4a", "message": "Moving ranks to their own folder", "committedDate": "2020-12-04T21:20:00Z", "type": "commit"}, {"oid": "198ea362215a2605015f13d5baf7a6f9a27e2323", "url": "https://github.com/MegaMek/mekhq/commit/198ea362215a2605015f13d5baf7a6f9a27e2323", "message": "Moving ranks system names to the Rank XML file", "committedDate": "2020-12-04T22:57:54Z", "type": "commit"}, {"oid": "875b9bde08ba7c0910c8ad45925cc1912afc0db9", "url": "https://github.com/MegaMek/mekhq/commit/875b9bde08ba7c0910c8ad45925cc1912afc0db9", "message": "Fixing unit test failures", "committedDate": "2020-12-05T05:29:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3OTA4MQ==", "url": "https://github.com/MegaMek/mekhq/pull/2263#discussion_r542779081", "bodyText": "Honestly I think we can delete this old migration and its associated code.\nThoughts @HammerGS @neoancient ?", "author": "sixlettervariables", "createdAt": "2020-12-14T20:59:31Z", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -1956,9 +1959,8 @@ public static Person generateInstanceFromXML(Node wn, Campaign c, Version versio\n                     retVal.gender = Gender.parseFromString(wn2.getTextContent().trim());\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"rank\")) {\n                     if (version.isLowerThan(\"0.3.4-r1782\")) {\n-                        RankTranslator rt = new RankTranslator(c);\n                         try {\n-                            retVal.rank = rt.getNewRank(c.getRanks().getOldRankSystem(),\n+                            retVal.rank = PersonMigrator.getNewRank(c, c.getRanks().getOldRankSystem(),\n                                     Integer.parseInt(wn2.getTextContent()));\n                         } catch (ArrayIndexOutOfBoundsException e) {\n                             // Do nothing", "originalCommit": "875b9bde08ba7c0910c8ad45925cc1912afc0db9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg3MzQ0OA==", "url": "https://github.com/MegaMek/mekhq/pull/2263#discussion_r542873448", "bodyText": "I agree. We might want to decide on a policy, but I would say anything older than the previous stable version can be considered obsolete.", "author": "neoancient", "createdAt": "2020-12-14T22:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3OTA4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "650c9d665e909f1e7c1ae57462ccda594ec80371", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/personnel/Person.java b/MekHQ/src/mekhq/campaign/personnel/Person.java\nindex fb306deb1..323bb7fa4 100644\n--- a/MekHQ/src/mekhq/campaign/personnel/Person.java\n+++ b/MekHQ/src/mekhq/campaign/personnel/Person.java\n\n@@ -1958,18 +1994,9 @@ public class Person implements Serializable, MekHqXmlSerializable {\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"gender\")) {\n                     retVal.gender = Gender.parseFromString(wn2.getTextContent().trim());\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"rank\")) {\n-                    if (version.isLowerThan(\"0.3.4-r1782\")) {\n-                        try {\n-                            retVal.rank = PersonMigrator.getNewRank(c, c.getRanks().getOldRankSystem(),\n-                                    Integer.parseInt(wn2.getTextContent()));\n-                        } catch (ArrayIndexOutOfBoundsException e) {\n-                            // Do nothing\n-                        }\n-                    } else {\n-                        retVal.rank = Integer.parseInt(wn2.getTextContent());\n-                    }\n+                    retVal.rank = Integer.parseInt(wn2.getTextContent().trim());\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"rankLevel\")) {\n-                    retVal.rankLevel = Integer.parseInt(wn2.getTextContent());\n+                    retVal.rankLevel = Integer.parseInt(wn2.getTextContent().trim());\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"rankSystem\")) {\n                     retVal.setRankSystem(Integer.parseInt(wn2.getTextContent()));\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"maneiDominiRank\")) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4MTA1Mg==", "url": "https://github.com/MegaMek/mekhq/pull/2263#discussion_r542781052", "bodyText": "Another spot where I think we can shed some oldancient migration code.", "author": "sixlettervariables", "createdAt": "2020-12-14T21:01:21Z", "path": "MekHQ/src/mekhq/campaign/personnel/ranks/Ranks.java", "diffHunk": "@@ -442,36 +403,47 @@ public static Ranks generateInstanceFromXML(Node wn, Version version) {\n             for (int x = 0; x < nl.getLength(); x++) {\n                 Node wn2 = nl.item(x);\n \n-                if (wn2.getNodeName().equalsIgnoreCase(\"system\") || wn2.getNodeName().equalsIgnoreCase(\"rankSystem\")) {\n-                    retVal.rankSystem = Integer.parseInt(wn2.getTextContent());\n+                if (wn2.getNodeName().equalsIgnoreCase(\"system\")\n+                        || wn2.getNodeName().equalsIgnoreCase(\"rankSystem\")) {\n+                    retVal.rankSystem = Integer.parseInt(wn2.getTextContent().trim());\n \n                     // If this is an older version from before the full blown rank system with\n                     // professions, we need to translate it to match the new constants\n-                    if (version != null && version.isLowerThan(\"0.3.4-r1782\")) {\n+                    if ((version != null) && version.isLowerThan(\"0.3.4-r1782\")) {", "originalCommit": "875b9bde08ba7c0910c8ad45925cc1912afc0db9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "650c9d665e909f1e7c1ae57462ccda594ec80371", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/personnel/ranks/Ranks.java b/MekHQ/src/mekhq/campaign/personnel/ranks/Ranks.java\nindex 3105c532e..9d48b9584 100644\n--- a/MekHQ/src/mekhq/campaign/personnel/ranks/Ranks.java\n+++ b/MekHQ/src/mekhq/campaign/personnel/ranks/Ranks.java\n\n@@ -407,25 +407,7 @@ public class Ranks {\n                         || wn2.getNodeName().equalsIgnoreCase(\"rankSystem\")) {\n                     retVal.rankSystem = Integer.parseInt(wn2.getTextContent().trim());\n \n-                    // If this is an older version from before the full blown rank system with\n-                    // professions, we need to translate it to match the new constants\n-                    if ((version != null) && version.isLowerThan(\"0.3.4-r1782\")) {\n-                        // Translate the rank system\n-                        if (retVal.rankSystem == 0) {\n-                            String change = (String) JOptionPane.showInputDialog(\n-                                    null,\n-                                    \"Due to an error in previous versions of MekHQ this value may not be correct.\"\n-                                            + \"\\nPlease select the correct rank system and click OK.\",\n-                                    \"Select Correct Rank System\",\n-                                    JOptionPane.QUESTION_MESSAGE,\n-                                    null,\n-                                    PersonMigrator.oldRankNames,\n-                                    PersonMigrator.oldRankNames[0]);\n-                            retVal.rankSystem = Arrays.asList(PersonMigrator.oldRankNames).indexOf(change);\n-                        }\n-                        retVal.oldRankSystem = retVal.rankSystem;\n-                        retVal.rankSystem = Ranks.translateFactions[retVal.rankSystem];\n-                    } else if ((version != null) && (retVal.rankSystem != RS_CUSTOM)) {\n+                    if ((version != null) && (retVal.rankSystem != RS_CUSTOM)) {\n                         retVal = Ranks.getRanksFromSystem(retVal.rankSystem);\n                     }\n \n"}}, {"oid": "abcac4a6acc61c8eb4aa26dd0d73c02498569851", "url": "https://github.com/MegaMek/mekhq/commit/abcac4a6acc61c8eb4aa26dd0d73c02498569851", "message": "Fixing merge conflicts", "committedDate": "2020-12-14T22:42:34Z", "type": "commit"}, {"oid": "650c9d665e909f1e7c1ae57462ccda594ec80371", "url": "https://github.com/MegaMek/mekhq/commit/650c9d665e909f1e7c1ae57462ccda594ec80371", "message": "Removing ancient migration code", "committedDate": "2020-12-14T22:49:07Z", "type": "commit"}]}