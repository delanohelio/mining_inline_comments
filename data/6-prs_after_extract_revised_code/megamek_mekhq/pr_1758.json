{"pr_number": 1758, "pr_title": "Planet acquisition fixes", "pr_createdAt": "2020-05-20T19:02:43Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1758", "timeline": [{"oid": "6b4f71357ccbb809eea7412a07e0759d016b7833", "url": "https://github.com/MegaMek/mekhq/commit/6b4f71357ccbb809eea7412a07e0759d016b7833", "message": "findContactForAcquisition returning false if no limit on number of acquisitions", "committedDate": "2020-05-20T15:50:17Z", "type": "commit"}, {"oid": "192dd80a65ffc77f69c10a1a789af0f30481410f", "url": "https://github.com/MegaMek/mekhq/commit/192dd80a65ffc77f69c10a1a789af0f30481410f", "message": "removed unnecessary reset of waiting time for parts with IAcquisitionWork interface. This is already dealt withi in Campaign.goShopping methods", "committedDate": "2020-05-20T18:00:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NDE1MQ==", "url": "https://github.com/MegaMek/mekhq/pull/1758#discussion_r428244151", "bodyText": "This was causing the method to return false when the user left max acquisitions at zero which is supposed to be unlimited. Using the canAcquireParts method instead fixes this because it already checks that properly.", "author": "AaronGullickson", "createdAt": "2020-05-20T19:04:17Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -2729,7 +2729,7 @@ public boolean canPayFor(IAcquisitionWork acquisition) {\n      * @return true if your target roll succeeded.\n      */\n     public boolean findContactForAcquisition(IAcquisitionWork acquisition, Person person, PlanetarySystem system) {\n-        if (person.getAcquisitions() >= getCampaignOptions().getMaxAcquisitions()) {\n+        if (null == person || !canAcquireParts(person)) {", "originalCommit": "192dd80a65ffc77f69c10a1a789af0f30481410f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI1MDk0Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1758#discussion_r428250942", "bodyText": "This is already checked in goShoppingByPlanet(ShoppingList), which is the only place this method is called. A null person is also not possible from the current path.", "author": "Windchild292", "createdAt": "2020-05-20T19:16:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NDE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMyNDkwMw==", "url": "https://github.com/MegaMek/mekhq/pull/1758#discussion_r428324903", "bodyText": "Good point. I have removed this entirely now as its redundant.", "author": "AaronGullickson", "createdAt": "2020-05-20T21:43:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NDE1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "52516c271d38f394cdc34c7c720d95af1dabc2aa", "chunk": "diff --git a/MekHQ/src/mekhq/campaign/Campaign.java b/MekHQ/src/mekhq/campaign/Campaign.java\nindex 60f37bd93..c765ed736 100644\n--- a/MekHQ/src/mekhq/campaign/Campaign.java\n+++ b/MekHQ/src/mekhq/campaign/Campaign.java\n\n@@ -2729,9 +2729,7 @@ public class Campaign implements Serializable, ITechManager {\n      * @return true if your target roll succeeded.\n      */\n     public boolean findContactForAcquisition(IAcquisitionWork acquisition, Person person, PlanetarySystem system) {\n-        if (null == person || !canAcquireParts(person)) {\n-            return false;\n-        }\n+\n         DateTime currentDate = Utilities.getDateTimeDay(getCalendar());\n         TargetRoll target = getTargetForAcquisition(acquisition, person, false);\n         target = system.getPrimaryPlanet().getAcquisitionMods(target, getDate(), getCampaignOptions(), getFaction(),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NTMwNw==", "url": "https://github.com/MegaMek/mekhq/pull/1758#discussion_r428245307", "bodyText": "The AmmoStorage, Armor, and Refit parts objects all add resetDaystoWait() to the failToFind method. However, this is redundant, because each of the Campaign.goShopping methods already does this reset at the proper place for all IAcquisitionWork. In this case, it was causing some issues with planetary acquisition because we don't want to reset that until we have failed to find stuff on all the planets on our list.", "author": "AaronGullickson", "createdAt": "2020-05-20T19:06:15Z", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -283,7 +283,6 @@ public Object getNewEquipment() {\n \n     @Override\n     public String failToFind() {\n-        resetDaysToWait();", "originalCommit": "192dd80a65ffc77f69c10a1a789af0f30481410f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "52516c271d38f394cdc34c7c720d95af1dabc2aa", "url": "https://github.com/MegaMek/mekhq/commit/52516c271d38f394cdc34c7c720d95af1dabc2aa", "message": "removed unnecessary check", "committedDate": "2020-05-20T21:42:19Z", "type": "commit"}]}