{"pr_number": 475, "pr_title": "[#353] Add tests to the neo4j quickstart", "pr_createdAt": "2020-02-25T14:56:25Z", "pr_url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475", "timeline": [{"oid": "31eb26e279ab0e72ea58cfe6ff584b3181163928", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/31eb26e279ab0e72ea58cfe6ff584b3181163928", "message": "Add tests to the neo4j quickstart\n\nSigned-off-by: Miguel Serra <Miguel.Serra@criticaltechworks.com>", "committedDate": "2020-02-25T14:55:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkzOTAxOA==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r383939018", "bodyText": "Would be great to also test the reactive API if possible.", "author": "cescoffier", "createdAt": "2020-02-25T15:09:26Z", "path": "neo4j-quickstart/src/test/java/org/acme/neo4j/FruitsEndpointTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package org.acme.neo4j;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.UnaryOperator;\n+import javax.ws.rs.core.HttpHeaders;\n+import javax.ws.rs.core.MediaType;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static io.restassured.RestAssured.given;\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.hamcrest.core.IsNot.not;\n+\n+@QuarkusTest\n+class FruitsEndpointTest  {\n+\n+    private static final Map<String, String> fruitIdMap = new HashMap<>();\n+    private static final UnaryOperator<String> FRUIT = fruit ->  String.format(\"{\\\"name\\\":\\\"%s\\\"}\", fruit);\n+\n+    @Test\n+    public void testResource() {", "originalCommit": "31eb26e279ab0e72ea58cfe6ff584b3181163928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0NjkwNQ==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r383946905", "bodyText": "I use it in line 60. Would it be better to create other test class? It doesn't have a persist method, so I did it in the same one", "author": "mcserra", "createdAt": "2020-02-25T15:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkzOTAxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0OTcxMA==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r383949710", "bodyText": "sorry, I didn't see it! that's great!", "author": "cescoffier", "createdAt": "2020-02-25T15:25:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkzOTAxOA=="}], "type": "inlineReview", "revised_code": {"commit": "2898daeafafa46d0063ffe1a6ad750cff93cac22", "chunk": "diff --git a/neo4j-quickstart/src/test/java/org/acme/neo4j/FruitsEndpointTest.java b/neo4j-quickstart/src/test/java/org/acme/neo4j/FruitsEndpointTest.java\nindex 7b2d1c4c..ef959ae6 100644\n--- a/neo4j-quickstart/src/test/java/org/acme/neo4j/FruitsEndpointTest.java\n+++ b/neo4j-quickstart/src/test/java/org/acme/neo4j/FruitsEndpointTest.java\n\n@@ -1,5 +1,6 @@\n package org.acme.neo4j;\n \n+import io.quarkus.test.common.QuarkusTestResource;\n import io.quarkus.test.junit.QuarkusTest;\n \n import java.util.Arrays;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxMDcwNQ==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r386010705", "bodyText": "The interest of test container combined with this approach is that you don't need to set up the exposed port. It will pick a random available port.", "author": "cescoffier", "createdAt": "2020-02-29T08:00:05Z", "path": "neo4j-quickstart/src/test/java/org/acme/neo4j/Neo4jResource.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.acme.neo4j;\n+\n+import io.quarkus.test.common.QuarkusTestResourceLifecycleManager;\n+\n+import com.github.dockerjava.api.model.ExposedPort;\n+import com.github.dockerjava.api.model.PortBinding;\n+import com.github.dockerjava.api.model.Ports;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+\n+import org.testcontainers.containers.Neo4jContainer;\n+\n+public class Neo4jResource implements QuarkusTestResourceLifecycleManager {\n+\n+    private final Neo4jContainer NEO4J = new Neo4jContainer<>(\"neo4j:4.0.0\").withAdminPassword(null)\n+        .withExposedPorts(7687)\n+        .withCreateContainerCmdModifier(cmd -> cmd\n+            .withHostName(\"localhost\")\n+            .getHostConfig().withPortBindings(new PortBinding(Ports.Binding.bindPort(7687), new ExposedPort(7687))));", "originalCommit": "c11737463318792b6baca4f3ff6498abb09e39ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxNjQzNQ==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r386016435", "bodyText": "I had a big problem to make it work with the native test, and found that solution. But I just tried it again without that and it worked, so I must have made a mistake...", "author": "mcserra", "createdAt": "2020-02-29T09:47:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxMDcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgzNTM4OQ==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r386835389", "bodyText": "@mcserra it used to be the case, however look at how the other QS uses the QuarkusTestResource, and then it works :-)", "author": "cescoffier", "createdAt": "2020-03-03T07:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxMDcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA4OTEyNg==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/475#discussion_r387089126", "bodyText": "Its pretty cool :) Is it ready then?", "author": "mcserra", "createdAt": "2020-03-03T15:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxMDcwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "2898daeafafa46d0063ffe1a6ad750cff93cac22", "chunk": "diff --git a/neo4j-quickstart/src/test/java/org/acme/neo4j/Neo4jResource.java b/neo4j-quickstart/src/test/java/org/acme/neo4j/Neo4jResource.java\nindex 93a5f3e1..b9e7fb8b 100644\n--- a/neo4j-quickstart/src/test/java/org/acme/neo4j/Neo4jResource.java\n+++ b/neo4j-quickstart/src/test/java/org/acme/neo4j/Neo4jResource.java\n\n@@ -13,11 +13,7 @@ import org.testcontainers.containers.Neo4jContainer;\n \n public class Neo4jResource implements QuarkusTestResourceLifecycleManager {\n \n-    private final Neo4jContainer NEO4J = new Neo4jContainer<>(\"neo4j:4.0.0\").withAdminPassword(null)\n-        .withExposedPorts(7687)\n-        .withCreateContainerCmdModifier(cmd -> cmd\n-            .withHostName(\"localhost\")\n-            .getHostConfig().withPortBindings(new PortBinding(Ports.Binding.bindPort(7687), new ExposedPort(7687))));\n+    final Neo4jContainer NEO4J = new Neo4jContainer<>(\"neo4j:4.0.0\").withAdminPassword(null);\n \n     @Override\n     public Map<String, String> start() {\n"}}, {"oid": "2898daeafafa46d0063ffe1a6ad750cff93cac22", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/2898daeafafa46d0063ffe1a6ad750cff93cac22", "message": "Add testcontainers\n\nSigned-off-by: Miguel Serra <Miguel.Serra@criticaltechworks.com>", "committedDate": "2020-02-29T09:45:35Z", "type": "forcePushed"}, {"oid": "0ed756362968080747a817ed603f367b48715f84", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/0ed756362968080747a817ed603f367b48715f84", "message": "Add testcontainers\n\nSigned-off-by: Miguel Serra <Miguel.Serra@criticaltechworks.com>", "committedDate": "2020-03-03T16:14:41Z", "type": "commit"}, {"oid": "0ed756362968080747a817ed603f367b48715f84", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/0ed756362968080747a817ed603f367b48715f84", "message": "Add testcontainers\n\nSigned-off-by: Miguel Serra <Miguel.Serra@criticaltechworks.com>", "committedDate": "2020-03-03T16:14:41Z", "type": "forcePushed"}]}