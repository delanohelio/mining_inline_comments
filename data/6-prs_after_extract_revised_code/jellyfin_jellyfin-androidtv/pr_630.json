{"pr_number": 630, "pr_title": "Add the ability to change the rating type shown on cards", "pr_createdAt": "2020-11-15T17:31:00Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/630", "timeline": [{"oid": "139a6ef59be59380b66ffc64807cd3ea1373d2f1", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/139a6ef59be59380b66ffc64807cd3ea1373d2f1", "message": "Add the ability to choose IMDb as the default rating provider", "committedDate": "2020-11-15T17:57:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0ODIxNA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/630#discussion_r524848214", "bodyText": "Looks like you could use holder here instead of casting repeatedly \ud83d\ude09 .", "author": "thornbill", "createdAt": "2020-11-17T02:41:07Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java", "diffHunk": "@@ -394,9 +398,17 @@ public void onBindViewHolder(Presenter.ViewHolder viewHolder, Object item) {\n             holder.mCardView.setPlayingIndicator(true);\n         } else {\n             holder.mCardView.setPlayingIndicator(false);\n-            Drawable badge = rowItem.getBadgeImage();\n-            if (badge != null) {\n-                ((ViewHolder) viewHolder).mCardView.setBadgeImage(badge);\n+\n+            if (get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) == RatingProvider.RATING_RT) {\n+                Drawable badge = rowItem.getBadgeImage();\n+                ((ViewHolder) viewHolder).mCardView.setRating(null);", "originalCommit": "139a6ef59be59380b66ffc64807cd3ea1373d2f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkwMjcxMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/630#discussion_r524902711", "bodyText": "ah yes. it appears I started with some copy pasta and rolled with it \ud83e\udd26\u200d\u2642\ufe0f", "author": "MrChip53", "createdAt": "2020-11-17T06:02:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0ODIxNA=="}], "type": "inlineReview", "revised_code": {"commit": "7550a0cb690fe8aa09b39a952fdcbd9f3d02108b", "chunk": "diff --git a/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java b/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java\nindex d78eeb4f..1cdcbdfd 100644\n--- a/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java\n+++ b/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java\n\n@@ -401,18 +401,18 @@ public class CardPresenter extends Presenter {\n \n             if (get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) == RatingProvider.RATING_RT) {\n                 Drawable badge = rowItem.getBadgeImage();\n-                ((ViewHolder) viewHolder).mCardView.setRating(null);\n+                holder.mCardView.setRating(null);\n                 if (badge != null) {\n-                    ((ViewHolder) viewHolder).mCardView.setBadgeImage(badge);\n+                    holder.mCardView.setBadgeImage(badge);\n                 }\n             } else if (get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) == RatingProvider.RATING_IMDB &&\n                     rowItem.getBaseItem() != null && rowItem.getBaseItem().getCommunityRating() != null) {\n-                    ((ViewHolder) viewHolder).mCardView.setBadgeImage(ContextCompat.getDrawable(viewHolder.view.getContext(), R.drawable.star));\n-                    ((ViewHolder) viewHolder).mCardView.setRating(rowItem.getBaseItem().getCommunityRating().toString());\n+                holder.mCardView.setBadgeImage(ContextCompat.getDrawable(viewHolder.view.getContext(), R.drawable.star));\n+                holder.mCardView.setRating(rowItem.getBaseItem().getCommunityRating().toString());\n             }\n         }\n \n-        ((ViewHolder) viewHolder).updateCardViewImage(rowItem.getImageUrl(mImageType, ((ViewHolder) viewHolder).getCardHeight()));\n+        holder.updateCardViewImage(rowItem.getImageUrl(mImageType, holder.getCardHeight()));\n     }\n \n     @Override\n"}}, {"oid": "7550a0cb690fe8aa09b39a952fdcbd9f3d02108b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/7550a0cb690fe8aa09b39a952fdcbd9f3d02108b", "message": "Add the ability to choose IMDb as the default rating provider", "committedDate": "2020-11-17T06:33:06Z", "type": "forcePushed"}, {"oid": "373acc8958f6f267f6d4d2e59422936f1cf20dcb", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/373acc8958f6f267f6d4d2e59422936f1cf20dcb", "message": "Change strings to be more provider agnostic", "committedDate": "2020-11-28T15:24:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU5NzM3OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/630#discussion_r543597378", "bodyText": "I think the code will be more readable if the result of the get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) part is moved to a variable before the if statement.", "author": "nielsvanvelzen", "createdAt": "2020-12-15T18:47:24Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java", "diffHunk": "@@ -394,13 +398,21 @@ public void onBindViewHolder(Presenter.ViewHolder viewHolder, Object item) {\n             holder.mCardView.setPlayingIndicator(true);\n         } else {\n             holder.mCardView.setPlayingIndicator(false);\n-            Drawable badge = rowItem.getBadgeImage();\n-            if (badge != null) {\n-                ((ViewHolder) viewHolder).mCardView.setBadgeImage(badge);\n+\n+            if (get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) == RatingProvider.RATING_TOMATOES) {", "originalCommit": "373acc8958f6f267f6d4d2e59422936f1cf20dcb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12fc12f124226350569a539aa76041dbbb79d0de", "chunk": "diff --git a/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java b/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java\nindex 114be288..c4ba5999 100644\n--- a/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java\n+++ b/app/src/main/java/org/jellyfin/androidtv/ui/presentation/CardPresenter.java\n\n@@ -399,13 +379,14 @@ public class CardPresenter extends Presenter {\n         } else {\n             holder.mCardView.setPlayingIndicator(false);\n \n-            if (get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) == RatingProvider.RATING_TOMATOES) {\n+            RatingType ratingType = get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingType());\n+            if (ratingType == RatingType.RATING_TOMATOES) {\n                 Drawable badge = rowItem.getBadgeImage();\n                 holder.mCardView.setRating(null);\n                 if (badge != null) {\n                     holder.mCardView.setBadgeImage(badge);\n                 }\n-            } else if (get(UserPreferences.class).get(UserPreferences.Companion.getDefaultRatingProvider()) == RatingProvider.RATING_STARS &&\n+            } else if (ratingType == RatingType.RATING_STARS &&\n                     rowItem.getBaseItem() != null && rowItem.getBaseItem().getCommunityRating() != null) {\n                 holder.mCardView.setBadgeImage(ContextCompat.getDrawable(viewHolder.view.getContext(), R.drawable.ic_star));\n                 holder.mCardView.setRating(rowItem.getBaseItem().getCommunityRating().toString());\n"}}, {"oid": "12fc12f124226350569a539aa76041dbbb79d0de", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/12fc12f124226350569a539aa76041dbbb79d0de", "message": "Add the ability to change the default rating type displayed on cards", "committedDate": "2020-12-17T04:24:22Z", "type": "commit"}, {"oid": "12fc12f124226350569a539aa76041dbbb79d0de", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/12fc12f124226350569a539aa76041dbbb79d0de", "message": "Add the ability to change the default rating type displayed on cards", "committedDate": "2020-12-17T04:24:22Z", "type": "forcePushed"}]}