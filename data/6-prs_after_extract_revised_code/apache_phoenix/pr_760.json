{"pr_number": 760, "pr_title": "PHOENIX-5840: IndexTool inline verification should not fail with -v O\u2026", "pr_createdAt": "2020-04-14T20:20:33Z", "pr_url": "https://github.com/apache/phoenix/pull/760", "timeline": [{"oid": "bfc61424c737f70fbefcc429db2f54bfedcf145e", "url": "https://github.com/apache/phoenix/commit/bfc61424c737f70fbefcc429db2f54bfedcf145e", "message": "PHOENIX-5840: IndexTool inline verification should not fail with -v ONLY option", "committedDate": "2020-04-14T23:15:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUxMjMyMA==", "url": "https://github.com/apache/phoenix/pull/760#discussion_r408512320", "bodyText": "I suggest the following instead of above\npublic boolean isVerificationFailed() {\nif (getAfter().getInvalidIndexRowCount() + getAfter().getMissingIndexRowCount() +\nafter.getBeyondMaxLookBackInvalidIndexRowCount() + after.getBeyondMaxLookBackMissingIndexRowCount() > 0) {\nreturn true;\n}\nreturn false;\n}", "author": "kadirozde", "createdAt": "2020-04-15T00:28:53Z", "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexToolVerificationResult.java", "diffHunk": "@@ -413,13 +413,8 @@ public void update(Cell cell) {\n     }\n \n     public boolean isVerificationFailed(IndexTool.IndexVerifyType verifyType) {\n-        if (verifyType == IndexTool.IndexVerifyType.BEFORE || verifyType == IndexTool.IndexVerifyType.NONE) {\n+        if (verifyType == IndexTool.IndexVerifyType.BEFORE || verifyType == IndexTool.IndexVerifyType.NONE || verifyType == IndexTool.IndexVerifyType.ONLY) {\n             return false;\n-        } else if (verifyType == IndexTool.IndexVerifyType.ONLY) {\n-            if (getBefore().getInvalidIndexRowCount() + getBefore().getMissingIndexRowCount() +\n-                before.getBeyondMaxLookBackInvalidIndexRowCount() + before.getBeyondMaxLookBackMissingIndexRowCount() > 0) {\n-                return true;\n-            }\n         } else if (verifyType == IndexTool.IndexVerifyType.BOTH || verifyType == IndexTool.IndexVerifyType.AFTER) {", "originalCommit": "bfc61424c737f70fbefcc429db2f54bfedcf145e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUxMzQ2NA==", "url": "https://github.com/apache/phoenix/pull/760#discussion_r408513464", "bodyText": "nice, however, we ll still need a check on \"both\" and \"after\"", "author": "swaroopak", "createdAt": "2020-04-15T00:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUxMjMyMA=="}], "type": "inlineReview", "revised_code": {"commit": "136105df6cb391a11a4021eb58195132d299619a", "chunk": "diff --git a/phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexToolVerificationResult.java b/phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexToolVerificationResult.java\nindex 85c3d1b5c..3299ed610 100644\n--- a/phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexToolVerificationResult.java\n+++ b/phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexToolVerificationResult.java\n\n@@ -412,14 +412,10 @@ public class IndexToolVerificationResult {\n         }\n     }\n \n-    public boolean isVerificationFailed(IndexTool.IndexVerifyType verifyType) {\n-        if (verifyType == IndexTool.IndexVerifyType.BEFORE || verifyType == IndexTool.IndexVerifyType.NONE || verifyType == IndexTool.IndexVerifyType.ONLY) {\n-            return false;\n-        } else if (verifyType == IndexTool.IndexVerifyType.BOTH || verifyType == IndexTool.IndexVerifyType.AFTER) {\n-            if (getAfter().getInvalidIndexRowCount() + getAfter().getMissingIndexRowCount() +\n-                after.getBeyondMaxLookBackInvalidIndexRowCount() + after.getBeyondMaxLookBackMissingIndexRowCount() > 0) {\n-                return true;\n-            }\n+    public boolean isVerificationFailed() {\n+        if (getAfter().getInvalidIndexRowCount() + getAfter().getMissingIndexRowCount() +\n+                getAfter().getBeyondMaxLookBackInvalidIndexRowCount() + getAfter().getBeyondMaxLookBackMissingIndexRowCount() > 0) {\n+            return true;\n         }\n         return false;\n     }\n"}}, {"oid": "136105df6cb391a11a4021eb58195132d299619a", "url": "https://github.com/apache/phoenix/commit/136105df6cb391a11a4021eb58195132d299619a", "message": "PHOENIX-5840: IndexTool inline verification should not fail with -v ONLY option", "committedDate": "2020-04-15T17:21:56Z", "type": "forcePushed"}, {"oid": "ba9618f482f0db2de8cb83acae32b4204c15ab60", "url": "https://github.com/apache/phoenix/commit/ba9618f482f0db2de8cb83acae32b4204c15ab60", "message": "PHOENIX-5840: IndexTool inline verification should not fail with -v ONLY option", "committedDate": "2020-04-15T19:05:33Z", "type": "commit"}, {"oid": "ba9618f482f0db2de8cb83acae32b4204c15ab60", "url": "https://github.com/apache/phoenix/commit/ba9618f482f0db2de8cb83acae32b4204c15ab60", "message": "PHOENIX-5840: IndexTool inline verification should not fail with -v ONLY option", "committedDate": "2020-04-15T19:05:33Z", "type": "forcePushed"}]}