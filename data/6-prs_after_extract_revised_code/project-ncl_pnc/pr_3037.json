{"pr_number": 3037, "pr_title": "[NCL-5701] - Port tests to RestResponseFormattingTest", "pr_createdAt": "2020-05-12T16:45:56Z", "pr_url": "https://github.com/project-ncl/pnc/pull/3037", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMyODUzNw==", "url": "https://github.com/project-ncl/pnc/pull/3037#discussion_r424328537", "bodyText": "Please extract the common API path to constant. It will change in the future.", "author": "janinko", "createdAt": "2020-05-13T10:15:53Z", "path": "integration-test/src/test/java/org/jboss/pnc/integration_new/RestResponseFormattingTest.java", "diffHunk": "@@ -78,24 +58,23 @@ public void shouldReturnErrorInJsonFormat() {\n                 .statusCode(Response.Status.INTERNAL_SERVER_ERROR.getStatusCode())\n                 .body(\"errorMessage\", IsEqual.equalTo(\"Test exception.\"))\n                 .when()\n-                .get(\"/pnc-rest/rest/test/throw\")\n+                .get(\"/pnc-rest-new/rest-new/debug/throw\")", "originalCommit": "6d839d15c1c980fdebe188a11d8b866b0469fcd8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f9790936eee4239d6ecfad9b865ce2d83c02c39a", "chunk": "diff --git a/integration-test/src/test/java/org/jboss/pnc/integration_new/RestResponseFormattingTest.java b/integration-test/src/test/java/org/jboss/pnc/integration_new/RestResponseFormattingTest.java\nindex 0b4c5b6da..84165a0be 100644\n--- a/integration-test/src/test/java/org/jboss/pnc/integration_new/RestResponseFormattingTest.java\n+++ b/integration-test/src/test/java/org/jboss/pnc/integration_new/RestResponseFormattingTest.java\n\n@@ -58,7 +61,7 @@ public class RestResponseFormattingTest {\n                 .statusCode(Response.Status.INTERNAL_SERVER_ERROR.getStatusCode())\n                 .body(\"errorMessage\", IsEqual.equalTo(\"Test exception.\"))\n                 .when()\n-                .get(\"/pnc-rest-new/rest-new/debug/throw\")\n+                .get(BASE_PATH + \"/debug/throw\")\n                 .asString();\n         logger.info(response);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMzMzMxOA==", "url": "https://github.com/project-ncl/pnc/pull/3037#discussion_r424333318", "bodyText": "you build a response here but then do nothing with it.\nFrom JAX-RS specification\n\n3.3.3 Return Type\nvoid Results in an empty entity body with a 204 status code.\n\nSo Having just empty method will do the works.", "author": "janinko", "createdAt": "2020-05-13T10:24:49Z", "path": "rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java", "diffHunk": "@@ -75,4 +78,23 @@ public static Build newBuild() {\n                 .temporaryBuild(true)\n                 .build();\n     }\n+\n+    @Override\n+    public void throwEx() throws Exception {\n+        RuntimeException nested = new RuntimeException(\"Root exception.\");\n+        throw new Exception(\"Test exception.\", nested);\n+    }\n+\n+    @Override\n+    public void nocontent() throws Exception {\n+        Response.status(Response.Status.NO_CONTENT).build();", "originalCommit": "6d839d15c1c980fdebe188a11d8b866b0469fcd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1MDA4Nw==", "url": "https://github.com/project-ncl/pnc/pull/3037#discussion_r424450087", "bodyText": "thanks!", "author": "vibe13", "createdAt": "2020-05-13T13:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMzMzMxOA=="}], "type": "inlineReview", "revised_code": {"commit": "f9790936eee4239d6ecfad9b865ce2d83c02c39a", "chunk": "diff --git a/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java b/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java\nindex 6e8984bd0..6f186e9b6 100644\n--- a/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java\n+++ b/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java\n\n@@ -87,13 +87,13 @@ public class DebugEndpointImpl implements DebugEndpoint {\n \n     @Override\n     public void nocontent() throws Exception {\n-        Response.status(Response.Status.NO_CONTENT).build();\n+        // void Results in an empty entity body with a 204 status code.\n     }\n \n     @Override\n-    public void redirect() throws Exception {\n-        Response.status(Response.Status.UNAUTHORIZED)\n-                .header(HttpHeaders.WWW_AUTHENTICATE, \"Basic realm=\\\"ApplicationRealm\\\"\")\n+    public Response redirect() throws Exception {\n+        return Response.status(Response.Status.UNAUTHORIZED)\n+                .header(HttpHeaders.WWW_AUTHENTICATE, \"Basic realm=\\\"debug\\\"\")\n                 .build();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMzNDQ5OQ==", "url": "https://github.com/project-ncl/pnc/pull/3037#discussion_r424334499", "bodyText": "How can this work? You build a repsoinse but then don't use it anywhere.", "author": "janinko", "createdAt": "2020-05-13T10:26:58Z", "path": "rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java", "diffHunk": "@@ -75,4 +78,23 @@ public static Build newBuild() {\n                 .temporaryBuild(true)\n                 .build();\n     }\n+\n+    @Override\n+    public void throwEx() throws Exception {\n+        RuntimeException nested = new RuntimeException(\"Root exception.\");\n+        throw new Exception(\"Test exception.\", nested);\n+    }\n+\n+    @Override\n+    public void nocontent() throws Exception {\n+        Response.status(Response.Status.NO_CONTENT).build();\n+    }\n+\n+    @Override\n+    public void redirect() throws Exception {\n+        Response.status(Response.Status.UNAUTHORIZED)\n+                .header(HttpHeaders.WWW_AUTHENTICATE, \"Basic realm=\\\"ApplicationRealm\\\"\")\n+                .build();", "originalCommit": "6d839d15c1c980fdebe188a11d8b866b0469fcd8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f9790936eee4239d6ecfad9b865ce2d83c02c39a", "chunk": "diff --git a/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java b/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java\nindex 6e8984bd0..6f186e9b6 100644\n--- a/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java\n+++ b/rest-new/src/main/java/org/jboss/pnc/rest/endpoints/internal/DebugEndpointImpl.java\n\n@@ -87,13 +87,13 @@ public class DebugEndpointImpl implements DebugEndpoint {\n \n     @Override\n     public void nocontent() throws Exception {\n-        Response.status(Response.Status.NO_CONTENT).build();\n+        // void Results in an empty entity body with a 204 status code.\n     }\n \n     @Override\n-    public void redirect() throws Exception {\n-        Response.status(Response.Status.UNAUTHORIZED)\n-                .header(HttpHeaders.WWW_AUTHENTICATE, \"Basic realm=\\\"ApplicationRealm\\\"\")\n+    public Response redirect() throws Exception {\n+        return Response.status(Response.Status.UNAUTHORIZED)\n+                .header(HttpHeaders.WWW_AUTHENTICATE, \"Basic realm=\\\"debug\\\"\")\n                 .build();\n     }\n \n"}}, {"oid": "4ceaaad42b53fe92b2987378c6911c20ebf64c8c", "url": "https://github.com/project-ncl/pnc/commit/4ceaaad42b53fe92b2987378c6911c20ebf64c8c", "message": "[NCL-5701] - Port tests to RestResponseFormattingTest", "committedDate": "2020-05-13T10:46:21Z", "type": "commit"}, {"oid": "f9790936eee4239d6ecfad9b865ce2d83c02c39a", "url": "https://github.com/project-ncl/pnc/commit/f9790936eee4239d6ecfad9b865ce2d83c02c39a", "message": "Fixes after review", "committedDate": "2020-05-13T14:17:57Z", "type": "commit"}, {"oid": "f9790936eee4239d6ecfad9b865ce2d83c02c39a", "url": "https://github.com/project-ncl/pnc/commit/f9790936eee4239d6ecfad9b865ce2d83c02c39a", "message": "Fixes after review", "committedDate": "2020-05-13T14:17:57Z", "type": "forcePushed"}]}