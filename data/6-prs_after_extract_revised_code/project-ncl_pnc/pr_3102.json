{"pr_number": 3102, "pr_title": "[NCL-5777] add a validation for scm repo with http/https only: should\u2026", "pr_createdAt": "2020-06-16T12:51:01Z", "pr_url": "https://github.com/project-ncl/pnc/pull/3102", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3MDA0NA==", "url": "https://github.com/project-ncl/pnc/pull/3102#discussion_r441070044", "bodyText": "In some specific cases, you may want to also add the port if specified in the url.", "author": "thescouser89", "createdAt": "2020-06-16T18:48:57Z", "path": "facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java", "diffHunk": "@@ -160,7 +162,16 @@ public RepositoryCreationResponse createSCMRepository(\n                         + preBuildSyncEnabled + \")\");\n         if (StringUtils.isEmpty(scmUrl))\n             throw new InvalidEntityException(\"You must specify the SCM URL.\");\n-\n+        if (scmUrl.startsWith(\"http\") || scmUrl.startsWith(\"https\")) {\n+            try {\n+                URL url = new URL(scmUrl);\n+                if (url.getProtocol().equals(\"http\") || url.getProtocol().equals(\"https\")) {\n+                    scmUrl = \"git+http://\" + url.getHost() + url.getFile();", "originalCommit": "d1e68eeb1b6167fec300124b766608d7086464d3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6729f1a7fe42efdb97730886871081e4f0b9b3e4", "chunk": "diff --git a/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java b/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\nindex 096a82cf0..ec2314dda 100644\n--- a/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\n+++ b/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\n\n@@ -166,7 +166,13 @@ public class SCMRepositoryProviderImpl\n             try {\n                 URL url = new URL(scmUrl);\n                 if (url.getProtocol().equals(\"http\") || url.getProtocol().equals(\"https\")) {\n-                    scmUrl = \"git+http://\" + url.getHost() + url.getFile();\n+                    StringBuilder stringBuilder = new StringBuilder(\"git+http://\");\n+                    stringBuilder.append(url.getHost());\n+                    if (url.getPort() != -1) {\n+                        stringBuilder.append(\":\" + url.getPort());\n+                    }\n+                    stringBuilder.append(url.getFile());\n+                    scmUrl = stringBuilder.toString();\n                 }\n             } catch (MalformedURLException e) {\n                 throw new InvalidEntityException(\"URL is malformed.\" + e.getMessage());\n"}}, {"oid": "6729f1a7fe42efdb97730886871081e4f0b9b3e4", "url": "https://github.com/project-ncl/pnc/commit/6729f1a7fe42efdb97730886871081e4f0b9b3e4", "message": "[NCL-5777] add a validation for scm repo with http/https only: should be git+http", "committedDate": "2020-06-17T08:45:37Z", "type": "commit"}, {"oid": "6729f1a7fe42efdb97730886871081e4f0b9b3e4", "url": "https://github.com/project-ncl/pnc/commit/6729f1a7fe42efdb97730886871081e4f0b9b3e4", "message": "[NCL-5777] add a validation for scm repo with http/https only: should be git+http", "committedDate": "2020-06-17T08:45:37Z", "type": "forcePushed"}]}