{"pr_number": 3300, "pr_title": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "pr_createdAt": "2020-09-11T10:07:18Z", "pr_url": "https://github.com/project-ncl/pnc/pull/3300", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkzMjI1OA==", "url": "https://github.com/project-ncl/pnc/pull/3300#discussion_r491932258", "bodyText": "I'd Override the validateBeforeUpdating method and move this line there.", "author": "michalovjan", "createdAt": "2020-09-21T10:15:24Z", "path": "facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java", "diffHunk": "@@ -190,6 +190,7 @@ public SCMRepository update(String id, SCMRepository restEntity) {\n         if (!before.getInternalUrl().equals(restEntity.getInternalUrl())) {\n             throw new InvalidEntityException(\"Updating internal URL is prohibited. SCMRepo: \" + id);\n         }\n+        validateRepositoryWithExternalURLDoesNotExist(restEntity.getExternalUrl());", "originalCommit": "21a7175cd8dedad2a7c32239952100e3e02105a5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8b193f8d60bdedcf9bc52883e2bd5eac152b53a0", "chunk": "diff --git a/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java b/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\nindex bb13b86d1..cc6fe2a3b 100644\n--- a/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\n+++ b/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\n\n@@ -190,12 +190,17 @@ public class SCMRepositoryProviderImpl\n         if (!before.getInternalUrl().equals(restEntity.getInternalUrl())) {\n             throw new InvalidEntityException(\"Updating internal URL is prohibited. SCMRepo: \" + id);\n         }\n-        validateRepositoryWithExternalURLDoesNotExist(restEntity.getExternalUrl());\n         log.debug(\"Updating entity: \" + restEntity.toString());\n         RepositoryConfiguration saved = repository.save(mapper.toEntity(restEntity));\n         return mapper.toDTO(saved);\n     }\n \n+    @Override\n+    public void validateBeforeUpdating(String id, SCMRepository restEntity){\n+        super.validateBeforeUpdating(id, restEntity);\n+        validateRepositoryWithInternalURLDoesNotExist(restEntity.getExternalUrl());\n+    }\n+\n     public SCMRepository createSCMRepositoryFromValues(\n             String externalScmUrl,\n             String internalScmUrl,\n"}}, {"oid": "8b193f8d60bdedcf9bc52883e2bd5eac152b53a0", "url": "https://github.com/project-ncl/pnc/commit/8b193f8d60bdedcf9bc52883e2bd5eac152b53a0", "message": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "committedDate": "2020-09-21T12:18:03Z", "type": "forcePushed"}, {"oid": "ff3534986bce0b3c0a1ac16b14c9a5b2b35d3bfc", "url": "https://github.com/project-ncl/pnc/commit/ff3534986bce0b3c0a1ac16b14c9a5b2b35d3bfc", "message": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "committedDate": "2020-09-21T12:30:52Z", "type": "forcePushed"}, {"oid": "b706a9b2fefd9aaaa3c5671cabdad873a0b66633", "url": "https://github.com/project-ncl/pnc/commit/b706a9b2fefd9aaaa3c5671cabdad873a0b66633", "message": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "committedDate": "2020-09-21T13:24:49Z", "type": "forcePushed"}, {"oid": "e05fd50d9e4723d31eb334a4f9b68cf93f1cc6d2", "url": "https://github.com/project-ncl/pnc/commit/e05fd50d9e4723d31eb334a4f9b68cf93f1cc6d2", "message": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "committedDate": "2020-09-22T07:46:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU0ODU3Mg==", "url": "https://github.com/project-ncl/pnc/pull/3300#discussion_r492548572", "bodyText": "You can just delete this method now :D No need to override. The update from AbstractProvider is the same after all now.", "author": "michalovjan", "createdAt": "2020-09-22T08:10:44Z", "path": "facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java", "diffHunk": "@@ -186,13 +186,21 @@ public RepositoryCreationResponse createSCMRepository(\n     @Override\n     public SCMRepository update(String id, SCMRepository restEntity) {", "originalCommit": "e05fd50d9e4723d31eb334a4f9b68cf93f1cc6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "295f3bbde8d2eaae3f3ef94beb63541687363e23", "chunk": "diff --git a/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java b/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\nindex 81f9a6773..43644c539 100644\n--- a/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\n+++ b/facade/src/main/java/org/jboss/pnc/facade/providers/SCMRepositoryProviderImpl.java\n\n@@ -183,14 +183,6 @@ public class SCMRepositoryProviderImpl\n         }\n     }\n \n-    @Override\n-    public SCMRepository update(String id, SCMRepository restEntity) {\n-        validateBeforeUpdating(id, restEntity);\n-        log.debug(\"Updating entity: \" + restEntity.toString());\n-        RepositoryConfiguration saved = repository.save(mapper.toEntity(restEntity));\n-        return mapper.toDTO(saved);\n-    }\n-\n     @Override\n     public void validateBeforeUpdating(String id, SCMRepository restEntity) {\n         super.validateBeforeUpdating(id, restEntity);\n"}}, {"oid": "295f3bbde8d2eaae3f3ef94beb63541687363e23", "url": "https://github.com/project-ncl/pnc/commit/295f3bbde8d2eaae3f3ef94beb63541687363e23", "message": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "committedDate": "2020-09-22T08:17:08Z", "type": "commit"}, {"oid": "295f3bbde8d2eaae3f3ef94beb63541687363e23", "url": "https://github.com/project-ncl/pnc/commit/295f3bbde8d2eaae3f3ef94beb63541687363e23", "message": "[NCL-6016] Validate ExternalUrl does not exist when updating SCMR", "committedDate": "2020-09-22T08:17:08Z", "type": "forcePushed"}]}