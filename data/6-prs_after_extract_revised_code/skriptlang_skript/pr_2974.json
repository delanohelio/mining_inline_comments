{"pr_number": 2974, "pr_title": "Gamerule Expression", "pr_createdAt": "2020-05-09T21:31:55Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/2974", "timeline": [{"oid": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "url": "https://github.com/SkriptLang/Skript/commit/07b21f94094f2722fc0ed12f435c85fc506f2aa2", "message": "Gamerule Expression", "committedDate": "2020-05-09T21:23:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU2MjU3Mw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422562573", "bodyText": "As APickledWalrus said, we should be created a type rather than using strings.", "author": "ShaneBeee", "createdAt": "2020-05-10T00:05:14Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Game Rule\")\n+@Description(\"The gamerule of a world.\")\n+@Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n+@Since(\"2.5\")\n+public class ExprGameRule extends SimpleExpression<Object> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n+\t\t\t\"[the] game[ ]rule %string% of %world%\");", "originalCommit": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU2MjY0NQ==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422562645", "bodyText": "Also on this, it should take in multiple worlds, not just one.", "author": "ShaneBeee", "createdAt": "2020-05-10T00:06:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU2MjU3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "092326a427e153ed15963434210cb4c358ce7a86", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex 3341cdf1..3a27fb66 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -32,30 +32,31 @@ import ch.njol.skript.doc.Name;\n import ch.njol.skript.doc.Since;\n import ch.njol.skript.lang.Expression;\n import ch.njol.skript.lang.ExpressionType;\n-import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n import ch.njol.util.Kleenean;\n import ch.njol.util.coll.CollectionUtils;\n \n-@Name(\"Game Rule\")\n-@Description(\"The gamerule of a world.\")\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n @Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n-@Since(\"2.5\")\n-public class ExprGameRule extends SimpleExpression<Object> {\n+@Since(\"INSERT VERSION\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n \t\n \tstatic {\n-\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n-\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n \t}\n \t\n \t@SuppressWarnings(\"null\")\n-\tprivate Expression<String> gamerule;\n+\tprivate Expression<GameRule> gamerule;\n \t@SuppressWarnings(\"null\")\n \tprivate Expression<World> world;\n \t\n \t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n-\t\tgamerule = (Expression<String>) exprs[0];\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n \t\tworld = (Expression<World>) exprs[1];\n \t\treturn true;\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU2MjYxNQ==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422562615", "bodyText": "Anytime we create new things for Skript, we use \"INSERT VERSION\" .... this will be changed later when we release.", "author": "ShaneBeee", "createdAt": "2020-05-10T00:05:41Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Game Rule\")\n+@Description(\"The gamerule of a world.\")\n+@Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n+@Since(\"2.5\")", "originalCommit": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "092326a427e153ed15963434210cb4c358ce7a86", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex 3341cdf1..3a27fb66 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -32,30 +32,31 @@ import ch.njol.skript.doc.Name;\n import ch.njol.skript.doc.Since;\n import ch.njol.skript.lang.Expression;\n import ch.njol.skript.lang.ExpressionType;\n-import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n import ch.njol.util.Kleenean;\n import ch.njol.util.coll.CollectionUtils;\n \n-@Name(\"Game Rule\")\n-@Description(\"The gamerule of a world.\")\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n @Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n-@Since(\"2.5\")\n-public class ExprGameRule extends SimpleExpression<Object> {\n+@Since(\"INSERT VERSION\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n \t\n \tstatic {\n-\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n-\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n \t}\n \t\n \t@SuppressWarnings(\"null\")\n-\tprivate Expression<String> gamerule;\n+\tprivate Expression<GameRule> gamerule;\n \t@SuppressWarnings(\"null\")\n \tprivate Expression<World> world;\n \t\n \t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n-\t\tgamerule = (Expression<String>) exprs[0];\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n \t\tworld = (Expression<World>) exprs[1];\n \t\treturn true;\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU2MzE5Mw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422563193", "bodyText": "To keep consistency, this should be Gamerule not Game Rule", "author": "ShaneBeee", "createdAt": "2020-05-10T00:13:22Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Game Rule\")", "originalCommit": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "092326a427e153ed15963434210cb4c358ce7a86", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex 3341cdf1..3a27fb66 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -32,30 +32,31 @@ import ch.njol.skript.doc.Name;\n import ch.njol.skript.doc.Since;\n import ch.njol.skript.lang.Expression;\n import ch.njol.skript.lang.ExpressionType;\n-import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n import ch.njol.util.Kleenean;\n import ch.njol.util.coll.CollectionUtils;\n \n-@Name(\"Game Rule\")\n-@Description(\"The gamerule of a world.\")\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n @Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n-@Since(\"2.5\")\n-public class ExprGameRule extends SimpleExpression<Object> {\n+@Since(\"INSERT VERSION\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n \t\n \tstatic {\n-\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n-\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n \t}\n \t\n \t@SuppressWarnings(\"null\")\n-\tprivate Expression<String> gamerule;\n+\tprivate Expression<GameRule> gamerule;\n \t@SuppressWarnings(\"null\")\n \tprivate Expression<World> world;\n \t\n \t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n-\t\tgamerule = (Expression<String>) exprs[0];\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n \t\tworld = (Expression<World>) exprs[1];\n \t\treturn true;\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MjQwNw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422572407", "bodyText": "This isn't a property expression, it's a combined one.", "author": "SnowPyon", "createdAt": "2020-05-10T02:10:57Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Game Rule\")\n+@Description(\"The gamerule of a world.\")\n+@Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n+@Since(\"2.5\")\n+public class ExprGameRule extends SimpleExpression<Object> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,", "originalCommit": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "092326a427e153ed15963434210cb4c358ce7a86", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex 3341cdf1..3a27fb66 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -32,30 +32,31 @@ import ch.njol.skript.doc.Name;\n import ch.njol.skript.doc.Since;\n import ch.njol.skript.lang.Expression;\n import ch.njol.skript.lang.ExpressionType;\n-import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n import ch.njol.util.Kleenean;\n import ch.njol.util.coll.CollectionUtils;\n \n-@Name(\"Game Rule\")\n-@Description(\"The gamerule of a world.\")\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n @Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n-@Since(\"2.5\")\n-public class ExprGameRule extends SimpleExpression<Object> {\n+@Since(\"INSERT VERSION\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n \t\n \tstatic {\n-\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n-\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n \t}\n \t\n \t@SuppressWarnings(\"null\")\n-\tprivate Expression<String> gamerule;\n+\tprivate Expression<GameRule> gamerule;\n \t@SuppressWarnings(\"null\")\n \tprivate Expression<World> world;\n \t\n \t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n-\t\tgamerule = (Expression<String>) exprs[0];\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n \t\tworld = (Expression<World>) exprs[1];\n \t\treturn true;\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MjYxNw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422572617", "bodyText": "separate import for the ParseResult parameter.", "author": "SnowPyon", "createdAt": "2020-05-10T02:13:49Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Game Rule\")\n+@Description(\"The gamerule of a world.\")\n+@Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n+@Since(\"2.5\")\n+public class ExprGameRule extends SimpleExpression<Object> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n+\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<String> gamerule;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<World> world;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {", "originalCommit": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "092326a427e153ed15963434210cb4c358ce7a86", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex 3341cdf1..3a27fb66 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -32,30 +32,31 @@ import ch.njol.skript.doc.Name;\n import ch.njol.skript.doc.Since;\n import ch.njol.skript.lang.Expression;\n import ch.njol.skript.lang.ExpressionType;\n-import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n import ch.njol.util.Kleenean;\n import ch.njol.util.coll.CollectionUtils;\n \n-@Name(\"Game Rule\")\n-@Description(\"The gamerule of a world.\")\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n @Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n-@Since(\"2.5\")\n-public class ExprGameRule extends SimpleExpression<Object> {\n+@Since(\"INSERT VERSION\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n \t\n \tstatic {\n-\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n-\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n \t}\n \t\n \t@SuppressWarnings(\"null\")\n-\tprivate Expression<String> gamerule;\n+\tprivate Expression<GameRule> gamerule;\n \t@SuppressWarnings(\"null\")\n \tprivate Expression<World> world;\n \t\n \t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n-\t\tgamerule = (Expression<String>) exprs[0];\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n \t\tworld = (Expression<World>) exprs[1];\n \t\treturn true;\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MzQxOA==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r422573418", "bodyText": "if the returned type is the GameRule class, then why didn't you use that in the registration as well?", "author": "SnowPyon", "createdAt": "2020-05-10T02:24:15Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Game Rule\")\n+@Description(\"The gamerule of a world.\")\n+@Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n+@Since(\"2.5\")\n+public class ExprGameRule extends SimpleExpression<Object> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n+\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<String> gamerule;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<World> world;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n+\t\tgamerule = (Expression<String>) exprs[0];\n+\t\tworld = (Expression<World>) exprs[1];\n+\t\treturn true;\n+\t}\n+\t\n+\t@Override\n+\t@Nullable\n+\tpublic Class<?>[] acceptChange(final Changer.ChangeMode mode) {\n+\t\tif (mode == Changer.ChangeMode.SET) return CollectionUtils.array(Object.class);\n+\t\treturn null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(final Event e, final @Nullable Object[] delta, final Changer.ChangeMode mode) {\n+\t\tassert delta != null;\n+\t\tif (mode == Changer.ChangeMode.SET) {\n+\t\t\tWorld gameruleWorld = world.getSingle(e);\n+\t\t\tif (gameruleWorld == null) return;\n+\t\t\tGameRule bukkitGamerule = getGamerule(e);\n+\t\t\tif (bukkitGamerule == null) return;\n+\t\t\tgameruleWorld.setGameRule(bukkitGamerule, delta[0]);\n+\t\t}\n+\t}\n+\t\t\n+\t@Nullable\n+\t@Override\n+\tprotected Object[] get(Event e) {\n+\t\tWorld gameruleWorld = world.getSingle(e);\n+\t\tif (gameruleWorld == null) return null;\n+\t\tGameRule<?> bukkitGamerule = getGamerule(e);\n+\t\tif (bukkitGamerule == null) return null;\n+\t\treturn new Object[] {gameruleWorld.getGameRuleValue(bukkitGamerule)};\n+\t}\n+\t\n+\t@Nullable\n+\tprivate GameRule<?> getGamerule(Event e) {\n+\t\tString stringGamerule = gamerule.getSingle(e);\n+\t\tif (stringGamerule == null) return null;\n+\t\tGameRule<?> bukkitGamerule = GameRule.getByName(stringGamerule);\n+\t\treturn bukkitGamerule;\n+\t}\n+\t\n+\t@Override\n+\tpublic boolean isSingle() {\n+\t\treturn true;\n+\t}\n+\t\n+\t@Override\n+\tpublic Class<?> getReturnType() {\n+\t\treturn GameRule.class;", "originalCommit": "07b21f94094f2722fc0ed12f435c85fc506f2aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "092326a427e153ed15963434210cb4c358ce7a86", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex 3341cdf1..3a27fb66 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -32,30 +32,31 @@ import ch.njol.skript.doc.Name;\n import ch.njol.skript.doc.Since;\n import ch.njol.skript.lang.Expression;\n import ch.njol.skript.lang.ExpressionType;\n-import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n import ch.njol.util.Kleenean;\n import ch.njol.util.coll.CollectionUtils;\n \n-@Name(\"Game Rule\")\n-@Description(\"The gamerule of a world.\")\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n @Examples({\"set the gamerule \\\"commandBlockOutput\\\" of world \\\"world\\\" to false\"})\n-@Since(\"2.5\")\n-public class ExprGameRule extends SimpleExpression<Object> {\n+@Since(\"INSERT VERSION\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n \t\n \tstatic {\n-\t\tSkript.registerExpression(ExprGameRule.class, Object.class, ExpressionType.PROPERTY,\n-\t\t\t\"[the] game[ ]rule %string% of %world%\");\n+\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n \t}\n \t\n \t@SuppressWarnings(\"null\")\n-\tprivate Expression<String> gamerule;\n+\tprivate Expression<GameRule> gamerule;\n \t@SuppressWarnings(\"null\")\n \tprivate Expression<World> world;\n \t\n \t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n-\t\tgamerule = (Expression<String>) exprs[0];\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n \t\tworld = (Expression<World>) exprs[1];\n \t\treturn true;\n \t}\n"}}, {"oid": "092326a427e153ed15963434210cb4c358ce7a86", "url": "https://github.com/SkriptLang/Skript/commit/092326a427e153ed15963434210cb4c358ce7a86", "message": "Add Gamerule and GameruleValue\n\nTypes for Gamerule Expression", "committedDate": "2020-05-11T06:14:32Z", "type": "commit"}, {"oid": "f5121230fbc159b78bc8ca5d5d6dd9023f601d2c", "url": "https://github.com/SkriptLang/Skript/commit/f5121230fbc159b78bc8ca5d5d6dd9023f601d2c", "message": "GameRule Version\n\nRequires 1.13 or newer", "committedDate": "2020-05-11T06:30:29Z", "type": "commit"}, {"oid": "9666bb2d5c8ebd8cddc37df3e592c5e08baedafb", "url": "https://github.com/SkriptLang/Skript/commit/9666bb2d5c8ebd8cddc37df3e592c5e08baedafb", "message": "Proper gamerule version checks", "committedDate": "2020-05-11T07:12:37Z", "type": "commit"}, {"oid": "fe2a614877d4106689f0a1a31a3e7cb4b31322d3", "url": "https://github.com/SkriptLang/Skript/commit/fe2a614877d4106689f0a1a31a3e7cb4b31322d3", "message": "Fix example", "committedDate": "2020-05-11T21:47:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3Mzg4NQ==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r423673885", "bodyText": "You will need to change your line endings in your IDE for this class, to prevent this kind of commit happening.\nNot only does it kill commit history, but it also prevents us from being able to easily see the line changes.", "author": "ShaneBeee", "createdAt": "2020-05-12T11:54:59Z", "path": "src/main/java/ch/njol/skript/expressions/ExprName.java", "diffHunk": "@@ -1,432 +1,442 @@\n-/**\r\n- *   This file is part of Skript.\r\n- *\r\n- *  Skript is free software: you can redistribute it and/or modify\r\n- *  it under the terms of the GNU General Public License as published by\r\n- *  the Free Software Foundation, either version 3 of the License, or\r\n- *  (at your option) any later version.\r\n- *\r\n- *  Skript is distributed in the hope that it will be useful,\r\n- *  but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n- *  GNU General Public License for more details.\r\n- *\r\n- *  You should have received a copy of the GNU General Public License\r\n- *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\r\n- *\r\n- *\r\n- * Copyright 2011-2017 Peter G\u00fcttinger and contributors\r\n- */\r\n-package ch.njol.skript.expressions;\r\n-\r\n-import java.lang.invoke.MethodHandle;\r\n-import java.lang.invoke.MethodHandles;\r\n-import java.lang.invoke.MethodType;\r\n-import java.util.ArrayList;\r\n-import java.util.List;\r\n-\r\n-import org.bukkit.Bukkit;\r\n-import org.bukkit.ChatColor;\r\n-import org.bukkit.entity.Entity;\r\n-import org.bukkit.entity.HumanEntity;\r\n-import org.bukkit.entity.LivingEntity;\r\n-import org.bukkit.entity.Player;\r\n-import org.bukkit.event.Event;\r\n-import org.bukkit.event.inventory.InventoryType;\r\n-import org.bukkit.inventory.Inventory;\r\n-import org.bukkit.inventory.ItemStack;\r\n-import org.bukkit.inventory.meta.ItemMeta;\r\n-import org.eclipse.jdt.annotation.Nullable;\r\n-\r\n-import ch.njol.skript.Skript;\r\n-import ch.njol.skript.aliases.ItemType;\r\n-import ch.njol.skript.classes.Changer.ChangeMode;\r\n-import ch.njol.skript.classes.Changer.ChangerUtils;\r\n-import ch.njol.skript.doc.Description;\r\n-import ch.njol.skript.doc.Examples;\r\n-import ch.njol.skript.doc.Name;\r\n-import ch.njol.skript.doc.Since;\r\n-import ch.njol.skript.expressions.base.SimplePropertyExpression;\r\n-import ch.njol.skript.lang.Expression;\r\n-import ch.njol.skript.lang.SkriptParser.ParseResult;\r\n-import ch.njol.skript.lang.Variable;\r\n-import ch.njol.skript.util.slot.Slot;\r\n-import ch.njol.util.Kleenean;\r\n-import ch.njol.util.coll.CollectionUtils;\r\n-\r\n-@Name(\"Name / Display Name\")\r\n-@Description({\"Represents the Minecraft account, display or tab list name of a player, or the custom name of an item, entity or inventory.\",\r\n-\t\t\"\",\r\n-\t\t\"<ul>\",\r\n-\t\t\"\\t<li><strong>Players</strong>\",\r\n-\t\t\"\\t\\t<ul>\",\r\n-\t\t\"\\t\\t\\t<li><strong>Name:</strong> The Minecraft account name of the player. Can't be changed, but 'display name' can be changed.</li>\",\r\n-\t\t\"\\t\\t\\t<li><strong>Display Name:</strong> The name of the player that is displayed in messages. \" +\r\n-\t\t\t\"This name can be changed freely and can include colour codes, and is shared among all plugins (e.g. chat plugins will use the display name).</li>\",\r\n-\t\t\"\\t\\t</ul>\",\r\n-\t\t\"\\t</li>\",\r\n-\t\t\"\\t<li><strong>Entities</strong>\",\r\n-\t\t\"\\t\\t<ul>\",\r\n-\t\t\"\\t\\t\\t<li><strong>Name:</strong> The custom name of the entity. Can be changed. But for living entities, \" +\r\n-\t\t\t\"the players will have to target the entity to see its name tag. For non-living entities, the name will not be visible at all. To prevent this, use 'display name'.</li>\",\r\n-\t\t\"\\t\\t\\t<li><strong>Display Name:</strong> The custom name of the entity. Can be changed, \" +\r\n-\t\t\t\"which will also enable <em>custom name visibility</em> of the entity so name tag of the entity will be visible always.</li>\",\r\n-\t\t\"\\t\\t</ul>\",\r\n-\t\t\"\\t</li>\",\r\n-\t\t\"\\t<li><strong>Items</strong>\",\r\n-\t\t\"\\t\\t<ul>\",\r\n-\t\t\"\\t\\t\\t<li><strong>Name and Display Name:</strong> The <em>custom</em> name of the item (not the Minecraft locale name). Can be changed.</li>\",\r\n-\t\t\"\\t\\t</ul>\",\r\n-\t\t\"\\t</li>\",\r\n-\t\t\"\\t<li><strong>Inventories</strong>\",\r\n-\t\t\"\\t\\t<ul>\",\r\n-\t\t\"\\t\\t\\t<li><strong>Name and Display Name:</strong> The name/title of the inventory. \" +\r\n-\t\t\t\"Changing name of an inventory means opening the same inventory with the same contents but with a different name to its current viewers.</li>\",\r\n-\t\t\"\\t\\t</ul>\",\r\n-\t\t\"\\t</li>\",\r\n-\t\t\"</ul>\"})\r\n-@Examples({\"on join:\",\r\n-\t\t\"\tplayer has permission \\\"name.red\\\"\",\r\n-\t\t\"\tset the player's display name to \\\"<red>[admin] <gold>%name of player%\\\"\",\r\n-\t\t\"\tset the player's tab list name to \\\"<green>%player's name%\\\"\",\r\n-\t\t\"set the name of the player's tool to \\\"Legendary Sword of Awesomeness\\\"\"})\r\n-@Since(\"before 2.1, 2.2-dev20 (inventory name), 2.4 (non-living entity support, changeable inventory name)\")\r\n-public class ExprName extends SimplePropertyExpression<Object, String> {\r\n-\r\n-\t@Nullable\r\n-\tstatic final MethodHandle TITLE_METHOD;\r\n-\r\n-\tstatic {\r\n-\t\tMethodHandle _METHOD = null;\r\n-\t\ttry {\r\n-\t\t\t_METHOD = MethodHandles.lookup().findVirtual(Inventory.class, \"getTitle\", MethodType.methodType(String.class));\r\n-\t\t} catch (IllegalAccessException | NoSuchMethodException ignored) {}\r\n-\t\tTITLE_METHOD = _METHOD;\r\n-\t}\r\n-\r\n-\tprivate final static int ITEM = 1, ENTITY = 2, PLAYER = 4, INVENTORY = 8;\r\n-\tfinal static String[] types = {\"itemstacks/slots\", \"entities\", \"players\", \"inventories\"};\r\n-\r\n-\tprivate enum NameType {\r\n-\t\tNAME(\"name\", \"name[s]\", PLAYER | ITEM | ENTITY | INVENTORY, ITEM | ENTITY | INVENTORY) {\r\n-\t\t\t@Override\r\n-\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\r\n-\t\t\t\tif (o == null)\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\tif (o instanceof Entity) {\r\n-\t\t\t\t\t((Entity) o).setCustomName(name);\r\n-\t\t\t\t\tif (o instanceof LivingEntity)\r\n-\t\t\t\t\t\t((LivingEntity) o).setRemoveWhenFarAway(name == null);\r\n-\t\t\t\t} else if (o instanceof ItemType) {\r\n-\t\t\t\t\tItemMeta m = ((ItemType) o).getItemMeta();\r\n-\t\t\t\t\tm.setDisplayName(name);\r\n-\t\t\t\t\t((ItemType) o).setItemMeta(m);\r\n-\t\t\t\t} else if (o instanceof ItemStack) {\r\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\r\n-\t\t\t\t\tif (m != null) {\r\n-\t\t\t\t\t\tm.setDisplayName(name);\r\n-\t\t\t\t\t\t((ItemStack) o).setItemMeta(m);\r\n-\t\t\t\t\t}\r\n-\t\t\t\t} else if (o instanceof Inventory) {\r\n-\t\t\t\t\tInventory inventory = ((Inventory) o);\r\n-\t\t\t\t\tList<HumanEntity> viewers = new ArrayList<>(inventory.getViewers());\r\n-\t\t\t\t\tif (viewers.isEmpty())\r\n-\t\t\t\t\t\treturn;\r\n-\t\t\t\t\tInventory copy;\r\n-\t\t\t\t\tInventoryType invType = inventory.getType();\r\n-\t\t\t\t\tif (!invType.isCreatable())\r\n-\t\t\t\t\t\treturn;\r\n-\t\t\t\t\tif (invType == InventoryType.CHEST) {\r\n-\t\t\t\t\t\tif (name == null)\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize());\r\n-\t\t\t\t\t\telse\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize(), name);\r\n-\t\t\t\t\t} else {\r\n-\t\t\t\t\t\tif (name == null)\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType);\r\n-\t\t\t\t\t\telse\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType, name);\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\tcopy.setContents(inventory.getContents());\r\n-\t\t\t\t\tviewers.forEach(human -> human.openInventory(copy));\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tassert false;\r\n-\t\t\t\t}\r\n-\t\t\t}\r\n-\r\n-\t\t\t@Override\r\n-\t\t\t@Nullable\r\n-\t\t\tString get(@Nullable Object o) {\r\n-\t\t\t\tif (o == null)\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\tif (o instanceof Player) {\r\n-\t\t\t\t\treturn ((Player) o).getName();\r\n-\t\t\t\t} else if (o instanceof Entity) {\r\n-\t\t\t\t\treturn ((Entity) o).getCustomName();\r\n-\t\t\t\t} else if (o instanceof ItemType) {\r\n-\t\t\t\t\tItemMeta m = ((ItemType) o).getItemMeta();\r\n-\t\t\t\t\treturn !m.hasDisplayName() ? null : m.getDisplayName();\r\n-\t\t\t\t} else if (o instanceof ItemStack) {\r\n-\t\t\t\t\tif (!((ItemStack) o).hasItemMeta())\r\n-\t\t\t\t\t\treturn null;\r\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\r\n-\t\t\t\t\treturn m == null || !m.hasDisplayName() ? null : m.getDisplayName();\r\n-\t\t\t\t} else if (o instanceof Inventory) {\r\n-\t\t\t\t\tif (TITLE_METHOD != null) {\r\n-\t\t\t\t\t\ttry {\r\n-\t\t\t\t\t\t\treturn ((String) TITLE_METHOD.invoke(o));\r\n-\t\t\t\t\t\t} catch (IllegalAccessException e) {\r\n-\t\t\t\t\t\t\tassert false;\r\n-\t\t\t\t\t\t\treturn null;\r\n-\t\t\t\t\t\t} catch (Throwable e) {\r\n-\t\t\t\t\t\t\tSkript.exception(e);\r\n-\t\t\t\t\t\t\treturn null;\r\n-\t\t\t\t\t\t}\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tassert false;\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\t}\r\n-\t\t\t}\r\n-\t\t},\r\n-\t\tDISPLAY_NAME(\"display name\", \"(display|nick|chat)[ ]name[s]\", PLAYER | ITEM | ENTITY | INVENTORY, PLAYER | ITEM | ENTITY | INVENTORY) {\r\n-\t\t\t@Override\r\n-\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\r\n-\t\t\t\tif (o == null)\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\tif (o instanceof Player) {\r\n-\t\t\t\t\t((Player) o).setDisplayName(name == null ? ((Player) o).getName() : name + ChatColor.RESET);\r\n-\t\t\t\t} else if (o instanceof Entity) {\r\n-\t\t\t\t\t((Entity) o).setCustomName(name);\r\n-\t\t\t\t\t((Entity) o).setCustomNameVisible(name != null);\r\n-\t\t\t\t\tif (o instanceof LivingEntity)\r\n-\t\t\t\t\t\t((LivingEntity) o).setRemoveWhenFarAway(name == null);\r\n-\t\t\t\t} else if (o instanceof ItemStack) {\r\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\r\n-\t\t\t\t\tif (m != null) {\r\n-\t\t\t\t\t\tm.setDisplayName(name);\r\n-\t\t\t\t\t\t((ItemStack) o).setItemMeta(m);\r\n-\t\t\t\t\t}\r\n-\t\t\t\t} else if (o instanceof Inventory) {\r\n-\t\t\t\t\tInventory inventory = ((Inventory) o);\r\n-\t\t\t\t\tList<HumanEntity> viewers = new ArrayList<>(inventory.getViewers());\r\n-\t\t\t\t\tif (viewers.isEmpty())\r\n-\t\t\t\t\t\treturn;\r\n-\t\t\t\t\tInventory copy;\r\n-\t\t\t\t\tInventoryType invType = inventory.getType();\r\n-\t\t\t\t\tif (!invType.isCreatable())\r\n-\t\t\t\t\t\treturn;\r\n-\t\t\t\t\tif (invType == InventoryType.CHEST) {\r\n-\t\t\t\t\t\tif (name == null)\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize());\r\n-\t\t\t\t\t\telse\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize(), name);\r\n-\t\t\t\t\t} else {\r\n-\t\t\t\t\t\tif (name == null)\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType);\r\n-\t\t\t\t\t\telse\r\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType, name);\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\tcopy.setContents(inventory.getContents());\r\n-\t\t\t\t\tviewers.forEach(human -> human.openInventory(copy));\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tassert false;\r\n-\t\t\t\t}\r\n-\t\t\t}\r\n-\r\n-\t\t\t@Override\r\n-\t\t\t@Nullable\r\n-\t\t\tString get(@Nullable Object o) {\r\n-\t\t\t\tif (o == null)\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\tif (o instanceof Player) {\r\n-\t\t\t\t\treturn ((Player) o).getDisplayName();\r\n-\t\t\t\t} else if (o instanceof Entity) {\r\n-\t\t\t\t\treturn ((Entity) o).getCustomName();\r\n-\t\t\t\t} else if (o instanceof ItemStack) {\r\n-\t\t\t\t\tif (!((ItemStack) o).hasItemMeta())\r\n-\t\t\t\t\t\treturn null;\r\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\r\n-\t\t\t\t\treturn m == null || !m.hasDisplayName() ? null : m.getDisplayName();\r\n-\t\t\t\t} else if (o instanceof Inventory) {\r\n-\t\t\t\t\tif (TITLE_METHOD != null) {\r\n-\t\t\t\t\t\ttry {\r\n-\t\t\t\t\t\t\treturn ((String) TITLE_METHOD.invoke(o));\r\n-\t\t\t\t\t\t} catch (IllegalAccessException e) {\r\n-\t\t\t\t\t\t\tassert false;\r\n-\t\t\t\t\t\t\treturn null;\r\n-\t\t\t\t\t\t} catch (Throwable e) {\r\n-\t\t\t\t\t\t\tSkript.exception(e);\r\n-\t\t\t\t\t\t\treturn null;\r\n-\t\t\t\t\t\t}\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tassert false;\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\t}\r\n-\t\t\t}\r\n-\t\t},\r\n-\t\tTABLIST_NAME(\"player list name\", \"(player|tab)[ ]list name[s]\", PLAYER, PLAYER) {\r\n-\t\t\t@Override\r\n-\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\r\n-\t\t\t\tif (o == null)\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\tif (o instanceof Player) {\r\n-\t\t\t\t\ttry {\r\n-\t\t\t\t\t\t((Player) o).setPlayerListName(name == null ? \"\" : name);\r\n-\t\t\t\t\t} catch (IllegalArgumentException ignored) {}\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tassert false;\r\n-\t\t\t\t}\r\n-\t\t\t}\r\n-\r\n-\t\t\t@Override\r\n-\t\t\t@Nullable\r\n-\t\t\tString get(@Nullable Object o) {\r\n-\t\t\t\tif (o == null)\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\tif (o instanceof Player) {\r\n-\t\t\t\t\treturn ((Player) o).getPlayerListName();\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tassert false;\r\n-\t\t\t\t\treturn null;\r\n-\t\t\t\t}\r\n-\t\t\t}\r\n-\t\t};\r\n-\r\n-\t\tfinal String name;\r\n-\t\tfinal String pattern;\r\n-\t\tfinal int from;\r\n-\t\tfinal int acceptChange;\r\n-\r\n-\t\tNameType(String name, String pattern, int from, int change) {\r\n-\t\t\tthis.name = name;\r\n-\t\t\tthis.pattern = \"(\" + ordinal() + \"\u00a6)\" + pattern;\r\n-\t\t\tthis.from = from;\r\n-\t\t\tacceptChange = change;\r\n-\t\t}\r\n-\r\n-\t\tabstract void set(@Nullable Object o, @Nullable String s);\r\n-\r\n-\t\t@Nullable\r\n-\t\tabstract String get(@Nullable Object o);\r\n-\r\n-\t\tString getFrom() {\r\n-\t\t\tStringBuilder b = new StringBuilder();\r\n-\t\t\tfor (int i = 0; i < types.length; i++) {\r\n-\t\t\t\tif ((from & (1 << i)) == 0)\r\n-\t\t\t\t\tcontinue;\r\n-\t\t\t\tif ((1 << i) == ITEM && !Skript.isRunningMinecraft(1, 4, 5))\r\n-\t\t\t\t\tcontinue;\r\n-\t\t\t\tif ((1 << i) == ENTITY && !Skript.isRunningMinecraft(1, 5))\r\n-\t\t\t\t\tcontinue;\r\n-\t\t\t\tif (b.length() != 0)\r\n-\t\t\t\t\tb.append(\"/\");\r\n-\t\t\t\tb.append(types[i]);\r\n-\t\t\t}\r\n-\t\t\treturn \"\" + b;\r\n-\t\t}\r\n-\t}\r\n-\r\n-\tstatic {\r\n-\t\tfor (NameType n : NameType.values())\r\n-\t\t\tregister(ExprName.class, String.class, n.pattern, n.getFrom());\r\n-\t}\r\n-\r\n-\t@SuppressWarnings(\"null\")\r\n-\tprivate NameType type;\r\n-\r\n-\t@SuppressWarnings({\"null\", \"unchecked\"})\r\n-\t@Override\r\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\r\n-\t\ttype = NameType.values()[parseResult.mark];\r\n-\t\tif (exprs[0] instanceof Variable)\r\n-\t\t\tsetExpr(exprs[0].getConvertedExpression(Object.class));\r\n-\t\telse\r\n-\t\t\tsetExpr(exprs[0]);\r\n-\t\treturn true;\r\n-\t}\r\n-\r\n-\t@Override\r\n-\t@Nullable\r\n-\tpublic String convert(Object o) {\r\n-\t\treturn type.get(o instanceof Slot ? ((Slot) o).getItem() : o);\r\n-\t}\r\n-\r\n-\tprivate int changeType = 0;\r\n-\r\n-\t// TODO find a better method for handling changes (in general)\r\n-\t// e.g. a Changer that takes an object and returns another which should then be saved if applicable (the Changer includes the ChangeMode)\r\n-\t@Override\r\n-\t@Nullable\r\n-\tpublic Class<?>[] acceptChange(ChangeMode mode) {\r\n-\t\tif (mode == ChangeMode.DELETE && (type.acceptChange & ~PLAYER) != 0 || mode == ChangeMode.RESET)\r\n-\t\t\treturn new Class[0];\r\n-\t\tif (mode != ChangeMode.SET)\r\n-\t\t\treturn null;\r\n-\t\tif ((type.acceptChange & PLAYER) != 0 && Player.class.isAssignableFrom(getExpr().getReturnType())) {\r\n-\t\t\tchangeType = PLAYER;\r\n-\t\t} else if ((type.acceptChange & INVENTORY) != 0 && Inventory.class.isAssignableFrom(getExpr().getReturnType())) {\r\n-\t\t\tchangeType = INVENTORY;\r\n-\t\t} else if ((type.acceptChange & ITEM) != 0 && (getExpr().isSingle() && ChangerUtils.acceptsChange(getExpr(), ChangeMode.SET, ItemStack.class, ItemType.class) || Slot.class.isAssignableFrom(getExpr().getReturnType()))) {\r\n-\t\t\tchangeType = ITEM;\r\n-\t\t} else if ((type.acceptChange & ENTITY) != 0 && Entity.class.isAssignableFrom(getExpr().getReturnType())) {\r\n-\t\t\tif (type == NameType.NAME && Player.class.isAssignableFrom(getExpr().getReturnType())) {\r\n-\t\t\t\tSkript.error(\"Can't change the Minecraft name of a player. Change the 'display name' or 'tab list name' instead.\");\r\n-\t\t\t\treturn null;\r\n-\t\t\t}\r\n-\t\t\tchangeType = ENTITY;\r\n-\t\t}\r\n-\t\treturn changeType == 0 ? null : CollectionUtils.array(String.class);\r\n-\t}\r\n-\r\n-\t@Override\r\n-\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\r\n-\t\tString name = delta == null ? null : (String) delta[0];\r\n-\t\tif (changeType == ITEM) {\r\n-\t\t\tif (Slot.class.isAssignableFrom(getExpr().getReturnType())) {\r\n-\t\t\t\tfor (Slot s : (Slot[]) getExpr().getArray(e)) {\r\n-\t\t\t\t\tItemStack i = s.getItem();\r\n-\t\t\t\t\ttype.set(i, name);\r\n-\t\t\t\t\ts.setItem(i);\r\n-\t\t\t\t}\r\n-\t\t\t} else {\r\n-\t\t\t\tObject i = getExpr().getSingle(e);\r\n-\t\t\t\tif (i instanceof ItemType) {\r\n-\t\t\t\t\ttype.set(i, name);\r\n-\t\t\t\t\tgetExpr().change(e, new ItemType[] {(ItemType) i}, ChangeMode.SET);\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\t}\r\n-\r\n-\t\t\t\tif (!(i instanceof ItemStack) && !(i instanceof Slot))\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\tItemStack is = i instanceof Slot ? ((Slot) i).getItem() : (ItemStack) i;\r\n-\t\t\t\ttype.set(is, name);\r\n-\t\t\t\tif (i instanceof Slot)\r\n-\t\t\t\t\t((Slot) i).setItem(is);\r\n-\t\t\t\telse if (ChangerUtils.acceptsChange(getExpr(), ChangeMode.SET, ItemStack.class))\r\n-\t\t\t\t\tgetExpr().change(e, new Object[] {i}, ChangeMode.SET);\r\n-\t\t\t\telse\r\n-\t\t\t\t\tgetExpr().change(e, new ItemType[] {new ItemType((ItemStack) i)}, ChangeMode.SET);\r\n-\t\t\t}\r\n-\t\t} else {\r\n-\t\t\tfor (Object o : getExpr().getArray(e)) {\r\n-\t\t\t\tif (o instanceof Entity || o instanceof Inventory)\r\n-\t\t\t\t\ttype.set(o, name);\r\n-\t\t\t}\r\n-\t\t}\r\n-\t}\r\n-\r\n-\t@Override\r\n-\tpublic Class<String> getReturnType() {\r\n-\t\treturn String.class;\r\n-\t}\r\n-\r\n-\t@Override\r\n-\tprotected String getPropertyName() {\r\n-\t\treturn type.name;\r\n-\t}\r\n-\r\n-}\r\n+/**", "originalCommit": "fe2a614877d4106689f0a1a31a3e7cb4b31322d3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1c7dfd8f1b94cd3273ffb577122dacd6cf0f2e4a", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprName.java b/src/main/java/ch/njol/skript/expressions/ExprName.java\nindex cb160967..24367214 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprName.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprName.java\n\n@@ -1,442 +1,442 @@\n-/**\n- *   This file is part of Skript.\n- *\n- *  Skript is free software: you can redistribute it and/or modify\n- *  it under the terms of the GNU General Public License as published by\n- *  the Free Software Foundation, either version 3 of the License, or\n- *  (at your option) any later version.\n- *\n- *  Skript is distributed in the hope that it will be useful,\n- *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n- *  GNU General Public License for more details.\n- *\n- *  You should have received a copy of the GNU General Public License\n- *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n- *\n- *\n- * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n- */\n-package ch.njol.skript.expressions;\n-\n-import java.lang.invoke.MethodHandle;\n-import java.lang.invoke.MethodHandles;\n-import java.lang.invoke.MethodType;\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import org.bukkit.Bukkit;\n-import org.bukkit.ChatColor;\n-import org.bukkit.GameRule;\n-import org.bukkit.entity.Entity;\n-import org.bukkit.entity.HumanEntity;\n-import org.bukkit.entity.LivingEntity;\n-import org.bukkit.entity.Player;\n-import org.bukkit.event.Event;\n-import org.bukkit.event.inventory.InventoryType;\n-import org.bukkit.inventory.Inventory;\n-import org.bukkit.inventory.ItemStack;\n-import org.bukkit.inventory.meta.ItemMeta;\n-import org.eclipse.jdt.annotation.Nullable;\n-\n-import ch.njol.skript.Skript;\n-import ch.njol.skript.aliases.ItemType;\n-import ch.njol.skript.classes.Changer.ChangeMode;\n-import ch.njol.skript.classes.Changer.ChangerUtils;\n-import ch.njol.skript.doc.Description;\n-import ch.njol.skript.doc.Examples;\n-import ch.njol.skript.doc.Name;\n-import ch.njol.skript.doc.Since;\n-import ch.njol.skript.expressions.base.SimplePropertyExpression;\n-import ch.njol.skript.lang.Expression;\n-import ch.njol.skript.lang.SkriptParser.ParseResult;\n-import ch.njol.skript.lang.Variable;\n-import ch.njol.skript.util.slot.Slot;\n-import ch.njol.util.Kleenean;\n-import ch.njol.util.coll.CollectionUtils;\n-\n-@Name(\"Name / Display Name\")\n-@Description({\"Represents the Minecraft account, display or tab list name of a player, or the custom name of an item, entity, inventory, or gamerule.\",\n-\t\t\"\",\n-\t\t\"<ul>\",\n-\t\t\"\\t<li><strong>Players</strong>\",\n-\t\t\"\\t\\t<ul>\",\n-\t\t\"\\t\\t\\t<li><strong>Name:</strong> The Minecraft account name of the player. Can't be changed, but 'display name' can be changed.</li>\",\n-\t\t\"\\t\\t\\t<li><strong>Display Name:</strong> The name of the player that is displayed in messages. \" +\n-\t\t\t\"This name can be changed freely and can include colour codes, and is shared among all plugins (e.g. chat plugins will use the display name).</li>\",\n-\t\t\"\\t\\t</ul>\",\n-\t\t\"\\t</li>\",\n-\t\t\"\\t<li><strong>Entities</strong>\",\n-\t\t\"\\t\\t<ul>\",\n-\t\t\"\\t\\t\\t<li><strong>Name:</strong> The custom name of the entity. Can be changed. But for living entities, \" +\n-\t\t\t\"the players will have to target the entity to see its name tag. For non-living entities, the name will not be visible at all. To prevent this, use 'display name'.</li>\",\n-\t\t\"\\t\\t\\t<li><strong>Display Name:</strong> The custom name of the entity. Can be changed, \" +\n-\t\t\t\"which will also enable <em>custom name visibility</em> of the entity so name tag of the entity will be visible always.</li>\",\n-\t\t\"\\t\\t</ul>\",\n-\t\t\"\\t</li>\",\n-\t\t\"\\t<li><strong>Items</strong>\",\n-\t\t\"\\t\\t<ul>\",\n-\t\t\"\\t\\t\\t<li><strong>Name and Display Name:</strong> The <em>custom</em> name of the item (not the Minecraft locale name). Can be changed.</li>\",\n-\t\t\"\\t\\t</ul>\",\n-\t\t\"\\t</li>\",\n-\t\t\"\\t<li><strong>Inventories</strong>\",\n-\t\t\"\\t\\t<ul>\",\n-\t\t\"\\t\\t\\t<li><strong>Name and Display Name:</strong> The name/title of the inventory. \" +\n-\t\t\t\"Changing name of an inventory means opening the same inventory with the same contents but with a different name to its current viewers.</li>\",\n-\t\t\"\\t\\t</ul>\",\n-\t\t\"\\t</li>\",\n-\t\t\"\\t<li><strong>Gamerules (1.13+)</strong>\",\n-\t\t\"\\t\\t<ul>\",\n-\t\t\"\\t\\t\\t<li><strong>Name:</strong> The name of the gamerule. Cannot be changed.</li>\",\n-\t\t\"\\t\\t</ul>\",\n-\t\t\"\\t</li>\",\n-\t\t\"</ul>\"})\n-@Examples({\"on join:\",\n-\t\t\"\tplayer has permission \\\"name.red\\\"\",\n-\t\t\"\tset the player's display name to \\\"<red>[admin] <gold>%name of player%\\\"\",\n-\t\t\"\tset the player's tab list name to \\\"<green>%player's name%\\\"\",\n-\t\t\"set the name of the player's tool to \\\"Legendary Sword of Awesomeness\\\"\"})\n-@Since(\"before 2.1, 2.2-dev20 (inventory name), 2.4 (non-living entity support, changeable inventory name)\")\n-public class ExprName extends SimplePropertyExpression<Object, String> {\n-\n-\t@Nullable\n-\tstatic final MethodHandle TITLE_METHOD;\n-\tstatic final boolean HAS_GAMERULES;\n-\n-\tstatic {\n-\t\tHAS_GAMERULES = Skript.classExists(\"org.bukkit.GameRule\");\n-\t\tMethodHandle _METHOD = null;\n-\t\ttry {\n-\t\t\t_METHOD = MethodHandles.lookup().findVirtual(Inventory.class, \"getTitle\", MethodType.methodType(String.class));\n-\t\t} catch (IllegalAccessException | NoSuchMethodException ignored) {}\n-\t\tTITLE_METHOD = _METHOD;\n-\t}\n-\n-\tprivate final static int ITEM = 1, ENTITY = 2, PLAYER = 4, INVENTORY = 8;\n-\tfinal static String[] types = {\"itemstacks/slots\", \"entities\", \"players\", \"inventories\"};\n-\n-\tprivate enum NameType {\n-\t\tNAME(\"name\", \"name[s]\", PLAYER | ITEM | ENTITY | INVENTORY, ITEM | ENTITY | INVENTORY) {\n-\t\t\t@Override\n-\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\n-\t\t\t\tif (o == null)\n-\t\t\t\t\treturn;\n-\t\t\t\tif (o instanceof Entity) {\n-\t\t\t\t\t((Entity) o).setCustomName(name);\n-\t\t\t\t\tif (o instanceof LivingEntity)\n-\t\t\t\t\t\t((LivingEntity) o).setRemoveWhenFarAway(name == null);\n-\t\t\t\t} else if (o instanceof ItemType) {\n-\t\t\t\t\tItemMeta m = ((ItemType) o).getItemMeta();\n-\t\t\t\t\tm.setDisplayName(name);\n-\t\t\t\t\t((ItemType) o).setItemMeta(m);\n-\t\t\t\t} else if (o instanceof ItemStack) {\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n-\t\t\t\t\tif (m != null) {\n-\t\t\t\t\t\tm.setDisplayName(name);\n-\t\t\t\t\t\t((ItemStack) o).setItemMeta(m);\n-\t\t\t\t\t}\n-\t\t\t\t} else if (o instanceof Inventory) {\n-\t\t\t\t\tInventory inventory = ((Inventory) o);\n-\t\t\t\t\tList<HumanEntity> viewers = new ArrayList<>(inventory.getViewers());\n-\t\t\t\t\tif (viewers.isEmpty())\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\tInventory copy;\n-\t\t\t\t\tInventoryType invType = inventory.getType();\n-\t\t\t\t\tif (!invType.isCreatable())\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\tif (invType == InventoryType.CHEST) {\n-\t\t\t\t\t\tif (name == null)\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize());\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize(), name);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tif (name == null)\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType, name);\n-\t\t\t\t\t}\n-\t\t\t\t\tcopy.setContents(inventory.getContents());\n-\t\t\t\t\tviewers.forEach(human -> human.openInventory(copy));\n-\t\t\t\t} else {\n-\t\t\t\t\tassert false;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\t@Nullable\n-\t\t\tString get(@Nullable Object o) {\n-\t\t\t\tif (o == null)\n-\t\t\t\t\treturn null;\n-\t\t\t\tif (o instanceof Player) {\n-\t\t\t\t\treturn ((Player) o).getName();\n-\t\t\t\t} else if (o instanceof Entity) {\n-\t\t\t\t\treturn ((Entity) o).getCustomName();\n-\t\t\t\t} else if (o instanceof ItemType) {\n-\t\t\t\t\tItemMeta m = ((ItemType) o).getItemMeta();\n-\t\t\t\t\treturn !m.hasDisplayName() ? null : m.getDisplayName();\n-\t\t\t\t} else if (o instanceof ItemStack) {\n-\t\t\t\t\tif (!((ItemStack) o).hasItemMeta())\n-\t\t\t\t\t\treturn null;\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n-\t\t\t\t\treturn m == null || !m.hasDisplayName() ? null : m.getDisplayName();\n-\t\t\t\t} else if (o instanceof Inventory) {\n-\t\t\t\t\tif (TITLE_METHOD != null) {\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\treturn ((String) TITLE_METHOD.invoke(o));\n-\t\t\t\t\t\t} catch (IllegalAccessException e) {\n-\t\t\t\t\t\t\tassert false;\n-\t\t\t\t\t\t\treturn null;\n-\t\t\t\t\t\t} catch (Throwable e) {\n-\t\t\t\t\t\t\tSkript.exception(e);\n-\t\t\t\t\t\t\treturn null;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\treturn null;\n-\t\t\t\t} else if (HAS_GAMERULES && o instanceof GameRule) {\n-\t\t\t\t\treturn ((GameRule) o).getName();\n-\t\t\t\t} else {\n-\t\t\t\t\tassert false;\n-\t\t\t\t\treturn null;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\t\tDISPLAY_NAME(\"display name\", \"(display|nick|chat)[ ]name[s]\", PLAYER | ITEM | ENTITY | INVENTORY, PLAYER | ITEM | ENTITY | INVENTORY) {\n-\t\t\t@Override\n-\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\n-\t\t\t\tif (o == null)\n-\t\t\t\t\treturn;\n-\t\t\t\tif (o instanceof Player) {\n-\t\t\t\t\t((Player) o).setDisplayName(name == null ? ((Player) o).getName() : name + ChatColor.RESET);\n-\t\t\t\t} else if (o instanceof Entity) {\n-\t\t\t\t\t((Entity) o).setCustomName(name);\n-\t\t\t\t\t((Entity) o).setCustomNameVisible(name != null);\n-\t\t\t\t\tif (o instanceof LivingEntity)\n-\t\t\t\t\t\t((LivingEntity) o).setRemoveWhenFarAway(name == null);\n-\t\t\t\t} else if (o instanceof ItemStack) {\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n-\t\t\t\t\tif (m != null) {\n-\t\t\t\t\t\tm.setDisplayName(name);\n-\t\t\t\t\t\t((ItemStack) o).setItemMeta(m);\n-\t\t\t\t\t}\n-\t\t\t\t} else if (o instanceof Inventory) {\n-\t\t\t\t\tInventory inventory = ((Inventory) o);\n-\t\t\t\t\tList<HumanEntity> viewers = new ArrayList<>(inventory.getViewers());\n-\t\t\t\t\tif (viewers.isEmpty())\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\tInventory copy;\n-\t\t\t\t\tInventoryType invType = inventory.getType();\n-\t\t\t\t\tif (!invType.isCreatable())\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\tif (invType == InventoryType.CHEST) {\n-\t\t\t\t\t\tif (name == null)\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize());\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize(), name);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tif (name == null)\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType, name);\n-\t\t\t\t\t}\n-\t\t\t\t\tcopy.setContents(inventory.getContents());\n-\t\t\t\t\tviewers.forEach(human -> human.openInventory(copy));\n-\t\t\t\t} else {\n-\t\t\t\t\tassert false;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\t@Nullable\n-\t\t\tString get(@Nullable Object o) {\n-\t\t\t\tif (o == null)\n-\t\t\t\t\treturn null;\n-\t\t\t\tif (o instanceof Player) {\n-\t\t\t\t\treturn ((Player) o).getDisplayName();\n-\t\t\t\t} else if (o instanceof Entity) {\n-\t\t\t\t\treturn ((Entity) o).getCustomName();\n-\t\t\t\t} else if (o instanceof ItemStack) {\n-\t\t\t\t\tif (!((ItemStack) o).hasItemMeta())\n-\t\t\t\t\t\treturn null;\n-\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n-\t\t\t\t\treturn m == null || !m.hasDisplayName() ? null : m.getDisplayName();\n-\t\t\t\t} else if (o instanceof Inventory) {\n-\t\t\t\t\tif (TITLE_METHOD != null) {\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\treturn ((String) TITLE_METHOD.invoke(o));\n-\t\t\t\t\t\t} catch (IllegalAccessException e) {\n-\t\t\t\t\t\t\tassert false;\n-\t\t\t\t\t\t\treturn null;\n-\t\t\t\t\t\t} catch (Throwable e) {\n-\t\t\t\t\t\t\tSkript.exception(e);\n-\t\t\t\t\t\t\treturn null;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\treturn null;\n-\t\t\t\t} else {\n-\t\t\t\t\tassert false;\n-\t\t\t\t\treturn null;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\t\tTABLIST_NAME(\"player list name\", \"(player|tab)[ ]list name[s]\", PLAYER, PLAYER) {\n-\t\t\t@Override\n-\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\n-\t\t\t\tif (o == null)\n-\t\t\t\t\treturn;\n-\t\t\t\tif (o instanceof Player) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t((Player) o).setPlayerListName(name == null ? \"\" : name);\n-\t\t\t\t\t} catch (IllegalArgumentException ignored) {}\n-\t\t\t\t} else {\n-\t\t\t\t\tassert false;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\t@Nullable\n-\t\t\tString get(@Nullable Object o) {\n-\t\t\t\tif (o == null)\n-\t\t\t\t\treturn null;\n-\t\t\t\tif (o instanceof Player) {\n-\t\t\t\t\treturn ((Player) o).getPlayerListName();\n-\t\t\t\t} else {\n-\t\t\t\t\tassert false;\n-\t\t\t\t\treturn null;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\tfinal String name;\n-\t\tfinal String pattern;\n-\t\tfinal int from;\n-\t\tfinal int acceptChange;\n-\n-\t\tNameType(String name, String pattern, int from, int change) {\n-\t\t\tthis.name = name;\n-\t\t\tthis.pattern = \"(\" + ordinal() + \"\u00a6)\" + pattern;\n-\t\t\tthis.from = from;\n-\t\t\tacceptChange = change;\n-\t\t}\n-\n-\t\tabstract void set(@Nullable Object o, @Nullable String s);\n-\n-\t\t@Nullable\n-\t\tabstract String get(@Nullable Object o);\n-\n-\t\tString getFrom() {\n-\t\t\tStringBuilder b = new StringBuilder();\n-\t\t\tfor (int i = 0; i < types.length; i++) {\n-\t\t\t\tif ((from & (1 << i)) == 0)\n-\t\t\t\t\tcontinue;\n-\t\t\t\tif ((1 << i) == ITEM && !Skript.isRunningMinecraft(1, 4, 5))\n-\t\t\t\t\tcontinue;\n-\t\t\t\tif ((1 << i) == ENTITY && !Skript.isRunningMinecraft(1, 5))\n-\t\t\t\t\tcontinue;\n-\t\t\t\tif (b.length() != 0)\n-\t\t\t\t\tb.append(\"/\");\n-\t\t\t\tb.append(types[i]);\n-\t\t\t}\n-\t\t\treturn \"\" + b;\n-\t\t}\n-\t}\n-\n-\tstatic {\n-\t\tfor (NameType n : NameType.values())\n-\t\t\tregister(ExprName.class, String.class, n.pattern, n.getFrom());\n-\t}\n-\n-\t@SuppressWarnings(\"null\")\n-\tprivate NameType type;\n-\n-\t@SuppressWarnings({\"null\", \"unchecked\"})\n-\t@Override\n-\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n-\t\ttype = NameType.values()[parseResult.mark];\n-\t\tif (exprs[0] instanceof Variable)\n-\t\t\tsetExpr(exprs[0].getConvertedExpression(Object.class));\n-\t\telse\n-\t\t\tsetExpr(exprs[0]);\n-\t\treturn true;\n-\t}\n-\n-\t@Override\n-\t@Nullable\n-\tpublic String convert(Object o) {\n-\t\treturn type.get(o instanceof Slot ? ((Slot) o).getItem() : o);\n-\t}\n-\n-\tprivate int changeType = 0;\n-\n-\t// TODO find a better method for handling changes (in general)\n-\t// e.g. a Changer that takes an object and returns another which should then be saved if applicable (the Changer includes the ChangeMode)\n-\t@Override\n-\t@Nullable\n-\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n-\t\tif (mode == ChangeMode.DELETE && (type.acceptChange & ~PLAYER) != 0 || mode == ChangeMode.RESET)\n-\t\t\treturn new Class[0];\n-\t\tif (mode != ChangeMode.SET)\n-\t\t\treturn null;\n-\t\tif ((type.acceptChange & PLAYER) != 0 && Player.class.isAssignableFrom(getExpr().getReturnType())) {\n-\t\t\tchangeType = PLAYER;\n-\t\t} else if ((type.acceptChange & INVENTORY) != 0 && Inventory.class.isAssignableFrom(getExpr().getReturnType())) {\n-\t\t\tchangeType = INVENTORY;\n-\t\t} else if ((type.acceptChange & ITEM) != 0 && (getExpr().isSingle() && ChangerUtils.acceptsChange(getExpr(), ChangeMode.SET, ItemStack.class, ItemType.class) || Slot.class.isAssignableFrom(getExpr().getReturnType()))) {\n-\t\t\tchangeType = ITEM;\n-\t\t} else if ((type.acceptChange & ENTITY) != 0 && Entity.class.isAssignableFrom(getExpr().getReturnType())) {\n-\t\t\tif (type == NameType.NAME && Player.class.isAssignableFrom(getExpr().getReturnType())) {\n-\t\t\t\tSkript.error(\"Can't change the Minecraft name of a player. Change the 'display name' or 'tab list name' instead.\");\n-\t\t\t\treturn null;\n-\t\t\t}\n-\t\t\tchangeType = ENTITY;\n-\t\t}\n-\t\treturn changeType == 0 ? null : CollectionUtils.array(String.class);\n-\t}\n-\n-\t@Override\n-\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n-\t\tString name = delta == null ? null : (String) delta[0];\n-\t\tif (changeType == ITEM) {\n-\t\t\tif (Slot.class.isAssignableFrom(getExpr().getReturnType())) {\n-\t\t\t\tfor (Slot s : (Slot[]) getExpr().getArray(e)) {\n-\t\t\t\t\tItemStack i = s.getItem();\n-\t\t\t\t\ttype.set(i, name);\n-\t\t\t\t\ts.setItem(i);\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\tObject i = getExpr().getSingle(e);\n-\t\t\t\tif (i instanceof ItemType) {\n-\t\t\t\t\ttype.set(i, name);\n-\t\t\t\t\tgetExpr().change(e, new ItemType[] {(ItemType) i}, ChangeMode.SET);\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\n-\t\t\t\tif (!(i instanceof ItemStack) && !(i instanceof Slot))\n-\t\t\t\t\treturn;\n-\t\t\t\tItemStack is = i instanceof Slot ? ((Slot) i).getItem() : (ItemStack) i;\n-\t\t\t\ttype.set(is, name);\n-\t\t\t\tif (i instanceof Slot)\n-\t\t\t\t\t((Slot) i).setItem(is);\n-\t\t\t\telse if (ChangerUtils.acceptsChange(getExpr(), ChangeMode.SET, ItemStack.class))\n-\t\t\t\t\tgetExpr().change(e, new Object[] {i}, ChangeMode.SET);\n-\t\t\t\telse\n-\t\t\t\t\tgetExpr().change(e, new ItemType[] {new ItemType((ItemStack) i)}, ChangeMode.SET);\n-\t\t\t}\n-\t\t} else {\n-\t\t\tfor (Object o : getExpr().getArray(e)) {\n-\t\t\t\tif (o instanceof Entity || o instanceof Inventory)\n-\t\t\t\t\ttype.set(o, name);\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\t@Override\n-\tpublic Class<String> getReturnType() {\n-\t\treturn String.class;\n-\t}\n-\n-\t@Override\n-\tprotected String getPropertyName() {\n-\t\treturn type.name;\n-\t}\n-\n-}\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.invoke.MethodType;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.bukkit.Bukkit;\n+import org.bukkit.ChatColor;\n+import org.bukkit.GameRule;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.entity.HumanEntity;\n+import org.bukkit.entity.LivingEntity;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.inventory.InventoryType;\n+import org.bukkit.inventory.Inventory;\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.inventory.meta.ItemMeta;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.classes.Changer.ChangerUtils;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.Variable;\n+import ch.njol.skript.util.slot.Slot;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Name / Display Name\")\n+@Description({\"Represents the Minecraft account, display or tab list name of a player, or the custom name of an item, entity, inventory, or gamerule.\",\n+\t\t\"\",\n+\t\t\"<ul>\",\n+\t\t\"\\t<li><strong>Players</strong>\",\n+\t\t\"\\t\\t<ul>\",\n+\t\t\"\\t\\t\\t<li><strong>Name:</strong> The Minecraft account name of the player. Can't be changed, but 'display name' can be changed.</li>\",\n+\t\t\"\\t\\t\\t<li><strong>Display Name:</strong> The name of the player that is displayed in messages. \" +\n+\t\t\t\"This name can be changed freely and can include colour codes, and is shared among all plugins (e.g. chat plugins will use the display name).</li>\",\n+\t\t\"\\t\\t</ul>\",\n+\t\t\"\\t</li>\",\n+\t\t\"\\t<li><strong>Entities</strong>\",\n+\t\t\"\\t\\t<ul>\",\n+\t\t\"\\t\\t\\t<li><strong>Name:</strong> The custom name of the entity. Can be changed. But for living entities, \" +\n+\t\t\t\"the players will have to target the entity to see its name tag. For non-living entities, the name will not be visible at all. To prevent this, use 'display name'.</li>\",\n+\t\t\"\\t\\t\\t<li><strong>Display Name:</strong> The custom name of the entity. Can be changed, \" +\n+\t\t\t\"which will also enable <em>custom name visibility</em> of the entity so name tag of the entity will be visible always.</li>\",\n+\t\t\"\\t\\t</ul>\",\n+\t\t\"\\t</li>\",\n+\t\t\"\\t<li><strong>Items</strong>\",\n+\t\t\"\\t\\t<ul>\",\n+\t\t\"\\t\\t\\t<li><strong>Name and Display Name:</strong> The <em>custom</em> name of the item (not the Minecraft locale name). Can be changed.</li>\",\n+\t\t\"\\t\\t</ul>\",\n+\t\t\"\\t</li>\",\n+\t\t\"\\t<li><strong>Inventories</strong>\",\n+\t\t\"\\t\\t<ul>\",\n+\t\t\"\\t\\t\\t<li><strong>Name and Display Name:</strong> The name/title of the inventory. \" +\n+\t\t\t\"Changing name of an inventory means opening the same inventory with the same contents but with a different name to its current viewers.</li>\",\n+\t\t\"\\t\\t</ul>\",\n+\t\t\"\\t</li>\",\n+\t\t\"\\t<li><strong>Gamerules (1.13+)</strong>\",\n+\t\t\"\\t\\t<ul>\",\n+\t\t\"\\t\\t\\t<li><strong>Name:</strong> The name of the gamerule. Cannot be changed.</li>\",\n+\t\t\"\\t\\t</ul>\",\n+\t\t\"\\t</li>\",\n+\t\t\"</ul>\"})\n+@Examples({\"on join:\",\n+\t\t\"\tplayer has permission \\\"name.red\\\"\",\n+\t\t\"\tset the player's display name to \\\"<red>[admin] <gold>%name of player%\\\"\",\n+\t\t\"\tset the player's tab list name to \\\"<green>%player's name%\\\"\",\n+\t\t\"set the name of the player's tool to \\\"Legendary Sword of Awesomeness\\\"\"})\n+@Since(\"before 2.1, 2.2-dev20 (inventory name), 2.4 (non-living entity support, changeable inventory name)\")\n+public class ExprName extends SimplePropertyExpression<Object, String> {\n+\n+\t@Nullable\n+\tstatic final MethodHandle TITLE_METHOD;\n+\tstatic final boolean HAS_GAMERULES;\n+\n+\tstatic {\n+\t\tHAS_GAMERULES = Skript.classExists(\"org.bukkit.GameRule\");\n+\t\tMethodHandle _METHOD = null;\n+\t\ttry {\n+\t\t\t_METHOD = MethodHandles.lookup().findVirtual(Inventory.class, \"getTitle\", MethodType.methodType(String.class));\n+\t\t} catch (IllegalAccessException | NoSuchMethodException ignored) {}\n+\t\tTITLE_METHOD = _METHOD;\n+\t}\n+\n+\tprivate final static int ITEM = 1, ENTITY = 2, PLAYER = 4, INVENTORY = 8;\n+\tfinal static String[] types = {\"itemstacks/slots\", \"entities\", \"players\", \"inventories\"};\n+\n+\tprivate enum NameType {\n+\t\tNAME(\"name\", \"name[s]\", PLAYER | ITEM | ENTITY | INVENTORY, ITEM | ENTITY | INVENTORY) {\n+\t\t\t@Override\n+\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\n+\t\t\t\tif (o == null)\n+\t\t\t\t\treturn;\n+\t\t\t\tif (o instanceof Entity) {\n+\t\t\t\t\t((Entity) o).setCustomName(name);\n+\t\t\t\t\tif (o instanceof LivingEntity)\n+\t\t\t\t\t\t((LivingEntity) o).setRemoveWhenFarAway(name == null);\n+\t\t\t\t} else if (o instanceof ItemType) {\n+\t\t\t\t\tItemMeta m = ((ItemType) o).getItemMeta();\n+\t\t\t\t\tm.setDisplayName(name);\n+\t\t\t\t\t((ItemType) o).setItemMeta(m);\n+\t\t\t\t} else if (o instanceof ItemStack) {\n+\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n+\t\t\t\t\tif (m != null) {\n+\t\t\t\t\t\tm.setDisplayName(name);\n+\t\t\t\t\t\t((ItemStack) o).setItemMeta(m);\n+\t\t\t\t\t}\n+\t\t\t\t} else if (o instanceof Inventory) {\n+\t\t\t\t\tInventory inventory = ((Inventory) o);\n+\t\t\t\t\tList<HumanEntity> viewers = new ArrayList<>(inventory.getViewers());\n+\t\t\t\t\tif (viewers.isEmpty())\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\tInventory copy;\n+\t\t\t\t\tInventoryType invType = inventory.getType();\n+\t\t\t\t\tif (!invType.isCreatable())\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\tif (invType == InventoryType.CHEST) {\n+\t\t\t\t\t\tif (name == null)\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize());\n+\t\t\t\t\t\telse\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize(), name);\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tif (name == null)\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType);\n+\t\t\t\t\t\telse\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType, name);\n+\t\t\t\t\t}\n+\t\t\t\t\tcopy.setContents(inventory.getContents());\n+\t\t\t\t\tviewers.forEach(human -> human.openInventory(copy));\n+\t\t\t\t} else {\n+\t\t\t\t\tassert false;\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\t@Nullable\n+\t\t\tString get(@Nullable Object o) {\n+\t\t\t\tif (o == null)\n+\t\t\t\t\treturn null;\n+\t\t\t\tif (o instanceof Player) {\n+\t\t\t\t\treturn ((Player) o).getName();\n+\t\t\t\t} else if (o instanceof Entity) {\n+\t\t\t\t\treturn ((Entity) o).getCustomName();\n+\t\t\t\t} else if (o instanceof ItemType) {\n+\t\t\t\t\tItemMeta m = ((ItemType) o).getItemMeta();\n+\t\t\t\t\treturn !m.hasDisplayName() ? null : m.getDisplayName();\n+\t\t\t\t} else if (o instanceof ItemStack) {\n+\t\t\t\t\tif (!((ItemStack) o).hasItemMeta())\n+\t\t\t\t\t\treturn null;\n+\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n+\t\t\t\t\treturn m == null || !m.hasDisplayName() ? null : m.getDisplayName();\n+\t\t\t\t} else if (o instanceof Inventory) {\n+\t\t\t\t\tif (TITLE_METHOD != null) {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\treturn ((String) TITLE_METHOD.invoke(o));\n+\t\t\t\t\t\t} catch (IllegalAccessException e) {\n+\t\t\t\t\t\t\tassert false;\n+\t\t\t\t\t\t\treturn null;\n+\t\t\t\t\t\t} catch (Throwable e) {\n+\t\t\t\t\t\t\tSkript.exception(e);\n+\t\t\t\t\t\t\treturn null;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t\treturn null;\n+\t\t\t\t} else if (HAS_GAMERULES && o instanceof GameRule) {\n+\t\t\t\t\treturn ((GameRule) o).getName();\n+\t\t\t\t} else {\n+\t\t\t\t\tassert false;\n+\t\t\t\t\treturn null;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t},\n+\t\tDISPLAY_NAME(\"display name\", \"(display|nick|chat)[ ]name[s]\", PLAYER | ITEM | ENTITY | INVENTORY, PLAYER | ITEM | ENTITY | INVENTORY) {\n+\t\t\t@Override\n+\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\n+\t\t\t\tif (o == null)\n+\t\t\t\t\treturn;\n+\t\t\t\tif (o instanceof Player) {\n+\t\t\t\t\t((Player) o).setDisplayName(name == null ? ((Player) o).getName() : name + ChatColor.RESET);\n+\t\t\t\t} else if (o instanceof Entity) {\n+\t\t\t\t\t((Entity) o).setCustomName(name);\n+\t\t\t\t\t((Entity) o).setCustomNameVisible(name != null);\n+\t\t\t\t\tif (o instanceof LivingEntity)\n+\t\t\t\t\t\t((LivingEntity) o).setRemoveWhenFarAway(name == null);\n+\t\t\t\t} else if (o instanceof ItemStack) {\n+\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n+\t\t\t\t\tif (m != null) {\n+\t\t\t\t\t\tm.setDisplayName(name);\n+\t\t\t\t\t\t((ItemStack) o).setItemMeta(m);\n+\t\t\t\t\t}\n+\t\t\t\t} else if (o instanceof Inventory) {\n+\t\t\t\t\tInventory inventory = ((Inventory) o);\n+\t\t\t\t\tList<HumanEntity> viewers = new ArrayList<>(inventory.getViewers());\n+\t\t\t\t\tif (viewers.isEmpty())\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\tInventory copy;\n+\t\t\t\t\tInventoryType invType = inventory.getType();\n+\t\t\t\t\tif (!invType.isCreatable())\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\tif (invType == InventoryType.CHEST) {\n+\t\t\t\t\t\tif (name == null)\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize());\n+\t\t\t\t\t\telse\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), inventory.getSize(), name);\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tif (name == null)\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType);\n+\t\t\t\t\t\telse\n+\t\t\t\t\t\t\tcopy = Bukkit.createInventory(inventory.getHolder(), invType, name);\n+\t\t\t\t\t}\n+\t\t\t\t\tcopy.setContents(inventory.getContents());\n+\t\t\t\t\tviewers.forEach(human -> human.openInventory(copy));\n+\t\t\t\t} else {\n+\t\t\t\t\tassert false;\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\t@Nullable\n+\t\t\tString get(@Nullable Object o) {\n+\t\t\t\tif (o == null)\n+\t\t\t\t\treturn null;\n+\t\t\t\tif (o instanceof Player) {\n+\t\t\t\t\treturn ((Player) o).getDisplayName();\n+\t\t\t\t} else if (o instanceof Entity) {\n+\t\t\t\t\treturn ((Entity) o).getCustomName();\n+\t\t\t\t} else if (o instanceof ItemStack) {\n+\t\t\t\t\tif (!((ItemStack) o).hasItemMeta())\n+\t\t\t\t\t\treturn null;\n+\t\t\t\t\tItemMeta m = ((ItemStack) o).getItemMeta();\n+\t\t\t\t\treturn m == null || !m.hasDisplayName() ? null : m.getDisplayName();\n+\t\t\t\t} else if (o instanceof Inventory) {\n+\t\t\t\t\tif (TITLE_METHOD != null) {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\treturn ((String) TITLE_METHOD.invoke(o));\n+\t\t\t\t\t\t} catch (IllegalAccessException e) {\n+\t\t\t\t\t\t\tassert false;\n+\t\t\t\t\t\t\treturn null;\n+\t\t\t\t\t\t} catch (Throwable e) {\n+\t\t\t\t\t\t\tSkript.exception(e);\n+\t\t\t\t\t\t\treturn null;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t\treturn null;\n+\t\t\t\t} else {\n+\t\t\t\t\tassert false;\n+\t\t\t\t\treturn null;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t},\n+\t\tTABLIST_NAME(\"player list name\", \"(player|tab)[ ]list name[s]\", PLAYER, PLAYER) {\n+\t\t\t@Override\n+\t\t\tvoid set(@Nullable Object o, @Nullable String name) {\n+\t\t\t\tif (o == null)\n+\t\t\t\t\treturn;\n+\t\t\t\tif (o instanceof Player) {\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\t((Player) o).setPlayerListName(name == null ? \"\" : name);\n+\t\t\t\t\t} catch (IllegalArgumentException ignored) {}\n+\t\t\t\t} else {\n+\t\t\t\t\tassert false;\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\t@Nullable\n+\t\t\tString get(@Nullable Object o) {\n+\t\t\t\tif (o == null)\n+\t\t\t\t\treturn null;\n+\t\t\t\tif (o instanceof Player) {\n+\t\t\t\t\treturn ((Player) o).getPlayerListName();\n+\t\t\t\t} else {\n+\t\t\t\t\tassert false;\n+\t\t\t\t\treturn null;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t};\n+\n+\t\tfinal String name;\n+\t\tfinal String pattern;\n+\t\tfinal int from;\n+\t\tfinal int acceptChange;\n+\n+\t\tNameType(String name, String pattern, int from, int change) {\n+\t\t\tthis.name = name;\n+\t\t\tthis.pattern = \"(\" + ordinal() + \"\u00a6)\" + pattern;\n+\t\t\tthis.from = from;\n+\t\t\tacceptChange = change;\n+\t\t}\n+\n+\t\tabstract void set(@Nullable Object o, @Nullable String s);\n+\n+\t\t@Nullable\n+\t\tabstract String get(@Nullable Object o);\n+\n+\t\tString getFrom() {\n+\t\t\tStringBuilder b = new StringBuilder();\n+\t\t\tfor (int i = 0; i < types.length; i++) {\n+\t\t\t\tif ((from & (1 << i)) == 0)\n+\t\t\t\t\tcontinue;\n+\t\t\t\tif ((1 << i) == ITEM && !Skript.isRunningMinecraft(1, 4, 5))\n+\t\t\t\t\tcontinue;\n+\t\t\t\tif ((1 << i) == ENTITY && !Skript.isRunningMinecraft(1, 5))\n+\t\t\t\t\tcontinue;\n+\t\t\t\tif (b.length() != 0)\n+\t\t\t\t\tb.append(\"/\");\n+\t\t\t\tb.append(types[i]);\n+\t\t\t}\n+\t\t\treturn \"\" + b;\n+\t\t}\n+\t}\n+\n+\tstatic {\n+\t\tfor (NameType n : NameType.values())\n+\t\t\tregister(ExprName.class, String.class, n.pattern, n.getFrom());\n+\t}\n+\n+\t@SuppressWarnings(\"null\")\n+\tprivate NameType type;\n+\n+\t@SuppressWarnings({\"null\", \"unchecked\"})\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\ttype = NameType.values()[parseResult.mark];\n+\t\tif (exprs[0] instanceof Variable)\n+\t\t\tsetExpr(exprs[0].getConvertedExpression(Object.class));\n+\t\telse\n+\t\t\tsetExpr(exprs[0]);\n+\t\treturn true;\n+\t}\n+\n+\t@Override\n+\t@Nullable\n+\tpublic String convert(Object o) {\n+\t\treturn type.get(o instanceof Slot ? ((Slot) o).getItem() : o);\n+\t}\n+\n+\tprivate int changeType = 0;\n+\n+\t// TODO find a better method for handling changes (in general)\n+\t// e.g. a Changer that takes an object and returns another which should then be saved if applicable (the Changer includes the ChangeMode)\n+\t@Override\n+\t@Nullable\n+\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n+\t\tif (mode == ChangeMode.DELETE && (type.acceptChange & ~PLAYER) != 0 || mode == ChangeMode.RESET)\n+\t\t\treturn new Class[0];\n+\t\tif (mode != ChangeMode.SET)\n+\t\t\treturn null;\n+\t\tif ((type.acceptChange & PLAYER) != 0 && Player.class.isAssignableFrom(getExpr().getReturnType())) {\n+\t\t\tchangeType = PLAYER;\n+\t\t} else if ((type.acceptChange & INVENTORY) != 0 && Inventory.class.isAssignableFrom(getExpr().getReturnType())) {\n+\t\t\tchangeType = INVENTORY;\n+\t\t} else if ((type.acceptChange & ITEM) != 0 && (getExpr().isSingle() && ChangerUtils.acceptsChange(getExpr(), ChangeMode.SET, ItemStack.class, ItemType.class) || Slot.class.isAssignableFrom(getExpr().getReturnType()))) {\n+\t\t\tchangeType = ITEM;\n+\t\t} else if ((type.acceptChange & ENTITY) != 0 && Entity.class.isAssignableFrom(getExpr().getReturnType())) {\n+\t\t\tif (type == NameType.NAME && Player.class.isAssignableFrom(getExpr().getReturnType())) {\n+\t\t\t\tSkript.error(\"Can't change the Minecraft name of a player. Change the 'display name' or 'tab list name' instead.\");\n+\t\t\t\treturn null;\n+\t\t\t}\n+\t\t\tchangeType = ENTITY;\n+\t\t}\n+\t\treturn changeType == 0 ? null : CollectionUtils.array(String.class);\n+\t}\n+\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n+\t\tString name = delta == null ? null : (String) delta[0];\n+\t\tif (changeType == ITEM) {\n+\t\t\tif (Slot.class.isAssignableFrom(getExpr().getReturnType())) {\n+\t\t\t\tfor (Slot s : (Slot[]) getExpr().getArray(e)) {\n+\t\t\t\t\tItemStack i = s.getItem();\n+\t\t\t\t\ttype.set(i, name);\n+\t\t\t\t\ts.setItem(i);\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tObject i = getExpr().getSingle(e);\n+\t\t\t\tif (i instanceof ItemType) {\n+\t\t\t\t\ttype.set(i, name);\n+\t\t\t\t\tgetExpr().change(e, new ItemType[] {(ItemType) i}, ChangeMode.SET);\n+\t\t\t\t\treturn;\n+\t\t\t\t}\n+\n+\t\t\t\tif (!(i instanceof ItemStack) && !(i instanceof Slot))\n+\t\t\t\t\treturn;\n+\t\t\t\tItemStack is = i instanceof Slot ? ((Slot) i).getItem() : (ItemStack) i;\n+\t\t\t\ttype.set(is, name);\n+\t\t\t\tif (i instanceof Slot)\n+\t\t\t\t\t((Slot) i).setItem(is);\n+\t\t\t\telse if (ChangerUtils.acceptsChange(getExpr(), ChangeMode.SET, ItemStack.class))\n+\t\t\t\t\tgetExpr().change(e, new Object[] {i}, ChangeMode.SET);\n+\t\t\t\telse\n+\t\t\t\t\tgetExpr().change(e, new ItemType[] {new ItemType((ItemStack) i)}, ChangeMode.SET);\n+\t\t\t}\n+\t\t} else {\n+\t\t\tfor (Object o : getExpr().getArray(e)) {\n+\t\t\t\tif (o instanceof Entity || o instanceof Inventory)\n+\t\t\t\t\ttype.set(o, name);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic Class<String> getReturnType() {\n+\t\treturn String.class;\n+\t}\n+\n+\t@Override\n+\tprotected String getPropertyName() {\n+\t\treturn type.name;\n+\t}\n+\n+}\n"}}, {"oid": "1c7dfd8f1b94cd3273ffb577122dacd6cf0f2e4a", "url": "https://github.com/SkriptLang/Skript/commit/1c7dfd8f1b94cd3273ffb577122dacd6cf0f2e4a", "message": "revert LF to CRLF", "committedDate": "2020-07-18T02:55:58Z", "type": "commit"}, {"oid": "2fa51c464fb5bbd0d36f4c68da8acb7790b34a60", "url": "https://github.com/SkriptLang/Skript/commit/2fa51c464fb5bbd0d36f4c68da8acb7790b34a60", "message": "Fix conflicts", "committedDate": "2020-07-18T03:34:11Z", "type": "commit"}, {"oid": "e15c5b318532ac5ed97e640d14ae38d742e522a1", "url": "https://github.com/SkriptLang/Skript/commit/e15c5b318532ac5ed97e640d14ae38d742e522a1", "message": "fix more conflicts", "committedDate": "2020-07-18T03:40:03Z", "type": "commit"}, {"oid": "63b785058cd8621c76c0bfb96fde2c40dd92c8e4", "url": "https://github.com/SkriptLang/Skript/commit/63b785058cd8621c76c0bfb96fde2c40dd92c8e4", "message": "Merge branch 'master' of https://github.com/SkriptLang/Skript into gamerules", "committedDate": "2020-07-18T05:54:40Z", "type": "commit"}, {"oid": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "url": "https://github.com/SkriptLang/Skript/commit/575bf3cbd729d8a280320f040c8eae1e82123f1c", "message": "remove settings changes", "committedDate": "2020-07-18T06:02:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzMyNw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456833327", "bodyText": "Does this work with ExprName properly? You should need to add game rules to the accepted values (unless it already works?)", "author": "APickledWalrus", "createdAt": "2020-07-18T22:17:16Z", "path": "src/main/java/ch/njol/skript/expressions/ExprName.java", "diffHunk": "@@ -94,13 +100,14 @@\n \r\n \t@Nullable\r\n \tstatic final MethodHandle TITLE_METHOD;\r\n+\tstatic final boolean HAS_GAMERULES;\r\n \r\n \tstatic {\r\n+\t\tHAS_GAMERULES = Skript.classExists(\"org.bukkit.GameRule\");\r\n \t\tregister(ExprName.class, String.class, \"(1\u00a6name[s]|2\u00a6(display|nick|chat|custom)[ ]name[s])\", \"players/entities/itemtypes/inventories/slots\");\r", "originalCommit": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5NzQyMw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456997423", "bodyText": "Fixed \ud83d\udc4d", "author": "chatasma", "createdAt": "2020-07-20T02:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzMyNw=="}], "type": "inlineReview", "revised_code": {"commit": "e58870ac4db1054dd348a24a6e121648ead67c6b", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprName.java b/src/main/java/ch/njol/skript/expressions/ExprName.java\nindex 186b70aa..90edd73c 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprName.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprName.java\n\n@@ -104,7 +104,7 @@ public class ExprName extends SimplePropertyExpression<Object, String> {\n \n \tstatic {\n \t\tHAS_GAMERULES = Skript.classExists(\"org.bukkit.GameRule\");\n-\t\tregister(ExprName.class, String.class, \"(1\u00a6name[s]|2\u00a6(display|nick|chat|custom)[ ]name[s])\", \"players/entities/itemtypes/inventories/slots\");\n+\t\tregister(ExprName.class, String.class, \"(1\u00a6name[s]|2\u00a6(display|nick|chat|custom)[ ]name[s])\", \"players/entities/itemtypes/inventories/slots/gamerules\");\n \t\tregister(ExprName.class, String.class, \"(3\u00a6(player|tab)[ ]list name[s])\", \"players\");\n \n \t\t// Get the old method for getting the name of an inventory.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzE4Nw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456833187", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t.usage(Arrays.stream(GameRule.values()).map(GameRule::getName).collect(Collectors.joining()))\n          \n          \n            \n            \t\t\t\t.usage(Arrays.stream(GameRule.values()).map(GameRule::getName).collect(Collectors.joining(\", \")))", "author": "FranKusmiruk", "createdAt": "2020-07-18T22:15:02Z", "path": "src/main/java/ch/njol/skript/classes/data/BukkitClasses.java", "diffHunk": "@@ -1721,6 +1724,40 @@ public String getVariableNamePattern() {\n \t\t\t\t\t})\n \t\t\t\t\t.serializer(new EnumSerializer<>(Cat.Type.class)));\n \t\t}\n+\n+\t\tif (Skript.classExists(\"org.bukkit.GameRule\")) {\n+\t\t\tClasses.registerClass(new ClassInfo<>(GameRule.class, \"gamerule\")\n+\t\t\t\t.user(\"gamerules?\")\n+\t\t\t\t.name(\"Gamerule\")\n+\t\t\t\t.description(\"A gamerule\")\n+\t\t\t\t.usage(Arrays.stream(GameRule.values()).map(GameRule::getName).collect(Collectors.joining()))", "originalCommit": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e58870ac4db1054dd348a24a6e121648ead67c6b", "chunk": "diff --git a/src/main/java/ch/njol/skript/classes/data/BukkitClasses.java b/src/main/java/ch/njol/skript/classes/data/BukkitClasses.java\nindex 083386af..bc0dd0cf 100644\n--- a/src/main/java/ch/njol/skript/classes/data/BukkitClasses.java\n+++ b/src/main/java/ch/njol/skript/classes/data/BukkitClasses.java\n\n@@ -1730,7 +1730,7 @@ public class BukkitClasses {\n \t\t\t\t.user(\"gamerules?\")\n \t\t\t\t.name(\"Gamerule\")\n \t\t\t\t.description(\"A gamerule\")\n-\t\t\t\t.usage(Arrays.stream(GameRule.values()).map(GameRule::getName).collect(Collectors.joining()))\n+\t\t\t\t.usage(Arrays.stream(GameRule.values()).map(GameRule::getName).collect(Collectors.joining(\", \")))\n \t\t\t\t.since(\"INSERT VERSION\")\n \t\t\t\t.requiredPlugins(\"Minecraft 1.13 or newer\")\n \t\t\t\t.parser(new Parser<GameRule>() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzMxMw==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456833313", "bodyText": "Changer.ChangeMode should be imported directly", "author": "FranKusmiruk", "createdAt": "2020-07-18T22:17:06Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.RequiredPlugins;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n+@Examples({\"set the gamerule commandBlockOutput of world \\\"world\\\" to false\"})\n+@Since(\"INSERT VERSION\")\n+@RequiredPlugins(\"Minecraft 1.13+\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n+\t\n+\tstatic {\n+\t\tif (Skript.classExists(\"org.bukkit.GameRule\")) {\n+\t\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n+\t\t}\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<GameRule> gamerule;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<World> world;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n+\t\tworld = (Expression<World>) exprs[1];\n+\t\treturn true;\n+\t}\n+\t\n+\t@Override\n+\t@Nullable\n+\tpublic Class<?>[] acceptChange(final Changer.ChangeMode mode) {", "originalCommit": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e58870ac4db1054dd348a24a6e121648ead67c6b", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex cddef534..84301423 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -25,7 +25,7 @@ import org.bukkit.event.Event;\n import org.eclipse.jdt.annotation.Nullable;\n \n import ch.njol.skript.Skript;\n-import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n import ch.njol.skript.doc.Description;\n import ch.njol.skript.doc.Examples;\n import ch.njol.skript.doc.Name;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzM4MA==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456833380", "bodyText": "You can take in Boolean.class and Number.class instead", "author": "FranKusmiruk", "createdAt": "2020-07-18T22:17:52Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.RequiredPlugins;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n+@Examples({\"set the gamerule commandBlockOutput of world \\\"world\\\" to false\"})\n+@Since(\"INSERT VERSION\")\n+@RequiredPlugins(\"Minecraft 1.13+\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n+\t\n+\tstatic {\n+\t\tif (Skript.classExists(\"org.bukkit.GameRule\")) {\n+\t\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n+\t\t}\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<GameRule> gamerule;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<World> world;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n+\t\tworld = (Expression<World>) exprs[1];\n+\t\treturn true;\n+\t}\n+\t\n+\t@Override\n+\t@Nullable\n+\tpublic Class<?>[] acceptChange(final Changer.ChangeMode mode) {\n+\t\tif (mode == Changer.ChangeMode.SET) return CollectionUtils.array(Object.class);", "originalCommit": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e58870ac4db1054dd348a24a6e121648ead67c6b", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex cddef534..84301423 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -25,7 +25,7 @@ import org.bukkit.event.Event;\n import org.eclipse.jdt.annotation.Nullable;\n \n import ch.njol.skript.Skript;\n-import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n import ch.njol.skript.doc.Description;\n import ch.njol.skript.doc.Examples;\n import ch.njol.skript.doc.Name;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzQwOA==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456833408", "bodyText": "Return should be on the next line", "author": "FranKusmiruk", "createdAt": "2020-07-18T22:18:26Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.RequiredPlugins;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n+@Examples({\"set the gamerule commandBlockOutput of world \\\"world\\\" to false\"})\n+@Since(\"INSERT VERSION\")\n+@RequiredPlugins(\"Minecraft 1.13+\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n+\t\n+\tstatic {\n+\t\tif (Skript.classExists(\"org.bukkit.GameRule\")) {\n+\t\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n+\t\t}\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<GameRule> gamerule;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<World> world;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n+\t\tworld = (Expression<World>) exprs[1];\n+\t\treturn true;\n+\t}\n+\t\n+\t@Override\n+\t@Nullable\n+\tpublic Class<?>[] acceptChange(final Changer.ChangeMode mode) {\n+\t\tif (mode == Changer.ChangeMode.SET) return CollectionUtils.array(Object.class);\n+\t\treturn null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(final Event e, final @Nullable Object[] delta, final Changer.ChangeMode mode) {\n+\t\tassert delta != null;\n+\t\tif (mode == Changer.ChangeMode.SET) {\n+\t\t\tGameRule bukkitGamerule = gamerule.getSingle(e);\n+\t\t\tif (bukkitGamerule == null) return;", "originalCommit": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e58870ac4db1054dd348a24a6e121648ead67c6b", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex cddef534..84301423 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -25,7 +25,7 @@ import org.bukkit.event.Event;\n import org.eclipse.jdt.annotation.Nullable;\n \n import ch.njol.skript.Skript;\n-import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n import ch.njol.skript.doc.Description;\n import ch.njol.skript.doc.Examples;\n import ch.njol.skript.doc.Name;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzQ0NQ==", "url": "https://github.com/SkriptLang/Skript/pull/2974#discussion_r456833445", "bodyText": "the following statement to the for loop should also be on its own line", "author": "FranKusmiruk", "createdAt": "2020-07-18T22:19:04Z", "path": "src/main/java/ch/njol/skript/expressions/ExprGameRule.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/**\n+ *   This file is part of Skript.\n+ *\n+ *  Skript is free software: you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation, either version 3 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  Skript is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.GameRule;\n+import org.bukkit.World;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.RequiredPlugins;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.util.GameruleValue;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Gamerule Value\")\n+@Description(\"The gamerule value of a world.\")\n+@Examples({\"set the gamerule commandBlockOutput of world \\\"world\\\" to false\"})\n+@Since(\"INSERT VERSION\")\n+@RequiredPlugins(\"Minecraft 1.13+\")\n+public class ExprGameRule extends SimpleExpression<GameruleValue> {\n+\t\n+\tstatic {\n+\t\tif (Skript.classExists(\"org.bukkit.GameRule\")) {\n+\t\t\tSkript.registerExpression(ExprGameRule.class, GameruleValue.class, ExpressionType.COMBINED,\n+\t\t\t\t\"[the] gamerule %gamerule% of %worlds%\");\n+\t\t}\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<GameRule> gamerule;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<World> world;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tgamerule = (Expression<GameRule>) exprs[0];\n+\t\tworld = (Expression<World>) exprs[1];\n+\t\treturn true;\n+\t}\n+\t\n+\t@Override\n+\t@Nullable\n+\tpublic Class<?>[] acceptChange(final Changer.ChangeMode mode) {\n+\t\tif (mode == Changer.ChangeMode.SET) return CollectionUtils.array(Object.class);\n+\t\treturn null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(final Event e, final @Nullable Object[] delta, final Changer.ChangeMode mode) {\n+\t\tassert delta != null;\n+\t\tif (mode == Changer.ChangeMode.SET) {\n+\t\t\tGameRule bukkitGamerule = gamerule.getSingle(e);\n+\t\t\tif (bukkitGamerule == null) return;\n+\t\t\tfor (World gameruleWorld : world.getArray(e)) gameruleWorld.setGameRule(bukkitGamerule, delta[0]);", "originalCommit": "575bf3cbd729d8a280320f040c8eae1e82123f1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e58870ac4db1054dd348a24a6e121648ead67c6b", "chunk": "diff --git a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\nindex cddef534..84301423 100644\n--- a/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n+++ b/src/main/java/ch/njol/skript/expressions/ExprGameRule.java\n\n@@ -25,7 +25,7 @@ import org.bukkit.event.Event;\n import org.eclipse.jdt.annotation.Nullable;\n \n import ch.njol.skript.Skript;\n-import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n import ch.njol.skript.doc.Description;\n import ch.njol.skript.doc.Examples;\n import ch.njol.skript.doc.Name;\n"}}, {"oid": "e58870ac4db1054dd348a24a6e121648ead67c6b", "url": "https://github.com/SkriptLang/Skript/commit/e58870ac4db1054dd348a24a6e121648ead67c6b", "message": "ExprName fix and minor changes", "committedDate": "2020-07-18T22:47:40Z", "type": "commit"}, {"oid": "d4606185381ad0afc775093dbe4502a4f460282b", "url": "https://github.com/SkriptLang/Skript/commit/d4606185381ad0afc775093dbe4502a4f460282b", "message": "Conditionally add gamerule type to Expr", "committedDate": "2020-07-18T23:26:32Z", "type": "commit"}, {"oid": "675bf890560afec0fa3c6e109c98eee8fed01129", "url": "https://github.com/SkriptLang/Skript/commit/675bf890560afec0fa3c6e109c98eee8fed01129", "message": "Resolve BukkitClasses conflict", "committedDate": "2020-07-20T20:25:41Z", "type": "commit"}]}