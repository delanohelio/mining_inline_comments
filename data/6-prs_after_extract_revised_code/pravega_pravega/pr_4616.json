{"pr_number": 4616, "pr_title": "Issue 3865 unify test utils assert extensions", "pr_createdAt": "2020-03-11T17:53:57Z", "pr_url": "https://github.com/pravega/pravega/pull/4616", "timeline": [{"oid": "421428d8e80d95d781c08ed0540b0e655b722405", "url": "https://github.com/pravega/pravega/commit/421428d8e80d95d781c08ed0540b0e655b722405", "message": "Utilize TestUtils.await within assertEventuallyEquals method\n\nSigned-off-by: co-jo <Colin.Hryniowski@emc.com>", "committedDate": "2020-01-29T18:15:26Z", "type": "commit"}, {"oid": "3ae46abc4c120e1bedeb77658068179e7fc8ded2", "url": "https://github.com/pravega/pravega/commit/3ae46abc4c120e1bedeb77658068179e7fc8ded2", "message": "Do not log error to console. Remove duplicate code.\n\nSigned-off-by: co-jo <Colin.Hryniowski@emc.com>", "committedDate": "2020-01-29T22:17:15Z", "type": "commit"}, {"oid": "abac889d590115b8420c22470d5de87b1d9f7efc", "url": "https://github.com/pravega/pravega/commit/abac889d590115b8420c22470d5de87b1d9f7efc", "message": "Merge remote-tracking branch 'upstream/master' into issue-3865-unify-test-utils-assert-extensions", "committedDate": "2020-03-10T22:55:42Z", "type": "commit"}, {"oid": "ac649c7817cf66e1b34718af054c01a45334ac39", "url": "https://github.com/pravega/pravega/commit/ac649c7817cf66e1b34718af054c01a45334ac39", "message": "Merge branch 'master' into issue-3865-unify-test-utils-assert-extensions", "committedDate": "2020-03-11T18:00:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNTgyMw==", "url": "https://github.com/pravega/pravega/pull/4616#discussion_r392325823", "bodyText": "You need to handle the case when expected is null as well. Check the condition above.", "author": "andreipaduroiu", "createdAt": "2020-03-13T16:10:46Z", "path": "test/testcommon/src/main/java/io/pravega/test/common/AssertExtensions.java", "diffHunk": "@@ -56,15 +56,13 @@\n      * @throws Exception            If the is an assertion error, and exception from `eval`, or the thread is interrupted.\n      */\n     private static <T> void assertEventuallyEquals(T expected, Callable<T> eval, int checkIntervalMillis, long timeoutMillis) throws Exception {\n-        long currentTime = System.currentTimeMillis();\n-        long endTime = currentTime + timeoutMillis;\n-        while (currentTime < endTime) {\n-            if ((expected == null && eval.call() == null) || (expected != null && expected.equals(eval.call()))) {\n-                return;\n-            }\n-            Thread.sleep(checkIntervalMillis);\n-            currentTime = System.currentTimeMillis();\n-        }\n+        TestUtils.await(() -> {\n+                try {\n+                    return expected.equals(eval.call());", "originalCommit": "ac649c7817cf66e1b34718af054c01a45334ac39", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a17abca735aa91ed065cb301b44fbb245150c12e", "chunk": "diff --git a/test/testcommon/src/main/java/io/pravega/test/common/AssertExtensions.java b/test/testcommon/src/main/java/io/pravega/test/common/AssertExtensions.java\nindex eff9f967ba..a8899d7653 100644\n--- a/test/testcommon/src/main/java/io/pravega/test/common/AssertExtensions.java\n+++ b/test/testcommon/src/main/java/io/pravega/test/common/AssertExtensions.java\n\n@@ -58,7 +58,7 @@ public class AssertExtensions {\n     private static <T> void assertEventuallyEquals(T expected, Callable<T> eval, int checkIntervalMillis, long timeoutMillis) throws Exception {\n         TestUtils.await(() -> {\n                 try {\n-                    return expected.equals(eval.call());\n+                    return (expected == null && eval.call() == null) || (expected != null && expected.equals(eval.call()));\n                 } catch (Exception e) {\n                     throw new RuntimeException(e);\n                 }\n"}}, {"oid": "8070af36a5b4addf4d61ec99a6e4b3413277ef85", "url": "https://github.com/pravega/pravega/commit/8070af36a5b4addf4d61ec99a6e4b3413277ef85", "message": "Merge branch 'master' into issue-3865-unify-test-utils-assert-extensions", "committedDate": "2020-03-13T16:13:25Z", "type": "commit"}, {"oid": "d71296cad77b65e64bfb13a918881445067c130f", "url": "https://github.com/pravega/pravega/commit/d71296cad77b65e64bfb13a918881445067c130f", "message": "Merge branch 'master' into issue-3865-unify-test-utils-assert-extensions", "committedDate": "2020-03-18T11:58:09Z", "type": "commit"}, {"oid": "339e1c034edfa6cd446f9b338d720f9a722b4611", "url": "https://github.com/pravega/pravega/commit/339e1c034edfa6cd446f9b338d720f9a722b4611", "message": "Merge branch 'master' into issue-3865-unify-test-utils-assert-extensions", "committedDate": "2020-03-18T17:47:48Z", "type": "commit"}, {"oid": "a17abca735aa91ed065cb301b44fbb245150c12e", "url": "https://github.com/pravega/pravega/commit/a17abca735aa91ed065cb301b44fbb245150c12e", "message": "Cover the case where expected may or may not be null.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-03-18T18:37:15Z", "type": "commit"}]}