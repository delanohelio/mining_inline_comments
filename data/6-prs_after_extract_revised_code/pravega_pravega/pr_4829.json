{"pr_number": 4829, "pr_title": "Issue 4791: Add a new controller API to fetch segments for a given epoch.", "pr_createdAt": "2020-05-28T16:07:27Z", "pr_url": "https://github.com/pravega/pravega/pull/4829", "timeline": [{"oid": "2adde002b07d1b2f88a23e0c1d9ec33bfa640c39", "url": "https://github.com/pravega/pravega/commit/2adde002b07d1b2f88a23e0c1d9ec33bfa640c39", "message": "First Version.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-05-28T10:31:49Z", "type": "commit"}, {"oid": "9a3df2a87c0fc959afc6cd4764435ac8618ee926", "url": "https://github.com/pravega/pravega/commit/9a3df2a87c0fc959afc6cd4764435ac8618ee926", "message": "Add integration test.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-05-28T16:01:36Z", "type": "commit"}, {"oid": "4d9a8e832d54a1e2285a05b6942c1e3fce83e779", "url": "https://github.com/pravega/pravega/commit/4d9a8e832d54a1e2285a05b6942c1e3fce83e779", "message": "Merge branch 'master' into issue-4791", "committedDate": "2020-05-28T16:14:02Z", "type": "commit"}, {"oid": "f4b38fa5fb9eaeadcb1ed6273f80bf3730c67f30", "url": "https://github.com/pravega/pravega/commit/f4b38fa5fb9eaeadcb1ed6273f80bf3730c67f30", "message": "Fix checkstyle.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-05-29T03:56:39Z", "type": "commit"}, {"oid": "c651430eb055b76e99f37a2350f77442e0db4e7c", "url": "https://github.com/pravega/pravega/commit/c651430eb055b76e99f37a2350f77442e0db4e7c", "message": "Merge branch 'master' into issue-4791", "committedDate": "2020-05-29T06:48:49Z", "type": "commit"}, {"oid": "1e0f6c2e3478ed797565069d468b63c1e653f58d", "url": "https://github.com/pravega/pravega/commit/1e0f6c2e3478ed797565069d468b63c1e653f58d", "message": "client junits.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-05-29T08:52:16Z", "type": "commit"}, {"oid": "aac4cfd233d734a20c4e940305d45b86ebf4085a", "url": "https://github.com/pravega/pravega/commit/aac4cfd233d734a20c4e940305d45b86ebf4085a", "message": "Controller client junits.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-05-29T09:10:00Z", "type": "commit"}, {"oid": "56d97104fdd871e56f30e9f1b785ae8fc567512e", "url": "https://github.com/pravega/pravega/commit/56d97104fdd871e56f30e9f1b785ae8fc567512e", "message": "Controller junit tests.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-05-29T09:34:50Z", "type": "commit"}, {"oid": "d3c8d8dbaab60fae196afb0f05fd508903ce937e", "url": "https://github.com/pravega/pravega/commit/d3c8d8dbaab60fae196afb0f05fd508903ce937e", "message": "Merge branch 'master' into issue-4791", "committedDate": "2020-06-01T02:11:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1MjgzNw==", "url": "https://github.com/pravega/pravega/pull/4829#discussion_r433952837", "bodyText": "question: why do we need to get the segments for a txn again? when you create a txn, controller returns the txn segments, right?\nso when is this getTxn api useful?", "author": "shiveshr", "createdAt": "2020-06-02T15:12:12Z", "path": "client/src/main/java/io/pravega/client/stream/impl/TransactionalEventStreamWriterImpl.java", "diffHunk": "@@ -198,13 +199,19 @@ private void throwIfClosed() throws TxnFailedException {\n \n     @Override\n     public Transaction<Type> getTxn(UUID txId) {\n-        StreamSegments segments = getAndHandleExceptions(\n-                controller.getCurrentSegments(stream.getScope(), stream.getStreamName()), RuntimeException::new);\n+        // check if the transaction is open.\n         Status status = getAndHandleExceptions(controller.checkTransactionStatus(stream, txId), RuntimeException::new);\n         if (status != Status.OPEN) {\n             return new TransactionImpl<>(writerId, txId, controller, stream);\n         }\n-        \n+", "originalCommit": "d3c8d8dbaab60fae196afb0f05fd508903ce937e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwMjI0OA==", "url": "https://github.com/pravega/pravega/pull/4829#discussion_r434002248", "bodyText": "TransactionalEventStreamWriter enables users to created transactions. The user can use\n\nTransactionalEventStreamWriter#beginTxn() to create a new transaction\nTransactionalEventStreamWriter#getTxn(UUID txnId) to fetch an already created transaction given its id. This is useful when the user knows a txnId and wants to perform operations on that transaction.\n\nBoth the above APIs return a io.pravega.client.stream.Transaction using which the user can\na. Write events to a transaction, Transaction#writeEvent\nb. Commit a transaction, Transaction#commit() \nc. Abort a transaction, Transaction#abort()\nd. Check the status of the transaction Transaction#checkStatus().\nThe new controller API ensures the correct segments are fetched when the user uses  [2.] getTxn(txnId) API.", "author": "shrids", "createdAt": "2020-06-02T16:12:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1MjgzNw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "e2998ade43245e9a1ba3973144170a95668ed72d", "url": "https://github.com/pravega/pravega/commit/e2998ade43245e9a1ba3973144170a95668ed72d", "message": "Merge branch 'master' into issue-4791", "committedDate": "2020-06-02T15:15:39Z", "type": "commit"}]}