{"pr_number": 4906, "pr_title": "Issue 4893: Add Scopes Metrics", "pr_createdAt": "2020-06-26T07:29:48Z", "pr_url": "https://github.com/pravega/pravega/pull/4906", "timeline": [{"oid": "c26d061f1c92991787a746f9b017343312980838", "url": "https://github.com/pravega/pravega/commit/c26d061f1c92991787a746f9b017343312980838", "message": "Initial commit.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-25T18:22:55Z", "type": "commit"}, {"oid": "39c6427de296f69b9fcb3963a0a5a73983820e68", "url": "https://github.com/pravega/pravega/commit/39c6427de296f69b9fcb3963a0a5a73983820e68", "message": "Fixed methods to report scope metrics.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-25T18:41:36Z", "type": "commit"}, {"oid": "a14464590b2dda294551bfe0b7f2f7b0b8fb438b", "url": "https://github.com/pravega/pravega/commit/a14464590b2dda294551bfe0b7f2f7b0b8fb438b", "message": "Added test for stream and scope metrics.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-26T07:10:33Z", "type": "commit"}, {"oid": "48f8091d5b5ad98d2af7576a42610e1fb6f6bb70", "url": "https://github.com/pravega/pravega/commit/48f8091d5b5ad98d2af7576a42610e1fb6f6bb70", "message": "Close scope latency metrics.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-26T07:23:12Z", "type": "commit"}, {"oid": "48e940f66f6fe4919e907123546ded80bc6b91fc", "url": "https://github.com/pravega/pravega/commit/48e940f66f6fe4919e907123546ded80bc6b91fc", "message": "Fixed test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-26T13:37:45Z", "type": "commit"}, {"oid": "6e41b57db47d1da8950d9dbb96fbaf36ac7b9aff", "url": "https://github.com/pravega/pravega/commit/6e41b57db47d1da8950d9dbb96fbaf36ac7b9aff", "message": "Added metrics tests for failed operations.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-29T10:36:34Z", "type": "commit"}, {"oid": "ca6727b64339ebc76b9b9a1cd74d8c9e03d82cf5", "url": "https://github.com/pravega/pravega/commit/ca6727b64339ebc76b9b9a1cd74d8c9e03d82cf5", "message": "Added metrics tests for failed operations.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-29T13:34:53Z", "type": "commit"}, {"oid": "b6461fced5f72e91aef2918b6c35abeeff4c366c", "url": "https://github.com/pravega/pravega/commit/b6461fced5f72e91aef2918b6c35abeeff4c366c", "message": "Merge branch 'master' into issue-4893-scopes-metrics", "committedDate": "2020-06-29T19:11:20Z", "type": "commit"}, {"oid": "5673dc8a9796d408999e98c7c5b506e014c7c641", "url": "https://github.com/pravega/pravega/commit/5673dc8a9796d408999e98c7c5b506e014c7c641", "message": "Add update stream metric test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-30T08:05:30Z", "type": "commit"}, {"oid": "c4e32d5f1342a7afe803633d37fa2a64c737b1bc", "url": "https://github.com/pravega/pravega/commit/c4e32d5f1342a7afe803633d37fa2a64c737b1bc", "message": "Add update stream metric test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-30T09:39:05Z", "type": "commit"}, {"oid": "bbc4b6e5483a35217e79e5193a5b94e01185f128", "url": "https://github.com/pravega/pravega/commit/bbc4b6e5483a35217e79e5193a5b94e01185f128", "message": "Added more coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-06-30T15:59:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3MTQ5OA==", "url": "https://github.com/pravega/pravega/pull/4906#discussion_r448171498", "bodyText": "this is counting how many scopes this controller instance has created so far.. right?\nif the intention for this metrics is to be per controller instance, then this seems fine, but if it reports a value, then two different controller instances could report different values.", "author": "shiveshr", "createdAt": "2020-07-01T07:32:09Z", "path": "controller/src/main/java/io/pravega/controller/metrics/StreamMetrics.java", "diffHunk": "@@ -93,6 +104,16 @@ public void createStream(String scope, String streamName, int minNumSegments, Du\n         createStreamLatency.reportSuccessValue(latency.toMillis());\n     }\n \n+    /**\n+     * This method increments the global counter of Scope creations and reports the latency of the operation.\n+     *\n+     * @param latency           Latency of the createStream operation.\n+     */\n+    public void createScope(Duration latency) {\n+        DYNAMIC_LOGGER.incCounterValue(CREATE_SCOPE, 1);", "originalCommit": "bbc4b6e5483a35217e79e5193a5b94e01185f128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIyMzYzOQ==", "url": "https://github.com/pravega/pravega/pull/4906#discussion_r448223639", "bodyText": "The values from multiple Controllers will be aggregated at the InfluxDB level when collecting the metrics.", "author": "RaulGracia", "createdAt": "2020-07-01T09:04:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3MTQ5OA=="}], "type": "inlineReview", "revised_code": null}]}