{"pr_number": 4824, "pr_title": "Issue 4823: Pravega 0.8 does not build on JDK14 - Upgrade Lombok to 1.18.12", "pr_createdAt": "2020-05-28T08:57:41Z", "pr_url": "https://github.com/pravega/pravega/pull/4824", "timeline": [{"oid": "41a81ef896e9aea7609744941255174a8471f821", "url": "https://github.com/pravega/pravega/commit/41a81ef896e9aea7609744941255174a8471f821", "message": "Pravega 0.8 does not build on JDK14 - Lombok issues\n- Upgrade Lombok from 1.18.4 to 1.18.12\n- adapt code to changes to Lombok (Wither annodation and Builder.Default annotation)\n\nFixes #4823\n\nSigned-off-by: Enrico Olivelli <eolivelli@apache.org>", "committedDate": "2020-05-28T08:54:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyMjI2OQ==", "url": "https://github.com/pravega/pravega/pull/4824#discussion_r431722269", "bodyText": "fields with a Default value now works differently and you do not have a field that holds the value\nsee https://projectlombok.org/features/Builder", "author": "eolivelli", "createdAt": "2020-05-28T10:02:03Z", "path": "standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java", "diffHunk": "@@ -127,39 +127,75 @@\n     private String keyPasswordFile;\n     private String jksKeyFile;\n \n-    public static final class InProcPravegaClusterBuilder {\n-        public InProcPravegaCluster build() {\n-            //Check for valid combinations of flags\n-            //For ZK\n-            Preconditions.checkState(isInProcZK || zkUrl != null, \"ZkUrl must be specified\");\n-\n-            //For controller\n-            Preconditions.checkState(isInProcController || controllerURI != null,", "originalCommit": "41a81ef896e9aea7609744941255174a8471f821", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0813f492069498fdc99e889c113a9b85305f59c3", "chunk": "diff --git a/standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java b/standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java\nindex eb76b0701..59df1ec64 100644\n--- a/standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java\n+++ b/standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java\n\n@@ -127,75 +117,44 @@ public class InProcPravegaCluster implements AutoCloseable {\n     private String keyPasswordFile;\n     private String jksKeyFile;\n \n-    private InProcPravegaCluster(boolean isInMemStorage, boolean enableMetrics, boolean enableAuth, boolean enableTls, boolean enableTlsReload,\n-            boolean isInProcController, int controllerCount, int[] controllerPorts, String controllerURI,\n-            int restServerPort, boolean isInProcSegmentStore, int segmentStoreCount, int[] segmentStorePorts, boolean isInProcZK, int zkPort, String zkHost,\n-            ZooKeeperServiceRunner zkService, boolean isInProcHDFS, String hdfsUrl, int containerCount, ServiceStarter[] nodeServiceStarter,\n-            LocalHDFSEmulator localHdfs, ControllerServiceMain[] controllerServers,\n-            String zkUrl,\n-            boolean enableRestServer, String userName, String passwd, String certFile, String keyFile,\n-            String jksTrustFile, String passwdFile, boolean secureZK, String keyPasswordFile, String jksKeyFile) {\n-\n-        //Check for valid combinations of flags\n-        //For ZK\n-        Preconditions.checkState(isInProcZK || zkUrl != null, \"ZkUrl must be specified\");\n-\n-        //For controller\n-        Preconditions.checkState(isInProcController || controllerURI != null,\n-                \"ControllerURI should be defined for external controller\");\n-        Preconditions.checkState(isInProcController || controllerPorts != null,\n-                \"Controller ports not present\");\n-\n-        //For SegmentStore\n-        Preconditions.checkState(isInProcSegmentStore || segmentStorePorts != null, \"SegmentStore ports not declared\");\n-\n-        //Check TLS related parameters\n-        Preconditions.checkState(!enableTls\n-                || (!Strings.isNullOrEmpty(keyFile)\n-                && !Strings.isNullOrEmpty(certFile)\n-                && !Strings.isNullOrEmpty(jksKeyFile)\n-                && !Strings.isNullOrEmpty(jksTrustFile)\n-                && !Strings.isNullOrEmpty(keyPasswordFile)),\n-                \"TLS enabled, but not all parameters set\");\n-\n-        if (isInMemStorage) {\n-            isInProcHDFS = false;\n+    public static final class InProcPravegaClusterBuilder {\n+\n+        // default values\n+        private int containerCount = 4;\n+        private boolean enableRestServer = true;\n+\n+        public InProcPravegaCluster build() {\n+            //Check for valid combinations of flags\n+            //For ZK\n+            Preconditions.checkState(isInProcZK || zkUrl != null, \"ZkUrl must be specified\");\n+\n+            //For controller\n+            Preconditions.checkState(isInProcController || controllerURI != null,\n+                    \"ControllerURI should be defined for external controller\");\n+            Preconditions.checkState(isInProcController || this.controllerPorts != null,\n+                    \"Controller ports not present\");\n+\n+            //For SegmentStore\n+            Preconditions.checkState(isInProcSegmentStore || this.segmentStorePorts != null, \"SegmentStore ports not declared\");\n+\n+            //Check TLS related parameters\n+            Preconditions.checkState(!enableTls ||\n+                            (!Strings.isNullOrEmpty(this.keyFile)\n+                            && !Strings.isNullOrEmpty(this.certFile)\n+                            && !Strings.isNullOrEmpty(this.jksKeyFile)\n+                            && !Strings.isNullOrEmpty(this.jksTrustFile)\n+                            && !Strings.isNullOrEmpty(this.keyPasswordFile)),\n+                    \"TLS enabled, but not all parameters set\");\n+\n+            if (this.isInMemStorage) {\n+                this.isInProcHDFS = false;\n+            }\n+            return new InProcPravegaCluster(isInMemStorage, enableMetrics, enableAuth, enableTls, enableTlsReload,\n+                    isInProcController, controllerCount, controllerPorts, controllerURI,\n+                    restServerPort, isInProcSegmentStore, segmentStoreCount, segmentStorePorts, isInProcZK, zkPort, zkHost,\n+                    zkService, isInProcHDFS, hdfsUrl, containerCount, nodeServiceStarter, localHdfs, controllerServers, zkUrl,\n+                    enableRestServer, userName, passwd, certFile, keyFile, jksTrustFile, passwdFile, secureZK, keyPasswordFile, jksKeyFile);\n         }\n-\n-        this.isInMemStorage = isInMemStorage;\n-        this.enableMetrics = enableMetrics;\n-        this.enableAuth = enableAuth;\n-        this.enableTls = enableTls;\n-        this.enableTlsReload = enableTlsReload;\n-        this.isInProcController = isInProcController;\n-        this.controllerCount = controllerCount;\n-        this.controllerPorts = controllerPorts;\n-        this.controllerURI = controllerURI;\n-        this.restServerPort = restServerPort;\n-        this.isInProcSegmentStore = isInProcSegmentStore;\n-        this.segmentStoreCount = segmentStoreCount;\n-        this.segmentStorePorts = segmentStorePorts;\n-        this.isInProcZK = isInProcZK;\n-        this.zkPort = zkPort;\n-        this.zkHost = zkHost;\n-        this.zkService = zkService;\n-        this.isInProcHDFS = isInProcHDFS;\n-        this.hdfsUrl = hdfsUrl;\n-        this.containerCount = containerCount;\n-        this.nodeServiceStarter = nodeServiceStarter;\n-        this.localHdfs = localHdfs;\n-        this.controllerServers = controllerServers;\n-        this.zkUrl = zkUrl;\n-        this.enableRestServer = enableRestServer;\n-        this.userName = userName;\n-        this.passwd = passwd;\n-        this.certFile = certFile;\n-        this.keyFile = keyFile;\n-        this.jksTrustFile = jksTrustFile;\n-        this.passwdFile = passwdFile;\n-        this.secureZK = secureZK;\n-        this.keyPasswordFile = keyPasswordFile;\n-        this.jksKeyFile = jksKeyFile;\n     }\n \n     @Synchronized\n"}}, {"oid": "0813f492069498fdc99e889c113a9b85305f59c3", "url": "https://github.com/pravega/pravega/commit/0813f492069498fdc99e889c113a9b85305f59c3", "message": "Address review comments and remove last @Wither annotation\n\nSigned-off-by: Enrico Olivelli <eolivelli@apache.org>", "committedDate": "2020-05-29T06:54:16Z", "type": "commit"}, {"oid": "c8ceb04d0cf0df2316931af5b7827f0c9ce3067f", "url": "https://github.com/pravega/pravega/commit/c8ceb04d0cf0df2316931af5b7827f0c9ce3067f", "message": "Merge remote-tracking branch 'origin/master' into fix/update-lombok", "committedDate": "2020-05-29T06:54:33Z", "type": "commit"}, {"oid": "c8ceb04d0cf0df2316931af5b7827f0c9ce3067f", "url": "https://github.com/pravega/pravega/commit/c8ceb04d0cf0df2316931af5b7827f0c9ce3067f", "message": "Merge remote-tracking branch 'origin/master' into fix/update-lombok", "committedDate": "2020-05-29T06:54:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI4OTg5Nw==", "url": "https://github.com/pravega/pravega/pull/4824#discussion_r432289897", "bodyText": "nice trick @shrids !\naddressed your comments\nthank you", "author": "eolivelli", "createdAt": "2020-05-29T06:55:44Z", "path": "standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java", "diffHunk": "@@ -128,6 +118,11 @@\n     private String jksKeyFile;\n \n     public static final class InProcPravegaClusterBuilder {\n+\n+        // default values\n+        private int containerCount = 4;", "originalCommit": "c8ceb04d0cf0df2316931af5b7827f0c9ce3067f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "a448e7de1e9de8f3e453498bc3c2e4a4a7741de8", "url": "https://github.com/pravega/pravega/commit/a448e7de1e9de8f3e453498bc3c2e4a4a7741de8", "message": "Merge branch 'master' into fix/update-lombok", "committedDate": "2020-05-31T06:58:27Z", "type": "commit"}]}