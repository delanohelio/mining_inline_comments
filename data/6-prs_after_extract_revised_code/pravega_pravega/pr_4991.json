{"pr_number": 4991, "pr_title": "Issue 4985: Additional Logs for tracking controller periodic retention ", "pr_createdAt": "2020-07-29T12:07:45Z", "pr_url": "https://github.com/pravega/pravega/pull/4991", "timeline": [{"oid": "29e616d013f12603d14e08a6d5f83730e230ac7c", "url": "https://github.com/pravega/pravega/commit/29e616d013f12603d14e08a6d5f83730e230ac7c", "message": "added logs\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>", "committedDate": "2020-07-29T11:43:20Z", "type": "commit"}, {"oid": "9fdc6300668e8b86dadf4b5f3732114360827231", "url": "https://github.com/pravega/pravega/commit/9fdc6300668e8b86dadf4b5f3732114360827231", "message": "added logs 1\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>", "committedDate": "2020-07-29T11:59:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MDA0Mw==", "url": "https://github.com/pravega/pravega/pull/4991#discussion_r462250043", "bodyText": "nit: Could not find truncation record seems negative.\nI would reword it to something along the lines of - No suitable truncation record was found that satisfied retention policy.", "author": "shiveshr", "createdAt": "2020-07-29T12:10:15Z", "path": "controller/src/main/java/io/pravega/controller/task/Stream/StreamMetadataTasks.java", "diffHunk": "@@ -321,27 +321,32 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n \n     private CompletableFuture<Void> truncate(String scope, String stream, RetentionPolicy policy, OperationContext context,\n                                              RetentionSet retentionSet, StreamCutRecord newRecord, long recordingTime, long requestId) {\n-        return findTruncationRecord(policy, retentionSet, newRecord, recordingTime)\n-                .map(record -> streamMetadataStore.getStreamCutRecord(scope, stream, record, context, executor)\n-                        .thenCompose(streamCutRecord -> startTruncation(scope, stream, streamCutRecord.getStreamCut(), context, requestId))\n-                        .thenCompose(started -> {\n-                            if (started) {\n-                                return streamMetadataStore.deleteStreamCutBefore(scope, stream, record, context, executor);\n+        Optional<StreamCutReferenceRecord> truncationRecord = findTruncationRecord(policy, retentionSet, newRecord, recordingTime);\n+        if (!truncationRecord.isPresent()) {\n+            log.info(\"Could not find truncation record for stream {}/{}\", scope, stream);", "originalCommit": "9fdc6300668e8b86dadf4b5f3732114360827231", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI2MjQ4Mw==", "url": "https://github.com/pravega/pravega/pull/4991#discussion_r462262483", "bodyText": "Ok.", "author": "pbelgundi", "createdAt": "2020-07-29T12:32:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MDA0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "40efa7bb3da7a550a874537648c9fe7672a3bfe1", "chunk": "diff --git a/controller/src/main/java/io/pravega/controller/task/Stream/StreamMetadataTasks.java b/controller/src/main/java/io/pravega/controller/task/Stream/StreamMetadataTasks.java\nindex 696902fd2..db2dfa67c 100644\n--- a/controller/src/main/java/io/pravega/controller/task/Stream/StreamMetadataTasks.java\n+++ b/controller/src/main/java/io/pravega/controller/task/Stream/StreamMetadataTasks.java\n\n@@ -323,7 +323,7 @@ public class StreamMetadataTasks extends TaskBase {\n                                              RetentionSet retentionSet, StreamCutRecord newRecord, long recordingTime, long requestId) {\n         Optional<StreamCutReferenceRecord> truncationRecord = findTruncationRecord(policy, retentionSet, newRecord, recordingTime);\n         if (!truncationRecord.isPresent()) {\n-            log.info(\"Could not find truncation record for stream {}/{}\", scope, stream);\n+            log.info(\"No suitable truncation record found, per retention policy for stream {}/{}\", scope, stream);\n             return CompletableFuture.completedFuture(null);\n         }\n         log.info(\"Found truncation record for stream {}/{} newRecord time/size: {}/{}\", scope, stream,\n"}}, {"oid": "40efa7bb3da7a550a874537648c9fe7672a3bfe1", "url": "https://github.com/pravega/pravega/commit/40efa7bb3da7a550a874537648c9fe7672a3bfe1", "message": "code review\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>", "committedDate": "2020-07-29T12:32:25Z", "type": "commit"}]}