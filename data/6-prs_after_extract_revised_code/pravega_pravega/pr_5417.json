{"pr_number": 5417, "pr_title": "Issue 5416: Transaction commit order should take 'limit' elements from ordered list", "pr_createdAt": "2020-12-10T07:36:13Z", "pr_url": "https://github.com/pravega/pravega/pull/5417", "timeline": [{"oid": "f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "url": "https://github.com/pravega/pravega/commit/f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "message": "Issue 5416: Transaction Order fix\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-12-10T07:42:31Z", "type": "commit"}, {"oid": "f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "url": "https://github.com/pravega/pravega/commit/f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "message": "Issue 5416: Transaction Order fix\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-12-10T07:42:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3ODE4Ng==", "url": "https://github.com/pravega/pravega/pull/5417#discussion_r539978186", "bodyText": "wow, good catch \ud83d\udc4d", "author": "shrids", "createdAt": "2020-12-10T08:43:08Z", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1931,8 +1931,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                 () -> getTransactionRecords(epoch, txnIds.subList(from.get(), till.get())).thenAccept(txns -> {\n             for (int i = 0; i < txns.size(); i++) {\n                 ActiveTxnRecord txnRecord = txns.get(i);\n-                UUID txnId = UUID.fromString(txnIds.get(i));\n-                long order = orders.get(i);\n+                int index = from.get() + i;", "originalCommit": "f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4Mjg0Nw==", "url": "https://github.com/pravega/pravega/pull/5417#discussion_r539982847", "bodyText": "missing parameter in line :1960", "author": "shrids", "createdAt": "2020-12-10T08:50:18Z", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1931,8 +1931,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                 () -> getTransactionRecords(epoch, txnIds.subList(from.get(), till.get())).thenAccept(txns -> {\n             for (int i = 0; i < txns.size(); i++) {\n                 ActiveTxnRecord txnRecord = txns.get(i);\n-                UUID txnId = UUID.fromString(txnIds.get(i));\n-                long order = orders.get(i);\n+                int index = from.get() + i;\n+                UUID txnId = UUID.fromString(txnIds.get(index));\n+                long order = orders.get(index);", "originalCommit": "f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NDAyMQ==", "url": "https://github.com/pravega/pravega/pull/5417#discussion_r539984021", "bodyText": "when will txnRecord.commitOrder be different from orders.get(index)?", "author": "shrids", "createdAt": "2020-12-10T08:52:01Z", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1931,8 +1931,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                 () -> getTransactionRecords(epoch, txnIds.subList(from.get(), till.get())).thenAccept(txns -> {\n             for (int i = 0; i < txns.size(); i++) {\n                 ActiveTxnRecord txnRecord = txns.get(i);", "originalCommit": "f2bcfbf85f329b8f1ff445970e3007f08cad3b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk5NjExMw==", "url": "https://github.com/pravega/pravega/pull/5417#discussion_r539996113", "bodyText": "Because we first create znode and then we update the txn record, we could have failed after 1st. Or could have recreated another znode in a different call that then doesn\u2019t update the record.", "author": "shiveshr", "createdAt": "2020-12-10T09:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NDAyMQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "64d95b02ce46d31d531dde8f2c47dd27c65a8e62", "url": "https://github.com/pravega/pravega/commit/64d95b02ce46d31d531dde8f2c47dd27c65a8e62", "message": "PR comment\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-12-10T09:16:57Z", "type": "commit"}, {"oid": "f848912bed435b7d0d3d958a5bd15d41a7ea88cd", "url": "https://github.com/pravega/pravega/commit/f848912bed435b7d0d3d958a5bd15d41a7ea88cd", "message": "Merge branch 'master' into issue5416", "committedDate": "2020-12-10T15:55:17Z", "type": "commit"}, {"oid": "7b0e37e24dd4c65705892be5f4189f576d150156", "url": "https://github.com/pravega/pravega/commit/7b0e37e24dd4c65705892be5f4189f576d150156", "message": "Merge branch 'master' into issue5416", "committedDate": "2020-12-11T02:17:52Z", "type": "commit"}, {"oid": "b9b4ad87376de6592d83d4a7f0b19c50823dc37b", "url": "https://github.com/pravega/pravega/commit/b9b4ad87376de6592d83d4a7f0b19c50823dc37b", "message": "Merge branch 'master' into issue5416", "committedDate": "2020-12-11T17:29:27Z", "type": "commit"}]}