{"pr_number": 4612, "pr_title": "Issue 4603: (KeyValueTables) Client Controller API", "pr_createdAt": "2020-03-11T00:55:03Z", "pr_url": "https://github.com/pravega/pravega/pull/4612", "timeline": [{"oid": "f0c8a75a7fed394e43cc1da58a03437d964704f6", "url": "https://github.com/pravega/pravega/commit/f0c8a75a7fed394e43cc1da58a03437d964704f6", "message": "Moved Controller, ControllerImpl and a few related classes to io.pravega.client.control.impl.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-10T01:18:14Z", "type": "commit"}, {"oid": "253745d93eb687bca6cd290ac95f9cf1bda0515a", "url": "https://github.com/pravega/pravega/commit/253745d93eb687bca6cd290ac95f9cf1bda0515a", "message": "KeyValueTable contracts for Controller operations\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-10T18:25:53Z", "type": "commit"}, {"oid": "6b49fc3f91d58dc04422f157c1c81ceb6359c611", "url": "https://github.com/pravega/pravega/commit/6b49fc3f91d58dc04422f157c1c81ceb6359c611", "message": "Removed extra method.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-11T17:13:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM2NTgwNA==", "url": "https://github.com/pravega/pravega/pull/4612#discussion_r392365804", "bodyText": "This was something we very deliberately avoided in the way we layed out the directory structure. This object is returned to users, so even though it is inside of the impl directory there is a temptation to call methods on it. Let's try to work out a way to avoid making this publicly callable. Perhaps by having the map passed to the caller rather than the position object?", "author": "tkaitchuck", "createdAt": "2020-03-13T17:19:48Z", "path": "client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java", "diffHunk": "@@ -40,7 +40,7 @@\n      *\n      * @return the read offset for each segment in the ownedSegments set\n      */\n-    abstract Map<Segment, Long> getOwnedSegmentsWithOffsets();\n+    public abstract Map<Segment, Long> getOwnedSegmentsWithOffsets();", "originalCommit": "6b49fc3f91d58dc04422f157c1c81ceb6359c611", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA5MDkwNA==", "url": "https://github.com/pravega/pravega/pull/4612#discussion_r393090904", "bodyText": "Looks like this is only invoked from ModelHelper.getSegmentsFromPositions which is actually not used anywhere. Same with the one below (invoked in ModelHelper.toSegmentOffsetMap which is not used anywhere.\nI deleted those methods in ModelHelper and reverted the changes in PositionInternal.java.", "author": "andreipaduroiu", "createdAt": "2020-03-16T15:01:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM2NTgwNA=="}], "type": "inlineReview", "revised_code": {"commit": "10316df5d7940bcced9ed29ed92b063a6e0a941e", "chunk": "diff --git a/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java b/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java\nindex 0d6bf5754c..9cfbab8888 100644\n--- a/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java\n+++ b/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java\n\n@@ -40,7 +40,7 @@ public abstract class PositionInternal implements Position {\n      *\n      * @return the read offset for each segment in the ownedSegments set\n      */\n-    public abstract Map<Segment, Long> getOwnedSegmentsWithOffsets();\n+    abstract Map<Segment, Long> getOwnedSegmentsWithOffsets();\n     \n     /**\n      * Completely read segments have offset of -1.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM2NTg4NA==", "url": "https://github.com/pravega/pravega/pull/4612#discussion_r392365884", "bodyText": "Same here", "author": "tkaitchuck", "createdAt": "2020-03-13T17:19:57Z", "path": "client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java", "diffHunk": "@@ -52,7 +52,7 @@\n     /**\n      * Gets the set of completely read segments.\n      */\n-    abstract Set<Segment> getCompletedSegments();\n+    public abstract Set<Segment> getCompletedSegments();", "originalCommit": "6b49fc3f91d58dc04422f157c1c81ceb6359c611", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA5MDk1OQ==", "url": "https://github.com/pravega/pravega/pull/4612#discussion_r393090959", "bodyText": "See reply above.", "author": "andreipaduroiu", "createdAt": "2020-03-16T15:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM2NTg4NA=="}], "type": "inlineReview", "revised_code": {"commit": "10316df5d7940bcced9ed29ed92b063a6e0a941e", "chunk": "diff --git a/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java b/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java\nindex 0d6bf5754c..9cfbab8888 100644\n--- a/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java\n+++ b/client/src/main/java/io/pravega/client/stream/impl/PositionInternal.java\n\n@@ -52,7 +52,7 @@ public abstract class PositionInternal implements Position {\n     /**\n      * Gets the set of completely read segments.\n      */\n-    public abstract Set<Segment> getCompletedSegments();\n+    abstract Set<Segment> getCompletedSegments();\n \n     /**\n      * Gets the offset for a specified the segment.\n"}}, {"oid": "10316df5d7940bcced9ed29ed92b063a6e0a941e", "url": "https://github.com/pravega/pravega/commit/10316df5d7940bcced9ed29ed92b063a6e0a941e", "message": "Removed dead code. Reverted PositionInternal.java.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-16T15:15:13Z", "type": "commit"}, {"oid": "f141e4d7712e97c5797936cbe56c8ec81a1726a2", "url": "https://github.com/pravega/pravega/commit/f141e4d7712e97c5797936cbe56c8ec81a1726a2", "message": "Backporting some unit tests.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-27T17:34:07Z", "type": "commit"}, {"oid": "2a1b13b4c078d182a044e4014c529cca646a8154", "url": "https://github.com/pravega/pravega/commit/2a1b13b4c078d182a044e4014c529cca646a8154", "message": "Build fix.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-27T17:44:05Z", "type": "commit"}, {"oid": "be0e028be4577995599a1cd66024170a41319994", "url": "https://github.com/pravega/pravega/commit/be0e028be4577995599a1cd66024170a41319994", "message": "Unit test coverage.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-27T19:45:52Z", "type": "commit"}, {"oid": "044b3e2f9bf5d5010a3c7e7af89edf6f030b434b", "url": "https://github.com/pravega/pravega/commit/044b3e2f9bf5d5010a3c7e7af89edf6f030b434b", "message": "Code coverage.\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-30T21:50:05Z", "type": "commit"}, {"oid": "ba3433dee0d4a24b2a521f6dab00befe1b1c234a", "url": "https://github.com/pravega/pravega/commit/ba3433dee0d4a24b2a521f6dab00befe1b1c234a", "message": "checkstyle\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-30T22:39:56Z", "type": "commit"}, {"oid": "d49e411da19e5bffd7d1fd96a15f22e366045007", "url": "https://github.com/pravega/pravega/commit/d49e411da19e5bffd7d1fd96a15f22e366045007", "message": "Merge branch 'feature-key-value-tables' of https://github.com/pravega/pravega into issue-4603-client-controller\n\n\u0001 Conflicts:\n\u0001\tcontroller/src/main/java/io/pravega/controller/server/SegmentHelper.java", "committedDate": "2020-03-31T14:45:39Z", "type": "commit"}, {"oid": "ce2751995692cf03b24547c70a2e91bf6b7f931e", "url": "https://github.com/pravega/pravega/commit/ce2751995692cf03b24547c70a2e91bf6b7f931e", "message": "Merge conflicts\n\nSigned-off-by: Andrei Paduroiu <andrei.paduroiu@emc.com>", "committedDate": "2020-03-31T14:47:03Z", "type": "commit"}]}