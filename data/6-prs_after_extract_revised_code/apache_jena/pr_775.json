{"pr_number": 775, "pr_title": "JENA-1937: SHACL Compact Syntax Writer", "pr_createdAt": "2020-07-16T21:02:17Z", "pr_url": "https://github.com/apache/jena/pull/775", "timeline": [{"oid": "8c00478560d3726ed9d2fb29cac4ed6556743bcb", "url": "https://github.com/apache/jena/commit/8c00478560d3726ed9d2fb29cac4ed6556743bcb", "message": "JENA-1937: SHACLC writer", "committedDate": "2020-07-11T11:58:42Z", "type": "commit"}, {"oid": "918df109dedd922d06b47c7488c2bcd39bba9b13", "url": "https://github.com/apache/jena/commit/918df109dedd922d06b47c7488c2bcd39bba9b13", "message": "JENA-1937: Move tests to src/test/files", "committedDate": "2020-07-11T12:00:04Z", "type": "commit"}, {"oid": "5eca828d437a0fb85c089d5038828e4279d1c1cb", "url": "https://github.com/apache/jena/commit/5eca828d437a0fb85c089d5038828e4279d1c1cb", "message": "JENA-1937: More SHACLC writer; clearup", "committedDate": "2020-07-15T18:42:56Z", "type": "commit"}, {"oid": "aa61fb956b93ee4768b04c842698e8102707bf12", "url": "https://github.com/apache/jena/commit/aa61fb956b93ee4768b04c842698e8102707bf12", "message": "Code cleanup", "committedDate": "2020-07-16T20:51:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4NTE3OA==", "url": "https://github.com/apache/jena/pull/775#discussion_r456385178", "bodyText": "the datatype= was intentional or accidentally?", "author": "kinow", "createdAt": "2020-07-17T11:30:44Z", "path": "jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java", "diffHunk": "@@ -195,6 +208,25 @@ public static boolean isImmediate(Target target) {\n         return targetType.equals(TargetType.targetObjectsOf) || targetType.equals(TargetType.targetSubjectsOf);\n     }\n \n+    static Set<String> rdfDatatypes = new HashSet<>();\n+    static {\n+        rdfDatatypes.add(RDF.dtLangString.getURI());\n+        rdfDatatypes.add(RDF.dtRDFHTML.getURI());\n+        rdfDatatypes.add(RDF.dtRDFJSON.getURI());\n+        rdfDatatypes.add(RDF.dtXMLLiteral.getURI());\n+    }\n+\n+\n+\n+    /** Test whether the IRI is a datatype that can be written in compact short form (no datatype=)", "originalCommit": "aa61fb956b93ee4768b04c842698e8102707bf12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUxMjMyNw==", "url": "https://github.com/apache/jena/pull/775#discussion_r456512327", "bodyText": "\"datatype=\" intended.\nA plain URI as a constraint is a shorthand for either \"datatype=URI\" or \"class=URI\" by looking inside the URI.  Teh writer attempts to reverse this conservatively. For XSD and some known datatypes, it writes the URI as an abbreviation for datatype=URI otherwise it writes class= (no attempt to abbreviate)\nI'll clarify the comment.", "author": "afs", "createdAt": "2020-07-17T15:24:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4NTE3OA=="}], "type": "inlineReview", "revised_code": {"commit": "807f06d9fde535f62683cac9efe4adcbfc318c3d", "chunk": "diff --git a/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java b/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java\nindex 1f61430d9c..de9024c33c 100644\n--- a/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java\n+++ b/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java\n\n@@ -216,17 +216,16 @@ public class ShLib {\n         rdfDatatypes.add(RDF.dtXMLLiteral.getURI());\n     }\n \n-\n-\n-    /** Test whether the IRI is a datatype that can be written in compact short form (no datatype=)\n-     * This test us used by the SHACL compact parser in {@code ShaclCompactParser.rPropertyType}\n-     * and SHACL compact writer.\n+    /**\n+     * Test whether the IRI is a datatype that can be written in compact short form\n+     * (no {@code datatype=} written, only the datatype URI). This test is used by\n+     * the SHACL compact parser in {@code ShaclCompactParser.rPropertyType} and SHACL\n+     * compact writer.\n      */\n     public static boolean isDatatype(String iriStr) {\n         return iriStr.startsWith(XSD.getURI()) || rdfDatatypes.contains(iriStr);\n     }\n \n-\n     public static Node focusNode(Triple triple, Target target) {\n         switch(target.getTargetType()) {\n             //case targetClass :\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4NTI3OA==", "url": "https://github.com/apache/jena/pull/775#discussion_r456385278", "bodyText": "s/us/is ?", "author": "kinow", "createdAt": "2020-07-17T11:30:58Z", "path": "jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java", "diffHunk": "@@ -195,6 +208,25 @@ public static boolean isImmediate(Target target) {\n         return targetType.equals(TargetType.targetObjectsOf) || targetType.equals(TargetType.targetSubjectsOf);\n     }\n \n+    static Set<String> rdfDatatypes = new HashSet<>();\n+    static {\n+        rdfDatatypes.add(RDF.dtLangString.getURI());\n+        rdfDatatypes.add(RDF.dtRDFHTML.getURI());\n+        rdfDatatypes.add(RDF.dtRDFJSON.getURI());\n+        rdfDatatypes.add(RDF.dtXMLLiteral.getURI());\n+    }\n+\n+\n+\n+    /** Test whether the IRI is a datatype that can be written in compact short form (no datatype=)\n+     * This test us used by the SHACL compact parser in {@code ShaclCompactParser.rPropertyType}", "originalCommit": "aa61fb956b93ee4768b04c842698e8102707bf12", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "807f06d9fde535f62683cac9efe4adcbfc318c3d", "chunk": "diff --git a/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java b/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java\nindex 1f61430d9c..de9024c33c 100644\n--- a/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java\n+++ b/jena-shacl/src/main/java/org/apache/jena/shacl/lib/ShLib.java\n\n@@ -216,17 +216,16 @@ public class ShLib {\n         rdfDatatypes.add(RDF.dtXMLLiteral.getURI());\n     }\n \n-\n-\n-    /** Test whether the IRI is a datatype that can be written in compact short form (no datatype=)\n-     * This test us used by the SHACL compact parser in {@code ShaclCompactParser.rPropertyType}\n-     * and SHACL compact writer.\n+    /**\n+     * Test whether the IRI is a datatype that can be written in compact short form\n+     * (no {@code datatype=} written, only the datatype URI). This test is used by\n+     * the SHACL compact parser in {@code ShaclCompactParser.rPropertyType} and SHACL\n+     * compact writer.\n      */\n     public static boolean isDatatype(String iriStr) {\n         return iriStr.startsWith(XSD.getURI()) || rdfDatatypes.contains(iriStr);\n     }\n \n-\n     public static Node focusNode(Triple triple, Target target) {\n         switch(target.getTargetType()) {\n             //case targetClass :\n"}}, {"oid": "807f06d9fde535f62683cac9efe4adcbfc318c3d", "url": "https://github.com/apache/jena/commit/807f06d9fde535f62683cac9efe4adcbfc318c3d", "message": "JENA-1937: Fix comment in response to review", "committedDate": "2020-07-17T15:40:21Z", "type": "commit"}]}