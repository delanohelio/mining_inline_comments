{"pr_number": 806, "pr_title": "JENA-1975: Clean up logging", "pr_createdAt": "2020-10-01T13:30:49Z", "pr_url": "https://github.com/apache/jena/pull/806", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ1MTk0MA==", "url": "https://github.com/apache/jena/pull/806#discussion_r498451940", "bodyText": "20? Or 2 perhaps?", "author": "kinow", "createdAt": "2020-10-01T18:55:24Z", "path": "jena-fuseki2/jena-fuseki-main/src/main/java/org/apache/jena/fuseki/main/JettyServer.java", "diffHunk": "@@ -352,7 +387,17 @@ protected void addFilter(ServletContextHandler context, String pathspec, Filter\n         }\n \n         /** Jetty server */\n-        private static Server jettyServer(int port, boolean loopback) {\n+        private static Server jettyServer(int port, boolean loopback, int minThreads, int maxThreads) {\n+            ThreadPool threadPool = null;\n+            // Jetty 9.4 : the Jetty default is200,8", "originalCommit": "ce39d0e49daa6208c9d89aa0daa8122a7a5964de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NDM0Mw==", "url": "https://github.com/apache/jena/pull/806#discussion_r498474343", "bodyText": "It really is 200,8 -- Jetty arguments are (max,min).\nQueuedThreadPool.java in Jetty 9.4\nOne of the reasons for messing with this is that it becomes hard to debug with even the minimum 8 threads when you pause the whole JVM and want to find a thread in a particular state, especially if (for Delta testing) there are multiple Jetty servers in one JVM.", "author": "afs", "createdAt": "2020-10-01T19:41:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ1MTk0MA=="}], "type": "inlineReview", "revised_code": {"commit": "86fbc49921c7f7f199f8e188d6439a22a26dc4f0", "chunk": "diff --git a/jena-fuseki2/jena-fuseki-main/src/main/java/org/apache/jena/fuseki/main/JettyServer.java b/jena-fuseki2/jena-fuseki-main/src/main/java/org/apache/jena/fuseki/main/JettyServer.java\nindex fab943a0e5..370ba5e994 100644\n--- a/jena-fuseki2/jena-fuseki-main/src/main/java/org/apache/jena/fuseki/main/JettyServer.java\n+++ b/jena-fuseki2/jena-fuseki-main/src/main/java/org/apache/jena/fuseki/main/JettyServer.java\n\n@@ -389,16 +389,17 @@ public class JettyServer {\n         /** Jetty server */\n         private static Server jettyServer(int port, boolean loopback, int minThreads, int maxThreads) {\n             ThreadPool threadPool = null;\n-            // Jetty 9.4 : the Jetty default is200,8\n+            // Jetty 9.4 : the Jetty default is 200,8\n             if ( minThreads != -1 || maxThreads != -1 ) {\n                 if ( minThreads == -1 )\n                     minThreads = 2;\n                 if ( maxThreads == -1 )\n                     maxThreads = 20;\n                 maxThreads = Math.max(minThreads, maxThreads);\n-                threadPool = new QueuedThreadPool(maxThreads);\n+                // Args reversed:Jetty uses (max,min)\n+                threadPool = new QueuedThreadPool(maxThreads, minThreads);\n             }\n-            Server server = new Server();\n+            Server server = new Server(threadPool);\n             HttpConnectionFactory f1 = new HttpConnectionFactory();\n \n             //f1.getHttpConfiguration().setRequestHeaderSize(512 * 1024);\n"}}, {"oid": "86fbc49921c7f7f199f8e188d6439a22a26dc4f0", "url": "https://github.com/apache/jena/commit/86fbc49921c7f7f199f8e188d6439a22a26dc4f0", "message": "JENA-1975: Clean up logging", "committedDate": "2020-10-01T19:39:36Z", "type": "commit"}, {"oid": "86fbc49921c7f7f199f8e188d6439a22a26dc4f0", "url": "https://github.com/apache/jena/commit/86fbc49921c7f7f199f8e188d6439a22a26dc4f0", "message": "JENA-1975: Clean up logging", "committedDate": "2020-10-01T19:39:36Z", "type": "forcePushed"}]}