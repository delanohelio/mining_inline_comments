{"pr_number": 864, "pr_title": "JENA-1994: Look in datatype URI", "pr_createdAt": "2020-11-14T16:38:09Z", "pr_url": "https://github.com/apache/jena/pull/864", "timeline": [{"oid": "a2e96724ef1509ce27385cc31159fccb687b8bde", "url": "https://github.com/apache/jena/commit/a2e96724ef1509ce27385cc31159fccb687b8bde", "message": "JENA-1994: Look in datatype URI", "committedDate": "2020-11-14T16:37:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzU4OTU4MA==", "url": "https://github.com/apache/jena/pull/864#discussion_r523589580", "bodyText": "Tests confirming the prefixes are available after the calc methods are called \ud83d\udc4d", "author": "kinow", "createdAt": "2020-11-15T01:40:58Z", "path": "jena-core/src/test/java/org/apache/jena/util/TestPrefixMappingUtils.java", "diffHunk": "@@ -141,14 +146,125 @@ static int size(PrefixMapping pmap) {\n         Graph graph = create(data) ;\n         PrefixMapping pmap = PrefixMappingUtils.calcInUsePrefixMapping(graph) ;\n         PrefixMapping pmapExpected = new PrefixMappingImpl() ;\n-     \tpmapExpected.setNsPrefix(\"\", \"http://example/\") ;\n-\t\tpmapExpected.setNsPrefix(\"ex\", \"http://example/ex#\") ;\n-\t\tpmapExpected.setNsPrefix(\"indirect\", \"urn:foo:\") ;\n-\t\tpmapExpected.setNsPrefix(\"ns\", \"http://host/ns\") ;\n-\t\tpmapExpected.setNsPrefix(\"ns1\", \"http://host/ns1\") ;\n-\t\tpmapExpected.setNsPrefix(\"indirectx\", \"urn:x:\") ;\n-\t\t//print(\"Expected:\", pmapExpected) ;\n-\t\t//print(\"Got:\", pmap) ;\n+        pmapExpected.setNsPrefix(\"\", \"http://example/\") ;\n+        pmapExpected.setNsPrefix(\"ex\", \"http://example/ex#\") ;\n+        pmapExpected.setNsPrefix(\"indirect\", \"urn:foo:\") ;\n+        pmapExpected.setNsPrefix(\"ns\", \"http://host/ns\") ;\n+        pmapExpected.setNsPrefix(\"ns1\", \"http://host/ns1\") ;\n+        pmapExpected.setNsPrefix(\"indirectx\", \"urn:x:\") ;\n+        //print(\"Expected:\", pmapExpected) ;\n+        //print(\"Got:\", pmap) ;\n+        Assert.assertTrue(sameMapping(pmapExpected, pmap)) ;\n+        Assert.assertTrue(pmap.getNsPrefixURI(\"notinuse\") == null) ;\n+    }\n+\n+    @Test public void prefixesTTL1() {\n+        // All prefixes used.\n+        // Note: XSD as well.\n+        String data1 = StrUtils.strjoinNL\n+            (\"@prefix : <http://example/> .\" ,\n+             \"@prefix ex: <http://example/ex#> .\" ,\n+             \"@prefix xsd: <\"+XSD.getURI()+\"> .\",\n+             \"\" ,\n+             \":s1 :p :x1 .\" ,\n+             \":s1 ex:p :x1 .\",\n+             \":s1 ex:p 1 .\"\n+             ) ;\n+        Graph graph1 = create(data1) ;\n+        PrefixMapping pmap = PrefixMappingUtils.calcInUsePrefixMappingTTL(graph1) ;\n+        PrefixMapping pmapExpected = graph1.getPrefixMapping() ;\n+        Assert.assertEquals(3, size(pmap)) ;\n+        Assert.assertEquals(pmapExpected, pmap) ; \n+    }\n+    \n+    @Test public void prefixesTTL2() {\n+        // Some prefixes used\n+        String data2 = StrUtils.strjoinNL\n+            (\"@prefix : <http://example/> .\" ,\n+             \"@prefix ex: <http://example/ex#> .\" ,\n+             \"@prefix notinuse: <http://example/whatever/> .\" ,\n+             \"\" ,\n+             \":s1 :p :x1 .\" ,\n+             \":s1 ex:p :x1 .\"\n+             ) ;\n+        \n+        Graph graph1 = create(data2) ;\n+        PrefixMapping pmap = PrefixMappingUtils.calcInUsePrefixMappingTTL(graph1) ;\n+        PrefixMapping pmapExpected = new PrefixMappingImpl() ;\n+        pmapExpected.setNsPrefix(\"\", \"http://example/\") ;\n+        pmapExpected.setNsPrefix(\"ex\", \"http://example/ex#\") ;\n+        Assert.assertEquals(2, size(pmap)) ;\n+        Assert.assertTrue(sameMapping(pmapExpected, pmap)) ;\n+        Assert.assertTrue(pmap.getNsPrefixURI(\"notinuse\") == null) ;", "originalCommit": "a2e96724ef1509ce27385cc31159fccb687b8bde", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}