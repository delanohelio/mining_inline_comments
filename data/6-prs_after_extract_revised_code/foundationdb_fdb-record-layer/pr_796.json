{"pr_number": 796, "pr_title": "Resolves #794: FDBRecordStore.rebuildIndexWithNoRecord should clear and mark readable and not just assume that the subspace is empty", "pr_createdAt": "2020-01-02T23:52:38Z", "pr_url": "https://github.com/FoundationDB/fdb-record-layer/pull/796", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg3ODA1MQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/796#discussion_r362878051", "bodyText": "Possibly either .thenRun or .thenAccept instead of .thenApply. It doesn't really matter, though; just style.", "author": "alecgrieser", "createdAt": "2020-01-03T16:44:36Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStore.java", "diffHunk": "@@ -3089,7 +3089,10 @@ private boolean areAllRecordTypesSince(@Nullable Collection<RecordType> recordTy\n             }\n         }\n \n-        return markIndexReadable(index).thenApply(b -> null);\n+        return markIndexReadable(index).thenApply(vignore -> {", "originalCommit": "958d60f04bff164c3f964c3f01795c1d9e6de6bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkyMzk0MQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/796#discussion_r362923941", "bodyText": "Done.", "author": "nblintao", "createdAt": "2020-01-03T19:04:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg3ODA1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "c9b25feb564e9e90bfec3665c4dcca6e4c2a82c8", "chunk": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStore.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStore.java\nindex 384d8871..8c6e6f60 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStore.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStore.java\n\n@@ -3089,10 +3087,8 @@ public class FDBRecordStore extends FDBStoreBase implements FDBRecordStoreBase<M\n             }\n         }\n \n-        return markIndexReadable(index).thenApply(vignore -> {\n-            clearIndexData(index);\n-            return null;\n-        });\n+        return markIndexReadable(index)\n+                .thenRun(() -> clearIndexData(index));\n     }\n \n     /**\n"}}, {"oid": "c9b25feb564e9e90bfec3665c4dcca6e4c2a82c8", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/c9b25feb564e9e90bfec3665c4dcca6e4c2a82c8", "message": "Resolves #794: FDBRecordStore.rebuildIndexWithNoRecord should clear and mark readable and not just assume that the subspace is empty", "committedDate": "2020-01-03T19:04:29Z", "type": "commit"}, {"oid": "c9b25feb564e9e90bfec3665c4dcca6e4c2a82c8", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/c9b25feb564e9e90bfec3665c4dcca6e4c2a82c8", "message": "Resolves #794: FDBRecordStore.rebuildIndexWithNoRecord should clear and mark readable and not just assume that the subspace is empty", "committedDate": "2020-01-03T19:04:29Z", "type": "forcePushed"}]}