{"pr_number": 2419, "pr_title": "fix #2410 Add serialized wrappers for Sinks.Empty/Sinks.One", "pr_createdAt": "2020-10-07T08:51:30Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2419", "timeline": [{"oid": "29d12dd0cfe0439316d8a6a8c9ae75b688438470", "url": "https://github.com/reactor/reactor-core/commit/29d12dd0cfe0439316d8a6a8c9ae75b688438470", "message": "fix# 2410 Add serialized wrappers to SinkEmpty and SinkOne", "committedDate": "2020-10-07T09:23:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAyMTk3MA==", "url": "https://github.com/reactor/reactor-core/pull/2419#discussion_r501021970", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tfinal SinkOneSerializedStressTest.TargetSink<Object> stressSink = new SinkOneSerializedStressTest.TargetSink<>();\n          \n          \n            \n            \tfinal TargetSink<Object> stressSink = new TargetSink<>();", "author": "bsideup", "createdAt": "2020-10-07T13:42:07Z", "path": "reactor-core/src/jcstress/java/reactor/core/publisher/SinkOneSerializedStressTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright (c) 2020-Present VMware Inc. or its affiliates, All Rights Reserved.\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *        https://www.apache.org/licenses/LICENSE-2.0\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package reactor.core.publisher;\n+\n+import org.openjdk.jcstress.annotations.*;\n+import org.openjdk.jcstress.infra.results.LLI_Result;\n+import reactor.util.context.Context;\n+\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.locks.LockSupport;\n+\n+import static org.openjdk.jcstress.annotations.Expect.ACCEPTABLE;\n+\n+public class SinkOneSerializedStressTest {\n+\n+\tfinal SinkOneSerializedStressTest.TargetSink<Object> stressSink = new SinkOneSerializedStressTest.TargetSink<>();", "originalCommit": "2382ef72a73cec91870c7b823f370bc3abd18fc0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edbfce83278e885a10a6bf1c1b356601e2574806", "chunk": "diff --git a/reactor-core/src/jcstress/java/reactor/core/publisher/SinkOneSerializedStressTest.java b/reactor-core/src/jcstress/java/reactor/core/publisher/SinkOneSerializedStressTest.java\nindex bab64a74c..e7a828af0 100644\n--- a/reactor-core/src/jcstress/java/reactor/core/publisher/SinkOneSerializedStressTest.java\n+++ b/reactor-core/src/jcstress/java/reactor/core/publisher/SinkOneSerializedStressTest.java\n\n@@ -24,7 +24,7 @@ import static org.openjdk.jcstress.annotations.Expect.ACCEPTABLE;\n \n public class SinkOneSerializedStressTest {\n \n-\tfinal SinkOneSerializedStressTest.TargetSink<Object> stressSink = new SinkOneSerializedStressTest.TargetSink<>();\n+\tfinal TargetSink<Object> stressSink = new TargetSink<>();\n \n \tfinal SinkOneSerialized<Object> sink = new SinkOneSerialized<>(\n \t\t\tstressSink,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA1NjE0NA==", "url": "https://github.com/reactor/reactor-core/pull/2419#discussion_r501056144", "bodyText": "I am wondering why IDEA renamed this class :D I think we should rename it back to keep the inner class names shorter", "author": "bsideup", "createdAt": "2020-10-07T14:25:18Z", "path": "reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java", "diffHunk": "@@ -45,7 +45,7 @@\n \t@Outcome(id = {\"FAIL_NON_SERIALIZED, OK, 1\"}, expect = ACCEPTABLE, desc = \"second wins\")\n \t@Outcome(id = {\"OK, OK, 2\"}, expect = ACCEPTABLE, desc = \"one after another\")\n \t@State\n-\tpublic static class TryEmitNextStressTest extends SerializedManySinkStressTest {\n+\tpublic static class TryEmitNextManySerializedStressTest extends SinkManySerializedStressTest {", "originalCommit": "82f8e2e424273ac95a652200022bbf60fbbed925", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA5ODYwNw==", "url": "https://github.com/reactor/reactor-core/pull/2419#discussion_r501098607", "bodyText": "to clarify, this should indeed be renamed back to TryEmitNextStressTest", "author": "simonbasle", "createdAt": "2020-10-07T15:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA1NjE0NA=="}], "type": "inlineReview", "revised_code": {"commit": "edbfce83278e885a10a6bf1c1b356601e2574806", "chunk": "diff --git a/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java b/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java\nindex 353a33d17..d6bae7fc1 100644\n--- a/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java\n+++ b/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java\n\n@@ -45,7 +45,7 @@ public class SinkManySerializedStressTest {\n \t@Outcome(id = {\"FAIL_NON_SERIALIZED, OK, 1\"}, expect = ACCEPTABLE, desc = \"second wins\")\n \t@Outcome(id = {\"OK, OK, 2\"}, expect = ACCEPTABLE, desc = \"one after another\")\n \t@State\n-\tpublic static class TryEmitNextManySerializedStressTest extends SinkManySerializedStressTest {\n+\tpublic static class TryEmitNextStressTest extends SinkManySerializedStressTest {\n \n \t\t@Actor\n \t\tpublic void first(LLI_Result r) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA5ODYyNQ==", "url": "https://github.com/reactor/reactor-core/pull/2419#discussion_r501098625", "bodyText": "same as in above @bsideup comment: rename back to TerminatedVsOnNextStressTest", "author": "simonbasle", "createdAt": "2020-10-07T15:19:14Z", "path": "reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java", "diffHunk": "@@ -69,7 +69,7 @@ public void arbiter(LLI_Result r) {\n \t@Outcome(id = {\"FAIL_TERMINATED, OK, 1\"}, expect = ACCEPTABLE, desc = \"onNext after onComplete\")\n \t@Outcome(id = {\"OK, OK, 1\"}, expect = ACCEPTABLE, desc = \"onComplete after onNext\")\n \t@State\n-\tpublic static class TerminatedVsOnNextStressTest extends SerializedManySinkStressTest {\n+\tpublic static class TerminatedVsOnNextManySerializedStressTest extends SinkManySerializedStressTest {", "originalCommit": "82f8e2e424273ac95a652200022bbf60fbbed925", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edbfce83278e885a10a6bf1c1b356601e2574806", "chunk": "diff --git a/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java b/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java\nindex 353a33d17..d6bae7fc1 100644\n--- a/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java\n+++ b/reactor-core/src/jcstress/java/reactor/core/publisher/SinkManySerializedStressTest.java\n\n@@ -69,7 +69,7 @@ public class SinkManySerializedStressTest {\n \t@Outcome(id = {\"FAIL_TERMINATED, OK, 1\"}, expect = ACCEPTABLE, desc = \"onNext after onComplete\")\n \t@Outcome(id = {\"OK, OK, 1\"}, expect = ACCEPTABLE, desc = \"onComplete after onNext\")\n \t@State\n-\tpublic static class TerminatedVsOnNextManySerializedStressTest extends SinkManySerializedStressTest {\n+\tpublic static class TerminatedVsOnNextStressTest extends SinkManySerializedStressTest {\n \n \t\t@Actor\n \t\tpublic void first(LLI_Result r) {\n"}}, {"oid": "edbfce83278e885a10a6bf1c1b356601e2574806", "url": "https://github.com/reactor/reactor-core/commit/edbfce83278e885a10a6bf1c1b356601e2574806", "message": "properly renamed stressTest cases", "committedDate": "2020-10-08T08:49:01Z", "type": "forcePushed"}, {"oid": "3f5d125b4a306e9e332727e81ae90b25550f39e4", "url": "https://github.com/reactor/reactor-core/commit/3f5d125b4a306e9e332727e81ae90b25550f39e4", "message": "fix# 2410 Add serialized wrappers to SinkEmpty and SinkOne", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "be92b976de930d7c769d52efbf3e20256de015a1", "url": "https://github.com/reactor/reactor-core/commit/be92b976de930d7c769d52efbf3e20256de015a1", "message": "extract SerializedSink as an abstract class and make SerializedOne and SerializedEmpty extend from it", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "af79de27c626e850f7cf55303559e3191c8f8731", "url": "https://github.com/reactor/reactor-core/commit/af79de27c626e850f7cf55303559e3191c8f8731", "message": "extract and rename SinkManySerialized", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "00ebd4d492a5426852ede703e7ac8b24ca959254", "url": "https://github.com/reactor/reactor-core/commit/00ebd4d492a5426852ede703e7ac8b24ca959254", "message": "rename SinkManySerializedStressTest", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "836ab91d154a2494b7290ae788509d481473f78d", "url": "https://github.com/reactor/reactor-core/commit/836ab91d154a2494b7290ae788509d481473f78d", "message": "cleanup", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "ed60fca38f783f90c60ab395473ba10a7b69a359", "url": "https://github.com/reactor/reactor-core/commit/ed60fca38f783f90c60ab395473ba10a7b69a359", "message": "remove unnecessary qualifier", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "7815674fee46ef9010c9fb6b605f0354466a8770", "url": "https://github.com/reactor/reactor-core/commit/7815674fee46ef9010c9fb6b605f0354466a8770", "message": "properly renamed stressTest cases", "committedDate": "2020-10-08T13:13:23Z", "type": "commit"}, {"oid": "7815674fee46ef9010c9fb6b605f0354466a8770", "url": "https://github.com/reactor/reactor-core/commit/7815674fee46ef9010c9fb6b605f0354466a8770", "message": "properly renamed stressTest cases", "committedDate": "2020-10-08T13:13:23Z", "type": "forcePushed"}]}