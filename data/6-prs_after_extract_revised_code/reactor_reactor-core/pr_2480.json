{"pr_number": 2480, "pr_title": "fix #2468 Review and polish deprecation suppressions", "pr_createdAt": "2020-11-06T13:51:07Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2480", "timeline": [{"oid": "4190f9994101aec55b7f240381caf9dc8022e39e", "url": "https://github.com/reactor/reactor-core/commit/4190f9994101aec55b7f240381caf9dc8022e39e", "message": "Document sensible suppressed warnings where it makes sense\n\nRewrite some tests otherwise", "committedDate": "2020-11-06T14:18:00Z", "type": "forcePushed"}, {"oid": "474e80d79c1c32e75807b74c342ed589193b55fe", "url": "https://github.com/reactor/reactor-core/commit/474e80d79c1c32e75807b74c342ed589193b55fe", "message": "fix #2468 challenge suppressed deprecation warnings\n\nMake NextProcessor non-deprecated itself. It is hidden from the outside\nworld by being package private.", "committedDate": "2020-11-06T14:18:37Z", "type": "commit"}, {"oid": "c4d7e976eb35a5f0983cdfeabd5119ffe781ec41", "url": "https://github.com/reactor/reactor-core/commit/c4d7e976eb35a5f0983cdfeabd5119ffe781ec41", "message": "Document sensible suppressed warnings where it makes sense\n\nRewrite some tests otherwise", "committedDate": "2020-11-06T14:18:37Z", "type": "commit"}, {"oid": "c4d7e976eb35a5f0983cdfeabd5119ffe781ec41", "url": "https://github.com/reactor/reactor-core/commit/c4d7e976eb35a5f0983cdfeabd5119ffe781ec41", "message": "Document sensible suppressed warnings where it makes sense\n\nRewrite some tests otherwise", "committedDate": "2020-11-06T14:18:37Z", "type": "forcePushed"}, {"oid": "ba3cb80ea1f156df88deaa8f901982789554108d", "url": "https://github.com/reactor/reactor-core/commit/ba3cb80ea1f156df88deaa8f901982789554108d", "message": "Document remaining suppressed warning", "committedDate": "2020-11-09T14:56:28Z", "type": "commit"}, {"oid": "c8437f6b9319794a234cc83ae2f503dbc8490489", "url": "https://github.com/reactor/reactor-core/commit/c8437f6b9319794a234cc83ae2f503dbc8490489", "message": "Remove deprecation on ImmutableSignal.ON_COMPLETE", "committedDate": "2020-11-10T08:42:08Z", "type": "commit"}, {"oid": "c8437f6b9319794a234cc83ae2f503dbc8490489", "url": "https://github.com/reactor/reactor-core/commit/c8437f6b9319794a234cc83ae2f503dbc8490489", "message": "Remove deprecation on ImmutableSignal.ON_COMPLETE", "committedDate": "2020-11-10T08:42:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2MzQzMg==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524163432", "bodyText": "technically, it will rather be simplified into EmitterSink, only implementing Sinks.Many rather than FluxProcessor (which itself will be removed). the class will become package-private though, so \"removed from the public API\".", "author": "simonbasle", "createdAt": "2020-11-16T11:36:38Z", "path": "reactor-core/src/main/java/reactor/core/publisher/SinksSpecs.java", "diffHunk": "@@ -114,21 +113,21 @@ boolean tryAcquire(Thread currentThread) {\n \n \t\t@Override\n \t\tpublic <T> Many<T> onBackpressureBuffer() {\n-\t\t\t@SuppressWarnings(\"deprecation\")\n+\t\t\t@SuppressWarnings(\"deprecation\") // EmitterProcessor will be removed in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2ODQ0Mg==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524168442", "bodyText": "I'd consider making sure the remove comments are easily greppable, by making them consistently end with removed in 3.5 => later on we can simply search for removed in 3.5 and find all spots that need cleanup.", "author": "simonbasle", "createdAt": "2020-11-16T11:41:21Z", "path": "reactor-core/src/test/java/reactor/core/CurrentContextArchTest.java", "diffHunk": "@@ -36,6 +36,7 @@\n \t\t\t.withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_JARS)\n \t\t\t.importPackagesOf(CoreSubscriber.class);\n \n+\t// This is ok as this class tests the deprecated FluxProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1ODU3MQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524258571", "bodyText": "The current comment has the benefit of explaining that this will be removed as a side effect of FluxProcessor being removed. Which is really the (small) value add of this PR when you search for SuppressWarning(\"deprecation\"). Simplifying the texts too much removes context. We can always search for removed.*3\\.5 if needed, wdyt?", "author": "ericbottard", "createdAt": "2020-11-16T13:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2ODQ0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NDAzMQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524264031", "bodyText": "yeah ok. my initial thought was that going the extra mile would make the search for things to remove trivial in 3.5.0, but it is probably safer to assume no consistent message and cast a wider net the day of the removal (since it will be easy to forget about the \"right\" message in future deprecations)", "author": "simonbasle", "createdAt": "2020-11-16T13:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2ODQ0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NzA4MQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524267081", "bodyText": "note that we also have related issues to track what has to be removed in 3.5 per topic (#2478, #2207, #2204 ...)", "author": "aneveu", "createdAt": "2020-11-16T13:29:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2ODQ0Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2OTE0Nw==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524169147", "bodyText": "same comment as above regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T11:42:04Z", "path": "reactor-core/src/test/java/reactor/core/publisher/DelegateProcessorTest.java", "diffHunk": "@@ -24,6 +24,7 @@\n import static org.assertj.core.api.Assertions.assertThat;\n import static org.mockito.Mockito.when;\n \n+// This is ok as this class tests the deprecated DelegateProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2OTI4Ng==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524169286", "bodyText": "same comment as above regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T11:42:10Z", "path": "reactor-core/src/test/java/reactor/core/CurrentContextArchTest.java", "diffHunk": "@@ -69,6 +70,7 @@ public void check(JavaClass item, ConditionEvents events) {\n \t}\n \n \t@Test\n+\t// This is ok as this class tests the deprecated FluxProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2OTQzMQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524169431", "bodyText": "same comment as above regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T11:42:18Z", "path": "reactor-core/src/test/java/reactor/core/publisher/DirectProcessorTest.java", "diffHunk": "@@ -27,6 +27,7 @@\n import static org.assertj.core.api.Assertions.assertThat;\n import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n \n+// This is ok as this class tests the deprecated DirectProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2OTUyMw==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524169523", "bodyText": "same comment as above regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T11:42:23Z", "path": "reactor-core/src/test/java/reactor/core/publisher/EmitterProcessorTest.java", "diffHunk": "@@ -60,6 +60,7 @@\n /**\n  * @author Stephane Maldini\n  */\n+// This is ok as this class tests the deprecated EmitterProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE3MDAxMA==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524170010", "bodyText": "same comment as above regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T11:42:47Z", "path": "reactor-core/src/test/java/reactor/core/publisher/FluxProcessorTest.java", "diffHunk": "@@ -33,6 +33,7 @@\n import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n import static org.assertj.core.api.Assertions.fail;\n \n+// This is ok as this class tests the deprecated FluxProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE4MTM0Nw==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524181347", "bodyText": "maybe mention that it will be safe to plain remove the test in 3.5 as there is already a doOnError test below ?", "author": "simonbasle", "createdAt": "2020-11-16T11:53:07Z", "path": "reactor-core/src/test/java/reactor/core/publisher/NextProcessorTest.java", "diffHunk": "@@ -153,13 +153,14 @@ public void MonoProcessorResultNotAvailable() {\n \t\t});\n \t}\n \n-\t@SuppressWarnings(\"deprecation\")\n \t@Test\n \tpublic void rejectedDoOnSuccessOrError() {\n \t\tNextProcessor<String> mp = new NextProcessor<>(null);\n \t\tAtomicReference<Throwable> ref = new AtomicReference<>();\n \n-\t\tmp.doOnSuccessOrError((s, f) -> ref.set(f)).subscribe(v -> {}, e -> {});\n+\t\t@SuppressWarnings(\"deprecation\") // Because of doOnSuccessOrError, which will be removed in 3.5.0", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE4MTc5MA==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524181790", "bodyText": "maybe mention that it will be safe to plain remove the test in 3.5 as there is already a doOnSuccess test below ?", "author": "simonbasle", "createdAt": "2020-11-16T11:53:32Z", "path": "reactor-core/src/test/java/reactor/core/publisher/NextProcessorTest.java", "diffHunk": "@@ -193,13 +194,14 @@ public void rejectedSubscribeCallback() {\n \t\tassertThat(mp.isError()).isTrue();\n \t}\n \n-\t@SuppressWarnings(\"deprecation\")\n \t@Test\n \tpublic void successDoOnSuccessOrError() {\n \t\tNextProcessor<String> mp = new NextProcessor<>(null);\n \t\tAtomicReference<String> ref = new AtomicReference<>();\n \n-\t\tmp.doOnSuccessOrError((s, f) -> ref.set(s)).subscribe();\n+\t\t@SuppressWarnings(\"deprecation\") // Because of doOnSuccessOrError, which will be removed in 3.5.0\n+\t\tMono<String> mono = mp.doOnSuccessOrError((s, f) -> ref.set(s));", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5MDg0MQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524190841", "bodyText": "nitpick: put these two lines (507+508) on a single line", "author": "simonbasle", "createdAt": "2020-11-16T12:02:02Z", "path": "reactor-core/src/test/java/reactor/core/publisher/NextProcessorTest.java", "diffHunk": "@@ -502,8 +504,8 @@ public void filterMonoProcessorError() {\n \t\tNextProcessor<Integer> mp = new NextProcessor<>(null);\n \t\tNextProcessor<Integer> mp2 = new NextProcessor<>(null);\n \t\tStepVerifier.create(mp.filter(s -> {throw new RuntimeException(\"test\"); })\n-\t\t\t\t\t.subscribeWith\n-\t\t\t\t\t\t(mp2))\n+\t\t                      .subscribeWith", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5MTIzNA==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524191234", "bodyText": "nitpick: put these two lines on a single line", "author": "simonbasle", "createdAt": "2020-11-16T12:02:25Z", "path": "reactor-core/src/test/java/reactor/core/publisher/NextProcessorTest.java", "diffHunk": "@@ -520,8 +522,8 @@ public void doOnSuccessMonoProcessorError() {\n \n \t\tStepVerifier.create(mp.doOnSuccess(s -> {throw new RuntimeException(\"test\"); })\n \t\t                      .doOnError(ref::set)\n-\t\t\t\t\t.subscribeWith\n-\t\t\t\t\t\t(mp2))\n+\t\t                      .subscribeWith", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5MjUwMw==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524192503", "bodyText": "nitpick: I think IntelliJ's formatter is getting confused by the mix of tabs and spaces in this file. we should generally favor tabs for most of the colums (and let it adjust the alignment of dots with a few spaces if there is a shift of less than 4 characters)", "author": "simonbasle", "createdAt": "2020-11-16T12:03:42Z", "path": "reactor-core/src/test/java/reactor/core/publisher/NextProcessorTest.java", "diffHunk": "@@ -327,7 +329,7 @@ public void mapFulfill() {\n \t\tmp.onNext(1);\n \n \t\tNextProcessor<Integer> mp2 = mp.map(s -> s * 2)\n-\t\t\t\t\t\t\t\t\t   .cache()\n+\t\t                               .cache()", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5NDIyNQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524194225", "bodyText": "same nitpick as above with tabs, also applies to line 615", "author": "simonbasle", "createdAt": "2020-11-16T12:05:21Z", "path": "reactor-core/src/test/java/reactor/core/publisher/NextProcessorTest.java", "diffHunk": "@@ -609,8 +611,8 @@ public void scanProcessorError() {\n \t@SuppressWarnings(\"deprecated\")\n \tpublic void sharedMonoReusesInstance() {\n \t\tMono<String> sharedMono = Mono.just(\"foo\")\n-\t\t\t\t\t\t\t\t\t  .hide()\n-\t\t\t\t\t\t\t\t\t  .share();\n+\t\t                              .hide()", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5NDc2NQ==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524194765", "bodyText": "same comment as earlier regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T12:05:51Z", "path": "reactor-core/src/test/java/reactor/core/publisher/ReplayProcessorTest.java", "diffHunk": "@@ -36,6 +36,7 @@\n import static org.assertj.core.api.Assertions.assertThat;\n import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n \n+// This is ok as this class tests the deprecated ReplayProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5NDg2NA==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524194864", "bodyText": "same comment as earlier regarding the removed in 3.5", "author": "simonbasle", "createdAt": "2020-11-16T12:05:56Z", "path": "reactor-core/src/test/java/reactor/core/publisher/UnicastProcessorTest.java", "diffHunk": "@@ -46,6 +46,7 @@\n import static org.assertj.core.api.Assertions.assertThat;\n import static reactor.core.publisher.Sinks.EmitFailureHandler.FAIL_FAST;\n \n+// This is ok as this class tests the deprecated UnicastProcessor. Will be removed with it in 3.5.", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5NTcyNw==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524195727", "bodyText": "same comment as earlier regarding the removed in 3.5. eg here comment could be to be removed in 3.5 with newElastic()", "author": "simonbasle", "createdAt": "2020-11-16T12:06:49Z", "path": "reactor-core/src/test/java/reactor/core/scheduler/SchedulersTest.java", "diffHunk": "@@ -59,7 +59,7 @@\n \n \tfinal static class TestSchedulers implements Schedulers.Factory {\n \n-\t\t@SuppressWarnings(\"deprecation\")\n+\t\t@SuppressWarnings(\"deprecation\") // to be removed with newElastic() in 3.5", "originalCommit": "c8437f6b9319794a234cc83ae2f503dbc8490489", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5NjYwNw==", "url": "https://github.com/reactor/reactor-core/pull/2480#discussion_r524196607", "bodyText": "also applies to all comments below in the file", "author": "simonbasle", "createdAt": "2020-11-16T12:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5NTcyNw=="}], "type": "inlineReview", "revised_code": null}]}