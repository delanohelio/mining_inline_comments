{"pr_number": 2609, "pr_title": "Wrap ProxyConnectException with UnprocessedRequestException", "pr_createdAt": "2020-03-18T15:15:06Z", "pr_url": "https://github.com/line/armeria/pull/2609", "timeline": [{"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251", "url": "https://github.com/line/armeria/commit/42ccad8b0c992e326f1e5d8e723225f8c1472251", "message": "try wrapping e in HttpSessionHandler", "committedDate": "2020-03-19T14:18:46Z", "type": "commit"}, {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251", "url": "https://github.com/line/armeria/commit/42ccad8b0c992e326f1e5d8e723225f8c1472251", "message": "try wrapping e in HttpSessionHandler", "committedDate": "2020-03-19T14:18:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEyMDYzOQ==", "url": "https://github.com/line/armeria/pull/2609#discussion_r395120639", "bodyText": "Looks like a good place!", "author": "trustin", "createdAt": "2020-03-19T15:37:32Z", "path": "core/src/main/java/com/linecorp/armeria/client/HttpSessionHandler.java", "diffHunk": "@@ -350,6 +351,10 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n \n     @Override\n     public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {\n+        if (cause instanceof ProxyConnectException) {\n+            setPendingException(ctx, new UnprocessedRequestException(cause));", "originalCommit": "42ccad8b0c992e326f1e5d8e723225f8c1472251", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEyMTI0NQ==", "url": "https://github.com/line/armeria/pull/2609#discussion_r395121245", "bodyText": "Could you add some comment? e.g.\n// ProxyConnectException is handled by HttpSessionHandler.exceptionCaught().", "author": "trustin", "createdAt": "2020-03-19T15:38:18Z", "path": "core/src/main/java/com/linecorp/armeria/client/HttpRequestSubscriber.java", "diffHunk": "@@ -334,6 +335,10 @@ private void cancelSubscription() {\n     }\n \n     private void failAndReset(Throwable cause) {\n+        if (cause instanceof ProxyConnectException) {\n+            return;", "originalCommit": "42ccad8b0c992e326f1e5d8e723225f8c1472251", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b", "chunk": "diff --git a/core/src/main/java/com/linecorp/armeria/client/HttpRequestSubscriber.java b/core/src/main/java/com/linecorp/armeria/client/HttpRequestSubscriber.java\nindex b60e3e24a..d4c4b30e8 100644\n--- a/core/src/main/java/com/linecorp/armeria/client/HttpRequestSubscriber.java\n+++ b/core/src/main/java/com/linecorp/armeria/client/HttpRequestSubscriber.java\n\n@@ -336,6 +336,7 @@ final class HttpRequestSubscriber implements Subscriber<HttpObject>, ChannelFutu\n \n     private void failAndReset(Throwable cause) {\n         if (cause instanceof ProxyConnectException) {\n+            // ProxyConnectException is handled by HttpSessionHandler.exceptionCaught().\n             return;\n         }\n \n"}}, {"oid": "7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b", "url": "https://github.com/line/armeria/commit/7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b", "message": "add comment specifying where ProxyConnectionEvent is handled", "committedDate": "2020-03-20T12:14:01Z", "type": "commit"}]}