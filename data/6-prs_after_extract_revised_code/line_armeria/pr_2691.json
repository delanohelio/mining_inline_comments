{"pr_number": 2691, "pr_title": "Fix for issue #2688 (armeria-jetty: ArmeriaConnector - NPE when DEBUG logging enabled)", "pr_createdAt": "2020-05-06T13:38:13Z", "pr_url": "https://github.com/line/armeria/pull/2691", "timeline": [{"oid": "c3dd6a499c9c34b0e691c85cbd6ea5ebfb9cdd03", "url": "https://github.com/line/armeria/commit/c3dd6a499c9c34b0e691c85cbd6ea5ebfb9cdd03", "message": "Fix for issue #2688: Prevented NPE in ArmeriaConnector during Jetty server startup with DEBUG logging enabled. Added a check for \"armeriaServer\" instance being NULL and return some mockup values.", "committedDate": "2020-05-06T13:34:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwMTU3MA==", "url": "https://github.com/line/armeria/pull/2691#discussion_r421301570", "bodyText": "You can return SystemInfo.hostname().", "author": "trustin", "createdAt": "2020-05-07T07:40:14Z", "path": "jetty/src/main/java/com/linecorp/armeria/server/jetty/ArmeriaConnector.java", "diffHunk": "@@ -61,6 +63,17 @@ public Object getTransport() {\n \n     @Override\n     public String getHost() {\n+        //noinspection ConstantConditions\n+        if (armeriaServer == null) {\n+            // This method could be called during ServerConnector construction (for diagnostic purposes)\n+            // BEFORE {@code armeriaServer} gets assigned. In such case case,\n+            // return some reasonable mockup value in order to prevent NPE.\n+            try {\n+                return InetAddress.getLocalHost().getHostName();\n+            } catch (UnknownHostException e) {\n+                return \"\";\n+            }", "originalCommit": "c3dd6a499c9c34b0e691c85cbd6ea5ebfb9cdd03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzODcwOQ==", "url": "https://github.com/line/armeria/pull/2691#discussion_r423038709", "bodyText": "Fixed", "author": "max904-github", "createdAt": "2020-05-11T13:28:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwMTU3MA=="}], "type": "inlineReview", "revised_code": {"commit": "dc95ae76af07ccacfe420509928e4d1764b535b8", "chunk": "diff --git a/jetty/src/main/java/com/linecorp/armeria/server/jetty/ArmeriaConnector.java b/jetty/src/main/java/com/linecorp/armeria/server/jetty/ArmeriaConnector.java\nindex e01397d35..279e5ce4a 100644\n--- a/jetty/src/main/java/com/linecorp/armeria/server/jetty/ArmeriaConnector.java\n+++ b/jetty/src/main/java/com/linecorp/armeria/server/jetty/ArmeriaConnector.java\n\n@@ -68,11 +68,7 @@ final class ArmeriaConnector extends ServerConnector {\n             // This method could be called during ServerConnector construction (for diagnostic purposes)\n             // BEFORE {@code armeriaServer} gets assigned. In such case case,\n             // return some reasonable mockup value in order to prevent NPE.\n-            try {\n-                return InetAddress.getLocalHost().getHostName();\n-            } catch (UnknownHostException e) {\n-                return \"\";\n-            }\n+            return SystemInfo.hostname();\n         }\n         return armeriaServer.defaultHostname();\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwMTc1OA==", "url": "https://github.com/line/armeria/pull/2691#discussion_r421301758", "bodyText": "2020 \ud83d\ude09", "author": "trustin", "createdAt": "2020-05-07T07:40:35Z", "path": "jetty/src/test/java/com/linecorp/armeria/server/jetty/JettyServiceStartupTest.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * Copyright 2016 LINE Corporation", "originalCommit": "c3dd6a499c9c34b0e691c85cbd6ea5ebfb9cdd03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzODc5MA==", "url": "https://github.com/line/armeria/pull/2691#discussion_r423038790", "bodyText": "Fixed", "author": "max904-github", "createdAt": "2020-05-11T13:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwMTc1OA=="}], "type": "inlineReview", "revised_code": {"commit": "dc95ae76af07ccacfe420509928e4d1764b535b8", "chunk": "diff --git a/jetty/src/test/java/com/linecorp/armeria/server/jetty/JettyServiceStartupTest.java b/jetty/src/test/java/com/linecorp/armeria/server/jetty/JettyServiceStartupTest.java\nindex e538664eb..9615750ca 100644\n--- a/jetty/src/test/java/com/linecorp/armeria/server/jetty/JettyServiceStartupTest.java\n+++ b/jetty/src/test/java/com/linecorp/armeria/server/jetty/JettyServiceStartupTest.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2016 LINE Corporation\n+ * Copyright 2020 LINE Corporation\n  *\n  * LINE Corporation licenses this file to you under the Apache License,\n  * version 2.0 (the \"License\"); you may not use this file except in compliance\n"}}, {"oid": "dc95ae76af07ccacfe420509928e4d1764b535b8", "url": "https://github.com/line/armeria/commit/dc95ae76af07ccacfe420509928e4d1764b535b8", "message": "- review comments by @trustin (InetAddress.getLocalHost().getHostName() -> SystemInfo.hostname())\n- fixed JUnit failures at JettyServiceStartupTest", "committedDate": "2020-05-11T13:28:13Z", "type": "commit"}]}