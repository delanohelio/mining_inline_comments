{"pr_number": 2751, "pr_title": "Improve the exception message for the case of unexpected type", "pr_createdAt": "2020-05-30T05:49:51Z", "pr_url": "https://github.com/line/armeria/pull/2751", "timeline": [{"oid": "97dde35887a4b491b6d00e87b84e32f8676c1682", "url": "https://github.com/line/armeria/commit/97dde35887a4b491b6d00e87b84e32f8676c1682", "message": "Add better error message", "committedDate": "2020-05-30T05:49:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxOTE4NA==", "url": "https://github.com/line/armeria/pull/2751#discussion_r432819184", "bodyText": "How about: ... (expected: ...) for consistency with the IllegalArgumentException messages?", "author": "trustin", "createdAt": "2020-05-30T07:29:29Z", "path": "core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java", "diffHunk": "@@ -241,9 +241,9 @@ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception\n         }\n     }\n \n-    private void failWithUnexpectedMessageType(ChannelHandlerContext ctx, Object msg) {\n+    private void failWithUnexpectedMessageType(ChannelHandlerContext ctx, Object msg, Class<?> expected) {\n         fail(ctx, new ProtocolViolationException(\n-                \"unexpected message type: \" + msg.getClass().getName()));\n+                \"unexpected message type: \" + msg.getClass().getName() + \", expected \" + expected.getName()));", "originalCommit": "97dde35887a4b491b6d00e87b84e32f8676c1682", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA4NzU3MQ==", "url": "https://github.com/line/armeria/pull/2751#discussion_r433087571", "bodyText": "sgtm, fixed", "author": "huydx", "createdAt": "2020-06-01T07:42:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxOTE4NA=="}], "type": "inlineReview", "revised_code": {"commit": "ede5a1f3f8de17a0869ad446dd3352721c585ee1", "chunk": "diff --git a/core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java b/core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java\nindex 93b56f24ee..0a6f160740 100644\n--- a/core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java\n+++ b/core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java\n\n@@ -243,7 +243,8 @@ final class Http1ResponseDecoder extends HttpResponseDecoder implements ChannelI\n \n     private void failWithUnexpectedMessageType(ChannelHandlerContext ctx, Object msg, Class<?> expected) {\n         fail(ctx, new ProtocolViolationException(\n-                \"unexpected message type: \" + msg.getClass().getName() + \", expected \" + expected.getName()));\n+                \"unexpected message type: \" + msg.getClass().getName() +\n+                \" (expected: \" + expected.getName() + ')'));\n     }\n \n     private void fail(ChannelHandlerContext ctx, Throwable cause) {\n"}}, {"oid": "ede5a1f3f8de17a0869ad446dd3352721c585ee1", "url": "https://github.com/line/armeria/commit/ede5a1f3f8de17a0869ad446dd3352721c585ee1", "message": "comment feedback", "committedDate": "2020-06-01T07:28:30Z", "type": "commit"}]}