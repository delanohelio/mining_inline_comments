{"pr_number": 2774, "pr_title": "Validate a boolean parameter strictly in annotated services", "pr_createdAt": "2020-06-04T10:10:01Z", "pr_url": "https://github.com/line/armeria/pull/2774", "timeline": [{"oid": "2ece3d084e7678a2af21aa6e46262fba0243f60e", "url": "https://github.com/line/armeria/commit/2ece3d084e7678a2af21aa6e46262fba0243f60e", "message": "Validate a boolean parameter strictly in annotated services\n\nMotivation:\n\nGiven the following annotated service:\n\n    public class MyService {\n        @Get(\"/get\")\n        public String get(@Param boolean value) {\n            return String.valueOf(value);\n        }\n    }\n\n`GET /get?value=` or `GET /get?value=badvalue` injects `false` into\nthe parameter `value`, which is unclear to many users.\n\nModifications:\n\n- Use a custom function for parsing a boolean parameter instead of\n  `Boolean.valueOf()`.\n\nResult:\n\n- Less surprising behavior\n- Fixes #2767", "committedDate": "2020-06-04T10:07:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTgzOQ==", "url": "https://github.com/line/armeria/pull/2774#discussion_r435721839", "bodyText": "Couldn't we take other common boolean expressions such as:\n\n1 and 0\nyes and no\nhttps://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/convert/support/StringToBooleanConverter.java#L38-L46", "author": "ikhoon", "createdAt": "2020-06-05T06:49:14Z", "path": "core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java", "diffHunk": "@@ -115,5 +116,16 @@\n                 \"Can't convert '\" + str + \"' to type '\" + clazz.getSimpleName() + \"'.\");\n     }\n \n+    private static Boolean parseBoolean(String s) {\n+        switch (Ascii.toLowerCase(s)) {\n+            case \"true\":\n+                return true;\n+            case \"false\":\n+                return false;", "originalCommit": "2ece3d084e7678a2af21aa6e46262fba0243f60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg1NTU3NQ==", "url": "https://github.com/line/armeria/pull/2774#discussion_r435855575", "bodyText": "How about on and off then?", "author": "trustin", "createdAt": "2020-06-05T11:18:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTgzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "0c7b06ea3e10d23e0d30f26a5ff80d9fdc5c1c6d", "chunk": "diff --git a/core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java b/core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java\nindex 3c51469eb..564656441 100644\n--- a/core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java\n+++ b/core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java\n\n@@ -117,14 +129,11 @@ final class AnnotatedServiceTypeUtil {\n     }\n \n     private static Boolean parseBoolean(String s) {\n-        switch (Ascii.toLowerCase(s)) {\n-            case \"true\":\n-                return true;\n-            case \"false\":\n-                return false;\n-            default:\n-                throw new IllegalArgumentException(\"must be 'true' or 'false': \" + s);\n+        final Boolean result = stringToBooleanMap.get(Ascii.toLowerCase(s));\n+        if (result == null) {\n+            throw new IllegalArgumentException(\"must be one of \" + stringToBooleanMap.keySet() + \": \" + s);\n         }\n+        return result;\n     }\n \n     private AnnotatedServiceTypeUtil() {}\n"}}, {"oid": "48ebd656885b156e4bd5c8b5c094fa60dd297fb9", "url": "https://github.com/line/armeria/commit/48ebd656885b156e4bd5c8b5c094fa60dd297fb9", "message": "Merge branch 'master' into fix_boolean_parse", "committedDate": "2020-06-05T11:22:15Z", "type": "commit"}, {"oid": "0c7b06ea3e10d23e0d30f26a5ff80d9fdc5c1c6d", "url": "https://github.com/line/armeria/commit/0c7b06ea3e10d23e0d30f26a5ff80d9fdc5c1c6d", "message": "Relax a little bit", "committedDate": "2020-06-05T11:38:37Z", "type": "commit"}, {"oid": "ad0bddc24f1a8bf92a82d83aa2cbcc9864ab6032", "url": "https://github.com/line/armeria/commit/ad0bddc24f1a8bf92a82d83aa2cbcc9864ab6032", "message": "Merge branch 'master' into fix_boolean_parse", "committedDate": "2020-06-05T11:52:56Z", "type": "commit"}, {"oid": "4c6d13d870850deef8c7d14877791effc3d082dc", "url": "https://github.com/line/armeria/commit/4c6d13d870850deef8c7d14877791effc3d082dc", "message": "Tad bit more strict", "committedDate": "2020-06-05T13:16:05Z", "type": "commit"}]}