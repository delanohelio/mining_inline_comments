{"pr_number": 2733, "pr_title": "Update dependencies", "pr_createdAt": "2020-05-21T03:49:46Z", "pr_url": "https://github.com/line/armeria/pull/2733", "timeline": [{"oid": "2d64c93075267ecd906e9828c978bacffa645c57", "url": "https://github.com/line/armeria/commit/2d64c93075267ecd906e9828c978bacffa645c57", "message": "Update dependencies\n- Caffeine 2.8.2 -> 2.8.3\n- grpc-kotlin-stub 0.1.1 -> 0.1.2\n- io.dropwizard.metrics 4.1.7 -> 4.1.8\n- kotlinx-coroutines-core 1.3.6 -> 1.3.7\n- reactor-grpc 1.0.0 -> 1.0.1\n- Retrofit 2.8.1 -> 2.8.2\n- Build\n  - Awaitility 4.0.2 -> 4.0.3\n  - Eureka 1.9.20 -> 1.9.22\n  - Gradle 6.4 -> 6.4.1\n  - gradle-node-plugin 2.2.3 -> 2.2.4", "committedDate": "2020-05-21T03:48:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxMTE2Mw==", "url": "https://github.com/line/armeria/pull/2733#discussion_r429011163", "bodyText": "How about casting Object to Class<?>?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        final Object kClass = valueMethod.invoke(annotation, null);\n          \n          \n            \n                        return Class.forName(kClass.toString().substring(\"class \".length()));\n          \n          \n            \n                        final Class<?> kClass = (Class<?>) valueMethod.invoke(annotation, null);\n          \n          \n            \n                        return Class.forName(kClass.getName());", "author": "ikhoon", "createdAt": "2020-05-22T02:28:55Z", "path": "grpc/src/main/java/com/linecorp/armeria/internal/client/grpc/GrpcClientFactory.java", "diffHunk": "@@ -216,4 +238,29 @@ private static IllegalArgumentException newUnknownClientTypeException(Class<?> c\n         }\n         return ImmutableList.copyOf(descriptor.getMethods());\n     }\n+\n+    private static Class<?> generatedStub(Annotation annotation, Method valueMethod) {\n+        try {\n+            final Object kClass = valueMethod.invoke(annotation, null);\n+            return Class.forName(kClass.toString().substring(\"class \".length()));", "originalCommit": "df16fba2a7a7ebc0c68735d775249503928f50d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzMTg0OQ==", "url": "https://github.com/line/armeria/pull/2733#discussion_r429031849", "bodyText": "Why not just returning kClass then? No point of doing Class.forName()", "author": "trustin", "createdAt": "2020-05-22T04:06:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxMTE2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzNTQ4Ng==", "url": "https://github.com/line/armeria/pull/2733#discussion_r429035486", "bodyText": "Why not just returning kClass then? No point of doing Class.forName()\n\nAhh, you are right! \ud83e\udd23", "author": "ikhoon", "createdAt": "2020-05-22T04:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxMTE2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1Mjg2OA==", "url": "https://github.com/line/armeria/pull/2733#discussion_r429052868", "bodyText": "Oops fixed. \ud83d\ude05", "author": "minwoox", "createdAt": "2020-05-22T05:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxMTE2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "07c5445a7b4b74bba3d4316576d0d7bdf1857e31", "chunk": "diff --git a/grpc/src/main/java/com/linecorp/armeria/internal/client/grpc/GrpcClientFactory.java b/grpc/src/main/java/com/linecorp/armeria/internal/client/grpc/GrpcClientFactory.java\nindex fdfadcc93..fe2fccec7 100644\n--- a/grpc/src/main/java/com/linecorp/armeria/internal/client/grpc/GrpcClientFactory.java\n+++ b/grpc/src/main/java/com/linecorp/armeria/internal/client/grpc/GrpcClientFactory.java\n\n@@ -241,9 +241,8 @@ final class GrpcClientFactory extends DecoratingClientFactory {\n \n     private static Class<?> generatedStub(Annotation annotation, Method valueMethod) {\n         try {\n-            final Object kClass = valueMethod.invoke(annotation, null);\n-            return Class.forName(kClass.toString().substring(\"class \".length()));\n-        } catch (IllegalAccessException | InvocationTargetException | ClassNotFoundException e) {\n+            return (Class<?>) valueMethod.invoke(annotation, null);\n+        } catch (IllegalAccessException | InvocationTargetException e) {\n             throw new IllegalStateException(\"Could not find a gRPC Kotlin generated client stub.\");\n         }\n     }\n"}}, {"oid": "07c5445a7b4b74bba3d4316576d0d7bdf1857e31", "url": "https://github.com/line/armeria/commit/07c5445a7b4b74bba3d4316576d0d7bdf1857e31", "message": "Use StubFor annotation for grpc-kotlin stub", "committedDate": "2020-05-22T05:42:37Z", "type": "commit"}, {"oid": "07c5445a7b4b74bba3d4316576d0d7bdf1857e31", "url": "https://github.com/line/armeria/commit/07c5445a7b4b74bba3d4316576d0d7bdf1857e31", "message": "Use StubFor annotation for grpc-kotlin stub", "committedDate": "2020-05-22T05:42:37Z", "type": "forcePushed"}, {"oid": "ce51968dd72fd0b90c2649706bf735409d99967c", "url": "https://github.com/line/armeria/commit/ce51968dd72fd0b90c2649706bf735409d99967c", "message": "Upgrade more", "committedDate": "2020-05-25T01:33:06Z", "type": "commit"}, {"oid": "4df8c24cdafc02f4c5402919b6f731259fab5bae", "url": "https://github.com/line/armeria/commit/4df8c24cdafc02f4c5402919b6f731259fab5bae", "message": "Support Micrometer 1.3", "committedDate": "2020-05-25T04:32:34Z", "type": "commit"}, {"oid": "95ca51756c229843dfe4ab84201c365fa33c9f5a", "url": "https://github.com/line/armeria/commit/95ca51756c229843dfe4ab84201c365fa33c9f5a", "message": "Revert \"Support Micrometer 1.3\"\n\nThis reverts commit 4df8c24cdafc02f4c5402919b6f731259fab5bae.", "committedDate": "2020-05-25T05:44:57Z", "type": "commit"}, {"oid": "95ca51756c229843dfe4ab84201c365fa33c9f5a", "url": "https://github.com/line/armeria/commit/95ca51756c229843dfe4ab84201c365fa33c9f5a", "message": "Revert \"Support Micrometer 1.3\"\n\nThis reverts commit 4df8c24cdafc02f4c5402919b6f731259fab5bae.", "committedDate": "2020-05-25T05:44:57Z", "type": "forcePushed"}, {"oid": "8747b9b8fd47a89b1c5d1f306d1ffd36f0c38bde", "url": "https://github.com/line/armeria/commit/8747b9b8fd47a89b1c5d1f306d1ffd36f0c38bde", "message": "Merge branch 'master' into update_deps", "committedDate": "2020-05-26T01:35:37Z", "type": "commit"}]}