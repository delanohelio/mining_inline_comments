{"pr_number": 2149, "pr_title": "[Feature] CVV caixa", "pr_createdAt": "2020-05-14T14:41:57Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2149", "timeline": [{"oid": "9b8537ee3e1329b6ab6b5bbd647a6f50403aca2d", "url": "https://github.com/mercadopago/px-android/commit/9b8537ee3e1329b6ab6b5bbd647a6f50403aca2d", "message": "update model, layout updated", "committedDate": "2020-05-13T14:00:34Z", "type": "commit"}, {"oid": "ba054ceb899ebb8af19db45930a0c17e504f2b88", "url": "https://github.com/mercadopago/px-android/commit/ba054ceb899ebb8af19db45930a0c17e504f2b88", "message": "add sample", "committedDate": "2020-05-13T17:31:33Z", "type": "commit"}, {"oid": "a2f25172ac8301e562f8e5034a3e3a417df3a56c", "url": "https://github.com/mercadopago/px-android/commit/a2f25172ac8301e562f8e5034a3e3a417df3a56c", "message": "add cvv info to groups", "committedDate": "2020-05-14T12:25:40Z", "type": "commit"}, {"oid": "cfc89a26dddfd5e115acb52c7832327c0d23b783", "url": "https://github.com/mercadopago/px-android/commit/cfc89a26dddfd5e115acb52c7832327c0d23b783", "message": "bottom_description fixed", "committedDate": "2020-05-14T13:43:49Z", "type": "commit"}, {"oid": "eab7925746eeda04eb780b4fe3f9b66f0b049715", "url": "https://github.com/mercadopago/px-android/commit/eab7925746eeda04eb780b4fe3f9b66f0b049715", "message": "revert test changes", "committedDate": "2020-05-14T14:17:31Z", "type": "commit"}, {"oid": "52a8eda5aa8e4ee99e76bece68b3220f6810f9ee", "url": "https://github.com/mercadopago/px-android/commit/52a8eda5aa8e4ee99e76bece68b3220f6810f9ee", "message": "revert test onetap", "committedDate": "2020-05-14T14:19:02Z", "type": "commit"}, {"oid": "480082fb07f46028b8178fdf3274f4cd0edfcb8c", "url": "https://github.com/mercadopago/px-android/commit/480082fb07f46028b8178fdf3274f4cd0edfcb8c", "message": "revert changes CheckoutService", "committedDate": "2020-05-14T14:24:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5OTA1NA==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425199054", "bodyText": "podemos encapsular la l\u00f3gica del if else en m\u00e9todos para que no quede tan grande y este mas contextualizado, no?\ntipo\nif(showCvv){\nshowCvv()\n} else {\nshowCustomView()\n}", "author": "cgaggino", "createdAt": "2020-05-14T14:52:15Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java", "diffHunk": "@@ -228,30 +232,43 @@ public void stopLoadingView() {\n     }\n \n     private void loadViews() {\n-        mCardView = new CardView(this);\n-        final String lastFourDigits = presenter.getCardInfo().getLastFourDigits();\n-        mCardView.setSize(CardRepresentationModes.BIG_SIZE);\n-        mCardView.inflateInParent(mCardContainer, true);\n-        mCardView.initializeControls();\n-        mCardView.setPaymentMethod(presenter.getPaymentMethod());\n-        mCardView.setSecurityCodeLength(presenter.getSecurityCodeLength());\n-        mCardView.setSecurityCodeLocation(presenter.getSecurityCodeLocation());\n-        mCardView.setCardNumberLength(presenter.getCardNumberLength());\n-        mCardView.setLastFourDigits(lastFourDigits);\n-        mCardView.draw(CardView.CARD_SIDE_FRONT);\n-        mCardView.drawFullCard();\n-        mCardView.drawEditingSecurityCode(\"\");\n-        presenter.setSecurityCodeCardType();\n \n-        executeIfAccessibilityTalkBackEnable(this, () -> {\n-            mCardContainer.setContentDescription(new SpannableStringBuilder()\n-                .append(getString(R.string.px_card_number_label))\n-                .append(TextUtil.SPACE)\n-                .append(getString(R.string.px_ending_in))\n-                .append(TextUtil.SPACE)\n-                .append(lastFourDigits));\n-            return null;\n-        });\n+        if (!presenter.showCvvInfo()) {\n+            mCardView = new CardView(this);", "originalCommit": "480082fb07f46028b8178fdf3274f4cd0edfcb8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5OTgxOQ==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425199819", "bodyText": "Dale!", "author": "jorGonzalez291292", "createdAt": "2020-05-14T14:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5OTA1NA=="}], "type": "inlineReview", "revised_code": {"commit": "d194b814d26dc0c98043f414928c69643115aa08", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java\nindex 698c2096c..2ab044248 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java\n\n@@ -232,45 +232,51 @@ public class SecurityCodeActivity extends PXActivity<SecurityCodePresenter> impl\n     }\n \n     private void loadViews() {\n-\n-        if (!presenter.showCvvInfo()) {\n-            mCardView = new CardView(this);\n-            final String lastFourDigits = presenter.getCardInfo().getLastFourDigits();\n-            mCardView.setSize(CardRepresentationModes.BIG_SIZE);\n-            mCardView.inflateInParent(mCardContainer, true);\n-            mCardView.initializeControls();\n-            mCardView.setPaymentMethod(presenter.getPaymentMethod());\n-            mCardView.setSecurityCodeLength(presenter.getSecurityCodeLength());\n-            mCardView.setSecurityCodeLocation(presenter.getSecurityCodeLocation());\n-            mCardView.setCardNumberLength(presenter.getCardNumberLength());\n-            mCardView.setLastFourDigits(lastFourDigits);\n-            mCardView.draw(CardView.CARD_SIDE_FRONT);\n-            mCardView.drawFullCard();\n-            mCardView.drawEditingSecurityCode(\"\");\n-\n-            executeIfAccessibilityTalkBackEnable(this, () -> {\n-                mCardContainer.setContentDescription(new SpannableStringBuilder()\n-                    .append(getString(R.string.px_card_number_label))\n-                    .append(TextUtil.SPACE)\n-                    .append(getString(R.string.px_ending_in))\n-                    .append(TextUtil.SPACE)\n-                    .append(lastFourDigits));\n-                return null;\n-            });\n+        if (!presenter.shouldShowCvvInfo()) {\n+            showCvv();\n         } else {\n-\n-            final CvvInfo cvvInfo = presenter.getCard().getCvvInfo();\n-            final View view = LayoutInflater.from(this).inflate(R.layout.px_cvv_info, mCardContainer, true);\n-\n-            final AppCompatTextView title = view.findViewById(R.id.title);\n-\n-            FontHelper.setFont(title, PxFont.SEMI_BOLD);\n-            title.setText(cvvInfo.getTitle());\n-            ViewUtils.loadOrGone(cvvInfo.getMessage(), view.findViewById(R.id.message));\n+            showCustomView();\n         }\n         presenter.setSecurityCodeCardType();\n     }\n \n+    private void showCvv() {\n+        mCardView = new CardView(this);\n+        final String lastFourDigits = presenter.getCardInfo().getLastFourDigits();\n+        mCardView.setSize(CardRepresentationModes.BIG_SIZE);\n+        mCardView.inflateInParent(mCardContainer, true);\n+        mCardView.initializeControls();\n+        mCardView.setPaymentMethod(presenter.getPaymentMethod());\n+        mCardView.setSecurityCodeLength(presenter.getSecurityCodeLength());\n+        mCardView.setSecurityCodeLocation(presenter.getSecurityCodeLocation());\n+        mCardView.setCardNumberLength(presenter.getCardNumberLength());\n+        mCardView.setLastFourDigits(lastFourDigits);\n+        mCardView.draw(CardView.CARD_SIDE_FRONT);\n+        mCardView.drawFullCard();\n+        mCardView.drawEditingSecurityCode(\"\");\n+\n+        executeIfAccessibilityTalkBackEnable(this, () -> {\n+            mCardContainer.setContentDescription(new SpannableStringBuilder()\n+                .append(getString(R.string.px_card_number_label))\n+                .append(TextUtil.SPACE)\n+                .append(getString(R.string.px_ending_in))\n+                .append(TextUtil.SPACE)\n+                .append(lastFourDigits));\n+            return null;\n+        });\n+    }\n+\n+    private void showCustomView() {\n+        final CvvInfo cvvInfo = presenter.getCvvInfo();\n+        final View view = LayoutInflater.from(this).inflate(R.layout.px_cvv_info, mCardContainer, true);\n+\n+        final AppCompatTextView title = view.findViewById(R.id.title);\n+\n+        FontHelper.setFont(title, PxFont.SEMI_BOLD);\n+        title.setText(cvvInfo.getTitle());\n+        ViewUtils.loadOrGone(cvvInfo.getMessage(), view.findViewById(R.id.message));\n+    }\n+\n     private void setSecurityCodeCardColorFilter() {\n         final int color = ResourceUtil.getCardColor(presenter.getPaymentMethod().getId(), this);\n         mSecurityCodeCardIcon.setColorFilter(ContextCompat.getColor(this, color), PorterDuff.Mode.DST_OVER);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIwMTc1OA==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425201758", "bodyText": "esto parece una acci\u00f3n pero es una validaci\u00f3n, seria mas onda shouldShowCvvInfo", "author": "cgaggino", "createdAt": "2020-05-14T14:55:35Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodePresenter.java", "diffHunk": "@@ -100,6 +100,10 @@ public PaymentMethod getPaymentMethod() {\n         return paymentMethod;\n     }\n \n+    public boolean showCvvInfo() {", "originalCommit": "480082fb07f46028b8178fdf3274f4cd0edfcb8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIwNDUyOQ==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425204529", "bodyText": "Tenes raz\u00f3n", "author": "jorGonzalez291292", "createdAt": "2020-05-14T14:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIwMTc1OA=="}], "type": "inlineReview", "revised_code": {"commit": "d194b814d26dc0c98043f414928c69643115aa08", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodePresenter.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodePresenter.java\nindex d765b1738..f5a87b67d 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodePresenter.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodePresenter.java\n\n@@ -100,8 +102,16 @@ public class SecurityCodePresenter extends BasePresenter<SecurityCodeActivityVie\n         return paymentMethod;\n     }\n \n-    public boolean showCvvInfo() {\n-        return card.getCvvInfo() != null;\n+    public CvvInfo getCvvInfo() {\n+        PaymentMethod pm = getCard().getPaymentMethod();\n+        if (pm != null && pm.getDisplayInfo() != null) {\n+            return pm.getDisplayInfo().getCvvInfo();\n+        }\n+        return null;\n+    }\n+\n+    public boolean shouldShowCvvInfo() {\n+        return getCvvInfo() != null;\n     }\n \n     public Token getToken() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIxMTE2NQ==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425211165", "bodyText": "por que hacemos el gone del shadow siempre?", "author": "cgaggino", "createdAt": "2020-05-14T15:08:00Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/PaymentMethodFragment.java", "diffHunk": "@@ -78,8 +78,8 @@ public void initializeViews(@NonNull final View view) {\n             ViewUtils.setBackgroundColor(view.findViewById(R.id.bottom_description_background),\n                 model.getBottomDescription().getBackgroundColor());\n             ViewUtils.loadOrHide(View.INVISIBLE, model.getBottomDescription(), bottomDescription);\n-            view.findViewById(R.id.bottom_description_shadow).setVisibility(View.GONE);\n         }\n+        view.findViewById(R.id.bottom_description_shadow).setVisibility(View.GONE);", "originalCommit": "480082fb07f46028b8178fdf3274f4cd0edfcb8c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d194b814d26dc0c98043f414928c69643115aa08", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/PaymentMethodFragment.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/PaymentMethodFragment.java\nindex 67a1201d6..cd58ebc9c 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/PaymentMethodFragment.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/PaymentMethodFragment.java\n\n@@ -78,8 +78,8 @@ public abstract class PaymentMethodFragment<T extends DrawableFragmentItem>\n             ViewUtils.setBackgroundColor(view.findViewById(R.id.bottom_description_background),\n                 model.getBottomDescription().getBackgroundColor());\n             ViewUtils.loadOrHide(View.INVISIBLE, model.getBottomDescription(), bottomDescription);\n+            view.findViewById(R.id.bottom_description_shadow).setVisibility(View.INVISIBLE);\n         }\n-        view.findViewById(R.id.bottom_description_shadow).setVisibility(View.GONE);\n         if (hasFocus()) {\n             onFocusIn();\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIyNTU5NA==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425225594", "bodyText": "esto no iria si usamos directamente el payment method dentro de la pantalla de security code", "author": "cgaggino", "createdAt": "2020-05-14T15:27:02Z", "path": "px-services/src/main/java/com/mercadopago/android/px/model/Card.java", "diffHunk": "@@ -23,6 +23,7 @@\n     private String lastFourDigits;\n     private PaymentMethod paymentMethod;\n     private SecurityCode securityCode;\n+    private CvvInfo cvvInfo;", "originalCommit": "480082fb07f46028b8178fdf3274f4cd0edfcb8c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d194b814d26dc0c98043f414928c69643115aa08", "chunk": "diff --git a/px-services/src/main/java/com/mercadopago/android/px/model/Card.java b/px-services/src/main/java/com/mercadopago/android/px/model/Card.java\nindex f4bdba4c2..0d0123565 100755\n--- a/px-services/src/main/java/com/mercadopago/android/px/model/Card.java\n+++ b/px-services/src/main/java/com/mercadopago/android/px/model/Card.java\n\n@@ -23,7 +23,6 @@ public final class Card implements CardInformation {\n     private String lastFourDigits;\n     private PaymentMethod paymentMethod;\n     private SecurityCode securityCode;\n-    private CvvInfo cvvInfo;\n     private String escStatus;\n \n     @Deprecated\n"}}, {"oid": "d194b814d26dc0c98043f414928c69643115aa08", "url": "https://github.com/mercadopago/px-android/commit/d194b814d26dc0c98043f414928c69643115aa08", "message": "review changes", "committedDate": "2020-05-14T17:05:20Z", "type": "commit"}, {"oid": "f44d6ba794575c85b5e6921a816d25d459fb23f8", "url": "https://github.com/mercadopago/px-android/commit/f44d6ba794575c85b5e6921a816d25d459fb23f8", "message": "Merge branch 'master' of github.com:mercadopago/px-android into feature/cvv-caixa", "committedDate": "2020-05-14T17:15:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMwNDE4Mw==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425304183", "bodyText": "Us\u00e1 el MPTextView", "author": "guchito9", "createdAt": "2020-05-14T17:18:34Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java", "diffHunk": "@@ -254,6 +266,17 @@ private void loadViews() {\n         });\n     }\n \n+    private void showCustomView() {\n+        final CvvInfo cvvInfo = presenter.getCvvInfo();\n+        final View view = LayoutInflater.from(this).inflate(R.layout.px_cvv_info, mCardContainer, true);\n+\n+        final AppCompatTextView title = view.findViewById(R.id.title);\n+\n+        FontHelper.setFont(title, PxFont.SEMI_BOLD);", "originalCommit": "d194b814d26dc0c98043f414928c69643115aa08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "132c8b621cd8cc980f9d464e110fb5644756296e", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java\nindex 2ab044248..1317620d7 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/SecurityCodeActivity.java\n\n@@ -270,9 +270,7 @@ public class SecurityCodeActivity extends PXActivity<SecurityCodePresenter> impl\n         final CvvInfo cvvInfo = presenter.getCvvInfo();\n         final View view = LayoutInflater.from(this).inflate(R.layout.px_cvv_info, mCardContainer, true);\n \n-        final AppCompatTextView title = view.findViewById(R.id.title);\n-\n-        FontHelper.setFont(title, PxFont.SEMI_BOLD);\n+        final MPTextView title = view.findViewById(R.id.title);\n         title.setText(cvvInfo.getTitle());\n         ViewUtils.loadOrGone(cvvInfo.getMessage(), view.findViewById(R.id.message));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMwNjUwMw==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425306503", "bodyText": "Esto parece estar al pedo", "author": "guchito9", "createdAt": "2020-05-14T17:22:36Z", "path": "px-services/src/main/java/com/mercadopago/android/px/model/PaymentMethodSearch.java", "diffHunk": "@@ -3,6 +3,7 @@\n import android.support.annotation.NonNull;\n import android.support.annotation.Nullable;\n import com.google.gson.annotations.SerializedName;\n+import com.mercadopago.android.px.model.display_info.DisplayInfo;", "originalCommit": "d194b814d26dc0c98043f414928c69643115aa08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "132c8b621cd8cc980f9d464e110fb5644756296e", "chunk": "diff --git a/px-services/src/main/java/com/mercadopago/android/px/model/PaymentMethodSearch.java b/px-services/src/main/java/com/mercadopago/android/px/model/PaymentMethodSearch.java\nindex 3c38595fa..a3d069734 100755\n--- a/px-services/src/main/java/com/mercadopago/android/px/model/PaymentMethodSearch.java\n+++ b/px-services/src/main/java/com/mercadopago/android/px/model/PaymentMethodSearch.java\n\n@@ -3,7 +3,6 @@ package com.mercadopago.android.px.model;\n import android.support.annotation.NonNull;\n import android.support.annotation.Nullable;\n import com.google.gson.annotations.SerializedName;\n-import com.mercadopago.android.px.model.display_info.DisplayInfo;\n import java.io.Serializable;\n import java.util.ArrayList;\n import java.util.Collections;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMwNjkwMA==", "url": "https://github.com/mercadopago/px-android/pull/2149#discussion_r425306900", "bodyText": "Falta el @nullable del m\u00e9todo", "author": "guchito9", "createdAt": "2020-05-14T17:23:15Z", "path": "px-services/src/main/java/com/mercadopago/android/px/model/display_info/DisplayInfo.java", "diffHunk": "@@ -23,18 +27,24 @@ public Text getDescription() {\n         return description;\n     }\n \n+    public CvvInfo getCvvInfo() {", "originalCommit": "d194b814d26dc0c98043f414928c69643115aa08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "132c8b621cd8cc980f9d464e110fb5644756296e", "url": "https://github.com/mercadopago/px-android/commit/132c8b621cd8cc980f9d464e110fb5644756296e", "message": "MPTextView added", "committedDate": "2020-05-14T18:01:49Z", "type": "commit"}, {"oid": "8d68ff5ca808043922f8725c4cc6aecb84d88eb7", "url": "https://github.com/mercadopago/px-android/commit/8d68ff5ca808043922f8725c4cc6aecb84d88eb7", "message": "remove import", "committedDate": "2020-05-14T18:09:06Z", "type": "commit"}]}