{"pr_number": 2208, "pr_title": "[Feature] Money split view", "pr_createdAt": "2020-06-25T14:39:32Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2208", "timeline": [{"oid": "0dcd322eb132854f6a432c21c881296ffdd5f8e4", "url": "https://github.com/mercadopago/px-android/commit/0dcd322eb132854f6a432c21c881296ffdd5f8e4", "message": "split payment added", "committedDate": "2020-06-22T16:19:28Z", "type": "commit"}, {"oid": "1f188dbd03135d2be34d7a12c6bd2d3ce8ed9121", "url": "https://github.com/mercadopago/px-android/commit/1f188dbd03135d2be34d7a12c6bd2d3ce8ed9121", "message": "refactor money split component", "committedDate": "2020-06-23T19:53:19Z", "type": "commit"}, {"oid": "f1d29d4a3b5d53e045c34b200a4fa21b10ee1fa5", "url": "https://github.com/mercadopago/px-android/commit/f1d29d4a3b5d53e045c34b200a4fa21b10ee1fa5", "message": "refactor name", "committedDate": "2020-06-24T13:54:29Z", "type": "commit"}, {"oid": "94e563c476c06b7adc2a24e309b961bdc42ab435", "url": "https://github.com/mercadopago/px-android/commit/94e563c476c06b7adc2a24e309b961bdc42ab435", "message": "action card view for money split added, deeplink track by screen added", "committedDate": "2020-06-25T12:25:21Z", "type": "commit"}, {"oid": "7de774f1f2a81802e5b3495e9f136f8e9471e27e", "url": "https://github.com/mercadopago/px-android/commit/7de774f1f2a81802e5b3495e9f136f8e9471e27e", "message": "merge", "committedDate": "2020-06-25T14:18:39Z", "type": "commit"}, {"oid": "b80d9e4f2c6a6e990df7883649bea404874930c6", "url": "https://github.com/mercadopago/px-android/commit/b80d9e4f2c6a6e990df7883649bea404874930c6", "message": "revert changes in onetap samples", "committedDate": "2020-06-25T14:20:54Z", "type": "commit"}, {"oid": "54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "url": "https://github.com/mercadopago/px-android/commit/54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "message": "remove imports, revert changes in LocaleUtil", "committedDate": "2020-06-25T14:29:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3MzMyMQ==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445673321", "bodyText": "Es un overkill tener un mapper para cada modelo? para que no queden tantos getters de este estilo, termina siendo una s\u00e1bana la clase", "author": "cgaggino", "createdAt": "2020-06-25T16:09:50Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java", "diffHunk": "@@ -304,4 +307,52 @@ public String getButtonDeepLink() {\n \n         return crossSellingBoxData;\n     }\n+\n+    @Nullable\n+    private MLBusinessActionCardViewData getMoneySplitData(@Nullable final CongratsResponse.MoneySplit moneySplit) {", "originalCommit": "54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcyODY4Mw==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445728683", "bodyText": "ok", "author": "jorGonzalez291292", "createdAt": "2020-06-25T17:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3MzMyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "5f20b5fa6efc176f7f15763be1256a54253f7c72", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java\nindex 08da450d5..5d31480db 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java\n\n@@ -310,49 +309,6 @@ public class CongratsResponseMapper extends Mapper<CongratsResponse, CongratsVie\n \n     @Nullable\n     private MLBusinessActionCardViewData getMoneySplitData(@Nullable final CongratsResponse.MoneySplit moneySplit) {\n-\n-        if (moneySplit == null) {\n-            return null;\n-        }\n-\n-        final Text title = moneySplit.getTitle();\n-\n-        return new MLBusinessActionCardViewData() {\n-            @NonNull\n-            @Override\n-            public String getTitle() {\n-                return title.getMessage();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getTitleColor() {\n-                return title.getTextColor();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getTitleBackgroundColor() {\n-                return title.getBackgroundColor();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getTitleWeight() {\n-                return title.getWeight();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getImageUrl() {\n-                return moneySplit.getImageUrl();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getAffordanceText() {\n-                return moneySplit.getAction().getLabel();\n-            }\n-        };\n+        return MLBusinessMapper.map(moneySplit);\n     }\n }\n\\ No newline at end of file\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3NjM3Nw==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445676377", "bodyText": "podemos hacer mas safe esto? crasheamos si no viene de backend?, se que deberia venir pero hoy no tenemos una capa intermedia, lo mismo los otros getters", "author": "cgaggino", "createdAt": "2020-06-25T16:14:07Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java", "diffHunk": "@@ -304,4 +307,52 @@ public String getButtonDeepLink() {\n \n         return crossSellingBoxData;\n     }\n+\n+    @Nullable\n+    private MLBusinessActionCardViewData getMoneySplitData(@Nullable final CongratsResponse.MoneySplit moneySplit) {\n+\n+        if (moneySplit == null) {\n+            return null;\n+        }\n+\n+        final Text title = moneySplit.getTitle();\n+\n+        return new MLBusinessActionCardViewData() {\n+            @NonNull\n+            @Override\n+            public String getTitle() {\n+                return title.getMessage();", "originalCommit": "54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcyODc0MA==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445728740", "bodyText": "ok", "author": "jorGonzalez291292", "createdAt": "2020-06-25T17:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3NjM3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "5f20b5fa6efc176f7f15763be1256a54253f7c72", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java\nindex 08da450d5..5d31480db 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/CongratsResponseMapper.java\n\n@@ -310,49 +309,6 @@ public class CongratsResponseMapper extends Mapper<CongratsResponse, CongratsVie\n \n     @Nullable\n     private MLBusinessActionCardViewData getMoneySplitData(@Nullable final CongratsResponse.MoneySplit moneySplit) {\n-\n-        if (moneySplit == null) {\n-            return null;\n-        }\n-\n-        final Text title = moneySplit.getTitle();\n-\n-        return new MLBusinessActionCardViewData() {\n-            @NonNull\n-            @Override\n-            public String getTitle() {\n-                return title.getMessage();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getTitleColor() {\n-                return title.getTextColor();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getTitleBackgroundColor() {\n-                return title.getBackgroundColor();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getTitleWeight() {\n-                return title.getWeight();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getImageUrl() {\n-                return moneySplit.getImageUrl();\n-            }\n-\n-            @NonNull\n-            @Override\n-            public String getAffordanceText() {\n-                return moneySplit.getAction().getLabel();\n-            }\n-        };\n+        return MLBusinessMapper.map(moneySplit);\n     }\n }\n\\ No newline at end of file\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4OTE1MQ==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445689151", "bodyText": "No me copa en el presenter esto, podriamos tener un objeto que conozca estos est\u00e1ticos, podria ser un enum si lo necesitamos a nivel firma", "author": "cgaggino", "createdAt": "2020-06-25T16:33:41Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java", "diffHunk": "@@ -47,6 +49,7 @@\n     private final ResultViewTrack resultViewTrack;\n     private final PaymentResultScreenConfiguration screenConfiguration;\n     private final FlowBehaviour flowBehaviour;\n+    private static final String MONEY_SPLIT_TYPE = \"money_split\";", "originalCommit": "54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczNzQ2OA==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445737468", "bodyText": "dale", "author": "jorGonzalez291292", "createdAt": "2020-06-25T17:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4OTE1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5f20b5fa6efc176f7f15763be1256a54253f7c72", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java\nindex a1be90d51..2461ccaf1 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java\n\n@@ -49,13 +50,12 @@ import java.util.List;\n     private final ResultViewTrack resultViewTrack;\n     private final PaymentResultScreenConfiguration screenConfiguration;\n     private final FlowBehaviour flowBehaviour;\n-    private static final String MONEY_SPLIT_TYPE = \"money_split\";\n \n     private FailureRecovery failureRecovery;\n \n     /* default */ PaymentResultPresenter(@NonNull final PaymentSettingRepository paymentSettings,\n         @NonNull final InstructionsRepository instructionsRepository, @NonNull final PaymentModel paymentModel,\n-        @NonNull final FlowBehaviour flowBehaviour) {\n+        @NonNull final FlowBehaviour flowBehaviour, final boolean isMP) {\n         this.paymentModel = paymentModel;\n         this.instructionsRepository = instructionsRepository;\n         this.flowBehaviour = flowBehaviour;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NTc1Mw==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445695753", "bodyText": "no deberia considerar tambien si es MP o ML? trackearia true para ML en versiones viejas cuando lo prendan", "author": "cgaggino", "createdAt": "2020-06-25T16:44:39Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/model/ResultViewTrackModel.java", "diffHunk": "@@ -54,13 +55,15 @@ public ResultViewTrackModel(@NonNull final PaymentModel paymentModel,\n         hasBottomView = screenConfiguration.hasBottomFragment();\n         hasTopView = screenConfiguration.hasTopFragment();\n         hasImportantView = false;\n+        hasMoneySplitView = paymentModel.getCongratsResponse().getMoneySplit() != null;\n     }\n \n     public ResultViewTrackModel(@NonNull final BusinessPaymentModel paymentModel,\n         @NonNull final CheckoutPreference checkoutPreference, @NonNull final String currencyId) {\n         this(Style.CUSTOM, paymentModel, checkoutPreference, currencyId);\n         hasBottomView = paymentModel.getPayment().hasBottomFragment();\n         hasTopView = paymentModel.getPayment().hasTopFragment();\n+        hasMoneySplitView = paymentModel.getCongratsResponse().getMoneySplit() != null;", "originalCommit": "54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczMzk4OQ==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445733989", "bodyText": "oka", "author": "jorGonzalez291292", "createdAt": "2020-06-25T17:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NTc1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "5f20b5fa6efc176f7f15763be1256a54253f7c72", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/model/ResultViewTrackModel.java b/px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/model/ResultViewTrackModel.java\nindex a79ee91d3..fc7a05f63 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/model/ResultViewTrackModel.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/model/ResultViewTrackModel.java\n\n@@ -50,20 +52,20 @@ public final class ResultViewTrackModel extends TrackingMapModel {\n \n     public ResultViewTrackModel(@NonNull final PaymentModel paymentModel,\n         @NonNull final PaymentResultScreenConfiguration screenConfiguration,\n-        @NonNull final CheckoutPreference checkoutPreference, @NonNull final String currencyId) {\n+        @NonNull final CheckoutPreference checkoutPreference, @NonNull final String currencyId, final boolean isMP) {\n         this(Style.GENERIC, paymentModel, checkoutPreference, currencyId);\n         hasBottomView = screenConfiguration.hasBottomFragment();\n         hasTopView = screenConfiguration.hasTopFragment();\n         hasImportantView = false;\n-        hasMoneySplitView = paymentModel.getCongratsResponse().getMoneySplit() != null;\n+        hasMoneySplitView = isMP && paymentModel.getCongratsResponse().getMoneySplit() != null;\n     }\n \n     public ResultViewTrackModel(@NonNull final BusinessPaymentModel paymentModel,\n-        @NonNull final CheckoutPreference checkoutPreference, @NonNull final String currencyId) {\n+        @NonNull final CheckoutPreference checkoutPreference, @NonNull final String currencyId, final boolean isMP) {\n         this(Style.CUSTOM, paymentModel, checkoutPreference, currencyId);\n         hasBottomView = paymentModel.getPayment().hasBottomFragment();\n         hasTopView = paymentModel.getPayment().hasTopFragment();\n-        hasMoneySplitView = paymentModel.getCongratsResponse().getMoneySplit() != null;\n+        hasMoneySplitView = isMP && paymentModel.getCongratsResponse().getMoneySplit() != null;\n     }\n \n     private ResultViewTrackModel(@NonNull final Style style, @NonNull final PaymentModel paymentModel,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NzY3MQ==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445697671", "bodyText": "qued\u00f3 de m\u00e1s el comment de default", "author": "cgaggino", "createdAt": "2020-06-25T16:47:31Z", "path": "px-services/src/main/java/com/mercadopago/android/px/model/internal/CongratsResponse.java", "diffHunk": "@@ -553,4 +563,52 @@ public int getRight() {\n             return right;\n         }\n     }\n+\n+    /* default */ public static final class MoneySplit implements Parcelable {", "originalCommit": "54bd9e4b66fb2afda38b0e751fcdb739dc20d105", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcyOTIyOA==", "url": "https://github.com/mercadopago/px-android/pull/2208#discussion_r445729228", "bodyText": "lo saco", "author": "jorGonzalez291292", "createdAt": "2020-06-25T17:42:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NzY3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5f20b5fa6efc176f7f15763be1256a54253f7c72", "chunk": "diff --git a/px-services/src/main/java/com/mercadopago/android/px/model/internal/CongratsResponse.java b/px-services/src/main/java/com/mercadopago/android/px/model/internal/CongratsResponse.java\nindex e7e6ffd72..3c81b1c7a 100644\n--- a/px-services/src/main/java/com/mercadopago/android/px/model/internal/CongratsResponse.java\n+++ b/px-services/src/main/java/com/mercadopago/android/px/model/internal/CongratsResponse.java\n\n@@ -564,7 +564,7 @@ public final class CongratsResponse implements Parcelable {\n         }\n     }\n \n-    /* default */ public static final class MoneySplit implements Parcelable {\n+    public static final class MoneySplit implements Parcelable {\n         private final Text title;\n         private final Action action;\n         private final String imageUrl;\n"}}, {"oid": "5f20b5fa6efc176f7f15763be1256a54253f7c72", "url": "https://github.com/mercadopago/px-android/commit/5f20b5fa6efc176f7f15763be1256a54253f7c72", "message": "review changes", "committedDate": "2020-06-25T18:11:50Z", "type": "commit"}, {"oid": "5c071da04e0050fe253732955afc01bee6f2222c", "url": "https://github.com/mercadopago/px-android/commit/5c071da04e0050fe253732955afc01bee6f2222c", "message": "change base context", "committedDate": "2020-06-25T18:14:37Z", "type": "commit"}, {"oid": "22e85cd633a5a4fd499d9bc820fd48a296499806", "url": "https://github.com/mercadopago/px-android/commit/22e85cd633a5a4fd499d9bc820fd48a296499806", "message": "Remove experimental business components version", "committedDate": "2020-06-25T18:45:14Z", "type": "commit"}]}