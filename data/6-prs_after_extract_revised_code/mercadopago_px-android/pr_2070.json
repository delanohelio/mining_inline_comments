{"pr_number": 2070, "pr_title": "[Feature] Congrats service", "pr_createdAt": "2020-03-17T00:09:22Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2070", "timeline": [{"oid": "4f66deea22df64fd56a1ba12de2fcde2099b3550", "url": "https://github.com/mercadopago/px-android/commit/4f66deea22df64fd56a1ba12de2fcde2099b3550", "message": "fixed nullpointer in cardform", "committedDate": "2020-03-14T17:38:36Z", "type": "commit"}, {"oid": "db06007f68140ae192a68678848b85217a8b7c3f", "url": "https://github.com/mercadopago/px-android/commit/db06007f68140ae192a68678848b85217a8b7c3f", "message": "Merge pull request #2068 from mercadopago/fix/fragments-onetap-cardform\n\nFixed nullpointer in cardform", "committedDate": "2020-03-15T18:01:52Z", "type": "commit"}, {"oid": "4936097ed33d6d39004137e4b304e6b8d811a7ce", "url": "https://github.com/mercadopago/px-android/commit/4936097ed33d6d39004137e4b304e6b8d811a7ce", "message": " * Refactored payment service", "committedDate": "2020-03-17T00:15:32Z", "type": "commit"}, {"oid": "33b579b3f7d125fff3a01cced6452155f6f18d4d", "url": "https://github.com/mercadopago/px-android/commit/33b579b3f7d125fff3a01cced6452155f6f18d4d", "message": "Added congrats service", "committedDate": "2020-03-17T00:18:01Z", "type": "forcePushed"}, {"oid": "b3278c6e26ee765f3d4ad81ad8cd11d506c4c109", "url": "https://github.com/mercadopago/px-android/commit/b3278c6e26ee765f3d4ad81ad8cd11d506c4c109", "message": "Added congrats service", "committedDate": "2020-03-17T06:43:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3MTQ0OQ==", "url": "https://github.com/mercadopago/px-android/pull/2070#discussion_r393471449", "bodyText": "el valor de paymentSettings.getCurrency va a ser resuelto al momento que se llame getPaymentRewardRepository, que va a ser al momento de realizar las inyecciones de dependencia, pasaria el repositorio de paymentSettings directamente a CongratsRepositoryImpl para que resuelva lo que necesite en su momento (y de paso es un parametro menos)", "author": "cgaggino", "createdAt": "2020-03-17T06:43:50Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/di/Session.java", "diffHunk": "@@ -447,17 +447,17 @@ public PaymentMethodsRepository getPaymentMethodsRepository() {\n         return paymentMethodsRepository;\n     }\n \n-    public PaymentRewardRepository getPaymentRewardRepository() {\n-        if (paymentRewardRepository == null) {\n+    public CongratsRepository getCongratsRepository() {\n+        if (congratsRepository == null) {\n             final Context applicationContext = getApplicationContext();\n-            final PaymentRewardService paymentRewardService =\n-                RetrofitUtil.getRetrofitClient(applicationContext).create(PaymentRewardService.class);\n+            final CongratsService congratsService =\n+                RetrofitUtil.getRetrofitClient(applicationContext).create(CongratsService.class);\n             final PaymentSettingRepository paymentSettings = getConfigurationModule().getPaymentSettings();\n-            paymentRewardRepository =\n-                new PaymentRewardRepositoryImpl(getPaymentRewardCache(), paymentRewardService,\n-                    paymentSettings.getPrivateKey(), getPlatform(applicationContext),\n+            congratsRepository =\n+                new CongratsRepositoryImpl(getPaymentRewardCache(), congratsService, paymentSettings.getPrivateKey(),\n+                    paymentSettings.getCurrency(), getPlatform(applicationContext),", "originalCommit": "33b579b3f7d125fff3a01cced6452155f6f18d4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3NjkzOA==", "url": "https://github.com/mercadopago/px-android/pull/2070#discussion_r393476938", "bodyText": "Si, ya lo tuve que arreglar, me tir\u00f3 el famoso error de que no puede traer currency del storage", "author": "guchito9", "createdAt": "2020-03-17T07:01:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3MTQ0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "d617e596dd793980d235f59c204bc8f1d3c4db9b", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/di/Session.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/di/Session.java\nindex 2f7275041..2ed76fcd4 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/di/Session.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/di/Session.java\n\n@@ -454,8 +444,7 @@ public final class Session extends ApplicationModule implements AmountComponent\n                 RetrofitUtil.getRetrofitClient(applicationContext).create(CongratsService.class);\n             final PaymentSettingRepository paymentSettings = getConfigurationModule().getPaymentSettings();\n             congratsRepository =\n-                new CongratsRepositoryImpl(getPaymentRewardCache(), congratsService, paymentSettings.getPrivateKey(),\n-                    paymentSettings.getCurrency(), getPlatform(applicationContext),\n+                new CongratsRepositoryImpl(congratsService, paymentSettings, getPlatform(applicationContext),\n                     LocaleUtil.getLanguage(getApplicationContext()), MPTracker.getInstance().getFlowName());\n         }\n         return congratsRepository;\n"}}, {"oid": "b3278c6e26ee765f3d4ad81ad8cd11d506c4c109", "url": "https://github.com/mercadopago/px-android/commit/b3278c6e26ee765f3d4ad81ad8cd11d506c4c109", "message": "Added congrats service", "committedDate": "2020-03-17T06:43:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ4MzkwNA==", "url": "https://github.com/mercadopago/px-android/pull/2070#discussion_r393483904", "bodyText": "La logica de retries funciona igual?", "author": "cgaggino", "createdAt": "2020-03-17T07:22:48Z", "path": "px-services/src/main/java/com/mercadopago/android/px/internal/util/RetrofitUtil.java", "diffHunk": "@@ -32,6 +33,7 @@ private static Retrofit getRetrofit(final Context context,\n             .addConverterFactory(GsonConverterFactory.create(JsonUtil.getGson()))\n             .client(HttpClientUtil.getClient(context, connectTimeout, readTimeout, writeTimeout))\n             .addCallAdapterFactory(new ErrorHandlingCallAdapter.ErrorHandlingCallAdapterFactory())\n+            .addCallAdapterFactory(CoroutineCallAdapterFactory.create())", "originalCommit": "b3278c6e26ee765f3d4ad81ad8cd11d506c4c109", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTk0OA==", "url": "https://github.com/mercadopago/px-android/pull/2070#discussion_r393685948", "bodyText": "Lamentablemente no, cae por el adapter nuevo. Por ah\u00ed estar\u00eda bueno discutir si vale la pena llevarlo al mismo comportamiento, pero se puede hacer en el futuro.", "author": "guchito9", "createdAt": "2020-03-17T13:40:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ4MzkwNA=="}], "type": "inlineReview", "revised_code": {"commit": "daf56892d60d7b2302fa3b42a15ecd6e77c3eaad", "chunk": "diff --git a/px-services/src/main/java/com/mercadopago/android/px/internal/util/RetrofitUtil.java b/px-services/src/main/java/com/mercadopago/android/px/internal/util/RetrofitUtil.java\nindex 3c10a2925..53e3ce2be 100644\n--- a/px-services/src/main/java/com/mercadopago/android/px/internal/util/RetrofitUtil.java\n+++ b/px-services/src/main/java/com/mercadopago/android/px/internal/util/RetrofitUtil.java\n\n@@ -33,7 +32,6 @@ public final class RetrofitUtil {\n             .addConverterFactory(GsonConverterFactory.create(JsonUtil.getGson()))\n             .client(HttpClientUtil.getClient(context, connectTimeout, readTimeout, writeTimeout))\n             .addCallAdapterFactory(new ErrorHandlingCallAdapter.ErrorHandlingCallAdapterFactory())\n-            .addCallAdapterFactory(CoroutineCallAdapterFactory.create())\n             .build();\n     }\n-}\n\\ No newline at end of file\n+}\n"}}, {"oid": "d617e596dd793980d235f59c204bc8f1d3c4db9b", "url": "https://github.com/mercadopago/px-android/commit/d617e596dd793980d235f59c204bc8f1d3c4db9b", "message": "custom cvv remedy layout added", "committedDate": "2020-03-17T21:49:41Z", "type": "commit"}, {"oid": "40039ed5d2b8691f0025b30256afad1c910ccdf5", "url": "https://github.com/mercadopago/px-android/commit/40039ed5d2b8691f0025b30256afad1c910ccdf5", "message": "change document fragment remedies", "committedDate": "2020-03-17T21:54:37Z", "type": "commit"}, {"oid": "7913585a4d8d56d66a8e5a819f7c0a5f0d818e69", "url": "https://github.com/mercadopago/px-android/commit/7913585a4d8d56d66a8e5a819f7c0a5f0d818e69", "message": "More work on the congrats service", "committedDate": "2020-03-18T03:02:26Z", "type": "commit"}, {"oid": "78a1c8a69b95f3a2e681439ed11407da79cf18a1", "url": "https://github.com/mercadopago/px-android/commit/78a1c8a69b95f3a2e681439ed11407da79cf18a1", "message": "Merge branch 'feature/congrats-service' of github.com:mercadopago/px-android into feature/congrats-service", "committedDate": "2020-03-18T03:22:51Z", "type": "commit"}, {"oid": "78a1c8a69b95f3a2e681439ed11407da79cf18a1", "url": "https://github.com/mercadopago/px-android/commit/78a1c8a69b95f3a2e681439ed11407da79cf18a1", "message": "Merge branch 'feature/congrats-service' of github.com:mercadopago/px-android into feature/congrats-service", "committedDate": "2020-03-18T03:22:51Z", "type": "forcePushed"}, {"oid": "daf56892d60d7b2302fa3b42a15ecd6e77c3eaad", "url": "https://github.com/mercadopago/px-android/commit/daf56892d60d7b2302fa3b42a15ecd6e77c3eaad", "message": "* Added PayButtonFragment", "committedDate": "2020-03-18T05:54:17Z", "type": "commit"}, {"oid": "34919ec0275220b66c190d58f866c7b066501ca9", "url": "https://github.com/mercadopago/px-android/commit/34919ec0275220b66c190d58f866c7b066501ca9", "message": "render remedy view, mapper remedy data", "committedDate": "2020-03-18T21:32:23Z", "type": "commit"}, {"oid": "484a1ff20f1039f129292e1f2e287e94b86122bc", "url": "https://github.com/mercadopago/px-android/commit/484a1ff20f1039f129292e1f2e287e94b86122bc", "message": "refactor", "committedDate": "2020-03-18T22:05:41Z", "type": "commit"}, {"oid": "a21cff2e48b9fa5ed14a7c3badb5cf911f280f2e", "url": "https://github.com/mercadopago/px-android/commit/a21cff2e48b9fa5ed14a7c3badb5cf911f280f2e", "message": "refactor", "committedDate": "2020-03-18T22:22:46Z", "type": "forcePushed"}, {"oid": "484a1ff20f1039f129292e1f2e287e94b86122bc", "url": "https://github.com/mercadopago/px-android/commit/484a1ff20f1039f129292e1f2e287e94b86122bc", "message": "refactor", "committedDate": "2020-03-18T22:05:41Z", "type": "forcePushed"}, {"oid": "0f85bf2e4285c2514c7792bb9d0fe2b047518806", "url": "https://github.com/mercadopago/px-android/commit/0f85bf2e4285c2514c7792bb9d0fe2b047518806", "message": "* Cleaned express payment view", "committedDate": "2020-03-18T23:07:19Z", "type": "commit"}, {"oid": "89ec097f66e40b12b4f1daa299c56068dfc0e4e3", "url": "https://github.com/mercadopago/px-android/commit/89ec097f66e40b12b4f1daa299c56068dfc0e4e3", "message": "Merge branch 'enhancement/generic-confirmation-button' into feature/congrats-service", "committedDate": "2020-03-18T23:16:13Z", "type": "commit"}, {"oid": "ea68b96b2ee3502a2707e55f452ebd8408459a54", "url": "https://github.com/mercadopago/px-android/commit/ea68b96b2ee3502a2707e55f452ebd8408459a54", "message": "* Fixed button adapter", "committedDate": "2020-03-18T23:28:19Z", "type": "commit"}, {"oid": "3dac3913a4a4b9ba0fd841eb0847d62865e95576", "url": "https://github.com/mercadopago/px-android/commit/3dac3913a4a4b9ba0fd841eb0847d62865e95576", "message": "* Update button status", "committedDate": "2020-03-19T00:20:23Z", "type": "commit"}, {"oid": "95dec7a40d33291ca029a0447d334ba83c1751f6", "url": "https://github.com/mercadopago/px-android/commit/95dec7a40d33291ca029a0447d334ba83c1751f6", "message": "* Changed post value by set value", "committedDate": "2020-03-19T00:23:37Z", "type": "commit"}, {"oid": "ba3dd69b97b89bb7326c5e793f78121b04256687", "url": "https://github.com/mercadopago/px-android/commit/ba3dd69b97b89bb7326c5e793f78121b04256687", "message": "* Fixed fragment replacement", "committedDate": "2020-03-19T01:57:18Z", "type": "commit"}, {"oid": "f807510c82e407edbc93dafe9b9858fb32a55e1c", "url": "https://github.com/mercadopago/px-android/commit/f807510c82e407edbc93dafe9b9858fb32a55e1c", "message": "* Reverted set value to post value for problems with fragments", "committedDate": "2020-03-19T02:10:54Z", "type": "commit"}, {"oid": "5f66a9c498cdf09be022062adc09961144c48a6c", "url": "https://github.com/mercadopago/px-android/commit/5f66a9c498cdf09be022062adc09961144c48a6c", "message": "Adding pay button to cvv remedy", "committedDate": "2020-03-19T05:15:22Z", "type": "commit"}, {"oid": "1740a8ed46b39470bc207dab1e874bc4e6891745", "url": "https://github.com/mercadopago/px-android/commit/1740a8ed46b39470bc207dab1e874bc4e6891745", "message": "Merge branch 'enhancement/generic-confirmation-button' into feature/congrats-service", "committedDate": "2020-03-19T05:16:37Z", "type": "commit"}, {"oid": "065697310f0f1a9877a29a302d3862737ba2b756", "url": "https://github.com/mercadopago/px-android/commit/065697310f0f1a9877a29a302d3862737ba2b756", "message": "More work on the cvv remedy", "committedDate": "2020-03-19T09:21:44Z", "type": "commit"}, {"oid": "065697310f0f1a9877a29a302d3862737ba2b756", "url": "https://github.com/mercadopago/px-android/commit/065697310f0f1a9877a29a302d3862737ba2b756", "message": "More work on the cvv remedy", "committedDate": "2020-03-19T09:21:44Z", "type": "forcePushed"}]}