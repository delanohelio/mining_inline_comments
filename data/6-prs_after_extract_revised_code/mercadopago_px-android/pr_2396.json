{"pr_number": 2396, "pr_title": "[Enhancement] Using backUrl and redirectUrl from congrats response", "pr_createdAt": "2020-12-01T21:57:45Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2396", "timeline": [{"oid": "38f5da417ce0610886a83e28984a2ada751ce190", "url": "https://github.com/mercadopago/px-android/commit/38f5da417ce0610886a83e28984a2ada751ce190", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-01T22:04:34Z", "type": "forcePushed"}, {"oid": "11954a6247697abb638500e1b7f952c4fd8835b9", "url": "https://github.com/mercadopago/px-android/commit/11954a6247697abb638500e1b7f952c4fd8835b9", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-01T22:08:38Z", "type": "forcePushed"}, {"oid": "6966d7713be7392e1045c7f13b92d33229757514", "url": "https://github.com/mercadopago/px-android/commit/6966d7713be7392e1045c7f13b92d33229757514", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-01T22:17:23Z", "type": "forcePushed"}, {"oid": "9221c8f1193a9182bb2a9d77507a0f54a0bda006", "url": "https://github.com/mercadopago/px-android/commit/9221c8f1193a9182bb2a9d77507a0f54a0bda006", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-01T22:19:36Z", "type": "forcePushed"}, {"oid": "ec5dc94aad5597cc18b4edde3ac72a12bbaaf8ca", "url": "https://github.com/mercadopago/px-android/commit/ec5dc94aad5597cc18b4edde3ac72a12bbaaf8ca", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-01T22:34:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE0NDU3NA==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534144574", "bodyText": "Te parece guardar model.getPaymentCongratsResponse() en una variable?", "author": "jorGonzalez291292", "createdAt": "2020-12-02T12:54:45Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java", "diffHunk": "@@ -71,7 +71,8 @@ public void onStop() {\n     @Override\n     public void onAbort() {\n         new AbortEvent(viewTracker).track();\n-        getView().processCustomExit();\n+        getView().processCustomExit(model.getPaymentCongratsResponse().getBackUrl(),", "originalCommit": "ec5dc94aad5597cc18b4edde3ac72a12bbaaf8ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDIyODgwOQ==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534228809", "bodyText": "Me parece", "author": "guchito9", "createdAt": "2020-12-02T14:53:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE0NDU3NA=="}], "type": "inlineReview", "revised_code": {"commit": "9cbe380866fd716ff1f284875397a295eda6a53f", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java\nindex 02195c98e..cc02f88a0 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java\n\n@@ -71,8 +71,8 @@ import com.mercadopago.android.px.tracking.internal.views.ResultViewTrack;\n     @Override\n     public void onAbort() {\n         new AbortEvent(viewTracker).track();\n-        getView().processCustomExit(model.getPaymentCongratsResponse().getBackUrl(),\n-            model.getPaymentCongratsResponse().getRedirectUrl());\n+        final PaymentCongratsResponse congratsResponse = model.getPaymentCongratsResponse();\n+        getView().processCustomExit(congratsResponse.getBackUrl(), congratsResponse.getRedirectUrl());\n     }\n \n     private void configureView() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE0NDcyMw==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534144723", "bodyText": "idem anterior", "author": "jorGonzalez291292", "createdAt": "2020-12-02T12:54:59Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java", "diffHunk": "@@ -84,7 +85,8 @@ public void onClick(@NonNull final ExitAction action) {\n                 } else if (action instanceof SecondaryExitAction) {\n                     new SecondaryActionEvent(viewTracker).track();\n                 }\n-                getView().processCustomExit(action);\n+                getView().processCustomExit(action, model.getPaymentCongratsResponse().getBackUrl(),", "originalCommit": "ec5dc94aad5597cc18b4edde3ac72a12bbaaf8ca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9cbe380866fd716ff1f284875397a295eda6a53f", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java\nindex 02195c98e..cc02f88a0 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java\n\n@@ -85,8 +85,8 @@ import com.mercadopago.android.px.tracking.internal.views.ResultViewTrack;\n                 } else if (action instanceof SecondaryExitAction) {\n                     new SecondaryActionEvent(viewTracker).track();\n                 }\n-                getView().processCustomExit(action, model.getPaymentCongratsResponse().getBackUrl(),\n-                    model.getPaymentCongratsResponse().getRedirectUrl());\n+                final PaymentCongratsResponse congratsResponse = model.getPaymentCongratsResponse();\n+                getView().processCustomExit(action, congratsResponse.getBackUrl(), congratsResponse.getRedirectUrl());\n             }\n \n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE0NzY4Mg==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534147682", "bodyText": "De la forma que estaba antes ten\u00edamos una sola llamada para un Normal exit - Result screen. Cual es la diferencia ahora?", "author": "jorGonzalez291292", "createdAt": "2020-12-02T12:59:39Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutActivity.java", "diffHunk": "@@ -273,18 +277,26 @@ private void handleCancel() {\n     }\n \n     private void handleCustomExit(final Intent data) {\n-        if (data != null && data.hasExtra(EXTRA_CLIENT_RES_CODE)) {\n-            //Business custom exit\n-            final int resCode = data.getIntExtra(EXTRA_CLIENT_RES_CODE, RESULT_OK);\n-            presenter.onPaymentResultResponse(resCode);\n-        } else if (data != null && data.hasExtra(EXTRA_RESULT_CODE)) {\n-            //Custom exit  - Result screen.\n-            final Integer finalResultCode = data.getIntExtra(EXTRA_RESULT_CODE, PAYMENT_RESULT_CODE);\n-            customDataBundle = data;\n-            presenter.onPaymentResultResponse(finalResultCode);\n+        if (data != null) {\n+            final String backUrl = data.getStringExtra(Constants.EXTRA_BACK_URL);\n+            final String redirectUrl = data.getStringExtra(Constants.EXTRA_REDIRECT_URL);\n+\n+            if (data.hasExtra(EXTRA_CLIENT_RES_CODE)) {\n+                //Business custom exit\n+                final int resCode = data.getIntExtra(EXTRA_CLIENT_RES_CODE, RESULT_OK);\n+                presenter.onPaymentResultResponse(resCode, backUrl, redirectUrl);\n+            } else if (data != null && data.hasExtra(EXTRA_RESULT_CODE)) {\n+                //Custom exit  - Result screen.\n+                final Integer finalResultCode = data.getIntExtra(EXTRA_RESULT_CODE, PAYMENT_RESULT_CODE);\n+                customDataBundle = data;\n+                presenter.onPaymentResultResponse(finalResultCode, backUrl, redirectUrl);\n+            } else {\n+                //Normal exit - Result screen.\n+                presenter.onPaymentResultResponse(null, backUrl, redirectUrl);", "originalCommit": "ec5dc94aad5597cc18b4edde3ac72a12bbaaf8ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDIyOTY3NQ==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534229675", "bodyText": "Antes no importaba si el intent era null o no. Yo ahora si el intent no es nulo levanto backUrl y sino no. El intent no deber\u00eda ser nunca nulo pero bueno, por las dudas", "author": "guchito9", "createdAt": "2020-12-02T14:54:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE0NzY4Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE1NTYzMQ==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534155631", "bodyText": "Si pasamos paymentModel.getCongratsResponse() en una variable?", "author": "jorGonzalez291292", "createdAt": "2020-12-02T13:12:30Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java", "diffHunk": "@@ -284,4 +284,9 @@ public void onClickMoneySplit() {\n             getView().launchDeepLink(deepLink);\n         }\n     }\n+\n+    private void finishWithResult(final int resultCode) {\n+        getView().finishWithResult(resultCode, paymentModel.getCongratsResponse().getBackUrl(),", "originalCommit": "ec5dc94aad5597cc18b4edde3ac72a12bbaaf8ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDIzNTQ2NA==", "url": "https://github.com/mercadopago/px-android/pull/2396#discussion_r534235464", "bodyText": "De una", "author": "guchito9", "createdAt": "2020-12-02T15:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE1NTYzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "9cbe380866fd716ff1f284875397a295eda6a53f", "chunk": "diff --git a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java\nindex 5ac7222b4..73107df21 100644\n--- a/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java\n+++ b/px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultPresenter.java\n\n@@ -286,7 +286,7 @@ import java.util.List;\n     }\n \n     private void finishWithResult(final int resultCode) {\n-        getView().finishWithResult(resultCode, paymentModel.getCongratsResponse().getBackUrl(),\n-            paymentModel.getCongratsResponse().getRedirectUrl());\n+        final CongratsResponse congratsResponse = paymentModel.getCongratsResponse();\n+        getView().finishWithResult(resultCode, congratsResponse.getBackUrl(), congratsResponse.getRedirectUrl());\n     }\n }\n"}}, {"oid": "9cbe380866fd716ff1f284875397a295eda6a53f", "url": "https://github.com/mercadopago/px-android/commit/9cbe380866fd716ff1f284875397a295eda6a53f", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-02T15:00:18Z", "type": "forcePushed"}, {"oid": "9a6c5ad2353b985ae821fdbce5baf37149c8333c", "url": "https://github.com/mercadopago/px-android/commit/9a6c5ad2353b985ae821fdbce5baf37149c8333c", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-02T18:07:43Z", "type": "forcePushed"}, {"oid": "d6fd732ae555779afbfbb404bd1ab43e22b6ec14", "url": "https://github.com/mercadopago/px-android/commit/d6fd732ae555779afbfbb404bd1ab43e22b6ec14", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-02T20:03:57Z", "type": "forcePushed"}, {"oid": "ad8d5a2b5386c316313112bda25ae67608f8bc6b", "url": "https://github.com/mercadopago/px-android/commit/ad8d5a2b5386c316313112bda25ae67608f8bc6b", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-02T21:21:56Z", "type": "commit"}, {"oid": "ad8d5a2b5386c316313112bda25ae67608f8bc6b", "url": "https://github.com/mercadopago/px-android/commit/ad8d5a2b5386c316313112bda25ae67608f8bc6b", "message": "Using backUrl and redirectUrl from congrats response\n* Appended data to post payment urls", "committedDate": "2020-12-02T21:21:56Z", "type": "forcePushed"}]}