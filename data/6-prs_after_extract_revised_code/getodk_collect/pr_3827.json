{"pr_number": 3827, "pr_title": "Fix QR code tests", "pr_createdAt": "2020-05-13T19:14:47Z", "pr_url": "https://github.com/getodk/collect/pull/3827", "timeline": [{"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354", "url": "https://github.com/getodk/collect/commit/b0eef9846aeaefd886fe1cc7b4711594e7c4a354", "message": "Fix Qr code tests", "committedDate": "2020-05-13T19:08:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3MzQ1OA==", "url": "https://github.com/getodk/collect/pull/3827#discussion_r424673458", "bodyText": "I only ran into problems with this on my emulator and then couldn't reproduce but I thought it made more sense to use a file path that had nothing to do with how the real object would work. This means it's less likely to clash with anything else and highlights that this is fake/stub.", "author": "seadowg", "createdAt": "2020-05-13T19:16:53Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/preferences/qr/ConfigureWithQRCodeTest.java", "diffHunk": "@@ -168,19 +167,19 @@ public Bitmap generateQRBitMap(String data, int sideLength) throws IOException,\n             return Observable.create(emitter -> {\n                 Bitmap bitmap =\n                         BitmapFactory.decodeResource(\n-                                ApplicationProvider.getApplicationContext().getResources(),\n+                                getApplicationContext().getResources(),\n                                 CHECKER_BACKGROUND_DRAWABLE_ID);\n                 emitter.onNext(bitmap);\n+                FileUtils.saveBitmapToFile(bitmap, getQrCodeFilepath());\n \n                 // save bitmap to test that shareQRCode generates bitmap if file not there\n-                FileUtils.saveBitmapToFile(bitmap, getQrCodeFilepath());\n                 emitter.onComplete();\n             });\n         }\n \n         @Override\n         public String getQrCodeFilepath() {\n-            return new StoragePathProvider().getDirPath(StorageSubdirectory.SETTINGS) + File.separator + \"test-collect-settings.png\";\n+            return getApplicationContext().getExternalFilesDir(null) + File.separator + \"test-collect-settings.png\";", "originalCommit": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3MzU4OA==", "url": "https://github.com/getodk/collect/pull/3827#discussion_r424673588", "bodyText": "Moved this up as it made more sense to me to asser this up front", "author": "seadowg", "createdAt": "2020-05-13T19:17:11Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/preferences/qr/ConfigureWithQRCodeTest.java", "diffHunk": "@@ -132,14 +130,18 @@ public void onMainMenu_clickConfigureQRCode_andClickingOnShareQRCode_startsExter\n                 .clickConfigureQR()\n                 .clickOnId(R.id.menu_item_share);\n \n+        // Check that we've actually generated a QR code to share\n+        File qrcodeFile = new File(path);", "originalCommit": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}