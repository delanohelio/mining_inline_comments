{"pr_number": 3824, "pr_title": "Used Dialog Fragment to retain Change Admin Password Dialog on Orientation Change", "pr_createdAt": "2020-05-12T23:36:14Z", "pr_url": "https://github.com/getodk/collect/pull/3824", "timeline": [{"oid": "821eea34adcf02ede3d7acfba221c606ee705cba", "url": "https://github.com/getodk/collect/commit/821eea34adcf02ede3d7acfba221c606ee705cba", "message": "defined tests for dialog", "committedDate": "2020-05-07T23:19:12Z", "type": "commit"}, {"oid": "7e7a94035b7f579e2696d96f8e8a5ac60ba2cc12", "url": "https://github.com/getodk/collect/commit/7e7a94035b7f579e2696d96f8e8a5ac60ba2cc12", "message": "updated tests for dialog", "committedDate": "2020-05-12T04:23:43Z", "type": "commit"}, {"oid": "fc3b5a61ee4da698afd3e2eccfb71e1a50d90672", "url": "https://github.com/getodk/collect/commit/fc3b5a61ee4da698afd3e2eccfb71e1a50d90672", "message": "created change admin password dialog fragment and code refactor", "committedDate": "2020-05-12T23:29:27Z", "type": "commit"}, {"oid": "9b35f1a07bd9e352924634c4bd6c5fe61c555b1c", "url": "https://github.com/getodk/collect/commit/9b35f1a07bd9e352924634c4bd6c5fe61c555b1c", "message": "Merge branch 'master' into change_admin_password_dialog_fragment", "committedDate": "2020-05-12T23:38:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ5MDg4OA==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r424490888", "bodyText": "Hi @seadowg! I'm not sure if the above two tests are necessary.", "author": "SaumiaSinghal", "createdAt": "2020-05-13T14:39:25Z", "path": "collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java", "diffHunk": "@@ -0,0 +1,166 @@\n+package org.odk.collect.android.preferences;\n+\n+import android.content.DialogInterface;\n+import android.content.res.Configuration;\n+import android.text.InputType;\n+import android.widget.CheckBox;\n+import android.widget.EditText;\n+\n+import androidx.appcompat.app.AlertDialog;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.fragment.app.FragmentManager;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.support.RobolectricHelpers;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.RuntimeEnvironment;\n+import org.robolectric.android.controller.ActivityController;\n+import org.robolectric.shadows.ShadowDialog;\n+\n+import static android.view.View.VISIBLE;\n+import static junit.framework.TestCase.assertTrue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.Assert.assertFalse;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class ChangeAdminPasswordDialogTest {\n+\n+    private ActivityController<FragmentActivity> activity;\n+    private FragmentManager fragmentManager;\n+    private ChangeAdminPasswordDialog dialogFragment;\n+    private ChangeAdminPasswordDialog.ChangePasswordDialogCallback callback;\n+\n+    @Before\n+    public void setup() {\n+        activity = RobolectricHelpers.buildThemedActivity(FragmentActivity.class);\n+        activity.setup();\n+\n+        fragmentManager = activity.get().getSupportFragmentManager();\n+        dialogFragment = new ChangeAdminPasswordDialog();\n+\n+        callback = mock(ChangeAdminPasswordDialog.ChangePasswordDialogCallback.class);\n+        dialogFragment.callback = callback;\n+    }\n+\n+    @Test\n+    public void dialogIsCancellable() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        assertThat(shadowOf(dialogFragment.getDialog()).isCancelable(), equalTo(true));\n+    }\n+\n+    @Test\n+    public void shouldShowCorrectButtons() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_POSITIVE).getVisibility(), equalTo(VISIBLE));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_POSITIVE).getText(),\n+                equalTo(activity.get().getString(R.string.ok)));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_NEGATIVE).getVisibility(), equalTo(VISIBLE));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_NEGATIVE).getText(),\n+                equalTo(activity.get().getString(R.string.cancel)));\n+    }\n+", "originalCommit": "9b35f1a07bd9e352924634c4bd6c5fe61c555b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0MTE3OA==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r429841178", "bodyText": "The first one dialogIsCancellable checks that the back button would works so I think that's good. The second seems like it isn't needed as you  interact with all the elements in the tests below.", "author": "seadowg", "createdAt": "2020-05-25T09:43:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ5MDg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg4OTk3OA==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r429889978", "bodyText": "Thanks @seadowg! So can I remove the second test case, for all my subsequent PRs on dialog disappearing issue. As for all of them, somewhere later in some other test, I have interacted with the elements, so I think, this part of code is redundant.", "author": "SaumiaSinghal", "createdAt": "2020-05-25T11:42:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ5MDg4OA=="}], "type": "inlineReview", "revised_code": {"commit": "e8d59bbcfd9bcfa6f6d386b16bf0b8a9eba4ecda", "chunk": "diff --git a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\nindex 39dab8947..7f258afcc 100644\n--- a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n+++ b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n\n@@ -20,7 +20,6 @@ import org.robolectric.RuntimeEnvironment;\n import org.robolectric.android.controller.ActivityController;\n import org.robolectric.shadows.ShadowDialog;\n \n-import static android.view.View.VISIBLE;\n import static junit.framework.TestCase.assertTrue;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.equalTo;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0MDI0MQ==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r429840241", "bodyText": "Is there any reason this logic couldn't happen in the fragment? Then we can avoid having to deal with having a listener. We can also then test this functionality in ChngeAdminPasswordDialogFragmentTest.", "author": "seadowg", "createdAt": "2020-05-25T09:41:42Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesActivity.java", "diffHunk": "@@ -101,4 +104,17 @@ public void preventOtherWaysOfEditingForm() {\n     public void onDialogClosed() {\n         startActivityAndCloseAllOthers(this, MainMenuActivity.class);\n     }\n+\n+    @Override\n+    public void onPasswordChanged(String password) {\n+        SharedPreferences.Editor editor = this.getSharedPreferences(ADMIN_PREFERENCES, MODE_PRIVATE).edit();", "originalCommit": "9b35f1a07bd9e352924634c4bd6c5fe61c555b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM2OTk5Mw==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r430369993", "bodyText": "Yes I think it would be nice to remove the unnecessary listener. I will revert this change.", "author": "SaumiaSinghal", "createdAt": "2020-05-26T12:21:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0MDI0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e51c759fa0d227d1710d00e256099de7ccbc0a5", "chunk": "diff --git a/collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesActivity.java b/collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesActivity.java\nindex c38562cf2..ac9594343 100644\n--- a/collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesActivity.java\n+++ b/collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesActivity.java\n\n@@ -104,17 +102,4 @@ public class AdminPreferencesActivity extends CollectAbstractActivity implements\n     public void onDialogClosed() {\n         startActivityAndCloseAllOthers(this, MainMenuActivity.class);\n     }\n-\n-    @Override\n-    public void onPasswordChanged(String password) {\n-        SharedPreferences.Editor editor = this.getSharedPreferences(ADMIN_PREFERENCES, MODE_PRIVATE).edit();\n-        editor.putString(KEY_ADMIN_PW, password);\n-\n-        if (password.equals(\"\")) {\n-            ToastUtils.showShortToast(R.string.admin_password_disabled);\n-        } else {\n-            ToastUtils.showShortToast(R.string.admin_password_changed);\n-        }\n-        editor.apply();\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0MzU3OQ==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r429843579", "bodyText": "This isn't really the correct logic for what happens when an Activity rotates. Normally and Activity will go through a full onPause/onStop/onDestroy run and then go back through the creation steps. As part of this the Fragment will be restored (using the arguments it had before rotation). Instead of trying to deal with all this yourself you should be able to the ActivityScenario like in AdminPasswordDialogFragmentTest#afterRecreating_enteringPassword_andClickingOK_callsOnCorrectAdminPasswordWithAction.", "author": "seadowg", "createdAt": "2020-05-25T09:48:30Z", "path": "collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java", "diffHunk": "@@ -0,0 +1,166 @@\n+package org.odk.collect.android.preferences;\n+\n+import android.content.DialogInterface;\n+import android.content.res.Configuration;\n+import android.text.InputType;\n+import android.widget.CheckBox;\n+import android.widget.EditText;\n+\n+import androidx.appcompat.app.AlertDialog;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.fragment.app.FragmentManager;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.support.RobolectricHelpers;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.RuntimeEnvironment;\n+import org.robolectric.android.controller.ActivityController;\n+import org.robolectric.shadows.ShadowDialog;\n+\n+import static android.view.View.VISIBLE;\n+import static junit.framework.TestCase.assertTrue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.Assert.assertFalse;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class ChangeAdminPasswordDialogTest {\n+\n+    private ActivityController<FragmentActivity> activity;\n+    private FragmentManager fragmentManager;\n+    private ChangeAdminPasswordDialog dialogFragment;\n+    private ChangeAdminPasswordDialog.ChangePasswordDialogCallback callback;\n+\n+    @Before\n+    public void setup() {\n+        activity = RobolectricHelpers.buildThemedActivity(FragmentActivity.class);\n+        activity.setup();\n+\n+        fragmentManager = activity.get().getSupportFragmentManager();\n+        dialogFragment = new ChangeAdminPasswordDialog();\n+\n+        callback = mock(ChangeAdminPasswordDialog.ChangePasswordDialogCallback.class);\n+        dialogFragment.callback = callback;\n+    }\n+\n+    @Test\n+    public void dialogIsCancellable() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        assertThat(shadowOf(dialogFragment.getDialog()).isCancelable(), equalTo(true));\n+    }\n+\n+    @Test\n+    public void shouldShowCorrectButtons() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_POSITIVE).getVisibility(), equalTo(VISIBLE));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_POSITIVE).getText(),\n+                equalTo(activity.get().getString(R.string.ok)));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_NEGATIVE).getVisibility(), equalTo(VISIBLE));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_NEGATIVE).getText(),\n+                equalTo(activity.get().getString(R.string.cancel)));\n+    }\n+\n+    @Test\n+    public void clickingOkAfterSettingPassword_callsOnPasswordChanged() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+        EditText passwordEditText = dialog.findViewById(R.id.pwd_field);\n+        passwordEditText.setText(\"blah\");\n+        dialog.getButton(DialogInterface.BUTTON_POSITIVE).performClick();\n+\n+        verify(callback, times(1)).onPasswordChanged(\"blah\");\n+    }\n+\n+    @Test\n+    public void passwordIsRetainedOnScreenRotation() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+        EditText passwordEditText = dialog.findViewById(R.id.pwd_field);\n+        passwordEditText.setText(\"blah\");\n+\n+        assertThat(activity.get().getResources().getConfiguration().orientation, equalTo(Configuration.ORIENTATION_PORTRAIT));", "originalCommit": "9b35f1a07bd9e352924634c4bd6c5fe61c555b1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e8d59bbcfd9bcfa6f6d386b16bf0b8a9eba4ecda", "chunk": "diff --git a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\nindex 39dab8947..7f258afcc 100644\n--- a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n+++ b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n\n@@ -20,7 +20,6 @@ import org.robolectric.RuntimeEnvironment;\n import org.robolectric.android.controller.ActivityController;\n import org.robolectric.shadows.ShadowDialog;\n \n-import static android.view.View.VISIBLE;\n import static junit.framework.TestCase.assertTrue;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.equalTo;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0MzcxMA==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r429843710", "bodyText": "Same thing as above here!", "author": "seadowg", "createdAt": "2020-05-25T09:48:43Z", "path": "collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java", "diffHunk": "@@ -0,0 +1,166 @@\n+package org.odk.collect.android.preferences;\n+\n+import android.content.DialogInterface;\n+import android.content.res.Configuration;\n+import android.text.InputType;\n+import android.widget.CheckBox;\n+import android.widget.EditText;\n+\n+import androidx.appcompat.app.AlertDialog;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.fragment.app.FragmentManager;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.support.RobolectricHelpers;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.RuntimeEnvironment;\n+import org.robolectric.android.controller.ActivityController;\n+import org.robolectric.shadows.ShadowDialog;\n+\n+import static android.view.View.VISIBLE;\n+import static junit.framework.TestCase.assertTrue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.Assert.assertFalse;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class ChangeAdminPasswordDialogTest {\n+\n+    private ActivityController<FragmentActivity> activity;\n+    private FragmentManager fragmentManager;\n+    private ChangeAdminPasswordDialog dialogFragment;\n+    private ChangeAdminPasswordDialog.ChangePasswordDialogCallback callback;\n+\n+    @Before\n+    public void setup() {\n+        activity = RobolectricHelpers.buildThemedActivity(FragmentActivity.class);\n+        activity.setup();\n+\n+        fragmentManager = activity.get().getSupportFragmentManager();\n+        dialogFragment = new ChangeAdminPasswordDialog();\n+\n+        callback = mock(ChangeAdminPasswordDialog.ChangePasswordDialogCallback.class);\n+        dialogFragment.callback = callback;\n+    }\n+\n+    @Test\n+    public void dialogIsCancellable() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        assertThat(shadowOf(dialogFragment.getDialog()).isCancelable(), equalTo(true));\n+    }\n+\n+    @Test\n+    public void shouldShowCorrectButtons() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_POSITIVE).getVisibility(), equalTo(VISIBLE));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_POSITIVE).getText(),\n+                equalTo(activity.get().getString(R.string.ok)));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_NEGATIVE).getVisibility(), equalTo(VISIBLE));\n+        assertThat(dialog.getButton(DialogInterface.BUTTON_NEGATIVE).getText(),\n+                equalTo(activity.get().getString(R.string.cancel)));\n+    }\n+\n+    @Test\n+    public void clickingOkAfterSettingPassword_callsOnPasswordChanged() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+        EditText passwordEditText = dialog.findViewById(R.id.pwd_field);\n+        passwordEditText.setText(\"blah\");\n+        dialog.getButton(DialogInterface.BUTTON_POSITIVE).performClick();\n+\n+        verify(callback, times(1)).onPasswordChanged(\"blah\");\n+    }\n+\n+    @Test\n+    public void passwordIsRetainedOnScreenRotation() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+        EditText passwordEditText = dialog.findViewById(R.id.pwd_field);\n+        passwordEditText.setText(\"blah\");\n+\n+        assertThat(activity.get().getResources().getConfiguration().orientation, equalTo(Configuration.ORIENTATION_PORTRAIT));\n+        RuntimeEnvironment.setQualifiers(\"+land\");\n+        activity.configurationChange();\n+        assertThat(activity.get().getResources().getConfiguration().orientation, equalTo(Configuration.ORIENTATION_LANDSCAPE));\n+\n+        ChangeAdminPasswordDialog restoredFragment = (ChangeAdminPasswordDialog)\n+                activity.get().getSupportFragmentManager().findFragmentByTag(\"TAG\");\n+\n+        AlertDialog restoredDialog = (AlertDialog) restoredFragment.getDialog();\n+        assertThat(((EditText) restoredDialog.findViewById(R.id.pwd_field)).getText().toString(), equalTo(\"blah\"));\n+    }\n+\n+    @Test\n+    public void showPasswordCheckBoxValueIsRetainedOnScreenRotation() {\n+        dialogFragment.show(fragmentManager, \"TAG\");\n+        AlertDialog dialog = (AlertDialog) ShadowDialog.getLatestDialog();\n+        CheckBox passwordCheckBox = dialog.findViewById(R.id.checkBox2);\n+        passwordCheckBox.setChecked(true);\n+\n+        assertThat(activity.get().getResources().getConfiguration().orientation, equalTo(Configuration.ORIENTATION_PORTRAIT));", "originalCommit": "9b35f1a07bd9e352924634c4bd6c5fe61c555b1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e8d59bbcfd9bcfa6f6d386b16bf0b8a9eba4ecda", "chunk": "diff --git a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\nindex 39dab8947..7f258afcc 100644\n--- a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n+++ b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n\n@@ -20,7 +20,6 @@ import org.robolectric.RuntimeEnvironment;\n import org.robolectric.android.controller.ActivityController;\n import org.robolectric.shadows.ShadowDialog;\n \n-import static android.view.View.VISIBLE;\n import static junit.framework.TestCase.assertTrue;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.equalTo;\n"}}, {"oid": "991cd8c7f98e1958c9b2a34c942f70f01b79261b", "url": "https://github.com/getodk/collect/commit/991cd8c7f98e1958c9b2a34c942f70f01b79261b", "message": "fixed conflicts", "committedDate": "2020-05-25T12:07:27Z", "type": "commit"}, {"oid": "936fb36f55734528b906171ab6d072227a148603", "url": "https://github.com/getodk/collect/commit/936fb36f55734528b906171ab6d072227a148603", "message": "Merge branch 'change_admin_password_dialog_fragment' of https://github.com/SaumiaSinghal/collect into change_admin_password_dialog_fragment", "committedDate": "2020-05-25T12:10:05Z", "type": "commit"}, {"oid": "e8d59bbcfd9bcfa6f6d386b16bf0b8a9eba4ecda", "url": "https://github.com/getodk/collect/commit/e8d59bbcfd9bcfa6f6d386b16bf0b8a9eba4ecda", "message": "removed shouldShowCorrectButtons test", "committedDate": "2020-05-25T12:14:44Z", "type": "commit"}, {"oid": "42ad1d000284e7b221fe23c2476a057a0ad82b83", "url": "https://github.com/getodk/collect/commit/42ad1d000284e7b221fe23c2476a057a0ad82b83", "message": "used activity scenario to recreate activity in unit tests", "committedDate": "2020-05-26T07:58:24Z", "type": "commit"}, {"oid": "1b7fd935622be527c60605c5605fc5724f88b347", "url": "https://github.com/getodk/collect/commit/1b7fd935622be527c60605c5605fc5724f88b347", "message": "unit test refactor", "committedDate": "2020-05-26T10:33:29Z", "type": "commit"}, {"oid": "23fb813ce720351cf986f3880518e2ef79edf6a2", "url": "https://github.com/getodk/collect/commit/23fb813ce720351cf986f3880518e2ef79edf6a2", "message": "added test for checking password value set in Shared Prefrences", "committedDate": "2020-05-26T12:12:08Z", "type": "commit"}, {"oid": "7e51c759fa0d227d1710d00e256099de7ccbc0a5", "url": "https://github.com/getodk/collect/commit/7e51c759fa0d227d1710d00e256099de7ccbc0a5", "message": "removed callback listener", "committedDate": "2020-05-26T12:14:15Z", "type": "commit"}, {"oid": "3652c9afcfbdfd93691f3dd893e881fdcb5894a9", "url": "https://github.com/getodk/collect/commit/3652c9afcfbdfd93691f3dd893e881fdcb5894a9", "message": "removed callback mock in unit test", "committedDate": "2020-05-26T12:19:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM1NzYxNw==", "url": "https://github.com/getodk/collect/pull/3824#discussion_r433357617", "bodyText": "I don't think the activityScenario needs to be a field here as you're only using ActivityScenario in one test. I think just make it a local variable in there.", "author": "seadowg", "createdAt": "2020-06-01T16:46:30Z", "path": "collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java", "diffHunk": "@@ -0,0 +1,141 @@\n+package org.odk.collect.android.preferences;\n+\n+import android.content.Context;\n+import android.content.DialogInterface;\n+import android.content.SharedPreferences;\n+import android.os.Bundle;\n+import android.text.InputType;\n+import android.widget.CheckBox;\n+import android.widget.EditText;\n+\n+import androidx.annotation.Nullable;\n+import androidx.appcompat.app.AlertDialog;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.fragment.app.FragmentManager;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.support.RobolectricHelpers;\n+import org.odk.collect.android.support.TestActivityScenario;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.shadows.ShadowDialog;\n+\n+import static junit.framework.TestCase.assertTrue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.Assert.assertFalse;\n+import static org.odk.collect.android.preferences.AdminKeys.KEY_ADMIN_PW;\n+import static org.odk.collect.android.preferences.AdminPreferencesActivity.ADMIN_PREFERENCES;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class ChangeAdminPasswordDialogTest {\n+\n+    private TestActivityScenario<DialogFragmentTestActivity> activityScenario;", "originalCommit": "3652c9afcfbdfd93691f3dd893e881fdcb5894a9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb23bdbb011193913c40399ec6edba3a18fa7f0a", "chunk": "diff --git a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\nindex f7f7b7528..896e1aa06 100644\n--- a/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n+++ b/collect_app/src/test/java/org/odk/collect/android/preferences/ChangeAdminPasswordDialogTest.java\n\n@@ -33,14 +33,12 @@ import static org.robolectric.Shadows.shadowOf;\n @RunWith(RobolectricTestRunner.class)\n public class ChangeAdminPasswordDialogTest {\n \n-    private TestActivityScenario<DialogFragmentTestActivity> activityScenario;\n     private FragmentManager fragmentManager;\n     private ChangeAdminPasswordDialog dialogFragment;\n     private SharedPreferences sharedPreferences;\n \n     @Before\n     public void setup() {\n-        activityScenario = TestActivityScenario.launch(DialogFragmentTestActivity.class);\n         FragmentActivity activity = RobolectricHelpers.createThemedActivity(FragmentActivity.class);\n         sharedPreferences = activity.getSharedPreferences(ADMIN_PREFERENCES, Context.MODE_PRIVATE);\n \n"}}, {"oid": "eb23bdbb011193913c40399ec6edba3a18fa7f0a", "url": "https://github.com/getodk/collect/commit/eb23bdbb011193913c40399ec6edba3a18fa7f0a", "message": "convert activityScenario to local variable", "committedDate": "2020-06-01T16:59:00Z", "type": "commit"}]}