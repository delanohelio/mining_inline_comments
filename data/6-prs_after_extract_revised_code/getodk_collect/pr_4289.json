{"pr_number": 4289, "pr_title": "Make sure screen reloads when preferences are changed", "pr_createdAt": "2020-12-09T13:49:32Z", "pr_url": "https://github.com/getodk/collect/pull/4289", "timeline": [{"oid": "187a90e46791b54c8314aee8391613141c9a28f8", "url": "https://github.com/getodk/collect/commit/187a90e46791b54c8314aee8391613141c9a28f8", "message": "Make sure screen reloads when preferences are changed", "committedDate": "2020-12-09T13:37:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMyMjg3Nw==", "url": "https://github.com/getodk/collect/pull/4289#discussion_r539322877", "bodyText": "This isn't tested. I played around with various Espresso tests but couldn't get something that worked nicely and actually drove this out. We still consider FormEntryActivity a no-go for Robolectric testing, so I didn't even look at that.\nThe new Activity Result APIs are really the answer here I think, but they are still in beta. Once that's stable we should be able to move our activity result code into components (like FormEntryMenuDelegate) and test the request and \"response\" in one place.", "author": "seadowg", "createdAt": "2020-12-09T13:52:29Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -762,7 +762,7 @@ protected void onActivityResult(int requestCode, int resultCode, final Intent in\n \n         // If we're coming back from the hierarchy view, the user has either tapped the back\n         // button or another question to jump to so we need to rebuild the view.\n-        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY) {\n+        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY || requestCode == RequestCodes.CHANGE_SETTINGS) {", "originalCommit": "187a90e46791b54c8314aee8391613141c9a28f8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzMjE4OA==", "url": "https://github.com/getodk/collect/pull/4289#discussion_r539332188", "bodyText": "Can we do the same for font size? Probably we don't even need adjustFontSize() now if we call onScreenRefresh(); either way. Do you want to confirm? If you are in a hurry with this pr we can file a separate issue to make sure changes in settings are handled in the same way.", "author": "grzesiek2010", "createdAt": "2020-12-09T14:04:33Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -762,7 +762,7 @@ protected void onActivityResult(int requestCode, int resultCode, final Intent in\n \n         // If we're coming back from the hierarchy view, the user has either tapped the back\n         // button or another question to jump to so we need to rebuild the view.\n-        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY) {\n+        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY || requestCode == RequestCodes.CHANGE_SETTINGS) {", "originalCommit": "187a90e46791b54c8314aee8391613141c9a28f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzNjQzNQ==", "url": "https://github.com/getodk/collect/pull/4289#discussion_r539336435", "bodyText": "Sounds like a good idea! Just to confirm: you're suggesting we get rid of the code that's dealing with the font size adjustment and see if this new solution works instead?", "author": "seadowg", "createdAt": "2020-12-09T14:09:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzMjE4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzOTMzMg==", "url": "https://github.com/getodk/collect/pull/4289#discussion_r539339332", "bodyText": "Yeah I guess it should because basically it does the same just calling onScreenRefresh();", "author": "grzesiek2010", "createdAt": "2020-12-09T14:13:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzMjE4OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5f8367d225ccace400316eca035d2473ad48b39d", "url": "https://github.com/getodk/collect/commit/5f8367d225ccace400316eca035d2473ad48b39d", "message": "Remove unneeded font size code", "committedDate": "2020-12-09T15:09:43Z", "type": "commit"}]}