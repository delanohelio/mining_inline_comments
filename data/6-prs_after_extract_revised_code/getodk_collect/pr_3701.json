{"pr_number": 3701, "pr_title": "Disable Markup button if default image couldn't be loaded", "pr_createdAt": "2020-03-10T21:38:28Z", "pr_url": "https://github.com/getodk/collect/pull/3701", "timeline": [{"oid": "deed7c2be8b482b5ad2c319dbeee73314a7cd730", "url": "https://github.com/getodk/collect/commit/deed7c2be8b482b5ad2c319dbeee73314a7cd730", "message": "fix annotate button if default image corrupt", "committedDate": "2020-03-10T21:32:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc1NjMwOQ==", "url": "https://github.com/getodk/collect/pull/3701#discussion_r395756309", "bodyText": "I think you don't need this at all... what about a check like?\n        if (binaryName == null || imageView == null || imageView.getVisibility() == GONE) {\n            annotateButton.setEnabled(false);\n        }\n\nthere is a similar check:\nif (binaryName == null) {\n            annotateButton.setEnabled(false);\n        }\n\nin setUpLayout() method so you could remove it there.", "author": "grzesiek2010", "createdAt": "2020-03-20T16:34:44Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java", "diffHunk": "@@ -65,6 +65,9 @@ public AnnotateWidget(Context context, QuestionDetails prompt) {\n         imageCaptureHandler = new ImageCaptureHandler();\n         setUpLayout();\n         addCurrentImageToLayout();\n+        if (errorLoadingImage) {", "originalCommit": "deed7c2be8b482b5ad2c319dbeee73314a7cd730", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMxNTg0NA==", "url": "https://github.com/getodk/collect/pull/3701#discussion_r400315844", "bodyText": "Done.", "author": "chidauri", "createdAt": "2020-03-30T16:11:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc1NjMwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "578b4b18f8a3f3156239fc3d54fe842e2c0e2f94", "chunk": "diff --git a/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java b/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java\nindex f16023349..c06f3804b 100644\n--- a/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java\n+++ b/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java\n\n@@ -65,7 +65,7 @@ public class AnnotateWidget extends BaseImageWidget {\n         imageCaptureHandler = new ImageCaptureHandler();\n         setUpLayout();\n         addCurrentImageToLayout();\n-        if (errorLoadingImage) {\n+        if (binaryName == null || imageView == null || imageView.getVisibility() == GONE) {\n             annotateButton.setEnabled(false);\n         }\n         addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n"}}, {"oid": "578b4b18f8a3f3156239fc3d54fe842e2c0e2f94", "url": "https://github.com/getodk/collect/commit/578b4b18f8a3f3156239fc3d54fe842e2c0e2f94", "message": "code refactoring", "committedDate": "2020-03-30T16:02:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgxNTIzOQ==", "url": "https://github.com/getodk/collect/pull/3701#discussion_r400815239", "bodyText": "It would be good to factor it out to a separate method like adjustAnnotateButtonaAailability(0 for example.", "author": "grzesiek2010", "createdAt": "2020-03-31T10:44:55Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java", "diffHunk": "@@ -65,6 +65,9 @@ public AnnotateWidget(Context context, QuestionDetails prompt) {\n         imageCaptureHandler = new ImageCaptureHandler();\n         setUpLayout();\n         addCurrentImageToLayout();\n+        if (binaryName == null || imageView == null || imageView.getVisibility() == GONE) {", "originalCommit": "578b4b18f8a3f3156239fc3d54fe842e2c0e2f94", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5c78a2aa451900ec28e540570e7798d7762599c2", "chunk": "diff --git a/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java b/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java\nindex c06f3804b..6cb3759e3 100644\n--- a/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java\n+++ b/collect_app/src/main/java/org/odk/collect/android/widgets/AnnotateWidget.java\n\n@@ -65,9 +65,7 @@ public class AnnotateWidget extends BaseImageWidget {\n         imageCaptureHandler = new ImageCaptureHandler();\n         setUpLayout();\n         addCurrentImageToLayout();\n-        if (binaryName == null || imageView == null || imageView.getVisibility() == GONE) {\n-            annotateButton.setEnabled(false);\n-        }\n+        adjustAnnotateButtonAvailability();\n         addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n     }\n \n"}}, {"oid": "5c78a2aa451900ec28e540570e7798d7762599c2", "url": "https://github.com/getodk/collect/commit/5c78a2aa451900ec28e540570e7798d7762599c2", "message": "add a test for markup button", "committedDate": "2020-04-12T17:56:59Z", "type": "commit"}]}