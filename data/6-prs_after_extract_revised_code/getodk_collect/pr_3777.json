{"pr_number": 3777, "pr_title": "Add experimental Material Theme", "pr_createdAt": "2020-04-15T11:32:52Z", "pr_url": "https://github.com/getodk/collect/pull/3777", "timeline": [{"oid": "e6e0cf75fdf51e2c742f69e2cfa1a22d199c084f", "url": "https://github.com/getodk/collect/commit/e6e0cf75fdf51e2c742f69e2cfa1a22d199c084f", "message": "When I grow up I want to be good at boolean logic", "committedDate": "2020-04-27T10:22:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEzMTAzMQ==", "url": "https://github.com/getodk/collect/pull/3777#discussion_r418131031", "bodyText": "How about a comment here or putting it in a method called hideMaterialThemeForRelease or something?", "author": "lognaturel", "createdAt": "2020-04-30T16:19:22Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferencesFragment.java", "diffHunk": "@@ -72,11 +87,19 @@ private void initThemePrefs() {\n         final ListPreference pref = (ListPreference) findPreference(KEY_APP_THEME);\n \n         if (pref != null) {\n+            if (versionInformation.isRelease()) {", "originalCommit": "1bc0d6c65fb1d80e6526f804adbd0149de47c020", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4MDgwMg==", "url": "https://github.com/getodk/collect/pull/3777#discussion_r418480802", "bodyText": "Yeah good call. I'll put in a method.", "author": "seadowg", "createdAt": "2020-05-01T09:43:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEzMTAzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "ce8cbb8c6005dc2286d2154ca3c1e594881694f7", "chunk": "diff --git a/collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferencesFragment.java b/collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferences.java\nsimilarity index 85%\nrename from collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferencesFragment.java\nrename to collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferences.java\nindex 228e49102..d1e78d7ba 100644\n--- a/collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferencesFragment.java\n+++ b/collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferences.java\n\n@@ -87,19 +72,11 @@ public class UserInterfacePreferencesFragment extends BasePreferenceFragment {\n         final ListPreference pref = (ListPreference) findPreference(KEY_APP_THEME);\n \n         if (pref != null) {\n-            if (versionInformation.isRelease()) {\n-                CharSequence[] entries = pref.getEntries();\n-                pref.setEntries(Arrays.copyOfRange(entries, 0, entries.length - 1));\n-\n-                CharSequence[] entryValues = pref.getEntryValues();\n-                pref.setEntryValues(Arrays.copyOfRange(entryValues, 0, entryValues.length - 1));\n-            }\n-\n             pref.setSummary(pref.getEntry());\n             pref.setOnPreferenceChangeListener((preference, newValue) -> {\n                 int index = ((ListPreference) preference).findIndexOfValue(newValue.toString());\n                 String entry = (String) ((ListPreference) preference).getEntries()[index];\n-                if (pref.getEntry() == null || !pref.getEntry().equals(entry)) {\n+                if (!pref.getEntry().equals(entry)) {\n                     preference.setSummary(entry);\n                     startActivityAndCloseAllOthers(getActivity(), MainMenuActivity.class);\n                 }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MDQ1NQ==", "url": "https://github.com/getodk/collect/pull/3777#discussion_r418180455", "bodyText": "This is much better. It very nearly could close #3693 if you could add the couple of test cases suggested. I still think the regex approach could cut some of this down but it's now much easier to reason about so I'm fine with it as-is.", "author": "lognaturel", "createdAt": "2020-04-30T17:42:03Z", "path": "collect_app/src/main/java/org/odk/collect/android/version/VersionInformation.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package org.odk.collect.android.version;\n+\n+import androidx.annotation.Nullable;\n+\n+public class VersionInformation {", "originalCommit": "1bc0d6c65fb1d80e6526f804adbd0149de47c020", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4MDk4OQ==", "url": "https://github.com/getodk/collect/pull/3777#discussion_r418480989", "bodyText": "Ah didn't see that issue. Definitely the right time. Will get to that once other issues are fixed!", "author": "seadowg", "createdAt": "2020-05-01T09:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MDQ1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ0OTg0MQ==", "url": "https://github.com/getodk/collect/pull/3777#discussion_r419449841", "bodyText": "Looks like the implementation was there for this but wanted to move the coverage from the ViewModel to the VersionInformation so did that.", "author": "seadowg", "createdAt": "2020-05-04T13:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MDQ1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "ce8cbb8c6005dc2286d2154ca3c1e594881694f7", "chunk": "diff --git a/collect_app/src/main/java/org/odk/collect/android/version/VersionInformation.java b/collect_app/src/main/java/org/odk/collect/android/version/VersionInformation.java\ndeleted file mode 100644\nindex 0942df99e..000000000\n--- a/collect_app/src/main/java/org/odk/collect/android/version/VersionInformation.java\n+++ /dev/null\n\n@@ -1,75 +0,0 @@\n-package org.odk.collect.android.version;\n-\n-import androidx.annotation.Nullable;\n-\n-public class VersionInformation {\n-\n-    private final VersionDescriptionProvider versionDescriptionProvider;\n-\n-    @Nullable\n-    private String[] splitDescription;\n-\n-    public VersionInformation(VersionDescriptionProvider versionDescriptionProvider) {\n-        this.versionDescriptionProvider = versionDescriptionProvider;\n-    }\n-\n-    public String getSemanticVersion() {\n-        return getVersionDescriptionComponents()[0];\n-    }\n-\n-    @Nullable\n-    public Integer getBetaNumber() {\n-        if (isBeta()) {\n-            String description = versionDescriptionProvider.getVersionDescription();\n-            return Integer.parseInt(description.split(\"beta\")[1].substring(1, 2));\n-        } else {\n-            return null;\n-        }\n-    }\n-\n-    @Nullable\n-    public String getCommitSHA() {\n-         String[] components = getVersionDescriptionComponents();\n-\n-        if (isBeta() && components.length > 3) {\n-            return components[3];\n-        } else if (!isBeta() && components.length > 2) {\n-            return components[2];\n-        } else {\n-            return null;\n-        }\n-    }\n-\n-    @Nullable\n-    public Integer getCommitCount() {\n-        String[] components = getVersionDescriptionComponents();\n-\n-        if (isBeta() && components.length > 3) {\n-            return Integer.parseInt(components[2]);\n-        } else if (!isBeta() && components.length > 2) {\n-            return Integer.parseInt(components[1]);\n-        } else {\n-            return null;\n-        }\n-    }\n-\n-    public boolean isRelease() {\n-        return getVersionDescriptionComponents().length == 1;\n-    }\n-\n-    private boolean isBeta() {\n-        return versionDescriptionProvider.getVersionDescription().contains(\"beta\");\n-    }\n-\n-    public boolean isDirty() {\n-        return versionDescriptionProvider.getVersionDescription().contains(\"dirty\");\n-    }\n-\n-    private String[] getVersionDescriptionComponents() {\n-        if (splitDescription == null) {\n-            splitDescription = versionDescriptionProvider.getVersionDescription().split(\"-\");\n-        }\n-\n-        return splitDescription;\n-    }\n-}\n"}}, {"oid": "ce8cbb8c6005dc2286d2154ca3c1e594881694f7", "url": "https://github.com/getodk/collect/commit/ce8cbb8c6005dc2286d2154ca3c1e594881694f7", "message": "Move button styles to their own file", "committedDate": "2020-05-04T13:14:03Z", "type": "commit"}, {"oid": "d81a28f04155bb4452d9ddf672eb9ecdb99b74cf", "url": "https://github.com/getodk/collect/commit/d81a28f04155bb4452d9ddf672eb9ecdb99b74cf", "message": "Switch Get Blank Form buttons to MaterialButtons", "committedDate": "2020-05-04T13:14:03Z", "type": "commit"}, {"oid": "8894ab8351e707fd76b888693454230f8c20c82d", "url": "https://github.com/getodk/collect/commit/8894ab8351e707fd76b888693454230f8c20c82d", "message": "Switch Send Finalized Form buttons to MaterialButtons", "committedDate": "2020-05-04T13:14:03Z", "type": "commit"}, {"oid": "5cc5a06711799b63fc6b6e17f4b9a2858d5c7a8f", "url": "https://github.com/getodk/collect/commit/5cc5a06711799b63fc6b6e17f4b9a2858d5c7a8f", "message": "Switch Delete Saved Form buttons to MaterialButtons", "committedDate": "2020-05-04T13:14:03Z", "type": "commit"}, {"oid": "f1232f23da84db53f11289d6ef3c567c079e2aca", "url": "https://github.com/getodk/collect/commit/f1232f23da84db53f11289d6ef3c567c079e2aca", "message": "Make Save and Exit Form button a MAterialButton", "committedDate": "2020-05-04T13:14:03Z", "type": "commit"}, {"oid": "5480109a4d7d35e291c2e560038207bff8c88f75", "url": "https://github.com/getodk/collect/commit/5480109a4d7d35e291c2e560038207bff8c88f75", "message": "Switch hierarchy screen to using MaterialButtons", "committedDate": "2020-05-04T13:14:03Z", "type": "commit"}, {"oid": "d92d47638ffda1caef0ff5f7b6d2b688974c837a", "url": "https://github.com/getodk/collect/commit/d92d47638ffda1caef0ff5f7b6d2b688974c837a", "message": "Drop letter spacing on button text style", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "223e6c9cb7870b2e1443642ed9d4e74f28fbafdc", "url": "https://github.com/getodk/collect/commit/223e6c9cb7870b2e1443642ed9d4e74f28fbafdc", "message": "MaterialButtons in Google Drive List", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "783ff50cb5da447d8289999c756ebed08850d2a7", "url": "https://github.com/getodk/collect/commit/783ff50cb5da447d8289999c756ebed08850d2a7", "message": "Switch light theme to MaterialComponents theme", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "700bdc5d605e40ca09148384d79269b56cfb8e7c", "url": "https://github.com/getodk/collect/commit/700bdc5d605e40ca09148384d79269b56cfb8e7c", "message": "Fix alert dialog button style for light theme", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "2803744758e1dce1970b4e0885959d9232d87e93", "url": "https://github.com/getodk/collect/commit/2803744758e1dce1970b4e0885959d9232d87e93", "message": "Fix option menu color", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "d5caf14cf57a5ae0cd35840eae808c00c87ca7d0", "url": "https://github.com/getodk/collect/commit/d5caf14cf57a5ae0cd35840eae808c00c87ca7d0", "message": "Use MaterialButton for widget button", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "a769d00cad3758ec0bc7351253ec3a1ae08d0e36", "url": "https://github.com/getodk/collect/commit/a769d00cad3758ec0bc7351253ec3a1ae08d0e36", "message": "Move alert dialog theme to its own file", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "0622bff7fbc4362b24e759bd5d9e1958fb27e10a", "url": "https://github.com/getodk/collect/commit/0622bff7fbc4362b24e759bd5d9e1958fb27e10a", "message": "Switch dialogs to new alert dialog", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "51f6fc1ef321c67508cb67b3578f676ce62e6cdb", "url": "https://github.com/getodk/collect/commit/51f6fc1ef321c67508cb67b3578f676ce62e6cdb", "message": "Remove deprecated ProgressDialog from ProgressDialogFragment", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "b8f17b90fc3217a7a0657474d81522034ee62882", "url": "https://github.com/getodk/collect/commit/b8f17b90fc3217a7a0657474d81522034ee62882", "message": "Make dialog fragment tests more consistent", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "2206612412cb01dda859c116507fe861e9e50ec7", "url": "https://github.com/getodk/collect/commit/2206612412cb01dda859c116507fe861e9e50ec7", "message": "Fix incorrect AlertDialog cast", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "d5df37b14b57e138a26130334c87005c94788cf1", "url": "https://github.com/getodk/collect/commit/d5df37b14b57e138a26130334c87005c94788cf1", "message": "Remove retainInstance from ProgressDialogFragment", "committedDate": "2020-05-04T13:14:04Z", "type": "commit"}, {"oid": "1f8a0fd186f801741b13f0ab41ca83ae362dd0f2", "url": "https://github.com/getodk/collect/commit/1f8a0fd186f801741b13f0ab41ca83ae362dd0f2", "message": "Introduce 'Magenta' Material Components theme", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "91aed322e4fc1840301eb4e76729b004b9892c2a", "url": "https://github.com/getodk/collect/commit/91aed322e4fc1840301eb4e76729b004b9892c2a", "message": "Correct icon color references", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "4c8e99a11874f95126c2607c58de4a333a2d38db", "url": "https://github.com/getodk/collect/commit/4c8e99a11874f95126c2607c58de4a333a2d38db", "message": "Mark new theme as experimental", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "4981049faa382a3e759c61b816dbf850c52874b6", "url": "https://github.com/getodk/collect/commit/4981049faa382a3e759c61b816dbf850c52874b6", "message": "Move version information logic to use its own class", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "8326fb34ffeb29f58785e969090b9de742d98d77", "url": "https://github.com/getodk/collect/commit/8326fb34ffeb29f58785e969090b9de742d98d77", "message": "Only show Magenta theme option in non release versions", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "c961c414e65bdb9e23af705fc54c3f5499ef3d0f", "url": "https://github.com/getodk/collect/commit/c961c414e65bdb9e23af705fc54c3f5499ef3d0f", "message": "When I grow up I want to be good at boolean logic", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "27c13509f3f6a87d6861c21f5c742fe2871d768d", "url": "https://github.com/getodk/collect/commit/27c13509f3f6a87d6861c21f5c742fe2871d768d", "message": "Prevent crash when changing theme in release versions", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "99dd0bd35e4d709f6293baeeac14ea1d844b5e6e", "url": "https://github.com/getodk/collect/commit/99dd0bd35e4d709f6293baeeac14ea1d844b5e6e", "message": "Use hard coded colors for form state icons", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "4e4d80cbf3bbd0866de139aae9b73e397aac726f", "url": "https://github.com/getodk/collect/commit/4e4d80cbf3bbd0866de139aae9b73e397aac726f", "message": "Use AndroidX preferences for User Interface to prevent Dagger bugs", "committedDate": "2020-05-04T13:14:05Z", "type": "commit"}, {"oid": "4e4d80cbf3bbd0866de139aae9b73e397aac726f", "url": "https://github.com/getodk/collect/commit/4e4d80cbf3bbd0866de139aae9b73e397aac726f", "message": "Use AndroidX preferences for User Interface to prevent Dagger bugs", "committedDate": "2020-05-04T13:14:05Z", "type": "forcePushed"}, {"oid": "3356c29ab68f171417a1975526b3dd9e1c985710", "url": "https://github.com/getodk/collect/commit/3356c29ab68f171417a1975526b3dd9e1c985710", "message": "Add method for hiding themes", "committedDate": "2020-05-04T13:28:16Z", "type": "commit"}, {"oid": "686a8cb2746dee8127532b878b74c8489289b6ae", "url": "https://github.com/getodk/collect/commit/686a8cb2746dee8127532b878b74c8489289b6ae", "message": "Move getSemanticVersion testing to VersionInformation", "committedDate": "2020-05-04T13:46:23Z", "type": "commit"}, {"oid": "00dcee9e228aefdeedc7c9b76199afb0513cd89d", "url": "https://github.com/getodk/collect/commit/00dcee9e228aefdeedc7c9b76199afb0513cd89d", "message": "Add comment to describe AndroidXPreferenceActivity", "committedDate": "2020-05-05T10:05:15Z", "type": "commit"}, {"oid": "e90c595d0902f529515a772427e007cdb645af7d", "url": "https://github.com/getodk/collect/commit/e90c595d0902f529515a772427e007cdb645af7d", "message": "Make bottom option buttons fixed height", "committedDate": "2020-05-06T12:12:58Z", "type": "commit"}, {"oid": "5bc87c1dd9f7d59ce14d027086b364565edb460e", "url": "https://github.com/getodk/collect/commit/5bc87c1dd9f7d59ce14d027086b364565edb460e", "message": "Stop crash when opening offline layer dialog", "committedDate": "2020-05-06T13:10:17Z", "type": "commit"}, {"oid": "8fdaf5304da30f609be2724b2380580b07ac489b", "url": "https://github.com/getodk/collect/commit/8fdaf5304da30f609be2724b2380580b07ac489b", "message": "Use colorPrimary for rank items rather than custom attribute", "committedDate": "2020-05-06T14:44:33Z", "type": "commit"}, {"oid": "eb55938c4a75cfd3cb15836797e721fa9d021c5d", "url": "https://github.com/getodk/collect/commit/eb55938c4a75cfd3cb15836797e721fa9d021c5d", "message": "Remove primaryTextColor attribute", "committedDate": "2020-05-06T14:54:46Z", "type": "commit"}, {"oid": "e5b09ea8eecd7466b9e18bbfc03770c964cb736d", "url": "https://github.com/getodk/collect/commit/e5b09ea8eecd7466b9e18bbfc03770c964cb736d", "message": "Remove secondaryTextColor custom attribute", "committedDate": "2020-05-06T14:59:07Z", "type": "commit"}, {"oid": "4965179dc7806973facccc7fca4cf7860d9c57dd", "url": "https://github.com/getodk/collect/commit/4965179dc7806973facccc7fca4cf7860d9c57dd", "message": "Remove custom spinner item background attribute", "committedDate": "2020-05-06T15:07:17Z", "type": "commit"}, {"oid": "08fff181916255c74cbb0611b098831230988219", "url": "https://github.com/getodk/collect/commit/08fff181916255c74cbb0611b098831230988219", "message": "Make sure bottom option buttons grow (together)", "committedDate": "2020-05-08T10:09:21Z", "type": "commit"}]}