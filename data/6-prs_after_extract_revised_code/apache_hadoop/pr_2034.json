{"pr_number": 2034, "pr_title": "HADOOP-17053. ABFS: Fix Account-specific OAuth config setting parsing", "pr_createdAt": "2020-05-26T22:01:57Z", "pr_url": "https://github.com/apache/hadoop/pull/2034", "timeline": [{"oid": "44f7d2f3cbe05e092c75a68f631922e8808d0ffe", "url": "https://github.com/apache/hadoop/commit/44f7d2f3cbe05e092c75a68f631922e8808d0ffe", "message": "Fix getTokenProvider", "committedDate": "2020-05-26T20:38:06Z", "type": "commit"}, {"oid": "f1d294abfb259a4d8b4f8eb238d5e7429479c5fe", "url": "https://github.com/apache/hadoop/commit/f1d294abfb259a4d8b4f8eb238d5e7429479c5fe", "message": "Minor formatting fixes", "committedDate": "2020-05-26T21:59:46Z", "type": "commit"}, {"oid": "4775b8965bf90a10412310ef90b99c7afdf8ab0a", "url": "https://github.com/apache/hadoop/commit/4775b8965bf90a10412310ef90b99c7afdf8ab0a", "message": "findbugs NPE fix", "committedDate": "2020-05-27T05:38:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMDIyNA==", "url": "https://github.com/apache/hadoop/pull/2034#discussion_r431000224", "bodyText": "nit: I could see it from the javadocs, still naming it something like authTypeForAccount could improve readability", "author": "bilaharith", "createdAt": "2020-05-27T09:58:26Z", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AbfsConfiguration.java", "diffHunk": "@@ -325,31 +325,91 @@ public String getPasswordString(String key) throws IOException {\n   }\n \n   /**\n-   * Returns the account-specific Class if it exists, then looks for an\n-   * account-agnostic value, and finally tries the default value.\n+   * Returns account-specific token provider class if it exists, else checks if\n+   * an account-agnostic setting is present for token provider class if AuthType\n+   * matches with authType passed.\n+   * @param authType AuthType effective on the account\n    * @param name Account-agnostic configuration key\n    * @param defaultValue Class returned if none is configured\n    * @param xface Interface shared by all possible values\n+   * @param <U> Interface class type\n    * @return Highest-precedence Class object that was found\n    */\n-  public <U> Class<? extends U> getClass(String name, Class<? extends U> defaultValue, Class<U> xface) {\n+  public <U> Class<? extends U> getTokenProviderClass(AuthType authType,", "originalCommit": "4775b8965bf90a10412310ef90b99c7afdf8ab0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAxMTU3MQ==", "url": "https://github.com/apache/hadoop/pull/2034#discussion_r431011571", "bodyText": "This method fetches TokenProviderClass instance based on the input AuthType. It is in sync with the naming followed by other methods that resolve account-specific config and in it's absence default to account-agnostic value. Will retain the naming.", "author": "snvijaya", "createdAt": "2020-05-27T10:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMDIyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAxMzE2NQ==", "url": "https://github.com/apache/hadoop/pull/2034#discussion_r431013165", "bodyText": "I meant for the parameter currently named authType", "author": "bilaharith", "createdAt": "2020-05-27T10:22:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMDIyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM4Mjk5MQ==", "url": "https://github.com/apache/hadoop/pull/2034#discussion_r431382991", "bodyText": "Inputs AuthType, name of the relevant TokenProvider config key, xface (interface) are derived by the caller of getTokenProviderClass based on account-specific config settings. As it applies to all the inputs equally and is clear from the calling method's perspective, will retain the naming.", "author": "snvijaya", "createdAt": "2020-05-27T19:14:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMDIyNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMTcyOQ==", "url": "https://github.com/apache/hadoop/pull/2034#discussion_r431001729", "bodyText": "Nit: This new line can be removed", "author": "bilaharith", "createdAt": "2020-05-27T10:01:12Z", "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/TestAccountConfiguration.java", "diffHunk": "@@ -20,13 +20,25 @@\n \n import java.io.IOException;\n \n+import org.assertj.core.api.Assertions;\n+import org.junit.Test;\n+\n import org.apache.hadoop.conf.Configuration;\n+", "originalCommit": "4775b8965bf90a10412310ef90b99c7afdf8ab0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwOTg2Mw==", "url": "https://github.com/apache/hadoop/pull/2034#discussion_r431009863", "bodyText": "Fixed.", "author": "snvijaya", "createdAt": "2020-05-27T10:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMTcyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "75557967c37afc1567fe4e4c5b01791cdde77c01", "chunk": "diff --git a/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/TestAccountConfiguration.java b/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/TestAccountConfiguration.java\nindex a7e3b57720d..4cb0961e936 100644\n--- a/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/TestAccountConfiguration.java\n+++ b/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/TestAccountConfiguration.java\n\n@@ -24,7 +24,6 @@\n import org.junit.Test;\n \n import org.apache.hadoop.conf.Configuration;\n-\n import org.apache.hadoop.fs.azurebfs.contracts.exceptions.InvalidConfigurationValueException;\n import org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider;\n import org.apache.hadoop.fs.azurebfs.oauth2.CustomTokenProviderAdapter;\n"}}, {"oid": "75557967c37afc1567fe4e4c5b01791cdde77c01", "url": "https://github.com/apache/hadoop/commit/75557967c37afc1567fe4e4c5b01791cdde77c01", "message": "Addressing review comment to extra newline", "committedDate": "2020-05-27T10:14:53Z", "type": "commit"}]}