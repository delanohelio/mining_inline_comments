{"pr_number": 2003, "pr_title": "HADOOP-16768. SnappyCompressor test cases wrongly assume that the compressed data is always smaller than the input data.", "pr_createdAt": "2020-05-08T11:43:46Z", "pr_url": "https://github.com/apache/hadoop/pull/2003", "timeline": [{"oid": "6817f659b812249cc01a47044949196eebb81207", "url": "https://github.com/apache/hadoop/commit/6817f659b812249cc01a47044949196eebb81207", "message": "Increase size of direct buffer", "committedDate": "2020-05-08T10:14:48Z", "type": "commit"}, {"oid": "0e357a7a0a2d8e0a3bd62ac4605f51473a9b4009", "url": "https://github.com/apache/hadoop/commit/0e357a7a0a2d8e0a3bd62ac4605f51473a9b4009", "message": "Add logging", "committedDate": "2020-05-08T10:23:08Z", "type": "commit"}, {"oid": "44448e0ab77f0addb5779a3f713b111f3d6e691c", "url": "https://github.com/apache/hadoop/commit/44448e0ab77f0addb5779a3f713b111f3d6e691c", "message": "Output compressed size", "committedDate": "2020-05-08T10:35:41Z", "type": "commit"}, {"oid": "e9cabdd159249b6c11ed75b6746dfb57ee319250", "url": "https://github.com/apache/hadoop/commit/e9cabdd159249b6c11ed75b6746dfb57ee319250", "message": "Revert the change of buffer size.", "committedDate": "2020-05-08T10:51:09Z", "type": "commit"}, {"oid": "d6df06e0c1300ac2a76c308c55fcef379587f162", "url": "https://github.com/apache/hadoop/commit/d6df06e0c1300ac2a76c308c55fcef379587f162", "message": "More debug messages", "committedDate": "2020-05-08T11:01:11Z", "type": "commit"}, {"oid": "34f86164dbeb32933fe40bee462364c073875c98", "url": "https://github.com/apache/hadoop/commit/34f86164dbeb32933fe40bee462364c073875c98", "message": "Use compressed size as possible", "committedDate": "2020-05-08T11:10:35Z", "type": "commit"}, {"oid": "918abd00fb8a0964ecc15df103ad3abc2992be17", "url": "https://github.com/apache/hadoop/commit/918abd00fb8a0964ecc15df103ad3abc2992be17", "message": "Throw exception in test", "committedDate": "2020-05-08T11:14:35Z", "type": "commit"}, {"oid": "2d7ea2d380026f236edc5666e22f94ede997033e", "url": "https://github.com/apache/hadoop/commit/2d7ea2d380026f236edc5666e22f94ede997033e", "message": "Increase compressed buffer", "committedDate": "2020-05-08T11:22:12Z", "type": "commit"}, {"oid": "5fbbb51350afce00f2db4771ff3d201175b4ccd7", "url": "https://github.com/apache/hadoop/commit/5fbbb51350afce00f2db4771ff3d201175b4ccd7", "message": "Tweak doc", "committedDate": "2020-05-08T11:24:29Z", "type": "commit"}, {"oid": "86233882c5cf2ac24ead3331c4ba1e53339f9e58", "url": "https://github.com/apache/hadoop/commit/86233882c5cf2ac24ead3331c4ba1e53339f9e58", "message": "Remove unused import", "committedDate": "2020-05-08T11:37:51Z", "type": "commit"}, {"oid": "b188a47fffb46a01f8d17f299178af29028c7a67", "url": "https://github.com/apache/hadoop/commit/b188a47fffb46a01f8d17f299178af29028c7a67", "message": "Use assertEquals instead of assertTrue", "committedDate": "2020-05-08T11:39:35Z", "type": "commit"}, {"oid": "dac152bb70a37d1c2517cf67c487fa52eb58f719", "url": "https://github.com/apache/hadoop/commit/dac152bb70a37d1c2517cf67c487fa52eb58f719", "message": "Refactor test", "committedDate": "2020-05-08T17:11:18Z", "type": "commit"}, {"oid": "d9f0d9fc3f69aba0b1063f35c24ccc16252d5963", "url": "https://github.com/apache/hadoop/commit/d9f0d9fc3f69aba0b1063f35c24ccc16252d5963", "message": "Fix TestCompressorDecompressor", "committedDate": "2020-05-08T17:15:01Z", "type": "commit"}, {"oid": "6febbfa0618e9b3c09d0caf28d60d86c7a1a74fa", "url": "https://github.com/apache/hadoop/commit/6febbfa0618e9b3c09d0caf28d60d86c7a1a74fa", "message": "Fix checkstyle warning", "committedDate": "2020-05-09T17:20:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDQxNA==", "url": "https://github.com/apache/hadoop/pull/2003#discussion_r422650414", "bodyText": "Do we need this change? This could cause IndexOutOfBoundsException on consuming compressed data.", "author": "iwasakims", "createdAt": "2020-05-10T14:08:24Z", "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/compress/snappy/SnappyCompressor.java", "diffHunk": "@@ -234,8 +234,6 @@ public int compress(byte[] b, int off, int len)\n       finished = true;\n     }\n \n-    // Get atmost 'len' bytes\n-    n = Math.min(n, len);", "originalCommit": "6febbfa0618e9b3c09d0caf28d60d86c7a1a74fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxOTAzNQ==", "url": "https://github.com/apache/hadoop/pull/2003#discussion_r422719035", "bodyText": "This change is not needed. Reverted the change.\nI would like to add a test case for this problem.", "author": "aajisaka", "createdAt": "2020-05-10T23:50:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDQxNA=="}], "type": "inlineReview", "revised_code": {"commit": "0650432f439a27579204d71fd8b680dad73236bb", "chunk": "diff --git a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/compress/snappy/SnappyCompressor.java b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/compress/snappy/SnappyCompressor.java\nindex e5e523fe7cb..3d386800e4d 100644\n--- a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/compress/snappy/SnappyCompressor.java\n+++ b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/compress/snappy/SnappyCompressor.java\n\n@@ -234,6 +234,8 @@ public int compress(byte[] b, int off, int len)\n       finished = true;\n     }\n \n+    // Get atmost 'len' bytes\n+    n = Math.min(n, len);\n     bytesWritten += n;\n     ((ByteBuffer) compressedDirectBuf).get(b, off, n);\n \n"}}, {"oid": "0650432f439a27579204d71fd8b680dad73236bb", "url": "https://github.com/apache/hadoop/commit/0650432f439a27579204d71fd8b680dad73236bb", "message": "Limit the compressed data within the buffer size for each compress call.", "committedDate": "2020-05-10T23:37:00Z", "type": "commit"}, {"oid": "4a7befba1514eb764aa88478119e0a2463f6767b", "url": "https://github.com/apache/hadoop/commit/4a7befba1514eb764aa88478119e0a2463f6767b", "message": "Add a test case for small buffer.", "committedDate": "2020-05-11T00:22:42Z", "type": "commit"}, {"oid": "b487be0fd407ab232bda91dc37de4cf6f9fb1c59", "url": "https://github.com/apache/hadoop/commit/b487be0fd407ab232bda91dc37de4cf6f9fb1c59", "message": "Fix infinite-loop", "committedDate": "2020-05-11T00:26:51Z", "type": "commit"}, {"oid": "175ddaa0800d5991a68da58b10f6a723ff082f01", "url": "https://github.com/apache/hadoop/commit/175ddaa0800d5991a68da58b10f6a723ff082f01", "message": "Add assertion for the compressed data", "committedDate": "2020-05-11T00:29:36Z", "type": "commit"}, {"oid": "5ef9ba5907a22c2a8f267664438f4380e69be3af", "url": "https://github.com/apache/hadoop/commit/5ef9ba5907a22c2a8f267664438f4380e69be3af", "message": "Tweak the doc", "committedDate": "2020-05-11T00:34:17Z", "type": "commit"}, {"oid": "ff47f779ac7e6d2a93e84207ec3bf12b62e88219", "url": "https://github.com/apache/hadoop/commit/ff47f779ac7e6d2a93e84207ec3bf12b62e88219", "message": "Rename local variables to fix check style warnings", "committedDate": "2020-05-11T03:50:03Z", "type": "commit"}]}