{"pr_number": 1990, "pr_title": "HADOOP-17018. Intermittent failing of ITestAbfsStreamStatistics in ABFS", "pr_createdAt": "2020-04-30T12:52:57Z", "pr_url": "https://github.com/apache/hadoop/pull/1990", "timeline": [{"oid": "e2e29be973633435aea1aef0d8478482ef4a49b9", "url": "https://github.com/apache/hadoop/commit/e2e29be973633435aea1aef0d8478482ef4a49b9", "message": "HADOOP-17018. Intermittent failing of ITestAbfsStreamStatistics in ABFS", "committedDate": "2020-04-30T12:41:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3ODYzMQ==", "url": "https://github.com/apache/hadoop/pull/1990#discussion_r420678631", "bodyText": "Error text needs to include actual values", "author": "steveloughran", "createdAt": "2020-05-06T10:06:51Z", "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAbfsStreamStatistics.java", "diffHunk": "@@ -84,12 +84,20 @@ public void testAbfsStreamOps() throws Exception {\n \n       LOG.info(\"Result of Read operation : {}\", result);\n       /*\n-      Testing if 2 read_ops value is coming after reading full content from a\n-      file (3 if anything to read from Buffer too).\n-      Reason: read() call gives read_ops=1,\n-      reading from AbfsClient(http GET) gives read_ops=2.\n+       * Testing if 2 read_ops value is coming after reading full content\n+       * from a file (3 if anything to read from Buffer too). Reason: read()\n+       * call gives read_ops=1, reading from AbfsClient(http GET) gives\n+       * read_ops=2.\n+       *\n+       * In some cases ABFS-prefetch thread runs in the background which\n+       * returns some bytes from buffer and gives an extra readOp.\n+       * Thus, making readOps values arbitrary and giving intermittent\n+       * failures in some cases. Hence, readOps values of 2 or 3 is seen in\n+       * different setups.\n+       *\n        */\n-      assertReadWriteOps(\"read\", 2, statistics.getReadOps());\n+      assertTrue(\"Mismatch in read operations\",", "originalCommit": "e2e29be973633435aea1aef0d8478482ef4a49b9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "19a314aa9de013f0dacb58741dcd7788edc7e6a6", "chunk": "diff --git a/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAbfsStreamStatistics.java b/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAbfsStreamStatistics.java\nindex 359a0ea7c03..51531f678f6 100644\n--- a/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAbfsStreamStatistics.java\n+++ b/hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAbfsStreamStatistics.java\n\n@@ -96,7 +96,8 @@ public void testAbfsStreamOps() throws Exception {\n        * different setups.\n        *\n        */\n-      assertTrue(\"Mismatch in read operations\",\n+      assertTrue(String.format(\"The actual value of %d was not equal to the \"\n+              + \"expected value of 2 or 3\", statistics.getReadOps()),\n           statistics.getReadOps() == 2 || statistics.getReadOps() == 3);\n \n     } finally {\n"}}, {"oid": "19a314aa9de013f0dacb58741dcd7788edc7e6a6", "url": "https://github.com/apache/hadoop/commit/19a314aa9de013f0dacb58741dcd7788edc7e6a6", "message": "HADOOP-17018. Actual value in error message", "committedDate": "2020-05-07T10:25:51Z", "type": "commit"}]}