{"pr_number": 2132, "pr_title": "HDFS-15464: ViewFsOverloadScheme should work when -fs option pointing to remote cluster without mount links", "pr_createdAt": "2020-07-10T17:56:30Z", "pr_url": "https://github.com/apache/hadoop/pull/2132", "timeline": [{"oid": "ce2b73d6170c5d76deb2e39c510b38afd7bf8234", "url": "https://github.com/apache/hadoop/commit/ce2b73d6170c5d76deb2e39c510b38afd7bf8234", "message": "HDFS-15464: ViewFsOverloadScheme should work when -fs option pointing to remote cluster without mount links", "committedDate": "2020-07-10T17:54:34Z", "type": "commit"}, {"oid": "1e1dfd6142dcf265345c270bd1bf181003a36137", "url": "https://github.com/apache/hadoop/commit/1e1dfd6142dcf265345c270bd1bf181003a36137", "message": "Fixed test failures.", "committedDate": "2020-07-11T00:34:52Z", "type": "commit"}, {"oid": "38860cfe85a8a178d5ff86c0c119b54e6ac33de0", "url": "https://github.com/apache/hadoop/commit/38860cfe85a8a178d5ff86c0c119b54e6ac33de0", "message": "Moved test to TestViewFsOverloadSchemeListStatus.java", "committedDate": "2020-07-11T21:52:34Z", "type": "commit"}, {"oid": "c76ae4d0f6dec615300f113401e4fd3533960031", "url": "https://github.com/apache/hadoop/commit/c76ae4d0f6dec615300f113401e4fd3533960031", "message": "Added a log mesage in the case where no mount links detected.", "committedDate": "2020-07-11T22:16:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NTE3MA==", "url": "https://github.com/apache/hadoop/pull/2132#discussion_r453265170", "bodyText": "nit:\nthere is a static import for assert.* above, you can avoid having Assert.", "author": "ayushtkn", "createdAt": "2020-07-12T04:21:42Z", "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFsOverloadSchemeListStatus.java", "diffHunk": "@@ -124,6 +126,24 @@ public void testListStatusACL() throws IOException, URISyntaxException {\n     }\n   }\n \n+  /**\n+   * Tests that ViewFSOverloadScheme should consider initialized fs as fallback\n+   * if there are no mount links configured.\n+   */\n+  @Test(timeout = 30000)\n+  public void testViewFSOverloadSchemeWithoutAnyMountLinks() throws Exception {\n+    try (FileSystem fs = FileSystem.get(TEST_DIR.toPath().toUri(), conf)) {\n+      ViewFileSystemOverloadScheme vfs = (ViewFileSystemOverloadScheme) fs;\n+      Assert.assertEquals(0, vfs.getMountPoints().length);\n+      Path testFallBack = new Path(\"test\", FILE_NAME);\n+      Assert.assertTrue(vfs.mkdirs(testFallBack));\n+      FileStatus[] status = vfs.listStatus(testFallBack.getParent());\n+      Assert.assertEquals(FILE_NAME, status[0].getPath().getName());\n+      Assert.assertEquals(testFallBack.getName(),", "originalCommit": "c76ae4d0f6dec615300f113401e4fd3533960031", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI3NDMyOQ==", "url": "https://github.com/apache/hadoop/pull/2132#discussion_r453274329", "bodyText": "Done", "author": "umamaheswararao", "createdAt": "2020-07-12T06:25:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NTE3MA=="}], "type": "inlineReview", "revised_code": {"commit": "49ecbb3aa6115a0a82bc56ed0e65fb274a961c51", "chunk": "diff --git a/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFsOverloadSchemeListStatus.java b/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFsOverloadSchemeListStatus.java\nindex 8d3903c442a..300fdd8b333 100644\n--- a/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFsOverloadSchemeListStatus.java\n+++ b/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFsOverloadSchemeListStatus.java\n\n@@ -134,12 +133,12 @@ public void testListStatusACL() throws IOException, URISyntaxException {\n   public void testViewFSOverloadSchemeWithoutAnyMountLinks() throws Exception {\n     try (FileSystem fs = FileSystem.get(TEST_DIR.toPath().toUri(), conf)) {\n       ViewFileSystemOverloadScheme vfs = (ViewFileSystemOverloadScheme) fs;\n-      Assert.assertEquals(0, vfs.getMountPoints().length);\n+      assertEquals(0, vfs.getMountPoints().length);\n       Path testFallBack = new Path(\"test\", FILE_NAME);\n-      Assert.assertTrue(vfs.mkdirs(testFallBack));\n+      assertTrue(vfs.mkdirs(testFallBack));\n       FileStatus[] status = vfs.listStatus(testFallBack.getParent());\n-      Assert.assertEquals(FILE_NAME, status[0].getPath().getName());\n-      Assert.assertEquals(testFallBack.getName(),\n+      assertEquals(FILE_NAME, status[0].getPath().getName());\n+      assertEquals(testFallBack.getName(),\n           vfs.getFileLinkStatus(testFallBack).getPath().getName());\n     }\n   }\n"}}, {"oid": "49ecbb3aa6115a0a82bc56ed0e65fb274a961c51", "url": "https://github.com/apache/hadoop/commit/49ecbb3aa6115a0a82bc56ed0e65fb274a961c51", "message": "Nit change: Just removed Assert. and removed import", "committedDate": "2020-07-12T06:23:58Z", "type": "commit"}]}