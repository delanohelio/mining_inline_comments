{"pr_number": 2411, "pr_title": "HADOOP-17324. Don't relocate org.bouncycastle in shaded client jars", "pr_createdAt": "2020-10-23T22:23:23Z", "pr_url": "https://github.com/apache/hadoop/pull/2411", "timeline": [{"oid": "640b4a0a345f0dbeb78e49e4f58e9c704d720e87", "url": "https://github.com/apache/hadoop/commit/640b4a0a345f0dbeb78e49e4f58e9c704d720e87", "message": "HADOOP-17324. Don't relocate org.bouncycastle in shaded client jars", "committedDate": "2020-10-23T22:11:41Z", "type": "commit"}, {"oid": "8f2a4902cae57985f5ce8f241ac774ddba29fc39", "url": "https://github.com/apache/hadoop/commit/8f2a4902cae57985f5ce8f241ac774ddba29fc39", "message": "Add tests", "committedDate": "2020-10-26T18:20:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3NTUzNg==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r512175536", "bodyText": "another issue: we currently don't bundle YARN test resources like capacity-scheduler.xml in hadoop-client-minicluster so this is a temporary workaround. I'll open another JIRA for this later.", "author": "sunchao", "createdAt": "2020-10-26T18:21:49Z", "path": "hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java", "diffHunk": "@@ -73,13 +78,22 @@ public void clusterUp() throws IOException {\n         .numDataNodes(3)\n         .build();\n     cluster.waitActive();\n+\n+    conf.set(\"yarn.scheduler.capacity.root.queues\", \"default\");", "originalCommit": "8f2a4902cae57985f5ce8f241ac774ddba29fc39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMjc4OA==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r519822788", "bodyText": "we leave out all of test/resources to stop log4j files, site configs etc getting onto the classpath of apps downstream -so making it impossible for them to choose their own options", "author": "steveloughran", "createdAt": "2020-11-09T13:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3NTUzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA3MzY3NQ==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r520073675", "bodyText": "maybe we should include them for test-only purpose? I think hadoop-client-minicluster should always be test scope right?", "author": "sunchao", "createdAt": "2020-11-09T19:41:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3NTUzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY3MTcyNA==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r520671724", "bodyText": "it may be test only, but the other test suite may have its own configs that it wants. If we put them in the test JAR, it becomes near impossible to change. People will hate us (more)", "author": "steveloughran", "createdAt": "2020-11-10T15:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3NTUzNg=="}], "type": "inlineReview", "revised_code": {"commit": "7149aa1c1d528cec793768f83e6b4e84d787d489", "chunk": "diff --git a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\nindex eb2ae3a8148..2e304861bab 100644\n--- a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n+++ b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n\n@@ -91,9 +89,7 @@ public void clusterDown() {\n     if (cluster != null) {\n       cluster.close();\n     }\n-    if (yarnCluster != null) {\n-      yarnCluster.stop();\n-    }\n+    IOUtils.cleanupWithLogger(LOG, yarnCluster);\n   }\n \n   @Test\n"}}, {"oid": "e5d64e7e3bca1b836d93bdbbe5b65c5df1208ac3", "url": "https://github.com/apache/hadoop/commit/e5d64e7e3bca1b836d93bdbbe5b65c5df1208ac3", "message": "Include dependencies needed by MiniYARNCluster", "committedDate": "2020-11-04T17:37:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMTc1OA==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r519821758", "bodyText": "should go straight after line 45 - no gap", "author": "steveloughran", "createdAt": "2020-11-09T13:41:15Z", "path": "hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java", "diffHunk": "@@ -44,6 +44,10 @@\n import org.apache.hadoop.hdfs.web.WebHdfsTestUtil;\n import org.apache.hadoop.hdfs.web.WebHdfsConstants;\n \n+import org.apache.hadoop.yarn.server.MiniYARNCluster;", "originalCommit": "8f2a4902cae57985f5ce8f241ac774ddba29fc39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA3NDc5OQ==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r520074799", "bodyText": "will fix. I was trying to follow the existing style though which separates imports based on package.", "author": "sunchao", "createdAt": "2020-11-09T19:43:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMTc1OA=="}], "type": "inlineReview", "revised_code": {"commit": "7149aa1c1d528cec793768f83e6b4e84d787d489", "chunk": "diff --git a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\nindex eb2ae3a8148..2e304861bab 100644\n--- a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n+++ b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n\n@@ -43,11 +44,8 @@\n \n import org.apache.hadoop.hdfs.web.WebHdfsTestUtil;\n import org.apache.hadoop.hdfs.web.WebHdfsConstants;\n-\n import org.apache.hadoop.yarn.server.MiniYARNCluster;\n \n-import static org.junit.Assert.assertTrue;\n-\n /**\n  * Ensure that we can perform operations against the shaded minicluster\n  * given the API and runtime jars by performing some simple smoke tests.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMTkzNA==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r519821934", "bodyText": "unused, according to checkstyle", "author": "steveloughran", "createdAt": "2020-11-09T13:41:31Z", "path": "hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java", "diffHunk": "@@ -44,6 +44,10 @@\n import org.apache.hadoop.hdfs.web.WebHdfsTestUtil;\n import org.apache.hadoop.hdfs.web.WebHdfsConstants;\n \n+import org.apache.hadoop.yarn.server.MiniYARNCluster;\n+\n+import static org.junit.Assert.assertTrue;", "originalCommit": "8f2a4902cae57985f5ce8f241ac774ddba29fc39", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7149aa1c1d528cec793768f83e6b4e84d787d489", "chunk": "diff --git a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\nindex eb2ae3a8148..2e304861bab 100644\n--- a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n+++ b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n\n@@ -43,11 +44,8 @@\n \n import org.apache.hadoop.hdfs.web.WebHdfsTestUtil;\n import org.apache.hadoop.hdfs.web.WebHdfsConstants;\n-\n import org.apache.hadoop.yarn.server.MiniYARNCluster;\n \n-import static org.junit.Assert.assertTrue;\n-\n /**\n  * Ensure that we can perform operations against the shaded minicluster\n  * given the API and runtime jars by performing some simple smoke tests.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNDYyOQ==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r519824629", "bodyText": "all services are closeable, so use IOUtil.cleanupWithLogger() & let it handle null checks and exceptions", "author": "steveloughran", "createdAt": "2020-11-09T13:45:37Z", "path": "hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java", "diffHunk": "@@ -73,13 +78,22 @@ public void clusterUp() throws IOException {\n         .numDataNodes(3)\n         .build();\n     cluster.waitActive();\n+\n+    conf.set(\"yarn.scheduler.capacity.root.queues\", \"default\");\n+    conf.setInt(\"yarn.scheduler.capacity.root.default.capacity\", 100);\n+    yarnCluster = new MiniYARNCluster(getClass().getName(), 1, 1, 1, 1);\n+    yarnCluster.init(conf);\n+    yarnCluster.start();\n   }\n \n   @After\n   public void clusterDown() {\n     if (cluster != null) {\n       cluster.close();\n     }\n+    if (yarnCluster != null) {", "originalCommit": "8f2a4902cae57985f5ce8f241ac774ddba29fc39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA5MjU4Ng==", "url": "https://github.com/apache/hadoop/pull/2411#discussion_r520092586", "bodyText": "Nice. Didn't know this util method, but seems we can only use it with yarnCluster.", "author": "sunchao", "createdAt": "2020-11-09T20:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNDYyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "7149aa1c1d528cec793768f83e6b4e84d787d489", "chunk": "diff --git a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\nindex eb2ae3a8148..2e304861bab 100644\n--- a/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n+++ b/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseMiniCluster.java\n\n@@ -91,9 +89,7 @@ public void clusterDown() {\n     if (cluster != null) {\n       cluster.close();\n     }\n-    if (yarnCluster != null) {\n-      yarnCluster.stop();\n-    }\n+    IOUtils.cleanupWithLogger(LOG, yarnCluster);\n   }\n \n   @Test\n"}}, {"oid": "7149aa1c1d528cec793768f83e6b4e84d787d489", "url": "https://github.com/apache/hadoop/commit/7149aa1c1d528cec793768f83e6b4e84d787d489", "message": "Address comments", "committedDate": "2020-11-09T20:15:21Z", "type": "commit"}]}