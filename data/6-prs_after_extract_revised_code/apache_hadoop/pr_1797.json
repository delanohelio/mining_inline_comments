{"pr_number": 1797, "pr_title": "HDFS-15077. Fix intermittent failure of TestDFSClientRetries#testLeas\u2026", "pr_createdAt": "2020-01-07T07:06:46Z", "pr_url": "https://github.com/apache/hadoop/pull/1797", "timeline": [{"oid": "acd80823495233683d0887cb21ab95c3642ac2ac", "url": "https://github.com/apache/hadoop/commit/acd80823495233683d0887cb21ab95c3642ac2ac", "message": "HDFS-15077. Fix intermittent failure of TestDFSClientRetries#testLeaseRenewSocketTimeout.", "committedDate": "2020-01-07T07:03:45Z", "type": "commit"}, {"oid": "0de30e92205215040d948d6eeb03b80ddb4c0fd7", "url": "https://github.com/apache/hadoop/commit/0de30e92205215040d948d6eeb03b80ddb4c0fd7", "message": "addressed checkstyle warning.", "committedDate": "2020-01-07T07:11:36Z", "type": "commit"}, {"oid": "3218cc49c2fce26d761061a2ed34b6263a218596", "url": "https://github.com/apache/hadoop/commit/3218cc49c2fce26d761061a2ed34b6263a218596", "message": "should wait till current LeaseRenewer thread stops to avoid race.", "committedDate": "2020-01-07T07:30:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAyODA0MQ==", "url": "https://github.com/apache/hadoop/pull/1797#discussion_r364028041", "bodyText": "Should we set final to leaseRenewer2 as well as leaseRenewer1?", "author": "aajisaka", "createdAt": "2020-01-08T01:21:49Z", "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSClientRetries.java", "diffHunk": "@@ -406,14 +407,14 @@ public void testLeaseRenewSocketTimeout() throws Exception\n       // throws SocketTimeoutException.\n       Mockito.doNothing().when(spyNN).renewLease(\n           Mockito.anyString());\n-      leaseRenewer = client.getLeaseRenewer();\n-      leaseRenewer.setRenewalTime(100);\n+      LeaseRenewer leaseRenewer2 = client.getLeaseRenewer();", "originalCommit": "3218cc49c2fce26d761061a2ed34b6263a218596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAyODQ4Mg==", "url": "https://github.com/apache/hadoop/pull/1797#discussion_r364028482", "bodyText": "I'm +1 if that is addressed.", "author": "aajisaka", "createdAt": "2020-01-08T01:24:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAyODA0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA1Mjc5Mg==", "url": "https://github.com/apache/hadoop/pull/1797#discussion_r364052792", "bodyText": "I addressed your comment. Thanks.", "author": "iwasakims", "createdAt": "2020-01-08T03:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAyODA0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "0361560576fbc9e1d694fb22570f54cb3770d305", "chunk": "diff --git a/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSClientRetries.java b/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSClientRetries.java\nindex 676ab0f0215..e560522cd93 100644\n--- a/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSClientRetries.java\n+++ b/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSClientRetries.java\n\n@@ -407,7 +407,7 @@ public void testLeaseRenewSocketTimeout() throws Exception\n       // throws SocketTimeoutException.\n       Mockito.doNothing().when(spyNN).renewLease(\n           Mockito.anyString());\n-      LeaseRenewer leaseRenewer2 = client.getLeaseRenewer();\n+      final LeaseRenewer leaseRenewer2 = client.getLeaseRenewer();\n       leaseRenewer2.setRenewalTime(100);\n       OutputStream out2 = client.create(file2, false);\n       Mockito.verify(spyNN, timeout(10000).times(2)).renewLease(\n"}}, {"oid": "0361560576fbc9e1d694fb22570f54cb3770d305", "url": "https://github.com/apache/hadoop/commit/0361560576fbc9e1d694fb22570f54cb3770d305", "message": "marked local var as final to align with existing one.", "committedDate": "2020-01-08T03:40:04Z", "type": "commit"}]}