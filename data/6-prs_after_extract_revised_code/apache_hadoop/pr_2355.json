{"pr_number": 2355, "pr_title": "HDFS-15611. Add list Snapshot command in WebHDFS.", "pr_createdAt": "2020-10-01T13:12:25Z", "pr_url": "https://github.com/apache/hadoop/pull/2355", "timeline": [{"oid": "b6b2090a7cc0a07b0afcf6137817519f7b95cd4b", "url": "https://github.com/apache/hadoop/commit/b6b2090a7cc0a07b0afcf6137817519f7b95cd4b", "message": "HDFS-15611. Add list Snapshot command in WebHDFS.", "committedDate": "2020-10-01T13:11:04Z", "type": "commit"}, {"oid": "508e648d9a7f42b5afcf31867b9c9c5b8653139b", "url": "https://github.com/apache/hadoop/commit/508e648d9a7f42b5afcf31867b9c9c5b8653139b", "message": "Fixed compilation issue.", "committedDate": "2020-10-01T16:16:02Z", "type": "commit"}, {"oid": "e7c07bcb9275a1c23412ccb8eb49491b0652e517", "url": "https://github.com/apache/hadoop/commit/e7c07bcb9275a1c23412ccb8eb49491b0652e517", "message": "Fixed unit test.", "committedDate": "2020-10-01T16:22:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYwNDM5Nw==", "url": "https://github.com/apache/hadoop/pull/2355#discussion_r498604397", "bodyText": "Use \"DELETED\".equal(..) in order to avoid NPE?\n final boolean isDeleted = \"DELETED\".equals(json.get(\"deletionStatus\"));", "author": "szetszwo", "createdAt": "2020-10-02T03:24:52Z", "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/JsonUtilClient.java", "diffHunk": "@@ -872,4 +873,39 @@ private static SnapshottableDirectoryStatus toSnapshottableDirectoryStatus(\n             snapshotQuota, parentFullPath);\n     return snapshottableDirectoryStatus;\n   }\n+\n+  public static SnapshotStatus[] toSnapshotList(final Map<?, ?> json) {\n+    if (json == null) {\n+      return null;\n+    }\n+    List<?> list = (List<?>) json.get(\"SnapshotList\");\n+    if (list == null) {\n+      return null;\n+    }\n+    SnapshotStatus[] statuses =\n+        new SnapshotStatus[list.size()];\n+    for (int i = 0; i < list.size(); i++) {\n+      statuses[i] = toSnapshotStatus((Map<?, ?>) list.get(i));\n+    }\n+    return statuses;\n+  }\n+\n+  private static SnapshotStatus toSnapshotStatus(\n+      Map<?, ?> json) {\n+    if (json == null) {\n+      return null;\n+    }\n+    int snapshotID = getInt(json, \"snapshotID\", 0);\n+    boolean isDeleted = ((String)json.get(\"deletionStatus\")).\n+        contentEquals(\"DELETED\");", "originalCommit": "e7c07bcb9275a1c23412ccb8eb49491b0652e517", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "739e04540a3abb32205ed04b2bf0276932f4537c", "chunk": "diff --git a/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/JsonUtilClient.java b/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/JsonUtilClient.java\nindex 98c7ddede55..6ce01a2221b 100644\n--- a/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/JsonUtilClient.java\n+++ b/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/JsonUtilClient.java\n\n@@ -896,8 +896,8 @@ private static SnapshotStatus toSnapshotStatus(\n       return null;\n     }\n     int snapshotID = getInt(json, \"snapshotID\", 0);\n-    boolean isDeleted = ((String)json.get(\"deletionStatus\")).\n-        contentEquals(\"DELETED\");\n+    boolean isDeleted = \"DELETED\".equalsIgnoreCase(\n+        (String)json.get(\"deletionStatus\"));\n     String fullPath = ((String) json.get(\"fullPath\"));\n \n     HdfsFileStatus dirStatus =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYwNTEyMA==", "url": "https://github.com/apache/hadoop/pull/2355#discussion_r498605120", "bodyText": "In DistributedFileSystem, it is called\n  public SnapshotStatus[] getSnapshotListing(Path snapshotRoot)\nLet's use the same name?", "author": "szetszwo", "createdAt": "2020-10-02T03:29:27Z", "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/WebHdfsFileSystem.java", "diffHunk": "@@ -1459,6 +1460,19 @@ SnapshotDiffReport decodeResponse(Map<?, ?> json) {\n     }.run();\n   }\n \n+  public SnapshotStatus[] getSnapshotList(final Path snapshotDir)", "originalCommit": "e7c07bcb9275a1c23412ccb8eb49491b0652e517", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "739e04540a3abb32205ed04b2bf0276932f4537c", "chunk": "diff --git a/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/WebHdfsFileSystem.java b/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/WebHdfsFileSystem.java\nindex 2b971ad72c8..bfcd0f8e2cc 100644\n--- a/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/WebHdfsFileSystem.java\n+++ b/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/web/WebHdfsFileSystem.java\n\n@@ -1460,7 +1460,7 @@ SnapshotDiffReport decodeResponse(Map<?, ?> json) {\n     }.run();\n   }\n \n-  public SnapshotStatus[] getSnapshotList(final Path snapshotDir)\n+  public SnapshotStatus[] getSnapshotListing(final Path snapshotDir)\n       throws IOException {\n     storageStatistics\n         .incrementOpCounter(OpType.GET_SNAPSHOT_LIST);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYwNTE4Ng==", "url": "https://github.com/apache/hadoop/pull/2355#discussion_r498605186", "bodyText": "Unused import.", "author": "szetszwo", "createdAt": "2020-10-02T03:29:48Z", "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/protocol/SnapshotStatus.java", "diffHunk": "@@ -25,6 +25,7 @@\n import org.apache.hadoop.fs.Path;\n import org.apache.hadoop.fs.permission.FsPermission;\n import org.apache.hadoop.hdfs.DFSUtilClient;\n+import org.apache.hadoop.util.StringUtils;", "originalCommit": "e7c07bcb9275a1c23412ccb8eb49491b0652e517", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "739e04540a3abb32205ed04b2bf0276932f4537c", "chunk": "diff --git a/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/protocol/SnapshotStatus.java b/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/protocol/SnapshotStatus.java\nindex 6e8cad36a86..8f10db8b8e6 100644\n--- a/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/protocol/SnapshotStatus.java\n+++ b/hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/protocol/SnapshotStatus.java\n\n@@ -25,7 +25,6 @@\n import org.apache.hadoop.fs.Path;\n import org.apache.hadoop.fs.permission.FsPermission;\n import org.apache.hadoop.hdfs.DFSUtilClient;\n-import org.apache.hadoop.util.StringUtils;\n \n /**\n  * Metadata about a snapshottable directory.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYwNjQ2Mg==", "url": "https://github.com/apache/hadoop/pull/2355#discussion_r498606462", "bodyText": "It should call getSnapshotListing.", "author": "szetszwo", "createdAt": "2020-10-02T03:37:34Z", "path": "hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/fs/http/client/HttpFSFileSystem.java", "diffHunk": "@@ -1582,6 +1584,18 @@ public SnapshotDiffReport getSnapshotDiffReport(Path path,\n     return JsonUtilClient.toSnapshottableDirectoryList(json);\n   }\n \n+  public SnapshotStatus[] getSnapshotList(Path snapshotRoot)", "originalCommit": "e7c07bcb9275a1c23412ccb8eb49491b0652e517", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "739e04540a3abb32205ed04b2bf0276932f4537c", "chunk": "diff --git a/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/fs/http/client/HttpFSFileSystem.java b/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/fs/http/client/HttpFSFileSystem.java\nindex e521e905a74..ccd71d94249 100644\n--- a/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/fs/http/client/HttpFSFileSystem.java\n+++ b/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/fs/http/client/HttpFSFileSystem.java\n\n@@ -1584,7 +1584,7 @@ public SnapshotDiffReport getSnapshotDiffReport(Path path,\n     return JsonUtilClient.toSnapshottableDirectoryList(json);\n   }\n \n-  public SnapshotStatus[] getSnapshotList(Path snapshotRoot)\n+  public SnapshotStatus[] getSnapshotListing(Path snapshotRoot)\n       throws IOException {\n     Map<String, String> params = new HashMap<String, String>();\n     params.put(OP_PARAM, Operation.GETSNAPSHOTLIST.toString());\n"}}, {"oid": "739e04540a3abb32205ed04b2bf0276932f4537c", "url": "https://github.com/apache/hadoop/commit/739e04540a3abb32205ed04b2bf0276932f4537c", "message": "Addressed Review comments.", "committedDate": "2020-10-02T05:45:33Z", "type": "commit"}, {"oid": "c0e61c1d0cf652182c8d68538f0d41a74909d39a", "url": "https://github.com/apache/hadoop/commit/c0e61c1d0cf652182c8d68538f0d41a74909d39a", "message": "Addressed checkstyle issues.", "committedDate": "2020-10-05T06:03:25Z", "type": "commit"}]}