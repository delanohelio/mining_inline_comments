{"pr_number": 2545, "pr_title": "HADOOP-17430. Add clear bytes logic for hadoop Text", "pr_createdAt": "2020-12-13T12:21:45Z", "pr_url": "https://github.com/apache/hadoop/pull/2545", "timeline": [{"oid": "54476713ddfc25d1afe118001b22d991130a8e14", "url": "https://github.com/apache/hadoop/commit/54476713ddfc25d1afe118001b22d991130a8e14", "message": "HADOOP-17430. Add clear bytes logic for hadoop Text", "committedDate": "2020-12-13T12:16:53Z", "type": "commit"}, {"oid": "071ecc04f54b3b9ed33f9853b22a2e80f3ab02c3", "url": "https://github.com/apache/hadoop/commit/071ecc04f54b3b9ed33f9853b22a2e80f3ab02c3", "message": "HADOOP-17430. Add clear bytes logic for hadoop Text", "committedDate": "2020-12-14T03:01:27Z", "type": "commit"}, {"oid": "fdda75c86c8913f01acf99848efc958a58a38379", "url": "https://github.com/apache/hadoop/commit/fdda75c86c8913f01acf99848efc958a58a38379", "message": "HADOOP-17430. Add clear bytes logic for hadoop Text", "committedDate": "2020-12-16T05:19:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgwODYwNw==", "url": "https://github.com/apache/hadoop/pull/2545#discussion_r545808607", "bodyText": "nit: can you add spaces either side of the  () ,e.g\nif (utf8.length == 0) {", "author": "steveloughran", "createdAt": "2020-12-18T12:46:00Z", "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java", "diffHunk": "@@ -226,6 +226,12 @@ public void set(String string) {\n    * Set to a utf8 byte array.\n    */\n   public void set(byte[] utf8) {\n+    if(utf8.length == 0){", "originalCommit": "fdda75c86c8913f01acf99848efc958a58a38379", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "11ebcf938850f3b601abadaf26a114add915a5d4", "chunk": "diff --git a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\nindex a8e64e9ade0..3fda08116fe 100644\n--- a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\n+++ b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\n\n@@ -226,13 +226,13 @@ public void set(String string) {\n    * Set to a utf8 byte array.\n    */\n   public void set(byte[] utf8) {\n-    if(utf8.length == 0){\n+    if (utf8.length == 0) {\n       bytes = EMPTY_BYTES;\n       length = 0;\n       textLength = -1;\n-      return;\n+    } else {\n+      set(utf8, 0, utf8.length);\n     }\n-    set(utf8, 0, utf8.length);\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgwOTM2Mw==", "url": "https://github.com/apache/hadoop/pull/2545#discussion_r545809363", "bodyText": "I think I'd prefer to cut the return here and just have an else clause for the normal set() operation.\nThis isn't so long and complex a piece of code that an early return makes sense; it can be easy to miss that it's there when reading the code.", "author": "steveloughran", "createdAt": "2020-12-18T12:47:33Z", "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java", "diffHunk": "@@ -226,6 +226,12 @@ public void set(String string) {\n    * Set to a utf8 byte array.\n    */\n   public void set(byte[] utf8) {\n+    if(utf8.length == 0){\n+      bytes = EMPTY_BYTES;\n+      length = 0;\n+      textLength = -1;\n+      return;", "originalCommit": "fdda75c86c8913f01acf99848efc958a58a38379", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgyMTgxNA==", "url": "https://github.com/apache/hadoop/pull/2545#discussion_r545821814", "bodyText": "Thank you for your advice. I'll fix it", "author": "dgzdot", "createdAt": "2020-12-18T13:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgwOTM2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "11ebcf938850f3b601abadaf26a114add915a5d4", "chunk": "diff --git a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\nindex a8e64e9ade0..3fda08116fe 100644\n--- a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\n+++ b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\n\n@@ -226,13 +226,13 @@ public void set(String string) {\n    * Set to a utf8 byte array.\n    */\n   public void set(byte[] utf8) {\n-    if(utf8.length == 0){\n+    if (utf8.length == 0) {\n       bytes = EMPTY_BYTES;\n       length = 0;\n       textLength = -1;\n-      return;\n+    } else {\n+      set(utf8, 0, utf8.length);\n     }\n-    set(utf8, 0, utf8.length);\n   }\n \n   /**\n"}}, {"oid": "11ebcf938850f3b601abadaf26a114add915a5d4", "url": "https://github.com/apache/hadoop/commit/11ebcf938850f3b601abadaf26a114add915a5d4", "message": "HADOOP-17430. Add clear bytes logic for hadoop Text", "committedDate": "2020-12-18T13:17:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc2ODE4OA==", "url": "https://github.com/apache/hadoop/pull/2545#discussion_r546768188", "bodyText": "Please update JavaDocs to provide details on behaviors as written here.", "author": "belugabehr", "createdAt": "2020-12-21T15:26:33Z", "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java", "diffHunk": "@@ -226,7 +226,13 @@ public void set(String string) {\n    * Set to a utf8 byte array.\n    */", "originalCommit": "11ebcf938850f3b601abadaf26a114add915a5d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTM5MA==", "url": "https://github.com/apache/hadoop/pull/2545#discussion_r547039390", "bodyText": "OK, I would.", "author": "dgzdot", "createdAt": "2020-12-22T02:57:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc2ODE4OA=="}], "type": "inlineReview", "revised_code": {"commit": "c5ee1783e6df2631492c6f42d98a11ee3230a28d", "chunk": "diff --git a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\nindex 3fda08116fe..49151002bae 100644\n--- a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\n+++ b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/Text.java\n\n@@ -223,7 +223,9 @@ public void set(String string) {\n   }\n \n   /**\n-   * Set to a utf8 byte array.\n+   * Set to a utf8 byte array. If the length of <code>utf8</code> is\n+   * <em>zero</em>, actually clear {@link #bytes} and any existing\n+   * data is lost.\n    */\n   public void set(byte[] utf8) {\n     if (utf8.length == 0) {\n"}}, {"oid": "c5ee1783e6df2631492c6f42d98a11ee3230a28d", "url": "https://github.com/apache/hadoop/commit/c5ee1783e6df2631492c6f42d98a11ee3230a28d", "message": "HADOOP-17430. update JavaDocs to provide details on modified function", "committedDate": "2020-12-22T02:53:35Z", "type": "commit"}]}