{"pr_number": 2490, "pr_title": "YARN-10499. TestRouterWebServiceREST fails (#2490). Contributed by Akira Ajisaka", "pr_createdAt": "2020-11-25T04:06:23Z", "pr_url": "https://github.com/apache/hadoop/pull/2490", "timeline": [{"oid": "323f265187bd290d98c92d753076460ed468bc44", "url": "https://github.com/apache/hadoop/commit/323f265187bd290d98c92d753076460ed468bc44", "message": "YARN-10499. TestRouterWebServicesREST fails.", "committedDate": "2020-11-25T03:45:38Z", "type": "commit"}, {"oid": "3713be58061928484a8b679610a012d3ff23af0f", "url": "https://github.com/apache/hadoop/commit/3713be58061928484a8b679610a012d3ff23af0f", "message": "Touch the test source to run the test in the precommit job", "committedDate": "2020-11-25T04:02:48Z", "type": "commit"}, {"oid": "bbe845fcfa99ba420d5c17536a6b2ad207fa69b4", "url": "https://github.com/apache/hadoop/commit/bbe845fcfa99ba420d5c17536a6b2ad207fa69b4", "message": "Revert \"Touch the test source to run the test in the precommit job\"\n\nThis reverts commit 3713be58061928484a8b679610a012d3ff23af0f.", "committedDate": "2020-11-30T04:39:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzMTMyNg==", "url": "https://github.com/apache/hadoop/pull/2490#discussion_r532631326", "bodyText": "Just to be sure the variable context is as consistent as possible, please add a\nvctx.putExtraDataset(\"groups\", groupsSet);\nbefore the return, empty set is a valid groups, at least it can be used by the matchers, not that it will ever match, but it's perhaps better than leaving it blank.\nAs for primary and secondary groups there is not much we can do.", "author": "shuzirra", "createdAt": "2020-11-30T14:21:08Z", "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/placement/CSMappingPlacementRule.java", "diffHunk": "@@ -181,6 +181,10 @@ private void setupGroupsForVariableContext(VariableContext vctx, String user)\n       return;\n     }\n     Set<String> groupsSet = groups.getGroupsSet(user);\n+    if (groupsSet.isEmpty()) {\n+      LOG.warn(\"There are no groups for user {}\", user);\n+      return;", "originalCommit": "323f265187bd290d98c92d753076460ed468bc44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE2MTYyOA==", "url": "https://github.com/apache/hadoop/pull/2490#discussion_r533161628", "bodyText": "Added it. Thank you @shuzirra", "author": "aajisaka", "createdAt": "2020-12-01T08:44:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzMTMyNg=="}], "type": "inlineReview", "revised_code": {"commit": "70bd2079040251f37cd2084781ca88936695bb6c", "chunk": "diff --git a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/placement/CSMappingPlacementRule.java b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/placement/CSMappingPlacementRule.java\nindex 4c83c5e460d..b1a733dfd15 100644\n--- a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/placement/CSMappingPlacementRule.java\n+++ b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/placement/CSMappingPlacementRule.java\n\n@@ -183,6 +183,7 @@ private void setupGroupsForVariableContext(VariableContext vctx, String user)\n     Set<String> groupsSet = groups.getGroupsSet(user);\n     if (groupsSet.isEmpty()) {\n       LOG.warn(\"There are no groups for user {}\", user);\n+      vctx.putExtraDataset(\"groups\", groupsSet);\n       return;\n     }\n     String secondaryGroup = null;\n"}}, {"oid": "70bd2079040251f37cd2084781ca88936695bb6c", "url": "https://github.com/apache/hadoop/commit/70bd2079040251f37cd2084781ca88936695bb6c", "message": "Make sure the variable context to be consitent by adding an extra dataset", "committedDate": "2020-12-01T08:43:23Z", "type": "commit"}]}