{"pr_number": 3271, "pr_title": "Remove dependency upon internet URLs for selenium tests", "pr_createdAt": "2020-09-26T20:29:35Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/3271", "timeline": [{"oid": "1d4fda43fadce8b2ca6e50ab5844c7555be958fc", "url": "https://github.com/testcontainers/testcontainers-java/commit/1d4fda43fadce8b2ca6e50ab5844c7555be958fc", "message": "Remove dependency upon internet URLs for selenium tests", "committedDate": "2020-09-26T10:43:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ5MjcxNQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3271#discussion_r495492715", "bodyText": "There's no real sense in having two ways to test that Selenium is working, so just removed this altogether.", "author": "rnorth", "createdAt": "2020-09-26T20:30:37Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/BaseWebDriverContainerTest.java", "diffHunk": "@@ -1,62 +1,62 @@\n package org.testcontainers.junit;\n \n import org.jetbrains.annotations.NotNull;\n+import org.junit.ClassRule;\n import org.openqa.selenium.By;\n import org.openqa.selenium.WebElement;\n import org.openqa.selenium.remote.RemoteWebDriver;\n-import org.openqa.selenium.support.ui.ExpectedConditions;\n-import org.openqa.selenium.support.ui.WebDriverWait;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.Network;\n+import org.testcontainers.containers.wait.strategy.HttpWaitStrategy;\n+import org.testcontainers.utility.DockerImageName;\n \n-import java.util.List;\n import java.util.concurrent.TimeUnit;\n \n import static java.lang.String.format;\n+import static org.rnorth.visibleassertions.VisibleAssertions.assertEquals;\n import static org.rnorth.visibleassertions.VisibleAssertions.assertTrue;\n \n /**\n  *\n  */\n public class BaseWebDriverContainerTest {\n \n-    protected void doSimpleWebdriverTest(BrowserWebDriverContainer rule) {\n+    @ClassRule\n+    public static Network NETWORK = Network.newNetwork();\n+\n+    @ClassRule\n+    public static GenericContainer<?> HELLO_WORLD = new GenericContainer<>(DockerImageName.parse(\"testcontainers/helloworld:1.0.0\"))\n+        .withNetwork(NETWORK)\n+        .withNetworkAliases(\"helloworld\")\n+        .withExposedPorts(8080, 8081)\n+        .waitingFor(new HttpWaitStrategy());\n+\n+    protected static void doSimpleExplore(BrowserWebDriverContainer<?> rule) {\n         RemoteWebDriver driver = setupDriverFromRule(rule);\n         System.out.println(\"Selenium remote URL is: \" + rule.getSeleniumAddress());\n         System.out.println(\"VNC URL is: \" + rule.getVncAddress());\n \n-        driver.get(\"http://www.google.com\");\n-        WebElement search = driver.findElement(By.name(\"q\"));\n-        search.sendKeys(\"testcontainers\");\n-        search.submit();\n+        driver.get(\"http://helloworld:8080\");\n+        WebElement title = driver.findElement(By.tagName(\"h1\"));\n \n-        List<WebElement> results = new WebDriverWait(driver, 15)\n-            .until(ExpectedConditions.visibilityOfAllElementsLocatedBy(By.cssSelector(\"#search h3\")));\n-\n-        assertTrue(\"the word 'testcontainers' appears in search results\",\n-            results.stream()\n-                .anyMatch(el -> el.getText().contains(\"testcontainers\")));\n+        assertEquals(\"the index page contains the title 'Hello world'\",\n+            \"Hello world\",\n+            title.getText().trim()\n+        );\n     }\n \n-    protected void assertBrowserNameIs(BrowserWebDriverContainer rule, String expectedName) {\n+    protected void assertBrowserNameIs(BrowserWebDriverContainer<?> rule, String expectedName) {\n         RemoteWebDriver driver = setupDriverFromRule(rule);\n         String actual = driver.getCapabilities().getBrowserName();\n         assertTrue(format(\"actual browser name is %s\", actual),\n             actual.equals(expectedName));\n     }\n \n     @NotNull\n-    private static RemoteWebDriver setupDriverFromRule(BrowserWebDriverContainer rule) {\n+    private static RemoteWebDriver setupDriverFromRule(BrowserWebDriverContainer<?> rule) {\n         RemoteWebDriver driver = rule.getWebDriver();\n         driver.manage().timeouts().implicitlyWait(30, TimeUnit.SECONDS);\n         return driver;\n     }\n-\n-    protected static void doSimpleExplore(BrowserWebDriverContainer rule) {\n-        RemoteWebDriver driver = setupDriverFromRule(rule);\n-        driver.get(\"http://en.wikipedia.org/wiki/Randomness\");\n-\n-        // Oh! The irony!\n-        assertTrue(\"Randomness' description has the word 'pattern'\", driver.findElementByPartialLinkText(\"pattern\").isDisplayed());\n-    }", "originalCommit": "1d4fda43fadce8b2ca6e50ab5844c7555be958fc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ5Mjc3Mw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3271#discussion_r495492773", "bodyText": "This was old and ignored anyway, so have just removed.", "author": "rnorth", "createdAt": "2020-09-26T20:31:13Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/FlakyContainerCreationTest.java", "diffHunk": "@@ -1,31 +0,0 @@\n-package org.testcontainers.junit;\n-\n-import org.junit.Ignore;\n-import org.junit.Test;\n-import org.openqa.selenium.chrome.ChromeOptions;\n-import org.openqa.selenium.remote.RemoteWebDriver;\n-import org.testcontainers.containers.BrowserWebDriverContainer;\n-\n-import java.io.File;\n-\n-/**\n- * Created by rnorth on 30/01/2016.\n- */\n-public class FlakyContainerCreationTest {", "originalCommit": "1d4fda43fadce8b2ca6e50ab5844c7555be958fc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ5Mjc5OQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3271#discussion_r495492799", "bodyText": "Given that all our tests will now use 'linked' (networked) containers, there's little point in having an explicit test for it that works another way.", "author": "rnorth", "createdAt": "2020-09-26T20:31:57Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/LinkedContainerTest.java", "diffHunk": "@@ -1,69 +0,0 @@\n-package org.testcontainers.junit;\n-\n-import lombok.Cleanup;\n-import org.junit.BeforeClass;\n-import org.junit.Rule;\n-import org.junit.Test;\n-import org.openqa.selenium.By;\n-import org.openqa.selenium.chrome.ChromeOptions;\n-import org.openqa.selenium.remote.RemoteWebDriver;\n-import org.testcontainers.SeleniumTestImages;\n-import org.testcontainers.containers.BrowserWebDriverContainer;\n-import org.testcontainers.containers.Network;\n-import org.testcontainers.containers.NginxContainer;\n-\n-import java.io.File;\n-import java.io.FileNotFoundException;\n-import java.io.FileOutputStream;\n-import java.io.PrintStream;\n-\n-import static org.rnorth.visibleassertions.VisibleAssertions.assertEquals;\n-\n-\n-/**\n- * @author richardnorth\n- */\n-public class LinkedContainerTest {", "originalCommit": "1d4fda43fadce8b2ca6e50ab5844c7555be958fc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}