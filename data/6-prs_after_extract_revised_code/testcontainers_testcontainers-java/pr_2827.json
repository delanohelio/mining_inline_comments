{"pr_number": 2827, "pr_title": "Add support for Docker compose `withOptions(...)`", "pr_createdAt": "2020-06-02T09:19:26Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/2827", "timeline": [{"oid": "354298b2897b0b9609dfb9aeca187cdfe3afa9fe", "url": "https://github.com/testcontainers/testcontainers-java/commit/354298b2897b0b9609dfb9aeca187cdfe3afa9fe", "message": "Docker compose options.", "committedDate": "2020-06-02T09:01:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc3MTAxNQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2827#discussion_r433771015", "bodyText": "Let's use a Set<String> to which to add the options.  Or in case order would be important (it probably is not?) a List.", "author": "kiview", "createdAt": "2020-06-02T10:17:35Z", "path": "core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java", "diffHunk": "@@ -78,6 +78,7 @@\n     private boolean localCompose;\n     private boolean pull = true;\n     private boolean build = false;\n+    private String options = StringUtils.EMPTY;", "originalCommit": "354298b2897b0b9609dfb9aeca187cdfe3afa9fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "23802c4e60764cf8c6b0385d4e26fccf048296f5", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java b/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java\nindex c6a1871d..1470905b 100644\n--- a/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java\n\n@@ -78,7 +79,7 @@ public class DockerComposeContainer<SELF extends DockerComposeContainer<SELF>> e\n     private boolean localCompose;\n     private boolean pull = true;\n     private boolean build = false;\n-    private String options = StringUtils.EMPTY;\n+    private Set<String> options = new HashSet<>();\n     private boolean tailChildContainers;\n \n     private String project;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc3MTk5OQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2827#discussion_r433771999", "bodyText": "Just adding to the Set here would be enough.\nString for runWithCompose can be constructed using Stream and Collectors.joining.", "author": "kiview", "createdAt": "2020-06-02T10:19:28Z", "path": "core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java", "diffHunk": "@@ -500,6 +501,20 @@ public SELF withBuild(boolean build) {\n         return self();\n     }\n \n+    /**\n+     * Adds options to the docker-compose command, e.g. docker-compose --compatibility. Options must be space separated\n+     * Options are raw strings to allow future options to be accommodated transparently.\n+     *\n+     * @return this instance, for chaining\n+     */\n+    public SELF withOptions(String options) {", "originalCommit": "354298b2897b0b9609dfb9aeca187cdfe3afa9fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIzNTUxMA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2827#discussion_r435235510", "bodyText": "Building on @kiview's suggestion to use a set, this also would mean that withOptions could take a varargs String, and just add all to the set. This would be quite nice semantically.", "author": "rnorth", "createdAt": "2020-06-04T13:03:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc3MTk5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "23802c4e60764cf8c6b0385d4e26fccf048296f5", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java b/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java\nindex c6a1871d..1470905b 100644\n--- a/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/DockerComposeContainer.java\n\n@@ -507,10 +521,7 @@ public class DockerComposeContainer<SELF extends DockerComposeContainer<SELF>> e\n      *\n      * @return this instance, for chaining\n      */\n-    public SELF withOptions(String options) {\n-        if (options.length() != 0 && !options.endsWith(\" \")) {\n-            options+=\" \";\n-        }\n+    public SELF withOptions(Set<String> options) {\n         this.options = options;\n         return self();\n     }\n"}}, {"oid": "23802c4e60764cf8c6b0385d4e26fccf048296f5", "url": "https://github.com/testcontainers/testcontainers-java/commit/23802c4e60764cf8c6b0385d4e26fccf048296f5", "message": "Docker compose options.", "committedDate": "2020-06-03T08:45:23Z", "type": "commit"}, {"oid": "afc3ee01ded08787480e1b63cbfd2fc0480e1b7e", "url": "https://github.com/testcontainers/testcontainers-java/commit/afc3ee01ded08787480e1b63cbfd2fc0480e1b7e", "message": "Review changes for docker compose options.", "committedDate": "2020-06-03T09:11:51Z", "type": "commit"}, {"oid": "c447fd98b7131821e936deb8c64d64a05c4d9da2", "url": "https://github.com/testcontainers/testcontainers-java/commit/c447fd98b7131821e936deb8c64d64a05c4d9da2", "message": "Docker compose options.", "committedDate": "2020-06-05T14:57:45Z", "type": "commit"}, {"oid": "988edf3139b02a6e64820e36e5e53fadf60b8315", "url": "https://github.com/testcontainers/testcontainers-java/commit/988edf3139b02a6e64820e36e5e53fadf60b8315", "message": "Docker compose options.", "committedDate": "2020-06-05T15:29:12Z", "type": "commit"}, {"oid": "f80cc0346fe209a6ae3c3895adb5a23642fbb8b6", "url": "https://github.com/testcontainers/testcontainers-java/commit/f80cc0346fe209a6ae3c3895adb5a23642fbb8b6", "message": "Vargs implementation for docker compose options.", "committedDate": "2020-06-05T15:36:06Z", "type": "commit"}, {"oid": "6bc36135192b5cb2f5c5d4650c97c6923c83ef0b", "url": "https://github.com/testcontainers/testcontainers-java/commit/6bc36135192b5cb2f5c5d4650c97c6923c83ef0b", "message": "Merge remote-tracking branch 'origin/master' into dockerComposeOptions", "committedDate": "2020-09-14T19:10:03Z", "type": "commit"}]}