{"pr_number": 3180, "pr_title": "Make recorder .flv videos scrollable (#512)", "pr_createdAt": "2020-08-31T22:18:18Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/3180", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2MzY2MQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r480863661", "bodyText": "Should we rename this method to reencodeRecording?", "author": "kiview", "createdAt": "2020-09-01T06:17:23Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -87,19 +88,27 @@ protected void configure() {\n         );\n     }\n \n+    @SneakyThrows\n+    public void saveRecordingToFile(File file) {\n+        try(InputStream inputStream = streamRecording()) {\n+            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+        }\n+    }\n+\n     @SneakyThrows\n     public InputStream streamRecording() {\n+        fixRecordDuration();\n+\n         TarArchiveInputStream archiveInputStream = new TarArchiveInputStream(\n                 dockerClient.copyArchiveFromContainerCmd(getContainerId(), RECORDING_FILE_NAME).exec()\n         );\n         archiveInputStream.getNextEntry();\n         return archiveInputStream;\n     }\n \n-    @SneakyThrows\n-    public void saveRecordingToFile(File file) {\n-        try(InputStream inputStream = streamRecording()) {\n-            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-        }\n+    private void fixRecordDuration() throws IOException, InterruptedException {", "originalCommit": "4fbd2fed5794fb7071fe9843ee924deef89e0b62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ3OTc3Mg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482479772", "bodyText": "It's done.", "author": "oussamabadr", "createdAt": "2020-09-02T21:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2MzY2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex b16816b1..788c2377 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -97,7 +97,7 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n \n     @SneakyThrows\n     public InputStream streamRecording() {\n-        fixRecordDuration();\n+        reencodeRecording();\n \n         TarArchiveInputStream archiveInputStream = new TarArchiveInputStream(\n                 dockerClient.copyArchiveFromContainerCmd(getContainerId(), RECORDING_FILE_NAME).exec()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2NDkwNA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r480864904", "bodyText": "This line might be problematic in certain CI environments. copyFiletoContainer should be the safer method.", "author": "kiview", "createdAt": "2020-09-01T06:19:09Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -58,6 +64,52 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException {\n+            final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+            final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n+\n+            try (\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+            ) {\n+                chrome.start();\n+\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return flvFileTitle;\n+                    }\n+                }, Optional.empty());\n+\n+                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n+\n+                ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n+\n+                try( GenericContainer container = new GenericContainer<>(\"jrottenberg/ffmpeg:3.2-alpine38\") ) {\n+                    container.withStartupCheckStrategy(new OneShotStartupCheckStrategy())\n+                            .withFileSystemBind(recordedFile, \"/tmp/chromeTestRecord.flv\", BindMode.READ_WRITE )", "originalCommit": "4fbd2fed5794fb7071fe9843ee924deef89e0b62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ3OTg2OA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482479868", "bodyText": "Done.", "author": "oussamabadr", "createdAt": "2020-09-02T21:16:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2NDkwNA=="}], "type": "inlineReview", "revised_code": {"commit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex e3547f8b..a3ae1ca3 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -66,13 +68,13 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n         }\n \n         @Test\n-        public void recordingTestThatShouldHaveCorrectDuration() throws IOException {\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n             final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n             final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n-\n+            DockerImageName chromeDockerImageName = DockerImageName.parse(\"selenium/standalone-chrome-debug\")\n+                                                             .withTag(SeleniumUtils.determineClasspathSeleniumVersion());\n             try (\n-                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer()\n-                    .withCapabilities(new ChromeOptions())\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer(chromeDockerImageName)\n                     .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n             ) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2NzAyMA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r480867020", "bodyText": "In general, we like to avoid using 3rd party images as part of our CI (if we can). I assume we could use the updated vnc-recorder container here as well, or?", "author": "kiview", "createdAt": "2020-09-01T06:22:18Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -58,6 +64,52 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException {\n+            final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+            final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n+\n+            try (\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+            ) {\n+                chrome.start();\n+\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return flvFileTitle;\n+                    }\n+                }, Optional.empty());\n+\n+                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n+\n+                ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n+\n+                try( GenericContainer container = new GenericContainer<>(\"jrottenberg/ffmpeg:3.2-alpine38\") ) {", "originalCommit": "4fbd2fed5794fb7071fe9843ee924deef89e0b62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ3OTkzNg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482479936", "bodyText": "Done.", "author": "oussamabadr", "createdAt": "2020-09-02T21:16:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2NzAyMA=="}], "type": "inlineReview", "revised_code": {"commit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex e3547f8b..a3ae1ca3 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -66,13 +68,13 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n         }\n \n         @Test\n-        public void recordingTestThatShouldHaveCorrectDuration() throws IOException {\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n             final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n             final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n-\n+            DockerImageName chromeDockerImageName = DockerImageName.parse(\"selenium/standalone-chrome-debug\")\n+                                                             .withTag(SeleniumUtils.determineClasspathSeleniumVersion());\n             try (\n-                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer()\n-                    .withCapabilities(new ChromeOptions())\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer(chromeDockerImageName)\n                     .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n             ) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2NzA1NQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r480867055", "bodyText": "OneShotStartupCheckStrategy  should not throw an exception if the container stops with exit code 0.", "author": "kiview", "createdAt": "2020-09-01T06:22:21Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -58,6 +64,52 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException {\n+            final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+            final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n+\n+            try (\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+            ) {\n+                chrome.start();\n+\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return flvFileTitle;\n+                    }\n+                }, Optional.empty());\n+\n+                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n+\n+                ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n+\n+                try( GenericContainer container = new GenericContainer<>(\"jrottenberg/ffmpeg:3.2-alpine38\") ) {\n+                    container.withStartupCheckStrategy(new OneShotStartupCheckStrategy())\n+                            .withFileSystemBind(recordedFile, \"/tmp/chromeTestRecord.flv\", BindMode.READ_WRITE )\n+                            .withCommand(\"-i\" ,\"/tmp/chromeTestRecord.flv\")\n+                            .withLogConsumer(dockerLogConsumer)\n+                            .start();\n+                } catch (RuntimeException ex) {", "originalCommit": "4fbd2fed5794fb7071fe9843ee924deef89e0b62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ3OTk3Mg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482479972", "bodyText": "Fixed.", "author": "oussamabadr", "createdAt": "2020-09-02T21:16:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2NzA1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex e3547f8b..a3ae1ca3 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -66,13 +68,13 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n         }\n \n         @Test\n-        public void recordingTestThatShouldHaveCorrectDuration() throws IOException {\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n             final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n             final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n-\n+            DockerImageName chromeDockerImageName = DockerImageName.parse(\"selenium/standalone-chrome-debug\")\n+                                                             .withTag(SeleniumUtils.determineClasspathSeleniumVersion());\n             try (\n-                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer()\n-                    .withCapabilities(new ChromeOptions())\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer(chromeDockerImageName)\n                     .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n             ) {\n"}}, {"oid": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "url": "https://github.com/testcontainers/testcontainers-java/commit/a50d156936320e5fe4d513c2744e2479b2dd2cc6", "message": "Remove third party container + Refactoring (#512)", "committedDate": "2020-09-02T21:13:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482485221", "bodyText": "Why encode to .flv instead of .mp4 container? Only to avoid the -movflags faststart parameter?", "author": "leonard84", "createdAt": "2020-09-02T21:22:25Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -87,19 +88,27 @@ protected void configure() {\n         );\n     }\n \n+    @SneakyThrows\n+    public void saveRecordingToFile(File file) {\n+        try(InputStream inputStream = streamRecording()) {\n+            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+        }\n+    }\n+\n     @SneakyThrows\n     public InputStream streamRecording() {\n+        reencodeRecording();\n+\n         TarArchiveInputStream archiveInputStream = new TarArchiveInputStream(\n                 dockerClient.copyArchiveFromContainerCmd(getContainerId(), RECORDING_FILE_NAME).exec()\n         );\n         archiveInputStream.getNextEntry();\n         return archiveInputStream;\n     }\n \n-    @SneakyThrows\n-    public void saveRecordingToFile(File file) {\n-        try(InputStream inputStream = streamRecording()) {\n-            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-        }\n+    private void reencodeRecording() throws IOException, InterruptedException {\n+        String newFlvOutput = \"/newScreen.flv\";", "originalCommit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUxOTg4Mg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482519882", "bodyText": "I don't know if it's Ok to change the record extension in this ticket, maybe we can open a new ticket for this, and I add that we can implement a kind of configuration to let user decide which extension he wants for recording...\n...but, I'm open if you want me to change my pull request to use .mp4 instead of .flv  with -movflags faststart  \ud83d\ude42", "author": "oussamabadr", "createdAt": "2020-09-02T22:04:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1NjQ4NQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482756485", "bodyText": "I personally have no opinion about this.\n@leonard84 could you elaborate why .mp4 would be the better choice? Would be happy to endorse this instead and change it in this PR, if it is the better choice for whatever reason.", "author": "kiview", "createdAt": "2020-09-03T07:12:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MTg2Ng==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r483161866", "bodyText": "FLV is a proprietary format developed by Adobe. MP4 is a format standardized by the ISO in the MPEG-4 family. Your video is H.264 (MPEG-4 Part 10), so it's from the same MPEG-4 standard.2\n\n\nThat being said, the support for MP4 should always be better than for FLV containers. While typical desktop video players support almost every container and codec, devices such as mobile phones or DLNA streaming servers might only handle MP4 files.\n\nhttps://superuser.com/a/549647", "author": "leonard84", "createdAt": "2020-09-03T18:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA3NTE2MA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r484075160", "bodyText": "I can also add this blog article of Adobe about flv being obsolete:\n\nIf you want to create a video to play in Flash Player, then you should generally be using H.264 (.mp4), not the obsolete FLV or F4V formats...\n\nhttps://blogs.adobe.com/creativecloud/removal-flv-f4v-swf-export-adobe-media-encoder-after-effects-premiere-pro/\nMaybe we should consider using .mp4 format, but is there any impact on users ? if so, should we just mark .flv as deprecated and offer .mp4 as option (or as default) and mention that .flv support will be deleted soon ?\nIf not, we can replace it right away.", "author": "oussamabadr", "createdAt": "2020-09-06T14:13:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNzQzMQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r484507431", "bodyText": "IMHO we should offer mp4 as default and could offer a legacy mode that produces flv.\nI don't think that there are any who specifically want flv, we currently transcode it in a post processing  step to mp4.\nSure this change breaks that, but that is the whole point, and we can just remove the step with this feature.", "author": "leonard84", "createdAt": "2020-09-07T16:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM5NDc5NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r524394794", "bodyText": "Was this quietly resolved? I still think we should use mp4.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String newFlvOutput = \"/newScreen.flv\";\n          \n          \n            \n                    String newFlvOutput = \"/newScreen.mp4\";\n          \n          \n            \n                    execInContainer(\"ffmpeg\" , \"-i\", RECORDING_FILE_NAME, \"-vcodec\", \"libx264\", \"-movflags\", \"faststart\", newFlvOutput);\n          \n      \n    \n    \n  \n\nSince the comment already has fixed line, I can't really let the suggestion replace the next line.", "author": "leonard84", "createdAt": "2020-11-16T16:22:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NTIyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex 788c2377..9560472b 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -84,7 +93,7 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1NzE0MQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482757141", "bodyText": "I wonder, can't we use VncRecordingContainer here directly? You can still override cmdModifier etc.", "author": "kiview", "createdAt": "2020-09-03T07:14:05Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -58,6 +66,52 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+            final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n+            DockerImageName chromeDockerImageName = DockerImageName.parse(\"selenium/standalone-chrome-debug\")\n+                                                             .withTag(SeleniumUtils.determineClasspathSeleniumVersion());\n+            try (\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer(chromeDockerImageName)\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+            ) {\n+                chrome.start();\n+\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return flvFileTitle;\n+                    }\n+                }, Optional.empty());\n+\n+                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n+\n+                String dockerOutput;\n+                try( GenericContainer<?> container = new GenericContainer<>(TestcontainersConfiguration.getInstance().getVncDockerImageName()) ) {", "originalCommit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA3NTY5Mw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r484075693", "bodyText": "VncRecordingContainer container has constructors with @NonNull arguments, and I don't know how can I instantiate the container without creating a method to return a VncRecordingContainer with ffmpeg as an entrypoint, which I think not good for the class as It will deviate from its main role which is  a vnc recoding, and ffmpeg is just an implementation detail (To fix the recording), and in my test I just want to get meta data for the recorded video using whatever ffmpeg.\nNonetheless, I can apply your suggestion, I just need some hints on how to do it properly, I don't want to mess the code up, as I don't have a deep knowledge of the base code  \ud83d\ude05", "author": "oussamabadr", "createdAt": "2020-09-06T14:17:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1NzE0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxODQ0MA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r519618440", "bodyText": "ok, makes sense.", "author": "kiview", "createdAt": "2020-11-09T08:09:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1NzE0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7008dfd3d7b94b50dbde41cc2b45f8c15a2d6b28", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex a3ae1ca3..d7af85e4 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -95,21 +95,18 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n \n                 String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n \n-                String dockerOutput;\n+                ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n                 try( GenericContainer<?> container = new GenericContainer<>(TestcontainersConfiguration.getInstance().getVncDockerImageName()) ) {\n                     String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n-                    ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n-\n                     container.withCopyFileToContainer(MountableFile.forHostPath(recordedFile), recordFileContainerPath)\n                             .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n                             .withCommand(\"-i\" , recordFileContainerPath)\n                             .withLogConsumer(dockerLogConsumer)\n                             .start();\n-\n-                    dockerOutput = dockerLogConsumer.toUtf8String();\n                 }\n \n-                assertTrue(\"Duration is incorrect: \", dockerOutput.matches(\"[\\\\S\\\\s]*Duration: (?!00:00:00.00)[\\\\S\\\\s]*\"));\n+                String dockerOutput = dockerLogConsumer.toUtf8String();\n+                assertTrue(\"Duration is incorrect in:\\n \" + dockerOutput, dockerOutput.matches(\"[\\\\S\\\\s]*Duration: (?!00:00:00.00)[\\\\S\\\\s]*\"));\n             }\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1ODAzMw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r482758033", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            String dockerOutput;\n          \n          \n            \n                            String dockerOutput = \"\";\n          \n      \n    \n    \n  \n\nMaybe better to initialize with empty String, so we can't end up with NPE in the assert.", "author": "kiview", "createdAt": "2020-09-03T07:15:46Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -58,6 +66,52 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            final String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+            final String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n+            DockerImageName chromeDockerImageName = DockerImageName.parse(\"selenium/standalone-chrome-debug\")\n+                                                             .withTag(SeleniumUtils.determineClasspathSeleniumVersion());\n+            try (\n+                BrowserWebDriverContainer chrome = new BrowserWebDriverContainer(chromeDockerImageName)\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+            ) {\n+                chrome.start();\n+\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return flvFileTitle;\n+                    }\n+                }, Optional.empty());\n+\n+                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n+\n+                String dockerOutput;", "originalCommit": "a50d156936320e5fe4d513c2744e2479b2dd2cc6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA3NjgwNw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r484076807", "bodyText": "It's no longer the case, I merged the declaration and the assignment, thanks \ud83d\udc4d", "author": "oussamabadr", "createdAt": "2020-09-06T14:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1ODAzMw=="}], "type": "inlineReview", "revised_code": {"commit": "7008dfd3d7b94b50dbde41cc2b45f8c15a2d6b28", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex a3ae1ca3..d7af85e4 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -95,21 +95,18 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n \n                 String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n \n-                String dockerOutput;\n+                ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n                 try( GenericContainer<?> container = new GenericContainer<>(TestcontainersConfiguration.getInstance().getVncDockerImageName()) ) {\n                     String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n-                    ToStringConsumer dockerLogConsumer = new ToStringConsumer();\n-\n                     container.withCopyFileToContainer(MountableFile.forHostPath(recordedFile), recordFileContainerPath)\n                             .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n                             .withCommand(\"-i\" , recordFileContainerPath)\n                             .withLogConsumer(dockerLogConsumer)\n                             .start();\n-\n-                    dockerOutput = dockerLogConsumer.toUtf8String();\n                 }\n \n-                assertTrue(\"Duration is incorrect: \", dockerOutput.matches(\"[\\\\S\\\\s]*Duration: (?!00:00:00.00)[\\\\S\\\\s]*\"));\n+                String dockerOutput = dockerLogConsumer.toUtf8String();\n+                assertTrue(\"Duration is incorrect in:\\n \" + dockerOutput, dockerOutput.matches(\"[\\\\S\\\\s]*Duration: (?!00:00:00.00)[\\\\S\\\\s]*\"));\n             }\n         }\n     }\n"}}, {"oid": "7008dfd3d7b94b50dbde41cc2b45f8c15a2d6b28", "url": "https://github.com/testcontainers/testcontainers-java/commit/7008dfd3d7b94b50dbde41cc2b45f8c15a2d6b28", "message": "Remove third party container + Refactoring (#512)", "committedDate": "2020-09-06T14:36:57Z", "type": "forcePushed"}, {"oid": "30963c2fae95272bcda09b0a6a763be143e1e730", "url": "https://github.com/testcontainers/testcontainers-java/commit/30963c2fae95272bcda09b0a6a763be143e1e730", "message": "Fix tests in Selenium module", "committedDate": "2020-09-20T22:26:34Z", "type": "forcePushed"}, {"oid": "4b75c5ea012f3634b23459318287552c0dde1dde", "url": "https://github.com/testcontainers/testcontainers-java/commit/4b75c5ea012f3634b23459318287552c0dde1dde", "message": "Fixing test after merge with master", "committedDate": "2020-10-10T18:10:04Z", "type": "forcePushed"}, {"oid": "f76e59a9cb56c451b23987c5f1fa6c6f1784be6b", "url": "https://github.com/testcontainers/testcontainers-java/commit/f76e59a9cb56c451b23987c5f1fa6c6f1784be6b", "message": "Fixing test after merge with master", "committedDate": "2020-10-10T23:20:29Z", "type": "forcePushed"}, {"oid": "0af43e01aa1f815ed695b4ea14e26a3d41561fa7", "url": "https://github.com/testcontainers/testcontainers-java/commit/0af43e01aa1f815ed695b4ea14e26a3d41561fa7", "message": "Fixing test after merge with master", "committedDate": "2020-10-10T23:51:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI1MTMxMQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r503251311", "bodyText": "Why do you need this sleep?", "author": "kiview", "createdAt": "2020-10-12T12:09:39Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -59,6 +66,53 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordAll {\n+                // To do this, simply add extra parameters to the rule constructor:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target)\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                chrome.start();\n+\n+                TimeUnit.SECONDS.sleep(5);", "originalCommit": "6249e3d50194cdda36892a812951a76afc652cee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NTkyOQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r503655929", "bodyText": "Sometimes the test goes very fast and the record may have duration = 00:00:00.00,  I reduce sleep to 1 second.", "author": "oussamabadr", "createdAt": "2020-10-13T04:10:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI1MTMxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "ae172f5255dc51c6aadad3f6a3f1b810b0470d79", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 38cdea3a..27dac6cd 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -81,7 +83,7 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n             ) {\n                 chrome.start();\n \n-                TimeUnit.SECONDS.sleep(5);\n+                TimeUnit.SECONDS.sleep(1);\n                 doSimpleExplore(chrome);\n                 chrome.afterTest(new TestDescription() {\n                     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI1MjI0Mg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r503252242", "bodyText": "I think it is not guaranteed, that the command did finish, therefore you miss the logs in CI, which runs slower. This container is missing the appropriate Wait Strategy. LogMessageWaitStrategy seems to be a good candidate here.", "author": "kiview", "createdAt": "2020-10-12T12:11:31Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -59,6 +66,53 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordAll {\n+                // To do this, simply add extra parameters to the rule constructor:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target)\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                chrome.start();\n+\n+                TimeUnit.SECONDS.sleep(5);\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                    }\n+                }, Optional.empty());\n+\n+                String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n+                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n+\n+                try( GenericContainer<?> container = new GenericContainer<>(TestcontainersConfiguration.getInstance().getVncDockerImageName()) ) {\n+                    String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n+                    container.withCopyFileToContainer(MountableFile.forHostPath(recordedFile), recordFileContainerPath)\n+                            .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n+                            .withStartupTimeout( Duration.ofMinutes(1) )\n+                            .withCommand(\"-i\" , recordFileContainerPath, \"-f\" ,\"null\" ,\"-\" )\n+                            .start();\n+                    String ffmpegOutput = container.getLogs();", "originalCommit": "6249e3d50194cdda36892a812951a76afc652cee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NTk2NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r503655964", "bodyText": "done, thanks for your help", "author": "oussamabadr", "createdAt": "2020-10-13T04:10:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI1MjI0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "ae172f5255dc51c6aadad3f6a3f1b810b0470d79", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 38cdea3a..27dac6cd 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -81,7 +83,7 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n             ) {\n                 chrome.start();\n \n-                TimeUnit.SECONDS.sleep(5);\n+                TimeUnit.SECONDS.sleep(1);\n                 doSimpleExplore(chrome);\n                 chrome.afterTest(new TestDescription() {\n                     @Override\n"}}, {"oid": "ae172f5255dc51c6aadad3f6a3f1b810b0470d79", "url": "https://github.com/testcontainers/testcontainers-java/commit/ae172f5255dc51c6aadad3f6a3f1b810b0470d79", "message": "Fix test [recordingTestThatShouldHaveCorrectDuration] broken in CI", "committedDate": "2020-10-13T04:02:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNDU0NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r519614544", "bodyText": "Maybe this is my mistake from solving the merge conflict, but why is getVncDockerImageName() needed?\nCan't you use getVncRecordedContainerImage()? (which I admit, has probably a typo, the name is strange)", "author": "kiview", "createdAt": "2020-11-09T08:00:32Z", "path": "core/src/main/java/org/testcontainers/utility/TestcontainersConfiguration.java", "diffHunk": "@@ -105,6 +105,10 @@ public String getSocatContainerImage() {\n \n     @Deprecated\n     public String getVncRecordedContainerImage() {\n+        return getVncDockerImageName().asCanonicalNameString();\n+    }\n+\n+    public DockerImageName getVncDockerImageName() {", "originalCommit": "eb9a077456ec916e1093cd7d97860138f51c1934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNjU3Ng==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r523806576", "bodyText": "Done, thanks.", "author": "oussamabadr", "createdAt": "2020-11-15T20:06:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNDU0NA=="}], "type": "inlineReview", "revised_code": {"commit": "0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "chunk": "diff --git a/core/src/main/java/org/testcontainers/utility/TestcontainersConfiguration.java b/core/src/main/java/org/testcontainers/utility/TestcontainersConfiguration.java\nindex 8d9fd2e6..987301fb 100644\n--- a/core/src/main/java/org/testcontainers/utility/TestcontainersConfiguration.java\n+++ b/core/src/main/java/org/testcontainers/utility/TestcontainersConfiguration.java\n\n@@ -105,10 +105,6 @@ public class TestcontainersConfiguration {\n \n     @Deprecated\n     public String getVncRecordedContainerImage() {\n-        return getVncDockerImageName().asCanonicalNameString();\n-    }\n-\n-    public DockerImageName getVncDockerImageName() {\n         return getImage(VNC_RECORDER_IMAGE).asCanonicalNameString();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNjIzNg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r519616236", "bodyText": "You can remove those comments. They are our markers for generating code includes in the docs.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            // recordAll {\n          \n          \n            \n                            // To do this, simply add extra parameters to the rule constructor:", "author": "kiview", "createdAt": "2020-11-09T08:04:14Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -59,6 +68,55 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordAll {\n+                // To do this, simply add extra parameters to the rule constructor:", "originalCommit": "eb9a077456ec916e1093cd7d97860138f51c1934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNjU2Mw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r523806563", "bodyText": "Done, thanks.", "author": "oussamabadr", "createdAt": "2020-11-15T20:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNjIzNg=="}], "type": "inlineReview", "revised_code": {"commit": "0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 27dac6cd..5fa4cebf 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -72,9 +72,9 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n         @Test\n         public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n+            String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+\n             try (\n-                // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNjgwNw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r519616807", "bodyText": "Why sleep? Shouldn't we get a duration > 0 either way?", "author": "kiview", "createdAt": "2020-11-09T08:05:31Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -59,6 +68,55 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordAll {\n+                // To do this, simply add extra parameters to the rule constructor:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target)\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                chrome.start();\n+\n+                TimeUnit.SECONDS.sleep(1);", "originalCommit": "eb9a077456ec916e1093cd7d97860138f51c1934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNjU1Mw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r523806553", "bodyText": "Sometimes the test goes very fast and the record may have duration = 00:00:00.00, I reduced it to 500 milliseconds.", "author": "oussamabadr", "createdAt": "2020-11-15T20:05:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNjgwNw=="}], "type": "inlineReview", "revised_code": {"commit": "0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 27dac6cd..5fa4cebf 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -72,9 +72,9 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n         @Test\n         public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n+            String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+\n             try (\n-                // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxOTQ3Nw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r519619477", "bodyText": "Better to have a unique name here and also use this in the regex below (this was copied from the test above).", "author": "kiview", "createdAt": "2020-11-09T08:11:09Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -59,6 +68,55 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordAll {\n+                // To do this, simply add extra parameters to the rule constructor:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target)\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                chrome.start();\n+\n+                TimeUnit.SECONDS.sleep(1);\n+                doSimpleExplore(chrome);\n+                chrome.afterTest(new TestDescription() {\n+                    @Override\n+                    public String getTestId() {\n+                        return getFilesystemFriendlyName();\n+                    }\n+\n+                    @Override\n+                    public String getFilesystemFriendlyName() {\n+                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                    }\n+                }, Optional.empty());\n+\n+                String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";", "originalCommit": "eb9a077456ec916e1093cd7d97860138f51c1934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNjUxMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r523806512", "bodyText": "Done, thanks.", "author": "oussamabadr", "createdAt": "2020-11-15T20:05:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxOTQ3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 27dac6cd..5fa4cebf 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -72,9 +72,9 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n         @Test\n         public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n+            String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+\n             try (\n-                // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n"}}, {"oid": "0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "url": "https://github.com/testcontainers/testcontainers-java/commit/0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "message": "Refactoring", "committedDate": "2020-11-15T19:36:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA5OTI2Nw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r524099267", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            TimeUnit.MILLISECONDS.sleep(500);\n          \n          \n            \n                            TimeUnit.MILLISECONDS.sleep(500); // to make sure video will have a duration", "author": "kiview", "createdAt": "2020-11-16T10:38:21Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -59,6 +68,54 @@ public String getFilesystemFriendlyName() {\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+\n+            try (\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target)\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                chrome.start();\n+\n+                TimeUnit.MILLISECONDS.sleep(500);", "originalCommit": "0fdd4a064c8e7cedd9050d03013cbdb4d97849df", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 5fa4cebf..4327e192 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -49,71 +57,94 @@ public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContaine\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n                     .withNetwork(NETWORK)\n             ) {\n-                chrome.start();\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n \n-                doSimpleExplore(chrome);\n-                chrome.afterTest(new TestDescription() {\n-                    @Override\n-                    public String getTestId() {\n-                        return getFilesystemFriendlyName();\n-                    }\n+        private File[] runSimpleExploreInContainer(BrowserWebDriverContainer<?> container, String fileNamePattern) throws InterruptedException {\n+            container.start();\n \n-                    @Override\n-                    public String getFilesystemFriendlyName() {\n-                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n-                    }\n-                }, Optional.empty());\n+            TimeUnit.MILLISECONDS.sleep(MINIMUM_VIDEO_DURATION_MILLISECONDS);\n+            doSimpleExplore(container);\n+            container.afterTest(new TestDescription() {\n+                @Override\n+                public String getTestId() {\n+                    return getFilesystemFriendlyName();\n+                }\n+\n+                @Override\n+                public String getFilesystemFriendlyName() {\n+                    return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                }\n+            }, Optional.empty());\n \n-                String[] files = vncRecordingDirectory.getRoot().list(new PatternFilenameFilter(\"PASSED-.*\\\\.flv\"));\n+            return vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(fileNamePattern));\n+        }\n+\n+        @Test\n+        public void recordingTestShouldHaveFlvExtension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordAllFlv {\n+                // Define explicitly FLV format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.FLV)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n \n         @Test\n-        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+        public void recordingTestShouldHaveMp4Extension() throws InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n-            String flvFileTitle = \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n-\n             try (\n+                // recordAllMp4 {\n+                // Define MP4 format for recorded video:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n-                    .withRecordingMode(RECORD_ALL, target)\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.MP4)\n+                    // }\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n                     .withNetwork(NETWORK)\n             ) {\n-                chrome.start();\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.mp4\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n \n-                TimeUnit.MILLISECONDS.sleep(500);\n-                doSimpleExplore(chrome);\n-                chrome.afterTest(new TestDescription() {\n-                    @Override\n-                    public String getTestId() {\n-                        return getFilesystemFriendlyName();\n-                    }\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            MountableFile mountableFile;\n+            try (\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] recordedFiles = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                mountableFile = MountableFile.forHostPath(recordedFiles[0].getCanonicalPath());\n+            }\n \n-                    @Override\n-                    public String getFilesystemFriendlyName() {\n-                        return flvFileTitle;\n-                    }\n-                }, Optional.empty());\n-\n-                String flvFileNameRegEx = \"PASSED-\" + flvFileTitle + \".*\\\\.flv\";\n-                String recordedFile = vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(flvFileNameRegEx))[0].getCanonicalPath();\n-\n-                try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {\n-                    String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n-                    container.withCopyFileToContainer(MountableFile.forHostPath(recordedFile), recordFileContainerPath)\n-                            .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n-                            .withCommand(\"-i\" , recordFileContainerPath, \"-f\" ,\"null\" ,\"-\" )\n-                            .waitingFor( new LogMessageWaitStrategy()\n-                                                    .withRegEx(\".*Duration.*\")\n-                                                    .withStartupTimeout(Duration.of(60, SECONDS)) )\n-                            .start();\n-                    String ffmpegOutput = container.getLogs();\n-\n-                    assertTrue(\"Duration is incorrect in:\\n \" + ffmpegOutput,\n-                        ffmpegOutput.contains(\"Duration: 00:\") && !(ffmpegOutput.contains(\"Duration: 00:00:00.00\")));\n-                }\n+            try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {\n+                String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n+                container.withCopyFileToContainer(mountableFile, recordFileContainerPath)\n+                        .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n+                        .withCommand(\"-i\" , recordFileContainerPath, \"-f\" ,\"null\" ,\"-\" )\n+                        .waitingFor( new LogMessageWaitStrategy()\n+                                                .withRegEx(\".*Duration.*\")\n+                                                .withStartupTimeout(Duration.of(60, SECONDS)) )\n+                        .start();\n+                String ffmpegOutput = container.getLogs();\n+\n+                assertTrue(\"Duration is incorrect in:\\n \" + ffmpegOutput,\n+                    ffmpegOutput.contains(\"Duration: 00:\") && !(ffmpegOutput.contains(\"Duration: 00:00:00.00\")));\n             }\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM5NzEzMw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r524397133", "bodyText": "Since commenting doesn't seem to reopen the issue, I have to make a new one https://github.com/testcontainers/testcontainers-java/pull/3180/files#r524394794\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String newFlvOutput = \"/newScreen.flv\";\n          \n          \n            \n                    execInContainer(\"ffmpeg\" , \"-i\", RECORDING_FILE_NAME, \"-vcodec\", \"libx264\", newFlvOutput);\n          \n          \n            \n                    String newFlvOutput = \"/newScreen.mp4\";\n          \n          \n            \n                    execInContainer(\"ffmpeg\" , \"-i\", RECORDING_FILE_NAME, \"-vcodec\", \"libx264\", \"-movflags\", \"faststart\", newFlvOutput);", "author": "leonard84", "createdAt": "2020-11-16T16:25:54Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -87,19 +88,27 @@ protected void configure() {\n         );\n     }\n \n+    @SneakyThrows\n+    public void saveRecordingToFile(File file) {\n+        try(InputStream inputStream = streamRecording()) {\n+            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+        }\n+    }\n+\n     @SneakyThrows\n     public InputStream streamRecording() {\n+        reencodeRecording();\n+\n         TarArchiveInputStream archiveInputStream = new TarArchiveInputStream(\n                 dockerClient.copyArchiveFromContainerCmd(getContainerId(), RECORDING_FILE_NAME).exec()\n         );\n         archiveInputStream.getNextEntry();\n         return archiveInputStream;\n     }\n \n-    @SneakyThrows\n-    public void saveRecordingToFile(File file) {\n-        try(InputStream inputStream = streamRecording()) {\n-            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-        }\n+    private void reencodeRecording() throws IOException, InterruptedException {\n+        String newFlvOutput = \"/newScreen.flv\";\n+        execInContainer(\"ffmpeg\" , \"-i\", RECORDING_FILE_NAME, \"-vcodec\", \"libx264\", newFlvOutput);", "originalCommit": "46810984dd4bfe752be80529aeb261741076951a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex aff0ced7..9560472b 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -84,7 +93,7 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n"}}, {"oid": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "url": "https://github.com/testcontainers/testcontainers-java/commit/8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "message": "Add MP4 support for Recorded video + Make FLV default format (#512)", "committedDate": "2020-12-11T13:04:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk3MjEwNw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r540972107", "bodyText": "What about @NonNull for the parameters", "author": "leonard84", "createdAt": "2020-12-11T14:08:47Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -97,18 +106,44 @@ public void saveRecordingToFile(File file) {\n \n     @SneakyThrows\n     public InputStream streamRecording() {\n-        reencodeRecording();\n+        String newRecordingFileName = recordingFormat.reencodeRecording(this, ORIGINAL_RECORDING_FILE_NAME);\n \n         TarArchiveInputStream archiveInputStream = new TarArchiveInputStream(\n-                dockerClient.copyArchiveFromContainerCmd(getContainerId(), RECORDING_FILE_NAME).exec()\n+                dockerClient.copyArchiveFromContainerCmd(getContainerId(), newRecordingFileName).exec()\n         );\n         archiveInputStream.getNextEntry();\n         return archiveInputStream;\n     }\n \n-    private void reencodeRecording() throws IOException, InterruptedException {\n-        String newFlvOutput = \"/newScreen.flv\";\n-        execInContainer(\"ffmpeg\" , \"-i\", RECORDING_FILE_NAME, \"-vcodec\", \"libx264\", newFlvOutput);\n-        execInContainer(\"mv\" , \"-f\", newFlvOutput, RECORDING_FILE_NAME);\n+\n+    public enum VncRecordingFormat {\n+        FLV(\"flv\") {\n+            @Override\n+            String reencodeRecording(VncRecordingContainer container, String source) throws IOException, InterruptedException {", "originalCommit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTc0MDI3MQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r541740271", "bodyText": "Done, Thanks", "author": "oussamabadr", "createdAt": "2020-12-12T19:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk3MjEwNw=="}], "type": "inlineReview", "revised_code": {"commit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex 9560472b..192a5bcd 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -98,7 +98,7 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n     }\n \n     @SneakyThrows\n-    public void saveRecordingToFile(File file) {\n+    public void saveRecordingToFile(@NonNull File file) {\n         try(InputStream inputStream = streamRecording()) {\n             Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk3MzY4Mg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r540973682", "bodyText": "I would not break existing interfaces and update this method", "author": "leonard84", "createdAt": "2020-12-11T14:11:21Z", "path": "modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java", "diffHunk": "@@ -1,15 +1,16 @@\n package org.testcontainers.containers;\n \n import org.junit.runner.Description;\n+import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n \n import java.io.File;\n \n public interface RecordingFileFactory {\n \n     @Deprecated\n-    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded) {\n-        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded);\n+    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded, VncRecordingFormat recordingFormat) {", "originalCommit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTc0MDE5MA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r541740190", "bodyText": "Done, I canceled the changes.\nThanks", "author": "oussamabadr", "createdAt": "2020-12-12T19:15:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk3MzY4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "chunk": "diff --git a/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java b/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java\nindex 1277ec10..32912dde 100644\n--- a/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java\n+++ b/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java\n\n@@ -8,9 +8,14 @@ import java.io.File;\n public interface RecordingFileFactory {\n \n     @Deprecated\n-    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded, VncRecordingFormat recordingFormat) {\n-        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded, recordingFormat);\n+    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded) {\n+        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded);\n+    }\n+\n+    File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded);\n+\n+    default File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat) {\n+        return recordingFileForTest(vncRecordingDirectory, prefix, succeeded);\n     }\n \n-    File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat);\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4MDcxMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r540980712", "bodyText": "This breaks existing implementations, I'm not sure what the most elegant solution would be.\nThis would create a stackoverflow if you don't implement any of the new methods, but if you already have one that is using the three param recordingFileForTest it would work.\n@Deprecated\ndefault File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded) { \n    return recordingFileForTest(vncRecordingDirectory, prefix, boolean, null);\n}\n    default File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat) {\n    return recordingFileForTest(vncRecordingDirectory, prefix, boolean);\n}\nThe alternative would be to just return null from the three param default method, since our code would call the four param version. In any case we would need to add default methods so that users are not forced to implement an unused method.", "author": "leonard84", "createdAt": "2020-12-11T14:21:21Z", "path": "modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java", "diffHunk": "@@ -1,15 +1,16 @@\n package org.testcontainers.containers;\n \n import org.junit.runner.Description;\n+import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n \n import java.io.File;\n \n public interface RecordingFileFactory {\n \n     @Deprecated\n-    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded) {\n-        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded);\n+    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded, VncRecordingFormat recordingFormat) {\n+        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded, recordingFormat);\n     }\n \n-    File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded);\n+    File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat);", "originalCommit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTc0MDEzNA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r541740134", "bodyText": "Indeed, I used Default for the new method, so user can implement it only if mp4 is desired, or setting flv explicitly.\nI canceled the changes in the three params method, I didn't use Deprecated and I considered It as a legitimate method (recording with default format).\nThanks.", "author": "oussamabadr", "createdAt": "2020-12-12T19:15:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4MDcxMg=="}], "type": "inlineReview", "revised_code": {"commit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "chunk": "diff --git a/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java b/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java\nindex 1277ec10..32912dde 100644\n--- a/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java\n+++ b/modules/selenium/src/main/java/org/testcontainers/containers/RecordingFileFactory.java\n\n@@ -8,9 +8,14 @@ import java.io.File;\n public interface RecordingFileFactory {\n \n     @Deprecated\n-    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded, VncRecordingFormat recordingFormat) {\n-        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded, recordingFormat);\n+    default File recordingFileForTest(File vncRecordingDirectory, Description description, boolean succeeded) {\n+        return recordingFileForTest(vncRecordingDirectory, description.getTestClass().getSimpleName() + \"-\" + description.getMethodName(), succeeded);\n+    }\n+\n+    File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded);\n+\n+    default File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat) {\n+        return recordingFileForTest(vncRecordingDirectory, prefix, succeeded);\n     }\n \n-    File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat);\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4MTYzOQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r540981639", "bodyText": "Add @NonNull", "author": "leonard84", "createdAt": "2020-12-11T14:22:32Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -83,23 +93,57 @@ protected void configure() {\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n+    @SneakyThrows\n+    public void saveRecordingToFile(File file) {", "originalCommit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTczOTcyMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r541739722", "bodyText": "Done, Thanks", "author": "oussamabadr", "createdAt": "2020-12-12T19:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4MTYzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex 9560472b..192a5bcd 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -98,7 +98,7 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n     }\n \n     @SneakyThrows\n-    public void saveRecordingToFile(File file) {\n+    public void saveRecordingToFile(@NonNull File file) {\n         try(InputStream inputStream = streamRecording()) {\n             Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4MjMyNw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r540982327", "bodyText": "@NonNull should also be added where it applies", "author": "leonard84", "createdAt": "2020-12-11T14:23:34Z", "path": "modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java", "diffHunk": "@@ -358,8 +361,13 @@ public SELF withLinkToContainer(LinkableContainer otherContainer, String alias)\n     }\n \n     public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory) {\n+        return withRecordingMode(recordingMode, vncRecordingDirectory, null);\n+    }\n+\n+    public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, VncRecordingFormat recordingFormat) {", "originalCommit": "8b78a9ce4ea9a90661935e5db6d87aa26b858fe0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTczOTY4Ng==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r541739686", "bodyText": "I used @Nullable instead for recordingFormat.\nthanks.", "author": "oussamabadr", "createdAt": "2020-12-12T19:14:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4MjMyNw=="}], "type": "inlineReview", "revised_code": {"commit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "chunk": "diff --git a/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java b/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java\nindex 2c8d2c18..03807eef 100644\n--- a/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java\n+++ b/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java\n\n@@ -364,7 +364,7 @@ public class BrowserWebDriverContainer<SELF extends BrowserWebDriverContainer<SE\n         return withRecordingMode(recordingMode, vncRecordingDirectory, null);\n     }\n \n-    public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, VncRecordingFormat recordingFormat) {\n+    public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, @Nullable VncRecordingFormat recordingFormat) {\n         this.recordingMode = recordingMode;\n         this.vncRecordingDirectory = vncRecordingDirectory;\n         this.recordingFormat = recordingFormat;\n"}}, {"oid": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "url": "https://github.com/testcontainers/testcontainers-java/commit/3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "message": "Backward compatibility for default Recording format + Add Null check (#512)", "committedDate": "2021-01-29T00:15:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjEzMw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452133", "bodyText": "shouldn't it be withVideoFormat?", "author": "bsideup", "createdAt": "2021-02-06T16:03:18Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -71,6 +74,13 @@ public VncRecordingContainer withVncPort(int vncPort) {\n         return this;\n     }\n \n+    public VncRecordingContainer withVideoExtension(VncRecordingFormat recordingFormat) {", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzODc5OQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573538799", "bodyText": "Yes, I think it's a better name, Done.", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjEzMw=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex 192a5bcd..5176e315 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -74,13 +72,6 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n         return this;\n     }\n \n-    public VncRecordingContainer withVideoExtension(VncRecordingFormat recordingFormat) {\n-        if (recordingFormat != null) {\n-            this.recordingFormat = recordingFormat;\n-        }\n-        return this;\n-    }\n-\n     public VncRecordingContainer withFrameRate(int frameRate) {\n         this.frameRate = frameRate;\n         return this;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjE0Mw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452143", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    try(InputStream inputStream = streamRecording()) {\n          \n          \n            \n                    try (InputStream inputStream = streamRecording()) {", "author": "bsideup", "createdAt": "2021-02-06T16:03:28Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -83,23 +93,69 @@ protected void configure() {\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n+    @SneakyThrows\n+    public void saveRecordingToFile(@NonNull File file) {\n+        try(InputStream inputStream = streamRecording()) {", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzODg1OQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573538859", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjE0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex 192a5bcd..5176e315 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -93,12 +84,12 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n     @SneakyThrows\n-    public void saveRecordingToFile(@NonNull File file) {\n+    public void saveRecordingToFile(File file) {\n         try(InputStream inputStream = streamRecording()) {\n             Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjI1Mg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452252", "bodyText": "what's the purpose of this method?", "author": "bsideup", "createdAt": "2021-02-06T16:04:26Z", "path": "core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java", "diffHunk": "@@ -83,23 +93,69 @@ protected void configure() {\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n+    @SneakyThrows\n+    public void saveRecordingToFile(@NonNull File file) {\n+        try(InputStream inputStream = streamRecording()) {\n+            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+        }\n+    }\n+\n     @SneakyThrows\n     public InputStream streamRecording() {\n+        String newRecordingFileName = recordingFormat.reencodeRecording(this, ORIGINAL_RECORDING_FILE_NAME);\n+\n         TarArchiveInputStream archiveInputStream = new TarArchiveInputStream(\n-                dockerClient.copyArchiveFromContainerCmd(getContainerId(), RECORDING_FILE_NAME).exec()\n+                dockerClient.copyArchiveFromContainerCmd(getContainerId(), newRecordingFileName).exec()\n         );\n         archiveInputStream.getNextEntry();\n         return archiveInputStream;\n     }\n \n-    @SneakyThrows\n-    public void saveRecordingToFile(File file) {\n-        try(InputStream inputStream = streamRecording()) {\n-            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+\n+    public enum VncRecordingFormat {\n+        FLV(\"flv\") {\n+            @Override\n+            String reencodeRecording(@NonNull VncRecordingContainer container, @NonNull String source) throws IOException, InterruptedException {\n+                String newFileOutput = \"/newScreen.flv\";\n+                container.execInContainer(\"ffmpeg\" , \"-i\", source, \"-vcodec\", \"libx264\", newFileOutput);\n+                return newFileOutput;\n+            }\n+        },\n+        MP4(\"mp4\") {\n+            @Override\n+            String reencodeRecording(@NonNull VncRecordingContainer container, @NonNull String source) throws IOException, InterruptedException {\n+                String newFileOutput = \"/newScreen.mp4\";\n+                container.execInContainer(\"ffmpeg\" , \"-i\", source, \"-vcodec\", \"libx264\", \"-movflags\", \"faststart\", newFileOutput);\n+                return newFileOutput;\n+            }\n+        };\n+\n+        abstract String reencodeRecording(VncRecordingContainer container, String source) throws IOException, InterruptedException;\n+\n+        private static final VncRecordingFormat DEFAULT_FORMAT = FLV;\n+        private final String filenameExtension;\n+\n+        VncRecordingFormat(String filenameExtension) {\n+            this.filenameExtension = filenameExtension;\n+        }\n+\n+        public String getExtension() {\n+            return filenameExtension;\n+        }\n+\n+        /**\n+         * @return {@code vncRecordingFormat} value if not null, otherwise, {@link VncRecordingFormat#FLV} will be returned as a default format.\n+         */\n+        public static VncRecordingFormat of(VncRecordingFormat vncRecordingFormat) {", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTEyMQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539121", "bodyText": "Just in case of null, so It can fall back to the default format. Indeed I wasn't sure If it was necessary, but just in case, to prevent a possible NullPointerException.\nBut I get rid of it for now, thanks.", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjI1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\nindex 192a5bcd..5176e315 100644\n--- a/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n+++ b/core/src/main/java/org/testcontainers/containers/VncRecordingContainer.java\n\n@@ -93,12 +84,12 @@ public class VncRecordingContainer extends GenericContainer<VncRecordingContaine\n         setCommand(\n                 \"-c\",\n                 \"echo '\" + encodedPassword + \"' | base64 -d > /vnc_password && \" +\n-                        \"flvrec.py -o \" + ORIGINAL_RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n+                        \"flvrec.py -o \" + RECORDING_FILE_NAME + \" -d -r \" + frameRate + \" -P /vnc_password \" + targetNetworkAlias + \" \" + vncPort\n         );\n     }\n \n     @SneakyThrows\n-    public void saveRecordingToFile(@NonNull File file) {\n+    public void saveRecordingToFile(File file) {\n         try(InputStream inputStream = streamRecording()) {\n             Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjMyOA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452328", "bodyText": "Let's not make it Nullable:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, @Nullable VncRecordingFormat recordingFormat) {\n          \n          \n            \n                public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, VncRecordingFormat recordingFormat) {", "author": "bsideup", "createdAt": "2021-02-06T16:05:21Z", "path": "modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java", "diffHunk": "@@ -358,8 +361,13 @@ public SELF withLinkToContainer(LinkableContainer otherContainer, String alias)\n     }\n \n     public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory) {\n+        return withRecordingMode(recordingMode, vncRecordingDirectory, null);\n+    }\n+\n+    public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, @Nullable VncRecordingFormat recordingFormat) {", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTE1NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539154", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjMyOA=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java b/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java\nindex 03807eef..1ceaf67a 100644\n--- a/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java\n+++ b/modules/selenium/src/main/java/org/testcontainers/containers/BrowserWebDriverContainer.java\n\n@@ -361,13 +358,8 @@ public class BrowserWebDriverContainer<SELF extends BrowserWebDriverContainer<SE\n     }\n \n     public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory) {\n-        return withRecordingMode(recordingMode, vncRecordingDirectory, null);\n-    }\n-\n-    public SELF withRecordingMode(VncRecordingMode recordingMode, File vncRecordingDirectory, @Nullable VncRecordingFormat recordingFormat) {\n         this.recordingMode = recordingMode;\n         this.vncRecordingDirectory = vncRecordingDirectory;\n-        this.recordingFormat = recordingFormat;\n         return self();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjQyMw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452423", "bodyText": "Should not be null:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        VncRecordingFormat.of(recordingFormat).getExtension()\n          \n          \n            \n                        recordingFormat.getExtension()", "author": "bsideup", "createdAt": "2021-02-06T16:05:52Z", "path": "modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java", "diffHunk": "@@ -4,20 +4,29 @@\n import java.text.SimpleDateFormat;\n import java.util.Date;\n \n+import static org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n+\n public class DefaultRecordingFileFactory implements RecordingFileFactory {\n \n     private static final SimpleDateFormat filenameDateFormat = new SimpleDateFormat(\"YYYYMMdd-HHmmss\");\n     private static final String PASSED = \"PASSED\";\n     private static final String FAILED = \"FAILED\";\n-    private static final String FILENAME_FORMAT = \"%s-%s-%s.flv\";\n+    private static final String FILENAME_FORMAT = \"%s-%s-%s.%s\";\n+\n \n     @Override\n     public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded) {\n+        return recordingFileForTest(vncRecordingDirectory, prefix, succeeded, null);\n+    }\n+\n+    @Override\n+    public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat) {\n         final String resultMarker = succeeded ? PASSED : FAILED;\n         final String fileName = String.format(FILENAME_FORMAT,\n             resultMarker,\n             prefix,\n-            filenameDateFormat.format(new Date())\n+            filenameDateFormat.format(new Date()),\n+            VncRecordingFormat.of(recordingFormat).getExtension()", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTE4MQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539181", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjQyMw=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java b/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java\nindex c64ee71b..64e8bbe7 100644\n--- a/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java\n+++ b/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java\n\n@@ -4,29 +4,20 @@ import java.io.File;\n import java.text.SimpleDateFormat;\n import java.util.Date;\n \n-import static org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n-\n public class DefaultRecordingFileFactory implements RecordingFileFactory {\n \n     private static final SimpleDateFormat filenameDateFormat = new SimpleDateFormat(\"YYYYMMdd-HHmmss\");\n     private static final String PASSED = \"PASSED\";\n     private static final String FAILED = \"FAILED\";\n-    private static final String FILENAME_FORMAT = \"%s-%s-%s.%s\";\n-\n+    private static final String FILENAME_FORMAT = \"%s-%s-%s.flv\";\n \n     @Override\n     public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded) {\n-        return recordingFileForTest(vncRecordingDirectory, prefix, succeeded, null);\n-    }\n-\n-    @Override\n-    public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat) {\n         final String resultMarker = succeeded ? PASSED : FAILED;\n         final String fileName = String.format(FILENAME_FORMAT,\n             resultMarker,\n             prefix,\n-            filenameDateFormat.format(new Date()),\n-            VncRecordingFormat.of(recordingFormat).getExtension()\n+            filenameDateFormat.format(new Date())\n         );\n         return new File(vncRecordingDirectory, fileName);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjQ5NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452494", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return recordingFileForTest(vncRecordingDirectory, prefix, succeeded, null);\n          \n          \n            \n                    return recordingFileForTest(vncRecordingDirectory, prefix, succeeded, VncRecordingFormat.FLV);", "author": "bsideup", "createdAt": "2021-02-06T16:06:24Z", "path": "modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java", "diffHunk": "@@ -4,20 +4,29 @@\n import java.text.SimpleDateFormat;\n import java.util.Date;\n \n+import static org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n+\n public class DefaultRecordingFileFactory implements RecordingFileFactory {\n \n     private static final SimpleDateFormat filenameDateFormat = new SimpleDateFormat(\"YYYYMMdd-HHmmss\");\n     private static final String PASSED = \"PASSED\";\n     private static final String FAILED = \"FAILED\";\n-    private static final String FILENAME_FORMAT = \"%s-%s-%s.flv\";\n+    private static final String FILENAME_FORMAT = \"%s-%s-%s.%s\";\n+\n \n     @Override\n     public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded) {\n+        return recordingFileForTest(vncRecordingDirectory, prefix, succeeded, null);", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTIyNQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539225", "bodyText": "Done, but with a little difference, tell me if it's ok for you.", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjQ5NA=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java b/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java\nindex c64ee71b..64e8bbe7 100644\n--- a/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java\n+++ b/modules/selenium/src/main/java/org/testcontainers/containers/DefaultRecordingFileFactory.java\n\n@@ -4,29 +4,20 @@ import java.io.File;\n import java.text.SimpleDateFormat;\n import java.util.Date;\n \n-import static org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n-\n public class DefaultRecordingFileFactory implements RecordingFileFactory {\n \n     private static final SimpleDateFormat filenameDateFormat = new SimpleDateFormat(\"YYYYMMdd-HHmmss\");\n     private static final String PASSED = \"PASSED\";\n     private static final String FAILED = \"FAILED\";\n-    private static final String FILENAME_FORMAT = \"%s-%s-%s.%s\";\n-\n+    private static final String FILENAME_FORMAT = \"%s-%s-%s.flv\";\n \n     @Override\n     public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded) {\n-        return recordingFileForTest(vncRecordingDirectory, prefix, succeeded, null);\n-    }\n-\n-    @Override\n-    public File recordingFileForTest(File vncRecordingDirectory, String prefix, boolean succeeded, VncRecordingFormat recordingFormat) {\n         final String resultMarker = succeeded ? PASSED : FAILED;\n         final String fileName = String.format(FILENAME_FORMAT,\n             resultMarker,\n             prefix,\n-            filenameDateFormat.format(new Date()),\n-            VncRecordingFormat.of(recordingFormat).getExtension()\n+            filenameDateFormat.format(new Date())\n         );\n         return new File(vncRecordingDirectory, fileName);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjYzMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452632", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {\n          \n          \n            \n                        try (GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\"))) {", "author": "bsideup", "createdAt": "2021-02-06T16:07:33Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -10,55 +10,143 @@\n import org.openqa.selenium.chrome.ChromeOptions;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.VncRecordingContainer;\n+import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n+import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n+import org.testcontainers.utility.DockerImageName;\n+import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n+import java.io.IOException;\n+import java.time.Duration;\n import java.util.Optional;\n+import java.util.concurrent.TimeUnit;\n \n+import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_FAILING;\n \n @RunWith(Enclosed.class)\n public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContainerTest {\n \n+    /**\n+     * Guaranty a minimum video length for FFmpeg re-encoding.\n+     * @see VncRecordingFormat#reencodeRecording(VncRecordingContainer, String)\n+     */\n+    private static final int MINIMUM_VIDEO_DURATION_MILLISECONDS = 200;\n+\n     public static class ChromeThatRecordsAllTests {\n \n         @Rule\n         public TemporaryFolder vncRecordingDirectory = new TemporaryFolder();\n \n         @Test\n-        public void recordingTestThatShouldBeRecordedAndRetained() {\n+        public void recordingTestThatShouldBeRecordedAndRetainedInFlvFormatAsDefault() throws InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n             try (\n                 // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n+                // To do this, simply add extra parameters to the rule constructor, so video will default to FLV format:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n                     // }\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n                     .withNetwork(NETWORK)\n             ) {\n-                chrome.start();\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n \n-                doSimpleExplore(chrome);\n-                chrome.afterTest(new TestDescription() {\n-                    @Override\n-                    public String getTestId() {\n-                        return getFilesystemFriendlyName();\n-                    }\n+        private File[] runSimpleExploreInContainer(BrowserWebDriverContainer<?> container, String fileNamePattern) throws InterruptedException {\n+            container.start();\n \n-                    @Override\n-                    public String getFilesystemFriendlyName() {\n-                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n-                    }\n-                }, Optional.empty());\n+            TimeUnit.MILLISECONDS.sleep(MINIMUM_VIDEO_DURATION_MILLISECONDS);\n+            doSimpleExplore(container);\n+            container.afterTest(new TestDescription() {\n+                @Override\n+                public String getTestId() {\n+                    return getFilesystemFriendlyName();\n+                }\n+\n+                @Override\n+                public String getFilesystemFriendlyName() {\n+                    return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                }\n+            }, Optional.empty());\n+\n+            return vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(fileNamePattern));\n+        }\n \n-                String[] files = vncRecordingDirectory.getRoot().list(new PatternFilenameFilter(\"PASSED-.*\\\\.flv\"));\n+        @Test\n+        public void recordingTestShouldHaveFlvExtension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordFlv {\n+                // Set (explicitly) FLV format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.FLV)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestShouldHaveMp4Extension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordMp4 {\n+                // Set MP4 format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.MP4)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.mp4\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            MountableFile mountableFile;\n+            try (\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] recordedFiles = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                mountableFile = MountableFile.forHostPath(recordedFiles[0].getCanonicalPath());\n+            }\n+\n+            try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTI4MA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539280", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjYzMg=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 34fc714e..6148ad79 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -8,23 +8,18 @@ import org.junit.experimental.runners.Enclosed;\n import org.junit.rules.TemporaryFolder;\n import org.junit.runner.RunWith;\n import org.openqa.selenium.chrome.ChromeOptions;\n+import org.testcontainers.containers.BindMode;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n import org.testcontainers.containers.GenericContainer;\n-import org.testcontainers.containers.VncRecordingContainer;\n-import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n-import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n+import org.testcontainers.containers.output.ToStringConsumer;\n+import org.testcontainers.containers.startupcheck.OneShotStartupCheckStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n-import org.testcontainers.utility.DockerImageName;\n-import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n import java.io.IOException;\n-import java.time.Duration;\n import java.util.Optional;\n-import java.util.concurrent.TimeUnit;\n \n-import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjcxMA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452710", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .waitingFor( new LogMessageWaitStrategy()\n          \n          \n            \n                                    .waitingFor(new LogMessageWaitStrategy()", "author": "bsideup", "createdAt": "2021-02-06T16:08:01Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -10,55 +10,143 @@\n import org.openqa.selenium.chrome.ChromeOptions;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.VncRecordingContainer;\n+import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n+import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n+import org.testcontainers.utility.DockerImageName;\n+import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n+import java.io.IOException;\n+import java.time.Duration;\n import java.util.Optional;\n+import java.util.concurrent.TimeUnit;\n \n+import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_FAILING;\n \n @RunWith(Enclosed.class)\n public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContainerTest {\n \n+    /**\n+     * Guaranty a minimum video length for FFmpeg re-encoding.\n+     * @see VncRecordingFormat#reencodeRecording(VncRecordingContainer, String)\n+     */\n+    private static final int MINIMUM_VIDEO_DURATION_MILLISECONDS = 200;\n+\n     public static class ChromeThatRecordsAllTests {\n \n         @Rule\n         public TemporaryFolder vncRecordingDirectory = new TemporaryFolder();\n \n         @Test\n-        public void recordingTestThatShouldBeRecordedAndRetained() {\n+        public void recordingTestThatShouldBeRecordedAndRetainedInFlvFormatAsDefault() throws InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n             try (\n                 // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n+                // To do this, simply add extra parameters to the rule constructor, so video will default to FLV format:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n                     // }\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n                     .withNetwork(NETWORK)\n             ) {\n-                chrome.start();\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n \n-                doSimpleExplore(chrome);\n-                chrome.afterTest(new TestDescription() {\n-                    @Override\n-                    public String getTestId() {\n-                        return getFilesystemFriendlyName();\n-                    }\n+        private File[] runSimpleExploreInContainer(BrowserWebDriverContainer<?> container, String fileNamePattern) throws InterruptedException {\n+            container.start();\n \n-                    @Override\n-                    public String getFilesystemFriendlyName() {\n-                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n-                    }\n-                }, Optional.empty());\n+            TimeUnit.MILLISECONDS.sleep(MINIMUM_VIDEO_DURATION_MILLISECONDS);\n+            doSimpleExplore(container);\n+            container.afterTest(new TestDescription() {\n+                @Override\n+                public String getTestId() {\n+                    return getFilesystemFriendlyName();\n+                }\n+\n+                @Override\n+                public String getFilesystemFriendlyName() {\n+                    return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                }\n+            }, Optional.empty());\n+\n+            return vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(fileNamePattern));\n+        }\n \n-                String[] files = vncRecordingDirectory.getRoot().list(new PatternFilenameFilter(\"PASSED-.*\\\\.flv\"));\n+        @Test\n+        public void recordingTestShouldHaveFlvExtension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordFlv {\n+                // Set (explicitly) FLV format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.FLV)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestShouldHaveMp4Extension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordMp4 {\n+                // Set MP4 format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.MP4)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.mp4\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            MountableFile mountableFile;\n+            try (\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] recordedFiles = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                mountableFile = MountableFile.forHostPath(recordedFiles[0].getCanonicalPath());\n+            }\n+\n+            try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {\n+                String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n+                container.withCopyFileToContainer(mountableFile, recordFileContainerPath)\n+                        .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n+                        .withCommand(\"-i\" , recordFileContainerPath, \"-f\" ,\"null\" ,\"-\" )\n+                        .waitingFor( new LogMessageWaitStrategy()", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTMyMQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539321", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjcxMA=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 34fc714e..6148ad79 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -8,23 +8,18 @@ import org.junit.experimental.runners.Enclosed;\n import org.junit.rules.TemporaryFolder;\n import org.junit.runner.RunWith;\n import org.openqa.selenium.chrome.ChromeOptions;\n+import org.testcontainers.containers.BindMode;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n import org.testcontainers.containers.GenericContainer;\n-import org.testcontainers.containers.VncRecordingContainer;\n-import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n-import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n+import org.testcontainers.containers.output.ToStringConsumer;\n+import org.testcontainers.containers.startupcheck.OneShotStartupCheckStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n-import org.testcontainers.utility.DockerImageName;\n-import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n import java.io.IOException;\n-import java.time.Duration;\n import java.util.Optional;\n-import java.util.concurrent.TimeUnit;\n \n-import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjczMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452732", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .withCommand(\"-i\" , recordFileContainerPath, \"-f\" ,\"null\" ,\"-\" )\n          \n          \n            \n                                    .withCommand(\"-i\", recordFileContainerPath, \"-f\" ,\"null\" ,\"-\")", "author": "bsideup", "createdAt": "2021-02-06T16:08:08Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -10,55 +10,143 @@\n import org.openqa.selenium.chrome.ChromeOptions;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.VncRecordingContainer;\n+import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n+import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n+import org.testcontainers.utility.DockerImageName;\n+import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n+import java.io.IOException;\n+import java.time.Duration;\n import java.util.Optional;\n+import java.util.concurrent.TimeUnit;\n \n+import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_FAILING;\n \n @RunWith(Enclosed.class)\n public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContainerTest {\n \n+    /**\n+     * Guaranty a minimum video length for FFmpeg re-encoding.\n+     * @see VncRecordingFormat#reencodeRecording(VncRecordingContainer, String)\n+     */\n+    private static final int MINIMUM_VIDEO_DURATION_MILLISECONDS = 200;\n+\n     public static class ChromeThatRecordsAllTests {\n \n         @Rule\n         public TemporaryFolder vncRecordingDirectory = new TemporaryFolder();\n \n         @Test\n-        public void recordingTestThatShouldBeRecordedAndRetained() {\n+        public void recordingTestThatShouldBeRecordedAndRetainedInFlvFormatAsDefault() throws InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n             try (\n                 // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n+                // To do this, simply add extra parameters to the rule constructor, so video will default to FLV format:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n                     // }\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n                     .withNetwork(NETWORK)\n             ) {\n-                chrome.start();\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n \n-                doSimpleExplore(chrome);\n-                chrome.afterTest(new TestDescription() {\n-                    @Override\n-                    public String getTestId() {\n-                        return getFilesystemFriendlyName();\n-                    }\n+        private File[] runSimpleExploreInContainer(BrowserWebDriverContainer<?> container, String fileNamePattern) throws InterruptedException {\n+            container.start();\n \n-                    @Override\n-                    public String getFilesystemFriendlyName() {\n-                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n-                    }\n-                }, Optional.empty());\n+            TimeUnit.MILLISECONDS.sleep(MINIMUM_VIDEO_DURATION_MILLISECONDS);\n+            doSimpleExplore(container);\n+            container.afterTest(new TestDescription() {\n+                @Override\n+                public String getTestId() {\n+                    return getFilesystemFriendlyName();\n+                }\n+\n+                @Override\n+                public String getFilesystemFriendlyName() {\n+                    return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                }\n+            }, Optional.empty());\n+\n+            return vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(fileNamePattern));\n+        }\n \n-                String[] files = vncRecordingDirectory.getRoot().list(new PatternFilenameFilter(\"PASSED-.*\\\\.flv\"));\n+        @Test\n+        public void recordingTestShouldHaveFlvExtension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordFlv {\n+                // Set (explicitly) FLV format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.FLV)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestShouldHaveMp4Extension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordMp4 {\n+                // Set MP4 format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.MP4)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.mp4\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            MountableFile mountableFile;\n+            try (\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] recordedFiles = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                mountableFile = MountableFile.forHostPath(recordedFiles[0].getCanonicalPath());\n+            }\n+\n+            try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {\n+                String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n+                container.withCopyFileToContainer(mountableFile, recordFileContainerPath)\n+                        .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n+                        .withCommand(\"-i\" , recordFileContainerPath, \"-f\" ,\"null\" ,\"-\" )", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTM0OA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539348", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:39:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1MjczMg=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 34fc714e..6148ad79 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -8,23 +8,18 @@ import org.junit.experimental.runners.Enclosed;\n import org.junit.rules.TemporaryFolder;\n import org.junit.runner.RunWith;\n import org.openqa.selenium.chrome.ChromeOptions;\n+import org.testcontainers.containers.BindMode;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n import org.testcontainers.containers.GenericContainer;\n-import org.testcontainers.containers.VncRecordingContainer;\n-import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n-import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n+import org.testcontainers.containers.output.ToStringConsumer;\n+import org.testcontainers.containers.startupcheck.OneShotStartupCheckStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n-import org.testcontainers.utility.DockerImageName;\n-import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n import java.io.IOException;\n-import java.time.Duration;\n import java.util.Optional;\n-import java.util.concurrent.TimeUnit;\n \n-import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1Mjc2NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r571452764", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )\n          \n          \n            \n                                    .withCreateContainerCmdModifier(createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\"))", "author": "bsideup", "createdAt": "2021-02-06T16:08:25Z", "path": "modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "diffHunk": "@@ -10,55 +10,143 @@\n import org.openqa.selenium.chrome.ChromeOptions;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.VncRecordingContainer;\n+import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n+import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n+import org.testcontainers.utility.DockerImageName;\n+import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n+import java.io.IOException;\n+import java.time.Duration;\n import java.util.Optional;\n+import java.util.concurrent.TimeUnit;\n \n+import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_FAILING;\n \n @RunWith(Enclosed.class)\n public class ChromeRecordingWebDriverContainerTest extends BaseWebDriverContainerTest {\n \n+    /**\n+     * Guaranty a minimum video length for FFmpeg re-encoding.\n+     * @see VncRecordingFormat#reencodeRecording(VncRecordingContainer, String)\n+     */\n+    private static final int MINIMUM_VIDEO_DURATION_MILLISECONDS = 200;\n+\n     public static class ChromeThatRecordsAllTests {\n \n         @Rule\n         public TemporaryFolder vncRecordingDirectory = new TemporaryFolder();\n \n         @Test\n-        public void recordingTestThatShouldBeRecordedAndRetained() {\n+        public void recordingTestThatShouldBeRecordedAndRetainedInFlvFormatAsDefault() throws InterruptedException {\n             File target = vncRecordingDirectory.getRoot();\n             try (\n                 // recordAll {\n-                // To do this, simply add extra parameters to the rule constructor:\n+                // To do this, simply add extra parameters to the rule constructor, so video will default to FLV format:\n                 BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n                     .withCapabilities(new ChromeOptions())\n                     .withRecordingMode(RECORD_ALL, target)\n                     // }\n                     .withRecordingFileFactory(new DefaultRecordingFileFactory())\n                     .withNetwork(NETWORK)\n             ) {\n-                chrome.start();\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n \n-                doSimpleExplore(chrome);\n-                chrome.afterTest(new TestDescription() {\n-                    @Override\n-                    public String getTestId() {\n-                        return getFilesystemFriendlyName();\n-                    }\n+        private File[] runSimpleExploreInContainer(BrowserWebDriverContainer<?> container, String fileNamePattern) throws InterruptedException {\n+            container.start();\n \n-                    @Override\n-                    public String getFilesystemFriendlyName() {\n-                        return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n-                    }\n-                }, Optional.empty());\n+            TimeUnit.MILLISECONDS.sleep(MINIMUM_VIDEO_DURATION_MILLISECONDS);\n+            doSimpleExplore(container);\n+            container.afterTest(new TestDescription() {\n+                @Override\n+                public String getTestId() {\n+                    return getFilesystemFriendlyName();\n+                }\n+\n+                @Override\n+                public String getFilesystemFriendlyName() {\n+                    return \"ChromeThatRecordsAllTests-recordingTestThatShouldBeRecordedAndRetained\";\n+                }\n+            }, Optional.empty());\n+\n+            return vncRecordingDirectory.getRoot().listFiles(new PatternFilenameFilter(fileNamePattern));\n+        }\n \n-                String[] files = vncRecordingDirectory.getRoot().list(new PatternFilenameFilter(\"PASSED-.*\\\\.flv\"));\n+        @Test\n+        public void recordingTestShouldHaveFlvExtension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordFlv {\n+                // Set (explicitly) FLV format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.FLV)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n                 assertEquals(\"Recorded file not found\", 1, files.length);\n             }\n         }\n+\n+        @Test\n+        public void recordingTestShouldHaveMp4Extension() throws InterruptedException {\n+            File target = vncRecordingDirectory.getRoot();\n+            try (\n+                // recordMp4 {\n+                // Set MP4 format for recorded video:\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, target, VncRecordingFormat.MP4)\n+                    // }\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] files = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.mp4\");\n+                assertEquals(\"Recorded file not found\", 1, files.length);\n+            }\n+        }\n+\n+        @Test\n+        public void recordingTestThatShouldHaveCorrectDuration() throws IOException, InterruptedException {\n+            MountableFile mountableFile;\n+            try (\n+                BrowserWebDriverContainer<?> chrome = new BrowserWebDriverContainer<>()\n+                    .withCapabilities(new ChromeOptions())\n+                    .withRecordingMode(RECORD_ALL, vncRecordingDirectory.getRoot())\n+                    .withRecordingFileFactory(new DefaultRecordingFileFactory())\n+                    .withNetwork(NETWORK)\n+            ) {\n+                File[] recordedFiles = runSimpleExploreInContainer(chrome, \"PASSED-.*\\\\.flv\");\n+                mountableFile = MountableFile.forHostPath(recordedFiles[0].getCanonicalPath());\n+            }\n+\n+            try( GenericContainer<?> container = new GenericContainer<>(DockerImageName.parse(\"testcontainers/vnc-recorder:1.2.0\")) ) {\n+                String recordFileContainerPath = \"/tmp/chromeTestRecord.flv\";\n+                container.withCopyFileToContainer(mountableFile, recordFileContainerPath)\n+                        .withCreateContainerCmdModifier( createContainerCmd -> createContainerCmd.withEntrypoint(\"ffmpeg\") )", "originalCommit": "3757cfd8b3e46b879deb35c8f8d1ae8c6f14498b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzOTQxNQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3180#discussion_r573539415", "bodyText": "Done", "author": "oussamabadr", "createdAt": "2021-02-10T08:40:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1Mjc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "chunk": "diff --git a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\nindex 34fc714e..6148ad79 100644\n--- a/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n+++ b/modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java\n\n@@ -8,23 +8,18 @@ import org.junit.experimental.runners.Enclosed;\n import org.junit.rules.TemporaryFolder;\n import org.junit.runner.RunWith;\n import org.openqa.selenium.chrome.ChromeOptions;\n+import org.testcontainers.containers.BindMode;\n import org.testcontainers.containers.BrowserWebDriverContainer;\n import org.testcontainers.containers.DefaultRecordingFileFactory;\n import org.testcontainers.containers.GenericContainer;\n-import org.testcontainers.containers.VncRecordingContainer;\n-import org.testcontainers.containers.VncRecordingContainer.VncRecordingFormat;\n-import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n+import org.testcontainers.containers.output.ToStringConsumer;\n+import org.testcontainers.containers.startupcheck.OneShotStartupCheckStrategy;\n import org.testcontainers.lifecycle.TestDescription;\n-import org.testcontainers.utility.DockerImageName;\n-import org.testcontainers.utility.MountableFile;\n \n import java.io.File;\n import java.io.IOException;\n-import java.time.Duration;\n import java.util.Optional;\n-import java.util.concurrent.TimeUnit;\n \n-import static java.time.temporal.ChronoUnit.SECONDS;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n import static org.testcontainers.containers.BrowserWebDriverContainer.VncRecordingMode.RECORD_ALL;\n"}}, {"oid": "a1942be72eb3590ba31d762eaa49ef399c7cebfb", "url": "https://github.com/testcontainers/testcontainers-java/commit/a1942be72eb3590ba31d762eaa49ef399c7cebfb", "message": "Make recorder .flv videos scrollable (#512)", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "839b3eeec4056ded7e1b123618779e6b651c7d68", "url": "https://github.com/testcontainers/testcontainers-java/commit/839b3eeec4056ded7e1b123618779e6b651c7d68", "message": "Remove third party container + Refactoring (#512)", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "16453c2fd9449c64bb3fff029c8fb1ef4e502821", "url": "https://github.com/testcontainers/testcontainers-java/commit/16453c2fd9449c64bb3fff029c8fb1ef4e502821", "message": "Fixing test after merge with master", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "de2f51a6450d1337c3a91a76053f07bddb4f1abe", "url": "https://github.com/testcontainers/testcontainers-java/commit/de2f51a6450d1337c3a91a76053f07bddb4f1abe", "message": "Fix test [recordingTestThatShouldHaveCorrectDuration] broken in CI", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "9c384de31767ae2bbaae70648cc6ce83c60fe7d5", "url": "https://github.com/testcontainers/testcontainers-java/commit/9c384de31767ae2bbaae70648cc6ce83c60fe7d5", "message": "Refactoring", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "6382c0b800b990f1a6db6255f1ba4bea80fb4cb8", "url": "https://github.com/testcontainers/testcontainers-java/commit/6382c0b800b990f1a6db6255f1ba4bea80fb4cb8", "message": "Update modules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "997d34a137bd5e7f857ccf9b6267d26e665d4320", "url": "https://github.com/testcontainers/testcontainers-java/commit/997d34a137bd5e7f857ccf9b6267d26e665d4320", "message": "Add MP4 support for Recorded video + Make FLV default format (#512)", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "e093058765e6958ee24ef8db96be3e191312b852", "url": "https://github.com/testcontainers/testcontainers-java/commit/e093058765e6958ee24ef8db96be3e191312b852", "message": "Backward compatibility for default Recording format + Add Null check (#512)", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "01554f0c6ecce8b73484a51acff6056b4e0f599e", "url": "https://github.com/testcontainers/testcontainers-java/commit/01554f0c6ecce8b73484a51acff6056b4e0f599e", "message": "Correct code format + Make video format non nullable (#512)", "committedDate": "2021-02-10T08:38:08Z", "type": "commit"}, {"oid": "01554f0c6ecce8b73484a51acff6056b4e0f599e", "url": "https://github.com/testcontainers/testcontainers-java/commit/01554f0c6ecce8b73484a51acff6056b4e0f599e", "message": "Correct code format + Make video format non nullable (#512)", "committedDate": "2021-02-10T08:38:08Z", "type": "forcePushed"}, {"oid": "9ccebb761894dc420f87978f379d421991bf587f", "url": "https://github.com/testcontainers/testcontainers-java/commit/9ccebb761894dc420f87978f379d421991bf587f", "message": "cleanups", "committedDate": "2021-02-10T09:43:43Z", "type": "commit"}]}