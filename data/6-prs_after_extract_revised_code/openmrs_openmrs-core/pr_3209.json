{"pr_number": 3209, "pr_title": "TRUNK-5740 | Initialize lazy properties while caching for True,False and unknown concepts.", "pr_createdAt": "2020-05-20T04:27:19Z", "pr_url": "https://github.com/openmrs/openmrs-core/pull/3209", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNDIyMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3209#discussion_r427834220", "bodyText": "You can get the lazily loaded property from Concept.hbm.xml", "author": "dkayiwa", "createdAt": "2020-05-20T08:33:04Z", "path": "api/src/main/java/org/openmrs/api/impl/ConceptServiceImpl.java", "diffHunk": "@@ -1225,15 +1229,30 @@ private void setBooleanConcepts() {\n \t\t\ttrueConcept = Context.getConceptService().getConcept(\n \t\t\t    Integer.parseInt(Context.getAdministrationService().getGlobalProperty(\n \t\t\t        OpenmrsConstants.GLOBAL_PROPERTY_TRUE_CONCEPT)));\n+\t\t\tinitializeLazyPropertiesForConcept(trueConcept);\n+\t\t\t\n \t\t\tfalseConcept = Context.getConceptService().getConcept(\n \t\t\t    Integer.parseInt(Context.getAdministrationService().getGlobalProperty(\n \t\t\t        OpenmrsConstants.GLOBAL_PROPERTY_FALSE_CONCEPT)));\n+\t\t\tinitializeLazyPropertiesForConcept(falseConcept);\n \t\t}\n \t\tcatch (NumberFormatException e) {\n \t\t\tlog.warn(\"Concept ids for boolean concepts should be numbers\");\n \t\t}\n \t}\n-\t\n+\n+\tprivate void initializeLazyPropertiesForConcept(Concept concept) {\n+\t\tHibernate.initialize(concept.getRetiredBy());\n+\t\tHibernate.initialize(concept.getCreator());\n+\t\tHibernate.initialize(concept.getChangedBy());", "originalCommit": "00c7650a39e33a9cd0dba55541aafe51ea153f0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg3OTUzMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3209#discussion_r427879533", "bodyText": "I see in concept.hbm.xml, Creator, ChangedBy and RetiredBy are not marked as lazy=true. However these were throwing the LazyInitException.\nPlease have a look at the screenshot.", "author": "mddubey", "createdAt": "2020-05-20T09:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNDIyMA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNzA5Mw==", "url": "https://github.com/openmrs/openmrs-core/pull/3209#discussion_r427837093", "bodyText": "Do you think there is any value in the original code, of setting the unknown concept via a new static method, instead of doing it just the same way as for the true and false concepts?", "author": "dkayiwa", "createdAt": "2020-05-20T08:37:28Z", "path": "api/src/main/java/org/openmrs/api/impl/ConceptServiceImpl.java", "diffHunk": "@@ -1195,9 +1196,12 @@ public Concept getTrueConcept() {\n \tpublic Concept getUnknownConcept() {\n \t\tif (unknownConcept == null) {\n \t\t\ttry {\n-\t\t\t\tConceptServiceImpl.setStaticUnknownConcept(Context.getConceptService().getConcept(\n-\t\t\t\t    Integer.parseInt(Context.getAdministrationService().getGlobalProperty(\n-\t\t\t\t        OpenmrsConstants.GLOBAL_PROPERTY_UNKNOWN_CONCEPT))));\n+\t\t\t\tConcept unknownConcept = Context.getConceptService().getConcept(\n+\t\t\t\t\tInteger.parseInt(Context.getAdministrationService().getGlobalProperty(\n+\t\t\t\t\t\tOpenmrsConstants.GLOBAL_PROPERTY_UNKNOWN_CONCEPT)));\n+\t\t\t\tinitializeLazyPropertiesForConcept(unknownConcept);\n+\t\t\t\t", "originalCommit": "00c7650a39e33a9cd0dba55541aafe51ea153f0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MjI1Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3209#discussion_r427882252", "bodyText": "I feel it would be better to do in the same way as the true and false concepts are done. However I don't know intention of creating a private stating method in the first time itself.\nI can make this change if needed.", "author": "mddubey", "createdAt": "2020-05-20T09:48:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNzA5Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a3e64754660037f5c21e12f39acb82829a80a892", "url": "https://github.com/openmrs/openmrs-core/commit/a3e64754660037f5c21e12f39acb82829a80a892", "message": "TFS-5740 | Initilize lazy propeties while caching for True,False and unknown concepts", "committedDate": "2020-05-20T12:50:31Z", "type": "commit"}, {"oid": "a3e64754660037f5c21e12f39acb82829a80a892", "url": "https://github.com/openmrs/openmrs-core/commit/a3e64754660037f5c21e12f39acb82829a80a892", "message": "TFS-5740 | Initilize lazy propeties while caching for True,False and unknown concepts", "committedDate": "2020-05-20T12:50:31Z", "type": "forcePushed"}]}