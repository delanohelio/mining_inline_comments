{"pr_number": 8798, "pr_title": "Custom downloads", "pr_createdAt": "2020-04-15T07:50:44Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8798", "timeline": [{"oid": "21bcfd5c538114c0c94c89f085086d006a5ec1d2", "url": "https://github.com/osmandapp/OsmAnd/commit/21bcfd5c538114c0c94c89f085086d006a5ec1d2", "message": "Read suggested downloads", "committedDate": "2020-04-09T13:19:14Z", "type": "commit"}, {"oid": "e1f56f6915c2a7433b45d996b7c960d95cf920c7", "url": "https://github.com/osmandapp/OsmAnd/commit/e1f56f6915c2a7433b45d996b7c960d95cf920c7", "message": "Suggested downloads initial commit", "committedDate": "2020-04-09T14:24:36Z", "type": "commit"}, {"oid": "70c907c010c61b42a7bc39cf1c65c65b549c6aab", "url": "https://github.com/osmandapp/OsmAnd/commit/70c907c010c61b42a7bc39cf1c65c65b549c6aab", "message": "Remove unnecessary changes", "committedDate": "2020-04-09T14:25:30Z", "type": "commit"}, {"oid": "5de11ab32b6d28a5c48b7dae08d9cf6f8093f209", "url": "https://github.com/osmandapp/OsmAnd/commit/5de11ab32b6d28a5c48b7dae08d9cf6f8093f209", "message": "Add custom downloads to settings helper", "committedDate": "2020-04-10T16:24:46Z", "type": "commit"}, {"oid": "44a4b93df17a531cd28e3a7e71ea3f895e89532d", "url": "https://github.com/osmandapp/OsmAnd/commit/44a4b93df17a531cd28e3a7e71ea3f895e89532d", "message": "Add downloads to ui initial commit", "committedDate": "2020-04-14T13:23:09Z", "type": "commit"}, {"oid": "ac60edda8dc054ef443a4f8273052500cb31cd9c", "url": "https://github.com/osmandapp/OsmAnd/commit/ac60edda8dc054ef443a4f8273052500cb31cd9c", "message": "Add gpx download type", "committedDate": "2020-04-14T20:49:09Z", "type": "commit"}, {"oid": "946c22adfcb638f54d4a6c491e0648265682f436", "url": "https://github.com/osmandapp/OsmAnd/commit/946c22adfcb638f54d4a6c491e0648265682f436", "message": "Add subfolder to target file", "committedDate": "2020-04-15T10:59:50Z", "type": "commit"}, {"oid": "4ca1925ac5c4fcbbe9b688301f5ab564a88d19d4", "url": "https://github.com/osmandapp/OsmAnd/commit/4ca1925ac5c4fcbbe9b688301f5ab564a88d19d4", "message": "Merge branch 'master' of https://github.com/osmandapp/Osmand into custom_downloads\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-04-16T15:10:19Z", "type": "commit"}, {"oid": "043e24b8a3e51218ad949d70b34aa9e8fe4b8315", "url": "https://github.com/osmandapp/OsmAnd/commit/043e24b8a3e51218ad949d70b34aa9e8fe4b8315", "message": "Add custom sqlite downloads", "committedDate": "2020-04-16T16:08:16Z", "type": "commit"}, {"oid": "2b1eef31806f69388706fb56504e964769970a51", "url": "https://github.com/osmandapp/OsmAnd/commit/2b1eef31806f69388706fb56504e964769970a51", "message": "Add localized names to custom index item", "committedDate": "2020-04-16T16:40:40Z", "type": "commit"}, {"oid": "d513237a6677bb8ea837a38208c183185eda4ef9", "url": "https://github.com/osmandapp/OsmAnd/commit/d513237a6677bb8ea837a38208c183185eda4ef9", "message": "Fix possible npe", "committedDate": "2020-04-16T16:52:18Z", "type": "commit"}, {"oid": "2d13917570365645d97c05cad82ed54961164953", "url": "https://github.com/osmandapp/OsmAnd/commit/2d13917570365645d97c05cad82ed54961164953", "message": "Save custom downloads", "committedDate": "2020-04-17T11:51:14Z", "type": "commit"}, {"oid": "38d84faa9540d300ac644f725465e306d78ec09d", "url": "https://github.com/osmandapp/OsmAnd/commit/38d84faa9540d300ac644f725465e306d78ec09d", "message": "Custom downloads UI initial commit", "committedDate": "2020-04-17T16:12:14Z", "type": "commit"}, {"oid": "2967b8f1407cd3c125766c70c2263cf6dff0fa7b", "url": "https://github.com/osmandapp/OsmAnd/commit/2967b8f1407cd3c125766c70c2263cf6dff0fa7b", "message": "Merge branch 'master' of https://github.com/osmandapp/Osmand into custom_downloads\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml\n#\tOsmAnd/src/net/osmand/plus/settings/ConfigureMenuItemsFragment.java", "committedDate": "2020-04-20T14:12:05Z", "type": "commit"}, {"oid": "bc15dcb8b1f3c0ce0f3405c4aa3bdf3244a4d77d", "url": "https://github.com/osmandapp/OsmAnd/commit/bc15dcb8b1f3c0ce0f3405c4aa3bdf3244a4d77d", "message": "Refactor custom downloads first part", "committedDate": "2020-04-20T19:40:46Z", "type": "commit"}, {"oid": "bc5dbc127089220a0dff44f8cc78652cabfe5d03", "url": "https://github.com/osmandapp/OsmAnd/commit/bc5dbc127089220a0dff44f8cc78652cabfe5d03", "message": "Fix plugin icons", "committedDate": "2020-04-21T10:30:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2OTUzNQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8798#discussion_r412069535", "bodyText": "?", "author": "max-klaus", "createdAt": "2020-04-21T10:34:15Z", "path": "OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java", "diffHunk": "@@ -398,33 +415,120 @@ public void loadResources() {\n \t\t}\n \t}\n \n-\tprivate Drawable getIconForFile(String path, Map<String, String> fileNames) {\n-\t\tfor (Map.Entry<String, String> entry : fileNames.entrySet()) {\n-\t\t\tString value = entry.getValue();\n-\t\t\tif (value.startsWith(\"@\")) {\n-\t\t\t\tvalue = value.substring(1);\n+\tpublic void updateSuggestedDownloads(List<SuggestedDownloadItem> items) {\n+\t\tsuggestedDownloadItems = new ArrayList<>(items);\n+\t}\n+\n+\tpublic void updateDownloadItems(List<WorldRegion> items) {\n+\t\tcustomRegions = new ArrayList<>(items);\n+\t}\n+\n+\tprivate List<IndexItem> getMapsForType(LatLon latLon, DownloadActivityType type) {\n+\t\ttry {\n+\t\t\treturn DownloadResources.findIndexItemsAt(app, latLon, type);\n+\t\t} catch (IOException e) {\n+\t\t\te.printStackTrace();", "originalCommit": "bc5dbc127089220a0dff44f8cc78652cabfe5d03", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0e63df108023f059e834f31ba207ea8cf21c5e15", "chunk": "diff --git a/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java b/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java\nindex 65a40a4bec..3d6fb4b321 100644\n--- a/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java\n+++ b/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java\n\n@@ -427,7 +426,7 @@ public class CustomOsmandPlugin extends OsmandPlugin {\n \t\ttry {\n \t\t\treturn DownloadResources.findIndexItemsAt(app, latLon, type);\n \t\t} catch (IOException e) {\n-\t\t\te.printStackTrace();\n+\t\t\tLOG.error(e);\n \t\t}\n \t\treturn Collections.emptyList();\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NDMzOQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8798#discussion_r412074339", "bodyText": "getLocalizedResFromMap, jsonArrayToList, getLocalizedMapFromJson, writeStringListToJson, writeLocalizedMapToJson and similar should be moved to external class like JsonUtils", "author": "max-klaus", "createdAt": "2020-04-21T10:42:03Z", "path": "OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java", "diffHunk": "@@ -398,33 +415,120 @@ public void loadResources() {\n \t\t}\n \t}\n \n-\tprivate Drawable getIconForFile(String path, Map<String, String> fileNames) {\n-\t\tfor (Map.Entry<String, String> entry : fileNames.entrySet()) {\n-\t\t\tString value = entry.getValue();\n-\t\t\tif (value.startsWith(\"@\")) {\n-\t\t\t\tvalue = value.substring(1);\n+\tpublic void updateSuggestedDownloads(List<SuggestedDownloadItem> items) {\n+\t\tsuggestedDownloadItems = new ArrayList<>(items);\n+\t}\n+\n+\tpublic void updateDownloadItems(List<WorldRegion> items) {\n+\t\tcustomRegions = new ArrayList<>(items);\n+\t}\n+\n+\tprivate List<IndexItem> getMapsForType(LatLon latLon, DownloadActivityType type) {\n+\t\ttry {\n+\t\t\treturn DownloadResources.findIndexItemsAt(app, latLon, type);\n+\t\t} catch (IOException e) {\n+\t\t\te.printStackTrace();\n+\t\t}\n+\t\treturn Collections.emptyList();\n+\t}\n+\n+\tprivate List<IndexItem> getMapsForType(List<String> names, DownloadActivityType type, int limit) {\n+\t\treturn DownloadResources.findIndexItemsAt(app, names, type, false, limit);\n+\t}\n+\n+\tpublic static String getLocalizedResFromMap(Context ctx, Map<String, String> localizedMap, String defVal) {", "originalCommit": "bc5dbc127089220a0dff44f8cc78652cabfe5d03", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0e63df108023f059e834f31ba207ea8cf21c5e15", "chunk": "diff --git a/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java b/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java\nindex 65a40a4bec..3d6fb4b321 100644\n--- a/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java\n+++ b/OsmAnd/src/net/osmand/plus/CustomOsmandPlugin.java\n\n@@ -427,7 +426,7 @@ public class CustomOsmandPlugin extends OsmandPlugin {\n \t\ttry {\n \t\t\treturn DownloadResources.findIndexItemsAt(app, latLon, type);\n \t\t} catch (IOException e) {\n-\t\t\te.printStackTrace();\n+\t\t\tLOG.error(e);\n \t\t}\n \t\treturn Collections.emptyList();\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NzE1OA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8798#discussion_r412077158", "bodyText": "gpx?", "author": "max-klaus", "createdAt": "2020-04-21T10:46:39Z", "path": "OsmAnd/src/net/osmand/plus/download/DownloadActivityType.java", "diffHunk": "@@ -136,6 +141,10 @@ public boolean isAccepted(String fileName) {\n \t\t\treturn fileName.endsWith(IndexConstants.SQLITE_EXT);\n \t\t} else if (DEPTH_CONTOUR_FILE == this) {\n \t\t\treturn fileName.endsWith(addVersionToExt(IndexConstants.BINARY_MAP_INDEX_EXT_ZIP, IndexConstants.BINARY_MAP_VERSION));\n+\t\t} else if (GPX_FILE == this) {\n+\t\t\treturn fileName.endsWith(IndexConstants.GPX_FILE_EXT);\n+\t\t} else if (SQLITE_FILE == this) {\n+\t\t\treturn fileName.endsWith(IndexConstants.GPX_FILE_EXT);", "originalCommit": "bc5dbc127089220a0dff44f8cc78652cabfe5d03", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0e63df108023f059e834f31ba207ea8cf21c5e15", "chunk": "diff --git a/OsmAnd/src/net/osmand/plus/download/DownloadActivityType.java b/OsmAnd/src/net/osmand/plus/download/DownloadActivityType.java\nindex 7bde53b277..b5671e89c8 100644\n--- a/OsmAnd/src/net/osmand/plus/download/DownloadActivityType.java\n+++ b/OsmAnd/src/net/osmand/plus/download/DownloadActivityType.java\n\n@@ -144,7 +144,7 @@ public class DownloadActivityType {\n \t\t} else if (GPX_FILE == this) {\n \t\t\treturn fileName.endsWith(IndexConstants.GPX_FILE_EXT);\n \t\t} else if (SQLITE_FILE == this) {\n-\t\t\treturn fileName.endsWith(IndexConstants.GPX_FILE_EXT);\n+\t\t\treturn fileName.endsWith(IndexConstants.SQLITE_EXT);\n \t\t}\n \t\treturn false;\n \t}\n"}}, {"oid": "0e63df108023f059e834f31ba207ea8cf21c5e15", "url": "https://github.com/osmandapp/OsmAnd/commit/0e63df108023f059e834f31ba207ea8cf21c5e15", "message": "Create JsonUtils and remove duplicate gpx constant", "committedDate": "2020-04-21T11:16:28Z", "type": "commit"}]}