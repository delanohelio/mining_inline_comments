{"pr_number": 9019, "pr_title": "Fix ConcurrentModificationException", "pr_createdAt": "2020-05-20T09:26:16Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/9019", "timeline": [{"oid": "43ba5d203f2ad210a35614d46576384b8549b689", "url": "https://github.com/osmandapp/OsmAnd/commit/43ba5d203f2ad210a35614d46576384b8549b689", "message": "Fix ConcurrentModificationException", "committedDate": "2020-05-20T09:15:07Z", "type": "commit"}, {"oid": "49d346771cb8f824f32014da5a9cb3a4815761f7", "url": "https://github.com/osmandapp/OsmAnd/commit/49d346771cb8f824f32014da5a9cb3a4815761f7", "message": "Fix ConcurrentModificationException", "committedDate": "2020-05-20T09:33:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkxNDg3MQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9019#discussion_r427914871", "bodyText": "Why do we copy each iteration?", "author": "vshcherb", "createdAt": "2020-05-20T10:47:25Z", "path": "OsmAnd-java/src/main/java/net/osmand/osm/MapPoiTypes.java", "diffHunk": "@@ -375,7 +380,7 @@ public void initFromInputStream(InputStream is) {\n \t\t\t\t\t\t\tlastCategory.addExcludedPoiAdditionalCategories(parser.getAttributeValue(\"\", \"excluded_poi_additional_category\").split(\",\"));\n \t\t\t\t\t\t\tlastCategoryPoiAdditionalsCategories.removeAll(lastCategory.getExcludedPoiAdditionalCategories());\n \t\t\t\t\t\t}\n-\t\t\t\t\t\tcategories.add(lastCategory);", "originalCommit": "49d346771cb8f824f32014da5a9cb3a4815761f7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0b5db53bc569b3b4a6cd09ef84c74a3dcc9b0d19", "chunk": "diff --git a/OsmAnd-java/src/main/java/net/osmand/osm/MapPoiTypes.java b/OsmAnd-java/src/main/java/net/osmand/osm/MapPoiTypes.java\nindex c56b20ce2f..e080828f3e 100644\n--- a/OsmAnd-java/src/main/java/net/osmand/osm/MapPoiTypes.java\n+++ b/OsmAnd-java/src/main/java/net/osmand/osm/MapPoiTypes.java\n\n@@ -380,7 +381,7 @@ public class MapPoiTypes {\n \t\t\t\t\t\t\tlastCategory.addExcludedPoiAdditionalCategories(parser.getAttributeValue(\"\", \"excluded_poi_additional_category\").split(\",\"));\n \t\t\t\t\t\t\tlastCategoryPoiAdditionalsCategories.removeAll(lastCategory.getExcludedPoiAdditionalCategories());\n \t\t\t\t\t\t}\n-\t\t\t\t\t\taddCategory(lastCategory);\n+\t\t\t\t\t\tcategoriesCopy.add(lastCategory);\n \t\t\t\t\t} else if (name.equals(\"poi_filter\")) {\n \t\t\t\t\t\tPoiFilter tp = new PoiFilter(this, lastCategory, parser.getAttributeValue(\"\", \"name\"));\n \t\t\t\t\t\ttp.setTopVisible(Boolean.parseBoolean(parser.getAttributeValue(\"\", \"top\")));\n"}}, {"oid": "0b5db53bc569b3b4a6cd09ef84c74a3dcc9b0d19", "url": "https://github.com/osmandapp/OsmAnd/commit/0b5db53bc569b3b4a6cd09ef84c74a3dcc9b0d19", "message": "Fix ConcurrentModificationException", "committedDate": "2020-05-20T11:01:14Z", "type": "commit"}, {"oid": "62c114f36e728ba6354bb36d4dc66f832e7afaf6", "url": "https://github.com/osmandapp/OsmAnd/commit/62c114f36e728ba6354bb36d4dc66f832e7afaf6", "message": "Fix ConcurrentModificationException", "committedDate": "2020-05-20T11:10:07Z", "type": "commit"}]}