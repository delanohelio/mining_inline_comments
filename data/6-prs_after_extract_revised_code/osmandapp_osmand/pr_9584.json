{"pr_number": 9584, "pr_title": "Follow track", "pr_createdAt": "2020-08-06T23:20:40Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/9584", "timeline": [{"oid": "59f85d8b10181392d187dd9af62b1772b2f7450e", "url": "https://github.com/osmandapp/OsmAnd/commit/59f85d8b10181392d187dd9af62b1772b2f7450e", "message": "Fix compilation", "committedDate": "2020-08-17T17:44:06Z", "type": "forcePushed"}, {"oid": "2bd533e496c4a6ce90c5e2c25c1bbb50153540b1", "url": "https://github.com/osmandapp/OsmAnd/commit/2bd533e496c4a6ce90c5e2c25c1bbb50153540b1", "message": "Add ImportTrackCard", "committedDate": "2020-08-17T20:18:42Z", "type": "commit"}, {"oid": "040de95f9a0aa0a2cf246405403d7fce8c40f6c3", "url": "https://github.com/osmandapp/OsmAnd/commit/040de95f9a0aa0a2cf246405403d7fce8c40f6c3", "message": "Add SelectTrackToFollowCard", "committedDate": "2020-08-17T20:18:42Z", "type": "commit"}, {"oid": "4c9b9f6f5c9760964baaf9a7e631c34130ffb312", "url": "https://github.com/osmandapp/OsmAnd/commit/4c9b9f6f5c9760964baaf9a7e631c34130ffb312", "message": "Add follow track screen initial commit", "committedDate": "2020-08-17T20:18:42Z", "type": "commit"}, {"oid": "960848ecf528d1b6dbed353c304ad82fe9568c03", "url": "https://github.com/osmandapp/OsmAnd/commit/960848ecf528d1b6dbed353c304ad82fe9568c03", "message": "Use GpxTrackAdapter for tracks card", "committedDate": "2020-08-17T20:18:42Z", "type": "commit"}, {"oid": "66e8634bea7bc3ca80dade6ea7a5a6ec96eff0e5", "url": "https://github.com/osmandapp/OsmAnd/commit/66e8634bea7bc3ca80dade6ea7a5a6ec96eff0e5", "message": "Follow track second part", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "6d359fdd00593ee090ead9efd1cfecb4c63fe4d4", "url": "https://github.com/osmandapp/OsmAnd/commit/6d359fdd00593ee090ead9efd1cfecb4c63fe4d4", "message": "Add ReverseTrackCard", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "a719ce79123e4420ace4ed3f2764ec5b110450cb", "url": "https://github.com/osmandapp/OsmAnd/commit/a719ce79123e4420ace4ed3f2764ec5b110450cb", "message": "Add NavigateTrackOptionsCard", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "a132201ab046a5881d6d8763d4e7539e124aa7df", "url": "https://github.com/osmandapp/OsmAnd/commit/a132201ab046a5881d6d8763d4e7539e124aa7df", "message": "Show edit route screen", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "87ef9b1a455faffcdbec6dd5f2918e0abddbbba0", "url": "https://github.com/osmandapp/OsmAnd/commit/87ef9b1a455faffcdbec6dd5f2918e0abddbbba0", "message": "Display follow track on first screen route prepation", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "ccefa2c4e1ab7dc0f67059f6b2ce1f7761a90745", "url": "https://github.com/osmandapp/OsmAnd/commit/ccefa2c4e1ab7dc0f67059f6b2ce1f7761a90745", "message": "Fix compilation", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "a6c4456ca4a2c3a9726e906d614a44c7fe7c0948", "url": "https://github.com/osmandapp/OsmAnd/commit/a6c4456ca4a2c3a9726e906d614a44c7fe7c0948", "message": "Remove calculate route between points", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "26d88ccef2e9c59bed9f0b601c3a42b64d9822e3", "url": "https://github.com/osmandapp/OsmAnd/commit/26d88ccef2e9c59bed9f0b601c3a42b64d9822e3", "message": "Add attach roads card", "committedDate": "2020-08-17T20:18:43Z", "type": "commit"}, {"oid": "26d88ccef2e9c59bed9f0b601c3a42b64d9822e3", "url": "https://github.com/osmandapp/OsmAnd/commit/26d88ccef2e9c59bed9f0b601c3a42b64d9822e3", "message": "Add attach roads card", "committedDate": "2020-08-17T20:18:43Z", "type": "forcePushed"}, {"oid": "ba3fe6f35c3fcf4e31900e5ccc9a0912b3ab66f3", "url": "https://github.com/osmandapp/OsmAnd/commit/ba3fe6f35c3fcf4e31900e5ccc9a0912b3ab66f3", "message": "Show attach roads dialog from follow track", "committedDate": "2020-08-17T20:35:51Z", "type": "commit"}, {"oid": "8c8dcffb5f45eb59bc60c16dd064b25a6615674e", "url": "https://github.com/osmandapp/OsmAnd/commit/8c8dcffb5f45eb59bc60c16dd064b25a6615674e", "message": "Fix import track selection", "committedDate": "2020-08-17T21:33:05Z", "type": "commit"}, {"oid": "2f712adfd78565433ff78c1848965ef6515a3bf9", "url": "https://github.com/osmandapp/OsmAnd/commit/2f712adfd78565433ff78c1848965ef6515a3bf9", "message": "Show reverse card for all tracks", "committedDate": "2020-08-17T21:39:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc4NDYxNQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9584#discussion_r473784615", "bodyText": "getSelectedTrackNames > getSelectedTrackPaths", "author": "max-klaus", "createdAt": "2020-08-20T08:56:32Z", "path": "OsmAnd/src/net/osmand/plus/dialogs/MapLayerMenuListener.java", "diffHunk": "@@ -47,10 +47,7 @@\n \t\tGpxSelectionHelper selectedGpxHelper = mapActivity.getMyApplication().getSelectedGpxHelper();\n \t\tList<SelectedGpxFile> selectedGpxFiles = selectedGpxHelper.getSelectedGPXFiles();\n \n-\t\tList<String> files = new ArrayList<>();\n-\t\tfor (SelectedGpxFile file : selectedGpxFiles) {\n-\t\t\tfiles.add(file.getGpxFile().path);\n-\t\t}\n+\t\tList<String> files = GpxUiHelper.getSelectedTrackNames(mapActivity.getMyApplication());", "originalCommit": "2f712adfd78565433ff78c1848965ef6515a3bf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3f7916fbccafbab4c0cfefe8d9172fb24eb73ca", "chunk": "diff --git a/OsmAnd/src/net/osmand/plus/dialogs/MapLayerMenuListener.java b/OsmAnd/src/net/osmand/plus/dialogs/MapLayerMenuListener.java\nindex 053e2c7536..9234239040 100644\n--- a/OsmAnd/src/net/osmand/plus/dialogs/MapLayerMenuListener.java\n+++ b/OsmAnd/src/net/osmand/plus/dialogs/MapLayerMenuListener.java\n\n@@ -47,7 +47,7 @@ final class MapLayerMenuListener extends OnRowItemClick {\n \t\tGpxSelectionHelper selectedGpxHelper = mapActivity.getMyApplication().getSelectedGpxHelper();\n \t\tList<SelectedGpxFile> selectedGpxFiles = selectedGpxHelper.getSelectedGPXFiles();\n \n-\t\tList<String> files = GpxUiHelper.getSelectedTrackNames(mapActivity.getMyApplication());\n+\t\tList<String> files = GpxUiHelper.getSelectedTrackPaths(mapActivity.getMyApplication());\n \t\tif (selectedGpxFiles.isEmpty()) {\n \t\t\tMap<GPXFile, Long> fls = selectedGpxHelper.getSelectedGpxFilesBackUp();\n \t\t\tfor (Map.Entry<GPXFile, Long> f : fls.entrySet()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc4NTk4Nw==", "url": "https://github.com/osmandapp/OsmAnd/pull/9584#discussion_r473785987", "bodyText": "getTrkSegment > getNonEmptyTrkSegment", "author": "max-klaus", "createdAt": "2020-08-20T08:58:00Z", "path": "OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java", "diffHunk": "@@ -1290,6 +1290,17 @@ public WptPt addRtePt(double lat, double lon, long time, String description, Str\n \t\t\treturn pt;\n \t\t}\n \n+\t\tpublic TrkSegment getTrkSegment() {", "originalCommit": "2f712adfd78565433ff78c1848965ef6515a3bf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3f7916fbccafbab4c0cfefe8d9172fb24eb73ca", "chunk": "diff --git a/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java b/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java\nindex a1e257cef2..0001bfd9b2 100644\n--- a/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java\n+++ b/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java\n\n@@ -1290,7 +1290,7 @@ public class GPXUtilities {\n \t\t\treturn pt;\n \t\t}\n \n-\t\tpublic TrkSegment getTrkSegment() {\n+\t\tpublic TrkSegment getNonEmptyTrkSegment() {\n \t\t\tfor (GPXUtilities.Track t : tracks) {\n \t\t\t\tfor (TrkSegment s : t.segments) {\n \t\t\t\t\tif (s.points.size() > 0) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc4ODQ2MQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9584#discussion_r473788461", "bodyText": "onSavingComplete > onSaveComplete", "author": "max-klaus", "createdAt": "2020-08-20T09:00:45Z", "path": "OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java", "diffHunk": "@@ -116,7 +116,8 @@ public String getExtension() {\n \t}\n \n \tpublic interface OnGpxImportCompleteListener {\n-\t\tvoid onComplete(boolean success);\n+\t\tvoid onImportComplete(boolean success);\n+\t\tvoid onSavingComplete(boolean success, GPXFile result);", "originalCommit": "2f712adfd78565433ff78c1848965ef6515a3bf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3f7916fbccafbab4c0cfefe8d9172fb24eb73ca", "chunk": "diff --git a/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java b/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java\nindex 43f51e40c1..3d63266db9 100644\n--- a/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java\n+++ b/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java\n\n@@ -117,7 +117,7 @@ public class ImportHelper {\n \n \tpublic interface OnGpxImportCompleteListener {\n \t\tvoid onImportComplete(boolean success);\n-\t\tvoid onSavingComplete(boolean success, GPXFile result);\n+\t\tvoid onSaveComplete(boolean success, GPXFile result);\n \t}\n \n \tpublic ImportHelper(final AppCompatActivity activity, final OsmandApplication app, final OsmandMapTileView mapView) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc5ODc4OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9584#discussion_r473798789", "bodyText": "drop attachToRoads", "author": "max-klaus", "createdAt": "2020-08-20T09:13:34Z", "path": "OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java", "diffHunk": "@@ -460,10 +465,15 @@ public void onClick(View view) {\n \n \t\tinitMeasurementMode(newGpxData);\n \n-\t\tif (planRouteMode && savedInstanceState == null) {\n-\t\t\tStartPlanRouteBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),\n-\t\t\t\t\tcreateStartPlanRouteListener());\n+\t\tif (savedInstanceState == null) {\n+\t\t\tif (editingCtx.isNewData() && planRouteMode) {\n+\t\t\t\tStartPlanRouteBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),\n+\t\t\t\t\t\tcreateStartPlanRouteListener());\n+\t\t\t} else if (attachToRoads && !(editingCtx.isNewData() || editingCtx.hasRoutePoints() || editingCtx.isInSnapToRoadMode())) {", "originalCommit": "2f712adfd78565433ff78c1848965ef6515a3bf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3f7916fbccafbab4c0cfefe8d9172fb24eb73ca", "chunk": "diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java\nindex 4c744dc74b..af0b256032 100644\n--- a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java\n+++ b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java\n\n@@ -469,7 +464,7 @@ public class MeasurementToolFragment extends BaseOsmAndFragment implements Route\n \t\t\tif (editingCtx.isNewData() && planRouteMode) {\n \t\t\t\tStartPlanRouteBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),\n \t\t\t\t\t\tcreateStartPlanRouteListener());\n-\t\t\t} else if (attachToRoads && !(editingCtx.isNewData() || editingCtx.hasRoutePoints() || editingCtx.isInSnapToRoadMode())) {\n+\t\t\t} else if (!(editingCtx.isNewData() || editingCtx.hasRoutePoints() || editingCtx.isInSnapToRoadMode())) {\n \t\t\t\tSnapTrackWarningBottomSheet.showInstance(mapActivity.getSupportFragmentManager(), this);\n \t\t\t}\n \t\t}\n"}}, {"oid": "fde90d40d48dcaa2cce21fa74629cc9a22357a27", "url": "https://github.com/osmandapp/OsmAnd/commit/fde90d40d48dcaa2cce21fa74629cc9a22357a27", "message": "Merge branch 'master' into follow_track", "committedDate": "2020-08-20T09:27:52Z", "type": "commit"}, {"oid": "f3f7916fbccafbab4c0cfefe8d9172fb24eb73ca", "url": "https://github.com/osmandapp/OsmAnd/commit/f3f7916fbccafbab4c0cfefe8d9172fb24eb73ca", "message": "Minor fixes", "committedDate": "2020-08-20T10:15:06Z", "type": "commit"}, {"oid": "9128691b52166d82d9295bbf90b5262c794af9a4", "url": "https://github.com/osmandapp/OsmAnd/commit/9128691b52166d82d9295bbf90b5262c794af9a4", "message": "Add missing dividers", "committedDate": "2020-08-20T10:33:20Z", "type": "commit"}, {"oid": "8f275ce86a7ce91ff687a074d6e384fc3604ba0f", "url": "https://github.com/osmandapp/OsmAnd/commit/8f275ce86a7ce91ff687a074d6e384fc3604ba0f", "message": "Merge branch 'master' into follow_track\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-08-20T10:41:16Z", "type": "commit"}]}