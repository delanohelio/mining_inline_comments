{"pr_number": 1625, "pr_title": "DG-410 Fix doc/defaults in Avro converter", "pr_createdAt": "2020-09-11T23:38:16Z", "pr_url": "https://github.com/confluentinc/schema-registry/pull/1625", "timeline": [{"oid": "cde07b12a51d140121294e82867682729af3213c", "url": "https://github.com/confluentinc/schema-registry/commit/cde07b12a51d140121294e82867682729af3213c", "message": "fix test filename typo", "committedDate": "2020-09-14T18:45:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2NzgxOA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r488967818", "bodyText": "We should keep the doc calls in this test and modify what we expect.", "author": "rayokota", "createdAt": "2020-09-15T20:56:04Z", "path": "avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java", "diffHunk": "@@ -503,22 +490,35 @@ public void testFromConnectComplexWithDefaults() {\n     org.apache.avro.Schema avroSchema = org.apache.avro.SchemaBuilder\n         .record(AvroData.DEFAULT_SCHEMA_NAME).namespace(AvroData.NAMESPACE) // default values\n         .fields()\n-        .name(\"int8\").doc(\"int8 field\").type(int8Schema).withDefault(2)\n-        .name(\"int16\").doc(\"int16 field\").type(int16Schema).withDefault(12)\n-        .name(\"int32\").doc(\"int32 field\").type(int32Schema).withDefault(12)\n-        .name(\"int64\").doc(\"int64 field\").type(int64Schema).withDefault(12L)\n-        .name(\"float32\").doc(\"float32 field\").type(float32Schema).withDefault(12.2f)\n-        .name(\"float64\").doc(\"float64 field\").type(float64Schema).withDefault(12.2)\n-        .name(\"boolean\").doc(\"bool field\").type(boolSchema).withDefault(true)\n-        .name(\"string\").doc(\"string field\").type(stringSchema).withDefault(\"foo\")\n-        .name(\"bytes\").doc(\"bytes field\").type(bytesSchema).withDefault(ByteBuffer.wrap(\"foo\".getBytes()))\n+        .name(\"int8\").type(int8Schema).withDefault(2)\n+        .name(\"int16\").type(int16Schema).withDefault(12)\n+        .name(\"int32\").type(int32Schema).withDefault(12)\n+        .name(\"int64\").type(int64Schema).withDefault(12L)\n+        .name(\"float32\").type(float32Schema).withDefault(12.2f)\n+        .name(\"float64\").type(float64Schema).withDefault(12.2)\n+        .name(\"boolean\").type(boolSchema).withDefault(true)\n+        .name(\"string\").type(stringSchema).withDefault(\"foo\")\n+        .name(\"bytes\").type(bytesSchema).withDefault(ByteBuffer.wrap(\"foo\".getBytes()))\n         .name(\"array\").type(arraySchema).withDefault(Arrays.asList(\"a\", \"b\", \"c\"))", "originalCommit": "cde07b12a51d140121294e82867682729af3213c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg5MjUyMQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493892521", "bodyText": "avroSchema (what we expect) will not have field doc because we will no longer add content of connect.doc to avro field's doc, it will have the connect.doc property at field schema level instead.", "author": "xiaoyali97", "createdAt": "2020-09-23T21:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2NzgxOA=="}], "type": "inlineReview", "revised_code": {"commit": "ac0248ba551dde9fbd4cb07d9f0f22f806abce0b", "chunk": "diff --git a/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java b/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\nindex 30d12f2ad..2e3efdb76 100644\n--- a/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\n+++ b/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\n\n@@ -506,19 +521,6 @@ public class AvroDataTest {\n         .name(\"ts\").type(tsSchema).withDefault(tsDefVal)\n         .name(\"decimal\").type(decimalSchema).withDefault(ByteBuffer.wrap(decimalDefVal))\n         .endRecord();\n-    avroSchema.addProp(\"connect.field.doc.int8\", \"int8 field\");\n-    avroSchema.addProp(\"connect.field.doc.int16\", \"int16 field\");\n-    avroSchema.addProp(\"connect.field.doc.int32\", \"int32 field\");\n-    avroSchema.addProp(\"connect.field.doc.int64\", \"int64 field\");\n-    avroSchema.addProp(\"connect.field.doc.float32\", \"float32 field\");\n-    avroSchema.addProp(\"connect.field.doc.float64\", \"float64 field\");\n-    avroSchema.addProp(\"connect.field.doc.boolean\", \"boolean field\");\n-    avroSchema.addProp(\"connect.field.doc.string\", \"string field\");\n-    avroSchema.addProp(\"connect.field.doc.bytes\", \"bytes field\");\n-    avroSchema.addProp(\"connect.field.doc.date\", \"date field\");\n-    avroSchema.addProp(\"connect.field.doc.time\", \"time field\");\n-    avroSchema.addProp(\"connect.field.doc.ts\", \"ts field\");\n-    avroSchema.addProp(\"connect.field.doc.decimal\", \"decimal field\");\n     org.apache.avro.generic.GenericRecord avroRecord\n         = new org.apache.avro.generic.GenericRecordBuilder(avroSchema)\n         .set(\"int8\", 2)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2Nzg2OQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r488967869", "bodyText": "Same", "author": "rayokota", "createdAt": "2020-09-15T20:56:14Z", "path": "avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java", "diffHunk": "@@ -503,22 +490,35 @@ public void testFromConnectComplexWithDefaults() {\n     org.apache.avro.Schema avroSchema = org.apache.avro.SchemaBuilder\n         .record(AvroData.DEFAULT_SCHEMA_NAME).namespace(AvroData.NAMESPACE) // default values\n         .fields()\n-        .name(\"int8\").doc(\"int8 field\").type(int8Schema).withDefault(2)\n-        .name(\"int16\").doc(\"int16 field\").type(int16Schema).withDefault(12)\n-        .name(\"int32\").doc(\"int32 field\").type(int32Schema).withDefault(12)\n-        .name(\"int64\").doc(\"int64 field\").type(int64Schema).withDefault(12L)\n-        .name(\"float32\").doc(\"float32 field\").type(float32Schema).withDefault(12.2f)\n-        .name(\"float64\").doc(\"float64 field\").type(float64Schema).withDefault(12.2)\n-        .name(\"boolean\").doc(\"bool field\").type(boolSchema).withDefault(true)\n-        .name(\"string\").doc(\"string field\").type(stringSchema).withDefault(\"foo\")\n-        .name(\"bytes\").doc(\"bytes field\").type(bytesSchema).withDefault(ByteBuffer.wrap(\"foo\".getBytes()))\n+        .name(\"int8\").type(int8Schema).withDefault(2)\n+        .name(\"int16\").type(int16Schema).withDefault(12)\n+        .name(\"int32\").type(int32Schema).withDefault(12)\n+        .name(\"int64\").type(int64Schema).withDefault(12L)\n+        .name(\"float32\").type(float32Schema).withDefault(12.2f)\n+        .name(\"float64\").type(float64Schema).withDefault(12.2)\n+        .name(\"boolean\").type(boolSchema).withDefault(true)\n+        .name(\"string\").type(stringSchema).withDefault(\"foo\")\n+        .name(\"bytes\").type(bytesSchema).withDefault(ByteBuffer.wrap(\"foo\".getBytes()))\n         .name(\"array\").type(arraySchema).withDefault(Arrays.asList(\"a\", \"b\", \"c\"))\n         .name(\"map\").type(mapSchema).withDefault(Collections.singletonMap(\"field\", 1))\n-        .name(\"date\").doc(\"date field\").type(dateSchema).withDefault(dateDefVal)\n-        .name(\"time\").doc(\"time field\").type(timeSchema).withDefault(timeDefVal)\n-        .name(\"ts\").doc(\"ts field\").type(tsSchema).withDefault(tsDefVal)\n-        .name(\"decimal\").doc(\"decimal field\").type(decimalSchema).withDefault(ByteBuffer.wrap(decimalDefVal))\n+        .name(\"date\").type(dateSchema).withDefault(dateDefVal)\n+        .name(\"time\").type(timeSchema).withDefault(timeDefVal)\n+        .name(\"ts\").type(tsSchema).withDefault(tsDefVal)\n+        .name(\"decimal\").type(decimalSchema).withDefault(ByteBuffer.wrap(decimalDefVal))\n         .endRecord();", "originalCommit": "cde07b12a51d140121294e82867682729af3213c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ac0248ba551dde9fbd4cb07d9f0f22f806abce0b", "chunk": "diff --git a/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java b/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\nindex 30d12f2ad..2e3efdb76 100644\n--- a/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\n+++ b/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\n\n@@ -506,19 +521,6 @@ public class AvroDataTest {\n         .name(\"ts\").type(tsSchema).withDefault(tsDefVal)\n         .name(\"decimal\").type(decimalSchema).withDefault(ByteBuffer.wrap(decimalDefVal))\n         .endRecord();\n-    avroSchema.addProp(\"connect.field.doc.int8\", \"int8 field\");\n-    avroSchema.addProp(\"connect.field.doc.int16\", \"int16 field\");\n-    avroSchema.addProp(\"connect.field.doc.int32\", \"int32 field\");\n-    avroSchema.addProp(\"connect.field.doc.int64\", \"int64 field\");\n-    avroSchema.addProp(\"connect.field.doc.float32\", \"float32 field\");\n-    avroSchema.addProp(\"connect.field.doc.float64\", \"float64 field\");\n-    avroSchema.addProp(\"connect.field.doc.boolean\", \"boolean field\");\n-    avroSchema.addProp(\"connect.field.doc.string\", \"string field\");\n-    avroSchema.addProp(\"connect.field.doc.bytes\", \"bytes field\");\n-    avroSchema.addProp(\"connect.field.doc.date\", \"date field\");\n-    avroSchema.addProp(\"connect.field.doc.time\", \"time field\");\n-    avroSchema.addProp(\"connect.field.doc.ts\", \"ts field\");\n-    avroSchema.addProp(\"connect.field.doc.decimal\", \"decimal field\");\n     org.apache.avro.generic.GenericRecord avroRecord\n         = new org.apache.avro.generic.GenericRecordBuilder(avroSchema)\n         .set(\"int8\", 2)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2OTgwOA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r488969808", "bodyText": "I think we still need tests to cover record-level docs from Connect schema to Avro schema.", "author": "rayokota", "createdAt": "2020-09-15T20:59:59Z", "path": "avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java", "diffHunk": "@@ -736,8 +735,8 @@ public void testFromConnectOptionalPrimitiveWithMetadata() {\n   @Test\n   public void testFromConnectRecordWithMetadata() {\n     Schema schema = SchemaBuilder.struct()\n-        .name(\"io.confluent.test.TestSchema\").version(12).doc(\"doc\")\n-        .field(\"int32\", Schema.INT32_SCHEMA)", "originalCommit": "cde07b12a51d140121294e82867682729af3213c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAyODEyNQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r489028125", "bodyText": "The Avro spec https://avro.apache.org/docs/current/spec.html#schema_primitive states\n\nPrimitive types have no specified attributes.\n\nSo only complex type schema will have connect.record.doc.\nPrimitive type can only have connect.field.doc because the current implementation can't distinguish a primitive schema from being a field level schema or is itself a record level schema.", "author": "xiaoyali97", "createdAt": "2020-09-15T22:25:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2OTgwOA=="}], "type": "inlineReview", "revised_code": {"commit": "ac0248ba551dde9fbd4cb07d9f0f22f806abce0b", "chunk": "diff --git a/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java b/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\nindex 30d12f2ad..2e3efdb76 100644\n--- a/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\n+++ b/avro-data/src/test/java/io/confluent/connect/avro/AvroDataTest.java\n\n@@ -735,8 +738,8 @@ public class AvroDataTest {\n   @Test\n   public void testFromConnectRecordWithMetadata() {\n     Schema schema = SchemaBuilder.struct()\n-        .name(\"io.confluent.test.TestSchema\").version(12)\n-        .field(\"int32\", SchemaBuilder.int32().doc(\"doc\").build())\n+        .name(\"io.confluent.test.TestSchema\").version(12).doc(\"doc\")\n+        .field(\"int32\", Schema.INT32_SCHEMA)\n         .build();\n     Struct struct = new Struct(schema)\n         .put(\"int32\", 12);\n"}}, {"oid": "ac0248ba551dde9fbd4cb07d9f0f22f806abce0b", "url": "https://github.com/confluentinc/schema-registry/commit/ac0248ba551dde9fbd4cb07d9f0f22f806abce0b", "message": "update AvroDataTest.java to reflect change for doc handling", "committedDate": "2020-09-17T18:42:44Z", "type": "forcePushed"}, {"oid": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "url": "https://github.com/confluentinc/schema-registry/commit/f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "message": "add change for handling default value", "committedDate": "2020-09-22T23:23:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc2ODg0OQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493768849", "bodyText": "We don't need this null check since it is already performed a few lines above.", "author": "rayokota", "createdAt": "2020-09-23T17:33:10Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -779,10 +783,18 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n               symbols.add(entry.getValue());\n             }\n           }\n+          String enumDoc = null;\n+          String enumDefault = null;\n+          if (schema.parameters() != null) {", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -783,18 +810,10 @@ public class AvroData {\n               symbols.add(entry.getValue());\n             }\n           }\n-          String enumDoc = null;\n-          String enumDefault = null;\n-          if (schema.parameters() != null) {\n-            enumDoc = schema.parameters().getOrDefault(AVRO_ENUM_DOC_PREFIX_PROP + name, null);\n-            enumDefault = schema.parameters()\n-                .getOrDefault(AVRO_ENUM_DEFAULT_PREFIX_PROP + name, null);\n-          }\n           baseSchema =\n               org.apache.avro.SchemaBuilder.builder().enumeration(\n                   schema.parameters().get(AVRO_TYPE_ENUM))\n-                  .doc(enumDoc)\n-                  .defaultSymbol(enumDefault)\n+                  .doc(schema.parameters().get(CONNECT_ENUM_DOC_PROP))\n                   .symbols(symbols.toArray(new String[symbols.size()]));\n         } else {\n           baseSchema = org.apache.avro.SchemaBuilder.builder().stringType();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc3MTYxMA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493771610", "bodyText": "Change to\nString fieldDoc = schema.parameters() != null ? schema.parameters().getOrDefault(AVRO_FIELD_DOC_PREFIX_PROP + field.name(), null) : null;\nWe check for != null for consistency with other parts of the code.\nPerforming get after containsKey is generally an anti-pattern.", "author": "rayokota", "createdAt": "2020-09-23T17:38:01Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -871,7 +885,10 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n           }\n           List<org.apache.avro.Schema.Field> fields = new ArrayList<>();\n           for (Field field : schema.fields()) {\n-            addAvroRecordField(fields, field.name(), field.schema(), fromConnectContext);\n+            String fieldDoc = schema.parameters() == null ? null :\n+                (schema.parameters().containsKey(AVRO_FIELD_DOC_PREFIX_PROP + field.name())\n+                    ? schema.parameters().get(AVRO_FIELD_DOC_PREFIX_PROP + field.name()) : null);\n+            addAvroRecordField(fields, field.name(), field.schema(), fromConnectContext, fieldDoc);", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -876,21 +893,27 @@ public class AvroData {\n           baseSchema = org.apache.avro.Schema.createUnion(unionSchemas);\n         } else {\n           String doc = schema.parameters() != null\n-                       ? schema.parameters().get(AVRO_RECORD_DOC_PROP)\n+                       ? schema.parameters().get(CONNECT_RECORD_DOC_PROP)\n                        : null;\n           baseSchema = org.apache.avro.Schema.createRecord(\n               name != null ? name : DEFAULT_SCHEMA_NAME, doc, namespace, false);\n+          Map<String, String> fieldDocs = new HashMap<>();\n           if (schema.name() != null) {\n             fromConnectContext.cycleReferences.put(schema.name(), baseSchema);\n           }\n           List<org.apache.avro.Schema.Field> fields = new ArrayList<>();\n           for (Field field : schema.fields()) {\n-            String fieldDoc = schema.parameters() == null ? null :\n-                (schema.parameters().containsKey(AVRO_FIELD_DOC_PREFIX_PROP + field.name())\n-                    ? schema.parameters().get(AVRO_FIELD_DOC_PREFIX_PROP + field.name()) : null);\n-            addAvroRecordField(fields, field.name(), field.schema(), fromConnectContext, fieldDoc);\n+            addAvroRecordField(fields, field.name(), field.schema(), fromConnectContext);\n+            if (field.schema().doc() != null) {\n+              fieldDocs.put(CONNECT_FIELD_DOC_PREFIX_PROP + field.name(), field.schema().doc());\n+            }\n           }\n           baseSchema.setFields(fields);\n+          if (connectMetaData) {\n+            for (Map.Entry<String, String> fieldDoc : fieldDocs.entrySet()) {\n+              baseSchema.addProp(fieldDoc.getKey(), fieldDoc.getValue());\n+            }\n+          }\n         }\n         break;\n       default:\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc3NTk3NQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493775975", "bodyText": "Let's switch fromConnectContext and fieldDoc so that fromConnectContext is last.  Generally we want context objects to always be the first or last parameter.", "author": "rayokota", "createdAt": "2020-09-23T17:45:32Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -1020,7 +1043,8 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n   private void addAvroRecordField(\n       List<org.apache.avro.Schema.Field> fields,\n       String fieldName, Schema fieldSchema,\n-      FromConnectContext fromConnectContext) {\n+      FromConnectContext fromConnectContext,\n+      String fieldDoc) {", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -1043,8 +1057,7 @@ public class AvroData {\n   private void addAvroRecordField(\n       List<org.apache.avro.Schema.Field> fields,\n       String fieldName, Schema fieldSchema,\n-      FromConnectContext fromConnectContext,\n-      String fieldDoc) {\n+      FromConnectContext fromConnectContext) {\n \n     Object defaultVal = null;\n     if (fieldSchema.defaultValue() != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc3NzUyOA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493777528", "bodyText": "Let's merge this method with parametersFromConnect by just adding the check for AVRO_FIELD_DEFAULT_FLAG_PROP to parametersFromConnect and removing this method.", "author": "rayokota", "createdAt": "2020-09-23T17:48:09Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -1169,6 +1193,16 @@ private static JsonNode defaultValueFromConnect(Schema schema, Object value) {\n     }\n   }\n \n+  private static JsonNode parametersFromConncetWithoutAvroDefaultFlag(Map<String, String> params) {", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -1193,16 +1206,6 @@ public class AvroData {\n     }\n   }\n \n-  private static JsonNode parametersFromConncetWithoutAvroDefaultFlag(Map<String, String> params) {\n-    ObjectNode result = JsonNodeFactory.instance.objectNode();\n-    for (Map.Entry<String, String> entry : params.entrySet()) {\n-      if (!entry.getKey().equals(AVRO_FIELD_DEFAULT_FLAG_PROP)) {\n-        result.put(entry.getKey(), entry.getValue());\n-      }\n-    }\n-    return result;\n-  }\n-\n   private static JsonNode parametersFromConnect(Map<String, String> params) {\n     ObjectNode result = JsonNodeFactory.instance.objectNode();\n     for (Map.Entry<String, String> entry : params.entrySet()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4MDAyOQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493780029", "bodyText": "Can this TODO be removed?", "author": "rayokota", "createdAt": "2020-09-23T17:52:08Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -1745,14 +1791,11 @@ private Schema toConnectSchema(org.apache.avro.Schema schema,\n                                 + schema.getType().getName() + \".\");\n     }\n \n-    String docVal = docDefaultVal != null ? docDefaultVal :\n-        (schema.getDoc() != null ? schema.getDoc() : schema.getProp(CONNECT_DOC_PROP));\n-    if (docVal != null) {\n+    String docVal = schema.getProp(CONNECT_DOC_PROP);\n+    if (connectMetaData && docVal != null) {\n       builder.doc(docVal);\n     }\n-    if (connectMetaData && schema.getDoc() != null) {\n-      builder.parameter(CONNECT_RECORD_DOC_PROP, schema.getDoc());\n-    }\n+    //todo: handle connect default", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3MjQxMA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493872410", "bodyText": "Yes.", "author": "xiaoyali97", "createdAt": "2020-09-23T20:23:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4MDAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwOTQ0MQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493909441", "bodyText": "todo:  remove todo :)", "author": "rayokota", "createdAt": "2020-09-23T21:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4MDAyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -1791,11 +1782,12 @@ public class AvroData {\n                                 + schema.getType().getName() + \".\");\n     }\n \n-    String docVal = schema.getProp(CONNECT_DOC_PROP);\n-    if (connectMetaData && docVal != null) {\n-      builder.doc(docVal);\n+    if (fieldDocVal != null) {\n+      builder.doc(fieldDocVal);\n+    }\n+    if (connectMetaData && schema.getDoc() != null) {\n+      builder.parameter(CONNECT_RECORD_DOC_PROP, schema.getDoc());\n     }\n-    //todo: handle connect default\n \n     // Included Kafka Connect version takes priority, fall back to schema registry version\n     int versionInt = -1;  // A valid version must be a positive integer (assumed throughout SR)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NTExMg==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493785112", "bodyText": "Simplify to\n    Object connectDefault = schema.getObjectProp(CONNECT_DEFAULT_VALUE_PROP);\n    if (fieldDefaultVal == null) {\n      fieldDefaultVal = JacksonUtils.toJsonNode(connectDefault);\n    } else if (connectDefault == null) {\n      builder.parameter(AVRO_FIELD_DEFAULT_FLAG_PROP, \"true\");\n    }", "author": "rayokota", "createdAt": "2020-09-23T18:00:11Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -1805,6 +1848,9 @@ private Schema toConnectSchema(org.apache.avro.Schema schema,\n       }\n     }\n \n+    if (fieldDefaultVal != null && schema.getObjectProp(CONNECT_DEFAULT_VALUE_PROP) == null) {\n+      builder.parameter(AVRO_FIELD_DEFAULT_FLAG_PROP, \"true\");\n+    }\n     if (fieldDefaultVal == null) {\n       fieldDefaultVal = JacksonUtils.toJsonNode(schema.getObjectProp(CONNECT_DEFAULT_VALUE_PROP));\n     }", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -1848,9 +1840,6 @@ public class AvroData {\n       }\n     }\n \n-    if (fieldDefaultVal != null && schema.getObjectProp(CONNECT_DEFAULT_VALUE_PROP) == null) {\n-      builder.parameter(AVRO_FIELD_DEFAULT_FLAG_PROP, \"true\");\n-    }\n     if (fieldDefaultVal == null) {\n       fieldDefaultVal = JacksonUtils.toJsonNode(schema.getObjectProp(CONNECT_DEFAULT_VALUE_PROP));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc5MzY1Ng==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493793656", "bodyText": "We should probably leave this as defaultValueFromConnect", "author": "rayokota", "createdAt": "2020-09-23T18:14:45Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -891,11 +908,17 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n                              JsonNodeFactory.instance.numberNode(schema.version()));\n         }\n         if (schema.parameters() != null) {\n-          baseSchema.addProp(CONNECT_PARAMETERS_PROP, parametersFromConnect(schema.parameters()));\n+          JsonNode params = parametersFromConncetWithoutAvroDefaultFlag(schema.parameters());\n+          if (!params.isEmpty()) {\n+            baseSchema.addProp(CONNECT_PARAMETERS_PROP, params);\n+          }\n         }\n         if (schema.defaultValue() != null) {\n-          baseSchema.addProp(CONNECT_DEFAULT_VALUE_PROP,\n-                             defaultValueFromConnect(schema, schema.defaultValue()));\n+          if (schema.parameters() == null\n+              || !schema.parameters().containsKey(AVRO_FIELD_DEFAULT_FLAG_PROP)) {\n+            baseSchema.addProp(CONNECT_DEFAULT_VALUE_PROP,\n+                defaultValueToConnect(schema, schema.defaultValue()));", "originalCommit": "f8c7fc480670f7e6b0a7f704b5768fc8bd69af3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 95%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 28f855350..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -900,25 +923,16 @@ public class AvroData {\n     org.apache.avro.Schema finalSchema = baseSchema;\n     if (!baseSchema.getType().equals(org.apache.avro.Schema.Type.UNION)) {\n       if (connectMetaData) {\n-        if (schema.doc() != null) {\n-          baseSchema.addProp(CONNECT_DOC_PROP, schema.doc());\n-        }\n         if (schema.version() != null) {\n           baseSchema.addProp(CONNECT_VERSION_PROP,\n                              JsonNodeFactory.instance.numberNode(schema.version()));\n         }\n         if (schema.parameters() != null) {\n-          JsonNode params = parametersFromConncetWithoutAvroDefaultFlag(schema.parameters());\n-          if (!params.isEmpty()) {\n-            baseSchema.addProp(CONNECT_PARAMETERS_PROP, params);\n-          }\n+          baseSchema.addProp(CONNECT_PARAMETERS_PROP, parametersFromConnect(schema.parameters()));\n         }\n         if (schema.defaultValue() != null) {\n-          if (schema.parameters() == null\n-              || !schema.parameters().containsKey(AVRO_FIELD_DEFAULT_FLAG_PROP)) {\n-            baseSchema.addProp(CONNECT_DEFAULT_VALUE_PROP,\n-                defaultValueToConnect(schema, schema.defaultValue()));\n-          }\n+          baseSchema.addProp(CONNECT_DEFAULT_VALUE_PROP,\n+                             defaultValueFromConnect(schema, schema.defaultValue()));\n         }\n         if (schema.name() != null) {\n           baseSchema.addProp(CONNECT_NAME_PROP, schema.name());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwNzEzOQ==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493907139", "bodyText": "I think this can just be get()", "author": "rayokota", "createdAt": "2020-09-23T21:31:07Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -779,10 +783,15 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n               symbols.add(entry.getValue());\n             }\n           }\n+          String enumDoc = schema.parameters()\n+              .getOrDefault(AVRO_ENUM_DOC_PREFIX_PROP + name, null);", "originalCommit": "42ed392f5ac248698ae7996cd3ce272801ba5540", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 94%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 314b84ed0..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -783,15 +810,10 @@ public class AvroData {\n               symbols.add(entry.getValue());\n             }\n           }\n-          String enumDoc = schema.parameters()\n-              .getOrDefault(AVRO_ENUM_DOC_PREFIX_PROP + name, null);\n-          String enumDefault = schema.parameters()\n-              .getOrDefault(AVRO_ENUM_DEFAULT_PREFIX_PROP + name, null);\n           baseSchema =\n               org.apache.avro.SchemaBuilder.builder().enumeration(\n                   schema.parameters().get(AVRO_TYPE_ENUM))\n-                  .doc(enumDoc)\n-                  .defaultSymbol(enumDefault)\n+                  .doc(schema.parameters().get(CONNECT_ENUM_DOC_PROP))\n                   .symbols(symbols.toArray(new String[symbols.size()]));\n         } else {\n           baseSchema = org.apache.avro.SchemaBuilder.builder().stringType();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwNzE2NA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493907164", "bodyText": "I think this can just be get()", "author": "rayokota", "createdAt": "2020-09-23T21:31:12Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -779,10 +783,15 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n               symbols.add(entry.getValue());\n             }\n           }\n+          String enumDoc = schema.parameters()\n+              .getOrDefault(AVRO_ENUM_DOC_PREFIX_PROP + name, null);\n+          String enumDefault = schema.parameters()\n+              .getOrDefault(AVRO_ENUM_DEFAULT_PREFIX_PROP + name, null);", "originalCommit": "42ed392f5ac248698ae7996cd3ce272801ba5540", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 94%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 314b84ed0..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -783,15 +810,10 @@ public class AvroData {\n               symbols.add(entry.getValue());\n             }\n           }\n-          String enumDoc = schema.parameters()\n-              .getOrDefault(AVRO_ENUM_DOC_PREFIX_PROP + name, null);\n-          String enumDefault = schema.parameters()\n-              .getOrDefault(AVRO_ENUM_DEFAULT_PREFIX_PROP + name, null);\n           baseSchema =\n               org.apache.avro.SchemaBuilder.builder().enumeration(\n                   schema.parameters().get(AVRO_TYPE_ENUM))\n-                  .doc(enumDoc)\n-                  .defaultSymbol(enumDefault)\n+                  .doc(schema.parameters().get(CONNECT_ENUM_DOC_PROP))\n                   .symbols(symbols.toArray(new String[symbols.size()]));\n         } else {\n           baseSchema = org.apache.avro.SchemaBuilder.builder().stringType();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwNzM5Mw==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r493907393", "bodyText": "I think this can just be get()", "author": "rayokota", "createdAt": "2020-09-23T21:31:45Z", "path": "avro-data/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -871,7 +882,11 @@ private static Object maybeWrapSchemaless(Schema schema, Object value, String ty\n           }\n           List<org.apache.avro.Schema.Field> fields = new ArrayList<>();\n           for (Field field : schema.fields()) {\n-            addAvroRecordField(fields, field.name(), field.schema(), fromConnectContext);\n+            String fieldDoc = schema.parameters() != null\n+                ? schema.parameters()\n+                  .getOrDefault(AVRO_FIELD_DOC_PREFIX_PROP + field.name(), null)", "originalCommit": "42ed392f5ac248698ae7996cd3ce272801ba5540", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "chunk": "diff --git a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nsimilarity index 94%\nrename from avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\nrename to avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex 314b84ed0..89aa726ea 100644\n--- a/avro-data/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -873,22 +893,27 @@ public class AvroData {\n           baseSchema = org.apache.avro.Schema.createUnion(unionSchemas);\n         } else {\n           String doc = schema.parameters() != null\n-                       ? schema.parameters().get(AVRO_RECORD_DOC_PROP)\n+                       ? schema.parameters().get(CONNECT_RECORD_DOC_PROP)\n                        : null;\n           baseSchema = org.apache.avro.Schema.createRecord(\n               name != null ? name : DEFAULT_SCHEMA_NAME, doc, namespace, false);\n+          Map<String, String> fieldDocs = new HashMap<>();\n           if (schema.name() != null) {\n             fromConnectContext.cycleReferences.put(schema.name(), baseSchema);\n           }\n           List<org.apache.avro.Schema.Field> fields = new ArrayList<>();\n           for (Field field : schema.fields()) {\n-            String fieldDoc = schema.parameters() != null\n-                ? schema.parameters()\n-                  .getOrDefault(AVRO_FIELD_DOC_PREFIX_PROP + field.name(), null)\n-                : null;\n-            addAvroRecordField(fields, field.name(), field.schema(), fieldDoc, fromConnectContext);\n+            addAvroRecordField(fields, field.name(), field.schema(), fromConnectContext);\n+            if (field.schema().doc() != null) {\n+              fieldDocs.put(CONNECT_FIELD_DOC_PREFIX_PROP + field.name(), field.schema().doc());\n+            }\n           }\n           baseSchema.setFields(fields);\n+          if (connectMetaData) {\n+            for (Map.Entry<String, String> fieldDoc : fieldDocs.entrySet()) {\n+              baseSchema.addProp(fieldDoc.getKey(), fieldDoc.getValue());\n+            }\n+          }\n         }\n         break;\n       default:\n"}}, {"oid": "5ae5cf7e99382c76afab38f7e4da48cd670a7900", "url": "https://github.com/confluentinc/schema-registry/commit/5ae5cf7e99382c76afab38f7e4da48cd670a7900", "message": "AvroData.toConnectSchema(): stop propagate the schema's doc to the field's doc\nAvroData.fromConnectSchema(): stop adding schema's doc to property", "committedDate": "2020-09-23T23:51:27Z", "type": "commit"}, {"oid": "1fa6423deb8fd37ae544a51477a9a21fbd634c24", "url": "https://github.com/confluentinc/schema-registry/commit/1fa6423deb8fd37ae544a51477a9a21fbd634c24", "message": "update test", "committedDate": "2020-09-23T23:51:38Z", "type": "commit"}, {"oid": "745dcc8620ce900fa2603dcee1aa9acf091a7174", "url": "https://github.com/confluentinc/schema-registry/commit/745dcc8620ce900fa2603dcee1aa9acf091a7174", "message": "fix test filename typo", "committedDate": "2020-09-23T23:51:38Z", "type": "commit"}, {"oid": "f4590d626239421ee83464b781c8bce70478a532", "url": "https://github.com/confluentinc/schema-registry/commit/f4590d626239421ee83464b781c8bce70478a532", "message": "revert the fix", "committedDate": "2020-09-23T23:52:02Z", "type": "commit"}, {"oid": "c4ea4723baeaf2a81b3736c27b212b4f15f76d26", "url": "https://github.com/confluentinc/schema-registry/commit/c4ea4723baeaf2a81b3736c27b212b4f15f76d26", "message": "adopt tests from @dcsobral", "committedDate": "2020-09-23T23:53:07Z", "type": "commit"}, {"oid": "5810c23ee7d2337e781fbc026adf1b08cfbc1735", "url": "https://github.com/confluentinc/schema-registry/commit/5810c23ee7d2337e781fbc026adf1b08cfbc1735", "message": "use avro.* properties to preserve AVRO Schema's doc", "committedDate": "2020-09-23T23:53:12Z", "type": "commit"}, {"oid": "29a1a639247b7912fb461a0e0be9790344557340", "url": "https://github.com/confluentinc/schema-registry/commit/29a1a639247b7912fb461a0e0be9790344557340", "message": "update AvroDataTest.java to reflect change for doc handling", "committedDate": "2020-09-23T23:53:12Z", "type": "commit"}, {"oid": "e96470430f9d493d437c5aaa93b4bddf1af01875", "url": "https://github.com/confluentinc/schema-registry/commit/e96470430f9d493d437c5aaa93b4bddf1af01875", "message": "style fix", "committedDate": "2020-09-23T23:53:12Z", "type": "commit"}, {"oid": "8f3e11b067bbdf4cf9af8c27e12d5267855472c3", "url": "https://github.com/confluentinc/schema-registry/commit/8f3e11b067bbdf4cf9af8c27e12d5267855472c3", "message": "change AVRO_ENUM_DOC_PROP to AVRO_ENUM_DOC_PREFIX_PROP, update related test; also add check for connectMetadata boolean", "committedDate": "2020-09-23T23:53:13Z", "type": "commit"}, {"oid": "e006bcab46d43de5a9ede78526b4be076fc7ce4e", "url": "https://github.com/confluentinc/schema-registry/commit/e006bcab46d43de5a9ede78526b4be076fc7ce4e", "message": "update AdditionalAvroDataTest.testRepeatedTypeWithDefault()", "committedDate": "2020-09-23T23:53:13Z", "type": "commit"}, {"oid": "8f9af8cc1669d791a6846736e4c94c56f25fb090", "url": "https://github.com/confluentinc/schema-registry/commit/8f9af8cc1669d791a6846736e4c94c56f25fb090", "message": "update test", "committedDate": "2020-09-23T23:53:13Z", "type": "commit"}, {"oid": "08eb9bf01c3c175bdd9061ad4b8b2b9c2842a3d9", "url": "https://github.com/confluentinc/schema-registry/commit/08eb9bf01c3c175bdd9061ad4b8b2b9c2842a3d9", "message": "add change for handling default value", "committedDate": "2020-09-23T23:53:13Z", "type": "commit"}, {"oid": "37d7f7a7e743f40040896a77971da6a3f8ecf545", "url": "https://github.com/confluentinc/schema-registry/commit/37d7f7a7e743f40040896a77971da6a3f8ecf545", "message": "polishing code", "committedDate": "2020-09-23T23:53:13Z", "type": "commit"}, {"oid": "65cfb6f53cea652f29bd9a229f33fa93b154bd6e", "url": "https://github.com/confluentinc/schema-registry/commit/65cfb6f53cea652f29bd9a229f33fa93b154bd6e", "message": "handle type conversion in defaultValueFromConnect(), remove defaultValueToConnect() method, then update related test", "committedDate": "2020-09-23T23:53:13Z", "type": "commit"}, {"oid": "dae3a4bc164d52fbf07662a986b9abef3afc995e", "url": "https://github.com/confluentinc/schema-registry/commit/dae3a4bc164d52fbf07662a986b9abef3afc995e", "message": "style fix", "committedDate": "2020-09-23T23:53:14Z", "type": "commit"}, {"oid": "e0506c660a284da01a04d5f073d95c0999a6f32c", "url": "https://github.com/confluentinc/schema-registry/commit/e0506c660a284da01a04d5f073d95c0999a6f32c", "message": "polishing code", "committedDate": "2020-09-23T23:53:14Z", "type": "commit"}, {"oid": "e0506c660a284da01a04d5f073d95c0999a6f32c", "url": "https://github.com/confluentinc/schema-registry/commit/e0506c660a284da01a04d5f073d95c0999a6f32c", "message": "polishing code", "committedDate": "2020-09-23T23:53:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0OTU3Mg==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r494449572", "bodyText": "Let's comment this property, something like \"This property is used to determine whether a default value in the Connect schema originated from an Avro field default.\"", "author": "rayokota", "createdAt": "2020-09-24T16:23:05Z", "path": "avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -85,12 +84,15 @@\n \n   public static final String CONNECT_NAME_PROP = \"connect.name\";\n   public static final String CONNECT_DOC_PROP = \"connect.doc\";\n-  public static final String CONNECT_RECORD_DOC_PROP = \"connect.record.doc\";\n-  public static final String CONNECT_ENUM_DOC_PROP = \"connect.enum.doc\";\n   public static final String CONNECT_VERSION_PROP = \"connect.version\";\n   public static final String CONNECT_DEFAULT_VALUE_PROP = \"connect.default\";\n   public static final String CONNECT_PARAMETERS_PROP = \"connect.parameters\";\n   public static final String CONNECT_INTERNAL_TYPE_NAME = \"connect.internal.type\";\n+  public static final String AVRO_RECORD_DOC_PROP = NAMESPACE + \".record.doc\";\n+  public static final String AVRO_ENUM_DOC_PREFIX_PROP = NAMESPACE + \".enum.doc.\";\n+  public static final String AVRO_FIELD_DOC_PREFIX_PROP = NAMESPACE + \".field.doc.\";\n+  public static final String AVRO_FIELD_DEFAULT_FLAG_PROP = NAMESPACE + \".field.default\";", "originalCommit": "e0506c660a284da01a04d5f073d95c0999a6f32c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3c75f1eb1508020320837cbb938c01cb7e9bcc00", "chunk": "diff --git a/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex a00de6559..b0ad66c9d 100644\n--- a/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -91,6 +91,8 @@ public class AvroData {\n   public static final String AVRO_RECORD_DOC_PROP = NAMESPACE + \".record.doc\";\n   public static final String AVRO_ENUM_DOC_PREFIX_PROP = NAMESPACE + \".enum.doc.\";\n   public static final String AVRO_FIELD_DOC_PREFIX_PROP = NAMESPACE + \".field.doc.\";\n+  //This property is used to determine whether a default value in the Connect schema originated\n+  //from an Avro field default\n   public static final String AVRO_FIELD_DEFAULT_FLAG_PROP = NAMESPACE + \".field.default\";\n   public static final String AVRO_ENUM_DEFAULT_PREFIX_PROP = NAMESPACE + \".enum.default.\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0OTY2OA==", "url": "https://github.com/confluentinc/schema-registry/pull/1625#discussion_r494449668", "bodyText": "nit: extra line", "author": "rayokota", "createdAt": "2020-09-24T16:23:16Z", "path": "avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java", "diffHunk": "@@ -100,6 +102,7 @@\n   public static final String AVRO_TYPE_UNION = NAMESPACE + \".Union\";\n   public static final String AVRO_TYPE_ENUM = NAMESPACE + \".Enum\";\n \n+", "originalCommit": "e0506c660a284da01a04d5f073d95c0999a6f32c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3c75f1eb1508020320837cbb938c01cb7e9bcc00", "chunk": "diff --git a/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\nindex a00de6559..b0ad66c9d 100644\n--- a/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n+++ b/avro-converter/src/main/java/io/confluent/connect/avro/AvroData.java\n\n@@ -102,7 +104,6 @@ public class AvroData {\n   public static final String AVRO_TYPE_UNION = NAMESPACE + \".Union\";\n   public static final String AVRO_TYPE_ENUM = NAMESPACE + \".Enum\";\n \n-\n   public static final String AVRO_TYPE_ANYTHING = NAMESPACE + \".Anything\";\n \n   private static final Map<String, Schema.Type> NON_AVRO_TYPES_BY_TYPE_CODE = new HashMap<>();\n"}}, {"oid": "3c75f1eb1508020320837cbb938c01cb7e9bcc00", "url": "https://github.com/confluentinc/schema-registry/commit/3c75f1eb1508020320837cbb938c01cb7e9bcc00", "message": "add comments and style fix", "committedDate": "2020-09-24T17:37:10Z", "type": "commit"}, {"oid": "f2c316777ae2f25a2fe0d402e594f65533f92f84", "url": "https://github.com/confluentinc/schema-registry/commit/f2c316777ae2f25a2fe0d402e594f65533f92f84", "message": "remove unused test file", "committedDate": "2020-09-24T17:44:02Z", "type": "commit"}]}