{"pr_number": 1485, "pr_title": "Add node information to SchemaRegistryProtocol", "pr_createdAt": "2020-06-09T07:00:09Z", "pr_url": "https://github.com/confluentinc/schema-registry/pull/1485", "timeline": [{"oid": "1d62a3aa05daac1c390e51fa5ab99237f92136c3", "url": "https://github.com/confluentinc/schema-registry/commit/1d62a3aa05daac1c390e51fa5ab99237f92136c3", "message": "Add list of nodes to SchemaRegistryProtocol.Assignment", "committedDate": "2020-06-09T05:49:19Z", "type": "commit"}, {"oid": "10d76dea5cea41157594d3d785d2d6aac6e7ffd7", "url": "https://github.com/confluentinc/schema-registry/commit/10d76dea5cea41157594d3d785d2d6aac6e7ffd7", "message": "Verify node count metrics in election tests", "committedDate": "2020-06-09T06:39:59Z", "type": "commit"}, {"oid": "11ba87090b39f286488b4943b86e3ccfbac253d7", "url": "https://github.com/confluentinc/schema-registry/commit/11ba87090b39f286488b4943b86e3ccfbac253d7", "message": "Wait until node count matches", "committedDate": "2020-06-09T06:54:07Z", "type": "commit"}, {"oid": "87660db32438f5e805ea7cf249107c6721b7dedc", "url": "https://github.com/confluentinc/schema-registry/commit/87660db32438f5e805ea7cf249107c6721b7dedc", "message": "Cosmetic fixes", "committedDate": "2020-06-09T07:04:06Z", "type": "commit"}, {"oid": "7ec0814947818aaba25c2d83a8ee699ea015dfc4", "url": "https://github.com/confluentinc/schema-registry/commit/7ec0814947818aaba25c2d83a8ee699ea015dfc4", "message": "Cleanup test", "committedDate": "2020-06-09T17:31:45Z", "type": "commit"}, {"oid": "5c42f60135a25a6ccb624fb94858738637702fe8", "url": "https://github.com/confluentinc/schema-registry/commit/5c42f60135a25a6ccb624fb94858738637702fe8", "message": "Move test to separate file", "committedDate": "2020-06-09T17:55:58Z", "type": "commit"}, {"oid": "73b4f1b64560928dd21d8ade6d795339ed0353b5", "url": "https://github.com/confluentinc/schema-registry/commit/73b4f1b64560928dd21d8ade6d795339ed0353b5", "message": "Revert old test", "committedDate": "2020-06-09T17:58:46Z", "type": "commit"}, {"oid": "e0ee1a0fd0aab2a7f10846daff07a45d6c47e2da", "url": "https://github.com/confluentinc/schema-registry/commit/e0ee1a0fd0aab2a7f10846daff07a45d6c47e2da", "message": "Clarify some comments", "committedDate": "2020-06-09T18:03:02Z", "type": "commit"}, {"oid": "f6034a4d592f0640c2fb63331d128a5d64498dc4", "url": "https://github.com/confluentinc/schema-registry/commit/f6034a4d592f0640c2fb63331d128a5d64498dc4", "message": "Fix toString", "committedDate": "2020-06-09T18:24:48Z", "type": "commit"}, {"oid": "78679b68f362e34d9644682127534341deb4a097", "url": "https://github.com/confluentinc/schema-registry/commit/78679b68f362e34d9644682127534341deb4a097", "message": "Cosmetic fix", "committedDate": "2020-06-09T18:26:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcwNTY0OA==", "url": "https://github.com/confluentinc/schema-registry/pull/1485#discussion_r437705648", "bodyText": "Maybe add a null check for nodes() as well?  In case of upgrades from an older version this may be the case.", "author": "rayokota", "createdAt": "2020-06-09T20:42:30Z", "path": "core/src/main/java/io/confluent/kafka/schemaregistry/leaderelector/kafka/SchemaRegistryCoordinator.java", "diffHunk": "@@ -147,6 +148,9 @@ protected void onJoinComplete(\n   ) {\n     assignmentSnapshot = SchemaRegistryProtocol.deserializeAssignment(memberAssignment);\n     listener.onAssigned(assignmentSnapshot, generation);\n+    if (nodeCountMetric != null) {\n+      nodeCountMetric.set(assignmentSnapshot.nodes().size());", "originalCommit": "78679b68f362e34d9644682127534341deb4a097", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcyMTcwNA==", "url": "https://github.com/confluentinc/schema-registry/pull/1485#discussion_r437721704", "bodyText": "Fixed, thank you !", "author": "dragosvictor", "createdAt": "2020-06-09T21:04:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcwNTY0OA=="}], "type": "inlineReview", "revised_code": {"commit": "08a8801d1c5b8551e3acec914bbae772b2df7a1b", "chunk": "diff --git a/core/src/main/java/io/confluent/kafka/schemaregistry/leaderelector/kafka/SchemaRegistryCoordinator.java b/core/src/main/java/io/confluent/kafka/schemaregistry/leaderelector/kafka/SchemaRegistryCoordinator.java\nindex 79a77e2b2..61c446146 100644\n--- a/core/src/main/java/io/confluent/kafka/schemaregistry/leaderelector/kafka/SchemaRegistryCoordinator.java\n+++ b/core/src/main/java/io/confluent/kafka/schemaregistry/leaderelector/kafka/SchemaRegistryCoordinator.java\n\n@@ -148,7 +148,7 @@ final class SchemaRegistryCoordinator extends AbstractCoordinator implements Clo\n   ) {\n     assignmentSnapshot = SchemaRegistryProtocol.deserializeAssignment(memberAssignment);\n     listener.onAssigned(assignmentSnapshot, generation);\n-    if (nodeCountMetric != null) {\n+    if (nodeCountMetric != null && assignmentSnapshot.nodes() != null) {\n       nodeCountMetric.set(assignmentSnapshot.nodes().size());\n     }\n   }\n"}}, {"oid": "08a8801d1c5b8551e3acec914bbae772b2df7a1b", "url": "https://github.com/confluentinc/schema-registry/commit/08a8801d1c5b8551e3acec914bbae772b2df7a1b", "message": "Null check assignment snapshots", "committedDate": "2020-06-09T21:03:30Z", "type": "commit"}]}