{"pr_number": 1517, "pr_title": "Correct Lockscreen start behavior", "pr_createdAt": "2020-09-30T20:49:12Z", "pr_url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1517", "timeline": [{"oid": "f8c61b9ea79c97432993ed8cddbabd97ee1832f5", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/f8c61b9ea79c97432993ed8cddbabd97ee1832f5", "message": "Prevent multiple startActivity calls for same intent", "committedDate": "2020-09-30T15:23:29Z", "type": "commit"}, {"oid": "fdcc5ba5dc865792a1cbe7ecb86f8765d7fc3d84", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/fdcc5ba5dc865792a1cbe7ecb86f8765d7fc3d84", "message": "Fix case launching lockscreen too many times\n\nAlso refactored a local var according to style guide (no starting m)", "committedDate": "2020-09-30T20:29:36Z", "type": "commit"}, {"oid": "e4b6c396a0a7982add2971c5ac8b3dea947ecf7d", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e4b6c396a0a7982add2971c5ac8b3dea947ecf7d", "message": "Fix lockscreen tests", "committedDate": "2020-09-30T21:14:27Z", "type": "commit"}, {"oid": "32f6ef485af63d9641dc445ee832b0db24417b13", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/32f6ef485af63d9641dc445ee832b0db24417b13", "message": "Combine bools for lockscreen dismiss extra", "committedDate": "2020-10-01T15:43:33Z", "type": "commit"}, {"oid": "99ca5abb4cd58b80c9518623e57815d3cd6deef3", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/99ca5abb4cd58b80c9518623e57815d3cd6deef3", "message": "Fix check in dismissable change for lockscreen", "committedDate": "2020-10-01T20:45:55Z", "type": "commit"}, {"oid": "1bda6f5fbaa8181606ef6cdbeff2f135b5a333c8", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1bda6f5fbaa8181606ef6cdbeff2f135b5a333c8", "message": "Add another case for updating lockscreen", "committedDate": "2020-10-01T21:22:10Z", "type": "commit"}, {"oid": "bf88ecdcefaec6d0e24df91a3f7767b080b1e521", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/bf88ecdcefaec6d0e24df91a3f7767b080b1e521", "message": "Refactor lockscreen acitivity and DD code", "committedDate": "2020-10-02T15:47:30Z", "type": "commit"}, {"oid": "a9cca6219636e272cce1bfb2b1f33864cbef3f4c", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a9cca6219636e272cce1bfb2b1f33864cbef3f4c", "message": "Fix logic handling for dismiss  \u201cnull\u201d case param", "committedDate": "2020-10-05T15:48:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTczOTk5OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1517#discussion_r499739998", "bodyText": "@joeygrover The comment and the logic are mismatched here.\nshould this be:\nif(ddState.getLockscreenDismissibility() == null ) {\n    isLockscreenDismissible = previousDismissibleState;\n} else {\n    isLockscreenDismissible = ddState.getLockscreenDismissibility();\n}", "author": "RHenigan", "createdAt": "2020-10-05T16:54:37Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/managers/lockscreen/LockScreenManager.java", "diffHunk": "@@ -195,34 +198,54 @@ public void onNotified(RPCNotification notification) {\n             public void onNotified(RPCNotification notification) {\n                 // do something with the status\n                 if (notification != null) {\n-                    OnDriverDistraction ddState = (OnDriverDistraction) notification;\n-                    Boolean isDismissible = ddState.getLockscreenDismissibility();\n-                    DebugTool.logInfo(TAG, \"Lock screen dismissible: \" + isDismissible);\n-                    if (isDismissible != null) {\n-                        // both of these conditions must be met to be able to dismiss lockscreen\n-                        if (isDismissible && enableDismissGesture) {\n-                            mIsLockscreenDismissible = true;\n-\n-                            // if DisplayMode is set to ALWAYS, it will be shown before the first DD notification.\n-                            // If this is our first DD notification and we are in ALWAYS mode, send another intent to\n-                            // enable the dismissal\n-                            if (!receivedFirstDDNotification && displayMode == LockScreenConfig.DISPLAY_MODE_ALWAYS) {\n-                                launchLockScreenActivity();\n+                    synchronized (this) {\n+                        OnDriverDistraction ddState = (OnDriverDistraction) notification;\n+                        driverDistStatus = DriverDistractionState.DD_ON.equals(ddState.getState());\n+                        mLockscreenWarningMsg = ddState.getLockscreenWarningMessage();\n+                        boolean previousDismissibleState = isLockscreenDismissible;\n+                        if(ddState.getLockscreenDismissibility() == null ) {\n+                            isLockscreenDismissible = ddState.getLockscreenDismissibility();\n+                        } //If the param is null, we assume it stays as the previous value", "originalCommit": "a9cca6219636e272cce1bfb2b1f33864cbef3f4c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a6b38b3060eecff77a28c7785ec0816ed4539ec9", "chunk": "diff --git a/android/sdl_android/src/main/java/com/smartdevicelink/managers/lockscreen/LockScreenManager.java b/android/sdl_android/src/main/java/com/smartdevicelink/managers/lockscreen/LockScreenManager.java\nindex de935bad1..66894df8b 100644\n--- a/android/sdl_android/src/main/java/com/smartdevicelink/managers/lockscreen/LockScreenManager.java\n+++ b/android/sdl_android/src/main/java/com/smartdevicelink/managers/lockscreen/LockScreenManager.java\n\n@@ -203,7 +203,7 @@ public class LockScreenManager extends BaseSubManager {\n                         driverDistStatus = DriverDistractionState.DD_ON.equals(ddState.getState());\n                         mLockscreenWarningMsg = ddState.getLockscreenWarningMessage();\n                         boolean previousDismissibleState = isLockscreenDismissible;\n-                        if(ddState.getLockscreenDismissibility() == null ) {\n+                        if(ddState.getLockscreenDismissibility() != null ) {\n                             isLockscreenDismissible = ddState.getLockscreenDismissibility();\n                         } //If the param is null, we assume it stays as the previous value\n \n"}}, {"oid": "a6b38b3060eecff77a28c7785ec0816ed4539ec9", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a6b38b3060eecff77a28c7785ec0816ed4539ec9", "message": "Correct conditional logic", "committedDate": "2020-10-05T17:06:30Z", "type": "commit"}]}