{"pr_number": 1250, "pr_title": "Fix an issue with starting video stream after closing the app", "pr_createdAt": "2020-01-07T21:25:53Z", "pr_url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1250", "timeline": [{"oid": "ff93032c5db4692c4259c792c43fb6cc6a4dbb70", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/ff93032c5db4692c4259c792c43fb6cc6a4dbb70", "message": "Fix an issue with starting video stream after closing the app", "committedDate": "2020-01-07T21:11:28Z", "type": "commit"}, {"oid": "5a62c4d115a28d38500bb6364bced4866d3192cd", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/5a62c4d115a28d38500bb6364bced4866d3192cd", "message": "Update the condition for stopping video streaming", "committedDate": "2020-01-08T15:01:50Z", "type": "commit"}, {"oid": "8e8bf1c3368b8208a84bee30a7aab902a6b218fe", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8e8bf1c3368b8208a84bee30a7aab902a6b218fe", "message": "Merge branch 'develop' into feature/issue_1248", "committedDate": "2020-01-14T20:06:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0MzA3Mw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1250#discussion_r367443073", "bodyText": "Potential NPE using the equals method here. You can either use the == comparator  or switch the enum instance calling the equals() metod, eg  HMILevel.HMI_FULL.equals(prevHMILevel) as the HMILevel enum instances will always be valid. Either solution will work.", "author": "joeygrover", "createdAt": "2020-01-16T14:21:48Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/managers/video/VideoStreamManager.java", "diffHunk": "@@ -148,10 +148,16 @@ public void onNotified(RPCNotification notification) {\n \t\t\t\tif (onHMIStatus.getWindowID() != null && onHMIStatus.getWindowID() != PredefinedWindows.DEFAULT_WINDOW.getValue()) {\n \t\t\t\t\treturn;\n \t\t\t\t}\n+\t\t\t\tHMILevel prevHMILevel = hmiLevel;\n \t\t\t\thmiLevel = onHMIStatus.getHmiLevel();\n \t\t\t\tif(hmiLevel.equals(HMILevel.HMI_FULL)){\n \t\t\t\t\tcheckState();\n \t\t\t\t}\n+\t\t\t\tif (hasStarted && (prevHMILevel.equals(HMILevel.HMI_FULL) || prevHMILevel.equals(HMILevel.HMI_LIMITED)) && (hmiLevel.equals(HMILevel.HMI_NONE) || hmiLevel.equals(HMILevel.HMI_BACKGROUND))){", "originalCommit": "8e8bf1c3368b8208a84bee30a7aab902a6b218fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69da23e3b2e43d8caef0365be6e94df8de5d1301", "chunk": "diff --git a/android/sdl_android/src/main/java/com/smartdevicelink/managers/video/VideoStreamManager.java b/android/sdl_android/src/main/java/com/smartdevicelink/managers/video/VideoStreamManager.java\nindex 8f5ebe5a0..e67abf47e 100644\n--- a/android/sdl_android/src/main/java/com/smartdevicelink/managers/video/VideoStreamManager.java\n+++ b/android/sdl_android/src/main/java/com/smartdevicelink/managers/video/VideoStreamManager.java\n\n@@ -153,7 +153,7 @@ public class VideoStreamManager extends BaseVideoStreamManager {\n \t\t\t\tif(hmiLevel.equals(HMILevel.HMI_FULL)){\n \t\t\t\t\tcheckState();\n \t\t\t\t}\n-\t\t\t\tif (hasStarted && (prevHMILevel.equals(HMILevel.HMI_FULL) || prevHMILevel.equals(HMILevel.HMI_LIMITED)) && (hmiLevel.equals(HMILevel.HMI_NONE) || hmiLevel.equals(HMILevel.HMI_BACKGROUND))){\n+\t\t\t\tif (hasStarted && (prevHMILevel == HMILevel.HMI_FULL || prevHMILevel == HMILevel.HMI_LIMITED) && (hmiLevel == HMILevel.HMI_NONE || hmiLevel == HMILevel.HMI_BACKGROUND)){\n \t\t\t\t\tstateMachine.transitionToState(StreamingStateMachine.NONE);\n \t\t\t\t\ttransitionToState(SETTING_UP);\n \t\t\t\t\tinternalInterface.stopVideoService();\n"}}, {"oid": "69da23e3b2e43d8caef0365be6e94df8de5d1301", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/69da23e3b2e43d8caef0365be6e94df8de5d1301", "message": "Fix potential NPE issue in VideoStreamManager", "committedDate": "2020-01-16T15:34:38Z", "type": "commit"}, {"oid": "15d43541770e941205389c64eb697b05301ec2e0", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/15d43541770e941205389c64eb697b05301ec2e0", "message": "Update transitions in VideoStreamManager", "committedDate": "2020-01-16T16:12:24Z", "type": "commit"}]}