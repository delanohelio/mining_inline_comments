{"pr_number": 1553, "pr_title": "Refactor VoiceCommandManager for taskmaster", "pr_createdAt": "2020-11-06T19:45:39Z", "pr_url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553", "timeline": [{"oid": "a6a94fa2acbdf9bd553e875218289aa7f2b51bf7", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a6a94fa2acbdf9bd553e875218289aa7f2b51bf7", "message": "Refactor VoiceCommandManager for taskmaster", "committedDate": "2020-11-06T19:40:18Z", "type": "commit"}, {"oid": "d4b659ae3c7097946341855e5ac2dc9db4c796d9", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/d4b659ae3c7097946341855e5ac2dc9db4c796d9", "message": "Clean up", "committedDate": "2020-11-06T21:07:05Z", "type": "commit"}, {"oid": "c150199e3e9a0f44f569cb8eb13b0bfd177c9880", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/c150199e3e9a0f44f569cb8eb13b0bfd177c9880", "message": "Pass VoiceCommands to operation instead of RPC", "committedDate": "2020-11-09T21:03:42Z", "type": "commit"}, {"oid": "4e6ece930a05d14afb572f81fa4bd269828b8d2a", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/4e6ece930a05d14afb572f81fa4bd269828b8d2a", "message": "Fix index for successfulAddCommand", "committedDate": "2020-11-09T21:10:48Z", "type": "commit"}, {"oid": "e151ad4d0525fb15217150e4ee95c8942766efec", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e151ad4d0525fb15217150e4ee95c8942766efec", "message": "Remove Retry logic", "committedDate": "2020-11-09T21:18:56Z", "type": "commit"}, {"oid": "1cadb4a9f44a82f0cd01fbc911afcb78dc693f87", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1cadb4a9f44a82f0cd01fbc911afcb78dc693f87", "message": "Clean up callback to manager", "committedDate": "2020-11-10T18:48:30Z", "type": "commit"}, {"oid": "45a6b2fbe5768e50b8d3e4ef833cada6647f0e26", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/45a6b2fbe5768e50b8d3e4ef833cada6647f0e26", "message": "Update pending tasks when callback returns new list", "committedDate": "2020-11-10T19:32:54Z", "type": "commit"}, {"oid": "b82f3a4aec07c981f472f4c8b53c2628d4cd2912", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b82f3a4aec07c981f472f4c8b53c2628d4cd2912", "message": "Adding unit tests, fix errorObject", "committedDate": "2020-11-12T19:56:55Z", "type": "commit"}, {"oid": "7116d3a936eeb8d23a0d0a99b03bd7e58ce33cd9", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/7116d3a936eeb8d23a0d0a99b03bd7e58ce33cd9", "message": "Verify Callback is called", "committedDate": "2020-11-12T21:49:39Z", "type": "commit"}, {"oid": "b789ffffdf9177303185856d8b71900bf44569d8", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b789ffffdf9177303185856d8b71900bf44569d8", "message": "Add successful test case", "committedDate": "2020-11-13T14:35:29Z", "type": "commit"}, {"oid": "62618ad2492e6fd52715a7bd7afda1b3103c8b02", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/62618ad2492e6fd52715a7bd7afda1b3103c8b02", "message": "Add tests for manager", "committedDate": "2020-11-13T15:01:47Z", "type": "commit"}, {"oid": "1bffbf9b6de0dc1cd9e6f32d407245e53740c1d0", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1bffbf9b6de0dc1cd9e6f32d407245e53740c1d0", "message": "Refactor and cancel tasks before clearing queue", "committedDate": "2020-11-13T18:38:51Z", "type": "commit"}, {"oid": "4fde22730ed524926f2b514c76acdeadc4aa28c3", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/4fde22730ed524926f2b514c76acdeadc4aa28c3", "message": "Cleanup transaction queue", "committedDate": "2020-11-13T20:04:16Z", "type": "commit"}, {"oid": "e969bf2fae218318674746364f36cbec8e290596", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e969bf2fae218318674746364f36cbec8e290596", "message": "Merge branch 'develop' into feature/issue_1549", "committedDate": "2020-11-17T19:06:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ5Nzk3MA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r525497970", "bodyText": "The manager always logs that error message even if there are no errors", "author": "bilal-alsharifi", "createdAt": "2020-11-17T20:27:05Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -141,135 +164,40 @@ public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n     // UPDATING SYSTEM\n \n     private void update() {\n-\n-        if (currentHMILevel == null || currentHMILevel.equals(HMILevel.HMI_NONE)) {\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        if (inProgressUpdate != null) {\n-            // There's an in-progress update, put this on hold\n-            hasQueuedUpdate = true;\n-            return;\n-        }\n-\n-        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n-            @Override\n-            public void onComplete(boolean success) {\n-                // we don't care about errors from deleting, send new add commands\n-                sendCurrentVoiceCommands(new CompletionListener() {\n-                    @Override\n-                    public void onComplete(boolean success2) {\n-                        inProgressUpdate = null;\n-\n-                        if (hasQueuedUpdate) {\n-                            update();\n-                            hasQueuedUpdate = false;\n-                        }\n-\n-                        if (!success2) {\n-                            DebugTool.logError(TAG, \"Error sending voice commands\");\n-                        }\n-                    }\n-                });\n-            }\n-        });\n-\n-    }\n-\n-    // DELETING OLD MENU ITEMS\n-\n-    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n-\n-        if (oldVoiceCommands == null || oldVoiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true);\n-            }\n-            return;\n-        }\n-\n-        List<DeleteCommand> deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n-        oldVoiceCommands.clear();\n-        internalInterface.sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+        cleanTransactionQueue();\n+        updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n-            public void onUpdate(int remainingRequests) {\n-\n-            }\n-\n-            @Override\n-            public void onFinished() {\n-                DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n-                if (listener != null) {\n-                    listener.onComplete(true);\n-                }\n-            }\n-\n-            @Override\n-            public void onResponse(int correlationId, RPCResponse response) {\n+            public void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject) {\n+                DebugTool.logInfo(TAG, \"The updated list of VoiceCommands: \" + newCurrentVoiceCommands);\n+                DebugTool.logError(TAG, \"The failed Add and Delete Commands: \" + errorObject);", "originalCommit": "e969bf2fae218318674746364f36cbec8e290596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNDY2Nw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526304667", "bodyText": "Updated to only print when errorObject is not empty", "author": "RHenigan", "createdAt": "2020-11-18T17:56:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ5Nzk3MA=="}], "type": "inlineReview", "revised_code": {"commit": "2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 07f4ca892..62bcfea5b 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -169,7 +171,9 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n             @Override\n             public void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject) {\n                 DebugTool.logInfo(TAG, \"The updated list of VoiceCommands: \" + newCurrentVoiceCommands);\n-                DebugTool.logError(TAG, \"The failed Add and Delete Commands: \" + errorObject);\n+                if (!errorObject.isEmpty()) {\n+                    DebugTool.logError(TAG, \"The failed Add and Delete Commands: \" + errorObject);\n+                }\n                 currentVoiceCommands = newCurrentVoiceCommands;\n                 updatePendingOperations();\n                 updateOperation = null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0NzU1Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r525547552", "bodyText": "it doesn't seem that there is currently a way for the developer to delete existing voice commands. Developers may expect the existing items to be deleted when an empty list is passed but currently, the method just returns in that case. Does iOS have the same behavior?", "author": "bilal-alsharifi", "createdAt": "2020-11-17T21:49:45Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -104,6 +110,23 @@ public void dispose() {\n         super.dispose();\n     }\n \n+    private Queue newTransactionQueue() {\n+        Queue queue = internalInterface.getTaskmaster().createQueue(\"VoiceCommandManager\", 4, false);\n+        queue.pause();\n+        return queue;\n+    }\n+\n+    // If the HMI level is NONE since we want to delay sending RPCs until we're in non-NONE\n+    private void updateTransactionQueueSuspended() {\n+        if (HMILevel.HMI_NONE.equals(currentHMILevel)) {\n+            DebugTool.logInfo(TAG, \"Suspending the transaction queue. Current HMI level is NONE\");\n+            transactionQueue.pause();\n+        } else {\n+            DebugTool.logInfo(TAG, \"Starting the transaction queue\");\n+            transactionQueue.resume();\n+        }\n+    }\n+\n     // SETTERS\n \n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {", "originalCommit": "e969bf2fae218318674746364f36cbec8e290596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNTMwNw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526305307", "bodyText": "Updated to allow for an emptylist to be set, added unit test for the updateOperation", "author": "RHenigan", "createdAt": "2020-11-18T17:57:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0NzU1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 07f4ca892..62bcfea5b 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -132,8 +134,8 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            DebugTool.logInfo(TAG, \"Trying to set empty list of voice commands, returning\");\n+        if (voiceCommands == null) {\n+            DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3MTEyMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526171123", "bodyText": "This class shouldn't be public", "author": "bilal-alsharifi", "createdAt": "2020-11-18T15:21:01Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,228 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+public class VoiceCommandUpdateOperation extends Task {", "originalCommit": "e969bf2fae218318674746364f36cbec8e290596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNDc2MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526304761", "bodyText": "fixed", "author": "RHenigan", "createdAt": "2020-11-18T17:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3MTEyMw=="}], "type": "inlineReview", "revised_code": {"commit": "2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex ee159e43c..2a74b7e78 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -17,7 +17,7 @@ import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n \n-public class VoiceCommandUpdateOperation extends Task {\n+class VoiceCommandUpdateOperation extends Task {\n     private static final String TAG = \"VoiceCommandReplaceOperation\";\n     private final WeakReference<ISdl> internalInterface;\n     List<VoiceCommand> oldVoiceCommands;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3MzczMA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526173730", "bodyText": "I suggest wrapping this in a null checking condition", "author": "bilal-alsharifi", "createdAt": "2020-11-18T15:24:08Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -90,12 +93,15 @@ public void dispose() {\n \n         lastVoiceCommandId = voiceCommandIdMin;\n         voiceCommands = null;\n-        oldVoiceCommands = null;\n+        currentVoiceCommands = null;\n \n         waitingOnHMIUpdate = false;\n         currentHMILevel = null;\n-        inProgressUpdate = null;\n-        hasQueuedUpdate = false;\n+\n+        transactionQueue.close();", "originalCommit": "e969bf2fae218318674746364f36cbec8e290596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNDkxNA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526304914", "bodyText": "added null check", "author": "RHenigan", "createdAt": "2020-11-18T17:56:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3MzczMA=="}], "type": "inlineReview", "revised_code": {"commit": "2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 07f4ca892..62bcfea5b 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -98,7 +98,9 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n         waitingOnHMIUpdate = false;\n         currentHMILevel = null;\n \n-        transactionQueue.close();\n+        if (transactionQueue != null) {\n+            transactionQueue.close();\n+        }\n         transactionQueue = null;\n \n         updateOperation = null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3NzgyNg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526177826", "bodyText": "Do we still need this boolean after using queues? I believe the main reason for using queues is not to use such conditions", "author": "bilal-alsharifi", "createdAt": "2020-11-18T15:29:11Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -34,47 +34,50 @@\n \n import androidx.annotation.NonNull;\n \n+import com.livio.taskmaster.Queue;\n+import com.livio.taskmaster.Task;\n import com.smartdevicelink.managers.BaseSubManager;\n import com.smartdevicelink.managers.CompletionListener;\n import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.protocol.enums.FunctionID;\n import com.smartdevicelink.proxy.RPCNotification;\n-import com.smartdevicelink.proxy.RPCResponse;\n-import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.rpc.OnCommand;\n import com.smartdevicelink.proxy.rpc.OnHMIStatus;\n import com.smartdevicelink.proxy.rpc.enums.HMILevel;\n import com.smartdevicelink.proxy.rpc.enums.PredefinedWindows;\n-import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.proxy.rpc.listeners.OnRPCNotificationListener;\n import com.smartdevicelink.util.DebugTool;\n \n import java.util.ArrayList;\n+import java.util.HashMap;\n import java.util.List;\n \n abstract class BaseVoiceCommandManager extends BaseSubManager {\n     private static final String TAG = \"BaseVoiceCommandManager\";\n-    List<VoiceCommand> voiceCommands, oldVoiceCommands;\n-\n-    List<AddCommand> inProgressUpdate;\n+    List<VoiceCommand> voiceCommands, currentVoiceCommands;\n \n     int lastVoiceCommandId;\n     private static final int voiceCommandIdMin = 1900000000;\n \n     boolean waitingOnHMIUpdate;", "originalCommit": "e969bf2fae218318674746364f36cbec8e290596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4NTgyMQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526385821", "bodyText": "removed old HMI Status Logic", "author": "RHenigan", "createdAt": "2020-11-18T20:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3NzgyNg=="}], "type": "inlineReview", "revised_code": {"commit": "54702ec01128949fa7dee97860f12a9e9fd1eddf", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 07f4ca892..4c10cd52e 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -60,8 +60,6 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     int lastVoiceCommandId;\n     private static final int voiceCommandIdMin = 1900000000;\n \n-    boolean waitingOnHMIUpdate;\n-\n     HMILevel currentHMILevel;\n     OnRPCNotificationListener hmiListener;\n     OnRPCNotificationListener commandListener;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5OTc3MA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526199770", "bodyText": "In this method (line 141), we are still manually checking HMI and return if it is NONE. That should be handled by pausing and resuming the queues instead.", "author": "bilal-alsharifi", "createdAt": "2020-11-18T15:55:03Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -125,9 +148,9 @@ public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n         waitingOnHMIUpdate = false;", "originalCommit": "e969bf2fae218318674746364f36cbec8e290596", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4NTY3Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526385672", "bodyText": "removed old HMI Status logic", "author": "RHenigan", "createdAt": "2020-11-18T20:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5OTc3MA=="}], "type": "inlineReview", "revised_code": {"commit": "2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 07f4ca892..62bcfea5b 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -149,7 +151,7 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n         lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n         this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null && !this.voiceCommands.isEmpty()) {\n+        if (this.voiceCommands != null) {\n             this.currentVoiceCommands.addAll(this.voiceCommands);\n         }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n"}}, {"oid": "2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/2353d6f474330ae9c0de1b7cbc8e8ad8afc9275a", "message": "Fix review feedback allow empty list to be set", "committedDate": "2020-11-18T17:54:52Z", "type": "commit"}, {"oid": "54702ec01128949fa7dee97860f12a9e9fd1eddf", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/54702ec01128949fa7dee97860f12a9e9fd1eddf", "message": "Remove old HMIStatus logic and allign with iOS", "committedDate": "2020-11-18T20:01:17Z", "type": "commit"}, {"oid": "10bfc5fe44a7643375063f60d31aad869a439cc8", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/10bfc5fe44a7643375063f60d31aad869a439cc8", "message": "Remove old HMIStatus logic", "committedDate": "2020-11-18T20:06:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5NjQ4Ng==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526996486", "bodyText": "We shouldn't update voice commands in the case where the devs set the same voice commands as existing ones (iOS implementation has that)", "author": "bilal-alsharifi", "createdAt": "2020-11-19T15:53:11Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -104,30 +109,38 @@ public void dispose() {\n         super.dispose();\n     }\n \n+    private Queue newTransactionQueue() {\n+        Queue queue = internalInterface.getTaskmaster().createQueue(\"VoiceCommandManager\", 4, false);\n+        queue.pause();\n+        return queue;\n+    }\n+\n+    // If the HMI level is NONE since we want to delay sending RPCs until we're in non-NONE\n+    private void updateTransactionQueueSuspended() {\n+        if (HMILevel.HMI_NONE.equals(currentHMILevel)) {\n+            DebugTool.logInfo(TAG, \"Suspending the transaction queue. Current HMI level is NONE\");\n+            transactionQueue.pause();\n+        } else {\n+            DebugTool.logInfo(TAG, \"Starting the transaction queue\");\n+            transactionQueue.resume();\n+        }\n+    }\n+\n     // SETTERS\n \n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyMzY2Nw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527223667", "bodyText": "added a check", "author": "RHenigan", "createdAt": "2020-11-19T21:47:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5NjQ4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 9a86b85a7..50ba16815 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -131,29 +131,14 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null) {\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n             DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null) {\n-            this.currentVoiceCommands.addAll(this.voiceCommands);\n-        }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n \n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n-    }\n-\n-    // UPDATING SYSTEM\n-\n-    private void update() {\n         cleanTransactionQueue();\n         updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5ODQ0NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r526998445", "bodyText": "We don't need to setlastVoiceCommandId again", "author": "bilal-alsharifi", "createdAt": "2020-11-19T15:55:28Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -104,30 +109,38 @@ public void dispose() {\n         super.dispose();\n     }\n \n+    private Queue newTransactionQueue() {\n+        Queue queue = internalInterface.getTaskmaster().createQueue(\"VoiceCommandManager\", 4, false);\n+        queue.pause();\n+        return queue;\n+    }\n+\n+    // If the HMI level is NONE since we want to delay sending RPCs until we're in non-NONE\n+    private void updateTransactionQueueSuspended() {\n+        if (HMILevel.HMI_NONE.equals(currentHMILevel)) {\n+            DebugTool.logInfo(TAG, \"Suspending the transaction queue. Current HMI level is NONE\");\n+            transactionQueue.pause();\n+        } else {\n+            DebugTool.logInfo(TAG, \"Starting the transaction queue\");\n+            transactionQueue.resume();\n+        }\n+    }\n+\n     // SETTERS\n \n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            DebugTool.logInfo(TAG, \"Trying to set empty list of voice commands, returning\");\n+        if (voiceCommands == null) {\n+            DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        // make sure hmi is not none\n-        if (currentHMILevel == null || currentHMILevel == HMILevel.HMI_NONE) {\n-            // Trying to send on HMI_NONE, waiting for full\n-            this.voiceCommands = new ArrayList<>(voiceCommands);\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        waitingOnHMIUpdate = false;\n         lastVoiceCommandId = voiceCommandIdMin;", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyMzc5Ng==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527223796", "bodyText": "removed this assignment", "author": "RHenigan", "createdAt": "2020-11-19T21:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5ODQ0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 9a86b85a7..50ba16815 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -131,29 +131,14 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null) {\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n             DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null) {\n-            this.currentVoiceCommands.addAll(this.voiceCommands);\n-        }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n \n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n-    }\n-\n-    // UPDATING SYSTEM\n-\n-    private void update() {\n         cleanTransactionQueue();\n         updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwNDQ3MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527004471", "bodyText": "currentVoiceCommands shouldn't be updated until we make sure the voiceCommands are successfully sent to the head unit otherwise currentVoiceCommands could have wrong values (if sending the RPC fails for example). Please check how is that implemented in iOS to align with that.", "author": "bilal-alsharifi", "createdAt": "2020-11-19T16:03:04Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -104,30 +109,38 @@ public void dispose() {\n         super.dispose();\n     }\n \n+    private Queue newTransactionQueue() {\n+        Queue queue = internalInterface.getTaskmaster().createQueue(\"VoiceCommandManager\", 4, false);\n+        queue.pause();\n+        return queue;\n+    }\n+\n+    // If the HMI level is NONE since we want to delay sending RPCs until we're in non-NONE\n+    private void updateTransactionQueueSuspended() {\n+        if (HMILevel.HMI_NONE.equals(currentHMILevel)) {\n+            DebugTool.logInfo(TAG, \"Suspending the transaction queue. Current HMI level is NONE\");\n+            transactionQueue.pause();\n+        } else {\n+            DebugTool.logInfo(TAG, \"Starting the transaction queue\");\n+            transactionQueue.resume();\n+        }\n+    }\n+\n     // SETTERS\n \n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            DebugTool.logInfo(TAG, \"Trying to set empty list of voice commands, returning\");\n+        if (voiceCommands == null) {\n+            DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        // make sure hmi is not none\n-        if (currentHMILevel == null || currentHMILevel == HMILevel.HMI_NONE) {\n-            // Trying to send on HMI_NONE, waiting for full\n-            this.voiceCommands = new ArrayList<>(voiceCommands);\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        waitingOnHMIUpdate = false;\n         lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.oldVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null && !this.voiceCommands.isEmpty()) {\n-            this.oldVoiceCommands.addAll(this.voiceCommands);\n+        this.currentVoiceCommands = new ArrayList<>();", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNDAwMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527224003", "bodyText": "removed this to align with iOS code", "author": "RHenigan", "createdAt": "2020-11-19T21:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwNDQ3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 9a86b85a7..50ba16815 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -131,29 +131,14 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null) {\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n             DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null) {\n-            this.currentVoiceCommands.addAll(this.voiceCommands);\n-        }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n \n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n-    }\n-\n-    // UPDATING SYSTEM\n-\n-    private void update() {\n         cleanTransactionQueue();\n         updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxMjE1Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527012152", "bodyText": "I suggest removing the update() method and host its logic directly in setVoiceCommands() because the update() is only called one time and to align more with iOS", "author": "bilal-alsharifi", "createdAt": "2020-11-19T16:13:07Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -141,135 +154,42 @@ public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n     // UPDATING SYSTEM\n \n     private void update() {", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNDQ3Mw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527224473", "bodyText": "removed update method and added to set voice commands", "author": "RHenigan", "createdAt": "2020-11-19T21:48:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxMjE1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 9a86b85a7..50ba16815 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -131,29 +131,14 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null) {\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n             DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null) {\n-            this.currentVoiceCommands.addAll(this.voiceCommands);\n-        }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n \n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n-    }\n-\n-    // UPDATING SYSTEM\n-\n-    private void update() {\n         cleanTransactionQueue();\n         updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxNDEyOA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527014128", "bodyText": "calling ransactionQueue.getTasksAsList().size() is memory consuming because it has to build the list first. Also, the statement has potential NPEs.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (transactionQueue.getTasksAsList().size() > 0) {\n          \n          \n            \n                        updateOperation = null;\n          \n          \n            \n                        transactionQueue.clear();\n          \n          \n            \n                    }\n          \n          \n            \n                    if (transactionQueue != null) {\n          \n          \n            \n                        transactionQueue.clear();\n          \n          \n            \n                    }", "author": "bilal-alsharifi", "createdAt": "2020-11-19T16:15:43Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -141,135 +154,42 @@ public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n     // UPDATING SYSTEM\n \n     private void update() {\n-\n-        if (currentHMILevel == null || currentHMILevel.equals(HMILevel.HMI_NONE)) {\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        if (inProgressUpdate != null) {\n-            // There's an in-progress update, put this on hold\n-            hasQueuedUpdate = true;\n-            return;\n-        }\n-\n-        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n-            @Override\n-            public void onComplete(boolean success) {\n-                // we don't care about errors from deleting, send new add commands\n-                sendCurrentVoiceCommands(new CompletionListener() {\n-                    @Override\n-                    public void onComplete(boolean success2) {\n-                        inProgressUpdate = null;\n-\n-                        if (hasQueuedUpdate) {\n-                            update();\n-                            hasQueuedUpdate = false;\n-                        }\n-\n-                        if (!success2) {\n-                            DebugTool.logError(TAG, \"Error sending voice commands\");\n-                        }\n-                    }\n-                });\n-            }\n-        });\n-\n-    }\n-\n-    // DELETING OLD MENU ITEMS\n-\n-    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n-\n-        if (oldVoiceCommands == null || oldVoiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true);\n-            }\n-            return;\n-        }\n-\n-        List<DeleteCommand> deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n-        oldVoiceCommands.clear();\n-        internalInterface.sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n-            @Override\n-            public void onUpdate(int remainingRequests) {\n-\n-            }\n-\n+        cleanTransactionQueue();\n+        updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n-            public void onFinished() {\n-                DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n-                if (listener != null) {\n-                    listener.onComplete(true);\n+            public void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject) {\n+                DebugTool.logInfo(TAG, \"The updated list of VoiceCommands: \" + newCurrentVoiceCommands);\n+                if (!errorObject.isEmpty()) {\n+                    DebugTool.logError(TAG, \"The failed Add and Delete Commands: \" + errorObject);\n                 }\n-            }\n-\n-            @Override\n-            public void onResponse(int correlationId, RPCResponse response) {\n+                currentVoiceCommands = newCurrentVoiceCommands;\n+                updatePendingOperations();\n+                updateOperation = null;\n             }\n         });\n-\n+        transactionQueue.add(updateOperation, false);\n     }\n \n-    // SEND NEW MENU ITEMS\n-\n-    private void sendCurrentVoiceCommands(final CompletionListener listener) {\n-\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true); // no voice commands to send doesnt mean that its an error\n-            }\n-            return;\n+    private void cleanTransactionQueue() {\n+        if (transactionQueue.getTasksAsList().size() > 0) {\n+            updateOperation = null;\n+            transactionQueue.clear();\n         }", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNDU3Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527224572", "bodyText": "changed to null check", "author": "RHenigan", "createdAt": "2020-11-19T21:48:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxNDEyOA=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 9a86b85a7..50ba16815 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -131,29 +131,14 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null) {\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n             DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null) {\n-            this.currentVoiceCommands.addAll(this.voiceCommands);\n-        }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n \n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n-    }\n-\n-    // UPDATING SYSTEM\n-\n-    private void update() {\n         cleanTransactionQueue();\n         updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxNDc2OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527014768", "bodyText": "We are setting updateOperation to null twice in this method", "author": "bilal-alsharifi", "createdAt": "2020-11-19T16:16:37Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -141,135 +154,42 @@ public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n     // UPDATING SYSTEM\n \n     private void update() {\n-\n-        if (currentHMILevel == null || currentHMILevel.equals(HMILevel.HMI_NONE)) {\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        if (inProgressUpdate != null) {\n-            // There's an in-progress update, put this on hold\n-            hasQueuedUpdate = true;\n-            return;\n-        }\n-\n-        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n-            @Override\n-            public void onComplete(boolean success) {\n-                // we don't care about errors from deleting, send new add commands\n-                sendCurrentVoiceCommands(new CompletionListener() {\n-                    @Override\n-                    public void onComplete(boolean success2) {\n-                        inProgressUpdate = null;\n-\n-                        if (hasQueuedUpdate) {\n-                            update();\n-                            hasQueuedUpdate = false;\n-                        }\n-\n-                        if (!success2) {\n-                            DebugTool.logError(TAG, \"Error sending voice commands\");\n-                        }\n-                    }\n-                });\n-            }\n-        });\n-\n-    }\n-\n-    // DELETING OLD MENU ITEMS\n-\n-    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n-\n-        if (oldVoiceCommands == null || oldVoiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true);\n-            }\n-            return;\n-        }\n-\n-        List<DeleteCommand> deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n-        oldVoiceCommands.clear();\n-        internalInterface.sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n-            @Override\n-            public void onUpdate(int remainingRequests) {\n-\n-            }\n-\n+        cleanTransactionQueue();\n+        updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n-            public void onFinished() {\n-                DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n-                if (listener != null) {\n-                    listener.onComplete(true);\n+            public void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject) {\n+                DebugTool.logInfo(TAG, \"The updated list of VoiceCommands: \" + newCurrentVoiceCommands);\n+                if (!errorObject.isEmpty()) {\n+                    DebugTool.logError(TAG, \"The failed Add and Delete Commands: \" + errorObject);\n                 }\n-            }\n-\n-            @Override\n-            public void onResponse(int correlationId, RPCResponse response) {\n+                currentVoiceCommands = newCurrentVoiceCommands;\n+                updatePendingOperations();\n+                updateOperation = null;\n             }\n         });\n-\n+        transactionQueue.add(updateOperation, false);\n     }\n \n-    // SEND NEW MENU ITEMS\n-\n-    private void sendCurrentVoiceCommands(final CompletionListener listener) {\n-\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true); // no voice commands to send doesnt mean that its an error\n-            }\n-            return;\n+    private void cleanTransactionQueue() {\n+        if (transactionQueue.getTasksAsList().size() > 0) {\n+            updateOperation = null;\n+            transactionQueue.clear();\n         }\n \n-        inProgressUpdate = addCommandsForVoiceCommands(voiceCommands);\n-\n-        internalInterface.sendRPCs(inProgressUpdate, new OnMultipleRequestListener() {\n-            @Override\n-            public void onUpdate(int remainingRequests) {\n-\n-            }\n-\n-            @Override\n-            public void onFinished() {\n-                DebugTool.logInfo(TAG, \"Sending Voice Commands Complete\");\n-                if (listener != null) {\n-                    listener.onComplete(true);\n-                }\n-                oldVoiceCommands = voiceCommands;\n-            }\n-\n-            @Override\n-            public void onResponse(int correlationId, RPCResponse response) {\n-            }\n-        });\n-    }\n-\n-    // DELETES\n-\n-    List<DeleteCommand> deleteCommandsForVoiceCommands(List<VoiceCommand> voiceCommands) {\n-        List<DeleteCommand> deleteCommandList = new ArrayList<>();\n-        for (VoiceCommand command : voiceCommands) {\n-            DeleteCommand delete = new DeleteCommand(command.getCommandId());\n-            deleteCommandList.add(delete);\n+        if (updateOperation != null) {\n+            updateOperation.cancelTask();\n+            updateOperation = null;", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNDg3NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527224875", "bodyText": "removed assignment in the transactionQueue check", "author": "RHenigan", "createdAt": "2020-11-19T21:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxNDc2OA=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 9a86b85a7..50ba16815 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -131,29 +131,14 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n     public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n         // we actually need voice commands to set.\n-        if (voiceCommands == null) {\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n             DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n             return;\n         }\n \n-        lastVoiceCommandId = voiceCommandIdMin;\n         updateIdsOnVoiceCommands(voiceCommands);\n-        this.currentVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null) {\n-            this.currentVoiceCommands.addAll(this.voiceCommands);\n-        }\n         this.voiceCommands = new ArrayList<>(voiceCommands);\n \n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n-    }\n-\n-    // UPDATING SYSTEM\n-\n-    private void update() {\n         cleanTransactionQueue();\n         updateOperation = new VoiceCommandUpdateOperation(internalInterface, currentVoiceCommands, voiceCommands, new VoiceCommandUpdateOperation.VoiceCommandChangesListener() {\n             @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0MDA1NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527040054", "bodyText": "I am a little confused about we do we need two variables (this.oldVoiceCommands, this.currentVoiceCommands) if they both point to the same object", "author": "bilal-alsharifi", "createdAt": "2020-11-19T16:50:02Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0NzE4Nw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527047187", "bodyText": "If I understand it correctly, we need to keep an updated copy of the current voice commands so we add and remove from currentVoiceCommands based on RPC responses. But since currentVoiceCommands  & oldVoiceCommands  both point to the same object, modifying the first will change the second as well. which makes oldVoiceCommands value incorrect. In that case currentVoiceCommands should be a deep copy of oldVoiceCommands. Because we dont want to alter oldVoiceCommands when we make changes to the items in currentVoiceCommands", "author": "bilal-alsharifi", "createdAt": "2020-11-19T16:59:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0MDA1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNTExMg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527225112", "bodyText": "changed to copy oldVoiceCommands into currentVoiceCommands", "author": "RHenigan", "createdAt": "2020-11-19T21:49:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0MDA1NA=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1MDM1MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527050351", "bodyText": "I am not sure what onError() does exactly in Taskmaster, does the queue continue executing other operations? we need to confirm that. Or we can call onFnished() regardless of the RPC response result to let the queue continue", "author": "bilal-alsharifi", "createdAt": "2020-11-19T17:03:37Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyODk4NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527228984", "bodyText": "Changed to onFinished() as this is how it was implemented for other tasks such as SoftButtonReplaceOperation and TextAndGraphicUpdateOperation", "author": "RHenigan", "createdAt": "2020-11-19T21:57:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1MDM1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NDEzNA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527054134", "bodyText": "I suggest doing a null check before updateVoiceCommands just to be extra sure that the object is not null", "author": "bilal-alsharifi", "createdAt": "2020-11-19T17:07:52Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNjM5MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527226391", "bodyText": "added null check for listener", "author": "RHenigan", "createdAt": "2020-11-19T21:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NDEzNA=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5OTg0MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527099841", "bodyText": "No need to store the reposnse and cast it\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n          \n          \n            \n                            if (!deleteResponse.getSuccess()) {\n          \n          \n            \n                            if (!response.getSuccess()) {", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:17:04Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n+                if (!deleteResponse.getSuccess()) {", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNjQ4OQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527226489", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-11-19T21:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5OTg0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwMDE1Mw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527100153", "bodyText": "We can exit out of the loop when we find the item that we are searching for", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:17:30Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n+                if (!deleteResponse.getSuccess()) {\n+                    for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                        if (correlationId == deleteCommand.getCorrelationID()) {\n+                            errorObject.put(deleteCommand, response.getInfo());", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNjkzNw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527226937", "bodyText": "change no longer needed due to change in the onResponse methods", "author": "RHenigan", "createdAt": "2020-11-19T21:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwMDE1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwMTAyMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527101023", "bodyText": "We can exit out of the outer loop when we find the item", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:18:47Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n+                if (!deleteResponse.getSuccess()) {\n+                    for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                        if (correlationId == deleteCommand.getCorrelationID()) {\n+                            errorObject.put(deleteCommand, response.getInfo());\n+                        }\n+                    }\n+                } else {\n+                    removeCurrentVoiceCommandWithCorrelationId(correlationId);\n+                }\n+            }\n+        });\n+\n+    }\n+\n+    // Create DeleteCommand List\n+\n+    List<DeleteCommand> deleteCommandsForVoiceCommands(List<VoiceCommand> voiceCommands) {\n+        List<DeleteCommand> deleteCommandList = new ArrayList<>();\n+        for (VoiceCommand command : voiceCommands) {\n+            DeleteCommand delete = new DeleteCommand(command.getCommandId());\n+            deleteCommandList.add(delete);\n+        }\n+        return deleteCommandList;\n+    }\n+\n+    private void removeCurrentVoiceCommandWithCorrelationId(int correlationId) {\n+        for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+            if (correlationId == deleteCommand.getCorrelationID()) {", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNzExMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527227113", "bodyText": "Updated", "author": "RHenigan", "createdAt": "2020-11-19T21:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwMTAyMw=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwODU3OQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527108579", "bodyText": "in the if (!success) part, we find the request for the corresponding correclationId. Can we just pass that the command id for the request that we found to removeCurrentVoiceCommandWithCorrelationId() instead of passing the correclationId?. that way, we don't have to look for the request again in removeCurrentVoiceCommandWithCorrelationId().\nYou may need to move the looking for request logic before if..else to use the request in both cases.", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:31:04Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n+                if (!deleteResponse.getSuccess()) {\n+                    for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                        if (correlationId == deleteCommand.getCorrelationID()) {\n+                            errorObject.put(deleteCommand, response.getInfo());\n+                        }\n+                    }\n+                } else {\n+                    removeCurrentVoiceCommandWithCorrelationId(correlationId);", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwODc5Nw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527108797", "bodyText": "If you go with that option please update the name for removeCurrentVoiceCommandWithCorrelationId accordingly", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:31:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwODU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwOTUxMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527109513", "bodyText": "That will make the logic a bit simpler and align with iOS more", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:32:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwODU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExNjU4Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527116582", "bodyText": "All previous comments here also apply to pendingVoiceCommandWithCorrelationId(). The logic can be simplified in a similar manner", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:44:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwODU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNzU5MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527227591", "bodyText": "Changed as suggested, new method names are removeCurrentVoiceCommandForCorrelatingDeleteCommand and pendingVoiceCommandForCorrelatingAddCommand", "author": "RHenigan", "createdAt": "2020-11-19T21:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwODU3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExMzcyNQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527113725", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            AddCommandResponse addResponse = (AddCommandResponse) response;\n          \n          \n            \n                            if (!addResponse.getSuccess()) {\n          \n          \n            \n                            if (!response.getSuccess()) {", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:39:51Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n+                if (!deleteResponse.getSuccess()) {\n+                    for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                        if (correlationId == deleteCommand.getCorrelationID()) {\n+                            errorObject.put(deleteCommand, response.getInfo());\n+                        }\n+                    }\n+                } else {\n+                    removeCurrentVoiceCommandWithCorrelationId(correlationId);\n+                }\n+            }\n+        });\n+\n+    }\n+\n+    // Create DeleteCommand List\n+\n+    List<DeleteCommand> deleteCommandsForVoiceCommands(List<VoiceCommand> voiceCommands) {\n+        List<DeleteCommand> deleteCommandList = new ArrayList<>();\n+        for (VoiceCommand command : voiceCommands) {\n+            DeleteCommand delete = new DeleteCommand(command.getCommandId());\n+            deleteCommandList.add(delete);\n+        }\n+        return deleteCommandList;\n+    }\n+\n+    private void removeCurrentVoiceCommandWithCorrelationId(int correlationId) {\n+        for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+            if (correlationId == deleteCommand.getCorrelationID()) {\n+                for (VoiceCommand voiceCommand : oldVoiceCommands) {\n+                    if (deleteCommand.getCmdID() == voiceCommand.getCommandId()) {\n+                        currentVoiceCommands.remove(voiceCommand);\n+                        return;\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    // SEND NEW MENU ITEMS\n+\n+    private void sendCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (pendingVoiceCommands == null || pendingVoiceCommands.size() == 0) {\n+            if (listener != null) {\n+                listener.onComplete(true); // no voice commands to send doesnt mean that its an error\n+            }\n+            return;\n+        }\n+\n+        addCommandsToSend = addCommandsForVoiceCommands(pendingVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(addCommandsToSend, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Sending Voice Commands Complete\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Sending Voice Commands Complete with errors\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                AddCommandResponse addResponse = (AddCommandResponse) response;\n+                if (!addResponse.getSuccess()) {", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNzY5NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527227694", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-11-19T21:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExMzcyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExNDM4MA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527114380", "bodyText": "You can exit out of the loop when you find the item", "author": "bilal-alsharifi", "createdAt": "2020-11-19T18:41:00Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,227 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = oldVoiceCommands;\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onError();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommandResponse deleteResponse = (DeleteCommandResponse) response;\n+                if (!deleteResponse.getSuccess()) {\n+                    for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                        if (correlationId == deleteCommand.getCorrelationID()) {\n+                            errorObject.put(deleteCommand, response.getInfo());\n+                        }\n+                    }\n+                } else {\n+                    removeCurrentVoiceCommandWithCorrelationId(correlationId);\n+                }\n+            }\n+        });\n+\n+    }\n+\n+    // Create DeleteCommand List\n+\n+    List<DeleteCommand> deleteCommandsForVoiceCommands(List<VoiceCommand> voiceCommands) {\n+        List<DeleteCommand> deleteCommandList = new ArrayList<>();\n+        for (VoiceCommand command : voiceCommands) {\n+            DeleteCommand delete = new DeleteCommand(command.getCommandId());\n+            deleteCommandList.add(delete);\n+        }\n+        return deleteCommandList;\n+    }\n+\n+    private void removeCurrentVoiceCommandWithCorrelationId(int correlationId) {\n+        for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+            if (correlationId == deleteCommand.getCorrelationID()) {\n+                for (VoiceCommand voiceCommand : oldVoiceCommands) {\n+                    if (deleteCommand.getCmdID() == voiceCommand.getCommandId()) {\n+                        currentVoiceCommands.remove(voiceCommand);\n+                        return;\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    // SEND NEW MENU ITEMS\n+\n+    private void sendCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (pendingVoiceCommands == null || pendingVoiceCommands.size() == 0) {\n+            if (listener != null) {\n+                listener.onComplete(true); // no voice commands to send doesnt mean that its an error\n+            }\n+            return;\n+        }\n+\n+        addCommandsToSend = addCommandsForVoiceCommands(pendingVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(addCommandsToSend, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Sending Voice Commands Complete\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Sending Voice Commands Complete with errors\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                AddCommandResponse addResponse = (AddCommandResponse) response;\n+                if (!addResponse.getSuccess()) {\n+                    for (AddCommand addCommand : addCommandsToSend) {\n+                        if (correlationId == addCommand.getCorrelationID()) {\n+                            errorObject.put(addCommand, response.getInfo());", "originalCommit": "10bfc5fe44a7643375063f60d31aad869a439cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyODEzNg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527228136", "bodyText": "change no longer needed with changes to onResponse method", "author": "RHenigan", "createdAt": "2020-11-19T21:55:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExNDM4MA=="}], "type": "inlineReview", "revised_code": {"commit": "7e9d2eba29c42eda91375111a8788d2e28f26863", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex 29b928ec7..3f1f330ca 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -6,9 +6,7 @@ import com.smartdevicelink.managers.ISdl;\n import com.smartdevicelink.proxy.RPCRequest;\n import com.smartdevicelink.proxy.RPCResponse;\n import com.smartdevicelink.proxy.rpc.AddCommand;\n-import com.smartdevicelink.proxy.rpc.AddCommandResponse;\n import com.smartdevicelink.proxy.rpc.DeleteCommand;\n-import com.smartdevicelink.proxy.rpc.DeleteCommandResponse;\n import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n import com.smartdevicelink.util.DebugTool;\n \n"}}, {"oid": "7e9d2eba29c42eda91375111a8788d2e28f26863", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/7e9d2eba29c42eda91375111a8788d2e28f26863", "message": "Updates from review feedback", "committedDate": "2020-11-19T21:45:47Z", "type": "commit"}, {"oid": "9e5590c6d3582d31db84384ad2d0031061b13a85", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/9e5590c6d3582d31db84384ad2d0031061b13a85", "message": "replace onError call with onFinished", "committedDate": "2020-11-19T21:55:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0MjQ3NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527242475", "bodyText": "I don't think the list equals method works out of the box for custom objects. I believe you will need to override hashCode() and equals() in VoiceCommand to make the list.equals() method work. you can check SoftButtonObject as an example to see how to implement that.", "author": "bilal-alsharifi", "createdAt": "2020-11-19T22:20:10Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -104,172 +109,75 @@ public void dispose() {\n         super.dispose();\n     }\n \n-    // SETTERS\n-\n-    public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n-\n-        // we actually need voice commands to set.\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            DebugTool.logInfo(TAG, \"Trying to set empty list of voice commands, returning\");\n-            return;\n-        }\n-\n-        // make sure hmi is not none\n-        if (currentHMILevel == null || currentHMILevel == HMILevel.HMI_NONE) {\n-            // Trying to send on HMI_NONE, waiting for full\n-            this.voiceCommands = new ArrayList<>(voiceCommands);\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        waitingOnHMIUpdate = false;\n-        lastVoiceCommandId = voiceCommandIdMin;\n-        updateIdsOnVoiceCommands(voiceCommands);\n-        this.oldVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null && !this.voiceCommands.isEmpty()) {\n-            this.oldVoiceCommands.addAll(this.voiceCommands);\n-        }\n-        this.voiceCommands = new ArrayList<>(voiceCommands);\n-\n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n+    private Queue newTransactionQueue() {\n+        Queue queue = internalInterface.getTaskmaster().createQueue(\"VoiceCommandManager\", 4, false);\n+        queue.pause();\n+        return queue;\n     }\n \n-    // UPDATING SYSTEM\n-\n-    private void update() {\n-\n-        if (currentHMILevel == null || currentHMILevel.equals(HMILevel.HMI_NONE)) {\n-            waitingOnHMIUpdate = true;\n-            return;\n+    // If the HMI level is NONE since we want to delay sending RPCs until we're in non-NONE\n+    private void updateTransactionQueueSuspended() {\n+        if (HMILevel.HMI_NONE.equals(currentHMILevel)) {\n+            DebugTool.logInfo(TAG, \"Suspending the transaction queue. Current HMI level is NONE\");\n+            transactionQueue.pause();\n+        } else {\n+            DebugTool.logInfo(TAG, \"Starting the transaction queue\");\n+            transactionQueue.resume();\n         }\n-\n-        if (inProgressUpdate != null) {\n-            // There's an in-progress update, put this on hold\n-            hasQueuedUpdate = true;\n-            return;\n-        }\n-\n-        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n-            @Override\n-            public void onComplete(boolean success) {\n-                // we don't care about errors from deleting, send new add commands\n-                sendCurrentVoiceCommands(new CompletionListener() {\n-                    @Override\n-                    public void onComplete(boolean success2) {\n-                        inProgressUpdate = null;\n-\n-                        if (hasQueuedUpdate) {\n-                            update();\n-                            hasQueuedUpdate = false;\n-                        }\n-\n-                        if (!success2) {\n-                            DebugTool.logError(TAG, \"Error sending voice commands\");\n-                        }\n-                    }\n-                });\n-            }\n-        });\n-\n     }\n \n-    // DELETING OLD MENU ITEMS\n+    // SETTERS\n \n-    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+    public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n-        if (oldVoiceCommands == null || oldVoiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true);\n-            }\n+        // we actually need voice commands to set.\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {", "originalCommit": "9e5590c6d3582d31db84384ad2d0031061b13a85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3MzMxNQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527773315", "bodyText": "Implemented Methods in VoiceCommand", "author": "RHenigan", "createdAt": "2020-11-20T15:36:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0MjQ3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 50ba16815..782c80d80 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -132,7 +132,7 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n \n         // we actually need voice commands to set.\n         if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n-            DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n+            DebugTool.logInfo(TAG, \"Voice commands list was null or matches the current voice commands\");\n             return;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0MzE5OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527243198", "bodyText": "The message is no longer accurate if the new list equals the old one", "author": "bilal-alsharifi", "createdAt": "2020-11-19T22:21:35Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java", "diffHunk": "@@ -104,172 +109,75 @@ public void dispose() {\n         super.dispose();\n     }\n \n-    // SETTERS\n-\n-    public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n-\n-        // we actually need voice commands to set.\n-        if (voiceCommands == null || voiceCommands.size() == 0) {\n-            DebugTool.logInfo(TAG, \"Trying to set empty list of voice commands, returning\");\n-            return;\n-        }\n-\n-        // make sure hmi is not none\n-        if (currentHMILevel == null || currentHMILevel == HMILevel.HMI_NONE) {\n-            // Trying to send on HMI_NONE, waiting for full\n-            this.voiceCommands = new ArrayList<>(voiceCommands);\n-            waitingOnHMIUpdate = true;\n-            return;\n-        }\n-\n-        waitingOnHMIUpdate = false;\n-        lastVoiceCommandId = voiceCommandIdMin;\n-        updateIdsOnVoiceCommands(voiceCommands);\n-        this.oldVoiceCommands = new ArrayList<>();\n-        if (this.voiceCommands != null && !this.voiceCommands.isEmpty()) {\n-            this.oldVoiceCommands.addAll(this.voiceCommands);\n-        }\n-        this.voiceCommands = new ArrayList<>(voiceCommands);\n-\n-        update();\n-    }\n-\n-    public List<VoiceCommand> getVoiceCommands() {\n-        return voiceCommands;\n+    private Queue newTransactionQueue() {\n+        Queue queue = internalInterface.getTaskmaster().createQueue(\"VoiceCommandManager\", 4, false);\n+        queue.pause();\n+        return queue;\n     }\n \n-    // UPDATING SYSTEM\n-\n-    private void update() {\n-\n-        if (currentHMILevel == null || currentHMILevel.equals(HMILevel.HMI_NONE)) {\n-            waitingOnHMIUpdate = true;\n-            return;\n+    // If the HMI level is NONE since we want to delay sending RPCs until we're in non-NONE\n+    private void updateTransactionQueueSuspended() {\n+        if (HMILevel.HMI_NONE.equals(currentHMILevel)) {\n+            DebugTool.logInfo(TAG, \"Suspending the transaction queue. Current HMI level is NONE\");\n+            transactionQueue.pause();\n+        } else {\n+            DebugTool.logInfo(TAG, \"Starting the transaction queue\");\n+            transactionQueue.resume();\n         }\n-\n-        if (inProgressUpdate != null) {\n-            // There's an in-progress update, put this on hold\n-            hasQueuedUpdate = true;\n-            return;\n-        }\n-\n-        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n-            @Override\n-            public void onComplete(boolean success) {\n-                // we don't care about errors from deleting, send new add commands\n-                sendCurrentVoiceCommands(new CompletionListener() {\n-                    @Override\n-                    public void onComplete(boolean success2) {\n-                        inProgressUpdate = null;\n-\n-                        if (hasQueuedUpdate) {\n-                            update();\n-                            hasQueuedUpdate = false;\n-                        }\n-\n-                        if (!success2) {\n-                            DebugTool.logError(TAG, \"Error sending voice commands\");\n-                        }\n-                    }\n-                });\n-            }\n-        });\n-\n     }\n \n-    // DELETING OLD MENU ITEMS\n+    // SETTERS\n \n-    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+    public void setVoiceCommands(List<VoiceCommand> voiceCommands) {\n \n-        if (oldVoiceCommands == null || oldVoiceCommands.size() == 0) {\n-            if (listener != null) {\n-                listener.onComplete(true);\n-            }\n+        // we actually need voice commands to set.\n+        if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n+            DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");", "originalCommit": "9e5590c6d3582d31db84384ad2d0031061b13a85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3MzQyMg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527773422", "bodyText": "updated log message", "author": "RHenigan", "createdAt": "2020-11-20T15:36:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0MzE5OA=="}], "type": "inlineReview", "revised_code": {"commit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\nindex 50ba16815..782c80d80 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/BaseVoiceCommandManager.java\n\n@@ -132,7 +132,7 @@ abstract class BaseVoiceCommandManager extends BaseSubManager {\n \n         // we actually need voice commands to set.\n         if (voiceCommands == null || voiceCommands.equals(this.voiceCommands)) {\n-            DebugTool.logInfo(TAG, \"Voice commands list was null, returning\");\n+            DebugTool.logInfo(TAG, \"Voice commands list was null or matches the current voice commands\");\n             return;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NTQwOA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527245408", "bodyText": "The lines can be simplfied to avoid duplicate code and remove some logs\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    if (!success2) {\n          \n          \n            \n                                        DebugTool.logError(TAG, \"Error sending voice commands\");\n          \n          \n            \n                                        onFinished();\n          \n          \n            \n                                    } else {\n          \n          \n            \n                                        DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n          \n          \n            \n                                        onFinished();\n          \n          \n            \n                                    }\n          \n          \n            \n                                    if (!success2) {\n          \n          \n            \n                                        DebugTool.logError(TAG, \"Error sending voice commands\");\n          \n          \n            \n                                    }\n          \n          \n            \n                                    onFinished();", "author": "bilal-alsharifi", "createdAt": "2020-11-19T22:26:02Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = new ArrayList<>();\n+        if (oldVoiceCommands != null) {\n+            this.currentVoiceCommands.addAll(oldVoiceCommands);\n+        }\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onFinished();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }", "originalCommit": "9e5590c6d3582d31db84384ad2d0031061b13a85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NDIzMQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527774231", "bodyText": "implemented", "author": "RHenigan", "createdAt": "2020-11-20T15:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NTQwOA=="}], "type": "inlineReview", "revised_code": {"commit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex ce7b56028..bc33161b1 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -67,11 +67,8 @@ class VoiceCommandUpdateOperation extends Task {\n                     public void onComplete(boolean success2) {\n                         if (!success2) {\n                             DebugTool.logError(TAG, \"Error sending voice commands\");\n-                            onFinished();\n-                        } else {\n-                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n-                            onFinished();\n                         }\n+                        onFinished();\n                         if (voiceCommandListener != null) {\n                             voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n                         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NzQyOQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527247429", "bodyText": "no need to continue the loop when we find the item\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    foundDeleteCommand = deleteCommand;\n          \n          \n            \n                                    foundDeleteCommand = deleteCommand;\n          \n          \n            \n                                    break;", "author": "bilal-alsharifi", "createdAt": "2020-11-19T22:30:06Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = new ArrayList<>();\n+        if (oldVoiceCommands != null) {\n+            this.currentVoiceCommands.addAll(oldVoiceCommands);\n+        }\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onFinished();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        if (voiceCommandListener != null) {\n+                            voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                        }\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommand foundDeleteCommand = null;\n+                for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                    if (correlationId == deleteCommand.getCorrelationID()) {\n+                        foundDeleteCommand = deleteCommand;", "originalCommit": "9e5590c6d3582d31db84384ad2d0031061b13a85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NDMxMQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527774311", "bodyText": "implemented", "author": "RHenigan", "createdAt": "2020-11-20T15:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NzQyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex ce7b56028..bc33161b1 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -67,11 +67,8 @@ class VoiceCommandUpdateOperation extends Task {\n                     public void onComplete(boolean success2) {\n                         if (!success2) {\n                             DebugTool.logError(TAG, \"Error sending voice commands\");\n-                            onFinished();\n-                        } else {\n-                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n-                            onFinished();\n                         }\n+                        onFinished();\n                         if (voiceCommandListener != null) {\n                             voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n                         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0Nzk1Mw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527247953", "bodyText": "no need to contiue the loop after finsing the item\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    foundAddCommand = addCommand;\n          \n          \n            \n                                    foundAddCommand = addCommand;\n          \n          \n            \n                                    break;", "author": "bilal-alsharifi", "createdAt": "2020-11-19T22:31:16Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package com.smartdevicelink.managers.screen.menu;\n+\n+import com.livio.taskmaster.Task;\n+import com.smartdevicelink.managers.CompletionListener;\n+import com.smartdevicelink.managers.ISdl;\n+import com.smartdevicelink.proxy.RPCRequest;\n+import com.smartdevicelink.proxy.RPCResponse;\n+import com.smartdevicelink.proxy.rpc.AddCommand;\n+import com.smartdevicelink.proxy.rpc.DeleteCommand;\n+import com.smartdevicelink.proxy.rpc.listeners.OnMultipleRequestListener;\n+import com.smartdevicelink.util.DebugTool;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+class VoiceCommandUpdateOperation extends Task {\n+    private static final String TAG = \"VoiceCommandReplaceOperation\";\n+    private final WeakReference<ISdl> internalInterface;\n+    List<VoiceCommand> oldVoiceCommands;\n+    private List<VoiceCommand> pendingVoiceCommands;\n+    private List<DeleteCommand> deleteVoiceCommands;\n+    private List<AddCommand> addCommandsToSend;\n+    private VoiceCommandChangesListener voiceCommandListener;\n+    private List<VoiceCommand> currentVoiceCommands;\n+    private HashMap<RPCRequest, String> errorObject;\n+\n+    interface VoiceCommandChangesListener {\n+        void updateVoiceCommands(List<VoiceCommand> newCurrentVoiceCommands, HashMap<RPCRequest, String> errorObject);\n+    }\n+\n+    VoiceCommandUpdateOperation(ISdl internalInterface, List<VoiceCommand> oldVoiceCommands, List<VoiceCommand> pendingVoiceCommands, VoiceCommandChangesListener voiceCommandListener) {\n+        super(\"VoiceCommandReplaceOperation\");\n+        this.internalInterface = new WeakReference<>(internalInterface);\n+        this.oldVoiceCommands = oldVoiceCommands;\n+        this.pendingVoiceCommands = pendingVoiceCommands;\n+        this.currentVoiceCommands = new ArrayList<>();\n+        if (oldVoiceCommands != null) {\n+            this.currentVoiceCommands.addAll(oldVoiceCommands);\n+        }\n+        this.voiceCommandListener = voiceCommandListener;\n+        this.errorObject = new HashMap<>();\n+    }\n+\n+    @Override\n+    public void onExecute() {\n+        start();\n+    }\n+\n+    private void start() {\n+        if (getState() == Task.CANCELED) {\n+            onFinished();\n+            return;\n+        }\n+\n+        sendDeleteCurrentVoiceCommands(new CompletionListener() {\n+            @Override\n+            public void onComplete(boolean success) {\n+                if (getState() == Task.CANCELED) {\n+                    onFinished();\n+                    return;\n+                }\n+                // we don't care about errors from deleting, send new add commands\n+                sendCurrentVoiceCommands(new CompletionListener() {\n+                    @Override\n+                    public void onComplete(boolean success2) {\n+                        if (!success2) {\n+                            DebugTool.logError(TAG, \"Error sending voice commands\");\n+                            onFinished();\n+                        } else {\n+                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n+                            onFinished();\n+                        }\n+                        if (voiceCommandListener != null) {\n+                            voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n+                        }\n+                    }\n+                });\n+            }\n+        });\n+    }\n+\n+    // Send DeleteCommandList\n+\n+    private void sendDeleteCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (oldVoiceCommands == null || oldVoiceCommands.isEmpty()) {\n+            if (listener != null) {\n+                listener.onComplete(true);\n+            }\n+            return;\n+        }\n+\n+        deleteVoiceCommands = deleteCommandsForVoiceCommands(oldVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(deleteVoiceCommands, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Successfully deleted old voice commands\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Unable to deleted some old voice commands\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                DeleteCommand foundDeleteCommand = null;\n+                for (DeleteCommand deleteCommand : deleteVoiceCommands) {\n+                    if (correlationId == deleteCommand.getCorrelationID()) {\n+                        foundDeleteCommand = deleteCommand;\n+                    }\n+                }\n+\n+                if (!response.getSuccess()) {\n+                    errorObject.put(foundDeleteCommand, response.getInfo());\n+                } else {\n+                    if (foundDeleteCommand == null) {\n+                        return;\n+                    }\n+                    removeCurrentVoiceCommandForCorrelatingDeleteCommand(foundDeleteCommand);\n+                }\n+            }\n+        });\n+\n+    }\n+\n+    // Create DeleteCommand List\n+\n+    List<DeleteCommand> deleteCommandsForVoiceCommands(List<VoiceCommand> voiceCommands) {\n+        List<DeleteCommand> deleteCommandList = new ArrayList<>();\n+        for (VoiceCommand command : voiceCommands) {\n+            DeleteCommand delete = new DeleteCommand(command.getCommandId());\n+            deleteCommandList.add(delete);\n+        }\n+        return deleteCommandList;\n+    }\n+\n+    private void removeCurrentVoiceCommandForCorrelatingDeleteCommand(DeleteCommand deleteCommand) {\n+        for (VoiceCommand voiceCommand : oldVoiceCommands) {\n+            if (deleteCommand.getCmdID() == voiceCommand.getCommandId()) {\n+                currentVoiceCommands.remove(voiceCommand);\n+                return;\n+            }\n+        }\n+    }\n+\n+    // SEND NEW MENU ITEMS\n+\n+    private void sendCurrentVoiceCommands(final CompletionListener listener) {\n+\n+        if (pendingVoiceCommands == null || pendingVoiceCommands.size() == 0) {\n+            if (listener != null) {\n+                listener.onComplete(true); // no voice commands to send doesnt mean that its an error\n+            }\n+            return;\n+        }\n+\n+        addCommandsToSend = addCommandsForVoiceCommands(pendingVoiceCommands);\n+\n+        internalInterface.get().sendRPCs(addCommandsToSend, new OnMultipleRequestListener() {\n+            @Override\n+            public void onUpdate(int remainingRequests) {\n+            }\n+\n+            @Override\n+            public void onFinished() {\n+                if (listener != null) {\n+                    if (errorObject.isEmpty()) {\n+                        DebugTool.logInfo(TAG, \"Sending Voice Commands Complete\");\n+                        listener.onComplete(true);\n+                    } else {\n+                        DebugTool.logInfo(TAG, \"Sending Voice Commands Complete with errors\");\n+                        listener.onComplete(false);\n+                    }\n+                }\n+            }\n+\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                AddCommand foundAddCommand = null;\n+                for (AddCommand addCommand : addCommandsToSend) {\n+                    if (correlationId == addCommand.getCorrelationID()) {\n+                        foundAddCommand = addCommand;", "originalCommit": "9e5590c6d3582d31db84384ad2d0031061b13a85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NDQ0Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527774442", "bodyText": "implemented", "author": "RHenigan", "createdAt": "2020-11-20T15:38:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0Nzk1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\nindex ce7b56028..bc33161b1 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommandUpdateOperation.java\n\n@@ -67,11 +67,8 @@ class VoiceCommandUpdateOperation extends Task {\n                     public void onComplete(boolean success2) {\n                         if (!success2) {\n                             DebugTool.logError(TAG, \"Error sending voice commands\");\n-                            onFinished();\n-                        } else {\n-                            DebugTool.logInfo(TAG, \"Successfully send voice commands\");\n-                            onFinished();\n                         }\n+                        onFinished();\n                         if (voiceCommandListener != null) {\n                             voiceCommandListener.updateVoiceCommands(currentVoiceCommands, errorObject);\n                         }\n"}}, {"oid": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/c01aa26fa73577dcd4d882bd578cf34df7d714c9", "message": "Fix review feedback", "committedDate": "2020-11-20T15:31:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4MDE2MA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527780160", "bodyText": "unused import", "author": "bilal-alsharifi", "createdAt": "2020-11-20T15:46:18Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java", "diffHunk": "@@ -35,6 +35,8 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import com.smartdevicelink.managers.screen.SoftButtonObject;", "originalCommit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgwMTA1OQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527801059", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-11-20T16:18:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4MDE2MA=="}], "type": "inlineReview", "revised_code": {"commit": "65cea2d23fdbe8742f46a11ce1bf39c66b885d5a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\nindex ca6a4e957..15d66b09e 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\n\n@@ -35,7 +35,6 @@ package com.smartdevicelink.managers.screen.menu;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n-import com.smartdevicelink.managers.screen.SoftButtonObject;\n \n import java.util.List;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4MjQ5NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527782495", "bodyText": "The listener is not a data object so it doesn't need to be compared for equality. Also after removing it please change the number i+3 to be i+2 accordingly", "author": "bilal-alsharifi", "createdAt": "2020-11-20T15:49:46Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java", "diffHunk": "@@ -124,4 +126,37 @@ void setCommandId(int commandId) {\n     int getCommandId() {\n         return commandId;\n     }\n+\n+    /**\n+     * Used to compile hashcode for VoiceCommand for use to compare in equals method\n+     *\n+     * @return Custom hashcode of VoiceCommand variables\n+     */\n+    @Override\n+    public int hashCode() {\n+        int result = 1;\n+        result += ((getCommandId() == 0) ? 0 : Integer.rotateLeft(getCommandId(), 1));\n+        result += ((getVoiceCommandSelectionListener() == null) ? 0 : Integer.rotateLeft(getVoiceCommandSelectionListener().hashCode(), 2));", "originalCommit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgwMTAyMA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527801020", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-11-20T16:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4MjQ5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "65cea2d23fdbe8742f46a11ce1bf39c66b885d5a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\nindex ca6a4e957..15d66b09e 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\n\n@@ -135,10 +134,9 @@ public class VoiceCommand {\n     @Override\n     public int hashCode() {\n         int result = 1;\n-        result += ((getCommandId() == 0) ? 0 : Integer.rotateLeft(getCommandId(), 1));\n-        result += ((getVoiceCommandSelectionListener() == null) ? 0 : Integer.rotateLeft(getVoiceCommandSelectionListener().hashCode(), 2));\n+        result += Integer.rotateLeft(getCommandId(), 1);\n         for (int i = 0; i < this.getVoiceCommands().size(); i++) {\n-            result += ((getVoiceCommands().get(i) == null) ? 0 : Integer.rotateLeft(getVoiceCommands().get(i).hashCode(), i + 3));\n+            result += ((getVoiceCommands().get(i) == null) ? 0 : Integer.rotateLeft(getVoiceCommands().get(i).hashCode(), i + 2));\n         }\n         return result;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4NDExOA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527784118", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    result += ((getCommandId() == 0) ? 0 : Integer.rotateLeft(getCommandId(), 1));\n          \n          \n            \n                    result += Integer.rotateLeft(getCommandId(), 1);", "author": "bilal-alsharifi", "createdAt": "2020-11-20T15:52:02Z", "path": "base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java", "diffHunk": "@@ -124,4 +126,37 @@ void setCommandId(int commandId) {\n     int getCommandId() {\n         return commandId;\n     }\n+\n+    /**\n+     * Used to compile hashcode for VoiceCommand for use to compare in equals method\n+     *\n+     * @return Custom hashcode of VoiceCommand variables\n+     */\n+    @Override\n+    public int hashCode() {\n+        int result = 1;\n+        result += ((getCommandId() == 0) ? 0 : Integer.rotateLeft(getCommandId(), 1));", "originalCommit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgwMDkzMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527800933", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-11-20T16:18:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4NDExOA=="}], "type": "inlineReview", "revised_code": {"commit": "65cea2d23fdbe8742f46a11ce1bf39c66b885d5a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\nindex ca6a4e957..15d66b09e 100644\n--- a/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\n+++ b/base/src/main/java/com/smartdevicelink/managers/screen/menu/VoiceCommand.java\n\n@@ -135,10 +134,9 @@ public class VoiceCommand {\n     @Override\n     public int hashCode() {\n         int result = 1;\n-        result += ((getCommandId() == 0) ? 0 : Integer.rotateLeft(getCommandId(), 1));\n-        result += ((getVoiceCommandSelectionListener() == null) ? 0 : Integer.rotateLeft(getVoiceCommandSelectionListener().hashCode(), 2));\n+        result += Integer.rotateLeft(getCommandId(), 1);\n         for (int i = 0; i < this.getVoiceCommands().size(); i++) {\n-            result += ((getVoiceCommands().get(i) == null) ? 0 : Integer.rotateLeft(getVoiceCommands().get(i).hashCode(), i + 3));\n+            result += ((getVoiceCommands().get(i) == null) ? 0 : Integer.rotateLeft(getVoiceCommands().get(i).hashCode(), i + 2));\n         }\n         return result;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5ODUxNA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527798514", "bodyText": "There is an unused import in this class", "author": "bilal-alsharifi", "createdAt": "2020-11-20T16:14:16Z", "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/managers/screen/menu/VoiceCommandManagerTests.java", "diffHunk": "@@ -34,6 +34,7 @@\n ", "originalCommit": "c01aa26fa73577dcd4d882bd578cf34df7d714c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgwMDg4NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1553#discussion_r527800884", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-11-20T16:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5ODUxNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "65cea2d23fdbe8742f46a11ce1bf39c66b885d5a", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/65cea2d23fdbe8742f46a11ce1bf39c66b885d5a", "message": "Clean up hashCode method and imports", "committedDate": "2020-11-20T16:16:25Z", "type": "commit"}, {"oid": "467b9eec38896bff8176c9971d28211d2fadf7a2", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/467b9eec38896bff8176c9971d28211d2fadf7a2", "message": "iOS Alignment", "committedDate": "2020-12-09T15:22:01Z", "type": "commit"}]}