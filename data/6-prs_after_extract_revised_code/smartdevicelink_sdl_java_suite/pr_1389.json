{"pr_number": 1389, "pr_title": "[SDL 0292] implement VirtualDisplayEncoder improvement for stable frame rate", "pr_createdAt": "2020-06-22T10:49:17Z", "pr_url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389", "timeline": [{"oid": "1afffdb10fee3690ec00a6ac241e8f39f2fa0b5c", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1afffdb10fee3690ec00a6ac241e8f39f2fa0b5c", "message": "[SDL-0274] issue-1268: implementing add preferred FPS to VideoStreamingCapability.", "committedDate": "2020-06-12T09:01:28Z", "type": "commit"}, {"oid": "8dd4bb8fbe91b223c7eb3fd755c4a19f4645c275", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8dd4bb8fbe91b223c7eb3fd755c4a19f4645c275", "message": "SDL-0292: initial commit for implementing VirtualDisplayEncoder improvement for stable frame rate.", "committedDate": "2020-06-19T10:25:03Z", "type": "commit"}, {"oid": "6ce74f0039f169a7211787a2cc848ba55f036982", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/6ce74f0039f169a7211787a2cc848ba55f036982", "message": "Add OffscreenSurfaceTest (for unit testing).", "committedDate": "2020-06-22T10:29:00Z", "type": "commit"}, {"oid": "b66814bd198a630c27050e337e118d8e150b3343", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b66814bd198a630c27050e337e118d8e150b3343", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361", "committedDate": "2020-07-03T09:56:01Z", "type": "commit"}, {"oid": "20b95ce2ada65190232101b64301c772edd3b163", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/20b95ce2ada65190232101b64301c772edd3b163", "message": "Refactorred OffscreenSurfaceTest, as AndroidtestCase2 no longer exists in current develop branch.", "committedDate": "2020-07-03T10:58:37Z", "type": "commit"}, {"oid": "edc3586655862c2a6735f38585be08c68a65e6fe", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/edc3586655862c2a6735f38585be08c68a65e6fe", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361", "committedDate": "2020-08-21T07:12:32Z", "type": "commit"}, {"oid": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3", "message": "Fix the test failure in OffscreenSurfaceTest aftter merging 4.12.0.", "committedDate": "2020-08-25T09:26:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM4OTkyNA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r481389924", "bodyText": "This would be considered a breaking change, can you please keep the old method and deprecate it and then add in your new method", "author": "RHenigan", "createdAt": "2020-09-01T19:45:57Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java", "diffHunk": "@@ -107,8 +126,8 @@ public VideoStreamingParameters getStreamingParams(){\n     }\n \n     @SuppressWarnings(\"unused\")\n-    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format) {\n-        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format);\n+    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format, boolean stableFrameRate) {\n+        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format, stableFrameRate);", "originalCommit": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg0MjEzNA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r481842134", "bodyText": "Thanks for the suggestion. I have restored the previous setStreamingParams method at commit #a4f2539.", "author": "shiniwat", "createdAt": "2020-09-02T07:42:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM4OTkyNA=="}], "type": "inlineReview", "revised_code": {"commit": "a4f25398780ef4ef94e930baa54857534f2cbf0a", "chunk": "diff --git a/android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java b/android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java\nindex 920b962b0..201c7e5ca 100644\n--- a/android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java\n+++ b/android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java\n\n@@ -125,6 +125,11 @@ public class VirtualDisplayEncoder {\n         return this.streamingParams;\n     }\n \n+    @Deprecated\n+    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format) {\n+        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format);\n+    }\n+\n     @SuppressWarnings(\"unused\")\n     public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format, boolean stableFrameRate) {\n         this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format, stableFrameRate);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5MTAyOA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r481391028", "bodyText": "This would be considered a breaking change, can you please keep the old constructor and deprecate it and then add in your new constructor.\nin the old constructor you can default the stableFrameRate value to be true", "author": "RHenigan", "createdAt": "2020-09-01T19:48:07Z", "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -75,16 +76,18 @@ public VideoStreamingParameters(){\n \t    format = new VideoStreamingFormat();\n \t    format.setProtocol(DEFAULT_PROTOCOL);\n \t    format.setCodec(DEFAULT_CODEC);\n+\t    stableFrameRate = true;\n     }\n \n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format){\n+                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){", "originalCommit": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg0MjU2OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r481842568", "bodyText": "I have restored previous constructor as you suggested.", "author": "shiniwat", "createdAt": "2020-09-02T07:42:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5MTAyOA=="}], "type": "inlineReview", "revised_code": {"commit": "a4f25398780ef4ef94e930baa54857534f2cbf0a", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java b/base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java\nindex bf2ff3957..6727e0ead 100644\n--- a/base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java\n+++ b/base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java\n\n@@ -79,6 +79,28 @@ public class VideoStreamingParameters {\n \t    stableFrameRate = true;\n     }\n \n+    @Deprecated\n+    public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n+                                    ImageResolution resolution, VideoStreamingFormat format){\n+        this.displayDensity = displayDensity;\n+        this.frameRate = frameRate;\n+        this.bitrate = bitrate;\n+        this.interval = interval;\n+        this.resolution = resolution;\n+        this.format = format;\n+        this.stableFrameRate = true;\n+    }\n+\n+    /**\n+     * new constructor of VideoStreamingParameters, which now has stableFrameRate param.\n+     * @param displayDensity\n+     * @param frameRate\n+     * @param bitrate\n+     * @param interval\n+     * @param resolution\n+     * @param format\n+     * @param stableFrameRate\n+     */\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n                                     ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n \t    this.displayDensity = displayDensity;\n"}}, {"oid": "a4f25398780ef4ef94e930baa54857534f2cbf0a", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a4f25398780ef4ef94e930baa54857534f2cbf0a", "message": "Restored the old constructor of VideoStreamParameters for backward compatibility, which is suggested during the code review at https://github.com/smartdevicelink/sdl_java_suite/pull/1389.", "committedDate": "2020-09-02T05:57:12Z", "type": "commit"}, {"oid": "0aeb8da0119132f4b316c9d1983bbcfa9baba79f", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/0aeb8da0119132f4b316c9d1983bbcfa9baba79f", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361", "committedDate": "2020-09-16T06:18:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc1MDQ3NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r489750474", "bodyText": "As part of the updates for 5.0 we have updated the RPCStructs setters to be chainable, please update this method with a return this; and update the method signature\nPlease see issue #1421", "author": "RHenigan", "createdAt": "2020-09-16T20:59:00Z", "path": "base/src/main/java/com/smartdevicelink/proxy/rpc/VideoStreamingCapability.java", "diffHunk": "@@ -145,7 +146,22 @@ public Double getScale() {\n \t * @param scale the scaling factor the app should use to change the size of the projecting view.\n \t */\n \tpublic VideoStreamingCapability setScale( Double scale) {\n-        setValue(KEY_SCALE, scale);\n-        return this;\n-    }\n+\t\tsetValue(KEY_SCALE, scale);\n+\t\treturn this;\n+\t}\n+\n+\t/**\n+\t * @return the preferred frame rate per second (FPS) specified by head unit.\n+\t */\n+\tpublic Integer getPreferredFPS() {\n+\t\treturn getInteger(KEY_PREFERRED_FPS);\n+\t}\n+\n+\t/**\n+\t * @param preferredFPS preferred frame rate per second\n+\t */\n+\tpublic void setPreferredFPS(Integer preferredFPS) {\n+\t\tsetValue(KEY_PREFERRED_FPS, preferredFPS);", "originalCommit": "0aeb8da0119132f4b316c9d1983bbcfa9baba79f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgxMTE4Nw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r489811187", "bodyText": "Hi @RHenigan,\nThanks for pointing that out. I have updated the setPreferredFPS accordingly.", "author": "shiniwat", "createdAt": "2020-09-16T23:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc1MDQ3NA=="}], "type": "inlineReview", "revised_code": {"commit": "240aa2085a15ea00f179705d37c9054b8ccd5751", "chunk": "diff --git a/base/src/main/java/com/smartdevicelink/proxy/rpc/VideoStreamingCapability.java b/base/src/main/java/com/smartdevicelink/proxy/rpc/VideoStreamingCapability.java\nindex c5a22fd42..0ba642fe2 100644\n--- a/base/src/main/java/com/smartdevicelink/proxy/rpc/VideoStreamingCapability.java\n+++ b/base/src/main/java/com/smartdevicelink/proxy/rpc/VideoStreamingCapability.java\n\n@@ -160,8 +160,9 @@ public class VideoStreamingCapability extends RPCStruct {\n \t/**\n \t * @param preferredFPS preferred frame rate per second\n \t */\n-\tpublic void setPreferredFPS(Integer preferredFPS) {\n+\tpublic VideoStreamingCapability setPreferredFPS(Integer preferredFPS) {\n \t\tsetValue(KEY_PREFERRED_FPS, preferredFPS);\n+\t\treturn this;\n \t}\n \n }\n"}}, {"oid": "240aa2085a15ea00f179705d37c9054b8ccd5751", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/240aa2085a15ea00f179705d37c9054b8ccd5751", "message": "Update setPreferredFPS in VideoStreamingCapability as requested in PR review.", "committedDate": "2020-09-16T23:30:51Z", "type": "commit"}, {"oid": "e9453d0863256bfdf6ccaf8b45296019760f0398", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e9453d0863256bfdf6ccaf8b45296019760f0398", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361", "committedDate": "2020-09-22T11:13:30Z", "type": "commit"}, {"oid": "16ed070754fecd4aa2fa318eba9c325180bff570", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/16ed070754fecd4aa2fa318eba9c325180bff570", "message": "Fix a merge error in VideStreamingParameters.", "committedDate": "2020-09-22T12:14:48Z", "type": "commit"}, {"oid": "3c276eb8821f0e7df7da6b53a8afa67b798ece5b", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/3c276eb8821f0e7df7da6b53a8afa67b798ece5b", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361", "committedDate": "2020-12-04T05:19:00Z", "type": "commit"}, {"oid": "3adc0eaf12c453ad4ca4bf2adcff92408bf4350d", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/3adc0eaf12c453ad4ca4bf2adcff92408bf4350d", "message": "Implementing SDL 0323: Align VideoStreamingParameters with VideoStreamingCapability.", "committedDate": "2020-12-04T10:15:48Z", "type": "commit"}, {"oid": "37427ef09bf819d3d80586d8112d52aece006733", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/37427ef09bf819d3d80586d8112d52aece006733", "message": "Revert \"Implementing SDL 0323: Align VideoStreamingParameters with VideoStreamingCapability.\"\n\nThis reverts commit 3adc0eaf12c453ad4ca4bf2adcff92408bf4350d.", "committedDate": "2020-12-07T08:05:51Z", "type": "commit"}]}