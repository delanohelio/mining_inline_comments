{"pr_number": 4585, "pr_title": "CUSTCOM-194 The delete-jvm-options command shouldn't require to specify the Java version prefix", "pr_createdAt": "2020-03-22T21:28:16Z", "pr_url": "https://github.com/payara/Payara/pull/4585", "timeline": [{"oid": "9d8f273127d8afaa945d7bc93e88460ed583debc", "url": "https://github.com/payara/Payara/commit/9d8f273127d8afaa945d7bc93e88460ed583debc", "message": "CUSTCOM-194 The delete-jvm-options command shouldn't require to specify the Java version prefix", "committedDate": "2020-03-22T21:11:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0NDY3MQ==", "url": "https://github.com/payara/Payara/pull/4585#discussion_r396344671", "bodyText": "This construct fails in some cases when multiple options are removed.  Iterator is only initialised once, so you can have the situation that the second toRemoveOption value is already in the part of the iterator which has been traversed already.", "author": "rdebusscher", "createdAt": "2020-03-23T10:21:49Z", "path": "nucleus/core/kernel/src/main/java/com/sun/enterprise/v3/admin/commands/DeleteJvmOptions.java", "diffHunk": "@@ -158,12 +159,22 @@ public Object run(JavaConfig jc) throws PropertyVetoException, TransactionFailur\n     }\n     */\n     //@ForTimeBeing :)\n-    private void deleteX(final JvmOptionBag bag, final List<String> toRemove, final ActionReport.MessagePart part) throws Exception {\n+    private void deleteX(final JvmOptionBag bag, final List<String> toRemoveOptions, final ActionReport.MessagePart part) throws Exception {\n         SingleConfigCode<JvmOptionBag> scc = (JvmOptionBag bag1) -> {\n             List<String> jvmopts = new ArrayList<>(bag1.getJvmRawOptions());\n             int orig = jvmopts.size();\n-            // using new JvmOption(option).toString() (instead op option directly) to make sure the correct formatting is applied.\n-            boolean removed = jvmopts.removeIf(option -> toRemove.contains(new JvmOption(option).toString()));\n+            boolean removed = false;\n+            Iterator<String> iter = jvmopts.iterator();\n+            for (String toRemoveOption : toRemoveOptions) {\n+                String option = new JvmOption(toRemoveOption).option;\n+                while (iter.hasNext()) {", "originalCommit": "9d8f273127d8afaa945d7bc93e88460ed583debc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3NDA5Mw==", "url": "https://github.com/payara/Payara/pull/4585#discussion_r396374093", "bodyText": "@rdebusscher, you are right. It was a dumb mistake on my part", "author": "MeroRai", "createdAt": "2020-03-23T11:13:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0NDY3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "e363115114c81473fa73a3d00b57ea4da4c2a1e1", "chunk": "diff --git a/nucleus/core/kernel/src/main/java/com/sun/enterprise/v3/admin/commands/DeleteJvmOptions.java b/nucleus/core/kernel/src/main/java/com/sun/enterprise/v3/admin/commands/DeleteJvmOptions.java\nindex 5ca37839ae..1914dd60d0 100644\n--- a/nucleus/core/kernel/src/main/java/com/sun/enterprise/v3/admin/commands/DeleteJvmOptions.java\n+++ b/nucleus/core/kernel/src/main/java/com/sun/enterprise/v3/admin/commands/DeleteJvmOptions.java\n\n@@ -164,9 +164,10 @@ public final class DeleteJvmOptions implements AdminCommand, AdminCommandSecurit\n             List<String> jvmopts = new ArrayList<>(bag1.getJvmRawOptions());\n             int orig = jvmopts.size();\n             boolean removed = false;\n-            Iterator<String> iter = jvmopts.iterator();\n+            Iterator<String> iter;  \n             for (String toRemoveOption : toRemoveOptions) {\n                 String option = new JvmOption(toRemoveOption).option;\n+                iter = jvmopts.iterator();\n                 while (iter.hasNext()) {\n                     if (new JvmOption(iter.next()).option.equals(option)) {\n                         iter.remove();\n"}}, {"oid": "e363115114c81473fa73a3d00b57ea4da4c2a1e1", "url": "https://github.com/payara/Payara/commit/e363115114c81473fa73a3d00b57ea4da4c2a1e1", "message": "Now can delete multiple JVM options", "committedDate": "2020-03-24T10:47:48Z", "type": "commit"}]}