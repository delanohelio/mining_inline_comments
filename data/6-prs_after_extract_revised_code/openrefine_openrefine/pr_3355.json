{"pr_number": 3355, "pr_title": "Fix NPE bug in EditInspector", "pr_createdAt": "2020-11-25T06:15:06Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/3355", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTg5Mg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/3355#discussion_r530155892", "bodyText": "This was added by @darecoder to prefetch property documents in one API\u00a0call rather than requesting them one by one. I assume your IDE detected that the propertyDocuments variable was not used later on. I think we should just call getMultipleDocuments without storing the return result in a local variable. It would be good to have a comment here explaining why we are doing that.", "author": "wetneb", "createdAt": "2020-11-25T07:27:01Z", "path": "extensions/wikidata/src/org/openrefine/wikidata/qa/EditInspector.java", "diffHunk": "@@ -124,7 +123,6 @@ public void inspect(List<ItemUpdate> editBatch, WikibaseSchema schema) throws Ex\n         // so that all newly created entities appear in the batch\n         SchemaPropertyExtractor fetcher = new SchemaPropertyExtractor();\n         Set<PropertyIdValue> properties = fetcher.getAllProperties(schema);\n-        List<EntityDocument> propertyDocuments = entityCache.getMultipleDocuments(properties.stream().collect(Collectors.toList()));", "originalCommit": "6a108c5f4b5bee401e898854af5a6b3a7e92329e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE2MDQyMA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/3355#discussion_r530160420", "bodyText": "Got it!", "author": "afkbrb", "createdAt": "2020-11-25T07:37:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTg5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "e03b0babd7cc8a02717433362f10031c4ba21b26", "chunk": "diff --git a/extensions/wikidata/src/org/openrefine/wikidata/qa/EditInspector.java b/extensions/wikidata/src/org/openrefine/wikidata/qa/EditInspector.java\nindex 9dafb8d8f..d50331cbe 100644\n--- a/extensions/wikidata/src/org/openrefine/wikidata/qa/EditInspector.java\n+++ b/extensions/wikidata/src/org/openrefine/wikidata/qa/EditInspector.java\n\n@@ -123,6 +124,10 @@ public class EditInspector {\n         // so that all newly created entities appear in the batch\n         SchemaPropertyExtractor fetcher = new SchemaPropertyExtractor();\n         Set<PropertyIdValue> properties = fetcher.getAllProperties(schema);\n+        if (entityCache != null) {\n+            // Prefetch property documents in one API call rather than requesting them one by one.\n+            entityCache.getMultipleDocuments(properties.stream().collect(Collectors.toList()));\n+        }\n         WikibaseAPIUpdateScheduler scheduler = new WikibaseAPIUpdateScheduler();\n         editBatch = scheduler.schedule(editBatch);\n \n"}}, {"oid": "e03b0babd7cc8a02717433362f10031c4ba21b26", "url": "https://github.com/OpenRefine/OpenRefine/commit/e03b0babd7cc8a02717433362f10031c4ba21b26", "message": "fix #3354", "committedDate": "2020-11-25T07:45:31Z", "type": "commit"}, {"oid": "e03b0babd7cc8a02717433362f10031c4ba21b26", "url": "https://github.com/OpenRefine/OpenRefine/commit/e03b0babd7cc8a02717433362f10031c4ba21b26", "message": "fix #3354", "committedDate": "2020-11-25T07:45:31Z", "type": "forcePushed"}]}