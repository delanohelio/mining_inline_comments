{"pr_number": 2469, "pr_title": "make maxlag configurable", "pr_createdAt": "2020-03-24T05:34:14Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2469", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0MTE2MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2469#discussion_r396941161", "bodyText": "I would replace \"maxLag\" by something a bit more specific, to make sure there is no collision with anything else: for instance \"wikibase:upload:maxLag\".", "author": "wetneb", "createdAt": "2020-03-24T07:15:12Z", "path": "extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java", "diffHunk": "@@ -67,6 +70,14 @@\n     private int globalCursor;\n     private Map<String, EntityDocument> currentDocs;\n     private int batchSize;\n+    private static final String MAX_LAG_KEY = \"maxLag\";", "originalCommit": "af09b05d502157d9b4314ec71adec79e1d7e550a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMzMzYyMg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2469#discussion_r397333622", "bodyText": "will improve the naming.", "author": "james-cui", "createdAt": "2020-03-24T17:27:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0MTE2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "fce458f9f889ea1b47f95eb6e225b26827e5ec07", "chunk": "diff --git a/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java b/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java\nindex 963a6b8bc..023e100e8 100644\n--- a/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java\n+++ b/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java\n\n@@ -70,13 +70,16 @@ public class EditBatchProcessor {\n     private int globalCursor;\n     private Map<String, EntityDocument> currentDocs;\n     private int batchSize;\n-    private static final String MAX_LAG_KEY = \"maxLag\";\n+    private static final String MAX_LAG_KEY = \"wikibase:upload:maxLag\";\n     private static final int MAX_LAG_DEFAULT = 5000;      // 5 second default maxLag\n     private PreferenceStore prefStore = ProjectManager.singleton.getPreferenceStore();\n \n     private int getMaxLag() {\n-        return prefStore.get(MAX_LAG_KEY) == null ? MAX_LAG_DEFAULT :\n-                Integer.parseInt((String) prefStore.get(MAX_LAG_KEY));\n+\ttry {\n+\t\treturn Integer.parseInt((String) prefStore.get(MAX_LAG_KEY));\n+\t} catch (NumberFormatException e) {\n+\t\treturn MAX_LAG_DEFAULT;\n+\t}\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0MTU2NA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2469#discussion_r396941564", "bodyText": "What happens if parseInt fails?\u00a0 Should it fall back to the default?", "author": "wetneb", "createdAt": "2020-03-24T07:16:18Z", "path": "extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java", "diffHunk": "@@ -67,6 +70,14 @@\n     private int globalCursor;\n     private Map<String, EntityDocument> currentDocs;\n     private int batchSize;\n+    private static final String MAX_LAG_KEY = \"maxLag\";\n+    private static final int MAX_LAG_DEFAULT = 5000;      // 5 second default maxLag\n+    private PreferenceStore prefStore = ProjectManager.singleton.getPreferenceStore();\n+\n+    private int getMaxLag() {\n+        return prefStore.get(MAX_LAG_KEY) == null ? MAX_LAG_DEFAULT :\n+                Integer.parseInt((String) prefStore.get(MAX_LAG_KEY));", "originalCommit": "af09b05d502157d9b4314ec71adec79e1d7e550a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMzNDM5MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2469#discussion_r397334391", "bodyText": "good catch, I should wrap the code in a try catch and use default if user put something invalid.", "author": "james-cui", "createdAt": "2020-03-24T17:28:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0MTU2NA=="}], "type": "inlineReview", "revised_code": {"commit": "fce458f9f889ea1b47f95eb6e225b26827e5ec07", "chunk": "diff --git a/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java b/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java\nindex 963a6b8bc..023e100e8 100644\n--- a/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java\n+++ b/extensions/wikidata/src/org/openrefine/wikidata/editing/EditBatchProcessor.java\n\n@@ -70,13 +70,16 @@ public class EditBatchProcessor {\n     private int globalCursor;\n     private Map<String, EntityDocument> currentDocs;\n     private int batchSize;\n-    private static final String MAX_LAG_KEY = \"maxLag\";\n+    private static final String MAX_LAG_KEY = \"wikibase:upload:maxLag\";\n     private static final int MAX_LAG_DEFAULT = 5000;      // 5 second default maxLag\n     private PreferenceStore prefStore = ProjectManager.singleton.getPreferenceStore();\n \n     private int getMaxLag() {\n-        return prefStore.get(MAX_LAG_KEY) == null ? MAX_LAG_DEFAULT :\n-                Integer.parseInt((String) prefStore.get(MAX_LAG_KEY));\n+\ttry {\n+\t\treturn Integer.parseInt((String) prefStore.get(MAX_LAG_KEY));\n+\t} catch (NumberFormatException e) {\n+\t\treturn MAX_LAG_DEFAULT;\n+\t}\n     }\n \n     /**\n"}}, {"oid": "fce458f9f889ea1b47f95eb6e225b26827e5ec07", "url": "https://github.com/OpenRefine/OpenRefine/commit/fce458f9f889ea1b47f95eb6e225b26827e5ec07", "message": "make maxlag configurable", "committedDate": "2020-03-25T00:09:53Z", "type": "forcePushed"}, {"oid": "4fd35ecaaa952eff68428167703ff900a33f7b1e", "url": "https://github.com/OpenRefine/OpenRefine/commit/4fd35ecaaa952eff68428167703ff900a33f7b1e", "message": "make maxlag configurable", "committedDate": "2020-03-26T04:36:22Z", "type": "commit"}, {"oid": "4fd35ecaaa952eff68428167703ff900a33f7b1e", "url": "https://github.com/OpenRefine/OpenRefine/commit/4fd35ecaaa952eff68428167703ff900a33f7b1e", "message": "make maxlag configurable", "committedDate": "2020-03-26T04:36:22Z", "type": "forcePushed"}]}