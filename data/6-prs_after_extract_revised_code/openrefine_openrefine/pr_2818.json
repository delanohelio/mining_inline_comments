{"pr_number": 2818, "pr_title": "Implemented SingleValue Scrutinizer tests using mocks", "pr_createdAt": "2020-06-26T08:06:24Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2818", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAzNzY2MA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2818#discussion_r446037660", "bodyText": "I think all exceptions can accept constraints, so how about we pull the parsing code in this class to a common superclass of all the inner classes you have been introducing?", "author": "wetneb", "createdAt": "2020-06-26T08:17:19Z", "path": "extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java", "diffHunk": "@@ -44,6 +49,24 @@\n public class SingleValueScrutinizer extends EditScrutinizer {\n \n     public static final String type = \"single-valued-property-added-more-than-once\";\n+    public static String SINGLE_VALUE_CONSTRAINT_QID = \"Q19474404\";\n+    public static String SINGLE_VALUE_CONSTRAINT_EXCEPTION = \"P2303\";\n+\n+    class SingleValueConstraint {", "originalCommit": "17654afe3271aa4418cf7969180e715bcafc20aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA2NTk4OQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2818#discussion_r446065989", "bodyText": "Sure, we can make a constraint class that will be extended by these inner classes. And check what all parameters can be added over there other than exceptions that are generally common to all property constraints.", "author": "darecoder", "createdAt": "2020-06-26T09:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAzNzY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA2ODI0NQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2818#discussion_r446068245", "bodyText": "Great! Constraint status is another one.", "author": "wetneb", "createdAt": "2020-06-26T09:17:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAzNzY2MA=="}], "type": "inlineReview", "revised_code": {"commit": "f2d0dce8fe643769f759e83063943ec3764af9ed", "chunk": "diff --git a/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java b/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java\nindex a64f9b7a2..4c611b439 100644\n--- a/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java\n+++ b/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java\n\n@@ -50,6 +49,7 @@ public class SingleValueScrutinizer extends EditScrutinizer {\n \n     public static final String type = \"single-valued-property-added-more-than-once\";\n     public static String SINGLE_VALUE_CONSTRAINT_QID = \"Q19474404\";\n+    public static String SINGLE_BEST_VALUE_CONSTRAINT_QID = \"Q52060874\";\n     public static String SINGLE_VALUE_CONSTRAINT_EXCEPTION = \"P2303\";\n \n     class SingleValueConstraint {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4NjIxOA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2818#discussion_r446686218", "bodyText": "You should not need to declare a new field for constraint exceptions again:\u00a0you can just reuse the one from the super class. So, for all constraints which do not take any parameters, you should not need to declare any inner class: the Constraint class itself can be used in the scrutinizer.", "author": "wetneb", "createdAt": "2020-06-28T19:05:07Z", "path": "extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java", "diffHunk": "@@ -44,6 +46,17 @@\n public class SingleValueScrutinizer extends EditScrutinizer {\n \n     public static final String type = \"single-valued-property-added-more-than-once\";\n+    public static String SINGLE_VALUE_CONSTRAINT_QID = \"Q19474404\";\n+    public static String SINGLE_BEST_VALUE_CONSTRAINT_QID = \"Q52060874\";\n+\n+    class SingleValueConstraint extends Constraint {\n+        Set<EntityIdValue> constraintExceptions;\n+\n+        SingleValueConstraint(Statement statement) {\n+            super(statement);\n+            constraintExceptions = getConstraintExceptions();", "originalCommit": "8f8f4b565d0a5022ab5fefd6d539ef73834f7834", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "547d0a5d35fda02ffed4b307770ead767301d497", "chunk": "diff --git a/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java b/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java\nindex bcbbaeb03..a64f9b7a2 100644\n--- a/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java\n+++ b/extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/SingleValueScrutinizer.java\n\n@@ -47,14 +50,21 @@ public class SingleValueScrutinizer extends EditScrutinizer {\n \n     public static final String type = \"single-valued-property-added-more-than-once\";\n     public static String SINGLE_VALUE_CONSTRAINT_QID = \"Q19474404\";\n-    public static String SINGLE_BEST_VALUE_CONSTRAINT_QID = \"Q52060874\";\n+    public static String SINGLE_VALUE_CONSTRAINT_EXCEPTION = \"P2303\";\n \n-    class SingleValueConstraint extends Constraint {\n-        Set<EntityIdValue> constraintExceptions;\n+    class SingleValueConstraint {\n+        Set<Value> constraintExceptions;\n \n         SingleValueConstraint(Statement statement) {\n-            super(statement);\n-            constraintExceptions = getConstraintExceptions();\n+            constraintExceptions = new HashSet<>();\n+            List<SnakGroup> snakGroupList = statement.getClaim().getQualifiers();\n+            for(SnakGroup group : snakGroupList) {\n+                for (Snak snak : group.getSnaks()) {\n+                    if (group.getProperty().getId().equals(SINGLE_VALUE_CONSTRAINT_EXCEPTION)){\n+                        constraintExceptions.add(snak.getValue());\n+                    }\n+                }\n+            }\n         }\n     }\n \n"}}, {"oid": "547d0a5d35fda02ffed4b307770ead767301d497", "url": "https://github.com/OpenRefine/OpenRefine/commit/547d0a5d35fda02ffed4b307770ead767301d497", "message": "Implemented SingleValue Scrutinizer tests using mocks\n\nUpdated test class & added inner class to the scrutinizer", "committedDate": "2020-06-29T06:50:11Z", "type": "commit"}, {"oid": "f2d0dce8fe643769f759e83063943ec3764af9ed", "url": "https://github.com/OpenRefine/OpenRefine/commit/f2d0dce8fe643769f759e83063943ec3764af9ed", "message": "tests updated", "committedDate": "2020-06-29T06:50:11Z", "type": "commit"}, {"oid": "041a8c3bb000a2c9201c8776eaddb350af29a4d4", "url": "https://github.com/OpenRefine/OpenRefine/commit/041a8c3bb000a2c9201c8776eaddb350af29a4d4", "message": "Updated SingleValueConstraint class", "committedDate": "2020-06-29T06:54:56Z", "type": "commit"}]}