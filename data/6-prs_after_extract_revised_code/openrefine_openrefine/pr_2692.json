{"pr_number": 2692, "pr_title": "Use Apache HTTP Commons for Fetch URL", "pr_createdAt": "2020-06-11T02:36:49Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2692", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzIxMQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r439803211", "bodyText": "Shouldn't checks like header.name != \"\" use equals instead?", "author": "wetneb", "createdAt": "2020-06-14T08:03:33Z", "path": "main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java", "diffHunk": "@@ -134,8 +151,34 @@ public ColumnAdditionByFetchingURLsOperation(\n         _delay = delay;\n         _cacheResponses = cacheResponses;\n         _httpHeadersJson = httpHeadersJson;\n+\n+        List<Header> headers = new ArrayList<Header>();\n+        if (_httpHeadersJson != null) {\n+            for (HttpHeader header : _httpHeadersJson) {\n+                if (header.name != null && header.name != \"\" && header.value != null && header.value != \"\") {", "originalCommit": "caa159bd5720174f0977b039ce55ea3471ed2bab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1ODA2MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r439858061", "bodyText": "Yes, of course! I'll fix it.", "author": "tfmorris", "createdAt": "2020-06-14T18:57:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzIxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyMTgyMA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r440521820", "bodyText": "Done.", "author": "tfmorris", "createdAt": "2020-06-16T00:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzIxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "45865fd9fcafb1207edd00fdd632f2a92e47f14c", "chunk": "diff --git a/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java b/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java\nindex d2ff58949..a3e5bfc6a 100644\n--- a/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java\n+++ b/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java\n\n@@ -155,7 +157,7 @@ public class ColumnAdditionByFetchingURLsOperation extends EngineDependentOperat\n         List<Header> headers = new ArrayList<Header>();\n         if (_httpHeadersJson != null) {\n             for (HttpHeader header : _httpHeadersJson) {\n-                if (header.name != null && header.name != \"\" && header.value != null && header.value != \"\") {\n+                if (!isNullOrEmpty(header.name) && !isNullOrEmpty(header.value)) {\n                     headers.add(new BasicHeader(header.name, header.value));\n                 }\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzMxOQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r439803319", "bodyText": "Why is this code commented out?", "author": "wetneb", "createdAt": "2020-06-14T08:05:01Z", "path": "main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java", "diffHunk": "@@ -134,8 +151,34 @@ public ColumnAdditionByFetchingURLsOperation(\n         _delay = delay;\n         _cacheResponses = cacheResponses;\n         _httpHeadersJson = httpHeadersJson;\n+\n+        List<Header> headers = new ArrayList<Header>();\n+        if (_httpHeadersJson != null) {\n+            for (HttpHeader header : _httpHeadersJson) {\n+                if (header.name != null && header.name != \"\" && header.value != null && header.value != \"\") {\n+                    headers.add(new BasicHeader(header.name, header.value));\n+                }\n+            }\n+        }\n+        httpHeaders = headers.toArray(httpHeaders);\n+\n+        defaultRequestConfig = RequestConfig.custom()\n+                .setConnectTimeout(30 * 1000)\n+                .setConnectionRequestTimeout(30 * 1000)\n+                .setSocketTimeout(10 * 1000).build();\n+\n+//        CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+//        credsProvider.setCredentials(new AuthScope(host, 443),\n+//                new UsernamePasswordCredentials(user, password));", "originalCommit": "caa159bd5720174f0977b039ce55ea3471ed2bab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1ODE1Ng==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r439858156", "bodyText": "It's not part of the current functionality, so not included in the refactoring. I left it as a placeholder for future feature enhancement, but I can remove it if you think that would be cleaner.", "author": "tfmorris", "createdAt": "2020-06-14T18:58:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1OTIzNA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r439859234", "bodyText": "Ah yes, I thought we supported this already, but we only expose an Authorization header in the UI. I generally try to avoid committing commented out code, but if you want to leave it as a demo for future improvements, it could be worth explaining that intention with a comment, perhaps?", "author": "wetneb", "createdAt": "2020-06-14T19:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyMTkxMg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2692#discussion_r440521912", "bodyText": "Comment added", "author": "tfmorris", "createdAt": "2020-06-16T00:40:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwMzMxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "45865fd9fcafb1207edd00fdd632f2a92e47f14c", "chunk": "diff --git a/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java b/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java\nindex d2ff58949..a3e5bfc6a 100644\n--- a/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java\n+++ b/main/src/com/google/refine/operations/column/ColumnAdditionByFetchingURLsOperation.java\n\n@@ -155,7 +157,7 @@ public class ColumnAdditionByFetchingURLsOperation extends EngineDependentOperat\n         List<Header> headers = new ArrayList<Header>();\n         if (_httpHeadersJson != null) {\n             for (HttpHeader header : _httpHeadersJson) {\n-                if (header.name != null && header.name != \"\" && header.value != null && header.value != \"\") {\n+                if (!isNullOrEmpty(header.name) && !isNullOrEmpty(header.value)) {\n                     headers.add(new BasicHeader(header.name, header.value));\n                 }\n             }\n"}}, {"oid": "45865fd9fcafb1207edd00fdd632f2a92e47f14c", "url": "https://github.com/OpenRefine/OpenRefine/commit/45865fd9fcafb1207edd00fdd632f2a92e47f14c", "message": "Address review comments", "committedDate": "2020-06-16T00:37:12Z", "type": "forcePushed"}, {"oid": "1a420d722a554f2385511ce1a78eb34375ab6bb2", "url": "https://github.com/OpenRefine/OpenRefine/commit/1a420d722a554f2385511ce1a78eb34375ab6bb2", "message": "Use mockwebserver instead of live network for tests\n\nFixes #2680. Fixes #1904.", "committedDate": "2020-06-16T00:42:11Z", "type": "commit"}, {"oid": "62aca8bd6c0b7e251a879495bd6d581e4ea47141", "url": "https://github.com/OpenRefine/OpenRefine/commit/62aca8bd6c0b7e251a879495bd6d581e4ea47141", "message": "Remove use of deprecated methods", "committedDate": "2020-06-16T00:42:11Z", "type": "commit"}, {"oid": "1ed99a49bf69654defd9536507f8c79fa4e316b9", "url": "https://github.com/OpenRefine/OpenRefine/commit/1ed99a49bf69654defd9536507f8c79fa4e316b9", "message": "Convert to use Apache HTTP Components client library\n\nFixes #1410 by virtue of redirect following being a built-in\ncapability of the library, along with retries with binary backoff,\nbuilt-in decompression, etc.", "committedDate": "2020-06-16T00:42:11Z", "type": "commit"}, {"oid": "045d2d8702f72eb3a39e9fcbd5fc744d7a4ca77f", "url": "https://github.com/OpenRefine/OpenRefine/commit/045d2d8702f72eb3a39e9fcbd5fc744d7a4ca77f", "message": "Address review comments", "committedDate": "2020-06-16T00:42:11Z", "type": "commit"}, {"oid": "045d2d8702f72eb3a39e9fcbd5fc744d7a4ca77f", "url": "https://github.com/OpenRefine/OpenRefine/commit/045d2d8702f72eb3a39e9fcbd5fc744d7a4ca77f", "message": "Address review comments", "committedDate": "2020-06-16T00:42:11Z", "type": "forcePushed"}]}