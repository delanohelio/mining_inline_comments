{"pr_number": 527, "pr_title": "XRDDEV-404 audit logging", "pr_createdAt": "2020-05-28T20:42:04Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/527", "timeline": [{"oid": "71dcf9e251fa78aa17ecec366304aaf0654173c4", "url": "https://github.com/nordic-institute/X-Road/commit/71dcf9e251fa78aa17ecec366304aaf0654173c4", "message": "XRDDEV-404 add audit logging framework, and multiple events and properties", "committedDate": "2020-05-13T19:10:33Z", "type": "commit"}, {"oid": "1555ded88a6facc353b884710f226c3c4f8813cd", "url": "https://github.com/nordic-institute/X-Road/commit/1555ded88a6facc353b884710f226c3c4f8813cd", "message": "XRDDEV-404 fix broken tests", "committedDate": "2020-05-13T19:35:51Z", "type": "commit"}, {"oid": "8f86f200b76ab422d111099321263c334357d4c2", "url": "https://github.com/nordic-institute/X-Road/commit/8f86f200b76ab422d111099321263c334357d4c2", "message": "Merge branch 'develop' into XRDDEV-404-audit-logging\n\nFix Conflicts:\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/auth/securityconfigurer/FormLoginWebSecurityConfigurerAdapter.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/ClientsApiController.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/EndpointsApiController.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/ServicesApiController.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/AccessRightService.java\n\tsrc/proxy-ui-api/src/test/java/org/niis/xroad/restapi/service/KeyAndCertificateRequestServiceIntegrationTest.java", "committedDate": "2020-05-13T19:56:51Z", "type": "commit"}, {"oid": "d36eca75cd7fb79ba00fe894d23512dc9695961d", "url": "https://github.com/nordic-institute/X-Road/commit/d36eca75cd7fb79ba00fe894d23512dc9695961d", "message": "XRDDEV-404 add access rights to/from service/service client", "committedDate": "2020-05-13T21:01:09Z", "type": "commit"}, {"oid": "628b4394b7c9273bcc663b65634ed3be396defb2", "url": "https://github.com/nordic-institute/X-Road/commit/628b4394b7c9273bcc663b65634ed3be396defb2", "message": "XRDDEV-404 add connection type, internal tls certs, local group management", "committedDate": "2020-05-13T22:40:50Z", "type": "commit"}, {"oid": "107f44300223a734f4ded413dcafd24c17807f67", "url": "https://github.com/nordic-institute/X-Road/commit/107f44300223a734f4ded413dcafd24c17807f67", "message": "XRDDEV-404 finalize login, logout, language events", "committedDate": "2020-05-14T08:40:22Z", "type": "commit"}, {"oid": "c1600a885f7eaf77c3c6a89d4a38369d42d38b5b", "url": "https://github.com/nordic-institute/X-Road/commit/c1600a885f7eaf77c3c6a89d4a38369d42d38b5b", "message": "XRDDEV-404 add token login/logout, key and csr management, update audit log framework", "committedDate": "2020-05-14T18:42:35Z", "type": "commit"}, {"oid": "349148f8fc921fec58b62d19e26d028e38c24e96", "url": "https://github.com/nordic-institute/X-Road/commit/349148f8fc921fec58b62d19e26d028e38c24e96", "message": "XRDDEV-404 add rest of keys and certificates events, untested", "committedDate": "2020-05-15T06:53:29Z", "type": "commit"}, {"oid": "3128822e40e6cc2b46ba868a52dfa2f6f3abbb02", "url": "https://github.com/nordic-institute/X-Road/commit/3128822e40e6cc2b46ba868a52dfa2f6f3abbb02", "message": "XRDDEV-404 updates to keys and certificates events", "committedDate": "2020-05-19T08:37:04Z", "type": "commit"}, {"oid": "9d0c21bb5d701cb3cb6df0a5847c75f3b0efc7e1", "url": "https://github.com/nordic-institute/X-Road/commit/9d0c21bb5d701cb3cb6df0a5847c75f3b0efc7e1", "message": "XRDDEV-404 add backup operations", "committedDate": "2020-05-19T12:16:53Z", "type": "commit"}, {"oid": "61d660a4333a9caabcb6a65267cdd17a7451e290", "url": "https://github.com/nordic-institute/X-Road/commit/61d660a4333a9caabcb6a65267cdd17a7451e290", "message": "XRDDEV-404 add system parameters events, untested", "committedDate": "2020-05-19T13:08:58Z", "type": "commit"}, {"oid": "00c1a47419f255218bff599fd85f628419ab1749", "url": "https://github.com/nordic-institute/X-Road/commit/00c1a47419f255218bff599fd85f628419ab1749", "message": "Merge branch 'develop' into XRDDEV-404-audit-logging\n\nFix Conflicts:\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/SystemApiController.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/SystemService.java", "committedDate": "2020-05-20T09:25:14Z", "type": "commit"}, {"oid": "52bea5b6827cb2685403ecaeb25e1d7b82f29caa", "url": "https://github.com/nordic-institute/X-Road/commit/52bea5b6827cb2685403ecaeb25e1d7b82f29caa", "message": "XRDDEV-404 fix anchor hash", "committedDate": "2020-05-20T12:28:04Z", "type": "commit"}, {"oid": "39380f73d92abc26b926dfd7511644beeef40ddf", "url": "https://github.com/nordic-institute/X-Road/commit/39380f73d92abc26b926dfd7511644beeef40ddf", "message": "XRDDEV-404 fix wrong cert hashes from bytes", "committedDate": "2020-05-20T12:59:13Z", "type": "commit"}, {"oid": "a4e8c614fb06d9917fdc85608536f95cfb2de8e2", "url": "https://github.com/nordic-institute/X-Road/commit/a4e8c614fb06d9917fdc85608536f95cfb2de8e2", "message": "XRDDEV-404 add last audit log events: init", "committedDate": "2020-05-20T17:54:05Z", "type": "commit"}, {"oid": "e449ca6486625ff19168b5cc3786c8b02ef04860", "url": "https://github.com/nordic-institute/X-Road/commit/e449ca6486625ff19168b5cc3786c8b02ef04860", "message": "XRDDEV-404 remove audit-log-successes-once-per-request", "committedDate": "2020-05-25T08:26:04Z", "type": "commit"}, {"oid": "364a5531914de62ad8ea16472063891287a91c07", "url": "https://github.com/nordic-institute/X-Road/commit/364a5531914de62ad8ea16472063891287a91c07", "message": "XRDDEV-404 add auth key event properties", "committedDate": "2020-05-25T10:00:02Z", "type": "commit"}, {"oid": "dd960ca4258115c7671489fafd4dc3ee3cc3dd63", "url": "https://github.com/nordic-institute/X-Road/commit/dd960ca4258115c7671489fafd4dc3ee3cc3dd63", "message": "XRDDEV-404 fix broken test, update audit logback configuration", "committedDate": "2020-05-25T10:15:50Z", "type": "commit"}, {"oid": "d77bbb7f0033a6e1e42795df209b6d96b418db28", "url": "https://github.com/nordic-institute/X-Road/commit/d77bbb7f0033a6e1e42795df209b6d96b418db28", "message": "XRDDEV-404 AuditLogger comments and cleanup, improve audit log mocking in tests", "committedDate": "2020-05-25T11:15:07Z", "type": "commit"}, {"oid": "18ec339e5c8b3c1c135b0b2c74e759ab1ff23b89", "url": "https://github.com/nordic-institute/X-Road/commit/18ec339e5c8b3c1c135b0b2c74e759ab1ff23b89", "message": "XRDDEV-404 add tag install-xroad-ss-packages to enable skipping package installation, fix audit logback conf", "committedDate": "2020-05-25T12:26:19Z", "type": "commit"}, {"oid": "261b8b36e1571523f034bdc906717b3e2d735d6e", "url": "https://github.com/nordic-institute/X-Road/commit/261b8b36e1571523f034bdc906717b3e2d735d6e", "message": "XRDDEV-404 fix broken static resources, and AuditLogger logging everything as failures", "committedDate": "2020-05-25T16:55:06Z", "type": "commit"}, {"oid": "6369c5bde41a45cab127cf1aeb76f1d6219efef7", "url": "https://github.com/nordic-institute/X-Road/commit/6369c5bde41a45cab127cf1aeb76f1d6219efef7", "message": "XRDDEV-404 refactor", "committedDate": "2020-05-26T09:55:09Z", "type": "commit"}, {"oid": "fa5533bf37f0457fbfde35e213d8991662a95bea", "url": "https://github.com/nordic-institute/X-Road/commit/fa5533bf37f0457fbfde35e213d8991662a95bea", "message": "XRDDEV-404 refactor and comment", "committedDate": "2020-05-26T11:01:39Z", "type": "commit"}, {"oid": "26a09a67969769ed1e5eb201b6c113cf6dc413f5", "url": "https://github.com/nordic-institute/X-Road/commit/26a09a67969769ed1e5eb201b6c113cf6dc413f5", "message": "XRDDEV-404 add comments", "committedDate": "2020-05-26T11:57:56Z", "type": "commit"}, {"oid": "0157f995119674ada27c99f9f558297182d82cf4", "url": "https://github.com/nordic-institute/X-Road/commit/0157f995119674ada27c99f9f558297182d82cf4", "message": "XRDDEV-404 serialize auditlog null values. Note this may change SignerCLI audit logging", "committedDate": "2020-05-26T13:05:55Z", "type": "commit"}, {"oid": "a6dd75e6a219227d2acbb2b4fb1494179ba8d30d", "url": "https://github.com/nordic-institute/X-Road/commit/a6dd75e6a219227d2acbb2b4fb1494179ba8d30d", "message": "XRDDEV-404 add logging context to", "committedDate": "2020-05-27T06:23:36Z", "type": "commit"}, {"oid": "83a03afdf932dbd3122bcb8c114ebbd32cf65502", "url": "https://github.com/nordic-institute/X-Road/commit/83a03afdf932dbd3122bcb8c114ebbd32cf65502", "message": "XRDDEV-404 update event comments", "committedDate": "2020-05-27T15:36:12Z", "type": "commit"}, {"oid": "fe3b2a0df027a0c8ec11fe5563cecf2ecc07c0ee", "url": "https://github.com/nordic-institute/X-Road/commit/fe3b2a0df027a0c8ec11fe5563cecf2ecc07c0ee", "message": "Merge branch 'develop' into XRDDEV-404-audit-logging\n\nFix Conflicts:\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/repository/ClientRepository.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/AccessRightService.java\n\tsrc/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/LocalGroupService.java\n\tsrc/serverconf/src/main/java/ee/ria/xroad/common/conf/serverconf/dao/ClientDAOImpl.java", "committedDate": "2020-05-27T16:26:34Z", "type": "commit"}, {"oid": "ae75624f3a04496eae799c9f4583f48b8cbb6730", "url": "https://github.com/nordic-institute/X-Road/commit/ae75624f3a04496eae799c9f4583f48b8cbb6730", "message": "XRDDEV-404 skeleton of audit log test", "committedDate": "2020-05-27T17:21:49Z", "type": "commit"}, {"oid": "dfc328d99ad6aa1ca6c774732d7810791c60dc44", "url": "https://github.com/nordic-institute/X-Road/commit/dfc328d99ad6aa1ca6c774732d7810791c60dc44", "message": "XRDDEV-404 add simplistic tests", "committedDate": "2020-05-27T20:34:57Z", "type": "commit"}, {"oid": "acd182e07bd093c9c0f7f91409ba1a9c89f4b417", "url": "https://github.com/nordic-institute/X-Road/commit/acd182e07bd093c9c0f7f91409ba1a9c89f4b417", "message": "XRDDEV-404 add warning=true/false to failure logging", "committedDate": "2020-05-28T06:49:54Z", "type": "commit"}, {"oid": "bf129c19722a96c8df151ce93d864cb33b026b37", "url": "https://github.com/nordic-institute/X-Road/commit/bf129c19722a96c8df151ce93d864cb33b026b37", "message": "XRDDEV-404 refactor ServiceUpdate openapi schema to simplify", "committedDate": "2020-05-28T07:27:22Z", "type": "commit"}, {"oid": "02e72b1b19e91224a738ccee17ebc5bba57109bd", "url": "https://github.com/nordic-institute/X-Road/commit/02e72b1b19e91224a738ccee17ebc5bba57109bd", "message": "XRDDEV-404 remove unused set locale audit log event", "committedDate": "2020-05-28T08:32:35Z", "type": "commit"}, {"oid": "80a13e8474b41841df3a5a29670dcbe628b5e178", "url": "https://github.com/nordic-institute/X-Road/commit/80a13e8474b41841df3a5a29670dcbe628b5e178", "message": "XRDDEV-404: Changed services ssl_auth value to be set to true if it is not defined. Also added typings", "committedDate": "2020-05-28T09:59:16Z", "type": "commit"}, {"oid": "30aee2cdc698cf8dc45c99083d382b8b1aa59acb", "url": "https://github.com/nordic-institute/X-Road/commit/30aee2cdc698cf8dc45c99083d382b8b1aa59acb", "message": "Merge branch 'XRDDEV-404-audit-logging' of github.com:nordic-institute/X-Road into XRDDEV-404-audit-logging", "committedDate": "2020-05-28T12:45:05Z", "type": "commit"}, {"oid": "4dd80a170c261fff186fb8579d40da439939e3ce", "url": "https://github.com/nordic-institute/X-Road/commit/4dd80a170c261fff186fb8579d40da439939e3ce", "message": "XRDDEV-404 fix bug in CachingServerConfImpl.isSslAuthentication", "committedDate": "2020-05-28T12:59:33Z", "type": "commit"}, {"oid": "7d951800ff6513de816ce5d394c28b2d9f2e70fc", "url": "https://github.com/nordic-institute/X-Road/commit/7d951800ff6513de816ce5d394c28b2d9f2e70fc", "message": "XRDDEV-404 update delete orphans documentation", "committedDate": "2020-05-28T13:12:27Z", "type": "commit"}, {"oid": "b72887d8dc3ec60c7902a4c551736e7e0d22dc36", "url": "https://github.com/nordic-institute/X-Road/commit/b72887d8dc3ec60c7902a4c551736e7e0d22dc36", "message": "XRDDEV-404 updates based on specification discussions, and update documentation", "committedDate": "2020-05-28T16:45:06Z", "type": "commit"}, {"oid": "86a926d168559eb3940008108857b9c6372342e6", "url": "https://github.com/nordic-institute/X-Road/commit/86a926d168559eb3940008108857b9c6372342e6", "message": "XRDDEV-404 fix TODOs", "committedDate": "2020-05-28T18:58:24Z", "type": "commit"}, {"oid": "c1cf7c2fdae46481a8ea8ae7f53031cedd8acc3a", "url": "https://github.com/nordic-institute/X-Road/commit/c1cf7c2fdae46481a8ea8ae7f53031cedd8acc3a", "message": "XRDDEV-404 update docx documentation", "committedDate": "2020-05-28T19:37:26Z", "type": "commit"}, {"oid": "aa8444477ee4f29b4a59ebeb424186af657ebd16", "url": "https://github.com/nordic-institute/X-Road/commit/aa8444477ee4f29b4a59ebeb424186af657ebd16", "message": "XRDDEV-404 update docx documentation", "committedDate": "2020-05-28T20:02:01Z", "type": "commit"}, {"oid": "695d299ad76170ee5afe8e1e8b96a210d81007f2", "url": "https://github.com/nordic-institute/X-Road/commit/695d299ad76170ee5afe8e1e8b96a210d81007f2", "message": "XRDDEV-404 update docx documentation", "committedDate": "2020-05-28T20:06:01Z", "type": "commit"}, {"oid": "f811cf6e90f68417bbc2de20d66972b1baa3ba4f", "url": "https://github.com/nordic-institute/X-Road/commit/f811cf6e90f68417bbc2de20d66972b1baa3ba4f", "message": "XRDDEV-404 cleanup", "committedDate": "2020-05-28T20:38:27Z", "type": "commit"}, {"oid": "a725e5950ff0747fb17c6e0f7dfec3834cdc2242", "url": "https://github.com/nordic-institute/X-Road/commit/a725e5950ff0747fb17c6e0f7dfec3834cdc2242", "message": "XRDDEV-404 cleanup", "committedDate": "2020-05-29T07:12:33Z", "type": "commit"}, {"oid": "868afb98779921a3de2dc591498eef81ef8d74da", "url": "https://github.com/nordic-institute/X-Road/commit/868afb98779921a3de2dc591498eef81ef8d74da", "message": "XRDDEV-404 fix sonar problems", "committedDate": "2020-05-29T07:50:07Z", "type": "commit"}, {"oid": "a7e6df2a4bb422500880e3ced6271d16627b7b37", "url": "https://github.com/nordic-institute/X-Road/commit/a7e6df2a4bb422500880e3ced6271d16627b7b37", "message": "XRDDEV-404 add log error if audit data json serialization failed", "committedDate": "2020-05-29T12:41:24Z", "type": "commit"}, {"oid": "8d19e4cf97c61731d95d5f7173056e4c2528adc4", "url": "https://github.com/nordic-institute/X-Road/commit/8d19e4cf97c61731d95d5f7173056e4c2528adc4", "message": "XRDDEV-404 fix docx dynamic fields etc using office365", "committedDate": "2020-06-03T10:35:02Z", "type": "commit"}, {"oid": "fb83b6c734561eca05bc1afcf7ab3b6bb586c591", "url": "https://github.com/nordic-institute/X-Road/commit/fb83b6c734561eca05bc1afcf7ab3b6bb586c591", "message": "XRDDEV-404 update user guide about audit logging", "committedDate": "2020-06-03T11:04:38Z", "type": "commit"}, {"oid": "1a2f9c2f6565987698dcda4ce44bc60a2a9266cd", "url": "https://github.com/nordic-institute/X-Road/commit/1a2f9c2f6565987698dcda4ce44bc60a2a9266cd", "message": "XRDDEV-404 update correct audit event names for service description related events", "committedDate": "2020-06-03T12:10:18Z", "type": "commit"}, {"oid": "f44df32363199d77e77ad60da4ddb02c42d3e1b0", "url": "https://github.com/nordic-institute/X-Road/commit/f44df32363199d77e77ad60da4ddb02c42d3e1b0", "message": "XRDDEV-404 fix documentation about warnings and service description audit logs", "committedDate": "2020-06-03T12:18:26Z", "type": "commit"}, {"oid": "ac859f1acea363d87c584a93e352c186e684378f", "url": "https://github.com/nordic-institute/X-Road/commit/ac859f1acea363d87c584a93e352c186e684378f", "message": "Merge branch 'develop' into XRDDEV-404-audit-logging", "committedDate": "2020-06-03T14:51:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE5Njk3MA==", "url": "https://github.com/nordic-institute/X-Road/pull/527#discussion_r435196970", "bodyText": "Does the lazy inject actually work since AuditEventLoggingFacade is not a lazy bean?", "author": "carohauta", "createdAt": "2020-06-04T11:56:19Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ApplicationExceptionHandler.java", "diffHunk": "@@ -45,13 +52,18 @@\n     @Autowired\n     private ExceptionTranslator exceptionTranslator;\n \n+    @Autowired\n+    @Lazy\n+    private AuditEventLoggingFacade auditEventLoggingFacade;", "originalCommit": "ac859f1acea363d87c584a93e352c186e684378f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE5ODEyMA==", "url": "https://github.com/nordic-institute/X-Road/pull/527#discussion_r435198120", "bodyText": "If this annotation is not present on a Component or Bean definition, eager initialization will occur\n...\nIn addition to its role for component initialization, this annotation may also be placed on injection points marked with Autowired or Inject\n\n\u2013 Spring Documents: Lazy", "author": "carohauta", "createdAt": "2020-06-04T11:58:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE5Njk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgxNzg4NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/527#discussion_r435817885", "bodyText": "Good point! I don't think it works. It was a remnant of older implementation where AuditEventLoggingFacade was a request scoped bean, and injecting it would break when used from outside of request scope (like when exceptions happen during bootup)\nAuditEventLoggingFacade is now a regular bean so I removed those Lazy annotations.  Now only RequestScopedAuditEventData and RequestScopedLoggedAuditEvents are request scoped beans, and those are injected as lazy to RequestScopedAuditDataHolder", "author": "jansu76", "createdAt": "2020-06-05T09:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE5Njk3MA=="}], "type": "inlineReview", "revised_code": {"commit": "f7bdb488dc7f22396d747988c7492e83c7c97084", "chunk": "diff --git a/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ApplicationExceptionHandler.java b/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ApplicationExceptionHandler.java\nindex a2069490f..2c6defe0b 100644\n--- a/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ApplicationExceptionHandler.java\n+++ b/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ApplicationExceptionHandler.java\n\n@@ -53,7 +52,6 @@ public class ApplicationExceptionHandler {\n     private ExceptionTranslator exceptionTranslator;\n \n     @Autowired\n-    @Lazy\n     private AuditEventLoggingFacade auditEventLoggingFacade;\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIyMDYyOQ==", "url": "https://github.com/nordic-institute/X-Road/pull/527#discussion_r435220629", "bodyText": "Could it not be possible to use when(auditEventLoggingFacade).thenCallRealMethod(); in the AuditLoggingRestTemplateTest instead of this mock version of the facade? Or would it just assume that the mock(AuditEventLoggingFacade.class); in AuditLogMockingConfiguration is the actual real bean?", "author": "carohauta", "createdAt": "2020-06-04T12:39:18Z", "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/config/audit/MockableAuditEventLoggingFacade.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.config.audit;\n+\n+import org.niis.xroad.restapi.util.RequestHelper;\n+import org.niis.xroad.restapi.util.SecurityHelper;\n+import org.niis.xroad.restapi.util.UsernameHelper;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Map;\n+\n+@Component\n+@Profile({ \"test\"})\n+public class MockableAuditEventLoggingFacade extends AuditEventLoggingFacade {", "originalCommit": "ac859f1acea363d87c584a93e352c186e684378f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgxOTM0Ng==", "url": "https://github.com/nordic-institute/X-Road/pull/527#discussion_r435819346", "bodyText": "MockableAuditEventLoggingFacade exists to make callAuditLoggerLogSuccess and callAuditLoggerLogFailure public, so that tests can verify() them. It's maybe not the perfect design, and there could be alternatives, like moving AuditLoggingRestTemplateTest to package org.niis.xroad.restapi.config.audit....but maybe I will keep it like it is?", "author": "jansu76", "createdAt": "2020-06-05T09:59:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIyMDYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgyMjM3MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/527#discussion_r435822371", "bodyText": "Yes there are the usual multiple alternatives how to achieve this. I don't see so much benefit in changing the current implementation so we can keep it this way \ud83d\udc4d", "author": "carohauta", "createdAt": "2020-06-05T10:05:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIyMDYyOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f7bdb488dc7f22396d747988c7492e83c7c97084", "url": "https://github.com/nordic-institute/X-Road/commit/f7bdb488dc7f22396d747988c7492e83c7c97084", "message": "XRDDEV-404 fix bad Lazy definitions based on PR comments", "committedDate": "2020-06-05T09:52:39Z", "type": "commit"}]}