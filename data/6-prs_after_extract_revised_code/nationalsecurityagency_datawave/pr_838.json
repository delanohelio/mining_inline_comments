{"pr_number": 838, "pr_title": "Fixes #713 auto close failed queries", "pr_createdAt": "2020-06-23T14:20:28Z", "pr_url": "https://github.com/NationalSecurityAgency/datawave/pull/838", "timeline": [{"oid": "139ef5c84f61bc426a2971009ee6f92da29f5eb9", "url": "https://github.com/NationalSecurityAgency/datawave/commit/139ef5c84f61bc426a2971009ee6f92da29f5eb9", "message": "close id in else condition", "committedDate": "2020-06-23T14:13:19Z", "type": "commit"}, {"oid": "232e2f22bbe5382762d799d1803bd40410a7749e", "url": "https://github.com/NationalSecurityAgency/datawave/commit/232e2f22bbe5382762d799d1803bd40410a7749e", "message": "Merge branch 'master' into closequery", "committedDate": "2020-06-23T14:44:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkwNTI2NQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/838#discussion_r450905265", "bodyText": "It appears that this close may throw an exception in certain cases.  So this close should be wrapped in a try catch and log the error:\ntry {\n  close(id);\n} catch (Exception ce) {\n  log.error(qe, ce);\n}", "author": "ivakegg", "createdAt": "2020-07-07T14:24:59Z", "path": "web-services/query/src/main/java/datawave/webservice/query/runner/QueryExecutorBean.java", "diffHunk": "@@ -2026,6 +2026,7 @@ private BaseQueryResponse next(final String id, boolean checkForContentLookup) {\n                 close(id);\n                 closedQueryCache.add(id); // remember that we auto-closed this query\n             } else {\n+                close(id);", "originalCommit": "232e2f22bbe5382762d799d1803bd40410a7749e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0b6c488afa6bf98c5f71d4e6f266103c6e9f625a", "chunk": "diff --git a/web-services/query/src/main/java/datawave/webservice/query/runner/QueryExecutorBean.java b/web-services/query/src/main/java/datawave/webservice/query/runner/QueryExecutorBean.java\nindex bb6a08762..29b090e5e 100644\n--- a/web-services/query/src/main/java/datawave/webservice/query/runner/QueryExecutorBean.java\n+++ b/web-services/query/src/main/java/datawave/webservice/query/runner/QueryExecutorBean.java\n\n@@ -2026,7 +2026,11 @@ public class QueryExecutorBean implements QueryExecutor {\n                 close(id);\n                 closedQueryCache.add(id); // remember that we auto-closed this query\n             } else {\n-                close(id);\n+                try {\n+                    close(id);\n+                } catch (Exception ce){\n+                    log.error(qe, ce);\n+                }\n                 log.error(qe, e);\n                 response.addException(qe.getBottomQueryException());\n             }\n"}}, {"oid": "0b6c488afa6bf98c5f71d4e6f266103c6e9f625a", "url": "https://github.com/NationalSecurityAgency/datawave/commit/0b6c488afa6bf98c5f71d4e6f266103c6e9f625a", "message": "add try catch", "committedDate": "2020-07-07T14:46:55Z", "type": "commit"}, {"oid": "1bd1110b20ef4159cf8cff5357a512b544d33ff0", "url": "https://github.com/NationalSecurityAgency/datawave/commit/1bd1110b20ef4159cf8cff5357a512b544d33ff0", "message": "Merge branch 'master' into closequery", "committedDate": "2020-07-07T14:48:14Z", "type": "commit"}, {"oid": "cbd37062780a64bd680fe5d269185e701f0efaee", "url": "https://github.com/NationalSecurityAgency/datawave/commit/cbd37062780a64bd680fe5d269185e701f0efaee", "message": "auto format", "committedDate": "2020-07-07T16:02:33Z", "type": "commit"}, {"oid": "c2839e756b12958b789036da27d32f578dfd4252", "url": "https://github.com/NationalSecurityAgency/datawave/commit/c2839e756b12958b789036da27d32f578dfd4252", "message": "Merge branch 'master' into closequery", "committedDate": "2020-07-29T18:40:52Z", "type": "commit"}, {"oid": "2e8c3f2d7fb686a24e56dacb1dab648d8b23be98", "url": "https://github.com/NationalSecurityAgency/datawave/commit/2e8c3f2d7fb686a24e56dacb1dab648d8b23be98", "message": "Merge branch 'master' into closequery", "committedDate": "2020-07-29T21:59:14Z", "type": "commit"}, {"oid": "ebb7fdbf2545bc0eee0315f47a41922731595d47", "url": "https://github.com/NationalSecurityAgency/datawave/commit/ebb7fdbf2545bc0eee0315f47a41922731595d47", "message": "Merge branch 'master' into closequery", "committedDate": "2020-07-29T22:04:39Z", "type": "commit"}]}