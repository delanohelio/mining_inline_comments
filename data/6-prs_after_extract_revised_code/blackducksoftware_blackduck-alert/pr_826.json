{"pr_number": 826, "pr_title": "Ps certificate tests", "pr_createdAt": "2020-01-23T22:04:02Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/826", "timeline": [{"oid": "ca9afa6fb55864aba9ab010d10de54121541ebcf", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ca9afa6fb55864aba9ab010d10de54121541ebcf", "message": "Fix(tests): Add tests for CertificateActions.", "committedDate": "2020-01-23T18:40:47Z", "type": "commit"}, {"oid": "5e38df913d3601c874139b93196d1d12c51db33f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/5e38df913d3601c874139b93196d1d12c51db33f", "message": "Fix(test): Implement tests for the CertificateActions class.", "committedDate": "2020-01-23T22:01:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYzMDc1Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/826#discussion_r370630757", "bodyText": "This line may also throw an exception and I'm not sure how we want to handle it.", "author": "gkillough", "createdAt": "2020-01-24T13:24:21Z", "path": "src/main/java/com/synopsys/integration/alert/web/certificates/CertificateActions.java", "diffHunk": "@@ -76,9 +76,15 @@ public CertificateModel createCertificate(CertificateModel certificateModel) thr\n \n     private CertificateModel importCertificate(CertificateModel certificateModel) throws AlertException {\n         CustomCertificateModel certificateToStore = convertToDatabaseModel(certificateModel);\n-        CustomCertificateModel storedCertificate = certificateAccessor.storeCertificate(certificateToStore);\n-        certificateUtility.importCertificate(storedCertificate);\n-        return convertFromDatabaseModel(storedCertificate);\n+        try {\n+            CustomCertificateModel storedCertificate = certificateAccessor.storeCertificate(certificateToStore);\n+            certificateUtility.importCertificate(storedCertificate);\n+            return convertFromDatabaseModel(storedCertificate);\n+        } catch (AlertException ex) {\n+            certificateAccessor.deleteCertificate(certificateToStore.getAlias());\n+            certificateUtility.removeCertificate(certificateToStore.getAlias());", "originalCommit": "5e38df913d3601c874139b93196d1d12c51db33f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "29cfcac0c8684bfacfea6f6fa924bb92a19aa950", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/certificates/CertificateActions.java b/src/main/java/com/synopsys/integration/alert/web/certificates/CertificateActions.java\nindex f577c48d4..47ebfb494 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/certificates/CertificateActions.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/certificates/CertificateActions.java\n\n@@ -63,14 +66,17 @@ public class CertificateActions {\n         if (null != certificateModel.getId()) {\n             throw new AlertDatabaseConstraintException(\"id cannot be present to create a new certificate on the server.\");\n         }\n+        logger.info(\"Importing certificate with alias {}\", certificateModel.getAlias());\n         return importCertificate(certificateModel);\n     }\n \n     public Optional<CertificateModel> updateCertificate(Long id, CertificateModel certificateModel) throws AlertException {\n         Optional<CustomCertificateModel> existingCertificate = certificateAccessor.getCertificate(id);\n+        logger.info(\"Updating certificate with id: {} and alias: {}\", certificateModel.getId(), certificateModel.getAlias());\n         if (existingCertificate.isPresent()) {\n             return Optional.ofNullable(importCertificate(certificateModel));\n         }\n+        logger.error(\"Certificate with id: {} missing.\", certificateModel.getId());\n         return Optional.empty();\n     }\n \n"}}, {"oid": "29cfcac0c8684bfacfea6f6fa924bb92a19aa950", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/29cfcac0c8684bfacfea6f6fa924bb92a19aa950", "message": "Refactor(certs): Add logging for the certificate actions.", "committedDate": "2020-01-24T14:41:01Z", "type": "commit"}]}