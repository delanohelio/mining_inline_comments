{"pr_number": 1162, "pr_title": "Create a better well defined API for actions and controllers", "pr_createdAt": "2020-09-10T15:29:04Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162", "timeline": [{"oid": "c4d1725df2b0a0d55c38d337e88f11f0aec7eccd", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c4d1725df2b0a0d55c38d337e88f11f0aec7eccd", "message": "feat: Start implementing abstract actions.", "committedDate": "2020-09-04T19:55:36Z", "type": "commit"}, {"oid": "f4e01de4a6ffc1b7f1c7b3855faffb4685f3abee", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f4e01de4a6ffc1b7f1c7b3855faffb4685f3abee", "message": "feat: Initial implementation of abstract action class.", "committedDate": "2020-09-08T12:49:25Z", "type": "commit"}, {"oid": "04acb3ca495ab8e01e4dfa46b59897671e81abeb", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/04acb3ca495ab8e01e4dfa46b59897671e81abeb", "message": "refactor: Change the certificates controller to implement new interface.", "committedDate": "2020-09-08T20:35:50Z", "type": "commit"}, {"oid": "39bdee6e6897d739cd249e6f274bb61965219968", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/39bdee6e6897d739cd249e6f274bb61965219968", "message": "feat: Implement Job and Config actions.", "committedDate": "2020-09-09T15:28:22Z", "type": "commit"}, {"oid": "523364897938337d95bbf45c9937e32207192e25", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/523364897938337d95bbf45c9937e32207192e25", "message": "fix: Fix the reset password test.", "committedDate": "2020-09-09T15:48:15Z", "type": "commit"}, {"oid": "c1786e339713ce0ddfa6e42c011a7a4712329292", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c1786e339713ce0ddfa6e42c011a7a4712329292", "message": "refactor: ConfigController and ConfigActions use new abstract classes.", "committedDate": "2020-09-09T19:18:42Z", "type": "commit"}, {"oid": "283c521bd308a36c351d62a6d21dcd7411a890c3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/283c521bd308a36c351d62a6d21dcd7411a890c3", "message": "refactor: Change Job controller and actions.", "committedDate": "2020-09-10T13:07:41Z", "type": "commit"}, {"oid": "7b95e78e638862ea3c404f3196d1e0ccbcae81d2", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7b95e78e638862ea3c404f3196d1e0ccbcae81d2", "message": "refactor: Rename some methods to make more sense in the Swagger doc.", "committedDate": "2020-09-10T14:06:39Z", "type": "commit"}, {"oid": "374d1dddcdb270528498838ae5bbd469ce46b21e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/374d1dddcdb270528498838ae5bbd469ce46b21e", "message": "Merge remote-tracking branch 'origin/feat_action_response' into ps_abstract_actions", "committedDate": "2020-09-10T14:34:10Z", "type": "commit"}, {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "message": "fix: Fix parsing the job id to avoid an exception.", "committedDate": "2020-09-10T15:27:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MjQyNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r486442425", "bodyText": "The PKIX SSL error that displays an error message in the UI.  The object that needs to be created for the PKIX exception is a message and an isDetailed boolean.  This object was created to supply the same result object for a PKIX error.", "author": "psantos1113", "createdAt": "2020-09-10T15:38:43Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/SSLValidationResponseModel.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action;\n+\n+import java.util.Map;\n+\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+\n+public class SSLValidationResponseModel extends ValidationResponseModel {\n+    private boolean isDetailed;\n+\n+    public SSLValidationResponseModel(String message) {", "originalCommit": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NDU4MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r486444580", "bodyText": "This class checks permissions and validates the content first.  The abstract methods are to be implemented by a concrete class to perform the functionality.", "author": "psantos1113", "createdAt": "2020-09-10T15:41:37Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {", "originalCommit": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\nindex 7d03ae7c9..797531497 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n\n@@ -52,27 +52,27 @@ public abstract class AbstractConfigResourceActions implements ResourceActions<F\n         this.authorizationManager = authorizationManager;\n     }\n \n-    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+    protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+    protected abstract ActionResponse<List<FieldModel>> readAllAfterChecks();\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName);\n \n     protected abstract Optional<FieldModel> findFieldModel(Long id);\n \n-    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+    protected abstract ValidationActionResponse testAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource);\n \n-    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+    protected abstract ValidationActionResponse validateAfterChecks(FieldModel resource);\n \n     public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n         if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n             return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n         }\n-        return readAllByContextAndDescriptor(context, descriptorName);\n+        return readAllByContextAndDescriptorAfterChecks(context, descriptorName);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NzkwNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r486447904", "bodyText": "This class can be used by classes that deal with resources other than FieldModel or JobFieldModel i.e. CertificateActions, UserActions,RoleActions, and TaskActions.", "author": "psantos1113", "createdAt": "2020-09-10T15:46:13Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractResourceActions<T> implements ResourceActions<T>, ValidateAction<T>, TestAction<T> {", "originalCommit": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\nindex 0badaa132..dd0997f1a 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\n\n@@ -23,6 +23,7 @@\n package com.synopsys.integration.alert.common.action.api;\n \n import java.util.List;\n+import java.util.Optional;\n \n import org.springframework.http.HttpStatus;\n \n"}}, {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "message": "refactor: Remove unused code in certificates and fix tests.", "committedDate": "2020-09-10T19:08:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyMDc3MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487020770", "bodyText": "I'm thinking that when we further separate Alert into sub-projects, the models for the REST API stuff should be moved into that sub-project as well. That way we can avoid misusing the models and bogging down alert-common.", "author": "gkillough", "createdAt": "2020-09-11T12:47:00Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/ValidationActionResponse.java", "diffHunk": "@@ -22,12 +22,32 @@\n  */\n package com.synopsys.integration.alert.common.action;", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTc4OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487055789", "bodyText": "I think after this PR and the feature branch are merged into master we will no longer need to use AlertFieldException and IntegrationRestException in Alert.  So the static method in this ValidationActionResponse will be able to be removed also.", "author": "psantos1113", "createdAt": "2020-09-11T13:46:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyMDc3MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f79d758c6a9f2d558b2728c4089863a4791796c5", "message": "fix: Rename FieldValueModel  to  to fix serialization.", "committedDate": "2020-09-11T12:48:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyNTE2Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487025162", "bodyText": "Looking at these names and how they are used below, we might want to distinguish them a little more from each other. Maybe instead of the public create and the protected createResource, the public method could be called createWithPermissionCheck and the protected method could be called createWithoutPermissionCheck or something along those lines.", "author": "gkillough", "createdAt": "2020-09-11T12:54:45Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(FieldModel resource);", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MTAyMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487041020", "bodyText": "I would prefer to change the names of the abstract methods because the public methods are displayed in the Swagger API.  To an end user they just want to create, read, update, delete, validate, or test the resources. Whether we perform permission checks or not should not be exposed to them.", "author": "psantos1113", "createdAt": "2020-09-11T13:22:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyNTE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1MTQ2Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487051467", "bodyText": "Aren't the actions invoked by the controllers? The name of the method in the controller should be the name that is displayed, no?", "author": "gkillough", "createdAt": "2020-09-11T13:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyNTE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2ODM3OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487068378", "bodyText": "You're right been looking at this code for too long.", "author": "psantos1113", "createdAt": "2020-09-11T14:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyNTE2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\nindex 7d03ae7c9..797531497 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n\n@@ -52,27 +52,27 @@ public abstract class AbstractConfigResourceActions implements ResourceActions<F\n         this.authorizationManager = authorizationManager;\n     }\n \n-    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+    protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+    protected abstract ActionResponse<List<FieldModel>> readAllAfterChecks();\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName);\n \n     protected abstract Optional<FieldModel> findFieldModel(Long id);\n \n-    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+    protected abstract ValidationActionResponse testAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource);\n \n-    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+    protected abstract ValidationActionResponse validateAfterChecks(FieldModel resource);\n \n     public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n         if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n             return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n         }\n-        return readAllByContextAndDescriptor(context, descriptorName);\n+        return readAllByContextAndDescriptorAfterChecks(context, descriptorName);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyODAzMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487028033", "bodyText": "It might be worthwhile to create an enhancement request for AuthorizationManager to have methods that also take collections of enums.", "author": "gkillough", "createdAt": "2020-09-11T12:59:48Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+\n+    public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n+        if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllByContextAndDescriptor(context, descriptorName);\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> create(FieldModel resource) {\n+        if (!authorizationManager.hasCreatePermission(resource.getContext(), resource.getDescriptorName())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<FieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name(), ConfigContextEnum.GLOBAL.name()), descriptorNames)) {", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MjkxMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487042910", "bodyText": "Yeah I was going to make that change in this set of code changes but I will add it separately.", "author": "psantos1113", "createdAt": "2020-09-11T13:25:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyODAzMw=="}], "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\nindex 7d03ae7c9..797531497 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n\n@@ -52,27 +52,27 @@ public abstract class AbstractConfigResourceActions implements ResourceActions<F\n         this.authorizationManager = authorizationManager;\n     }\n \n-    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+    protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+    protected abstract ActionResponse<List<FieldModel>> readAllAfterChecks();\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName);\n \n     protected abstract Optional<FieldModel> findFieldModel(Long id);\n \n-    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+    protected abstract ValidationActionResponse testAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource);\n \n-    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+    protected abstract ValidationActionResponse validateAfterChecks(FieldModel resource);\n \n     public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n         if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n             return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n         }\n-        return readAllByContextAndDescriptor(context, descriptorName);\n+        return readAllByContextAndDescriptorAfterChecks(context, descriptorName);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyOTU2NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487029565", "bodyText": "Based on the way this class is used (i.e. in a controller) is this case actually possible? If the RequestMapping requires an id, and an id is missing from the request, then it will either be a call to the \"getAll\" endpoint (if one exists) or Spring will return a 404.", "author": "gkillough", "createdAt": "2020-09-11T13:02:42Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+\n+    public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n+        if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllByContextAndDescriptor(context, descriptorName);\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> create(FieldModel resource) {\n+        if (!authorizationManager.hasCreatePermission(resource.getContext(), resource.getDescriptorName())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<FieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name(), ConfigContextEnum.GLOBAL.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            return readAllResources();\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading configurations: %s\", ex.getMessage()));\n+        }\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> getOne(Long id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, AbstractResourceActions.RESOURCE_IDENTIFIER_MISSING);\n+        }", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MzUyNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487043527", "bodyText": "Just tested this out Spring throws an exception if it's the wrong type so I will remove that.", "author": "psantos1113", "createdAt": "2020-09-11T13:26:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyOTU2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\nindex 7d03ae7c9..797531497 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n\n@@ -52,27 +52,27 @@ public abstract class AbstractConfigResourceActions implements ResourceActions<F\n         this.authorizationManager = authorizationManager;\n     }\n \n-    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+    protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+    protected abstract ActionResponse<List<FieldModel>> readAllAfterChecks();\n \n-    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName);\n \n     protected abstract Optional<FieldModel> findFieldModel(Long id);\n \n-    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+    protected abstract ValidationActionResponse testAfterChecks(FieldModel resource);\n \n-    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+    protected abstract ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource);\n \n-    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+    protected abstract ValidationActionResponse validateAfterChecks(FieldModel resource);\n \n     public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n         if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n             return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n         }\n-        return readAllByContextAndDescriptor(context, descriptorName);\n+        return readAllByContextAndDescriptorAfterChecks(context, descriptorName);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNDE5Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487034192", "bodyText": "Same thought as the previous class. We should make it more explicit what the difference between something like ActionResponse<JobFieldModel> create(JobFieldModel resource) and ActionResponse<JobFieldModel> createResource(JobFieldModel resource) is.", "author": "gkillough", "createdAt": "2020-09-11T13:10:48Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteResource(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllResources();\n+\n+    protected abstract ValidationActionResponse testResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateResource(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(JobFieldModel resource);", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\nindex 4f6e37c9b..75eb36db5 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n\n@@ -38,7 +38,7 @@ import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNDcwNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487034705", "bodyText": "Same thought as the previous class.", "author": "gkillough", "createdAt": "2020-09-11T13:11:36Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteResource(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllResources();\n+\n+    protected abstract ValidationActionResponse testResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateResource(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(JobFieldModel resource);\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n+        boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n+        if (!hasPermissions) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<JobFieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            List<JobFieldModel> models = new LinkedList<>();\n+            ActionResponse<List<JobFieldModel>> response = readAllResources();\n+            List<JobFieldModel> allModels = response.getContent().orElse(List.of());\n+            for (JobFieldModel jobModel : allModels) {\n+                boolean includeJob = hasRequiredPermissions(jobModel.getFieldModels(), authorizationManager::hasReadPermission);\n+                if (includeJob) {\n+                    models.add(jobModel);\n+                }\n+            }\n+            return new ActionResponse<>(HttpStatus.OK, models);\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading job configurations: %s\", ex.getMessage()));\n+        }\n+\n+    }\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> getOne(UUID id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, AbstractResourceActions.RESOURCE_IDENTIFIER_MISSING);\n+        }", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\nindex 4f6e37c9b..75eb36db5 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n\n@@ -38,7 +38,7 @@ import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNjI5OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487036299", "bodyText": "When the constructor for ActionResponse would take a null parameter, we should either add a static initializer or a new constructor without the message parameter.", "author": "gkillough", "createdAt": "2020-09-11T13:14:21Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteResource(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllResources();\n+\n+    protected abstract ValidationActionResponse testResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateResource(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(JobFieldModel resource);\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n+        boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n+        if (!hasPermissions) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<JobFieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            List<JobFieldModel> models = new LinkedList<>();\n+            ActionResponse<List<JobFieldModel>> response = readAllResources();\n+            List<JobFieldModel> allModels = response.getContent().orElse(List.of());\n+            for (JobFieldModel jobModel : allModels) {\n+                boolean includeJob = hasRequiredPermissions(jobModel.getFieldModels(), authorizationManager::hasReadPermission);\n+                if (includeJob) {\n+                    models.add(jobModel);\n+                }\n+            }\n+            return new ActionResponse<>(HttpStatus.OK, models);\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading job configurations: %s\", ex.getMessage()));\n+        }\n+\n+    }\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> getOne(UUID id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, AbstractResourceActions.RESOURCE_IDENTIFIER_MISSING);\n+        }\n+\n+        Optional<JobFieldModel> optionalModel = findJobFieldModel(id);\n+\n+        if (optionalModel.isPresent()) {\n+            JobFieldModel fieldModel = optionalModel.get();\n+            boolean hasPermissions = hasRequiredPermissions(fieldModel.getFieldModels(), authorizationManager::hasReadPermission);\n+            if (!hasPermissions) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            return new ActionResponse<>(HttpStatus.OK, fieldModel);\n+        }\n+\n+        return new ActionResponse<>(HttpStatus.NOT_FOUND, null);", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0NDExMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487044110", "bodyText": "We have a constructor that takes the status only.  I missed some places where that should be used.  I will fix that.", "author": "psantos1113", "createdAt": "2020-09-11T13:27:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNjI5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\nindex 4f6e37c9b..75eb36db5 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n\n@@ -38,7 +38,7 @@ import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzOTcyNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487039726", "bodyText": "Should this extend ResourceActions?", "author": "gkillough", "createdAt": "2020-09-11T13:20:10Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/JobResourceActions.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.UUID;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+\n+public interface JobResourceActions {", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0NTg2Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487045866", "bodyText": "If I add another Generic to resource actions to define the type for the ids then yes it would be possible.  The id type for Jobs is UUID and other resources is a Long.  Hindsight being 2020 perhaps the ids should have always been a UUID but because we have two different ID types I didn't want to make it extend.", "author": "psantos1113", "createdAt": "2020-09-11T13:30:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzOTcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1MjY1Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487052653", "bodyText": "Ok, I think this could be a future enhancement if we ever migrate to UUIDs across the board.", "author": "gkillough", "createdAt": "2020-09-11T13:41:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzOTcyNg=="}], "type": "inlineReview", "revised_code": {"commit": "21256a169e148361ee2907b34c3c351b652ff130", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/JobResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/JobResourceActions.java\nindex e8e0237de..c1a72e3ab 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/JobResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/JobResourceActions.java\n\n@@ -22,20 +22,7 @@\n  */\n package com.synopsys.integration.alert.common.action.api;\n \n-import java.util.List;\n-import java.util.UUID;\n-\n-import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n \n-public interface JobResourceActions {\n-    ActionResponse<JobFieldModel> create(JobFieldModel resource);\n-\n-    ActionResponse<List<JobFieldModel>> getAll();\n-\n-    ActionResponse<JobFieldModel> getOne(UUID id);\n-\n-    ActionResponse<JobFieldModel> update(UUID id, JobFieldModel resource);\n-\n-    ActionResponse<JobFieldModel> delete(UUID id);\n+public interface JobResourceActions extends UUIDResourceActions<JobFieldModel> {\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MTQ2OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487041468", "bodyText": "Should this call setValues with Set.of() if the parameter is null?", "author": "gkillough", "createdAt": "2020-09-11T13:22:56Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/FieldValueModel.java", "diffHunk": "@@ -60,7 +60,9 @@ public void setValues(Collection<String> values) {\n     }\n \n     public void setValue(String value) {\n-        setValues(Set.of(value));\n+        if (null != value) {\n+            setValues(Set.of(value));\n+        }", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0NjY3OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487046678", "bodyText": "yes good catch.", "author": "psantos1113", "createdAt": "2020-09-11T13:31:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MTQ2OA=="}], "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/FieldValueModel.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/FieldValueModel.java\nindex 8689c10d1..5793c654d 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/FieldValueModel.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/FieldValueModel.java\n\n@@ -60,17 +60,21 @@ public class FieldValueModel extends AlertSerializableModel {\n     }\n \n     public void setValue(String value) {\n-        if (null != value) {\n+        if (null == value) {\n+            setValues(Set.of());\n+        } else {\n             setValues(Set.of(value));\n         }\n     }\n \n-    public boolean isSet() {\n+    // DO NOT CHANGE this method name unless you change the UI. Alert is serializing this object in controllers. Spring uses Jackson which uses getters and setters to serialize fields.\n+    // Jackson will remove the is, get, and set prefixes from method names to determine the field names for the JSON object.  This changes what the UI expects so get was added to the method name.\n+    public boolean getIsSet() {\n         return isSet;\n     }\n \n-    public void setIsSet(boolean set) {\n-        isSet = set;\n+    public void setIsSet(boolean isSet) {\n+        this.isSet = isSet;\n     }\n \n     public boolean hasValues() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MjcwMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487042703", "bodyText": "Won't configActions.update check write permissions? Should the if-statement check if the id is present to determine whether to create or update?", "author": "gkillough", "createdAt": "2020-09-11T13:25:04Z", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/web/AzureBoardsCustomFunctionAction.java", "diffHunk": "@@ -155,11 +155,13 @@ private OAuthEndpointResponse createErrorResponse(String errorMessage) {\n         if (StringUtils.isNotBlank(fieldModel.getId())) {\n             if (authorizationManager.hasWritePermission(ConfigContextEnum.GLOBAL.name(), azureBoardsChannelKey.getUniversalKey())) {\n                 Long id = Long.parseLong(fieldModel.getId());\n-                return Optional.ofNullable(configActions.updateConfig(id, fieldModel));\n+                ActionResponse<FieldModel> response = configActions.update(id, fieldModel);", "originalCommit": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1Mzk0NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487053944", "bodyText": "yes", "author": "psantos1113", "createdAt": "2020-09-11T13:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MjcwMw=="}], "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/channel/azure/boards/web/AzureBoardsCustomFunctionAction.java b/src/main/java/com/synopsys/integration/alert/channel/azure/boards/web/AzureBoardsCustomFunctionAction.java\nindex 5c92de21c..f3cec7a5b 100644\n--- a/src/main/java/com/synopsys/integration/alert/channel/azure/boards/web/AzureBoardsCustomFunctionAction.java\n+++ b/src/main/java/com/synopsys/integration/alert/channel/azure/boards/web/AzureBoardsCustomFunctionAction.java\n\n@@ -151,20 +128,15 @@ public class AzureBoardsCustomFunctionAction extends CustomFunctionAction<OAuthE\n         return new OAuthEndpointResponse(false, \"\", errorMessage);\n     }\n \n-    private Optional<FieldModel> saveIfValid(FieldModel fieldModel) throws AlertException {\n+    private Optional<FieldModel> saveIfValid(FieldModel fieldModel) {\n         if (StringUtils.isNotBlank(fieldModel.getId())) {\n-            if (authorizationManager.hasWritePermission(ConfigContextEnum.GLOBAL.name(), azureBoardsChannelKey.getUniversalKey())) {\n-                Long id = Long.parseLong(fieldModel.getId());\n-                ActionResponse<FieldModel> response = configActions.update(id, fieldModel);\n-                return response.getContent();\n-            }\n+            Long id = Long.parseLong(fieldModel.getId());\n+            ActionResponse<FieldModel> response = configActions.update(id, fieldModel);\n+            return response.getContent();\n         } else {\n-            if (authorizationManager.hasCreatePermission(ConfigContextEnum.GLOBAL.name(), azureBoardsChannelKey.getUniversalKey())) {\n-                ActionResponse<FieldModel> response = configActions.create(fieldModel);\n-                return response.getContent();\n-            }\n+            ActionResponse<FieldModel> response = configActions.create(fieldModel);\n+            return response.getContent();\n         }\n-        return Optional.empty();\n     }\n \n     private FieldAccessor createFieldAccessor(FieldModel fieldModel) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0NTgwMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487045803", "bodyText": "Will this clash with the overridden validate method?", "author": "gkillough", "createdAt": "2020-09-11T13:30:11Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "diffHunk": "@@ -22,316 +22,83 @@\n  */\n package com.synopsys.integration.alert.web.api.job;\n \n-import java.util.Collection;\n-import java.util.EnumSet;\n-import java.util.LinkedList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Set;\n import java.util.UUID;\n-import java.util.function.BiFunction;\n-import java.util.stream.Collectors;\n \n-import org.apache.commons.lang3.StringUtils;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n-import org.springframework.http.ResponseEntity;\n-import org.springframework.web.bind.annotation.DeleteMapping;\n import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.PathVariable;\n import org.springframework.web.bind.annotation.PostMapping;\n-import org.springframework.web.bind.annotation.PutMapping;\n import org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RestController;\n \n-import com.synopsys.integration.alert.common.ContentConverter;\n-import com.synopsys.integration.alert.common.descriptor.Descriptor;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n-import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n-import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n-import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n-import com.synopsys.integration.alert.common.exception.AlertFieldException;\n-import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n-import com.synopsys.integration.alert.common.message.model.MessageResult;\n-import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n-import com.synopsys.integration.alert.common.persistence.model.PermissionKey;\n-import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.rest.ResponseFactory;\n-import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.api.BaseJobResourceController;\n+import com.synopsys.integration.alert.common.rest.api.ReadAllController;\n+import com.synopsys.integration.alert.common.rest.api.TestController;\n+import com.synopsys.integration.alert.common.rest.api.ValidateController;\n import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n-import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.web.api.config.ConfigController;\n-import com.synopsys.integration.alert.web.common.BaseController;\n-import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n-import com.synopsys.integration.exception.IntegrationException;\n-import com.synopsys.integration.function.ThrowingFunction;\n-import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @RestController\n @RequestMapping(JobConfigController.JOB_CONFIGURATION_PATH)\n-public class JobConfigController extends BaseController {\n+public class JobConfigController implements BaseJobResourceController, ReadAllController, TestController<JobFieldModel>, ValidateController<JobFieldModel> {\n     public static final String JOB_CONFIGURATION_PATH = ConfigController.CONFIGURATION_PATH + \"/job\";\n-    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n-    private final Logger logger = LoggerFactory.getLogger(JobConfigController.class);\n     private final JobConfigActions jobConfigActions;\n-    private final ResponseFactory responseFactory;\n-    private final ContentConverter contentConverter;\n-    private final AuthorizationManager authorizationManager;\n-    private final DescriptorAccessor descriptorAccessor;\n-    private final DescriptorMap descriptorMap;\n-    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n \n     @Autowired\n-    public JobConfigController(JobConfigActions jobConfigActions, ResponseFactory responseFactory, ContentConverter contentConverter, AuthorizationManager authorizationManager,\n-        DescriptorAccessor descriptorAccessor, PKIXErrorResponseFactory pkixErrorResponseFactory, DescriptorMap descriptorMap) {\n+    public JobConfigController(JobConfigActions jobConfigActions) {\n         this.jobConfigActions = jobConfigActions;\n-        this.responseFactory = responseFactory;\n-        this.contentConverter = contentConverter;\n-        this.authorizationManager = authorizationManager;\n-        this.descriptorAccessor = descriptorAccessor;\n-        this.pkixErrorResponseFactory = pkixErrorResponseFactory;\n-        this.descriptorMap = descriptorMap;\n     }\n \n-    @GetMapping\n-    public ResponseEntity<String> getJobs() {\n-        try {\n-            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n-                                              .stream()\n-                                              .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n-                                              .map(RegisteredDescriptorModel::getName)\n-                                              .collect(Collectors.toSet());\n-            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name()), descriptorNames)) {\n-                return responseFactory.createForbiddenResponse();\n-            }\n-            List<JobFieldModel> models = new LinkedList<>();\n-            List<JobFieldModel> allModels = jobConfigActions.getAllJobs();\n-\n-            for (JobFieldModel jobModel : allModels) {\n-                boolean includeJob = hasRequiredPermissions(jobModel.getFieldModels(), authorizationManager::hasReadPermission);\n-                if (includeJob) {\n-                    models.add(jobModel);\n-                }\n-            }\n-            return responseFactory.createOkContentResponse(contentConverter.getJsonString(models));\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createMessageResponse(HttpStatus.INTERNAL_SERVER_ERROR, \"There was an issue retrieving data from the database.\");\n-        }\n-    }\n-\n-    @GetMapping(\"/{id}\")\n-    public ResponseEntity<String> getJob(@PathVariable UUID id) {\n-        Optional<JobFieldModel> optionalModel;\n-        try {\n-            optionalModel = jobConfigActions.getJobById(id);\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createMessageResponse(HttpStatus.INTERNAL_SERVER_ERROR, \"There was an issue retrieving data from the database for ID: \" + id);\n-        }\n-\n-        if (optionalModel.isPresent()) {\n-            JobFieldModel fieldModel = optionalModel.get();\n-            boolean hasPermissions = hasRequiredPermissions(fieldModel.getFieldModels(), authorizationManager::hasReadPermission);\n-            if (!hasPermissions) {\n-                return responseFactory.createForbiddenResponse();\n-            }\n-            return responseFactory.createOkContentResponse(contentConverter.getJsonString(fieldModel));\n-        }\n-\n-        return responseFactory.createNotFoundResponse(\"Configuration not found for the specified id\");\n-    }\n-\n-    @PostMapping\n-    public ResponseEntity<String> postConfig(@RequestBody(required = true) JobFieldModel restModel) {\n-        boolean hasPermissions = hasRequiredPermissions(restModel.getFieldModels(), authorizationManager::hasCreatePermission);\n-        if (!hasPermissions) {\n-            return responseFactory.createForbiddenResponse();\n-        }\n-\n-        try {\n-            return runPostConfig(restModel);\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createInternalServerErrorResponse(restModel.getJobId(), e.getMessage());\n-        }\n-    }\n-\n-    private ResponseEntity<String> runPostConfig(JobFieldModel restModel) throws AlertException {\n-        String id = restModel.getJobId();\n-        if (StringUtils.isNotBlank(id) && jobConfigActions.doesJobExist(id)) {\n-            return responseFactory.createConflictResponse(id, \"Provided id must not be in use. To update an existing configuration, use PUT.\");\n-        }\n-\n-        try {\n-            JobFieldModel updatedEntity = jobConfigActions.saveJob(restModel);\n-            return responseFactory.createCreatedResponse(updatedEntity.getJobId(), \"Created\");\n-        } catch (AlertFieldException e) {\n-            return responseFactory.createFieldErrorResponse(id, \"There were errors with the configuration.\", e.getFieldErrors());\n-        }\n-    }\n-\n-    @PutMapping(\"/{id}\")\n-    public ResponseEntity<String> putConfig(@PathVariable UUID id, @RequestBody(required = true) JobFieldModel restModel) {\n-        boolean hasPermissions = hasRequiredPermissions(restModel.getFieldModels(), authorizationManager::hasWritePermission);\n-        if (!hasPermissions) {\n-            return responseFactory.createForbiddenResponse();\n-        }\n-\n-        try {\n-            return runPutConfig(id, restModel);\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createInternalServerErrorResponse(restModel.getJobId(), e.getMessage());\n-        }\n+    @GetMapping(\"/validate\")\n+    public List<JobFieldStatuses> validateJobs() {", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0ODIwMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487048200", "bodyText": "no because the overridden validate method is a POST mapping and takes a parameter.  The method signature is different and has a different request mapping associated with it.  They do not conflict.", "author": "psantos1113", "createdAt": "2020-09-11T13:34:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0NTgwMw=="}], "type": "inlineReview", "revised_code": {"commit": "21256a169e148361ee2907b34c3c351b652ff130", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java b/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java\nindex 0d2061b8b..49faf9efd 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java\n\n@@ -56,7 +56,7 @@ public class JobConfigController implements BaseJobResourceController, ReadAllCo\n     }\n \n     @GetMapping(\"/validate\")\n-    public List<JobFieldStatuses> validateJobs() {\n+    public List<JobFieldStatuses> getValidationResultsForJobs() {\n         return ResponseFactory.createContentResponseFromAction(jobConfigActions.validateAllJobs());\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NDYxNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487054617", "bodyText": "Missing a space before \"{}\"", "author": "gkillough", "createdAt": "2020-09-11T13:44:36Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java", "diffHunk": "@@ -28,77 +28,116 @@\n import java.util.stream.Collectors;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.lang3.math.NumberUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.action.api.AbstractResourceActions;\n import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n-import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.exception.AlertException;\n-import com.synopsys.integration.alert.common.exception.AlertFieldException;\n import com.synopsys.integration.alert.common.persistence.accessor.CustomCertificateAccessor;\n import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.common.security.CertificateUtility;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n import com.synopsys.integration.alert.component.certificates.CertificatesDescriptor;\n+import com.synopsys.integration.alert.component.certificates.CertificatesDescriptorKey;\n import com.synopsys.integration.util.IntegrationEscapeUtil;\n \n @Component\n-public class CertificateActions {\n+public class CertificateActions extends AbstractResourceActions<CertificateModel> {\n     private final Logger logger = LoggerFactory.getLogger(CertificateActions.class);\n     private static final String ERROR_DUPLICATE_ALIAS = \"A certificate with this alias already exists.\";\n     private final CertificateUtility certificateUtility;\n     private final CustomCertificateAccessor certificateAccessor;\n     private final IntegrationEscapeUtil escapeUtil;\n \n     @Autowired\n-    public CertificateActions(CustomCertificateAccessor certificateAccessor, CertificateUtility certificateUtility) {\n+    public CertificateActions(CertificatesDescriptorKey descriptorKey, AuthorizationManager authorizationManager, CustomCertificateAccessor certificateAccessor, CertificateUtility certificateUtility) {\n+        super(descriptorKey, ConfigContextEnum.GLOBAL, authorizationManager);\n         this.certificateAccessor = certificateAccessor;\n         this.certificateUtility = certificateUtility;\n         escapeUtil = new IntegrationEscapeUtil();\n     }\n \n-    public List<CertificateModel> readCertificates() {\n-        return certificateAccessor.getCertificates().stream()\n-                   .map(this::convertFromDatabaseModel)\n-                   .collect(Collectors.toList());\n+    @Override\n+    public ActionResponse<List<CertificateModel>> readAllResources() {\n+        List<CertificateModel> certificates = certificateAccessor.getCertificates().stream()\n+                                                  .map(this::convertFromDatabaseModel)\n+                                                  .collect(Collectors.toList());\n+        return new ActionResponse<>(HttpStatus.OK, certificates);\n     }\n \n-    public Optional<CertificateModel> readCertificate(Long id) {\n-        return certificateAccessor.getCertificate(id)\n-                   .map(this::convertFromDatabaseModel);\n+    @Override\n+    public ActionResponse<CertificateModel> readResource(Long id) {\n+        Optional<CertificateModel> model = certificateAccessor.getCertificate(id)\n+                                               .map(this::convertFromDatabaseModel);\n+        if (model.isPresent()) {\n+            return new ActionResponse<>(HttpStatus.OK, model.get());\n+        }\n+\n+        return new ActionResponse<>(HttpStatus.NOT_FOUND, String.format(\"Certificate with id:%d not found.\", id));\n     }\n \n-    public ValidationResponseModel validateCertificate(CertificateModel certificateModel) {\n-        List<AlertFieldStatus> fieldErrors = validateCertificateFields(certificateModel);\n+    @Override\n+    public ValidationActionResponse testResource(CertificateModel resource) {\n+        return validateResource(resource);\n+    }\n+\n+    @Override\n+    public ValidationActionResponse validateResource(CertificateModel resource) {\n+        ValidationResponseModel responseModel;\n+        if (StringUtils.isNotBlank(resource.getId()) && !NumberUtils.isCreatable(resource.getId())) {\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"Invalid resource id\");\n+            return new ValidationActionResponse(HttpStatus.BAD_REQUEST, responseModel);\n+        }\n+        List<AlertFieldStatus> fieldErrors = validateCertificateFields(resource);\n         if (fieldErrors.isEmpty()) {\n-            return ValidationResponseModel.withoutFieldStatuses(\"The certificate configuration is valid\");\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"The certificate configuration is valid\");\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n         }\n-        return ValidationResponseModel.fromStatusCollection(\"There were problems with the certificate configuration\", fieldErrors);\n+        responseModel = ValidationResponseModel.fromStatusCollection(\"There were problems with the certificate configuration\", fieldErrors);\n+        return new ValidationActionResponse(HttpStatus.BAD_REQUEST, responseModel);\n     }\n \n-    public CertificateModel createCertificate(CertificateModel certificateModel) throws AlertException {\n-        if (null != certificateModel.getId()) {\n-            throw new AlertDatabaseConstraintException(\"id cannot be present to create a new certificate on the server.\");\n-        }\n-        validateCertificateModel(certificateModel);\n-        String loggableAlias = escapeUtil.replaceWithUnderscore(certificateModel.getAlias());\n+    @Override\n+    public ActionResponse<CertificateModel> createResource(CertificateModel resource) {\n+        String loggableAlias = escapeUtil.replaceWithUnderscore(resource.getAlias());\n         logger.info(\"Importing certificate with alias {}\", loggableAlias);\n-        return importCertificate(certificateModel);\n+        try {\n+            CertificateModel certificateModel = importCertificate(resource);\n+            return new ActionResponse<>(HttpStatus.OK, certificateModel);\n+        } catch (AlertException ex) {\n+            String message = ex.getMessage();\n+            logger.error(\"There was an issue importing the certificate.{}\", message);", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java b/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\nindex aac810b48..bdaa4e36e 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\n\n@@ -67,7 +67,13 @@ public class CertificateActions extends AbstractResourceActions<CertificateModel\n     }\n \n     @Override\n-    public ActionResponse<List<CertificateModel>> readAllResources() {\n+    protected Optional<CertificateModel> findExisting(Long id) {\n+        return certificateAccessor.getCertificate(id)\n+                   .map(this::convertFromDatabaseModel);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<CertificateModel>> readAllAfterChecks() {\n         List<CertificateModel> certificates = certificateAccessor.getCertificates().stream()\n                                                   .map(this::convertFromDatabaseModel)\n                                                   .collect(Collectors.toList());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTQwNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487055404", "bodyText": "null passed to the constructor", "author": "gkillough", "createdAt": "2020-09-11T13:45:40Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java", "diffHunk": "@@ -113,19 +152,22 @@ private CertificateModel importCertificate(CertificateModel certificateModel) th\n         }\n     }\n \n-    /**\n-     * @return true if the certificate existed\n-     */\n-    public boolean deleteCertificate(Long id) throws AlertException {\n-        Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n-        if (certificate.isPresent()) {\n-            CustomCertificateModel certificateModel = certificate.get();\n-            logger.info(\"Delete certificate with id: {} and alias: {}\", certificateModel.getNullableId(), certificateModel.getAlias());\n-            certificateUtility.removeCertificate(certificateModel);\n-            certificateAccessor.deleteCertificate(id);\n-            return true;\n+    @Override\n+    public ActionResponse<CertificateModel> deleteResource(Long id) {\n+        try {\n+            Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n+            if (certificate.isPresent()) {\n+                CustomCertificateModel certificateModel = certificate.get();\n+                logger.info(\"Delete certificate with id: {} and alias: {}\", certificateModel.getNullableId(), certificateModel.getAlias());\n+                certificateUtility.removeCertificate(certificateModel);\n+                certificateAccessor.deleteCertificate(id);\n+            }\n+        } catch (AlertException ex) {\n+            logger.error(\"Error deleting certificate\", ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error deleting certificate: %s\", ex.getMessage()));\n         }\n-        return false;\n+\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT, null);", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java b/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\nindex aac810b48..bdaa4e36e 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\n\n@@ -153,7 +158,7 @@ public class CertificateActions extends AbstractResourceActions<CertificateModel\n     }\n \n     @Override\n-    public ActionResponse<CertificateModel> deleteResource(Long id) {\n+    public ActionResponse<CertificateModel> deleteAfterChecks(Long id) {\n         try {\n             Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n             if (certificate.isPresent()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTY4MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487055680", "bodyText": "If the certificate is not present, we should return a 404", "author": "gkillough", "createdAt": "2020-09-11T13:46:08Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java", "diffHunk": "@@ -113,19 +152,22 @@ private CertificateModel importCertificate(CertificateModel certificateModel) th\n         }\n     }\n \n-    /**\n-     * @return true if the certificate existed\n-     */\n-    public boolean deleteCertificate(Long id) throws AlertException {\n-        Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n-        if (certificate.isPresent()) {\n-            CustomCertificateModel certificateModel = certificate.get();\n-            logger.info(\"Delete certificate with id: {} and alias: {}\", certificateModel.getNullableId(), certificateModel.getAlias());\n-            certificateUtility.removeCertificate(certificateModel);\n-            certificateAccessor.deleteCertificate(id);\n-            return true;\n+    @Override\n+    public ActionResponse<CertificateModel> deleteResource(Long id) {\n+        try {\n+            Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n+            if (certificate.isPresent()) {", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java b/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\nindex aac810b48..bdaa4e36e 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java\n\n@@ -153,7 +158,7 @@ public class CertificateActions extends AbstractResourceActions<CertificateModel\n     }\n \n     @Override\n-    public ActionResponse<CertificateModel> deleteResource(Long id) {\n+    public ActionResponse<CertificateModel> deleteAfterChecks(Long id) {\n         try {\n             Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n             if (certificate.isPresent()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NzU0MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487057540", "bodyText": "Eventually, we should wrap this list in an object before returning.", "author": "gkillough", "createdAt": "2020-09-11T13:49:07Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigController.java", "diffHunk": "@@ -22,241 +22,69 @@\n  */\n package com.synopsys.integration.alert.web.api.config;\n \n-import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n \n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n-import org.springframework.http.ResponseEntity;\n-import org.springframework.web.bind.annotation.DeleteMapping;\n import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.PathVariable;\n-import org.springframework.web.bind.annotation.PostMapping;\n-import org.springframework.web.bind.annotation.PutMapping;\n-import org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RequestParam;\n import org.springframework.web.bind.annotation.RestController;\n \n-import com.synopsys.integration.alert.common.ContentConverter;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n-import com.synopsys.integration.alert.common.exception.AlertFieldException;\n-import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n import com.synopsys.integration.alert.common.rest.ResponseFactory;\n+import com.synopsys.integration.alert.common.rest.api.ConfigResourceController;\n+import com.synopsys.integration.alert.common.rest.api.TestController;\n+import com.synopsys.integration.alert.common.rest.api.ValidateController;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n-import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.web.common.BaseController;\n-import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n-import com.synopsys.integration.exception.IntegrationException;\n-import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @RestController\n @RequestMapping(ConfigController.CONFIGURATION_PATH)\n-public class ConfigController extends BaseController {\n+public class ConfigController implements ConfigResourceController, TestController<FieldModel>, ValidateController<FieldModel> {\n     public static final String CONFIGURATION_PATH = BaseController.BASE_PATH + \"/configuration\";\n-    public static final String EXCEPTION_FORMAT_CONFIGURATIONS_NOT_FOUND_FOR_CONTEXT_AND_DESCRIPTOR = \"Configurations not found for the context '%s' and descriptor '%s'.\";\n-    private final Logger logger = LoggerFactory.getLogger(ConfigController.class);\n     private final ConfigActions configActions;\n-    private final ContentConverter contentConverter;\n-    private final ResponseFactory responseFactory;\n-    private final AuthorizationManager authorizationManager;\n-    private final DescriptorMap descriptorMap;\n-    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n \n     @Autowired\n-    public ConfigController(ConfigActions configActions, ContentConverter contentConverter, ResponseFactory responseFactory, AuthorizationManager authorizationManager,\n-        DescriptorMap descriptorMap, PKIXErrorResponseFactory pkixErrorResponseFactory) {\n+    public ConfigController(ConfigActions configActions) {\n         this.configActions = configActions;\n-        this.contentConverter = contentConverter;\n-        this.responseFactory = responseFactory;\n-        this.authorizationManager = authorizationManager;\n-        this.descriptorMap = descriptorMap;\n-        this.pkixErrorResponseFactory = pkixErrorResponseFactory;\n     }\n \n     @GetMapping\n-    public ResponseEntity<String> getConfigs(@RequestParam ConfigContextEnum context, @RequestParam(required = false) String descriptorName) {\n-        List<FieldModel> models;\n-        if (!authorizationManager.hasReadPermission(context.name(), descriptorName)) {\n-            return responseFactory.createForbiddenResponse();\n-        }\n-        try {\n-            DescriptorKey descriptorKey = descriptorMap.getDescriptorKey(descriptorName).orElseThrow(() -> new AlertException(\"Could not find a Descriptor with the name: \" + descriptorName));\n-            models = configActions.getConfigs(context, descriptorKey);\n-        } catch (AlertException e) {\n-            logger.error(\"Was not able to find configurations with the context {}, and descriptorName {} to get.\", context, descriptorName);\n-            return responseFactory.createNotFoundResponse(String.format(EXCEPTION_FORMAT_CONFIGURATIONS_NOT_FOUND_FOR_CONTEXT_AND_DESCRIPTOR, context, descriptorName));\n-        }\n-\n-        if (models.isEmpty()) {\n-            return responseFactory.createNotFoundResponse(String.format(EXCEPTION_FORMAT_CONFIGURATIONS_NOT_FOUND_FOR_CONTEXT_AND_DESCRIPTOR, context, descriptorName));\n-        }\n-\n-        return responseFactory.createOkContentResponse(contentConverter.getJsonString(models));\n+    public List<FieldModel> getAll(@RequestParam ConfigContextEnum context, @RequestParam(required = false) String descriptorName) {", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigController.java b/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigController.java\nindex 7bd9da2ab..46b046ceb 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigController.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigController.java\n\n@@ -54,7 +54,7 @@ public class ConfigController implements ConfigResourceController, TestControlle\n \n     @GetMapping\n     public List<FieldModel> getAll(@RequestParam ConfigContextEnum context, @RequestParam(required = false) String descriptorName) {\n-        return ResponseFactory.createContentResponseFromAction(configActions.readAllByContextAndDescriptor(context.name(), descriptorName));\n+        return ResponseFactory.createContentResponseFromAction(configActions.readAllByContextAndDescriptorAfterChecks(context.name(), descriptorName));\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1ODYxOQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487058619", "bodyText": "null used in constructor", "author": "gkillough", "createdAt": "2020-09-11T13:50:46Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java", "diffHunk": "@@ -31,85 +30,128 @@\n import java.util.Optional;\n \n import org.apache.commons.lang3.EnumUtils;\n-import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.action.TestAction;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.action.api.AbstractConfigResourceActions;\n import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n import com.synopsys.integration.alert.common.exception.AlertException;\n import com.synopsys.integration.alert.common.exception.AlertFieldException;\n-import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n import com.synopsys.integration.alert.web.common.descriptor.DescriptorProcessor;\n import com.synopsys.integration.alert.web.common.field.FieldModelProcessor;\n import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @Component\n-public class ConfigActions {\n+public class ConfigActions extends AbstractConfigResourceActions {\n+    private final Logger logger = LoggerFactory.getLogger(ConfigActions.class);\n     private final ConfigurationAccessor configurationAccessor;\n     private final FieldModelProcessor fieldModelProcessor;\n     private final DescriptorProcessor descriptorProcessor;\n     private final ConfigurationFieldModelConverter modelConverter;\n+    private final DescriptorMap descriptorMap;\n+    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n \n     @Autowired\n-    public ConfigActions(ConfigurationAccessor configurationAccessor, FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor, ConfigurationFieldModelConverter modelConverter) {\n+    public ConfigActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor, ConfigurationAccessor configurationAccessor,\n+        FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor, ConfigurationFieldModelConverter modelConverter,\n+        DescriptorMap descriptorMap, PKIXErrorResponseFactory pkixErrorResponseFactory) {\n+        super(authorizationManager, descriptorAccessor);\n         this.configurationAccessor = configurationAccessor;\n         this.fieldModelProcessor = fieldModelProcessor;\n         this.descriptorProcessor = descriptorProcessor;\n         this.modelConverter = modelConverter;\n+        this.descriptorMap = descriptorMap;\n+        this.pkixErrorResponseFactory = pkixErrorResponseFactory;\n     }\n \n-    public boolean doesConfigExist(String id) throws AlertException {\n-        return StringUtils.isNotBlank(id) && doesConfigExist(Long.parseLong(id));\n+    @Override\n+    protected ActionResponse<List<FieldModel>> readAllResources() {\n+        return new ActionResponse<>(HttpStatus.NOT_IMPLEMENTED, null);", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java b/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java\nindex 8409ee3e7..a2acd2a1b 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java\n\n@@ -86,12 +86,12 @@ public class ConfigActions extends AbstractConfigResourceActions {\n     }\n \n     @Override\n-    protected ActionResponse<List<FieldModel>> readAllResources() {\n-        return new ActionResponse<>(HttpStatus.NOT_IMPLEMENTED, null);\n+    protected ActionResponse<List<FieldModel>> readAllAfterChecks() {\n+        return new ActionResponse<>(HttpStatus.NOT_IMPLEMENTED);\n     }\n \n     @Override\n-    protected ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName) {\n+    protected ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName) {\n         ConfigContextEnum configContext = ConfigContextEnum.valueOf(context);\n         Optional<DescriptorKey> descriptorKey = descriptorMap.getDescriptorKey(descriptorName);\n         if (!descriptorKey.isPresent()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1OTgzNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487059835", "bodyText": "null passed in constructor", "author": "gkillough", "createdAt": "2020-09-11T13:52:36Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java", "diffHunk": "@@ -258,53 +324,80 @@ public MessageResult validateJob(JobFieldModel jobFieldModel) {\n             }\n         }\n \n-        return errorsList;\n+        return new ActionResponse<>(HttpStatus.OK, errorsList);\n     }\n \n-    // TODO abstract duplicate functionality\n-    public MessageResult testJob(JobFieldModel jobFieldModel) throws IntegrationException {\n-        MessageResult jobValidationResult = validateJob(jobFieldModel);\n-        if (jobValidationResult.hasErrors()) {\n-            return jobValidationResult;\n-        }\n-\n-        Collection<FieldModel> otherJobModels = new LinkedList<>();\n-        FieldModel channelFieldModel = getChannelFieldModelAndPopulateOtherJobModels(jobFieldModel, otherJobModels);\n-\n-        if (null != channelFieldModel) {\n-            Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(channelFieldModel);\n-            if (testActionOptional.isPresent()) {\n-                Map<String, ConfigurationFieldModel> fields = createFieldsMap(channelFieldModel, otherJobModels);\n-                // The custom message fields are not written to the database or defined fields in the database.  Need to manually add them.\n-                // TODO Create a mechanism to create the field accessor with a combination of fields in the database and fields that are not.\n-                Optional<ConfigurationFieldModel> topicField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_TOPIC);\n-                Optional<ConfigurationFieldModel> messageField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_MESSAGE);\n-                topicField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_TOPIC, model));\n-                messageField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_MESSAGE, model));\n-                TestAction testAction = testActionOptional.get();\n-                FieldAccessor fieldAccessor = new FieldAccessor(fields);\n-                String jobId = channelFieldModel.getId();\n-\n-                MessageResult providerTestResult = testProviderConfig(fieldAccessor, jobId, channelFieldModel);\n-                if (providerTestResult.hasErrors()) {\n-                    return providerTestResult;\n+    @Override\n+    protected ValidationActionResponse testResource(JobFieldModel resource) {\n+        ValidationResponseModel responseModel;\n+        String id = resource.getJobId();\n+        try {\n+\n+            Collection<FieldModel> otherJobModels = new LinkedList<>();\n+            FieldModel channelFieldModel = getChannelFieldModelAndPopulateOtherJobModels(resource, otherJobModels);\n+\n+            if (null != channelFieldModel) {\n+                Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(channelFieldModel);\n+                if (testActionOptional.isPresent()) {\n+                    Map<String, ConfigurationFieldModel> fields = createFieldsMap(channelFieldModel, otherJobModels);\n+                    // The custom message fields are not written to the database or defined fields in the database.  Need to manually add them.\n+                    // TODO Create a mechanism to create the field accessor with a combination of fields in the database and fields that are not.\n+                    Optional<ConfigurationFieldModel> topicField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_TOPIC);\n+                    Optional<ConfigurationFieldModel> messageField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_MESSAGE);\n+                    topicField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_TOPIC, model));\n+                    messageField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_MESSAGE, model));\n+                    TestAction testAction = testActionOptional.get();\n+                    FieldAccessor fieldAccessor = new FieldAccessor(fields);\n+                    String jobId = channelFieldModel.getId();\n+\n+                    MessageResult providerTestResult = testProviderConfig(fieldAccessor, jobId, channelFieldModel);\n+                    if (providerTestResult.hasErrors()) {\n+                        responseModel = ValidationResponseModel.fromStatusCollection(providerTestResult.getStatusMessage(), providerTestResult.getFieldStatuses());\n+                        return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+                    }\n+\n+                    MessageResult testActionResult = testAction.testConfig(jobId, channelFieldModel, fieldAccessor);\n+                    List<AlertFieldStatus> resultFieldStatuses = testActionResult.getFieldStatuses();\n+                    responseModel = ValidationResponseModel.fromStatusCollection(testActionResult.getStatusMessage(), resultFieldStatuses);\n+                    return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+                } else {\n+                    String descriptorName = channelFieldModel.getDescriptorName();\n+                    logger.error(\"Test action did not exist: {}\", descriptorName);\n+                    responseModel = ValidationResponseModel.withoutFieldStatuses(\"Test functionality not implemented for \" + descriptorName);\n+                    return new ValidationActionResponse(HttpStatus.METHOD_NOT_ALLOWED, responseModel);\n                 }\n-\n-                List<AlertFieldStatus> resultFieldStatuses = concatStatuses(jobValidationResult.getFieldStatuses(), providerTestResult.getFieldStatuses());\n-                MessageResult testActionResult = testAction.testConfig(jobId, channelFieldModel, fieldAccessor);\n-                resultFieldStatuses = concatStatuses(resultFieldStatuses, testActionResult.getFieldStatuses());\n-                return new MessageResult(testActionResult.getStatusMessage(), resultFieldStatuses);\n-            } else {\n-                String descriptorName = channelFieldModel.getDescriptorName();\n-                logger.error(\"Test action did not exist: {}\", descriptorName);\n-                throw new AlertMethodNotAllowedException(\"Test functionality not implemented for \" + descriptorName);\n             }\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"No field model of type channel was was sent to test.\");\n+            return new ValidationActionResponse(HttpStatus.BAD_REQUEST, responseModel);\n+        } catch (IntegrationRestException e) {\n+            logger.error(e.getMessage(), e);\n+            return ValidationActionResponse.createResponseFromIntegrationRestException(e);\n+        } catch (AlertFieldException e) {\n+            logger.error(\"Test Error with field Errors\", e);\n+            responseModel = ValidationResponseModel.fromStatusCollection(e.getMessage(), e.getFieldErrors());\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+        } catch (AlertMethodNotAllowedException e) {\n+            logger.error(e.getMessage(), e);\n+            return new ValidationActionResponse(HttpStatus.METHOD_NOT_ALLOWED, ValidationResponseModel.withoutFieldStatuses(e.getMessage()));\n+        } catch (IntegrationException e) {\n+            responseModel = pkixErrorResponseFactory.createSSLExceptionResponse(id, e)\n+                                .orElse(ValidationResponseModel.withoutFieldStatuses(e.getMessage()));\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage(), e);\n+            responseModel = pkixErrorResponseFactory.createSSLExceptionResponse(id, e)\n+                                .orElse(ValidationResponseModel.withoutFieldStatuses(e.getMessage()));\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n         }\n-        return new MessageResult(\"No field model of type channel was was sent to test.\");\n     }\n \n-    public Optional<String> checkGlobalConfigExists(String descriptorName) {\n-        return globalConfigExistsValidator.validate(descriptorName);\n+    public ActionResponse<String> checkGlobalConfigExists(String descriptorName) {\n+        Optional<String> configMissingMessage = globalConfigExistsValidator.validate(descriptorName);\n+        if (configMissingMessage.isPresent()) {\n+            String message = configMissingMessage.get();\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, message);\n+        }\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT, null);", "originalCommit": "f79d758c6a9f2d558b2728c4089863a4791796c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c513540ae543cb01250d0bcae9601dce6950e1aa", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java b/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java\nindex 922f3c166..e10dddda7 100644\n--- a/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java\n+++ b/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java\n\n@@ -328,7 +328,7 @@ public class JobConfigActions extends AbstractJobResourceActions {\n     }\n \n     @Override\n-    protected ValidationActionResponse testResource(JobFieldModel resource) {\n+    protected ValidationActionResponse testAfterChecks(JobFieldModel resource) {\n         ValidationResponseModel responseModel;\n         String id = resource.getJobId();\n         try {\n"}}, {"oid": "c513540ae543cb01250d0bcae9601dce6950e1aa", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c513540ae543cb01250d0bcae9601dce6950e1aa", "message": "refactor: Implement current PR suggestions.", "committedDate": "2020-09-11T14:50:07Z", "type": "commit"}, {"oid": "21256a169e148361ee2907b34c3c351b652ff130", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/21256a169e148361ee2907b34c3c351b652ff130", "message": "refactor: Implement PR feedback for additional interfaces.", "committedDate": "2020-09-11T16:41:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMTIyNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487231226", "bodyText": "Do we prefer calling the other constructor ('this' keyword) in cases like this?", "author": "bamandel", "createdAt": "2020-09-11T18:57:42Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,184 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements LongResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzMjYwMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487832602", "bodyText": "The other constructor is from an earlier incarnation. I will remove it.", "author": "psantos1113", "createdAt": "2020-09-14T11:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMTIyNg=="}], "type": "inlineReview", "revised_code": {"commit": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\nindex 263c0b281..e050adeee 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n\n@@ -48,10 +48,6 @@ public abstract class AbstractConfigResourceActions implements LongResourceActio\n         this.descriptorAccessor = descriptorAccessor;\n     }\n \n-    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n-        this.authorizationManager = authorizationManager;\n-    }\n-\n     protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n \n     protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNDEwMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487234100", "bodyText": "This statement is written a lot. Should we have a private method or static method in ActionResponse to ensure it's always the same message?", "author": "bamandel", "createdAt": "2020-09-11T19:03:47Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,184 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements LongResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllAfterChecks();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testAfterChecks(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(FieldModel resource);\n+\n+    public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n+        if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllByContextAndDescriptorAfterChecks(context, descriptorName);\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> create(FieldModel resource) {\n+        if (!authorizationManager.hasCreatePermission(resource.getContext(), resource.getDescriptorName())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateAfterChecks(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createAfterChecks(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<FieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name(), ConfigContextEnum.GLOBAL.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            return readAllAfterChecks();\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading configurations: %s\", ex.getMessage()));\n+        }\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> getOne(Long id) {\n+        Optional<FieldModel> fieldModel = findFieldModel(id);\n+        if (fieldModel.isPresent()) {\n+            FieldModel model = fieldModel.get();\n+            if (!authorizationManager.hasReadPermission(model.getContext(), model.getDescriptorName())) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\nindex 263c0b281..e050adeee 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java\n\n@@ -48,10 +48,6 @@ public abstract class AbstractConfigResourceActions implements LongResourceActio\n         this.descriptorAccessor = descriptorAccessor;\n     }\n \n-    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n-        this.authorizationManager = authorizationManager;\n-    }\n-\n     protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n \n     protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNzU4MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487237580", "bodyText": "Instead of the Set object, could we return the statement in the try block otherwise return Set.of?", "author": "bamandel", "createdAt": "2020-09-11T19:11:05Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteAfterChecks(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllAfterChecks();\n+\n+    protected abstract ValidationActionResponse testAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateAfterChecks(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(JobFieldModel resource);\n+\n+    private Set<String> getDescriptorNames() {\n+        Set<String> descriptorNames = Set.of();\n+        try {\n+            descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                  .stream()\n+                                  .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                  .map(RegisteredDescriptorModel::getName)\n+                                  .collect(Collectors.toSet());\n+        } catch (AlertDatabaseConstraintException ex) {\n+            // ignore or add a logger.\n+        }\n+\n+        return descriptorNames;", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\nindex b830bc46c..547e03416 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n\n@@ -89,7 +89,7 @@ public abstract class AbstractJobResourceActions implements JobResourceActions,\n     public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n         boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n         if (!hasPermissions) {\n-            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            return ActionResponse.createForbiddenResponse();\n         }\n         ValidationActionResponse validationResponse = validateAfterChecks(resource);\n         if (validationResponse.isError()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzODA0OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487238048", "bodyText": "More of these calls to FORBIDDEN and FORBIDDEN_MESSAGE. Makes me this we should put this object creation in a static variable somewhere.", "author": "bamandel", "createdAt": "2020-09-11T19:12:00Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteAfterChecks(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllAfterChecks();\n+\n+    protected abstract ValidationActionResponse testAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateAfterChecks(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(JobFieldModel resource);\n+\n+    private Set<String> getDescriptorNames() {\n+        Set<String> descriptorNames = Set.of();\n+        try {\n+            descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                  .stream()\n+                                  .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                  .map(RegisteredDescriptorModel::getName)\n+                                  .collect(Collectors.toSet());\n+        } catch (AlertDatabaseConstraintException ex) {\n+            // ignore or add a logger.\n+        }\n+\n+        return descriptorNames;\n+    }\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n+        boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n+        if (!hasPermissions) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\nindex b830bc46c..547e03416 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java\n\n@@ -89,7 +89,7 @@ public abstract class AbstractJobResourceActions implements JobResourceActions,\n     public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n         boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n         if (!hasPermissions) {\n-            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            return ActionResponse.createForbiddenResponse();\n         }\n         ValidationActionResponse validationResponse = validateAfterChecks(resource);\n         if (validationResponse.isError()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0MTQ3Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487241476", "bodyText": "This class also has references to the forbidden action response", "author": "bamandel", "createdAt": "2020-09-11T19:17:39Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractResourceActions<T> implements LongResourceActions<T>, ValidateAction<T>, TestAction<T> {\n+    public static final String FORBIDDEN_MESSAGE = \"User not authorized to perform the request\";\n+    public static final String RESOURCE_IDENTIFIER_MISSING = \"Resource identifier missing.\";\n+    private DescriptorKey descriptorKey;\n+    private AuthorizationManager authorizationManager;\n+    private ConfigContextEnum context;\n+\n+    public AbstractResourceActions(DescriptorKey descriptorKey, ConfigContextEnum context, AuthorizationManager authorizationManager) {\n+        this.descriptorKey = descriptorKey;\n+        this.context = context;\n+        // to do change the authorization manager to use the context enum and the descriptor key\n+        this.authorizationManager = authorizationManager;\n+\n+    }\n+\n+    protected abstract ActionResponse<T> createAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> deleteAfterChecks(Long id);\n+\n+    protected abstract ActionResponse<List<T>> readAllAfterChecks();\n+\n+    protected abstract ActionResponse<T> readAfterChecks(Long id);\n+\n+    protected abstract ValidationActionResponse testAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> updateAfterChecks(Long id, T resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(T resource);\n+\n+    protected abstract Optional<T> findExisting(Long id);\n+\n+    @Override\n+    public ActionResponse<T> create(T resource) {\n+        if (!authorizationManager.hasCreatePermission(context.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\nindex 4de42125a..f9449ac93 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\n\n@@ -35,8 +35,7 @@ import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n \n public abstract class AbstractResourceActions<T> implements LongResourceActions<T>, ValidateAction<T>, TestAction<T> {\n-    public static final String FORBIDDEN_MESSAGE = \"User not authorized to perform the request\";\n-    public static final String RESOURCE_IDENTIFIER_MISSING = \"Resource identifier missing.\";\n+\n     private DescriptorKey descriptorKey;\n     private AuthorizationManager authorizationManager;\n     private ConfigContextEnum context;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0MTk0Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487241943", "bodyText": "Do we still want this null check or will this be removed?", "author": "bamandel", "createdAt": "2020-09-11T19:18:19Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractResourceActions<T> implements LongResourceActions<T>, ValidateAction<T>, TestAction<T> {\n+    public static final String FORBIDDEN_MESSAGE = \"User not authorized to perform the request\";\n+    public static final String RESOURCE_IDENTIFIER_MISSING = \"Resource identifier missing.\";\n+    private DescriptorKey descriptorKey;\n+    private AuthorizationManager authorizationManager;\n+    private ConfigContextEnum context;\n+\n+    public AbstractResourceActions(DescriptorKey descriptorKey, ConfigContextEnum context, AuthorizationManager authorizationManager) {\n+        this.descriptorKey = descriptorKey;\n+        this.context = context;\n+        // to do change the authorization manager to use the context enum and the descriptor key\n+        this.authorizationManager = authorizationManager;\n+\n+    }\n+\n+    protected abstract ActionResponse<T> createAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> deleteAfterChecks(Long id);\n+\n+    protected abstract ActionResponse<List<T>> readAllAfterChecks();\n+\n+    protected abstract ActionResponse<T> readAfterChecks(Long id);\n+\n+    protected abstract ValidationActionResponse testAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> updateAfterChecks(Long id, T resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(T resource);\n+\n+    protected abstract Optional<T> findExisting(Long id);\n+\n+    @Override\n+    public ActionResponse<T> create(T resource) {\n+        if (!authorizationManager.hasCreatePermission(context.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateAfterChecks(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createAfterChecks(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<T>> getAll() {\n+        if (!authorizationManager.hasReadPermission(context.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllAfterChecks();\n+    }\n+\n+    @Override\n+    public ActionResponse<T> getOne(Long id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, RESOURCE_IDENTIFIER_MISSING);\n+        }", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\nindex 4de42125a..f9449ac93 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java\n\n@@ -35,8 +35,7 @@ import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n \n public abstract class AbstractResourceActions<T> implements LongResourceActions<T>, ValidateAction<T>, TestAction<T> {\n-    public static final String FORBIDDEN_MESSAGE = \"User not authorized to perform the request\";\n-    public static final String RESOURCE_IDENTIFIER_MISSING = \"Resource identifier missing.\";\n+\n     private DescriptorKey descriptorKey;\n     private AuthorizationManager authorizationManager;\n     private ConfigContextEnum context;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MDMxOQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487250319", "bodyText": "This may look better if we fo an if check with a return then return Bad request by default if the if statement is skipped.", "author": "bamandel", "createdAt": "2020-09-11T19:35:11Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java", "diffHunk": "@@ -118,54 +160,103 @@ public void deleteConfig(Long id) throws AlertException {\n                 configurationAccessor.deleteConfiguration(Long.parseLong(fieldModel.getId()));\n                 fieldModelProcessor.performAfterDeleteAction(fieldModel);\n             }\n+        } catch (AlertException ex) {\n+            logger.error(String.format(\"Error deleting config id: %d\", id), ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, ex.getMessage());\n         }\n+\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT);\n     }\n \n-    public FieldModel saveConfig(FieldModel fieldModel, DescriptorKey descriptorKey) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(fieldModel);\n-        String context = modifiedFieldModel.getContext();\n-        Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n-        ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey, EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n-        FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n-        return dbSavedModel.fill(afterSaveAction);\n+    @Override\n+    protected ActionResponse<FieldModel> createAfterChecks(FieldModel resource) {\n+        Optional<DescriptorKey> descriptorKey = descriptorMap.getDescriptorKey(resource.getDescriptorName());\n+        if (descriptorKey.isPresent()) {\n+            try {\n+                FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(resource);\n+                String context = modifiedFieldModel.getContext();\n+                Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n+                ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey.get(), EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n+                FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n+                FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n+                FieldModel responseModel = dbSavedModel.fill(afterSaveAction);\n+                return new ActionResponse<>(HttpStatus.OK, responseModel);\n+            } catch (AlertException ex) {\n+                logger.error(\"Error creating configuration\", ex);\n+                return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+            }\n+        }\n+        return new ActionResponse<>(HttpStatus.BAD_REQUEST, \"descriptorName is missing or invalid\");\n     }\n \n-    public FieldModel updateConfig(Long id, FieldModel fieldModel) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n-        FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n-\n-        FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(fieldModel);\n-        Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n-        ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n-        FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n-        return dbSavedModel.fill(afterUpdateAction);\n+    @Override\n+    protected ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource) {\n+        try {\n+            Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n+            FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n+\n+            FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(resource);\n+            Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n+            ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n+            FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n+            FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n+            FieldModel responseModel = dbSavedModel.fill(afterUpdateAction);\n+            return new ActionResponse<>(HttpStatus.OK, responseModel);\n+        } catch (AlertException ex) {\n+            logger.error(\"Error creating configuration\", ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+        }\n     }\n \n-    public String validateConfig(FieldModel fieldModel, List<AlertFieldStatus> fieldErrors) throws AlertFieldException {\n-        fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+    @Override\n+    protected ValidationActionResponse validateAfterChecks(FieldModel resource) {\n+        List<AlertFieldStatus> fieldStatuses = fieldModelProcessor.validateFieldModel(resource);\n+        ValidationResponseModel responseModel;\n+        HttpStatus status = HttpStatus.OK;\n+        if (fieldStatuses.isEmpty()) {\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"The configuration is valid\");\n+        } else {\n+            status = HttpStatus.BAD_REQUEST;\n+            responseModel = ValidationResponseModel.fromStatusCollection(\"There were problems with the configuration\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new ValidationActionResponse(status, responseModel);", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzNzExMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487837111", "bodyText": "There's a ticket to add audit logging especially for users and role actions.  To ensure that we are logging consistently we most likely won't be able to use the circuit breaker pattern and return right away if we want to log when an action starts and completes.", "author": "psantos1113", "createdAt": "2020-09-14T11:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MDMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0Mjk5MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487942991", "bodyText": "Won't we still be able to log in all cases? Returning early would act like the if else statement above and you can fit all logs as needed, unless I'm missing something about that logging.", "author": "bamandel", "createdAt": "2020-09-14T13:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MDMxOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MTIzNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487251236", "bodyText": "Might be cleaner to remove this declaration and just create the object before returning.", "author": "bamandel", "createdAt": "2020-09-11T19:37:17Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java", "diffHunk": "@@ -118,54 +160,103 @@ public void deleteConfig(Long id) throws AlertException {\n                 configurationAccessor.deleteConfiguration(Long.parseLong(fieldModel.getId()));\n                 fieldModelProcessor.performAfterDeleteAction(fieldModel);\n             }\n+        } catch (AlertException ex) {\n+            logger.error(String.format(\"Error deleting config id: %d\", id), ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, ex.getMessage());\n         }\n+\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT);\n     }\n \n-    public FieldModel saveConfig(FieldModel fieldModel, DescriptorKey descriptorKey) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(fieldModel);\n-        String context = modifiedFieldModel.getContext();\n-        Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n-        ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey, EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n-        FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n-        return dbSavedModel.fill(afterSaveAction);\n+    @Override\n+    protected ActionResponse<FieldModel> createAfterChecks(FieldModel resource) {\n+        Optional<DescriptorKey> descriptorKey = descriptorMap.getDescriptorKey(resource.getDescriptorName());\n+        if (descriptorKey.isPresent()) {\n+            try {\n+                FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(resource);\n+                String context = modifiedFieldModel.getContext();\n+                Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n+                ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey.get(), EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n+                FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n+                FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n+                FieldModel responseModel = dbSavedModel.fill(afterSaveAction);\n+                return new ActionResponse<>(HttpStatus.OK, responseModel);\n+            } catch (AlertException ex) {\n+                logger.error(\"Error creating configuration\", ex);\n+                return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+            }\n+        }\n+        return new ActionResponse<>(HttpStatus.BAD_REQUEST, \"descriptorName is missing or invalid\");\n     }\n \n-    public FieldModel updateConfig(Long id, FieldModel fieldModel) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n-        FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n-\n-        FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(fieldModel);\n-        Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n-        ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n-        FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n-        return dbSavedModel.fill(afterUpdateAction);\n+    @Override\n+    protected ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource) {\n+        try {\n+            Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n+            FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n+\n+            FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(resource);\n+            Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n+            ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n+            FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n+            FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n+            FieldModel responseModel = dbSavedModel.fill(afterUpdateAction);\n+            return new ActionResponse<>(HttpStatus.OK, responseModel);\n+        } catch (AlertException ex) {\n+            logger.error(\"Error creating configuration\", ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+        }\n     }\n \n-    public String validateConfig(FieldModel fieldModel, List<AlertFieldStatus> fieldErrors) throws AlertFieldException {\n-        fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+    @Override\n+    protected ValidationActionResponse validateAfterChecks(FieldModel resource) {\n+        List<AlertFieldStatus> fieldStatuses = fieldModelProcessor.validateFieldModel(resource);\n+        ValidationResponseModel responseModel;\n+        HttpStatus status = HttpStatus.OK;\n+        if (fieldStatuses.isEmpty()) {\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"The configuration is valid\");\n+        } else {\n+            status = HttpStatus.BAD_REQUEST;\n+            responseModel = ValidationResponseModel.fromStatusCollection(\"There were problems with the configuration\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new ValidationActionResponse(status, responseModel);\n     }\n \n-    public String testConfig(FieldModel restModel) throws IntegrationException {\n-        validateConfig(restModel, new ArrayList<>());\n-        Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(restModel);\n+    @Override\n+    protected ValidationActionResponse testAfterChecks(FieldModel resource) {\n+        Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(resource);\n+        ValidationResponseModel responseModel;", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MjIxMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487252210", "bodyText": "A lot of constructor params getting passed. Something to look into, maybe add a TODO to revisit this?", "author": "bamandel", "createdAt": "2020-09-11T19:39:34Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java", "diffHunk": "@@ -56,150 +63,183 @@\n import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n import com.synopsys.integration.alert.common.message.model.MessageResult;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.PermissionKey;\n import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n import com.synopsys.integration.alert.web.common.descriptor.DescriptorProcessor;\n import com.synopsys.integration.alert.web.common.field.FieldModelProcessor;\n import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @Component\n-public class JobConfigActions {\n+public class JobConfigActions extends AbstractJobResourceActions {\n     private final Logger logger = LoggerFactory.getLogger(JobConfigActions.class);\n     private final ConfigurationAccessor configurationAccessor;\n     private final FieldModelProcessor fieldModelProcessor;\n     private final DescriptorProcessor descriptorProcessor;\n     private final ConfigurationFieldModelConverter modelConverter;\n     private final GlobalConfigExistsValidator globalConfigExistsValidator;\n+    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n+    private final DescriptorMap descriptorMap;\n \n     @Autowired\n-    public JobConfigActions(ConfigurationAccessor configurationAccessor, FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor, ConfigurationFieldModelConverter modelConverter,\n-        GlobalConfigExistsValidator globalConfigExistsValidator) {\n+    public JobConfigActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor, ConfigurationAccessor configurationAccessor, FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor,\n+        ConfigurationFieldModelConverter modelConverter, GlobalConfigExistsValidator globalConfigExistsValidator, PKIXErrorResponseFactory pkixErrorResponseFactory, DescriptorMap descriptorMap) {", "originalCommit": "21256a169e148361ee2907b34c3c351b652ff130", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "message": "refactor: Implement latest PR feedback.", "committedDate": "2020-09-14T11:50:14Z", "type": "commit"}]}