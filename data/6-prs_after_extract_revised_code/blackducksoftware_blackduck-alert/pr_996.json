{"pr_number": 996, "pr_title": "ldap password fix", "pr_createdAt": "2020-05-28T21:21:38Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/996", "timeline": [{"oid": "6be0a19094c3dc5db4e7758131e4e2ac252efa68", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6be0a19094c3dc5db4e7758131e4e2ac252efa68", "message": "fix: Read existing saved sensitive fields from the database on update.", "committedDate": "2020-05-28T21:12:01Z", "type": "commit"}, {"oid": "b5c91cf55491292b48c549c83cab71bf1b4c1449", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b5c91cf55491292b48c549c83cab71bf1b4c1449", "message": "refactor: Clean up the code on update to be more consistent.", "committedDate": "2020-05-28T21:20:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyODYzMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#discussion_r432428632", "bodyText": "I'm surprised we don't have a utility for this. We should probably add a TODO here and an issue for 6.1.0", "author": "gkillough", "createdAt": "2020-05-29T11:42:39Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/accessor/DefaultDescriptorGlobalConfigUtility.java", "diffHunk": "@@ -96,9 +98,33 @@ public FieldModel save(FieldModel fieldModel) throws AlertException {\n \n     public FieldModel update(Long id, FieldModel fieldModel) throws AlertException {\n         FieldModel beforeUpdateAction = apiAction.beforeUpdateAction(fieldModel);\n-        Collection<ConfigurationFieldModel> values = configurationFieldModelConverter.convertToConfigurationFieldModelMap(beforeUpdateAction).values();\n-        ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, values);\n+        Map<String, ConfigurationFieldModel> valueMap = configurationFieldModelConverter.convertToConfigurationFieldModelMap(beforeUpdateAction);\n+        Optional<ConfigurationModel> existingConfig = configurationAccessor.getConfigurationById(id);\n+        ConfigurationModel configurationModel;\n+        if (existingConfig.isPresent()) {\n+            Map<String, ConfigurationFieldModel> updatedValues = updateSensitiveFields(valueMap, existingConfig.get());\n+            configurationModel = configurationAccessor.updateConfiguration(id, updatedValues.values());\n+        } else {\n+            configurationModel = configurationAccessor.createConfiguration(key, context, valueMap.values());\n+        }\n         FieldModel convertedFieldModel = configurationFieldModelConverter.convertToFieldModel(configurationModel);\n         return apiAction.afterUpdateAction(convertedFieldModel);\n     }\n+\n+    private Map<String, ConfigurationFieldModel> updateSensitiveFields(Map<String, ConfigurationFieldModel> values, ConfigurationModel existingConfig) {", "originalCommit": "b5c91cf55491292b48c549c83cab71bf1b4c1449", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MzYwMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#discussion_r432453602", "bodyText": "FieldModelProcessor will handle these changes.  The problem is that FieldModelProcessor is in the alert-main project and this utility is in the alert-common sub project.  Using FieldModelProcessor would create a dependency we don't want.  If we can move FieldModelProcessor into alert-common then that would resolve this issue.  I will add a TODO comment.", "author": "psantos1113", "createdAt": "2020-05-29T12:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyODYzMg=="}], "type": "inlineReview", "revised_code": {"commit": "97e473b250f915648fc3fd365e5df826bf81e5d1", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/accessor/DefaultDescriptorGlobalConfigUtility.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/accessor/DefaultDescriptorGlobalConfigUtility.java\nindex 9b35825f4..63f1f9eb3 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/accessor/DefaultDescriptorGlobalConfigUtility.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/accessor/DefaultDescriptorGlobalConfigUtility.java\n\n@@ -111,6 +111,7 @@ public class DefaultDescriptorGlobalConfigUtility {\n         return apiAction.afterUpdateAction(convertedFieldModel);\n     }\n \n+    // TODO build a new utility to perform this action or try to refactor FieldModelProcessor into the alert-common sub-project\n     private Map<String, ConfigurationFieldModel> updateSensitiveFields(Map<String, ConfigurationFieldModel> values, ConfigurationModel existingConfig) {\n         Collection<ConfigurationFieldModel> sensitiveFields = existingConfig.getCopyOfFieldList().stream()\n                                                                   .filter(ConfigurationFieldModel::isSensitive)\n"}}, {"oid": "97e473b250f915648fc3fd365e5df826bf81e5d1", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/97e473b250f915648fc3fd365e5df826bf81e5d1", "message": "refactor: Add a TODO comment.", "committedDate": "2020-05-29T12:57:30Z", "type": "commit"}]}