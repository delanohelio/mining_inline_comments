{"pr_number": 1069, "pr_title": "Fix BD Callback PUT and issue link", "pr_createdAt": "2020-07-16T13:10:10Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1069", "timeline": [{"oid": "7cae30d85e2f23093a7097c1b189e8f0f7f974f3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7cae30d85e2f23093a7097c1b189e8f0f7f974f3", "message": "Fix(Issue Callback): Update BlackDuck issue callback PUT requests and update jira links from API to UI", "committedDate": "2020-07-16T13:09:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgzNDg0Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1069#discussion_r455834846", "bodyText": "If bomComponentVersionIssuesUrl is passed in, why are we overriding it here? Can you add a comment to explain? Or create a new variable to pass into performRequest(...) that would reveal the intent?", "author": "jamesrichard91", "createdAt": "2020-07-16T14:34:40Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/issues/BlackDuckProviderIssueHandler.java", "diffHunk": "@@ -59,6 +59,7 @@ public void createOrUpdateBlackDuckIssue(String bomComponentVersionIssuesUrl, Bl\n             issueRequestModel.setIssueDescription(existingIssue.getIssueDescription());\n             issueRequestModel.setIssueCreatedAt(existingIssue.getIssueCreatedAt());\n             issueRequestModel.setIssueUpdatedAt(currentDate);\n+            bomComponentVersionIssuesUrl = existingIssue.getMeta().getHref();", "originalCommit": "7cae30d85e2f23093a7097c1b189e8f0f7f974f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg0MTc4MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1069#discussion_r455841780", "bodyText": "A PUT requires the id be appended to the request, but the only way the API reveals that is through the href. I'll update the variable names to make it more clear.", "author": "gkillough", "createdAt": "2020-07-16T14:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgzNDg0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "3d758ced41ef54fb6e6791c1d4ddc520ef15159e", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/provider/blackduck/issues/BlackDuckProviderIssueHandler.java b/src/main/java/com/synopsys/integration/alert/provider/blackduck/issues/BlackDuckProviderIssueHandler.java\nindex fabe17298..6b081e231 100644\n--- a/src/main/java/com/synopsys/integration/alert/provider/blackduck/issues/BlackDuckProviderIssueHandler.java\n+++ b/src/main/java/com/synopsys/integration/alert/provider/blackduck/issues/BlackDuckProviderIssueHandler.java\n\n@@ -52,21 +52,25 @@ public class BlackDuckProviderIssueHandler {\n         Optional<IssueView> optionalExistingIssue = retrieveExistingIssue(bomComponentVersionIssuesUrl, issueModel.getKey());\n \n         Date currentDate = Date.from(Instant.now());\n+        String requestUri = bomComponentVersionIssuesUrl;\n         IssueView issueRequestModel = createIssueRequestModel(issueModel);\n+\n         Function<String, Request.Builder> requestBuilderCreator;\n         if (optionalExistingIssue.isPresent()) {\n             IssueView existingIssue = optionalExistingIssue.get();\n             issueRequestModel.setIssueDescription(existingIssue.getIssueDescription());\n             issueRequestModel.setIssueCreatedAt(existingIssue.getIssueCreatedAt());\n             issueRequestModel.setIssueUpdatedAt(currentDate);\n-            bomComponentVersionIssuesUrl = existingIssue.getMeta().getHref();\n+\n+            // The request uri should point at the specific issue for PUT requests\n+            requestUri = existingIssue.getMeta().getHref();\n             requestBuilderCreator = RequestFactory::createCommonPutRequestBuilder;\n         } else {\n             issueRequestModel.setIssueCreatedAt(currentDate);\n             issueRequestModel.setIssueUpdatedAt(null);\n             requestBuilderCreator = RequestFactory::createCommonPostRequestBuilder;\n         }\n-        performRequest(bomComponentVersionIssuesUrl, issueRequestModel, requestBuilderCreator);\n+        performRequest(requestUri, issueRequestModel, requestBuilderCreator);\n     }\n \n     // TODO fix this logic once the bomComponentVersionIssuesUrl supports GET requests directly\n"}}, {"oid": "3d758ced41ef54fb6e6791c1d4ddc520ef15159e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3d758ced41ef54fb6e6791c1d4ddc520ef15159e", "message": "Fix(Issue Tracker): Add variable for BD issue tracker request uri to clarify intent", "committedDate": "2020-07-16T15:37:17Z", "type": "commit"}]}