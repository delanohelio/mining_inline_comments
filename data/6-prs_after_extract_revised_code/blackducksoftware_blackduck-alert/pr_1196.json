{"pr_number": 1196, "pr_title": "Move the permission cache updates into authorizationManager", "pr_createdAt": "2020-09-29T19:09:21Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1196", "timeline": [{"oid": "3e49fefbcd34d660f2506be2ac5c765ba8292abd", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3e49fefbcd34d660f2506be2ac5c765ba8292abd", "message": "Refactor: Move the permission cache updates into authorizationManager", "committedDate": "2020-09-29T19:08:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3NTQ2OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1196#discussion_r496975468", "bodyText": "We can now return this line.", "author": "gkillough", "createdAt": "2020-09-29T19:11:52Z", "path": "src/main/java/com/synopsys/integration/alert/ApplicationConfiguration.java", "diffHunk": "@@ -134,7 +134,6 @@ public PasswordEncoder defaultPasswordEncoder() {\n     @Bean\n     public AuthorizationManager authorizationManager(RoleAccessor roleAccessor) {\n         AuthorizationManager authorizationManager = new AuthorizationManager(roleAccessor);", "originalCommit": "3e49fefbcd34d660f2506be2ac5c765ba8292abd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3a0e74cc39a2fd40ec947a484cfe7506879bc05c", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/ApplicationConfiguration.java b/src/main/java/com/synopsys/integration/alert/ApplicationConfiguration.java\nindex d0cd54dcc..641044123 100644\n--- a/src/main/java/com/synopsys/integration/alert/ApplicationConfiguration.java\n+++ b/src/main/java/com/synopsys/integration/alert/ApplicationConfiguration.java\n\n@@ -133,8 +133,7 @@ public class ApplicationConfiguration {\n \n     @Bean\n     public AuthorizationManager authorizationManager(RoleAccessor roleAccessor) {\n-        AuthorizationManager authorizationManager = new AuthorizationManager(roleAccessor);\n-        return authorizationManager;\n+        return new AuthorizationManager(roleAccessor);\n     }\n \n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3NjM0Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1196#discussion_r496976346", "bodyText": "Let's move this private method to under the public ones.", "author": "gkillough", "createdAt": "2020-09-29T19:12:47Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/security/authorization/AuthorizationManager.java", "diffHunk": "@@ -164,9 +167,35 @@ private boolean currentUserHasPermission(AccessOperation operation, String conte\n                    .map(role -> StringUtils.substringAfter(role, UserModel.ROLE_PREFIX)).collect(Collectors.toSet());\n     }\n \n-    public final void loadPermissionsIntoCache() {\n+    private final void loadPermissionsIntoCache() {\n         Collection<UserRoleModel> roles = roleAccessor.getRoles();\n         permissionCache.putAll(roles.stream().collect(Collectors.toMap(UserRoleModel::getName, UserRoleModel::getPermissions)));\n     }\n \n+    private final void updateRoleInCache(String roleName, PermissionMatrixModel permissions) {", "originalCommit": "3e49fefbcd34d660f2506be2ac5c765ba8292abd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3a0e74cc39a2fd40ec947a484cfe7506879bc05c", "chunk": "diff --git a/alert-common/src/main/java/com/synopsys/integration/alert/common/security/authorization/AuthorizationManager.java b/alert-common/src/main/java/com/synopsys/integration/alert/common/security/authorization/AuthorizationManager.java\nindex 86697d1a5..a9044ba75 100644\n--- a/alert-common/src/main/java/com/synopsys/integration/alert/common/security/authorization/AuthorizationManager.java\n+++ b/alert-common/src/main/java/com/synopsys/integration/alert/common/security/authorization/AuthorizationManager.java\n\n@@ -175,27 +198,4 @@ public class AuthorizationManager {\n     private final void updateRoleInCache(String roleName, PermissionMatrixModel permissions) {\n         permissionCache.put(roleName, permissions);\n     }\n-\n-    public UserRoleModel createRoleWithPermissions(String roleName, PermissionMatrixModel permissionMatrix) throws AlertDatabaseConstraintException {\n-        UserRoleModel roleWithPermissions = roleAccessor.createRoleWithPermissions(roleName, permissionMatrix);\n-        updateRoleInCache(roleWithPermissions.getName(), roleWithPermissions.getPermissions());\n-        return roleWithPermissions;\n-    }\n-\n-    public PermissionMatrixModel updatePermissionsForRole(String roleName, PermissionMatrixModel permissionMatrix) throws AlertDatabaseConstraintException {\n-        PermissionMatrixModel permissionMatrixModel = roleAccessor.updatePermissionsForRole(roleName, permissionMatrix);\n-        updateRoleInCache(roleName, permissionMatrixModel);\n-        return permissionMatrixModel;\n-    }\n-\n-    public void deleteRole(Long roleId) throws AlertForbiddenOperationException {\n-        roleAccessor.deleteRole(roleId);\n-        loadPermissionsIntoCache();\n-    }\n-\n-    public void updateUserRoles(Long userId, Collection<UserRoleModel> roles) {\n-        roleAccessor.updateUserRoles(userId, roles);\n-        roles.stream()\n-            .forEach(userRoleModel -> updateRoleInCache(userRoleModel.getName(), userRoleModel.getPermissions()));\n-    }\n }\n"}}, {"oid": "3a0e74cc39a2fd40ec947a484cfe7506879bc05c", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3a0e74cc39a2fd40ec947a484cfe7506879bc05c", "message": "Refactor: moving the public method above private methods based on PR suggestions", "committedDate": "2020-09-29T19:27:42Z", "type": "commit"}]}