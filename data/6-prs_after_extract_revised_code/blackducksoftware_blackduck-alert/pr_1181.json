{"pr_number": 1181, "pr_title": "Remove Jira Admin Requirements", "pr_createdAt": "2020-09-22T20:15:48Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181", "timeline": [{"oid": "22088a77e2fe9b39d8de9e9cd3c86197500e0b15", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/22088a77e2fe9b39d8de9e9cd3c86197500e0b15", "message": "Feat(Jira Cloud): Add conditional logic for disabling plugin check", "committedDate": "2020-09-22T17:56:05Z", "type": "commit"}, {"oid": "defe4344bd69f9d908a90fb3c610ed672c9f9c58", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/defe4344bd69f9d908a90fb3c610ed672c9f9c58", "message": "Fix(Jira Cloud): Change label for plugin check field", "committedDate": "2020-09-22T19:03:35Z", "type": "commit"}, {"oid": "11222c178326d1c9c3a9bb15e1d20725481b6fe4", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/11222c178326d1c9c3a9bb15e1d20725481b6fe4", "message": "Feat(Jira Server): Add plugin check field", "committedDate": "2020-09-22T19:47:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxNTQ1Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493015453", "bodyText": "\"of the user Jira Cloud user\" should be simplified to \"of the Jira Cloud user\"", "author": "jamesrichard91", "createdAt": "2020-09-22T20:32:01Z", "path": "src/main/java/com/synopsys/integration/alert/channel/jira/cloud/descriptor/JiraCloudGlobalUIConfig.java", "diffHunk": "@@ -38,13 +39,16 @@\n @Component\n public class JiraCloudGlobalUIConfig extends UIConfig {\n     public static final String LABEL_URL = \"Url\";\n-    public static final String LABEL_ADMIN_EMAIL_ADDRESS = \"Admin Email Address\";\n-    public static final String LABEL_ADMIN_API_TOKEN = \"Admin API Token\";\n+    public static final String LABEL_EMAIL_ADDRESS = \"Email Address\";\n+    public static final String LABEL_API_TOKEN = \"API Token\";\n+    public static final String LABEL_DISABLE_PLUGIN_CHECK = \"Disable Plugin Check\";\n     public static final String LABEL_CONFIGURE_PLUGIN = \"Configure Jira Cloud plugin\";\n \n     public static final String DESCRIPTION_URL = \"The URL of the Jira Cloud server.\";\n-    public static final String DESCRIPTION_ADMIN_USER_NAME = \"The email address of the admin used to log into the Jira Cloud server that has generated the API token.\";\n-    public static final String DESCRIPTION_ADMIN_API_TOKEN = \"The admin API token used to send API requests to the Jira Cloud server.\";\n+    public static final String DESCRIPTION_USER_NAME = \"The email address of the user Jira Cloud user. Note: Unless 'Disable Plugin Check' is checked, this user must be a Jira admin.\";", "originalCommit": "11222c178326d1c9c3a9bb15e1d20725481b6fe4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b8767fcad04e24be202c027fa71625eccf543fb", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/channel/jira/cloud/descriptor/JiraCloudGlobalUIConfig.java b/src/main/java/com/synopsys/integration/alert/channel/jira/cloud/descriptor/JiraCloudGlobalUIConfig.java\nindex baeb293d2..d04c39cea 100644\n--- a/src/main/java/com/synopsys/integration/alert/channel/jira/cloud/descriptor/JiraCloudGlobalUIConfig.java\n+++ b/src/main/java/com/synopsys/integration/alert/channel/jira/cloud/descriptor/JiraCloudGlobalUIConfig.java\n\n@@ -45,7 +45,7 @@ public class JiraCloudGlobalUIConfig extends UIConfig {\n     public static final String LABEL_CONFIGURE_PLUGIN = \"Configure Jira Cloud plugin\";\n \n     public static final String DESCRIPTION_URL = \"The URL of the Jira Cloud server.\";\n-    public static final String DESCRIPTION_USER_NAME = \"The email address of the user Jira Cloud user. Note: Unless 'Disable Plugin Check' is checked, this user must be a Jira admin.\";\n+    public static final String DESCRIPTION_USER_NAME = \"The email address of the Jira Cloud user. Note: Unless 'Disable Plugin Check' is checked, this user must be a Jira admin.\";\n     public static final String DESCRIPTION_API_TOKEN = \"The API token of the specified Jira user.\";\n     public static final String DESCRIPTION_DISABLE_PLUGIN_CHECK = \"This will disable checking whether the 'Alert Issue Property Indexer' plugin is installed on the specified Jira instance.\"\n                                                                       + \" Please ensure that the plugin is manually installed before using Alert with Jira. If not, issues created by Alert will not be updated properly.\";\n"}}, {"oid": "6b8767fcad04e24be202c027fa71625eccf543fb", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6b8767fcad04e24be202c027fa71625eccf543fb", "message": "Feat(Jira): Update global UI config fields", "committedDate": "2020-09-23T12:20:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyOTgwNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493629804", "bodyText": "Should this be passed PluginManagerService, username, and accessToken?", "author": "bamandel", "createdAt": "2020-09-23T14:16:52Z", "path": "src/main/java/com/synopsys/integration/alert/channel/jira/cloud/JiraCloudRequestDelegator.java", "diffHunk": "@@ -98,4 +92,17 @@ public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) thr\n         return jiraIssueHandler.createOrUpdateIssues(validIssueConfig, requests);\n     }\n \n+    private void checkIfAlertPluginIsInstalled(JiraCloudServiceFactory jiraCloudServiceFactory, JiraCloudProperties jiraProperties) throws IssueTrackerException {", "originalCommit": "6b8767fcad04e24be202c027fa71625eccf543fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzNzI4Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493637283", "bodyText": "It's not a public method, so I think it's better to minimize the clutter. Especially since this operation won't always happen.", "author": "gkillough", "createdAt": "2020-09-23T14:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyOTgwNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODE1MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493638150", "bodyText": "This method is done almost exactly the same as the other of checkIsAppInstalledAndRetryIfNecessary. Can you change the method to take a BiFunction so that all you need here is to pass in username and password then a method reference to jiraAppService::isAppInstalled", "author": "bamandel", "createdAt": "2020-09-23T14:27:18Z", "path": "src/main/java/com/synopsys/integration/alert/channel/jira/server/web/JiraServerCustomFunctionAction.java", "diffHunk": "@@ -85,7 +84,7 @@ public JiraServerCustomFunctionAction(AuthorizationManager authorizationManager,\n                 }\n                 createBadRequestIntegrationException(e);\n             }\n-            boolean jiraPluginInstalled = isJiraPluginInstalled(jiraAppService, password, username, JiraConstants.JIRA_APP_KEY);\n+            boolean jiraPluginInstalled = JiraPluginCheckUtil.checkIsAppInstalledAndRetryIfNecessary(() -> jiraAppService.isAppInstalled(username, password, JiraConstants.JIRA_APP_KEY));", "originalCommit": "6b8767fcad04e24be202c027fa71625eccf543fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY0OTk5Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493649993", "bodyText": "I would still need to create a lambda in order to pass the app key as the third param. I don't know if it's worth it at that point.", "author": "gkillough", "createdAt": "2020-09-23T14:42:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODE1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY1NDUyNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493654524", "bodyText": "Actually, both server and cloud use the same PluginManagerService. Could you just pass that, username, and password to the static method and run the call yourself?", "author": "bamandel", "createdAt": "2020-09-23T14:47:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODE1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY2MjQ1NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493662455", "bodyText": "I could. What are you trying to solve here? You don't like the lambda?", "author": "gkillough", "createdAt": "2020-09-23T14:57:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODE1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY2NDQ0OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1181#discussion_r493664448", "bodyText": "The lambda just feels a little unnecessary here. I think we could make it clearer with just normal method parameters. Lambdas to me generally mean different functionality, but we're always doing the same check.", "author": "bamandel", "createdAt": "2020-09-23T14:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODE1MA=="}], "type": "inlineReview", "revised_code": {"commit": "a45b47d17da6be313cca9d60b968115878d6ab19", "chunk": "diff --git a/src/main/java/com/synopsys/integration/alert/channel/jira/server/web/JiraServerCustomFunctionAction.java b/src/main/java/com/synopsys/integration/alert/channel/jira/server/web/JiraServerCustomFunctionAction.java\nindex 8766864d0..bb7a8dffa 100644\n--- a/src/main/java/com/synopsys/integration/alert/channel/jira/server/web/JiraServerCustomFunctionAction.java\n+++ b/src/main/java/com/synopsys/integration/alert/channel/jira/server/web/JiraServerCustomFunctionAction.java\n\n@@ -84,7 +84,7 @@ public class JiraServerCustomFunctionAction extends CustomFunctionAction<String>\n                 }\n                 createBadRequestIntegrationException(e);\n             }\n-            boolean jiraPluginInstalled = JiraPluginCheckUtil.checkIsAppInstalledAndRetryIfNecessary(() -> jiraAppService.isAppInstalled(username, password, JiraConstants.JIRA_APP_KEY));\n+            boolean jiraPluginInstalled = JiraPluginCheckUtil.checkIsAppInstalledAndRetryIfNecessary(jiraAppService, username, password);\n             if (!jiraPluginInstalled) {\n                 return new ActionResponse<>(HttpStatus.NOT_FOUND, \"Was not able to confirm Jira server successfully installed the Jira Server plugin. Please verify the installation on you Jira server.\");\n             }\n"}}, {"oid": "a45b47d17da6be313cca9d60b968115878d6ab19", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a45b47d17da6be313cca9d60b968115878d6ab19", "message": "Fix(Jira): Update plugin check util to not use a lambda", "committedDate": "2020-09-23T15:10:00Z", "type": "commit"}, {"oid": "a1f15e9b9c894dc26b6c2202a38d7da8c70b88ce", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a1f15e9b9c894dc26b6c2202a38d7da8c70b88ce", "message": "Merge branch 'master' into gk_remove_jira_admin_req", "committedDate": "2020-09-23T19:18:36Z", "type": "commit"}, {"oid": "c482915a8dc5c61ad37ceffc6c97e936c607b3d0", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c482915a8dc5c61ad37ceffc6c97e936c607b3d0", "message": "Merge branch 'master' into gk_remove_jira_admin_req", "committedDate": "2020-09-23T19:42:57Z", "type": "commit"}, {"oid": "0b34e50e0b70eac3bfa39ec3bcb4f6ff7eda47a9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0b34e50e0b70eac3bfa39ec3bcb4f6ff7eda47a9", "message": "Merge branch 'master' into gk_remove_jira_admin_req", "committedDate": "2020-09-23T20:36:33Z", "type": "commit"}, {"oid": "6644cdd909df690b2cfe43682045dd34815c248c", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6644cdd909df690b2cfe43682045dd34815c248c", "message": "Fix(Liquibase): Fix copy/paste error with descriptor name", "committedDate": "2020-09-24T13:53:08Z", "type": "commit"}, {"oid": "2db596e2f00c85c790cea1c014964e88a95d9796", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2db596e2f00c85c790cea1c014964e88a95d9796", "message": "Fix(Jira Server): Update UI config descriptions", "committedDate": "2020-09-24T14:29:41Z", "type": "commit"}]}