{"pr_number": 1280, "pr_title": "Store href as part of a Job's configured project data", "pr_createdAt": "2020-12-02T18:13:34Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1280", "timeline": [{"oid": "55fe9ff91d4834c6ddfbc5d56a7e2474e7591ba9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/55fe9ff91d4834c6ddfbc5d56a7e2474e7591ba9", "message": "Feat(BlackDuck): Store href and project owner email in blackduck_job_projects and migrate from old versions", "committedDate": "2020-11-19T14:46:07Z", "type": "commit"}, {"oid": "87df1c7409ff80b39d1b229de070f2b2bfc28fde", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/87df1c7409ff80b39d1b229de070f2b2bfc28fde", "message": "Feat(BlackDuck): Update job java models to include href and project owner email", "committedDate": "2020-11-19T15:49:29Z", "type": "commit"}, {"oid": "f609aecfdfad08eadccf8d4e3f5f7d3fd98869ad", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f609aecfdfad08eadccf8d4e3f5f7d3fd98869ad", "message": "Chore: Add FIXME comments for changes required to fully support href and project owner email", "committedDate": "2020-11-19T16:13:14Z", "type": "commit"}, {"oid": "15531cf84cf3f6032bc6db6537f1055e7f2feacf", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/15531cf84cf3f6032bc6db6537f1055e7f2feacf", "message": "Feat(Liquibase): Use BlackDuck project href in primary key rather than project name", "committedDate": "2020-11-19T19:43:35Z", "type": "commit"}, {"oid": "b8661a22904df382f865a0f853d652a00d2aaf76", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b8661a22904df382f865a0f853d652a00d2aaf76", "message": "Feat(Job): Add list of projects as top-level field on JobFieldModel", "committedDate": "2020-11-19T20:08:23Z", "type": "commit"}, {"oid": "03fbe7d279498ad1dba5ef3f1933b14316c123c4", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/03fbe7d279498ad1dba5ef3f1933b14316c123c4", "message": "Feat(Job UI): Begin tracking configuredProviderProjects in UI state", "committedDate": "2020-11-20T13:47:28Z", "type": "commit"}, {"oid": "6b3397d9165a27b7b88b160c95b995bc1d0b0dc3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6b3397d9165a27b7b88b160c95b995bc1d0b0dc3", "message": "Merge branch 'master' into gk_migrate_href", "committedDate": "2020-11-23T15:40:46Z", "type": "commit"}, {"oid": "1b8d1f2228f96d2485d9997175d03566ba673c7b", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1b8d1f2228f96d2485d9997175d03566ba673c7b", "message": "Feat(UI): Begin implementing table select value basic object support", "committedDate": "2020-11-23T19:35:07Z", "type": "commit"}, {"oid": "095930c874277e6523433ad6ca4440ba41d7c25e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/095930c874277e6523433ad6ca4440ba41d7c25e", "message": "Feat(BlackDuck): Prepare DB API layer for storing more project fields", "committedDate": "2020-11-24T14:28:18Z", "type": "commit"}, {"oid": "fc7f81b48b2aab2658d6c3be28a8efe03d2cc584", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/fc7f81b48b2aab2658d6c3be28a8efe03d2cc584", "message": "Fixing header, fixing object copy, fixing data selection", "committedDate": "2020-11-24T19:55:32Z", "type": "commit"}, {"oid": "8b3d34c6ca050eec6a566289633e81d1e0324292", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8b3d34c6ca050eec6a566289633e81d1e0324292", "message": "Merge branch 'gk_migrate_href_object_field_values' into gk_migrate_href", "committedDate": "2020-11-25T13:33:48Z", "type": "commit"}, {"oid": "c710525a8de084473362f8b20cb24432f9e987c8", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c710525a8de084473362f8b20cb24432f9e987c8", "message": "Merge branch 'master' into gk_migrate_href and resolve conflicts", "committedDate": "2020-11-30T15:57:37Z", "type": "commit"}, {"oid": "81bb066fddf8090a596e98f5053aea4325473967", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/81bb066fddf8090a596e98f5053aea4325473967", "message": "Merge branch 'master' into gk_migrate_href and resolve conflicts/compile errors", "committedDate": "2020-12-01T19:21:02Z", "type": "commit"}, {"oid": "b262ae7b868f3e91f1704c38cb90d41f2087f190", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b262ae7b868f3e91f1704c38cb90d41f2087f190", "message": "Fix(Job): Set missing timestamp fields where appropriate", "committedDate": "2020-12-01T20:59:11Z", "type": "commit"}, {"oid": "19e46b6964599ba9ac8242b03fa5a6b722ae2240", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/19e46b6964599ba9ac8242b03fa5a6b722ae2240", "message": "Feat(Job): Update JobConfigActions to properly persist projects from JobFieldModel", "committedDate": "2020-12-02T14:37:44Z", "type": "commit"}, {"oid": "1f02a5a3d9b1f13132b4f498abab74d608802112", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1f02a5a3d9b1f13132b4f498abab74d608802112", "message": "Fix(UI): Set initial values for edit/copy in jobs to be JSON when appropriate", "committedDate": "2020-12-02T17:38:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM4MDE1NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1280#discussion_r534380154", "bodyText": "Required as long as we are dynamically generating the Job modal.", "author": "gkillough", "createdAt": "2020-12-02T18:14:32Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/config/field/endpoint/table/EndpointTableSelectField.java", "diffHunk": "@@ -32,13 +32,15 @@\n public class EndpointTableSelectField extends EndpointField {\n     private boolean paged;\n     private boolean searchable;\n+    private boolean useRowAsValue;", "originalCommit": "1f02a5a3d9b1f13132b4f498abab74d608802112", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM4MjM2NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1280#discussion_r534382364", "bodyText": "As an AlertSerializableModel the .toString() method will be in JSON format.", "author": "gkillough", "createdAt": "2020-12-02T18:17:49Z", "path": "web/src/main/java/com/synopsys/integration/alert/web/api/job/JobFieldModelPopulationUtils.java", "diffHunk": "@@ -85,9 +95,13 @@ public static void populateProviderFields(FieldModel providerFieldModel, Distrib\n                 .filter(StringUtils::isNotBlank)\n                 .ifPresent(pattern -> putField(providerFieldModel, ProviderDistributionUIConfig.KEY_PROJECT_NAME_PATTERN, pattern));\n \n-            List<String> blackDuckProjectNames = jobModel.getProjectFilterProjectNames();\n-            if (!blackDuckProjectNames.isEmpty()) {\n-                putField(providerFieldModel, ProviderDistributionUIConfig.KEY_CONFIGURED_PROJECT, blackDuckProjectNames);\n+            // Convert to JSON for 6.4.0 while the dynamic ui still uses these as initial values on edit/copy\n+            List<String> blackDuckProjectJson = jobModel.getProjectFilterDetails()\n+                                                    .stream()\n+                                                    .map(BlackDuckProjectDetailsModel::toString)", "originalCommit": "1f02a5a3d9b1f13132b4f498abab74d608802112", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQyMjQzNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1280#discussion_r534422437", "bodyText": "Should be lower case P, projectFiltersToSave", "author": "jamesrichard91", "createdAt": "2020-12-02T19:22:06Z", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/job/blackduck/BlackDuckJobDetailsAccessor.java", "diffHunk": "@@ -78,27 +79,32 @@ public BlackDuckJobDetailsEntity saveBlackDuckJobDetails(UUID jobId, Distributio\n                                                                                .stream()\n                                                                                .map(notificationType -> new BlackDuckJobNotificationTypeEntity(jobId, notificationType))\n                                                                                .collect(Collectors.toList());\n+        blackDuckJobNotificationTypeRepository.deleteAllByJobId(jobId);\n         List<BlackDuckJobNotificationTypeEntity> savedNotificationTypes = blackDuckJobNotificationTypeRepository.saveAll(notificationTypesToSave);\n         savedBlackDuckJobDetails.setBlackDuckJobNotificationTypes(savedNotificationTypes);\n \n-        List<BlackDuckJobProjectEntity> ProjectFiltersToSave = requestModel.getProjectFilterProjectNames()\n+        List<BlackDuckJobProjectEntity> ProjectFiltersToSave = requestModel.getProjectFilterDetails()", "originalCommit": "1f02a5a3d9b1f13132b4f498abab74d608802112", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e151c904e5e4015fcb102a8589fa2e17334e740b", "chunk": "diff --git a/alert-database/src/main/java/com/synopsys/integration/alert/database/job/blackduck/BlackDuckJobDetailsAccessor.java b/alert-database/src/main/java/com/synopsys/integration/alert/database/job/blackduck/BlackDuckJobDetailsAccessor.java\nindex 9708d9f65..e73b2e29b 100644\n--- a/alert-database/src/main/java/com/synopsys/integration/alert/database/job/blackduck/BlackDuckJobDetailsAccessor.java\n+++ b/alert-database/src/main/java/com/synopsys/integration/alert/database/job/blackduck/BlackDuckJobDetailsAccessor.java\n\n@@ -83,13 +83,13 @@ public class BlackDuckJobDetailsAccessor {\n         List<BlackDuckJobNotificationTypeEntity> savedNotificationTypes = blackDuckJobNotificationTypeRepository.saveAll(notificationTypesToSave);\n         savedBlackDuckJobDetails.setBlackDuckJobNotificationTypes(savedNotificationTypes);\n \n-        List<BlackDuckJobProjectEntity> ProjectFiltersToSave = requestModel.getProjectFilterDetails()\n+        List<BlackDuckJobProjectEntity> projectFiltersToSave = requestModel.getProjectFilterDetails()\n                                                                    .stream()\n                                                                    .map(projectDetails -> new BlackDuckJobProjectEntity(jobId, projectDetails.getName(), projectDetails.getHref(),\n                                                                        projectDetails.getProjectOwnerEmail().orElse(null)))\n                                                                    .collect(Collectors.toList());\n         blackDuckJobProjectRepository.deleteAllByJobId(jobId);\n-        List<BlackDuckJobProjectEntity> savedProjectFilters = blackDuckJobProjectRepository.saveAll(ProjectFiltersToSave);\n+        List<BlackDuckJobProjectEntity> savedProjectFilters = blackDuckJobProjectRepository.saveAll(projectFiltersToSave);\n         savedBlackDuckJobDetails.setBlackDuckJobProjects(savedProjectFilters);\n \n         List<BlackDuckJobPolicyFilterEntity> policyFiltersToSave = requestModel.getPolicyFilterPolicyNames()\n"}}, {"oid": "e151c904e5e4015fcb102a8589fa2e17334e740b", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e151c904e5e4015fcb102a8589fa2e17334e740b", "message": "Fix: Typo in camelCase", "committedDate": "2020-12-02T19:34:55Z", "type": "commit"}, {"oid": "2fb2ca393730b86942d005155da5bc50e8e112cd", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2fb2ca393730b86942d005155da5bc50e8e112cd", "message": "Fix(UI): Make provider project rows deselectable", "committedDate": "2020-12-02T20:05:28Z", "type": "commit"}]}