{"pr_number": 1227, "pr_title": "Paged Job Controller", "pr_createdAt": "2020-10-19T16:55:27Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227", "timeline": [{"oid": "78e2099bb19614f23c52cc5047c4cf42ad889ba2", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/78e2099bb19614f23c52cc5047c4cf42ad889ba2", "message": "Fix(AlertPagedModel): Begin refactoring in preperation for paging support", "committedDate": "2020-10-15T12:44:01Z", "type": "commit"}, {"oid": "7906379c4a1cea2c3a5c72003fd191eb9fa2d998", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7906379c4a1cea2c3a5c72003fd191eb9fa2d998", "message": "Refactor(JobAccessor): Split out job-related methods from ConfigurationAccessor to JobAccessor", "committedDate": "2020-10-15T15:07:09Z", "type": "commit"}, {"oid": "bbe55ef7b5b4d749d7ce1b21cee51185672f3f48", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bbe55ef7b5b4d749d7ce1b21cee51185672f3f48", "message": "Feat(JobConfigActions): Begin implementing paging logic", "committedDate": "2020-10-15T19:32:08Z", "type": "commit"}, {"oid": "49e73a15fd38368fedf8012f88a66f8d8f4565db", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/49e73a15fd38368fedf8012f88a66f8d8f4565db", "message": "Merge branch 'master' into gk_paged_job_controller", "committedDate": "2020-10-15T19:47:13Z", "type": "commit"}, {"oid": "8028d8c4f2b8871d75a8073813ff724e6f77c7f3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8028d8c4f2b8871d75a8073813ff724e6f77c7f3", "message": "Feat(JobAccessor): Implement paged query for jobs", "committedDate": "2020-10-16T13:40:29Z", "type": "commit"}, {"oid": "93c3bf6948addcfedd8b45ce02ff6956045127cf", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/93c3bf6948addcfedd8b45ce02ff6956045127cf", "message": "Feat(JobConfigActions): Add validation to job paged request", "committedDate": "2020-10-16T14:02:29Z", "type": "commit"}, {"oid": "8cefa8c4c9d34549c28abb7e04bb1b60353c3c27", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8cefa8c4c9d34549c28abb7e04bb1b60353c3c27", "message": "Fix(JobConfigController): Add basic interface for paging with controllers and remove getAll endpoint", "committedDate": "2020-10-16T15:12:14Z", "type": "commit"}, {"oid": "81481b7f50f19a45babfe45d567bf6ecf2b96648", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/81481b7f50f19a45babfe45d567bf6ecf2b96648", "message": "Fix(JobAccessor): Update job query to account for descriptor permissions", "committedDate": "2020-10-16T16:19:43Z", "type": "commit"}, {"oid": "9d1070ae4641e9e06fe2f9610228b4532ab7d7b8", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/9d1070ae4641e9e06fe2f9610228b4532ab7d7b8", "message": "Add FIXMEs for things that require paging", "committedDate": "2020-10-16T19:30:36Z", "type": "commit"}, {"oid": "0a4ef3f1f335a786c7ab554307e694a623c84589", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0a4ef3f1f335a786c7ab554307e694a623c84589", "message": "Feat(UI): Add paging to jobs table", "committedDate": "2020-10-19T15:49:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxMDgyMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r507910823", "bodyText": "Create a ticket for this.", "author": "gkillough", "createdAt": "2020-10-19T17:01:47Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/AlertPagedModel.java", "diffHunk": "@@ -24,17 +24,29 @@\n \n import java.util.List;\n \n+import org.springframework.data.domain.Page;\n+\n+import net.minidev.json.annotate.JsonIgnore;\n+\n public class AlertPagedModel<M extends AlertSerializableModel> extends AlertSerializableModel {\n+    public static final String DEFAULT_PAGE_NUMBER = \"0\";\n+    public static final String DEFAULT_PAGE_SIZE = \"10\";\n+\n+    // FIXME we should use terminology based on \"offset\" and \"limit\" which are standard REST API paging terms", "originalCommit": "0a4ef3f1f335a786c7ab554307e694a623c84589", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxMTY2Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r507911667", "bodyText": "Looking for suggestions.", "author": "gkillough", "createdAt": "2020-10-19T17:03:09Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/PagingParamValidationUtils.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.util;\n+\n+import java.util.Optional;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+\n+public class PagingParamValidationUtils {\n+    // TODO find a good home for this\n+    public static <T> Optional<ActionResponse<T>> createErrorActionResponseIfInvalid(Integer pageNumber, Integer pageSize) {", "originalCommit": "0a4ef3f1f335a786c7ab554307e694a623c84589", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxNTY5Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r507915693", "bodyText": "Create a ticket for this.", "author": "gkillough", "createdAt": "2020-10-19T17:09:49Z", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationAccessor.java", "diffHunk": "@@ -167,7 +169,10 @@ public void deleteNotification(AlertNotificationModel notification) {\n         notificationContentRepository.deleteById(notification.getId());\n     }\n \n-    public PageRequest getPageRequestForNotifications(Integer pageNumber, Integer pageSize, String sortField, String sortOrder) {\n+    public PageRequest getPageRequestForNotifications(@Nullable Integer pageNumber, @Nullable Integer pageSize, @Nullable String sortField, @Nullable String sortOrder) {\n+        // FIXME Integer.MAX_VALUE does not seem like an appropriate default\n+        //  Because this is an internal API, we should not expect pageNumber and pageSize to be @Nullable\n+        //  Default values should be handled at the public API level\n         Integer page = ObjectUtils.defaultIfNull(pageNumber, 0);\n         Integer size = ObjectUtils.defaultIfNull(pageSize, Integer.MAX_VALUE);", "originalCommit": "0a4ef3f1f335a786c7ab554307e694a623c84589", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "0ccf827e3d76275482e4002ded9faa9f8258a202", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0ccf827e3d76275482e4002ded9faa9f8258a202", "message": "Fix(Paging): Clean up some TODOs and FIXMEs", "committedDate": "2020-10-19T17:46:22Z", "type": "commit"}, {"oid": "77a8e8c7ccf1e89bb52fe033bd557bd770d79b0b", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/77a8e8c7ccf1e89bb52fe033bd557bd770d79b0b", "message": "Fix(Jobs): Change job table validation to only validate jobs being displayed (instead of all jobs)", "committedDate": "2020-10-19T19:08:20Z", "type": "commit"}, {"oid": "2a352ea14984e2a73ef1d18101dd47756da1cfad", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2a352ea14984e2a73ef1d18101dd47756da1cfad", "message": "Fix(Job Validation): Add new query to make job-name-uniqueness check more efficient", "committedDate": "2020-10-19T19:59:20Z", "type": "commit"}, {"oid": "ccdba90be76136dd0224e25c0082ca338591041e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ccdba90be76136dd0224e25c0082ca338591041e", "message": "Fix(JobConfigActions): Remove FIXME comment that was already resolved", "committedDate": "2020-10-19T20:26:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE5MzI0Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509193242", "bodyText": "By the name of this I thought this was the validation result of the jobs.  Can we make a slight change to make it clear this is to be used with a request.\nFor example: JobsIdsValidationRequestModel", "author": "psantos1113", "createdAt": "2020-10-21T11:15:41Z", "path": "web/src/main/java/com/synopsys/integration/alert/web/api/job/JobIdsValidationModel.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.synopsys.integration.alert.web.api.job;\n+\n+import java.util.List;\n+import java.util.UUID;\n+\n+import com.synopsys.integration.alert.common.rest.model.AlertSerializableModel;\n+\n+public class JobIdsValidationModel extends AlertSerializableModel {", "originalCommit": "ccdba90be76136dd0224e25c0082ca338591041e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "35c2f82b5d18fce7b2b3dd471bacab1c36b0366f", "chunk": "diff --git a/web/src/main/java/com/synopsys/integration/alert/web/api/job/JobIdsValidationModel.java b/web/src/main/java/com/synopsys/integration/alert/web/api/job/JobIdsValidationModel.java\ndeleted file mode 100644\nindex 4ee29f1d6..000000000\n--- a/web/src/main/java/com/synopsys/integration/alert/web/api/job/JobIdsValidationModel.java\n+++ /dev/null\n\n@@ -1,23 +0,0 @@\n-package com.synopsys.integration.alert.web.api.job;\n-\n-import java.util.List;\n-import java.util.UUID;\n-\n-import com.synopsys.integration.alert.common.rest.model.AlertSerializableModel;\n-\n-public class JobIdsValidationModel extends AlertSerializableModel {\n-    private List<UUID> jobIds;\n-\n-    public JobIdsValidationModel() {\n-        // For serialization\n-    }\n-\n-    public JobIdsValidationModel(List<UUID> jobIds) {\n-        this.jobIds = jobIds;\n-    }\n-\n-    public List<UUID> getJobIds() {\n-        return jobIds;\n-    }\n-\n-}\n"}}, {"oid": "35c2f82b5d18fce7b2b3dd471bacab1c36b0366f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/35c2f82b5d18fce7b2b3dd471bacab1c36b0366f", "message": "Refactor(Job Model): Rename model to include 'response' in its name", "committedDate": "2020-10-21T14:33:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM2MzQwMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509363402", "bodyText": "isn't 10 a little low? I feel we should be able to get at least 100 items a page rather quickly", "author": "bamandel", "createdAt": "2020-10-21T15:00:08Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/AlertPagedModel.java", "diffHunk": "@@ -24,17 +24,29 @@\n \n import java.util.List;\n \n+import org.springframework.data.domain.Page;\n+\n+import net.minidev.json.annotate.JsonIgnore;\n+\n public class AlertPagedModel<M extends AlertSerializableModel> extends AlertSerializableModel {\n+    public static final String DEFAULT_PAGE_NUMBER = \"0\";\n+    public static final String DEFAULT_PAGE_SIZE = \"10\";", "originalCommit": "35c2f82b5d18fce7b2b3dd471bacab1c36b0366f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM3MzAyMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509373023", "bodyText": "The client of the API can override this, but 10 is the default for audit entries and Black Duck API pages, so I was trying to key off of that.", "author": "gkillough", "createdAt": "2020-10-21T15:11:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM2MzQwMg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM2OTk3Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509369977", "bodyText": "Should we be using the jetbrains nullable?", "author": "bamandel", "createdAt": "2020-10-21T15:08:23Z", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationAccessor.java", "diffHunk": "@@ -29,6 +29,8 @@\n import java.util.Optional;\n import java.util.stream.Collectors;\n \n+import javax.annotation.Nullable;", "originalCommit": "35c2f82b5d18fce7b2b3dd471bacab1c36b0366f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM3MjA0NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509372045", "bodyText": "Good catch. This change was made before that decision.", "author": "gkillough", "createdAt": "2020-10-21T15:10:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM2OTk3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "62e79a09f6e39a4e5b45e65aaeadd6d4fc6e70b9", "chunk": "diff --git a/alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationAccessor.java b/alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationAccessor.java\nindex aff089e8b..756cf096f 100644\n--- a/alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationAccessor.java\n+++ b/alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationAccessor.java\n\n@@ -29,10 +29,9 @@ import java.util.Locale;\n import java.util.Optional;\n import java.util.stream.Collectors;\n \n-import javax.annotation.Nullable;\n-\n import org.apache.commons.lang3.ObjectUtils;\n import org.apache.commons.lang3.StringUtils;\n+import org.jetbrains.annotations.Nullable;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n"}}, {"oid": "62e79a09f6e39a4e5b45e65aaeadd6d4fc6e70b9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/62e79a09f6e39a4e5b45e65aaeadd6d4fc6e70b9", "message": "Refactor(Annotation): Use JetBrains Nullable to conform to convention", "committedDate": "2020-10-21T15:15:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM4NTc0Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509385746", "bodyText": "Are these for the next major version? Since people are using our API, won't this break things for them?", "author": "bamandel", "createdAt": "2020-10-21T15:28:02Z", "path": "web/src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "diffHunk": "@@ -54,9 +54,9 @@ public JobConfigController(JobConfigActions jobConfigActions) {\n         this.jobConfigActions = jobConfigActions;\n     }\n \n-    @GetMapping(\"/validate\")\n-    public List<JobFieldStatuses> getValidationResultsForJobs() {\n-        return ResponseFactory.createContentResponseFromAction(jobConfigActions.validateAllJobs());\n+    @PostMapping(\"/validateJobsById\")", "originalCommit": "35c2f82b5d18fce7b2b3dd471bacab1c36b0366f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMTc2OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1227#discussion_r509401769", "bodyText": "We have swagger documentation of endpoints, but we make it explicitly clear that these endpoints are not considered stable.", "author": "gkillough", "createdAt": "2020-10-21T15:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM4NTc0Ng=="}], "type": "inlineReview", "revised_code": null}]}