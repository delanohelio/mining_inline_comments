{"pr_number": 4901, "pr_title": "fix(TUP-26347):Bug in tMap component using Talend Studio on Mac", "pr_createdAt": "2020-07-08T10:12:09Z", "pr_url": "https://github.com/Talend/tdi-studio-se/pull/4901", "timeline": [{"oid": "77ac86fcc9bc4c835d3023a3d696bad881386dc2", "url": "https://github.com/Talend/tdi-studio-se/commit/77ac86fcc9bc4c835d3023a3d696bad881386dc2", "message": "fix(TUP-26347):Bug in tMap component using Talend Studio on Mac\nhttps://jira.talendforge.org/browse/TUP-26347", "committedDate": "2020-07-08T10:08:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ3OTM1Mw==", "url": "https://github.com/Talend/tdi-studio-se/pull/4901#discussion_r451479353", "bodyText": "It is better to use try finally block here, change the default value of customSized in try block, then set back the default value of customSized in finally block.", "author": "cmeng-talend", "createdAt": "2020-07-08T11:44:26Z", "path": "main/plugins/org.talend.designer.mapper/src/main/java/org/talend/designer/mapper/ui/visualmap/table/DataMapTableView.java", "diffHunk": "@@ -3531,20 +3531,26 @@ protected Object openDialogBox(Control cellEditorWindow) {\n                             }\n                         }\n \n-                        // avoid fire UIManager#handleEvent execute afterOperationListener\n-                        // resize will fire focuseLost to applyEditorValue remove the columnViewEditorListener\n-                        extendedTableModel.removeAll(copyedAllList, true, false);\n+                        // avoid UIManager#handleEvent execute afterOperationListener\n+                        // resize fire focuseLost to applyEditorValue remove the columnViewEditorListener\n+                        // after extendedTableModel remove/add reset back the original customSized\n+                        boolean isCustom = DataMapTableView.this.customSized;\n+                        DataMapTableView.this.customSized = true;\n+\n+                        extendedTableModel.removeAll(copyedAllList);\n                         for (IMetadataColumn metaColumnToAdd : columns) {\n                             String label = metaColumnToAdd.getLabel();\n                             String expression = oldMappingMap.get(label);\n                             if (expression != null && !\"\".equals(expression)) {\n                                 metaColumnToAdd.setExpression(expression);\n                             }\n                         }\n-                        extendedTableModel.addAll(columns, true, false);\n+                        extendedTableModel.addAll(columns);\n                         mapperManager.getUiManager().parseAllExpressionsForAllTables();\n                         mapperManager.getUiManager().getOldMappingMap().clear();\n                         oldMappingMap.clear();\n+\n+                        DataMapTableView.this.customSized = isCustom;", "originalCommit": "77ac86fcc9bc4c835d3023a3d696bad881386dc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUwMTg3OA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4901#discussion_r451501878", "bodyText": "Modified, thanks", "author": "jding-tlnd", "createdAt": "2020-07-08T12:20:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ3OTM1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "afa155778dc1b49c71f733c51142c4fd02416ca1", "chunk": "diff --git a/main/plugins/org.talend.designer.mapper/src/main/java/org/talend/designer/mapper/ui/visualmap/table/DataMapTableView.java b/main/plugins/org.talend.designer.mapper/src/main/java/org/talend/designer/mapper/ui/visualmap/table/DataMapTableView.java\nindex f8aeba2ec3..d6888a1ca4 100644\n--- a/main/plugins/org.talend.designer.mapper/src/main/java/org/talend/designer/mapper/ui/visualmap/table/DataMapTableView.java\n+++ b/main/plugins/org.talend.designer.mapper/src/main/java/org/talend/designer/mapper/ui/visualmap/table/DataMapTableView.java\n\n@@ -3535,22 +3535,23 @@ public abstract class DataMapTableView extends Composite implements IDataMapTabl\n                         // resize fire focuseLost to applyEditorValue remove the columnViewEditorListener\n                         // after extendedTableModel remove/add reset back the original customSized\n                         boolean isCustom = DataMapTableView.this.customSized;\n-                        DataMapTableView.this.customSized = true;\n-\n-                        extendedTableModel.removeAll(copyedAllList);\n-                        for (IMetadataColumn metaColumnToAdd : columns) {\n-                            String label = metaColumnToAdd.getLabel();\n-                            String expression = oldMappingMap.get(label);\n-                            if (expression != null && !\"\".equals(expression)) {\n-                                metaColumnToAdd.setExpression(expression);\n+                        try {\n+                            DataMapTableView.this.customSized = true;\n+                            extendedTableModel.removeAll(copyedAllList);\n+                            for (IMetadataColumn metaColumnToAdd : columns) {\n+                                String label = metaColumnToAdd.getLabel();\n+                                String expression = oldMappingMap.get(label);\n+                                if (expression != null && !\"\".equals(expression)) {\n+                                    metaColumnToAdd.setExpression(expression);\n+                                }\n                             }\n+                            extendedTableModel.addAll(columns);\n+                            mapperManager.getUiManager().parseAllExpressionsForAllTables();\n+                            mapperManager.getUiManager().getOldMappingMap().clear();\n+                            oldMappingMap.clear();\n+                        } finally {\n+                            DataMapTableView.this.customSized = isCustom;\n                         }\n-                        extendedTableModel.addAll(columns);\n-                        mapperManager.getUiManager().parseAllExpressionsForAllTables();\n-                        mapperManager.getUiManager().getOldMappingMap().clear();\n-                        oldMappingMap.clear();\n-\n-                        DataMapTableView.this.customSized = isCustom;\n                         return value;\n                     }\n                 }\n"}}, {"oid": "afa155778dc1b49c71f733c51142c4fd02416ca1", "url": "https://github.com/Talend/tdi-studio-se/commit/afa155778dc1b49c71f733c51142c4fd02416ca1", "message": "fix(TUP-26347)Bug in tMap component using Talend Studio on Mac\nhttps://jira.talendforge.org/browse/TUP-26347", "committedDate": "2020-07-08T12:18:16Z", "type": "commit"}]}