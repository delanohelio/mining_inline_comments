{"pr_number": 1539, "pr_title": "[ls] copy build listener list before notification", "pr_createdAt": "2020-07-05T11:50:52Z", "pr_url": "https://github.com/eclipse/xtext-core/pull/1539", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5NzYwNA==", "url": "https://github.com/eclipse/xtext-core/pull/1539#discussion_r449997604", "bodyText": "should we use a safe datastructure as ListenerList or CopyOnWriteArraySet as we do it at other places? what do you think @szarnekow ?", "author": "cdietrich", "createdAt": "2020-07-06T05:55:41Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -258,7 +258,7 @@ protected void setWorkspaceConfig(IWorkspaceConfig workspaceConfig) {\n \t * Callback after a build was performend\n \t */\n \tprotected void afterBuild(List<IResourceDescription.Delta> deltas) {\n-\t\tfor (ILanguageServerAccess.IBuildListener listener : buildListeners) {\n+\t\tfor (ILanguageServerAccess.IBuildListener listener : new ArrayList<>(buildListeners)) {", "originalCommit": "bae250a7f054d676a72e446bf93654d4d20a99a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwNzc0Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1539#discussion_r450007742", "bodyText": "Yes, I think a CopyOnWriteArrayList (preserving semantics) or CopyOnWriteArraySet would be better to avoid unnecessary copying and also be save wrt adding listeners from read commands.", "author": "szarnekow", "createdAt": "2020-07-06T06:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5NzYwNA=="}], "type": "inlineReview", "revised_code": {"commit": "2e58fac1a6e2a32a51e22ca63d58b28b00e1fa3a", "chunk": "diff --git a/org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java b/org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java\nindex 295b0b1d4..cf12dea87 100644\n--- a/org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java\n+++ b/org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java\n\n@@ -258,7 +259,7 @@ public class WorkspaceManager {\n \t * Callback after a build was performend\n \t */\n \tprotected void afterBuild(List<IResourceDescription.Delta> deltas) {\n-\t\tfor (ILanguageServerAccess.IBuildListener listener : new ArrayList<>(buildListeners)) {\n+\t\tfor (ILanguageServerAccess.IBuildListener listener : buildListeners) {\n \t\t\tlistener.afterBuild(deltas);\n \t\t}\n \t}\n"}}, {"oid": "2e58fac1a6e2a32a51e22ca63d58b28b00e1fa3a", "url": "https://github.com/eclipse/xtext-core/commit/2e58fac1a6e2a32a51e22ca63d58b28b00e1fa3a", "message": "[ls] copy build listener list before notification\nFixes #1538", "committedDate": "2020-07-07T15:26:39Z", "type": "commit"}, {"oid": "2e58fac1a6e2a32a51e22ca63d58b28b00e1fa3a", "url": "https://github.com/eclipse/xtext-core/commit/2e58fac1a6e2a32a51e22ca63d58b28b00e1fa3a", "message": "[ls] copy build listener list before notification\nFixes #1538", "committedDate": "2020-07-07T15:26:39Z", "type": "forcePushed"}]}