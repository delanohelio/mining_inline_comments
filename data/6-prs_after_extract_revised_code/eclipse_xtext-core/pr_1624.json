{"pr_number": 1624, "pr_title": "[#1489] Several formatter fixes.", "pr_createdAt": "2020-11-20T15:52:19Z", "pr_url": "https://github.com/eclipse/xtext-core/pull/1624", "timeline": [{"oid": "294a43c4ff4cdaf51dfa888baacfe5286e84290d", "url": "https://github.com/eclipse/xtext-core/commit/294a43c4ff4cdaf51dfa888baacfe5286e84290d", "message": "[#1489] Several formatter fixes.\n\nAdded unit tests as well.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>", "committedDate": "2020-11-20T14:54:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg0ODczNQ==", "url": "https://github.com/eclipse/xtext-core/pull/1624#discussion_r527848735", "bodyText": "It would be really great to get rid of the newline in this example before the last rhs=AssignmentExpression<In, Yield>", "author": "szarnekow", "createdAt": "2020-11-20T17:27:34Z", "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/formatting2/internal/JavaFormatterGrammarTest.java", "diffHunk": "@@ -0,0 +1,200 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.com) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2.internal;\n+\n+import org.eclipse.xtext.XtextStandaloneSetup;\n+import org.eclipse.xtext.testing.IInjectorProvider;\n+import org.eclipse.xtext.testing.InjectWith;\n+import org.eclipse.xtext.testing.XtextRunner;\n+import org.eclipse.xtext.testing.formatter.FormatterTestHelper;\n+import org.eclipse.xtext.tests.AbstractXtextTests;\n+import org.eclipse.xtext.tests.XtextInjectorProvider;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import com.google.inject.Inject;\n+import com.google.inject.Injector;\n+\n+/**\n+ * @author Arne Deutsch - Initial contribution and API\n+ */\n+@RunWith(XtextRunner.class)\n+@InjectWith(XtextInjectorProvider.class)\n+public class JavaFormatterGrammarTest extends AbstractXtextTests {\n+\n+\tprivate static final String NL = System.lineSeparator();\n+\tprivate static final String TAB = \"\\t\";\n+\n+\t@Inject\n+\tprivate FormatterTestHelper formatterTestHelper;\n+\n+\t@Override\n+\tpublic void setUp() throws Exception {\n+\t\tsuper.setUp();\n+\t\twith(XtextStandaloneSetup.class);\n+\t}\n+\n+\t@Test\n+\tpublic void action() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"Rule:\" + NL +\n+\t\t\t\tTAB + \"SubRule ({ Other . source = current } op='.');\"\n+\t\t\t\t,\n+\t\t\t\t\"Rule:\" + NL +\n+\t\t\t\tTAB + \"SubRule ({Other.source=current} op='.');\"\n+\t\t);\n+\t\t// @formatter:on\n+\t}\n+\n+\t@Test\n+\tpublic void enumLiterals() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"enum StateType:\" + NL +\n+\t\t\t\tTAB + \"FIRST|SECOND|THIRD;\"\n+\t\t\t\t,\n+\t\t\t\t\"enum StateType:\" + NL +\n+\t\t\t\tTAB + \"FIRST | SECOND | THIRD;\"\n+\t\t\t\t);\n+\t\t// @formatter:on\n+\t}\n+\n+\t@Test\n+\tpublic void enumLiteralAssignment() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"enum StateType:\" + NL +\n+\t\t\t\tTAB + \"PSEUDO = 'cond';\"\n+\t\t\t\t,\n+\t\t\t\t\"enum StateType:\" + NL +\n+\t\t\t\tTAB + \"PSEUDO='cond';\"\n+\t\t\t\t);\n+\t\t// @formatter:on\n+\t}\n+\n+\t@Test\n+\tpublic void hiddenClause() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"Child  hidden ( WS ,  ID ):\" + NL +\n+\t\t\t\tTAB + \"A;\"\n+\t\t\t\t,\n+\t\t\t\t\"Child hidden(WS, ID):\" + NL +\n+\t\t\t\tTAB + \"A;\"\n+\t\t\t\t);\n+\t\t// @formatter:on\n+\t}\n+\n+\t@Test\n+\tpublic void tokenCardinality() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"Real hidden(): INT ? '.' (EXT_INT | INT);\"\n+\t\t\t\t,\n+\t\t\t\t\"Real hidden():\" + NL\n+\t\t\t\t+ TAB + \"INT? '.' (EXT_INT | INT);\"\n+\t\t\t\t);\n+\t\t// @formatter:on\n+\t}\n+\n+\t@Test\n+\tpublic void unorderedGroups() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"CopyFieldNameToVariableStmt:\" + NL +\n+\t\t\t\t\"  'FIELD-NAME-TO-VARIABLE' ((',' 'SCREEN' '=' '(' line=INT ',' column=INT ')') &\" + NL +\n+\t\t\t\tTAB + TAB + TAB + \"(','     'VAR' '=' name=ID) &\" + NL +\n+\t\t\t\tTAB + TAB + TAB + \"(',' 'TYPE' '='    'REPLACE')?);\"\n+\t\t\t\t,\n+\t\t\t\t\"CopyFieldNameToVariableStmt:\" + NL +\n+\t\t\t\tTAB + \"'FIELD-NAME-TO-VARIABLE' ((',' 'SCREEN' '=' '(' line=INT ',' column=INT ')') &\" + NL +\n+\t\t\t\tTAB + \"(',' 'VAR' '=' name=ID) &\" + NL +\n+\t\t\t\tTAB + \"(',' 'TYPE' '=' 'REPLACE')?);\"\n+\t\t\t\t);\n+\t\t// @formatter:on\n+\t}\n+\n+\t@Test\n+\tpublic void guardExpressions() {\n+\t\t// @formatter:off\n+\t\tassertFormattedGrammar(\n+\t\t\t\t\"AssignmentExpression <In, Yield> returns Expression:\" + NL +\n+\t\t\t\tTAB + \"<Yield> YieldExpression<In>\" + NL +\n+\t\t\t\tTAB + \"| RelationalExpression<In,Yield> (=> ({AssignmentExpression.lhs=current} op='=') rhs=AssignmentExpression<In,Yield>)?\" + NL +\n+\t\t\t\t\";\"\n+\t\t\t\t,\n+\t\t\t\t\"AssignmentExpression <In, Yield> returns Expression:\" + NL +\n+\t\t\t\tTAB + \"<Yield> YieldExpression<In>\" + NL +\n+\t\t\t\tTAB + \"| RelationalExpression<In, Yield> (=> ({AssignmentExpression.lhs=current} op='=')\" + NL +", "originalCommit": "294a43c4ff4cdaf51dfa888baacfe5286e84290d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}