{"pr_number": 1525, "pr_title": "[#1524] made InjectionExtension compatible with older junit5 versions again", "pr_createdAt": "2020-06-15T08:09:55Z", "pr_url": "https://github.com/eclipse/xtext-core/pull/1525", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyMTA0Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1525#discussion_r440021042", "bodyText": "Should we throw an ExtensionConfigurationException if the testInstance is an instance of a non-static inner class?", "author": "szarnekow", "createdAt": "2020-06-15T08:45:06Z", "path": "org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/extensions/InjectionExtension.java", "diffHunk": "@@ -59,10 +59,14 @@ public void beforeEach(ExtensionContext context) throws Exception {\n \t\t\tInjector injector = injectorProvider.getInjector();\n \t\t\tif (injector != null) {\n \t\t\t\tObject testInstance = context.getRequiredTestInstance();\n-\t\t\t\tTestInstances requiredTestInstances = context.getRequiredTestInstances();\n \t\t\t\tinjector.injectMembers(testInstance);\n-\t\t\t\tfor (Object o : requiredTestInstances.getEnclosingInstances()) {\n-\t\t\t\t\tinjector.injectMembers(o);\n+\t\t\t\ttry {\n+\t\t\t\t\tTestInstances requiredTestInstances = context.getRequiredTestInstances();\n+\t\t\t\t\tfor (Object o : requiredTestInstances.getEnclosingInstances()) {\n+\t\t\t\t\t\tinjector.injectMembers(o);\n+\t\t\t\t\t}\n+\t\t\t\t} catch (NoSuchMethodError e) {\n+\t\t\t\t\t// OK, getRequiredTestInstances is not there in Junit5 < 5.4", "originalCommit": "eda9a18a5602d8f341e620e28478a080ea825b5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyNDk1MQ==", "url": "https://github.com/eclipse/xtext-core/pull/1525#discussion_r440024951", "bodyText": "\u00e4hm. this is all about non static inner classes", "author": "cdietrich", "createdAt": "2020-06-15T08:51:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyMTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAzMDU4Mw==", "url": "https://github.com/eclipse/xtext-core/pull/1525#discussion_r440030583", "bodyText": "I mean from within the catch block.", "author": "szarnekow", "createdAt": "2020-06-15T09:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyMTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA2NDQ4OQ==", "url": "https://github.com/eclipse/xtext-core/pull/1525#discussion_r440064489", "bodyText": "updated the PR", "author": "cdietrich", "createdAt": "2020-06-15T09:58:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyMTA0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "2c3a69ea36eb9e6e6349b9e8ad150b7f875f1e6d", "chunk": "diff --git a/org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/extensions/InjectionExtension.java b/org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/extensions/InjectionExtension.java\nindex b23f20535..3391d84c7 100644\n--- a/org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/extensions/InjectionExtension.java\n+++ b/org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/extensions/InjectionExtension.java\n\n@@ -66,6 +68,11 @@ public class InjectionExtension implements BeforeEachCallback, AfterEachCallback\n \t\t\t\t\t\tinjector.injectMembers(o);\n \t\t\t\t\t}\n \t\t\t\t} catch (NoSuchMethodError e) {\n+\t\t\t\t\tif (!Modifier.isStatic(testInstance.getClass().getModifiers())) {\n+\t\t\t\t\t\tif (testInstance.getClass().getDeclaringClass() != null) {\n+\t\t\t\t\t\t\tthrow new ExtensionConfigurationException(\"Injection of nested classes need Junit5 >= 5.4\", e);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n \t\t\t\t\t// OK, getRequiredTestInstances is not there in Junit5 < 5.4\n \t\t\t\t}\n \t\t\t}\n"}}, {"oid": "2c3a69ea36eb9e6e6349b9e8ad150b7f875f1e6d", "url": "https://github.com/eclipse/xtext-core/commit/2c3a69ea36eb9e6e6349b9e8ad150b7f875f1e6d", "message": "[#1524] made InjectionExtension compatible with older junit5 versions again\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-06-15T09:58:10Z", "type": "forcePushed"}, {"oid": "12873c47fb5b616e65e69c408a69ebf89eea7047", "url": "https://github.com/eclipse/xtext-core/commit/12873c47fb5b616e65e69c408a69ebf89eea7047", "message": "[#1524] made InjectionExtension compatible with older junit5 versions again\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-06-15T09:59:04Z", "type": "commit"}, {"oid": "12873c47fb5b616e65e69c408a69ebf89eea7047", "url": "https://github.com/eclipse/xtext-core/commit/12873c47fb5b616e65e69c408a69ebf89eea7047", "message": "[#1524] made InjectionExtension compatible with older junit5 versions again\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-06-15T09:59:04Z", "type": "forcePushed"}]}