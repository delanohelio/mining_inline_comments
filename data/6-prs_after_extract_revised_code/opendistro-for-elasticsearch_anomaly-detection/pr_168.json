{"pr_number": 168, "pr_title": "Rollover AD result index less frequently", "pr_createdAt": "2020-06-20T00:18:41Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/168", "timeline": [{"oid": "142688cefc420180cca4137a7441f817cbbe1486", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/142688cefc420180cca4137a7441f817cbbe1486", "message": "Rollover AD result index less frequently\n\nCurrently, we roll over the result index every 30 days or every 300000 docs. Assuming each doc has 1 KB and our result index has five shards, each shard takes about 60 MB, which is too small. Small shards are against ES best practice. This PR increases the rollover threshold to 9000000 docs, which increases the max shard size to roughly 1.8 GB.\u00a0", "committedDate": "2020-06-20T00:11:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY5NzM3Ng==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/168#discussion_r443697376", "bodyText": "minor. comments are outdated.", "author": "wnbts", "createdAt": "2020-06-22T16:52:42Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java", "diffHunk": "@@ -88,7 +88,7 @@ private AnomalyDetectorSettings() {}\n             // Suppose generally per cluster has 200 detectors and all run with 1 minute interval.\n             // We will get 288,000 AD result docs. So set it as 300k to avoid multiple roll overs\n             // per day.", "originalCommit": "142688cefc420180cca4137a7441f817cbbe1486", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyNzc4NA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/168#discussion_r443727784", "bodyText": "updated", "author": "kaituo", "createdAt": "2020-06-22T17:49:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY5NzM3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ac3bc59701689e8dd1074d3ff130bfb7a94f90d2", "chunk": "diff --git a/src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java b/src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java\nindex c507214..708d804 100644\n--- a/src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java\n+++ b/src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java\n\n@@ -86,7 +86,7 @@ public final class AnomalyDetectorSettings {\n         .longSetting(\n             \"opendistro.anomaly_detection.ad_result_history_max_docs\",\n             // Suppose generally per cluster has 200 detectors and all run with 1 minute interval.\n-            // We will get 288,000 AD result docs. So set it as 300k to avoid multiple roll overs\n+            // We will get 288,000 AD result docs. So set it as 9000k to avoid multiple roll overs\n             // per day.\n             9_000_000L,\n             0L,\n"}}, {"oid": "ac3bc59701689e8dd1074d3ff130bfb7a94f90d2", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/ac3bc59701689e8dd1074d3ff130bfb7a94f90d2", "message": "Update comments", "committedDate": "2020-06-22T17:49:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc1ODE4NQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/168#discussion_r443758185", "bodyText": "Is this a problem for 200 detectors? From the comment 300k is taking care of  288k limit to avoid multiple roll overs right?", "author": "vamshin", "createdAt": "2020-06-22T18:48:04Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java", "diffHunk": "@@ -86,9 +86,9 @@ private AnomalyDetectorSettings() {}\n         .longSetting(\n             \"opendistro.anomaly_detection.ad_result_history_max_docs\",\n             // Suppose generally per cluster has 200 detectors and all run with 1 minute interval.\n-            // We will get 288,000 AD result docs. So set it as 300k to avoid multiple roll overs\n+            // We will get 288,000 AD result docs. So set it as 9000k to avoid multiple roll overs\n             // per day.\n-            300 * 1000L,\n+            9_000_000L,", "originalCommit": "ac3bc59701689e8dd1074d3ff130bfb7a94f90d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzYyOA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/168#discussion_r443777628", "bodyText": "it is not a problem for 200 detectors.  It is a problem of small shard.   Please see my PR descriptions.", "author": "kaituo", "createdAt": "2020-06-22T19:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc1ODE4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxMDkxMw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/168#discussion_r443810913", "bodyText": "Right i get that. Comment is misleading here. Why not mention the message in PR description as comment? We are talking about 200 detectors and roll overs in the comment. Atleast mention the PR?\nOne more thing you might want to confirm is does having larger index impact performance when compared to previous smaller index?", "author": "vamshin", "createdAt": "2020-06-22T20:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc1ODE4NQ=="}], "type": "inlineReview", "revised_code": null}]}