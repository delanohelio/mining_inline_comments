{"pr_number": 297, "pr_title": "Adding user support from ThreadContext", "pr_createdAt": "2020-10-28T03:51:07Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/297", "timeline": [{"oid": "29641d44acfc13642b87d7d6f2ea4c942483e798", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/29641d44acfc13642b87d7d6f2ea4c942483e798", "message": "Adding User support from threadcontext", "committedDate": "2020-10-28T03:36:20Z", "type": "commit"}, {"oid": "254f939982f7b0ceedbbe3b877368f7a73994a83", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/254f939982f7b0ceedbbe3b877368f7a73994a83", "message": "Stubbing out common code to utils", "committedDate": "2020-10-28T03:44:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNDA5Mw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/297#discussion_r513624093", "bodyText": "How about we add some debug log like the alerting PR https://github.com/opendistro-for-elasticsearch/alerting/pull/288/files#diff-a168ed1ef25a8c7d17602d9f10e5944d20280b0854364b4cf3498240921972cbR104?", "author": "ylwu-amzn", "createdAt": "2020-10-28T17:18:14Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/util/ParseUtils.java", "diffHunk": "@@ -434,4 +436,9 @@ public static SearchSourceBuilder addUserBackendRolesFilter(User user, SearchSou\n         }\n         return searchSourceBuilder;\n     }\n+\n+    public static User getUserContext(Client client) {\n+        String userStr = client.threadPool().getThreadContext().getTransient(ConfigConstants.OPENDISTRO_SECURITY_USER_AND_ROLES);\n+        return User.parse(userStr);", "originalCommit": "254f939982f7b0ceedbbe3b877368f7a73994a83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNTk3Nw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/297#discussion_r513625977", "bodyText": "Sure.", "author": "saratvemulapalli", "createdAt": "2020-10-28T17:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNDA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYzMzcyMA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/297#discussion_r513633720", "bodyText": "Thanks, approve it, merge when you finish.", "author": "ylwu-amzn", "createdAt": "2020-10-28T17:31:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNDA5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "c5f5fe9644af9d08482c919cfa9af8add54cabeb", "chunk": "diff --git a/src/main/java/com/amazon/opendistroforelasticsearch/ad/util/ParseUtils.java b/src/main/java/com/amazon/opendistroforelasticsearch/ad/util/ParseUtils.java\nindex f96bc23..356fc80 100644\n--- a/src/main/java/com/amazon/opendistroforelasticsearch/ad/util/ParseUtils.java\n+++ b/src/main/java/com/amazon/opendistroforelasticsearch/ad/util/ParseUtils.java\n\n@@ -439,6 +442,7 @@ public final class ParseUtils {\n \n     public static User getUserContext(Client client) {\n         String userStr = client.threadPool().getThreadContext().getTransient(ConfigConstants.OPENDISTRO_SECURITY_USER_AND_ROLES);\n+        logger.debug(\"Filtering result by \" + userStr);\n         return User.parse(userStr);\n     }\n }\n"}}, {"oid": "c5f5fe9644af9d08482c919cfa9af8add54cabeb", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/c5f5fe9644af9d08482c919cfa9af8add54cabeb", "message": "Adding debug log", "committedDate": "2020-10-28T17:34:40Z", "type": "commit"}]}