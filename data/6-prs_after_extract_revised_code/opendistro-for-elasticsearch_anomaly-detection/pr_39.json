{"pr_number": 39, "pr_title": "adjust preview configuration for more data", "pr_createdAt": "2020-01-30T19:50:24Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/39", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzczNjM0MQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/39#discussion_r373736341", "bodyText": "Suggestion,\nint numSamples = Math.max(1, (int) Math.min(numBuckets * previewSampleRate, maxPreviewSamples));\nto avoid numSamples being 0.", "author": "jngz-es", "createdAt": "2020-02-01T00:06:51Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java", "diffHunk": "@@ -317,7 +321,8 @@ public void getPreviewFeatures(AnomalyDetector detector, long startMilli, long e\n         long end = truncateToMinute(endMilli);\n         long bucketSize = ((IntervalTimeConfiguration) detector.getDetectionInterval()).toDuration().toMillis();\n         int numBuckets = (int) Math.floor((end - start) / (double) bucketSize);\n-        int stride = (int) Math.max(1, Math.floor((double) numBuckets / maxPreviewSamples));\n+        int numSamples = (int) Math.min(numBuckets * previewSampleRate, maxPreviewSamples);", "originalCommit": "fde85879545acf2ead4b4e04fc76b9fa827e30fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc0MjMyNA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/39#discussion_r373742324", "bodyText": "Changed. Thank you!", "author": "wnbts", "createdAt": "2020-02-01T00:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzczNjM0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "3540f72388780254c11817c0575506bfd191a1d9", "chunk": "diff --git a/src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java b/src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java\nindex 162d6f5..d622644 100644\n--- a/src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java\n+++ b/src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java\n\n@@ -321,7 +321,7 @@ public class FeatureManager {\n         long end = truncateToMinute(endMilli);\n         long bucketSize = ((IntervalTimeConfiguration) detector.getDetectionInterval()).toDuration().toMillis();\n         int numBuckets = (int) Math.floor((end - start) / (double) bucketSize);\n-        int numSamples = (int) Math.min(numBuckets * previewSampleRate, maxPreviewSamples);\n+        int numSamples = (int) Math.max(Math.min(numBuckets * previewSampleRate, maxPreviewSamples), 1);\n         int stride = (int) Math.max(1, Math.floor((double) numBuckets / numSamples));\n         int numStrides = (int) Math.ceil(numBuckets / (double) stride);\n         List<Entry<Long, Long>> sampleRanges = Stream\n"}}, {"oid": "3540f72388780254c11817c0575506bfd191a1d9", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/3540f72388780254c11817c0575506bfd191a1d9", "message": "adjust preview configuration for more data", "committedDate": "2020-02-01T00:45:01Z", "type": "commit"}]}