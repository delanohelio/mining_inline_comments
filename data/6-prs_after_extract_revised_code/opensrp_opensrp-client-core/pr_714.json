{"pr_number": 714, "pr_title": "Implement TaskDao#findTasksByJurisdiction", "pr_createdAt": "2020-12-04T13:32:06Z", "pr_url": "https://github.com/opensrp/opensrp-client-core/pull/714", "timeline": [{"oid": "31059ac198ebbbce7185e7f523de26e0f5ed5086", "url": "https://github.com/opensrp/opensrp-client-core/commit/31059ac198ebbbce7185e7f523de26e0f5ed5086", "message": "Implement TaskDao#findTasksByJurisdiction", "committedDate": "2020-12-04T13:31:14Z", "type": "commit"}, {"oid": "b6c7cddcab2976846b3611898b8073321e8482c4", "url": "https://github.com/opensrp/opensrp-client-core/commit/b6c7cddcab2976846b3611898b8073321e8482c4", "message": "Update snapshot version to 4.1.0", "committedDate": "2020-12-04T13:32:54Z", "type": "commit"}, {"oid": "1fd94798831d5b11ec40a611ecf7aa8429a0b039", "url": "https://github.com/opensrp/opensrp-client-core/commit/1fd94798831d5b11ec40a611ecf7aa8429a0b039", "message": "Add TaskDaoImpl#findTasksByJurisdiction test", "committedDate": "2020-12-07T10:40:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ2MjQ0OA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/714#discussion_r537462448", "bodyText": "use org.smartregister.repository.TaskRepository#getTasks(java.lang.String, java.lang.String[])", "author": "githengi", "createdAt": "2020-12-07T12:18:41Z", "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -674,4 +674,24 @@ public int getUnsyncedCreatedTasksAndTaskStatusCount() {\n \n         return unsyncedRecordsCount;\n     }\n+\n+    @NonNull\n+    public Set<Task> getTasksByJurisdiction(@NonNull String jurisdictionId) {\n+        String query = \"SELECT * FROM \" + TASK_TABLE + \" WHERE \" + GROUP_ID + \" = ?\";\n+        Cursor cursor = null;\n+        Set<Task> taskSet = new HashSet<>();\n+        try {\n+            cursor = getReadableDatabase().rawQuery(query, new Object[]{jurisdictionId});\n+            while (cursor.moveToNext()) {\n+                Task task = readCursor(cursor);\n+                taskSet.add(task);\n+            }\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        } finally {\n+            if (cursor != null)\n+                cursor.close();\n+        }", "originalCommit": "1fd94798831d5b11ec40a611ecf7aa8429a0b039", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d7fedbc710b6d125ad9c650baa48f8403697f77d", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java b/opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java\nindex a3e15757..12d76fa3 100644\n--- a/opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java\n+++ b/opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java\n\n@@ -678,20 +678,6 @@ public class TaskRepository extends BaseRepository {\n     @NonNull\n     public Set<Task> getTasksByJurisdiction(@NonNull String jurisdictionId) {\n         String query = \"SELECT * FROM \" + TASK_TABLE + \" WHERE \" + GROUP_ID + \" = ?\";\n-        Cursor cursor = null;\n-        Set<Task> taskSet = new HashSet<>();\n-        try {\n-            cursor = getReadableDatabase().rawQuery(query, new Object[]{jurisdictionId});\n-            while (cursor.moveToNext()) {\n-                Task task = readCursor(cursor);\n-                taskSet.add(task);\n-            }\n-        } catch (Exception e) {\n-            Timber.e(e);\n-        } finally {\n-            if (cursor != null)\n-                cursor.close();\n-        }\n-        return taskSet;\n+        return getTasks(query, new String[]{jurisdictionId});\n     }\n }\n"}}, {"oid": "d7fedbc710b6d125ad9c650baa48f8403697f77d", "url": "https://github.com/opensrp/opensrp-client-core/commit/d7fedbc710b6d125ad9c650baa48f8403697f77d", "message": "Re-use TaskRepository#getTasks", "committedDate": "2020-12-07T12:24:48Z", "type": "commit"}]}