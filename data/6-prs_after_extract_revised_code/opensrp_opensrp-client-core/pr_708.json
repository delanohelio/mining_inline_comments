{"pr_number": 708, "pr_title": "Custom firebase performance logging for entities during sync", "pr_createdAt": "2020-12-02T04:48:02Z", "pr_url": "https://github.com/opensrp/opensrp-client-core/pull/708", "timeline": [{"oid": "b44e1540cc1691d73159d84cef9091a05c7ccf68", "url": "https://github.com/opensrp/opensrp-client-core/commit/b44e1540cc1691d73159d84cef9091a05c7ccf68", "message": "Import firebase performance lib", "committedDate": "2020-05-04T12:23:13Z", "type": "commit"}, {"oid": "6ca2b6e2f9a21fa87e63172bfbdbe6898b245ae4", "url": "https://github.com/opensrp/opensrp-client-core/commit/6ca2b6e2f9a21fa87e63172bfbdbe6898b245ae4", "message": "Add custom logging", "committedDate": "2020-05-05T07:20:15Z", "type": "commit"}, {"oid": "d0ba5cac4ac93224cf9df97a073db07a51848046", "url": "https://github.com/opensrp/opensrp-client-core/commit/d0ba5cac4ac93224cf9df97a073db07a51848046", "message": "Add custom logging when fetchng and pushing data to/from the server", "committedDate": "2020-05-06T12:49:57Z", "type": "commit"}, {"oid": "2cb0e655aafe0c30fd4bc6a94d452ad839ac5ae8", "url": "https://github.com/opensrp/opensrp-client-core/commit/2cb0e655aafe0c30fd4bc6a94d452ad839ac5ae8", "message": "Merger master into sync-logging", "committedDate": "2020-06-18T12:53:20Z", "type": "commit"}, {"oid": "370f957f06249001a7658107be3c65f2dd6db47f", "url": "https://github.com/opensrp/opensrp-client-core/commit/370f957f06249001a7658107be3c65f2dd6db47f", "message": "Fix merge conflicts", "committedDate": "2020-06-18T13:01:29Z", "type": "commit"}, {"oid": "d03e9d8e95971458c6a639a7061fd120cfd8f773", "url": "https://github.com/opensrp/opensrp-client-core/commit/d03e9d8e95971458c6a639a7061fd120cfd8f773", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-core into sync-logging", "committedDate": "2020-06-21T11:13:25Z", "type": "commit"}, {"oid": "df6e5445ebd040158782b944615c05542ef9d3df", "url": "https://github.com/opensrp/opensrp-client-core/commit/df6e5445ebd040158782b944615c05542ef9d3df", "message": "Refactor sync trace logic for locations", "committedDate": "2020-06-22T08:25:00Z", "type": "commit"}, {"oid": "29824dcec361e09883375ab705dd6ab0a276045b", "url": "https://github.com/opensrp/opensrp-client-core/commit/29824dcec361e09883375ab705dd6ab0a276045b", "message": "Refactor task trace logic", "committedDate": "2020-06-22T10:23:27Z", "type": "commit"}, {"oid": "0d6dca7f6caed2cbd62ca626c7a50bd4788ab695", "url": "https://github.com/opensrp/opensrp-client-core/commit/0d6dca7f6caed2cbd62ca626c7a50bd4788ab695", "message": "Refactor trace logic for events", "committedDate": "2020-06-22T10:35:39Z", "type": "commit"}, {"oid": "524721e903c0b9f306bc5e069f40ad0ea731e8c2", "url": "https://github.com/opensrp/opensrp-client-core/commit/524721e903c0b9f306bc5e069f40ad0ea731e8c2", "message": "Refactor trace loggic for plans", "committedDate": "2020-06-22T10:52:12Z", "type": "commit"}, {"oid": "f71fbd1d5d96f016dd94a53898473c1f3578ee39", "url": "https://github.com/opensrp/opensrp-client-core/commit/f71fbd1d5d96f016dd94a53898473c1f3578ee39", "message": " Merge master into sync-logging", "committedDate": "2020-12-02T04:44:33Z", "type": "commit"}, {"oid": "93178f6761f8edf2e805bc53e0d639350c372df9", "url": "https://github.com/opensrp/opensrp-client-core/commit/93178f6761f8edf2e805bc53e0d639350c372df9", "message": "Merge branch 'master' into sync-logging", "committedDate": "2021-01-04T06:40:52Z", "type": "commit"}, {"oid": "c3383d10dadf332ffcc48459b2402348fa767d7e", "url": "https://github.com/opensrp/opensrp-client-core/commit/c3383d10dadf332ffcc48459b2402348fa767d7e", "message": "Merge branch 'master' into sync-logging", "committedDate": "2021-01-25T05:13:50Z", "type": "commit"}, {"oid": "75fe0cd493bcdfe5716c65158daecbacc1334c6f", "url": "https://github.com/opensrp/opensrp-client-core/commit/75fe0cd493bcdfe5716c65158daecbacc1334c6f", "message": "Add config for using firebase performance monitoring", "committedDate": "2021-01-25T11:44:29Z", "type": "commit"}, {"oid": "7d03efbf9b9cece9fae0ebdeb9c892e064f733aa", "url": "https://github.com/opensrp/opensrp-client-core/commit/7d03efbf9b9cece9fae0ebdeb9c892e064f733aa", "message": "Add performance monitoring utils", "committedDate": "2021-01-25T11:45:09Z", "type": "commit"}, {"oid": "063dac6418249a72a7e5dadaab66624fcdbb4028", "url": "https://github.com/opensrp/opensrp-client-core/commit/063dac6418249a72a7e5dadaab66624fcdbb4028", "message": "Refactor SyncIntentService to use utils", "committedDate": "2021-01-25T11:46:08Z", "type": "commit"}, {"oid": "488eee240135e7812673684a0d902f7cddd534ca", "url": "https://github.com/opensrp/opensrp-client-core/commit/488eee240135e7812673684a0d902f7cddd534ca", "message": "Refactor PlanIntentServiceHelper to use utils", "committedDate": "2021-01-25T12:06:22Z", "type": "commit"}, {"oid": "383ce2b8da7a9de191b31102778a6ebc3d4493ef", "url": "https://github.com/opensrp/opensrp-client-core/commit/383ce2b8da7a9de191b31102778a6ebc3d4493ef", "message": "Refactor TaskServiceHelper to use perf monitorig utils", "committedDate": "2021-01-25T12:11:38Z", "type": "commit"}, {"oid": "e8a1dfbb35df4281a752d747bc11a2c16969203f", "url": "https://github.com/opensrp/opensrp-client-core/commit/e8a1dfbb35df4281a752d747bc11a2c16969203f", "message": "Refactor LocationServiceHelper to use perf monitoring utils", "committedDate": "2021-01-25T12:18:51Z", "type": "commit"}, {"oid": "4a684e476306f2cd1654c5f1c5c60b917db36b50", "url": "https://github.com/opensrp/opensrp-client-core/commit/4a684e476306f2cd1654c5f1c5c60b917db36b50", "message": "Move initialization of traces to utils", "committedDate": "2021-01-25T13:13:02Z", "type": "commit"}, {"oid": "1c4507deb14c732843f7bd5cf6bc045c9886635a", "url": "https://github.com/opensrp/opensrp-client-core/commit/1c4507deb14c732843f7bd5cf6bc045c9886635a", "message": "Merge branch 'master' into sync-logging", "committedDate": "2021-01-28T09:27:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjY0MzE0MA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/708#discussion_r566643140", "bodyText": "Sync trace should be stopped here boolean isSaved = ecSyncUpdater.saveAllClientsAndEvents(jsonObject);\nWe  should add another trace on this line  processClient(serverVersionPair); This will allow to know how much client processing takes", "author": "githengi", "createdAt": "2021-01-29T08:08:38Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java", "diffHunk": "@@ -213,6 +236,8 @@ private void processFetchedEvents(Response resp, ECSyncHelper ecSyncUpdater, fin\n             }\n             sendSyncProgressBroadcast(eCount);\n             fetchRetry(0, false);\n+            addAttribute(eventSyncTrace, COUNT, String.valueOf(eCount));\n+            stopTrace(eventSyncTrace);", "originalCommit": "1c4507deb14c732843f7bd5cf6bc045c9886635a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88d6e883e8b390828a1c7f43d8a821228ab2bafe", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java\nindex 968de1b1..6576c55c 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java\n\n@@ -228,16 +231,22 @@ public class SyncIntentService extends BaseSyncIntentService {\n                 lastServerVersion = serverVersionPair.second;\n             }\n \n+            addAttribute(eventSyncTrace, COUNT, String.valueOf(eCount));\n+            stopTrace(eventSyncTrace);\n+\n             boolean isSaved = ecSyncUpdater.saveAllClientsAndEvents(jsonObject);\n             //update sync time if all event client is save.\n             if (isSaved) {\n+                startTrace(processClientTrace);\n                 processClient(serverVersionPair);\n+                addAttribute(processClientTrace, COUNT, String.valueOf(eCount));\n+                addAttribute(processClientTrace,  TEAM, team);\n+                stopTrace(processClientTrace);\n                 ecSyncUpdater.updateLastSyncTimeStamp(lastServerVersion);\n             }\n             sendSyncProgressBroadcast(eCount);\n             fetchRetry(0, false);\n-            addAttribute(eventSyncTrace, COUNT, String.valueOf(eCount));\n-            stopTrace(eventSyncTrace);\n+\n         }\n     }\n \n"}}, {"oid": "88d6e883e8b390828a1c7f43d8a821228ab2bafe", "url": "https://github.com/opensrp/opensrp-client-core/commit/88d6e883e8b390828a1c7f43d8a821228ab2bafe", "message": "Add custom trace for client processing", "committedDate": "2021-01-29T09:20:00Z", "type": "commit"}, {"oid": "848dbbe3352df22090865b1c3be61406800120f2", "url": "https://github.com/opensrp/opensrp-client-core/commit/848dbbe3352df22090865b1c3be61406800120f2", "message": "Update version", "committedDate": "2021-01-29T09:25:22Z", "type": "commit"}, {"oid": "820732029019ca23531c57725042bba5b8326c52", "url": "https://github.com/opensrp/opensrp-client-core/commit/820732029019ca23531c57725042bba5b8326c52", "message": "Increase maxHeapSize to 4g", "committedDate": "2021-01-29T10:13:25Z", "type": "commit"}, {"oid": "4b7c46c554b8bd5780374ecb4070e4c35c1b6302", "url": "https://github.com/opensrp/opensrp-client-core/commit/4b7c46c554b8bd5780374ecb4070e4c35c1b6302", "message": "Increase maxheapSize to 6g", "committedDate": "2021-01-29T11:01:19Z", "type": "commit"}, {"oid": "2a8ff1e6867c32b226b41129ecb56930fb5b38d8", "url": "https://github.com/opensrp/opensrp-client-core/commit/2a8ff1e6867c32b226b41129ecb56930fb5b38d8", "message": "Fix failing tests", "committedDate": "2021-01-29T13:14:43Z", "type": "commit"}, {"oid": "4f3485852f57ad4b4cbb5597bd62b452854ad309", "url": "https://github.com/opensrp/opensrp-client-core/commit/4f3485852f57ad4b4cbb5597bd62b452854ad309", "message": "Merge branch 'master' into sync-logging", "committedDate": "2021-02-02T11:44:47Z", "type": "commit"}, {"oid": "96cddf96dd64080cd5b45c8bd0e2d6d70f160f7e", "url": "https://github.com/opensrp/opensrp-client-core/commit/96cddf96dd64080cd5b45c8bd0e2d6d70f160f7e", "message": "Update version", "committedDate": "2021-02-02T11:51:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODU4Mzc0MA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/708#discussion_r568583740", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (StringUtils.isNotBlank(CoreLibrary.getInstance().context().configuration().appName()) && CoreLibrary.getInstance().context().configuration().appName().equals(APP_NAME_INDONESIA)) {\n          \n          \n            \n                    if (APP_NAME_INDONESIA.equals(CoreLibrary.getInstance().context().configuration().appName()) {", "author": "githengi", "createdAt": "2021-02-02T13:02:28Z", "path": "opensrp-app/src/main/java/org/smartregister/repository/FormDataRepository.java", "diffHunk": "@@ -64,7 +65,7 @@ public FormDataRepository() {\n                 .put(MotherRepository.MOTHER_TABLE_NAME, MotherRepository.MOTHER_TABLE_COLUMNS);\n         TABLE_COLUMN_MAP.put(ChildRepository.CHILD_TABLE_NAME, ChildRepository.CHILD_TABLE_COLUMNS);\n \n-        if (CoreLibrary.getInstance().context().configuration().appName().equals(APP_NAME_INDONESIA)) {\n+        if (StringUtils.isNotBlank(CoreLibrary.getInstance().context().configuration().appName()) && CoreLibrary.getInstance().context().configuration().appName().equals(APP_NAME_INDONESIA)) {", "originalCommit": "96cddf96dd64080cd5b45c8bd0e2d6d70f160f7e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fdc5e869ae16bf52db2adfe3c06d672baae104e4", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/repository/FormDataRepository.java b/opensrp-app/src/main/java/org/smartregister/repository/FormDataRepository.java\nindex 7a71ec83..bfdfff61 100755\n--- a/opensrp-app/src/main/java/org/smartregister/repository/FormDataRepository.java\n+++ b/opensrp-app/src/main/java/org/smartregister/repository/FormDataRepository.java\n\n@@ -65,7 +65,7 @@ public class FormDataRepository extends DrishtiRepository {\n                 .put(MotherRepository.MOTHER_TABLE_NAME, MotherRepository.MOTHER_TABLE_COLUMNS);\n         TABLE_COLUMN_MAP.put(ChildRepository.CHILD_TABLE_NAME, ChildRepository.CHILD_TABLE_COLUMNS);\n \n-        if (StringUtils.isNotBlank(CoreLibrary.getInstance().context().configuration().appName()) && CoreLibrary.getInstance().context().configuration().appName().equals(APP_NAME_INDONESIA)) {\n+        if (APP_NAME_INDONESIA.equals(CoreLibrary.getInstance().context().configuration().appName()) {\n             return;\n         }\n \n"}}, {"oid": "fdc5e869ae16bf52db2adfe3c06d672baae104e4", "url": "https://github.com/opensrp/opensrp-client-core/commit/fdc5e869ae16bf52db2adfe3c06d672baae104e4", "message": "Update opensrp-app/src/main/java/org/smartregister/repository/FormDataRepository.java\n\nCo-authored-by: Samuel Githengi <samuel.githengi@gmail.com>", "committedDate": "2021-02-02T15:18:03Z", "type": "commit"}, {"oid": "d9758f425b0344e87dea9364abc2a33e010d9177", "url": "https://github.com/opensrp/opensrp-client-core/commit/d9758f425b0344e87dea9364abc2a33e010d9177", "message": "Fix buidl error", "committedDate": "2021-02-02T16:02:07Z", "type": "commit"}, {"oid": "fdfce8af93897974e2bb38a75260044d01fb110f", "url": "https://github.com/opensrp/opensrp-client-core/commit/fdfce8af93897974e2bb38a75260044d01fb110f", "message": "Remove unused imports", "committedDate": "2021-02-03T06:38:29Z", "type": "commit"}]}