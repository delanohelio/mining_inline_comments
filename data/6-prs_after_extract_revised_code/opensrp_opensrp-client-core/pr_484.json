{"pr_number": 484, "pr_title": "Enable multiple logins across teams by resetting the app", "pr_createdAt": "2020-04-09T09:52:16Z", "pr_url": "https://github.com/opensrp/opensrp-client-core/pull/484", "timeline": [{"oid": "3533525f63e2289ef745d4e3a350ad5738b2e56e", "url": "https://github.com/opensrp/opensrp-client-core/commit/3533525f63e2289ef745d4e3a350ad5738b2e56e", "message": "Add ability to clear preferences, db & PrivateKeyEntries", "committedDate": "2020-04-09T09:51:10Z", "type": "commit"}, {"oid": "8b476cd1d48b340164b339c48ae342e087775c9a", "url": "https://github.com/opensrp/opensrp-client-core/commit/8b476cd1d48b340164b339c48ae342e087775c9a", "message": "Enable checking if there are any unsynced events\n\n- Provide boolean returns for delete operations\n- Deprecate the logout() method in the SecureFragment since it's unsecure and we are providing a better method\n- Add a method that returns the no of unsynced events\n- Change the ResetAppUtil class to take in the application for which to clear data", "committedDate": "2020-04-09T13:54:29Z", "type": "commit"}, {"oid": "a3975dba78dc447195c1b874721e48c930f2406c", "url": "https://github.com/opensrp/opensrp-client-core/commit/a3975dba78dc447195c1b874721e48c930f2406c", "message": "Enable broadcasting sync upload progress", "committedDate": "2020-04-09T14:24:05Z", "type": "commit"}, {"oid": "a3975dba78dc447195c1b874721e48c930f2406c", "url": "https://github.com/opensrp/opensrp-client-core/commit/a3975dba78dc447195c1b874721e48c930f2406c", "message": "Enable broadcasting sync upload progress", "committedDate": "2020-04-09T14:24:05Z", "type": "forcePushed"}, {"oid": "bae335fb479ba989fbc6181ce2f85e819cb4b8e0", "url": "https://github.com/opensrp/opensrp-client-core/commit/bae335fb479ba989fbc6181ce2f85e819cb4b8e0", "message": "Add configurable Pre-reset app checks & operations\n\n- Move default event-client sync check for PreResetAppCheck class configuration\n- Add CoreLibrary executors to handle default behaviour running on threads\n- Add FetchStatus.fetchProgress enum\n- Add logic to start reset-app process from a UI call\n- Extend SyncService to be used for same-thread operations without pull from the server\n- Add Contract to be used by the reset-app feature UI that handles progress, confirmation", "committedDate": "2020-04-09T15:23:46Z", "type": "commit"}, {"oid": "46e9e8a99f2f7351c2e902f12809f3ed5d98ad34", "url": "https://github.com/opensrp/opensrp-client-core/commit/46e9e8a99f2f7351c2e902f12809f3ed5d98ad34", "message": "Clear p2p tracking db during reset", "committedDate": "2020-04-14T15:02:58Z", "type": "commit"}, {"oid": "495f1ef0d74439bde84dc723101abf60a2849c1e", "url": "https://github.com/opensrp/opensrp-client-core/commit/495f1ef0d74439bde84dc723101abf60a2849c1e", "message": "Add tests for ResetAppUtil", "committedDate": "2020-04-14T16:26:39Z", "type": "commit"}, {"oid": "495f1ef0d74439bde84dc723101abf60a2849c1e", "url": "https://github.com/opensrp/opensrp-client-core/commit/495f1ef0d74439bde84dc723101abf60a2849c1e", "message": "Add tests for ResetAppUtil", "committedDate": "2020-04-14T16:26:39Z", "type": "forcePushed"}, {"oid": "a274ca97ad6d45231b56924b1e5b226877896da6", "url": "https://github.com/opensrp/opensrp-client-core/commit/a274ca97ad6d45231b56924b1e5b226877896da6", "message": "Fix event-client sync not working before reset-app\n\n- Move to login page once done logging out completely\n- Cancel all jobs when resetting the app\n- Fix event-client synced records check query", "committedDate": "2020-04-16T08:23:13Z", "type": "commit"}, {"oid": "3eb96eedcdd83199e0c5fbb4d09959d64eabba2e", "url": "https://github.com/opensrp/opensrp-client-core/commit/3eb96eedcdd83199e0c5fbb4d09959d64eabba2e", "message": "Delete p2p wal & shm file after deleting database", "committedDate": "2020-04-16T11:59:52Z", "type": "commit"}, {"oid": "3c8c0f5eb7dd44f1bd5383632cd7a87ab89c061f", "url": "https://github.com/opensrp/opensrp-client-core/commit/3c8c0f5eb7dd44f1bd5383632cd7a87ab89c061f", "message": "Fix event-client sync starting but crashes from NPE", "committedDate": "2020-04-16T14:52:34Z", "type": "commit"}, {"oid": "a268b4cb4d36d75f8405b91d545f858030a1bd04", "url": "https://github.com/opensrp/opensrp-client-core/commit/a268b4cb4d36d75f8405b91d545f858030a1bd04", "message": "Add Reset app progress dialog\n\n- Enable clicking on cancel to cancel the quit process", "committedDate": "2020-04-16T14:55:22Z", "type": "commit"}, {"oid": "452b9b8ebea9397f40c8be46cca42a40f03c7a9d", "url": "https://github.com/opensrp/opensrp-client-core/commit/452b9b8ebea9397f40c8be46cca42a40f03c7a9d", "message": "Dismiss progress dialog when reset-app process is cancelled", "committedDate": "2020-04-16T14:58:39Z", "type": "commit"}, {"oid": "b62c82d20a7a5d66b6f6634b8f0055569458b79f", "url": "https://github.com/opensrp/opensrp-client-core/commit/b62c82d20a7a5d66b6f6634b8f0055569458b79f", "message": "Add check for unsynced structures\n\n- Rename the PreResetSync to EventClientSync\n- Unsubscribe from broadcast receiver after the event-client sync is complete\n- Add repository method to count created structures not synced\n- Enable syncing of structures in case they have not all been synced to the server", "committedDate": "2020-04-16T15:37:55Z", "type": "commit"}, {"oid": "40db98ac1c12a265d3b5029e4f625f70ca0059d4", "url": "https://github.com/opensrp/opensrp-client-core/commit/40db98ac1c12a265d3b5029e4f625f70ca0059d4", "message": "Add inherited WorkerThread annotations & cleanup", "committedDate": "2020-04-16T15:41:26Z", "type": "commit"}, {"oid": "5af3f1e8fae4715a3050e0a956d1bbee376fe663", "url": "https://github.com/opensrp/opensrp-client-core/commit/5af3f1e8fae4715a3050e0a956d1bbee376fe663", "message": "Add check for unsynced tasks\n\n- Add repository method to check for unsynced tasks\n- Add task sync to default pre-reset app checks", "committedDate": "2020-04-16T15:59:04Z", "type": "commit"}, {"oid": "616aea9a5701cd517dc2ba7c636c1ff1f0a7098c", "url": "https://github.com/opensrp/opensrp-client-core/commit/616aea9a5701cd517dc2ba7c636c1ff1f0a7098c", "message": "Extend created tasks check to check for unsynced task statuses", "committedDate": "2020-04-16T16:05:05Z", "type": "commit"}, {"oid": "57aa13b6da8d1436877f356134287de290604b9c", "url": "https://github.com/opensrp/opensrp-client-core/commit/57aa13b6da8d1436877f356134287de290604b9c", "message": "Add check for unsynced settings", "committedDate": "2020-04-17T06:55:26Z", "type": "commit"}, {"oid": "ba9b1d8c8ef4bdf66776b7977dc190daada90206", "url": "https://github.com/opensrp/opensrp-client-core/commit/ba9b1d8c8ef4bdf66776b7977dc190daada90206", "message": "Remove activity test", "committedDate": "2020-04-17T13:38:10Z", "type": "commit"}, {"oid": "05dd6ea1fd8c9b6e015f2ddbc10d6adbcd00f268", "url": "https://github.com/opensrp/opensrp-client-core/commit/05dd6ea1fd8c9b6e015f2ddbc10d6adbcd00f268", "message": "Merge branch 'master' into issue/483-enable-multiple-logins", "committedDate": "2020-04-21T14:36:27Z", "type": "commit"}, {"oid": "74dc59c2ede4d238748b094cdcc82e29cc9d04a7", "url": "https://github.com/opensrp/opensrp-client-core/commit/74dc59c2ede4d238748b094cdcc82e29cc9d04a7", "message": "Enable killing of services while syncing\n\n- Code cleanup\n- Remove imports\n- Move strings to strings.xml", "committedDate": "2020-04-21T15:31:51Z", "type": "commit"}, {"oid": "5e4c36408c79f6e5ad064c781297ba0f1ba444be", "url": "https://github.com/opensrp/opensrp-client-core/commit/5e4c36408c79f6e5ad064c781297ba0f1ba444be", "message": "Refactor file locations for multi-tenant features\n\n1. Add tests for the reset-app feature\n2. Code cleanup", "committedDate": "2020-04-22T10:01:48Z", "type": "commit"}, {"oid": "884ad629f491e256b71c48f9186f77838494a094", "url": "https://github.com/opensrp/opensrp-client-core/commit/884ad629f491e256b71c48f9186f77838494a094", "message": "Merge branch 'master' into issue/483-enable-multiple-logins", "committedDate": "2020-04-22T10:36:37Z", "type": "commit"}, {"oid": "0a7a3dd7c872902a7ae11ba3dc118b3105310de3", "url": "https://github.com/opensrp/opensrp-client-core/commit/0a7a3dd7c872902a7ae11ba3dc118b3105310de3", "message": "Log the user deletion in crashlytics\n\n- This will be updated later with a better strategy using Firebase Analytics Events OR what-was Fabric Answers\n- Updated version to 1.10.3-SNAPSHOT", "committedDate": "2020-04-22T12:19:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3OTQ3OA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r415679478", "bodyText": "There is already existing class org.smartregister.util.AppExecutors", "author": "githengi", "createdAt": "2020-04-27T10:02:31Z", "path": "opensrp-app/src/main/java/org/smartregister/executor/CoreLibraryExecutors.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package org.smartregister.executor;\n+\n+import android.os.Handler;\n+import android.os.Looper;\n+import android.support.annotation.NonNull;\n+\n+import java.util.concurrent.Executor;\n+import java.util.concurrent.Executors;\n+\n+/**\n+ * <p>\n+ * Global executor pools for plug-and-play CoreLibrary operations.\n+ * <p>\n+ * Grouping tasks like this avoids the effects of task starvation (e.g. disk reads don't wait behind\n+ * webservice requests).\n+ *\n+ * Created by Ephraim Kigamba - nek.eam@gmail.com on 09-04-2020.\n+ */\n+public class CoreLibraryExecutors {", "originalCommit": "0a7a3dd7c872902a7ae11ba3dc118b3105310de3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NjYxOQ==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r416576619", "bodyText": "Fixed", "author": "ekigamba", "createdAt": "2020-04-28T12:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3OTQ3OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MTQyNg==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r415681426", "bodyText": "Maybe this should be warning, if the intention is to send to crashlytics", "author": "githengi", "createdAt": "2020-04-27T10:05:27Z", "path": "opensrp-app/src/main/java/org/smartregister/multitenant/ResetAppHelper.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.smartregister.multitenant;\n+\n+import android.content.SharedPreferences;\n+import android.support.annotation.AnyThread;\n+import android.support.annotation.NonNull;\n+import android.support.annotation.Nullable;\n+import android.support.v7.app.AppCompatActivity;\n+import android.widget.Toast;\n+\n+import com.evernote.android.job.JobManager;\n+\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.P2POptions;\n+import org.smartregister.R;\n+import org.smartregister.exception.AppResetException;\n+import org.smartregister.multitenant.check.EventClientSyncedCheck;\n+import org.smartregister.multitenant.check.PreResetAppCheck;\n+import org.smartregister.multitenant.check.SettingsSyncedCheck;\n+import org.smartregister.multitenant.check.StructureSyncedCheck;\n+import org.smartregister.multitenant.check.TaskSyncedCheck;\n+import org.smartregister.exception.PreResetAppOperationException;\n+import org.smartregister.executor.CoreLibraryExecutors;\n+import org.smartregister.view.dialog.ResetAppDialog;\n+import org.smartregister.p2p.P2PLibrary;\n+import org.smartregister.p2p.model.AppDatabase;\n+import org.smartregister.util.NetworkUtils;\n+import org.smartregister.util.Utils;\n+import org.smartregister.view.activity.DrishtiApplication;\n+\n+import java.security.KeyStore;\n+import java.security.KeyStoreException;\n+import java.util.ArrayList;\n+import java.util.Enumeration;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by Ephraim Kigamba - nek.eam@gmail.com on 09-04-2020.\n+ */\n+public class ResetAppHelper {\n+\n+    private DrishtiApplication application;\n+    private CoreLibraryExecutors coreLibraryExecutors;\n+    private ArrayList<PreResetAppCheck> preResetAppChecks = new ArrayList<>();\n+    private ResetAppDialog resetAppDialog;\n+    private boolean resetCancelled = false;\n+\n+    public ResetAppHelper(@NonNull DrishtiApplication drishtiApplication) {\n+        this.application = drishtiApplication;\n+        coreLibraryExecutors = new CoreLibraryExecutors();\n+        preResetAppChecks.add(new EventClientSyncedCheck());\n+        preResetAppChecks.add(new SettingsSyncedCheck());\n+        preResetAppChecks.add(new StructureSyncedCheck());\n+        preResetAppChecks.add(new TaskSyncedCheck());\n+    }\n+\n+    public void startResetProcess(@NonNull AppCompatActivity activity) {\n+        resetCancelled = false;\n+        // Show some UI here to display the reset progress\n+        resetAppDialog = ResetAppDialog.newInstance();\n+        resetAppDialog.show(activity.getSupportFragmentManager(), \"rest-app-dialog\");\n+        resetAppDialog.setOnCancelListener((dialogInterface) -> {\n+            showProgressText(activity.getString(R.string.cancelling));\n+            resetCancelled = true;\n+        });\n+\n+        resetAppDialog.showText(activity.getString(R.string.stopping_services));\n+        JobManager.create(application).cancelAll();\n+\n+        resetAppDialog.showText(activity.getString(R.string.performing_data_checks));\n+\n+        if (!resetCancelled) {\n+            performPreResetChecks();\n+        }\n+    }\n+\n+    public void performPreResetChecks() {\n+        // Should be handled in the background\n+        coreLibraryExecutors.diskIO()\n+                .execute(() -> {\n+                    try {\n+                        for (PreResetAppCheck preResetAppCheck : preResetAppChecks) {\n+                            if (!preResetAppCheck.isCheckOk(application)) {\n+                                if (resetCancelled) {\n+                                    dismissDialog();\n+                                    return;\n+                                }\n+\n+                                if (!NetworkUtils.isNetworkAvailable()) {\n+                                    dismissDialog();\n+                                    coreLibraryExecutors.mainThread().execute(new Runnable() {\n+                                        @Override\n+                                        public void run() {\n+                                            Toast.makeText(application, \"No Internet Connection Available\", Toast.LENGTH_LONG)\n+                                                    .show();\n+                                        }\n+                                    });\n+\n+                                    resetCancelled = true;\n+                                    return;\n+                                }\n+\n+                                performPreResetOperations(preResetAppCheck);\n+                            }\n+                        }\n+\n+                        if (resetCancelled) {\n+                            dismissDialog();\n+                            return;\n+                        }\n+\n+                        showProgressText(application.getString(R.string.clearing_application_data));\n+\n+                        if (resetCancelled) {\n+                            dismissDialog();\n+                            return;\n+                        }\n+\n+                        Timber.e(\"User %s has completely reset the app\", application.getUsername());", "originalCommit": "0a7a3dd7c872902a7ae11ba3dc118b3105310de3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM4MTIzOA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r416381238", "bodyText": "I'll change that", "author": "ekigamba", "createdAt": "2020-04-28T07:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MTQyNg=="}], "type": "inlineReview", "revised_code": {"commit": "3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/multitenant/ResetAppHelper.java b/opensrp-app/src/main/java/org/smartregister/multitenant/ResetAppHelper.java\nindex 63afe72d..99e18daa 100644\n--- a/opensrp-app/src/main/java/org/smartregister/multitenant/ResetAppHelper.java\n+++ b/opensrp-app/src/main/java/org/smartregister/multitenant/ResetAppHelper.java\n\n@@ -20,6 +20,7 @@ import org.smartregister.multitenant.check.StructureSyncedCheck;\n import org.smartregister.multitenant.check.TaskSyncedCheck;\n import org.smartregister.exception.PreResetAppOperationException;\n import org.smartregister.executor.CoreLibraryExecutors;\n+import org.smartregister.util.AppExecutors;\n import org.smartregister.view.dialog.ResetAppDialog;\n import org.smartregister.p2p.P2PLibrary;\n import org.smartregister.p2p.model.AppDatabase;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgzNDU4MQ==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r415834581", "bodyText": "Maybe this can be a function for deleting journal, shm and wal", "author": "githengi", "createdAt": "2020-04-27T13:56:34Z", "path": "opensrp-app/src/main/java/org/smartregister/util/Utils.java", "diffHunk": "@@ -793,4 +793,56 @@ public static void copyDatabase(String dbName, String copyDbName, Context contex\n     public static Locale getDefaultLocale() {\n         return Locale.getDefault().toString().startsWith(\"ar\") ? Locale.ENGLISH : Locale.getDefault();\n     }\n+\n+    public static boolean deleteRoomDb(@NonNull Context context, @NonNull String databaseName) {\n+        File databases = new File(context.getApplicationInfo().dataDir + \"/databases\");\n+        File db = new File(databases, databaseName);\n+        if (!db.exists()) {\n+            Timber.i(\"Room database %s does not exist\", databaseName);\n+            return false;\n+        }\n+\n+        if (db.delete()) {\n+            Timber.i(\"Room database %s deleted\", databaseName);\n+        } else {\n+            Timber.i(\"Failed to delete database %s\", databaseName);\n+            return false;\n+        }\n+\n+        // Delete the journal file\n+        File journal = new File(databases, databaseName + \"-journal\");\n+        if (journal.exists()) {\n+            if (journal.delete()) {\n+                Timber.i(\"Database %s journal deleted\", databaseName);\n+            } else {\n+                Timber.e(\"Failed to delete database %s journal\", databaseName);\n+                return false;\n+            }\n+        }\n+\n+        // Delete the journal shm file\n+        File shmFile = new File(databases, databaseName + \"-shm\");\n+        if (shmFile.exists()) {\n+            if (shmFile.delete()) {\n+                Timber.i(\"Database %s-shm deleted\", databaseName);\n+            } else {\n+                Timber.e(\"Failed to delete database %s-shm\", databaseName);\n+                return false;\n+            }\n+        }", "originalCommit": "0a7a3dd7c872902a7ae11ba3dc118b3105310de3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NjUyNA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r416576524", "bodyText": "Fixed", "author": "ekigamba", "createdAt": "2020-04-28T12:36:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgzNDU4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/util/Utils.java b/opensrp-app/src/main/java/org/smartregister/util/Utils.java\nindex 6cd843e2..6751670c 100644\n--- a/opensrp-app/src/main/java/org/smartregister/util/Utils.java\n+++ b/opensrp-app/src/main/java/org/smartregister/util/Utils.java\n\n@@ -795,8 +794,9 @@ public class Utils {\n     }\n \n     public static boolean deleteRoomDb(@NonNull Context context, @NonNull String databaseName) {\n-        File databases = new File(context.getApplicationInfo().dataDir + \"/databases\");\n-        File db = new File(databases, databaseName);\n+        boolean operationSuccessful;\n+        File databasesFolder = new File(context.getApplicationInfo().dataDir + \"/databases\");\n+        File db = new File(databasesFolder, databaseName);\n         if (!db.exists()) {\n             Timber.i(\"Room database %s does not exist\", databaseName);\n             return false;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgzNTQyNA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r415835424", "bodyText": "This would leave the shm and wal which can lead to inconsistencies", "author": "githengi", "createdAt": "2020-04-27T13:57:43Z", "path": "opensrp-app/src/main/java/org/smartregister/util/Utils.java", "diffHunk": "@@ -793,4 +793,56 @@ public static void copyDatabase(String dbName, String copyDbName, Context contex\n     public static Locale getDefaultLocale() {\n         return Locale.getDefault().toString().startsWith(\"ar\") ? Locale.ENGLISH : Locale.getDefault();\n     }\n+\n+    public static boolean deleteRoomDb(@NonNull Context context, @NonNull String databaseName) {\n+        File databases = new File(context.getApplicationInfo().dataDir + \"/databases\");\n+        File db = new File(databases, databaseName);\n+        if (!db.exists()) {\n+            Timber.i(\"Room database %s does not exist\", databaseName);\n+            return false;\n+        }\n+\n+        if (db.delete()) {\n+            Timber.i(\"Room database %s deleted\", databaseName);\n+        } else {\n+            Timber.i(\"Failed to delete database %s\", databaseName);\n+            return false;\n+        }\n+\n+        // Delete the journal file\n+        File journal = new File(databases, databaseName + \"-journal\");\n+        if (journal.exists()) {\n+            if (journal.delete()) {\n+                Timber.i(\"Database %s journal deleted\", databaseName);\n+            } else {\n+                Timber.e(\"Failed to delete database %s journal\", databaseName);\n+                return false;", "originalCommit": "0a7a3dd7c872902a7ae11ba3dc118b3105310de3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM3ODI2Nw==", "url": "https://github.com/opensrp/opensrp-client-core/pull/484#discussion_r416378267", "bodyText": "I will change this to perform the other operations but return the correct status", "author": "ekigamba", "createdAt": "2020-04-28T07:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgzNTQyNA=="}], "type": "inlineReview", "revised_code": {"commit": "3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/util/Utils.java b/opensrp-app/src/main/java/org/smartregister/util/Utils.java\nindex 6cd843e2..6751670c 100644\n--- a/opensrp-app/src/main/java/org/smartregister/util/Utils.java\n+++ b/opensrp-app/src/main/java/org/smartregister/util/Utils.java\n\n@@ -795,8 +794,9 @@ public class Utils {\n     }\n \n     public static boolean deleteRoomDb(@NonNull Context context, @NonNull String databaseName) {\n-        File databases = new File(context.getApplicationInfo().dataDir + \"/databases\");\n-        File db = new File(databases, databaseName);\n+        boolean operationSuccessful;\n+        File databasesFolder = new File(context.getApplicationInfo().dataDir + \"/databases\");\n+        File db = new File(databasesFolder, databaseName);\n         if (!db.exists()) {\n             Timber.i(\"Room database %s does not exist\", databaseName);\n             return false;\n"}}, {"oid": "3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "url": "https://github.com/opensrp/opensrp-client-core/commit/3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "message": "Refactor code as-per code review\n\n- Move functionality to delete db journal, wal & shm file to methods\n- Use AppExecutor functionality\n- Delete other DB files irrespective of the previous db file result", "committedDate": "2020-04-28T12:40:15Z", "type": "commit"}, {"oid": "563fe01bb3c66a433cca4b9f2df07c0a6448fa30", "url": "https://github.com/opensrp/opensrp-client-core/commit/563fe01bb3c66a433cca4b9f2df07c0a6448fa30", "message": "Refactor code as-per code review\n\n- Move functionality to delete db journal, wal & shm file to methods\n- Use AppExecutor functionality\n- Delete other DB files irrespective of the previous db file result", "committedDate": "2020-04-28T12:43:00Z", "type": "forcePushed"}, {"oid": "3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "url": "https://github.com/opensrp/opensrp-client-core/commit/3d128c19b28b6693bf310ebe1dc1a1f89232ba91", "message": "Refactor code as-per code review\n\n- Move functionality to delete db journal, wal & shm file to methods\n- Use AppExecutor functionality\n- Delete other DB files irrespective of the previous db file result", "committedDate": "2020-04-28T12:40:15Z", "type": "forcePushed"}, {"oid": "1525f322d14a5e9f702fd993e4e19a548a095919", "url": "https://github.com/opensrp/opensrp-client-core/commit/1525f322d14a5e9f702fd993e4e19a548a095919", "message": "Code cleanup", "committedDate": "2020-04-28T12:57:32Z", "type": "commit"}, {"oid": "8b23717f4d87cdd8991d9e971a3f327bbce078c5", "url": "https://github.com/opensrp/opensrp-client-core/commit/8b23717f4d87cdd8991d9e971a3f327bbce078c5", "message": "Plugin clear-app data to current logout functionality\n\n- This functionality will be enabled when the SyncConfiguration#shouldClearDataOnLogout() returns true", "committedDate": "2020-04-28T14:31:35Z", "type": "commit"}, {"oid": "8b23717f4d87cdd8991d9e971a3f327bbce078c5", "url": "https://github.com/opensrp/opensrp-client-core/commit/8b23717f4d87cdd8991d9e971a3f327bbce078c5", "message": "Plugin clear-app data to current logout functionality\n\n- This functionality will be enabled when the SyncConfiguration#shouldClearDataOnLogout() returns true", "committedDate": "2020-04-28T14:31:35Z", "type": "forcePushed"}, {"oid": "b2b93483258bf172efa4ee6560ba4cd3b47911fb", "url": "https://github.com/opensrp/opensrp-client-core/commit/b2b93483258bf172efa4ee6560ba4cd3b47911fb", "message": "Fix failing tests", "committedDate": "2020-04-28T15:04:09Z", "type": "commit"}, {"oid": "b2b93483258bf172efa4ee6560ba4cd3b47911fb", "url": "https://github.com/opensrp/opensrp-client-core/commit/b2b93483258bf172efa4ee6560ba4cd3b47911fb", "message": "Fix failing tests", "committedDate": "2020-04-28T15:04:09Z", "type": "forcePushed"}, {"oid": "f77497209e137723e53a9770791ee02b83740cef", "url": "https://github.com/opensrp/opensrp-client-core/commit/f77497209e137723e53a9770791ee02b83740cef", "message": "Merge branch 'master' into issue/483-enable-multiple-logins", "committedDate": "2020-04-28T15:50:34Z", "type": "commit"}, {"oid": "7ea1237a6906a69d4560424458a6b82af10d53b4", "url": "https://github.com/opensrp/opensrp-client-core/commit/7ea1237a6906a69d4560424458a6b82af10d53b4", "message": "Move clear data feature to login with different team/location\n\n- If the user is not within the same group ID & the reset-app data configuration is true, the app will show a dialog asking the user if the are sure they want to clear data. It will then perform the process and try to relogin with the same username/password", "committedDate": "2020-04-29T09:01:47Z", "type": "commit"}, {"oid": "17db37f6efe18359e0c2e0fa372a7e4bda5da861", "url": "https://github.com/opensrp/opensrp-client-core/commit/17db37f6efe18359e0c2e0fa372a7e4bda5da861", "message": "Remove sdk min & target in core-library AndroidManifest.xml", "committedDate": "2020-04-29T09:01:47Z", "type": "commit"}, {"oid": "9d922fde500158e9512623a8775b736791b8def0", "url": "https://github.com/opensrp/opensrp-client-core/commit/9d922fde500158e9512623a8775b736791b8def0", "message": "Update ResetAppHelper tests", "committedDate": "2020-04-29T09:01:47Z", "type": "commit"}, {"oid": "d92a5a49322efde2f7d5cd016f203ab46e3eea2d", "url": "https://github.com/opensrp/opensrp-client-core/commit/d92a5a49322efde2f7d5cd016f203ab46e3eea2d", "message": "Move clear data dialog strings to strings.xml", "committedDate": "2020-04-29T09:06:13Z", "type": "commit"}, {"oid": "feb2dbcdc6dc20cdd5b3d5db9358193d87242dfc", "url": "https://github.com/opensrp/opensrp-client-core/commit/feb2dbcdc6dc20cdd5b3d5db9358193d87242dfc", "message": "Change user message during logout", "committedDate": "2020-04-29T11:31:32Z", "type": "commit"}, {"oid": "feb2dbcdc6dc20cdd5b3d5db9358193d87242dfc", "url": "https://github.com/opensrp/opensrp-client-core/commit/feb2dbcdc6dc20cdd5b3d5db9358193d87242dfc", "message": "Change user message during logout", "committedDate": "2020-04-29T11:31:32Z", "type": "forcePushed"}, {"oid": "e21b69d9f48b20ebaf2cb2820f4e4ab3cf7677d7", "url": "https://github.com/opensrp/opensrp-client-core/commit/e21b69d9f48b20ebaf2cb2820f4e4ab3cf7677d7", "message": "Retrigger codacy", "committedDate": "2020-04-29T12:32:45Z", "type": "commit"}]}