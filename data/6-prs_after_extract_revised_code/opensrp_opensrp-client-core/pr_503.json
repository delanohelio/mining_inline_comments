{"pr_number": 503, "pr_title": "Add FormSubmissionService tests", "pr_createdAt": "2020-04-28T07:59:21Z", "pr_url": "https://github.com/opensrp/opensrp-client-core/pull/503", "timeline": [{"oid": "211188003d6d1795fb76c0f13154ab7b7b127476", "url": "https://github.com/opensrp/opensrp-client-core/commit/211188003d6d1795fb76c0f13154ab7b7b127476", "message": "Added new FormSubmissionService tests", "committedDate": "2020-04-28T07:57:38Z", "type": "commit"}, {"oid": "645ea07ddcd1be53b9ce0c87aeba8a01d45f9f44", "url": "https://github.com/opensrp/opensrp-client-core/commit/645ea07ddcd1be53b9ce0c87aeba8a01d45f9f44", "message": "Use explicit scoping for variables", "committedDate": "2020-04-28T08:03:44Z", "type": "commit"}, {"oid": "78cea7a66e9caa64552b876feaa5c13051bf15f4", "url": "https://github.com/opensrp/opensrp-client-core/commit/78cea7a66e9caa64552b876feaa5c13051bf15f4", "message": "Added update FTS search test", "committedDate": "2020-04-28T08:37:04Z", "type": "commit"}, {"oid": "d02779e6c92e79cbac027f02906209ba8a61c343", "url": "https://github.com/opensrp/opensrp-client-core/commit/d02779e6c92e79cbac027f02906209ba8a61c343", "message": "Test updateFTSSearch for field with inner bind type", "committedDate": "2020-04-28T08:47:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU1MDkyNg==", "url": "https://github.com/opensrp/opensrp-client-core/pull/503#discussion_r416550926", "bodyText": "Verify that false is returned & remove the unnecessary mocking on line 143", "author": "ekigamba", "createdAt": "2020-04-28T11:52:11Z", "path": "opensrp-app/src/test/java/org/smartregister/service/FormSubmissionServiceTest.java", "diffHunk": "@@ -96,4 +114,71 @@ public void shouldNotDelegateProcessingToZiggyServiceForProcessedSubmissions() t\n         inOrder.verify(formDataRepository).updateServerVersion(\"instance id 2\", \"1\");\n         inOrder.verify(allSettings).savePreviousFormSyncIndex(\"1\");\n     }\n+\n+    @Test\n+    public void testConstructor() {\n+        service = null;\n+        assertNull(service);\n+        service = new FormSubmissionService(ziggyService, formDataRepository, allSettings, allCommonsRepositoryMap);\n+        assertNotNull(service);\n+        assertNotNull(Whitebox.getInternalState(service, \"ziggyService\"));\n+        assertNotNull(Whitebox.getInternalState(service, \"formDataRepository\"));\n+        assertNotNull(Whitebox.getInternalState(service, \"allSettings\"));\n+        assertNotNull(Whitebox.getInternalState(service, \"allCommonsRepositoryMap\"));\n+\n+    }\n+\n+    @Test\n+    public void testPrivateUpdateFTSSearch() throws Exception {\n+        service = new FormSubmissionService(ziggyService, formDataRepository, allSettings, allCommonsRepositoryMap);\n+        when(allCommonsRepositoryMap.isEmpty()).thenReturn(false);\n+        when(allCommonsRepositoryMap.get(\"bindtype_1\")).thenReturn(allCommonsRepository);\n+        Whitebox.invokeMethod(service, \"updateFTSsearch\", \"bindtype_1\", \"entity_1\");\n+        verify(allCommonsRepository).updateSearch(\"entity_1\");\n+    }\n+\n+    @Test\n+    public void testPrivateUpdateFTSSearchWithEmptyAllC0mmonsrepositoryMap() throws Exception {\n+        when(allCommonsRepositoryMap.isEmpty()).thenReturn(true);\n+        when(allCommonsRepositoryMap.get(\"bindtype_1\")).thenReturn(allCommonsRepository);\n+        Whitebox.invokeMethod(service, \"updateFTSsearch\", \"bindtype_1\", \"entity_1\");\n+        verify(allCommonsRepository, times(0)).updateSearch(\"entity_1\");", "originalCommit": "d02779e6c92e79cbac027f02906209ba8a61c343", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "496c6083c0cb8776027c1d022eef7b35754a5eb3", "chunk": "diff --git a/opensrp-app/src/test/java/org/smartregister/service/FormSubmissionServiceTest.java b/opensrp-app/src/test/java/org/smartregister/service/FormSubmissionServiceTest.java\nindex 37331ee0..8d429cf9 100644\n--- a/opensrp-app/src/test/java/org/smartregister/service/FormSubmissionServiceTest.java\n+++ b/opensrp-app/src/test/java/org/smartregister/service/FormSubmissionServiceTest.java\n\n@@ -140,8 +141,8 @@ public class FormSubmissionServiceTest {\n     @Test\n     public void testPrivateUpdateFTSSearchWithEmptyAllC0mmonsrepositoryMap() throws Exception {\n         when(allCommonsRepositoryMap.isEmpty()).thenReturn(true);\n-        when(allCommonsRepositoryMap.get(\"bindtype_1\")).thenReturn(allCommonsRepository);\n-        Whitebox.invokeMethod(service, \"updateFTSsearch\", \"bindtype_1\", \"entity_1\");\n+        Object ftsSearchUpdated = Whitebox.invokeMethod(service, \"updateFTSsearch\", \"bindtype_1\", \"entity_1\");\n+        assertFalse((Boolean) ftsSearchUpdated);\n         verify(allCommonsRepository, times(0)).updateSearch(\"entity_1\");\n     }\n \n"}}, {"oid": "496c6083c0cb8776027c1d022eef7b35754a5eb3", "url": "https://github.com/opensrp/opensrp-client-core/commit/496c6083c0cb8776027c1d022eef7b35754a5eb3", "message": "Update unit test", "committedDate": "2020-04-28T12:14:18Z", "type": "commit"}, {"oid": "21c52ee39af222e169ffe6efa31941194140d48a", "url": "https://github.com/opensrp/opensrp-client-core/commit/21c52ee39af222e169ffe6efa31941194140d48a", "message": "Merge branch 'master' into rkareko-tt-11", "committedDate": "2020-04-28T12:17:54Z", "type": "commit"}, {"oid": "ae46d91c9cd812dca834bced16889bfc0f26a069", "url": "https://github.com/opensrp/opensrp-client-core/commit/ae46d91c9cd812dca834bced16889bfc0f26a069", "message": "Merge branch 'master' into rkareko-tt-11", "committedDate": "2020-04-28T12:27:29Z", "type": "commit"}]}