{"pr_number": 481, "pr_title": "Implement document configuration downloading of forms", "pr_createdAt": "2020-04-08T15:16:32Z", "pr_url": "https://github.com/opensrp/opensrp-client-core/pull/481", "timeline": [{"oid": "4227fd4d2bc30aa44d70a06cddfe4d4ad608d95f", "url": "https://github.com/opensrp/opensrp-client-core/commit/4227fd4d2bc30aa44d70a06cddfe4d4ad608d95f", "message": "Implemented Manifest and CLientForms domains", "committedDate": "2020-04-06T08:13:53Z", "type": "commit"}, {"oid": "0e8163465277aa6df391511b68f1b439a9f8794d", "url": "https://github.com/opensrp/opensrp-client-core/commit/0e8163465277aa6df391511b68f1b439a9f8794d", "message": "Implemented Manifest repository", "committedDate": "2020-04-06T11:07:39Z", "type": "commit"}, {"oid": "47fb9a5714ef20628a113766d20976f09ab0c84a", "url": "https://github.com/opensrp/opensrp-client-core/commit/47fb9a5714ef20628a113766d20976f09ab0c84a", "message": "Implemented ClientForm Repository", "committedDate": "2020-04-06T11:59:08Z", "type": "commit"}, {"oid": "327033019ff06ac1f1229a20eb9a122b0dd78158", "url": "https://github.com/opensrp/opensrp-client-core/commit/327033019ff06ac1f1229a20eb9a122b0dd78158", "message": "Refactored Manifest Repository", "committedDate": "2020-04-06T13:50:16Z", "type": "commit"}, {"oid": "5dffdd015687ea06d3257124f0fb93a9f66ea12d", "url": "https://github.com/opensrp/opensrp-client-core/commit/5dffdd015687ea06d3257124f0fb93a9f66ea12d", "message": "optmising imports of Manifest domain", "committedDate": "2020-04-08T14:13:39Z", "type": "commit"}, {"oid": "0576515e82869bfd8293970a4489ba342a3d40b5", "url": "https://github.com/opensrp/opensrp-client-core/commit/0576515e82869bfd8293970a4489ba342a3d40b5", "message": "Implemented DocumentConfigurationIntentService", "committedDate": "2020-04-08T14:15:38Z", "type": "commit"}, {"oid": "38cf7bcc468ef9f320fdf4c9cd62bd88a1780588", "url": "https://github.com/opensrp/opensrp-client-core/commit/38cf7bcc468ef9f320fdf4c9cd62bd88a1780588", "message": "Implemented DocumentConfigurationServiceJob", "committedDate": "2020-04-08T14:15:58Z", "type": "commit"}, {"oid": "6ff06875a1a17ef72d7d64b504659c749cf67b83", "url": "https://github.com/opensrp/opensrp-client-core/commit/6ff06875a1a17ef72d7d64b504659c749cf67b83", "message": "Implement syncing of manifest", "committedDate": "2020-04-08T14:53:33Z", "type": "commit"}, {"oid": "f712bf7ddaec247d85269db4d872816438dd2912", "url": "https://github.com/opensrp/opensrp-client-core/commit/f712bf7ddaec247d85269db4d872816438dd2912", "message": "Implemented saving of synched manifest and deletion of the third oldest manifest", "committedDate": "2020-04-08T15:07:59Z", "type": "commit"}, {"oid": "a6ea2d3dc1c2a47fafb1e9a000b5df7e4a829537", "url": "https://github.com/opensrp/opensrp-client-core/commit/a6ea2d3dc1c2a47fafb1e9a000b5df7e4a829537", "message": "Code refactoring of DocumentConfigurationIntentService", "committedDate": "2020-04-08T15:14:46Z", "type": "commit"}, {"oid": "2e1702c6f744b7aa091685a5c05a75a4b2162270", "url": "https://github.com/opensrp/opensrp-client-core/commit/2e1702c6f744b7aa091685a5c05a75a4b2162270", "message": "Implemented deletion client form by id and querying of active client forms by identifiers", "committedDate": "2020-04-09T07:21:14Z", "type": "commit"}, {"oid": "6d7c511c0a0ac70822dde807db4b3b228884aa38", "url": "https://github.com/opensrp/opensrp-client-core/commit/6d7c511c0a0ac70822dde807db4b3b228884aa38", "message": "Code refactoring", "committedDate": "2020-04-09T07:22:02Z", "type": "commit"}, {"oid": "414daa60f4aece663ece4fe2a1ae22b4fec18d25", "url": "https://github.com/opensrp/opensrp-client-core/commit/414daa60f4aece663ece4fe2a1ae22b4fec18d25", "message": "Implemented client form response DTOs", "committedDate": "2020-04-09T07:25:56Z", "type": "commit"}, {"oid": "900c6fb996adf35fd4706def9876b53a4c54d93b", "url": "https://github.com/opensrp/opensrp-client-core/commit/900c6fb996adf35fd4706def9876b53a4c54d93b", "message": "Implemented sync of Client Forms", "committedDate": "2020-04-09T07:26:33Z", "type": "commit"}, {"oid": "d1316d2bf5f0598557b755e2ad5ad305d3863ce7", "url": "https://github.com/opensrp/opensrp-client-core/commit/d1316d2bf5f0598557b755e2ad5ad305d3863ce7", "message": "Code refactoring", "committedDate": "2020-04-09T10:29:24Z", "type": "commit"}, {"oid": "815dd3ae06724b7c2bf80c0ad92cd2a55ce0eca4", "url": "https://github.com/opensrp/opensrp-client-core/commit/815dd3ae06724b7c2bf80c0ad92cd2a55ce0eca4", "message": "Added tests for Manifest Repository", "committedDate": "2020-04-09T10:30:09Z", "type": "commit"}, {"oid": "96677317c9adb676970a2a4a2bf72de043b69260", "url": "https://github.com/opensrp/opensrp-client-core/commit/96677317c9adb676970a2a4a2bf72de043b69260", "message": "Fixed codacy issues", "committedDate": "2020-04-09T10:35:25Z", "type": "commit"}, {"oid": "48b0a471bd7d9f130b9932e4c8c65218cdbbcf79", "url": "https://github.com/opensrp/opensrp-client-core/commit/48b0a471bd7d9f130b9932e4c8c65218cdbbcf79", "message": "Added Client Form Repository Tests", "committedDate": "2020-04-09T11:18:22Z", "type": "commit"}, {"oid": "f0ff912564294b78770b0c53c67433e46350374b", "url": "https://github.com/opensrp/opensrp-client-core/commit/f0ff912564294b78770b0c53c67433e46350374b", "message": "Code refactoring", "committedDate": "2020-04-09T11:41:41Z", "type": "commit"}, {"oid": "8f7b5e565cdc9cf3a7345862e3945283d1a568c2", "url": "https://github.com/opensrp/opensrp-client-core/commit/8f7b5e565cdc9cf3a7345862e3945283d1a568c2", "message": "Code refactoring", "committedDate": "2020-04-09T13:06:10Z", "type": "commit"}, {"oid": "fa71ddabfb56c6a2bd16133afb20465d0c4b8653", "url": "https://github.com/opensrp/opensrp-client-core/commit/fa71ddabfb56c6a2bd16133afb20465d0c4b8653", "message": "Code refactoring", "committedDate": "2020-04-15T11:45:38Z", "type": "commit"}, {"oid": "c94100d4f307883f400a3b653435da4164a87659", "url": "https://github.com/opensrp/opensrp-client-core/commit/c94100d4f307883f400a3b653435da4164a87659", "message": "Fixing codacy issues", "committedDate": "2020-04-15T11:58:51Z", "type": "commit"}, {"oid": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "url": "https://github.com/opensrp/opensrp-client-core/commit/a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "message": "Merge branch 'master' into implement-document-configuration-downloading-of-forms", "committedDate": "2020-04-15T12:02:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2MTczNw==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408861737", "bodyText": "We are going to be searching by identififer & active boolean/integer` whenever we want to load a form. I think we can have an index for active also or just have a multi-column index with both", "author": "ekigamba", "createdAt": "2020-04-15T13:56:23Z", "path": "opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java", "diffHunk": "@@ -0,0 +1,150 @@\n+package org.smartregister.repository;\n+\n+import android.content.ContentValues;\n+\n+import net.sqlcipher.Cursor;\n+import net.sqlcipher.database.SQLiteDatabase;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.smartregister.domain.ClientForm;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-06.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class ClientFormRepository extends BaseRepository {\n+\n+    protected static final String ID = \"id\";\n+    protected static final String VERSION = \"version\";\n+    protected static final String IDENTIFIER = \"identifier\";\n+    protected static final String MODULE = \"module\";\n+    protected static final String JSON = \"json\";\n+    protected static final String JURISDICTION = \"jurisdiction\";\n+    protected static final String LABEL = \"label\";\n+    protected static final String IS_NEW = \"is_new\";\n+    protected static final String ACTIVE = \"active\";\n+    protected static final String CREATED_AT = \"created_at\";\n+    protected static final String CLIENT_FORM_TABLE = \"client_form\";\n+    public static final String CREATE_CLIENT_FORM_TABLE =\n+            \"CREATE TABLE \" + CLIENT_FORM_TABLE + \" (\" +\n+                    ID + \" VARCHAR NOT NULL PRIMARY KEY,\" +\n+                    VERSION + \" VARCHAR , \" +\n+                    IDENTIFIER + \" VARCHAR , \" +\n+                    MODULE + \" VARCHAR , \" +\n+                    JSON + \" VARCHAR , \" +\n+                    JURISDICTION + \" VARCHAR , \" +\n+                    LABEL + \" VARCHAR , \" +\n+                    IS_NEW + \" INTEGER , \" +\n+                    ACTIVE + \" INTEGER  NOT NULL, \" +\n+                    CREATED_AT + \" VARCHAR NOT NULL ) \";\n+    protected static final String[] COLUMNS = new String[]{ID, VERSION, IDENTIFIER, MODULE, JSON, JURISDICTION, LABEL, IS_NEW, ACTIVE, CREATED_AT};\n+    private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.ENGLISH);\n+    private static final String CREATE_CLIENT_FORM_IDENTIFIER_INDEX = \"CREATE INDEX \"\n+            + CLIENT_FORM_TABLE + \"_\" + IDENTIFIER + \"_ind ON \" + CLIENT_FORM_TABLE + \"(\" + IDENTIFIER + \")\";", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java b/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java\nindex 29890a69..eab14658 100644\n--- a/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java\n+++ b/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java\n\n@@ -50,10 +50,13 @@ public class ClientFormRepository extends BaseRepository {\n     private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.ENGLISH);\n     private static final String CREATE_CLIENT_FORM_IDENTIFIER_INDEX = \"CREATE INDEX \"\n             + CLIENT_FORM_TABLE + \"_\" + IDENTIFIER + \"_ind ON \" + CLIENT_FORM_TABLE + \"(\" + IDENTIFIER + \")\";\n+    private static final String CREATE_CLIENT_FORM_ACTIVE_INDEX = \"CREATE INDEX \"\n+            + CLIENT_FORM_TABLE + \"_\" + ACTIVE + \"_ind ON \" + CLIENT_FORM_TABLE + \"(\" + ACTIVE + \")\";\n \n     public static void createTable(SQLiteDatabase database) {\n         database.execSQL(CREATE_CLIENT_FORM_TABLE);\n         database.execSQL(CREATE_CLIENT_FORM_IDENTIFIER_INDEX);\n+        database.execSQL(CREATE_CLIENT_FORM_ACTIVE_INDEX);\n     }\n \n     protected String getClientFormTableName() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NjM2OA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408866368", "bodyText": "For the sync request happening every 15 minutes, I think that we are going to be using is_active to pick the latest manifest that the app is using. We are going to compare the contents with the one that was downloaded from the server. I therefore think we can index the column in use also", "author": "ekigamba", "createdAt": "2020-04-15T14:02:21Z", "path": "opensrp-app/src/main/java/org/smartregister/repository/ManifestRepository.java", "diffHunk": "@@ -0,0 +1,165 @@\n+package org.smartregister.repository;\n+\n+import android.content.ContentValues;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import net.sqlcipher.Cursor;\n+import net.sqlcipher.database.SQLiteDatabase;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.smartregister.domain.Manifest;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-06.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class ManifestRepository extends BaseRepository {\n+\n+    protected static final String ID = \"id\";\n+    protected static final String APP_VERSION = \"app_version\";\n+    protected static final String FORM_VERSION = \"form_version\";\n+    protected static final String IDENTIFIERS = \"identifiers\";\n+    protected static final String IS_NEW = \"is_new\";\n+    protected static final String ACTIVE = \"active\";\n+    protected static final String CREATED_AT = \"created_at\";\n+\n+\n+    protected static final String MANIFEST_TABLE = \"manifest\";\n+\n+    protected static final String[] COLUMNS = new String[]{ID, APP_VERSION, FORM_VERSION, IDENTIFIERS, IS_NEW, ACTIVE, CREATED_AT};\n+    private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.ENGLISH);\n+\n+    private static final String CREATE_MANIFEST_TABLE =\n+            \"CREATE TABLE \" + MANIFEST_TABLE + \" (\" +\n+                    ID + \" VARCHAR NOT NULL PRIMARY KEY,\" +\n+                    APP_VERSION + \" VARCHAR , \" +\n+                    FORM_VERSION + \" VARCHAR , \" +\n+                    IDENTIFIERS + \" VARCHAR , \" +\n+                    IS_NEW + \" INTEGER , \" +\n+                    ACTIVE + \" INTEGER , \" +\n+                    CREATED_AT + \" VARCHAR NOT NULL ) \";\n+\n+    private static final String CREATE_LOCATION_NAME_INDEX = \"CREATE INDEX \"\n+            + MANIFEST_TABLE + \"_\" + APP_VERSION + \"_ind ON \" + MANIFEST_TABLE + \"(\" + APP_VERSION + \")\";\n+\n+    public static void createTable(SQLiteDatabase database) {\n+        database.execSQL(CREATE_MANIFEST_TABLE);\n+        database.execSQL(CREATE_LOCATION_NAME_INDEX);", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/repository/ManifestRepository.java b/opensrp-app/src/main/java/org/smartregister/repository/ManifestRepository.java\nindex c75888ae..33446bbe 100644\n--- a/opensrp-app/src/main/java/org/smartregister/repository/ManifestRepository.java\n+++ b/opensrp-app/src/main/java/org/smartregister/repository/ManifestRepository.java\n\n@@ -50,12 +50,15 @@ public class ManifestRepository extends BaseRepository {\n                     ACTIVE + \" INTEGER , \" +\n                     CREATED_AT + \" VARCHAR NOT NULL ) \";\n \n-    private static final String CREATE_LOCATION_NAME_INDEX = \"CREATE INDEX \"\n+    private static final String CREATE_MANIFEST_APP_VERSION_INDEX = \"CREATE INDEX \"\n             + MANIFEST_TABLE + \"_\" + APP_VERSION + \"_ind ON \" + MANIFEST_TABLE + \"(\" + APP_VERSION + \")\";\n+    private static final String CREATE_MANIFEST_APP_ACTIVE_INDEX = \"CREATE INDEX \"\n+            + MANIFEST_TABLE + \"_\" + ACTIVE + \"_ind ON \" + MANIFEST_TABLE + \"(\" + ACTIVE + \")\";\n \n     public static void createTable(SQLiteDatabase database) {\n         database.execSQL(CREATE_MANIFEST_TABLE);\n-        database.execSQL(CREATE_LOCATION_NAME_INDEX);\n+        database.execSQL(CREATE_MANIFEST_APP_VERSION_INDEX);\n+        database.execSQL(CREATE_MANIFEST_APP_ACTIVE_INDEX);\n     }\n \n     protected String getManifestTableName() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5Mzk2Ng==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408893966", "bodyText": "Can we handle this exception on the client or declare the specific exceptions on the method signature", "author": "ekigamba", "createdAt": "2020-04-15T14:38:50Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.smartregister.sync.intent;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.domain.ClientForm;\n+import org.smartregister.domain.Manifest;\n+import org.smartregister.domain.Response;\n+import org.smartregister.dto.ClientFormResponse;\n+import org.smartregister.dto.ManifestDTO;\n+import org.smartregister.exception.NoHttpResponseException;\n+import org.smartregister.repository.ClientFormRepository;\n+import org.smartregister.repository.ManifestRepository;\n+import org.smartregister.service.HTTPAgent;\n+\n+import java.net.URLEncoder;\n+import java.text.MessageFormat;\n+import java.util.List;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-08.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n+    public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n+    public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    private Context context;\n+    private HTTPAgent httpAgent;\n+    private ManifestRepository manifestRepository;\n+    private ClientFormRepository clientFormRepository;\n+\n+    public DocumentConfigurationIntentService() {\n+        super(\"DocumentConfigurationIntentService\");\n+    }\n+\n+    public DocumentConfigurationIntentService(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        context = getBaseContext();\n+        httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        manifestRepository = CoreLibrary.getInstance().context().getManifestRepository();\n+        clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    @Override\n+    protected void onHandleIntent(Intent intent) {\n+        super.onHandleIntent(intent);\n+\n+        try {\n+            fetchManifest();\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        }\n+    }\n+\n+    protected void fetchManifest() throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(MANIFEST_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().\n+                configuration().dristhiBaseURL();\n+        String endString = \"/\";\n+        if (baseUrl.endsWith(endString)) {\n+            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf(endString));\n+        }\n+        Response resp = httpAgent.fetch(\n+                MessageFormat.format(\"{0}{1}{2}\",\n+                        baseUrl, MANIFEST_SYNC_URL, getApplicationContext().getPackageName()));\n+\n+        if (resp.isFailure()) {\n+            throw new NoHttpResponseException(MANIFEST_SYNC_URL + \" not returned data\");", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\nindex b232f76e..20b352af 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n\n@@ -33,6 +33,10 @@ import timber.log.Timber;\n public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n     public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n     public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    public static final String FORM_VERSION = \"form_version\";\n+    public static final String CURRENT_FORM_VERSION = \"current_form_version\";\n+    public static final String IDENTIFIERS = \"identifiers\";\n+    public static final String FORM_IDENTIFIER = \"form_identifier\";\n     private Context context;\n     private HTTPAgent httpAgent;\n     private ManifestRepository manifestRepository;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5NDYzNg==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408894636", "bodyText": "Format the file to fix these spacing issues on this line", "author": "ekigamba", "createdAt": "2020-04-15T14:39:37Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.smartregister.sync.intent;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.domain.ClientForm;\n+import org.smartregister.domain.Manifest;\n+import org.smartregister.domain.Response;\n+import org.smartregister.dto.ClientFormResponse;\n+import org.smartregister.dto.ManifestDTO;\n+import org.smartregister.exception.NoHttpResponseException;\n+import org.smartregister.repository.ClientFormRepository;\n+import org.smartregister.repository.ManifestRepository;\n+import org.smartregister.service.HTTPAgent;\n+\n+import java.net.URLEncoder;\n+import java.text.MessageFormat;\n+import java.util.List;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-08.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n+    public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n+    public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    private Context context;\n+    private HTTPAgent httpAgent;\n+    private ManifestRepository manifestRepository;\n+    private ClientFormRepository clientFormRepository;\n+\n+    public DocumentConfigurationIntentService() {\n+        super(\"DocumentConfigurationIntentService\");\n+    }\n+\n+    public DocumentConfigurationIntentService(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        context = getBaseContext();\n+        httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        manifestRepository = CoreLibrary.getInstance().context().getManifestRepository();\n+        clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    @Override\n+    protected void onHandleIntent(Intent intent) {\n+        super.onHandleIntent(intent);\n+\n+        try {\n+            fetchManifest();\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        }\n+    }\n+\n+    protected void fetchManifest() throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(MANIFEST_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().\n+                configuration().dristhiBaseURL();\n+        String endString = \"/\";\n+        if (baseUrl.endsWith(endString)) {\n+            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf(endString));\n+        }\n+        Response resp = httpAgent.fetch(\n+                MessageFormat.format(\"{0}{1}{2}\",\n+                        baseUrl, MANIFEST_SYNC_URL, getApplicationContext().getPackageName()));\n+\n+        if (resp.isFailure()) {\n+            throw new NoHttpResponseException(MANIFEST_SYNC_URL + \" not returned data\");\n+        }\n+\n+        ManifestDTO receivedManifestDTO =\n+                new Gson().fromJson(resp.payload().toString(), ManifestDTO.class);\n+\n+        Manifest receivedManifest = convertManifestDTOToManifest(receivedManifestDTO);\n+\n+        //Note active manifest is null for the first time synchronization of the application\n+        Manifest activeManifest = manifestRepository.getActiveManifest();\n+\n+        if (activeManifest!=null && !activeManifest.getFormVersion().equals(receivedManifest.getFormVersion())) {", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\nindex b232f76e..20b352af 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n\n@@ -33,6 +33,10 @@ import timber.log.Timber;\n public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n     public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n     public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    public static final String FORM_VERSION = \"form_version\";\n+    public static final String CURRENT_FORM_VERSION = \"current_form_version\";\n+    public static final String IDENTIFIERS = \"identifiers\";\n+    public static final String FORM_IDENTIFIER = \"form_identifier\";\n     private Context context;\n     private HTTPAgent httpAgent;\n     private ManifestRepository manifestRepository;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5NjI1NQ==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408896255", "bodyText": "We might not need to save the manifest if the form_version is the same", "author": "ekigamba", "createdAt": "2020-04-15T14:41:47Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.smartregister.sync.intent;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.domain.ClientForm;\n+import org.smartregister.domain.Manifest;\n+import org.smartregister.domain.Response;\n+import org.smartregister.dto.ClientFormResponse;\n+import org.smartregister.dto.ManifestDTO;\n+import org.smartregister.exception.NoHttpResponseException;\n+import org.smartregister.repository.ClientFormRepository;\n+import org.smartregister.repository.ManifestRepository;\n+import org.smartregister.service.HTTPAgent;\n+\n+import java.net.URLEncoder;\n+import java.text.MessageFormat;\n+import java.util.List;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-08.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n+    public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n+    public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    private Context context;\n+    private HTTPAgent httpAgent;\n+    private ManifestRepository manifestRepository;\n+    private ClientFormRepository clientFormRepository;\n+\n+    public DocumentConfigurationIntentService() {\n+        super(\"DocumentConfigurationIntentService\");\n+    }\n+\n+    public DocumentConfigurationIntentService(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        context = getBaseContext();\n+        httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        manifestRepository = CoreLibrary.getInstance().context().getManifestRepository();\n+        clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    @Override\n+    protected void onHandleIntent(Intent intent) {\n+        super.onHandleIntent(intent);\n+\n+        try {\n+            fetchManifest();\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        }\n+    }\n+\n+    protected void fetchManifest() throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(MANIFEST_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().\n+                configuration().dristhiBaseURL();\n+        String endString = \"/\";\n+        if (baseUrl.endsWith(endString)) {\n+            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf(endString));\n+        }\n+        Response resp = httpAgent.fetch(\n+                MessageFormat.format(\"{0}{1}{2}\",\n+                        baseUrl, MANIFEST_SYNC_URL, getApplicationContext().getPackageName()));\n+\n+        if (resp.isFailure()) {\n+            throw new NoHttpResponseException(MANIFEST_SYNC_URL + \" not returned data\");\n+        }\n+\n+        ManifestDTO receivedManifestDTO =\n+                new Gson().fromJson(resp.payload().toString(), ManifestDTO.class);\n+\n+        Manifest receivedManifest = convertManifestDTOToManifest(receivedManifestDTO);\n+\n+        //Note active manifest is null for the first time synchronization of the application\n+        Manifest activeManifest = manifestRepository.getActiveManifest();\n+\n+        if (activeManifest!=null && !activeManifest.getFormVersion().equals(receivedManifest.getFormVersion())) {\n+            //Untaging the active manifest and saving the received manifest and tagging it as active\n+            activeManifest.setActive(false);\n+            activeManifest.setNew(false);\n+            manifestRepository.addOrUpdate(activeManifest);\n+        }\n+\n+        saveReceivedManifest(receivedManifest);", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\nindex b232f76e..20b352af 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n\n@@ -33,6 +33,10 @@ import timber.log.Timber;\n public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n     public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n     public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    public static final String FORM_VERSION = \"form_version\";\n+    public static final String CURRENT_FORM_VERSION = \"current_form_version\";\n+    public static final String IDENTIFIERS = \"identifiers\";\n+    public static final String FORM_IDENTIFIER = \"form_identifier\";\n     private Context context;\n     private HTTPAgent httpAgent;\n     private ManifestRepository manifestRepository;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5ODM1OA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408898358", "bodyText": "We can leave this call to be performed just in case the application did not download all the client-forms in the previous run.", "author": "ekigamba", "createdAt": "2020-04-15T14:44:20Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.smartregister.sync.intent;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.domain.ClientForm;\n+import org.smartregister.domain.Manifest;\n+import org.smartregister.domain.Response;\n+import org.smartregister.dto.ClientFormResponse;\n+import org.smartregister.dto.ManifestDTO;\n+import org.smartregister.exception.NoHttpResponseException;\n+import org.smartregister.repository.ClientFormRepository;\n+import org.smartregister.repository.ManifestRepository;\n+import org.smartregister.service.HTTPAgent;\n+\n+import java.net.URLEncoder;\n+import java.text.MessageFormat;\n+import java.util.List;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-08.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n+    public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n+    public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    private Context context;\n+    private HTTPAgent httpAgent;\n+    private ManifestRepository manifestRepository;\n+    private ClientFormRepository clientFormRepository;\n+\n+    public DocumentConfigurationIntentService() {\n+        super(\"DocumentConfigurationIntentService\");\n+    }\n+\n+    public DocumentConfigurationIntentService(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        context = getBaseContext();\n+        httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        manifestRepository = CoreLibrary.getInstance().context().getManifestRepository();\n+        clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    @Override\n+    protected void onHandleIntent(Intent intent) {\n+        super.onHandleIntent(intent);\n+\n+        try {\n+            fetchManifest();\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        }\n+    }\n+\n+    protected void fetchManifest() throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(MANIFEST_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().\n+                configuration().dristhiBaseURL();\n+        String endString = \"/\";\n+        if (baseUrl.endsWith(endString)) {\n+            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf(endString));\n+        }\n+        Response resp = httpAgent.fetch(\n+                MessageFormat.format(\"{0}{1}{2}\",\n+                        baseUrl, MANIFEST_SYNC_URL, getApplicationContext().getPackageName()));\n+\n+        if (resp.isFailure()) {\n+            throw new NoHttpResponseException(MANIFEST_SYNC_URL + \" not returned data\");\n+        }\n+\n+        ManifestDTO receivedManifestDTO =\n+                new Gson().fromJson(resp.payload().toString(), ManifestDTO.class);\n+\n+        Manifest receivedManifest = convertManifestDTOToManifest(receivedManifestDTO);\n+\n+        //Note active manifest is null for the first time synchronization of the application\n+        Manifest activeManifest = manifestRepository.getActiveManifest();\n+\n+        if (activeManifest!=null && !activeManifest.getFormVersion().equals(receivedManifest.getFormVersion())) {\n+            //Untaging the active manifest and saving the received manifest and tagging it as active\n+            activeManifest.setActive(false);\n+            activeManifest.setNew(false);\n+            manifestRepository.addOrUpdate(activeManifest);\n+        }\n+\n+        saveReceivedManifest(receivedManifest);\n+        syncClientForms(receivedManifest);\n+    }\n+\n+    protected void syncClientForms(Manifest activeManifest) {", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\nindex b232f76e..20b352af 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n\n@@ -33,6 +33,10 @@ import timber.log.Timber;\n public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n     public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n     public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    public static final String FORM_VERSION = \"form_version\";\n+    public static final String CURRENT_FORM_VERSION = \"current_form_version\";\n+    public static final String IDENTIFIERS = \"identifiers\";\n+    public static final String FORM_IDENTIFIER = \"form_identifier\";\n     private Context context;\n     private HTTPAgent httpAgent;\n     private ManifestRepository manifestRepository;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5OTM1OQ==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408899359", "bodyText": "It would be easier to handle exceptions if we declare specific exceptions instead of a general Exception", "author": "ekigamba", "createdAt": "2020-04-15T14:45:35Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.smartregister.sync.intent;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.domain.ClientForm;\n+import org.smartregister.domain.Manifest;\n+import org.smartregister.domain.Response;\n+import org.smartregister.dto.ClientFormResponse;\n+import org.smartregister.dto.ManifestDTO;\n+import org.smartregister.exception.NoHttpResponseException;\n+import org.smartregister.repository.ClientFormRepository;\n+import org.smartregister.repository.ManifestRepository;\n+import org.smartregister.service.HTTPAgent;\n+\n+import java.net.URLEncoder;\n+import java.text.MessageFormat;\n+import java.util.List;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-08.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n+    public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n+    public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    private Context context;\n+    private HTTPAgent httpAgent;\n+    private ManifestRepository manifestRepository;\n+    private ClientFormRepository clientFormRepository;\n+\n+    public DocumentConfigurationIntentService() {\n+        super(\"DocumentConfigurationIntentService\");\n+    }\n+\n+    public DocumentConfigurationIntentService(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        context = getBaseContext();\n+        httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        manifestRepository = CoreLibrary.getInstance().context().getManifestRepository();\n+        clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    @Override\n+    protected void onHandleIntent(Intent intent) {\n+        super.onHandleIntent(intent);\n+\n+        try {\n+            fetchManifest();\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        }\n+    }\n+\n+    protected void fetchManifest() throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(MANIFEST_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().\n+                configuration().dristhiBaseURL();\n+        String endString = \"/\";\n+        if (baseUrl.endsWith(endString)) {\n+            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf(endString));\n+        }\n+        Response resp = httpAgent.fetch(\n+                MessageFormat.format(\"{0}{1}{2}\",\n+                        baseUrl, MANIFEST_SYNC_URL, getApplicationContext().getPackageName()));\n+\n+        if (resp.isFailure()) {\n+            throw new NoHttpResponseException(MANIFEST_SYNC_URL + \" not returned data\");\n+        }\n+\n+        ManifestDTO receivedManifestDTO =\n+                new Gson().fromJson(resp.payload().toString(), ManifestDTO.class);\n+\n+        Manifest receivedManifest = convertManifestDTOToManifest(receivedManifestDTO);\n+\n+        //Note active manifest is null for the first time synchronization of the application\n+        Manifest activeManifest = manifestRepository.getActiveManifest();\n+\n+        if (activeManifest!=null && !activeManifest.getFormVersion().equals(receivedManifest.getFormVersion())) {\n+            //Untaging the active manifest and saving the received manifest and tagging it as active\n+            activeManifest.setActive(false);\n+            activeManifest.setNew(false);\n+            manifestRepository.addOrUpdate(activeManifest);\n+        }\n+\n+        saveReceivedManifest(receivedManifest);\n+        syncClientForms(receivedManifest);\n+    }\n+\n+    protected void syncClientForms(Manifest activeManifest) {\n+        //Fetching Client Forms for identifiers in the manifest\n+        for (String identifier : activeManifest.getIdentifiers()) {\n+            try {\n+                fetchClientForm(identifier, activeManifest.getFormVersion(), clientFormRepository.getActiveClientFormByIdentifier(identifier));\n+            } catch (Exception e) {\n+                Timber.e(e);\n+            }\n+        }\n+    }\n+\n+    protected void fetchClientForm(String identifier, String formVersion, ClientForm activeClientForm) throws Exception {", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\nindex b232f76e..20b352af 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n\n@@ -33,6 +33,10 @@ import timber.log.Timber;\n public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n     public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n     public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    public static final String FORM_VERSION = \"form_version\";\n+    public static final String CURRENT_FORM_VERSION = \"current_form_version\";\n+    public static final String IDENTIFIERS = \"identifiers\";\n+    public static final String FORM_IDENTIFIER = \"form_identifier\";\n     private Context context;\n     private HTTPAgent httpAgent;\n     private ManifestRepository manifestRepository;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkwOTQxNg==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r408909416", "bodyText": "I think that we can confirm that the activeClientForm is not the same version as the one that we want to request. If it's the same, the skip this server call", "author": "ekigamba", "createdAt": "2020-04-15T14:58:02Z", "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.smartregister.sync.intent;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.smartregister.CoreLibrary;\n+import org.smartregister.domain.ClientForm;\n+import org.smartregister.domain.Manifest;\n+import org.smartregister.domain.Response;\n+import org.smartregister.dto.ClientFormResponse;\n+import org.smartregister.dto.ManifestDTO;\n+import org.smartregister.exception.NoHttpResponseException;\n+import org.smartregister.repository.ClientFormRepository;\n+import org.smartregister.repository.ManifestRepository;\n+import org.smartregister.service.HTTPAgent;\n+\n+import java.net.URLEncoder;\n+import java.text.MessageFormat;\n+import java.util.List;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-08.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n+    public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n+    public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    private Context context;\n+    private HTTPAgent httpAgent;\n+    private ManifestRepository manifestRepository;\n+    private ClientFormRepository clientFormRepository;\n+\n+    public DocumentConfigurationIntentService() {\n+        super(\"DocumentConfigurationIntentService\");\n+    }\n+\n+    public DocumentConfigurationIntentService(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        context = getBaseContext();\n+        httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        manifestRepository = CoreLibrary.getInstance().context().getManifestRepository();\n+        clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    @Override\n+    protected void onHandleIntent(Intent intent) {\n+        super.onHandleIntent(intent);\n+\n+        try {\n+            fetchManifest();\n+        } catch (Exception e) {\n+            Timber.e(e);\n+        }\n+    }\n+\n+    protected void fetchManifest() throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(MANIFEST_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().\n+                configuration().dristhiBaseURL();\n+        String endString = \"/\";\n+        if (baseUrl.endsWith(endString)) {\n+            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf(endString));\n+        }\n+        Response resp = httpAgent.fetch(\n+                MessageFormat.format(\"{0}{1}{2}\",\n+                        baseUrl, MANIFEST_SYNC_URL, getApplicationContext().getPackageName()));\n+\n+        if (resp.isFailure()) {\n+            throw new NoHttpResponseException(MANIFEST_SYNC_URL + \" not returned data\");\n+        }\n+\n+        ManifestDTO receivedManifestDTO =\n+                new Gson().fromJson(resp.payload().toString(), ManifestDTO.class);\n+\n+        Manifest receivedManifest = convertManifestDTOToManifest(receivedManifestDTO);\n+\n+        //Note active manifest is null for the first time synchronization of the application\n+        Manifest activeManifest = manifestRepository.getActiveManifest();\n+\n+        if (activeManifest!=null && !activeManifest.getFormVersion().equals(receivedManifest.getFormVersion())) {\n+            //Untaging the active manifest and saving the received manifest and tagging it as active\n+            activeManifest.setActive(false);\n+            activeManifest.setNew(false);\n+            manifestRepository.addOrUpdate(activeManifest);\n+        }\n+\n+        saveReceivedManifest(receivedManifest);\n+        syncClientForms(receivedManifest);\n+    }\n+\n+    protected void syncClientForms(Manifest activeManifest) {\n+        //Fetching Client Forms for identifiers in the manifest\n+        for (String identifier : activeManifest.getIdentifiers()) {\n+            try {\n+                fetchClientForm(identifier, activeManifest.getFormVersion(), clientFormRepository.getActiveClientFormByIdentifier(identifier));\n+            } catch (Exception e) {\n+                Timber.e(e);\n+            }\n+        }\n+    }\n+\n+    protected void fetchClientForm(String identifier, String formVersion, ClientForm activeClientForm) throws Exception {\n+        HTTPAgent httpAgent = CoreLibrary.getInstance().context().getHttpAgent();\n+        if (httpAgent == null) {\n+            throw new IllegalArgumentException(CLIENT_FORM_SYNC_URL + \" http agent is null\");\n+        }\n+        String baseUrl = CoreLibrary.getInstance().context().", "originalCommit": "a9bc43c727441e0aa577bc0cbd0bee395ad34dc6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64d866073688edfda56f4d9244afb06bb5d501df", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\nindex b232f76e..20b352af 100644\n--- a/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n+++ b/opensrp-app/src/main/java/org/smartregister/sync/intent/DocumentConfigurationIntentService.java\n\n@@ -33,6 +33,10 @@ import timber.log.Timber;\n public class DocumentConfigurationIntentService extends BaseSyncIntentService {\n     public static final String MANIFEST_SYNC_URL = \"rest/manifest/\";\n     public static final String CLIENT_FORM_SYNC_URL = \"rest/clientForm\";\n+    public static final String FORM_VERSION = \"form_version\";\n+    public static final String CURRENT_FORM_VERSION = \"current_form_version\";\n+    public static final String IDENTIFIERS = \"identifiers\";\n+    public static final String FORM_IDENTIFIER = \"form_identifier\";\n     private Context context;\n     private HTTPAgent httpAgent;\n     private ManifestRepository manifestRepository;\n"}}, {"oid": "64d866073688edfda56f4d9244afb06bb5d501df", "url": "https://github.com/opensrp/opensrp-client-core/commit/64d866073688edfda56f4d9244afb06bb5d501df", "message": "Fixed PR issues", "committedDate": "2020-04-16T09:05:07Z", "type": "commit"}, {"oid": "42fad2e5e1795d8de56934b6e4d8b2839d8deb92", "url": "https://github.com/opensrp/opensrp-client-core/commit/42fad2e5e1795d8de56934b6e4d8b2839d8deb92", "message": "Code refactoring and adding of tests", "committedDate": "2020-04-16T10:13:30Z", "type": "commit"}, {"oid": "a34e6636a7141fa8cdb6b3e000de118a0f071242", "url": "https://github.com/opensrp/opensrp-client-core/commit/a34e6636a7141fa8cdb6b3e000de118a0f071242", "message": "Optimised imports", "committedDate": "2020-04-16T10:16:54Z", "type": "commit"}, {"oid": "3c2ffe4af5895ca08704f9d648af1fb86a8a9821", "url": "https://github.com/opensrp/opensrp-client-core/commit/3c2ffe4af5895ca08704f9d648af1fb86a8a9821", "message": "Added more tests", "committedDate": "2020-04-16T10:38:12Z", "type": "commit"}, {"oid": "861dc84c0e31fffbf817566153e7fffc976ce38d", "url": "https://github.com/opensrp/opensrp-client-core/commit/861dc84c0e31fffbf817566153e7fffc976ce38d", "message": "Code refactoring", "committedDate": "2020-04-16T10:43:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE3ODMxNw==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r410178317", "bodyText": "You will need to test out this out. I think the ID provided by the server is int and not string", "author": "ekigamba", "createdAt": "2020-04-17T12:05:19Z", "path": "opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java", "diffHunk": "@@ -0,0 +1,153 @@\n+package org.smartregister.repository;\n+\n+import android.content.ContentValues;\n+\n+import net.sqlcipher.Cursor;\n+import net.sqlcipher.database.SQLiteDatabase;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.smartregister.domain.ClientForm;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import timber.log.Timber;\n+\n+/**\n+ * Created by cozej4 on 2020-04-06.\n+ *\n+ * @author cozej4 https://github.com/cozej4\n+ */\n+public class ClientFormRepository extends BaseRepository {\n+\n+    protected static final String ID = \"id\";\n+    protected static final String VERSION = \"version\";\n+    protected static final String IDENTIFIER = \"identifier\";\n+    protected static final String MODULE = \"module\";\n+    protected static final String JSON = \"json\";\n+    protected static final String JURISDICTION = \"jurisdiction\";\n+    protected static final String LABEL = \"label\";\n+    protected static final String IS_NEW = \"is_new\";\n+    protected static final String ACTIVE = \"active\";\n+    protected static final String CREATED_AT = \"created_at\";\n+    protected static final String CLIENT_FORM_TABLE = \"client_form\";\n+    public static final String CREATE_CLIENT_FORM_TABLE =\n+            \"CREATE TABLE \" + CLIENT_FORM_TABLE + \" (\" +\n+                    ID + \" VARCHAR NOT NULL PRIMARY KEY,\" +\n+                    VERSION + \" VARCHAR , \" +\n+                    IDENTIFIER + \" VARCHAR , \" +\n+                    MODULE + \" VARCHAR , \" +\n+                    JSON + \" VARCHAR , \" +\n+                    JURISDICTION + \" VARCHAR , \" +\n+                    LABEL + \" VARCHAR , \" +\n+                    IS_NEW + \" INTEGER , \" +\n+                    ACTIVE + \" INTEGER  NOT NULL, \" +\n+                    CREATED_AT + \" VARCHAR NOT NULL ) \";\n+    protected static final String[] COLUMNS = new String[]{ID, VERSION, IDENTIFIER, MODULE, JSON, JURISDICTION, LABEL, IS_NEW, ACTIVE, CREATED_AT};\n+    private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.ENGLISH);\n+    private static final String CREATE_CLIENT_FORM_IDENTIFIER_INDEX = \"CREATE INDEX \"\n+            + CLIENT_FORM_TABLE + \"_\" + IDENTIFIER + \"_ind ON \" + CLIENT_FORM_TABLE + \"(\" + IDENTIFIER + \")\";\n+    private static final String CREATE_CLIENT_FORM_IS_ACTIVE_INDEX = \"CREATE INDEX \"\n+            + CLIENT_FORM_TABLE + \"_\" + ACTIVE + \"_ind ON \" + CLIENT_FORM_TABLE + \"(\" + ACTIVE + \")\";\n+\n+    public static void createTable(SQLiteDatabase database) {\n+        database.execSQL(CREATE_CLIENT_FORM_TABLE);\n+        database.execSQL(CREATE_CLIENT_FORM_IDENTIFIER_INDEX);\n+        database.execSQL(CREATE_CLIENT_FORM_IS_ACTIVE_INDEX);\n+    }\n+\n+    protected String getClientFormTableName() {\n+        return CLIENT_FORM_TABLE;\n+    }\n+\n+    public void addOrUpdate(ClientForm clientForm) {\n+        if (StringUtils.isBlank(clientForm.getId()))\n+            throw new IllegalArgumentException(\"id not provided\");\n+        ContentValues contentValues = new ContentValues();\n+        contentValues.put(ID, clientForm.getId());", "originalCommit": "861dc84c0e31fffbf817566153e7fffc976ce38d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4ODYwOA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r410188608", "bodyText": "Okay cool, Let me change it to an int", "author": "cozej4", "createdAt": "2020-04-17T12:27:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE3ODMxNw=="}], "type": "inlineReview", "revised_code": {"commit": "8bf62ec02a9e9a36b4debcf7958bbfba84b20046", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java b/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java\nindex 2616e8ab..24978b92 100644\n--- a/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java\n+++ b/opensrp-app/src/main/java/org/smartregister/repository/ClientFormRepository.java\n\n@@ -36,7 +36,7 @@ public class ClientFormRepository extends BaseRepository {\n     protected static final String CLIENT_FORM_TABLE = \"client_form\";\n     public static final String CREATE_CLIENT_FORM_TABLE =\n             \"CREATE TABLE \" + CLIENT_FORM_TABLE + \" (\" +\n-                    ID + \" VARCHAR NOT NULL PRIMARY KEY,\" +\n+                    ID + \" INTEGER PRIMARY KEY,\" +\n                     VERSION + \" VARCHAR , \" +\n                     IDENTIFIER + \" VARCHAR , \" +\n                     MODULE + \" VARCHAR , \" +\n"}}, {"oid": "9cb6baf7e1a608d3a375d57bc3b5cde14666885b", "url": "https://github.com/opensrp/opensrp-client-core/commit/9cb6baf7e1a608d3a375d57bc3b5cde14666885b", "message": "Code refactoring", "committedDate": "2020-04-22T15:35:04Z", "type": "commit"}, {"oid": "06cec289ebe6b84904a24bee9e3a68a173f8ba63", "url": "https://github.com/opensrp/opensrp-client-core/commit/06cec289ebe6b84904a24bee9e3a68a173f8ba63", "message": "Added FormUitls methods for obtaining json form from repository or assets", "committedDate": "2020-04-23T08:12:17Z", "type": "commit"}, {"oid": "cc10f691b4d3d37ec124a047b896630dd99df9ed", "url": "https://github.com/opensrp/opensrp-client-core/commit/cc10f691b4d3d37ec124a047b896630dd99df9ed", "message": "Code refactoring", "committedDate": "2020-04-23T08:15:18Z", "type": "commit"}, {"oid": "1939af8b7bc30de40c6ef1cefd174e7221ae1256", "url": "https://github.com/opensrp/opensrp-client-core/commit/1939af8b7bc30de40c6ef1cefd174e7221ae1256", "message": "Merged changes from master", "committedDate": "2020-04-23T13:02:57Z", "type": "commit"}, {"oid": "37cd11e07505b3e0b6001724a834f575f42b885a", "url": "https://github.com/opensrp/opensrp-client-core/commit/37cd11e07505b3e0b6001724a834f575f42b885a", "message": "Bumped up module version", "committedDate": "2020-04-23T13:04:17Z", "type": "commit"}, {"oid": "8bf62ec02a9e9a36b4debcf7958bbfba84b20046", "url": "https://github.com/opensrp/opensrp-client-core/commit/8bf62ec02a9e9a36b4debcf7958bbfba84b20046", "message": "Refactored ClientForm id to integer", "committedDate": "2020-04-23T13:25:10Z", "type": "commit"}, {"oid": "cc2e66933bd386ae1a4f4b1c31308857931a5d4b", "url": "https://github.com/opensrp/opensrp-client-core/commit/cc2e66933bd386ae1a4f4b1c31308857931a5d4b", "message": "Updated tests", "committedDate": "2020-04-23T14:11:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM0OTQ2Ng==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r414349466", "bodyText": "Verify that the origin of the form retrieve is from the repository by verifying the mocked call to the repository", "author": "ekigamba", "createdAt": "2020-04-24T07:15:22Z", "path": "opensrp-app/src/test/java/org/smartregister/util/FormUtilsTest.java", "diffHunk": "@@ -206,4 +212,24 @@ public String getStringFromStream(InputStream is) throws Exception {\n         fileContents = new String(buffer, \"UTF-8\");\n         return fileContents;\n     }\n+\n+    @Test\n+    public void getFormJsonFromRepositoryOrAssets() throws Exception {\n+        formUtils = new FormUtils(context_);\n+\n+        Resources resources = Mockito.mock(Resources.class);\n+        Configuration configuration = Mockito.mock(Configuration.class);\n+        ClientFormRepository clientFormRepository = Mockito.mock(ClientFormRepository.class);\n+        ClientForm clientForm = new ClientForm();\n+        clientForm.setJson(\"\\\"{\\\\n  \\\\\\\"form\\\\\\\": \\\\\\\"Sick Child Referral\\\\\\\",\\\\n  \\\\\\\"count\\\\\\\": \\\\\\\"1\\\\\\\",\\\\n  \\\\\\\"encounter_type\\\\\\\": \\\\\\\" \\\\\\\",\\\\n  \\\\\\\"entity_id\\\\\\\": \\\\\\\"\\\\\\\",\\\\n  \\\\\\\"relational_id\\\\\\\": \\\\\\\"\\\\\\\",\\\\n  \\\\\\\"rules_file\\\\\\\": \\\\\\\"rule/general_neat_referral_form_rules.yml\\\\\\\",\\\\n  \\\\\\\"metadata\\\\\\\": {\\\\n    \\\\\\\"start\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"start\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163137AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"end\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"end\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163138AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"today\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"encounter\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"encounter_date\\\\\\\"\\\\n    },\\\\n    \\\\\\\"deviceid\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"deviceid\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163149AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"subscriberid\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"subscriberid\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163150AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"simserial\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"simserial\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163151AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"phonenumber\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"phonenumber\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163152AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"encounter_location\\\\\\\": \\\\\\\"\\\\\\\",\\\\n    \\\\\\\"look_up\\\\\\\": {\\\\n      \\\\\\\"entity_id\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"value\\\\\\\": \\\\\\\"\\\\\\\"\\\\n    }\\\\n  },\\\\n  \\\\\\\"steps\\\\\\\": [\\\\n    {\\\\n      \\\\\\\"title\\\\\\\": \\\\\\\"Sick child form\\\\\\\",\\\\n      \\\\\\\"fields\\\\\\\": [\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"chw_referral_service\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"invisible\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Choose referral service\\\\\\\"\\\\n          },\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"09978\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"yes:Please specify referral service\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"problem\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"multi_choice_checkbox\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Pick condition/problem associated with the client.\\\\\\\"\\\\n          },\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163182AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Fast_breathing_and_difficulty_with_breathing\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Fast breathing and difficulty with breathing\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"142373AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Umbilical_cord_navel_bleeding\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Umbilical cord/navel bleeding\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"123844AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Excessive_crying\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Excessive crying\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"140944AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Convulsions\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Convulsions\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"113054AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Unable_to_breastfeed_or_swallow\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Unable to breastfeed or swallow\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"159861AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Neck_stiffness\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Neck stiffness\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"112721AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Fever\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Fever\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Bloating\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Bloating\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"147132AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Redness_around_the_umbilical_cord_foul_smelling_discharge_from_the_umbilical_cord\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Redness around the umbilical cord, foul-smelling discharge from the umbilical cord\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"132407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Bacterial_conjunctivitis\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Bacterial conjunctivitis\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"148026AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Severe_anaemia\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Severe anaemia\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"162044AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Severe_abdominal_pain\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Severe abdominal pain\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"165271AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Pale_or_jaundiced\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Pale or jaundiced\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"136443AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Cyanosis_blueness_of_lips\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Cyanosis (blueness of lips)\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"143050AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Skin_rash_pustules\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Skin rash / pustules\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Diarrhea\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Diarrhea\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Vomiting\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Vomiting\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"122983AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Disabilities\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Disabilities\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Premature_baby\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Premature baby\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"159908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Care_of_HIV_exposed_infant\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Care of HIV-exposed infant\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"164818AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Immunisation\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Immunisation\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"1914AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Other_symptom\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Other symptom\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            }\\\\n          ],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"yes:Please specify client's problems\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"problem_other\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"text_input_edit_text\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"163182AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"hint\\\\\\\": \\\\\\\"Other symptoms\\\\\\\",\\\\n            \\\\\\\"type\\\\\\\": \\\\\\\"name\\\\\\\"\\\\n          },\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"true:Please specify other symptoms\\\\\\\",\\\\n          \\\\\\\"subjects\\\\\\\": \\\\\\\"problem:map\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"service_before_referral\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"164378AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"multi_choice_checkbox\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Pre-referral management given.\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"ORS\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"ORS\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"351AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Panadol\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Panadol\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"70116AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Other_treatment\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Other treatment\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"None\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"None\\\\\\\",\\\\n              \\\\\\\"is_exclusive\\\\\\\": true,\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"164369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            }\\\\n          ],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"Pre-referral management field is required\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"service_before_referral_other\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"text_input_edit_text\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"164378AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"hint\\\\\\\": \\\\\\\"Other Treatment\\\\\\\",\\\\n            \\\\\\\"type\\\\\\\": \\\\\\\"name\\\\\\\"\\\\n          },\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"true:Please specify other treatment given\\\\\\\",\\\\n          \\\\\\\"subjects\\\\\\\": \\\\\\\"service_before_referral:map\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"chw_referral_hf\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"spinner\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"chw_referral_hf\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n          },\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Choose referral facility\\\\\\\",\\\\n            \\\\\\\"searchable\\\\\\\": \\\\\\\"Choose referral facility\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"yes:Please specify referral facility\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_appointment_date\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"datetime_picker\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"hint\\\\\\\": \\\\\\\"Please select the appointment date\\\\\\\",\\\\n            \\\\\\\"type\\\\\\\": \\\\\\\"date_picker\\\\\\\",\\\\n            \\\\\\\"display_format\\\\\\\": \\\\\\\"dd/MM/yyyy\\\\\\\"\\\\n          },\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_appointment_date\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n          },\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"true:Please specify the appointment date\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_date\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163181AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_time\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n          \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_time\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_type\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n          \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_type\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_status\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n          \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_status\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        }\\\\n      ]\\\\n    }\\\\n  ]\\\\n}\\\"\");\n+\n+\n+        configuration.locale = new Locale(\"en\");\n+\n+        Mockito.when( context_.getResources()).thenReturn(resources);\n+        Mockito.when( resources.getConfiguration()).thenReturn(configuration);\n+        Mockito.when( CoreLibrary.getInstance().context().getClientFormRepository()).thenReturn(clientFormRepository);\n+        Mockito.when( clientFormRepository.getActiveClientFormByIdentifier(\"sick_child_referral_form\")).thenReturn(clientForm);\n+        Assert.assertNotNull(formUtils.getFormJsonFromRepositoryOrAssets(\"sick_child_referral_form\"));", "originalCommit": "cc2e66933bd386ae1a4f4b1c31308857931a5d4b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ee34a9f08809cdd267104dceb7f375aedd788f03", "chunk": "diff --git a/opensrp-app/src/test/java/org/smartregister/util/FormUtilsTest.java b/opensrp-app/src/test/java/org/smartregister/util/FormUtilsTest.java\nindex 8e7f6bc2..6ac60fbf 100644\n--- a/opensrp-app/src/test/java/org/smartregister/util/FormUtilsTest.java\n+++ b/opensrp-app/src/test/java/org/smartregister/util/FormUtilsTest.java\n\n@@ -221,8 +222,7 @@ public class FormUtilsTest extends BaseUnitTest {\n         Configuration configuration = Mockito.mock(Configuration.class);\n         ClientFormRepository clientFormRepository = Mockito.mock(ClientFormRepository.class);\n         ClientForm clientForm = new ClientForm();\n-        clientForm.setJson(\"\\\"{\\\\n  \\\\\\\"form\\\\\\\": \\\\\\\"Sick Child Referral\\\\\\\",\\\\n  \\\\\\\"count\\\\\\\": \\\\\\\"1\\\\\\\",\\\\n  \\\\\\\"encounter_type\\\\\\\": \\\\\\\" \\\\\\\",\\\\n  \\\\\\\"entity_id\\\\\\\": \\\\\\\"\\\\\\\",\\\\n  \\\\\\\"relational_id\\\\\\\": \\\\\\\"\\\\\\\",\\\\n  \\\\\\\"rules_file\\\\\\\": \\\\\\\"rule/general_neat_referral_form_rules.yml\\\\\\\",\\\\n  \\\\\\\"metadata\\\\\\\": {\\\\n    \\\\\\\"start\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"start\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163137AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"end\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"end\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163138AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"today\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"encounter\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"encounter_date\\\\\\\"\\\\n    },\\\\n    \\\\\\\"deviceid\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"deviceid\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163149AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"subscriberid\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"subscriberid\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163150AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"simserial\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"simserial\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163151AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"phonenumber\\\\\\\": {\\\\n      \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n      \\\\\\\"openmrs_data_type\\\\\\\": \\\\\\\"phonenumber\\\\\\\",\\\\n      \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163152AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n    },\\\\n    \\\\\\\"encounter_location\\\\\\\": \\\\\\\"\\\\\\\",\\\\n    \\\\\\\"look_up\\\\\\\": {\\\\n      \\\\\\\"entity_id\\\\\\\": \\\\\\\"\\\\\\\",\\\\n      \\\\\\\"value\\\\\\\": \\\\\\\"\\\\\\\"\\\\n    }\\\\n  },\\\\n  \\\\\\\"steps\\\\\\\": [\\\\n    {\\\\n      \\\\\\\"title\\\\\\\": \\\\\\\"Sick child form\\\\\\\",\\\\n      \\\\\\\"fields\\\\\\\": [\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"chw_referral_service\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"invisible\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Choose referral service\\\\\\\"\\\\n          },\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"09978\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"yes:Please specify referral service\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"problem\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"multi_choice_checkbox\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Pick condition/problem associated with the client.\\\\\\\"\\\\n          },\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163182AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Fast_breathing_and_difficulty_with_breathing\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Fast breathing and difficulty with breathing\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"142373AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Umbilical_cord_navel_bleeding\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Umbilical cord/navel bleeding\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"123844AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Excessive_crying\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Excessive crying\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"140944AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Convulsions\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Convulsions\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"113054AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Unable_to_breastfeed_or_swallow\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Unable to breastfeed or swallow\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"159861AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Neck_stiffness\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Neck stiffness\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"112721AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Fever\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Fever\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Bloating\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Bloating\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"147132AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Redness_around_the_umbilical_cord_foul_smelling_discharge_from_the_umbilical_cord\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Redness around the umbilical cord, foul-smelling discharge from the umbilical cord\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"132407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Bacterial_conjunctivitis\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Bacterial conjunctivitis\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"148026AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Severe_anaemia\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Severe anaemia\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"162044AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Severe_abdominal_pain\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Severe abdominal pain\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"165271AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Pale_or_jaundiced\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Pale or jaundiced\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"136443AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Cyanosis_blueness_of_lips\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Cyanosis (blueness of lips)\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"143050AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Skin_rash_pustules\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Skin rash / pustules\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Diarrhea\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Diarrhea\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Vomiting\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Vomiting\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"122983AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Disabilities\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Disabilities\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Premature_baby\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Premature baby\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"159908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Care_of_HIV_exposed_infant\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Care of HIV-exposed infant\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"164818AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Immunisation\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Immunisation\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"1914AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Other_symptom\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Other symptom\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            }\\\\n          ],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"yes:Please specify client's problems\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"problem_other\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"text_input_edit_text\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"163182AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"hint\\\\\\\": \\\\\\\"Other symptoms\\\\\\\",\\\\n            \\\\\\\"type\\\\\\\": \\\\\\\"name\\\\\\\"\\\\n          },\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"true:Please specify other symptoms\\\\\\\",\\\\n          \\\\\\\"subjects\\\\\\\": \\\\\\\"problem:map\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"service_before_referral\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"164378AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"multi_choice_checkbox\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Pre-referral management given.\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"ORS\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"ORS\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"351AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Panadol\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Panadol\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"70116AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"Other_treatment\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"Other treatment\\\\\\\",\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            },\\\\n            {\\\\n              \\\\\\\"name\\\\\\\": \\\\\\\"None\\\\\\\",\\\\n              \\\\\\\"text\\\\\\\": \\\\\\\"None\\\\\\\",\\\\n              \\\\\\\"is_exclusive\\\\\\\": true,\\\\n              \\\\\\\"meta_data\\\\\\\": {\\\\n                \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"164369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n                \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n              }\\\\n            }\\\\n          ],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"Pre-referral management field is required\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"service_before_referral_other\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"text_input_edit_text\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"164378AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"hint\\\\\\\": \\\\\\\"Other Treatment\\\\\\\",\\\\n            \\\\\\\"type\\\\\\\": \\\\\\\"name\\\\\\\"\\\\n          },\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"true:Please specify other treatment given\\\\\\\",\\\\n          \\\\\\\"subjects\\\\\\\": \\\\\\\"service_before_referral:map\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"chw_referral_hf\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"spinner\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"chw_referral_hf\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n          },\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"text\\\\\\\": \\\\\\\"Choose referral facility\\\\\\\",\\\\n            \\\\\\\"searchable\\\\\\\": \\\\\\\"Choose referral facility\\\\\\\"\\\\n          },\\\\n          \\\\\\\"options\\\\\\\": [],\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"yes:Please specify referral facility\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_appointment_date\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"datetime_picker\\\\\\\",\\\\n          \\\\\\\"properties\\\\\\\": {\\\\n            \\\\\\\"hint\\\\\\\": \\\\\\\"Please select the appointment date\\\\\\\",\\\\n            \\\\\\\"type\\\\\\\": \\\\\\\"date_picker\\\\\\\",\\\\n            \\\\\\\"display_format\\\\\\\": \\\\\\\"dd/MM/yyyy\\\\\\\"\\\\n          },\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_appointment_date\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\"\\\\n          },\\\\n          \\\\\\\"required_status\\\\\\\": \\\\\\\"true:Please specify the appointment date\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_date\\\\\\\",\\\\n          \\\\\\\"meta_data\\\\\\\": {\\\\n            \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n            \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n            \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"163181AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\\\"\\\\n          },\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_time\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n          \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_time\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_type\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n          \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_type\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        },\\\\n        {\\\\n          \\\\\\\"name\\\\\\\": \\\\\\\"referral_status\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_parent\\\\\\\": \\\\\\\"\\\\\\\",\\\\n          \\\\\\\"openmrs_entity\\\\\\\": \\\\\\\"concept\\\\\\\",\\\\n          \\\\\\\"openmrs_entity_id\\\\\\\": \\\\\\\"referral_status\\\\\\\",\\\\n          \\\\\\\"type\\\\\\\": \\\\\\\"hidden\\\\\\\"\\\\n        }\\\\n      ]\\\\n    }\\\\n  ]\\\\n}\\\"\");\n-\n+        clientForm.setJson(\"{\\\"form\\\":\\\"Sick Child Referral\\\",\\\"count\\\":\\\"1\\\",\\\"encounter_type\\\":\\\" \\\",\\\"entity_id\\\":\\\"\\\",\\\"relational_id\\\":\\\"\\\",\\\"rules_file\\\":\\\"rule/general_neat_referral_form_rules.yml\\\",\\\"metadata\\\":{\\\"start\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_data_type\\\":\\\"start\\\",\\\"openmrs_entity_id\\\":\\\"163137AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"end\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_data_type\\\":\\\"end\\\",\\\"openmrs_entity_id\\\":\\\"163138AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"today\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"encounter\\\",\\\"openmrs_entity_id\\\":\\\"encounter_date\\\"},\\\"deviceid\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_data_type\\\":\\\"deviceid\\\",\\\"openmrs_entity_id\\\":\\\"163149AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"subscriberid\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_data_type\\\":\\\"subscriberid\\\",\\\"openmrs_entity_id\\\":\\\"163150AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"simserial\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_data_type\\\":\\\"simserial\\\",\\\"openmrs_entity_id\\\":\\\"163151AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"phonenumber\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_data_type\\\":\\\"phonenumber\\\",\\\"openmrs_entity_id\\\":\\\"163152AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"encounter_location\\\":\\\"\\\",\\\"look_up\\\":{\\\"entity_id\\\":\\\"\\\",\\\"value\\\":\\\"\\\"}},\\\"steps\\\":[{\\\"title\\\":\\\"Sick child form\\\",\\\"fields\\\":[{\\\"name\\\":\\\"chw_referral_service\\\",\\\"type\\\":\\\"invisible\\\",\\\"properties\\\":{\\\"text\\\":\\\"Choose referral service\\\"},\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"09978\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"},\\\"options\\\":[],\\\"required_status\\\":\\\"yes:Please specify referral service\\\"},{\\\"name\\\":\\\"problem\\\",\\\"type\\\":\\\"multi_choice_checkbox\\\",\\\"properties\\\":{\\\"text\\\":\\\"Pick condition/problem associated with the client.\\\"},\\\"meta_data\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"163182AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"options\\\":[{\\\"name\\\":\\\"Fast_breathing_and_difficulty_with_breathing\\\",\\\"text\\\":\\\"Fast breathing and difficulty with breathing\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"142373AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Umbilical_cord_navel_bleeding\\\",\\\"text\\\":\\\"Umbilical cord/navel bleeding\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"123844AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Excessive_crying\\\",\\\"text\\\":\\\"Excessive crying\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"140944AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Convulsions\\\",\\\"text\\\":\\\"Convulsions\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"113054AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Unable_to_breastfeed_or_swallow\\\",\\\"text\\\":\\\"Unable to breastfeed or swallow\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"159861AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Neck_stiffness\\\",\\\"text\\\":\\\"Neck stiffness\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"112721AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Fever\\\",\\\"text\\\":\\\"Fever\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Bloating\\\",\\\"text\\\":\\\"Bloating\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"147132AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Redness_around_the_umbilical_cord_foul_smelling_discharge_from_the_umbilical_cord\\\",\\\"text\\\":\\\"Redness around the umbilical cord, foul-smelling discharge from the umbilical cord\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"132407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Bacterial_conjunctivitis\\\",\\\"text\\\":\\\"Bacterial conjunctivitis\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"148026AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Severe_anaemia\\\",\\\"text\\\":\\\"Severe anaemia\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"162044AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Severe_abdominal_pain\\\",\\\"text\\\":\\\"Severe abdominal pain\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"165271AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Pale_or_jaundiced\\\",\\\"text\\\":\\\"Pale or jaundiced\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"136443AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Cyanosis_blueness_of_lips\\\",\\\"text\\\":\\\"Cyanosis (blueness of lips)\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"143050AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Skin_rash_pustules\\\",\\\"text\\\":\\\"Skin rash / pustules\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Diarrhea\\\",\\\"text\\\":\\\"Diarrhea\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Vomiting\\\",\\\"text\\\":\\\"Vomiting\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"122983AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Disabilities\\\",\\\"text\\\":\\\"Disabilities\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Premature_baby\\\",\\\"text\\\":\\\"Premature baby\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"159908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Care_of_HIV_exposed_infant\\\",\\\"text\\\":\\\"Care of HIV-exposed infant\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"164818AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Immunisation\\\",\\\"text\\\":\\\"Immunisation\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"1914AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Other_symptom\\\",\\\"text\\\":\\\"Other symptom\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}}],\\\"required_status\\\":\\\"yes:Please specify client's problems\\\"},{\\\"name\\\":\\\"problem_other\\\",\\\"type\\\":\\\"text_input_edit_text\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"163182AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"properties\\\":{\\\"hint\\\":\\\"Other symptoms\\\",\\\"type\\\":\\\"name\\\"},\\\"required_status\\\":\\\"true:Please specify other symptoms\\\",\\\"subjects\\\":\\\"problem:map\\\"},{\\\"name\\\":\\\"service_before_referral\\\",\\\"meta_data\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"164378AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"type\\\":\\\"multi_choice_checkbox\\\",\\\"properties\\\":{\\\"text\\\":\\\"Pre-referral management given.\\\"},\\\"options\\\":[{\\\"name\\\":\\\"ORS\\\",\\\"text\\\":\\\"ORS\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"351AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Panadol\\\",\\\"text\\\":\\\"Panadol\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"70116AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"Other_treatment\\\",\\\"text\\\":\\\"Other treatment\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}},{\\\"name\\\":\\\"None\\\",\\\"text\\\":\\\"None\\\",\\\"is_exclusive\\\":true,\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"164369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"}}],\\\"required_status\\\":\\\"Pre-referral management field is required\\\"},{\\\"name\\\":\\\"service_before_referral_other\\\",\\\"type\\\":\\\"text_input_edit_text\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\",\\\"openmrs_entity_parent\\\":\\\"164378AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"properties\\\":{\\\"hint\\\":\\\"Other Treatment\\\",\\\"type\\\":\\\"name\\\"},\\\"required_status\\\":\\\"true:Please specify other treatment given\\\",\\\"subjects\\\":\\\"service_before_referral:map\\\"},{\\\"name\\\":\\\"chw_referral_hf\\\",\\\"type\\\":\\\"spinner\\\",\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"chw_referral_hf\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"},\\\"properties\\\":{\\\"text\\\":\\\"Choose referral facility\\\",\\\"searchable\\\":\\\"Choose referral facility\\\"},\\\"options\\\":[],\\\"required_status\\\":\\\"yes:Please specify referral facility\\\"},{\\\"name\\\":\\\"referral_appointment_date\\\",\\\"type\\\":\\\"datetime_picker\\\",\\\"properties\\\":{\\\"hint\\\":\\\"Please select the appointment date\\\",\\\"type\\\":\\\"date_picker\\\",\\\"display_format\\\":\\\"dd/MM/yyyy\\\"},\\\"meta_data\\\":{\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"referral_appointment_date\\\",\\\"openmrs_entity_parent\\\":\\\"\\\"},\\\"required_status\\\":\\\"true:Please specify the appointment date\\\"},{\\\"name\\\":\\\"referral_date\\\",\\\"meta_data\\\":{\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"163181AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\"},\\\"type\\\":\\\"hidden\\\"},{\\\"name\\\":\\\"referral_time\\\",\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"referral_time\\\",\\\"type\\\":\\\"hidden\\\"},{\\\"name\\\":\\\"referral_type\\\",\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"referral_type\\\",\\\"type\\\":\\\"hidden\\\"},{\\\"name\\\":\\\"referral_status\\\",\\\"openmrs_entity_parent\\\":\\\"\\\",\\\"openmrs_entity\\\":\\\"concept\\\",\\\"openmrs_entity_id\\\":\\\"referral_status\\\",\\\"type\\\":\\\"hidden\\\"}]}]}\");\n \n         configuration.locale = new Locale(\"en\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM5MzQ2Mg==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r414393462", "bodyText": "I was thinking that this code will be difficult to maintain and  might not cover all the cases. I think this StringEscapeUtils.unescapeJson(clientFormResponse.getClientForm().getJson()) is better. I also think that we should save the json unescaped just like the event & client JSONs are saved in the tables. This will mean that you only have to unescape it once during download. After that, the JSON will be like standard JSON, easy to ready, debug & work with", "author": "ekigamba", "createdAt": "2020-04-24T08:29:32Z", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1121,4 +1123,38 @@ private void createNewEventDocument(org.smartregister.cloudant.models.Event even\n     private void createNewClientDocument(org.smartregister.cloudant.models.Client client) {\n         mCloudantDataHandler.createClientDocument(client);\n     }\n+\n+    public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = formIdentity;\n+        if (!locale.equals(\"en\")) {\n+            localeFormIdentity = localeFormIdentity + \"-\" + locale;\n+        }\n+\n+        ClientForm clientForm = clientFormRepository.getActiveClientFormByIdentifier(localeFormIdentity);\n+        try {\n+            if (clientForm != null) {\n+                Timber.d(\"============%s form loaded from db============\", formIdentity);\n+                String jsonString = convertStandardJSONString(clientForm.getJson());\n+                return new JSONObject(jsonString);\n+            }\n+        } catch (JSONException e) {\n+            Timber.e(e);\n+        }\n+        Timber.d(\"============%s form loaded from Assets=============\", formIdentity);\n+        return getFormJson(formIdentity);\n+    }\n+\n+    private String convertStandardJSONString(String data_json) {", "originalCommit": "cc2e66933bd386ae1a4f4b1c31308857931a5d4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM5ODEyOA==", "url": "https://github.com/opensrp/opensrp-client-core/pull/481#discussion_r414398128", "bodyText": "Cool this makes more sense", "author": "cozej4", "createdAt": "2020-04-24T08:36:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM5MzQ2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "ee34a9f08809cdd267104dceb7f375aedd788f03", "chunk": "diff --git a/opensrp-app/src/main/java/org/smartregister/util/FormUtils.java b/opensrp-app/src/main/java/org/smartregister/util/FormUtils.java\nindex 1f85ea57..65b75ec7 100644\n--- a/opensrp-app/src/main/java/org/smartregister/util/FormUtils.java\n+++ b/opensrp-app/src/main/java/org/smartregister/util/FormUtils.java\n\n@@ -1138,8 +1139,7 @@ public class FormUtils {\n         try {\n             if (clientForm != null) {\n                 Timber.d(\"============%s form loaded from db============\", formIdentity);\n-                String jsonString = convertStandardJSONString(clientForm.getJson());\n-                return new JSONObject(jsonString);\n+                return new JSONObject(clientForm.getJson());\n             }\n         } catch (JSONException e) {\n             Timber.e(e);\n"}}, {"oid": "ee34a9f08809cdd267104dceb7f375aedd788f03", "url": "https://github.com/opensrp/opensrp-client-core/commit/ee34a9f08809cdd267104dceb7f375aedd788f03", "message": "Fixed PR issues", "committedDate": "2020-04-24T09:58:52Z", "type": "commit"}, {"oid": "32891386fe6c70f7f03b86206657d7267313d351", "url": "https://github.com/opensrp/opensrp-client-core/commit/32891386fe6c70f7f03b86206657d7267313d351", "message": "Code refactoring", "committedDate": "2020-04-24T11:21:31Z", "type": "commit"}, {"oid": "6bfa104b28e43b7106df48c3c5ebdbd2a4f9f99f", "url": "https://github.com/opensrp/opensrp-client-core/commit/6bfa104b28e43b7106df48c3c5ebdbd2a4f9f99f", "message": "Added more Document Configuration service tests", "committedDate": "2020-04-24T11:22:12Z", "type": "commit"}, {"oid": "023a70025bae2d581e65c108e48b752a20480354", "url": "https://github.com/opensrp/opensrp-client-core/commit/023a70025bae2d581e65c108e48b752a20480354", "message": "Code cleaning", "committedDate": "2020-04-24T11:40:12Z", "type": "commit"}, {"oid": "8d30864ba969118a028610fc8b18f7e3aae522d0", "url": "https://github.com/opensrp/opensrp-client-core/commit/8d30864ba969118a028610fc8b18f7e3aae522d0", "message": "Fixed Codacy issues", "committedDate": "2020-04-24T11:49:48Z", "type": "commit"}, {"oid": "b4bcdbe3f215a2003b9b479fb7eaefc442d1273a", "url": "https://github.com/opensrp/opensrp-client-core/commit/b4bcdbe3f215a2003b9b479fb7eaefc442d1273a", "message": "Fixed travic issues", "committedDate": "2020-04-24T11:59:09Z", "type": "commit"}, {"oid": "63af5aef981e1edb21674db3b941fcbf5a229fdd", "url": "https://github.com/opensrp/opensrp-client-core/commit/63af5aef981e1edb21674db3b941fcbf5a229fdd", "message": "Fixed failing tests", "committedDate": "2020-04-24T12:43:56Z", "type": "commit"}, {"oid": "73c6e5bf7805ffc446f321e98edafb54f90c7709", "url": "https://github.com/opensrp/opensrp-client-core/commit/73c6e5bf7805ffc446f321e98edafb54f90c7709", "message": "Fixing Codacy issues", "committedDate": "2020-04-24T13:22:07Z", "type": "commit"}, {"oid": "b32222f0e1498b14e97f49392ef58602ca1010c5", "url": "https://github.com/opensrp/opensrp-client-core/commit/b32222f0e1498b14e97f49392ef58602ca1010c5", "message": "Merge branch 'master' into implement-document-configuration-downloading-of-forms", "committedDate": "2020-04-24T13:34:55Z", "type": "commit"}, {"oid": "6651e6b6a470b11953ef34e7df63ad1bcbe46645", "url": "https://github.com/opensrp/opensrp-client-core/commit/6651e6b6a470b11953ef34e7df63ad1bcbe46645", "message": "Bumped up the version name", "committedDate": "2020-04-24T13:36:34Z", "type": "commit"}]}