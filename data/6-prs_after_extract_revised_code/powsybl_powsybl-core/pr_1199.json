{"pr_number": 1199, "pr_title": "Add apparent power attribute (ratedS) on transformers in IIDM", "pr_createdAt": "2020-03-03T09:44:02Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1199", "timeline": [{"oid": "3de7474dd42d2d3dd01a4f0f910b006624e5c70c", "url": "https://github.com/powsybl/powsybl-core/commit/3de7474dd42d2d3dd01a4f0f910b006624e5c70c", "message": "Taking into account PR remarks : move ratedS from ThreeWindingsTransformer to Leg\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-04T08:10:55Z", "type": "forcePushed"}, {"oid": "ee331c4b6b2738d86d89cf20febc203779734f3e", "url": "https://github.com/powsybl/powsybl-core/commit/ee331c4b6b2738d86d89cf20febc203779734f3e", "message": "Add RatedS into ThreeWindingsTransformer & TwoWindingsTransformer\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-04T08:10:38Z", "type": "commit"}, {"oid": "c98b6a25d0f5ace9825670686d83a465bbced9ad", "url": "https://github.com/powsybl/powsybl-core/commit/c98b6a25d0f5ace9825670686d83a465bbced9ad", "message": "Add management of RatedS into ThreeWindingsTransformerXML & TwoWindingsTransformerXML\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-04T08:10:47Z", "type": "commit"}, {"oid": "3de7474dd42d2d3dd01a4f0f910b006624e5c70c", "url": "https://github.com/powsybl/powsybl-core/commit/3de7474dd42d2d3dd01a4f0f910b006624e5c70c", "message": "Taking into account PR remarks : move ratedS from ThreeWindingsTransformer to Leg\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-04T08:10:55Z", "type": "commit"}, {"oid": "2cb02ff02503027f336776cae3b1cff54505bda4", "url": "https://github.com/powsybl/powsybl-core/commit/2cb02ff02503027f336776cae3b1cff54505bda4", "message": "SonarCloud Code Analysis : fix code smell\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-04T09:10:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyODY1OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1199#discussion_r387528658", "bodyText": "Add default implementation", "author": "MioRtia", "createdAt": "2020-03-04T09:03:05Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/TwoWindingsTransformerAdder.java", "diffHunk": "@@ -24,6 +24,8 @@\n \n     TwoWindingsTransformerAdder setRatedU2(double ratedU2);\n \n+    TwoWindingsTransformerAdder setRatedS(double ratedS);", "originalCommit": "3de7474dd42d2d3dd01a4f0f910b006624e5c70c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "befce96fabbb5e2f5509645a5f5a86fb78f9504d", "chunk": "diff --git a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/TwoWindingsTransformerAdder.java b/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/TwoWindingsTransformerAdder.java\nindex 4be7575773..9feb13c4f3 100644\n--- a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/TwoWindingsTransformerAdder.java\n+++ b/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/TwoWindingsTransformerAdder.java\n\n@@ -24,7 +24,9 @@ public interface TwoWindingsTransformerAdder extends BranchAdder<TwoWindingsTran\n \n     TwoWindingsTransformerAdder setRatedU2(double ratedU2);\n \n-    TwoWindingsTransformerAdder setRatedS(double ratedS);\n+    default TwoWindingsTransformerAdder setRatedS(double ratedS) {\n+        throw new UnsupportedOperationException();\n+    }\n \n     TwoWindingsTransformer add();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUzMjI4Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1199#discussion_r387532282", "bodyText": "Rather than using a custom interface, you can use DoubleConsumer here and delete RatedSConsumer", "author": "MioRtia", "createdAt": "2020-03-04T09:10:16Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractTransformerXml.java", "diffHunk": "@@ -246,4 +250,19 @@ private static void readSteps(NetworkXmlReaderContext context, StepConsumer cons\n         double rho = XmlUtil.readDoubleAttribute(context.getReader(), \"rho\");\n         consumer.accept(r, x, g, b, rho);\n     }\n+\n+    protected static void readRatedS(String name, NetworkXmlReaderContext context, RatedSConsumer consumer) {\n+        double ratedS = XmlUtil.readOptionalDoubleAttribute(context.getReader(), name);\n+        consumer.accept(ratedS);", "originalCommit": "3de7474dd42d2d3dd01a4f0f910b006624e5c70c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "befce96fabbb5e2f5509645a5f5a86fb78f9504d", "chunk": "diff --git a/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractTransformerXml.java b/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractTransformerXml.java\nindex f7188dc198..f640687693 100644\n--- a/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractTransformerXml.java\n+++ b/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractTransformerXml.java\n\n@@ -251,11 +248,23 @@ abstract class AbstractTransformerXml<T extends Connectable, A extends Identifia\n         consumer.accept(r, x, g, b, rho);\n     }\n \n-    protected static void readRatedS(String name, NetworkXmlReaderContext context, RatedSConsumer consumer) {\n+    /**\n+     * Read the apparent power in kVA.\n+     * @param name the field name to read\n+     * @param context the XMLStreamReader accessor\n+     * @param consumer the method will used apparent power value read\n+     */\n+    protected static void readRatedS(String name, NetworkXmlReaderContext context, DoubleConsumer consumer) {\n         double ratedS = XmlUtil.readOptionalDoubleAttribute(context.getReader(), name);\n         consumer.accept(ratedS);\n     }\n \n+    /**\n+     * Write the apparent power in kVA.\n+     * @param name the field name to write\n+     * @param ratedS the apparent power value to serialize\n+     * @param context the XMLStreamWriter accessor\n+     */\n     protected static void writeRatedS(String name, double ratedS, NetworkXmlWriterContext context) {\n         IidmXmlUtil.runFromMinimumVersion(IidmXmlVersion.V_1_2, context, () -> {\n             try {\n"}}, {"oid": "befce96fabbb5e2f5509645a5f5a86fb78f9504d", "url": "https://github.com/powsybl/powsybl-core/commit/befce96fabbb5e2f5509645a5f5a86fb78f9504d", "message": "Taking into account PR remarks : add default implementation & using DoubleConsumer\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-04T10:51:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzODE4OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1199#discussion_r388138188", "bodyText": "Maybe we should put ratedS close to ratedU?", "author": "mathbagu", "createdAt": "2020-03-05T08:24:01Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ThreeWindingsTransformerAdderImpl.java", "diffHunk": "@@ -137,15 +146,15 @@ public ThreeWindingsTransformerAdderImpl add() {\n             if (legNumber == 1) {\n                 voltageLevel1 = checkAndGetVoltageLevel();\n                 terminal1 = checkAndGetTerminal();\n-                leg1 = new LegImpl(r, x, g, b, ratedU, legNumber);\n+                leg1 = new LegImpl(r, x, g, b, ratedU, legNumber, ratedS);", "originalCommit": "befce96fabbb5e2f5509645a5f5a86fb78f9504d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "938726d8d99f02eb753ef845b484fa5e98ab77ce", "chunk": "diff --git a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ThreeWindingsTransformerAdderImpl.java b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ThreeWindingsTransformerAdderImpl.java\nindex 70f67c338f..baac90aa12 100644\n--- a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ThreeWindingsTransformerAdderImpl.java\n+++ b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ThreeWindingsTransformerAdderImpl.java\n\n@@ -146,15 +146,15 @@ class ThreeWindingsTransformerAdderImpl extends AbstractIdentifiableAdder<ThreeW\n             if (legNumber == 1) {\n                 voltageLevel1 = checkAndGetVoltageLevel();\n                 terminal1 = checkAndGetTerminal();\n-                leg1 = new LegImpl(r, x, g, b, ratedU, legNumber, ratedS);\n+                leg1 = new LegImpl(r, x, g, b, ratedU, ratedS, legNumber);\n             } else if (legNumber == 2) {\n                 voltageLevel2 = checkAndGetVoltageLevel();\n                 terminal2 = checkAndGetTerminal();\n-                leg2 = new LegImpl(r, x, g, b, ratedU, legNumber, ratedS);\n+                leg2 = new LegImpl(r, x, g, b, ratedU, ratedS, legNumber);\n             } else {\n                 voltageLevel3 = checkAndGetVoltageLevel();\n                 terminal3 = checkAndGetTerminal();\n-                leg3 = new LegImpl(r, x, g, b, ratedU, legNumber, ratedS);\n+                leg3 = new LegImpl(r, x, g, b, ratedU, ratedS, legNumber);\n             }\n             return ThreeWindingsTransformerAdderImpl.this;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzOTY2Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1199#discussion_r388139666", "bodyText": "Seems useless to set ratedS to NaN.", "author": "mathbagu", "createdAt": "2020-03-05T08:27:30Z", "path": "iidm/iidm-tck/src/test/java/com/powsybl/iidm/network/tck/AbstractThreeWindingsTransformerTest.java", "diffHunk": "@@ -408,6 +416,17 @@ public void invalidPhaseStepArgumentB() {\n             0.0, 0.0, Double.NaN);\n     }\n \n+    @Test\n+    public void invalidRatedS() {\n+        ThreeWindingsTransformer transformer = createThreeWindingsTransformer();\n+        ThreeWindingsTransformer.Leg leg1 = transformer.getLeg1();\n+        leg1.setRatedS(Double.NaN);", "originalCommit": "befce96fabbb5e2f5509645a5f5a86fb78f9504d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "938726d8d99f02eb753ef845b484fa5e98ab77ce", "chunk": "diff --git a/iidm/iidm-tck/src/test/java/com/powsybl/iidm/network/tck/AbstractThreeWindingsTransformerTest.java b/iidm/iidm-tck/src/test/java/com/powsybl/iidm/network/tck/AbstractThreeWindingsTransformerTest.java\nindex c8d813f812..2a90742893 100644\n--- a/iidm/iidm-tck/src/test/java/com/powsybl/iidm/network/tck/AbstractThreeWindingsTransformerTest.java\n+++ b/iidm/iidm-tck/src/test/java/com/powsybl/iidm/network/tck/AbstractThreeWindingsTransformerTest.java\n\n@@ -420,7 +420,6 @@ public abstract class AbstractThreeWindingsTransformerTest extends AbstractTrans\n     public void invalidRatedS() {\n         ThreeWindingsTransformer transformer = createThreeWindingsTransformer();\n         ThreeWindingsTransformer.Leg leg1 = transformer.getLeg1();\n-        leg1.setRatedS(Double.NaN);\n \n         thrown.expect(ValidationException.class);\n         thrown.expectMessage(\"Invalid value of rated S 0.0\");\n"}}, {"oid": "938726d8d99f02eb753ef845b484fa5e98ab77ce", "url": "https://github.com/powsybl/powsybl-core/commit/938726d8d99f02eb753ef845b484fa5e98ab77ce", "message": "Taking into account PR remarks : clean code\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-03-05T08:41:14Z", "type": "commit"}]}