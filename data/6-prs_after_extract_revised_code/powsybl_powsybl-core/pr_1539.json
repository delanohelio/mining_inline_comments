{"pr_number": 1539, "pr_title": "Dynamic simulation results", "pr_createdAt": "2020-11-04T11:51:06Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1539", "timeline": [{"oid": "22efe577d2ad364e6e27f60135d6bd3fc3b3aec8", "url": "https://github.com/powsybl/powsybl-core/commit/22efe577d2ad364e6e27f60135d6bd3fc3b3aec8", "message": "Save curves and time line outputs\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-03T15:36:03Z", "type": "commit"}, {"oid": "b1a17a92af23d24eafc9cdf6c310a332825929fe", "url": "https://github.com/powsybl/powsybl-core/commit/b1a17a92af23d24eafc9cdf6c310a332825929fe", "message": "fix test\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-03T15:48:21Z", "type": "commit"}, {"oid": "fbc1be4bbe46182209ab7751c38dfafae354a169", "url": "https://github.com/powsybl/powsybl-core/commit/fbc1be4bbe46182209ab7751c38dfafae354a169", "message": "fix test\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-03T15:56:37Z", "type": "commit"}, {"oid": "070c9d7642402d9873feb2edf79d684156fa391b", "url": "https://github.com/powsybl/powsybl-core/commit/070c9d7642402d9873feb2edf79d684156fa391b", "message": "add java doc\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-04T11:04:00Z", "type": "commit"}, {"oid": "0cbc86beaed5964511176acdfbf8cf34fd7380e4", "url": "https://github.com/powsybl/powsybl-core/commit/0cbc86beaed5964511176acdfbf8cf34fd7380e4", "message": "fix checkstyle\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-04T11:23:39Z", "type": "commit"}, {"oid": "74e6a2cccd6628b4fb98f355083aac5541b55052", "url": "https://github.com/powsybl/powsybl-core/commit/74e6a2cccd6628b4fb98f355083aac5541b55052", "message": "add result test\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-04T16:34:33Z", "type": "commit"}, {"oid": "ff2dae7cf322fde12508f2216d34470d25e5b735", "url": "https://github.com/powsybl/powsybl-core/commit/ff2dae7cf322fde12508f2216d34470d25e5b735", "message": "Save TimeLine as a single object of type TimeSeries\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-11-06T11:36:37Z", "type": "commit"}, {"oid": "296d995a38f98728f707c3e490ae0eac6c5bd008", "url": "https://github.com/powsybl/powsybl-core/commit/296d995a38f98728f707c3e490ae0eac6c5bd008", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2020-11-06T11:37:16Z", "type": "commit"}, {"oid": "c629f5b3ee3038ac2242a2c5533187baec4af798", "url": "https://github.com/powsybl/powsybl-core/commit/c629f5b3ee3038ac2242a2c5533187baec4af798", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2020-11-10T12:06:33Z", "type": "commit"}, {"oid": "3fc38f7f51a4a5c01e6ceadf8f8bc5f334b65401", "url": "https://github.com/powsybl/powsybl-core/commit/3fc38f7f51a4a5c01e6ceadf8f8bc5f334b65401", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2020-11-17T15:34:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQxOTg5Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r534419892", "bodyText": "I don't understand the purpose of this time series. Is it a double or a string time series. Could you give an example of what is going to contain?", "author": "geofjamg", "createdAt": "2020-12-02T19:17:50Z", "path": "dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResult.java", "diffHunk": "@@ -14,4 +18,13 @@\n     boolean isOk();\n \n     String getLogs();\n+\n+    Map<String, TimeSeries> getCurves();\n+\n+    TimeSeries getCurve(String curve);\n+\n+    /**\n+     * The Timeline contains information about relevant events that may have happened during the time domain simulation.", "originalCommit": "3fc38f7f51a4a5c01e6ceadf8f8bc5f334b65401", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE1ODc4NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r535158784", "bodyText": "It will be a string time series containing a textual description of events that have been considered relevant during the dynamic simulation. An example from Dynawo output (time is given in milliseconds since the start of the simulation):\n5000\t _BUS____1-BUS____5-1_AC  LINE : opening on side 2\n5000\t GEN____3_SM  PMIN : deactivation\n5248\t CLA_2_5  CLA : arming by over-current constraint\n5405\t GEN____6_SM  PMIN : activation\n10248\t CLA_2_5  CLA : order to change topology\n10248\t _BUS____2-BUS____5-1_AC  LINE : opening both sides", "author": "zamarrenolm", "createdAt": "2020-12-03T11:54:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQxOTg5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI3NjM4MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r535276381", "bodyText": "Ok thanks it is clear now, so maybe we can use StringTimeSeries in the API?", "author": "geofjamg", "createdAt": "2020-12-03T14:33:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQxOTg5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4MjQxMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r535382410", "bodyText": "Done", "author": "marcosmc", "createdAt": "2020-12-03T16:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQxOTg5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b76e9defe38f834014de8c872692022b6266834e", "chunk": "diff --git a/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResult.java b/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResult.java\nindex 5271457628..0ae128a74a 100644\n--- a/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResult.java\n+++ b/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResult.java\n\n@@ -26,5 +27,5 @@ public interface DynamicSimulationResult {\n     /**\n      * The Timeline contains information about relevant events that may have happened during the time domain simulation.\n      */\n-    TimeSeries getTimeLine();\n+    StringTimeSeries getTimeLine();\n }\n"}}, {"oid": "f716d53ce78241c0ae10681938feb735d2941048", "url": "https://github.com/powsybl/powsybl-core/commit/f716d53ce78241c0ae10681938feb735d2941048", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2020-12-03T15:48:10Z", "type": "commit"}, {"oid": "b76e9defe38f834014de8c872692022b6266834e", "url": "https://github.com/powsybl/powsybl-core/commit/b76e9defe38f834014de8c872692022b6266834e", "message": "use StringTimeSeries with TimeLine info\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-12-03T16:10:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIyMjgwMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r538222800", "bodyText": "Could you assert that both curves and timeline are not null? I saw in the unit test that the timeline could be null. Is it possible to create an empty timeline without any entries?", "author": "mathbagu", "createdAt": "2020-12-08T10:33:03Z", "path": "dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResultImpl.java", "diffHunk": "@@ -6,17 +6,27 @@\n  */\n package com.powsybl.dynamicsimulation;\n \n+import java.util.Collections;\n+import java.util.Map;\n+\n+import com.powsybl.timeseries.StringTimeSeries;\n+import com.powsybl.timeseries.TimeSeries;\n+\n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  */\n public class DynamicSimulationResultImpl implements DynamicSimulationResult {\n \n     private final boolean status;\n     private final String logs;\n+    private final Map<String, TimeSeries> curves;\n+    private final StringTimeSeries timeLine;\n \n-    public DynamicSimulationResultImpl(boolean status, String logs) {\n+    public DynamicSimulationResultImpl(boolean status, String logs, Map<String, TimeSeries> curves, StringTimeSeries timeLine) {\n         this.status = status;\n         this.logs = logs;\n+        this.curves = curves;\n+        this.timeLine = timeLine;", "originalCommit": "b76e9defe38f834014de8c872692022b6266834e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzODMwNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r543138306", "bodyText": "Done.", "author": "marcosmc", "createdAt": "2020-12-15T08:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIyMjgwMA=="}], "type": "inlineReview", "revised_code": {"commit": "98b76d75a5345ce90af4fd67854abda02cdbb8e9", "chunk": "diff --git a/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResultImpl.java b/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResultImpl.java\nindex 21faae26d0..e485a614f7 100644\n--- a/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResultImpl.java\n+++ b/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/DynamicSimulationResultImpl.java\n\n@@ -8,6 +8,7 @@ package com.powsybl.dynamicsimulation;\n \n import java.util.Collections;\n import java.util.Map;\n+import java.util.Objects;\n \n import com.powsybl.timeseries.StringTimeSeries;\n import com.powsybl.timeseries.TimeSeries;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIyNDMxOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r538224319", "bodyText": "I don't understand this change: I would expect to serialize the curves and the timeline instead. Maybe it's better than a zip file.\n@zamarrenolm @marcosmc what do you think?", "author": "mathbagu", "createdAt": "2020-12-08T10:34:47Z", "path": "dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/json/DynamicSimulationResultSerializer.java", "diffHunk": "@@ -40,7 +40,6 @@ public void serialize(DynamicSimulationResult result, JsonGenerator jsonGenerato\n         jsonGenerator.writeStartObject();\n         jsonGenerator.writeStringField(\"version\", VERSION);\n         jsonGenerator.writeBooleanField(\"isOK\", result.isOk());\n-        jsonGenerator.writeStringField(\"logs\", result.getLogs());\n         jsonGenerator.writeEndObject();", "originalCommit": "b76e9defe38f834014de8c872692022b6266834e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzODQxMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1539#discussion_r543138410", "bodyText": "Done.", "author": "marcosmc", "createdAt": "2020-12-15T08:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIyNDMxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "98b76d75a5345ce90af4fd67854abda02cdbb8e9", "chunk": "diff --git a/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/json/DynamicSimulationResultSerializer.java b/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/json/DynamicSimulationResultSerializer.java\nindex 383549ef0e..f7474e5383 100644\n--- a/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/json/DynamicSimulationResultSerializer.java\n+++ b/dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/json/DynamicSimulationResultSerializer.java\n\n@@ -34,12 +36,23 @@ public class DynamicSimulationResultSerializer extends StdSerializer<DynamicSimu\n     }\n \n     @Override\n-    public void serialize(DynamicSimulationResult result, JsonGenerator jsonGenerator,\n-        SerializerProvider serializerProvider)\n-        throws IOException {\n+    public void serialize(DynamicSimulationResult result, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException {\n         jsonGenerator.writeStartObject();\n         jsonGenerator.writeStringField(\"version\", VERSION);\n         jsonGenerator.writeBooleanField(\"isOK\", result.isOk());\n+        jsonGenerator.writeStringField(\"logs\", result.getLogs());\n+        jsonGenerator.writeFieldName(\"curves\");\n+        jsonGenerator.writeStartArray();\n+        for (Entry<String, TimeSeries> entry : result.getCurves().entrySet()) {\n+            jsonGenerator.writeStartObject();\n+            jsonGenerator.writeStringField(\"name\", entry.getKey());\n+            jsonGenerator.writeFieldName(\"curve\");\n+            entry.getValue().writeJson(jsonGenerator);\n+            jsonGenerator.writeEndObject();\n+        }\n+        jsonGenerator.writeEndArray();\n+        jsonGenerator.writeFieldName(\"timeLine\");\n+        result.getTimeLine().writeJson(jsonGenerator);\n         jsonGenerator.writeEndObject();\n     }\n \n"}}, {"oid": "98b76d75a5345ce90af4fd67854abda02cdbb8e9", "url": "https://github.com/powsybl/powsybl-core/commit/98b76d75a5345ce90af4fd67854abda02cdbb8e9", "message": "serialize/deserialize curves and timeline\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-12-11T17:31:39Z", "type": "commit"}, {"oid": "51f7f058d8d0f3392b912c316c49e424ce6696b7", "url": "https://github.com/powsybl/powsybl-core/commit/51f7f058d8d0f3392b912c316c49e424ce6696b7", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2020-12-11T17:32:17Z", "type": "commit"}, {"oid": "09250bbfc86f3cecaf2e7f959c1a53608fc113ad", "url": "https://github.com/powsybl/powsybl-core/commit/09250bbfc86f3cecaf2e7f959c1a53608fc113ad", "message": "fix emptyTimeline\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2020-12-15T09:46:50Z", "type": "commit"}, {"oid": "ebd59391b4ed628e255003a1d2bf4bf2405fd7a4", "url": "https://github.com/powsybl/powsybl-core/commit/ebd59391b4ed628e255003a1d2bf4bf2405fd7a4", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2020-12-15T10:09:13Z", "type": "commit"}, {"oid": "9cdf99a6bf13e79c66b7638a1ecee21778dc9d4b", "url": "https://github.com/powsybl/powsybl-core/commit/9cdf99a6bf13e79c66b7638a1ecee21778dc9d4b", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2021-01-14T17:09:33Z", "type": "commit"}, {"oid": "5cb7e44fc6d9c63952608f72782071edc3d44502", "url": "https://github.com/powsybl/powsybl-core/commit/5cb7e44fc6d9c63952608f72782071edc3d44502", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2021-01-18T15:08:28Z", "type": "commit"}, {"oid": "75ce354a368b4ec0cedac832f3d70f124c6be9bd", "url": "https://github.com/powsybl/powsybl-core/commit/75ce354a368b4ec0cedac832f3d70f124c6be9bd", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2021-01-19T08:09:48Z", "type": "commit"}, {"oid": "d144d4401949cea68335b110a59c9f1d3a77dd3b", "url": "https://github.com/powsybl/powsybl-core/commit/d144d4401949cea68335b110a59c9f1d3a77dd3b", "message": "remove redundant info in JSON\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2021-01-19T10:32:10Z", "type": "commit"}, {"oid": "e07db02928f99372149cf14d90b51bb7af6d3ef6", "url": "https://github.com/powsybl/powsybl-core/commit/e07db02928f99372149cf14d90b51bb7af6d3ef6", "message": "fix bug\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>", "committedDate": "2021-01-19T11:25:30Z", "type": "commit"}, {"oid": "d064baa3a6fe6a0815da9e538908c2fd64216dce", "url": "https://github.com/powsybl/powsybl-core/commit/d064baa3a6fe6a0815da9e538908c2fd64216dce", "message": "Merge branch 'master' into dynamic-simulation-output", "committedDate": "2021-01-19T11:38:27Z", "type": "commit"}]}