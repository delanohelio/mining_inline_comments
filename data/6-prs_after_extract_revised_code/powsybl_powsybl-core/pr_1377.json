{"pr_number": 1377, "pr_title": "Implementation of LoadDetail extension (handle fixed and variable part of active and reactive power)", "pr_createdAt": "2020-07-03T08:11:01Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1377", "timeline": [{"oid": "02ed8dddb9196bfbc4858bdb2162055ddcf5f1ff", "url": "https://github.com/powsybl/powsybl-core/commit/02ed8dddb9196bfbc4858bdb2162055ddcf5f1ff", "message": "Implementation of LoadDetail extension (handle fixed and variable part of active and reactive power)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ntmp\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-03T11:47:04Z", "type": "commit"}, {"oid": "5847ea478ba332dcf5eb3bd18ce24ab3bad2f6fa", "url": "https://github.com/powsybl/powsybl-core/commit/5847ea478ba332dcf5eb3bd18ce24ab3bad2f6fa", "message": "Refactor xml serializer of load detail\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-03T11:47:06Z", "type": "commit"}, {"oid": "25d9ff31360573203378ced1e5e37a2789373ade", "url": "https://github.com/powsybl/powsybl-core/commit/25d9ff31360573203378ced1e5e37a2789373ade", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-03T11:47:06Z", "type": "commit"}, {"oid": "25d9ff31360573203378ced1e5e37a2789373ade", "url": "https://github.com/powsybl/powsybl-core/commit/25d9ff31360573203378ced1e5e37a2789373ade", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-03T11:47:06Z", "type": "forcePushed"}, {"oid": "5fe6087df6a5943afb65498966590f5856f690ae", "url": "https://github.com/powsybl/powsybl-core/commit/5fe6087df6a5943afb65498966590f5856f690ae", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-03T12:38:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2MTA1Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1377#discussion_r450061057", "bodyText": "Maybe we should invert the order to read the new attribute in priority.", "author": "mathbagu", "createdAt": "2020-07-06T08:23:37Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/LoadDetailXmlSerializer.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n+import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n+import com.powsybl.commons.xml.XmlReaderContext;\n+import com.powsybl.commons.xml.XmlUtil;\n+import com.powsybl.commons.xml.XmlWriterContext;\n+import com.powsybl.iidm.network.Load;\n+\n+import javax.xml.stream.XMLStreamException;\n+\n+/**\n+ * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n+ */\n+@AutoService(ExtensionXmlSerializer.class)\n+public class LoadDetailXmlSerializer extends AbstractExtensionXmlSerializer<Load, LoadDetail> {\n+\n+    public LoadDetailXmlSerializer() {\n+        super(\"detail\", \"network\", LoadDetail.class,\n+                false, \"loadDetail.xsd\",\n+                \"http://www.itesla_project.eu/schema/iidm/ext/load_detail/1_0\",\n+                \"ld\");\n+    }\n+\n+    @Override\n+    public void write(LoadDetail detail, XmlWriterContext context) throws XMLStreamException {\n+        XmlUtil.writeFloat(\"fixedActivePower\", detail.getFixedActivePower(), context.getExtensionsWriter());\n+        XmlUtil.writeFloat(\"fixedReactivePower\", detail.getFixedReactivePower(), context.getExtensionsWriter());\n+        XmlUtil.writeFloat(\"variableActivePower\", detail.getVariableActivePower(), context.getExtensionsWriter());\n+        XmlUtil.writeFloat(\"variableReactivePower\", detail.getVariableReactivePower(), context.getExtensionsWriter());\n+    }\n+\n+    @Override\n+    public LoadDetail read(Load load, XmlReaderContext context) throws XMLStreamException {\n+        float fixedActivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad1ActivePower\");\n+        if (Float.isNaN(fixedActivePower)) {\n+            fixedActivePower = XmlUtil.readFloatAttribute(context.getReader(), \"fixedActivePower\");\n+        }\n+        float fixedReactivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad1ReactivePower\");\n+        if (Float.isNaN(fixedReactivePower)) {\n+            fixedReactivePower = XmlUtil.readFloatAttribute(context.getReader(), \"fixedReactivePower\");\n+        }\n+        float variableActivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad2ActivePower\");\n+        if (Float.isNaN(variableActivePower)) {\n+            variableActivePower = XmlUtil.readFloatAttribute(context.getReader(), \"variableActivePower\");\n+        }\n+        float variableReactivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad2ReactivePower\");\n+        if (Float.isNaN(variableReactivePower)) {\n+            variableReactivePower = XmlUtil.readFloatAttribute(context.getReader(), \"variableReactivePower\");\n+        }", "originalCommit": "5fe6087df6a5943afb65498966590f5856f690ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NDM5MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1377#discussion_r450064391", "bodyText": "I agree. Changing that and then I will merge it.", "author": "miovd", "createdAt": "2020-07-06T08:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2MTA1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "85ebc53a5f86795002e52a27c8229879f9977822", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/LoadDetailXmlSerializer.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/LoadDetailXmlSerializer.java\nindex 244cf8b222..54f93c7348 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/LoadDetailXmlSerializer.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/LoadDetailXmlSerializer.java\n\n@@ -38,22 +38,22 @@ public class LoadDetailXmlSerializer extends AbstractExtensionXmlSerializer<Load\n     }\n \n     @Override\n-    public LoadDetail read(Load load, XmlReaderContext context) throws XMLStreamException {\n-        float fixedActivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad1ActivePower\");\n+    public LoadDetail read(Load load, XmlReaderContext context) {\n+        float fixedActivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"fixedActivePower\");\n         if (Float.isNaN(fixedActivePower)) {\n-            fixedActivePower = XmlUtil.readFloatAttribute(context.getReader(), \"fixedActivePower\");\n+            fixedActivePower = XmlUtil.readFloatAttribute(context.getReader(), \"subLoad1ActivePower\");\n         }\n-        float fixedReactivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad1ReactivePower\");\n+        float fixedReactivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"fixedReactivePower\");\n         if (Float.isNaN(fixedReactivePower)) {\n-            fixedReactivePower = XmlUtil.readFloatAttribute(context.getReader(), \"fixedReactivePower\");\n+            fixedReactivePower = XmlUtil.readFloatAttribute(context.getReader(), \"subLoad1ReactivePower\");\n         }\n-        float variableActivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad2ActivePower\");\n+        float variableActivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"variableActivePower\");\n         if (Float.isNaN(variableActivePower)) {\n-            variableActivePower = XmlUtil.readFloatAttribute(context.getReader(), \"variableActivePower\");\n+            variableActivePower = XmlUtil.readFloatAttribute(context.getReader(), \"subLoad2ActivePower\");\n         }\n-        float variableReactivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"subLoad2ReactivePower\");\n+        float variableReactivePower = XmlUtil.readOptionalFloatAttribute(context.getReader(), \"variableReactivePower\");\n         if (Float.isNaN(variableReactivePower)) {\n-            variableReactivePower = XmlUtil.readFloatAttribute(context.getReader(), \"variableReactivePower\");\n+            variableReactivePower = XmlUtil.readFloatAttribute(context.getReader(), \"subLoad2ReactivePower\");\n         }\n         load.newExtension(LoadDetailAdder.class)\n                 .withFixedActivePower(fixedActivePower)\n"}}, {"oid": "85ebc53a5f86795002e52a27c8229879f9977822", "url": "https://github.com/powsybl/powsybl-core/commit/85ebc53a5f86795002e52a27c8229879f9977822", "message": "Read new LoadDetail attributes in priority\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-06T08:38:53Z", "type": "commit"}]}