{"pr_number": 1381, "pr_title": "Slackbus extension: interface and implementation", "pr_createdAt": "2020-07-06T13:05:30Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1381", "timeline": [{"oid": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "url": "https://github.com/powsybl/powsybl-core/commit/3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "message": "Slackbus extension: interface and implementation\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-06T13:35:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NDYwMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450674602", "bodyText": "Should be private", "author": "mathbagu", "createdAt": "2020-07-07T07:50:32Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n+\n+    static final int NODE_UNINITIALIZED = -1;", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\nindex ef75c6189..711dc0389 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n\n@@ -1,25 +1,35 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n package com.powsybl.iidm.network.extensions;\n \n+import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n \n-    static final int NODE_UNINITIALIZED = -1;\n-\n     private String busId;\n-    private int node = NODE_UNINITIALIZED;\n+    private OptionalInt node;\n \n     public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n         super(voltageLevel);\n+        this.node = OptionalInt.empty();\n     }\n \n     @Override\n     public SlackBusAdder setNode(int node) {\n-        this.node = node;\n+        this.node = OptionalInt.of(node);\n         return this;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NDgwMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450674802", "bodyText": "return from here", "author": "mathbagu", "createdAt": "2020-07-07T07:50:55Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n+\n+    static final int NODE_UNINITIALIZED = -1;\n+\n+    private String busId;\n+    private int node = NODE_UNINITIALIZED;\n+\n+    public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n+        super(voltageLevel);\n+    }\n+\n+    @Override\n+    public SlackBusAdder setNode(int node) {\n+        this.node = node;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackBusAdder setBusId(String busId) {\n+        this.busId = busId;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackBusImpl createExtension(VoltageLevel voltageLevel) {\n+        SlackBusImpl slackBus;\n+        switch (voltageLevel.getTopologyKind()) {\n+            case NODE_BREAKER:\n+                slackBus = new SlackBusImpl(node, voltageLevel);", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\nindex ef75c6189..711dc0389 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n\n@@ -1,25 +1,35 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n package com.powsybl.iidm.network.extensions;\n \n+import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n \n-    static final int NODE_UNINITIALIZED = -1;\n-\n     private String busId;\n-    private int node = NODE_UNINITIALIZED;\n+    private OptionalInt node;\n \n     public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n         super(voltageLevel);\n+        this.node = OptionalInt.empty();\n     }\n \n     @Override\n     public SlackBusAdder setNode(int node) {\n-        this.node = node;\n+        this.node = OptionalInt.of(node);\n         return this;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NDg3Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450674876", "bodyText": "return from here", "author": "mathbagu", "createdAt": "2020-07-07T07:51:02Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n+\n+    static final int NODE_UNINITIALIZED = -1;\n+\n+    private String busId;\n+    private int node = NODE_UNINITIALIZED;\n+\n+    public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n+        super(voltageLevel);\n+    }\n+\n+    @Override\n+    public SlackBusAdder setNode(int node) {\n+        this.node = node;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackBusAdder setBusId(String busId) {\n+        this.busId = busId;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackBusImpl createExtension(VoltageLevel voltageLevel) {\n+        SlackBusImpl slackBus;\n+        switch (voltageLevel.getTopologyKind()) {\n+            case NODE_BREAKER:\n+                slackBus = new SlackBusImpl(node, voltageLevel);\n+                break;\n+            case BUS_BREAKER:\n+                slackBus = new SlackBusImpl(busId, voltageLevel);", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\nindex ef75c6189..711dc0389 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n\n@@ -1,25 +1,35 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n package com.powsybl.iidm.network.extensions;\n \n+import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n \n-    static final int NODE_UNINITIALIZED = -1;\n-\n     private String busId;\n-    private int node = NODE_UNINITIALIZED;\n+    private OptionalInt node;\n \n     public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n         super(voltageLevel);\n+        this.node = OptionalInt.empty();\n     }\n \n     @Override\n     public SlackBusAdder setNode(int node) {\n-        this.node = node;\n+        this.node = OptionalInt.of(node);\n         return this;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NTAwOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450675009", "bodyText": "Add a message in this exception", "author": "mathbagu", "createdAt": "2020-07-07T07:51:17Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n+\n+    static final int NODE_UNINITIALIZED = -1;\n+\n+    private String busId;\n+    private int node = NODE_UNINITIALIZED;\n+\n+    public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n+        super(voltageLevel);\n+    }\n+\n+    @Override\n+    public SlackBusAdder setNode(int node) {\n+        this.node = node;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackBusAdder setBusId(String busId) {\n+        this.busId = busId;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackBusImpl createExtension(VoltageLevel voltageLevel) {\n+        SlackBusImpl slackBus;\n+        switch (voltageLevel.getTopologyKind()) {\n+            case NODE_BREAKER:\n+                slackBus = new SlackBusImpl(node, voltageLevel);\n+                break;\n+            case BUS_BREAKER:\n+                slackBus = new SlackBusImpl(busId, voltageLevel);\n+                break;\n+            default:\n+                throw new AssertionError();", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\nindex ef75c6189..711dc0389 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n\n@@ -1,25 +1,35 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n package com.powsybl.iidm.network.extensions;\n \n+import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n \n-    static final int NODE_UNINITIALIZED = -1;\n-\n     private String busId;\n-    private int node = NODE_UNINITIALIZED;\n+    private OptionalInt node;\n \n     public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n         super(voltageLevel);\n+        this.node = OptionalInt.empty();\n     }\n \n     @Override\n     public SlackBusAdder setNode(int node) {\n-        this.node = node;\n+        this.node = OptionalInt.of(node);\n         return this;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NTA5MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450675091", "bodyText": "Add missing license header", "author": "mathbagu", "createdAt": "2020-07-07T07:51:27Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package com.powsybl.iidm.network.extensions;", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java\ndeleted file mode 100644\nindex 7f9261699..000000000\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java\n+++ /dev/null\n\n@@ -1,102 +0,0 @@\n-package com.powsybl.iidm.network.extensions;\n-\n-import com.powsybl.commons.PowsyblException;\n-import com.powsybl.commons.extensions.AbstractExtension;\n-import com.powsybl.iidm.network.Bus;\n-import com.powsybl.iidm.network.Terminal;\n-import com.powsybl.iidm.network.VoltageLevel;\n-\n-/**\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public class SlackBusImpl extends AbstractExtension<VoltageLevel> implements SlackBus {\n-\n-    private final NodeBreakerViewImpl nodeBreakerView;\n-    private final BusBreakerViewImpl busBreakerView;\n-    private final BusViewImpl busView;\n-\n-    private static final class NodeBreakerViewImpl implements SlackBus.NodeBreakerView {\n-        private final int node;\n-\n-        public NodeBreakerViewImpl(int node) {\n-            this.node = node;\n-        }\n-\n-        @Override\n-        public int getNode() {\n-            return this.node;\n-        }\n-    }\n-\n-    private static final class BusBreakerViewImpl implements SlackBus.BusBreakerView {\n-        private final Bus bus;\n-\n-        public BusBreakerViewImpl(Bus busBusBreakerView) {\n-            this.bus = busBusBreakerView;\n-        }\n-\n-        @Override\n-        public Bus getBus() {\n-            return this.bus;\n-        }\n-    }\n-\n-    private static final class BusViewImpl implements SlackBus.BusView {\n-        private final Bus bus;\n-\n-        private BusViewImpl(Bus busBusView) {\n-            this.bus = busBusView;\n-        }\n-\n-        @Override\n-        public Bus getBus() {\n-            return this.bus;\n-        }\n-    }\n-\n-    SlackBusImpl(String busId, VoltageLevel vl) {\n-        super(vl);\n-        if (busId == null) {\n-            throw new PowsyblException(\"busId needs to be set for a SlackBus in VoltageLevel.BusBreakerView\");\n-        }\n-        Bus busBusBreakerView = vl.getBusBreakerView().getBus(busId);\n-        Bus busBusView = vl.getBusView().getMergedBus(busId);\n-        this.nodeBreakerView = null;\n-        this.busBreakerView = new BusBreakerViewImpl(busBusBreakerView);\n-        this.busView = new BusViewImpl(busBusView);\n-    }\n-\n-    SlackBusImpl(int node, VoltageLevel vl) {\n-        super(vl);\n-        if (node == SlackBusAdderImpl.NODE_UNINITIALIZED) {\n-            throw new PowsyblException(\"node needs to be set for a SlackBus in VoltageLevel.NodeBreakerView\");\n-        }\n-        Terminal terminal = vl.getNodeBreakerView().getOptionalTerminal(node).get();\n-        Bus busBusBreakerView = terminal.getBusBreakerView().getBus();\n-        Bus busBusView = terminal.getBusView().getBus();\n-        this.busBreakerView = new BusBreakerViewImpl(busBusBreakerView);\n-        this.nodeBreakerView = new NodeBreakerViewImpl(node);\n-        this.busView = new BusViewImpl(busBusView);\n-    }\n-\n-    @Override\n-    public Bus get() {\n-        return busView.getBus();\n-    }\n-\n-    @Override\n-    public NodeBreakerView getNodeBreakerView() {\n-        return nodeBreakerView;\n-    }\n-\n-    @Override\n-    public BusBreakerView getBusBreakerView() {\n-        return busBreakerView;\n-    }\n-\n-    @Override\n-    public BusView getBusView() {\n-        return busView;\n-    }\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NTE2Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450675167", "bodyText": "Add missing license header", "author": "mathbagu", "createdAt": "2020-07-07T07:51:35Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.powsybl.iidm.network.extensions;", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\nindex ef75c6189..711dc0389 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n\n@@ -1,25 +1,35 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n package com.powsybl.iidm.network.extensions;\n \n+import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n \n-    static final int NODE_UNINITIALIZED = -1;\n-\n     private String busId;\n-    private int node = NODE_UNINITIALIZED;\n+    private OptionalInt node;\n \n     public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n         super(voltageLevel);\n+        this.node = OptionalInt.empty();\n     }\n \n     @Override\n     public SlackBusAdder setNode(int node) {\n-        this.node = node;\n+        this.node = OptionalInt.of(node);\n         return this;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NTY0NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450675645", "bodyText": "Fix copyright date", "author": "mathbagu", "createdAt": "2020-07-07T07:52:35Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusXmlSerializer.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2018, RTE (http://www.rte-france.com)", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusXmlSerializer.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusXmlSerializer.java\nindex 6af3df725..49a2a2eb2 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusXmlSerializer.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusXmlSerializer.java\n\n@@ -1,5 +1,5 @@\n /**\n- * Copyright (c) 2018, RTE (http://www.rte-france.com)\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n  * This Source Code Form is subject to the terms of the Mozilla Public\n  * License, v. 2.0. If a copy of the MPL was not distributed with this\n  * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3ODEzOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450678139", "bodyText": "I think it's not necessary to prefix the return type with SlackBus", "author": "mathbagu", "createdAt": "2020-07-07T07:57:12Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.Extension;\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public interface SlackBus extends Extension<VoltageLevel> {\n+\n+    @Override\n+    default String getName() {\n+        return \"slackBus\";\n+    }\n+\n+    interface NodeBreakerView {\n+        int getNode();\n+    }\n+\n+    interface BusBreakerView {\n+        Bus getBus();\n+    }\n+\n+    interface BusView {\n+        Bus getBus();\n+    }\n+\n+    Bus get();\n+\n+    SlackBus.NodeBreakerView getNodeBreakerView();", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java\nindex f24e9ca54..22f2d898f 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java\n\n@@ -32,11 +32,17 @@ public interface SlackBus extends Extension<VoltageLevel> {\n         Bus getBus();\n     }\n \n-    Bus get();\n+    /**\n+     * Shortcut to getBusView().getBus()\n+     * @return the corresponding bus in the bus view\n+     */\n+    default Bus get() {\n+        return getBusView().getBus();\n+    }\n \n-    SlackBus.NodeBreakerView getNodeBreakerView();\n+    NodeBreakerView getNodeBreakerView();\n \n-    SlackBus.BusBreakerView getBusBreakerView();\n+    BusBreakerView getBusBreakerView();\n \n-    SlackBus.BusView getBusView();\n+    BusView getBusView();\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3ODU4Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450678587", "bodyText": "Add javadoc to explain this is a shortcut to getBusView().getBus()", "author": "mathbagu", "createdAt": "2020-07-07T07:57:56Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.Extension;\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public interface SlackBus extends Extension<VoltageLevel> {\n+\n+    @Override\n+    default String getName() {\n+        return \"slackBus\";\n+    }\n+\n+    interface NodeBreakerView {\n+        int getNode();\n+    }\n+\n+    interface BusBreakerView {\n+        Bus getBus();\n+    }\n+\n+    interface BusView {\n+        Bus getBus();\n+    }\n+\n+    Bus get();", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java\nindex f24e9ca54..22f2d898f 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBus.java\n\n@@ -32,11 +32,17 @@ public interface SlackBus extends Extension<VoltageLevel> {\n         Bus getBus();\n     }\n \n-    Bus get();\n+    /**\n+     * Shortcut to getBusView().getBus()\n+     * @return the corresponding bus in the bus view\n+     */\n+    default Bus get() {\n+        return getBusView().getBus();\n+    }\n \n-    SlackBus.NodeBreakerView getNodeBreakerView();\n+    NodeBreakerView getNodeBreakerView();\n \n-    SlackBus.BusBreakerView getBusBreakerView();\n+    BusBreakerView getBusBreakerView();\n \n-    SlackBus.BusView getBusView();\n+    BusView getBusView();\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY4MDQ1Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r450680453", "bodyText": "This is a really bad idea to store the bus in the view: in a Node/Breaker Voltage level, these buses are calculated automatically, so new buses will be created when the topology changes. For Bus/Breaker Voltage Level, the bus of the bus/breaker view is configured, so it could be OK to keep it, but it's not for the bus view.", "author": "mathbagu", "createdAt": "2020-07-07T08:01:28Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.extensions.AbstractExtension;\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackBusImpl extends AbstractExtension<VoltageLevel> implements SlackBus {\n+\n+    private final NodeBreakerViewImpl nodeBreakerView;\n+    private final BusBreakerViewImpl busBreakerView;\n+    private final BusViewImpl busView;\n+\n+    private static final class NodeBreakerViewImpl implements SlackBus.NodeBreakerView {\n+        private final int node;\n+\n+        public NodeBreakerViewImpl(int node) {\n+            this.node = node;\n+        }\n+\n+        @Override\n+        public int getNode() {\n+            return this.node;\n+        }\n+    }\n+\n+    private static final class BusBreakerViewImpl implements SlackBus.BusBreakerView {\n+        private final Bus bus;\n+\n+        public BusBreakerViewImpl(Bus busBusBreakerView) {\n+            this.bus = busBusBreakerView;\n+        }\n+\n+        @Override\n+        public Bus getBus() {\n+            return this.bus;\n+        }\n+    }\n+\n+    private static final class BusViewImpl implements SlackBus.BusView {\n+        private final Bus bus;\n+\n+        private BusViewImpl(Bus busBusView) {\n+            this.bus = busBusView;\n+        }\n+\n+        @Override\n+        public Bus getBus() {\n+            return this.bus;\n+        }\n+    }\n+\n+    SlackBusImpl(String busId, VoltageLevel vl) {\n+        super(vl);\n+        if (busId == null) {\n+            throw new PowsyblException(\"busId needs to be set for a SlackBus in VoltageLevel.BusBreakerView\");\n+        }\n+        Bus busBusBreakerView = vl.getBusBreakerView().getBus(busId);\n+        Bus busBusView = vl.getBusView().getMergedBus(busId);\n+        this.nodeBreakerView = null;\n+        this.busBreakerView = new BusBreakerViewImpl(busBusBreakerView);\n+        this.busView = new BusViewImpl(busBusView);\n+    }\n+\n+    SlackBusImpl(int node, VoltageLevel vl) {\n+        super(vl);\n+        if (node == SlackBusAdderImpl.NODE_UNINITIALIZED) {\n+            throw new PowsyblException(\"node needs to be set for a SlackBus in VoltageLevel.NodeBreakerView\");\n+        }\n+        Terminal terminal = vl.getNodeBreakerView().getOptionalTerminal(node).get();\n+        Bus busBusBreakerView = terminal.getBusBreakerView().getBus();\n+        Bus busBusView = terminal.getBusView().getBus();\n+        this.busBreakerView = new BusBreakerViewImpl(busBusBreakerView);\n+        this.nodeBreakerView = new NodeBreakerViewImpl(node);\n+        this.busView = new BusViewImpl(busBusView);", "originalCommit": "3f98918166ca2d4f0bb794be9e2cd08d037dbb62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java\ndeleted file mode 100644\nindex 7f9261699..000000000\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusImpl.java\n+++ /dev/null\n\n@@ -1,102 +0,0 @@\n-package com.powsybl.iidm.network.extensions;\n-\n-import com.powsybl.commons.PowsyblException;\n-import com.powsybl.commons.extensions.AbstractExtension;\n-import com.powsybl.iidm.network.Bus;\n-import com.powsybl.iidm.network.Terminal;\n-import com.powsybl.iidm.network.VoltageLevel;\n-\n-/**\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public class SlackBusImpl extends AbstractExtension<VoltageLevel> implements SlackBus {\n-\n-    private final NodeBreakerViewImpl nodeBreakerView;\n-    private final BusBreakerViewImpl busBreakerView;\n-    private final BusViewImpl busView;\n-\n-    private static final class NodeBreakerViewImpl implements SlackBus.NodeBreakerView {\n-        private final int node;\n-\n-        public NodeBreakerViewImpl(int node) {\n-            this.node = node;\n-        }\n-\n-        @Override\n-        public int getNode() {\n-            return this.node;\n-        }\n-    }\n-\n-    private static final class BusBreakerViewImpl implements SlackBus.BusBreakerView {\n-        private final Bus bus;\n-\n-        public BusBreakerViewImpl(Bus busBusBreakerView) {\n-            this.bus = busBusBreakerView;\n-        }\n-\n-        @Override\n-        public Bus getBus() {\n-            return this.bus;\n-        }\n-    }\n-\n-    private static final class BusViewImpl implements SlackBus.BusView {\n-        private final Bus bus;\n-\n-        private BusViewImpl(Bus busBusView) {\n-            this.bus = busBusView;\n-        }\n-\n-        @Override\n-        public Bus getBus() {\n-            return this.bus;\n-        }\n-    }\n-\n-    SlackBusImpl(String busId, VoltageLevel vl) {\n-        super(vl);\n-        if (busId == null) {\n-            throw new PowsyblException(\"busId needs to be set for a SlackBus in VoltageLevel.BusBreakerView\");\n-        }\n-        Bus busBusBreakerView = vl.getBusBreakerView().getBus(busId);\n-        Bus busBusView = vl.getBusView().getMergedBus(busId);\n-        this.nodeBreakerView = null;\n-        this.busBreakerView = new BusBreakerViewImpl(busBusBreakerView);\n-        this.busView = new BusViewImpl(busBusView);\n-    }\n-\n-    SlackBusImpl(int node, VoltageLevel vl) {\n-        super(vl);\n-        if (node == SlackBusAdderImpl.NODE_UNINITIALIZED) {\n-            throw new PowsyblException(\"node needs to be set for a SlackBus in VoltageLevel.NodeBreakerView\");\n-        }\n-        Terminal terminal = vl.getNodeBreakerView().getOptionalTerminal(node).get();\n-        Bus busBusBreakerView = terminal.getBusBreakerView().getBus();\n-        Bus busBusView = terminal.getBusView().getBus();\n-        this.busBreakerView = new BusBreakerViewImpl(busBusBreakerView);\n-        this.nodeBreakerView = new NodeBreakerViewImpl(node);\n-        this.busView = new BusViewImpl(busBusView);\n-    }\n-\n-    @Override\n-    public Bus get() {\n-        return busView.getBus();\n-    }\n-\n-    @Override\n-    public NodeBreakerView getNodeBreakerView() {\n-        return nodeBreakerView;\n-    }\n-\n-    @Override\n-    public BusBreakerView getBusBreakerView() {\n-        return busBreakerView;\n-    }\n-\n-    @Override\n-    public BusView getBusView() {\n-        return busView;\n-    }\n-\n-}\n"}}, {"oid": "e4a20274c079a39a22a3cd94db87dc5e420d9014", "url": "https://github.com/powsybl/powsybl-core/commit/e4a20274c079a39a22a3cd94db87dc5e420d9014", "message": "SlackBusAdder: OptionalInt node to avoid the unitialized constant\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-07T11:31:34Z", "type": "forcePushed"}, {"oid": "f8e70fe0f36f1f02c21e390499244355a4ca3361", "url": "https://github.com/powsybl/powsybl-core/commit/f8e70fe0f36f1f02c21e390499244355a4ca3361", "message": "SlackBusAdder: OptionalInt node to avoid the unitialized constant\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-07T11:47:46Z", "type": "forcePushed"}, {"oid": "948e5ad390105e97b14a366628d64db2e2e40dad", "url": "https://github.com/powsybl/powsybl-core/commit/948e5ad390105e97b14a366628d64db2e2e40dad", "message": "SlackBusAdder: OptionalInt node to avoid the unitialized constant\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-07T12:18:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2MDkyMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r451160921", "bodyText": "Optional as a class attribute is often not recommended (https://stackoverflow.com/questions/29033518/is-it-a-good-practice-to-use-optional-as-an-attribute-in-a-class)", "author": "geofjamg", "createdAt": "2020-07-07T21:43:14Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+import java.util.OptionalInt;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n+\n+    private String busId;\n+    private OptionalInt node;", "originalCommit": "948e5ad390105e97b14a366628d64db2e2e40dad", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "739b52d66d9228a25c504058d4f58b5d1c4cb1ef", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdderImpl.java\nsimilarity index 53%\nrename from iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\nrename to iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdderImpl.java\nindex 52698299e..1a21e0064 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackBusAdderImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdderImpl.java\n\n@@ -8,49 +8,47 @@ package com.powsybl.iidm.network.extensions;\n \n import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtensionAdder;\n-import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n-import java.util.OptionalInt;\n-\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n-public class SlackBusAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackBus> implements SlackBusAdder {\n+public class SlackTerminalAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackTerminal> implements SlackTerminalAdder {\n+\n+    private static final int NODE_UNINITIALIZED = -1;\n \n     private String busId;\n-    private OptionalInt node;\n+    private int node = NODE_UNINITIALIZED;\n \n-    public SlackBusAdderImpl(VoltageLevel voltageLevel) {\n+    public SlackTerminalAdderImpl(VoltageLevel voltageLevel) {\n         super(voltageLevel);\n-        this.node = OptionalInt.empty();\n     }\n \n     @Override\n-    public SlackBusAdder setNode(int node) {\n-        this.node = OptionalInt.of(node);\n+    public SlackTerminalAdder setNode(int node) {\n+        this.node = node;\n         return this;\n     }\n \n     @Override\n-    public SlackBusAdder setBusId(String busId) {\n+    public SlackTerminalAdder setBusId(String busId) {\n         this.busId = busId;\n         return this;\n     }\n \n     @Override\n-    public SlackBus createExtension(VoltageLevel voltageLevel) {\n+    public SlackTerminal createExtension(VoltageLevel voltageLevel) {\n         switch (voltageLevel.getTopologyKind()) {\n             case NODE_BREAKER:\n-                int nodeValue = node.orElseThrow(() -> new PowsyblException(\"Node needs to be set for a SlackBus in VoltageLevel.NodeBreakerView\"));\n-                Terminal terminal = voltageLevel.getNodeBreakerView().getOptionalTerminal(nodeValue)\n-                    .orElseThrow(() -> new PowsyblException(\"The given slackBus node lacks a terminal\"));\n-                return new SlackBusNodeBreakerImpl(terminal, voltageLevel);\n+                if (node == NODE_UNINITIALIZED) {\n+                    throw new PowsyblException(\"Node needs to be set for a SlackBus in VoltageLevel.NodeBreakerView\");\n+                }\n+                return new SlackTerminalNodeBreakerImpl(node, voltageLevel);\n             case BUS_BREAKER:\n                 if (busId == null) {\n                     throw new PowsyblException(\"BusId needs to be set for a SlackBus in VoltageLevel.BusBreakerView\");\n                 }\n-                return new SlackBusBusBreakerImpl(busId, voltageLevel);\n+                return new SlackTerminalBusBreakerImpl(busId, voltageLevel);\n             default:\n                 throw new AssertionError(\"Unexpected TopologyKind of given voltageLevel: \"\n                     + voltageLevel.getTopologyKind());\n"}}, {"oid": "739b52d66d9228a25c504058d4f58b5d1c4cb1ef", "url": "https://github.com/powsybl/powsybl-core/commit/739b52d66d9228a25c504058d4f58b5d1c4cb1ef", "message": "Switching from SlackBus to SlackTerminal\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-13T15:58:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0MzAzNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r454943034", "bodyText": "This extension should inherit from AbstractMultiVariantConnectableExtension because the slack bus could depend from the variant.", "author": "mathbagu", "createdAt": "2020-07-15T10:12:05Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalNodeBreakerImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.extensions.AbstractExtension;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackTerminalNodeBreakerImpl extends AbstractExtension<VoltageLevel> implements SlackTerminal {", "originalCommit": "35c6d6f0b203dd49cd85cffd2f944a89ffd48e8d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d653c932ac5e8c7414a2b7af8ce09cb8ad6ec5e2", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalNodeBreakerImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalImpl.java\nsimilarity index 51%\nrename from iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalNodeBreakerImpl.java\nrename to iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalImpl.java\nindex 11558ba7f..1a04c3707 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalNodeBreakerImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalImpl.java\n\n@@ -6,7 +6,6 @@\n  */\n package com.powsybl.iidm.network.extensions;\n \n-import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtension;\n import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxMjAxNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r455312016", "bodyText": "I think this utility function already exists somewhere in iidm xml converter module.", "author": "geofjamg", "createdAt": "2020-07-15T20:09:04Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n+import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n+import com.powsybl.commons.xml.XmlReaderContext;\n+import com.powsybl.commons.xml.XmlWriterContext;\n+import com.powsybl.iidm.network.*;\n+\n+import javax.xml.stream.XMLStreamException;\n+import javax.xml.stream.XMLStreamWriter;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+@AutoService(ExtensionXmlSerializer.class)\n+public class SlackTerminalXmlSerializer extends AbstractExtensionXmlSerializer<VoltageLevel, SlackTerminal> {\n+\n+    public SlackTerminalXmlSerializer() {\n+        super(\"slackTerminal\", \"network\", SlackTerminal.class, false, \"slackTerminal.xsd\",\n+            \"http://www.powsybl.org/schema/iidm/ext/slack_bus/1_0\", \"slt\");\n+    }\n+\n+    @Override\n+    public void write(SlackTerminal slackTerminal, XmlWriterContext context) throws XMLStreamException {\n+        writeTerminalRef(slackTerminal.getTerminal(), context.getExtensionsWriter());\n+    }\n+\n+    @Override\n+    public SlackTerminal read(VoltageLevel voltageLevel, XmlReaderContext context) {\n+        Terminal terminal = readTerminalRef(voltageLevel.getNetwork(), context);\n+        if (terminal != null) {\n+            voltageLevel.newExtension(SlackTerminalAdder.class)\n+                .setTerminal(terminal)\n+                .add();\n+            return voltageLevel.getExtension(SlackTerminalAdder.class);\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    public static void writeTerminalRef(Terminal t, XMLStreamWriter writer) throws XMLStreamException {", "originalCommit": "08923ffa7beb9c5f883b946991cdb235fbf6ef82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2NjcxNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r455666715", "bodyText": "Indeed, in TerminalRefXml. A minor issue blocked the refactoring in the commit so far, but it is in progress!", "author": "flo-dup", "createdAt": "2020-07-16T09:53:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxMjAxNg=="}], "type": "inlineReview", "revised_code": {"commit": "d653c932ac5e8c7414a2b7af8ce09cb8ad6ec5e2", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java\nindex 45aa92f81..b377c1147 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java\n\n@@ -39,7 +39,7 @@ public class SlackTerminalXmlSerializer extends AbstractExtensionXmlSerializer<V\n             voltageLevel.newExtension(SlackTerminalAdder.class)\n                 .setTerminal(terminal)\n                 .add();\n-            return voltageLevel.getExtension(SlackTerminalAdder.class);\n+            return voltageLevel.getExtension(SlackTerminal.class);\n         } else {\n             return null;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxMjExNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r455312116", "bodyText": "Same", "author": "geofjamg", "createdAt": "2020-07-15T20:09:16Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n+import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n+import com.powsybl.commons.xml.XmlReaderContext;\n+import com.powsybl.commons.xml.XmlWriterContext;\n+import com.powsybl.iidm.network.*;\n+\n+import javax.xml.stream.XMLStreamException;\n+import javax.xml.stream.XMLStreamWriter;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+@AutoService(ExtensionXmlSerializer.class)\n+public class SlackTerminalXmlSerializer extends AbstractExtensionXmlSerializer<VoltageLevel, SlackTerminal> {\n+\n+    public SlackTerminalXmlSerializer() {\n+        super(\"slackTerminal\", \"network\", SlackTerminal.class, false, \"slackTerminal.xsd\",\n+            \"http://www.powsybl.org/schema/iidm/ext/slack_bus/1_0\", \"slt\");\n+    }\n+\n+    @Override\n+    public void write(SlackTerminal slackTerminal, XmlWriterContext context) throws XMLStreamException {\n+        writeTerminalRef(slackTerminal.getTerminal(), context.getExtensionsWriter());\n+    }\n+\n+    @Override\n+    public SlackTerminal read(VoltageLevel voltageLevel, XmlReaderContext context) {\n+        Terminal terminal = readTerminalRef(voltageLevel.getNetwork(), context);\n+        if (terminal != null) {\n+            voltageLevel.newExtension(SlackTerminalAdder.class)\n+                .setTerminal(terminal)\n+                .add();\n+            return voltageLevel.getExtension(SlackTerminalAdder.class);\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    public static void writeTerminalRef(Terminal t, XMLStreamWriter writer) throws XMLStreamException {\n+        Connectable c = t.getConnectable();\n+        writer.writeAttribute(\"connectableId\", c.getId());\n+        if (c.getTerminals().size() > 1) {\n+            if (c instanceof Injection) {\n+                // nothing to do\n+            } else if (c instanceof Branch) {\n+                Branch branch = (Branch) c;\n+                writer.writeAttribute(\"side\", branch.getSide(t).name());\n+            } else if (c instanceof ThreeWindingsTransformer) {\n+                ThreeWindingsTransformer twt = (ThreeWindingsTransformer) c;\n+                writer.writeAttribute(\"side\", twt.getSide(t).name());\n+            } else {\n+                throw new AssertionError(\"Unexpected Connectable instance: \" + c.getClass());\n+            }\n+        }\n+    }\n+\n+    public static Terminal readTerminalRef(Network network, XmlReaderContext context) {", "originalCommit": "08923ffa7beb9c5f883b946991cdb235fbf6ef82", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d653c932ac5e8c7414a2b7af8ce09cb8ad6ec5e2", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java\nindex 45aa92f81..b377c1147 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalXmlSerializer.java\n\n@@ -39,7 +39,7 @@ public class SlackTerminalXmlSerializer extends AbstractExtensionXmlSerializer<V\n             voltageLevel.newExtension(SlackTerminalAdder.class)\n                 .setTerminal(terminal)\n                 .add();\n-            return voltageLevel.getExtension(SlackTerminalAdder.class);\n+            return voltageLevel.getExtension(SlackTerminal.class);\n         } else {\n             return null;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxMjk5Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r455312997", "bodyText": "This is an arbitrary choice to return the bus view bus and doc does not really help.\nI would just remove it and force the user to explictly choose the view.", "author": "geofjamg", "createdAt": "2020-07-15T20:10:50Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.Extension;\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public interface SlackTerminal extends Extension<VoltageLevel> {\n+\n+    @Override\n+    default String getName() {\n+        return \"slackTerminal\";\n+    }\n+\n+    /**\n+     * Get the terminal pointed by the current SlackTerminal\n+     * @return the corresponding terminal\n+     */\n+    Terminal getTerminal();\n+\n+    /**\n+     * Shortcut to getTerminal().getBusView().getBus()\n+     * @return the corresponding bus in the bus view\n+     */\n+    default Bus getBus() {", "originalCommit": "08923ffa7beb9c5f883b946991cdb235fbf6ef82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2MzU4MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r455663580", "bodyText": "Removed.", "author": "flo-dup", "createdAt": "2020-07-16T09:47:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxMjk5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "d653c932ac5e8c7414a2b7af8ce09cb8ad6ec5e2", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\nindex f92668d5d..74dfb2b02 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\n\n@@ -7,7 +7,6 @@\n package com.powsybl.iidm.network.extensions;\n \n import com.powsybl.commons.extensions.Extension;\n-import com.powsybl.iidm.network.Bus;\n import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n \n"}}, {"oid": "d653c932ac5e8c7414a2b7af8ce09cb8ad6ec5e2", "url": "https://github.com/powsybl/powsybl-core/commit/d653c932ac5e8c7414a2b7af8ce09cb8ad6ec5e2", "message": "SlackTerminal: Removing the getBus shortcut\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-16T09:19:52Z", "type": "forcePushed"}, {"oid": "331ec17c93e84ca3dc58f54b98c8784ff3c5e4e6", "url": "https://github.com/powsybl/powsybl-core/commit/331ec17c93e84ca3dc58f54b98c8784ff3c5e4e6", "message": "Adding xml unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-17T12:29:28Z", "type": "forcePushed"}, {"oid": "51fc3baa3cea7106d02794c4c22eed4020fe8c9e", "url": "https://github.com/powsybl/powsybl-core/commit/51fc3baa3cea7106d02794c4c22eed4020fe8c9e", "message": "Unit tests\n\n- Adding xml unit test\n- Adding error unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-17T13:05:27Z", "type": "forcePushed"}, {"oid": "357e320a8b693104a8a49067f2ec37c78ba22735", "url": "https://github.com/powsybl/powsybl-core/commit/357e320a8b693104a8a49067f2ec37c78ba22735", "message": "Unit tests\n\n- Adding xml unit test\n- Adding error unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-17T13:19:31Z", "type": "forcePushed"}, {"oid": "0c7d6ce3c0717c4df22628ef85df376155c1e68e", "url": "https://github.com/powsybl/powsybl-core/commit/0c7d6ce3c0717c4df22628ef85df376155c1e68e", "message": "Unit tests\n\n- Adding xml unit test\n- Adding error unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-17T13:31:02Z", "type": "forcePushed"}, {"oid": "7e4bc239b888322cbfff8ba4e2aa2168a0227874", "url": "https://github.com/powsybl/powsybl-core/commit/7e4bc239b888322cbfff8ba4e2aa2168a0227874", "message": "Unit tests\n\n- Adding xml unit test\n- Adding error unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-17T13:36:32Z", "type": "forcePushed"}, {"oid": "5f98a2e709e9c47110544594e9690d6a130f0b84", "url": "https://github.com/powsybl/powsybl-core/commit/5f98a2e709e9c47110544594e9690d6a130f0b84", "message": "Unit tests\n\n- Adding xml unit test\n- Adding error unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-17T13:50:54Z", "type": "forcePushed"}, {"oid": "4522182ba44dc79b03a7891d2b5867001b813a62", "url": "https://github.com/powsybl/powsybl-core/commit/4522182ba44dc79b03a7891d2b5867001b813a62", "message": "Support for multi-variants\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-20T16:14:25Z", "type": "forcePushed"}, {"oid": "c5c9d343b447b81af17a3f7e8b543cf6d877ad37", "url": "https://github.com/powsybl/powsybl-core/commit/c5c9d343b447b81af17a3f7e8b543cf6d877ad37", "message": "Support for multi-variants\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-20T16:20:59Z", "type": "forcePushed"}, {"oid": "c3022c25ec771dacecea3c339376e14eec11bd11", "url": "https://github.com/powsybl/powsybl-core/commit/c3022c25ec771dacecea3c339376e14eec11bd11", "message": "Support for multi-variants\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-20T16:33:07Z", "type": "forcePushed"}, {"oid": "18a32aa6fce71dc22833480d2f12f8446a535836", "url": "https://github.com/powsybl/powsybl-core/commit/18a32aa6fce71dc22833480d2f12f8446a535836", "message": "Adding multi-variant test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-21T13:56:06Z", "type": "forcePushed"}, {"oid": "74257603afe3bf8316a3a09b07b1535f0c5d07a9", "url": "https://github.com/powsybl/powsybl-core/commit/74257603afe3bf8316a3a09b07b1535f0c5d07a9", "message": "Adding multi-variant test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-21T14:06:07Z", "type": "forcePushed"}, {"oid": "9ada85d4c8d8e3036ad614acd802b814a8d409be", "url": "https://github.com/powsybl/powsybl-core/commit/9ada85d4c8d8e3036ad614acd802b814a8d409be", "message": "TerminalChooser to choose the \"best\" terminal for the SlackTerminal\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-21T15:58:13Z", "type": "forcePushed"}, {"oid": "b985920e703779e2ea77d75bf9ad8c65ca4a34d6", "url": "https://github.com/powsybl/powsybl-core/commit/b985920e703779e2ea77d75bf9ad8c65ca4a34d6", "message": "TerminalChooser to choose the \"best\" terminal for the SlackTerminal\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-21T16:39:49Z", "type": "forcePushed"}, {"oid": "561f812fc39b92d54fc76f526a0986ac8781df0b", "url": "https://github.com/powsybl/powsybl-core/commit/561f812fc39b92d54fc76f526a0986ac8781df0b", "message": "Adding unit tests\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T08:24:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MzMwMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458583300", "bodyText": "If we try to be consistent, the other extension adder use with prefix instead of set. I don't remember why @jonenst did that choice, and I don't know if the consistency is a hard requirement.", "author": "mathbagu", "createdAt": "2020-07-22T07:15:21Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdder.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.ExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public interface SlackTerminalAdder extends ExtensionAdder<VoltageLevel, SlackTerminal> {\n+\n+    @Override\n+    default Class<SlackTerminal> getExtensionClass() {\n+        return SlackTerminal.class;\n+    }\n+\n+    SlackTerminalAdder setTerminal(Terminal terminal);", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdder.java b/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdder.java\ndeleted file mode 100644\nindex 2910b7c65..000000000\n--- a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminalAdder.java\n+++ /dev/null\n\n@@ -1,25 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.extensions;\n-\n-import com.powsybl.commons.extensions.ExtensionAdder;\n-import com.powsybl.iidm.network.Terminal;\n-import com.powsybl.iidm.network.VoltageLevel;\n-\n-/**\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public interface SlackTerminalAdder extends ExtensionAdder<VoltageLevel, SlackTerminal> {\n-\n-    @Override\n-    default Class<SlackTerminal> getExtensionClass() {\n-        return SlackTerminal.class;\n-    }\n-\n-    SlackTerminalAdder setTerminal(Terminal terminal);\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MzcyNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458583727", "bodyText": "Could you prepare a pull request to adapt the existing code?", "author": "mathbagu", "createdAt": "2020-07-22T07:16:16Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantConnectableExtension.java", "diffHunk": "@@ -6,31 +6,21 @@\n  */\n package com.powsybl.iidm.network.impl;\n \n-import com.powsybl.commons.exceptions.UncheckedClassCastExceptionException;\n-import com.powsybl.commons.extensions.AbstractExtension;\n import com.powsybl.iidm.network.Connectable;\n-import com.powsybl.iidm.network.Network;\n \n /**\n+ * Deprecated, use {@link AbstractMultiVariantIdentifiableExtension} instead.\n  * @author Ghiles Abdellah <ghiles.abdellah at rte-france.com>\n  */\n-public abstract class AbstractMultiVariantConnectableExtension<T extends Connectable> extends AbstractExtension<T> implements MultiVariantObject {\n+@Deprecated\n+public abstract class AbstractMultiVariantConnectableExtension<T extends Connectable> extends AbstractMultiVariantIdentifiableExtension<T> {\n \n+    /**\n+     * Deprecated, use {@link AbstractMultiVariantIdentifiableExtension} instead.\n+     */\n+    @Deprecated", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY1MTQwOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458651408", "bodyText": "Merge request 526 on rte-core", "author": "flo-dup", "createdAt": "2020-07-22T09:12:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MzcyNw=="}], "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantConnectableExtension.java b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantConnectableExtension.java\nindex 83db9d8c6..48d0b7dc8 100644\n--- a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantConnectableExtension.java\n+++ b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantConnectableExtension.java\n\n@@ -9,11 +9,11 @@ package com.powsybl.iidm.network.impl;\n import com.powsybl.iidm.network.Connectable;\n \n /**\n- * Deprecated, use {@link AbstractMultiVariantIdentifiableExtension} instead.\n+ * @deprecated use {@link AbstractMultiVariantIdentifiableExtension} instead.\n  * @author Ghiles Abdellah <ghiles.abdellah at rte-france.com>\n  */\n @Deprecated\n-public abstract class AbstractMultiVariantConnectableExtension<T extends Connectable> extends AbstractMultiVariantIdentifiableExtension<T> {\n+public abstract class AbstractMultiVariantConnectableExtension<T extends Connectable<T>> extends AbstractMultiVariantIdentifiableExtension<T> {\n \n     /**\n      * Deprecated, use {@link AbstractMultiVariantIdentifiableExtension} instead.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NDA3Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458584077", "bodyText": "<T extends Identifiable<T>> ?", "author": "mathbagu", "createdAt": "2020-07-22T07:16:59Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantIdentifiableExtension.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/**\n+ * Copyright (c) 2020, RTE (https://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.commons.exceptions.UncheckedClassCastExceptionException;\n+import com.powsybl.commons.extensions.AbstractExtension;\n+import com.powsybl.iidm.network.Identifiable;\n+import com.powsybl.iidm.network.Network;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public abstract class AbstractMultiVariantIdentifiableExtension<T extends Identifiable> extends AbstractExtension<T> implements MultiVariantObject {", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantIdentifiableExtension.java b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantIdentifiableExtension.java\nindex 22e421b11..d527d2dd5 100644\n--- a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantIdentifiableExtension.java\n+++ b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractMultiVariantIdentifiableExtension.java\n\n@@ -14,7 +14,7 @@ import com.powsybl.iidm.network.Network;\n /**\n  * @author Florian Dupuy <florian.dupuy at rte-france.com>\n  */\n-public abstract class AbstractMultiVariantIdentifiableExtension<T extends Identifiable> extends AbstractExtension<T> implements MultiVariantObject {\n+public abstract class AbstractMultiVariantIdentifiableExtension<T extends Identifiable<T>> extends AbstractExtension<T> implements MultiVariantObject {\n \n     public AbstractMultiVariantIdentifiableExtension(T extendable) {\n         super(extendable);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NDkyMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458584923", "bodyText": "You should switch both parameters to keep the extendable at the first place.", "author": "mathbagu", "createdAt": "2020-07-22T07:18:40Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalAdderImpl.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.extensions.SlackTerminal;\n+import com.powsybl.iidm.network.extensions.SlackTerminalAdder;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackTerminalAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackTerminal> implements SlackTerminalAdder {\n+\n+    private Terminal terminal;\n+\n+    public SlackTerminalAdderImpl(VoltageLevel voltageLevel) {\n+        super(voltageLevel);\n+    }\n+\n+    @Override\n+    public SlackTerminalAdder setTerminal(Terminal terminal) {\n+        this.terminal = terminal;\n+        return this;\n+    }\n+\n+    @Override\n+    public SlackTerminal createExtension(VoltageLevel voltageLevel) {\n+        if (terminal == null) {\n+            throw new PowsyblException(\"Terminal needs to be set to create a SlackTerminal extension\");\n+        }\n+        return new SlackTerminalImpl(terminal, voltageLevel);", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalAdderImpl.java b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalAdderImpl.java\ndeleted file mode 100644\nindex f073c39ca..000000000\n--- a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalAdderImpl.java\n+++ /dev/null\n\n@@ -1,40 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.impl.extensions;\n-\n-import com.powsybl.commons.PowsyblException;\n-import com.powsybl.commons.extensions.AbstractExtensionAdder;\n-import com.powsybl.iidm.network.Terminal;\n-import com.powsybl.iidm.network.VoltageLevel;\n-import com.powsybl.iidm.network.extensions.SlackTerminal;\n-import com.powsybl.iidm.network.extensions.SlackTerminalAdder;\n-\n-/**\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public class SlackTerminalAdderImpl extends AbstractExtensionAdder<VoltageLevel, SlackTerminal> implements SlackTerminalAdder {\n-\n-    private Terminal terminal;\n-\n-    public SlackTerminalAdderImpl(VoltageLevel voltageLevel) {\n-        super(voltageLevel);\n-    }\n-\n-    @Override\n-    public SlackTerminalAdder setTerminal(Terminal terminal) {\n-        this.terminal = terminal;\n-        return this;\n-    }\n-\n-    @Override\n-    public SlackTerminal createExtension(VoltageLevel voltageLevel) {\n-        if (terminal == null) {\n-            throw new PowsyblException(\"Terminal needs to be set to create a SlackTerminal extension\");\n-        }\n-        return new SlackTerminalImpl(terminal, voltageLevel);\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NTI1OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458585259", "bodyText": "Replace ArrayList by List\n@geofjamg do you think a List is ok, or should we change to a classic array?", "author": "mathbagu", "createdAt": "2020-07-22T07:19:19Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalImpl.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl.extensions;\n+\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.extensions.SlackTerminal;\n+import com.powsybl.iidm.network.impl.AbstractMultiVariantIdentifiableExtension;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public class SlackTerminalImpl extends AbstractMultiVariantIdentifiableExtension<VoltageLevel> implements SlackTerminal {\n+\n+    private final ArrayList<Terminal> terminals;", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY0ODQyNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458648426", "bodyText": "I kept ArrayList here to be able to call ArrayList.ensureCapacity(int) method. I can remove that call to use List instead, but the capacity will be ensured at each add then.", "author": "flo-dup", "createdAt": "2020-07-22T09:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NTI1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalImpl.java b/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalImpl.java\ndeleted file mode 100644\nindex d63f87e7d..000000000\n--- a/iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalImpl.java\n+++ /dev/null\n\n@@ -1,65 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.impl.extensions;\n-\n-import com.powsybl.iidm.network.Terminal;\n-import com.powsybl.iidm.network.VoltageLevel;\n-import com.powsybl.iidm.network.extensions.SlackTerminal;\n-import com.powsybl.iidm.network.impl.AbstractMultiVariantIdentifiableExtension;\n-\n-import java.util.ArrayList;\n-\n-/**\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public class SlackTerminalImpl extends AbstractMultiVariantIdentifiableExtension<VoltageLevel> implements SlackTerminal {\n-\n-    private final ArrayList<Terminal> terminals;\n-\n-    SlackTerminalImpl(Terminal terminal, VoltageLevel voltageLevel) {\n-        super(voltageLevel);\n-\n-        int variantArraySize = getVariantManagerHolder().getVariantManager().getVariantArraySize();\n-        this.terminals = new ArrayList<>(variantArraySize);\n-        for (int i = 0; i < variantArraySize; i++) {\n-            this.terminals.add(terminal);\n-        }\n-    }\n-\n-    @Override\n-    public Terminal getTerminal() {\n-        return terminals.get(getVariantIndex());\n-    }\n-\n-    @Override\n-    public void extendVariantArraySize(int initVariantArraySize, int number, int sourceIndex) {\n-        terminals.ensureCapacity(terminals.size() + number);\n-        for (int i = 0; i < number; ++i) {\n-            terminals.add(terminals.get(sourceIndex));\n-        }\n-    }\n-\n-    @Override\n-    public void reduceVariantArraySize(int number) {\n-        for (int i = 0; i < number; i++) {\n-            terminals.remove(terminals.size() - 1); // remove elements from the top to avoid moves inside the array\n-        }\n-    }\n-\n-    @Override\n-    public void deleteVariantArrayElement(int index) {\n-        terminals.set(index, null);\n-    }\n-\n-    @Override\n-    public void allocateVariantArrayElement(int[] indexes, int sourceIndex) {\n-        Terminal terminalSource = terminals.get(sourceIndex);\n-        for (int index : indexes) {\n-            terminals.set(index, terminalSource);\n-        }\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NjQzMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458586432", "bodyText": "Add the license header", "author": "mathbagu", "createdAt": "2020-07-22T07:21:39Z", "path": "iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package com.powsybl.iidm.network.impl.extensions;", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "561f812fc39b92d54fc76f526a0986ac8781df0b", "chunk": "diff --git a/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java b/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\nindex da913a390..6fa71af24 100644\n--- a/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\n+++ b/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\n\n@@ -122,6 +122,7 @@ public class SlackTerminalTest {\n     public void variantsTest() {\n         String variant1 = \"variant1\";\n         String variant2 = \"variant2\";\n+        String variant3 = \"variant3\";\n \n         Network network = EurostagTutorialExample1Factory.create();\n         VoltageLevel vl = network.getVoltageLevel(\"VLHV1\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NjgyMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458586822", "bodyText": "Fix this todo", "author": "mathbagu", "createdAt": "2020-07-22T07:22:16Z", "path": "iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package com.powsybl.iidm.network.impl.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.extensions.SlackTerminal;\n+import com.powsybl.iidm.network.extensions.SlackTerminalAdder;\n+import com.powsybl.iidm.network.test.EurostagTutorialExample1Factory;\n+import org.joda.time.DateTime;\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+\n+import static com.powsybl.iidm.network.VariantManagerConstants.INITIAL_VARIANT_ID;\n+import static org.junit.Assert.*;\n+\n+/**\n+ * @author Anne Tilloy <anne.tilloy at rte-france.com>\n+ */\n+public class SlackTerminalTest {\n+\n+    static Network createBusBreakerNetwork() {\n+        Network network = Network.create(\"test\", \"test\");\n+        network.setCaseDate(DateTime.parse(\"2016-06-27T12:27:58.535+02:00\"));\n+        Substation s = network.newSubstation()\n+            .setId(\"S\")\n+            .setCountry(Country.FR)\n+            .add();\n+        VoltageLevel vl = s.newVoltageLevel()\n+            .setId(\"VL\")\n+            .setNominalV(400)\n+            .setTopologyKind(TopologyKind.BUS_BREAKER)\n+            .add();\n+        vl.getBusBreakerView().newBus()\n+            .setId(\"B\")\n+            .add();\n+        vl.newLoad()\n+            .setId(\"L\")\n+            .setBus(\"B\")\n+            .setConnectableBus(\"B\")\n+            .setP0(100)\n+            .setQ0(50)\n+            .add();\n+\n+        Substation s1 = network.newSubstation()\n+            .setId(\"S1\")\n+            .setCountry(Country.FR)\n+            .add();\n+        VoltageLevel vl1 = s.newVoltageLevel()\n+            .setId(\"VL1\")\n+            .setNominalV(400)\n+            .setTopologyKind(TopologyKind.BUS_BREAKER)\n+            .add();\n+        vl1.getBusBreakerView().newBus()\n+            .setId(\"B1\")\n+            .add();\n+        vl1.newGenerator()\n+            .setId(\"GE\")\n+            .setBus(\"B1\")\n+            .setConnectableBus(\"B1\")\n+            .setTargetP(100)\n+            .setMinP(0)\n+            .setMaxP(110)\n+            .setTargetV(380)\n+            .setVoltageRegulatorOn(true)\n+            .add();\n+\n+        network.newLine()\n+            .setId(\"LI\")\n+            .setR(0.05)\n+            .setX(1.)\n+            .setG1(0.)\n+            .setG2(0.)\n+            .setB1(0.)\n+            .setB2(0.)\n+            .setVoltageLevel1(\"VL\")\n+            .setVoltageLevel2(\"VL1\")\n+            .setBus1(\"B\")\n+            .setBus2(\"B1\")\n+            .add();\n+\n+        return network;\n+    }\n+\n+    private static Terminal getBestTerminal(Network network, String busBusBreaker) {\n+        // TODO: use the utility rules function which decides which terminal to choose from a given bus: see TerminalChooser in iidm-util module\n+        Iterator<? extends Terminal> connectedTerminals =\n+            network.getBusBreakerView().getBus(busBusBreaker).getConnectedTerminals().iterator();", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY0ODUzMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458648530", "bodyText": "todo removed. The TerminalChooser is not in the scope of that test.", "author": "flo-dup", "createdAt": "2020-07-22T09:08:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NjgyMg=="}], "type": "inlineReview", "revised_code": {"commit": "561f812fc39b92d54fc76f526a0986ac8781df0b", "chunk": "diff --git a/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java b/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\nindex da913a390..6fa71af24 100644\n--- a/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\n+++ b/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\n\n@@ -122,6 +122,7 @@ public class SlackTerminalTest {\n     public void variantsTest() {\n         String variant1 = \"variant1\";\n         String variant2 = \"variant2\";\n+        String variant3 = \"variant3\";\n \n         Network network = EurostagTutorialExample1Factory.create();\n         VoltageLevel vl = network.getVoltageLevel(\"VLHV1\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4OTMwOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458589309", "bodyText": "This extension is in read-only mode: it's not possible to set a terminal. For a multi-variant network, to define a slack terminal for one variant, I will remove all existing extension and lose information about other variants. I think we miss something...\nI also think we have to fix the integration code of load flows", "author": "mathbagu", "createdAt": "2020-07-22T07:27:01Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.Extension;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public interface SlackTerminal extends Extension<VoltageLevel> {", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java b/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\ndeleted file mode 100644\nindex 74dfb2b02..000000000\n--- a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\n+++ /dev/null\n\n@@ -1,29 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.extensions;\n-\n-import com.powsybl.commons.extensions.Extension;\n-import com.powsybl.iidm.network.Terminal;\n-import com.powsybl.iidm.network.VoltageLevel;\n-\n-/**\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public interface SlackTerminal extends Extension<VoltageLevel> {\n-\n-    @Override\n-    default String getName() {\n-        return \"slackTerminal\";\n-    }\n-\n-    /**\n-     * Get the terminal pointed by the current SlackTerminal\n-     * @return the corresponding terminal\n-     */\n-    Terminal getTerminal();\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MDA2Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458590063", "bodyText": "Could you please complete this unit-test to expose the design issue I mention above about multi-variant management and the replacement of an existing extension", "author": "mathbagu", "createdAt": "2020-07-22T07:28:28Z", "path": "iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package com.powsybl.iidm.network.impl.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.extensions.SlackTerminal;\n+import com.powsybl.iidm.network.extensions.SlackTerminalAdder;\n+import com.powsybl.iidm.network.test.EurostagTutorialExample1Factory;\n+import org.joda.time.DateTime;\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+\n+import static com.powsybl.iidm.network.VariantManagerConstants.INITIAL_VARIANT_ID;\n+import static org.junit.Assert.*;\n+\n+/**\n+ * @author Anne Tilloy <anne.tilloy at rte-france.com>\n+ */\n+public class SlackTerminalTest {\n+\n+    static Network createBusBreakerNetwork() {\n+        Network network = Network.create(\"test\", \"test\");\n+        network.setCaseDate(DateTime.parse(\"2016-06-27T12:27:58.535+02:00\"));\n+        Substation s = network.newSubstation()\n+            .setId(\"S\")\n+            .setCountry(Country.FR)\n+            .add();\n+        VoltageLevel vl = s.newVoltageLevel()\n+            .setId(\"VL\")\n+            .setNominalV(400)\n+            .setTopologyKind(TopologyKind.BUS_BREAKER)\n+            .add();\n+        vl.getBusBreakerView().newBus()\n+            .setId(\"B\")\n+            .add();\n+        vl.newLoad()\n+            .setId(\"L\")\n+            .setBus(\"B\")\n+            .setConnectableBus(\"B\")\n+            .setP0(100)\n+            .setQ0(50)\n+            .add();\n+\n+        Substation s1 = network.newSubstation()\n+            .setId(\"S1\")\n+            .setCountry(Country.FR)\n+            .add();\n+        VoltageLevel vl1 = s.newVoltageLevel()\n+            .setId(\"VL1\")\n+            .setNominalV(400)\n+            .setTopologyKind(TopologyKind.BUS_BREAKER)\n+            .add();\n+        vl1.getBusBreakerView().newBus()\n+            .setId(\"B1\")\n+            .add();\n+        vl1.newGenerator()\n+            .setId(\"GE\")\n+            .setBus(\"B1\")\n+            .setConnectableBus(\"B1\")\n+            .setTargetP(100)\n+            .setMinP(0)\n+            .setMaxP(110)\n+            .setTargetV(380)\n+            .setVoltageRegulatorOn(true)\n+            .add();\n+\n+        network.newLine()\n+            .setId(\"LI\")\n+            .setR(0.05)\n+            .setX(1.)\n+            .setG1(0.)\n+            .setG2(0.)\n+            .setB1(0.)\n+            .setB2(0.)\n+            .setVoltageLevel1(\"VL\")\n+            .setVoltageLevel2(\"VL1\")\n+            .setBus1(\"B\")\n+            .setBus2(\"B1\")\n+            .add();\n+\n+        return network;\n+    }\n+\n+    private static Terminal getBestTerminal(Network network, String busBusBreaker) {\n+        // TODO: use the utility rules function which decides which terminal to choose from a given bus: see TerminalChooser in iidm-util module\n+        Iterator<? extends Terminal> connectedTerminals =\n+            network.getBusBreakerView().getBus(busBusBreaker).getConnectedTerminals().iterator();\n+        return connectedTerminals.next();\n+    }\n+\n+    @Test\n+    public void test() {\n+        Network network = createBusBreakerNetwork();\n+        VoltageLevel vl0 = network.getVoltageLevel(\"VL\");\n+        SlackTerminalAdder adder = vl0.newExtension(SlackTerminalAdder.class);\n+\n+        // error test\n+        try {\n+            adder.add();\n+            fail();\n+        } catch (PowsyblException e) {\n+            assertEquals(\"Terminal needs to be set to create a SlackTerminal extension\", e.getMessage());\n+        }\n+\n+        // extends voltage level\n+        String busBusBreakerId = \"B\";\n+        adder.setTerminal(getBestTerminal(network, busBusBreakerId)).add();\n+\n+        SlackTerminal slackTerminal;\n+        for (VoltageLevel vl : network.getVoltageLevels()) {\n+            slackTerminal = vl.getExtension(SlackTerminal.class);\n+            if (slackTerminal != null) {\n+                assertEquals(busBusBreakerId, slackTerminal.getTerminal().getBusBreakerView().getBus().getId());\n+                assertEquals(\"VL_0\", slackTerminal.getTerminal().getBusView().getBus().getId());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void variantsTest() {\n+        String variant1 = \"variant1\";\n+        String variant2 = \"variant2\";\n+\n+        Network network = EurostagTutorialExample1Factory.create();\n+        VoltageLevel vl = network.getVoltageLevel(\"VLHV1\");\n+        vl.newExtension(SlackTerminalAdder.class)\n+            .setTerminal(getBestTerminal(network, \"NLOAD\"))\n+            .add();\n+\n+        SlackTerminal slackTerminal = vl.getExtension(SlackTerminal.class);\n+        assertNotNull(slackTerminal);\n+\n+        final Terminal t0 = slackTerminal.getTerminal();\n+\n+        VariantManager variantManager = network.getVariantManager();\n+        variantManager.cloneVariant(INITIAL_VARIANT_ID, variant1);\n+\n+        variantManager.setWorkingVariant(variant1);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        variantManager.setWorkingVariant(INITIAL_VARIANT_ID);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        variantManager.cloneVariant(variant1, variant2);\n+\n+        variantManager.setWorkingVariant(variant1);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        variantManager.setWorkingVariant(variant2);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        variantManager.removeVariant(variant1);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        variantManager.removeVariant(variant2);\n+        try {\n+            slackTerminal.getTerminal();\n+            fail();\n+        } catch (PowsyblException e) {\n+            assertEquals(\"Variant index not set\", e.getMessage());\n+        }\n+\n+        variantManager.setWorkingVariant(INITIAL_VARIANT_ID);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        List<String> targetVariantIds = new ArrayList<>();\n+        targetVariantIds.add(variant1);\n+        targetVariantIds.add(variant2);\n+        variantManager.cloneVariant(INITIAL_VARIANT_ID, targetVariantIds);\n+\n+        variantManager.setWorkingVariant(variant1);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+\n+        variantManager.setWorkingVariant(variant2);\n+        assertEquals(t0, slackTerminal.getTerminal());\n+    }", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "561f812fc39b92d54fc76f526a0986ac8781df0b", "chunk": "diff --git a/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java b/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\nindex da913a390..6fa71af24 100644\n--- a/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\n+++ b/iidm/iidm-impl/src/test/java/com/powsybl/iidm/network/impl/extensions/SlackTerminalTest.java\n\n@@ -122,6 +122,7 @@ public class SlackTerminalTest {\n     public void variantsTest() {\n         String variant1 = \"variant1\";\n         String variant2 = \"variant2\";\n+        String variant3 = \"variant3\";\n \n         Network network = EurostagTutorialExample1Factory.create();\n         VoltageLevel vl = network.getVoltageLevel(\"VLHV1\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MDkzNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458590934", "bodyText": "What about branches, T3E or HVDC lines?", "author": "mathbagu", "createdAt": "2020-07-22T07:30:00Z", "path": "iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import com.powsybl.iidm.network.ConnectableType;\n+import com.powsybl.iidm.network.Injection;\n+import com.powsybl.iidm.network.Terminal;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+\n+/**\n+ * A class which allows to choose a terminal, according to given filters, among several terminals\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public final class TerminalChooser {\n+\n+    private final List<Predicate<Terminal>> rules;\n+\n+    public static TerminalChooser getDefaultSlackTerminalChooser() {\n+        List<Predicate<Terminal>> rules = new ArrayList<>();\n+        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n+        rules.add(t -> t.getConnectable() instanceof Injection);", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE0Mjc0MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460142740", "bodyText": "They could also be added if you think it makes sense, but @geofjamg would only leave the Busbar predicate... so that's a compromise? Anyway that's only the default chooser, other choosers can be defined and used.", "author": "flo-dup", "createdAt": "2020-07-24T15:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MDkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwMTE2Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460701163", "bodyText": "There is a risk that there is no busbar section (Bus/Breaker VoltageLevel) and no injection neither. For instance, if we consider a star-like network, the star bus is a good slack bus, even there is no injection connected to it.\nI would add the 3 other predicates to be sure you can always attach the extension to a terminal.\nCan you please add a unit test using the Eurostag Tutorial 1, and ensure your are able to set the slack terminal", "author": "mathbagu", "createdAt": "2020-07-27T07:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MDkzNA=="}], "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\ndeleted file mode 100644\nindex e70f2f597..000000000\n--- a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\n+++ /dev/null\n\n@@ -1,66 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.util;\n-\n-import com.powsybl.iidm.network.ConnectableType;\n-import com.powsybl.iidm.network.Injection;\n-import com.powsybl.iidm.network.Terminal;\n-\n-import java.util.ArrayList;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Optional;\n-import java.util.function.Predicate;\n-import java.util.stream.Collectors;\n-import java.util.stream.Stream;\n-import java.util.stream.StreamSupport;\n-\n-/**\n- * A class which allows to choose a terminal, according to given filters, among several terminals\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public final class TerminalChooser {\n-\n-    private final List<Predicate<Terminal>> rules;\n-\n-    public static TerminalChooser getDefaultSlackTerminalChooser() {\n-        List<Predicate<Terminal>> rules = new ArrayList<>();\n-        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n-        rules.add(t -> t.getConnectable() instanceof Injection);\n-        return new TerminalChooser(rules);\n-    }\n-\n-    public TerminalChooser(List<Predicate<Terminal>> rules) {\n-        this.rules = rules;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Iterable<? extends Terminal> terminals) {\n-        for (Predicate<Terminal> predicate : rules) {\n-            Optional<? extends Terminal> terminal = StreamSupport.stream(terminals.spliterator(), false)\n-                .filter(predicate)\n-                .findFirst();\n-            if (terminal.isPresent()) {\n-                return terminal.get();\n-            }\n-        }\n-        Iterator<? extends Terminal> it = terminals.iterator();\n-        return it.hasNext() ? it.next() : null;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Stream<? extends Terminal> terminals) {\n-        return choose(terminals.collect(Collectors.toList()));\n-    }\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MTM4Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458591383", "bodyText": "Rules cannot be null:\nthis.rules = Objects.requireNonNull(rules);", "author": "mathbagu", "createdAt": "2020-07-22T07:30:45Z", "path": "iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import com.powsybl.iidm.network.ConnectableType;\n+import com.powsybl.iidm.network.Injection;\n+import com.powsybl.iidm.network.Terminal;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+\n+/**\n+ * A class which allows to choose a terminal, according to given filters, among several terminals\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public final class TerminalChooser {\n+\n+    private final List<Predicate<Terminal>> rules;\n+\n+    public static TerminalChooser getDefaultSlackTerminalChooser() {\n+        List<Predicate<Terminal>> rules = new ArrayList<>();\n+        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n+        rules.add(t -> t.getConnectable() instanceof Injection);\n+        return new TerminalChooser(rules);\n+    }\n+\n+    public TerminalChooser(List<Predicate<Terminal>> rules) {\n+        this.rules = rules;", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDg0MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460704841", "bodyText": "I reopen this conversation because it's not fixed", "author": "mathbagu", "createdAt": "2020-07-27T07:45:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MTM4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc4NTE3Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460785172", "bodyText": "Correctly corrected this time!", "author": "flo-dup", "createdAt": "2020-07-27T10:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MTM4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\ndeleted file mode 100644\nindex e70f2f597..000000000\n--- a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\n+++ /dev/null\n\n@@ -1,66 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.util;\n-\n-import com.powsybl.iidm.network.ConnectableType;\n-import com.powsybl.iidm.network.Injection;\n-import com.powsybl.iidm.network.Terminal;\n-\n-import java.util.ArrayList;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Optional;\n-import java.util.function.Predicate;\n-import java.util.stream.Collectors;\n-import java.util.stream.Stream;\n-import java.util.stream.StreamSupport;\n-\n-/**\n- * A class which allows to choose a terminal, according to given filters, among several terminals\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public final class TerminalChooser {\n-\n-    private final List<Predicate<Terminal>> rules;\n-\n-    public static TerminalChooser getDefaultSlackTerminalChooser() {\n-        List<Predicate<Terminal>> rules = new ArrayList<>();\n-        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n-        rules.add(t -> t.getConnectable() instanceof Injection);\n-        return new TerminalChooser(rules);\n-    }\n-\n-    public TerminalChooser(List<Predicate<Terminal>> rules) {\n-        this.rules = rules;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Iterable<? extends Terminal> terminals) {\n-        for (Predicate<Terminal> predicate : rules) {\n-            Optional<? extends Terminal> terminal = StreamSupport.stream(terminals.spliterator(), false)\n-                .filter(predicate)\n-                .findFirst();\n-            if (terminal.isPresent()) {\n-                return terminal.get();\n-            }\n-        }\n-        Iterator<? extends Terminal> it = terminals.iterator();\n-        return it.hasNext() ? it.next() : null;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Stream<? extends Terminal> terminals) {\n-        return choose(terminals.collect(Collectors.toList()));\n-    }\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwODgyOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458608829", "bodyText": "I'm not sure it's really efficient: we iterate many times over the list of terminals.", "author": "mathbagu", "createdAt": "2020-07-22T08:01:49Z", "path": "iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import com.powsybl.iidm.network.ConnectableType;\n+import com.powsybl.iidm.network.Injection;\n+import com.powsybl.iidm.network.Terminal;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+\n+/**\n+ * A class which allows to choose a terminal, according to given filters, among several terminals\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public final class TerminalChooser {\n+\n+    private final List<Predicate<Terminal>> rules;\n+\n+    public static TerminalChooser getDefaultSlackTerminalChooser() {\n+        List<Predicate<Terminal>> rules = new ArrayList<>();\n+        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n+        rules.add(t -> t.getConnectable() instanceof Injection);\n+        return new TerminalChooser(rules);\n+    }\n+\n+    public TerminalChooser(List<Predicate<Terminal>> rules) {\n+        this.rules = rules;\n+    }\n+\n+    /**\n+     * @param terminals the terminals among which a terminal has to be chosen\n+     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n+     */\n+    public Terminal choose(Iterable<? extends Terminal> terminals) {\n+        for (Predicate<Terminal> predicate : rules) {\n+            Optional<? extends Terminal> terminal = StreamSupport.stream(terminals.spliterator(), false)\n+                .filter(predicate)\n+                .findFirst();\n+            if (terminal.isPresent()) {\n+                return terminal.get();\n+            }\n+        }\n+        Iterator<? extends Terminal> it = terminals.iterator();\n+        return it.hasNext() ? it.next() : null;", "originalCommit": "3de39dee657e079913bc921486b9a3e38eefe187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NDYyOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458794628", "bodyText": "Corrected. I thought the number of terminals was too small to bother about efficiency... \ud83d\ude14", "author": "flo-dup", "createdAt": "2020-07-22T13:33:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwODgyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\ndeleted file mode 100644\nindex e70f2f597..000000000\n--- a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\n+++ /dev/null\n\n@@ -1,66 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.util;\n-\n-import com.powsybl.iidm.network.ConnectableType;\n-import com.powsybl.iidm.network.Injection;\n-import com.powsybl.iidm.network.Terminal;\n-\n-import java.util.ArrayList;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Optional;\n-import java.util.function.Predicate;\n-import java.util.stream.Collectors;\n-import java.util.stream.Stream;\n-import java.util.stream.StreamSupport;\n-\n-/**\n- * A class which allows to choose a terminal, according to given filters, among several terminals\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public final class TerminalChooser {\n-\n-    private final List<Predicate<Terminal>> rules;\n-\n-    public static TerminalChooser getDefaultSlackTerminalChooser() {\n-        List<Predicate<Terminal>> rules = new ArrayList<>();\n-        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n-        rules.add(t -> t.getConnectable() instanceof Injection);\n-        return new TerminalChooser(rules);\n-    }\n-\n-    public TerminalChooser(List<Predicate<Terminal>> rules) {\n-        this.rules = rules;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Iterable<? extends Terminal> terminals) {\n-        for (Predicate<Terminal> predicate : rules) {\n-            Optional<? extends Terminal> terminal = StreamSupport.stream(terminals.spliterator(), false)\n-                .filter(predicate)\n-                .findFirst();\n-            if (terminal.isPresent()) {\n-                return terminal.get();\n-            }\n-        }\n-        Iterator<? extends Terminal> it = terminals.iterator();\n-        return it.hasNext() ? it.next() : null;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Stream<? extends Terminal> terminals) {\n-        return choose(terminals.collect(Collectors.toList()));\n-    }\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYyNTI1NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458625254", "bodyText": "Not sure it's really efficient, specially because you iterate over the stream to create the list, and then we iterate several times over the list in the other choose method", "author": "mathbagu", "createdAt": "2020-07-22T08:29:48Z", "path": "iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import com.powsybl.iidm.network.ConnectableType;\n+import com.powsybl.iidm.network.Injection;\n+import com.powsybl.iidm.network.Terminal;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+\n+/**\n+ * A class which allows to choose a terminal, according to given filters, among several terminals\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public final class TerminalChooser {\n+\n+    private final List<Predicate<Terminal>> rules;\n+\n+    public static TerminalChooser getDefaultSlackTerminalChooser() {\n+        List<Predicate<Terminal>> rules = new ArrayList<>();\n+        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n+        rules.add(t -> t.getConnectable() instanceof Injection);\n+        return new TerminalChooser(rules);\n+    }\n+\n+    public TerminalChooser(List<Predicate<Terminal>> rules) {\n+        this.rules = rules;\n+    }\n+\n+    /**\n+     * @param terminals the terminals among which a terminal has to be chosen\n+     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n+     */\n+    public Terminal choose(Iterable<? extends Terminal> terminals) {\n+        for (Predicate<Terminal> predicate : rules) {\n+            Optional<? extends Terminal> terminal = StreamSupport.stream(terminals.spliterator(), false)\n+                .filter(predicate)\n+                .findFirst();\n+            if (terminal.isPresent()) {\n+                return terminal.get();\n+            }\n+        }\n+        Iterator<? extends Terminal> it = terminals.iterator();\n+        return it.hasNext() ? it.next() : null;\n+    }\n+\n+    /**\n+     * @param terminals the terminals among which a terminal has to be chosen\n+     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n+     */\n+    public Terminal choose(Stream<? extends Terminal> terminals) {\n+        return choose(terminals.collect(Collectors.toList()));\n+    }", "originalCommit": "561f812fc39b92d54fc76f526a0986ac8781df0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NDgzNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r458794834", "bodyText": "Same...", "author": "flo-dup", "createdAt": "2020-07-22T13:33:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYyNTI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNTkyMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460705922", "bodyText": "Same what?", "author": "mathbagu", "createdAt": "2020-07-27T07:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYyNTI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc4NDk3Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460784976", "bodyText": "Same as previous conversation: I corrected it.", "author": "flo-dup", "createdAt": "2020-07-27T10:07:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYyNTI1NA=="}], "type": "inlineReview", "revised_code": {"commit": "988b7b6b8f45123d827c06a89d644bc91f95d115", "chunk": "diff --git a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\ndeleted file mode 100644\nindex e70f2f597..000000000\n--- a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\n+++ /dev/null\n\n@@ -1,66 +0,0 @@\n-/**\n- * Copyright (c) 2020, RTE (http://www.rte-france.com)\n- * This Source Code Form is subject to the terms of the Mozilla Public\n- * License, v. 2.0. If a copy of the MPL was not distributed with this\n- * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n- */\n-package com.powsybl.iidm.network.util;\n-\n-import com.powsybl.iidm.network.ConnectableType;\n-import com.powsybl.iidm.network.Injection;\n-import com.powsybl.iidm.network.Terminal;\n-\n-import java.util.ArrayList;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Optional;\n-import java.util.function.Predicate;\n-import java.util.stream.Collectors;\n-import java.util.stream.Stream;\n-import java.util.stream.StreamSupport;\n-\n-/**\n- * A class which allows to choose a terminal, according to given filters, among several terminals\n- * @author Florian Dupuy <florian.dupuy at rte-france.com>\n- */\n-public final class TerminalChooser {\n-\n-    private final List<Predicate<Terminal>> rules;\n-\n-    public static TerminalChooser getDefaultSlackTerminalChooser() {\n-        List<Predicate<Terminal>> rules = new ArrayList<>();\n-        rules.add(t -> t.getConnectable().getType() == ConnectableType.BUSBAR_SECTION);\n-        rules.add(t -> t.getConnectable() instanceof Injection);\n-        return new TerminalChooser(rules);\n-    }\n-\n-    public TerminalChooser(List<Predicate<Terminal>> rules) {\n-        this.rules = rules;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Iterable<? extends Terminal> terminals) {\n-        for (Predicate<Terminal> predicate : rules) {\n-            Optional<? extends Terminal> terminal = StreamSupport.stream(terminals.spliterator(), false)\n-                .filter(predicate)\n-                .findFirst();\n-            if (terminal.isPresent()) {\n-                return terminal.get();\n-            }\n-        }\n-        Iterator<? extends Terminal> it = terminals.iterator();\n-        return it.hasNext() ? it.next() : null;\n-    }\n-\n-    /**\n-     * @param terminals the terminals among which a terminal has to be chosen\n-     * @return the first terminal satisfying a rule (rules are checked in ascending order)\n-     */\n-    public Terminal choose(Stream<? extends Terminal> terminals) {\n-        return choose(terminals.collect(Collectors.toList()));\n-    }\n-\n-}\n"}}, {"oid": "988b7b6b8f45123d827c06a89d644bc91f95d115", "url": "https://github.com/powsybl/powsybl-core/commit/988b7b6b8f45123d827c06a89d644bc91f95d115", "message": "Adding multivariant support for Identifiable extensions\n\nSupport for Connectable extensions through AbstractMultiVariantConnectableExtension class is deprecated, as Connectable extends Identifiable\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:36:52Z", "type": "commit"}, {"oid": "1d2dedf3e87d0fb015afc3a1dca114f738c8e1f4", "url": "https://github.com/powsybl/powsybl-core/commit/1d2dedf3e87d0fb015afc3a1dca114f738c8e1f4", "message": "Adding terminals getters to the Bus interface\n\nThe two getters already existed in BusExt interface but needed to be added in the Bus interface for the SlackTerminal issue #1307\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:22Z", "type": "commit"}, {"oid": "7da07f0d7d05ce1f9e470f5dc7ac7b5ba37acab3", "url": "https://github.com/powsybl/powsybl-core/commit/7da07f0d7d05ce1f9e470f5dc7ac7b5ba37acab3", "message": "Terminals getters: default implementations in Bus interface\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:22Z", "type": "commit"}, {"oid": "4f63c077ca21d5ee75302b05a623a82a23edd367", "url": "https://github.com/powsybl/powsybl-core/commit/4f63c077ca21d5ee75302b05a623a82a23edd367", "message": "Minor corrections\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:22Z", "type": "commit"}, {"oid": "ee4803d334e51a50a5e4690ab97753260686b847", "url": "https://github.com/powsybl/powsybl-core/commit/ee4803d334e51a50a5e4690ab97753260686b847", "message": "Slackbus extension: interface and implementation\n\nSlackBus: two implementations depending on the VoltageLevel type\nSlackBusBusBreakerImpl for VoltageLevel.BusBreakerView\nSlackBusNodeBreakerImpl for VoltageLevel.NodeBreakerView\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:22Z", "type": "commit"}, {"oid": "d688d3d70569e94eca0f64cb497d27399b63f6ee", "url": "https://github.com/powsybl/powsybl-core/commit/d688d3d70569e94eca0f64cb497d27399b63f6ee", "message": "SlackBus is replaced by SlackTerminal\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:22Z", "type": "commit"}, {"oid": "1781d963a940bc6ee270e7d8c259672ed9cc0c06", "url": "https://github.com/powsybl/powsybl-core/commit/1781d963a940bc6ee270e7d8c259672ed9cc0c06", "message": "Add a unit test.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-07-22T09:40:22Z", "type": "commit"}, {"oid": "0d1aff402a7a4aea631c9fcd46883f0836f08077", "url": "https://github.com/powsybl/powsybl-core/commit/0d1aff402a7a4aea631c9fcd46883f0836f08077", "message": "SlackTerminal: defined from a terminal\n\nThe user gives the terminal when creating the extension, instead of the busId / node id.\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:23Z", "type": "commit"}, {"oid": "c8cd431e4e3fc13ee8b1a04a8ca7ac07fe62a465", "url": "https://github.com/powsybl/powsybl-core/commit/c8cd431e4e3fc13ee8b1a04a8ca7ac07fe62a465", "message": "SlackTerminal: Removing the getBus shortcut\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:23Z", "type": "commit"}, {"oid": "ab21f3bdb02540e3cd49e8e7bb5e41770809cf60", "url": "https://github.com/powsybl/powsybl-core/commit/ab21f3bdb02540e3cd49e8e7bb5e41770809cf60", "message": "Unit tests\n\n- Adding xml unit test\n- Adding error unit test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:40:23Z", "type": "commit"}, {"oid": "4d17b6f083e9c744fb1b255ab2f33d3c35f321e0", "url": "https://github.com/powsybl/powsybl-core/commit/4d17b6f083e9c744fb1b255ab2f33d3c35f321e0", "message": "Support for multi-variants\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:46:06Z", "type": "commit"}, {"oid": "054fae2c3a4fe3d8b5d88b42361c1d6339ee37f2", "url": "https://github.com/powsybl/powsybl-core/commit/054fae2c3a4fe3d8b5d88b42361c1d6339ee37f2", "message": "Adding multi-variant test\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:46:15Z", "type": "commit"}, {"oid": "c1ba6d7cd4eadc5901aa5db9d5b531bc6512e3e5", "url": "https://github.com/powsybl/powsybl-core/commit/c1ba6d7cd4eadc5901aa5db9d5b531bc6512e3e5", "message": "TerminalChooser to choose the \"best\" terminal for the SlackTerminal\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:46:15Z", "type": "commit"}, {"oid": "a32a19a27413cdbc829f8a47e74cd701ae11b6f6", "url": "https://github.com/powsybl/powsybl-core/commit/a32a19a27413cdbc829f8a47e74cd701ae11b6f6", "message": "Adding unit tests\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T09:46:15Z", "type": "commit"}, {"oid": "097349ffab000dfd6af2d7ee9717763a85c00503", "url": "https://github.com/powsybl/powsybl-core/commit/097349ffab000dfd6af2d7ee9717763a85c00503", "message": "Minor changes\n\nAs requested from review.\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T11:58:50Z", "type": "commit"}, {"oid": "2ffae6622d296689bf883e46ab38db79e083d49b", "url": "https://github.com/powsybl/powsybl-core/commit/2ffae6622d296689bf883e46ab38db79e083d49b", "message": "TerminalChooser: efficiency improved\n\nAs discussed in PR review\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T11:59:22Z", "type": "commit"}, {"oid": "2ffae6622d296689bf883e46ab38db79e083d49b", "url": "https://github.com/powsybl/powsybl-core/commit/2ffae6622d296689bf883e46ab38db79e083d49b", "message": "TerminalChooser: efficiency improved\n\nAs discussed in PR review\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-22T11:59:22Z", "type": "forcePushed"}, {"oid": "1a0411850811e1872aaf81d5c0713fc6d4893e8b", "url": "https://github.com/powsybl/powsybl-core/commit/1a0411850811e1872aaf81d5c0713fc6d4893e8b", "message": "SlackTerminal: multivariant support corrections\n\n- adding setTerminal and isCleanable methods\n- adding reset, removeFrom, removeAllFrom static methods\n- related unit tests\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-23T17:50:52Z", "type": "forcePushed"}, {"oid": "e98cd2281a4fb23b42833c09d82a7192e6f4535b", "url": "https://github.com/powsybl/powsybl-core/commit/e98cd2281a4fb23b42833c09d82a7192e6f4535b", "message": "SlackTerminal: multivariant support corrections\n\n- adding setTerminal and isCleanable methods\n- adding reset, removeFrom, removeAllFrom static methods\n- related unit tests\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-23T17:58:30Z", "type": "commit"}, {"oid": "e98cd2281a4fb23b42833c09d82a7192e6f4535b", "url": "https://github.com/powsybl/powsybl-core/commit/e98cd2281a4fb23b42833c09d82a7192e6f4535b", "message": "SlackTerminal: multivariant support corrections\n\n- adding setTerminal and isCleanable methods\n- adding reset, removeFrom, removeAllFrom static methods\n- related unit tests\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-23T17:58:30Z", "type": "forcePushed"}, {"oid": "4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "url": "https://github.com/powsybl/powsybl-core/commit/4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "message": "SlackTerminal: multivariant support corrections\n\n- setTerminal returns current SlackTerminal\n- add setTerminal(terminal, cleanIfCleanable) method\n- correcting reset static method and SlackTerminalImpl constructor\n- related unit tests\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-24T15:50:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NTQ3Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460695473", "bodyText": "I would write the method like this:\n    default SlackTerminal setTerminal(Terminal terminal, boolean cleanIfCleanable) {\n        boolean cleanable = setTerminal(terminal);\n        if (cleanIfCleanable && cleanable) {\n            getExtendable().removeExtension(SlackTerminal.class);\n        }\n        return this;\n    }", "author": "mathbagu", "createdAt": "2020-07-27T07:26:56Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.Extension;\n+import com.powsybl.iidm.network.Network;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public interface SlackTerminal extends Extension<VoltageLevel> {\n+\n+    /**\n+     * Remove all SlackTerminal extensions from given network\n+     * @param network the network to remove the slackTerminal extensions from\n+     */\n+    static void removeAllFrom(Network network) {\n+        network.getVoltageLevels().forEach(vl -> vl.removeExtension(SlackTerminal.class));\n+    }\n+\n+    /**\n+     * Reset the slackTerminal extension to the given terminal (may be null)\n+     * @param voltageLevel the voltageLevel to reset the slackTerminal extension from\n+     * @param terminal the terminal to reset the extension to (may be null)\n+     */\n+    static void reset(VoltageLevel voltageLevel, Terminal terminal) {\n+        SlackTerminal st = voltageLevel.getExtension(SlackTerminal.class);\n+        if (st == null) {\n+            voltageLevel.newExtension(SlackTerminalAdder.class)\n+                .withTerminal(terminal)\n+                .add();\n+        } else {\n+            st.setTerminal(terminal, true);\n+        }\n+    }\n+\n+    @Override\n+    default String getName() {\n+        return \"slackTerminal\";\n+    }\n+\n+    /**\n+     * Get the terminal pointed by the current SlackTerminal\n+     * @return the corresponding terminal\n+     */\n+    Terminal getTerminal();\n+\n+    /**\n+     * Set the terminal pointed by the current SlackTerminal\n+     * @param terminal the corresponding terminal\n+     * @return the current SlackTerminal\n+     */\n+    SlackTerminal setTerminal(Terminal terminal);\n+\n+    /**\n+     * Set the terminal pointed by the current SlackTerminal\n+     * @param terminal the corresponding terminal (may be null)\n+     * @param cleanIfCleanable if true and if the slackTerminal is cleanable, removes the SlackTerminal extension from\n+     *                         the corresponding VoltageLevel\n+     * @return the current SlackTerminal\n+     */\n+    default SlackTerminal setTerminal(Terminal terminal, boolean cleanIfCleanable) {\n+        if (cleanIfCleanable) {\n+            if (setTerminal(terminal).isCleanable()) {\n+                getExtendable().removeExtension(SlackTerminal.class);\n+            }\n+        } else {\n+            setTerminal(terminal);\n+        }\n+        return this;\n+    }", "originalCommit": "4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcyNzI4MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460727281", "bodyText": "Yes it's more compact! but it would be better to check if the slackTerminal is cleanable only if required, so:\ndefault SlackTerminal setTerminal(Terminal terminal, boolean cleanIfCleanable) {\n    setTerminal(terminal);\n    if (cleanIfCleanable && isCleanable()) {\n        getExtendable().removeExtension(SlackTerminal.class);\n    }\n    return this;\n}\n\nOtherwise with the multivariant implementation we iterate over the array for nothing", "author": "flo-dup", "createdAt": "2020-07-27T08:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NTQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMDEzMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460730133", "bodyText": "If we really want to avoid calling isCleanable when not required, couldn't we also add terminal==null in the condition?", "author": "flo-dup", "createdAt": "2020-07-27T08:32:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NTQ3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "755b06d7f33f821da9c45d6e2fd65574bbdc49d3", "chunk": "diff --git a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java b/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\nindex 33529af01..64ec6b32c 100644\n--- a/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\n+++ b/iidm/iidm-api/src/main/java/com/powsybl/iidm/network/extensions/SlackTerminal.java\n\n@@ -66,12 +66,9 @@ public interface SlackTerminal extends Extension<VoltageLevel> {\n      * @return the current SlackTerminal\n      */\n     default SlackTerminal setTerminal(Terminal terminal, boolean cleanIfCleanable) {\n-        if (cleanIfCleanable) {\n-            if (setTerminal(terminal).isCleanable()) {\n-                getExtendable().removeExtension(SlackTerminal.class);\n-            }\n-        } else {\n-            setTerminal(terminal);\n+        setTerminal(terminal);\n+        if (cleanIfCleanable && terminal == null && isCleanable()) {\n+            getExtendable().removeExtension(SlackTerminal.class);\n         }\n         return this;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDUzMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460704530", "bodyText": "I would rename this method getDefault to avoid redundancy between the name of the class, and the name of this method", "author": "mathbagu", "createdAt": "2020-07-27T07:44:58Z", "path": "iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import com.powsybl.iidm.network.ConnectableType;\n+import com.powsybl.iidm.network.Injection;\n+import com.powsybl.iidm.network.Terminal;\n+\n+import java.util.*;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+\n+/**\n+ * A class which allows to choose a terminal, according to given filters, among several terminals\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public final class TerminalChooser {\n+\n+    private final List<Predicate<Terminal>> rules;\n+\n+    public static TerminalChooser getDefaultSlackTerminalChooser() {", "originalCommit": "4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "91b7efd49eee71174bbe66bfe060fc0f2cee40af", "chunk": "diff --git a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalFinder.java\nsimilarity index 71%\nrename from iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\nrename to iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalFinder.java\nindex 311bbc9ac..d296c8257 100644\n--- a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\n+++ b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalFinder.java\n\n@@ -6,9 +6,7 @@\n  */\n package com.powsybl.iidm.network.util;\n \n-import com.powsybl.iidm.network.ConnectableType;\n-import com.powsybl.iidm.network.Injection;\n-import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.*;\n \n import java.util.*;\n import java.util.function.Predicate;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNTQ0NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460705445", "bodyText": "I would rename this class TerminalFinder and the rename the choose method find", "author": "mathbagu", "createdAt": "2020-07-27T07:46:48Z", "path": "iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import com.powsybl.iidm.network.ConnectableType;\n+import com.powsybl.iidm.network.Injection;\n+import com.powsybl.iidm.network.Terminal;\n+\n+import java.util.*;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+\n+/**\n+ * A class which allows to choose a terminal, according to given filters, among several terminals\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+public final class TerminalChooser {", "originalCommit": "4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "91b7efd49eee71174bbe66bfe060fc0f2cee40af", "chunk": "diff --git a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalFinder.java\nsimilarity index 71%\nrename from iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\nrename to iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalFinder.java\nindex 311bbc9ac..d296c8257 100644\n--- a/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalChooser.java\n+++ b/iidm/iidm-util/src/main/java/com/powsybl/iidm/network/util/TerminalFinder.java\n\n@@ -6,9 +6,7 @@\n  */\n package com.powsybl.iidm.network.util;\n \n-import com.powsybl.iidm.network.ConnectableType;\n-import com.powsybl.iidm.network.Injection;\n-import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.*;\n \n import java.util.*;\n import java.util.function.Predicate;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxMDQ4OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460710489", "bodyText": "I would check if the terminal is not null. I would also override the hasSubElements: this method should return true if the terminal is set, false otherwise", "author": "mathbagu", "createdAt": "2020-07-27T07:56:19Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.xml.extensions;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n+import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n+import com.powsybl.commons.xml.XmlReaderContext;\n+import com.powsybl.commons.xml.XmlUtil;\n+import com.powsybl.commons.xml.XmlWriterContext;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.extensions.SlackTerminal;\n+import com.powsybl.iidm.network.extensions.SlackTerminalAdder;\n+import com.powsybl.iidm.xml.NetworkXmlReaderContext;\n+import com.powsybl.iidm.xml.NetworkXmlWriterContext;\n+import com.powsybl.iidm.xml.TerminalRefXml;\n+\n+import javax.xml.stream.XMLStreamException;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+@AutoService(ExtensionXmlSerializer.class)\n+public class SlackTerminalXmlSerializer extends AbstractExtensionXmlSerializer<VoltageLevel, SlackTerminal> {\n+\n+    private static final String ELEM_TERMINAL_REF = \"terminalRef\";\n+\n+    public SlackTerminalXmlSerializer() {\n+        super(\"slackTerminal\", \"network\", SlackTerminal.class, true, \"slackTerminal.xsd\",\n+            \"http://www.powsybl.org/schema/iidm/ext/slack_terminal/1_0\", \"slt\");\n+    }\n+\n+    @Override\n+    public void write(SlackTerminal slackTerminal, XmlWriterContext context) throws XMLStreamException {\n+        TerminalRefXml.writeTerminalRef(slackTerminal.getTerminal(), (NetworkXmlWriterContext) context, getNamespaceUri(), ELEM_TERMINAL_REF);\n+    }", "originalCommit": "4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc4MzYyNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460783624", "bodyText": "Corrected. And hasSubElements is now always false, as the attributes are now directly in the slackTerminal (see comment below)", "author": "flo-dup", "createdAt": "2020-07-27T10:04:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxMDQ4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "7c311fb133dbeb0ee124cf9ef81c86de7011c315", "chunk": "diff --git a/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java b/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java\nindex cbf384803..145053e30 100644\n--- a/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java\n+++ b/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java\n\n@@ -6,11 +6,8 @@\n  */\n package com.powsybl.iidm.xml.extensions;\n \n-import com.google.auto.service.AutoService;\n import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n-import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n import com.powsybl.commons.xml.XmlReaderContext;\n-import com.powsybl.commons.xml.XmlUtil;\n import com.powsybl.commons.xml.XmlWriterContext;\n import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxMDg0MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460710841", "bodyText": "I think if you change a little bit the export, the terminalRef is required, so you can remove this test", "author": "mathbagu", "createdAt": "2020-07-27T07:56:59Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.xml.extensions;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n+import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n+import com.powsybl.commons.xml.XmlReaderContext;\n+import com.powsybl.commons.xml.XmlUtil;\n+import com.powsybl.commons.xml.XmlWriterContext;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.extensions.SlackTerminal;\n+import com.powsybl.iidm.network.extensions.SlackTerminalAdder;\n+import com.powsybl.iidm.xml.NetworkXmlReaderContext;\n+import com.powsybl.iidm.xml.NetworkXmlWriterContext;\n+import com.powsybl.iidm.xml.TerminalRefXml;\n+\n+import javax.xml.stream.XMLStreamException;\n+\n+/**\n+ * @author Florian Dupuy <florian.dupuy at rte-france.com>\n+ */\n+@AutoService(ExtensionXmlSerializer.class)\n+public class SlackTerminalXmlSerializer extends AbstractExtensionXmlSerializer<VoltageLevel, SlackTerminal> {\n+\n+    private static final String ELEM_TERMINAL_REF = \"terminalRef\";\n+\n+    public SlackTerminalXmlSerializer() {\n+        super(\"slackTerminal\", \"network\", SlackTerminal.class, true, \"slackTerminal.xsd\",\n+            \"http://www.powsybl.org/schema/iidm/ext/slack_terminal/1_0\", \"slt\");\n+    }\n+\n+    @Override\n+    public void write(SlackTerminal slackTerminal, XmlWriterContext context) throws XMLStreamException {\n+        TerminalRefXml.writeTerminalRef(slackTerminal.getTerminal(), (NetworkXmlWriterContext) context, getNamespaceUri(), ELEM_TERMINAL_REF);\n+    }\n+\n+    @Override\n+    public SlackTerminal read(VoltageLevel voltageLevel, XmlReaderContext context) throws XMLStreamException {\n+        NetworkXmlReaderContext networkContext = (NetworkXmlReaderContext) context;\n+        XmlUtil.readUntilEndElement(getExtensionName(), networkContext.getReader(), () -> {\n+            if (networkContext.getReader().getLocalName().equals(ELEM_TERMINAL_REF)) {", "originalCommit": "4b376562e4351c2e2c8fcd5bc32bc4cf90ceaed6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc4NDAwNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1381#discussion_r460784006", "bodyText": "Corrected, no test anymore (attributes directly in the slackTerminal object).", "author": "flo-dup", "createdAt": "2020-07-27T10:05:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxMDg0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7c311fb133dbeb0ee124cf9ef81c86de7011c315", "chunk": "diff --git a/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java b/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java\nindex cbf384803..145053e30 100644\n--- a/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java\n+++ b/iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/extensions/SlackTerminalXmlSerializer.java\n\n@@ -6,11 +6,8 @@\n  */\n package com.powsybl.iidm.xml.extensions;\n \n-import com.google.auto.service.AutoService;\n import com.powsybl.commons.extensions.AbstractExtensionXmlSerializer;\n-import com.powsybl.commons.extensions.ExtensionXmlSerializer;\n import com.powsybl.commons.xml.XmlReaderContext;\n-import com.powsybl.commons.xml.XmlUtil;\n import com.powsybl.commons.xml.XmlWriterContext;\n import com.powsybl.iidm.network.Terminal;\n import com.powsybl.iidm.network.VoltageLevel;\n"}}, {"oid": "91b7efd49eee71174bbe66bfe060fc0f2cee40af", "url": "https://github.com/powsybl/powsybl-core/commit/91b7efd49eee71174bbe66bfe060fc0f2cee40af", "message": "TerminalChooser -> TerminalFinder; corrections\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T10:10:17Z", "type": "commit"}, {"oid": "7c311fb133dbeb0ee124cf9ef81c86de7011c315", "url": "https://github.com/powsybl/powsybl-core/commit/7c311fb133dbeb0ee124cf9ef81c86de7011c315", "message": "SlackTerminal serialisation corrections\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T10:42:30Z", "type": "commit"}, {"oid": "755b06d7f33f821da9c45d6e2fd65574bbdc49d3", "url": "https://github.com/powsybl/powsybl-core/commit/755b06d7f33f821da9c45d6e2fd65574bbdc49d3", "message": "Default SlackTerminal.setTerminal method cleaned\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T10:47:01Z", "type": "commit"}, {"oid": "62cb6c581c1f2e719e97f88035849e4023cf3eec", "url": "https://github.com/powsybl/powsybl-core/commit/62cb6c581c1f2e719e97f88035849e4023cf3eec", "message": "Checkstyle correction\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T10:50:43Z", "type": "commit"}, {"oid": "35b6650d4a9cc1f599af12068604665827e7d7d6", "url": "https://github.com/powsybl/powsybl-core/commit/35b6650d4a9cc1f599af12068604665827e7d7d6", "message": "Code smell correction\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T12:06:11Z", "type": "commit"}, {"oid": "85c389e0fa215a743f4e6bc537e37de15bd7e02d", "url": "https://github.com/powsybl/powsybl-core/commit/85c389e0fa215a743f4e6bc537e37de15bd7e02d", "message": "TerminalFinder with max\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T14:38:49Z", "type": "commit"}, {"oid": "d9c4041ce7aabd7380490ffc74a76bb5c273c5e9", "url": "https://github.com/powsybl/powsybl-core/commit/d9c4041ce7aabd7380490ffc74a76bb5c273c5e9", "message": "Attach a SlackTerminal extension to slack buses\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-07-27T15:27:01Z", "type": "commit"}, {"oid": "34a8fa3d820723f7014bcf96b6c1e1917487fe1f", "url": "https://github.com/powsybl/powsybl-core/commit/34a8fa3d820723f7014bcf96b6c1e1917487fe1f", "message": "Fix 2 sonar issues\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-07-27T15:43:17Z", "type": "commit"}, {"oid": "94d4571d1e2962d3993dd2044d09b3f09e3353d4", "url": "https://github.com/powsybl/powsybl-core/commit/94d4571d1e2962d3993dd2044d09b3f09e3353d4", "message": "Last fixes\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-07-27T16:05:11Z", "type": "commit"}, {"oid": "b83e8b5a43409526222a1a3bb77812d66140b83a", "url": "https://github.com/powsybl/powsybl-core/commit/b83e8b5a43409526222a1a3bb77812d66140b83a", "message": "Fix compilation issue\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-07-27T16:18:24Z", "type": "commit"}, {"oid": "1faa50ae621d3c1e5979fd7c8ccac9469876b248", "url": "https://github.com/powsybl/powsybl-core/commit/1faa50ae621d3c1e5979fd7c8ccac9469876b248", "message": "TerminalFinder unit tests do not test SlackTerminal extension\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T16:50:34Z", "type": "commit"}, {"oid": "3484a094d82157f67b3b041e6b1e79daeaf84b5d", "url": "https://github.com/powsybl/powsybl-core/commit/3484a094d82157f67b3b041e6b1e79daeaf84b5d", "message": "SlackTerminal unit tests correction\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T16:52:05Z", "type": "commit"}, {"oid": "7d2825168fe975f7a99bbf35c87c1ebe5a3fd518", "url": "https://github.com/powsybl/powsybl-core/commit/7d2825168fe975f7a99bbf35c87c1ebe5a3fd518", "message": "Adding protection to avoid setting a terminal on the wrong VoltageLevel\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-27T17:34:00Z", "type": "commit"}, {"oid": "5d1badcb0aea0b40936b3832746aa039a2d671d4", "url": "https://github.com/powsybl/powsybl-core/commit/5d1badcb0aea0b40936b3832746aa039a2d671d4", "message": "TerminalFinder: adding javadoc and comments\n\nSigned-off-by: Florian Dupuy <florian.dupuy@rte-france.com>", "committedDate": "2020-07-28T07:47:36Z", "type": "commit"}, {"oid": "ab840f3e7a204c6941e84577820c29852242ac62", "url": "https://github.com/powsybl/powsybl-core/commit/ab840f3e7a204c6941e84577820c29852242ac62", "message": "Add a unit-test in UCTE converter\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-07-28T09:17:27Z", "type": "commit"}, {"oid": "3a6b7f3dc4b3414d4b1bb82b6b7e8a38c19d3426", "url": "https://github.com/powsybl/powsybl-core/commit/3a6b7f3dc4b3414d4b1bb82b6b7e8a38c19d3426", "message": "Merge branch 'master' into slackbus", "committedDate": "2020-07-28T14:29:55Z", "type": "commit"}]}