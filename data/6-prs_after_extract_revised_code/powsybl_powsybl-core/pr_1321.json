{"pr_number": 1321, "pr_title": "New extension \"VoltagePerReactivePowerControl\" for StaticVarCompensator", "pr_createdAt": "2020-05-26T07:33:01Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1321", "timeline": [{"oid": "74c518f03049dfcae644410a31a9d708af53e88b", "url": "https://github.com/powsybl/powsybl-core/commit/74c518f03049dfcae644410a31a9d708af53e88b", "message": "First import of extension \"VoltagePerReactivePowerControl\".\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-26T07:25:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5ODIyNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r430998226", "bodyText": "Fix the author (same remark for all the files)", "author": "mathbagu", "createdAt": "2020-05-27T09:55:07Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControl.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.Extension;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n+\n+/**\n+ * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>", "originalCommit": "74c518f03049dfcae644410a31a9d708af53e88b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAzMTcyMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431031722", "bodyText": "Indeed it is from @geofjamg I just have moved some code.", "author": "annetill", "createdAt": "2020-05-27T10:57:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5ODIyNg=="}], "type": "inlineReview", "revised_code": {"commit": "30e1e6d235045414a33ee5692c0dcfa4510ad541", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControl.java\nindex fdc24f5aa..fcb4f1bca 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControl.java\n\n@@ -19,6 +19,10 @@ public interface VoltagePerReactivePowerControl extends Extension<StaticVarCompe\n         return \"voltagePerReactivePowerControl\";\n     }\n \n+    /**\n+     * Get the slope of the StaticVarCompensator, that defines how the reactive power output changes\n+     * in proportion to the difference between the controlled bus voltage and the controller bus voltage.\n+     */\n     double getSlope();\n \n     VoltagePerReactivePowerControl setSlope(double slope);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r430999433", "bodyText": "There is something strange in the design: it's not related to your PR, but why the adder take one Extendable instance and the createExtension could take another one?\n@MioRtia : what do you think?", "author": "mathbagu", "createdAt": "2020-05-27T09:57:08Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlAdderImpl.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.AbstractExtensionAdder;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n+\n+/**\n+ * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n+ */\n+public class VoltagePerReactivePowerControlAdderImpl\n+        extends AbstractExtensionAdder<StaticVarCompensator, VoltagePerReactivePowerControl>\n+        implements VoltagePerReactivePowerControlAdder {\n+\n+    private double slope;\n+\n+    protected VoltagePerReactivePowerControlAdderImpl(StaticVarCompensator svc) {\n+        super(svc);\n+    }\n+\n+    @Override\n+    protected VoltagePerReactivePowerControlImpl createExtension(StaticVarCompensator svc) {\n+        return new VoltagePerReactivePowerControlImpl(svc, slope);\n+    }", "originalCommit": "74c518f03049dfcae644410a31a9d708af53e88b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcwMzk3Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431703972", "bodyText": "Hm, good question. In the code, createExtension is only called with the extendable field (from the constructor) as parameter. Maybe the method should not take any parameter and extendable should be protected? (@jonenst do you remember why you designed it this way?)", "author": "miovd", "createdAt": "2020-05-28T09:29:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyOTExNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431729114", "bodyText": "I did it this way because it was more explicit for an implementer of an adder to take the extendable as a method argument from the method he is supposed to implement. The alternative (that you mentionned) is to have the extendable in a protected field of the base class and document that it should be used in the createExtension method", "author": "jonenst", "createdAt": "2020-05-28T10:14:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyOTgyOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431729829", "bodyText": "I'm ok with both implementations if you want to change it", "author": "jonenst", "createdAt": "2020-05-28T10:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczMTE2NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431731165", "bodyText": "I guess it's not so implicit with a protected field because you have to write the constructor calling super() with the extendable so you are hinted about it", "author": "jonenst", "createdAt": "2020-05-28T10:18:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMDI3OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431800278", "bodyText": "Ok, thank you for the explanation! Both are okay for me, what do you think @mathbagu ? In any case, I think this PR is good to be merged, we can make another PR on this subject later.", "author": "miovd", "createdAt": "2020-05-28T12:34:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwODI3NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431908274", "bodyText": "The only thing I want we ensure, is that should be forbidden to pass a different instance. I think it could be the case with the abstract class we provide. It's not directly related to this PR, so I will merge it but the discussion is still open", "author": "mathbagu", "createdAt": "2020-05-28T15:03:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTQzMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTk4Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r430999982", "bodyText": "Is there any restriction for this value? Do we have to implement a checkSlope method to ensure this value is in range, and use it in the constructor and the setter?", "author": "mathbagu", "createdAt": "2020-05-27T09:58:02Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.extensions.AbstractExtension;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n+\n+/**\n+ * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n+ */\n+public class VoltagePerReactivePowerControlImpl extends AbstractExtension<StaticVarCompensator> implements VoltagePerReactivePowerControl {\n+\n+    private double slope;\n+\n+    public VoltagePerReactivePowerControlImpl(StaticVarCompensator svc, double slope) {\n+        super(svc);\n+        this.slope = slope;", "originalCommit": "74c518f03049dfcae644410a31a9d708af53e88b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA0NDgwNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431044807", "bodyText": "Yes Indeed it should be positive in the load sign convention.", "author": "annetill", "createdAt": "2020-05-27T11:24:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk5OTk4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "30e1e6d235045414a33ee5692c0dcfa4510ad541", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\nindex 8ce55f762..15f9398be 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\n\n@@ -6,19 +6,25 @@\n  */\n package com.powsybl.iidm.network.extensions;\n \n+import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtension;\n import com.powsybl.iidm.network.StaticVarCompensator;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n /**\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n+ * @author Anne Tilloy <anne.tilloy at rte-france.com>\n  */\n public class VoltagePerReactivePowerControlImpl extends AbstractExtension<StaticVarCompensator> implements VoltagePerReactivePowerControl {\n \n+    private static final Logger LOGGER = LoggerFactory.getLogger(VoltagePerReactivePowerControlImpl.class);\n+\n     private double slope;\n \n     public VoltagePerReactivePowerControlImpl(StaticVarCompensator svc, double slope) {\n         super(svc);\n-        this.slope = slope;\n+        this.slope = checkSlope(svc, slope);\n     }\n \n     @Override\n"}}, {"oid": "3a1c9846aad60a3ebbd8f95e6fa0305899a2b731", "url": "https://github.com/powsybl/powsybl-core/commit/3a1c9846aad60a3ebbd8f95e6fa0305899a2b731", "message": "Merge branch 'master' into svc-slope-extension", "committedDate": "2020-05-27T11:25:59Z", "type": "commit"}, {"oid": "30e1e6d235045414a33ee5692c0dcfa4510ad541", "url": "https://github.com/powsybl/powsybl-core/commit/30e1e6d235045414a33ee5692c0dcfa4510ad541", "message": "Add a validation over the slope.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-27T11:39:45Z", "type": "commit"}, {"oid": "3262685ac2ffa8b65e231908267273078b83a229", "url": "https://github.com/powsybl/powsybl-core/commit/3262685ac2ffa8b65e231908267273078b83a229", "message": "Merge branch 'svc-slope-extension' of https://github.com/powsybl/powsybl-core into svc-slope-extension", "committedDate": "2020-05-27T11:41:03Z", "type": "commit"}, {"oid": "c67cd58a5e7e48098029c382703e2f65bf2b0caf", "url": "https://github.com/powsybl/powsybl-core/commit/c67cd58a5e7e48098029c382703e2f65bf2b0caf", "message": "Add unit tests.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-27T11:54:54Z", "type": "commit"}, {"oid": "53cbe6512707007530502bc2e5aaf2de1919c442", "url": "https://github.com/powsybl/powsybl-core/commit/53cbe6512707007530502bc2e5aaf2de1919c442", "message": "Add cgmes conversion.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-27T12:14:12Z", "type": "commit"}, {"oid": "98dcecfa6e283944f650f585cbe64609a48f0a09", "url": "https://github.com/powsybl/powsybl-core/commit/98dcecfa6e283944f650f585cbe64609a48f0a09", "message": "Add unitary test for serialization.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-27T12:38:32Z", "type": "commit"}, {"oid": "b6820e2ff635f03d25bdfb02b7cd7663bc565d45", "url": "https://github.com/powsybl/powsybl-core/commit/b6820e2ff635f03d25bdfb02b7cd7663bc565d45", "message": "Refactor.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-27T12:39:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NjQ5OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431086499", "bodyText": "@mathbagu Help, it is not working and I think it is just because I am not familiar with xml conversion. Thanks !", "author": "annetill", "createdAt": "2020-05-27T12:42:13Z", "path": "iidm/iidm-extensions/src/test/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlXmlSerializerTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.AbstractConverterTest;\n+import com.powsybl.iidm.export.Exporters;\n+import com.powsybl.iidm.network.Network;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n+import com.powsybl.iidm.network.test.SvcTestCaseFactory;\n+import com.powsybl.iidm.xml.NetworkXml;\n+import org.joda.time.DateTime;\n+import org.junit.Test;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Properties;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+/**\n+ * @author Anne Tilloy <anne.tilloy at rte-france.com>\n+ */\n+public class VoltagePerReactivePowerControlXmlSerializerTest extends AbstractConverterTest {\n+\n+    @Test\n+    public void test() throws IOException {\n+        Network network = SvcTestCaseFactory.create();\n+        network.setCaseDate(DateTime.parse(\"2019-05-27T12:17:02.504+02:00\"));\n+        StaticVarCompensator svc = network.getStaticVarCompensator(\"SVC2\");\n+        assertNotNull(svc);\n+\n+        svc.newExtension(VoltagePerReactivePowerControlAdder.class).withSlope(0.5).add();\n+\n+        // FIXME", "originalCommit": "b6820e2ff635f03d25bdfb02b7cd7663bc565d45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NzA1MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431087050", "bodyText": "The error I get is:\ncom.powsybl.commons.exceptions.UncheckedSaxException: org.xml.sax.SAXParseException; lineNumber: 24; columnNumber: 60; cvc-complex-type.2.4.c : Le caract\u00e8re g\u00e9n\u00e9rique concordant est strict, mais aucune d\u00e9claration ne peut \u00eatre trouv\u00e9e pour l'\u00e9l\u00e9ment 'vprpc:voltagePerReactivePowerControl'.", "author": "annetill", "createdAt": "2020-05-27T12:43:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NjQ5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI1Mjk2NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431252964", "bodyText": "The problem was that namespace was different in xsd and in the XML serializer class.\nI removed the FIXME annotation.\nI also fixed the expected value in the final assert (should be 0.5, that is the value used when creating the extension).", "author": "zamarrenolm", "createdAt": "2020-05-27T15:55:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NjQ5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2MjUwMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431262500", "bodyText": "Thanks a lot @zamarrenolm ! Have you check the cgmes conversion by the way ?", "author": "annetill", "createdAt": "2020-05-27T16:05:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NjQ5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI3ODM1MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431278351", "bodyText": "Yes, I saw that you are storing in the extension the slope attribute read in the staticVarCompensators SPARQL query, so for me it is ok.", "author": "zamarrenolm", "createdAt": "2020-05-27T16:28:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NjQ5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "c39091b84734bd1d86552d473051f72e64625791", "chunk": "diff --git a/iidm/iidm-extensions/src/test/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlXmlSerializerTest.java b/iidm/iidm-extensions/src/test/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlXmlSerializerTest.java\nindex 0d7d01d4e..5574c26cd 100644\n--- a/iidm/iidm-extensions/src/test/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlXmlSerializerTest.java\n+++ b/iidm/iidm-extensions/src/test/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlXmlSerializerTest.java\n\n@@ -7,20 +7,14 @@\n package com.powsybl.iidm.network.extensions;\n \n import com.powsybl.commons.AbstractConverterTest;\n-import com.powsybl.iidm.export.Exporters;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.StaticVarCompensator;\n import com.powsybl.iidm.network.test.SvcTestCaseFactory;\n-import com.powsybl.iidm.xml.NetworkXml;\n import org.joda.time.DateTime;\n import org.junit.Test;\n \n import java.io.IOException;\n-import java.nio.file.Path;\n-import java.nio.file.Paths;\n-import java.util.Properties;\n \n-import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n \n /**\n"}}, {"oid": "c39091b84734bd1d86552d473051f72e64625791", "url": "https://github.com/powsybl/powsybl-core/commit/c39091b84734bd1d86552d473051f72e64625791", "message": "Fix checkstyle.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-05-27T12:53:14Z", "type": "commit"}, {"oid": "4754b3710ced0f4664c00af89bc3aed6e4b7f1e0", "url": "https://github.com/powsybl/powsybl-core/commit/4754b3710ced0f4664c00af89bc3aed6e4b7f1e0", "message": "fix namespace; fix expected value\n\nSigned-off-by: Luma <zamarrenolm@aia.es>", "committedDate": "2020-05-27T15:53:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYzMTA1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431631056", "bodyText": "There is a diffference in this check and in the check done in StaticVarCompensatorConversion.java\n        if (slope > 0) {\n            svc.newExtension(VoltagePerReactivePowerControlAdder.class).withSlope(slope);\n        }\n\nDoes 0 a valid value?", "author": "mathbagu", "createdAt": "2020-05-28T07:20:52Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.extensions.AbstractExtension;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n+ * @author Anne Tilloy <anne.tilloy at rte-france.com>\n+ */\n+public class VoltagePerReactivePowerControlImpl extends AbstractExtension<StaticVarCompensator> implements VoltagePerReactivePowerControl {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(VoltagePerReactivePowerControlImpl.class);\n+\n+    private double slope;\n+\n+    public VoltagePerReactivePowerControlImpl(StaticVarCompensator svc, double slope) {\n+        super(svc);\n+        this.slope = checkSlope(svc, slope);\n+    }\n+\n+    @Override\n+    public double getSlope() {\n+        return slope;\n+    }\n+\n+    public VoltagePerReactivePowerControl setSlope(double slope) {\n+        this.slope = slope;\n+        return this;\n+    }\n+\n+    private static double checkSlope(StaticVarCompensator svc, double slope) {\n+        if (Double.isNaN(slope)) {\n+            throw new PowsyblException(\"Undefined value for slope\");\n+        }\n+        if (slope < 0) {", "originalCommit": "4754b3710ced0f4664c00af89bc3aed6e4b7f1e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "add3adfb0e7f5f65a2d5dfe55c0b828be27d7a78", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\nindex 15f9398be..fc77f7636 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\n\n@@ -9,8 +9,6 @@ package com.powsybl.iidm.network.extensions;\n import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtension;\n import com.powsybl.iidm.network.StaticVarCompensator;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n /**\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYzMTc0Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1321#discussion_r431631742", "bodyText": "Is it OK or should we throw an exception? If we accept negative value, it will never be possible to change that. It's better to throw an exception, and then make the code more permissive.\nMoreover, in CGMES conversion, we do not create the extension if the slope is negative (or equal to 0)", "author": "mathbagu", "createdAt": "2020-05-28T07:22:11Z", "path": "iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.extensions;\n+\n+import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.extensions.AbstractExtension;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n+ * @author Anne Tilloy <anne.tilloy at rte-france.com>\n+ */\n+public class VoltagePerReactivePowerControlImpl extends AbstractExtension<StaticVarCompensator> implements VoltagePerReactivePowerControl {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(VoltagePerReactivePowerControlImpl.class);\n+\n+    private double slope;\n+\n+    public VoltagePerReactivePowerControlImpl(StaticVarCompensator svc, double slope) {\n+        super(svc);\n+        this.slope = checkSlope(svc, slope);\n+    }\n+\n+    @Override\n+    public double getSlope() {\n+        return slope;\n+    }\n+\n+    public VoltagePerReactivePowerControl setSlope(double slope) {\n+        this.slope = slope;\n+        return this;\n+    }\n+\n+    private static double checkSlope(StaticVarCompensator svc, double slope) {\n+        if (Double.isNaN(slope)) {\n+            throw new PowsyblException(\"Undefined value for slope\");\n+        }\n+        if (slope < 0) {\n+            LOGGER.debug(\"Slope value of svc {} should be positive: {}\", svc.getId(), slope);", "originalCommit": "4754b3710ced0f4664c00af89bc3aed6e4b7f1e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "add3adfb0e7f5f65a2d5dfe55c0b828be27d7a78", "chunk": "diff --git a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\nindex 15f9398be..fc77f7636 100644\n--- a/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\n+++ b/iidm/iidm-extensions/src/main/java/com/powsybl/iidm/network/extensions/VoltagePerReactivePowerControlImpl.java\n\n@@ -9,8 +9,6 @@ package com.powsybl.iidm.network.extensions;\n import com.powsybl.commons.PowsyblException;\n import com.powsybl.commons.extensions.AbstractExtension;\n import com.powsybl.iidm.network.StaticVarCompensator;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n /**\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n"}}, {"oid": "add3adfb0e7f5f65a2d5dfe55c0b828be27d7a78", "url": "https://github.com/powsybl/powsybl-core/commit/add3adfb0e7f5f65a2d5dfe55c0b828be27d7a78", "message": "Fix implementation\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-05-28T08:27:30Z", "type": "commit"}, {"oid": "a29567c16f7070cebd21fa773ce58b7ba40c7677", "url": "https://github.com/powsybl/powsybl-core/commit/a29567c16f7070cebd21fa773ce58b7ba40c7677", "message": "Merge branch 'master' into svc-slope-extension", "committedDate": "2020-05-28T11:07:46Z", "type": "commit"}, {"oid": "a125fc3b762712abef710c241b7cc7bc54dd952e", "url": "https://github.com/powsybl/powsybl-core/commit/a125fc3b762712abef710c241b7cc7bc54dd952e", "message": "Merge branch 'master' into svc-slope-extension", "committedDate": "2020-05-28T12:32:16Z", "type": "commit"}]}