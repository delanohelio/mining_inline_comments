{"pr_number": 11214, "pr_title": "[FLINK-16265][table][csv] CsvTableSourceFactoryBase should compare LogicalTypes instead of TableSchema", "pr_createdAt": "2020-02-25T13:02:24Z", "pr_url": "https://github.com/apache/flink/pull/11214", "timeline": [{"oid": "b25a5519591a0c994e7c30b8f6a3e0b693290c12", "url": "https://github.com/apache/flink/commit/b25a5519591a0c994e7c30b8f6a3e0b693290c12", "message": "[FLINK-16265][table][csv] CsvTableSourceFactoryBase should compare LogicalTypes instead of TableSchema", "committedDate": "2020-02-25T12:53:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg5OTE2MQ==", "url": "https://github.com/apache/flink/pull/11214#discussion_r383899161", "bodyText": "Maybe we can have a small utility in the class to get the LogicalType List from TableSchema? Then we don't need the long method chain.", "author": "wuchong", "createdAt": "2020-02-25T14:07:21Z", "path": "flink-table/flink-table-api-java-bridge/src/main/java/org/apache/flink/table/sources/CsvTableSourceFactoryBase.java", "diffHunk": "@@ -123,7 +126,15 @@ protected CsvTableSource createTableSource(\n \t\t\tTableSchema formatSchema = params.getTableSchema(FORMAT_FIELDS);\n \t\t\t// the CsvTableSource needs some rework first\n \t\t\t// for now the schema must be equal to the encoding\n-\t\t\tif (!formatSchema.equals(tableSchema)) {\n+\t\t\t// Ignore conversion classes in DataType\n+\t\t\tif (!Arrays\n+\t\t\t\t\t.stream(formatSchema.getFieldDataTypes())\n+\t\t\t\t\t.map(DataType::getLogicalType)\n+\t\t\t\t\t.collect(Collectors.toList())\n+\t\t\t\t\t.equals(Arrays\n+\t\t\t\t\t\t\t.stream(tableSchema.getFieldDataTypes())\n+\t\t\t\t\t\t\t.map(DataType::getLogicalType)\n+\t\t\t\t\t\t\t.collect(Collectors.toList()))) {", "originalCommit": "b25a5519591a0c994e7c30b8f6a3e0b693290c12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNjkxNw==", "url": "https://github.com/apache/flink/pull/11214#discussion_r383926917", "bodyText": "OK", "author": "JingsongLi", "createdAt": "2020-02-25T14:51:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg5OTE2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "ab0c7492448d954d48c789471379d56be3fa44ed", "chunk": "diff --git a/flink-table/flink-table-api-java-bridge/src/main/java/org/apache/flink/table/sources/CsvTableSourceFactoryBase.java b/flink-table/flink-table-api-java-bridge/src/main/java/org/apache/flink/table/sources/CsvTableSourceFactoryBase.java\nindex 4418a51af2e..972fef92cdf 100644\n--- a/flink-table/flink-table-api-java-bridge/src/main/java/org/apache/flink/table/sources/CsvTableSourceFactoryBase.java\n+++ b/flink-table/flink-table-api-java-bridge/src/main/java/org/apache/flink/table/sources/CsvTableSourceFactoryBase.java\n\n@@ -127,14 +128,8 @@ public abstract class CsvTableSourceFactoryBase implements TableFactory {\n \t\t\t// the CsvTableSource needs some rework first\n \t\t\t// for now the schema must be equal to the encoding\n \t\t\t// Ignore conversion classes in DataType\n-\t\t\tif (!Arrays\n-\t\t\t\t\t.stream(formatSchema.getFieldDataTypes())\n-\t\t\t\t\t.map(DataType::getLogicalType)\n-\t\t\t\t\t.collect(Collectors.toList())\n-\t\t\t\t\t.equals(Arrays\n-\t\t\t\t\t\t\t.stream(tableSchema.getFieldDataTypes())\n-\t\t\t\t\t\t\t.map(DataType::getLogicalType)\n-\t\t\t\t\t\t\t.collect(Collectors.toList()))) {\n+\t\t\tif (!getFieldLogicalTypes(formatSchema)\n+\t\t\t\t\t.equals(getFieldLogicalTypes(tableSchema))) {\n \t\t\t\tthrow new TableException(\n \t\t\t\t\t\"Encodings that differ from the schema are not supported yet for CsvTableSources.\");\n \t\t\t}\n"}}, {"oid": "ab0c7492448d954d48c789471379d56be3fa44ed", "url": "https://github.com/apache/flink/commit/ab0c7492448d954d48c789471379d56be3fa44ed", "message": "Fix comments", "committedDate": "2020-02-25T14:51:20Z", "type": "commit"}]}