{"pr_number": 11430, "pr_title": "[FLINK-16633][AZP] Fix builds without s3 credentials", "pr_createdAt": "2020-03-17T17:10:40Z", "pr_url": "https://github.com/apache/flink/pull/11430", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1Nzk2NQ==", "url": "https://github.com/apache/flink/pull/11430#discussion_r393857965", "bodyText": "Add a simple utility function boolean isNotEmpty(@Nullable String) that you call 3 times. This is both more readable and would've prevented bugs like in the second line below where S3_TEST_SECRET_KEY.isEmpty() is missing a negation.", "author": "zentol", "createdAt": "2020-03-17T17:42:41Z", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "diffHunk": "@@ -44,7 +44,8 @@\n \t * of this JVM.\n \t */\n \tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null;", "originalCommit": "25282859e69411e8320cb694679c1404921b5305", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE0MDI5NQ==", "url": "https://github.com/apache/flink/pull/11430#discussion_r394140295", "bodyText": "Thanks a lot. That's a very good idea :)", "author": "rmetzger", "createdAt": "2020-03-18T07:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1Nzk2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "85a7515407184f45009e7cbe7f6c7099ea4a41be", "chunk": "diff --git a/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java b/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java\nindex ac06fe3234..5642e4803d 100644\n--- a/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java\n+++ b/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java\n\n@@ -43,9 +43,15 @@ public class S3TestCredentials {\n \t * Checks whether S3 test credentials are available in the environment variables\n \t * of this JVM.\n \t */\n-\tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null\n-\t\t\t&& !S3_TEST_BUCKET.isEmpty() && !S3_TEST_ACCESS_KEY.isEmpty() && S3_TEST_SECRET_KEY.isEmpty();\n+\tprivate static boolean credentialsAvailable() {\n+\t\treturn isNotEmpty(S3_TEST_BUCKET) && isNotEmpty(S3_TEST_ACCESS_KEY) && isNotEmpty(S3_TEST_SECRET_KEY);\n+\t}\n+\n+\t/**\n+\t * Checks if a String is not null and not empty.\n+\t */\n+\tprivate static boolean isNotEmpty(@Nullable String str) {\n+\t\treturn str != null && !str.isEmpty();\n \t}\n \n \t/**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE2MTA0Nw==", "url": "https://github.com/apache/flink/pull/11430#discussion_r394161047", "bodyText": "let's make it private for no", "author": "zentol", "createdAt": "2020-03-18T07:58:09Z", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "diffHunk": "@@ -44,7 +44,14 @@\n \t * of this JVM.\n \t */\n \tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null;\n+\t\treturn isNotEmpty(S3_TEST_BUCKET) && isNotEmpty(S3_TEST_ACCESS_KEY) && isNotEmpty(S3_TEST_SECRET_KEY);\n+\t}\n+\n+\t/**\n+\t * Checks if a String is not null and not empty.\n+\t */\n+\tpublic static boolean isNotEmpty(@Nullable String str) {", "originalCommit": "4a2938805ce595d3263da2684bd8f44ff815ab36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE2NDUxMA==", "url": "https://github.com/apache/flink/pull/11430#discussion_r394164510", "bodyText": "will do", "author": "rmetzger", "createdAt": "2020-03-18T08:06:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE2MTA0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "85a7515407184f45009e7cbe7f6c7099ea4a41be", "chunk": "diff --git a/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java b/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java\nindex 526fcef98a..5642e4803d 100644\n--- a/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java\n+++ b/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java\n\n@@ -43,14 +43,14 @@ public class S3TestCredentials {\n \t * Checks whether S3 test credentials are available in the environment variables\n \t * of this JVM.\n \t */\n-\tpublic static boolean credentialsAvailable() {\n+\tprivate static boolean credentialsAvailable() {\n \t\treturn isNotEmpty(S3_TEST_BUCKET) && isNotEmpty(S3_TEST_ACCESS_KEY) && isNotEmpty(S3_TEST_SECRET_KEY);\n \t}\n \n \t/**\n \t * Checks if a String is not null and not empty.\n \t */\n-\tpublic static boolean isNotEmpty(@Nullable String str) {\n+\tprivate static boolean isNotEmpty(@Nullable String str) {\n \t\treturn str != null && !str.isEmpty();\n \t}\n \n"}}, {"oid": "85a7515407184f45009e7cbe7f6c7099ea4a41be", "url": "https://github.com/apache/flink/commit/85a7515407184f45009e7cbe7f6c7099ea4a41be", "message": "[FLINK-16633][AZP] Fix builds without s3 credentials\n\nProblem: Builds on Azure where failing if S3 credentails were not provided, because the syntax in the pipeline definition was incorrect.\n\nSolution: Use a way to access secret variables that leads to an empty value (instead of the variable name). Also, extend the check in the unit tests to \"variable empty\" instead of just \"variable not set\".", "committedDate": "2020-03-19T14:23:41Z", "type": "commit"}, {"oid": "85a7515407184f45009e7cbe7f6c7099ea4a41be", "url": "https://github.com/apache/flink/commit/85a7515407184f45009e7cbe7f6c7099ea4a41be", "message": "[FLINK-16633][AZP] Fix builds without s3 credentials\n\nProblem: Builds on Azure where failing if S3 credentails were not provided, because the syntax in the pipeline definition was incorrect.\n\nSolution: Use a way to access secret variables that leads to an empty value (instead of the variable name). Also, extend the check in the unit tests to \"variable empty\" instead of just \"variable not set\".", "committedDate": "2020-03-19T14:23:41Z", "type": "forcePushed"}]}