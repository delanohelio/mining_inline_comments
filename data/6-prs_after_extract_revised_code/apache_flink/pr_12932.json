{"pr_number": 12932, "pr_title": "[FLINK-18638][runtime] FutureUtils support timeout message", "pr_createdAt": "2020-07-19T09:25:29Z", "pr_url": "https://github.com/apache/flink/pull/12932", "timeline": [{"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80", "url": "https://github.com/apache/flink/commit/f53c211684c08a543b06c56ac5b40f5d02247a80", "message": "[FLINK-18638][runtime] FutureUtils support timeout message", "committedDate": "2020-07-20T02:19:56Z", "type": "commit"}, {"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80", "url": "https://github.com/apache/flink/commit/f53c211684c08a543b06c56ac5b40f5d02247a80", "message": "[FLINK-18638][runtime] FutureUtils support timeout message", "committedDate": "2020-07-20T02:19:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA1NjM5OA==", "url": "https://github.com/apache/flink/pull/12932#discussion_r458056398", "bodyText": "missing @Nullable", "author": "zentol", "createdAt": "2020-07-21T12:26:50Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java", "diffHunk": "@@ -439,10 +453,30 @@ public RetryException(Throwable cause) {\n \t\tlong timeout,\n \t\tTimeUnit timeUnit,\n \t\tExecutor timeoutFailExecutor) {\n+\t\treturn orTimeout(future, timeout, timeUnit, timeoutFailExecutor, null);\n+\t}\n+\n+\t/**\n+\t * Times the given future out after the timeout.\n+\t *\n+\t * @param future to time out\n+\t * @param timeout after which the given future is timed out\n+\t * @param timeUnit time unit of the timeout\n+\t * @param timeoutFailExecutor executor that will complete the future exceptionally after the timeout is reached\n+\t * @param timeoutMsg timeout message for exception\n+\t * @param <T> type of the given future\n+\t * @return The timeout enriched future\n+\t */\n+\tpublic static <T> CompletableFuture<T> orTimeout(\n+\t\tCompletableFuture<T> future,\n+\t\tlong timeout,\n+\t\tTimeUnit timeUnit,\n+\t\tExecutor timeoutFailExecutor,\n+\t\tString timeoutMsg) {", "originalCommit": "f53c211684c08a543b06c56ac5b40f5d02247a80", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5e6e136026cbcd2ab8a0ebafa1d88bc1a81e0043", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java\nindex 229e37a5715..cf49904b26c 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java\n\n@@ -472,7 +472,7 @@ public class FutureUtils {\n \t\tlong timeout,\n \t\tTimeUnit timeUnit,\n \t\tExecutor timeoutFailExecutor,\n-\t\tString timeoutMsg) {\n+\t\t@Nullable String timeoutMsg) {\n \n \t\tif (!future.isDone()) {\n \t\t\tfinal ScheduledFuture<?> timeoutFuture = Delayer.delay(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA1NzYxMw==", "url": "https://github.com/apache/flink/pull/12932#discussion_r458057613", "bodyText": "this distinction isn't necessary; new TimeoutException(timeoutMsg) will work in any case.", "author": "zentol", "createdAt": "2020-07-21T12:28:57Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java", "diffHunk": "@@ -1026,14 +1060,16 @@ public void onComplete(Throwable failure, U success) {\n \tprivate static final class Timeout implements Runnable {\n \n \t\tprivate final CompletableFuture<?> future;\n+\t\tprivate final String timeoutMsg;\n \n-\t\tprivate Timeout(CompletableFuture<?> future) {\n+\t\tprivate Timeout(CompletableFuture<?> future, @Nullable String timeoutMsg) {\n \t\t\tthis.future = checkNotNull(future);\n+\t\t\tthis.timeoutMsg = timeoutMsg;\n \t\t}\n \n \t\t@Override\n \t\tpublic void run() {\n-\t\t\tfuture.completeExceptionally(new TimeoutException());\n+\t\t\tfuture.completeExceptionally(null == timeoutMsg ? new TimeoutException() : new TimeoutException(timeoutMsg));", "originalCommit": "f53c211684c08a543b06c56ac5b40f5d02247a80", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5e6e136026cbcd2ab8a0ebafa1d88bc1a81e0043", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java\nindex 229e37a5715..cf49904b26c 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java\n\n@@ -1069,7 +1069,7 @@ public class FutureUtils {\n \n \t\t@Override\n \t\tpublic void run() {\n-\t\t\tfuture.completeExceptionally(null == timeoutMsg ? new TimeoutException() : new TimeoutException(timeoutMsg));\n+\t\t\tfuture.completeExceptionally(new TimeoutException(timeoutMsg));\n \t\t}\n \t}\n \n"}}, {"oid": "5e6e136026cbcd2ab8a0ebafa1d88bc1a81e0043", "url": "https://github.com/apache/flink/commit/5e6e136026cbcd2ab8a0ebafa1d88bc1a81e0043", "message": "[FLINK-18638][runtime] FutureUtils support timeout message", "committedDate": "2020-07-21T12:40:38Z", "type": "commit"}]}