{"pr_number": 13078, "pr_title": "[FLINK-18659][hive][orc] Fix streaming write for Hive 1.x Orc table", "pr_createdAt": "2020-08-06T13:27:21Z", "pr_url": "https://github.com/apache/flink/pull/13078", "timeline": [{"oid": "80725d93cee49427ba2502a0c8f763fc4215d4e7", "url": "https://github.com/apache/flink/commit/80725d93cee49427ba2502a0c8f763fc4215d4e7", "message": "disable tests for 2.x", "committedDate": "2020-08-07T13:12:32Z", "type": "forcePushed"}, {"oid": "7b73a977a7a5272e352b5f7af0aaefd619405290", "url": "https://github.com/apache/flink/commit/7b73a977a7a5272e352b5f7af0aaefd619405290", "message": "address comments", "committedDate": "2020-08-12T11:29:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY4NjU0NA==", "url": "https://github.com/apache/flink/pull/13078#discussion_r469686544", "bodyText": "Why dependency conflict? Can we make it correct?", "author": "JingsongLi", "createdAt": "2020-08-13T04:15:40Z", "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/connectors/hive/HiveTableSinkITCase.java", "diffHunk": "@@ -252,32 +252,45 @@ public void testBatchAppend() {\n \n \t@Test(timeout = 120000)\n \tpublic void testDefaultSerPartStreamingWrite() throws Exception {\n-\t\ttestStreamingWrite(true, false, true, this::checkSuccessFiles);\n+\t\ttestStreamingWrite(true, false, \"textfile\", this::checkSuccessFiles);\n \t}\n \n \t@Test(timeout = 120000)\n \tpublic void testPartStreamingWrite() throws Exception {\n-\t\ttestStreamingWrite(true, false, false, this::checkSuccessFiles);\n+\t\ttestStreamingWrite(true, false, \"parquet\", this::checkSuccessFiles);\n+\t\t// disable orc test for hive 2.x due to dependency conflict\n+\t\tif (!hiveCatalog.getHiveVersion().startsWith(\"2.\")) {", "originalCommit": "7b73a977a7a5272e352b5f7af0aaefd619405290", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a6a01b8e1d30909732448f37a606b70fa9a3903e", "chunk": "diff --git a/flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/connectors/hive/HiveTableSinkITCase.java b/flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/connectors/hive/HiveTableSinkITCase.java\nindex db68ebefec..ab2b2a14e3 100644\n--- a/flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/connectors/hive/HiveTableSinkITCase.java\n+++ b/flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/connectors/hive/HiveTableSinkITCase.java\n\n@@ -258,34 +258,25 @@ public class HiveTableSinkITCase {\n \t@Test(timeout = 120000)\n \tpublic void testPartStreamingWrite() throws Exception {\n \t\ttestStreamingWrite(true, false, \"parquet\", this::checkSuccessFiles);\n-\t\t// disable orc test for hive 2.x due to dependency conflict\n-\t\tif (!hiveCatalog.getHiveVersion().startsWith(\"2.\")) {\n-\t\t\ttestStreamingWrite(true, false, \"orc\", this::checkSuccessFiles);\n-\t\t}\n+\t\ttestStreamingWrite(true, false, \"orc\", this::checkSuccessFiles);\n \t}\n \n \t@Test(timeout = 120000)\n \tpublic void testNonPartStreamingWrite() throws Exception {\n \t\ttestStreamingWrite(false, false, \"parquet\", (p) -> {});\n-\t\tif (!hiveCatalog.getHiveVersion().startsWith(\"2.\")) {\n-\t\t\ttestStreamingWrite(false, false, \"orc\", (p) -> {});\n-\t\t}\n+\t\ttestStreamingWrite(false, false, \"orc\", (p) -> {});\n \t}\n \n \t@Test(timeout = 120000)\n \tpublic void testPartStreamingMrWrite() throws Exception {\n \t\ttestStreamingWrite(true, true, \"parquet\", this::checkSuccessFiles);\n-\t\tif (!hiveCatalog.getHiveVersion().startsWith(\"2.\")) {\n-\t\t\ttestStreamingWrite(true, true, \"orc\", this::checkSuccessFiles);\n-\t\t}\n+\t\ttestStreamingWrite(true, true, \"orc\", this::checkSuccessFiles);\n \t}\n \n \t@Test(timeout = 120000)\n \tpublic void testNonPartStreamingMrWrite() throws Exception {\n \t\ttestStreamingWrite(false, true, \"parquet\", (p) -> {});\n-\t\tif (!hiveCatalog.getHiveVersion().startsWith(\"2.\")) {\n-\t\t\ttestStreamingWrite(false, true, \"orc\", (p) -> {});\n-\t\t}\n+\t\ttestStreamingWrite(false, true, \"orc\", (p) -> {});\n \t}\n \n \t@Test(timeout = 120000)\n"}}, {"oid": "a6a01b8e1d30909732448f37a606b70fa9a3903e", "url": "https://github.com/apache/flink/commit/a6a01b8e1d30909732448f37a606b70fa9a3903e", "message": "[FLINK-18659][hive][orc] Fix streaming write for Hive 1.x Orc table", "committedDate": "2020-08-13T05:26:20Z", "type": "commit"}, {"oid": "0be581beac841f9e2526d92f234534f577421c2a", "url": "https://github.com/apache/flink/commit/0be581beac841f9e2526d92f234534f577421c2a", "message": "disable tests for 2.x", "committedDate": "2020-08-13T05:26:20Z", "type": "commit"}, {"oid": "5044c0e4e5643c48d2e82b35c08597d4eb71840a", "url": "https://github.com/apache/flink/commit/5044c0e4e5643c48d2e82b35c08597d4eb71840a", "message": "address comments", "committedDate": "2020-08-13T05:26:20Z", "type": "commit"}, {"oid": "abaa5793d9d611d241e91a6546b29be18fd6a1c6", "url": "https://github.com/apache/flink/commit/abaa5793d9d611d241e91a6546b29be18fd6a1c6", "message": "test mr orc writer for 2.x", "committedDate": "2020-08-13T06:39:39Z", "type": "commit"}, {"oid": "abaa5793d9d611d241e91a6546b29be18fd6a1c6", "url": "https://github.com/apache/flink/commit/abaa5793d9d611d241e91a6546b29be18fd6a1c6", "message": "test mr orc writer for 2.x", "committedDate": "2020-08-13T06:39:39Z", "type": "forcePushed"}]}