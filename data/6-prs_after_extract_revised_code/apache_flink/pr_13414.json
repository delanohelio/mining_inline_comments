{"pr_number": 13414, "pr_title": "[FLINK-19227][Table SQL / API] The catalog is still created after opening failed in catalog registering", "pr_createdAt": "2020-09-18T04:16:40Z", "pr_url": "https://github.com/apache/flink/pull/13414", "timeline": [{"oid": "f717c4cea1a1f5e382cf78980902204c4142ad66", "url": "https://github.com/apache/flink/commit/f717c4cea1a1f5e382cf78980902204c4142ad66", "message": "[FLINK-19227][Table SQL / API]\nThe catalog is still created after opening failed in catalog registering", "committedDate": "2020-09-18T04:05:01Z", "type": "commit"}, {"oid": "728e316cafb4758890db9204c6ff9773f7ed7cb8", "url": "https://github.com/apache/flink/commit/728e316cafb4758890db9204c6ff9773f7ed7cb8", "message": "[FLINK-19227][Table SQL / API]\nThe catalog is still created after opening failed in catalog registering", "committedDate": "2020-09-18T04:06:09Z", "type": "commit"}, {"oid": "5b3479227664c09f527c045ab6d3623790fe3968", "url": "https://github.com/apache/flink/commit/5b3479227664c09f527c045ab6d3623790fe3968", "message": "[FLINK-19227][Table SQL / API]\nThe catalog is still created after opening failed in catalog registering", "committedDate": "2020-09-18T04:14:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY5NTg0Ng==", "url": "https://github.com/apache/flink/pull/13414#discussion_r490695846", "bodyText": "This should not happen.", "author": "JingsongLi", "createdAt": "2020-09-18T04:31:10Z", "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java", "diffHunk": "@@ -223,6 +223,9 @@ public String getHiveVersion() {\n \tpublic void open() throws CatalogException {\n \t\tif (client == null) {\n \t\t\tclient = HiveMetastoreClientFactory.create(hiveConf, hiveVersion);\n+\t\t\tif (client == null) {", "originalCommit": "5b3479227664c09f527c045ab6d3623790fe3968", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyMTY4Mw==", "url": "https://github.com/apache/flink/pull/13414#discussion_r490721683", "bodyText": "ok,i got it and i'll remove it", "author": "zhuxiaoshang", "createdAt": "2020-09-18T06:07:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY5NTg0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "f9e87d2876259746de73a938773bf89394589c85", "chunk": "diff --git a/flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java b/flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java\nindex 3af4f7205b..e320144d0e 100644\n--- a/flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java\n+++ b/flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java\n\n@@ -223,9 +223,6 @@ public class HiveCatalog extends AbstractCatalog {\n \tpublic void open() throws CatalogException {\n \t\tif (client == null) {\n \t\t\tclient = HiveMetastoreClientFactory.create(hiveConf, hiveVersion);\n-\t\t\tif (client == null) {\n-\t\t\t\tthrow new CatalogException(\"Can not open hive catalog because create hive metastore client failed.\");\n-\t\t\t}\n \t\t\tLOG.info(\"Connected to Hive metastore\");\n \t\t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY5NjE3MQ==", "url": "https://github.com/apache/flink/pull/13414#discussion_r490696171", "bodyText": "Can you add a case for this?\nYou can create a Catalog extends GenericInMemoryCatalog and implement open to throw exception. The check the TableEnv should not contains this catalog.", "author": "JingsongLi", "createdAt": "2020-09-18T04:32:47Z", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogManager.java", "diffHunk": "@@ -187,8 +187,8 @@ public void registerCatalog(String catalogName, Catalog catalog) {\n \t\t\tthrow new CatalogException(format(\"Catalog %s already exists.\", catalogName));\n \t\t}\n \n-\t\tcatalogs.put(catalogName, catalog);\n \t\tcatalog.open();\n+\t\tcatalogs.put(catalogName, catalog);", "originalCommit": "5b3479227664c09f527c045ab6d3623790fe3968", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyMzI1Mg==", "url": "https://github.com/apache/flink/pull/13414#discussion_r490723252", "bodyText": "thanks for your suggestions.i'll add a test case.", "author": "zhuxiaoshang", "createdAt": "2020-09-18T06:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY5NjE3MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f9e87d2876259746de73a938773bf89394589c85", "url": "https://github.com/apache/flink/commit/f9e87d2876259746de73a938773bf89394589c85", "message": "[FLINK-19227][Table SQL / API]\nThe catalog is still created after opening failed in catalog registering", "committedDate": "2020-09-18T09:31:47Z", "type": "commit"}, {"oid": "3a8d1da418973c5a1028217802353fd20fc70a6b", "url": "https://github.com/apache/flink/commit/3a8d1da418973c5a1028217802353fd20fc70a6b", "message": "fix checkstyle problem", "committedDate": "2020-09-18T11:02:21Z", "type": "commit"}, {"oid": "b392f6aff314ad8acd9e6d720e390cfc00e026ef", "url": "https://github.com/apache/flink/commit/b392f6aff314ad8acd9e6d720e390cfc00e026ef", "message": "fix checkstyle problem", "committedDate": "2020-09-18T12:20:19Z", "type": "commit"}]}