{"pr_number": 13175, "pr_title": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message", "pr_createdAt": "2020-08-17T11:46:40Z", "pr_url": "https://github.com/apache/flink/pull/13175", "timeline": [{"oid": "eded77e663409ce1c6436ec7217fc93ce6520eb8", "url": "https://github.com/apache/flink/commit/eded77e663409ce1c6436ec7217fc93ce6520eb8", "message": "[FLINK-18955] Add checkpoint path to job startup/restore message", "committedDate": "2020-08-18T03:42:31Z", "type": "forcePushed"}, {"oid": "755d0eb542a50f3a7c9e58d19325f489cb113d19", "url": "https://github.com/apache/flink/commit/755d0eb542a50f3a7c9e58d19325f489cb113d19", "message": "[FLINK-18955][Runtime] Add checkpoint path to job startup/restore message", "committedDate": "2020-08-18T03:45:35Z", "type": "forcePushed"}, {"oid": "0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "url": "https://github.com/apache/flink/commit/0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message", "committedDate": "2020-08-18T03:46:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NzQxOA==", "url": "https://github.com/apache/flink/pull/13175#discussion_r472987418", "bodyText": "I don't really see how @NicoK 's suggestion makes it clearer that it could also be a savepoint.\nMy suggestion would be to encode the type checkpoint/savepoint into CompletedCheckpoint#toString and just use: LOG.info(\"Restoring job {} from  {}.\", job, latest);.\nThen the full message would be\n8004 [flink-akka.actor.default-dispatcher-3] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator [] - Restoring job 36681198e38a2c91932eb131f47e3641 from Checkpoint 1 @ 1597663438566 for 36681198e38a2c91932eb131f47e3641 located at file:/var/folders/dm/5xn_h6n9135dwy4j27sr65zh0000gp/T/junit492898918775365121/junit2392379173263601046/checkpoints/36681198e38a2c91932eb131f47e3641/chk-1.\n\ninstead of\n8004 [flink-akka.actor.default-dispatcher-3] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator [] - Restoring job 36681198e38a2c91932eb131f47e3641 from checkpoint: Checkpoint 1 @ 1597663438566 for 36681198e38a2c91932eb131f47e3641 located at file:/var/folders/dm/5xn_h6n9135dwy4j27sr65zh0000gp/T/junit492898918775365121/junit2392379173263601046/checkpoints/36681198e38a2c91932eb131f47e3641/chk-1.", "author": "AHeise", "createdAt": "2020-08-19T12:23:16Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java", "diffHunk": "@@ -1293,7 +1293,7 @@ private boolean restoreLatestCheckpointedStateInternal(\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tLOG.info(\"Restoring job {} from latest valid checkpoint: {}.\", job, latest);\n+\t\t\tLOG.info(\"Restoring job {} from checkpoint: {}.\", job, latest);", "originalCommit": "0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2OTY5MA==", "url": "https://github.com/apache/flink/pull/13175#discussion_r473569690", "bodyText": "That's a good idea!", "author": "curcur", "createdAt": "2020-08-20T03:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NzQxOA=="}], "type": "inlineReview", "revised_code": {"commit": "635f839466122e36674a38a9845c2d6b5eb5c244", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java\nindex 5ffa76b8669..8c42822b728 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java\n\n@@ -1293,7 +1293,7 @@ public class CheckpointCoordinator {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tLOG.info(\"Restoring job {} from checkpoint: {}.\", job, latest);\n+\t\t\tLOG.info(\"Restoring job {} from {}.\", job, latest);\n \n \t\t\t// re-assign the task states\n \t\t\tfinal Map<OperatorID, OperatorState> operatorStates = latest.getOperatorStates();\n"}}, {"oid": "635f839466122e36674a38a9845c2d6b5eb5c244", "url": "https://github.com/apache/flink/commit/635f839466122e36674a38a9845c2d6b5eb5c244", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message", "committedDate": "2020-08-20T04:46:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc2NjIwOQ==", "url": "https://github.com/apache/flink/pull/13175#discussion_r473766209", "bodyText": "Currently that would display:\n\"CHECKPOINT\"\n\"SAVEPOINT\"\n\"SYNC_SAVEPOINT\"\nI'm proposing to translate them into just \"Checkpoint\" and \"Savepoint\" to reduce the technicality. However, no strong feelings, so you can also convince me that it's better to leave as is.", "author": "AHeise", "createdAt": "2020-08-20T08:36:19Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CompletedCheckpoint.java", "diffHunk": "@@ -320,6 +320,12 @@ void setDiscardCallback(@Nullable CompletedCheckpointStats.DiscardCallback disca\n \n \t@Override\n \tpublic String toString() {\n-\t\treturn String.format(\"Checkpoint %d @ %d for %s\", checkpointID, timestamp, job);\n+\t\treturn String.format(\n+\t\t\t\"%s %d @ %d for %s located at %s\",\n+\t\t\tprops.getCheckpointType(),", "originalCommit": "635f839466122e36674a38a9845c2d6b5eb5c244", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkyOTg0NA==", "url": "https://github.com/apache/flink/pull/13175#discussion_r473929844", "bodyText": "I do not have a strong opinion on this as well. But since you ask, let me have a try LOL :-)\nThe only concern is that we \"might\" have more types in the future\n\ncheckpoint or savepoint; 2. Synchronous or not; 3. Global or Individual; 4. unaligned or not (I mean it could be);\n\n\nIt is a bit difficult to categorize the enum of CheckpointType to just \"Checkpoint\" and \"Savepoint\"\nIt is also difficult to tell what level of technicality a user needs. Or in other words, if we think SYNC_SAVEPOINT is not that understandable, we can improve its expressiveness.", "author": "curcur", "createdAt": "2020-08-20T12:24:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc2NjIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzNTc2Mg==", "url": "https://github.com/apache/flink/pull/13175#discussion_r473935762", "bodyText": "Please let me know what do you think :-). I would be happy to change it.", "author": "curcur", "createdAt": "2020-08-20T12:35:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc2NjIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE1NDg1Mg==", "url": "https://github.com/apache/flink/pull/13175#discussion_r474154852", "bodyText": "I guess having a bit technicality in the log should be okay.\nAnother easy fix would be to override the toString in the checkpoint type and output it in more readable form.\n\"Checkpoint\"\n\"Savepoint\"\n\"Savepoint (sync)\"\nI also don't know if SYNC_SAVEPOINT would appear in materialized checkpoint at all - might be also some transient information that gets replaced by SAVEPOINT on recovery?", "author": "AHeise", "createdAt": "2020-08-20T17:28:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc2NjIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxNjcxNg==", "url": "https://github.com/apache/flink/pull/13175#discussion_r474816716", "bodyText": "updated :-)\nI can double-check whether SYNC_SAVEPOINT is user-aware or not.", "author": "curcur", "createdAt": "2020-08-21T16:57:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc2NjIwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CompletedCheckpoint.java b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CompletedCheckpoint.java\nindex 27ddb024551..d79cab42646 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CompletedCheckpoint.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CompletedCheckpoint.java\n\n@@ -322,7 +322,7 @@ public class CompletedCheckpoint implements Serializable {\n \tpublic String toString() {\n \t\treturn String.format(\n \t\t\t\"%s %d @ %d for %s located at %s\",\n-\t\t\tprops.getCheckpointType(),\n+\t\t\tprops.getCheckpointType().getName(),\n \t\t\tcheckpointID,\n \t\t\ttimestamp,\n \t\t\tjob,\n"}}, {"oid": "78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "url": "https://github.com/apache/flink/commit/78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message", "committedDate": "2020-08-21T16:55:45Z", "type": "commit"}, {"oid": "78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "url": "https://github.com/apache/flink/commit/78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message", "committedDate": "2020-08-21T16:55:45Z", "type": "forcePushed"}]}