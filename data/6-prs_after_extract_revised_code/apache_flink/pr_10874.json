{"pr_number": 10874, "pr_title": "[FLINK-15552][table api] parameters --library and --jar doesn't work for DDL in sqlClient", "pr_createdAt": "2020-01-16T14:46:09Z", "pr_url": "https://github.com/apache/flink/pull/10874", "timeline": [{"oid": "d55a80e9da0760f4a1d39ff60f50ac9cb8e40557", "url": "https://github.com/apache/flink/commit/d55a80e9da0760f4a1d39ff60f50ac9cb8e40557", "message": "[FLINK-15552][table api] parameters --library and --jar doesn't work for DDL in sqlClient", "committedDate": "2020-01-16T14:39:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczODc0NA==", "url": "https://github.com/apache/flink/pull/10874#discussion_r367738744", "bodyText": "We can simplify it a bit more:\n\t\t\tClassLoader cl = classLoader.orElse(Thread.currentThread().getContextClassLoader());\n\t\t\tServiceLoader\n\t\t\t\t.load(TableFactory.class, cl)\n\t\t\t\t.iterator()\n\t\t\t\t.forEachRemaining(result::add);", "author": "wuchong", "createdAt": "2020-01-17T02:03:48Z", "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/TableFactoryService.java", "diffHunk": "@@ -214,7 +213,10 @@\n \t\t\t\t\t.iterator()\n \t\t\t\t\t.forEachRemaining(result::add);\n \t\t\t} else {\n-\t\t\t\tdefaultLoader.iterator().forEachRemaining(result::add);\n+\t\t\t\tServiceLoader\n+\t\t\t\t\t.load(TableFactory.class, Thread.currentThread().getContextClassLoader())\n+\t\t\t\t\t.iterator()\n+\t\t\t\t\t.forEachRemaining(result::add);\n \t\t\t}", "originalCommit": "d55a80e9da0760f4a1d39ff60f50ac9cb8e40557", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc0MDU1Mw==", "url": "https://github.com/apache/flink/pull/10874#discussion_r367740553", "bodyText": "nice tips", "author": "leonardBang", "createdAt": "2020-01-17T02:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczODc0NA=="}], "type": "inlineReview", "revised_code": {"commit": "c956c947157110421ea2a1f29f1d0d67040875cd", "chunk": "diff --git a/flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/TableFactoryService.java b/flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/TableFactoryService.java\nindex d8021249b70..db3b00f5f26 100644\n--- a/flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/TableFactoryService.java\n+++ b/flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/TableFactoryService.java\n\n@@ -207,17 +207,11 @@ public class TableFactoryService {\n \tprivate static List<TableFactory> discoverFactories(Optional<ClassLoader> classLoader) {\n \t\ttry {\n \t\t\tList<TableFactory> result = new LinkedList<>();\n-\t\t\tif (classLoader.isPresent()) {\n-\t\t\t\tServiceLoader\n-\t\t\t\t\t.load(TableFactory.class, classLoader.get())\n-\t\t\t\t\t.iterator()\n-\t\t\t\t\t.forEachRemaining(result::add);\n-\t\t\t} else {\n-\t\t\t\tServiceLoader\n-\t\t\t\t\t.load(TableFactory.class, Thread.currentThread().getContextClassLoader())\n-\t\t\t\t\t.iterator()\n-\t\t\t\t\t.forEachRemaining(result::add);\n-\t\t\t}\n+\t\t\tClassLoader cl = classLoader.orElse(Thread.currentThread().getContextClassLoader());\n+\t\t\tServiceLoader\n+\t\t\t\t.load(TableFactory.class, cl)\n+\t\t\t\t.iterator()\n+\t\t\t\t.forEachRemaining(result::add);\n \t\t\treturn result;\n \t\t} catch (ServiceConfigurationError e) {\n \t\t\tLOG.error(\"Could not load service provider for table factories.\", e);\n"}}, {"oid": "c956c947157110421ea2a1f29f1d0d67040875cd", "url": "https://github.com/apache/flink/commit/c956c947157110421ea2a1f29f1d0d67040875cd", "message": "1.fix ScalaShellITcase 2. address comment", "committedDate": "2020-01-17T08:56:59Z", "type": "commit"}, {"oid": "0012c39e883a1d1685dd1f09d08d460370b82151", "url": "https://github.com/apache/flink/commit/0012c39e883a1d1685dd1f09d08d460370b82151", "message": "fix typo", "committedDate": "2020-01-17T10:10:47Z", "type": "commit"}]}