{"pr_number": 11031, "pr_title": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs", "pr_createdAt": "2020-02-06T11:00:02Z", "pr_url": "https://github.com/apache/flink/pull/11031", "timeline": [{"oid": "ac4930965a7f64c4db1ec2d8ef3d7838dd6ec46f", "url": "https://github.com/apache/flink/commit/ac4930965a7f64c4db1ec2d8ef3d7838dd6ec46f", "message": "[hotfix][task] Fix the comment typo in TwoInputStreamTask class", "committedDate": "2020-02-06T10:33:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg0MDkwNQ==", "url": "https://github.com/apache/flink/pull/11031#discussion_r375840905", "bodyText": "? It's not used anywhere in the tests, isn't it?", "author": "pnowojski", "createdAt": "2020-02-06T13:45:27Z", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointedInputGate.java", "diffHunk": "@@ -233,15 +234,17 @@ public long getLatestCheckpointId() {\n \t *\n \t * @return The duration in nanoseconds\n \t */\n-\tpublic long getAlignmentDurationNanos() {\n+\t@VisibleForTesting", "originalCommit": "80543b67036d2b2d589bfc677e583199b96e4a61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI1MTgwMw==", "url": "https://github.com/apache/flink/pull/11031#discussion_r376251803", "bodyText": "It is actually used in many tests in CheckpointBarrierAlignerTestBase. I ever tried to refactor these tests to use these two methods from CheckpointBarrierHandler directly, then we can remove them from CheckpointedInputGate. But it would bring more refactoring work after checking the codes for exposing the CheckpointBarrierHandler while constructing the gate. So I still keep the current way now.", "author": "zhijiangW", "createdAt": "2020-02-07T07:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg0MDkwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI3ODU1OQ==", "url": "https://github.com/apache/flink/pull/11031#discussion_r376278559", "bodyText": "Ops, sorry for the confusion. I thought that you were changed this from private to @VisibleForTesting for some test that you didn't commit, while it was public before. Please ignore my comment.", "author": "pnowojski", "createdAt": "2020-02-07T08:58:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg0MDkwNQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "e8db1410acaf945d236051761f928931633bea84", "url": "https://github.com/apache/flink/commit/e8db1410acaf945d236051761f928931633bea84", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.", "committedDate": "2020-02-10T05:58:25Z", "type": "forcePushed"}, {"oid": "c411f7735ea814410840a46ecfde839340d4cf3b", "url": "https://github.com/apache/flink/commit/c411f7735ea814410840a46ecfde839340d4cf3b", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.", "committedDate": "2020-02-10T06:09:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk2MzUzOA==", "url": "https://github.com/apache/flink/pull/11031#discussion_r376963538", "bodyText": "nit: I think we do not allow wildcard imports", "author": "pnowojski", "createdAt": "2020-02-10T10:00:05Z", "path": "flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTaskTest.java", "diffHunk": "@@ -51,14 +53,14 @@\n import org.apache.flink.streaming.util.TestBoundedTwoInputOperator;\n import org.apache.flink.streaming.util.TestHarnessUtil;\n \n+import org.hamcrest.collection.IsMapContaining;\n import org.junit.Assert;\n import org.junit.Test;\n \n-import java.util.Arrays;\n-import java.util.HashSet;\n-import java.util.List;\n+import java.util.*;", "originalCommit": "c411f7735ea814410840a46ecfde839340d4cf3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MTkzMQ==", "url": "https://github.com/apache/flink/pull/11031#discussion_r376971931", "bodyText": "Yes, my home mac setting was wrong, did it automatically. I will fix it.", "author": "zhijiangW", "createdAt": "2020-02-10T10:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk2MzUzOA=="}], "type": "inlineReview", "revised_code": {"commit": "5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "chunk": "diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTaskTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTaskTest.java\nindex ad48395a17..d8175ef1a0 100644\n--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTaskTest.java\n+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTaskTest.java\n\n@@ -57,7 +57,11 @@ import org.hamcrest.collection.IsMapContaining;\n import org.junit.Assert;\n import org.junit.Test;\n \n-import java.util.*;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n import java.util.concurrent.ConcurrentLinkedQueue;\n \n import static org.hamcrest.MatcherAssert.assertThat;\n"}}, {"oid": "5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "url": "https://github.com/apache/flink/commit/5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.", "committedDate": "2020-02-10T14:06:39Z", "type": "forcePushed"}, {"oid": "54550e7b277e46737782f8c5844ca12c5cc517c3", "url": "https://github.com/apache/flink/commit/54550e7b277e46737782f8c5844ca12c5cc517c3", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.", "committedDate": "2020-02-11T03:41:51Z", "type": "forcePushed"}, {"oid": "a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "url": "https://github.com/apache/flink/commit/a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.", "committedDate": "2020-02-11T07:47:08Z", "type": "commit"}, {"oid": "a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "url": "https://github.com/apache/flink/commit/a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.", "committedDate": "2020-02-11T07:47:08Z", "type": "forcePushed"}]}