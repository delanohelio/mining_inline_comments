{"pr_number": 11123, "pr_title": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.", "pr_createdAt": "2020-02-18T13:18:34Z", "pr_url": "https://github.com/apache/flink/pull/11123", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY5MTYwOQ==", "url": "https://github.com/apache/flink/pull/11123#discussion_r380691609", "bodyText": "add a note that this can be removed once Java8 support is dropped?", "author": "zentol", "createdAt": "2020-02-18T14:06:25Z", "path": "flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.xml.sax.helpers;\n+\n+import org.apache.xerces.jaxp.SAXParserFactoryImpl;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.XMLReader;\n+\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.parsers.SAXParserFactory;\n+\n+/**\n+ * Workaround for JDK-8015099, this factory always provides a bundled xerces parser for plugins.\n+ *\n+ * <p>Will provide a proper isolation for all kinds of different setups (other sax parser in lib or bundled in user\n+ * code).\n+ */\n+public class XMLReaderFactory {", "originalCommit": "83b98e39b163308ede9d79d2f905d6c12f23203b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d9e9614f86446ec1de22bdb4bc641e78f8725d39", "chunk": "diff --git a/flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java b/flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java\nindex b967e01ad2..79e236054f 100644\n--- a/flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java\n+++ b/flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java\n\n@@ -29,6 +29,8 @@ import javax.xml.parsers.SAXParserFactory;\n  *\n  * <p>Will provide a proper isolation for all kinds of different setups (other sax parser in lib or bundled in user\n  * code).\n+ *\n+ * <p>Note that this class can be completely removed once we drop Java 8. (FLINK-16014)\n  */\n public class XMLReaderFactory {\n \tprivate static final SAXParserFactory FACTORY = SAXParserFactoryImpl.newInstance();\n"}}, {"oid": "d9e9614f86446ec1de22bdb4bc641e78f8725d39", "url": "https://github.com/apache/flink/commit/d9e9614f86446ec1de22bdb4bc641e78f8725d39", "message": "[FLINK-16014] Adding xerces to s3 plugins to avoid ClassNotFound issues.\n\nRoot cause is a bug in JDK8. `XMLReaderFactory` caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.\nAlso overwriting the faulty `XMLReaderFactory` in the plugins with a non-caching implementation that only loads the bundled xerces.", "committedDate": "2020-02-19T13:30:21Z", "type": "forcePushed"}, {"oid": "385ebf4f1ad02ea7a62b2f6fadd54cd1fa6121e2", "url": "https://github.com/apache/flink/commit/385ebf4f1ad02ea7a62b2f6fadd54cd1fa6121e2", "message": "[FLINK-16014] Adding xerces to s3 plugins to avoid ClassNotFound issues.\n\nRoot cause is a bug in JDK8. `XMLReaderFactory` caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.\nAlso overwriting the faulty `XMLReaderFactory` in the plugins with a non-caching implementation that only loads the bundled xerces.", "committedDate": "2020-02-19T13:31:18Z", "type": "forcePushed"}, {"oid": "128a485e9c65cb7b24f5e48400ff830af16ff620", "url": "https://github.com/apache/flink/commit/128a485e9c65cb7b24f5e48400ff830af16ff620", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-02-27T13:42:10Z", "type": "forcePushed"}, {"oid": "3b18e6f5ff641afd27cfeccb5236a52f1e844498", "url": "https://github.com/apache/flink/commit/3b18e6f5ff641afd27cfeccb5236a52f1e844498", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-02-28T15:09:56Z", "type": "forcePushed"}, {"oid": "05703e66f5eeb89e476145d40538684c0926908d", "url": "https://github.com/apache/flink/commit/05703e66f5eeb89e476145d40538684c0926908d", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-03-04T08:22:03Z", "type": "forcePushed"}, {"oid": "95e457e1d10f8c7b0de7e52fef42f6ac029912a6", "url": "https://github.com/apache/flink/commit/95e457e1d10f8c7b0de7e52fef42f6ac029912a6", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-03-04T10:55:08Z", "type": "forcePushed"}, {"oid": "3d28892370884e69d1dfa550c69fd664d0053fdd", "url": "https://github.com/apache/flink/commit/3d28892370884e69d1dfa550c69fd664d0053fdd", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-03-04T19:25:33Z", "type": "forcePushed"}, {"oid": "bd9da339fdfee9967e478154bf127976b7a333b5", "url": "https://github.com/apache/flink/commit/bd9da339fdfee9967e478154bf127976b7a333b5", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-03-05T15:11:52Z", "type": "forcePushed"}, {"oid": "86c767d21b0e1b49e068fb086741776aa7d56b3e", "url": "https://github.com/apache/flink/commit/86c767d21b0e1b49e068fb086741776aa7d56b3e", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-03-06T16:56:47Z", "type": "commit"}, {"oid": "86c767d21b0e1b49e068fb086741776aa7d56b3e", "url": "https://github.com/apache/flink/commit/86c767d21b0e1b49e068fb086741776aa7d56b3e", "message": "[FLINK-16014][s3] Force usage of SAXParserFactory over XMLReaderFactory in aws-java-sdk-s3.\n\nThis avoids a ClassNotFound exception of the underlying XML reader class in plugin classloaders.\nRoot cause is a bug in JDK8 (JDK-8015099). XMLReaderFactory caches the class name independent of the classloader. On EMR, xercesImpl is on classpath (because of HDFS) and will be loaded at some point in time.", "committedDate": "2020-03-06T16:56:47Z", "type": "forcePushed"}]}