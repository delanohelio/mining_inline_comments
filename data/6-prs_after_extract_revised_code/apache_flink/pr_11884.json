{"pr_number": 11884, "pr_title": "[FLINK-17345][python][table] Support register and get Python UDF in Catalog.", "pr_createdAt": "2020-04-23T12:18:07Z", "pr_url": "https://github.com/apache/flink/pull/11884", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg3OTU5MQ==", "url": "https://github.com/apache/flink/pull/11884#discussion_r413879591", "bodyText": "Could you explain the aim of this change? It seems to me there is no difference between the changed logic and the original logic.", "author": "dianfu", "createdAt": "2020-04-23T15:08:43Z", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/FunctionCatalog.java", "diffHunk": "@@ -194,22 +194,32 @@ public void registerCatalogFunction(\n \t\t\tUnresolvedIdentifier unresolvedIdentifier,\n \t\t\tClass<? extends UserDefinedFunction> functionClass,\n \t\t\tboolean ignoreIfExists) {\n-\t\tfinal ObjectIdentifier identifier = catalogManager.qualifyIdentifier(unresolvedIdentifier);\n-\t\tfinal ObjectIdentifier normalizedIdentifier = FunctionIdentifier.normalizeObjectIdentifier(identifier);\n \n \t\ttry {\n \t\t\tUserDefinedFunctionHelper.validateClass(functionClass);\n \t\t} catch (Throwable t) {\n \t\t\tthrow new ValidationException(\n \t\t\t\tString.format(\n \t\t\t\t\t\"Could not register catalog function '%s' due to implementation errors.\",\n-\t\t\t\t\tidentifier.asSummaryString()),\n+\t\t\t\t\tcatalogManager.qualifyIdentifier(unresolvedIdentifier).asSummaryString()),\n \t\t\t\tt);\n \t\t}\n \n-\t\tfinal Catalog catalog = catalogManager.getCatalog(normalizedIdentifier.getCatalogName())\n-\t\t\t.orElseThrow(IllegalStateException::new);\n-\t\tfinal ObjectPath path = identifier.toObjectPath();\n+\t\tfinal CatalogFunction catalogFunction = new CatalogFunctionImpl(", "originalCommit": "ecd663181bfe20940c7c2ff311100f9007316392", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1NTA4MQ==", "url": "https://github.com/apache/flink/pull/11884#discussion_r414255081", "bodyText": "The initial reason of this change is provide an approach in FunctionCatalog to register Python CatalogFunction. But it seems not necessary now because the upper layer accesses the Catalog object directly.", "author": "WeiZhong94", "createdAt": "2020-04-24T02:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg3OTU5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "570f7e22326fc2f2d9f7dff4066192b604e7c479", "chunk": "diff --git a/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/FunctionCatalog.java b/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/FunctionCatalog.java\nindex 9437942e18..a6ab333c73 100644\n--- a/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/FunctionCatalog.java\n+++ b/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/FunctionCatalog.java\n\n@@ -194,6 +194,8 @@ public final class FunctionCatalog {\n \t\t\tUnresolvedIdentifier unresolvedIdentifier,\n \t\t\tClass<? extends UserDefinedFunction> functionClass,\n \t\t\tboolean ignoreIfExists) {\n+\t\tfinal ObjectIdentifier identifier = catalogManager.qualifyIdentifier(unresolvedIdentifier);\n+\t\tfinal ObjectIdentifier normalizedIdentifier = FunctionIdentifier.normalizeObjectIdentifier(identifier);\n \n \t\ttry {\n \t\t\tUserDefinedFunctionHelper.validateClass(functionClass);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg4NDg0Mg==", "url": "https://github.com/apache/flink/pull/11884#discussion_r413884842", "bodyText": "What's the aim of this change?", "author": "dianfu", "createdAt": "2020-04-23T15:14:32Z", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogFunctionImpl.java", "diffHunk": "@@ -67,6 +67,9 @@ public CatalogFunction copy() {\n \n \t@Override\n \tpublic boolean isGeneric() {\n+\t\tif (functionLanguage == FunctionLanguage.PYTHON) {", "originalCommit": "ecd663181bfe20940c7c2ff311100f9007316392", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1NDIwMQ==", "url": "https://github.com/apache/flink/pull/11884#discussion_r414254201", "bodyText": "Currently the Python UDF is always generic and can not be loaded via Class.forName. So just return true if the CatalogFunction is a Python UDF.", "author": "WeiZhong94", "createdAt": "2020-04-24T02:52:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg4NDg0Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "570f7e22326fc2f2d9f7dff4066192b604e7c479", "url": "https://github.com/apache/flink/commit/570f7e22326fc2f2d9f7dff4066192b604e7c479", "message": "[FLINK-17345][python][table] Support register and get Python UDF in Catalog.", "committedDate": "2020-04-24T02:00:56Z", "type": "forcePushed"}, {"oid": "3579637b38484fb5589c309fea8e803ad3c2e4e0", "url": "https://github.com/apache/flink/commit/3579637b38484fb5589c309fea8e803ad3c2e4e0", "message": "[FLINK-17345][python][table] Support register and get Python UDF in Catalog.", "committedDate": "2020-04-24T02:51:03Z", "type": "forcePushed"}, {"oid": "78e23cbb5c0ec424f89a83bffa5146e428237fea", "url": "https://github.com/apache/flink/commit/78e23cbb5c0ec424f89a83bffa5146e428237fea", "message": "[FLINK-17345][python][table] Support register and get Python UDF in Catalog.", "committedDate": "2020-04-24T07:21:54Z", "type": "commit"}, {"oid": "78e23cbb5c0ec424f89a83bffa5146e428237fea", "url": "https://github.com/apache/flink/commit/78e23cbb5c0ec424f89a83bffa5146e428237fea", "message": "[FLINK-17345][python][table] Support register and get Python UDF in Catalog.", "committedDate": "2020-04-24T07:21:54Z", "type": "forcePushed"}]}