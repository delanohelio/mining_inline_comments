{"pr_number": 10801, "pr_title": "[FLINK-15521][e2e] Follow symbolic link when copying distribution", "pr_createdAt": "2020-01-08T15:41:47Z", "pr_url": "https://github.com/apache/flink/pull/10801", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgxNTkxOA==", "url": "https://github.com/apache/flink/pull/10801#discussion_r365815918", "bodyText": "Why are we swallowing the exception if targetDir is a directory?", "author": "GJL", "createdAt": "2020-01-13T13:56:08Z", "path": "flink-end-to-end-tests/flink-end-to-end-tests-common/src/main/java/org/apache/flink/tests/util/TestUtils.java", "diffHunk": "@@ -87,15 +89,15 @@ public static Path getResourceJar(final String jarNameRegex) {\n \t * @throws IOException if any IO error happen.\n \t */\n \tpublic static Path copyDirectory(final Path source, final Path destination) throws IOException {\n-\t\tFiles.walkFileTree(source, new SimpleFileVisitor<Path>() {\n+\t\tFiles.walkFileTree(source, EnumSet.of(FileVisitOption.FOLLOW_LINKS), Integer.MAX_VALUE, new SimpleFileVisitor<Path>() {\n \t\t\t@Override\n \t\t\tpublic FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes ignored)\n \t\t\t\tthrows IOException {\n-\t\t\t\tfinal Path targetRir = destination.resolve(source.relativize(dir));\n+\t\t\t\tfinal Path targetDir = destination.resolve(source.relativize(dir));\n \t\t\t\ttry {\n-\t\t\t\t\tFiles.copy(dir, targetRir, StandardCopyOption.COPY_ATTRIBUTES);\n+\t\t\t\t\tFiles.copy(dir, targetDir, StandardCopyOption.COPY_ATTRIBUTES);\n \t\t\t\t} catch (FileAlreadyExistsException e) {\n-\t\t\t\t\tif (!Files.isDirectory(targetRir)) {\n+\t\t\t\t\tif (!Files.isDirectory(targetDir)) {", "originalCommit": "ee810d1cbf22046bb237506c74e885a6c29b4b5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNDEyNA==", "url": "https://github.com/apache/flink/pull/10801#discussion_r366814124", "bodyText": "I have to guess since it's been a while, but I suppose the idea is that if a file already exists it is likely that the contents are different (hence affecting the correctness of the operation), while this is not the case for directories generally.", "author": "zentol", "createdAt": "2020-01-15T10:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgxNTkxOA=="}], "type": "inlineReview", "revised_code": {"commit": "477801152391133d8ee7ff4543f6a1ed972f38a7", "chunk": "diff --git a/flink-end-to-end-tests/flink-end-to-end-tests-common/src/main/java/org/apache/flink/tests/util/TestUtils.java b/flink-end-to-end-tests/flink-end-to-end-tests-common/src/main/java/org/apache/flink/tests/util/TestUtils.java\nindex 9f3c9334dc..7bc63da26d 100644\n--- a/flink-end-to-end-tests/flink-end-to-end-tests-common/src/main/java/org/apache/flink/tests/util/TestUtils.java\n+++ b/flink-end-to-end-tests/flink-end-to-end-tests-common/src/main/java/org/apache/flink/tests/util/TestUtils.java\n\n@@ -93,11 +93,11 @@ public enum TestUtils {\n \t\t\t@Override\n \t\t\tpublic FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes ignored)\n \t\t\t\tthrows IOException {\n-\t\t\t\tfinal Path targetDir = destination.resolve(source.relativize(dir));\n+\t\t\t\tfinal Path targetRir = destination.resolve(source.relativize(dir));\n \t\t\t\ttry {\n-\t\t\t\t\tFiles.copy(dir, targetDir, StandardCopyOption.COPY_ATTRIBUTES);\n+\t\t\t\t\tFiles.copy(dir, targetRir, StandardCopyOption.COPY_ATTRIBUTES);\n \t\t\t\t} catch (FileAlreadyExistsException e) {\n-\t\t\t\t\tif (!Files.isDirectory(targetDir)) {\n+\t\t\t\t\tif (!Files.isDirectory(targetRir)) {\n \t\t\t\t\t\tthrow e;\n \t\t\t\t\t}\n \t\t\t\t}\n"}}, {"oid": "477801152391133d8ee7ff4543f6a1ed972f38a7", "url": "https://github.com/apache/flink/commit/477801152391133d8ee7ff4543f6a1ed972f38a7", "message": "[FLINK-15521][e2e] Follow symbolic link when copying distribution", "committedDate": "2020-01-15T15:41:25Z", "type": "commit"}, {"oid": "47607178f852dfe950ce979a6d215c74c178235c", "url": "https://github.com/apache/flink/commit/47607178f852dfe950ce979a6d215c74c178235c", "message": "[hotfix][tests] Fix typo", "committedDate": "2020-01-15T15:41:25Z", "type": "commit"}, {"oid": "47607178f852dfe950ce979a6d215c74c178235c", "url": "https://github.com/apache/flink/commit/47607178f852dfe950ce979a6d215c74c178235c", "message": "[hotfix][tests] Fix typo", "committedDate": "2020-01-15T15:41:25Z", "type": "forcePushed"}]}