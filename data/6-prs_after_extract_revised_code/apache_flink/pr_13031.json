{"pr_number": 13031, "pr_title": "[FLINK-18773][runtime] Enables parallel user-code and plugin class loader.", "pr_createdAt": "2020-07-30T13:31:57Z", "pr_url": "https://github.com/apache/flink/pull/13031", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg2NDU4Mw==", "url": "https://github.com/apache/flink/pull/13031#discussion_r466864583", "bodyText": "what's this change about?", "author": "zentol", "createdAt": "2020-08-07T07:16:06Z", "path": "flink-core/src/main/java/org/apache/flink/util/ChildFirstClassLoader.java", "diffHunk": "@@ -73,9 +71,7 @@ public ChildFirstClassLoader(\n \t\t\t\t// let URLClassLoader do it, which will eventually call the parent\n \t\t\t\tc = super.loadClassWithoutExceptionHandling(name, resolve);\n \t\t\t}\n-\t\t}\n-\n-\t\tif (resolve) {\n+\t\t} else if (resolve) {", "originalCommit": "eda9fa6842aa8a78d0868d9946bd90077d3af3fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk5MjY3MA==", "url": "https://github.com/apache/flink/pull/13031#discussion_r466992670", "bodyText": "It's a small performance optimization (should probably go in a separate hotfix commit). The typical class loading pattern indeed has this trailing resolution with an if, but in ChildFirstClassLoader, the resolution already happens at super.loadClassWithoutExceptionHandling(name, resolve). So it should never be necessary to resolve it additionally.", "author": "AHeise", "createdAt": "2020-08-07T11:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg2NDU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk5ODUwNw==", "url": "https://github.com/apache/flink/pull/13031#discussion_r466998507", "bodyText": "Ok that makes sense, let's move it into another commit and then we're good to merge.", "author": "zentol", "createdAt": "2020-08-07T12:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg2NDU4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "c37fea7b6e6c2861077daec21fbf98e43027fdb9", "chunk": "diff --git a/flink-core/src/main/java/org/apache/flink/util/ChildFirstClassLoader.java b/flink-core/src/main/java/org/apache/flink/util/ChildFirstClassLoader.java\nindex 14787f367b4..2dc6d4d49b8 100644\n--- a/flink-core/src/main/java/org/apache/flink/util/ChildFirstClassLoader.java\n+++ b/flink-core/src/main/java/org/apache/flink/util/ChildFirstClassLoader.java\n\n@@ -71,7 +71,9 @@ public final class ChildFirstClassLoader extends FlinkUserCodeClassLoader {\n \t\t\t\t// let URLClassLoader do it, which will eventually call the parent\n \t\t\t\tc = super.loadClassWithoutExceptionHandling(name, resolve);\n \t\t\t}\n-\t\t} else if (resolve) {\n+\t\t}\n+\n+\t\tif (resolve) {\n \t\t\tresolveClass(c);\n \t\t}\n \n"}}, {"oid": "c37fea7b6e6c2861077daec21fbf98e43027fdb9", "url": "https://github.com/apache/flink/commit/c37fea7b6e6c2861077daec21fbf98e43027fdb9", "message": "[FLINK-18773][runtime] Enable parallel user-code and plugin class loader.", "committedDate": "2020-08-07T13:43:02Z", "type": "commit"}, {"oid": "a1e53c3791bde520ed9fa53d188fb1420d751fa3", "url": "https://github.com/apache/flink/commit/a1e53c3791bde520ed9fa53d188fb1420d751fa3", "message": "[hotfix][runtime] Resolve only already loaded classes in ChildFirstClassLoader.\n\nClasses that also need to loaded are already resolved through super.loadClassWithoutExceptionHandling(name, resolve).", "committedDate": "2020-08-07T13:43:21Z", "type": "commit"}, {"oid": "a1e53c3791bde520ed9fa53d188fb1420d751fa3", "url": "https://github.com/apache/flink/commit/a1e53c3791bde520ed9fa53d188fb1420d751fa3", "message": "[hotfix][runtime] Resolve only already loaded classes in ChildFirstClassLoader.\n\nClasses that also need to loaded are already resolved through super.loadClassWithoutExceptionHandling(name, resolve).", "committedDate": "2020-08-07T13:43:21Z", "type": "forcePushed"}]}