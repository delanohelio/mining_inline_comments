{"pr_number": 12205, "pr_title": "[FLINK-17780][checkpointing] Add task name to log statements of ChannelStateWriter.", "pr_createdAt": "2020-05-17T21:02:29Z", "pr_url": "https://github.com/apache/flink/pull/12205", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA3MDY2OQ==", "url": "https://github.com/apache/flink/pull/12205#discussion_r427070669", "bodyText": "nit missing white space: + \" interrupted\"", "author": "pnowojski", "createdAt": "2020-05-19T06:56:50Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java", "diffHunk": "@@ -79,7 +84,7 @@ private void loop() throws Exception {\n \t\t\t\tdispatcher.dispatch(deque.take());\n \t\t\t} catch (InterruptedException e) {\n \t\t\t\tif (!wasClosed) {\n-\t\t\t\t\tLOG.debug(\"interrupted while waiting for a request (continue waiting)\", e);\n+\t\t\t\t\tLOG.debug(taskName + \"interrupted while waiting for a request (continue waiting)\", e);", "originalCommit": "95793199f3be07aaf21dcefd2f7c7f8998be683d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java\nindex 74e4d10138..3ad8982c92 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java\n\n@@ -84,7 +94,7 @@ class ChannelStateWriteRequestExecutorImpl implements ChannelStateWriteRequestEx\n \t\t\t\tdispatcher.dispatch(deque.take());\n \t\t\t} catch (InterruptedException e) {\n \t\t\t\tif (!wasClosed) {\n-\t\t\t\t\tLOG.debug(taskName + \"interrupted while waiting for a request (continue waiting)\", e);\n+\t\t\t\t\tLOG.debug(taskName + \" interrupted while waiting for a request (continue waiting)\", e);\n \t\t\t\t} else {\n \t\t\t\t\tThread.currentThread().interrupt();\n \t\t\t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA2NjAxNg==", "url": "https://github.com/apache/flink/pull/12205#discussion_r427066016", "bodyText": "add a white space\n\"interrupted... => \" interrupted...", "author": "curcur", "createdAt": "2020-05-19T06:46:07Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java", "diffHunk": "@@ -79,7 +84,7 @@ private void loop() throws Exception {\n \t\t\t\tdispatcher.dispatch(deque.take());\n \t\t\t} catch (InterruptedException e) {\n \t\t\t\tif (!wasClosed) {\n-\t\t\t\t\tLOG.debug(\"interrupted while waiting for a request (continue waiting)\", e);\n+\t\t\t\t\tLOG.debug(taskName + \"interrupted while waiting for a request (continue waiting)\", e);", "originalCommit": "95793199f3be07aaf21dcefd2f7c7f8998be683d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java\nindex 74e4d10138..3ad8982c92 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequestExecutorImpl.java\n\n@@ -84,7 +94,7 @@ class ChannelStateWriteRequestExecutorImpl implements ChannelStateWriteRequestEx\n \t\t\t\tdispatcher.dispatch(deque.take());\n \t\t\t} catch (InterruptedException e) {\n \t\t\t\tif (!wasClosed) {\n-\t\t\t\t\tLOG.debug(taskName + \"interrupted while waiting for a request (continue waiting)\", e);\n+\t\t\t\t\tLOG.debug(taskName + \" interrupted while waiting for a request (continue waiting)\", e);\n \t\t\t\t} else {\n \t\t\t\t\tThread.currentThread().interrupt();\n \t\t\t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA3MTU3OA==", "url": "https://github.com/apache/flink/pull/12205#discussion_r427071578", "bodyText": "Should the first parameter be in a separate line?\nnit: add -> adds, similarly in other places. It reads a bit strange otherwise. But I do not think it is a big problem.", "author": "curcur", "createdAt": "2020-05-19T06:58:53Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java", "diffHunk": "@@ -104,48 +111,57 @@ public void start(long checkpointId, CheckpointOptions checkpointOptions) {\n \n \t@Override\n \tpublic void addInputData(long checkpointId, InputChannelInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"add input data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n-\t\t\tcheckpointId, info, startSeqNum, data == null ? 0 : data.length);\n+\t\tLOG.debug(\"{} add input data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",", "originalCommit": "95793199f3be07aaf21dcefd2f7c7f8998be683d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java\nindex d29acb71c1..3f56b1592e 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java\n\n@@ -110,19 +110,20 @@ public class ChannelStateWriterImpl implements ChannelStateWriter {\n \t}\n \n \t@Override\n-\tpublic void addInputData(long checkpointId, InputChannelInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"{} add input data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n+\tpublic void addInputData(long checkpointId, InputChannelInfo info, int startSeqNum, CloseableIterator<Buffer> iterator) {\n+\t\tLOG.debug(\n+\t\t\t\"{} adding input data, checkpoint id: {}, channel: {}, startSeqNum: {}\",\n \t\t\ttaskName,\n \t\t\tcheckpointId,\n \t\t\tinfo,\n-\t\t\tstartSeqNum,\n-\t\t\tdata == null ? 0 : data.length);\n-\t\tenqueue(write(checkpointId, info, checkBufferType(data)), false);\n+\t\t\tstartSeqNum);\n+\t\tenqueue(write(checkpointId, info, iterator), false);\n \t}\n \n \t@Override\n \tpublic void addOutputData(long checkpointId, ResultSubpartitionInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"{} add output data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n+\t\tLOG.debug(\n+\t\t\t\"{} adding output data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n \t\t\ttaskName,\n \t\t\tcheckpointId,\n \t\t\tinfo,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA3MjUxMw==", "url": "https://github.com/apache/flink/pull/12205#discussion_r427072513", "bodyText": "a separate line?", "author": "curcur", "createdAt": "2020-05-19T07:00:51Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java", "diffHunk": "@@ -104,48 +111,57 @@ public void start(long checkpointId, CheckpointOptions checkpointOptions) {\n \n \t@Override\n \tpublic void addInputData(long checkpointId, InputChannelInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"add input data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n-\t\t\tcheckpointId, info, startSeqNum, data == null ? 0 : data.length);\n+\t\tLOG.debug(\"{} add input data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n+\t\t\ttaskName,\n+\t\t\tcheckpointId,\n+\t\t\tinfo,\n+\t\t\tstartSeqNum,\n+\t\t\tdata == null ? 0 : data.length);\n \t\tenqueue(write(checkpointId, info, checkBufferType(data)), false);\n \t}\n \n \t@Override\n \tpublic void addOutputData(long checkpointId, ResultSubpartitionInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"add output data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n-\t\t\tcheckpointId, info, startSeqNum, data == null ? 0 : data.length);\n+\t\tLOG.debug(\"{} add output data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",", "originalCommit": "95793199f3be07aaf21dcefd2f7c7f8998be683d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "chunk": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java\nindex d29acb71c1..3f56b1592e 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java\n\n@@ -110,19 +110,20 @@ public class ChannelStateWriterImpl implements ChannelStateWriter {\n \t}\n \n \t@Override\n-\tpublic void addInputData(long checkpointId, InputChannelInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"{} add input data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n+\tpublic void addInputData(long checkpointId, InputChannelInfo info, int startSeqNum, CloseableIterator<Buffer> iterator) {\n+\t\tLOG.debug(\n+\t\t\t\"{} adding input data, checkpoint id: {}, channel: {}, startSeqNum: {}\",\n \t\t\ttaskName,\n \t\t\tcheckpointId,\n \t\t\tinfo,\n-\t\t\tstartSeqNum,\n-\t\t\tdata == null ? 0 : data.length);\n-\t\tenqueue(write(checkpointId, info, checkBufferType(data)), false);\n+\t\t\tstartSeqNum);\n+\t\tenqueue(write(checkpointId, info, iterator), false);\n \t}\n \n \t@Override\n \tpublic void addOutputData(long checkpointId, ResultSubpartitionInfo info, int startSeqNum, Buffer... data) {\n-\t\tLOG.debug(\"{} add output data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n+\t\tLOG.debug(\n+\t\t\t\"{} adding output data, checkpoint id: {}, channel: {}, startSeqNum: {}, num buffers: {}\",\n \t\t\ttaskName,\n \t\t\tcheckpointId,\n \t\t\tinfo,\n"}}, {"oid": "ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "url": "https://github.com/apache/flink/commit/ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "message": "[FLINK-17780][checkpointing] Add task name to log statements of ChannelStateWriter.\n\nAdd task name to the executor thread and to all method of ChannelStateWriter (as they can be called from any other thread), such that log statements can be connected to the respective task.", "committedDate": "2020-05-19T19:05:36Z", "type": "commit"}, {"oid": "ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "url": "https://github.com/apache/flink/commit/ae108cca79cb02ce45cb8ec0657e7f04a5b55aef", "message": "[FLINK-17780][checkpointing] Add task name to log statements of ChannelStateWriter.\n\nAdd task name to the executor thread and to all method of ChannelStateWriter (as they can be called from any other thread), such that log statements can be connected to the respective task.", "committedDate": "2020-05-19T19:05:36Z", "type": "forcePushed"}]}