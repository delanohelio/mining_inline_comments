{"pr_number": 10943, "pr_title": "[FLINK-15751][task] Let all exceptions propagate from the StreamTask#runMailboxLoop", "pr_createdAt": "2020-01-24T15:45:23Z", "pr_url": "https://github.com/apache/flink/pull/10943", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDcyMDU1Mg==", "url": "https://github.com/apache/flink/pull/10943#discussion_r370720552", "bodyText": "nit: condition can now be simplified to interruption.isPresent() && !canceled", "author": "rkhachatryan", "createdAt": "2020-01-24T16:22:16Z", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java", "diffHunk": "@@ -493,8 +493,6 @@ private void runMailboxLoop() throws Exception {\n \t\t\t\t\tThread.currentThread().interrupt();\n \t\t\t\t\tthrow interruption.get();\n \t\t\t\t}\n-\t\t\t} else if (canceled) {\n-\t\t\t\tLOG.warn(\"Error while canceling task.\", e);", "originalCommit": "c83bca0f185f04f6ed81301ab1c609e3ec347b71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyNjc0Nw==", "url": "https://github.com/apache/flink/pull/10943#discussion_r371126747", "bodyText": "Could it be? There is still need for 3 different branches. Admittedly branches could be re-order to avoid one level of nesting, but still, how could they be squashed?", "author": "pnowojski", "createdAt": "2020-01-27T09:13:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDcyMDU1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "419ada6f10c5e7a53346aa979c7bdb1afd000418", "chunk": "diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java\nindex 218a8918e4c..181c92f0e1d 100644\n--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java\n+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java\n\n@@ -488,14 +488,11 @@ public abstract class StreamTask<OUT, OP extends StreamOperator<OUT>>\n \t\t}\n \t\tcatch (Exception e) {\n \t\t\tOptional<InterruptedException> interruption = ExceptionUtils.findThrowable(e, InterruptedException.class);\n-\t\t\tif (interruption.isPresent()) {\n-\t\t\t\tif (!canceled) {\n-\t\t\t\t\tThread.currentThread().interrupt();\n-\t\t\t\t\tthrow interruption.get();\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\telse {\n+\t\t\tif (!interruption.isPresent()) {\n \t\t\t\tthrow e;\n+\t\t\t} else if (!canceled) {\n+\t\t\t\tThread.currentThread().interrupt();\n+\t\t\t\tthrow interruption.get();\n \t\t\t}\n \t\t}\n \t}\n"}}, {"oid": "419ada6f10c5e7a53346aa979c7bdb1afd000418", "url": "https://github.com/apache/flink/commit/419ada6f10c5e7a53346aa979c7bdb1afd000418", "message": "[FLINK-15751][task] Let all exceptions propagate from the StreamTask#runMailboxLoop\n\nIf the StreamTask is being cancelled, let the Task handle the exception.", "committedDate": "2020-01-27T09:13:54Z", "type": "forcePushed"}, {"oid": "9d91ac73596ebea13bedbfbc36a6d7f37e69d5dc", "url": "https://github.com/apache/flink/commit/9d91ac73596ebea13bedbfbc36a6d7f37e69d5dc", "message": "[FLINK-15751][task] Let all exceptions propagate from the StreamTask#runMailboxLoop\n\nIf the StreamTask is being cancelled, let the Task handle the exception.", "committedDate": "2020-01-27T10:45:29Z", "type": "commit"}, {"oid": "9d91ac73596ebea13bedbfbc36a6d7f37e69d5dc", "url": "https://github.com/apache/flink/commit/9d91ac73596ebea13bedbfbc36a6d7f37e69d5dc", "message": "[FLINK-15751][task] Let all exceptions propagate from the StreamTask#runMailboxLoop\n\nIf the StreamTask is being cancelled, let the Task handle the exception.", "committedDate": "2020-01-27T10:45:29Z", "type": "forcePushed"}]}