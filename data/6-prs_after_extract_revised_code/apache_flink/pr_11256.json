{"pr_number": 11256, "pr_title": "[FLINK-16342][metrics][datadog] Remove mocking", "pr_createdAt": "2020-02-28T14:18:17Z", "pr_url": "https://github.com/apache/flink/pull/11256", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MTE2Mw==", "url": "https://github.com/apache/flink/pull/11256#discussion_r385771163", "bodyText": "shall we add a comment to mention that this option is for testing?", "author": "tisonkun", "createdAt": "2020-02-28T15:48:42Z", "path": "flink-metrics/flink-metrics-datadog/src/main/java/org/apache/flink/metrics/datadog/DatadogHttpClient.java", "diffHunk": "@@ -48,6 +48,8 @@\n \tprivate static final int TIMEOUT = 3;\n \tprivate static final ObjectMapper MAPPER = new ObjectMapper();\n \n+\tstatic boolean skipApiKeyValidation = false;", "originalCommit": "68d419a8e3a2738bda013ef0e2888f9eae7c3031", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MTkxMw==", "url": "https://github.com/apache/flink/pull/11256#discussion_r385771913", "bodyText": "or @VisibleForTesting", "author": "tisonkun", "createdAt": "2020-02-28T15:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MTE2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNjAxNg==", "url": "https://github.com/apache/flink/pull/11256#discussion_r385806016", "bodyText": "What about introducing a constructor DatadogHttpClient(dgApiKey, dgProxyHost, dgProxyPort, boolean validateApiKey) instead of this static field? It is also not perfect but I think it is a bit better than having this static field.", "author": "tillrohrmann", "createdAt": "2020-02-28T16:51:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MTE2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgxMTc5Mw==", "url": "https://github.com/apache/flink/pull/11256#discussion_r385811793", "bodyText": "I would go with that solution once factories are in place; as it stands we would need 2 constructors; one with the arguments, one no-arg constructor for reflection purposes (which would be detected as being unused), and I don't want to have to watch out for someone removing the constructor because he thought it's not used anyway, or migrate tests towards the new \"convenient\" constructor at which point we lose test coverage of runtime paths.\nI know it's super icky and Ideally we get rid of the reflection approach soon.", "author": "zentol", "createdAt": "2020-02-28T17:02:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MTE2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1NTgwMQ==", "url": "https://github.com/apache/flink/pull/11256#discussion_r385955801", "bodyText": "ooooooooooooooooooooooooooohhhhh....this is the client...yeah then we should totally do that.", "author": "zentol", "createdAt": "2020-02-28T22:42:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MTE2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "7e0b01fdb98ebf6e953b2b2433d9e0fb949dc4a4", "chunk": "diff --git a/flink-metrics/flink-metrics-datadog/src/main/java/org/apache/flink/metrics/datadog/DatadogHttpClient.java b/flink-metrics/flink-metrics-datadog/src/main/java/org/apache/flink/metrics/datadog/DatadogHttpClient.java\nindex 18f9ff73eda..6641c9bf744 100644\n--- a/flink-metrics/flink-metrics-datadog/src/main/java/org/apache/flink/metrics/datadog/DatadogHttpClient.java\n+++ b/flink-metrics/flink-metrics-datadog/src/main/java/org/apache/flink/metrics/datadog/DatadogHttpClient.java\n\n@@ -48,8 +48,6 @@ public class DatadogHttpClient {\n \tprivate static final int TIMEOUT = 3;\n \tprivate static final ObjectMapper MAPPER = new ObjectMapper();\n \n-\tstatic boolean skipApiKeyValidation = false;\n-\n \tprivate final String seriesUrl;\n \tprivate final String validateUrl;\n \tprivate final OkHttpClient client;\n"}}, {"oid": "7e0b01fdb98ebf6e953b2b2433d9e0fb949dc4a4", "url": "https://github.com/apache/flink/commit/7e0b01fdb98ebf6e953b2b2433d9e0fb949dc4a4", "message": "[FLINK-16342][metrics][datadog] Remove mocking\n\n- introduce timestamp factory instead of relying on static method\n- introduce static package-private non-final flag for skipping api validation", "committedDate": "2020-02-29T08:14:17Z", "type": "commit"}, {"oid": "7e0b01fdb98ebf6e953b2b2433d9e0fb949dc4a4", "url": "https://github.com/apache/flink/commit/7e0b01fdb98ebf6e953b2b2433d9e0fb949dc4a4", "message": "[FLINK-16342][metrics][datadog] Remove mocking\n\n- introduce timestamp factory instead of relying on static method\n- introduce static package-private non-final flag for skipping api validation", "committedDate": "2020-02-29T08:14:17Z", "type": "forcePushed"}]}