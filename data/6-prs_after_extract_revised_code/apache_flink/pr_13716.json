{"pr_number": 13716, "pr_title": "[FLINK-19706][table-runtime] Add WARN logs when hive table partition \u2026", "pr_createdAt": "2020-10-21T06:40:34Z", "pr_url": "https://github.com/apache/flink/pull/13716", "timeline": [{"oid": "6fa76fb97c2c0307557da240746f375838e98136", "url": "https://github.com/apache/flink/commit/6fa76fb97c2c0307557da240746f375838e98136", "message": "[FLINK-19706][table-runtime] Add WARN logs when hive table partition has existed before commit", "committedDate": "2020-10-21T06:31:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4Mzc3Nw==", "url": "https://github.com/apache/flink/pull/13716#discussion_r510583777", "bodyText": "NIT: print previous path too, you can do this:\n\t\tmetaStore.getPartition(partitionSpec).ifPresent(path ->\n\t\t\t\tLOG.warn(\"The partition {} has existed before current commit,\" +\n\t\t\t\t\t\t\" the path is {}, this partition will be altered instead of being created\",\n\t\t\t\t\t\tpartitionSpec, path));", "author": "JingsongLi", "createdAt": "2020-10-23T04:15:48Z", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/MetastoreCommitPolicy.java", "diffHunk": "@@ -45,6 +45,9 @@ public void setMetastore(TableMetaStore metaStore) {\n \tpublic void commit(Context context) throws Exception {\n \t\tLinkedHashMap<String, String> partitionSpec = context.partitionSpec();\n \t\tmetaStore.createOrAlterPartition(partitionSpec, context.partitionPath());\n+\t\tif (metaStore.getPartition(partitionSpec).isPresent()) {", "originalCommit": "6fa76fb97c2c0307557da240746f375838e98136", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDYyMzEyNg==", "url": "https://github.com/apache/flink/pull/13716#discussion_r510623126", "bodyText": "Sure, code has been changed following ur suggestion", "author": "shouweikun", "createdAt": "2020-10-23T05:41:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4Mzc3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "9d64eae3bb456919ea24d094894c18ad69db49fd", "chunk": "diff --git a/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/MetastoreCommitPolicy.java b/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/MetastoreCommitPolicy.java\nindex fa9dc1abca..a53847228c 100644\n--- a/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/MetastoreCommitPolicy.java\n+++ b/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/MetastoreCommitPolicy.java\n\n@@ -44,10 +44,11 @@ public class MetastoreCommitPolicy implements PartitionCommitPolicy {\n \t@Override\n \tpublic void commit(Context context) throws Exception {\n \t\tLinkedHashMap<String, String> partitionSpec = context.partitionSpec();\n+\t\tmetaStore.getPartition(partitionSpec).ifPresent(path ->\n+\t\t\tLOG.warn(\"The partition {} has existed before current commit,\" +\n+\t\t\t\t\t\" the path is {}, this partition will be altered instead of being created\",\n+\t\t\t\tpartitionSpec, path));\n \t\tmetaStore.createOrAlterPartition(partitionSpec, context.partitionPath());\n-\t\tif (metaStore.getPartition(partitionSpec).isPresent()) {\n-\t\t\tLOG.warn(\"partition {} has existed before current commit, this partition will be altered instead of being created\", partitionSpec);\n-\t\t}\n \t\tLOG.info(\"Committed partition {} to metastore\", partitionSpec);\n \t}\n }\n"}}, {"oid": "9d64eae3bb456919ea24d094894c18ad69db49fd", "url": "https://github.com/apache/flink/commit/9d64eae3bb456919ea24d094894c18ad69db49fd", "message": "print path in the warn log for more specific info", "committedDate": "2020-10-23T05:39:17Z", "type": "commit"}]}