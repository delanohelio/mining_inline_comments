{"pr_number": 3463, "pr_title": "[Binance] Add subAccount Transfert History", "pr_createdAt": "2020-03-22T20:02:25Z", "pr_url": "https://github.com/knowm/XChange/pull/3463", "timeline": [{"oid": "c1df6cfe4296ba6877685db50fe967971eba64c8", "url": "https://github.com/knowm/XChange/commit/c1df6cfe4296ba6877685db50fe967971eba64c8", "message": "Add Sub Account transfert history", "committedDate": "2020-03-22T19:55:08Z", "type": "commit"}, {"oid": "5f3cb906c55448d83ff1ef842e4c74603b5fb1dd", "url": "https://github.com/knowm/XChange/commit/5f3cb906c55448d83ff1ef842e4c74603b5fb1dd", "message": "Add Sub Account transfert history", "committedDate": "2020-03-22T19:55:11Z", "type": "commit"}, {"oid": "520197da8563256e708dc1e924c4c19d1697a6b4", "url": "https://github.com/knowm/XChange/commit/520197da8563256e708dc1e924c4c19d1697a6b4", "message": "Restore version of xchange", "committedDate": "2020-03-22T19:57:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398388277", "bodyText": "if your using lombok then these setters / getters are not needed", "author": "walec51", "createdAt": "2020-03-26T08:22:45Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/dto/account/TransfertHistoryResponse.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package org.knowm.xchange.binance.dto.account;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import java.math.BigDecimal;\n+import java.util.Arrays;\n+import java.util.List;\n+import lombok.Data;\n+\n+public final class TransfertHistoryResponse\n+    extends WapiResponse<List<TransfertHistoryResponse.TransfertHistory>> {\n+\n+  private final TransfertHistory[] transfertHistories;\n+\n+  public TransfertHistoryResponse(\n+      @JsonProperty(\"transfers\") TransfertHistoryResponse.TransfertHistory[] transfertHistories,\n+      @JsonProperty(\"success\") boolean success,\n+      @JsonProperty(\"msg\") String msg) {\n+    super(success, msg);\n+    this.transfertHistories = transfertHistories;\n+  }\n+\n+  @Override\n+  public List<TransfertHistory> getData() {\n+    return Arrays.asList(transfertHistories);\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return \"transfertHistories [rows=\" + Arrays.toString(transfertHistories) + \"]\";\n+  }\n+\n+  @Data\n+  public static final class TransfertHistory {\n+    private String from;\n+    private String to;\n+    private String asset;\n+    private BigDecimal qty;\n+    private long time;\n+\n+    public String getFrom() {\n+      return from;\n+    }", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQwMjk0Mg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398402942", "bodyText": "I haven't created unit test but if you remove getter, are you still able to create UT ?", "author": "trixprod", "createdAt": "2020-03-26T08:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3OTA5Mg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r399779092", "bodyText": "I'm not telling to remove getters\nI'm telling to remove the getter code you have written by hand\nlombok will generate getters for you - this is how the @Data annotation you have used here works https://projectlombok.org/features/Data", "author": "walec51", "createdAt": "2020-03-29T10:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NjMyNw==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r402456327", "bodyText": "file name has a typo", "author": "conspyrosy", "createdAt": "2020-04-02T16:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0NjcwMg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r402546702", "bodyText": "file name has a typo\n\nFixed all references from Transfert to Transfer ( without the 't' )", "author": "trixprod", "createdAt": "2020-04-02T19:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "chunk": "diff --git a/xchange-binance/src/main/java/org/knowm/xchange/binance/dto/account/TransfertHistoryResponse.java b/xchange-binance/src/main/java/org/knowm/xchange/binance/dto/account/TransfertHistoryResponse.java\nindex f548130908..528d9726ea 100644\n--- a/xchange-binance/src/main/java/org/knowm/xchange/binance/dto/account/TransfertHistoryResponse.java\n+++ b/xchange-binance/src/main/java/org/knowm/xchange/binance/dto/account/TransfertHistoryResponse.java\n\n@@ -36,45 +36,5 @@ public final class TransfertHistoryResponse\n     private String asset;\n     private BigDecimal qty;\n     private long time;\n-\n-    public String getFrom() {\n-      return from;\n-    }\n-\n-    public void setFrom(String from) {\n-      this.from = from;\n-    }\n-\n-    public String getTo() {\n-      return to;\n-    }\n-\n-    public void setTo(String to) {\n-      this.to = to;\n-    }\n-\n-    public String getAsset() {\n-      return asset;\n-    }\n-\n-    public void setAsset(String asset) {\n-      this.asset = asset;\n-    }\n-\n-    public BigDecimal getQty() {\n-      return qty;\n-    }\n-\n-    public void setQty(BigDecimal qty) {\n-      this.qty = qty;\n-    }\n-\n-    public long getTime() {\n-      return time;\n-    }\n-\n-    public void setTime(long time) {\n-      this.time = time;\n-    }\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4OTczMQ==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398389731", "bodyText": "I don't think this is needed", "author": "walec51", "createdAt": "2020-03-26T08:25:15Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java", "diffHunk": "@@ -287,6 +304,52 @@ public TradeHistoryParams createFundingHistoryParams() {\n                 });\n       }\n \n+      final String finalEmail = email;", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQwMzQxNQ==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398403415", "bodyText": "Lambda need final field. email field is null then affected to a value if needed.", "author": "trixprod", "createdAt": "2020-03-26T08:49:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4OTczMQ=="}], "type": "inlineReview", "revised_code": {"commit": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "chunk": "diff --git a/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java b/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\nindex 64c8babc9c..921d7f2987 100644\n--- a/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\n+++ b/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\n\n@@ -311,19 +311,14 @@ public class BinanceAccountService extends BinanceAccountServiceRaw implements A\n             .forEach(\n                 a -> {\n                   result.add(\n-                      new FundingRecord(\n-                          finalEmail,\n-                          null,\n-                          new Date(a.getTime()),\n-                          Currency.getInstance(a.getAsset()),\n-                          a.getQty(),\n-                          null,\n-                          null,\n-                          Type.SUBACCOUNT_OUTFLOW,\n-                          Status.COMPLETE,\n-                          null,\n-                          null,\n-                          null));\n+                      new FundingRecord.Builder()\n+                          .setAddress(finalEmail)\n+                          .setDate(new Date(a.getTime()))\n+                          .setCurrency(Currency.getInstance(a.getAsset()))\n+                          .setAmount(a.getQty())\n+                          .setType(Type.INTERNAL_WITHDRAWAL)\n+                          .setStatus(Status.COMPLETE)\n+                          .build());\n                 });\n       }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM5MDI1Mg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398390252", "bodyText": "please use builder", "author": "walec51", "createdAt": "2020-03-26T08:26:10Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java", "diffHunk": "@@ -287,6 +304,52 @@ public TradeHistoryParams createFundingHistoryParams() {\n                 });\n       }\n \n+      final String finalEmail = email;\n+\n+      if (email != null) {\n+        super.getTransfertHistory(email, startTime, endTime, page, limit)\n+            .forEach(\n+                a -> {\n+                  result.add(\n+                      new FundingRecord(", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "chunk": "diff --git a/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java b/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\nindex 64c8babc9c..921d7f2987 100644\n--- a/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\n+++ b/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\n\n@@ -311,19 +311,14 @@ public class BinanceAccountService extends BinanceAccountServiceRaw implements A\n             .forEach(\n                 a -> {\n                   result.add(\n-                      new FundingRecord(\n-                          finalEmail,\n-                          null,\n-                          new Date(a.getTime()),\n-                          Currency.getInstance(a.getAsset()),\n-                          a.getQty(),\n-                          null,\n-                          null,\n-                          Type.SUBACCOUNT_OUTFLOW,\n-                          Status.COMPLETE,\n-                          null,\n-                          null,\n-                          null));\n+                      new FundingRecord.Builder()\n+                          .setAddress(finalEmail)\n+                          .setDate(new Date(a.getTime()))\n+                          .setCurrency(Currency.getInstance(a.getAsset()))\n+                          .setAmount(a.getQty())\n+                          .setType(Type.INTERNAL_WITHDRAWAL)\n+                          .setStatus(Status.COMPLETE)\n+                          .build());\n                 });\n       }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM5MDMzOA==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398390338", "bodyText": "please use builder", "author": "walec51", "createdAt": "2020-03-26T08:26:21Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java", "diffHunk": "@@ -287,6 +304,52 @@ public TradeHistoryParams createFundingHistoryParams() {\n                 });\n       }\n \n+      final String finalEmail = email;\n+\n+      if (email != null) {\n+        super.getTransfertHistory(email, startTime, endTime, page, limit)\n+            .forEach(\n+                a -> {\n+                  result.add(\n+                      new FundingRecord(\n+                          finalEmail,\n+                          null,\n+                          new Date(a.getTime()),\n+                          Currency.getInstance(a.getAsset()),\n+                          a.getQty(),\n+                          null,\n+                          null,\n+                          Type.SUBACCOUNT_OUTFLOW,\n+                          Status.COMPLETE,\n+                          null,\n+                          null,\n+                          null));\n+                });\n+      }\n+\n+      if (subAccount) {\n+\n+        Integer type = deposits && withdrawals ? null : deposits ? 1 : 0;\n+        super.getSubUserHistory(asset, type, startTime, endTime, limit)\n+            .forEach(\n+                a -> {\n+                  result.add(\n+                      new FundingRecord(", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "chunk": "diff --git a/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java b/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\nindex 64c8babc9c..921d7f2987 100644\n--- a/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\n+++ b/xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java\n\n@@ -311,19 +311,14 @@ public class BinanceAccountService extends BinanceAccountServiceRaw implements A\n             .forEach(\n                 a -> {\n                   result.add(\n-                      new FundingRecord(\n-                          finalEmail,\n-                          null,\n-                          new Date(a.getTime()),\n-                          Currency.getInstance(a.getAsset()),\n-                          a.getQty(),\n-                          null,\n-                          null,\n-                          Type.SUBACCOUNT_OUTFLOW,\n-                          Status.COMPLETE,\n-                          null,\n-                          null,\n-                          null));\n+                      new FundingRecord.Builder()\n+                          .setAddress(finalEmail)\n+                          .setDate(new Date(a.getTime()))\n+                          .setCurrency(Currency.getInstance(a.getAsset()))\n+                          .setAmount(a.getQty())\n+                          .setType(Type.INTERNAL_WITHDRAWAL)\n+                          .setStatus(Status.COMPLETE)\n+                          .build());\n                 });\n       }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM5ODQ5MQ==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398398491", "bodyText": "I think more generic names would be better as this is to Binance-specific\nsome exchanges have a flat structure with many account for a given currency and no master\nI would suggest:\n    /**\n     * Withdrawal from the exchange a blockchain address or a bank account.\n     *\n     * Usually results in a withdrawal fee being subtracted\n     */\n    WITHDRAWAL(false),\n\n    /** Deposit from a blockchain address or a bank account to the exchange */\n    DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);", "author": "walec51", "createdAt": "2020-03-26T08:41:09Z", "path": "xchange-core/src/main/java/org/knowm/xchange/dto/account/FundingRecord.java", "diffHunk": "@@ -298,7 +298,13 @@ public String toString() {\n      * outflows defined above or their nature could not have been deduced from the exchanges\n      * response\n      */\n-    OTHER_OUTFLOW(false);\n+    OTHER_OUTFLOW(false),\n+\n+    /** Used for inflows that come from a sub account to the master account */\n+    SUBACCOUNT_INFLOW(true),", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "chunk": "diff --git a/xchange-core/src/main/java/org/knowm/xchange/dto/account/FundingRecord.java b/xchange-core/src/main/java/org/knowm/xchange/dto/account/FundingRecord.java\nindex e07d420c65..5b13a054b9 100644\n--- a/xchange-core/src/main/java/org/knowm/xchange/dto/account/FundingRecord.java\n+++ b/xchange-core/src/main/java/org/knowm/xchange/dto/account/FundingRecord.java\n\n@@ -300,11 +300,11 @@ public final class FundingRecord implements Serializable {\n      */\n     OTHER_OUTFLOW(false),\n \n-    /** Used for inflows that come from a sub account to the master account */\n-    SUBACCOUNT_INFLOW(true),\n+    /** Used for transfers between exchanges accounts */\n+    INTERNAL_WITHDRAWAL(false),\n \n-    /** Used for outflows that come from a master account to a sub account */\n-    SUBACCOUNT_OUTFLOW(false);\n+    /** Used for transfers between exchanges accounts */\n+    INTERNAL_DEPOSIT(true);\n \n     private static final Map<String, Type> fromString = new HashMap<>();\n \n"}}, {"oid": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "url": "https://github.com/knowm/XChange/commit/6c386a1dc6084af842ae06f5a561d0ce629421c0", "message": "[Binance] PR Review #3463\nAdd Sub Account transfert history", "committedDate": "2020-04-01T23:05:18Z", "type": "commit"}, {"oid": "e0f0a7390ec9df7934abe7009d69ee21289ef51f", "url": "https://github.com/knowm/XChange/commit/e0f0a7390ec9df7934abe7009d69ee21289ef51f", "message": "[Binance] PR Review #3463\nFix typo on Transfer(t)\nAdd Sub Account transfert history", "committedDate": "2020-04-02T19:02:12Z", "type": "commit"}]}