{"pr_number": 6476, "pr_title": "Fix crash on missing user", "pr_createdAt": "2020-07-15T13:58:55Z", "pr_url": "https://github.com/nextcloud/android/pull/6476", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM4MDk3OQ==", "url": "https://github.com/nextcloud/android/pull/6476#discussion_r455380979", "bodyText": "I think this is outdated javadoc", "author": "ezaquarii", "createdAt": "2020-07-15T21:48:33Z", "path": "src/main/java/com/owncloud/android/services/OperationsService.java", "diffHunk": "@@ -702,17 +707,19 @@ private void nextOperation() {\n     }\n \n     /**\n-     * This is a temporary compatibility helper to convert legacy {@link Account} instance\n-     * to new {@link User} model.\n+     * This is a temporary compatibility helper to convert legacy {@link Account} instance to new {@link User} model.\n      *\n      * @param account Account instance\n      * @return User model that corresponds to Account\n      * @throws RuntimeException if account cannot be converted", "originalCommit": "a629ac7debb0c36d8a26b528d3df7e90da7038d1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e09a1604d0be4aa4a390b60b3200cee5156d854c", "chunk": "diff --git a/src/main/java/com/owncloud/android/services/OperationsService.java b/src/main/java/com/owncloud/android/services/OperationsService.java\nindex f7991daf3..c615f9c22 100644\n--- a/src/main/java/com/owncloud/android/services/OperationsService.java\n+++ b/src/main/java/com/owncloud/android/services/OperationsService.java\n\n@@ -711,14 +709,15 @@ public class OperationsService extends Service {\n      *\n      * @param account Account instance\n      * @return User model that corresponds to Account\n-     * @throws RuntimeException if account cannot be converted\n      */\n     @NonNull\n-    private Optional<User> toUser(@Nullable Account account) {\n-        if (account == null) {\n-            return Optional.empty();\n+    private User toUser(@Nullable Account account) {\n+        String accountName = account != null ? account.name : \"\";\n+        Optional<User> optionalUser = accountManager.getUser(accountName);\n+        if (optionalUser.isPresent()) {\n+            return optionalUser.get();\n         } else {\n-            return accountManager.getUser(account.name);\n+            return accountManager.getAnonymousUser();\n         }\n     }\n \n"}}, {"oid": "e09a1604d0be4aa4a390b60b3200cee5156d854c", "url": "https://github.com/nextcloud/android/commit/e09a1604d0be4aa4a390b60b3200cee5156d854c", "message": "Fix crash on missing user\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-07-16T09:06:00Z", "type": "forcePushed"}, {"oid": "9a07418e519fbcefccf75b02d15327fc492367c5", "url": "https://github.com/nextcloud/android/commit/9a07418e519fbcefccf75b02d15327fc492367c5", "message": "Fix crash on missing user\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-07-17T06:07:45Z", "type": "commit"}, {"oid": "9a07418e519fbcefccf75b02d15327fc492367c5", "url": "https://github.com/nextcloud/android/commit/9a07418e519fbcefccf75b02d15327fc492367c5", "message": "Fix crash on missing user\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-07-17T06:07:45Z", "type": "forcePushed"}]}