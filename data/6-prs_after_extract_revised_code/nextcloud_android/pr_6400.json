{"pr_number": 6400, "pr_title": "Add theming logic for share link icons", "pr_createdAt": "2020-07-01T12:24:02Z", "pr_url": "https://github.com/nextcloud/android/pull/6400", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MzYwMQ==", "url": "https://github.com/nextcloud/android/pull/6400#discussion_r448373601", "bodyText": "Is this obeying dark mode?", "author": "tobiasKaminsky", "createdAt": "2020-07-01T13:45:03Z", "path": "src/main/java/com/owncloud/android/utils/ThemeUtils.java", "diffHunk": "@@ -712,6 +706,28 @@ public static void colorFloatingActionButton(FloatingActionButton button, int ba\n         button.setRippleColor(rippleColor);\n     }\n \n+    public static void colorIconImageViewWithBackground(ImageView imageView, Context context) {\n+        int primaryColor = ThemeUtils.primaryColor(null, true, false, context);\n+\n+        imageView.getBackground().setColorFilter(primaryColor, PorterDuff.Mode.SRC_IN);\n+        imageView.getDrawable().mutate().setColorFilter(getColorForPrimary(primaryColor), PorterDuff.Mode.SRC_IN);\n+    }\n+\n+    /**\n+     * returns a primary color matching color for texts/icons on top of a primary-colored element (like buttons).\n+     *\n+     * @param primaryColor the primary color\n+     */\n+    private getColorForPrimary(int primaryColor) {\n+        if (Color.BLACK == primaryColor) {", "originalCommit": "b09bd98be267a7f8c30fb0b985174467c3f6019c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQyODQxOQ==", "url": "https://github.com/nextcloud/android/pull/6400#discussion_r448428419", "bodyText": "Not at this very moment, we just do this based on the primary color for edge cases and else use the server's text-color value. See also my other comment.", "author": "AndyScherzinger", "createdAt": "2020-07-01T15:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MzYwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "0a41867ea6bbccc2c609d70e175c2da7c77f1903", "chunk": "diff --git a/src/main/java/com/owncloud/android/utils/ThemeUtils.java b/src/main/java/com/owncloud/android/utils/ThemeUtils.java\nindex 54608486c..2bc7cf480 100644\n--- a/src/main/java/com/owncloud/android/utils/ThemeUtils.java\n+++ b/src/main/java/com/owncloud/android/utils/ThemeUtils.java\n\n@@ -710,7 +710,8 @@ public final class ThemeUtils {\n         int primaryColor = ThemeUtils.primaryColor(null, true, false, context);\n \n         imageView.getBackground().setColorFilter(primaryColor, PorterDuff.Mode.SRC_IN);\n-        imageView.getDrawable().mutate().setColorFilter(getColorForPrimary(primaryColor), PorterDuff.Mode.SRC_IN);\n+        imageView.getDrawable().mutate().setColorFilter(getColorForPrimary(primaryColor, context),\n+                                                        PorterDuff.Mode.SRC_IN);\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3NDI1OA==", "url": "https://github.com/nextcloud/android/pull/6400#discussion_r448374258", "bodyText": "Isn't this also a good idea to have this computed on server? font-color-light and font-color dark?", "author": "tobiasKaminsky", "createdAt": "2020-07-01T13:45:57Z", "path": "src/main/java/com/owncloud/android/utils/ThemeUtils.java", "diffHunk": "@@ -712,6 +706,28 @@ public static void colorFloatingActionButton(FloatingActionButton button, int ba\n         button.setRippleColor(rippleColor);\n     }\n \n+    public static void colorIconImageViewWithBackground(ImageView imageView, Context context) {\n+        int primaryColor = ThemeUtils.primaryColor(null, true, false, context);\n+\n+        imageView.getBackground().setColorFilter(primaryColor, PorterDuff.Mode.SRC_IN);\n+        imageView.getDrawable().mutate().setColorFilter(getColorForPrimary(primaryColor), PorterDuff.Mode.SRC_IN);\n+    }\n+\n+    /**\n+     * returns a primary color matching color for texts/icons on top of a primary-colored element (like buttons).\n+     *\n+     * @param primaryColor the primary color\n+     */\n+    private getColorForPrimary(int primaryColor) {\n+        if (Color.BLACK == primaryColor) {\n+            return Color.WHITE;\n+        } else if (Color.WHITE == primaryColor) {\n+            return Color.BLACK;\n+        } else {\n+            return ThemeUtils.fontColor(context, false);", "originalCommit": "b09bd98be267a7f8c30fb0b985174467c3f6019c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQyNzgzOA==", "url": "https://github.com/nextcloud/android/pull/6400#discussion_r448427838", "bodyText": "Don't know, but @nickvergessen might be able to shed some light on the font-color calculations. I'd hope that with a fallback-ing background color working for dark/light the text-color of a button doesn't have any contrast issues anymore. So we would rather have to discuss if primary button texts would have to be white/black or if we just use white in both theme variants.\nSo also pinging @jancborchardt about this. ATM we don't have text-color variant from the server (also with element-color reference)", "author": "AndyScherzinger", "createdAt": "2020-07-01T15:04:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3NDI1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0Njg4OA==", "url": "https://github.com/nextcloud/android/pull/6400#discussion_r448946888", "bodyText": "Fine for me to have this in next PR \ud83d\udc4d", "author": "tobiasKaminsky", "createdAt": "2020-07-02T11:54:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3NDI1OA=="}], "type": "inlineReview", "revised_code": {"commit": "0a41867ea6bbccc2c609d70e175c2da7c77f1903", "chunk": "diff --git a/src/main/java/com/owncloud/android/utils/ThemeUtils.java b/src/main/java/com/owncloud/android/utils/ThemeUtils.java\nindex 54608486c..2bc7cf480 100644\n--- a/src/main/java/com/owncloud/android/utils/ThemeUtils.java\n+++ b/src/main/java/com/owncloud/android/utils/ThemeUtils.java\n\n@@ -710,7 +710,8 @@ public final class ThemeUtils {\n         int primaryColor = ThemeUtils.primaryColor(null, true, false, context);\n \n         imageView.getBackground().setColorFilter(primaryColor, PorterDuff.Mode.SRC_IN);\n-        imageView.getDrawable().mutate().setColorFilter(getColorForPrimary(primaryColor), PorterDuff.Mode.SRC_IN);\n+        imageView.getDrawable().mutate().setColorFilter(getColorForPrimary(primaryColor, context),\n+                                                        PorterDuff.Mode.SRC_IN);\n     }\n \n     /**\n"}}, {"oid": "d1d29bb5ff14bb8da9004cb6e82196c4cf0777b0", "url": "https://github.com/nextcloud/android/commit/d1d29bb5ff14bb8da9004cb6e82196c4cf0777b0", "message": "Resolve #6399 adding theming logic for share link icons\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-07-01T19:47:04Z", "type": "forcePushed"}, {"oid": "0a41867ea6bbccc2c609d70e175c2da7c77f1903", "url": "https://github.com/nextcloud/android/commit/0a41867ea6bbccc2c609d70e175c2da7c77f1903", "message": "Resolve #6399 adding theming logic for share link icons\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-07-01T19:50:22Z", "type": "forcePushed"}, {"oid": "fd47348f1bcde7e24ddde1ed45bbd734c72b7f17", "url": "https://github.com/nextcloud/android/commit/fd47348f1bcde7e24ddde1ed45bbd734c72b7f17", "message": "Resolve #6399 adding theming logic for share link icons\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-07-02T07:18:32Z", "type": "commit"}, {"oid": "fd47348f1bcde7e24ddde1ed45bbd734c72b7f17", "url": "https://github.com/nextcloud/android/commit/fd47348f1bcde7e24ddde1ed45bbd734c72b7f17", "message": "Resolve #6399 adding theming logic for share link icons\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-07-02T07:18:32Z", "type": "forcePushed"}]}