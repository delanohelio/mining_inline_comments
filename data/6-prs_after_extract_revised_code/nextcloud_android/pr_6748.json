{"pr_number": 6748, "pr_title": "no sticky broadcast", "pr_createdAt": "2020-08-19T09:24:31Z", "pr_url": "https://github.com/nextcloud/android/pull/6748", "timeline": [{"oid": "f85a2d7164bf19ad8078fc66084ef601e78c0b06", "url": "https://github.com/nextcloud/android/commit/f85a2d7164bf19ad8078fc66084ef601e78c0b06", "message": "no sticky broadcast:\n- use local broadcast system instead\n- no need to remove sticky broadcasts then\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-08-20T08:40:32Z", "type": "forcePushed"}, {"oid": "780c4434c60e27e70d0df4d3592d6433182d05e7", "url": "https://github.com/nextcloud/android/commit/780c4434c60e27e70d0df4d3592d6433182d05e7", "message": "no sticky broadcast:\n- use local broadcast system instead\n- no need to remove sticky broadcasts then\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-08-21T07:56:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzMTE2Mg==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r475131162", "bodyText": "I'd inject it from Dagger.", "author": "ezaquarii", "createdAt": "2020-08-22T20:05:04Z", "path": "src/main/java/com/owncloud/android/files/services/FileDownloader.java", "diffHunk": "@@ -691,7 +692,7 @@ private void sendBroadcastDownloadFinished(\n             end.putExtra(EXTRA_LINKED_TO_PATH, unlinkedFromRemotePath);\n         }\n         end.setPackage(getPackageName());\n-        sendStickyBroadcast(end);\n+        LocalBroadcastManager.getInstance(this).sendBroadcast(end);", "originalCommit": "780c4434c60e27e70d0df4d3592d6433182d05e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4bc5bb452404d06a9692b72aa844339327fbb6a9", "chunk": "diff --git a/src/main/java/com/owncloud/android/files/services/FileDownloader.java b/src/main/java/com/owncloud/android/files/services/FileDownloader.java\nindex 9fa8b20cf..106688dbf 100644\n--- a/src/main/java/com/owncloud/android/files/services/FileDownloader.java\n+++ b/src/main/java/com/owncloud/android/files/services/FileDownloader.java\n\n@@ -692,7 +693,7 @@ public class FileDownloader extends Service\n             end.putExtra(EXTRA_LINKED_TO_PATH, unlinkedFromRemotePath);\n         }\n         end.setPackage(getPackageName());\n-        LocalBroadcastManager.getInstance(this).sendBroadcast(end);\n+        localBroadcastManager.sendBroadcast(end);\n     }\n \n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzMjM3OQ==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r475132379", "bodyText": "This is nitpicking, but Broadcast instead of BroadCast. Sorry. :)", "author": "ezaquarii", "createdAt": "2020-08-22T20:06:23Z", "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -1111,6 +1113,8 @@ protected void onResume() {\n             updateActionBarTitleAndHomeButton(startFile);\n         }\n \n+        localBroadCastManager = LocalBroadcastManager.getInstance(this);", "originalCommit": "780c4434c60e27e70d0df4d3592d6433182d05e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4bc5bb452404d06a9692b72aa844339327fbb6a9", "chunk": "diff --git a/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java b/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java\nindex b7ec4880e..bb5518af7 100644\n--- a/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java\n+++ b/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java\n\n@@ -1113,8 +1113,6 @@ public class FileDisplayActivity extends FileActivity\n             updateActionBarTitleAndHomeButton(startFile);\n         }\n \n-        localBroadCastManager = LocalBroadcastManager.getInstance(this);\n-\n         // Listen for sync messages\n         if (ocFileListFragment != null && !ocFileListFragment.isSearchFragment()) {\n             IntentFilter syncIntentFilter = new IntentFilter(FileSyncAdapter.EVENT_FULL_SYNC_START);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzMzgyNA==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r475133824", "bodyText": "I think this is coming from one of my previous PRs that is already merged? Not sure how it ended up here.", "author": "ezaquarii", "createdAt": "2020-08-22T20:09:04Z", "path": "src/main/java/com/owncloud/android/ui/fragment/contactsbackup/ContactListFragment.java", "diffHunk": "@@ -58,10 +58,10 @@\n import com.nextcloud.client.account.UserAccountManager;\n import com.nextcloud.client.di.Injectable;\n import com.nextcloud.client.files.downloader.Direction;\n+import com.nextcloud.client.files.downloader.Request;\n import com.nextcloud.client.files.downloader.Transfer;\n-import com.nextcloud.client.files.downloader.TransferState;\n import com.nextcloud.client.files.downloader.TransferManagerConnection;\n-import com.nextcloud.client.files.downloader.Request;\n+import com.nextcloud.client.files.downloader.TransferState;", "originalCommit": "780c4434c60e27e70d0df4d3592d6433182d05e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "4bc5bb452404d06a9692b72aa844339327fbb6a9", "url": "https://github.com/nextcloud/android/commit/4bc5bb452404d06a9692b72aa844339327fbb6a9", "message": "no sticky broadcast:\n- use local broadcast system instead\n- no need to remove sticky broadcasts then\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-08-24T07:18:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5MDAyOQ==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r475390029", "bodyText": "@ezaquarii how could I use Dagger here?\nOnly via constructor, or?", "author": "tobiasKaminsky", "createdAt": "2020-08-24T07:20:51Z", "path": "src/main/java/com/owncloud/android/operations/RefreshFolderOperation.java", "diffHunk": "@@ -691,6 +692,6 @@ private void sendLocalBroadcast(String event, String dirRemotePath, RemoteOperat\n         intent.putExtra(FileSyncAdapter.EXTRA_RESULT, dataHolderItemId);\n \n         intent.setPackage(mContext.getPackageName());\n-        mContext.sendStickyBroadcast(intent);\n+        LocalBroadcastManager.getInstance(mContext.getApplicationContext()).sendBroadcast(intent);", "originalCommit": "4bc5bb452404d06a9692b72aa844339327fbb6a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5MTA3Nw==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r475391077", "bodyText": "Yeah, dagger works only in main components. Everything else is constructor based injection or setter if 2 stage init is required (I think we have 1 case of the latter).", "author": "ezaquarii", "createdAt": "2020-08-24T07:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5MDAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjIxMzk4NA==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r476213984", "bodyText": "Do you think it is worth the effort, or can we keep it this way?\nAfter all it is a singleton, so use of Dagger is not that much needed, but mainly only for centralizing the initiation?", "author": "tobiasKaminsky", "createdAt": "2020-08-25T06:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5MDAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkxOTE0NQ==", "url": "https://github.com/nextcloud/android/pull/6748#discussion_r479919145", "bodyText": "Let us keep it now this way to get it in faster.\nIf we need DI for testing, we can change it anyways.", "author": "tobiasKaminsky", "createdAt": "2020-08-31T06:26:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5MDAyOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1edf2a44d67fa18b8070678182be09eb32e7d546", "url": "https://github.com/nextcloud/android/commit/1edf2a44d67fa18b8070678182be09eb32e7d546", "message": "no sticky broadcast:\n- use local broadcast system instead\n- no need to remove sticky broadcasts then\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-08-24T07:26:53Z", "type": "forcePushed"}, {"oid": "15dcad229c2894ce1ef11e3ecf39b4791692d0c4", "url": "https://github.com/nextcloud/android/commit/15dcad229c2894ce1ef11e3ecf39b4791692d0c4", "message": "no sticky broadcast:\n- use local broadcast system instead\n- no need to remove sticky broadcasts then\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-08-28T10:34:20Z", "type": "commit"}, {"oid": "15dcad229c2894ce1ef11e3ecf39b4791692d0c4", "url": "https://github.com/nextcloud/android/commit/15dcad229c2894ce1ef11e3ecf39b4791692d0c4", "message": "no sticky broadcast:\n- use local broadcast system instead\n- no need to remove sticky broadcasts then\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-08-28T10:34:20Z", "type": "forcePushed"}]}