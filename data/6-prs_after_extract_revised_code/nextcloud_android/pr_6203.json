{"pr_number": 6203, "pr_title": "Upload list activity: new sort / switch button", "pr_createdAt": "2020-06-03T06:13:38Z", "pr_url": "https://github.com/nextcloud/android/pull/6203", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ2NDEwOQ==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r434464109", "bodyText": "Why you remove search ?", "author": "JorisBodin", "createdAt": "2020-06-03T10:21:41Z", "path": "src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java", "diffHunk": "@@ -796,26 +784,20 @@ public void onPrepareOptionsMenu(@NonNull Menu menu) {\n                 break;\n \n             case REMOVE_SEARCH:\n-                menu.removeItem(R.id.action_search);", "originalCommit": "319da713e5beb2610679d25b818eca1f6a9810b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMTYyNg==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r435011626", "bodyText": "No idea \ud83d\ude48\nAdded back \ud83d\udc4d", "author": "tobiasKaminsky", "createdAt": "2020-06-04T06:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ2NDEwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "f0f77098bbae810f4190ec015879535ed70cbb29", "chunk": "diff --git a/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java b/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java\nindex de37e7088..855b66856 100644\n--- a/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java\n+++ b/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java\n\n@@ -784,6 +784,7 @@ public class OCFileListFragment extends ExtendedListFragment implements\n                 break;\n \n             case REMOVE_SEARCH:\n+                menu.removeItem(R.id.action_search);\n                 break;\n \n             case REMOVE_SORT:\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ2NzE3NQ==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r434467175", "bodyText": "I prefere use \"requireContext()\" :)\nrequireContext() will throw an exception if fragment isn\u2019t attached to its host", "author": "JorisBodin", "createdAt": "2020-06-03T10:27:36Z", "path": "src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java", "diffHunk": "@@ -1287,7 +1269,7 @@ private void updateLayout() {\n             switchToListView();\n         }\n \n-        setSortButton(preferences.getSortOrderByFolder(mFile));\n+        DisplayUtils.setSortButton(mSortButton, preferences.getSortOrderByFolder(mFile), getContext());", "originalCommit": "319da713e5beb2610679d25b818eca1f6a9810b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f0f77098bbae810f4190ec015879535ed70cbb29", "chunk": "diff --git a/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java b/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java\nindex de37e7088..855b66856 100644\n--- a/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java\n+++ b/src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java\n\n@@ -1269,7 +1267,7 @@ public class OCFileListFragment extends ExtendedListFragment implements\n             switchToListView();\n         }\n \n-        DisplayUtils.setSortButton(mSortButton, preferences.getSortOrderByFolder(mFile), getContext());\n+        mSortButton.setText(DisplayUtils.getSortOrderStringId(preferences.getSortOrderByFolder(mFile)));\n         setGridSwitchButton();\n \n         if (mHideFab) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ2Nzk1OA==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r434467958", "bodyText": "\"action_sort\" is not removed?", "author": "JorisBodin", "createdAt": "2020-06-03T10:29:03Z", "path": "src/main/java/com/owncloud/android/ui/preview/PreviewTextFileFragment.java", "diffHunk": "@@ -287,12 +287,10 @@ public void onPrepareOptionsMenu(@NotNull Menu menu) {\n             menu.findItem(R.id.action_unset_favorite)\n         );\n \n-        Boolean dualPane = getResources().getBoolean(R.bool.large_land_layout);\n+        boolean dualPane = getResources().getBoolean(R.bool.large_land_layout);\n \n         if (!dualPane) {\n-            FileMenuFilter.hideMenuItems(menu.findItem(R.id.action_switch_view),\n-                                         menu.findItem(R.id.action_sort)\n-            );\n+            FileMenuFilter.hideMenuItems(menu.findItem(R.id.action_sort));", "originalCommit": "319da713e5beb2610679d25b818eca1f6a9810b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMjUzMQ==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r435012531", "bodyText": "Ops.\nAfter all changes I will go over whole project and remove all action_sort action_switch\u2026\nThanks for finding", "author": "tobiasKaminsky", "createdAt": "2020-06-04T06:08:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ2Nzk1OA=="}], "type": "inlineReview", "revised_code": {"commit": "f0f77098bbae810f4190ec015879535ed70cbb29", "chunk": "diff --git a/src/main/java/com/owncloud/android/ui/preview/PreviewTextFileFragment.java b/src/main/java/com/owncloud/android/ui/preview/PreviewTextFileFragment.java\nindex 262657720..6c7e07837 100644\n--- a/src/main/java/com/owncloud/android/ui/preview/PreviewTextFileFragment.java\n+++ b/src/main/java/com/owncloud/android/ui/preview/PreviewTextFileFragment.java\n\n@@ -287,12 +287,6 @@ public class PreviewTextFileFragment extends PreviewTextFragment {\n             menu.findItem(R.id.action_unset_favorite)\n         );\n \n-        boolean dualPane = getResources().getBoolean(R.bool.large_land_layout);\n-\n-        if (!dualPane) {\n-            FileMenuFilter.hideMenuItems(menu.findItem(R.id.action_sort));\n-        }\n-\n         if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {\n             FileMenuFilter.hideMenuItem(menu.findItem(R.id.action_edit));\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ2ODAzMA==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r434468030", "bodyText": "\"action_sort\" is not removed?", "author": "JorisBodin", "createdAt": "2020-06-03T10:29:10Z", "path": "src/main/java/com/owncloud/android/ui/preview/PreviewTextStringFragment.java", "diffHunk": "@@ -145,7 +145,6 @@ public void onPrepareOptionsMenu(@NonNull Menu menu) {\n         super.onPrepareOptionsMenu(menu);\n \n         menu.findItem(R.id.action_sort).setVisible(false);", "originalCommit": "319da713e5beb2610679d25b818eca1f6a9810b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ3MDUwMA==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r434470500", "bodyText": "We can not extract this in DisplayUtils? OCFileListFragment use setGridSwitchButton :)", "author": "JorisBodin", "createdAt": "2020-06-03T10:33:50Z", "path": "src/main/java/com/owncloud/android/ui/activity/UploadFilesActivity.java", "diffHunk": "@@ -170,15 +172,32 @@ public void onCreate(Bundle savedInstanceState) {\n         mFileListFragment = (LocalFileListFragment) getSupportFragmentManager().findFragmentById(R.id.local_files_list);\n \n         // Set input controllers\n-        MaterialButton mCancelButton = findViewById(R.id.upload_files_btn_cancel);\n-        mCancelButton.setTextColor(ThemeUtils.primaryColor(this, true));\n-        mCancelButton.setOnClickListener(this);\n+        MaterialButton cancelButton = findViewById(R.id.upload_files_btn_cancel);\n+        cancelButton.setTextColor(ThemeUtils.primaryColor(this, true));\n+        cancelButton.setOnClickListener(this);\n+\n+        MaterialButton uploadButton = findViewById(R.id.upload_files_btn_upload);\n+        uploadButton.setBackgroundTintMode(PorterDuff.Mode.SRC_ATOP);\n+        uploadButton.setBackgroundTintList(ColorStateList.valueOf(ThemeUtils.primaryColor(this, true)));\n+        uploadButton.setTextColor(ThemeUtils.fontColor(this, false));\n+        uploadButton.setOnClickListener(this);\n+\n+        sortButton = findViewById(R.id.sort_button);\n+        FileSortOrder fileSortOrder = preferences.getSortOrderByType(FileSortOrder.Type.uploadFilesView);\n+        DisplayUtils.setSortButton(sortButton, fileSortOrder, this);\n+        sortButton.setOnClickListener(l -> openSortingOrderDialogFragment(getSupportFragmentManager(), fileSortOrder));\n+\n+        MaterialButton switchButton = findViewById(R.id.switch_grid_view_button);\n+        switchButton.setOnClickListener(l -> {", "originalCommit": "319da713e5beb2610679d25b818eca1f6a9810b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMTQyMQ==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r435011421", "bodyText": "Check if is a grid view is different, so we cannot use it 1:1.", "author": "tobiasKaminsky", "createdAt": "2020-06-04T06:05:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ3MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA2OTE4MA==", "url": "https://github.com/nextcloud/android/pull/6203#discussion_r435069180", "bodyText": "For setIcon no?", "author": "JorisBodin", "createdAt": "2020-06-04T08:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ3MDUwMA=="}], "type": "inlineReview", "revised_code": {"commit": "f0f77098bbae810f4190ec015879535ed70cbb29", "chunk": "diff --git a/src/main/java/com/owncloud/android/ui/activity/UploadFilesActivity.java b/src/main/java/com/owncloud/android/ui/activity/UploadFilesActivity.java\nindex 7e2b4ad57..4279442f1 100644\n--- a/src/main/java/com/owncloud/android/ui/activity/UploadFilesActivity.java\n+++ b/src/main/java/com/owncloud/android/ui/activity/UploadFilesActivity.java\n\n@@ -184,7 +184,7 @@ public class UploadFilesActivity extends FileActivity implements LocalFileListFr\n \n         sortButton = findViewById(R.id.sort_button);\n         FileSortOrder fileSortOrder = preferences.getSortOrderByType(FileSortOrder.Type.uploadFilesView);\n-        DisplayUtils.setSortButton(sortButton, fileSortOrder, this);\n+        sortButton.setText(DisplayUtils.getSortOrderStringId(fileSortOrder));\n         sortButton.setOnClickListener(l -> openSortingOrderDialogFragment(getSupportFragmentManager(), fileSortOrder));\n \n         MaterialButton switchButton = findViewById(R.id.switch_grid_view_button);\n"}}, {"oid": "f0f77098bbae810f4190ec015879535ed70cbb29", "url": "https://github.com/nextcloud/android/commit/f0f77098bbae810f4190ec015879535ed70cbb29", "message": "Upload list activity: new sort / switch button\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-06-04T06:15:06Z", "type": "commit"}, {"oid": "f0f77098bbae810f4190ec015879535ed70cbb29", "url": "https://github.com/nextcloud/android/commit/f0f77098bbae810f4190ec015879535ed70cbb29", "message": "Upload list activity: new sort / switch button\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-06-04T06:15:06Z", "type": "forcePushed"}]}