{"pr_number": 6172, "pr_title": "fix search related items in drawer", "pr_createdAt": "2020-05-28T11:05:10Z", "pr_url": "https://github.com/nextcloud/android/pull/6172", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNjY2Mw==", "url": "https://github.com/nextcloud/android/pull/6172#discussion_r432136663", "bodyText": "sure?", "author": "AndyScherzinger", "createdAt": "2020-05-28T21:33:17Z", "path": "src/main/java/com/owncloud/android/utils/DrawerMenuUtil.java", "diffHunk": "@@ -42,31 +42,26 @@ private DrawerMenuUtil() {\n \n     public static void filterSearchMenuItems(Menu menu,\n                                              User user,\n-                                             Resources resources,\n-                                             boolean hasSearchSupport) {\n-        if (!user.isAnonymous() && !hasSearchSupport) {\n+                                             Resources resources) {\n+        if (user.isAnonymous()) {\n             filterMenuItems(menu, R.id.nav_photos, R.id.nav_favorites, R.id.nav_videos);\n         }\n \n-        if (hasSearchSupport) {\n-            if (!resources.getBoolean(R.bool.recently_added_enabled)) {\n-                menu.removeItem(R.id.nav_recently_added);\n-            }\n+        if (!resources.getBoolean(R.bool.recently_added_enabled)) {\n+            menu.removeItem(R.id.nav_recently_added);\n+        }\n \n-            if (!resources.getBoolean(R.bool.recently_modified_enabled)) {\n-                menu.removeItem(R.id.nav_recently_modified);\n-            }\n+        if (!resources.getBoolean(R.bool.recently_modified_enabled)) {\n+            menu.removeItem(R.id.nav_recently_modified);\n+        }\n \n-            if (!resources.getBoolean(R.bool.videos_enabled)) {\n-                menu.removeItem(R.id.nav_videos);\n-            }\n-        } else if (!user.isAnonymous()) {\n-            filterMenuItems(menu, R.id.nav_recently_added, R.id.nav_recently_modified, R.id.nav_videos);\n+        if (!resources.getBoolean(R.bool.videos_enabled)) {\n+            menu.removeItem(R.id.nav_videos);\n         }\n     }\n \n     public static void filterTrashbinMenuItem(Menu menu, User user, @Nullable OCCapability capability) {\n-        if (!user.isAnonymous() &&\n+        if (!user.isAnonymous() ||", "originalCommit": "bfa1de74642cae12d01452af1a4b015e62d68f70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNzQ1NA==", "url": "https://github.com/nextcloud/android/pull/6172#discussion_r432137454", "bodyText": "wouldn't it have to be\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!user.isAnonymous() ||\n          \n          \n            \n                    if (user.isAnonymous() ||\n          \n      \n    \n    \n  \n\nAs in remove menu item in case user is anonymous?", "author": "AndyScherzinger", "createdAt": "2020-05-28T21:35:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU3OTg2NA==", "url": "https://github.com/nextcloud/android/pull/6172#discussion_r432579864", "bodyText": "I guess we can just remove this.\nIt was previously needed as we had the check based on account, as we needed to check if the server (which is identified via account) is capable of search.\nBut as nowadays every supported NC server has search support, this is always true and thus we can remove also this check.\n(If a user is anonymous it means that the app is not logged in, so it should not show this screen at all\u2026)\nI will do it on Tuesday.", "author": "tobiasKaminsky", "createdAt": "2020-05-29T15:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg3MTQ1Mg==", "url": "https://github.com/nextcloud/android/pull/6172#discussion_r432871452", "bodyText": "anonymous user is the old account == null, which in turn was ususally a retrofitted workaround for a NPE bug", "author": "ezaquarii", "createdAt": "2020-05-30T17:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNjY2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "e81dcb780401842887e93bf7914d82ab4ccc7fbb", "chunk": "diff --git a/src/main/java/com/owncloud/android/utils/DrawerMenuUtil.java b/src/main/java/com/owncloud/android/utils/DrawerMenuUtil.java\nindex 268c584f0..5a664f53d 100644\n--- a/src/main/java/com/owncloud/android/utils/DrawerMenuUtil.java\n+++ b/src/main/java/com/owncloud/android/utils/DrawerMenuUtil.java\n\n@@ -60,9 +61,8 @@ public final class DrawerMenuUtil {\n         }\n     }\n \n-    public static void filterTrashbinMenuItem(Menu menu, User user, @Nullable OCCapability capability) {\n-        if (!user.isAnonymous() ||\n-            user.getServer().getVersion().compareTo(OwnCloudVersion.nextcloud_14) < 0 ||\n+    public static void filterTrashbinMenuItem(Menu menu, @NonNull User user, @Nullable OCCapability capability) {\n+        if (user.getServer().getVersion().compareTo(OwnCloudVersion.nextcloud_14) < 0 ||\n             capability != null && capability.getFilesUndelete().isFalse() ||\n             capability != null && capability.getFilesUndelete().isUnknown()) {\n             filterMenuItems(menu, R.id.nav_trashbin);\n"}}, {"oid": "e81dcb780401842887e93bf7914d82ab4ccc7fbb", "url": "https://github.com/nextcloud/android/commit/e81dcb780401842887e93bf7914d82ab4ccc7fbb", "message": "fix search related items in drawer\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-06-02T14:09:03Z", "type": "commit"}, {"oid": "e81dcb780401842887e93bf7914d82ab4ccc7fbb", "url": "https://github.com/nextcloud/android/commit/e81dcb780401842887e93bf7914d82ab4ccc7fbb", "message": "fix search related items in drawer\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-06-02T14:09:03Z", "type": "forcePushed"}]}