{"pr_number": 5509, "pr_title": "Resolved the crash when account is not new (Auth)", "pr_createdAt": "2020-02-23T19:10:01Z", "pr_url": "https://github.com/nextcloud/android/pull/5509", "timeline": [{"oid": "959ce4806b1f16ff2c978fd778b4aac0ddb04ed3", "url": "https://github.com/nextcloud/android/commit/959ce4806b1f16ff2c978fd778b4aac0ddb04ed3", "message": "Resolved the crash when account is not new (Auth)\n\nFixes #5058\n\nSigned-off-by: Kilian P\u00e9risset <kilian.perisset@infomaniak.com>\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>", "committedDate": "2020-02-23T19:10:51Z", "type": "forcePushed"}, {"oid": "214a125808c17cac68d99d91e3b928eaa4430675", "url": "https://github.com/nextcloud/android/commit/214a125808c17cac68d99d91e3b928eaa4430675", "message": "Resolved the crash when account is not new (Auth)\n\nSigned-off-by: Kilian P\u00e9risset <kilian.perisset@infomaniak.com>\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>", "committedDate": "2020-02-23T22:48:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk5NzkzNA==", "url": "https://github.com/nextcloud/android/pull/5509#discussion_r384997934", "bodyText": "Why not put directly into mAuthStatusText?", "author": "JorisBodin", "createdAt": "2020-02-27T09:16:50Z", "path": "src/main/java/com/owncloud/android/authentication/AuthenticatorActivity.java", "diffHunk": "@@ -1513,9 +1510,20 @@ private void updateAuthStatusIconAndText(RemoteOperationResult result) {\n             case HOST_NOT_AVAILABLE:\n                 mAuthStatusText = getResources().getString(R.string.auth_unknown_host_title);\n                 break;\n+            case ACCOUNT_NOT_NEW:\n+                String errorMessage = getString(R.string.auth_account_not_new);", "originalCommit": "214a125808c17cac68d99d91e3b928eaa4430675", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAxMjY0MA==", "url": "https://github.com/nextcloud/android/pull/5509#discussion_r385012640", "bodyText": "Good point, I applied a quick patch", "author": "Kilian-Perisset", "createdAt": "2020-02-27T09:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk5NzkzNA=="}], "type": "inlineReview", "revised_code": {"commit": "9fc40c61f0e73b32baa5142f2b2bd6e08c0dcaa4", "chunk": "diff --git a/src/main/java/com/owncloud/android/authentication/AuthenticatorActivity.java b/src/main/java/com/owncloud/android/authentication/AuthenticatorActivity.java\nindex cf6d69007..036506131 100644\n--- a/src/main/java/com/owncloud/android/authentication/AuthenticatorActivity.java\n+++ b/src/main/java/com/owncloud/android/authentication/AuthenticatorActivity.java\n\n@@ -1511,11 +1511,9 @@ public class AuthenticatorActivity extends AccountAuthenticatorActivity\n                 mAuthStatusText = getResources().getString(R.string.auth_unknown_host_title);\n                 break;\n             case ACCOUNT_NOT_NEW:\n-                String errorMessage = getString(R.string.auth_account_not_new);\n+                mAuthStatusText = getString(R.string.auth_account_not_new);\n                 if (webViewLoginMethod && !showWebViewLoginUrl) {\n-                    DisplayUtils.showErrorAndFinishActivity(this, errorMessage);\n-                } else {\n-                    mAuthStatusText = errorMessage;\n+                    DisplayUtils.showErrorAndFinishActivity(this, mAuthStatusText);\n                 }\n                 break;\n             case UNHANDLED_HTTP_CODE:\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1OTQzMg==", "url": "https://github.com/nextcloud/android/pull/5509#discussion_r409459432", "bodyText": "Why is this removed?", "author": "tobiasKaminsky", "createdAt": "2020-04-16T10:43:31Z", "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2592,18 +2574,12 @@ public void onStart() {\n                     startSyncFolderOperation(file, false);\n                 }\n             } else {\n-                updateFragmentsVisibility(!file.isFolder());\n-                updateActionBarTitleAndHomeButton(file.isFolder() ? null : file);\n+                mLastDisplayedAccount = null;\n             }\n-        }\n-        if (optionalUser.isPresent()) {", "originalCommit": "ab15e7b5c34c05806e142cafd315c338053799fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9fc40c61f0e73b32baa5142f2b2bd6e08c0dcaa4", "chunk": "diff --git a/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java b/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java\nindex 6a27ca55b..4fad44538 100644\n--- a/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java\n+++ b/src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java\n\n@@ -2574,12 +2600,18 @@ public class FileDisplayActivity extends FileActivity\n                     startSyncFolderOperation(file, false);\n                 }\n             } else {\n-                mLastDisplayedAccount = null;\n+                updateFragmentsVisibility(!file.isFolder());\n+                updateActionBarTitleAndHomeButton(file.isFolder() ? null : file);\n             }\n-\n-            EventBus.getDefault().post(new TokenPushEvent());\n-            checkForNewDevVersionNecessary(findViewById(R.id.root_layout), getApplicationContext());\n         }\n+        if (optionalUser.isPresent()) {\n+            mLastDisplayedAccount = optionalUser.get().toPlatformAccount();\n+        } else {\n+            mLastDisplayedAccount = null;\n+        }\n+\n+        EventBus.getDefault().post(new TokenPushEvent());\n+        checkForNewDevVersionNecessary(findViewById(R.id.root_layout), getApplicationContext());\n     }\n \n     @Override\n"}}, {"oid": "5942e4e6617470824037e48bcdba49e064bb23b2", "url": "https://github.com/nextcloud/android/commit/5942e4e6617470824037e48bcdba49e064bb23b2", "message": "Resolved the crash when account is not new (Auth)\n\nSigned-off-by: Kilian P\u00e9risset <kilian.perisset@infomaniak.com>\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>", "committedDate": "2020-04-21T07:03:57Z", "type": "commit"}, {"oid": "9fc40c61f0e73b32baa5142f2b2bd6e08c0dcaa4", "url": "https://github.com/nextcloud/android/commit/9fc40c61f0e73b32baa5142f2b2bd6e08c0dcaa4", "message": "Formated the code (applied DRY principle)\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-04-21T07:10:12Z", "type": "commit"}, {"oid": "9fc40c61f0e73b32baa5142f2b2bd6e08c0dcaa4", "url": "https://github.com/nextcloud/android/commit/9fc40c61f0e73b32baa5142f2b2bd6e08c0dcaa4", "message": "Formated the code (applied DRY principle)\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-04-21T07:10:12Z", "type": "forcePushed"}]}