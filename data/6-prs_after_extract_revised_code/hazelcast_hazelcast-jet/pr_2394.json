{"pr_number": 2394, "pr_title": "Add distribute-to-one edge type", "pr_createdAt": "2020-07-09T07:32:10Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2394", "timeline": [{"oid": "657b68c6bd761e6ee8c69d658576ed46fb25a997", "url": "https://github.com/hazelcast/hazelcast-jet/commit/657b68c6bd761e6ee8c69d658576ed46fb25a997", "message": "Add distribute-to-one edge type\n\nState: feature implemented, but untested", "committedDate": "2020-07-09T07:31:30Z", "type": "commit"}, {"oid": "2d28d2dd4386034d567e38a3b4b0aa4d1d8fa12d", "url": "https://github.com/hazelcast/hazelcast-jet/commit/2d28d2dd4386034d567e38a3b4b0aa4d1d8fa12d", "message": "Fix test failure", "committedDate": "2020-07-09T08:29:10Z", "type": "commit"}, {"oid": "367281f85b44e0c5de6165be6066aacd1d8db608", "url": "https://github.com/hazelcast/hazelcast-jet/commit/367281f85b44e0c5de6165be6066aacd1d8db608", "message": "Add test, the orphaned processor doesn't terminate (i guess so)", "committedDate": "2020-07-09T14:56:39Z", "type": "commit"}, {"oid": "77b736e5f18c779ee8d82944a023e6e70a7a535b", "url": "https://github.com/hazelcast/hazelcast-jet/commit/77b736e5f18c779ee8d82944a023e6e70a7a535b", "message": "Merge branch 'master' into distribute-to-one", "committedDate": "2020-07-20T14:44:55Z", "type": "commit"}, {"oid": "6daff779acfc0ddcfaa48e51d75f8882d5519847", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6daff779acfc0ddcfaa48e51d75f8882d5519847", "message": "Test", "committedDate": "2020-07-20T14:59:33Z", "type": "commit"}, {"oid": "a9f1cbe8add0cb1a38c262e5f03e3bdbf0377d3c", "url": "https://github.com/hazelcast/hazelcast-jet/commit/a9f1cbe8add0cb1a38c262e5f03e3bdbf0377d3c", "message": "Final impl", "committedDate": "2020-07-21T13:33:23Z", "type": "commit"}, {"oid": "f039da385d6483ad320286c36e030ffe30b967f2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/f039da385d6483ad320286c36e030ffe30b967f2", "message": "Touchups", "committedDate": "2020-07-21T14:03:35Z", "type": "commit"}, {"oid": "0daddcf021f30547601c8429f9d5d9c2fd7ef162", "url": "https://github.com/hazelcast/hazelcast-jet/commit/0daddcf021f30547601c8429f9d5d9c2fd7ef162", "message": "Merge branch 'master' into distribute-to-one\n\n# Conflicts:\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/PartitionArrangement.java", "committedDate": "2020-07-22T08:20:02Z", "type": "commit"}, {"oid": "bfab85be3d15884d1e204a5cba23005fdb0d6c2e", "url": "https://github.com/hazelcast/hazelcast-jet/commit/bfab85be3d15884d1e204a5cba23005fdb0d6c2e", "message": "Fix test failure", "committedDate": "2020-07-22T09:37:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU4ODkxNQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2394#discussion_r461588915", "bodyText": "This is a breaking change and possibly undesirable. The user could be checking if the edge already has a destination.", "author": "mtopolnik", "createdAt": "2020-07-28T13:41:58Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java", "diffHunk": "@@ -177,8 +198,9 @@ public int getSourceOrdinal() {\n     /**\n      * Returns the name of the destination vertex.\n      */\n+    @Nonnull\n     public String getDestName() {\n-        return destName;\n+        return requireNonNull(destName, \"destination not yet set on the edge\");", "originalCommit": "bfab85be3d15884d1e204a5cba23005fdb0d6c2e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "309f442fd4d8da3c029011b25838affe83d8af46", "chunk": "diff --git a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java\nindex d72d30594f..3a1e8397c2 100644\n--- a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java\n+++ b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java\n\n@@ -198,9 +198,9 @@ public class Edge implements IdentifiedDataSerializable {\n     /**\n      * Returns the name of the destination vertex.\n      */\n-    @Nonnull\n+    @Nullable\n     public String getDestName() {\n-        return requireNonNull(destName, \"destination not yet set on the edge\");\n+        return destName;\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU5MjAxMw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2394#discussion_r461592013", "bodyText": "Why the double null check?", "author": "mtopolnik", "createdAt": "2020-07-28T13:46:05Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/ConveyorCollector.java", "diffHunk": "@@ -19,16 +19,19 @@\n import com.hazelcast.internal.util.concurrent.ConcurrentConveyor;\n import com.hazelcast.jet.impl.util.ProgressState;\n \n+import javax.annotation.Nonnull;\n import javax.annotation.Nullable;\n \n+import static java.util.Objects.requireNonNull;\n+\n public class ConveyorCollector implements OutboundCollector {\n \n     private final ConcurrentConveyor<Object> conveyor;\n     private final int queueIndex;\n     private final int[] partitions;\n \n-    public ConveyorCollector(ConcurrentConveyor<Object> conveyor, int queueIndex, @Nullable int[] partitions) {\n-        this.conveyor = conveyor;\n+    public ConveyorCollector(@Nonnull ConcurrentConveyor<Object> conveyor, int queueIndex, @Nullable int[] partitions) {\n+        this.conveyor = requireNonNull(conveyor);", "originalCommit": "bfab85be3d15884d1e204a5cba23005fdb0d6c2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg1Mjk4Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2394#discussion_r461852986", "bodyText": "The @Nonnull is not a check, just an annotation which can be ignored.", "author": "viliam-durina", "createdAt": "2020-07-28T20:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU5MjAxMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYyNDM2Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2394#discussion_r461624366", "bodyText": "String.valueOf(e.getDistributedTo()) is nicer than this \"append empty string\" idiom.", "author": "mtopolnik", "createdAt": "2020-07-28T14:26:58Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/DAG.java", "diffHunk": "@@ -363,7 +361,7 @@ public JsonObject toJson(int defaultLocalParallelism) {\n             edge.add(\"to\", e.getDestName());\n             edge.add(\"toOrdinal\", e.getDestOrdinal());\n             edge.add(\"priority\", e.getPriority());\n-            edge.add(\"distributed\", e.isDistributed());\n+            edge.add(\"distributedTo\", e.getDistributedTo() + \"\");", "originalCommit": "bfab85be3d15884d1e204a5cba23005fdb0d6c2e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "309f442fd4d8da3c029011b25838affe83d8af46", "chunk": "diff --git a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/DAG.java b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/DAG.java\nindex 2ace4989af..8e8487fc67 100644\n--- a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/DAG.java\n+++ b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/DAG.java\n\n@@ -361,7 +365,7 @@ public class DAG implements IdentifiedDataSerializable, Iterable<Vertex> {\n             edge.add(\"to\", e.getDestName());\n             edge.add(\"toOrdinal\", e.getDestOrdinal());\n             edge.add(\"priority\", e.getPriority());\n-            edge.add(\"distributedTo\", e.getDistributedTo() + \"\");\n+            edge.add(\"distributedTo\", String.valueOf(e.getDistributedTo()));\n             edge.add(\"type\", e.getRoutingPolicy().toString().toLowerCase());\n             edges.add(edge);\n         }\n"}}, {"oid": "448b681c87d5bfa93ad3055f6feb5573b17a9ad0", "url": "https://github.com/hazelcast/hazelcast-jet/commit/448b681c87d5bfa93ad3055f6feb5573b17a9ad0", "message": "Merge branch 'master' into distribute-to-one", "committedDate": "2020-07-28T20:16:25Z", "type": "commit"}, {"oid": "309f442fd4d8da3c029011b25838affe83d8af46", "url": "https://github.com/hazelcast/hazelcast-jet/commit/309f442fd4d8da3c029011b25838affe83d8af46", "message": "Address the review", "committedDate": "2020-07-28T20:24:40Z", "type": "commit"}, {"oid": "4400b1e81714bed7f3492c1448bc1f882710bc5f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/4400b1e81714bed7f3492c1448bc1f882710bc5f", "message": "Fix test failure", "committedDate": "2020-07-29T12:50:26Z", "type": "commit"}]}