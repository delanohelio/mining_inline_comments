{"pr_number": 2610, "pr_title": "Config option to disable the IMDG version check", "pr_createdAt": "2020-10-19T16:11:14Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2610", "timeline": [{"oid": "0efc024f2b2022b6cbddaeddafeb340e49224660", "url": "https://github.com/hazelcast/hazelcast-jet/commit/0efc024f2b2022b6cbddaeddafeb340e49224660", "message": "Move variable closer to usage", "committedDate": "2020-10-19T16:09:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE3MDAyNA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2610#discussion_r514170024", "bodyText": "We have com.hazelcast.jet.core.JetProperties that declares and documents all the user-configurable properties Jet recognizes.\nThe user can configure a property both as a system property and in the configuration file, this would be an exception. We could either make the check in a place where the properties are accessible, or failing that, document that this only works as a system property.\nAlso, please adjust the name to comply with the convention, and semantics so that the default value of false does the right thing: jet.imdg.version.mismatch.check.disabled.", "author": "mtopolnik", "createdAt": "2020-10-29T10:56:09Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/Jet.java", "diffHunk": "@@ -258,11 +259,18 @@ private static void assertHazelcastVersion() {\n             Properties p = new Properties();\n             p.load(resource);\n             String jetHzVersion = p.getProperty(\"jet.hazelcast.version\");\n+\n             if (!hzVersion.equals(jetHzVersion)) {\n-                throw new JetException(\"Jet uses Hazelcast IMDG version \" + jetHzVersion + \" however \" +\n+                String message = \"Jet uses Hazelcast IMDG version \" + jetHzVersion + \" however \" +\n                         \"version \" + hzVersion + \" was found in the classpath. \" +\n                         \" As Jet already shades Hazelcast jars there is no need to explicitly \" +\n-                        \"add a dependency to it.\");\n+                        \"add a dependency to it.\";\n+                boolean errorOnMismatch = parseBoolean(System.getProperty(\"jet.hazelcast.errorOnMismatch\", \"true\"));", "originalCommit": "0efc024f2b2022b6cbddaeddafeb340e49224660", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE4ODg1OA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2610#discussion_r514188858", "bodyText": "Thanks, I didn't know about it. Will submit changes shortly", "author": "TomaszGaweda", "createdAt": "2020-10-29T11:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE3MDAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIyMjczMQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2610#discussion_r514222731", "bodyText": "We discussed this some more, we already have a precedent for a property that only works as a sysprop: hazelcast.logging.type, and the reasons are similar -- it's read at class init time. So I think we're good if we just make a note on this in the docs.", "author": "mtopolnik", "createdAt": "2020-10-29T12:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE3MDAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQyODQ1MA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2610#discussion_r524428450", "bodyText": "I've changed the name and moved property to JetProperties. What kind of docs you were thinking about?", "author": "TomaszGaweda", "createdAt": "2020-11-16T17:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE3MDAyNA=="}], "type": "inlineReview", "revised_code": {"commit": "eb58688b6117d6d952b4ce9b8048085235b8328c", "chunk": "diff --git a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/Jet.java b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/Jet.java\nindex 99d28619a..25527cdc7 100644\n--- a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/Jet.java\n+++ b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/Jet.java\n\n@@ -265,7 +265,7 @@ public final class Jet {\n                         \"version \" + hzVersion + \" was found in the classpath. \" +\n                         \" As Jet already shades Hazelcast jars there is no need to explicitly \" +\n                         \"add a dependency to it.\";\n-                boolean errorOnMismatch = parseBoolean(System.getProperty(\"jet.hazelcast.errorOnMismatch\", \"true\"));\n+                boolean errorOnMismatch = !parseBoolean(System.getProperty(\"jet.imdg.version.mismatch.check.disabled\", \"false\"));\n                 if (errorOnMismatch) {\n                     throw new JetException(message);\n                 } else {\n"}}, {"oid": "eb58688b6117d6d952b4ce9b8048085235b8328c", "url": "https://github.com/hazelcast/hazelcast-jet/commit/eb58688b6117d6d952b4ce9b8048085235b8328c", "message": "After CR: Name changed", "committedDate": "2020-11-16T16:40:06Z", "type": "commit"}, {"oid": "682e92eba20f1425b484028dce44b6863ed24b42", "url": "https://github.com/hazelcast/hazelcast-jet/commit/682e92eba20f1425b484028dce44b6863ed24b42", "message": "Checkstyle", "committedDate": "2020-11-16T16:42:01Z", "type": "commit"}, {"oid": "692f11ecd06a2324c752b9baf4f211be8a4c11cf", "url": "https://github.com/hazelcast/hazelcast-jet/commit/692f11ecd06a2324c752b9baf4f211be8a4c11cf", "message": "Typo", "committedDate": "2020-11-16T16:51:40Z", "type": "commit"}, {"oid": "6fd828a3e57ded5ea6117664cf37fd461d20cbd2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6fd828a3e57ded5ea6117664cf37fd461d20cbd2", "message": "Moved property to JetProperties", "committedDate": "2020-11-16T17:06:09Z", "type": "commit"}, {"oid": "d484d55e312d4d9e55b93c0a15b7e21e5faaff75", "url": "https://github.com/hazelcast/hazelcast-jet/commit/d484d55e312d4d9e55b93c0a15b7e21e5faaff75", "message": "Checkstyle again", "committedDate": "2020-11-16T17:22:28Z", "type": "commit"}, {"oid": "f1da7ef3e9be81234fb3ce1fefd025f0e4b54eaa", "url": "https://github.com/hazelcast/hazelcast-jet/commit/f1da7ef3e9be81234fb3ce1fefd025f0e4b54eaa", "message": "Checkstyle again", "committedDate": "2020-11-16T17:38:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc2ODExNA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2610#discussion_r546768114", "bodyText": "Please wrap this text (72 chars starting from the 1st text char), otherwise we can merge it.", "author": "mtopolnik", "createdAt": "2020-12-21T15:26:25Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/JetProperties.java", "diffHunk": "@@ -88,6 +88,16 @@\n     public static final HazelcastProperty JET_HOME\n             = new HazelcastProperty(\"jet.home\", \"\");\n \n+    /**\n+     * If {@code false}, Jet will check during initialization that IMDG module has compatible version.", "originalCommit": "f1da7ef3e9be81234fb3ce1fefd025f0e4b54eaa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0cafe51a55636ff1addd04fc4e20e7a75a7443df", "chunk": "diff --git a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/JetProperties.java b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/JetProperties.java\nindex 7d3fa1f39..f219b25fb 100644\n--- a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/JetProperties.java\n+++ b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/JetProperties.java\n\n@@ -79,9 +79,9 @@ public final class JetProperties {\n             = new HazelcastProperty(\"jet.job.results.max.size\", 1_000);\n \n     /**\n-     * Root of Jet installation. Used as default location for the lossless restart\n-     * store. By default it will be automatically set to the start of the Jet\n-     * installation path.\n+     * Root of Jet installation. Used as default location for the lossless\n+     * restart store. By default it will be automatically set to the start of\n+     * the Jet installation path.\n      *\n      * @since 3.2\n      */\n"}}, {"oid": "0cafe51a55636ff1addd04fc4e20e7a75a7443df", "url": "https://github.com/hazelcast/hazelcast-jet/commit/0cafe51a55636ff1addd04fc4e20e7a75a7443df", "message": "Rewrap Javadoc", "committedDate": "2020-12-23T10:09:04Z", "type": "commit"}, {"oid": "c3f4e01f02d0e869333361d0a2d48c22d0f089ae", "url": "https://github.com/hazelcast/hazelcast-jet/commit/c3f4e01f02d0e869333361d0a2d48c22d0f089ae", "message": "Improve version check property doc", "committedDate": "2020-12-23T11:11:30Z", "type": "commit"}]}