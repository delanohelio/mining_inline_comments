{"pr_number": 2417, "pr_title": "Fix WriteKafkaPTest.test_resumeTransaction failure", "pr_createdAt": "2020-07-23T16:34:35Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2417", "timeline": [{"oid": "15f7b918cdfc084741ced14b5f87518d4434e9c2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/15f7b918cdfc084741ced14b5f87518d4434e9c2", "message": "Fix WriteKafkaPTest.test_resumeTransaction failure\n\nWe waited for 2 seconds for the kafka to deliver the results, probably\nit wasn't long enough. Also it could happen that we receive 1 record and\ndon't poll for the next, even though it wasn't the case this time.\n\nAn attempt to fix #2398", "committedDate": "2020-07-23T16:33:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYwMTY0Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2417#discussion_r465601646", "bodyText": "This will loop indefinitely if the records aren't received, failing with a generic test timeout.\nWouldn't it be better to try the poll several times and eventually fail with an error message saying \"didn't receive X records within 30 seconds\" or similar?", "author": "frant-hartm", "createdAt": "2020-08-05T09:38:48Z", "path": "extensions/kafka/src/test/java/com/hazelcast/jet/kafka/impl/WriteKafkaPTest.java", "diffHunk": "@@ -264,10 +264,14 @@ public void test_resumeTransaction() throws Exception {\n         producer.commitTransaction();\n \n         // verify items are visible\n-        polledRecords = consumer.poll(Duration.ofSeconds(2));\n         StringBuilder actualContents = new StringBuilder();\n-        for (ConsumerRecord<String, String> record : polledRecords) {\n-            actualContents.append(record.value()).append('\\n');\n+        for (int receivedCount = 0; receivedCount < 2; ) {", "originalCommit": "15f7b918cdfc084741ced14b5f87518d4434e9c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY4MjMwNw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2417#discussion_r465682307", "bodyText": "Yeah, it would be better, but I think it's enough for now. The test maybe never failed.", "author": "viliam-durina", "createdAt": "2020-08-05T12:14:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYwMTY0Ng=="}], "type": "inlineReview", "revised_code": null}]}