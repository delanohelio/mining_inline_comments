{"pr_number": 2190, "pr_title": "Use job-level serializer to get partition id", "pr_createdAt": "2020-04-17T09:38:10Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2190", "timeline": [{"oid": "6ae6a71909696e258c25102fc2fece3da3a73167", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6ae6a71909696e258c25102fc2fece3da3a73167", "message": "Use job-level serializer to get partition id", "committedDate": "2020-04-17T09:33:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE2MzU0Mg==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2190#discussion_r410163542", "bodyText": "very minor but I find it more readable if the closing ) is on the next line here.", "author": "cangencer", "createdAt": "2020-04-17T11:31:31Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java", "diffHunk": "@@ -344,7 +344,8 @@ private void initDag() {\n                 .flatMap(List::stream)\n                 .map(EdgeDef::partitioner)\n                 .filter(Objects::nonNull)\n-                .forEach(p -> p.init(partitionService::getPartitionId));\n+                .forEach(partitioner ->\n+                        partitioner.init(object -> partitionService.getPartitionId(serializationService.toData(object))));", "originalCommit": "6ae6a71909696e258c25102fc2fece3da3a73167", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1fe54801333d775d68a74abfca3e8af97eeef942", "chunk": "diff --git a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\nindex 73c7b78673..afe226b2da 100644\n--- a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\n+++ b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\n\n@@ -345,7 +345,8 @@ public class ExecutionPlan implements IdentifiedDataSerializable {\n                 .map(EdgeDef::partitioner)\n                 .filter(Objects::nonNull)\n                 .forEach(partitioner ->\n-                        partitioner.init(object -> partitionService.getPartitionId(serializationService.toData(object))));\n+                        partitioner.init(object -> partitionService.getPartitionId(jobSerializationService.toData(object)))\n+                );\n     }\n \n     private static Collection<? extends Processor> createProcessors(VertexDef vertexDef, int parallelism) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE2MzcxNA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2190#discussion_r410163714", "bodyText": "this should be called jobSerializationService", "author": "cangencer", "createdAt": "2020-04-17T11:31:56Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java", "diffHunk": "@@ -148,7 +148,7 @@ public void initialize(NodeEngine nodeEngine,\n         this.nodeEngine = (NodeEngineImpl) nodeEngine;\n         this.executionId = executionId;\n         initProcSuppliers(jobId, executionId, tempDirectories, serializationService);\n-        initDag();\n+        initDag(serializationService);", "originalCommit": "6ae6a71909696e258c25102fc2fece3da3a73167", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1fe54801333d775d68a74abfca3e8af97eeef942", "chunk": "diff --git a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\nindex 73c7b78673..afe226b2da 100644\n--- a/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\n+++ b/hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/ExecutionPlan.java\n\n@@ -144,11 +144,11 @@ public class ExecutionPlan implements IdentifiedDataSerializable {\n                            long executionId,\n                            SnapshotContext snapshotContext,\n                            ConcurrentHashMap<String, File> tempDirectories,\n-                           InternalSerializationService serializationService) {\n+                           InternalSerializationService jobSerializationService) {\n         this.nodeEngine = (NodeEngineImpl) nodeEngine;\n         this.executionId = executionId;\n-        initProcSuppliers(jobId, executionId, tempDirectories, serializationService);\n-        initDag(serializationService);\n+        initProcSuppliers(jobId, executionId, tempDirectories, jobSerializationService);\n+        initDag(jobSerializationService);\n \n         this.ptionArrgmt = new PartitionArrangement(partitionOwners, nodeEngine.getThisAddress());\n         JetInstance instance = getJetInstance(nodeEngine);\n"}}, {"oid": "1fe54801333d775d68a74abfca3e8af97eeef942", "url": "https://github.com/hazelcast/hazelcast-jet/commit/1fe54801333d775d68a74abfca3e8af97eeef942", "message": "Naming & formatting", "committedDate": "2020-04-17T11:54:05Z", "type": "commit"}, {"oid": "92f8c70da41de11c3bafeaab679d858eab882500", "url": "https://github.com/hazelcast/hazelcast-jet/commit/92f8c70da41de11c3bafeaab679d858eab882500", "message": "Make checkstyle happy", "committedDate": "2020-04-17T12:14:14Z", "type": "commit"}]}