{"pr_number": 886, "pr_title": "[IOTDB-545] Update checkPathValidity in Session", "pr_createdAt": "2020-03-05T13:07:40Z", "pr_url": "https://github.com/apache/iotdb/pull/886", "timeline": [{"oid": "84b7135868813968900a6f87df3001d44992e65b", "url": "https://github.com/apache/iotdb/commit/84b7135868813968900a6f87df3001d44992e65b", "message": "[IOTDB-545] Update checkPathValidity in Session", "committedDate": "2020-03-05T13:05:32Z", "type": "commit"}, {"oid": "a51e48cd1f5c9b46086d9498369e3ddf05bdd39a", "url": "https://github.com/apache/iotdb/commit/a51e48cd1f5c9b46086d9498369e3ddf05bdd39a", "message": "Separate matcher to nodes", "committedDate": "2020-03-05T14:20:32Z", "type": "commit"}, {"oid": "3a36b36c634c39a53138c08504907e5f0cf248e2", "url": "https://github.com/apache/iotdb/commit/3a36b36c634c39a53138c08504907e5f0cf248e2", "message": "Fix code smell", "committedDate": "2020-03-05T14:23:13Z", "type": "commit"}, {"oid": "2c4d81e7bcef981d5fb12fc9fb2c68f72574ba39", "url": "https://github.com/apache/iotdb/commit/2c4d81e7bcef981d5fb12fc9fb2c68f72574ba39", "message": "Fix tests", "committedDate": "2020-03-06T01:04:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY4NDE5MA==", "url": "https://github.com/apache/iotdb/pull/886#discussion_r388684190", "bodyText": "add UT for this", "author": "qiaojialin", "createdAt": "2020-03-06T02:33:08Z", "path": "session/src/main/java/org/apache/iotdb/session/Session.java", "diffHunk": "@@ -654,8 +648,7 @@ public void executeNonQueryStatement(String sql) throws TException, IoTDBRPCExce\n   private void checkPathValidity(String path) throws IoTDBSessionException {", "originalCommit": "2c4d81e7bcef981d5fb12fc9fb2c68f72574ba39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY4Njg3Nw==", "url": "https://github.com/apache/iotdb/pull/886#discussion_r388686877", "bodyText": "Added. Thanks for reminding.", "author": "samperson1997", "createdAt": "2020-03-06T02:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY4NDE5MA=="}], "type": "inlineReview", "revised_code": {"commit": "60ba663d833960214f163868a2375af0bb0c76cc", "chunk": "diff --git a/session/src/main/java/org/apache/iotdb/session/Session.java b/session/src/main/java/org/apache/iotdb/session/Session.java\nindex 1f8a18460..769281f32 100644\n--- a/session/src/main/java/org/apache/iotdb/session/Session.java\n+++ b/session/src/main/java/org/apache/iotdb/session/Session.java\n\n@@ -646,7 +645,7 @@ public class Session {\n   }\n \n   private void checkPathValidity(String path) throws IoTDBSessionException {\n-    if (!Pattern.matches(PATH_MATCHER, path)) {\n+    if (!PATH_PATTERN.matcher(path).matches()) {\n       throw new IoTDBSessionException(\n           String.format(\"Path [%s] is invalid\", path));\n     }\n"}}, {"oid": "f3eb4bb0e7bed3eb98059a0646baa2e1f37939fa", "url": "https://github.com/apache/iotdb/commit/f3eb4bb0e7bed3eb98059a0646baa2e1f37939fa", "message": "Add UT", "committedDate": "2020-03-06T02:43:54Z", "type": "commit"}, {"oid": "cbf5fe0c69a86f376a4353f97c9224249f55f0a9", "url": "https://github.com/apache/iotdb/commit/cbf5fe0c69a86f376a4353f97c9224249f55f0a9", "message": "Add header", "committedDate": "2020-03-06T02:44:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NjAyNQ==", "url": "https://github.com/apache/iotdb/pull/886#discussion_r388696025", "bodyText": "Why not use Pattern here?", "author": "vesense", "createdAt": "2020-03-06T03:25:50Z", "path": "session/src/main/java/org/apache/iotdb/session/Config.java", "diffHunk": "@@ -28,7 +28,12 @@\n   public static final int DEFAULT_FETCH_SIZE = 10000;\n   public static final int DEFAULT_TIMEOUT_MS = 0;\n \n+  public static final String NODE_MATCHER = \"[\" + PATH_SEPARATOR + \"]\" + \"([a-zA-Z0-9_]+)\";\n+\n+  // for path like: root.sg1.d1.\"1.2.3\" or root.sg1.d1.'1.2.3', only occurs in the end of the path and only occurs once\n+  public static final String NODE_WITH_QUOTATION_MARK_MATCHER =\n+      \"[\" + PATH_SEPARATOR + \"][\\\"|\\']([a-zA-Z0-9_]+)(\" + NODE_MATCHER + \")+[\\\"|\\']\";\n   public static final String PATH_MATCHER =\n-      PATH_ROOT + \"([\" + PATH_SEPARATOR + \"](([a-zA-Z_][a-zA-Z0-9_-]*)|([+-]?[0-9]+)))+\";\n+      PATH_ROOT + \"(\" + NODE_MATCHER + \")+(\" + NODE_WITH_QUOTATION_MARK_MATCHER + \")?\";", "originalCommit": "cbf5fe0c69a86f376a4353f97c9224249f55f0a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODczMDI0Ng==", "url": "https://github.com/apache/iotdb/pull/886#discussion_r388730246", "bodyText": "Fixed.", "author": "samperson1997", "createdAt": "2020-03-06T06:19:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NjAyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "60ba663d833960214f163868a2375af0bb0c76cc", "chunk": "diff --git a/session/src/main/java/org/apache/iotdb/session/Config.java b/session/src/main/java/org/apache/iotdb/session/Config.java\nindex 857deb134..4f3fea7e7 100644\n--- a/session/src/main/java/org/apache/iotdb/session/Config.java\n+++ b/session/src/main/java/org/apache/iotdb/session/Config.java\n\n@@ -21,6 +21,8 @@ package org.apache.iotdb.session;\n import static org.apache.iotdb.tsfile.common.constant.TsFileConstant.PATH_ROOT;\n import static org.apache.iotdb.tsfile.common.constant.TsFileConstant.PATH_SEPARATOR;\n \n+import java.util.regex.Pattern;\n+\n public class Config {\n \n   public static final String DEFAULT_USER = \"user\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NjIwNA==", "url": "https://github.com/apache/iotdb/pull/886#discussion_r388696204", "bodyText": "If a pattern is to be used multiple times, compiling it once and reusing it will be more efficient than invoking this method each time.", "author": "vesense", "createdAt": "2020-03-06T03:26:36Z", "path": "session/src/main/java/org/apache/iotdb/session/Session.java", "diffHunk": "@@ -654,8 +648,7 @@ public void executeNonQueryStatement(String sql) throws TException, IoTDBRPCExce\n   private void checkPathValidity(String path) throws IoTDBSessionException {\n     if (!Pattern.matches(PATH_MATCHER, path)) {", "originalCommit": "cbf5fe0c69a86f376a4353f97c9224249f55f0a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODczMDQzMQ==", "url": "https://github.com/apache/iotdb/pull/886#discussion_r388730431", "bodyText": "Hi, thanks a lot for this suggestion! That's quite useful, and I have updated it in the latest commit. : )", "author": "samperson1997", "createdAt": "2020-03-06T06:20:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NjIwNA=="}], "type": "inlineReview", "revised_code": {"commit": "60ba663d833960214f163868a2375af0bb0c76cc", "chunk": "diff --git a/session/src/main/java/org/apache/iotdb/session/Session.java b/session/src/main/java/org/apache/iotdb/session/Session.java\nindex 1f8a18460..769281f32 100644\n--- a/session/src/main/java/org/apache/iotdb/session/Session.java\n+++ b/session/src/main/java/org/apache/iotdb/session/Session.java\n\n@@ -646,7 +645,7 @@ public class Session {\n   }\n \n   private void checkPathValidity(String path) throws IoTDBSessionException {\n-    if (!Pattern.matches(PATH_MATCHER, path)) {\n+    if (!PATH_PATTERN.matcher(path).matches()) {\n       throw new IoTDBSessionException(\n           String.format(\"Path [%s] is invalid\", path));\n     }\n"}}, {"oid": "60ba663d833960214f163868a2375af0bb0c76cc", "url": "https://github.com/apache/iotdb/commit/60ba663d833960214f163868a2375af0bb0c76cc", "message": "[IOTDB-545] Update checkPathValidity in Session", "committedDate": "2020-03-06T06:19:38Z", "type": "commit"}, {"oid": "7c35b55ca01a43ffbd8788cdff87a3a1a6dd6b99", "url": "https://github.com/apache/iotdb/commit/7c35b55ca01a43ffbd8788cdff87a3a1a6dd6b99", "message": "Merge remote-tracking branch 'upstream/master' into jira_545", "committedDate": "2020-03-06T08:59:01Z", "type": "commit"}]}