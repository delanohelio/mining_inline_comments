{"pr_number": 1411, "pr_title": "[IOTDB-706] Introduce virtual memtable for larger Chunk", "pr_createdAt": "2020-06-23T11:50:52Z", "pr_url": "https://github.com/apache/iotdb/pull/1411", "timeline": [{"oid": "703014bcc2906f65c36eddccd29c0db7c113f94c", "url": "https://github.com/apache/iotdb/commit/703014bcc2906f65c36eddccd29c0db7c113f94c", "message": "add log close", "committedDate": "2020-07-09T07:00:23Z", "type": "commit"}, {"oid": "cb4bcf072c33c9e9eab19cb130b15472720611b9", "url": "https://github.com/apache/iotdb/commit/cb4bcf072c33c9e9eab19cb130b15472720611b9", "message": "fix", "committedDate": "2020-07-09T09:28:24Z", "type": "commit"}, {"oid": "782518d2e7c72e931082aa6354d48bb9fb100b39", "url": "https://github.com/apache/iotdb/commit/782518d2e7c72e931082aa6354d48bb9fb100b39", "message": "fix", "committedDate": "2020-07-09T13:10:31Z", "type": "commit"}, {"oid": "a100b2483a8e58a8505ba1c8e94b5bb54e9e63a8", "url": "https://github.com/apache/iotdb/commit/a100b2483a8e58a8505ba1c8e94b5bb54e9e63a8", "message": "fix", "committedDate": "2020-07-09T14:45:04Z", "type": "commit"}, {"oid": "e52e0e400908e26b3850c5c44a9c2a590ff3d2ac", "url": "https://github.com/apache/iotdb/commit/e52e0e400908e26b3850c5c44a9c2a590ff3d2ac", "message": "Merge branch 'hot_compaction' into fix_windows_ci_bug\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java", "committedDate": "2020-07-09T23:16:13Z", "type": "commit"}, {"oid": "9bf7da20ae378ea2eff84e69b06882b622b06f65", "url": "https://github.com/apache/iotdb/commit/9bf7da20ae378ea2eff84e69b06882b622b06f65", "message": "fix", "committedDate": "2020-07-09T23:37:40Z", "type": "commit"}, {"oid": "a436db223b387253858c17b04f103432aeecee17", "url": "https://github.com/apache/iotdb/commit/a436db223b387253858c17b04f103432aeecee17", "message": "just end file", "committedDate": "2020-07-10T01:12:45Z", "type": "commit"}, {"oid": "938e80aa4af09166dcadde7ca525f01c5dbbf05c", "url": "https://github.com/apache/iotdb/commit/938e80aa4af09166dcadde7ca525f01c5dbbf05c", "message": "add log", "committedDate": "2020-07-10T02:43:22Z", "type": "commit"}, {"oid": "9e30f0fa03f2fe9dec8e71d8ba851337d3c3eae3", "url": "https://github.com/apache/iotdb/commit/9e30f0fa03f2fe9dec8e71d8ba851337d3c3eae3", "message": "Merge branch 'fix_windows_ci_bug' into add_vm_logs\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\n#\tserver/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "committedDate": "2020-07-10T02:49:30Z", "type": "commit"}, {"oid": "25c40dac91c4d3038e7e915767812611bc847912", "url": "https://github.com/apache/iotdb/commit/25c40dac91c4d3038e7e915767812611bc847912", "message": "add javadoc for RestorableTsFileIOWriter", "committedDate": "2020-07-10T02:49:50Z", "type": "commit"}, {"oid": "2cefde3c06072c0b7eba3a190c64789bd1bac878", "url": "https://github.com/apache/iotdb/commit/2cefde3c06072c0b7eba3a190c64789bd1bac878", "message": "update", "committedDate": "2020-07-10T02:50:07Z", "type": "commit"}, {"oid": "4d7b1cf12e95084c71df852e82bf59b10a1187ca", "url": "https://github.com/apache/iotdb/commit/4d7b1cf12e95084c71df852e82bf59b10a1187ca", "message": "remove endFile", "committedDate": "2020-07-10T02:50:39Z", "type": "commit"}, {"oid": "f6d6d1de9de868ffc0364312b02130138415690e", "url": "https://github.com/apache/iotdb/commit/f6d6d1de9de868ffc0364312b02130138415690e", "message": "Merge pull request #1477 from zhanglingzhe0820/add_vm_logs", "committedDate": "2020-07-10T03:21:35Z", "type": "commit"}, {"oid": "d4ff7f9b8f9c50552c38d30cea7359ad94a4ba9c", "url": "https://github.com/apache/iotdb/commit/d4ff7f9b8f9c50552c38d30cea7359ad94a4ba9c", "message": "make query right", "committedDate": "2020-07-10T04:42:55Z", "type": "commit"}, {"oid": "5e97e014639dcf53d08120ecb19943929bb4e146", "url": "https://github.com/apache/iotdb/commit/5e97e014639dcf53d08120ecb19943929bb4e146", "message": "fix tests", "committedDate": "2020-07-10T05:31:25Z", "type": "commit"}, {"oid": "a4922ca45302d65ab618d5716e13d94b1dfd3ebc", "url": "https://github.com/apache/iotdb/commit/a4922ca45302d65ab618d5716e13d94b1dfd3ebc", "message": "Merge branch 'master' into hot_compaction", "committedDate": "2020-07-13T06:33:27Z", "type": "commit"}, {"oid": "4b023b75fae1354fb90d335e46b99e8f08827413", "url": "https://github.com/apache/iotdb/commit/4b023b75fae1354fb90d335e46b99e8f08827413", "message": "update log and add some reader close (#1480)\n\nAdd level hot compaction", "committedDate": "2020-07-15T02:47:31Z", "type": "commit"}, {"oid": "619172ff8056ad2c6e2e34261ec5a8f1b4049861", "url": "https://github.com/apache/iotdb/commit/619172ff8056ad2c6e2e34261ec5a8f1b4049861", "message": "fix sonar", "committedDate": "2020-07-15T07:44:30Z", "type": "commit"}, {"oid": "92546c40f40b26ff5532c1cbaf50cbd4a93ad041", "url": "https://github.com/apache/iotdb/commit/92546c40f40b26ff5532c1cbaf50cbd4a93ad041", "message": "fix sonar", "committedDate": "2020-07-15T08:26:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkyNTM3Nw==", "url": "https://github.com/apache/iotdb/pull/1411#discussion_r454925377", "bodyText": "This method has a lot of duplicate lines and looks too complicated, it's better to do a refactor or split it to some small methods.", "author": "HTHou", "createdAt": "2020-07-15T09:41:29Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iotdb.db.engine.flush;\n+\n+import static org.apache.iotdb.db.utils.MergeUtils.writeTVPair;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+import java.util.TreeMap;\n+import org.apache.iotdb.tsfile.file.metadata.ChunkMetadata;\n+import org.apache.iotdb.tsfile.read.TimeValuePair;\n+import org.apache.iotdb.tsfile.read.TsFileSequenceReader;\n+import org.apache.iotdb.tsfile.read.common.Chunk;\n+import org.apache.iotdb.tsfile.read.reader.BatchDataIterator;\n+import org.apache.iotdb.tsfile.read.reader.IChunkReader;\n+import org.apache.iotdb.tsfile.read.reader.IPointReader;\n+import org.apache.iotdb.tsfile.read.reader.chunk.ChunkReaderByTimestamp;\n+import org.apache.iotdb.tsfile.utils.Pair;\n+import org.apache.iotdb.tsfile.write.chunk.ChunkWriterImpl;\n+import org.apache.iotdb.tsfile.write.chunk.IChunkWriter;\n+import org.apache.iotdb.tsfile.write.schema.MeasurementSchema;\n+import org.apache.iotdb.tsfile.write.writer.RestorableTsFileIOWriter;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class VmMergeUtils {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(VmMergeUtils.class);\n+\n+  private VmMergeUtils() {\n+    throw new IllegalStateException(\"Utility class\");\n+  }\n+\n+  public static void fullMerge(RestorableTsFileIOWriter writer,\n+      List<List<RestorableTsFileIOWriter>> vmWriters, String storageGroup, VmLogger vmLogger,\n+      Set<String> devices, boolean sequence) throws IOException {", "originalCommit": "92546c40f40b26ff5532c1cbaf50cbd4a93ad041", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69ae5055d93402d7e9899a3a5d7c7ffc2b4f0b3c", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java b/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\nindex 73895f716a..b5253d17ab 100644\n--- a/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\n+++ b/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\n\n@@ -120,9 +120,6 @@ public class VmMergeUtils {\n       reader.close();\n       logger.info(\"{} vm file close a reader\", reader.getFileName());\n     }\n-    if (vmLogger != null) {\n-      vmLogger.close();\n-    }\n   }\n \n   private static Pair<ChunkMetadata, Chunk> writeSeqChunk(RestorableTsFileIOWriter writer,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkyNjAxMA==", "url": "https://github.com/apache/iotdb/pull/1411#discussion_r454926010", "bodyText": "Same as fullMerge", "author": "HTHou", "createdAt": "2020-07-15T09:42:34Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iotdb.db.engine.flush;\n+\n+import static org.apache.iotdb.db.utils.MergeUtils.writeTVPair;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+import java.util.TreeMap;\n+import org.apache.iotdb.tsfile.file.metadata.ChunkMetadata;\n+import org.apache.iotdb.tsfile.read.TimeValuePair;\n+import org.apache.iotdb.tsfile.read.TsFileSequenceReader;\n+import org.apache.iotdb.tsfile.read.common.Chunk;\n+import org.apache.iotdb.tsfile.read.reader.BatchDataIterator;\n+import org.apache.iotdb.tsfile.read.reader.IChunkReader;\n+import org.apache.iotdb.tsfile.read.reader.IPointReader;\n+import org.apache.iotdb.tsfile.read.reader.chunk.ChunkReaderByTimestamp;\n+import org.apache.iotdb.tsfile.utils.Pair;\n+import org.apache.iotdb.tsfile.write.chunk.ChunkWriterImpl;\n+import org.apache.iotdb.tsfile.write.chunk.IChunkWriter;\n+import org.apache.iotdb.tsfile.write.schema.MeasurementSchema;\n+import org.apache.iotdb.tsfile.write.writer.RestorableTsFileIOWriter;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class VmMergeUtils {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(VmMergeUtils.class);\n+\n+  private VmMergeUtils() {\n+    throw new IllegalStateException(\"Utility class\");\n+  }\n+\n+  public static void fullMerge(RestorableTsFileIOWriter writer,\n+      List<List<RestorableTsFileIOWriter>> vmWriters, String storageGroup, VmLogger vmLogger,\n+      Set<String> devices, boolean sequence) throws IOException {\n+    Map<String, TsFileSequenceReader> tsFileSequenceReaderMap = new HashMap<>();\n+    Map<String, Map<String, MeasurementSchema>> deviceMeasurementMap = new HashMap<>();\n+\n+    for (List<RestorableTsFileIOWriter> subVmWriters : vmWriters) {\n+      fillDeviceMeasurementMap(devices, deviceMeasurementMap, subVmWriters);\n+    }\n+    if (!sequence) {\n+      for (Entry<String, Map<String, MeasurementSchema>> deviceMeasurementEntry : deviceMeasurementMap\n+          .entrySet()) {\n+        String deviceId = deviceMeasurementEntry.getKey();\n+        writer.startChunkGroup(deviceId);\n+        long maxVersion = Long.MIN_VALUE;\n+        for (Entry<String, MeasurementSchema> entry : deviceMeasurementEntry.getValue()\n+            .entrySet()) {\n+          String measurementId = entry.getKey();\n+          Map<Long, TimeValuePair> timeValuePairMap = new TreeMap<>();\n+          for (int i = vmWriters.size() - 1; i >= 0; i--) {\n+            maxVersion = writeUnseqChunk(writer, storageGroup, tsFileSequenceReaderMap, deviceId,\n+                maxVersion, entry,\n+                measurementId, timeValuePairMap, vmWriters.get(i));\n+          }\n+          IChunkWriter chunkWriter = new ChunkWriterImpl(entry.getValue());\n+          for (TimeValuePair timeValuePair : timeValuePairMap.values()) {\n+            writeTVPair(timeValuePair, chunkWriter);\n+          }\n+          chunkWriter.writeToFileWriter(writer);\n+        }\n+        writer.writeVersion(maxVersion);\n+        writer.endChunkGroup();\n+        if (vmLogger != null) {\n+          vmLogger.logDevice(deviceId, writer.getPos());\n+        }\n+      }\n+    } else {\n+      for (Entry<String, Map<String, MeasurementSchema>> deviceMeasurementEntry : deviceMeasurementMap\n+          .entrySet()) {\n+        String deviceId = deviceMeasurementEntry.getKey();\n+        writer.startChunkGroup(deviceId);\n+        for (Entry<String, MeasurementSchema> entry : deviceMeasurementEntry.getValue()\n+            .entrySet()) {\n+          String measurementId = entry.getKey();\n+          ChunkMetadata newChunkMetadata = null;\n+          Chunk newChunk = null;\n+          for (int i = vmWriters.size() - 1; i >= 0; i--) {\n+            Pair<ChunkMetadata, Chunk> chunkPair = writeSeqChunk(writer, storageGroup,\n+                tsFileSequenceReaderMap, deviceId, measurementId,\n+                vmWriters.get(i), newChunkMetadata, newChunk);\n+            newChunkMetadata = chunkPair.left;\n+            newChunk = chunkPair.right;\n+          }\n+          if (newChunkMetadata != null && newChunk != null) {\n+            writer.writeChunk(newChunk, newChunkMetadata);\n+          }\n+        }\n+        writer.endChunkGroup();\n+        if (vmLogger != null) {\n+          vmLogger.logDevice(deviceId, writer.getPos());\n+        }\n+      }\n+    }\n+\n+    for (TsFileSequenceReader reader : tsFileSequenceReaderMap.values()) {\n+      reader.close();\n+      logger.info(\"{} vm file close a reader\", reader.getFileName());\n+    }\n+    if (vmLogger != null) {\n+      vmLogger.close();\n+    }\n+  }\n+\n+  private static Pair<ChunkMetadata, Chunk> writeSeqChunk(RestorableTsFileIOWriter writer,\n+      String storageGroup,\n+      Map<String, TsFileSequenceReader> tsFileSequenceReaderMap, String deviceId,\n+      String measurementId,\n+      List<RestorableTsFileIOWriter> vmWriters, ChunkMetadata lastChunkMetadata, Chunk lastChunk)\n+      throws IOException {\n+    ChunkMetadata newChunkMetadata = lastChunkMetadata;\n+    Chunk newChunk = lastChunk;\n+    for (RestorableTsFileIOWriter vmWriter : vmWriters) {\n+      TsFileSequenceReader reader = buildReaderFromVmWriter(vmWriter,\n+          writer, tsFileSequenceReaderMap, storageGroup);\n+      if (reader == null || !vmWriter.getMetadatasForQuery().containsKey(deviceId)) {\n+        continue;\n+      }\n+      List<ChunkMetadata> chunkMetadataList = vmWriter.getMetadatasForQuery()\n+          .get(deviceId).get(measurementId);\n+      if (chunkMetadataList == null) {\n+        continue;\n+      }\n+      for (ChunkMetadata chunkMetadata : chunkMetadataList) {\n+        Chunk chunk = reader.readMemChunk(chunkMetadata);\n+        if (newChunkMetadata == null) {\n+          newChunkMetadata = chunkMetadata;\n+          newChunk = chunk;\n+        } else {\n+          newChunkMetadata.mergeChunkMetadata(chunkMetadata);\n+          newChunk.mergeChunk(chunk);\n+        }\n+      }\n+    }\n+    return new Pair<>(newChunkMetadata, newChunk);\n+  }\n+\n+  private static long writeUnseqChunk(RestorableTsFileIOWriter writer, String storageGroup,\n+      Map<String, TsFileSequenceReader> tsFileSequenceReaderMap, String deviceId, long maxVersion,\n+      Entry<String, MeasurementSchema> entry, String measurementId,\n+      Map<Long, TimeValuePair> timeValuePairMap, List<RestorableTsFileIOWriter> vmWriters)\n+      throws IOException {\n+    for (RestorableTsFileIOWriter vmWriter : vmWriters) {\n+      TsFileSequenceReader reader = buildReaderFromVmWriter(vmWriter,\n+          writer, tsFileSequenceReaderMap, storageGroup);\n+      if (reader == null) {\n+        continue;\n+      }\n+      List<ChunkMetadata> chunkMetadataList = vmWriter.getVisibleMetadataList(deviceId,\n+          measurementId, entry.getValue().getType());\n+      for (ChunkMetadata chunkMetadata : chunkMetadataList) {\n+        maxVersion = Math.max(chunkMetadata.getVersion(), maxVersion);\n+        IChunkReader chunkReader = new ChunkReaderByTimestamp(\n+            reader.readMemChunk(chunkMetadata));\n+        while (chunkReader.hasNextSatisfiedPage()) {\n+          IPointReader iPointReader = new BatchDataIterator(\n+              chunkReader.nextPageData());\n+          while (iPointReader.hasNextTimeValuePair()) {\n+            TimeValuePair timeValuePair = iPointReader.nextTimeValuePair();\n+            timeValuePairMap.put(timeValuePair.getTimestamp(), timeValuePair);\n+          }\n+        }\n+      }\n+    }\n+    return maxVersion;\n+  }\n+\n+  private static void fillDeviceMeasurementMap(Set<String> devices,\n+      Map<String, Map<String, MeasurementSchema>> deviceMeasurementMap,\n+      List<RestorableTsFileIOWriter> subVmWriters) {\n+    for (RestorableTsFileIOWriter vmWriter : subVmWriters) {\n+      vmWriter.makeMetadataVisible();\n+      Map<String, Map<String, List<ChunkMetadata>>> deviceMeasurementChunkMetadataMap = vmWriter\n+          .getMetadatasForQuery();\n+      // device, measurement -> chunk metadata list\n+      for (Entry<String, Map<String, List<ChunkMetadata>>> deviceEntry :\n+          deviceMeasurementChunkMetadataMap.entrySet()) {\n+        if (devices.contains(deviceEntry.getKey())) {\n+          continue;\n+        }\n+        Map<String, MeasurementSchema> measurementSchemaMap = deviceMeasurementMap\n+            .computeIfAbsent(deviceEntry.getKey(), k -> new HashMap<>());\n+\n+        // measurement, chunk metadata list\n+        for (Entry<String, List<ChunkMetadata>> measurementEntry : deviceEntry.getValue()\n+            .entrySet()) {\n+          measurementSchemaMap.computeIfAbsent(measurementEntry.getKey(), k ->\n+              new MeasurementSchema(k, measurementEntry.getValue().get(0).getDataType()));\n+        }\n+      }\n+    }\n+  }\n+\n+  public static void levelMerge(RestorableTsFileIOWriter writer,\n+      List<RestorableTsFileIOWriter> vmWriters, String storageGroup, VmLogger vmLogger,\n+      Set<String> devices, boolean sequence) throws IOException {", "originalCommit": "92546c40f40b26ff5532c1cbaf50cbd4a93ad041", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69ae5055d93402d7e9899a3a5d7c7ffc2b4f0b3c", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java b/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\nindex 73895f716a..b5253d17ab 100644\n--- a/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\n+++ b/server/src/main/java/org/apache/iotdb/db/engine/flush/VmMergeUtils.java\n\n@@ -120,9 +120,6 @@ public class VmMergeUtils {\n       reader.close();\n       logger.info(\"{} vm file close a reader\", reader.getFileName());\n     }\n-    if (vmLogger != null) {\n-      vmLogger.close();\n-    }\n   }\n \n   private static Pair<ChunkMetadata, Chunk> writeSeqChunk(RestorableTsFileIOWriter writer,\n"}}, {"oid": "e71e7101f0a183384c445c74d694da7649ea5c94", "url": "https://github.com/apache/iotdb/commit/e71e7101f0a183384c445c74d694da7649ea5c94", "message": "rename upgrade to tmp suffix", "committedDate": "2020-07-15T09:47:12Z", "type": "commit"}, {"oid": "6d6ae7b76239ad7a2da52d336923186efbe495a8", "url": "https://github.com/apache/iotdb/commit/6d6ae7b76239ad7a2da52d336923186efbe495a8", "message": "reduce duplication", "committedDate": "2020-07-16T07:37:15Z", "type": "commit"}, {"oid": "f53b94a10f912011c25f4f77382d48ee78e4399d", "url": "https://github.com/apache/iotdb/commit/f53b94a10f912011c25f4f77382d48ee78e4399d", "message": "fix vm recover bug", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "c2675faecb45ba0ba65a3b2e6f88be560234b3ba", "url": "https://github.com/apache/iotdb/commit/c2675faecb45ba0ba65a3b2e6f88be560234b3ba", "message": "fix", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "69ae5055d93402d7e9899a3a5d7c7ffc2b4f0b3c", "url": "https://github.com/apache/iotdb/commit/69ae5055d93402d7e9899a3a5d7c7ffc2b4f0b3c", "message": "update vm logger", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "7f35d50e87f8358b1ed1e39064606b16b30d9ed4", "url": "https://github.com/apache/iotdb/commit/7f35d50e87f8358b1ed1e39064606b16b30d9ed4", "message": "fix", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "8f2fc3b42b74fb1dd73281ff4cb9379bf9ae5181", "url": "https://github.com/apache/iotdb/commit/8f2fc3b42b74fb1dd73281ff4cb9379bf9ae5181", "message": "add truncate", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "1e9297ca917860a872fe5945f1ae46c8555ab2b7", "url": "https://github.com/apache/iotdb/commit/1e9297ca917860a872fe5945f1ae46c8555ab2b7", "message": "add logger close", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "f39b9e96567225884ee2522c9dab45303e9ba9c0", "url": "https://github.com/apache/iotdb/commit/f39b9e96567225884ee2522c9dab45303e9ba9c0", "message": "update vm merge utils", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "f6201590c6387e766546f1b694a90388ca331de1", "url": "https://github.com/apache/iotdb/commit/f6201590c6387e766546f1b694a90388ca331de1", "message": "log", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "2943f48ff6871f9a23d4cbee38efb46e7638eb9b", "url": "https://github.com/apache/iotdb/commit/2943f48ff6871f9a23d4cbee38efb46e7638eb9b", "message": "update log", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "c979febbbca3a0e446389e091e2c7c5a0e10e3ea", "url": "https://github.com/apache/iotdb/commit/c979febbbca3a0e446389e091e2c7c5a0e10e3ea", "message": "fix vm pack bug", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "3b3ac1a46bed30a4f8ff69b2b7bb626cb3c51e20", "url": "https://github.com/apache/iotdb/commit/3b3ac1a46bed30a4f8ff69b2b7bb626cb3c51e20", "message": "update filename compare", "committedDate": "2020-07-17T07:35:16Z", "type": "commit"}, {"oid": "326898eb2d89ea6b4b7a8ca877c2c18592899212", "url": "https://github.com/apache/iotdb/commit/326898eb2d89ea6b4b7a8ca877c2c18592899212", "message": "add log", "committedDate": "2020-07-17T08:19:50Z", "type": "commit"}, {"oid": "f1f03078d17fb24bac53c4edd78a56a441d228c6", "url": "https://github.com/apache/iotdb/commit/f1f03078d17fb24bac53c4edd78a56a441d228c6", "message": "fix sonar", "committedDate": "2020-07-17T08:24:24Z", "type": "commit"}, {"oid": "97a99372073469240a82092276ab93c6478dd5e0", "url": "https://github.com/apache/iotdb/commit/97a99372073469240a82092276ab93c6478dd5e0", "message": "change back memtable size in IoTDBConfig", "committedDate": "2020-07-17T08:29:52Z", "type": "commit"}, {"oid": "4d2cc322140e9f9a506b68d18490492437e59a60", "url": "https://github.com/apache/iotdb/commit/4d2cc322140e9f9a506b68d18490492437e59a60", "message": "Merge remote-tracking branch 'origin/master' into hot_compaction", "committedDate": "2020-07-17T08:36:03Z", "type": "commit"}, {"oid": "72169dc1d6afc43fb8f1aab158d0fcaf83eed888", "url": "https://github.com/apache/iotdb/commit/72169dc1d6afc43fb8f1aab158d0fcaf83eed888", "message": "feat:add vm", "committedDate": "2020-06-19T15:24:29Z", "type": "commit"}, {"oid": "1771ef0934377ee309150b246f44e6bb1a55a49c", "url": "https://github.com/apache/iotdb/commit/1771ef0934377ee309150b246f44e6bb1a55a49c", "message": "fix chunkmeta bugs", "committedDate": "2020-06-21T09:40:42Z", "type": "commit"}, {"oid": "ea534cf2d97afa88cf1c6e6fc5cc4443cd32ebcd", "url": "https://github.com/apache/iotdb/commit/ea534cf2d97afa88cf1c6e6fc5cc4443cd32ebcd", "message": "update hot merge", "committedDate": "2020-06-23T09:35:25Z", "type": "commit"}, {"oid": "de6130e27bf62bf5d765159e58174c4d6441ecbd", "url": "https://github.com/apache/iotdb/commit/de6130e27bf62bf5d765159e58174c4d6441ecbd", "message": "Merge branch 'hot_compaction' into add_vm_merge\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/conf/IoTDBConfig.java\n#\tserver/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java", "committedDate": "2020-06-23T09:38:55Z", "type": "commit"}, {"oid": "873ad3b28c6dcc29bfde731c37a95e0f336d0c82", "url": "https://github.com/apache/iotdb/commit/873ad3b28c6dcc29bfde731c37a95e0f336d0c82", "message": "Merge pull request #1401 from zhanglingzhe0820/add_vm_merge\n\n[Tmp IOTDB-706] Introduce virtual memtable for larger Chunk", "committedDate": "2020-06-23T09:43:51Z", "type": "commit"}, {"oid": "a10b404edce4c5d5d85a16b225df1e47eb7a1ecb", "url": "https://github.com/apache/iotdb/commit/a10b404edce4c5d5d85a16b225df1e47eb7a1ecb", "message": "update StorageGroupProcessor", "committedDate": "2020-06-23T09:57:37Z", "type": "commit"}, {"oid": "d08b08672cc7c622a68a529312475388d82c63e9", "url": "https://github.com/apache/iotdb/commit/d08b08672cc7c622a68a529312475388d82c63e9", "message": "Merge pull request #1410 from zhanglingzhe0820/add_vm_merge\n\n[Tmp IOTDB-706] Introduce virtual memtable for larger Chunk", "committedDate": "2020-06-23T10:02:11Z", "type": "commit"}, {"oid": "64830328d7895f70fded8e4192c6beb3ff8c0791", "url": "https://github.com/apache/iotdb/commit/64830328d7895f70fded8e4192c6beb3ff8c0791", "message": "query adapter", "committedDate": "2020-06-23T10:02:54Z", "type": "commit"}, {"oid": "8466408fc223a8577606bf00c9923950002902af", "url": "https://github.com/apache/iotdb/commit/8466408fc223a8577606bf00c9923950002902af", "message": "resolve conflicts", "committedDate": "2020-06-23T10:05:42Z", "type": "commit"}, {"oid": "6e0b8bde5b484e1aa782d000bfdff4ec7683d83b", "url": "https://github.com/apache/iotdb/commit/6e0b8bde5b484e1aa782d000bfdff4ec7683d83b", "message": "some changes in flush", "committedDate": "2020-06-23T12:17:17Z", "type": "commit"}, {"oid": "f88863bb3015a80f62c62618cc5a9dd8fb4c5970", "url": "https://github.com/apache/iotdb/commit/f88863bb3015a80f62c62618cc5a9dd8fb4c5970", "message": "fix ChunkHeader merge", "committedDate": "2020-06-23T12:27:05Z", "type": "commit"}, {"oid": "c682ab3ecce30714a24bdafbacb23fcc1d35f10d", "url": "https://github.com/apache/iotdb/commit/c682ab3ecce30714a24bdafbacb23fcc1d35f10d", "message": "fix small issues", "committedDate": "2020-06-23T13:09:50Z", "type": "commit"}, {"oid": "0b81e0b2f73047ca99626c2e2efb22c8619d3309", "url": "https://github.com/apache/iotdb/commit/0b81e0b2f73047ca99626c2e2efb22c8619d3309", "message": "update mergeio", "committedDate": "2020-06-23T13:36:12Z", "type": "commit"}, {"oid": "5711c2773f1d3e188e478760e64b1a53135b9d5f", "url": "https://github.com/apache/iotdb/commit/5711c2773f1d3e188e478760e64b1a53135b9d5f", "message": "fix some small issues", "committedDate": "2020-06-23T14:01:57Z", "type": "commit"}, {"oid": "c2216eb9bd617c16062ad696d86d944615e6c74d", "url": "https://github.com/apache/iotdb/commit/c2216eb9bd617c16062ad696d86d944615e6c74d", "message": "clear get num", "committedDate": "2020-06-23T14:29:58Z", "type": "commit"}, {"oid": "c6abcb9c62e7fb113f36d50067d3c21a57617627", "url": "https://github.com/apache/iotdb/commit/c6abcb9c62e7fb113f36d50067d3c21a57617627", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "committedDate": "2020-06-23T15:02:12Z", "type": "commit"}, {"oid": "bdb67d8627a53e7b8469ee5a9ec50012e268a256", "url": "https://github.com/apache/iotdb/commit/bdb67d8627a53e7b8469ee5a9ec50012e268a256", "message": "Fix hot compaction (#1412)\n\n* update mergeio\r\n\r\n* pass test\r\n\r\nCo-authored-by: \u5f20\u51cc\u54f2 <zhanglingzhe@bytedance.com>", "committedDate": "2020-06-23T15:14:13Z", "type": "commit"}, {"oid": "96f72bf71306e328fc99368c6be69005e50f8542", "url": "https://github.com/apache/iotdb/commit/96f72bf71306e328fc99368c6be69005e50f8542", "message": "fix recover folder", "committedDate": "2020-06-23T15:26:43Z", "type": "commit"}, {"oid": "759629450f812279c94aa078b72ebf22b72fc728", "url": "https://github.com/apache/iotdb/commit/759629450f812279c94aa078b72ebf22b72fc728", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/flush/MemTableFlushTask.java\n#\tserver/src/test/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessorTest.java", "committedDate": "2020-06-23T16:08:20Z", "type": "commit"}, {"oid": "27a579d9d64d43109b341dd0991898ad67c51766", "url": "https://github.com/apache/iotdb/commit/27a579d9d64d43109b341dd0991898ad67c51766", "message": "Fix hot compaction (#1415)\n\n* update config and fix vm compaction bug\r\n* fix compaction bug\r\nCo-authored-by: \u5f20\u51cc\u54f2 <zhanglingzhe@bytedance.com>", "committedDate": "2020-06-23T16:29:07Z", "type": "commit"}, {"oid": "ae637b6defb608e1c87df8847f68a10f891bbb15", "url": "https://github.com/apache/iotdb/commit/ae637b6defb608e1c87df8847f68a10f891bbb15", "message": "add comment", "committedDate": "2020-06-23T16:39:07Z", "type": "commit"}, {"oid": "b68bc1935aab8c53394065d968324a247a538645", "url": "https://github.com/apache/iotdb/commit/b68bc1935aab8c53394065d968324a247a538645", "message": "delete unusable serialize", "committedDate": "2020-06-24T01:32:38Z", "type": "commit"}, {"oid": "6510a20c6f668bbd1555ada154fdaf12b98dc88b", "url": "https://github.com/apache/iotdb/commit/6510a20c6f668bbd1555ada154fdaf12b98dc88b", "message": "fix restart", "committedDate": "2020-06-24T01:32:51Z", "type": "commit"}, {"oid": "96d290981ff04fe3871da499adcbe30c5c146139", "url": "https://github.com/apache/iotdb/commit/96d290981ff04fe3871da499adcbe30c5c146139", "message": "remove unused config", "committedDate": "2020-06-24T01:49:08Z", "type": "commit"}, {"oid": "a64002ad82130ccf7d746b34b310db5ead8c7562", "url": "https://github.com/apache/iotdb/commit/a64002ad82130ccf7d746b34b310db5ead8c7562", "message": "query lock", "committedDate": "2020-06-24T02:51:38Z", "type": "commit"}, {"oid": "acd8039bd11c6253a468a772f8d0f937a5d1f79f", "url": "https://github.com/apache/iotdb/commit/acd8039bd11c6253a468a772f8d0f937a5d1f79f", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction", "committedDate": "2020-06-24T02:51:57Z", "type": "commit"}, {"oid": "0ed3f9f9e5c5e6a3767a19c0bc306e028e64535b", "url": "https://github.com/apache/iotdb/commit/0ed3f9f9e5c5e6a3767a19c0bc306e028e64535b", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/flush/MemTableFlushTask.java", "committedDate": "2020-06-24T03:37:43Z", "type": "commit"}, {"oid": "39235aa922a32abdb02e9cf4a695461b50570739", "url": "https://github.com/apache/iotdb/commit/39235aa922a32abdb02e9cf4a695461b50570739", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "committedDate": "2020-06-24T03:39:22Z", "type": "commit"}, {"oid": "d3f80d2ab865dfa67ea588df4cecf79012cfdb5a", "url": "https://github.com/apache/iotdb/commit/d3f80d2ab865dfa67ea588df4cecf79012cfdb5a", "message": "update schema get", "committedDate": "2020-06-24T05:37:07Z", "type": "commit"}, {"oid": "a50f46f0d65c2f1b802036f68a288e7a046b0916", "url": "https://github.com/apache/iotdb/commit/a50f46f0d65c2f1b802036f68a288e7a046b0916", "message": "fix recover vm", "committedDate": "2020-06-24T05:43:56Z", "type": "commit"}, {"oid": "9aa0bc2cbc8ef7fea25a51ee3a59acc53b211671", "url": "https://github.com/apache/iotdb/commit/9aa0bc2cbc8ef7fea25a51ee3a59acc53b211671", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction", "committedDate": "2020-06-24T05:44:17Z", "type": "commit"}, {"oid": "4cc71034d587bc310e9a986d9446337c5aa20d0e", "url": "https://github.com/apache/iotdb/commit/4cc71034d587bc310e9a986d9446337c5aa20d0e", "message": "Merge pull request #1419 from zhanglingzhe0820/hot_compaction\n\nHot compaction", "committedDate": "2020-06-24T05:50:37Z", "type": "commit"}, {"oid": "343b7e891bbdf34881780cb1a6458b61ee517360", "url": "https://github.com/apache/iotdb/commit/343b7e891bbdf34881780cb1a6458b61ee517360", "message": "fix path", "committedDate": "2020-06-24T06:12:24Z", "type": "commit"}, {"oid": "cf089c6b510bc52b06d2313cd4fe554e746e96e9", "url": "https://github.com/apache/iotdb/commit/cf089c6b510bc52b06d2313cd4fe554e746e96e9", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction", "committedDate": "2020-06-24T06:12:45Z", "type": "commit"}, {"oid": "d2bd803d587765de9acac6dffdcbd9ebee069b26", "url": "https://github.com/apache/iotdb/commit/d2bd803d587765de9acac6dffdcbd9ebee069b26", "message": "format memtable flush task", "committedDate": "2020-06-24T06:16:02Z", "type": "commit"}, {"oid": "2d4b394ddab1475646ad5a56029f6a708a3431ef", "url": "https://github.com/apache/iotdb/commit/2d4b394ddab1475646ad5a56029f6a708a3431ef", "message": "Merge remote-tracking branch 'origin/hot_compaction' into hot_compaction", "committedDate": "2020-06-24T06:16:23Z", "type": "commit"}, {"oid": "2ac8ce35121d6cc2e98016f8b30a9aff7b22db52", "url": "https://github.com/apache/iotdb/commit/2ac8ce35121d6cc2e98016f8b30a9aff7b22db52", "message": "fix failed tests", "committedDate": "2020-06-24T06:54:17Z", "type": "commit"}, {"oid": "abee58184463fbd415f84f157a2eef29b097f9b8", "url": "https://github.com/apache/iotdb/commit/abee58184463fbd415f84f157a2eef29b097f9b8", "message": "add recover support", "committedDate": "2020-06-24T13:48:33Z", "type": "commit"}, {"oid": "7767facf119c44fc20ac5c03ab88c21cea96eff9", "url": "https://github.com/apache/iotdb/commit/7767facf119c44fc20ac5c03ab88c21cea96eff9", "message": "update merge recover (#1421)\n\n* update merge recover\r\n* update tmp file name\r\nCo-authored-by: \u5f20\u51cc\u54f2 <zhanglingzhe@bytedance.com>", "committedDate": "2020-06-24T17:04:45Z", "type": "commit"}, {"oid": "99cbcf4e22604a71f4eec815c71881a1935dd3c3", "url": "https://github.com/apache/iotdb/commit/99cbcf4e22604a71f4eec815c71881a1935dd3c3", "message": "add unseq tsfile processor recover", "committedDate": "2020-06-25T03:43:52Z", "type": "commit"}, {"oid": "888daa44c35afd6ad805861cdade427c56c990ed", "url": "https://github.com/apache/iotdb/commit/888daa44c35afd6ad805861cdade427c56c990ed", "message": "fix resource readlock lack origin readlock", "committedDate": "2020-06-25T03:55:17Z", "type": "commit"}, {"oid": "1e05957e723c9a71bca65cfc1099aed31f44400c", "url": "https://github.com/apache/iotdb/commit/1e05957e723c9a71bca65cfc1099aed31f44400c", "message": "fix sequence in TsFileReoverPerformer and MemtableFlushTask", "committedDate": "2020-06-25T04:12:43Z", "type": "commit"}, {"oid": "62f4095c62b656090b3d6fce014ec439bde0a579", "url": "https://github.com/apache/iotdb/commit/62f4095c62b656090b3d6fce014ec439bde0a579", "message": "no need to serialize vmfile", "committedDate": "2020-06-25T08:31:19Z", "type": "commit"}, {"oid": "820c3771509a8c6ec52ca2c6b8b3505cfa693e77", "url": "https://github.com/apache/iotdb/commit/820c3771509a8c6ec52ca2c6b8b3505cfa693e77", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction", "committedDate": "2020-06-25T08:31:33Z", "type": "commit"}, {"oid": "5c4f3044566b6812fe8bf7806fceb9d985001e32", "url": "https://github.com/apache/iotdb/commit/5c4f3044566b6812fe8bf7806fceb9d985001e32", "message": "only serialize closed file", "committedDate": "2020-06-25T08:41:39Z", "type": "commit"}, {"oid": "7fae0517d7c68e8ac035b1a56988a715cb5096e8", "url": "https://github.com/apache/iotdb/commit/7fae0517d7c68e8ac035b1a56988a715cb5096e8", "message": "and file exists judgment", "committedDate": "2020-06-27T15:29:59Z", "type": "commit"}, {"oid": "5b70863701d9a93b21ba9f3eae161b8723d8e711", "url": "https://github.com/apache/iotdb/commit/5b70863701d9a93b21ba9f3eae161b8723d8e711", "message": "and file exists judgment (#1424)\n\nCo-authored-by: \u5f20\u51cc\u54f2 <zhanglingzhe@bytedance.com>", "committedDate": "2020-06-27T15:33:36Z", "type": "commit"}, {"oid": "71b0c458af663a45a0b38bc96c3da44f0e75c3f2", "url": "https://github.com/apache/iotdb/commit/71b0c458af663a45a0b38bc96c3da44f0e75c3f2", "message": "update startTime and endTime in vmfile tsfile resource", "committedDate": "2020-06-28T05:11:41Z", "type": "commit"}, {"oid": "f2057b332fec75fb0db067917cad9051db1f2e85", "url": "https://github.com/apache/iotdb/commit/f2057b332fec75fb0db067917cad9051db1f2e85", "message": "add licenses", "committedDate": "2020-06-28T05:42:44Z", "type": "commit"}, {"oid": "886084ef7aacfde680307189a82b009bd38d6f78", "url": "https://github.com/apache/iotdb/commit/886084ef7aacfde680307189a82b009bd38d6f78", "message": "fix close bug", "committedDate": "2020-06-28T06:11:35Z", "type": "commit"}, {"oid": "aba621892e24d9d40719077dda6b1208c97e4f90", "url": "https://github.com/apache/iotdb/commit/aba621892e24d9d40719077dda6b1208c97e4f90", "message": "Merge branch 'hot_compaction' into fix_hot_compaction_recover", "committedDate": "2020-06-28T06:12:43Z", "type": "commit"}, {"oid": "50b4054651b45e905da90937dfdf7488a125ce1a", "url": "https://github.com/apache/iotdb/commit/50b4054651b45e905da90937dfdf7488a125ce1a", "message": "Merge pull request #1426 from zhanglingzhe0820/fix_hot_compaction_recover\n\nFix hot compaction recover", "committedDate": "2020-06-28T06:27:47Z", "type": "commit"}, {"oid": "2f71fb218d32646396f34e5fd2819968923b125a", "url": "https://github.com/apache/iotdb/commit/2f71fb218d32646396f34e5fd2819968923b125a", "message": "fix query deadlock", "committedDate": "2020-06-28T08:04:24Z", "type": "commit"}, {"oid": "09f0bcbaed9a69a1ce0ddab980b73a37be3e179c", "url": "https://github.com/apache/iotdb/commit/09f0bcbaed9a69a1ce0ddab980b73a37be3e179c", "message": "add merge version", "committedDate": "2020-06-28T08:06:22Z", "type": "commit"}, {"oid": "592612c43f502b37055976b666ef732129f3533d", "url": "https://github.com/apache/iotdb/commit/592612c43f502b37055976b666ef732129f3533d", "message": "Merge commit '2f71fb218d32646396f34e5fd2819968923b125a' into fix_hot_compaction_recover", "committedDate": "2020-06-28T08:07:39Z", "type": "commit"}, {"oid": "564d42d6f65f21298d8cb5133dcadc85cab336a5", "url": "https://github.com/apache/iotdb/commit/564d42d6f65f21298d8cb5133dcadc85cab336a5", "message": "recover bug", "committedDate": "2020-06-28T08:36:44Z", "type": "commit"}, {"oid": "3471ff923334c0d84e4d2d160fe8420b1b0eaa0a", "url": "https://github.com/apache/iotdb/commit/3471ff923334c0d84e4d2d160fe8420b1b0eaa0a", "message": "Merge branch 'hot_compaction' into fix_hot_compaction_recover", "committedDate": "2020-06-28T08:38:30Z", "type": "commit"}, {"oid": "105c019e75db3624661aeed8536734a55bc83a38", "url": "https://github.com/apache/iotdb/commit/105c019e75db3624661aeed8536734a55bc83a38", "message": "fix recover bug", "committedDate": "2020-06-28T09:12:57Z", "type": "commit"}, {"oid": "cf15a270e52ee3cf4eb4e91e7ea395ff467ac005", "url": "https://github.com/apache/iotdb/commit/cf15a270e52ee3cf4eb4e91e7ea395ff467ac005", "message": "add some comments", "committedDate": "2020-06-28T09:13:51Z", "type": "commit"}, {"oid": "451d4224d28e50d7017c098da0129aaa4b54dd07", "url": "https://github.com/apache/iotdb/commit/451d4224d28e50d7017c098da0129aaa4b54dd07", "message": "add tmp remove logic", "committedDate": "2020-06-28T11:15:53Z", "type": "commit"}, {"oid": "a622a26dd045c3a0ff16d4213322b61ba26e06a1", "url": "https://github.com/apache/iotdb/commit/a622a26dd045c3a0ff16d4213322b61ba26e06a1", "message": "Merge pull request #1427 from zhanglingzhe0820/fix_hot_compaction_recover\n\nFix hot compaction recover", "committedDate": "2020-06-28T11:19:57Z", "type": "commit"}, {"oid": "85ba4eeb4025a20ae6d4d0d45b9b6b62e6f4f721", "url": "https://github.com/apache/iotdb/commit/85ba4eeb4025a20ae6d4d0d45b9b6b62e6f4f721", "message": "update version", "committedDate": "2020-06-28T11:50:11Z", "type": "commit"}, {"oid": "731a5265de8ea000ba99e19a185fd7e53f7b8048", "url": "https://github.com/apache/iotdb/commit/731a5265de8ea000ba99e19a185fd7e53f7b8048", "message": "Merge branch 'hot_compaction' into fix_hot_compaction_recover", "committedDate": "2020-06-28T11:50:57Z", "type": "commit"}, {"oid": "e93b1dc937cdda6f99db8bfeccc153852fed3978", "url": "https://github.com/apache/iotdb/commit/e93b1dc937cdda6f99db8bfeccc153852fed3978", "message": "add merge", "committedDate": "2020-06-28T11:52:03Z", "type": "commit"}, {"oid": "f3e21bf071a8a1ed5b9e556bde98c6d75babc4d3", "url": "https://github.com/apache/iotdb/commit/f3e21bf071a8a1ed5b9e556bde98c6d75babc4d3", "message": "fix recover", "committedDate": "2020-06-28T13:07:54Z", "type": "commit"}, {"oid": "cd7481fb87fd3abef450e30727a8e70bf26c58ed", "url": "https://github.com/apache/iotdb/commit/cd7481fb87fd3abef450e30727a8e70bf26c58ed", "message": "Merge pull request #1428 from zhanglingzhe0820/fix_hot_compaction_recover\n\nFix hot compaction recover", "committedDate": "2020-06-28T13:09:09Z", "type": "commit"}, {"oid": "4f68137dbf311027532bd33af695a0017230ae12", "url": "https://github.com/apache/iotdb/commit/4f68137dbf311027532bd33af695a0017230ae12", "message": "fix SeriesReaderIT", "committedDate": "2020-06-29T03:14:57Z", "type": "commit"}, {"oid": "9934b3605d635211d302f573cc0ce9af2c4a9810", "url": "https://github.com/apache/iotdb/commit/9934b3605d635211d302f573cc0ce9af2c4a9810", "message": "fix vm file merge bug", "committedDate": "2020-06-29T03:43:21Z", "type": "commit"}, {"oid": "5b94dc2eeddcbe10ed9ff546e024d7cf0cf24840", "url": "https://github.com/apache/iotdb/commit/5b94dc2eeddcbe10ed9ff546e024d7cf0cf24840", "message": "Merge pull request #1432 from zhanglingzhe0820/fix_vm_merge_bug\n\nfix vm file merge bug", "committedDate": "2020-06-29T05:37:54Z", "type": "commit"}, {"oid": "b44f46afb727e8e2525729d2a648d47761c7a4b7", "url": "https://github.com/apache/iotdb/commit/b44f46afb727e8e2525729d2a648d47761c7a4b7", "message": "add recover processing for crashing while memtable is not full", "committedDate": "2020-06-29T06:59:42Z", "type": "commit"}, {"oid": "b01f724fd94ef06bc2f93865a6085ea4bb6e49f5", "url": "https://github.com/apache/iotdb/commit/b01f724fd94ef06bc2f93865a6085ea4bb6e49f5", "message": "Merge branch 'master' into hot_compaction", "committedDate": "2020-06-29T08:02:30Z", "type": "commit"}, {"oid": "83f3d9bcb4fe70666554ae8db79fa043fd22698c", "url": "https://github.com/apache/iotdb/commit/83f3d9bcb4fe70666554ae8db79fa043fd22698c", "message": "fix recover", "committedDate": "2020-06-29T09:46:34Z", "type": "commit"}, {"oid": "9fcb20d6e42f065808bd4c2ad79ce145d5813924", "url": "https://github.com/apache/iotdb/commit/9fcb20d6e42f065808bd4c2ad79ce145d5813924", "message": "Merge branch 'hot_compaction' of https://github.com/apache/incubator-iotdb into hot_compaction", "committedDate": "2020-06-29T11:05:12Z", "type": "commit"}, {"oid": "871fce07425022ad5569a0b0186b0563f3a4542f", "url": "https://github.com/apache/iotdb/commit/871fce07425022ad5569a0b0186b0563f3a4542f", "message": "add test", "committedDate": "2020-06-30T01:53:29Z", "type": "commit"}, {"oid": "524c9fe9e7951154f95280241ce42f1d29f8614a", "url": "https://github.com/apache/iotdb/commit/524c9fe9e7951154f95280241ce42f1d29f8614a", "message": "resolve conflict", "committedDate": "2020-07-01T07:20:24Z", "type": "commit"}, {"oid": "c493621bce85eb4a007848cabaeda4cf7e252189", "url": "https://github.com/apache/iotdb/commit/c493621bce85eb4a007848cabaeda4cf7e252189", "message": "add properties", "committedDate": "2020-07-02T10:09:58Z", "type": "commit"}, {"oid": "cff8f1d65ff83d3dfcb9da9bdf7636d9307117f8", "url": "https://github.com/apache/iotdb/commit/cff8f1d65ff83d3dfcb9da9bdf7636d9307117f8", "message": "change vm mergeTimes to flushTimes", "committedDate": "2020-07-03T07:32:59Z", "type": "commit"}, {"oid": "b263bf0bcd4727b6560fd0d5aad48e66af0df9e6", "url": "https://github.com/apache/iotdb/commit/b263bf0bcd4727b6560fd0d5aad48e66af0df9e6", "message": "change flush vm times to 11 and add log", "committedDate": "2020-07-03T07:57:49Z", "type": "commit"}, {"oid": "c038c03ac86f60dfb3fe6f01b629f24621d4ef3e", "url": "https://github.com/apache/iotdb/commit/c038c03ac86f60dfb3fe6f01b629f24621d4ef3e", "message": "fix test", "committedDate": "2020-07-03T12:59:04Z", "type": "commit"}, {"oid": "b59aad15db90e8418e7d46d2601405d0d6b82fce", "url": "https://github.com/apache/iotdb/commit/b59aad15db90e8418e7d46d2601405d0d6b82fce", "message": "merge master", "committedDate": "2020-07-07T05:30:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU4Njg1NQ==", "url": "https://github.com/apache/iotdb/pull/1411#discussion_r450586855", "bodyText": "Update the comment according to new return type", "author": "samperson1997", "createdAt": "2020-07-07T03:07:56Z", "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java", "diffHunk": "@@ -80,17 +104,33 @@ public TsFileRecoverPerformer(String logNodePrefix, VersionController versionCon\n    * @return a RestorableTsFileIOWriter if the file is not closed before crush, so this writer can", "originalCommit": "c038c03ac86f60dfb3fe6f01b629f24621d4ef3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0MDQyNg==", "url": "https://github.com/apache/iotdb/pull/1411#discussion_r451240426", "bodyText": "fixed~", "author": "HTHou", "createdAt": "2020-07-08T02:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU4Njg1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "703014bcc2906f65c36eddccd29c0db7c113f94c", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java b/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java\nindex f5a0148d24..02096d756a 100644\n--- a/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java\n+++ b/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java\n\n@@ -101,8 +90,9 @@ public class TsFileRecoverPerformer {\n    * 1. recover the TsFile by RestorableTsFileIOWriter and truncate the file to remaining corrected\n    * data 2. redo the WALs to recover unpersisted data 3. flush and close the file 4. clean WALs\n    *\n-   * @return a RestorableTsFileIOWriter if the file is not closed before crush, so this writer can\n-   * be used to continue writing\n+   * @return a RestorableTsFileIOWriter and a list of RestorableTsFileIOWriter of vmfiles, if the\n+   * file and the vmfiles are not closed before crush, so these writers can be used to continue\n+   * writing\n    */\n   public Pair<RestorableTsFileIOWriter, List<RestorableTsFileIOWriter>> recover()\n       throws StorageGroupProcessorException {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYzMDIzNg==", "url": "https://github.com/apache/iotdb/pull/1411#discussion_r450630236", "bodyText": "Will this unused method be used later?", "author": "samperson1997", "createdAt": "2020-07-07T06:07:08Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "diffHunk": "@@ -540,6 +574,80 @@ private void releaseFlushedMemTable(IMemTable memTable) {\n     }\n   }\n \n+  /**\n+   * Construct the a new or get an existing TsFileSequenceReader of a TsFile.\n+   *\n+   * @return a TsFileSequenceReader\n+   */\n+  private TsFileSequenceReader getFileReader(TsFileResource tsFileResource) throws IOException {", "originalCommit": "b59aad15db90e8418e7d46d2601405d0d6b82fce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0MDQ4NA==", "url": "https://github.com/apache/iotdb/pull/1411#discussion_r451240484", "bodyText": "fixed", "author": "HTHou", "createdAt": "2020-07-08T02:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYzMDIzNg=="}], "type": "inlineReview", "revised_code": {"commit": "703014bcc2906f65c36eddccd29c0db7c113f94c", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java b/server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java\nindex 9d495b33bf..6104e445df 100644\n--- a/server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java\n+++ b/server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java\n\n@@ -574,15 +578,6 @@ public class TsFileProcessor {\n     }\n   }\n \n-  /**\n-   * Construct the a new or get an existing TsFileSequenceReader of a TsFile.\n-   *\n-   * @return a TsFileSequenceReader\n-   */\n-  private TsFileSequenceReader getFileReader(TsFileResource tsFileResource) throws IOException {\n-    return new TsFileSequenceReader(tsFileResource.getPath(), true);\n-  }\n-\n   public static File createNewVMFile(TsFileResource tsFileResource) {\n     File parent = tsFileResource.getFile().getParentFile();\n     return FSFactoryProducer.getFSFactory().getFile(parent,\n"}}, {"oid": "c1472cb34a864e0e834b9cc1e81e2f46afa7d5a1", "url": "https://github.com/apache/iotdb/commit/c1472cb34a864e0e834b9cc1e81e2f46afa7d5a1", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb into hot_compaction", "committedDate": "2020-07-08T01:49:45Z", "type": "commit"}, {"oid": "71b4711054d072b979d7b809c3d8b182fce37c93", "url": "https://github.com/apache/iotdb/commit/71b4711054d072b979d7b809c3d8b182fce37c93", "message": "fix review", "committedDate": "2020-07-08T02:04:20Z", "type": "commit"}, {"oid": "a9b2e87b31a1a81966a9e851f3035e6b0a37bf0e", "url": "https://github.com/apache/iotdb/commit/a9b2e87b31a1a81966a9e851f3035e6b0a37bf0e", "message": "fix test", "committedDate": "2020-07-08T02:16:48Z", "type": "commit"}, {"oid": "acfdee2f447183a9617b5fa17197d8e3c6c47c1a", "url": "https://github.com/apache/iotdb/commit/acfdee2f447183a9617b5fa17197d8e3c6c47c1a", "message": "fix test", "committedDate": "2020-07-08T03:42:10Z", "type": "commit"}, {"oid": "d0d581549f2cd7a5603cfd21a4cb12ba7eb9c0d1", "url": "https://github.com/apache/iotdb/commit/d0d581549f2cd7a5603cfd21a4cb12ba7eb9c0d1", "message": "split vm with flush (#1468)\n\n* split vm with flush\r\n* update should close\r\nCo-authored-by: \u5f20\u51cc\u54f2 <zhanglingzhe@bytedance.com>", "committedDate": "2020-07-08T04:46:58Z", "type": "commit"}, {"oid": "a7e90302815c3bb5386c3f3f2b92db2eb0d98a7a", "url": "https://github.com/apache/iotdb/commit/a7e90302815c3bb5386c3f3f2b92db2eb0d98a7a", "message": "fix shouldClose", "committedDate": "2020-07-08T04:48:26Z", "type": "commit"}, {"oid": "336c034621c552250e9f78b576e45562a7b0583f", "url": "https://github.com/apache/iotdb/commit/336c034621c552250e9f78b576e45562a7b0583f", "message": "Fix sonar problems in hot_compaction branch (#1469)\n\n* Make sonar happy", "committedDate": "2020-07-08T07:40:11Z", "type": "commit"}, {"oid": "4b6fe39cf46263ed484aaa83e9679761d65c3c13", "url": "https://github.com/apache/iotdb/commit/4b6fe39cf46263ed484aaa83e9679761d65c3c13", "message": "Fix more sonar issues", "committedDate": "2020-07-08T08:47:22Z", "type": "commit"}, {"oid": "c20cdb7d2dc7b69f0f9dd1027ee9371de3aba9e0", "url": "https://github.com/apache/iotdb/commit/c20cdb7d2dc7b69f0f9dd1027ee9371de3aba9e0", "message": "Fix typo", "committedDate": "2020-07-08T10:05:26Z", "type": "commit"}, {"oid": "11f747afc81e7b659bd589633382e09d15e99f76", "url": "https://github.com/apache/iotdb/commit/11f747afc81e7b659bd589633382e09d15e99f76", "message": "fix bug", "committedDate": "2020-07-08T11:59:15Z", "type": "commit"}, {"oid": "80355cd753630b260f699315083f9940cc1f2eb6", "url": "https://github.com/apache/iotdb/commit/80355cd753630b260f699315083f9940cc1f2eb6", "message": "Fix tests", "committedDate": "2020-07-08T12:28:00Z", "type": "commit"}, {"oid": "732c1121744ffcc2eae3ce0934c2337eea7a2a53", "url": "https://github.com/apache/iotdb/commit/732c1121744ffcc2eae3ce0934c2337eea7a2a53", "message": "fix conflicts", "committedDate": "2020-07-08T12:53:56Z", "type": "commit"}, {"oid": "4dcd1d3cab8d9b70a484a47b1b6f69fab5cc8d41", "url": "https://github.com/apache/iotdb/commit/4dcd1d3cab8d9b70a484a47b1b6f69fab5cc8d41", "message": "fix conflicts", "committedDate": "2020-07-08T12:58:36Z", "type": "commit"}, {"oid": "42ce3f65d06c6ca6329dd27d8035e2fca7340e37", "url": "https://github.com/apache/iotdb/commit/42ce3f65d06c6ca6329dd27d8035e2fca7340e37", "message": "Fix conflicts", "committedDate": "2020-07-08T15:22:25Z", "type": "commit"}, {"oid": "95de1f828d5c083b9afdf158bf69cd974da076f8", "url": "https://github.com/apache/iotdb/commit/95de1f828d5c083b9afdf158bf69cd974da076f8", "message": "Merge remote-tracking branch 'origin/master' into hot_compaction2\n\n# Conflicts:\n#\tserver/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java", "committedDate": "2020-07-08T15:24:54Z", "type": "commit"}, {"oid": "6b8e1183cc7826620eb2ef3218bff4f3fb3c9507", "url": "https://github.com/apache/iotdb/commit/6b8e1183cc7826620eb2ef3218bff4f3fb3c9507", "message": "Fix sonar problems resulted by merging master", "committedDate": "2020-07-08T15:44:32Z", "type": "commit"}, {"oid": "caae141ec94c986975e60b79f8251bca97447722", "url": "https://github.com/apache/iotdb/commit/caae141ec94c986975e60b79f8251bca97447722", "message": "change back the delete way", "committedDate": "2020-07-09T02:32:07Z", "type": "commit"}, {"oid": "dd88ab1565bec6b0d0828ef9b37998ff243704dc", "url": "https://github.com/apache/iotdb/commit/dd88ab1565bec6b0d0828ef9b37998ff243704dc", "message": "change name", "committedDate": "2020-07-09T02:35:10Z", "type": "commit"}, {"oid": "07cc9dc408ce056ba3dec90ccc36c5f1d93fc62e", "url": "https://github.com/apache/iotdb/commit/07cc9dc408ce056ba3dec90ccc36c5f1d93fc62e", "message": "fix windows ci bug", "committedDate": "2020-07-09T03:28:59Z", "type": "commit"}]}