{"pr_number": 1884, "pr_title": "[IOTDB-749] Handle select * from root OOM", "pr_createdAt": "2020-10-28T07:51:15Z", "pr_url": "https://github.com/apache/iotdb/pull/1884", "timeline": [{"oid": "4b6fd581fac44a3adfa95a5ff484ac39bc043db7", "url": "https://github.com/apache/iotdb/commit/4b6fd581fac44a3adfa95a5ff484ac39bc043db7", "message": "fix slimit logical errors in ConcatPathOptimizer", "committedDate": "2020-10-28T06:33:36Z", "type": "commit"}, {"oid": "1214577e21ea3b4138a068c72f303d065cc9384c", "url": "https://github.com/apache/iotdb/commit/1214577e21ea3b4138a068c72f303d065cc9384c", "message": "add ITs", "committedDate": "2020-10-28T07:37:06Z", "type": "commit"}, {"oid": "ce251eb0203f5944291f3cb5e9245d0c2ab28d7d", "url": "https://github.com/apache/iotdb/commit/ce251eb0203f5944291f3cb5e9245d0c2ab28d7d", "message": "fix tests", "committedDate": "2020-10-28T17:22:06Z", "type": "commit"}, {"oid": "3934efaebceb8326f4c3d59617e0b6d01936afb7", "url": "https://github.com/apache/iotdb/commit/3934efaebceb8326f4c3d59617e0b6d01936afb7", "message": "fix tests", "committedDate": "2020-10-28T19:07:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MzM3Nw==", "url": "https://github.com/apache/iotdb/pull/1884#discussion_r513853377", "bodyText": "Don't forget to change the MaxQueryDeduplicatedPathNum back to the default value.", "author": "JackieTien97", "createdAt": "2020-10-29T01:16:37Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBQueryMemoryControlIT.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ *     http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+\r\n+package org.apache.iotdb.db.integration;\r\n+\r\n+import static org.junit.Assert.assertEquals;\r\n+import static org.junit.Assert.assertTrue;\r\n+import static org.junit.Assert.fail;\r\n+\r\n+import java.sql.Connection;\r\n+import java.sql.DriverManager;\r\n+import java.sql.ResultSetMetaData;\r\n+import java.sql.Statement;\r\n+import org.apache.iotdb.db.conf.IoTDBDescriptor;\r\n+import org.apache.iotdb.db.utils.EnvironmentUtils;\r\n+import org.apache.iotdb.jdbc.Config;\r\n+import org.junit.After;\r\n+import org.junit.Before;\r\n+import org.junit.Test;\r\n+\r\n+public class IoTDBQueryMemoryControlIT {\r\n+\r\n+  private static final String[] sqls = new String[]{\r\n+      \"set storage group to root.ln\",\r\n+\r\n+      \"create timeseries root.ln.wf01.wt01 with datatype=BOOLEAN,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf01.wt02 with datatype=BOOLEAN,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf01.wt03 with datatype=BOOLEAN,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf01.wt04 with datatype=BOOLEAN,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf01.wt05 with datatype=BOOLEAN,encoding=PLAIN\",\r\n+\r\n+      \"create timeseries root.ln.wf02.wt01 with datatype=FLOAT,encoding=RLE\",\r\n+      \"create timeseries root.ln.wf02.wt02 with datatype=FLOAT,encoding=RLE\",\r\n+      \"create timeseries root.ln.wf02.wt03 with datatype=FLOAT,encoding=RLE\",\r\n+      \"create timeseries root.ln.wf02.wt04 with datatype=FLOAT,encoding=RLE\",\r\n+      \"create timeseries root.ln.wf02.wt05 with datatype=FLOAT,encoding=RLE\",\r\n+\r\n+      \"create timeseries root.ln.wf03.wt01 with datatype=TEXT,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf03.wt02 with datatype=TEXT,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf03.wt03 with datatype=TEXT,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf03.wt04 with datatype=TEXT,encoding=PLAIN\",\r\n+      \"create timeseries root.ln.wf03.wt05 with datatype=TEXT,encoding=PLAIN\",\r\n+  };\r\n+\r\n+  @Before\r\n+  public void setUp() throws Exception {\r\n+    IoTDBDescriptor.getInstance().getConfig().setMaxQueryDeduplicatedPathNum(10);\r\n+    EnvironmentUtils.envSetUp();\r\n+    Class.forName(Config.JDBC_DRIVER_NAME);\r\n+    createTimeSeries();\r\n+  }\r\n+\r\n+  private static void createTimeSeries() {\r\n+    try (Statement statement = DriverManager.getConnection(\r\n+        Config.IOTDB_URL_PREFIX + \"127.0.0.1:6667/\", \"root\", \"root\").createStatement()) {\r\n+      for (String sql : sqls) {\r\n+        statement.execute(sql);\r\n+      }\r\n+    } catch (Exception e) {\r\n+      e.printStackTrace();\r\n+      fail(e.getMessage());\r\n+    }\r\n+  }\r\n+\r\n+  @After\r\n+  public void tearDown() throws Exception {\r\n+    EnvironmentUtils.cleanEnv();\r", "originalCommit": "3934efaebceb8326f4c3d59617e0b6d01936afb7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "365de50c22745d8cc6111db59b24ad89b11b3945", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBQueryMemoryControlIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBQueryMemoryControlIT.java\nindex 818162ce6..8a0f3ba7e 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBQueryMemoryControlIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBQueryMemoryControlIT.java\n\n@@ -36,6 +36,8 @@ import org.junit.Test;\n \n public class IoTDBQueryMemoryControlIT {\n \n+  private int defaultMaxQueryDeduplicatedPathNum;\n+\n   private static final String[] sqls = new String[]{\n       \"set storage group to root.ln\",\n \n"}}, {"oid": "365de50c22745d8cc6111db59b24ad89b11b3945", "url": "https://github.com/apache/iotdb/commit/365de50c22745d8cc6111db59b24ad89b11b3945", "message": "set default MaxQueryDeduplicatedPathNum value back when IoTDBQueryMemoryControlIT is over", "committedDate": "2020-10-29T01:45:08Z", "type": "commit"}]}