{"pr_number": 879, "pr_title": "Hot fix for LAST query bug when using with disable align", "pr_createdAt": "2020-03-03T17:16:17Z", "pr_url": "https://github.com/apache/iotdb/pull/879", "timeline": [{"oid": "553ae3ca291c94906b92d78077cc64afd91e690b", "url": "https://github.com/apache/iotdb/commit/553ae3ca291c94906b92d78077cc64afd91e690b", "message": "Add Last query implement without cache", "committedDate": "2020-02-17T07:28:00Z", "type": "commit"}, {"oid": "b4f7c6f3bc7c48d9ea6f5dd75b9c731420bfa5c4", "url": "https://github.com/apache/iotdb/commit/b4f7c6f3bc7c48d9ea6f5dd75b9c731420bfa5c4", "message": "Add Last query cache in MTree node", "committedDate": "2020-02-17T07:28:00Z", "type": "commit"}, {"oid": "611237160dbe07626588463847e13b3692b80208", "url": "https://github.com/apache/iotdb/commit/611237160dbe07626588463847e13b3692b80208", "message": "Fix null measurement display for last query", "committedDate": "2020-02-17T17:59:30Z", "type": "commit"}, {"oid": "8ba2e9695b4629f0d7d09badf5e796ee562f8451", "url": "https://github.com/apache/iotdb/commit/8ba2e9695b4629f0d7d09badf5e796ee562f8451", "message": "Add Missing license comments", "committedDate": "2020-02-18T03:04:42Z", "type": "commit"}, {"oid": "b03c708f91031dae5dc56044211c8bebe0615fee", "url": "https://github.com/apache/iotdb/commit/b03c708f91031dae5dc56044211c8bebe0615fee", "message": "Remove unused import and adjust code format", "committedDate": "2020-02-18T09:45:24Z", "type": "commit"}, {"oid": "55f9a83f7df0d15a23465438f2122c3231ec4c6e", "url": "https://github.com/apache/iotdb/commit/55f9a83f7df0d15a23465438f2122c3231ec4c6e", "message": "Fix compilation error", "committedDate": "2020-02-18T10:48:57Z", "type": "commit"}, {"oid": "97cfadc0d8dda1ca36204d84a68f680fc6fc4a34", "url": "https://github.com/apache/iotdb/commit/97cfadc0d8dda1ca36204d84a68f680fc6fc4a34", "message": "Clarify last related function behavior", "committedDate": "2020-02-18T16:42:45Z", "type": "commit"}, {"oid": "3f02f7c313c7e3dbfae12e0e5ca0cbdfdc61246f", "url": "https://github.com/apache/iotdb/commit/3f02f7c313c7e3dbfae12e0e5ca0cbdfdc61246f", "message": "Use chunk and page stats when calculating last data", "committedDate": "2020-02-18T17:10:44Z", "type": "commit"}, {"oid": "21e761566a8da68446492e0aa82cedf2bd236291", "url": "https://github.com/apache/iotdb/commit/21e761566a8da68446492e0aa82cedf2bd236291", "message": "Fix last query syntax bug", "committedDate": "2020-02-20T15:30:19Z", "type": "commit"}, {"oid": "afbc0937a690fa07f25edab5e0d2236cda69e068", "url": "https://github.com/apache/iotdb/commit/afbc0937a690fa07f25edab5e0d2236cda69e068", "message": "Add java doc for last", "committedDate": "2020-02-20T15:30:36Z", "type": "commit"}, {"oid": "0abe34f828e8aab11194d8025d95cf4ad44388d2", "url": "https://github.com/apache/iotdb/commit/0abe34f828e8aab11194d8025d95cf4ad44388d2", "message": "Update java doc", "committedDate": "2020-02-20T17:27:47Z", "type": "commit"}, {"oid": "c2ee32b765b44332bbe188126729b187c119746a", "url": "https://github.com/apache/iotdb/commit/c2ee32b765b44332bbe188126729b187c119746a", "message": "Merge remote-tracking branch 'upstream/new_series_reader' into new_series_reader", "committedDate": "2020-02-20T17:47:44Z", "type": "commit"}, {"oid": "409a7b96ecfe3e68fe4d3e09405d33720092a1a4", "url": "https://github.com/apache/iotdb/commit/409a7b96ecfe3e68fe4d3e09405d33720092a1a4", "message": "Add unit test for last", "committedDate": "2020-02-20T18:40:22Z", "type": "commit"}, {"oid": "f43426a7987c156d3d373fbf1cfa1d9858a2815d", "url": "https://github.com/apache/iotdb/commit/f43426a7987c156d3d373fbf1cfa1d9858a2815d", "message": "Fix ut compilation error", "committedDate": "2020-02-21T01:12:56Z", "type": "commit"}, {"oid": "1f1f2c0279cbbd3931357944655d51d92e953cc3", "url": "https://github.com/apache/iotdb/commit/1f1f2c0279cbbd3931357944655d51d92e953cc3", "message": "Merge remote-tracking branch 'upstream/new_series_reader' into new_series_reader", "committedDate": "2020-02-24T09:04:11Z", "type": "commit"}, {"oid": "3e175b5a2a31f5bcb600d9a4afc811d3b635f299", "url": "https://github.com/apache/iotdb/commit/3e175b5a2a31f5bcb600d9a4afc811d3b635f299", "message": "Merge branch 'master' into new_series_reader", "committedDate": "2020-02-24T09:18:40Z", "type": "commit"}, {"oid": "92c43917a94f540416413eb85ed95c55b606b628", "url": "https://github.com/apache/iotdb/commit/92c43917a94f540416413eb85ed95c55b606b628", "message": "Fix compilation error", "committedDate": "2020-02-24T09:24:05Z", "type": "commit"}, {"oid": "e10aa614335133d5f9dac0d893063fe237cafa3f", "url": "https://github.com/apache/iotdb/commit/e10aa614335133d5f9dac0d893063fe237cafa3f", "message": "Update new version of LAST query in java doc", "committedDate": "2020-02-24T16:38:22Z", "type": "commit"}, {"oid": "5736f861baa2cf0d4a02735450492f2fd2b4946a", "url": "https://github.com/apache/iotdb/commit/5736f861baa2cf0d4a02735450492f2fd2b4946a", "message": "Modify Last query syntax", "committedDate": "2020-02-25T16:17:42Z", "type": "commit"}, {"oid": "c561dc58b9c267c3aa8533f74a6bfa25a310d2ec", "url": "https://github.com/apache/iotdb/commit/c561dc58b9c267c3aa8533f74a6bfa25a310d2ec", "message": "Update last query behavior", "committedDate": "2020-02-26T17:14:03Z", "type": "commit"}, {"oid": "1e65ee361738ebcf5162108b57c42071290a76d6", "url": "https://github.com/apache/iotdb/commit/1e65ee361738ebcf5162108b57c42071290a76d6", "message": "Merge remote-tracking branch 'upstream/master' into new_series_reader", "committedDate": "2020-02-26T17:23:39Z", "type": "commit"}, {"oid": "c137074a1623d27db285673a9e39b161743cd9d0", "url": "https://github.com/apache/iotdb/commit/c137074a1623d27db285673a9e39b161743cd9d0", "message": "Fix test compile issue", "committedDate": "2020-02-27T00:50:50Z", "type": "commit"}, {"oid": "f6fb25b2b7d96e1459911b09844e2418defb7362", "url": "https://github.com/apache/iotdb/commit/f6fb25b2b7d96e1459911b09844e2418defb7362", "message": "Update unit tests for new syntax", "committedDate": "2020-02-27T01:12:53Z", "type": "commit"}, {"oid": "548e0af47927cc49cafc1fb0d75fc8a73e70a2fa", "url": "https://github.com/apache/iotdb/commit/548e0af47927cc49cafc1fb0d75fc8a73e70a2fa", "message": "Optimize last query process and fix review issues", "committedDate": "2020-02-28T07:08:11Z", "type": "commit"}, {"oid": "c4039c28586158ceb5c2a23f7c9bc10dfee9e1b1", "url": "https://github.com/apache/iotdb/commit/c4039c28586158ceb5c2a23f7c9bc10dfee9e1b1", "message": "Modify last cache update strategy", "committedDate": "2020-02-28T09:28:17Z", "type": "commit"}, {"oid": "2492f8ae47d881ed405a9e0d9c150e0992ca89e3", "url": "https://github.com/apache/iotdb/commit/2492f8ae47d881ed405a9e0d9c150e0992ca89e3", "message": "Move last cache insert into StorageGroupProcessor", "committedDate": "2020-02-28T10:36:02Z", "type": "commit"}, {"oid": "39974ad8a6c173dbc43a0b7fe5f7e971b1325026", "url": "https://github.com/apache/iotdb/commit/39974ad8a6c173dbc43a0b7fe5f7e971b1325026", "message": "Fix review issues and make code more readable", "committedDate": "2020-02-29T14:37:36Z", "type": "commit"}, {"oid": "6e15c19a473971cb135bf8209fb8bff55464d6bc", "url": "https://github.com/apache/iotdb/commit/6e15c19a473971cb135bf8209fb8bff55464d6bc", "message": "Add more java docs and rename some variables", "committedDate": "2020-03-02T02:14:13Z", "type": "commit"}, {"oid": "f136bcce40237672236cca1f1de738cfb450a9a8", "url": "https://github.com/apache/iotdb/commit/f136bcce40237672236cca1f1de738cfb450a9a8", "message": "Merge remote-tracking branch 'upstream/master' into new_series_reader", "committedDate": "2020-03-02T02:15:15Z", "type": "commit"}, {"oid": "8aa9e2b608c9f6d88a3547a89f19e8229dd0486e", "url": "https://github.com/apache/iotdb/commit/8aa9e2b608c9f6d88a3547a89f19e8229dd0486e", "message": "add sync property file to pass sync test case", "committedDate": "2020-03-02T09:30:20Z", "type": "commit"}, {"oid": "bebfc0e4e1758b16d15a75b84343feb03e5aa4ab", "url": "https://github.com/apache/iotdb/commit/bebfc0e4e1758b16d15a75b84343feb03e5aa4ab", "message": "Fix unit test bugs", "committedDate": "2020-03-02T13:04:10Z", "type": "commit"}, {"oid": "c26b2b5c6b1fe1e39d6d0afb59840554ac871301", "url": "https://github.com/apache/iotdb/commit/c26b2b5c6b1fe1e39d6d0afb59840554ac871301", "message": "Add Integration test for last query", "committedDate": "2020-03-02T14:34:17Z", "type": "commit"}, {"oid": "6d009ad198cc8e9c094e071d160275c290c72d6a", "url": "https://github.com/apache/iotdb/commit/6d009ad198cc8e9c094e071d160275c290c72d6a", "message": "Add missing licence", "committedDate": "2020-03-02T15:05:20Z", "type": "commit"}, {"oid": "f06dab82dc7b362c898f0f005aef35c480e44b64", "url": "https://github.com/apache/iotdb/commit/f06dab82dc7b362c898f0f005aef35c480e44b64", "message": "Merge remote-tracking branch 'upstream/master' into last_hotfix", "committedDate": "2020-03-03T17:06:08Z", "type": "commit"}, {"oid": "437015b3b1fdbb05e4c1ae5b766c2afa3715de95", "url": "https://github.com/apache/iotdb/commit/437015b3b1fdbb05e4c1ae5b766c2afa3715de95", "message": "Hot fix for last disable align crash bug", "committedDate": "2020-03-03T17:06:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ3NzU1Mw==", "url": "https://github.com/apache/iotdb/pull/879#discussion_r387477553", "bodyText": "false?", "author": "qiaojialin", "createdAt": "2020-03-04T06:54:10Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java", "diffHunk": "@@ -242,7 +242,12 @@ private PhysicalPlan transformQuery(QueryOperator queryOperator)\n     } else {\n       queryPlan = new RawDataQueryPlan();\n     }\n-    if (queryOperator.isAlignByDevice()) {\n+    if (queryPlan instanceof LastQueryPlan) {\n+      // Last query result set will not be affected by alignment\n+      queryPlan.setAlignByTime(true);", "originalCommit": "437015b3b1fdbb05e4c1ae5b766c2afa3715de95", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}