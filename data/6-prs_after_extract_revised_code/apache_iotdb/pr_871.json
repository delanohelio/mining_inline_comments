{"pr_number": 871, "pr_title": "[IOTDB-529] Relative times and NOW() operator cannot be used in Group By", "pr_createdAt": "2020-03-02T15:05:10Z", "pr_url": "https://github.com/apache/iotdb/pull/871", "timeline": [{"oid": "5a4e22555ed1418c099b6a83219c9f5f346144cb", "url": "https://github.com/apache/iotdb/commit/5a4e22555ed1418c099b6a83219c9f5f346144cb", "message": "fix a bug when recover the last crashed file", "committedDate": "2020-01-06T09:02:49Z", "type": "commit"}, {"oid": "ec64d27af2b0735f5d8588f709834bdfbc720897", "url": "https://github.com/apache/iotdb/commit/ec64d27af2b0735f5d8588f709834bdfbc720897", "message": "add exception for something gets wrong", "committedDate": "2020-01-06T09:22:59Z", "type": "commit"}, {"oid": "68296fc4de495b85829ddb6e511ad3b875727f38", "url": "https://github.com/apache/iotdb/commit/68296fc4de495b85829ddb6e511ad3b875727f38", "message": "fix test errors", "committedDate": "2020-01-06T12:36:13Z", "type": "commit"}, {"oid": "ba57aaba1803fef32309073e134c881c58f4c5ab", "url": "https://github.com/apache/iotdb/commit/ba57aaba1803fef32309073e134c881c58f4c5ab", "message": "change the comment", "committedDate": "2020-01-07T08:28:43Z", "type": "commit"}, {"oid": "e7d462642860d9d69d0551ea3a45ff6be6c03308", "url": "https://github.com/apache/iotdb/commit/e7d462642860d9d69d0551ea3a45ff6be6c03308", "message": "add comment", "committedDate": "2020-01-07T09:12:49Z", "type": "commit"}, {"oid": "835cbfa0f3f7994f5049892a088d2611b14fc9f1", "url": "https://github.com/apache/iotdb/commit/835cbfa0f3f7994f5049892a088d2611b14fc9f1", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb", "committedDate": "2020-01-07T11:03:32Z", "type": "commit"}, {"oid": "ee2414a8d22d7b296762ad2acd641e70cd579870", "url": "https://github.com/apache/iotdb/commit/ee2414a8d22d7b296762ad2acd641e70cd579870", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb", "committedDate": "2020-01-13T05:43:26Z", "type": "commit"}, {"oid": "2fdd0653f303ebbffd0721104d50d9fef5f6ed0b", "url": "https://github.com/apache/iotdb/commit/2fdd0653f303ebbffd0721104d50d9fef5f6ed0b", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb", "committedDate": "2020-03-02T13:33:03Z", "type": "commit"}, {"oid": "e36c27836889d8d7d27337023a7dab16cdd28173", "url": "https://github.com/apache/iotdb/commit/e36c27836889d8d7d27337023a7dab16cdd28173", "message": "use NOW() operator in Group by", "committedDate": "2020-03-02T15:00:00Z", "type": "commit"}, {"oid": "e339e1e76dd1b336dfa9f6b8b3f29e8ba205115c", "url": "https://github.com/apache/iotdb/commit/e339e1e76dd1b336dfa9f6b8b3f29e8ba205115c", "message": "add a UnitTest", "committedDate": "2020-03-02T15:48:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ3ODAwNw==", "url": "https://github.com/apache/iotdb/pull/871#discussion_r386478007", "bodyText": "Ok.. This UT is for testing that there is no data.\nHow about add one more like:\n@Test\n  public void usingNowFunction() {\n    try (Connection connection = DriverManager.\n        getConnection(\"jdbc:iotdb://127.0.0.1:6667/\", \"root\", \"root\");\n        Statement statement = connection.createStatement()) {\n      statement.execute(\"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n          + \"values(now(), 35.5, false, 650)\");\n      ResultSet resultSet = statement.executeQuery(\n          \"select count(temperature), sum(temperature), avg(temperature) from \"\n              + \"root.ln.wf01.wt01 \"\n              + \"GROUP BY ([now() - 1h, now()), 1h)\");\n      assertTrue(resultSet.next());\n      //resultSet.getLong(1) is the timestamp\n      assertEquals(1, Integer.valueOf(resultSet.getString(2)).intValue());\n      assertEquals(35.5, Float.valueOf(resultSet.getString(3)).floatValue(), 0.01);\n      assertEquals(35.5, Double.valueOf(resultSet.getString(4)).doubleValue(), 0.01);\n\n    } catch (Exception e) {\n      e.printStackTrace();\n      fail(e.getMessage());\n    }\n  }", "author": "jixuan1989", "createdAt": "2020-03-02T15:52:58Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IOTDBGroupByIT.java", "diffHunk": "@@ -506,6 +506,45 @@ public void countSumAvgInnerIntervalTest() {\n     }\n   }\n \n+  @Test\n+  public void countSumAvgRelativeTimesTest() {", "originalCommit": "e339e1e76dd1b336dfa9f6b8b3f29e8ba205115c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ4MzY0MQ==", "url": "https://github.com/apache/iotdb/pull/871#discussion_r386483641", "bodyText": "Thank you. I added your test code into this PR.", "author": "HTHou", "createdAt": "2020-03-02T16:00:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ3ODAwNw=="}], "type": "inlineReview", "revised_code": {"commit": "b850f5b64d12812c69cf74c307966cd3ea08abf0", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IOTDBGroupByIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IOTDBGroupByIT.java\nindex 924d15d05..66c2fb666 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IOTDBGroupByIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IOTDBGroupByIT.java\n\n@@ -507,7 +507,7 @@ public class IOTDBGroupByIT {\n   }\n \n   @Test\n-  public void countSumAvgRelativeTimesTest() {\n+  public void countSumAvgNoDataTest() {\n     String[] retArray1 = new String[]{\n         \",0,0.0,null\",\n         \",0,0.0,null\",\n"}}, {"oid": "b850f5b64d12812c69cf74c307966cd3ea08abf0", "url": "https://github.com/apache/iotdb/commit/b850f5b64d12812c69cf74c307966cd3ea08abf0", "message": "add one more Test", "committedDate": "2020-03-02T15:59:09Z", "type": "commit"}, {"oid": "bafe884c36876a0121cdf3310e3410f5d7808603", "url": "https://github.com/apache/iotdb/commit/bafe884c36876a0121cdf3310e3410f5d7808603", "message": "fix UT in groupby with now() to let travis more stable", "committedDate": "2020-03-02T16:59:22Z", "type": "commit"}]}