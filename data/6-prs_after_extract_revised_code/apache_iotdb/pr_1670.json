{"pr_number": 1670, "pr_title": "[IOTDB-856] Clear up the IoTDBSessionIT", "pr_createdAt": "2020-09-01T11:42:52Z", "pr_url": "https://github.com/apache/iotdb/pull/1670", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEzNTYzOQ==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r481135639", "bodyText": "This method could be deleted", "author": "qiaojialin", "createdAt": "2020-09-01T13:26:21Z", "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -244,23 +241,25 @@ public void testAlignByDevice() throws IoTDBConnectionException,\n \n     createTimeseries();\n \n-    insertTabletTest2(\"root.sg1.d1\");\n+    insertTabletTest(\"root.sg1.d1\");\n \n     queryForAlignByDevice();\n-    queryForAlignByDevice2();\n+\n+    session.close();\n   }\n \n-  // it's will output too much to travis, so ignore it\n   public void testTime()", "originalCommit": "47d4cfa074b4560c280fa59ad1fbdab795f97f00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "chunk": "diff --git a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nsimilarity index 63%\nrename from session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\nrename to session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nindex ef8458040..f057b2e42 100644\n--- a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\n+++ b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\n\n@@ -233,7 +129,7 @@ public class IoTDBSessionIT {\n \n   @Test\n   public void testAlignByDevice() throws IoTDBConnectionException,\n-      StatementExecutionException, BatchExecutionException {\n+      StatementExecutionException {\n     session = new Session(\"127.0.0.1\", 6667, \"root\", \"root\");\n     session.open();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEzNjU3Mw==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r481136573", "bodyText": "this is not a test, it's just a tool. Renaming to insertTablet is ok", "author": "qiaojialin", "createdAt": "2020-09-01T13:27:47Z", "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -814,7 +831,7 @@ private void insert() throws IoTDBConnectionException, StatementExecutionExcepti\n     }\n   }\n \n-  private void insertTabletTest1(String deviceId)\n+  private void insertTabletTest(String deviceId)", "originalCommit": "47d4cfa074b4560c280fa59ad1fbdab795f97f00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "chunk": "diff --git a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nsimilarity index 63%\nrename from session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\nrename to session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nindex ef8458040..f057b2e42 100644\n--- a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\n+++ b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\n\n@@ -762,76 +537,7 @@ public class IoTDBSessionIT {\n     session.insertRecords(deviceIds, timestamps, measurementsList, typesList, valuesList);\n   }\n \n-  private void insertRecordsByStr() throws IoTDBConnectionException, StatementExecutionException {\n-    String deviceId = \"root.sg1.d2\";\n-    List<String> measurements = new ArrayList<>();\n-    measurements.add(\"s1\");\n-    measurements.add(\"s2\");\n-    measurements.add(\"s3\");\n-    List<String> deviceIds = new ArrayList<>();\n-    List<List<String>> measurementsList = new ArrayList<>();\n-    List<List<String>> valuesList = new ArrayList<>();\n-    List<Long> timestamps = new ArrayList<>();\n-\n-    for (long time = 0; time < 500; time++) {\n-      List<String> values = new ArrayList<>();\n-      values.add(\"1\");\n-      values.add(\"2\");\n-      values.add(\"3\");\n-\n-      deviceIds.add(deviceId);\n-      measurementsList.add(measurements);\n-      valuesList.add(values);\n-      timestamps.add(time);\n-      if (time != 0 && time % 100 == 0) {\n-        session.insertRecords(deviceIds, timestamps, measurementsList, valuesList);\n-        deviceIds.clear();\n-        measurementsList.clear();\n-        valuesList.clear();\n-        timestamps.clear();\n-      }\n-    }\n-\n-    session.insertRecords(deviceIds, timestamps, measurementsList, valuesList);\n-  }\n-\n-  private void insertInObject() throws IoTDBConnectionException, StatementExecutionException {\n-    String deviceId = \"root.sg1.d1\";\n-    List<String> measurements = new ArrayList<>();\n-    List<TSDataType> types = new ArrayList<>();\n-    measurements.add(\"s1\");\n-    measurements.add(\"s2\");\n-    measurements.add(\"s3\");\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-\n-    for (long time = 0; time < 100; time++) {\n-      session.insertRecord(deviceId, time, measurements, types,1L, 2L, 3L);\n-    }\n-  }\n-\n-  private void insertInObjectList() throws IoTDBConnectionException, StatementExecutionException {\n-    String deviceId = \"root.sg1.d1\";\n-    List<String> measurements = new ArrayList<>();\n-    List<TSDataType> types = new ArrayList<>();\n-    measurements.add(\"s1\");\n-    measurements.add(\"s2\");\n-    measurements.add(\"s3\");\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-\n-    for (long time = 0; time < 100; time++) {\n-      List<Object> values = new ArrayList<>();\n-      values.add(1L);\n-      values.add(2L);\n-      values.add(3L);\n-      session.insertRecord(deviceId, time, measurements, types, values);\n-    }\n-  }\n-\n-  private void insertTabletTest(String deviceId)\n+  private void insertTablet(String deviceId)\n       throws IoTDBConnectionException, StatementExecutionException {\n \n     List<MeasurementSchema> schemaList = new ArrayList<>();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEzODYyMQ==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r481138621", "bodyText": "if the queryForBatchCheckOrder is not used, it could be removed.", "author": "qiaojialin", "createdAt": "2020-09-01T13:30:46Z", "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -1289,8 +1091,7 @@ private void queryForBatch() throws ClassNotFoundException, SQLException {\n         }\n       }\n       Assert.assertEquals(standard, resultStr.toString());\n-      // d1 and d2 will align\n-      Assert.assertEquals(14000, count);\n+      Assert.assertEquals(700, count);\n     }\n   }\n ", "originalCommit": "47d4cfa074b4560c280fa59ad1fbdab795f97f00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "chunk": "diff --git a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nsimilarity index 63%\nrename from session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\nrename to session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nindex ef8458040..f057b2e42 100644\n--- a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\n+++ b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\n\n@@ -1094,43 +787,4 @@ public class IoTDBSessionIT {\n       Assert.assertEquals(700, count);\n     }\n   }\n-\n-  public void queryForBatchCheckOrder() throws ClassNotFoundException, SQLException {\n-    Class.forName(Config.JDBC_DRIVER_NAME);\n-    String standard =\n-        \"Time\\n\" + \"root.sg1.d1.s1\\n\" + \"root.sg1.d1.s2\\n\" + \"root.sg1.d1.s3\\n\" +\n-            \"root.sg1.d2.s1\\n\" + \"root.sg1.d2.s2\\n\" + \"root.sg1.d2.s3\\n\";\n-    try (Connection connection = DriverManager\n-        .getConnection(Config.IOTDB_URL_PREFIX + \"192.168.130.18:6667/\", \"root\", \"root\");\n-        Statement statement = connection.createStatement()) {\n-      ResultSet resultSet = statement.executeQuery(\"SELECT s_0 FROM root.group_0.d_0 LIMIT 10000\");\n-      final ResultSetMetaData metaData = resultSet.getMetaData();\n-      final int colCount = metaData.getColumnCount();\n-      StringBuilder resultStr = new StringBuilder();\n-      for (int i = 0; i < colCount; i++) {\n-        resultStr.append(metaData.getColumnLabel(i + 1)).append(\"\\n\");\n-      }\n-\n-      int count = 0;\n-      long beforeTime = 0;\n-      int errorCount = 0;\n-      while (resultSet.next()) {\n-        long curTime = resultSet.getLong(1);\n-        if (beforeTime < curTime) {\n-          beforeTime = curTime;\n-        } else {\n-          errorCount++;\n-          if (errorCount > 10) {\n-            System.exit(-1);\n-          }\n-        }\n-\n-        for (int i = 1; i <= colCount; i++) {\n-          count++;\n-        }\n-      }\n-      Assert.assertEquals(standard, resultStr.toString());\n-      Assert.assertEquals(7000, count);\n-    }\n-  }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0MjEwNQ==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r481142105", "bodyText": "rename this to insertViaSQL", "author": "qiaojialin", "createdAt": "2020-09-01T13:35:56Z", "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -88,9 +88,8 @@ public void testInsertByStr() throws IoTDBConnectionException, StatementExecutio\n     createTimeseries();\n     insertByStr();\n \n-    // sql test\n     insert_via_sql();", "originalCommit": "47d4cfa074b4560c280fa59ad1fbdab795f97f00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "chunk": "diff --git a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nsimilarity index 63%\nrename from session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\nrename to session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nindex ef8458040..f057b2e42 100644\n--- a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\n+++ b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\n\n@@ -88,7 +75,7 @@ public class IoTDBSessionIT {\n     createTimeseries();\n     insertByStr();\n \n-    insert_via_sql();\n+    insertViaSQL();\n     queryByDevice(\"root.sg1.d1\");\n \n     session.close();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0MzEzNw==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r481143137", "bodyText": "move the insertInObject() method to its caller. There are too many methods in this file..", "author": "qiaojialin", "createdAt": "2020-09-01T13:37:11Z", "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -794,7 +811,7 @@ private void insertInObject() throws IoTDBConnectionException, StatementExecutio\n     }\n   }\n \n-  private void insert() throws IoTDBConnectionException, StatementExecutionException {\n+  private void insertInObjectList() throws IoTDBConnectionException, StatementExecutionException {\n     String deviceId = \"root.sg1.d1\";\n     List<String> measurements = new ArrayList<>();", "originalCommit": "47d4cfa074b4560c280fa59ad1fbdab795f97f00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "chunk": "diff --git a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nsimilarity index 63%\nrename from session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\nrename to session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\nindex ef8458040..f057b2e42 100644\n--- a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java\n+++ b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionComplexIT.java\n\n@@ -762,76 +537,7 @@ public class IoTDBSessionIT {\n     session.insertRecords(deviceIds, timestamps, measurementsList, typesList, valuesList);\n   }\n \n-  private void insertRecordsByStr() throws IoTDBConnectionException, StatementExecutionException {\n-    String deviceId = \"root.sg1.d2\";\n-    List<String> measurements = new ArrayList<>();\n-    measurements.add(\"s1\");\n-    measurements.add(\"s2\");\n-    measurements.add(\"s3\");\n-    List<String> deviceIds = new ArrayList<>();\n-    List<List<String>> measurementsList = new ArrayList<>();\n-    List<List<String>> valuesList = new ArrayList<>();\n-    List<Long> timestamps = new ArrayList<>();\n-\n-    for (long time = 0; time < 500; time++) {\n-      List<String> values = new ArrayList<>();\n-      values.add(\"1\");\n-      values.add(\"2\");\n-      values.add(\"3\");\n-\n-      deviceIds.add(deviceId);\n-      measurementsList.add(measurements);\n-      valuesList.add(values);\n-      timestamps.add(time);\n-      if (time != 0 && time % 100 == 0) {\n-        session.insertRecords(deviceIds, timestamps, measurementsList, valuesList);\n-        deviceIds.clear();\n-        measurementsList.clear();\n-        valuesList.clear();\n-        timestamps.clear();\n-      }\n-    }\n-\n-    session.insertRecords(deviceIds, timestamps, measurementsList, valuesList);\n-  }\n-\n-  private void insertInObject() throws IoTDBConnectionException, StatementExecutionException {\n-    String deviceId = \"root.sg1.d1\";\n-    List<String> measurements = new ArrayList<>();\n-    List<TSDataType> types = new ArrayList<>();\n-    measurements.add(\"s1\");\n-    measurements.add(\"s2\");\n-    measurements.add(\"s3\");\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-\n-    for (long time = 0; time < 100; time++) {\n-      session.insertRecord(deviceId, time, measurements, types,1L, 2L, 3L);\n-    }\n-  }\n-\n-  private void insertInObjectList() throws IoTDBConnectionException, StatementExecutionException {\n-    String deviceId = \"root.sg1.d1\";\n-    List<String> measurements = new ArrayList<>();\n-    List<TSDataType> types = new ArrayList<>();\n-    measurements.add(\"s1\");\n-    measurements.add(\"s2\");\n-    measurements.add(\"s3\");\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-    types.add(TSDataType.INT64);\n-\n-    for (long time = 0; time < 100; time++) {\n-      List<Object> values = new ArrayList<>();\n-      values.add(1L);\n-      values.add(2L);\n-      values.add(3L);\n-      session.insertRecord(deviceId, time, measurements, types, values);\n-    }\n-  }\n-\n-  private void insertTabletTest(String deviceId)\n+  private void insertTablet(String deviceId)\n       throws IoTDBConnectionException, StatementExecutionException {\n \n     List<MeasurementSchema> schemaList = new ArrayList<>();\n"}}, {"oid": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "url": "https://github.com/apache/iotdb/commit/e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "message": "conflict", "committedDate": "2020-09-03T12:21:19Z", "type": "commit"}, {"oid": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "url": "https://github.com/apache/iotdb/commit/e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "message": "conflict", "committedDate": "2020-09-03T12:21:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNzEyNg==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r483327126", "bodyText": "Apache Rat, please.", "author": "jixuan1989", "createdAt": "2020-09-04T00:51:47Z", "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionSimpleIT.java", "diffHunk": "@@ -0,0 +1,243 @@\n+package org.apache.iotdb.session;\r", "originalCommit": "e65db8cf1232c0360a75a1fe465f06754a9fd7b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMzNDU1Ng==", "url": "https://github.com/apache/iotdb/pull/1670#discussion_r483334556", "bodyText": "Apache Rat, please.\n\nCopy that,thanks for your guidance", "author": "yanhongwangg", "createdAt": "2020-09-04T01:22:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNzEyNg=="}], "type": "inlineReview", "revised_code": {"commit": "12e5454b753a47c683a43cc3f2cbad059ca0b2c5", "chunk": "diff --git a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionSimpleIT.java b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionSimpleIT.java\nindex 6bb3ee05c..28d57c57a 100644\n--- a/session/src/test/java/org/apache/iotdb/session/IoTDBSessionSimpleIT.java\n+++ b/session/src/test/java/org/apache/iotdb/session/IoTDBSessionSimpleIT.java\n\n@@ -1,3 +1,21 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n package org.apache.iotdb.session;\n \n import static org.junit.Assert.assertEquals;\n"}}, {"oid": "12e5454b753a47c683a43cc3f2cbad059ca0b2c5", "url": "https://github.com/apache/iotdb/commit/12e5454b753a47c683a43cc3f2cbad059ca0b2c5", "message": "[IOTDB]856 Add Apache comments", "committedDate": "2020-09-04T01:18:31Z", "type": "commit"}]}