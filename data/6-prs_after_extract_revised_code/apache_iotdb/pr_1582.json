{"pr_number": 1582, "pr_title": "[IOTDB-822] Flush Raft Logs Periodically", "pr_createdAt": "2020-07-29T15:54:20Z", "pr_url": "https://github.com/apache/iotdb/pull/1582", "timeline": [{"oid": "4a77450fc701d50a988b4d4dc9c197a6e0f0cac5", "url": "https://github.com/apache/iotdb/commit/4a77450fc701d50a988b4d4dc9c197a6e0f0cac5", "message": "flush periodically", "committedDate": "2020-07-29T13:19:04Z", "type": "commit"}, {"oid": "90a350e20f8d94190c3387e0c3d691ff2bf60480", "url": "https://github.com/apache/iotdb/commit/90a350e20f8d94190c3387e0c3d691ff2bf60480", "message": "force flush", "committedDate": "2020-07-29T15:38:21Z", "type": "commit"}, {"oid": "997bf90c607699b0840e95adee5ae7cbf1a8e181", "url": "https://github.com/apache/iotdb/commit/997bf90c607699b0840e95adee5ae7cbf1a8e181", "message": "format", "committedDate": "2020-07-29T16:04:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM1NTM1MA==", "url": "https://github.com/apache/iotdb/pull/1582#discussion_r463355350", "bodyText": "shutdown this when the manager is closed.", "author": "jt2594838", "createdAt": "2020-07-31T01:16:21Z", "path": "cluster/src/main/java/org/apache/iotdb/cluster/log/manage/RaftLogManager.java", "diffHunk": "@@ -100,6 +100,16 @@ public RaftLogManager(StableEntryManager stableEntryManager, LogApplier applier,\n         .scheduleAtFixedRate(this::checkDeleteLog, logDeleteCheckIntervalSecond,\n             logDeleteCheckIntervalSecond,\n             TimeUnit.SECONDS);\n+\n+    /**\n+     * flush log to file periodically\n+     */\n+    int logFlushTimeIntervalMS = ClusterDescriptor.getInstance().getConfig()\n+        .getForceRaftLogPeriodInMS();\n+    if (ClusterDescriptor.getInstance().getConfig().isEnableRaftLogPersistence()) {\n+      executorService.scheduleAtFixedRate(this::flushLogPeriodically, logFlushTimeIntervalMS,\n+          logFlushTimeIntervalMS, TimeUnit.MILLISECONDS);", "originalCommit": "997bf90c607699b0840e95adee5ae7cbf1a8e181", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQxNjg3NQ==", "url": "https://github.com/apache/iotdb/pull/1582#discussion_r463416875", "bodyText": "Thanks for your advice. I will use a new executor service for raft log writing.", "author": "Ring-k", "createdAt": "2020-07-31T05:47:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM1NTM1MA=="}], "type": "inlineReview", "revised_code": {"commit": "e2c0d10f0ff43d0167597c0f68bf1a05aa23e111", "chunk": "diff --git a/cluster/src/main/java/org/apache/iotdb/cluster/log/manage/RaftLogManager.java b/cluster/src/main/java/org/apache/iotdb/cluster/log/manage/RaftLogManager.java\nindex 8328c168b0..5005f33875 100644\n--- a/cluster/src/main/java/org/apache/iotdb/cluster/log/manage/RaftLogManager.java\n+++ b/cluster/src/main/java/org/apache/iotdb/cluster/log/manage/RaftLogManager.java\n\n@@ -96,7 +97,7 @@ abstract public class RaftLogManager {\n      */\n     int logDeleteCheckIntervalSecond = ClusterDescriptor.getInstance().getConfig()\n         .getLogDeleteCheckIntervalSecond();\n-    executorService\n+    raftLogDeleteExecutorService\n         .scheduleAtFixedRate(this::checkDeleteLog, logDeleteCheckIntervalSecond,\n             logDeleteCheckIntervalSecond,\n             TimeUnit.SECONDS);\n"}}, {"oid": "e2c0d10f0ff43d0167597c0f68bf1a05aa23e111", "url": "https://github.com/apache/iotdb/commit/e2c0d10f0ff43d0167597c0f68bf1a05aa23e111", "message": "new executor service", "committedDate": "2020-07-31T05:30:42Z", "type": "commit"}, {"oid": "aa1b9ac7c15a3dcf511029f8db573cd1cd3a9229", "url": "https://github.com/apache/iotdb/commit/aa1b9ac7c15a3dcf511029f8db573cd1cd3a9229", "message": "merge", "committedDate": "2020-07-31T05:44:12Z", "type": "commit"}, {"oid": "56663f95add49a4fd54cf6647401ad2466153bf5", "url": "https://github.com/apache/iotdb/commit/56663f95add49a4fd54cf6647401ad2466153bf5", "message": "format", "committedDate": "2020-07-31T05:49:09Z", "type": "commit"}]}