{"pr_number": 1341, "pr_title": "[ISSUE-1281] Show timeseries with heat sort", "pr_createdAt": "2020-06-10T07:39:13Z", "pr_url": "https://github.com/apache/iotdb/pull/1341", "timeline": [{"oid": "542a59bfb3bb097dae3471d476d69626b443c2a4", "url": "https://github.com/apache/iotdb/commit/542a59bfb3bb097dae3471d476d69626b443c2a4", "message": "init", "committedDate": "2020-06-08T11:58:12Z", "type": "commit"}, {"oid": "88e2118e4637dd36671a4acf6f447710ca8c3d26", "url": "https://github.com/apache/iotdb/commit/88e2118e4637dd36671a4acf6f447710ca8c3d26", "message": "show timeseries with sort", "committedDate": "2020-06-10T07:29:43Z", "type": "commit"}, {"oid": "8bea06346acfdd01c4ca36da2c5abb5be0bdbbdd", "url": "https://github.com/apache/iotdb/commit/8bea06346acfdd01c4ca36da2c5abb5be0bdbbdd", "message": "resolve conflicts", "committedDate": "2020-06-10T07:34:26Z", "type": "commit"}, {"oid": "16d6082583a1ca848f51f80f579a95676318c3d7", "url": "https://github.com/apache/iotdb/commit/16d6082583a1ca848f51f80f579a95676318c3d7", "message": "resolve conflicts twice", "committedDate": "2020-06-10T07:35:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk2MzI3MA==", "url": "https://github.com/apache/iotdb/pull/1341#discussion_r437963270", "bodyText": "do we need to order by path?", "author": "qiaojialin", "createdAt": "2020-06-10T08:47:40Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -798,6 +800,18 @@ public int getNodesCountInGivenLevel(String prefixPath, int level) throws Metada\n           }\n         }\n       }\n+\n+      // if ordered by heat, we sort all the timeseries by the descending order of the last insert timestamp\n+      if (plan.isOrderByHeat()) {\n+        allMatchedNodes = allMatchedNodes.stream().sorted(\n+            Comparator.comparingLong(MTree::getLastTimeStamp).reversed()\n+                .thenComparing(MNode::getFullPath)).collect(toList());", "originalCommit": "16d6082583a1ca848f51f80f579a95676318c3d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAxOTU4Nw==", "url": "https://github.com/apache/iotdb/pull/1341#discussion_r438019587", "bodyText": "@qiaojialin Hi, in my opinion, order by path is better than disorder relatively.", "author": "Alima777", "createdAt": "2020-06-10T10:22:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk2MzI3MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk2NzI1Ng==", "url": "https://github.com/apache/iotdb/pull/1341#discussion_r437967256", "bodyText": "it's better to return List<MeasurementMNode> instead of List<String>, Zesong may be working on this.", "author": "qiaojialin", "createdAt": "2020-06-10T08:54:00Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -657,7 +713,8 @@ private int getCountInGivenLevel(MNode node, int targetLevel) {\n   /**\n    * Iterate through MTree to fetch metadata info of all leaf nodes under the given seriesPath\n    *\n-   * @param timeseriesSchemaList List<timeseriesSchema>\n+   * @param timeseriesSchemaList Collection<timeseriesSchema> result: [name, alias, storage group,\n+   *                          dataType, encoding, compression, offset, lastTimeStamp]\n    */\n   private void findPath(MNode node, String[] nodes, int idx, String parent,", "originalCommit": "16d6082583a1ca848f51f80f579a95676318c3d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk3NzY0Ng==", "url": "https://github.com/apache/iotdb/pull/1341#discussion_r437977646", "bodyText": "It actually returns List, I forgot to change the comments back.", "author": "JackieTien97", "createdAt": "2020-06-10T09:10:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk2NzI1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "c1cfa47e295d9326ccb6b3d35ed407867b2fac07", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/metadata/MTree.java b/server/src/main/java/org/apache/iotdb/db/metadata/MTree.java\nindex df27cd7d0c..a72136b0d1 100644\n--- a/server/src/main/java/org/apache/iotdb/db/metadata/MTree.java\n+++ b/server/src/main/java/org/apache/iotdb/db/metadata/MTree.java\n\n@@ -713,8 +692,8 @@ public class MTree implements Serializable {\n   /**\n    * Iterate through MTree to fetch metadata info of all leaf nodes under the given seriesPath\n    *\n-   * @param timeseriesSchemaList Collection<timeseriesSchema> result: [name, alias, storage group,\n-   *                          dataType, encoding, compression, offset, lastTimeStamp]\n+   * @param timeseriesSchemaList List<timeseriesSchema>\n+   * result: [name, alias, storage group, dataType, encoding, compression, offset, lastTimeStamp]\n    */\n   private void findPath(MNode node, String[] nodes, int idx, String parent,\n       List<String[]> timeseriesSchemaList, boolean hasLimit) throws MetadataException {\n"}}, {"oid": "c1cfa47e295d9326ccb6b3d35ed407867b2fac07", "url": "https://github.com/apache/iotdb/commit/c1cfa47e295d9326ccb6b3d35ed407867b2fac07", "message": "chaneg comments", "committedDate": "2020-06-10T09:09:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAyNjc3OA==", "url": "https://github.com/apache/iotdb/pull/1341#discussion_r438026778", "bodyText": "Hi, you forgot the lastTimestamp column here~", "author": "Alima777", "createdAt": "2020-06-10T10:36:51Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -624,6 +631,34 @@ private int getCountInGivenLevel(MNode node, int targetLevel) {\n     return cnt;\n   }\n \n+  /**\n+   * Get all time series schema under the given path order by insert frequency\n+   *\n+   * <p>result: [name, alias, storage group, dataType, encoding, compression, offset]", "originalCommit": "c1cfa47e295d9326ccb6b3d35ed407867b2fac07", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "9fb01459dc1cd923d53ec2504fdf222ab082f83f", "url": "https://github.com/apache/iotdb/commit/9fb01459dc1cd923d53ec2504fdf222ab082f83f", "message": "change the syntax", "committedDate": "2020-06-12T07:41:32Z", "type": "commit"}, {"oid": "a1beb270a0fd8c8781fd15d22798d4f9045563bd", "url": "https://github.com/apache/iotdb/commit/a1beb270a0fd8c8781fd15d22798d4f9045563bd", "message": "resolve conflicts", "committedDate": "2020-06-15T03:43:36Z", "type": "commit"}, {"oid": "3b3e8acbdbec414c5efe9188f094b60b5eb8a8ef", "url": "https://github.com/apache/iotdb/commit/3b3e8acbdbec414c5efe9188f094b60b5eb8a8ef", "message": "add operation manual", "committedDate": "2020-06-15T09:58:57Z", "type": "commit"}]}