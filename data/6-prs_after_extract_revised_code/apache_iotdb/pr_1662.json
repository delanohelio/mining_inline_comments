{"pr_number": 1662, "pr_title": "[IOTDB-837] ArrayIndexOutOfBoundsException if the measurementId size is not consistent with the value size", "pr_createdAt": "2020-08-31T02:33:01Z", "pr_url": "https://github.com/apache/iotdb/pull/1662", "timeline": [{"oid": "f6047256737c8149e73e5a491c20ee1fc8c31c56", "url": "https://github.com/apache/iotdb/commit/f6047256737c8149e73e5a491c20ee1fc8c31c56", "message": "IOTDB-837:ArrayIndexOutOfBoundsException if the measurementId size is not consistent with the value size", "committedDate": "2020-08-31T02:30:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg2NTg3Mg==", "url": "https://github.com/apache/iotdb/pull/1662#discussion_r479865872", "bodyText": "This check could also be removed. I do not know how to trigger this. The sql parser should have already checked.", "author": "qiaojialin", "createdAt": "2020-08-31T03:09:24Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java", "diffHunk": "@@ -176,6 +176,13 @@ public PhysicalPlan transformToPhysicalPlan(Operator operator) throws QueryProce\n               \"For Insert command, cannot specified more than one seriesPath: \" + paths);\n         }", "originalCommit": "f6047256737c8149e73e5a491c20ee1fc8c31c56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eae1d4e1d4fb98130d07cc103afa14fe9a15e7f9", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java b/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java\nindex 04adf5ec78..4e3409dcca 100644\n--- a/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java\n+++ b/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java\n\n@@ -171,13 +176,9 @@ public class PhysicalGenerator {\n       case INSERT:\n         InsertOperator insert = (InsertOperator) operator;\n         paths = insert.getSelectedPaths();\n-        if (paths.size() != 1) {\n-          throw new LogicalOperatorException(\n-              \"For Insert command, cannot specified more than one seriesPath: \" + paths);\n-        }\n \n         if (insert.getMeasurementList().length != insert.getValueList().length) {\n-          throw new ArrayIndexOutOfBoundsException(\n+          throw new SQLParserException(\n               String.format(\n                   \"the measurementList's size %d is not consistent with the valueList's size %d\",\n                   insert.getMeasurementList().length, insert.getValueList().length));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg2NjY2Mg==", "url": "https://github.com/apache/iotdb/pull/1662#discussion_r479866662", "bodyText": "You could throw an SQLParserException.", "author": "qiaojialin", "createdAt": "2020-08-31T03:13:47Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java", "diffHunk": "@@ -176,6 +176,13 @@ public PhysicalPlan transformToPhysicalPlan(Operator operator) throws QueryProce\n               \"For Insert command, cannot specified more than one seriesPath: \" + paths);\n         }\n \n+        if (insert.getMeasurementList().length != insert.getValueList().length) {\n+          throw new ArrayIndexOutOfBoundsException(", "originalCommit": "f6047256737c8149e73e5a491c20ee1fc8c31c56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg3ODQyMg==", "url": "https://github.com/apache/iotdb/pull/1662#discussion_r479878422", "bodyText": "Thank you for your opinion. I will revise it", "author": "yanhongwangg", "createdAt": "2020-08-31T04:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg2NjY2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "eae1d4e1d4fb98130d07cc103afa14fe9a15e7f9", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java b/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java\nindex 04adf5ec78..4e3409dcca 100644\n--- a/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java\n+++ b/server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java\n\n@@ -171,13 +176,9 @@ public class PhysicalGenerator {\n       case INSERT:\n         InsertOperator insert = (InsertOperator) operator;\n         paths = insert.getSelectedPaths();\n-        if (paths.size() != 1) {\n-          throw new LogicalOperatorException(\n-              \"For Insert command, cannot specified more than one seriesPath: \" + paths);\n-        }\n \n         if (insert.getMeasurementList().length != insert.getValueList().length) {\n-          throw new ArrayIndexOutOfBoundsException(\n+          throw new SQLParserException(\n               String.format(\n                   \"the measurementList's size %d is not consistent with the valueList's size %d\",\n                   insert.getMeasurementList().length, insert.getValueList().length));\n"}}, {"oid": "eae1d4e1d4fb98130d07cc103afa14fe9a15e7f9", "url": "https://github.com/apache/iotdb/commit/eae1d4e1d4fb98130d07cc103afa14fe9a15e7f9", "message": "IOTDB-837:ArrayIndexOutOfBoundsException if the measurementId size is not consistent with the value size", "committedDate": "2020-08-31T06:32:01Z", "type": "commit"}, {"oid": "b9b8f0b6e8919e8de9cd68bade96b43d3564b7da", "url": "https://github.com/apache/iotdb/commit/b9b8f0b6e8919e8de9cd68bade96b43d3564b7da", "message": "IOTDB-837:Modify ArrayIndexOutOfBoundsException to SQLParserException", "committedDate": "2020-08-31T06:36:33Z", "type": "commit"}, {"oid": "90b889c6c71bc7fc54a23bcef9d8537c857ecf81", "url": "https://github.com/apache/iotdb/commit/90b889c6c71bc7fc54a23bcef9d8537c857ecf81", "message": "IOTDB-837:Add a test", "committedDate": "2020-09-01T11:09:25Z", "type": "commit"}]}