{"pr_number": 1751, "pr_title": "[IOTDB-902] Optimize max_time aggregation and fix order by time desc aggregation bug ", "pr_createdAt": "2020-09-22T14:56:45Z", "pr_url": "https://github.com/apache/iotdb/pull/1751", "timeline": [{"oid": "fd4f3fe172c41b59f75c21e1a0cb2f93694beb4a", "url": "https://github.com/apache/iotdb/commit/fd4f3fe172c41b59f75c21e1a0cb2f93694beb4a", "message": "seperate agg results as asc and desc", "committedDate": "2020-09-18T11:12:19Z", "type": "commit"}, {"oid": "85acf093b250a657a16561cd1c4099622324aedc", "url": "https://github.com/apache/iotdb/commit/85acf093b250a657a16561cd1c4099622324aedc", "message": "fix aggregation desc bug", "committedDate": "2020-09-18T12:24:51Z", "type": "commit"}, {"oid": "9c126eae3bcc1e54ec88ceeca224b84b20ce84d4", "url": "https://github.com/apache/iotdb/commit/9c126eae3bcc1e54ec88ceeca224b84b20ce84d4", "message": "fix series reader bug", "committedDate": "2020-09-19T08:55:10Z", "type": "commit"}, {"oid": "1c88f9b43e650e28de5f147c01eff4b7bd5b2939", "url": "https://github.com/apache/iotdb/commit/1c88f9b43e650e28de5f147c01eff4b7bd5b2939", "message": "fix maxtimeaggrResult", "committedDate": "2020-09-19T12:07:20Z", "type": "commit"}, {"oid": "88db34bdf453a16a1a8b0d8f0ed05c94a21050e2", "url": "https://github.com/apache/iotdb/commit/88db34bdf453a16a1a8b0d8f0ed05c94a21050e2", "message": "fix max last_value bug", "committedDate": "2020-09-19T13:25:41Z", "type": "commit"}, {"oid": "af10d859ba5496e5fada285ba9c775fb3b4c78ad", "url": "https://github.com/apache/iotdb/commit/af10d859ba5496e5fada285ba9c775fb3b4c78ad", "message": "fix desc merge reader bug", "committedDate": "2020-09-19T13:53:39Z", "type": "commit"}, {"oid": "b0ddb4f0a9f1c102c3ba05db227b572db122c21f", "url": "https://github.com/apache/iotdb/commit/b0ddb4f0a9f1c102c3ba05db227b572db122c21f", "message": "add more desc tests", "committedDate": "2020-09-22T06:15:30Z", "type": "commit"}, {"oid": "76aad30d937559fbd74c670d6379c3883402316f", "url": "https://github.com/apache/iotdb/commit/76aad30d937559fbd74c670d6379c3883402316f", "message": "fix bugs", "committedDate": "2020-09-22T14:53:45Z", "type": "commit"}, {"oid": "5ab42f4e832c65b2667e4fa07e1fc523cc859bd5", "url": "https://github.com/apache/iotdb/commit/5ab42f4e832c65b2667e4fa07e1fc523cc859bd5", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization", "committedDate": "2020-09-22T14:55:01Z", "type": "commit"}, {"oid": "8b68c49fc1636d73fc800e2a8efef732e45082c1", "url": "https://github.com/apache/iotdb/commit/8b68c49fc1636d73fc800e2a8efef732e45082c1", "message": "fix hasResult() bug", "committedDate": "2020-09-22T16:33:31Z", "type": "commit"}, {"oid": "8b68c49fc1636d73fc800e2a8efef732e45082c1", "url": "https://github.com/apache/iotdb/commit/8b68c49fc1636d73fc800e2a8efef732e45082c1", "message": "fix hasResult() bug", "committedDate": "2020-09-22T16:33:31Z", "type": "forcePushed"}, {"oid": "f97f25db2e1aed2ff192f0c2a73e2309733051b3", "url": "https://github.com/apache/iotdb/commit/f97f25db2e1aed2ff192f0c2a73e2309733051b3", "message": "remove unused constraint", "committedDate": "2020-09-22T16:44:37Z", "type": "commit"}, {"oid": "1520a985d2b519777b10889b2ece45ec7b6b8e7b", "url": "https://github.com/apache/iotdb/commit/1520a985d2b519777b10889b2ece45ec7b6b8e7b", "message": "modify test", "committedDate": "2020-09-22T17:00:26Z", "type": "commit"}, {"oid": "d528f98127570f0b63c4ad342ff92ed94fbd0da4", "url": "https://github.com/apache/iotdb/commit/d528f98127570f0b63c4ad342ff92ed94fbd0da4", "message": "fix first value bug", "committedDate": "2020-09-23T02:17:34Z", "type": "commit"}, {"oid": "3a0afeb943774796842f1e4d59a38fe97c5e9984", "url": "https://github.com/apache/iotdb/commit/3a0afeb943774796842f1e4d59a38fe97c5e9984", "message": "add aggregation tests and modift statistics method", "committedDate": "2020-09-23T03:40:11Z", "type": "commit"}, {"oid": "4ad290c05360317d7e929d79c45886e7f408d6e7", "url": "https://github.com/apache/iotdb/commit/4ad290c05360317d7e929d79c45886e7f408d6e7", "message": "modify parameter names", "committedDate": "2020-09-23T11:30:45Z", "type": "commit"}, {"oid": "f70941ecf15784f1c8d3076421a326c27a78f5b0", "url": "https://github.com/apache/iotdb/commit/f70941ecf15784f1c8d3076421a326c27a78f5b0", "message": "fix deserializeFrom bug", "committedDate": "2020-09-23T11:41:24Z", "type": "commit"}, {"oid": "0229fd7fb69e59403cd3f0f17bc9330e86e6f1a4", "url": "https://github.com/apache/iotdb/commit/0229fd7fb69e59403cd3f0f17bc9330e86e6f1a4", "message": "adjust structure of AggrResult", "committedDate": "2020-09-23T16:08:45Z", "type": "commit"}, {"oid": "8eece91c0726a7abca6a0652a6f3bde23150395f", "url": "https://github.com/apache/iotdb/commit/8eece91c0726a7abca6a0652a6f3bde23150395f", "message": "add license and fix a little bug", "committedDate": "2020-09-24T02:04:28Z", "type": "commit"}, {"oid": "a9bbf3ff002b79e20ec9d20f8903ebbec5671090", "url": "https://github.com/apache/iotdb/commit/a9bbf3ff002b79e20ec9d20f8903ebbec5671090", "message": "add more tests with filter", "committedDate": "2020-09-24T02:54:02Z", "type": "commit"}, {"oid": "122bc857f1d1da0b771bb45dd0c7ed35d594b18c", "url": "https://github.com/apache/iotdb/commit/122bc857f1d1da0b771bb45dd0c7ed35d594b18c", "message": "fix aggregation with value filter bug", "committedDate": "2020-09-24T04:03:31Z", "type": "commit"}, {"oid": "8a511c4b7c4d659d57f719cf3419153dde5b9ce3", "url": "https://github.com/apache/iotdb/commit/8a511c4b7c4d659d57f719cf3419153dde5b9ce3", "message": "optimize code structure", "committedDate": "2020-09-24T04:31:19Z", "type": "commit"}, {"oid": "6337c8cdc3b47925ea811e99b68ca32d7e8bbe9d", "url": "https://github.com/apache/iotdb/commit/6337c8cdc3b47925ea811e99b68ca32d7e8bbe9d", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization", "committedDate": "2020-09-24T09:13:21Z", "type": "commit"}, {"oid": "cc7e33a29658e0994b2471f8baa4fdc55ddaa89a", "url": "https://github.com/apache/iotdb/commit/cc7e33a29658e0994b2471f8baa4fdc55ddaa89a", "message": "del DescSeriesReaderByTimestamp", "committedDate": "2020-09-24T12:30:24Z", "type": "commit"}, {"oid": "d9b5b22beec96626499437844d634714f97735ee", "url": "https://github.com/apache/iotdb/commit/d9b5b22beec96626499437844d634714f97735ee", "message": "1.add groupByFIll UT\n2.fix bug and optimize GroupByFillDataSet", "committedDate": "2020-09-25T08:17:24Z", "type": "commit"}, {"oid": "0d2bdc7ea67eef214ce7bf5198833c652423d471", "url": "https://github.com/apache/iotdb/commit/0d2bdc7ea67eef214ce7bf5198833c652423d471", "message": "add some desc ut", "committedDate": "2020-09-25T08:32:47Z", "type": "commit"}, {"oid": "1d405c2b0189061c3bcba7124fe23c09c4db513c", "url": "https://github.com/apache/iotdb/commit/1d405c2b0189061c3bcba7124fe23c09c4db513c", "message": "delete some unused method", "committedDate": "2020-09-25T11:35:35Z", "type": "commit"}, {"oid": "8ca6f50429508472725a06b6a2cc6e0e1bab80c9", "url": "https://github.com/apache/iotdb/commit/8ca6f50429508472725a06b6a2cc6e0e1bab80c9", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization", "committedDate": "2020-09-27T01:40:36Z", "type": "commit"}, {"oid": "d2052424338db54bf010ef9c6247935befa5a6dd", "url": "https://github.com/apache/iotdb/commit/d2052424338db54bf010ef9c6247935befa5a6dd", "message": "add some desc IT", "committedDate": "2020-09-27T13:45:53Z", "type": "commit"}, {"oid": "33b66364e04c5413e7b8b03971f011e4bdd6b5fc", "url": "https://github.com/apache/iotdb/commit/33b66364e04c5413e7b8b03971f011e4bdd6b5fc", "message": "delete some redundant tests", "committedDate": "2020-09-29T02:07:35Z", "type": "commit"}, {"oid": "8df3edc6c2b2f05b86310c1e037782ed7059b7fc", "url": "https://github.com/apache/iotdb/commit/8df3edc6c2b2f05b86310c1e037782ed7059b7fc", "message": "fix conflict", "committedDate": "2020-09-29T02:08:19Z", "type": "commit"}, {"oid": "36f09b26ff0ff87a58e20e4a5072d171e9eaf2c6", "url": "https://github.com/apache/iotdb/commit/36f09b26ff0ff87a58e20e4a5072d171e9eaf2c6", "message": "fix some typo", "committedDate": "2020-09-29T03:05:18Z", "type": "commit"}, {"oid": "819dcea1aefbc21ca280dd31e7958f317b61c92b", "url": "https://github.com/apache/iotdb/commit/819dcea1aefbc21ca280dd31e7958f317b61c92b", "message": "remove duplicated code", "committedDate": "2020-09-29T09:20:19Z", "type": "commit"}, {"oid": "7200a1fa036bb7229c5d720341b05833e25087ce", "url": "https://github.com/apache/iotdb/commit/7200a1fa036bb7229c5d720341b05833e25087ce", "message": "rename hasResult -> hasCandidateResult", "committedDate": "2020-09-30T14:08:40Z", "type": "commit"}, {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "url": "https://github.com/apache/iotdb/commit/5b7c939db938d237e7e3263af2b2ba95de158c7d", "message": "modify typo", "committedDate": "2020-09-30T14:11:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4MDIyNw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500080227", "bodyText": "I don't get the reason why do you remove this IT...", "author": "HTHou", "createdAt": "2020-10-06T08:02:08Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationAlignByDeviceIT.java", "diffHunk": "@@ -1,113 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-package org.apache.iotdb.db.integration;\n-\n-import static org.apache.iotdb.db.constant.TestConstant.count;\n-import static org.junit.Assert.fail;\n-\n-import java.sql.Connection;\n-import java.sql.DriverManager;\n-import java.sql.ResultSet;\n-import java.sql.SQLException;\n-import java.sql.Statement;\n-import org.apache.iotdb.db.utils.EnvironmentUtils;\n-import org.apache.iotdb.jdbc.Config;\n-import org.junit.After;\n-import org.junit.Assert;\n-import org.junit.Before;\n-import org.junit.Test;\n-\n-public class IoTDBAggregationAlignByDeviceIT {\n-", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY5MDA2Mw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500690063", "bodyText": "As all the align by device test is included in IoTDBAlignByDeviceIT. It's redundant here.", "author": "Alima777", "createdAt": "2020-10-07T01:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4MDIyNw=="}], "type": "inlineReview", "revised_code": {"commit": "8f0374418e740afcac26f6128ea1c658aa14e835", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationAlignByDeviceIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationAlignByDeviceIT.java\nnew file mode 100644\nindex 000000000..d8e46c8a3\n--- /dev/null\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationAlignByDeviceIT.java\n\n@@ -0,0 +1,133 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.integration;\n+\n+import static org.apache.iotdb.db.constant.TestConstant.count;\n+import static org.junit.Assert.fail;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import org.apache.iotdb.db.utils.EnvironmentUtils;\n+import org.apache.iotdb.jdbc.Config;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class IoTDBAggregationAlignByDeviceIT {\n+\n+  private static final String[] dataSet = new String[]{\n+      \"INSERT INTO root.sg1.d1(timestamp,s1,s2,s3) values(1, 1.0, 1.1, 1.2)\",\n+      \"INSERT INTO root.sg1.d1(timestamp,s1,s2,s3) values(2, 2.0, 2.1, 2.2)\",\n+      \"INSERT INTO root.sg1.d1(timestamp,s1,s2,s3) values(3, 3.0, 3.1, 3.2)\",\n+      \"flush\",\n+      \"INSERT INTO root.sg1.d2(timestamp,s1,s2,s3) values(1, 1.0, 1.1, 1.2)\",\n+      \"INSERT INTO root.sg1.d2(timestamp,s1,s2,s3) values(2, 2.0, 2.1, 2.2)\",\n+      \"INSERT INTO root.sg1.d2(timestamp,s1,s2,s3) values(3, 3.0, 3.1, 3.2)\",\n+      \"flush\",\n+      \"INSERT INTO root.sg1.d1(timestamp,s1,s2,s3) values(1, 11.0, 11.1, 11.2)\",\n+      \"INSERT INTO root.sg1.d1(timestamp,s1,s2,s3) values(2, 12.0, 12.1, 12.2)\",\n+      \"INSERT INTO root.sg1.d1(timestamp,s1,s2,s3) values(3, 13.0, 13.1, 13.2)\",\n+      \"INSERT INTO root.sg1.d2(timestamp,s1,s2,s3) values(1, 11.0, 11.1, 11.2)\",\n+      \"INSERT INTO root.sg1.d2(timestamp,s1,s2,s3) values(2, 12.0, 12.1, 12.2)\",\n+      \"INSERT INTO root.sg1.d2(timestamp,s1,s2,s3) values(3, 13.0, 13.1, 13.2)\",\n+  };\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    EnvironmentUtils.closeStatMonitor();\n+    EnvironmentUtils.envSetUp();\n+    Class.forName(Config.JDBC_DRIVER_NAME);\n+    prepareData();\n+  }\n+\n+  @After\n+  public void tearDown() throws Exception {\n+    EnvironmentUtils.cleanEnv();\n+  }\n+\n+  @Test\n+  public void test() throws SQLException {\n+    String[] retArray = new String[]{\"root.sg1.d1,3,3,3\", \"root.sg1.d2,3,3,3\",};\n+    try (Connection connection = DriverManager.\n+        getConnection(\"jdbc:iotdb://127.0.0.1:6667/\", \"root\", \"root\");\n+        Statement statement = connection.createStatement()) {\n+\n+      boolean hasResultSet = statement\n+          .execute(\"SELECT count(*) from root align by device\");\n+\n+      Assert.assertTrue(hasResultSet);\n+\n+      int cnt;\n+      try (ResultSet resultSet = statement.getResultSet()) {\n+        cnt = 0;\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(\"Device\") + \",\" + resultSet.getString(count(\"s1\"))\n+                  + \",\" + resultSet.getString(count(\"s2\")) + \",\" + resultSet\n+                  .getString(count(\"s3\"));\n+          System.out.println(ans);\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(retArray.length, cnt);\n+      }\n+\n+      hasResultSet = statement\n+          .execute(\"SELECT count(*) from root order by time desc align by device \");\n+\n+      Assert.assertTrue(hasResultSet);\n+\n+      try (ResultSet resultSet = statement.getResultSet()) {\n+        cnt = 0;\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(\"Device\") + \",\" + resultSet.getString(count(\"s1\"))\n+                  + \",\" + resultSet.getString(count(\"s2\")) + \",\" + resultSet\n+                  .getString(count(\"s3\"));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(retArray.length, cnt);\n+      }\n+\n+    } catch (Exception e) {\n+      e.printStackTrace();\n+      fail(e.getMessage());\n+    }\n+  }\n+\n+  private void prepareData() {\n+    try (Connection connection = DriverManager\n+        .getConnection(Config.IOTDB_URL_PREFIX + \"127.0.0.1:6667/\", \"root\",\n+            \"root\");\n+        Statement statement = connection.createStatement()) {\n+\n+      for (String sql : dataSet) {\n+        statement.execute(sql);\n+      }\n+\n+    } catch (Exception e) {\n+      e.printStackTrace();\n+    }\n+  }\n+}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4Mzg4MQ==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500083881", "bodyText": "Better to use try with resource reduce code smell...", "author": "HTHou", "createdAt": "2020-10-06T08:08:16Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -357,11 +438,11 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n       try {\n         while (resultSet.next()) {\n           String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n-                  resultSet.getString(min_time(d0s0)) + \",\" +\n-                  resultSet.getString(min_time(d0s1)) + \",\" +\n-                  resultSet.getString(min_time(d0s2)) +\n-                  \",\" + resultSet.getString(min_time(d0s3)) +\n-                  \",\" + resultSet.getString(min_time(d0s4));\n+              resultSet.getString(min_time(d0s0)) + \",\" +\n+              resultSet.getString(min_time(d0s1)) + \",\" +\n+              resultSet.getString(min_time(d0s2)) +\n+              \",\" + resultSet.getString(min_time(d0s3)) +\n+              \",\" + resultSet.getString(min_time(d0s4));\n           Assert.assertEquals(ans, retArray[cnt]);\n           cnt++;\n         }", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk0MzcxMA==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500943710", "bodyText": "Fixed.", "author": "Alima777", "createdAt": "2020-10-07T11:41:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4Mzg4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\nindex c7f41bf4e..ac9cc31fa 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n\n@@ -433,9 +433,9 @@ public class IoTDBAggregationLargeDataIT {\n           \"select min_time(s0),min_time(s1),min_time(s2),min_time(s3),min_time(s4)\" +\n               \" from root.vehicle.d0 where s1 >= 0\");\n       Assert.assertTrue(hasResultSet);\n-      ResultSet resultSet = statement.getResultSet();\n       int cnt = 0;\n-      try {\n+\n+      try (ResultSet resultSet = statement.getResultSet()) {\n         while (resultSet.next()) {\n           String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n               resultSet.getString(min_time(d0s0)) + \",\" +\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NDUzMw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500084533", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  resultSet = statement.getResultSet();\n          \n          \n            \n                  try {\n          \n          \n            \n                    while (resultSet.next()) {\n          \n          \n            \n                      String ans =\n          \n          \n            \n                          resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s2))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s4));\n          \n          \n            \n                      Assert.assertEquals(ans, retArray[cnt]);\n          \n          \n            \n                      cnt++;\n          \n          \n            \n                    }\n          \n          \n            \n                    Assert.assertEquals(2, cnt);\n          \n          \n            \n                  } finally {\n          \n          \n            \n                    resultSet.close();\n          \n          \n            \n                  }\n          \n          \n            \n                  try (resultSet = statement.getResultSet()) {\n          \n          \n            \n                    while (resultSet.next()) {\n          \n          \n            \n                      String ans =\n          \n          \n            \n                          resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s2))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s4));\n          \n          \n            \n                      Assert.assertEquals(ans, retArray[cnt]);\n          \n          \n            \n                      cnt++;\n          \n          \n            \n                    }\n          \n          \n            \n                    Assert.assertEquals(2, cnt);\n          \n          \n            \n                  }", "author": "HTHou", "createdAt": "2020-10-06T08:09:26Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -370,27 +451,70 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n         resultSet.close();\n       }\n \n-      retArray = new String[]{\n-          \"0,3999,3999,3999,3599,100\"\n-      };\n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n       resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\nindex c7f41bf4e..ac9cc31fa 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n\n@@ -447,16 +447,13 @@ public class IoTDBAggregationLargeDataIT {\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n-      } finally {\n-        resultSet.close();\n       }\n \n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n-      resultSet = statement.getResultSet();\n-      try {\n+      try (ResultSet resultSet = statement.getResultSet()) {\n         while (resultSet.next()) {\n           String ans =\n               resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NDg0Nw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500084847", "bodyText": "Same as above", "author": "HTHou", "createdAt": "2020-10-06T08:09:57Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -370,27 +451,70 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n         resultSet.close();\n       }\n \n-      retArray = new String[]{\n-          \"0,3999,3999,3999,3599,100\"\n-      };\n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n       resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }\n+\n+      // keep the correctness of `order by time desc`\n+      hasResultSet = statement.execute(\n+          \"select min_time(s0),min_time(s1),min_time(s2),min_time(s3),min_time(s4)\" +\n+              \" from root.vehicle.d0 where s1 >= 0 order by time desc\");\n+      Assert.assertTrue(hasResultSet);\n+      resultSet = statement.getResultSet();\n       cnt = 0;\n       try {\n         while (resultSet.next()) {\n-          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n-                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet.getString(max_time(d0s2))\n-                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet.getString(max_time(d0s4));\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(d0s0)) + \",\" +\n+              resultSet.getString(min_time(d0s1)) + \",\" +\n+              resultSet.getString(min_time(d0s2)) +\n+              \",\" + resultSet.getString(min_time(d0s3)) +\n+              \",\" + resultSet.getString(min_time(d0s4));\n           Assert.assertEquals(ans, retArray[cnt]);\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n       } finally {\n         resultSet.close();\n       }", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\nindex c7f41bf4e..ac9cc31fa 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n\n@@ -447,16 +447,13 @@ public class IoTDBAggregationLargeDataIT {\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n-      } finally {\n-        resultSet.close();\n       }\n \n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n-      resultSet = statement.getResultSet();\n-      try {\n+      try (ResultSet resultSet = statement.getResultSet()) {\n         while (resultSet.next()) {\n           String ans =\n               resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NTA3OQ==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500085079", "bodyText": "Same...", "author": "HTHou", "createdAt": "2020-10-06T08:10:19Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -370,27 +451,70 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n         resultSet.close();\n       }\n \n-      retArray = new String[]{\n-          \"0,3999,3999,3999,3599,100\"\n-      };\n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n       resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }\n+\n+      // keep the correctness of `order by time desc`\n+      hasResultSet = statement.execute(\n+          \"select min_time(s0),min_time(s1),min_time(s2),min_time(s3),min_time(s4)\" +\n+              \" from root.vehicle.d0 where s1 >= 0 order by time desc\");\n+      Assert.assertTrue(hasResultSet);\n+      resultSet = statement.getResultSet();\n       cnt = 0;\n       try {\n         while (resultSet.next()) {\n-          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n-                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet.getString(max_time(d0s2))\n-                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet.getString(max_time(d0s4));\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(d0s0)) + \",\" +\n+              resultSet.getString(min_time(d0s1)) + \",\" +\n+              resultSet.getString(min_time(d0s2)) +\n+              \",\" + resultSet.getString(min_time(d0s3)) +\n+              \",\" + resultSet.getString(min_time(d0s4));\n           Assert.assertEquals(ans, retArray[cnt]);\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n       } finally {\n         resultSet.close();\n       }\n+\n+      hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n+          + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n+          \"where s1 < 50000 and s1 != 100 order by time desc\");\n+      Assert.assertTrue(hasResultSet);\n+      resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\nindex c7f41bf4e..ac9cc31fa 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n\n@@ -447,16 +447,13 @@ public class IoTDBAggregationLargeDataIT {\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n-      } finally {\n-        resultSet.close();\n       }\n \n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n-      resultSet = statement.getResultSet();\n-      try {\n+      try (ResultSet resultSet = statement.getResultSet()) {\n         while (resultSet.next()) {\n           String ans =\n               resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NTI2MA==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500085260", "bodyText": "Same...\nThere are a lot of try finally, better to fix them together.", "author": "HTHou", "createdAt": "2020-10-06T08:10:37Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -416,12 +540,35 @@ private void minValueAggreWithSingleFilterTest() throws ClassNotFoundException,\n         try {\n           while (resultSet.next()) {\n             String ans =\n-                    resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(min_value(d0s0))\n-                            + \",\" + resultSet.getString(min_value(d0s1)) + \",\" + resultSet\n-                            .getString(min_value(d0s2))\n-                            + \",\" + resultSet.getString(min_value(d0s3)) + \",\" + resultSet\n-                            .getString(min_value(d0s4));\n-            //System.out.println(\"============ \" + ans);\n+                resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(min_value(d0s0))\n+                    + \",\" + resultSet.getString(min_value(d0s1)) + \",\" + resultSet\n+                    .getString(min_value(d0s2))\n+                    + \",\" + resultSet.getString(min_value(d0s3)) + \",\" + resultSet\n+                    .getString(min_value(d0s4));\n+            Assert.assertEquals(ans, retArray[cnt]);\n+            cnt++;\n+          }\n+          Assert.assertEquals(1, cnt);\n+        } finally {\n+          resultSet.close();\n+        }", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\nindex c7f41bf4e..ac9cc31fa 100644\n--- a/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n+++ b/server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java\n\n@@ -535,9 +524,8 @@ public class IoTDBAggregationLargeDataIT {\n           \"where s1 < 50000 and s1 != 100\");\n \n       if (hasResultSet) {\n-        ResultSet resultSet = statement.getResultSet();\n         int cnt = 0;\n-        try {\n+        try (ResultSet resultSet = statement.getResultSet()) {\n           while (resultSet.next()) {\n             String ans =\n                 resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(min_value(d0s0))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODY4Mg==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500088682", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);", "author": "HTHou", "createdAt": "2020-10-06T08:16:17Z", "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -36,9 +36,9 @@\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk0NDE4OQ==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500944189", "bodyText": "Fixed.", "author": "Alima777", "createdAt": "2020-10-07T11:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODY4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\nindex 5efcb890f..cffedf3da 100644\n--- a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n+++ b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n\n@@ -36,138 +36,138 @@ public class AggregateResultTest {\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n     AggregateResult avgAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n-    statistics1.update(1L,1d);\n-    statistics1.update(2L,1d);\n-    statistics2.update(1L,2d);\n+    statistics1.update(1L, 1d);\n+    statistics1.update(2L, 1d);\n+    statistics2.update(1L, 2d);\n \n     avgAggrResult1.updateResultFromStatistics(statistics1);\n     avgAggrResult2.updateResultFromStatistics(statistics2);\n     avgAggrResult1.merge(avgAggrResult2);\n-    Assert.assertEquals(1.333d, (double)avgAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) avgAggrResult1.getResult(), 0.01);\n     Assert.assertEquals(3, ((AvgAggrResult) avgAggrResult1).getCnt());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     avgAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1.333d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult maxValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     maxValueAggrResult1.updateResultFromStatistics(statistics1);\n     maxValueAggrResult2.updateResultFromStatistics(statistics2);\n     maxValueAggrResult1.merge(maxValueAggrResult2);\n \n-    Assert.assertEquals(2d, (double)maxValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) maxValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n     AggregateResult maxTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     maxTimeAggrResult1.updateResultFromStatistics(statistics1);\n     maxTimeAggrResult2.updateResultFromStatistics(statistics2);\n     maxTimeAggrResult1.merge(maxTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)maxTimeAggrResult1.getResult());\n+    Assert.assertEquals(2L, (long) maxTimeAggrResult1.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxTimeAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void minValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult minValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult minValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     minValueAggrResult1.updateResultFromStatistics(statistics1);\n     minValueAggrResult2.updateResultFromStatistics(statistics2);\n     minValueAggrResult1.merge(minValueAggrResult2);\n \n-    Assert.assertEquals(1d, (double)minValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) minValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     minValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void minTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult finalResult = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(10L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     minTimeAggrResult1.updateResultFromStatistics(statistics1);\n     minTimeAggrResult2.updateResultFromStatistics(statistics2);\n     finalResult.merge(minTimeAggrResult1);\n     finalResult.merge(minTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)finalResult.getResult());\n+    Assert.assertEquals(2L, (long) finalResult.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     finalResult.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void countAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult countAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n     AggregateResult countAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.INT64);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.INT64);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODg0Mw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500088843", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);", "author": "HTHou", "createdAt": "2020-10-06T08:16:32Z", "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -36,9 +36,9 @@\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n     AggregateResult avgAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\nindex 5efcb890f..cffedf3da 100644\n--- a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n+++ b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n\n@@ -36,138 +36,138 @@ public class AggregateResultTest {\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n     AggregateResult avgAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n-    statistics1.update(1L,1d);\n-    statistics1.update(2L,1d);\n-    statistics2.update(1L,2d);\n+    statistics1.update(1L, 1d);\n+    statistics1.update(2L, 1d);\n+    statistics2.update(1L, 2d);\n \n     avgAggrResult1.updateResultFromStatistics(statistics1);\n     avgAggrResult2.updateResultFromStatistics(statistics2);\n     avgAggrResult1.merge(avgAggrResult2);\n-    Assert.assertEquals(1.333d, (double)avgAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) avgAggrResult1.getResult(), 0.01);\n     Assert.assertEquals(3, ((AvgAggrResult) avgAggrResult1).getCnt());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     avgAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1.333d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult maxValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     maxValueAggrResult1.updateResultFromStatistics(statistics1);\n     maxValueAggrResult2.updateResultFromStatistics(statistics2);\n     maxValueAggrResult1.merge(maxValueAggrResult2);\n \n-    Assert.assertEquals(2d, (double)maxValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) maxValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n     AggregateResult maxTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     maxTimeAggrResult1.updateResultFromStatistics(statistics1);\n     maxTimeAggrResult2.updateResultFromStatistics(statistics2);\n     maxTimeAggrResult1.merge(maxTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)maxTimeAggrResult1.getResult());\n+    Assert.assertEquals(2L, (long) maxTimeAggrResult1.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxTimeAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void minValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult minValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult minValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     minValueAggrResult1.updateResultFromStatistics(statistics1);\n     minValueAggrResult2.updateResultFromStatistics(statistics2);\n     minValueAggrResult1.merge(minValueAggrResult2);\n \n-    Assert.assertEquals(1d, (double)minValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) minValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     minValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void minTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult finalResult = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(10L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     minTimeAggrResult1.updateResultFromStatistics(statistics1);\n     minTimeAggrResult2.updateResultFromStatistics(statistics2);\n     finalResult.merge(minTimeAggrResult1);\n     finalResult.merge(minTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)finalResult.getResult());\n+    Assert.assertEquals(2L, (long) finalResult.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     finalResult.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void countAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult countAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n     AggregateResult countAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.INT64);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.INT64);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODk3Mg==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500088972", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);", "author": "HTHou", "createdAt": "2020-10-06T08:16:45Z", "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -62,9 +62,9 @@ public void avgAggrResultTest() throws QueryProcessException, IOException {\n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\nindex 5efcb890f..cffedf3da 100644\n--- a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n+++ b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n\n@@ -36,138 +36,138 @@ public class AggregateResultTest {\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n     AggregateResult avgAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n-    statistics1.update(1L,1d);\n-    statistics1.update(2L,1d);\n-    statistics2.update(1L,2d);\n+    statistics1.update(1L, 1d);\n+    statistics1.update(2L, 1d);\n+    statistics2.update(1L, 2d);\n \n     avgAggrResult1.updateResultFromStatistics(statistics1);\n     avgAggrResult2.updateResultFromStatistics(statistics2);\n     avgAggrResult1.merge(avgAggrResult2);\n-    Assert.assertEquals(1.333d, (double)avgAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) avgAggrResult1.getResult(), 0.01);\n     Assert.assertEquals(3, ((AvgAggrResult) avgAggrResult1).getCnt());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     avgAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1.333d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult maxValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     maxValueAggrResult1.updateResultFromStatistics(statistics1);\n     maxValueAggrResult2.updateResultFromStatistics(statistics2);\n     maxValueAggrResult1.merge(maxValueAggrResult2);\n \n-    Assert.assertEquals(2d, (double)maxValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) maxValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n     AggregateResult maxTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     maxTimeAggrResult1.updateResultFromStatistics(statistics1);\n     maxTimeAggrResult2.updateResultFromStatistics(statistics2);\n     maxTimeAggrResult1.merge(maxTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)maxTimeAggrResult1.getResult());\n+    Assert.assertEquals(2L, (long) maxTimeAggrResult1.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxTimeAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void minValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult minValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult minValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     minValueAggrResult1.updateResultFromStatistics(statistics1);\n     minValueAggrResult2.updateResultFromStatistics(statistics2);\n     minValueAggrResult1.merge(minValueAggrResult2);\n \n-    Assert.assertEquals(1d, (double)minValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) minValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     minValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void minTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult finalResult = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(10L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     minTimeAggrResult1.updateResultFromStatistics(statistics1);\n     minTimeAggrResult2.updateResultFromStatistics(statistics2);\n     finalResult.merge(minTimeAggrResult1);\n     finalResult.merge(minTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)finalResult.getResult());\n+    Assert.assertEquals(2L, (long) finalResult.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     finalResult.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void countAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult countAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n     AggregateResult countAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.INT64);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.INT64);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4OTA4Mg==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500089082", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);", "author": "HTHou", "createdAt": "2020-10-06T08:16:54Z", "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -62,9 +62,9 @@ public void avgAggrResultTest() throws QueryProcessException, IOException {\n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n     AggregateResult maxValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "417e82f9ca81944787374acadeacc4b1c1fa808d", "chunk": "diff --git a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\nindex 5efcb890f..cffedf3da 100644\n--- a/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n+++ b/server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java\n\n@@ -36,138 +36,138 @@ public class AggregateResultTest {\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n     AggregateResult avgAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n-    statistics1.update(1L,1d);\n-    statistics1.update(2L,1d);\n-    statistics2.update(1L,2d);\n+    statistics1.update(1L, 1d);\n+    statistics1.update(2L, 1d);\n+    statistics2.update(1L, 2d);\n \n     avgAggrResult1.updateResultFromStatistics(statistics1);\n     avgAggrResult2.updateResultFromStatistics(statistics2);\n     avgAggrResult1.merge(avgAggrResult2);\n-    Assert.assertEquals(1.333d, (double)avgAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) avgAggrResult1.getResult(), 0.01);\n     Assert.assertEquals(3, ((AvgAggrResult) avgAggrResult1).getCnt());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     avgAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1.333d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1.333d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult maxValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     maxValueAggrResult1.updateResultFromStatistics(statistics1);\n     maxValueAggrResult2.updateResultFromStatistics(statistics2);\n     maxValueAggrResult1.merge(maxValueAggrResult2);\n \n-    Assert.assertEquals(2d, (double)maxValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) maxValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(2d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void maxTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n     AggregateResult maxTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MAX_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     maxTimeAggrResult1.updateResultFromStatistics(statistics1);\n     maxTimeAggrResult2.updateResultFromStatistics(statistics2);\n     maxTimeAggrResult1.merge(maxTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)maxTimeAggrResult1.getResult());\n+    Assert.assertEquals(2L, (long) maxTimeAggrResult1.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     maxTimeAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void minValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult minValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n     AggregateResult minValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_VALUE, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(1L, 1d);\n-    statistics2.update(1L,2d);\n+    statistics2.update(1L, 2d);\n \n     minValueAggrResult1.updateResultFromStatistics(statistics1);\n     minValueAggrResult2.updateResultFromStatistics(statistics2);\n     minValueAggrResult1.merge(minValueAggrResult2);\n \n-    Assert.assertEquals(1d, (double)minValueAggrResult1.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) minValueAggrResult1.getResult(), 0.01);\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     minValueAggrResult1.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(1d, (double)result.getResult(), 0.01);\n+    Assert.assertEquals(1d, (double) result.getResult(), 0.01);\n   }\n \n   @Test\n   public void minTimeAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult finalResult = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n     AggregateResult minTimeAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE,true);\n+        .getAggrResultByName(SQLConstant.MIN_TIME, TSDataType.DOUBLE, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.DOUBLE);\n     statistics1.update(10L, 1d);\n-    statistics2.update(2L,1d);\n+    statistics2.update(2L, 1d);\n \n     minTimeAggrResult1.updateResultFromStatistics(statistics1);\n     minTimeAggrResult2.updateResultFromStatistics(statistics2);\n     finalResult.merge(minTimeAggrResult1);\n     finalResult.merge(minTimeAggrResult2);\n \n-    Assert.assertEquals(2L, (long)finalResult.getResult());\n+    Assert.assertEquals(2L, (long) finalResult.getResult());\n \n     ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n     finalResult.serializeTo(outputStream);\n     ByteBuffer byteBuffer = ByteBuffer.wrap(outputStream.toByteArray());\n     AggregateResult result = AggregateResult.deserializeFrom(byteBuffer);\n-    Assert.assertEquals(2L, (long)result.getResult());\n+    Assert.assertEquals(2L, (long) result.getResult());\n   }\n \n   @Test\n   public void countAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult countAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n     AggregateResult countAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64,true);\n+        .getAggrResultByName(SQLConstant.COUNT, TSDataType.INT64, true);\n \n     Statistics statistics1 = Statistics.getStatsByType(TSDataType.INT64);\n     Statistics statistics2 = Statistics.getStatsByType(TSDataType.INT64);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5NDU3NQ==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500094575", "bodyText": "Change to < here?", "author": "HTHou", "createdAt": "2020-10-06T08:25:22Z", "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/read/filter/GroupByFilter.java", "diffHunk": "@@ -65,7 +65,7 @@ public boolean satisfyStartEndTime(long startTime, long endTime) {\n       return false;\n     else if (startTime <= this.startTime)\n       return true;", "originalCommit": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk0OTM3Mw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500949373", "bodyText": "I think it's <= here. @JackieTien97", "author": "Alima777", "createdAt": "2020-10-07T11:51:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5NDU3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTI2Mw==", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r501401263", "bodyText": "Yes, you're right.", "author": "HTHou", "createdAt": "2020-10-08T01:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5NDU3NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "417e82f9ca81944787374acadeacc4b1c1fa808d", "url": "https://github.com/apache/iotdb/commit/417e82f9ca81944787374acadeacc4b1c1fa808d", "message": "fix based on review", "committedDate": "2020-10-07T11:52:06Z", "type": "commit"}, {"oid": "d7c39d0396c67614bf53ea00bef143d033d24405", "url": "https://github.com/apache/iotdb/commit/d7c39d0396c67614bf53ea00bef143d033d24405", "message": "merge master", "committedDate": "2020-10-10T04:06:55Z", "type": "commit"}, {"oid": "dcaa37b5ff53062bb93a73b4dc97a3c94a6f6acd", "url": "https://github.com/apache/iotdb/commit/dcaa37b5ff53062bb93a73b4dc97a3c94a6f6acd", "message": "fix merge bug", "committedDate": "2020-10-11T06:56:59Z", "type": "commit"}, {"oid": "8f0374418e740afcac26f6128ea1c658aa14e835", "url": "https://github.com/apache/iotdb/commit/8f0374418e740afcac26f6128ea1c658aa14e835", "message": "fix conflict", "committedDate": "2020-10-22T12:14:59Z", "type": "commit"}, {"oid": "de1cf147d51e99bb5d39d2c5c8f7ec63d62987da", "url": "https://github.com/apache/iotdb/commit/de1cf147d51e99bb5d39d2c5c8f7ec63d62987da", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization", "committedDate": "2020-10-22T12:15:34Z", "type": "commit"}]}