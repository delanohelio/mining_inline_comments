{"pr_number": 1146, "pr_title": "[IOTDB-635]Added workaround when doing Aggregation over boolean Series.", "pr_createdAt": "2020-05-02T07:48:20Z", "pr_url": "https://github.com/apache/iotdb/pull/1146", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNzM1MQ==", "url": "https://github.com/apache/iotdb/pull/1146#discussion_r418927351", "bodyText": "how about empty List?", "author": "jixuan1989", "createdAt": "2020-05-02T07:50:36Z", "path": "grafana/src/main/java/org/apache/iotdb/web/grafana/dao/impl/BasicDaoImpl.java", "diffHunk": "@@ -98,8 +98,28 @@ public Object doInConnection(Connection connection) throws SQLException {\n     return (List<String>) jdbcTemplate.execute(connectionCallback);\n   }\n \n+  /**\n+   * Note: If the query fails this could be due to AGGREGATIION like AVG on booleayn field.\n+   * Thus, we then do a retry with FIRST aggregation.\n+   * This should be solved better in the long run.\n+   */\n   @Override\n   public List<TimeValues> querySeries(String s, Pair<ZonedDateTime, ZonedDateTime> timeRange) {\n+    try {\n+      return querySeriesInternal(s, timeRange, function);\n+    } catch (Exception e) {\n+      logger.info(\"Execution failed, trying now with FIRST Function!\");\n+      // Try it with FIRST\n+      try {\n+        return querySeriesInternal(s, timeRange, \"FIRST\");\n+      } catch (Exception e2) {\n+        logger.warn(\"Even FIRST query did not succeed, returning NULL now\", e2);\n+        return null;", "originalCommit": "a1c2b782c59cfdc7b1cdd5cf08c152bee55603bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzMTQ2Nw==", "url": "https://github.com/apache/iotdb/pull/1146#discussion_r418931467", "bodyText": "+1, done", "author": "JulianFeinauer", "createdAt": "2020-05-02T08:35:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNzM1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "abc9dc54248568e7fa45d4f61eed3b14db6bfb99", "chunk": "diff --git a/grafana/src/main/java/org/apache/iotdb/web/grafana/dao/impl/BasicDaoImpl.java b/grafana/src/main/java/org/apache/iotdb/web/grafana/dao/impl/BasicDaoImpl.java\nindex d1574d8370..dde404ffe6 100644\n--- a/grafana/src/main/java/org/apache/iotdb/web/grafana/dao/impl/BasicDaoImpl.java\n+++ b/grafana/src/main/java/org/apache/iotdb/web/grafana/dao/impl/BasicDaoImpl.java\n\n@@ -111,10 +114,10 @@ public class BasicDaoImpl implements BasicDao {\n       logger.info(\"Execution failed, trying now with FIRST Function!\");\n       // Try it with FIRST\n       try {\n-        return querySeriesInternal(s, timeRange, \"FIRST\");\n+        return querySeriesInternal(s, timeRange, FALLBACK_AGG_FUNCTION);\n       } catch (Exception e2) {\n         logger.warn(\"Even FIRST query did not succeed, returning NULL now\", e2);\n-        return null;\n+        return Collections.emptyList();\n       }\n     }\n   }\n"}}, {"oid": "abc9dc54248568e7fa45d4f61eed3b14db6bfb99", "url": "https://github.com/apache/iotdb/commit/abc9dc54248568e7fa45d4f61eed3b14db6bfb99", "message": "Added workaround when doing Aggregation over boolean Series.", "committedDate": "2020-05-02T08:34:50Z", "type": "commit"}, {"oid": "abc9dc54248568e7fa45d4f61eed3b14db6bfb99", "url": "https://github.com/apache/iotdb/commit/abc9dc54248568e7fa45d4f61eed3b14db6bfb99", "message": "Added workaround when doing Aggregation over boolean Series.", "committedDate": "2020-05-02T08:34:50Z", "type": "forcePushed"}, {"oid": "a4d421d686ffab1e0e03770ab7b29858efee3d3b", "url": "https://github.com/apache/iotdb/commit/a4d421d686ffab1e0e03770ab7b29858efee3d3b", "message": "fix pentaho can not be downloaded because of spring.io address", "committedDate": "2020-05-02T12:23:21Z", "type": "commit"}, {"oid": "3dbeee622ff1a17e4b7ed5ec7a583eacd6f6be18", "url": "https://github.com/apache/iotdb/commit/3dbeee622ff1a17e4b7ed5ec7a583eacd6f6be18", "message": "Added workaround when doing Aggregation over boolean Series.", "committedDate": "2020-05-02T12:26:47Z", "type": "commit"}, {"oid": "ee2ccd57d45e254dde6c09bd97ca32541c042db5", "url": "https://github.com/apache/iotdb/commit/ee2ccd57d45e254dde6c09bd97ca32541c042db5", "message": "Merge branch 'bugfix/iotdb-grafana-boolean' of github.com:apache/incubator-iotdb into bugfix/iotdb-grafana-boolean", "committedDate": "2020-05-02T12:27:23Z", "type": "commit"}]}