{"pr_number": 1086, "pr_title": "update merge selector to filter close", "pr_createdAt": "2020-04-22T08:34:00Z", "pr_url": "https://github.com/apache/iotdb/pull/1086", "timeline": [{"oid": "27d38b1a48ba882fcace3ff1b1671715d7d121ed", "url": "https://github.com/apache/iotdb/commit/27d38b1a48ba882fcace3ff1b1671715d7d121ed", "message": "update merge selector to filter close", "committedDate": "2020-04-22T08:32:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5NzMxMA==", "url": "https://github.com/apache/iotdb/pull/1086#discussion_r412797310", "bodyText": "You may return here as soon as the unseqFile itself is found unclosed.", "author": "jt2594838", "createdAt": "2020-04-22T08:52:17Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/merge/selector/MaxFileMergeFileSelector.java", "diffHunk": "@@ -201,6 +201,17 @@ private void updateSelectedFiles(long newCost, TsFileResource unseqFile) {\n     }\n   }\n \n+  private boolean checkClosed(TsFileResource unseqFile) {\n+    boolean isClosed = unseqFile.isClosed();", "originalCommit": "27d38b1a48ba882fcace3ff1b1671715d7d121ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b2778914ee46203d85f39470df58c3368253d2e", "chunk": "diff --git a/server/src/main/java/org/apache/iotdb/db/engine/merge/selector/MaxFileMergeFileSelector.java b/server/src/main/java/org/apache/iotdb/db/engine/merge/selector/MaxFileMergeFileSelector.java\nindex a6da127668..74874e7eec 100644\n--- a/server/src/main/java/org/apache/iotdb/db/engine/merge/selector/MaxFileMergeFileSelector.java\n+++ b/server/src/main/java/org/apache/iotdb/db/engine/merge/selector/MaxFileMergeFileSelector.java\n\n@@ -203,6 +201,9 @@ public class MaxFileMergeFileSelector implements IMergeFileSelector {\n \n   private boolean checkClosed(TsFileResource unseqFile) {\n     boolean isClosed = unseqFile.isClosed();\n+    if (!isClosed) {\n+      return false;\n+    }\n     for (Integer seqIdx : tmpSelectedSeqFiles) {\n       if (!resource.getSeqFiles().get(seqIdx).isClosed()) {\n         isClosed = false;\n"}}, {"oid": "4b2778914ee46203d85f39470df58c3368253d2e", "url": "https://github.com/apache/iotdb/commit/4b2778914ee46203d85f39470df58c3368253d2e", "message": "update close", "committedDate": "2020-04-22T08:54:51Z", "type": "commit"}]}