{"pr_number": 1821, "pr_title": "[IOTDB-926] Support reconnection of Session", "pr_createdAt": "2020-10-12T10:23:22Z", "pr_url": "https://github.com/apache/iotdb/pull/1821", "timeline": [{"oid": "11b9ca862f4ffa1d99591c200e4295fb787ec2e2", "url": "https://github.com/apache/iotdb/commit/11b9ca862f4ffa1d99591c200e4295fb787ec2e2", "message": "add session retry", "committedDate": "2020-10-12T10:22:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIzMjA1Ng==", "url": "https://github.com/apache/iotdb/pull/1821#discussion_r503232056", "bodyText": "The reconnect() method will call the open() method again, would this cause an infinite loop\uff1f\nIf the open fails, I think we can just throw an exception, as next time the insert request came can call the reconnect() method.", "author": "neuyilan", "createdAt": "2020-10-12T11:31:49Z", "path": "session/src/main/java/org/apache/iotdb/session/Session.java", "diffHunk": "@@ -239,7 +244,15 @@ public void insertTablet(Tablet tablet, boolean sorted)\n     try {\n       RpcUtils.verifySuccess(client.insertTablet(request));\n     } catch (TException e) {\n-      throw new IoTDBConnectionException(e);\n+      if (reconnect()) {", "originalCommit": "11b9ca862f4ffa1d99591c200e4295fb787ec2e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ4MjQ4NQ==", "url": "https://github.com/apache/iotdb/pull/1821#discussion_r507482485", "bodyText": "It seems that the open() doesn't call the reconnect(), there won't be any infinite loops.", "author": "JackieTien97", "createdAt": "2020-10-19T05:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIzMjA1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwMzUyOA==", "url": "https://github.com/apache/iotdb/pull/1821#discussion_r507503528", "bodyText": "yeah, I read the code in the wrong place, it indeed does not have the problems.", "author": "neuyilan", "createdAt": "2020-10-19T06:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIzMjA1Ng=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIzNDUyOA==", "url": "https://github.com/apache/iotdb/pull/1821#discussion_r503234528", "bodyText": "RETRY_INTERVAL_MS?", "author": "neuyilan", "createdAt": "2020-10-12T11:36:39Z", "path": "session/src/main/java/org/apache/iotdb/session/Config.java", "diffHunk": "@@ -24,5 +24,6 @@\n   public static final String DEFAULT_PASSWORD = \"password\";\n   public static final int DEFAULT_FETCH_SIZE = 10000;\n   public static final int DEFAULT_TIMEOUT_MS = 0;\n-\n+  public static final int RETRY_NUM = 3;\n+  public static final long RETRY_INTERVAL = 1000;", "originalCommit": "11b9ca862f4ffa1d99591c200e4295fb787ec2e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ3NjEwOQ==", "url": "https://github.com/apache/iotdb/pull/1821#discussion_r507476109", "bodyText": "+1", "author": "qiaojialin", "createdAt": "2020-10-19T05:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIzNDUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY5Njk3NA==", "url": "https://github.com/apache/iotdb/pull/1821#discussion_r507696974", "bodyText": "fix", "author": "JackieTien97", "createdAt": "2020-10-19T12:14:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIzNDUyOA=="}], "type": "inlineReview", "revised_code": {"commit": "ffd9fa618f83aca9c00d8eaceebf8b7d02eac6c4", "chunk": "diff --git a/session/src/main/java/org/apache/iotdb/session/Config.java b/session/src/main/java/org/apache/iotdb/session/Config.java\nindex 067b8952c6..b7cfb24faf 100644\n--- a/session/src/main/java/org/apache/iotdb/session/Config.java\n+++ b/session/src/main/java/org/apache/iotdb/session/Config.java\n\n@@ -25,5 +25,5 @@ public class Config {\n   public static final int DEFAULT_FETCH_SIZE = 10000;\n   public static final int DEFAULT_TIMEOUT_MS = 0;\n   public static final int RETRY_NUM = 3;\n-  public static final long RETRY_INTERVAL = 1000;\n+  public static final long RETRY_INTERVAL_MS = 1000;\n }\n"}}, {"oid": "8a060fbd85f61827b9cdeeab9bc222e79b4e4784", "url": "https://github.com/apache/iotdb/commit/8a060fbd85f61827b9cdeeab9bc222e79b4e4784", "message": "add retry for query in session", "committedDate": "2020-10-19T07:32:44Z", "type": "commit"}, {"oid": "79d0e7b14343a37b27961ca5707b810c9aea478b", "url": "https://github.com/apache/iotdb/commit/79d0e7b14343a37b27961ca5707b810c9aea478b", "message": "Merge remote-tracking branch 'origin/master' into SessionRetry", "committedDate": "2020-10-19T07:32:47Z", "type": "commit"}, {"oid": "ffd9fa618f83aca9c00d8eaceebf8b7d02eac6c4", "url": "https://github.com/apache/iotdb/commit/ffd9fa618f83aca9c00d8eaceebf8b7d02eac6c4", "message": "rename", "committedDate": "2020-10-19T07:44:13Z", "type": "commit"}]}