{"pr_number": 2581, "pr_title": "Show pool/volume informations where possible", "pr_createdAt": "2020-09-08T15:47:40Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2581", "timeline": [{"oid": "5a2bd4cf5d14534d3af446e5d9efba8e946f124b", "url": "https://github.com/uyuni-project/uyuni/commit/5a2bd4cf5d14534d3af446e5d9efba8e946f124b", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output.", "committedDate": "2020-09-22T09:34:02Z", "type": "forcePushed"}, {"oid": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "url": "https://github.com/uyuni-project/uyuni/commit/81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device.", "committedDate": "2020-09-23T06:56:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEzNTMzNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r501135337", "bodyText": "Pattern is immutable so you could make it a static member of this class.", "author": "mateiw", "createdAt": "2020-10-07T16:08:11Z", "path": "java/code/src/com/suse/manager/virtualization/GuestDiskDef.java", "diffHunk": "@@ -216,6 +218,16 @@ else if (\"cdrom\".equals(disk.getDevice())) {\n                         source.put(\"file\", info.getFile());\n                     }\n                 }\n+                else if (Arrays.asList(\"block\", \"file\").contains(disk.getType())) {\n+                    Pattern regex = Pattern.compile(\"([^/]+)/([^/]+)\");", "originalCommit": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUwODUxNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r501508517", "bodyText": "done. Thanks for the suggestion", "author": "cbosdo", "createdAt": "2020-10-08T07:37:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEzNTMzNw=="}], "type": "inlineReview", "revised_code": {"commit": "b3b2aa92a1f42d1b8975bed5407e624cebc06716", "chunk": "diff --git a/java/code/src/com/suse/manager/virtualization/GuestDiskDef.java b/java/code/src/com/suse/manager/virtualization/GuestDiskDef.java\nindex c2404188f42..65dc81997a8 100644\n--- a/java/code/src/com/suse/manager/virtualization/GuestDiskDef.java\n+++ b/java/code/src/com/suse/manager/virtualization/GuestDiskDef.java\n\n@@ -219,8 +220,7 @@ public class GuestDiskDef {\n                     }\n                 }\n                 else if (Arrays.asList(\"block\", \"file\").contains(disk.getType())) {\n-                    Pattern regex = Pattern.compile(\"([^/]+)/([^/]+)\");\n-                    Matcher matcher = regex.matcher(info.getFile());\n+                    Matcher matcher = BLOCK_REGEX.matcher(info.getFile());\n                     if (matcher.matches()) {\n                         disk.setType(\"volume\");\n                         source.clear();\n"}}, {"oid": "b3b2aa92a1f42d1b8975bed5407e624cebc06716", "url": "https://github.com/uyuni-project/uyuni/commit/b3b2aa92a1f42d1b8975bed5407e624cebc06716", "message": "fixup! Show pool/volume informations where possible", "committedDate": "2020-10-08T07:20:33Z", "type": "forcePushed"}, {"oid": "f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "url": "https://github.com/uyuni-project/uyuni/commit/f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device.", "committedDate": "2020-10-26T15:34:02Z", "type": "forcePushed"}, {"oid": "2104ab302b2e6ca24dece6dcc6a7f28a2af775c7", "url": "https://github.com/uyuni-project/uyuni/commit/2104ab302b2e6ca24dece6dcc6a7f28a2af775c7", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output.", "committedDate": "2020-10-27T13:23:35Z", "type": "commit"}, {"oid": "d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "url": "https://github.com/uyuni-project/uyuni/commit/d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T13:23:35Z", "type": "forcePushed"}, {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e", "url": "https://github.com/uyuni-project/uyuni/commit/cd68217da22a868fb1d2ab25c5212055324b340e", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T13:42:10Z", "type": "forcePushed"}, {"oid": "a29f90b08bbdec839777808d663e8c3804bf565e", "url": "https://github.com/uyuni-project/uyuni/commit/a29f90b08bbdec839777808d663e8c3804bf565e", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device.", "committedDate": "2020-10-27T15:08:15Z", "type": "commit"}, {"oid": "c66f519de2966d80cd4bf5660408a0b8180c3b8b", "url": "https://github.com/uyuni-project/uyuni/commit/c66f519de2966d80cd4bf5660408a0b8180c3b8b", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T15:08:15Z", "type": "commit"}, {"oid": "c66f519de2966d80cd4bf5660408a0b8180c3b8b", "url": "https://github.com/uyuni-project/uyuni/commit/c66f519de2966d80cd4bf5660408a0b8180c3b8b", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T15:08:15Z", "type": "forcePushed"}]}