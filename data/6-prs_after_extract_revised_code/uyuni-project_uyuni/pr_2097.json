{"pr_number": 2097, "pr_title": "Fix sp migration without target product", "pr_createdAt": "2020-04-04T14:25:39Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2097", "timeline": [{"oid": "6cc420f1b0f2b648103a4a24d50bc60d25cd1528", "url": "https://github.com/uyuni-project/uyuni/commit/6cc420f1b0f2b648103a4a24d50bc60d25cd1528", "message": "remove incompatible migration targets in XMLRPC", "committedDate": "2020-04-06T12:34:28Z", "type": "forcePushed"}, {"oid": "3165e07be19b810db4d847dbf6caeff87e5d4025", "url": "https://github.com/uyuni-project/uyuni/commit/3165e07be19b810db4d847dbf6caeff87e5d4025", "message": "skip and show migration targets which do not have a successor for all installed extension products (bsc#1168227)", "committedDate": "2020-04-07T09:02:53Z", "type": "commit"}, {"oid": "a2bb93b60e07b4a521b36b2a32db84d793f3941a", "url": "https://github.com/uyuni-project/uyuni/commit/a2bb93b60e07b4a521b36b2a32db84d793f3941a", "message": "unit tests: test LTSS not available in the migration target", "committedDate": "2020-04-07T09:02:53Z", "type": "commit"}, {"oid": "2f1cd091a6e148f9da170560d3023e5519a27f18", "url": "https://github.com/uyuni-project/uyuni/commit/2f1cd091a6e148f9da170560d3023e5519a27f18", "message": "update changelog", "committedDate": "2020-04-07T09:03:22Z", "type": "commit"}, {"oid": "63252d4597e4df53e89a496c3653927387150192", "url": "https://github.com/uyuni-project/uyuni/commit/63252d4597e4df53e89a496c3653927387150192", "message": "quartz moved to Uyuni:Other", "committedDate": "2020-04-07T09:03:22Z", "type": "commit"}, {"oid": "63252d4597e4df53e89a496c3653927387150192", "url": "https://github.com/uyuni-project/uyuni/commit/63252d4597e4df53e89a496c3653927387150192", "message": "quartz moved to Uyuni:Other", "committedDate": "2020-04-07T09:03:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNjY3MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2097#discussion_r404836670", "bodyText": "You can pass the installedProducts directly, not via an optional (the only thing that's done via the optional is get() in this method).", "author": "hustodemon", "createdAt": "2020-04-07T14:06:52Z", "path": "java/code/src/com/redhat/rhn/manager/distupgrade/DistUpgradeManager.java", "diffHunk": "@@ -695,4 +697,42 @@ public static Long scheduleDistUpgrade(User user, Server server,\n         // Return the ID of the scheduled action\n         return ActionManager.scheduleDistUpgrade(user, server, details, earliest).getId();\n     }\n+\n+    /**\n+     * Remove incompatible migration targets compared to the installed products.\n+     * Write the failed products in the missingSuccesorExtensions set in case it should\n+     * be shown somewhere.\n+     *\n+     * @param installedProducts Optional set of the installed products\n+     * @param allMigrationTargets all calculated migration targets\n+     * @param missingSuccessorExtensions OUT: info about installed extensions missing a successor\n+     * @return list of valid migration targets\n+     */\n+    public static List<SUSEProductSet> removeIncompatibleTargets(Optional<SUSEProductSet> installedProducts,", "originalCommit": "3165e07be19b810db4d847dbf6caeff87e5d4025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg0NzQyOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2097#discussion_r404847429", "bodyText": "Right, where we call it we have it as optional value. Somebody refactored in the past the code to have installedProducts as Optional. So I keep compatibility.", "author": "mcalmer", "createdAt": "2020-04-07T14:20:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNjY3MA=="}], "type": "inlineReview", "revised_code": null}]}