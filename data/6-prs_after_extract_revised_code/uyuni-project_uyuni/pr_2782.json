{"pr_number": 2782, "pr_title": "Only update the kickstart path in cobbler if necessary (bsc#1175216)", "pr_createdAt": "2020-10-30T16:06:34Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2782", "timeline": [{"oid": "16f572644dd5792e3bef2787622930ce8f8ce122", "url": "https://github.com/uyuni-project/uyuni/commit/16f572644dd5792e3bef2787622930ce8f8ce122", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)", "committedDate": "2020-10-31T07:14:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Nzc5MTU4MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2782#discussion_r597791581", "bodyText": "Is the double \"cobbler\" an oversight?", "author": "agraul", "createdAt": "2021-03-19T15:55:05Z", "path": "java/code/src/com/redhat/rhn/manager/kickstart/cobbler/CobblerProfileSyncCommand.java", "diffHunk": "@@ -152,25 +154,35 @@ private void syncProfileToSpacewalk(Map cobblerProfile, KickstartData profile) {\n         }\n \n         //Now re-set the filename in case someone set it incorrectly\n-        try {\n-        String handle = (String) invokeXMLRPC(\"get_profile_handle\",\n-                cobblerProfile.get(\"name\"), xmlRpcToken);\n-        invokeXMLRPC(\"modify_profile\", handle, \"kickstart\", profile.buildCobblerFileName(),\n-                xmlRpcToken);\n-        invokeXMLRPC(\"save_profile\", handle, xmlRpcToken);\n-\n-        //Lets update the modified date just to make sure\n-        profile.setModified(new Date());\n-        }\n-        catch (RuntimeException re) {\n-            if (re.getCause() instanceof XmlRpcFault) {\n-                XmlRpcFault xrf = (XmlRpcFault)re.getCause();\n-                if (xrf.getMessage().contains(\"unknown profile name\")) {\n-                    log.error(\"Cobbler doesn't know about this profile any more!\");\n-                }\n+        Path kickstartPath = Path.of(\n+                ConfigDefaults.get().getKickstartConfigDir(),\n+                cobblerProfile.get(\"kickstart\").toString()\n+        );\n+        String cobblerKickstartFileName = profile.buildCobblerFileName();\n+        if (!Path.of(cobblerKickstartFileName).equals(kickstartPath)) {\n+            try {\n+                log.info(String.format(\"Updating cobbler cobbler profile, setting 'kickstart' to: %s\",", "originalCommit": "16f572644dd5792e3bef2787622930ce8f8ce122", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU4NjUyMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2782#discussion_r598586520", "bodyText": "Yes, it is!", "author": "brejoc", "createdAt": "2021-03-22T10:18:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Nzc5MTU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODg4Mjk1Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/2782#discussion_r598882953", "bodyText": "Fixed. thanks!", "author": "hustodemon", "createdAt": "2021-03-22T16:31:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Nzc5MTU4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "chunk": "diff --git a/java/code/src/com/redhat/rhn/manager/kickstart/cobbler/CobblerProfileSyncCommand.java b/java/code/src/com/redhat/rhn/manager/kickstart/cobbler/CobblerProfileSyncCommand.java\nindex 1c00ff1a5da..f91218c915e 100644\n--- a/java/code/src/com/redhat/rhn/manager/kickstart/cobbler/CobblerProfileSyncCommand.java\n+++ b/java/code/src/com/redhat/rhn/manager/kickstart/cobbler/CobblerProfileSyncCommand.java\n\n@@ -161,7 +160,7 @@ public class CobblerProfileSyncCommand extends CobblerCommand {\n         String cobblerKickstartFileName = profile.buildCobblerFileName();\n         if (!Path.of(cobblerKickstartFileName).equals(kickstartPath)) {\n             try {\n-                log.info(String.format(\"Updating cobbler cobbler profile, setting 'kickstart' to: %s\",\n+                log.info(String.format(\"Updating cobbler profile, setting 'kickstart' to: %s\",\n                         cobblerKickstartFileName));\n                 String handle = (String) invokeXMLRPC(\"get_profile_handle\",\n                         cobblerProfile.get(\"name\"), xmlRpcToken);\n"}}, {"oid": "8b612605f24db46961e195c23f1db37f1171dd95", "url": "https://github.com/uyuni-project/uyuni/commit/8b612605f24db46961e195c23f1db37f1171dd95", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)", "committedDate": "2021-03-22T16:30:04Z", "type": "forcePushed"}, {"oid": "6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "url": "https://github.com/uyuni-project/uyuni/commit/6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)", "committedDate": "2021-03-22T16:30:58Z", "type": "commit"}, {"oid": "6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "url": "https://github.com/uyuni-project/uyuni/commit/6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)", "committedDate": "2021-03-22T16:30:58Z", "type": "forcePushed"}]}