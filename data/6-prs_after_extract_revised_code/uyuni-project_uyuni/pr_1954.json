{"pr_number": 1954, "pr_title": "Modularisation Part1", "pr_createdAt": "2020-02-25T14:54:01Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/1954", "timeline": [{"oid": "0cf3201d280b5542d576c6cfbfc7724edfe266ad", "url": "https://github.com/uyuni-project/uyuni/commit/0cf3201d280b5542d576c6cfbfc7724edfe266ad", "message": "fix checkstyle", "committedDate": "2020-02-25T15:53:06Z", "type": "forcePushed"}, {"oid": "519203444cc1d117c9e75ea4cb6e86b6e749d89e", "url": "https://github.com/uyuni-project/uyuni/commit/519203444cc1d117c9e75ea4cb6e86b6e749d89e", "message": "fix checkstyle", "committedDate": "2020-02-25T16:00:33Z", "type": "forcePushed"}, {"oid": "97d6bdc578a20c5f9085c9ad951a96bfc9af5f73", "url": "https://github.com/uyuni-project/uyuni/commit/97d6bdc578a20c5f9085c9ad951a96bfc9af5f73", "message": "fix tests", "committedDate": "2020-02-27T17:13:54Z", "type": "forcePushed"}, {"oid": "02ee5b51cd31049b0a05354d5e76691e8de1976d", "url": "https://github.com/uyuni-project/uyuni/commit/02ee5b51cd31049b0a05354d5e76691e8de1976d", "message": "fix tests", "committedDate": "2020-02-28T17:33:53Z", "type": "forcePushed"}, {"oid": "18646cb39d39262f847ccedfe1a546157274f4c2", "url": "https://github.com/uyuni-project/uyuni/commit/18646cb39d39262f847ccedfe1a546157274f4c2", "message": "fix tests", "committedDate": "2020-03-02T12:53:31Z", "type": "forcePushed"}, {"oid": "8efbf8623750c492415037e31914d25643648293", "url": "https://github.com/uyuni-project/uyuni/commit/8efbf8623750c492415037e31914d25643648293", "message": "fix tests", "committedDate": "2020-03-02T16:17:55Z", "type": "forcePushed"}, {"oid": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "url": "https://github.com/uyuni-project/uyuni/commit/c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "message": "fix checkstyle", "committedDate": "2020-03-04T10:20:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1ODk0Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387158946", "bodyText": "As SystemQuery is defining an interface, should it really reside in the impl package? Could we maybe come up with a better package structure right from the beginning, or was it done on purpose?", "author": "renner", "createdAt": "2020-03-03T16:56:24Z", "path": "java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/**\n+ * Copyright (c) 2016 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.impl;", "originalCommit": "8efbf8623750c492415037e31914d25643648293", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY1NTc1MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387655750", "bodyText": "yeah its not the right place i just did not move it yet since i created the file. I would actually even like to move it out of webui since there is already so much stuff in there that does not belong there. You have an idea where it would fit because i currently don't see any place that makes direct sense.", "author": "lucidd", "createdAt": "2020-03-04T13:11:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1ODk0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NzAzNw==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387797037", "bodyText": "How would you imagine the package structure to look like eventually, or if we started from scratch? I guess it should reflect the architecture somehow, which is currently more true for the com.redhat packages as for the com.suse ones. There is the manager subpackage, but SystemQuery is a service interface. What exactly is the difference between a *Manager class and a *Service? Will we need both services and manager classes in the future?\nWe won't answer these questions here, but we should start thinking about concrete next steps to move towards a better overall structure. For now what about creating a services.iface subpackage and move it there? Then with another PR we could move the whole services package out of webui. This is just a suggestion, other ideas are welcome of course.", "author": "renner", "createdAt": "2020-03-04T16:49:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1ODk0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTQ3Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r388395477", "bodyText": "i moved it to  services.iface for now. i guess the package structure has to be its own topic once we decide to tackle it.", "author": "lucidd", "createdAt": "2020-03-05T16:07:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1ODk0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\nindex f8e70f26797..34bc4ebd287 100644\n--- a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n+++ b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n\n@@ -45,59 +45,286 @@ import java.util.Optional;\n import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.CompletionStage;\n \n+/**\n+ * Interface containing methods for directly interacting and getting information from\n+ * a system.\n+ * Note: This interface should be split up further at some point.\n+ */\n public interface SystemQuery {\n \n+    /**\n+     * Query virtual host and domains capabilities.\n+     *\n+     * @param minionId the salt minion virtual host to ask about\n+     * @return the output of the salt virt.all_capabilities call in JSON\n+     */\n     Optional<Map<String, JsonElement>> getCapabilities(String minionId);\n \n+    /**\n+     * Query the list of virtual networks defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a list of the network names\n+     */\n     Map<String, JsonElement> getNetworks(String minionId);\n \n+    /**\n+     * Query virtual machine definition\n+     *\n+     * @param minionId the host minion ID\n+     * @param domainName the domain name to look for\n+     * @return the XML definition or an empty Optional\n+     */\n     Optional<GuestDefinition> getGuestDefinition(String minionId, String domainName);\n \n+    /**\n+     * call salt test.ping\n+     * @param minionId id of the target minion\n+     * @return true\n+     */\n     Optional<Boolean> ping(String minionId);\n \n+    /**\n+     * Get the minion keys from salt with their respective status.\n+     *\n+     * @return the keys with their respective status as returned from salt\n+     */\n     Key.Names getKeys();\n+\n+    /**\n+     * For a given minion id check if there is a key in any of the given status. If no status is given as parameter,\n+     * all the available status are considered.\n+     *\n+     * @param id the id to check for\n+     * @param statusIn array of key status to consider\n+     * @return true if there is a key with the given id, false otherwise\n+     */\n     boolean keyExists(String id, SaltService.KeyStatus... statusIn);\n+\n+    /**\n+     * Get the minion keys from salt with their respective status and fingerprint.\n+     *\n+     * @return the keys with their respective status and fingerprint as returned from salt\n+     */\n     Key.Fingerprints getFingerprints();\n+\n+    /**\n+     * Generate a key pair for the given id and accept the public key.\n+     *\n+     * @param id the id to use\n+     * @param force set true to overwrite an already existing key\n+     * @return the generated key pair\n+     */\n     Key.Pair generateKeysAndAccept(String id, boolean force);\n+\n+    /**\n+     * Get the machine id for a given minion.\n+     *\n+     * @param minionId id of the target minion\n+     * @return the machine id as a string\n+     */\n     Optional<String> getMachineId(String minionId);\n+\n+    /**\n+     * Delete a given minion's key.\n+     *\n+     * @param minionId id of the minion\n+     */\n     void deleteKey(String minionId);\n+\n+    /**\n+     * Accept all keys matching the given pattern\n+     *\n+     * @param match a pattern for minion ids\n+     */\n     void acceptKey(String match);\n+\n+    /**\n+     * Reject a given minion's key.\n+     *\n+     * @param minionId id of the minion\n+     */\n     void rejectKey(String minionId);\n+\n+    /**\n+     * Delete a Salt key from the \"Rejected Keys\" category using the mgrutil runner.\n+     *\n+     * @param minionId the minionId to look for in \"Rejected Keys\"\n+     * @return the result of the runner call as a map\n+     */\n     Optional<MgrUtilRunner.ExecResult> deleteRejectedKey(String minionId);\n+\n+    /**\n+     * Return the stream of events happening in salt.\n+     *\n+     * @return the event stream\n+     * @throws SaltException exception occured during connection (if any)\n+     */\n     EventStream getEventStream() throws SaltException;\n+\n+    /**\n+     * Run a remote command on a given minion.\n+     *\n+     * @param target the target\n+     * @param cmd the command\n+     * @return the output of the command\n+     */\n     Map<String, Result<String>> runRemoteCommand(MinionList target, String cmd);\n+\n+    /**\n+     * Run a remote command on a given minion asynchronously.\n+     * @param target the target\n+     * @param cmd the command to execute\n+     * @param cancel a future used to cancel waiting on return events\n+     * @return a map holding a {@link CompletionStage}s for each minion\n+     */\n     Map<String, CompletionStage<Result<String>>> runRemoteCommandAsync(\n             MinionList target, String cmd, CompletableFuture<GenericError> cancel);\n \n+    /**\n+     * Query the list of virtual storage pools defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a map associating pool names with their informations as Json elements\n+     */\n     Map<String, JsonElement> getPools(String minionId);\n \n+    /**\n+     * Query the list of virtual storage volumes defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a map associating pool names with the list of volumes it contains mapped by their names\n+     */\n     Map<String, Map<String, JsonElement>> getVolumes(String minionId);\n \n+    /**\n+     * Returns the currently running jobs on the target\n+     *\n+     * @param target the target\n+     * @return list of running jobs\n+     */\n     Map<String, Result<List<SaltUtil.RunningInfo>>> running(MinionList target);\n+\n+    /**\n+     * Return the result for a jobId\n+     *\n+     * @param jid the job id\n+     * @return map from minion to result\n+     */\n     Optional<Jobs.Info> listJob(String jid);\n \n+    /**\n+     * Match the given target expression asynchronously.\n+     * @param target the target expression\n+     * @param cancel  a future used to cancel waiting on return events\n+     * @return a map holding a {@link CompletionStage}s for each minion\n+     */\n     Map<String, CompletionStage<Result<Boolean>>> matchAsync(\n             String target, CompletableFuture<GenericError> cancel);\n \n+    /**\n+     * Executes match.glob in another thread and returns a {@link CompletionStage}.\n+     * @param target the target to pass to match.glob\n+     * @param cancel a future used to cancel waiting\n+     * @return a future or Optional.empty if there's no ssh-push minion in the db\n+     */\n     Optional<CompletionStage<Map<String, Result<Boolean>>>> matchAsyncSSH(\n             String target, CompletableFuture<GenericError> cancel);\n \n+    /**\n+     * Call 'saltutil.refresh_pillar' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void refreshPillar(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_grains' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void syncGrains(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_modules' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void syncModules(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_all' to sync everything to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void syncAll(MinionList minionList);\n \n+    /**\n+     * Performs an test.echo on a target set of minions for checkIn purpose.\n+     * @param targetIn the target\n+     * @return the LocalAsyncResult of the test.echo call\n+     * @throws SaltException if we get a failure from Salt\n+     */\n     Optional<LocalAsyncResult<String>> checkIn(MinionList targetIn) throws SaltException;\n+\n+    /**\n+     * Apply util.systeminfo state on the specified minion list\n+     * @param minionTarget minion list\n+     */\n     void updateSystemInfo(MinionList minionTarget);\n+\n+    /**\n+     * Gets a minion's master hostname.\n+     *\n+     * @param minionId the minion id\n+     * @return the master hostname\n+     */\n     Optional<String> getMasterHostname(String minionId);\n \n+    /**\n+     * Bootstrap a system using salt-ssh.\n+     *\n+     * @param parameters - bootstrap parameters\n+     * @param bootstrapMods - state modules to be applied during the bootstrap\n+     * @param pillarData - pillar data used salt-ssh call\n+     * @throws SaltException if something goes wrong during command execution or\n+     * during manipulation the salt-ssh roster\n+     * @return the result of the underlying ssh call for given host\n+     */\n     Result<SSHResult<Map<String, State.ApplyResult>>> bootstrapMinion(\n             BootstrapParameters parameters, List<String> bootstrapMods,\n             Map<String, Object> pillarData) throws SaltException;\n \n-        Map<Boolean, String> storeMinionScapFiles(\n+    /**\n+     * Store the files uploaded by a minion to the SCAP storage directory.\n+     * @param minion the minion\n+     * @param uploadDir the uploadDir\n+     * @param actionId the action id\n+     * @return a map with one element: @{code true} -> scap store path,\n+     * {@code false} -> err message\n+     *\n+     */\n+    Map<Boolean, String> storeMinionScapFiles(\n             MinionServer minion, String uploadDir, Long actionId);\n+\n+    /**\n+     * Call the custom mgrutil.ssh_keygen runner if the key files are not present.\n+     *\n+     * @param path of the key files\n+     * @return the result of the runner call as a map\n+     */\n     Optional<MgrUtilRunner.ExecResult> generateSSHKey(String path);\n+\n+    /**\n+     * Chain ssh calls over one or more hops to run a command on the last host in the chain.\n+     * This calls the mgrutil.chain_ssh_command runner.\n+     *\n+     * @param hosts a list of hosts, where the last one is where\n+     *              the command will be executed\n+     * @param clientKey the ssh key to use to connect to the first host\n+     * @param proxyKey the ssh key path to use for the rest of the hosts\n+     * @param user the user\n+     * @param options ssh options\n+     * @param command the command to execute\n+     * @param outputfile the file to which to dump the command stdout\n+     * @return the execution result\n+     */\n     Optional<MgrUtilRunner.ExecResult> chainSSHCommand(List<String> hosts,\n         String clientKey,\n         String proxyKey,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE2Mjc0MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387162740", "bodyText": "We are at 2020 meanwhile.", "author": "renner", "createdAt": "2020-03-03T17:02:15Z", "path": "java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/**\n+ * Copyright (c) 2016 SUSE LLC", "originalCommit": "8efbf8623750c492415037e31914d25643648293", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\nindex f8e70f26797..34bc4ebd287 100644\n--- a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n+++ b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n\n@@ -45,59 +45,286 @@ import java.util.Optional;\n import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.CompletionStage;\n \n+/**\n+ * Interface containing methods for directly interacting and getting information from\n+ * a system.\n+ * Note: This interface should be split up further at some point.\n+ */\n public interface SystemQuery {\n \n+    /**\n+     * Query virtual host and domains capabilities.\n+     *\n+     * @param minionId the salt minion virtual host to ask about\n+     * @return the output of the salt virt.all_capabilities call in JSON\n+     */\n     Optional<Map<String, JsonElement>> getCapabilities(String minionId);\n \n+    /**\n+     * Query the list of virtual networks defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a list of the network names\n+     */\n     Map<String, JsonElement> getNetworks(String minionId);\n \n+    /**\n+     * Query virtual machine definition\n+     *\n+     * @param minionId the host minion ID\n+     * @param domainName the domain name to look for\n+     * @return the XML definition or an empty Optional\n+     */\n     Optional<GuestDefinition> getGuestDefinition(String minionId, String domainName);\n \n+    /**\n+     * call salt test.ping\n+     * @param minionId id of the target minion\n+     * @return true\n+     */\n     Optional<Boolean> ping(String minionId);\n \n+    /**\n+     * Get the minion keys from salt with their respective status.\n+     *\n+     * @return the keys with their respective status as returned from salt\n+     */\n     Key.Names getKeys();\n+\n+    /**\n+     * For a given minion id check if there is a key in any of the given status. If no status is given as parameter,\n+     * all the available status are considered.\n+     *\n+     * @param id the id to check for\n+     * @param statusIn array of key status to consider\n+     * @return true if there is a key with the given id, false otherwise\n+     */\n     boolean keyExists(String id, SaltService.KeyStatus... statusIn);\n+\n+    /**\n+     * Get the minion keys from salt with their respective status and fingerprint.\n+     *\n+     * @return the keys with their respective status and fingerprint as returned from salt\n+     */\n     Key.Fingerprints getFingerprints();\n+\n+    /**\n+     * Generate a key pair for the given id and accept the public key.\n+     *\n+     * @param id the id to use\n+     * @param force set true to overwrite an already existing key\n+     * @return the generated key pair\n+     */\n     Key.Pair generateKeysAndAccept(String id, boolean force);\n+\n+    /**\n+     * Get the machine id for a given minion.\n+     *\n+     * @param minionId id of the target minion\n+     * @return the machine id as a string\n+     */\n     Optional<String> getMachineId(String minionId);\n+\n+    /**\n+     * Delete a given minion's key.\n+     *\n+     * @param minionId id of the minion\n+     */\n     void deleteKey(String minionId);\n+\n+    /**\n+     * Accept all keys matching the given pattern\n+     *\n+     * @param match a pattern for minion ids\n+     */\n     void acceptKey(String match);\n+\n+    /**\n+     * Reject a given minion's key.\n+     *\n+     * @param minionId id of the minion\n+     */\n     void rejectKey(String minionId);\n+\n+    /**\n+     * Delete a Salt key from the \"Rejected Keys\" category using the mgrutil runner.\n+     *\n+     * @param minionId the minionId to look for in \"Rejected Keys\"\n+     * @return the result of the runner call as a map\n+     */\n     Optional<MgrUtilRunner.ExecResult> deleteRejectedKey(String minionId);\n+\n+    /**\n+     * Return the stream of events happening in salt.\n+     *\n+     * @return the event stream\n+     * @throws SaltException exception occured during connection (if any)\n+     */\n     EventStream getEventStream() throws SaltException;\n+\n+    /**\n+     * Run a remote command on a given minion.\n+     *\n+     * @param target the target\n+     * @param cmd the command\n+     * @return the output of the command\n+     */\n     Map<String, Result<String>> runRemoteCommand(MinionList target, String cmd);\n+\n+    /**\n+     * Run a remote command on a given minion asynchronously.\n+     * @param target the target\n+     * @param cmd the command to execute\n+     * @param cancel a future used to cancel waiting on return events\n+     * @return a map holding a {@link CompletionStage}s for each minion\n+     */\n     Map<String, CompletionStage<Result<String>>> runRemoteCommandAsync(\n             MinionList target, String cmd, CompletableFuture<GenericError> cancel);\n \n+    /**\n+     * Query the list of virtual storage pools defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a map associating pool names with their informations as Json elements\n+     */\n     Map<String, JsonElement> getPools(String minionId);\n \n+    /**\n+     * Query the list of virtual storage volumes defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a map associating pool names with the list of volumes it contains mapped by their names\n+     */\n     Map<String, Map<String, JsonElement>> getVolumes(String minionId);\n \n+    /**\n+     * Returns the currently running jobs on the target\n+     *\n+     * @param target the target\n+     * @return list of running jobs\n+     */\n     Map<String, Result<List<SaltUtil.RunningInfo>>> running(MinionList target);\n+\n+    /**\n+     * Return the result for a jobId\n+     *\n+     * @param jid the job id\n+     * @return map from minion to result\n+     */\n     Optional<Jobs.Info> listJob(String jid);\n \n+    /**\n+     * Match the given target expression asynchronously.\n+     * @param target the target expression\n+     * @param cancel  a future used to cancel waiting on return events\n+     * @return a map holding a {@link CompletionStage}s for each minion\n+     */\n     Map<String, CompletionStage<Result<Boolean>>> matchAsync(\n             String target, CompletableFuture<GenericError> cancel);\n \n+    /**\n+     * Executes match.glob in another thread and returns a {@link CompletionStage}.\n+     * @param target the target to pass to match.glob\n+     * @param cancel a future used to cancel waiting\n+     * @return a future or Optional.empty if there's no ssh-push minion in the db\n+     */\n     Optional<CompletionStage<Map<String, Result<Boolean>>>> matchAsyncSSH(\n             String target, CompletableFuture<GenericError> cancel);\n \n+    /**\n+     * Call 'saltutil.refresh_pillar' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void refreshPillar(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_grains' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void syncGrains(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_modules' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void syncModules(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_all' to sync everything to the target minion(s).\n+     * @param minionList minion list\n+     */\n     void syncAll(MinionList minionList);\n \n+    /**\n+     * Performs an test.echo on a target set of minions for checkIn purpose.\n+     * @param targetIn the target\n+     * @return the LocalAsyncResult of the test.echo call\n+     * @throws SaltException if we get a failure from Salt\n+     */\n     Optional<LocalAsyncResult<String>> checkIn(MinionList targetIn) throws SaltException;\n+\n+    /**\n+     * Apply util.systeminfo state on the specified minion list\n+     * @param minionTarget minion list\n+     */\n     void updateSystemInfo(MinionList minionTarget);\n+\n+    /**\n+     * Gets a minion's master hostname.\n+     *\n+     * @param minionId the minion id\n+     * @return the master hostname\n+     */\n     Optional<String> getMasterHostname(String minionId);\n \n+    /**\n+     * Bootstrap a system using salt-ssh.\n+     *\n+     * @param parameters - bootstrap parameters\n+     * @param bootstrapMods - state modules to be applied during the bootstrap\n+     * @param pillarData - pillar data used salt-ssh call\n+     * @throws SaltException if something goes wrong during command execution or\n+     * during manipulation the salt-ssh roster\n+     * @return the result of the underlying ssh call for given host\n+     */\n     Result<SSHResult<Map<String, State.ApplyResult>>> bootstrapMinion(\n             BootstrapParameters parameters, List<String> bootstrapMods,\n             Map<String, Object> pillarData) throws SaltException;\n \n-        Map<Boolean, String> storeMinionScapFiles(\n+    /**\n+     * Store the files uploaded by a minion to the SCAP storage directory.\n+     * @param minion the minion\n+     * @param uploadDir the uploadDir\n+     * @param actionId the action id\n+     * @return a map with one element: @{code true} -> scap store path,\n+     * {@code false} -> err message\n+     *\n+     */\n+    Map<Boolean, String> storeMinionScapFiles(\n             MinionServer minion, String uploadDir, Long actionId);\n+\n+    /**\n+     * Call the custom mgrutil.ssh_keygen runner if the key files are not present.\n+     *\n+     * @param path of the key files\n+     * @return the result of the runner call as a map\n+     */\n     Optional<MgrUtilRunner.ExecResult> generateSSHKey(String path);\n+\n+    /**\n+     * Chain ssh calls over one or more hops to run a command on the last host in the chain.\n+     * This calls the mgrutil.chain_ssh_command runner.\n+     *\n+     * @param hosts a list of hosts, where the last one is where\n+     *              the command will be executed\n+     * @param clientKey the ssh key to use to connect to the first host\n+     * @param proxyKey the ssh key path to use for the rest of the hosts\n+     * @param user the user\n+     * @param options ssh options\n+     * @param command the command to execute\n+     * @param outputfile the file to which to dump the command stdout\n+     * @return the execution result\n+     */\n     Optional<MgrUtilRunner.ExecResult> chainSSHCommand(List<String> hosts,\n         String clientKey,\n         String proxyKey,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2MDkwOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387560909", "bodyText": "Here (and in other parts of this patch) you suggest to keep the old variable name (saltService). Is this just for simplicity in terms of less changes? Should it eventually be systemQuery everywhere?", "author": "renner", "createdAt": "2020-03-04T10:00:55Z", "path": "java/code/src/com/suse/manager/webui/services/SaltServerActionService.java", "diffHunk": "@@ -201,11 +201,15 @@\n     private SaltActionChainGeneratorService saltActionChainGeneratorService =\n             SaltActionChainGeneratorService.INSTANCE;\n \n-    private SaltService saltService = SaltService.INSTANCE;\n+    private SystemQuery saltService;", "originalCommit": "8efbf8623750c492415037e31914d25643648293", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcyNDI0MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387724241", "bodyText": "i left it out to get the more important stuff done first. In the end it should have a name in line with the interface name which means it may actually change again or multiple times when spiting further or deciding on final names interface naming. I will change it for now anyway.", "author": "lucidd", "createdAt": "2020-03-04T15:03:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2MDkwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/SaltServerActionService.java b/java/code/src/com/suse/manager/webui/services/SaltServerActionService.java\nindex 9887312db82..b0f6a07fdb7 100644\n--- a/java/code/src/com/suse/manager/webui/services/SaltServerActionService.java\n+++ b/java/code/src/com/suse/manager/webui/services/SaltServerActionService.java\n\n@@ -206,8 +206,11 @@ public class SaltServerActionService {\n     private SaltUtils saltUtils = SaltUtils.INSTANCE;\n     private boolean skipCommandScriptPerms;\n \n-    public SaltServerActionService(SystemQuery systemQuery) {\n-        this.saltService = systemQuery;\n+    /**\n+     * @param systemQueryIn instance for getting information from a system.\n+     */\n+    public SaltServerActionService(SystemQuery systemQueryIn) {\n+        this.saltService = systemQueryIn;\n     }\n \n     private Action unproxy(Action entity) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwNDI4Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387604286", "bodyText": "Is SystemQuery actually the most appropriate name we can find for this new interface? I find the name suitable for most of the functionality, but for some of the methods it doesn't really fit, like generateSSHKey() or the ones related to key management on the master. I don't currently have a better name for suggestion, just wanted to raise it for discussion. Maybe there could even be a separate interface for things that just operate locally on another iteration, is that what you mean with \"split up further\"?", "author": "renner", "createdAt": "2020-03-04T11:22:41Z", "path": "java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java", "diffHunk": "@@ -0,0 +1,498 @@\n+/**\n+ * Copyright (c) 2016 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.impl;\n+\n+import com.google.gson.reflect.TypeToken;\n+import com.google.gson.JsonElement;\n+import com.redhat.rhn.domain.server.MinionServer;\n+import com.suse.manager.reactor.SaltReactor;\n+import com.suse.manager.virtualization.GuestDefinition;\n+import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n+import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n+import com.suse.manager.webui.utils.gson.BootstrapParameters;\n+import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n+import com.suse.salt.netapi.calls.LocalAsyncResult;\n+import com.suse.salt.netapi.calls.LocalCall;\n+import com.suse.salt.netapi.calls.modules.SaltUtil;\n+import com.suse.salt.netapi.calls.modules.State;\n+import com.suse.salt.netapi.calls.modules.Zypper;\n+import com.suse.salt.netapi.calls.runner.Jobs;\n+import com.suse.salt.netapi.calls.wheel.Key;\n+import com.suse.salt.netapi.datatypes.target.MinionList;\n+import com.suse.salt.netapi.datatypes.target.Target;\n+import com.suse.salt.netapi.errors.GenericError;\n+import com.suse.salt.netapi.event.EventStream;\n+import com.suse.salt.netapi.exception.SaltException;\n+import com.suse.salt.netapi.results.Result;\n+import com.suse.salt.netapi.results.SSHResult;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionStage;\n+\n+/**\n+ * Interface containing methods for directly interacting and getting information from\n+ * a system.\n+ * Note: This interface should be split up further at some point.\n+ */\n+public interface SystemQuery {", "originalCommit": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY0MTAxNA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387641014", "bodyText": "Yes that was the intention of splitting it further. Currently it contains all the methods we are using from SaltService but there is definitely different topics here that should go in their own interface. So far i'm thinking about splitting methods for general system information, salt specific methods like salt key handling etc, virtualization and a minimal low level salt interface for the salt backed implementations of those interfaces.", "author": "lucidd", "createdAt": "2020-03-04T12:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwNDI4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "eb9f69dafb50fce7c130edc71a107d639cc2287e", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\nindex 34bc4ebd287..e851209ff6a 100644\n--- a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n+++ b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n\n@@ -1,5 +1,5 @@\n /**\n- * Copyright (c) 2016 SUSE LLC\n+ * Copyright (c) 2020 SUSE LLC\n  *\n  * This software is licensed to you under the GNU General Public License,\n  * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwNTE0MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387605141", "bodyText": "The max line length is currently set to 120 characters (for checkstyle), so this should actually fit on a single line?", "author": "renner", "createdAt": "2020-03-04T11:24:45Z", "path": "java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java", "diffHunk": "@@ -0,0 +1,498 @@\n+/**\n+ * Copyright (c) 2016 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.impl;\n+\n+import com.google.gson.reflect.TypeToken;\n+import com.google.gson.JsonElement;\n+import com.redhat.rhn.domain.server.MinionServer;\n+import com.suse.manager.reactor.SaltReactor;\n+import com.suse.manager.virtualization.GuestDefinition;\n+import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n+import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n+import com.suse.manager.webui.utils.gson.BootstrapParameters;\n+import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n+import com.suse.salt.netapi.calls.LocalAsyncResult;\n+import com.suse.salt.netapi.calls.LocalCall;\n+import com.suse.salt.netapi.calls.modules.SaltUtil;\n+import com.suse.salt.netapi.calls.modules.State;\n+import com.suse.salt.netapi.calls.modules.Zypper;\n+import com.suse.salt.netapi.calls.runner.Jobs;\n+import com.suse.salt.netapi.calls.wheel.Key;\n+import com.suse.salt.netapi.datatypes.target.MinionList;\n+import com.suse.salt.netapi.datatypes.target.Target;\n+import com.suse.salt.netapi.errors.GenericError;\n+import com.suse.salt.netapi.event.EventStream;\n+import com.suse.salt.netapi.exception.SaltException;\n+import com.suse.salt.netapi.results.Result;\n+import com.suse.salt.netapi.results.SSHResult;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionStage;\n+\n+/**\n+ * Interface containing methods for directly interacting and getting information from\n+ * a system.", "originalCommit": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb9f69dafb50fce7c130edc71a107d639cc2287e", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\nindex 34bc4ebd287..e851209ff6a 100644\n--- a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n+++ b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n\n@@ -1,5 +1,5 @@\n /**\n- * Copyright (c) 2016 SUSE LLC\n+ * Copyright (c) 2020 SUSE LLC\n  *\n  * This software is licensed to you under the GNU General Public License,\n  * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwOTMxNA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r387609314", "bodyText": "This is really not important, but I would prefer if we would use a unified way of doing indentation. In this new interface we already use 3 different ways of indenting the arguments: 8 spaces after the method name (my least preferred one), 8 spaces starting from the beginning of the line and 4 spaces from the beginning of the line one argument per line. It would be a good opportunity now to use just one of those ways, at least throughout this new interface.", "author": "renner", "createdAt": "2020-03-04T11:33:39Z", "path": "java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java", "diffHunk": "@@ -0,0 +1,498 @@\n+/**\n+ * Copyright (c) 2016 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.impl;\n+\n+import com.google.gson.reflect.TypeToken;\n+import com.google.gson.JsonElement;\n+import com.redhat.rhn.domain.server.MinionServer;\n+import com.suse.manager.reactor.SaltReactor;\n+import com.suse.manager.virtualization.GuestDefinition;\n+import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n+import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n+import com.suse.manager.webui.utils.gson.BootstrapParameters;\n+import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n+import com.suse.salt.netapi.calls.LocalAsyncResult;\n+import com.suse.salt.netapi.calls.LocalCall;\n+import com.suse.salt.netapi.calls.modules.SaltUtil;\n+import com.suse.salt.netapi.calls.modules.State;\n+import com.suse.salt.netapi.calls.modules.Zypper;\n+import com.suse.salt.netapi.calls.runner.Jobs;\n+import com.suse.salt.netapi.calls.wheel.Key;\n+import com.suse.salt.netapi.datatypes.target.MinionList;\n+import com.suse.salt.netapi.datatypes.target.Target;\n+import com.suse.salt.netapi.errors.GenericError;\n+import com.suse.salt.netapi.event.EventStream;\n+import com.suse.salt.netapi.exception.SaltException;\n+import com.suse.salt.netapi.results.Result;\n+import com.suse.salt.netapi.results.SSHResult;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionStage;\n+\n+/**\n+ * Interface containing methods for directly interacting and getting information from\n+ * a system.\n+ * Note: This interface should be split up further at some point.\n+ */\n+public interface SystemQuery {\n+\n+    /**\n+     * Query virtual host and domains capabilities.\n+     *\n+     * @param minionId the salt minion virtual host to ask about\n+     * @return the output of the salt virt.all_capabilities call in JSON\n+     */\n+    Optional<Map<String, JsonElement>> getCapabilities(String minionId);\n+\n+    /**\n+     * Query the list of virtual networks defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a list of the network names\n+     */\n+    Map<String, JsonElement> getNetworks(String minionId);\n+\n+    /**\n+     * Query virtual machine definition\n+     *\n+     * @param minionId the host minion ID\n+     * @param domainName the domain name to look for\n+     * @return the XML definition or an empty Optional\n+     */\n+    Optional<GuestDefinition> getGuestDefinition(String minionId, String domainName);\n+\n+    /**\n+     * call salt test.ping\n+     * @param minionId id of the target minion\n+     * @return true\n+     */\n+    Optional<Boolean> ping(String minionId);\n+\n+    /**\n+     * Get the minion keys from salt with their respective status.\n+     *\n+     * @return the keys with their respective status as returned from salt\n+     */\n+    Key.Names getKeys();\n+\n+    /**\n+     * For a given minion id check if there is a key in any of the given status. If no status is given as parameter,\n+     * all the available status are considered.\n+     *\n+     * @param id the id to check for\n+     * @param statusIn array of key status to consider\n+     * @return true if there is a key with the given id, false otherwise\n+     */\n+    boolean keyExists(String id, SaltService.KeyStatus... statusIn);\n+\n+    /**\n+     * Get the minion keys from salt with their respective status and fingerprint.\n+     *\n+     * @return the keys with their respective status and fingerprint as returned from salt\n+     */\n+    Key.Fingerprints getFingerprints();\n+\n+    /**\n+     * Generate a key pair for the given id and accept the public key.\n+     *\n+     * @param id the id to use\n+     * @param force set true to overwrite an already existing key\n+     * @return the generated key pair\n+     */\n+    Key.Pair generateKeysAndAccept(String id, boolean force);\n+\n+    /**\n+     * Get the machine id for a given minion.\n+     *\n+     * @param minionId id of the target minion\n+     * @return the machine id as a string\n+     */\n+    Optional<String> getMachineId(String minionId);\n+\n+    /**\n+     * Delete a given minion's key.\n+     *\n+     * @param minionId id of the minion\n+     */\n+    void deleteKey(String minionId);\n+\n+    /**\n+     * Accept all keys matching the given pattern\n+     *\n+     * @param match a pattern for minion ids\n+     */\n+    void acceptKey(String match);\n+\n+    /**\n+     * Reject a given minion's key.\n+     *\n+     * @param minionId id of the minion\n+     */\n+    void rejectKey(String minionId);\n+\n+    /**\n+     * Delete a Salt key from the \"Rejected Keys\" category using the mgrutil runner.\n+     *\n+     * @param minionId the minionId to look for in \"Rejected Keys\"\n+     * @return the result of the runner call as a map\n+     */\n+    Optional<MgrUtilRunner.ExecResult> deleteRejectedKey(String minionId);\n+\n+    /**\n+     * Return the stream of events happening in salt.\n+     *\n+     * @return the event stream\n+     * @throws SaltException exception occured during connection (if any)\n+     */\n+    EventStream getEventStream() throws SaltException;\n+\n+    /**\n+     * Run a remote command on a given minion.\n+     *\n+     * @param target the target\n+     * @param cmd the command\n+     * @return the output of the command\n+     */\n+    Map<String, Result<String>> runRemoteCommand(MinionList target, String cmd);\n+\n+    /**\n+     * Run a remote command on a given minion asynchronously.\n+     * @param target the target\n+     * @param cmd the command to execute\n+     * @param cancel a future used to cancel waiting on return events\n+     * @return a map holding a {@link CompletionStage}s for each minion\n+     */\n+    Map<String, CompletionStage<Result<String>>> runRemoteCommandAsync(\n+            MinionList target, String cmd, CompletableFuture<GenericError> cancel);\n+\n+    /**\n+     * Query the list of virtual storage pools defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a map associating pool names with their informations as Json elements\n+     */\n+    Map<String, JsonElement> getPools(String minionId);\n+\n+    /**\n+     * Query the list of virtual storage volumes defined on a salt minion.\n+     *\n+     * @param minionId the minion to ask about\n+     * @return a map associating pool names with the list of volumes it contains mapped by their names\n+     */\n+    Map<String, Map<String, JsonElement>> getVolumes(String minionId);\n+\n+    /**\n+     * Returns the currently running jobs on the target\n+     *\n+     * @param target the target\n+     * @return list of running jobs\n+     */\n+    Map<String, Result<List<SaltUtil.RunningInfo>>> running(MinionList target);\n+\n+    /**\n+     * Return the result for a jobId\n+     *\n+     * @param jid the job id\n+     * @return map from minion to result\n+     */\n+    Optional<Jobs.Info> listJob(String jid);\n+\n+    /**\n+     * Match the given target expression asynchronously.\n+     * @param target the target expression\n+     * @param cancel  a future used to cancel waiting on return events\n+     * @return a map holding a {@link CompletionStage}s for each minion\n+     */\n+    Map<String, CompletionStage<Result<Boolean>>> matchAsync(\n+            String target, CompletableFuture<GenericError> cancel);\n+\n+    /**\n+     * Executes match.glob in another thread and returns a {@link CompletionStage}.\n+     * @param target the target to pass to match.glob\n+     * @param cancel a future used to cancel waiting\n+     * @return a future or Optional.empty if there's no ssh-push minion in the db\n+     */\n+    Optional<CompletionStage<Map<String, Result<Boolean>>>> matchAsyncSSH(\n+            String target, CompletableFuture<GenericError> cancel);\n+\n+    /**\n+     * Call 'saltutil.refresh_pillar' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n+    void refreshPillar(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_grains' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n+    void syncGrains(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_modules' to sync the grains to the target minion(s).\n+     * @param minionList minion list\n+     */\n+    void syncModules(MinionList minionList);\n+\n+    /**\n+     * Call 'saltutil.sync_all' to sync everything to the target minion(s).\n+     * @param minionList minion list\n+     */\n+    void syncAll(MinionList minionList);\n+\n+    /**\n+     * Performs an test.echo on a target set of minions for checkIn purpose.\n+     * @param targetIn the target\n+     * @return the LocalAsyncResult of the test.echo call\n+     * @throws SaltException if we get a failure from Salt\n+     */\n+    Optional<LocalAsyncResult<String>> checkIn(MinionList targetIn) throws SaltException;\n+\n+    /**\n+     * Apply util.systeminfo state on the specified minion list\n+     * @param minionTarget minion list\n+     */\n+    void updateSystemInfo(MinionList minionTarget);\n+\n+    /**\n+     * Gets a minion's master hostname.\n+     *\n+     * @param minionId the minion id\n+     * @return the master hostname\n+     */\n+    Optional<String> getMasterHostname(String minionId);\n+\n+    /**\n+     * Bootstrap a system using salt-ssh.\n+     *\n+     * @param parameters - bootstrap parameters\n+     * @param bootstrapMods - state modules to be applied during the bootstrap\n+     * @param pillarData - pillar data used salt-ssh call\n+     * @throws SaltException if something goes wrong during command execution or\n+     * during manipulation the salt-ssh roster\n+     * @return the result of the underlying ssh call for given host\n+     */\n+    Result<SSHResult<Map<String, State.ApplyResult>>> bootstrapMinion(\n+            BootstrapParameters parameters, List<String> bootstrapMods,\n+            Map<String, Object> pillarData) throws SaltException;\n+\n+    /**\n+     * Store the files uploaded by a minion to the SCAP storage directory.\n+     * @param minion the minion\n+     * @param uploadDir the uploadDir\n+     * @param actionId the action id\n+     * @return a map with one element: @{code true} -> scap store path,\n+     * {@code false} -> err message\n+     *\n+     */\n+    Map<Boolean, String> storeMinionScapFiles(\n+            MinionServer minion, String uploadDir, Long actionId);\n+\n+    /**\n+     * Call the custom mgrutil.ssh_keygen runner if the key files are not present.\n+     *\n+     * @param path of the key files\n+     * @return the result of the runner call as a map\n+     */\n+    Optional<MgrUtilRunner.ExecResult> generateSSHKey(String path);\n+\n+    /**\n+     * Chain ssh calls over one or more hops to run a command on the last host in the chain.\n+     * This calls the mgrutil.chain_ssh_command runner.\n+     *\n+     * @param hosts a list of hosts, where the last one is where\n+     *              the command will be executed\n+     * @param clientKey the ssh key to use to connect to the first host\n+     * @param proxyKey the ssh key path to use for the rest of the hosts\n+     * @param user the user\n+     * @param options ssh options\n+     * @param command the command to execute\n+     * @param outputfile the file to which to dump the command stdout\n+     * @return the execution result\n+     */\n+    Optional<MgrUtilRunner.ExecResult> chainSSHCommand(List<String> hosts,\n+        String clientKey,\n+        String proxyKey,\n+        String user,\n+        Map<String, String> options,\n+        String command,\n+        String outputfile);\n+\n+    /**\n+     * Get information about all containers running in a Kubernetes cluster.\n+     * @param kubeconfig path to the kubeconfig file\n+     * @param context kubeconfig context to use\n+     * @return a list of containers\n+     */\n+    Optional<List<MgrK8sRunner.Container>> getAllContainers(String kubeconfig, String context);\n+\n+    /**\n+     * Remove SUSE Manager specific configuration from a Salt minion.\n+     *\n+     * @param minion the minion.\n+     * @param timeout operation timeout\n+     * @return list of error messages or empty if no error\n+     */\n+    Optional<List<String>> cleanupMinion(MinionServer minion, int timeout);\n+\n+    /**\n+     * Send notification about a system id to be generated.\n+     * @param minion target minion.\n+     * @throws InstantiationException if signature generation fails\n+     * @throws SaltException if anything goes wrong.\n+     */\n+    void notifySystemIdGenerated(MinionServer minion) throws InstantiationException, SaltException;\n+\n+    /**\n+     * Get pending resume information.\n+     * @param minionIds to target.\n+     * @return pending resume information.\n+     * @throws SaltException if anything goes wrong.\n+     */\n+    Map<String, Result<Map<String, String>>> getPendingResume(List<String> minionIds) throws SaltException;\n+\n+    /**\n+     * Return show highstate result.\n+     * @param minionId of the target minion.\n+     * @return show highstate result.\n+     * @throws SaltException if anything goes wrong.\n+     */\n+    Map<String, Result<Object>> showHighstate(String minionId) throws SaltException;\n+\n+    /**\n+     * Query product information.\n+     * @param minionId of the target minion.\n+     * @return product information\n+     */\n+    Optional<List<Zypper.ProductInfo>> getProducts(String minionId);\n+\n+    /**\n+     * Execute a LocalCall asynchronously on the default Salt client.\n+     *\n+     * @deprecated this function is too general and should be replaced by more specific functionality.\n+     * @param <T> the return type of the call\n+     * @param callIn the call to execute\n+     * @param target minions targeted by the call\n+     * @param metadataIn the metadata to be passed in the call\n+     * @return the LocalAsyncResult of the call\n+     * @throws SaltException in case of an error executing the job with Salt\n+     */\n+    @Deprecated\n+    <T> Optional<LocalAsyncResult<T>> callAsync(LocalCall<T> callIn, Target<?> target,\n+                                                       Optional<ScheduleMetadata> metadataIn) throws SaltException;\n+\n+    /**\n+     * Sync the channels of a list of minions\n+     * @param minionIds of the targets.\n+     * @throws SaltException if anything goes wrong.\n+     */\n+    void deployChannels(List<String> minionIds) throws SaltException;\n+\n+    /**\n+     * Upload built Kiwi image to SUSE Manager\n+     *\n+     * @param minion     the minion\n+     * @param filepath   the filepath of the image to upload, in the build host\n+     * @param imageStore the image store location\n+     * @return the execution result\n+     */\n+    Optional<MgrUtilRunner.ExecResult> collectKiwiImage(MinionServer minion, String filepath,\n+                                                               String imageStore);", "originalCommit": "c8cbafa49fa3348ea923b52991e78ec4d8e844d9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb9f69dafb50fce7c130edc71a107d639cc2287e", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\nindex 34bc4ebd287..e851209ff6a 100644\n--- a/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n+++ b/java/code/src/com/suse/manager/webui/services/impl/SystemQuery.java\n\n@@ -1,5 +1,5 @@\n /**\n- * Copyright (c) 2016 SUSE LLC\n+ * Copyright (c) 2020 SUSE LLC\n  *\n  * This software is licensed to you under the GNU General Public License,\n  * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n"}}, {"oid": "eb9f69dafb50fce7c130edc71a107d639cc2287e", "url": "https://github.com/uyuni-project/uyuni/commit/eb9f69dafb50fce7c130edc71a107d639cc2287e", "message": "rename saltService variables to systemQuery", "committedDate": "2020-03-04T16:34:49Z", "type": "forcePushed"}, {"oid": "fb7a40835797dc57a6441eeb82ce0c046d19b28a", "url": "https://github.com/uyuni-project/uyuni/commit/fb7a40835797dc57a6441eeb82ce0c046d19b28a", "message": "cleanup unused variable", "committedDate": "2020-03-09T12:52:21Z", "type": "forcePushed"}, {"oid": "e2c368aa5a7ce2bf502203de5c0f2396f4dbc0fa", "url": "https://github.com/uyuni-project/uyuni/commit/e2c368aa5a7ce2bf502203de5c0f2396f4dbc0fa", "message": "cleanup unused variable", "committedDate": "2020-03-10T11:04:37Z", "type": "forcePushed"}, {"oid": "b1922b23994b09fe2cf427769d93c833ff122f3f", "url": "https://github.com/uyuni-project/uyuni/commit/b1922b23994b09fe2cf427769d93c833ff122f3f", "message": "cleanup unused variable", "committedDate": "2020-03-10T14:52:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyMTcxMg==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r390921712", "bodyText": "I assume we will use this systemQuery later in some other PR, right?", "author": "admd", "createdAt": "2020-03-11T11:58:35Z", "path": "java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java", "diffHunk": "@@ -267,9 +268,9 @@ public static boolean isMessaging() {\n     /**\n      * Configures defaut messaging actions needed by RHN\n      * This method should be called directly after <code>startMessaging</code>.\n-     *\n+     * @param systemQuery instance for gathering data from a system.\n      */\n-    public static void configureDefaultActions() {\n+    public static void configureDefaultActions(SystemQuery systemQuery) {", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA4MDk2OA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391080968", "bodyText": "not sure it was used until last rebase when the only *Action class that needed it was removed completely. I will remove it for now.", "author": "lucidd", "createdAt": "2020-03-11T16:00:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyMTcxMg=="}], "type": "inlineReview", "revised_code": {"commit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "chunk": "diff --git a/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java b/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java\nindex ebf5ca72973..088ecc305e5 100644\n--- a/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java\n+++ b/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java\n\n@@ -266,11 +265,10 @@ public class MessageQueue {\n \n \n     /**\n-     * Configures defaut messaging actions needed by RHN\n+     * Configures default messaging actions needed by RHN\n      * This method should be called directly after <code>startMessaging</code>.\n-     * @param systemQuery instance for gathering data from a system.\n      */\n-    public static void configureDefaultActions(SystemQuery systemQuery) {\n+    public static void configureDefaultActions() {\n         // Register the Actions for the Events\n         // If we develop a large set of MessageEvents we may want to\n         // refactor this block out into a class or method that\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyMjQwNA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r390922404", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Configures defaut messaging actions needed by RHN\n          \n          \n            \n                 * Configures default messaging actions needed by RHN", "author": "admd", "createdAt": "2020-03-11T11:59:59Z", "path": "java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java", "diffHunk": "@@ -267,9 +268,9 @@ public static boolean isMessaging() {\n     /**\n      * Configures defaut messaging actions needed by RHN", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "chunk": "diff --git a/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java b/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java\nindex ebf5ca72973..088ecc305e5 100644\n--- a/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java\n+++ b/java/code/src/com/redhat/rhn/common/messaging/MessageQueue.java\n\n@@ -266,11 +265,10 @@ public class MessageQueue {\n \n \n     /**\n-     * Configures defaut messaging actions needed by RHN\n+     * Configures default messaging actions needed by RHN\n      * This method should be called directly after <code>startMessaging</code>.\n-     * @param systemQuery instance for gathering data from a system.\n      */\n-    public static void configureDefaultActions(SystemQuery systemQuery) {\n+    public static void configureDefaultActions() {\n         // Register the Actions for the Events\n         // If we develop a large set of MessageEvents we may want to\n         // refactor this block out into a class or method that\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkzNDk1NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r390934954", "bodyText": "Nice to have this constructor but do we need it?  If not, let's add it when we need it.", "author": "admd", "createdAt": "2020-03-11T12:27:07Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java", "diffHunk": "@@ -28,16 +82,103 @@\n  */\n \n public class HandlerFactory {\n-    private ManifestFactory factory;\n-    private static final String PKG_NAME = \"com.redhat.rhn.frontend.xmlrpc\";\n+    private final Map<String, BaseHandler> handlers;\n \n-    /** private constructor */\n+    /**\n+     *  Creates an empty HandlerFactory.\n+     */\n     public HandlerFactory() {\n-        this(new ClassBuilder(PKG_NAME, \"handler-manifest.xml\"));\n+        this.handlers = new HashMap<>();\n+    }\n+\n+    /**\n+     * Creates a HandlerFactory prepopulated with handlers.\n+     * @param handlersIn to add to the handler factory.\n+     */\n+    public HandlerFactory(Map<String, BaseHandler> handlersIn) {", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "chunk": "diff --git a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\nindex 8596c672998..8ec649a858c 100644\n--- a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n+++ b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n\n@@ -91,14 +91,6 @@ public class HandlerFactory {\n         this.handlers = new HashMap<>();\n     }\n \n-    /**\n-     * Creates a HandlerFactory prepopulated with handlers.\n-     * @param handlersIn to add to the handler factory.\n-     */\n-    public HandlerFactory(Map<String, BaseHandler> handlersIn) {\n-        this.handlers = handlersIn;\n-    }\n-\n     /**\n      * HandlerFactory prepopulated with unit test handlers.\n      * @return HandlerFactory for unit tests.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk1NTcxMA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r390955710", "bodyText": "Haven't tested it but wouldn't handlers.getHandler(namespace).getClass() always return java.util.Optional  class here?", "author": "admd", "createdAt": "2020-03-11T13:07:14Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/api/ApiHandler.java", "diffHunk": "@@ -83,17 +88,12 @@ private Collection getNamespaces() {\n      *        #prop_desc(\"string\", \"handler\", \"API Handler\")\n      *   #struct_end()\n      */\n-    public Map getApiNamespaces(User loggedInUser) {\n-        Map namespacesHash = new HashMap();\n-        HandlerFactory hf = new HandlerFactory();\n-\n-        Iterator i = getNamespaces().iterator();\n-        while (i.hasNext()) {\n-                String namespace = (String)i.next();\n-                namespacesHash.put(namespace, StringUtil.getClassNameNoPackage(\n-                                                hf.getHandler(namespace).getClass()));\n-        }\n-        return namespacesHash;\n+    public Map<String, String> getApiNamespaces(User loggedInUser) {\n+        return handlers.getKeys().stream().collect(Collectors.toMap(\n+           namespace -> namespace,\n+           namespace -> StringUtil.getClassNameNoPackage(\n+                       handlers.getHandler(namespace).getClass())", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA5MzcwOA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391093708", "bodyText": "good catch thanks \ud83d\udc4d", "author": "lucidd", "createdAt": "2020-03-11T16:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk1NTcxMA=="}], "type": "inlineReview", "revised_code": {"commit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "chunk": "diff --git a/java/code/src/com/redhat/rhn/frontend/xmlrpc/api/ApiHandler.java b/java/code/src/com/redhat/rhn/frontend/xmlrpc/api/ApiHandler.java\nindex ae0b345db00..184fccd6768 100644\n--- a/java/code/src/com/redhat/rhn/frontend/xmlrpc/api/ApiHandler.java\n+++ b/java/code/src/com/redhat/rhn/frontend/xmlrpc/api/ApiHandler.java\n\n@@ -92,7 +92,7 @@ public class ApiHandler extends BaseHandler {\n         return handlers.getKeys().stream().collect(Collectors.toMap(\n            namespace -> namespace,\n            namespace -> StringUtil.getClassNameNoPackage(\n-                       handlers.getHandler(namespace).getClass())\n+                       handlers.getHandler(namespace).get().getClass())\n         ));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2Mjg5OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r390962899", "bodyText": "We will be removing all of such methods, right?", "author": "admd", "createdAt": "2020-03-11T13:19:09Z", "path": "java/code/src/com/redhat/rhn/manager/formula/FormulaManager.java", "diffHunk": "@@ -64,10 +65,10 @@ public static synchronized FormulaManager getInstance() {\n \n     /**\n      * This method is only for testing purpose.\n-     * @param saltServiceIn to set\n+     * @param systemQueryIn to set\n      */\n-    public void setSaltService(SaltService saltServiceIn) {\n-        this.saltService = saltServiceIn;\n+    public void setSystemQuery(SaltService systemQueryIn) {\n+        this.systemQuery = systemQueryIn;\n     }", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA5NDY2NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391094664", "bodyText": "yes that's the long term plan.", "author": "lucidd", "createdAt": "2020-03-11T16:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2Mjg5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/redhat/rhn/manager/formula/FormulaManager.java b/java/code/src/com/redhat/rhn/manager/formula/FormulaManager.java\nindex dc0b7dc2e0f..71e5c765616 100644\n--- a/java/code/src/com/redhat/rhn/manager/formula/FormulaManager.java\n+++ b/java/code/src/com/redhat/rhn/manager/formula/FormulaManager.java\n\n@@ -65,10 +65,10 @@ public class FormulaManager {\n \n     /**\n      * This method is only for testing purpose.\n-     * @param systemQueryIn to set\n+     * @param saltServiceIn to set\n      */\n-    public void setSystemQuery(SaltService systemQueryIn) {\n-        this.systemQuery = systemQueryIn;\n+    public void setSaltService(SaltService saltServiceIn) {\n+        this.saltService = saltServiceIn;\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAzMTY0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391031642", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param systemQueryIn the system to use\n          \n          \n            \n                 * @param systemQueryIn systemQuery instance for gathering data from a system.", "author": "admd", "createdAt": "2020-03-11T14:55:47Z", "path": "java/code/src/com/suse/manager/reactor/messaging/MinionStartEventMessageAction.java", "diffHunk": "@@ -32,22 +32,15 @@\n     private static final Logger LOG = Logger.getLogger(MinionStartEventMessageAction.class);\n \n     // Reference to the SaltService instance\n-    private final SaltService SALT_SERVICE;\n+    private final SystemQuery systemQuery;\n \n     /**\n-     * Default constructor.\n-     */\n-    public MinionStartEventMessageAction() {\n-        this(SaltService.INSTANCE);\n-    }\n-\n-    /**\n-     * Constructor taking a {@link SaltService} instance.\n+     * Constructor taking a {@link SystemQuery} instance.\n      *\n-     * @param saltService the salt service to use\n+     * @param systemQueryIn the system to use", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "chunk": "diff --git a/java/code/src/com/suse/manager/reactor/messaging/MinionStartEventMessageAction.java b/java/code/src/com/suse/manager/reactor/messaging/MinionStartEventMessageAction.java\nindex 447676175a9..85193151b0d 100644\n--- a/java/code/src/com/suse/manager/reactor/messaging/MinionStartEventMessageAction.java\n+++ b/java/code/src/com/suse/manager/reactor/messaging/MinionStartEventMessageAction.java\n\n@@ -37,7 +37,7 @@ public class MinionStartEventMessageAction implements MessageAction {\n     /**\n      * Constructor taking a {@link SystemQuery} instance.\n      *\n-     * @param systemQueryIn the system to use\n+     * @param systemQueryIn systemQuery instance for gathering data from a system.\n      */\n     public MinionStartEventMessageAction(SystemQuery systemQueryIn) {\n         this.systemQuery = systemQueryIn;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAzMjQxMA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391032410", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param systemQueryIn the salt service to use\n          \n          \n            \n                 * @param systemQueryIn systemQuery instance for gathering data from a system.", "author": "admd", "createdAt": "2020-03-11T14:56:46Z", "path": "java/code/src/com/suse/manager/reactor/messaging/RegisterMinionEventMessageAction.java", "diffHunk": "@@ -93,25 +93,18 @@\n             RegisterMinionEventMessageAction.class);\n \n     // Reference to the SaltService instance\n-    private final SaltService SALT_SERVICE;\n+    private final SystemQuery systemQuery;\n \n     private static final String FQDN = \"fqdn\";\n     private static final String TERMINALS_GROUP_NAME = \"TERMINALS\";\n \n     /**\n-     * Default constructor.\n-     */\n-    public RegisterMinionEventMessageAction() {\n-        this(SaltService.INSTANCE);\n-    }\n-\n-    /**\n-     * Constructor taking a {@link SaltService} instance.\n+     * Constructor taking a {@link SystemQuery} instance.\n      *\n-     * @param saltService the salt service to use\n+     * @param systemQueryIn the salt service to use", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "chunk": "diff --git a/java/code/src/com/suse/manager/reactor/messaging/RegisterMinionEventMessageAction.java b/java/code/src/com/suse/manager/reactor/messaging/RegisterMinionEventMessageAction.java\nindex 509036d2d4e..455ccc4b8fd 100644\n--- a/java/code/src/com/suse/manager/reactor/messaging/RegisterMinionEventMessageAction.java\n+++ b/java/code/src/com/suse/manager/reactor/messaging/RegisterMinionEventMessageAction.java\n\n@@ -101,7 +101,7 @@ public class RegisterMinionEventMessageAction implements MessageAction {\n     /**\n      * Constructor taking a {@link SystemQuery} instance.\n      *\n-     * @param systemQueryIn the salt service to use\n+     * @param systemQueryIn systemQuery instance for gathering data from a system.\n      */\n     public RegisterMinionEventMessageAction(SystemQuery systemQueryIn) {\n         systemQuery = systemQueryIn;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA1NTMyMA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391055320", "bodyText": "iface? Out of curiosity, what does it represent?", "author": "admd", "createdAt": "2020-03-11T15:27:25Z", "path": "java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java", "diffHunk": "@@ -0,0 +1,511 @@\n+/**\n+ * Copyright (c) 2020 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.iface;\n+", "originalCommit": "b1922b23994b09fe2cf427769d93c833ff122f3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA5MTgyNA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r391091824", "bodyText": "I suggested iface as I found it commonly used for interfaces as opposed to impl for their implementations.", "author": "renner", "createdAt": "2020-03-11T16:16:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA1NTMyMA=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java\ndeleted file mode 100644\nindex a4c9db9b37d..00000000000\n--- a/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java\n+++ /dev/null\n\n@@ -1,511 +0,0 @@\n-/**\n- * Copyright (c) 2020 SUSE LLC\n- *\n- * This software is licensed to you under the GNU General Public License,\n- * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n- * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n- * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n- * along with this software; if not, see\n- * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n- *\n- * Red Hat trademarks are not licensed under GPLv2. No permission is\n- * granted to use or replicate Red Hat trademarks that are incorporated\n- * in this software or its documentation.\n- */\n-package com.suse.manager.webui.services.iface;\n-\n-import com.google.gson.JsonObject;\n-import com.google.gson.reflect.TypeToken;\n-import com.google.gson.JsonElement;\n-import com.redhat.rhn.domain.server.MinionServer;\n-import com.suse.manager.reactor.SaltReactor;\n-import com.suse.manager.virtualization.GuestDefinition;\n-import com.suse.manager.virtualization.PoolCapabilitiesJson;\n-import com.suse.manager.virtualization.PoolDefinition;\n-import com.suse.manager.webui.services.impl.SaltSSHService;\n-import com.suse.manager.webui.services.impl.SaltService;\n-import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n-import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n-import com.suse.manager.webui.utils.gson.BootstrapParameters;\n-import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n-import com.suse.salt.netapi.calls.LocalAsyncResult;\n-import com.suse.salt.netapi.calls.LocalCall;\n-import com.suse.salt.netapi.calls.modules.SaltUtil;\n-import com.suse.salt.netapi.calls.modules.State;\n-import com.suse.salt.netapi.calls.modules.Zypper;\n-import com.suse.salt.netapi.calls.runner.Jobs;\n-import com.suse.salt.netapi.calls.wheel.Key;\n-import com.suse.salt.netapi.datatypes.target.MinionList;\n-import com.suse.salt.netapi.datatypes.target.Target;\n-import com.suse.salt.netapi.errors.GenericError;\n-import com.suse.salt.netapi.event.EventStream;\n-import com.suse.salt.netapi.exception.SaltException;\n-import com.suse.salt.netapi.results.Result;\n-import com.suse.salt.netapi.results.SSHResult;\n-\n-import java.time.LocalDateTime;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Optional;\n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.CompletionStage;\n-\n-/**\n- * Interface containing methods for directly interacting and getting information from a system.\n- * Note: This interface should be split up further at some point.\n- */\n-public interface SystemQuery {\n-\n-    /**\n-     * Query virtual host and domains capabilities.\n-     *\n-     * @param minionId the salt minion virtual host to ask about\n-     * @return the output of the salt virt.all_capabilities call in JSON\n-     */\n-    Optional<Map<String, JsonElement>> getCapabilities(String minionId);\n-\n-    /**\n-     * Query the list of virtual networks defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a list of the network names\n-     */\n-    Map<String, JsonObject> getNetworks(String minionId);\n-\n-    /**\n-     * Query virtual storage pool definition\n-     *\n-     * @param minionId the host minion ID\n-     * @param poolName the domain name to look for\n-     * @return the XML definition or an empty Optional\n-     */\n-    Optional<PoolDefinition> getPoolDefinition(String minionId, String poolName);\n-\n-    /**\n-     * Query virtual machine definition\n-     *\n-     * @param minionId the host minion ID\n-     * @param domainName the domain name to look for\n-     * @return the XML definition or an empty Optional\n-     */\n-    Optional<GuestDefinition> getGuestDefinition(String minionId, String domainName);\n-\n-    /**\n-     * Query virtual storage pool capabilities\n-     *\n-     * @param minionId the salt minion virtual host to ask about\n-     * @return the output of the salt virt.pool_capabilities call\n-     */\n-    Optional<PoolCapabilitiesJson> getPoolCapabilities(String minionId);\n-\n-    /**\n-     * call salt test.ping\n-     * @param minionId id of the target minion\n-     * @return true\n-     */\n-    Optional<Boolean> ping(String minionId);\n-\n-    /**\n-     * Get the minion keys from salt with their respective status.\n-     *\n-     * @return the keys with their respective status as returned from salt\n-     */\n-    Key.Names getKeys();\n-\n-    /**\n-     * For a given minion id check if there is a key in any of the given status. If no status is given as parameter,\n-     * all the available status are considered.\n-     *\n-     * @param id the id to check for\n-     * @param statusIn array of key status to consider\n-     * @return true if there is a key with the given id, false otherwise\n-     */\n-    boolean keyExists(String id, SaltService.KeyStatus... statusIn);\n-\n-    /**\n-     * Get the minion keys from salt with their respective status and fingerprint.\n-     *\n-     * @return the keys with their respective status and fingerprint as returned from salt\n-     */\n-    Key.Fingerprints getFingerprints();\n-\n-    /**\n-     * Generate a key pair for the given id and accept the public key.\n-     *\n-     * @param id the id to use\n-     * @param force set true to overwrite an already existing key\n-     * @return the generated key pair\n-     */\n-    Key.Pair generateKeysAndAccept(String id, boolean force);\n-\n-    /**\n-     * Get the machine id for a given minion.\n-     *\n-     * @param minionId id of the target minion\n-     * @return the machine id as a string\n-     */\n-    Optional<String> getMachineId(String minionId);\n-\n-    /**\n-     * Delete a given minion's key.\n-     *\n-     * @param minionId id of the minion\n-     */\n-    void deleteKey(String minionId);\n-\n-    /**\n-     * Accept all keys matching the given pattern\n-     *\n-     * @param match a pattern for minion ids\n-     */\n-    void acceptKey(String match);\n-\n-    /**\n-     * Reject a given minion's key.\n-     *\n-     * @param minionId id of the minion\n-     */\n-    void rejectKey(String minionId);\n-\n-    /**\n-     * Delete a Salt key from the \"Rejected Keys\" category using the mgrutil runner.\n-     *\n-     * @param minionId the minionId to look for in \"Rejected Keys\"\n-     * @return the result of the runner call as a map\n-     */\n-    Optional<MgrUtilRunner.ExecResult> deleteRejectedKey(String minionId);\n-\n-    /**\n-     * Return the stream of events happening in salt.\n-     *\n-     * @return the event stream\n-     * @throws SaltException exception occured during connection (if any)\n-     */\n-    EventStream getEventStream() throws SaltException;\n-\n-    /**\n-     * Run a remote command on a given minion.\n-     *\n-     * @param target the target\n-     * @param cmd the command\n-     * @return the output of the command\n-     */\n-    Map<String, Result<String>> runRemoteCommand(MinionList target, String cmd);\n-\n-    /**\n-     * Run a remote command on a given minion asynchronously.\n-     * @param target the target\n-     * @param cmd the command to execute\n-     * @param cancel a future used to cancel waiting on return events\n-     * @return a map holding a {@link CompletionStage}s for each minion\n-     */\n-    Map<String, CompletionStage<Result<String>>> runRemoteCommandAsync(\n-            MinionList target, String cmd, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Query the list of virtual storage pools defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a map associating pool names with their informations as Json elements\n-     */\n-    Map<String, JsonObject> getPools(String minionId);\n-\n-    /**\n-     * Query the list of virtual storage volumes defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a map associating pool names with the list of volumes it contains mapped by their names\n-     */\n-    Map<String, Map<String, JsonObject>> getVolumes(String minionId);\n-\n-    /**\n-     * Returns the currently running jobs on the target\n-     *\n-     * @param target the target\n-     * @return list of running jobs\n-     */\n-    Map<String, Result<List<SaltUtil.RunningInfo>>> running(MinionList target);\n-\n-    /**\n-     * Return the result for a jobId\n-     *\n-     * @param jid the job id\n-     * @return map from minion to result\n-     */\n-    Optional<Jobs.Info> listJob(String jid);\n-\n-    /**\n-     * Match the given target expression asynchronously.\n-     * @param target the target expression\n-     * @param cancel  a future used to cancel waiting on return events\n-     * @return a map holding a {@link CompletionStage}s for each minion\n-     */\n-    Map<String, CompletionStage<Result<Boolean>>> matchAsync(\n-            String target, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Executes match.glob in another thread and returns a {@link CompletionStage}.\n-     * @param target the target to pass to match.glob\n-     * @param cancel a future used to cancel waiting\n-     * @return a future or Optional.empty if there's no ssh-push minion in the db\n-     */\n-    Optional<CompletionStage<Map<String, Result<Boolean>>>> matchAsyncSSH(\n-            String target, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Call 'saltutil.refresh_pillar' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void refreshPillar(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_grains' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncGrains(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_modules' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncModules(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_all' to sync everything to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncAll(MinionList minionList);\n-\n-    /**\n-     * Performs an test.echo on a target set of minions for checkIn purpose.\n-     * @param targetIn the target\n-     * @return the LocalAsyncResult of the test.echo call\n-     * @throws SaltException if we get a failure from Salt\n-     */\n-    Optional<LocalAsyncResult<String>> checkIn(MinionList targetIn) throws SaltException;\n-\n-    /**\n-     * Apply util.systeminfo state on the specified minion list\n-     * @param minionTarget minion list\n-     */\n-    void updateSystemInfo(MinionList minionTarget);\n-\n-    /**\n-     * Gets a minion's master hostname.\n-     *\n-     * @param minionId the minion id\n-     * @return the master hostname\n-     */\n-    Optional<String> getMasterHostname(String minionId);\n-\n-    /**\n-     * Bootstrap a system using salt-ssh.\n-     *\n-     * @param parameters - bootstrap parameters\n-     * @param bootstrapMods - state modules to be applied during the bootstrap\n-     * @param pillarData - pillar data used salt-ssh call\n-     * @throws SaltException if something goes wrong during command execution or\n-     * during manipulation the salt-ssh roster\n-     * @return the result of the underlying ssh call for given host\n-     */\n-    Result<SSHResult<Map<String, State.ApplyResult>>> bootstrapMinion(\n-            BootstrapParameters parameters, List<String> bootstrapMods,\n-            Map<String, Object> pillarData) throws SaltException;\n-\n-    /**\n-     * Store the files uploaded by a minion to the SCAP storage directory.\n-     * @param minion the minion\n-     * @param uploadDir the uploadDir\n-     * @param actionId the action id\n-     * @return a map with one element: @{code true} -> scap store path,\n-     * {@code false} -> err message\n-     *\n-     */\n-    Map<Boolean, String> storeMinionScapFiles(MinionServer minion, String uploadDir, Long actionId);\n-\n-    /**\n-     * Call the custom mgrutil.ssh_keygen runner if the key files are not present.\n-     *\n-     * @param path of the key files\n-     * @return the result of the runner call as a map\n-     */\n-    Optional<MgrUtilRunner.ExecResult> generateSSHKey(String path);\n-\n-    /**\n-     * Chain ssh calls over one or more hops to run a command on the last host in the chain.\n-     * This calls the mgrutil.chain_ssh_command runner.\n-     *\n-     * @param hosts a list of hosts, where the last one is where\n-     *              the command will be executed\n-     * @param clientKey the ssh key to use to connect to the first host\n-     * @param proxyKey the ssh key path to use for the rest of the hosts\n-     * @param user the user\n-     * @param options ssh options\n-     * @param command the command to execute\n-     * @param outputfile the file to which to dump the command stdout\n-     * @return the execution result\n-     */\n-    Optional<MgrUtilRunner.ExecResult> chainSSHCommand(List<String> hosts, String clientKey, String proxyKey,\n-            String user, Map<String, String> options, String command, String outputfile);\n-\n-    /**\n-     * Get information about all containers running in a Kubernetes cluster.\n-     * @param kubeconfig path to the kubeconfig file\n-     * @param context kubeconfig context to use\n-     * @return a list of containers\n-     */\n-    Optional<List<MgrK8sRunner.Container>> getAllContainers(String kubeconfig, String context);\n-\n-    /**\n-     * Remove SUSE Manager specific configuration from a Salt minion.\n-     *\n-     * @param minion the minion.\n-     * @param timeout operation timeout\n-     * @return list of error messages or empty if no error\n-     */\n-    Optional<List<String>> cleanupMinion(MinionServer minion, int timeout);\n-\n-    /**\n-     * Send notification about a system id to be generated.\n-     * @param minion target minion.\n-     * @throws InstantiationException if signature generation fails\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    void notifySystemIdGenerated(MinionServer minion) throws InstantiationException, SaltException;\n-\n-    /**\n-     * Get pending resume information.\n-     * @param minionIds to target.\n-     * @return pending resume information.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    Map<String, Result<Map<String, String>>> getPendingResume(List<String> minionIds) throws SaltException;\n-\n-    /**\n-     * Return show highstate result.\n-     * @param minionId of the target minion.\n-     * @return show highstate result.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    Map<String, Result<Object>> showHighstate(String minionId) throws SaltException;\n-\n-    /**\n-     * Query product information.\n-     * @param minionId of the target minion.\n-     * @return product information\n-     */\n-    Optional<List<Zypper.ProductInfo>> getProducts(String minionId);\n-\n-    /**\n-     * Execute a LocalCall asynchronously on the default Salt client.\n-     *\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param <T> the return type of the call\n-     * @param callIn the call to execute\n-     * @param target minions targeted by the call\n-     * @param metadataIn the metadata to be passed in the call\n-     * @return the LocalAsyncResult of the call\n-     * @throws SaltException in case of an error executing the job with Salt\n-     */\n-    @Deprecated\n-    <T> Optional<LocalAsyncResult<T>> callAsync(LocalCall<T> callIn, Target<?> target,\n-            Optional<ScheduleMetadata> metadataIn) throws SaltException;\n-\n-    /**\n-     * Sync the channels of a list of minions\n-     * @param minionIds of the targets.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    void deployChannels(List<String> minionIds) throws SaltException;\n-\n-    /**\n-     * Upload built Kiwi image to SUSE Manager\n-     *\n-     * @param minion     the minion\n-     * @param filepath   the filepath of the image to upload, in the build host\n-     * @param imageStore the image store location\n-     * @return the execution result\n-     */\n-    Optional<MgrUtilRunner.ExecResult> collectKiwiImage(MinionServer minion, String filepath,\n-            String imageStore);\n-\n-    /**\n-     * Update libvirt engine on a given minion.\n-     * @param minion to update.\n-     */\n-    void updateLibvirtEngine(MinionServer minion);\n-\n-    /**\n-     * Execute generic salt call.\n-     * @param call salt call to execute.\n-     * @param minionId of the target minion.\n-     * @return raw salt call result in json format.\n-     */\n-    Optional<JsonElement> rawJsonCall(LocalCall<?> call, String minionId);\n-\n-    /**\n-     * Return the jobcache filtered by metadata\n-     *\n-     * @param metadata search metadata\n-     * @return list of running jobs\n-     */\n-    Optional<Map<String, Jobs.ListJobsEntry>> jobsByMetadata(Object metadata);\n-\n-    /**\n-     * Return the jobcache filtered by metadata and start and end time.\n-     *\n-     * @param metadata search metadata\n-     * @param startTime jobs start time\n-     * @param endTime jobs end time\n-     * @return list of running jobs\n-     */\n-    Optional<Map<String, Jobs.ListJobsEntry>> jobsByMetadata(Object metadata, LocalDateTime startTime,\n-            LocalDateTime endTime);\n-\n-    /**\n-     * Get the specified grains for a given minion.\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId id of the target minion\n-     * @param type  class type, result should be parsed into\n-     * @param grainNames list of grains names\n-     * @param <T> Type result should be parsed into\n-     * @return Optional containing the grains parsed into specified type\n-     */\n-    @Deprecated\n-    <T> Optional<T> getGrains(String minionId, TypeToken<T> type, String... grainNames);\n-\n-    /**\n-     * Get the grains for a given minion.\n-     *\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId id of the target minion\n-     * @return map containing the grains\n-     */\n-    @Deprecated\n-    Optional<Map<String, Object>> getGrains(String minionId);\n-\n-    /**\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param reactorIn the salt reactor.\n-     */\n-    @Deprecated\n-    void setReactor(SaltReactor reactorIn);\n-\n-    /**\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @return saltSSHService to get\n-     */\n-    @Deprecated\n-    SaltSSHService getSaltSSHService();\n-\n-    /**\n-     * Apply a state synchronously.\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId the minion id\n-     * @param state the state to apply\n-     * @return the result of applying the state\n-     */\n-    @Deprecated\n-    Optional<Map<String, State.ApplyResult>> applyState(String minionId, String state);\n-\n-}\n"}}, {"oid": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "url": "https://github.com/uyuni-project/uyuni/commit/4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "message": "fix ApiHandler", "committedDate": "2020-03-12T12:45:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4NDIxNA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392684214", "bodyText": "Nitpicks:\n\nmethod name: as this returns a Factory (rather than a Collection of Handlers), shouldn't these be named something like getTestHandlerFactory/getDefaultHandlerFactory instead of mockHandlers/defaultHandlers?\nshouldn't mockHandlers ideally live in unit test code only? Are there cons with that?", "author": "moio", "createdAt": "2020-03-15T15:25:34Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java", "diffHunk": "@@ -28,16 +82,95 @@\n  */\n \n public class HandlerFactory {\n-    private ManifestFactory factory;\n-    private static final String PKG_NAME = \"com.redhat.rhn.frontend.xmlrpc\";\n+    private final Map<String, BaseHandler> handlers;\n \n-    /** private constructor */\n+    /**\n+     *  Creates an empty HandlerFactory.\n+     */\n     public HandlerFactory() {\n-        this(new ClassBuilder(PKG_NAME, \"handler-manifest.xml\"));\n+        this.handlers = new HashMap<>();\n+    }\n+\n+    /**\n+     * HandlerFactory prepopulated with unit test handlers.\n+     * @return HandlerFactory for unit tests.\n+     */\n+    public static HandlerFactory mockHandlers() {", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU2ODQwMA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r393568400", "bodyText": "I'm not really happy with the naming overall here after the refactoring but i did not want to make too many changes in this PR. I adopted the names you suggest for now but i guess a follow up PR can just focus on finding more fitting names for those classes.\nAlso moved the mocking to a test utils class.", "author": "lucidd", "createdAt": "2020-03-17T10:09:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4NDIxNA=="}], "type": "inlineReview", "revised_code": {"commit": "4b40ef3d41dc7e2da404823be1fb706a57f72e43", "chunk": "diff --git a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\nindex 8ec649a858c..1e7219257ed 100644\n--- a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n+++ b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n\n@@ -75,8 +75,7 @@ import java.util.Optional;\n import java.util.Set;\n \n /**\n- * HandlerFactory, simple factory class that uses ManifestFactory to\n- * return RPC Handlers.\n+ * HandlerFactory for XMLRPC Handlers.\n  *\n  * @version $Rev$\n  */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4NTU4Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392685586", "bodyText": "Code does not agree with comment any longer", "author": "moio", "createdAt": "2020-03-15T15:39:51Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java", "diffHunk": "@@ -28,16 +82,95 @@\n  */", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b40ef3d41dc7e2da404823be1fb706a57f72e43", "chunk": "diff --git a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\nindex 8ec649a858c..1e7219257ed 100644\n--- a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n+++ b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n\n@@ -75,8 +75,7 @@ import java.util.Optional;\n import java.util.Set;\n \n /**\n- * HandlerFactory, simple factory class that uses ManifestFactory to\n- * return RPC Handlers.\n+ * HandlerFactory for XMLRPC Handlers.\n  *\n  * @version $Rev$\n  */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4Njg5MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392686890", "bodyText": "I wonder if we should allow using the non-mocked SaltService in test code (I understand this was the case even before this PR). What is your opinion?", "author": "moio", "createdAt": "2020-03-15T15:54:07Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/system/test/SystemHandlerTest.java", "diffHunk": "@@ -1859,7 +1860,11 @@ public void testSetDetailsBaseEntitlementAsNonOrgAdmin() throws Exception {\n     }\n \n     public void testAddEntitlements() throws Exception {\n-        Server server = ServerTestUtils.createVirtHostWithGuests(admin, 0);\n+        SystemEntitlementManager systemEntitlementManager = new SystemEntitlementManager(\n+                new SystemUnentitler(),\n+                new SystemEntitler(SaltService.INSTANCE)", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/redhat/rhn/frontend/xmlrpc/system/test/SystemHandlerTest.java b/java/code/src/com/redhat/rhn/frontend/xmlrpc/system/test/SystemHandlerTest.java\nindex b6d5e6a3a90..648bf4ce078 100644\n--- a/java/code/src/com/redhat/rhn/frontend/xmlrpc/system/test/SystemHandlerTest.java\n+++ b/java/code/src/com/redhat/rhn/frontend/xmlrpc/system/test/SystemHandlerTest.java\n\n@@ -1860,11 +1859,7 @@ public class SystemHandlerTest extends BaseHandlerTestCase {\n     }\n \n     public void testAddEntitlements() throws Exception {\n-        SystemEntitlementManager systemEntitlementManager = new SystemEntitlementManager(\n-                new SystemUnentitler(),\n-                new SystemEntitler(SaltService.INSTANCE)\n-        );\n-        Server server = ServerTestUtils.createVirtHostWithGuests(admin, 0, systemEntitlementManager);\n+        Server server = ServerTestUtils.createVirtHostWithGuests(admin, 0);\n \n         Integer serverId = server.getId().intValue();\n         List<String> entitlements = new LinkedList<String>() { {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4NzY5NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392687694", "bodyText": "I wonder if returning Optional is the right choice here, as I see that basically all call sites immediately use get() on the result.\nHow about instead throwing an unchecked, descriptive Exception here that will result in something like \"handlerName not found\" in logs, instead of NPE, whenever handlers.get yields null - thereby avoiding the Optional wrapping?\nWhat do you think, what would be pros and cons?", "author": "moio", "createdAt": "2020-03-15T16:03:22Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java", "diffHunk": "@@ -46,15 +179,15 @@ protected HandlerFactory(ClassBuilder builder) {\n      * @param handlerName the name of the handler\n      * @return Object of the handler in question.\n      */\n-    public BaseHandler getHandler(String handlerName) {\n-        return (BaseHandler)factory.getObject(handlerName);\n+    public Optional<BaseHandler> getHandler(String handlerName) {\n+        return Optional.ofNullable(handlers.get(handlerName));", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU2NzIyMg==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r393567222", "bodyText": "looking at the invocations there is really only 1 place that looks up a handler by user input. I added a orElseThrow there with a descriptive message. All the other invocations are either in tests or by using only values from getKeys. Optimally we should probably change this method to return a Set<Tuple2<String, BaseHandler>> so there is no need for an unsafe get.", "author": "lucidd", "createdAt": "2020-03-17T10:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4NzY5NA=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\nindex 8ec649a858c..d2c639ff630 100644\n--- a/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n+++ b/java/code/src/com/redhat/rhn/frontend/xmlrpc/HandlerFactory.java\n\n@@ -179,15 +46,15 @@ public class HandlerFactory {\n      * @param handlerName the name of the handler\n      * @return Object of the handler in question.\n      */\n-    public Optional<BaseHandler> getHandler(String handlerName) {\n-        return Optional.ofNullable(handlers.get(handlerName));\n+    public BaseHandler getHandler(String handlerName) {\n+        return (BaseHandler)factory.getObject(handlerName);\n     }\n \n     /**\n      * Get all keys from the Factory.\n      * @return All keys from the Factory.\n      */\n-    public Set<String> getKeys() {\n-        return handlers.keySet();\n+    public Collection getKeys() {\n+        return factory.getKeys();\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4OTQxNg==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392689416", "bodyText": "Should we move this outside the webui package? This sounds to me as not tied to the UI at all.", "author": "moio", "createdAt": "2020-03-15T16:23:10Z", "path": "java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java", "diffHunk": "@@ -0,0 +1,511 @@\n+/**\n+ * Copyright (c) 2020 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.iface;", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk3NDQ1Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392974457", "bodyText": "see #1954 (comment).", "author": "lucidd", "createdAt": "2020-03-16T12:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4OTQxNg=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java\ndeleted file mode 100644\nindex a4c9db9b37d..00000000000\n--- a/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java\n+++ /dev/null\n\n@@ -1,511 +0,0 @@\n-/**\n- * Copyright (c) 2020 SUSE LLC\n- *\n- * This software is licensed to you under the GNU General Public License,\n- * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n- * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n- * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n- * along with this software; if not, see\n- * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n- *\n- * Red Hat trademarks are not licensed under GPLv2. No permission is\n- * granted to use or replicate Red Hat trademarks that are incorporated\n- * in this software or its documentation.\n- */\n-package com.suse.manager.webui.services.iface;\n-\n-import com.google.gson.JsonObject;\n-import com.google.gson.reflect.TypeToken;\n-import com.google.gson.JsonElement;\n-import com.redhat.rhn.domain.server.MinionServer;\n-import com.suse.manager.reactor.SaltReactor;\n-import com.suse.manager.virtualization.GuestDefinition;\n-import com.suse.manager.virtualization.PoolCapabilitiesJson;\n-import com.suse.manager.virtualization.PoolDefinition;\n-import com.suse.manager.webui.services.impl.SaltSSHService;\n-import com.suse.manager.webui.services.impl.SaltService;\n-import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n-import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n-import com.suse.manager.webui.utils.gson.BootstrapParameters;\n-import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n-import com.suse.salt.netapi.calls.LocalAsyncResult;\n-import com.suse.salt.netapi.calls.LocalCall;\n-import com.suse.salt.netapi.calls.modules.SaltUtil;\n-import com.suse.salt.netapi.calls.modules.State;\n-import com.suse.salt.netapi.calls.modules.Zypper;\n-import com.suse.salt.netapi.calls.runner.Jobs;\n-import com.suse.salt.netapi.calls.wheel.Key;\n-import com.suse.salt.netapi.datatypes.target.MinionList;\n-import com.suse.salt.netapi.datatypes.target.Target;\n-import com.suse.salt.netapi.errors.GenericError;\n-import com.suse.salt.netapi.event.EventStream;\n-import com.suse.salt.netapi.exception.SaltException;\n-import com.suse.salt.netapi.results.Result;\n-import com.suse.salt.netapi.results.SSHResult;\n-\n-import java.time.LocalDateTime;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Optional;\n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.CompletionStage;\n-\n-/**\n- * Interface containing methods for directly interacting and getting information from a system.\n- * Note: This interface should be split up further at some point.\n- */\n-public interface SystemQuery {\n-\n-    /**\n-     * Query virtual host and domains capabilities.\n-     *\n-     * @param minionId the salt minion virtual host to ask about\n-     * @return the output of the salt virt.all_capabilities call in JSON\n-     */\n-    Optional<Map<String, JsonElement>> getCapabilities(String minionId);\n-\n-    /**\n-     * Query the list of virtual networks defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a list of the network names\n-     */\n-    Map<String, JsonObject> getNetworks(String minionId);\n-\n-    /**\n-     * Query virtual storage pool definition\n-     *\n-     * @param minionId the host minion ID\n-     * @param poolName the domain name to look for\n-     * @return the XML definition or an empty Optional\n-     */\n-    Optional<PoolDefinition> getPoolDefinition(String minionId, String poolName);\n-\n-    /**\n-     * Query virtual machine definition\n-     *\n-     * @param minionId the host minion ID\n-     * @param domainName the domain name to look for\n-     * @return the XML definition or an empty Optional\n-     */\n-    Optional<GuestDefinition> getGuestDefinition(String minionId, String domainName);\n-\n-    /**\n-     * Query virtual storage pool capabilities\n-     *\n-     * @param minionId the salt minion virtual host to ask about\n-     * @return the output of the salt virt.pool_capabilities call\n-     */\n-    Optional<PoolCapabilitiesJson> getPoolCapabilities(String minionId);\n-\n-    /**\n-     * call salt test.ping\n-     * @param minionId id of the target minion\n-     * @return true\n-     */\n-    Optional<Boolean> ping(String minionId);\n-\n-    /**\n-     * Get the minion keys from salt with their respective status.\n-     *\n-     * @return the keys with their respective status as returned from salt\n-     */\n-    Key.Names getKeys();\n-\n-    /**\n-     * For a given minion id check if there is a key in any of the given status. If no status is given as parameter,\n-     * all the available status are considered.\n-     *\n-     * @param id the id to check for\n-     * @param statusIn array of key status to consider\n-     * @return true if there is a key with the given id, false otherwise\n-     */\n-    boolean keyExists(String id, SaltService.KeyStatus... statusIn);\n-\n-    /**\n-     * Get the minion keys from salt with their respective status and fingerprint.\n-     *\n-     * @return the keys with their respective status and fingerprint as returned from salt\n-     */\n-    Key.Fingerprints getFingerprints();\n-\n-    /**\n-     * Generate a key pair for the given id and accept the public key.\n-     *\n-     * @param id the id to use\n-     * @param force set true to overwrite an already existing key\n-     * @return the generated key pair\n-     */\n-    Key.Pair generateKeysAndAccept(String id, boolean force);\n-\n-    /**\n-     * Get the machine id for a given minion.\n-     *\n-     * @param minionId id of the target minion\n-     * @return the machine id as a string\n-     */\n-    Optional<String> getMachineId(String minionId);\n-\n-    /**\n-     * Delete a given minion's key.\n-     *\n-     * @param minionId id of the minion\n-     */\n-    void deleteKey(String minionId);\n-\n-    /**\n-     * Accept all keys matching the given pattern\n-     *\n-     * @param match a pattern for minion ids\n-     */\n-    void acceptKey(String match);\n-\n-    /**\n-     * Reject a given minion's key.\n-     *\n-     * @param minionId id of the minion\n-     */\n-    void rejectKey(String minionId);\n-\n-    /**\n-     * Delete a Salt key from the \"Rejected Keys\" category using the mgrutil runner.\n-     *\n-     * @param minionId the minionId to look for in \"Rejected Keys\"\n-     * @return the result of the runner call as a map\n-     */\n-    Optional<MgrUtilRunner.ExecResult> deleteRejectedKey(String minionId);\n-\n-    /**\n-     * Return the stream of events happening in salt.\n-     *\n-     * @return the event stream\n-     * @throws SaltException exception occured during connection (if any)\n-     */\n-    EventStream getEventStream() throws SaltException;\n-\n-    /**\n-     * Run a remote command on a given minion.\n-     *\n-     * @param target the target\n-     * @param cmd the command\n-     * @return the output of the command\n-     */\n-    Map<String, Result<String>> runRemoteCommand(MinionList target, String cmd);\n-\n-    /**\n-     * Run a remote command on a given minion asynchronously.\n-     * @param target the target\n-     * @param cmd the command to execute\n-     * @param cancel a future used to cancel waiting on return events\n-     * @return a map holding a {@link CompletionStage}s for each minion\n-     */\n-    Map<String, CompletionStage<Result<String>>> runRemoteCommandAsync(\n-            MinionList target, String cmd, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Query the list of virtual storage pools defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a map associating pool names with their informations as Json elements\n-     */\n-    Map<String, JsonObject> getPools(String minionId);\n-\n-    /**\n-     * Query the list of virtual storage volumes defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a map associating pool names with the list of volumes it contains mapped by their names\n-     */\n-    Map<String, Map<String, JsonObject>> getVolumes(String minionId);\n-\n-    /**\n-     * Returns the currently running jobs on the target\n-     *\n-     * @param target the target\n-     * @return list of running jobs\n-     */\n-    Map<String, Result<List<SaltUtil.RunningInfo>>> running(MinionList target);\n-\n-    /**\n-     * Return the result for a jobId\n-     *\n-     * @param jid the job id\n-     * @return map from minion to result\n-     */\n-    Optional<Jobs.Info> listJob(String jid);\n-\n-    /**\n-     * Match the given target expression asynchronously.\n-     * @param target the target expression\n-     * @param cancel  a future used to cancel waiting on return events\n-     * @return a map holding a {@link CompletionStage}s for each minion\n-     */\n-    Map<String, CompletionStage<Result<Boolean>>> matchAsync(\n-            String target, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Executes match.glob in another thread and returns a {@link CompletionStage}.\n-     * @param target the target to pass to match.glob\n-     * @param cancel a future used to cancel waiting\n-     * @return a future or Optional.empty if there's no ssh-push minion in the db\n-     */\n-    Optional<CompletionStage<Map<String, Result<Boolean>>>> matchAsyncSSH(\n-            String target, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Call 'saltutil.refresh_pillar' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void refreshPillar(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_grains' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncGrains(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_modules' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncModules(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_all' to sync everything to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncAll(MinionList minionList);\n-\n-    /**\n-     * Performs an test.echo on a target set of minions for checkIn purpose.\n-     * @param targetIn the target\n-     * @return the LocalAsyncResult of the test.echo call\n-     * @throws SaltException if we get a failure from Salt\n-     */\n-    Optional<LocalAsyncResult<String>> checkIn(MinionList targetIn) throws SaltException;\n-\n-    /**\n-     * Apply util.systeminfo state on the specified minion list\n-     * @param minionTarget minion list\n-     */\n-    void updateSystemInfo(MinionList minionTarget);\n-\n-    /**\n-     * Gets a minion's master hostname.\n-     *\n-     * @param minionId the minion id\n-     * @return the master hostname\n-     */\n-    Optional<String> getMasterHostname(String minionId);\n-\n-    /**\n-     * Bootstrap a system using salt-ssh.\n-     *\n-     * @param parameters - bootstrap parameters\n-     * @param bootstrapMods - state modules to be applied during the bootstrap\n-     * @param pillarData - pillar data used salt-ssh call\n-     * @throws SaltException if something goes wrong during command execution or\n-     * during manipulation the salt-ssh roster\n-     * @return the result of the underlying ssh call for given host\n-     */\n-    Result<SSHResult<Map<String, State.ApplyResult>>> bootstrapMinion(\n-            BootstrapParameters parameters, List<String> bootstrapMods,\n-            Map<String, Object> pillarData) throws SaltException;\n-\n-    /**\n-     * Store the files uploaded by a minion to the SCAP storage directory.\n-     * @param minion the minion\n-     * @param uploadDir the uploadDir\n-     * @param actionId the action id\n-     * @return a map with one element: @{code true} -> scap store path,\n-     * {@code false} -> err message\n-     *\n-     */\n-    Map<Boolean, String> storeMinionScapFiles(MinionServer minion, String uploadDir, Long actionId);\n-\n-    /**\n-     * Call the custom mgrutil.ssh_keygen runner if the key files are not present.\n-     *\n-     * @param path of the key files\n-     * @return the result of the runner call as a map\n-     */\n-    Optional<MgrUtilRunner.ExecResult> generateSSHKey(String path);\n-\n-    /**\n-     * Chain ssh calls over one or more hops to run a command on the last host in the chain.\n-     * This calls the mgrutil.chain_ssh_command runner.\n-     *\n-     * @param hosts a list of hosts, where the last one is where\n-     *              the command will be executed\n-     * @param clientKey the ssh key to use to connect to the first host\n-     * @param proxyKey the ssh key path to use for the rest of the hosts\n-     * @param user the user\n-     * @param options ssh options\n-     * @param command the command to execute\n-     * @param outputfile the file to which to dump the command stdout\n-     * @return the execution result\n-     */\n-    Optional<MgrUtilRunner.ExecResult> chainSSHCommand(List<String> hosts, String clientKey, String proxyKey,\n-            String user, Map<String, String> options, String command, String outputfile);\n-\n-    /**\n-     * Get information about all containers running in a Kubernetes cluster.\n-     * @param kubeconfig path to the kubeconfig file\n-     * @param context kubeconfig context to use\n-     * @return a list of containers\n-     */\n-    Optional<List<MgrK8sRunner.Container>> getAllContainers(String kubeconfig, String context);\n-\n-    /**\n-     * Remove SUSE Manager specific configuration from a Salt minion.\n-     *\n-     * @param minion the minion.\n-     * @param timeout operation timeout\n-     * @return list of error messages or empty if no error\n-     */\n-    Optional<List<String>> cleanupMinion(MinionServer minion, int timeout);\n-\n-    /**\n-     * Send notification about a system id to be generated.\n-     * @param minion target minion.\n-     * @throws InstantiationException if signature generation fails\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    void notifySystemIdGenerated(MinionServer minion) throws InstantiationException, SaltException;\n-\n-    /**\n-     * Get pending resume information.\n-     * @param minionIds to target.\n-     * @return pending resume information.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    Map<String, Result<Map<String, String>>> getPendingResume(List<String> minionIds) throws SaltException;\n-\n-    /**\n-     * Return show highstate result.\n-     * @param minionId of the target minion.\n-     * @return show highstate result.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    Map<String, Result<Object>> showHighstate(String minionId) throws SaltException;\n-\n-    /**\n-     * Query product information.\n-     * @param minionId of the target minion.\n-     * @return product information\n-     */\n-    Optional<List<Zypper.ProductInfo>> getProducts(String minionId);\n-\n-    /**\n-     * Execute a LocalCall asynchronously on the default Salt client.\n-     *\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param <T> the return type of the call\n-     * @param callIn the call to execute\n-     * @param target minions targeted by the call\n-     * @param metadataIn the metadata to be passed in the call\n-     * @return the LocalAsyncResult of the call\n-     * @throws SaltException in case of an error executing the job with Salt\n-     */\n-    @Deprecated\n-    <T> Optional<LocalAsyncResult<T>> callAsync(LocalCall<T> callIn, Target<?> target,\n-            Optional<ScheduleMetadata> metadataIn) throws SaltException;\n-\n-    /**\n-     * Sync the channels of a list of minions\n-     * @param minionIds of the targets.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    void deployChannels(List<String> minionIds) throws SaltException;\n-\n-    /**\n-     * Upload built Kiwi image to SUSE Manager\n-     *\n-     * @param minion     the minion\n-     * @param filepath   the filepath of the image to upload, in the build host\n-     * @param imageStore the image store location\n-     * @return the execution result\n-     */\n-    Optional<MgrUtilRunner.ExecResult> collectKiwiImage(MinionServer minion, String filepath,\n-            String imageStore);\n-\n-    /**\n-     * Update libvirt engine on a given minion.\n-     * @param minion to update.\n-     */\n-    void updateLibvirtEngine(MinionServer minion);\n-\n-    /**\n-     * Execute generic salt call.\n-     * @param call salt call to execute.\n-     * @param minionId of the target minion.\n-     * @return raw salt call result in json format.\n-     */\n-    Optional<JsonElement> rawJsonCall(LocalCall<?> call, String minionId);\n-\n-    /**\n-     * Return the jobcache filtered by metadata\n-     *\n-     * @param metadata search metadata\n-     * @return list of running jobs\n-     */\n-    Optional<Map<String, Jobs.ListJobsEntry>> jobsByMetadata(Object metadata);\n-\n-    /**\n-     * Return the jobcache filtered by metadata and start and end time.\n-     *\n-     * @param metadata search metadata\n-     * @param startTime jobs start time\n-     * @param endTime jobs end time\n-     * @return list of running jobs\n-     */\n-    Optional<Map<String, Jobs.ListJobsEntry>> jobsByMetadata(Object metadata, LocalDateTime startTime,\n-            LocalDateTime endTime);\n-\n-    /**\n-     * Get the specified grains for a given minion.\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId id of the target minion\n-     * @param type  class type, result should be parsed into\n-     * @param grainNames list of grains names\n-     * @param <T> Type result should be parsed into\n-     * @return Optional containing the grains parsed into specified type\n-     */\n-    @Deprecated\n-    <T> Optional<T> getGrains(String minionId, TypeToken<T> type, String... grainNames);\n-\n-    /**\n-     * Get the grains for a given minion.\n-     *\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId id of the target minion\n-     * @return map containing the grains\n-     */\n-    @Deprecated\n-    Optional<Map<String, Object>> getGrains(String minionId);\n-\n-    /**\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param reactorIn the salt reactor.\n-     */\n-    @Deprecated\n-    void setReactor(SaltReactor reactorIn);\n-\n-    /**\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @return saltSSHService to get\n-     */\n-    @Deprecated\n-    SaltSSHService getSaltSSHService();\n-\n-    /**\n-     * Apply a state synchronously.\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId the minion id\n-     * @param state the state to apply\n-     * @return the result of applying the state\n-     */\n-    @Deprecated\n-    Optional<Map<String, State.ApplyResult>> applyState(String minionId, String state);\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MDc0MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392690740", "bodyText": "I have to say I felt a bit confused with the name of this interface. My sense of confusion comes from two aspects.\nFirst: in English, \"query\" by and large means \"question\" (see wiktionary), which is not really what we have here. Classes implementing this interface sound more to me like a \"query acceptors\", \"query processors\", \"system information retrievers\" - if we exclude ping, acceptKey/rejectKey and similar methods which are not really \"read-only\".\n\"Querier\" sounds a bit strange but would fit at least for me, at least for the \"read-only\" methods. \"Writing\" methods could be given an \"Actuator\" name or something similar, with SaltService implementing both. How does that feel to you?\nSecond problem, is that at least now I see this as quite coupled with Salt (acceptKey, getFingerprints, refreshPillar...), so I am not sure we want to give it an overgeneral name at least for now. How about using Minion or SaltClient as the prefix instead of System?", "author": "moio", "createdAt": "2020-03-15T16:38:44Z", "path": "java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java", "diffHunk": "@@ -0,0 +1,511 @@\n+/**\n+ * Copyright (c) 2020 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services.iface;\n+\n+import com.google.gson.JsonObject;\n+import com.google.gson.reflect.TypeToken;\n+import com.google.gson.JsonElement;\n+import com.redhat.rhn.domain.server.MinionServer;\n+import com.suse.manager.reactor.SaltReactor;\n+import com.suse.manager.virtualization.GuestDefinition;\n+import com.suse.manager.virtualization.PoolCapabilitiesJson;\n+import com.suse.manager.virtualization.PoolDefinition;\n+import com.suse.manager.webui.services.impl.SaltSSHService;\n+import com.suse.manager.webui.services.impl.SaltService;\n+import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n+import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n+import com.suse.manager.webui.utils.gson.BootstrapParameters;\n+import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n+import com.suse.salt.netapi.calls.LocalAsyncResult;\n+import com.suse.salt.netapi.calls.LocalCall;\n+import com.suse.salt.netapi.calls.modules.SaltUtil;\n+import com.suse.salt.netapi.calls.modules.State;\n+import com.suse.salt.netapi.calls.modules.Zypper;\n+import com.suse.salt.netapi.calls.runner.Jobs;\n+import com.suse.salt.netapi.calls.wheel.Key;\n+import com.suse.salt.netapi.datatypes.target.MinionList;\n+import com.suse.salt.netapi.datatypes.target.Target;\n+import com.suse.salt.netapi.errors.GenericError;\n+import com.suse.salt.netapi.event.EventStream;\n+import com.suse.salt.netapi.exception.SaltException;\n+import com.suse.salt.netapi.results.Result;\n+import com.suse.salt.netapi.results.SSHResult;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionStage;\n+\n+/**\n+ * Interface containing methods for directly interacting and getting information from a system.\n+ * Note: This interface should be split up further at some point.\n+ */\n+public interface SystemQuery {", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java b/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java\ndeleted file mode 100644\nindex a4c9db9b37d..00000000000\n--- a/java/code/src/com/suse/manager/webui/services/iface/SystemQuery.java\n+++ /dev/null\n\n@@ -1,511 +0,0 @@\n-/**\n- * Copyright (c) 2020 SUSE LLC\n- *\n- * This software is licensed to you under the GNU General Public License,\n- * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n- * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n- * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n- * along with this software; if not, see\n- * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n- *\n- * Red Hat trademarks are not licensed under GPLv2. No permission is\n- * granted to use or replicate Red Hat trademarks that are incorporated\n- * in this software or its documentation.\n- */\n-package com.suse.manager.webui.services.iface;\n-\n-import com.google.gson.JsonObject;\n-import com.google.gson.reflect.TypeToken;\n-import com.google.gson.JsonElement;\n-import com.redhat.rhn.domain.server.MinionServer;\n-import com.suse.manager.reactor.SaltReactor;\n-import com.suse.manager.virtualization.GuestDefinition;\n-import com.suse.manager.virtualization.PoolCapabilitiesJson;\n-import com.suse.manager.virtualization.PoolDefinition;\n-import com.suse.manager.webui.services.impl.SaltSSHService;\n-import com.suse.manager.webui.services.impl.SaltService;\n-import com.suse.manager.webui.services.impl.runner.MgrK8sRunner;\n-import com.suse.manager.webui.services.impl.runner.MgrUtilRunner;\n-import com.suse.manager.webui.utils.gson.BootstrapParameters;\n-import com.suse.manager.webui.utils.salt.custom.ScheduleMetadata;\n-import com.suse.salt.netapi.calls.LocalAsyncResult;\n-import com.suse.salt.netapi.calls.LocalCall;\n-import com.suse.salt.netapi.calls.modules.SaltUtil;\n-import com.suse.salt.netapi.calls.modules.State;\n-import com.suse.salt.netapi.calls.modules.Zypper;\n-import com.suse.salt.netapi.calls.runner.Jobs;\n-import com.suse.salt.netapi.calls.wheel.Key;\n-import com.suse.salt.netapi.datatypes.target.MinionList;\n-import com.suse.salt.netapi.datatypes.target.Target;\n-import com.suse.salt.netapi.errors.GenericError;\n-import com.suse.salt.netapi.event.EventStream;\n-import com.suse.salt.netapi.exception.SaltException;\n-import com.suse.salt.netapi.results.Result;\n-import com.suse.salt.netapi.results.SSHResult;\n-\n-import java.time.LocalDateTime;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Optional;\n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.CompletionStage;\n-\n-/**\n- * Interface containing methods for directly interacting and getting information from a system.\n- * Note: This interface should be split up further at some point.\n- */\n-public interface SystemQuery {\n-\n-    /**\n-     * Query virtual host and domains capabilities.\n-     *\n-     * @param minionId the salt minion virtual host to ask about\n-     * @return the output of the salt virt.all_capabilities call in JSON\n-     */\n-    Optional<Map<String, JsonElement>> getCapabilities(String minionId);\n-\n-    /**\n-     * Query the list of virtual networks defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a list of the network names\n-     */\n-    Map<String, JsonObject> getNetworks(String minionId);\n-\n-    /**\n-     * Query virtual storage pool definition\n-     *\n-     * @param minionId the host minion ID\n-     * @param poolName the domain name to look for\n-     * @return the XML definition or an empty Optional\n-     */\n-    Optional<PoolDefinition> getPoolDefinition(String minionId, String poolName);\n-\n-    /**\n-     * Query virtual machine definition\n-     *\n-     * @param minionId the host minion ID\n-     * @param domainName the domain name to look for\n-     * @return the XML definition or an empty Optional\n-     */\n-    Optional<GuestDefinition> getGuestDefinition(String minionId, String domainName);\n-\n-    /**\n-     * Query virtual storage pool capabilities\n-     *\n-     * @param minionId the salt minion virtual host to ask about\n-     * @return the output of the salt virt.pool_capabilities call\n-     */\n-    Optional<PoolCapabilitiesJson> getPoolCapabilities(String minionId);\n-\n-    /**\n-     * call salt test.ping\n-     * @param minionId id of the target minion\n-     * @return true\n-     */\n-    Optional<Boolean> ping(String minionId);\n-\n-    /**\n-     * Get the minion keys from salt with their respective status.\n-     *\n-     * @return the keys with their respective status as returned from salt\n-     */\n-    Key.Names getKeys();\n-\n-    /**\n-     * For a given minion id check if there is a key in any of the given status. If no status is given as parameter,\n-     * all the available status are considered.\n-     *\n-     * @param id the id to check for\n-     * @param statusIn array of key status to consider\n-     * @return true if there is a key with the given id, false otherwise\n-     */\n-    boolean keyExists(String id, SaltService.KeyStatus... statusIn);\n-\n-    /**\n-     * Get the minion keys from salt with their respective status and fingerprint.\n-     *\n-     * @return the keys with their respective status and fingerprint as returned from salt\n-     */\n-    Key.Fingerprints getFingerprints();\n-\n-    /**\n-     * Generate a key pair for the given id and accept the public key.\n-     *\n-     * @param id the id to use\n-     * @param force set true to overwrite an already existing key\n-     * @return the generated key pair\n-     */\n-    Key.Pair generateKeysAndAccept(String id, boolean force);\n-\n-    /**\n-     * Get the machine id for a given minion.\n-     *\n-     * @param minionId id of the target minion\n-     * @return the machine id as a string\n-     */\n-    Optional<String> getMachineId(String minionId);\n-\n-    /**\n-     * Delete a given minion's key.\n-     *\n-     * @param minionId id of the minion\n-     */\n-    void deleteKey(String minionId);\n-\n-    /**\n-     * Accept all keys matching the given pattern\n-     *\n-     * @param match a pattern for minion ids\n-     */\n-    void acceptKey(String match);\n-\n-    /**\n-     * Reject a given minion's key.\n-     *\n-     * @param minionId id of the minion\n-     */\n-    void rejectKey(String minionId);\n-\n-    /**\n-     * Delete a Salt key from the \"Rejected Keys\" category using the mgrutil runner.\n-     *\n-     * @param minionId the minionId to look for in \"Rejected Keys\"\n-     * @return the result of the runner call as a map\n-     */\n-    Optional<MgrUtilRunner.ExecResult> deleteRejectedKey(String minionId);\n-\n-    /**\n-     * Return the stream of events happening in salt.\n-     *\n-     * @return the event stream\n-     * @throws SaltException exception occured during connection (if any)\n-     */\n-    EventStream getEventStream() throws SaltException;\n-\n-    /**\n-     * Run a remote command on a given minion.\n-     *\n-     * @param target the target\n-     * @param cmd the command\n-     * @return the output of the command\n-     */\n-    Map<String, Result<String>> runRemoteCommand(MinionList target, String cmd);\n-\n-    /**\n-     * Run a remote command on a given minion asynchronously.\n-     * @param target the target\n-     * @param cmd the command to execute\n-     * @param cancel a future used to cancel waiting on return events\n-     * @return a map holding a {@link CompletionStage}s for each minion\n-     */\n-    Map<String, CompletionStage<Result<String>>> runRemoteCommandAsync(\n-            MinionList target, String cmd, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Query the list of virtual storage pools defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a map associating pool names with their informations as Json elements\n-     */\n-    Map<String, JsonObject> getPools(String minionId);\n-\n-    /**\n-     * Query the list of virtual storage volumes defined on a salt minion.\n-     *\n-     * @param minionId the minion to ask about\n-     * @return a map associating pool names with the list of volumes it contains mapped by their names\n-     */\n-    Map<String, Map<String, JsonObject>> getVolumes(String minionId);\n-\n-    /**\n-     * Returns the currently running jobs on the target\n-     *\n-     * @param target the target\n-     * @return list of running jobs\n-     */\n-    Map<String, Result<List<SaltUtil.RunningInfo>>> running(MinionList target);\n-\n-    /**\n-     * Return the result for a jobId\n-     *\n-     * @param jid the job id\n-     * @return map from minion to result\n-     */\n-    Optional<Jobs.Info> listJob(String jid);\n-\n-    /**\n-     * Match the given target expression asynchronously.\n-     * @param target the target expression\n-     * @param cancel  a future used to cancel waiting on return events\n-     * @return a map holding a {@link CompletionStage}s for each minion\n-     */\n-    Map<String, CompletionStage<Result<Boolean>>> matchAsync(\n-            String target, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Executes match.glob in another thread and returns a {@link CompletionStage}.\n-     * @param target the target to pass to match.glob\n-     * @param cancel a future used to cancel waiting\n-     * @return a future or Optional.empty if there's no ssh-push minion in the db\n-     */\n-    Optional<CompletionStage<Map<String, Result<Boolean>>>> matchAsyncSSH(\n-            String target, CompletableFuture<GenericError> cancel);\n-\n-    /**\n-     * Call 'saltutil.refresh_pillar' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void refreshPillar(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_grains' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncGrains(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_modules' to sync the grains to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncModules(MinionList minionList);\n-\n-    /**\n-     * Call 'saltutil.sync_all' to sync everything to the target minion(s).\n-     * @param minionList minion list\n-     */\n-    void syncAll(MinionList minionList);\n-\n-    /**\n-     * Performs an test.echo on a target set of minions for checkIn purpose.\n-     * @param targetIn the target\n-     * @return the LocalAsyncResult of the test.echo call\n-     * @throws SaltException if we get a failure from Salt\n-     */\n-    Optional<LocalAsyncResult<String>> checkIn(MinionList targetIn) throws SaltException;\n-\n-    /**\n-     * Apply util.systeminfo state on the specified minion list\n-     * @param minionTarget minion list\n-     */\n-    void updateSystemInfo(MinionList minionTarget);\n-\n-    /**\n-     * Gets a minion's master hostname.\n-     *\n-     * @param minionId the minion id\n-     * @return the master hostname\n-     */\n-    Optional<String> getMasterHostname(String minionId);\n-\n-    /**\n-     * Bootstrap a system using salt-ssh.\n-     *\n-     * @param parameters - bootstrap parameters\n-     * @param bootstrapMods - state modules to be applied during the bootstrap\n-     * @param pillarData - pillar data used salt-ssh call\n-     * @throws SaltException if something goes wrong during command execution or\n-     * during manipulation the salt-ssh roster\n-     * @return the result of the underlying ssh call for given host\n-     */\n-    Result<SSHResult<Map<String, State.ApplyResult>>> bootstrapMinion(\n-            BootstrapParameters parameters, List<String> bootstrapMods,\n-            Map<String, Object> pillarData) throws SaltException;\n-\n-    /**\n-     * Store the files uploaded by a minion to the SCAP storage directory.\n-     * @param minion the minion\n-     * @param uploadDir the uploadDir\n-     * @param actionId the action id\n-     * @return a map with one element: @{code true} -> scap store path,\n-     * {@code false} -> err message\n-     *\n-     */\n-    Map<Boolean, String> storeMinionScapFiles(MinionServer minion, String uploadDir, Long actionId);\n-\n-    /**\n-     * Call the custom mgrutil.ssh_keygen runner if the key files are not present.\n-     *\n-     * @param path of the key files\n-     * @return the result of the runner call as a map\n-     */\n-    Optional<MgrUtilRunner.ExecResult> generateSSHKey(String path);\n-\n-    /**\n-     * Chain ssh calls over one or more hops to run a command on the last host in the chain.\n-     * This calls the mgrutil.chain_ssh_command runner.\n-     *\n-     * @param hosts a list of hosts, where the last one is where\n-     *              the command will be executed\n-     * @param clientKey the ssh key to use to connect to the first host\n-     * @param proxyKey the ssh key path to use for the rest of the hosts\n-     * @param user the user\n-     * @param options ssh options\n-     * @param command the command to execute\n-     * @param outputfile the file to which to dump the command stdout\n-     * @return the execution result\n-     */\n-    Optional<MgrUtilRunner.ExecResult> chainSSHCommand(List<String> hosts, String clientKey, String proxyKey,\n-            String user, Map<String, String> options, String command, String outputfile);\n-\n-    /**\n-     * Get information about all containers running in a Kubernetes cluster.\n-     * @param kubeconfig path to the kubeconfig file\n-     * @param context kubeconfig context to use\n-     * @return a list of containers\n-     */\n-    Optional<List<MgrK8sRunner.Container>> getAllContainers(String kubeconfig, String context);\n-\n-    /**\n-     * Remove SUSE Manager specific configuration from a Salt minion.\n-     *\n-     * @param minion the minion.\n-     * @param timeout operation timeout\n-     * @return list of error messages or empty if no error\n-     */\n-    Optional<List<String>> cleanupMinion(MinionServer minion, int timeout);\n-\n-    /**\n-     * Send notification about a system id to be generated.\n-     * @param minion target minion.\n-     * @throws InstantiationException if signature generation fails\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    void notifySystemIdGenerated(MinionServer minion) throws InstantiationException, SaltException;\n-\n-    /**\n-     * Get pending resume information.\n-     * @param minionIds to target.\n-     * @return pending resume information.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    Map<String, Result<Map<String, String>>> getPendingResume(List<String> minionIds) throws SaltException;\n-\n-    /**\n-     * Return show highstate result.\n-     * @param minionId of the target minion.\n-     * @return show highstate result.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    Map<String, Result<Object>> showHighstate(String minionId) throws SaltException;\n-\n-    /**\n-     * Query product information.\n-     * @param minionId of the target minion.\n-     * @return product information\n-     */\n-    Optional<List<Zypper.ProductInfo>> getProducts(String minionId);\n-\n-    /**\n-     * Execute a LocalCall asynchronously on the default Salt client.\n-     *\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param <T> the return type of the call\n-     * @param callIn the call to execute\n-     * @param target minions targeted by the call\n-     * @param metadataIn the metadata to be passed in the call\n-     * @return the LocalAsyncResult of the call\n-     * @throws SaltException in case of an error executing the job with Salt\n-     */\n-    @Deprecated\n-    <T> Optional<LocalAsyncResult<T>> callAsync(LocalCall<T> callIn, Target<?> target,\n-            Optional<ScheduleMetadata> metadataIn) throws SaltException;\n-\n-    /**\n-     * Sync the channels of a list of minions\n-     * @param minionIds of the targets.\n-     * @throws SaltException if anything goes wrong.\n-     */\n-    void deployChannels(List<String> minionIds) throws SaltException;\n-\n-    /**\n-     * Upload built Kiwi image to SUSE Manager\n-     *\n-     * @param minion     the minion\n-     * @param filepath   the filepath of the image to upload, in the build host\n-     * @param imageStore the image store location\n-     * @return the execution result\n-     */\n-    Optional<MgrUtilRunner.ExecResult> collectKiwiImage(MinionServer minion, String filepath,\n-            String imageStore);\n-\n-    /**\n-     * Update libvirt engine on a given minion.\n-     * @param minion to update.\n-     */\n-    void updateLibvirtEngine(MinionServer minion);\n-\n-    /**\n-     * Execute generic salt call.\n-     * @param call salt call to execute.\n-     * @param minionId of the target minion.\n-     * @return raw salt call result in json format.\n-     */\n-    Optional<JsonElement> rawJsonCall(LocalCall<?> call, String minionId);\n-\n-    /**\n-     * Return the jobcache filtered by metadata\n-     *\n-     * @param metadata search metadata\n-     * @return list of running jobs\n-     */\n-    Optional<Map<String, Jobs.ListJobsEntry>> jobsByMetadata(Object metadata);\n-\n-    /**\n-     * Return the jobcache filtered by metadata and start and end time.\n-     *\n-     * @param metadata search metadata\n-     * @param startTime jobs start time\n-     * @param endTime jobs end time\n-     * @return list of running jobs\n-     */\n-    Optional<Map<String, Jobs.ListJobsEntry>> jobsByMetadata(Object metadata, LocalDateTime startTime,\n-            LocalDateTime endTime);\n-\n-    /**\n-     * Get the specified grains for a given minion.\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId id of the target minion\n-     * @param type  class type, result should be parsed into\n-     * @param grainNames list of grains names\n-     * @param <T> Type result should be parsed into\n-     * @return Optional containing the grains parsed into specified type\n-     */\n-    @Deprecated\n-    <T> Optional<T> getGrains(String minionId, TypeToken<T> type, String... grainNames);\n-\n-    /**\n-     * Get the grains for a given minion.\n-     *\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId id of the target minion\n-     * @return map containing the grains\n-     */\n-    @Deprecated\n-    Optional<Map<String, Object>> getGrains(String minionId);\n-\n-    /**\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param reactorIn the salt reactor.\n-     */\n-    @Deprecated\n-    void setReactor(SaltReactor reactorIn);\n-\n-    /**\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @return saltSSHService to get\n-     */\n-    @Deprecated\n-    SaltSSHService getSaltSSHService();\n-\n-    /**\n-     * Apply a state synchronously.\n-     * @deprecated this function is too general and should be replaced by more specific functionality.\n-     * @param minionId the minion id\n-     * @param state the state to apply\n-     * @return the result of applying the state\n-     */\n-    @Deprecated\n-    Optional<Map<String, State.ApplyResult>> applyState(String minionId, String state);\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MTIyOA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392691228", "bodyText": "This seems to be dead code now (as it should be!)\nConsider removing.", "author": "moio", "createdAt": "2020-03-15T16:45:02Z", "path": "java/code/src/com/redhat/rhn/manager/system/entitling/SystemEntitler.java", "diffHunk": "@@ -330,6 +330,6 @@ else if (toolsChannel == null) {\n      * @param saltServiceIn The SaltService\n      */\n     public void setSaltService(SaltService saltServiceIn) {", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b40ef3d41dc7e2da404823be1fb706a57f72e43", "chunk": "diff --git a/java/code/src/com/redhat/rhn/manager/system/entitling/SystemEntitler.java b/java/code/src/com/redhat/rhn/manager/system/entitling/SystemEntitler.java\nindex 5fae4eaefc0..ca4e76587d1 100644\n--- a/java/code/src/com/redhat/rhn/manager/system/entitling/SystemEntitler.java\n+++ b/java/code/src/com/redhat/rhn/manager/system/entitling/SystemEntitler.java\n\n@@ -324,12 +324,4 @@ public class SystemEntitler {\n                     ChannelManager.RHN_VIRT_HOST_PACKAGE_NAME));\n         }\n     }\n-\n-    /**\n-     * Setter for the SaltService\n-     * @param saltServiceIn The SaltService\n-     */\n-    public void setSaltService(SaltService saltServiceIn) {\n-        this.systemQuery = saltServiceIn;\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MTk5Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392691996", "bodyText": "Isn't this pattern more brittle to future changes that require more functionality from SaltService?\nBefore: one only whitelists methods available from mocked class. If an unexpected method is called, it fails immediately\nAfter: one uses the real class, but overwrites some methods. New calls might go undetected, or it might be more difficult to see why they fail\nAm I missing something? Do you see other pros I am currently not seeing?", "author": "moio", "createdAt": "2020-03-15T16:55:21Z", "path": "java/code/src/com/suse/manager/matcher/test/MatcherJsonIOTest.java", "diffHunk": "@@ -65,19 +68,22 @@\n     private static final String AMD64_ARCH = \"amd64\";\n     private static final String S390_ARCH = \"s390\";\n     private static final String PPC64LE_ARCH = \"ppc64le\";\n+    private SystemEntitlementManager systemEntitlementManager;\n \n     @Override\n     public void setUp() throws Exception {\n         super.setUp();\n         setImposteriser(ClassImposteriser.INSTANCE);\n \n-        SaltService saltServiceMock = context().mock(SaltService.class);\n-        context().checking(new Expectations() {{\n-            allowing(saltServiceMock).callSync(\n-                    with(any(LocalCall.class)),\n-                    with(any(String.class)));\n-        }});\n-        SystemEntitler.INSTANCE.setSaltService(saltServiceMock);\n+        SaltService saltServiceMock = new SaltService() {", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1ODQ4MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r393258481", "bodyText": "The primary reason for getting rid of the mocking framework is to make tests easier to understand/write since everybody knows basic inheritance and overriding methods.\nAnother minor benefit is failure at compile time rather then runtime when changing return types of methods.\nI don't worry about calls going undetected since that would mean the test passing. It could be more difficult to see why something fails in some case in most it will probably lead to an exception with a stacktrace since most methods are mocking things that are not available in the test environment. We could retain this behavior by having a test implementation of each interface that throws an not implemented exception for every method that is not overridden.", "author": "lucidd", "createdAt": "2020-03-16T19:19:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMzNTQ3OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r393335479", "bodyText": "I agree with this perspective and leave it up to you to decide if and when such a test implementation makes sense. Thanks", "author": "moio", "createdAt": "2020-03-16T22:05:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MTk5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/suse/manager/matcher/test/MatcherJsonIOTest.java b/java/code/src/com/suse/manager/matcher/test/MatcherJsonIOTest.java\nindex fc7ead4782e..55a5a9ab481 100644\n--- a/java/code/src/com/suse/manager/matcher/test/MatcherJsonIOTest.java\n+++ b/java/code/src/com/suse/manager/matcher/test/MatcherJsonIOTest.java\n\n@@ -68,22 +65,19 @@ public class MatcherJsonIOTest extends JMockBaseTestCaseWithUser {\n     private static final String AMD64_ARCH = \"amd64\";\n     private static final String S390_ARCH = \"s390\";\n     private static final String PPC64LE_ARCH = \"ppc64le\";\n-    private SystemEntitlementManager systemEntitlementManager;\n \n     @Override\n     public void setUp() throws Exception {\n         super.setUp();\n         setImposteriser(ClassImposteriser.INSTANCE);\n \n-        SaltService saltServiceMock = new SaltService() {\n-            @Override\n-            public void updateLibvirtEngine(MinionServer minion) {\n-            }\n-        };\n-        systemEntitlementManager = new SystemEntitlementManager(\n-                new SystemUnentitler(),\n-                new SystemEntitler(saltServiceMock)\n-        );\n+        SaltService saltServiceMock = context().mock(SaltService.class);\n+        context().checking(new Expectations() {{\n+            allowing(saltServiceMock).callSync(\n+                    with(any(LocalCall.class)),\n+                    with(any(String.class)));\n+        }});\n+        SystemEntitler.INSTANCE.setSaltService(saltServiceMock);\n     }\n \n     public void testSystemsToJson() throws Exception {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MjE2MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392692161", "bodyText": "Do we even need this class now? All functionality is completely delegated to SystemQuery at this point.", "author": "moio", "createdAt": "2020-03-15T16:57:00Z", "path": "java/code/src/com/suse/manager/virtualization/VirtManager.java", "diffHunk": "@@ -16,24 +16,25 @@\n \n import com.google.gson.JsonElement;\n import com.google.gson.JsonObject;\n-import com.google.gson.reflect.TypeToken;\n-import com.suse.manager.webui.services.impl.SaltService;\n-import com.suse.salt.netapi.calls.LocalCall;\n+import com.suse.manager.webui.services.iface.SystemQuery;\n \n-import java.util.Arrays;\n-import java.util.HashMap;\n-import java.util.LinkedHashMap;\n-import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n-import java.util.stream.Collectors;\n \n /**\n  * Service providing utility functions to handle virtual machines.\n  */\n public class VirtManager {", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1OTkwOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392959909", "bodyText": "All those methods are just temporarily in SystemQuery but will be split up into additional interfaces in a future PR. VirtManager is probably on of the most logical ones the become its own interface.", "author": "lucidd", "createdAt": "2020-03-16T11:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MjE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMzNTY3NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r393335674", "bodyText": "OK in the assumption this goes into the next PR of this series", "author": "moio", "createdAt": "2020-03-16T22:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MjE2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/suse/manager/virtualization/VirtManager.java b/java/code/src/com/suse/manager/virtualization/VirtManager.java\nindex db065b3e31b..493cb21d75a 100644\n--- a/java/code/src/com/suse/manager/virtualization/VirtManager.java\n+++ b/java/code/src/com/suse/manager/virtualization/VirtManager.java\n\n@@ -16,25 +16,25 @@ package com.suse.manager.virtualization;\n \n import com.google.gson.JsonElement;\n import com.google.gson.JsonObject;\n-import com.suse.manager.webui.services.iface.SystemQuery;\n+import com.google.gson.reflect.TypeToken;\n+import com.suse.manager.webui.services.impl.SaltService;\n+import com.suse.manager.webui.services.impl.SystemQuery;\n+import com.suse.salt.netapi.calls.LocalCall;\n \n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n+import java.util.stream.Collectors;\n \n /**\n  * Service providing utility functions to handle virtual machines.\n  */\n public class VirtManager {\n \n-    private final SystemQuery systemQuery;\n-\n-    /**\n-     * Service providing utility functions to handle virtual machines.\n-     * @param systemQueryIn instance for getting information from a system.\n-     */\n-    public VirtManager(SystemQuery systemQueryIn) {\n-        this.systemQuery = systemQueryIn;\n-    }\n+    private static SystemQuery saltService = SaltService.INSTANCE;\n \n     /**\n      * Query virtual machine definition\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MzU1NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392693555", "bodyText": "What motivated the choice of using one thread here, given original code allocated 5?\nhttps://github.com/uyuni-project/uyuni/blob/4.1-alpha1/java/code/src/com/suse/manager/webui/services/impl/SaltService.java#L155\nUnrelated note: SaltService.scheduledExecutorService seems to be dead code now.", "author": "moio", "createdAt": "2020-03-15T17:15:47Z", "path": "java/code/src/com/suse/manager/webui/services/FutureUtils.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.suse.manager.webui.services;\n+\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+/**\n+ * Class providing utility methods for futures.\n+ */\n+public class FutureUtils {\n+\n+    private static final ScheduledExecutorService SCHEDULED_EXECUTOR_SERVICE =\n+            Executors.newScheduledThreadPool(1);", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2NTM5Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r393265393", "bodyText": "reasoning was that this thread pool is not used for heavy long running computation but only to set a future to failed so 1 thread should be enough for that.", "author": "lucidd", "createdAt": "2020-03-16T19:33:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MzU1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "96ea37e1e6a08662d299db37f9958d307519002f", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/FutureUtils.java b/java/code/src/com/suse/manager/webui/services/FutureUtils.java\ndeleted file mode 100644\nindex a14d5888f90..00000000000\n--- a/java/code/src/com/suse/manager/webui/services/FutureUtils.java\n+++ /dev/null\n\n@@ -1,49 +0,0 @@\n-/**\n- * Copyright (c) 2020 SUSE LLC\n- *\n- * This software is licensed to you under the GNU General Public License,\n- * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n- * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n- * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n- * along with this software; if not, see\n- * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n- *\n- * Red Hat trademarks are not licensed under GPLv2. No permission is\n- * granted to use or replicate Red Hat trademarks that are incorporated\n- * in this software or its documentation.\n- */\n-package com.suse.manager.webui.services;\n-\n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.Executors;\n-import java.util.concurrent.ScheduledExecutorService;\n-import java.util.concurrent.TimeUnit;\n-import java.util.concurrent.TimeoutException;\n-\n-/**\n- * Class providing utility methods for futures.\n- */\n-public class FutureUtils {\n-\n-    private static final ScheduledExecutorService SCHEDULED_EXECUTOR_SERVICE =\n-            Executors.newScheduledThreadPool(1);\n-\n-    private FutureUtils() {\n-    }\n-\n-    /**\n-     * Creates a future that fails with a timeout exception after a given amount of time.\n-     * @param seconds until the timeout.\n-     * @param <T> result type of the future which is never used since this future always fails.\n-     * @return the future.\n-     */\n-    public static <T> CompletableFuture<T> failAfter(int seconds) {\n-        final CompletableFuture<T> promise = new CompletableFuture<>();\n-        SCHEDULED_EXECUTOR_SERVICE.schedule(() -> {\n-            final TimeoutException ex = new TimeoutException(\"Timeout after \" + seconds);\n-            return promise.completeExceptionally(ex);\n-        }, seconds, TimeUnit.SECONDS);\n-\n-        return promise;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5Mzg5OA==", "url": "https://github.com/uyuni-project/uyuni/pull/1954#discussion_r392693898", "bodyText": "Nitpick: I'd suggest to either have this tag on all public methods or just remove it everywhere.", "author": "moio", "createdAt": "2020-03-15T17:20:22Z", "path": "java/code/src/com/suse/manager/webui/services/impl/SaltService.java", "diffHunk": "@@ -226,6 +239,72 @@ public void setReactor(SaltReactor reactorIn) {\n         }\n     }\n \n+    @Override\n+    public Optional<Map<String, JsonElement>> getCapabilities(String minionId) {\n+        LocalCall<Map<String, JsonElement>> call =\n+                new LocalCall<>(\"virt.all_capabilities\", Optional.empty(), Optional.empty(),\n+                        new TypeToken<Map<String, JsonElement>>() { });\n+\n+        return callSync(call, minionId);\n+    }\n+\n+    @Override\n+    public Map<String, JsonObject> getNetworks(String minionId) {\n+        Map<String, Object> args = new LinkedHashMap<>();\n+        LocalCall<Map<String, JsonElement>> call =\n+                new LocalCall<>(\"virt.network_info\", Optional.empty(), Optional.of(args),\n+                        new TypeToken<Map<String, JsonElement>>() { });\n+\n+        Optional<Map<String, JsonElement>> nets = callSync(call, minionId);\n+        Map<String, JsonElement> result = nets.orElse(new HashMap<String, JsonElement>());\n+\n+        // Workaround: Filter out the entries that don't match since we may get a retcode=0 one.\n+        return result.entrySet().stream()\n+                .filter(entry -> entry.getValue().isJsonObject())\n+                .collect(Collectors.toMap(entry -> entry.getKey(), entry -> entry.getValue().getAsJsonObject()));\n+    }\n+\n+    /**\n+     * {@inheritDoc}", "originalCommit": "4b1f6343ef5635bb1b4cf255d7113108be5a9ac9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b40ef3d41dc7e2da404823be1fb706a57f72e43", "chunk": "diff --git a/java/code/src/com/suse/manager/webui/services/impl/SaltService.java b/java/code/src/com/suse/manager/webui/services/impl/SaltService.java\nindex bfee1fe5cac..5e3bd822000 100644\n--- a/java/code/src/com/suse/manager/webui/services/impl/SaltService.java\n+++ b/java/code/src/com/suse/manager/webui/services/impl/SaltService.java\n\n@@ -239,6 +236,9 @@ public class SaltService implements SystemQuery {\n         }\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n     @Override\n     public Optional<Map<String, JsonElement>> getCapabilities(String minionId) {\n         LocalCall<Map<String, JsonElement>> call =\n"}}, {"oid": "4b40ef3d41dc7e2da404823be1fb706a57f72e43", "url": "https://github.com/uyuni-project/uyuni/commit/4b40ef3d41dc7e2da404823be1fb706a57f72e43", "message": "throw descriptive error message when handler does not exist.", "committedDate": "2020-03-17T10:09:50Z", "type": "forcePushed"}, {"oid": "55681ddadbbcbdeb3ddfccd20bc157334406ced5", "url": "https://github.com/uyuni-project/uyuni/commit/55681ddadbbcbdeb3ddfccd20bc157334406ced5", "message": "remove now unused imports", "committedDate": "2020-03-17T10:44:55Z", "type": "forcePushed"}, {"oid": "96ea37e1e6a08662d299db37f9958d307519002f", "url": "https://github.com/uyuni-project/uyuni/commit/96ea37e1e6a08662d299db37f9958d307519002f", "message": "extract salt operations into interface", "committedDate": "2020-03-19T16:34:20Z", "type": "commit"}, {"oid": "6c3280563c4ce60f266b90a97ba6ee90f43a1e32", "url": "https://github.com/uyuni-project/uyuni/commit/6c3280563c4ce60f266b90a97ba6ee90f43a1e32", "message": "extract failAfter to utility class", "committedDate": "2020-03-19T16:34:24Z", "type": "commit"}, {"oid": "9c7674308e100375e3200ca30ad6cf3a49e0eaad", "url": "https://github.com/uyuni-project/uyuni/commit/9c7674308e100375e3200ca30ad6cf3a49e0eaad", "message": "refine getAllContainers", "committedDate": "2020-03-19T16:34:24Z", "type": "commit"}, {"oid": "73c001245a12914cdd1a2ea785add39ee5765026", "url": "https://github.com/uyuni-project/uyuni/commit/73c001245a12914cdd1a2ea785add39ee5765026", "message": "replace callAsync with specific methods", "committedDate": "2020-03-19T16:34:24Z", "type": "commit"}, {"oid": "761545bae5f7094f65df1f983b347d73aaf6f4f7", "url": "https://github.com/uyuni-project/uyuni/commit/761545bae5f7094f65df1f983b347d73aaf6f4f7", "message": "replace callSync with more specific methods", "committedDate": "2020-03-19T16:34:24Z", "type": "commit"}, {"oid": "a319bba8fbe3b8d2dff70ffaf2c4e267f7557850", "url": "https://github.com/uyuni-project/uyuni/commit/a319bba8fbe3b8d2dff70ffaf2c4e267f7557850", "message": "replace callSync with more specific methods (part1)", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "82fe6b8b4767f2edc3c4508403c40fee55c36fd8", "url": "https://github.com/uyuni-project/uyuni/commit/82fe6b8b4767f2edc3c4508403c40fee55c36fd8", "message": "bootstrap ImageBuildController", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "321c079ad2f994dc94c1c5aec1308492c2029627", "url": "https://github.com/uyuni-project/uyuni/commit/321c079ad2f994dc94c1c5aec1308492c2029627", "message": "bootstrap Virtual*Controller", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "c08092609eac1b3dec2df2909f98a7f423423b9a", "url": "https://github.com/uyuni-project/uyuni/commit/c08092609eac1b3dec2df2909f98a7f423423b9a", "message": "bootstrap SystemController", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "6505614dd5727092320348bc3bc882e32532ab0f", "url": "https://github.com/uyuni-project/uyuni/commit/6505614dd5727092320348bc3bc882e32532ab0f", "message": "bootstrap remaining MessageAction classes", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "44f85c1ea3bef47a6c0b8a10dac53f30d95328d3", "url": "https://github.com/uyuni-project/uyuni/commit/44f85c1ea3bef47a6c0b8a10dac53f30d95328d3", "message": "fix compile error", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "76dd898667fd17972548117fc344f6b91f5b1ee4", "url": "https://github.com/uyuni-project/uyuni/commit/76dd898667fd17972548117fc344f6b91f5b1ee4", "message": "remove reflective handler instanciation to prepare for passing dependnecies to handlers", "committedDate": "2020-03-19T16:34:25Z", "type": "commit"}, {"oid": "7cefb0824ddb9dbc14d440faa04c3c2918791efd", "url": "https://github.com/uyuni-project/uyuni/commit/7cefb0824ddb9dbc14d440faa04c3c2918791efd", "message": "bootstrap SaltSSHController", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "77181ce0c295f61eeb3e4faf1abc45f1fe084909", "url": "https://github.com/uyuni-project/uyuni/commit/77181ce0c295f61eeb3e4faf1abc45f1fe084909", "message": "bootstrap NotificationMessageController", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "7a886965f5ae99d3492fe05e8a4cfe88e5ca2a29", "url": "https://github.com/uyuni-project/uyuni/commit/7a886965f5ae99d3492fe05e8a4cfe88e5ca2a29", "message": "bootstrap RefreshPillarEventAction", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "8a8b2bb89c1d79e2468d2f074f6a6f1d57d64323", "url": "https://github.com/uyuni-project/uyuni/commit/8a8b2bb89c1d79e2468d2f074f6a6f1d57d64323", "message": "fix tests", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "388fe503c889697beaa528331f474105f6e278ff", "url": "https://github.com/uyuni-project/uyuni/commit/388fe503c889697beaa528331f474105f6e278ff", "message": "fix checkstyle", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "30c2708a67161c11e650c989bc3a1b50e8cad91d", "url": "https://github.com/uyuni-project/uyuni/commit/30c2708a67161c11e650c989bc3a1b50e8cad91d", "message": "fix copyright date", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "9cf164a9ef7bad2171dd77c732b4e0d4a5324218", "url": "https://github.com/uyuni-project/uyuni/commit/9cf164a9ef7bad2171dd77c732b4e0d4a5324218", "message": "unify indentation", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "f5be9986706941ea6f4c658cee6ba811a45ed66b", "url": "https://github.com/uyuni-project/uyuni/commit/f5be9986706941ea6f4c658cee6ba811a45ed66b", "message": "rename saltService variables to systemQuery", "committedDate": "2020-03-19T16:34:26Z", "type": "commit"}, {"oid": "8fe447825cd3793cff544b880c5af47dc6f3de7d", "url": "https://github.com/uyuni-project/uyuni/commit/8fe447825cd3793cff544b880c5af47dc6f3de7d", "message": "move SystemQuery to services.iface package", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "8a93daaa07d046901bfab78371ed97cb5d9487bd", "url": "https://github.com/uyuni-project/uyuni/commit/8a93daaa07d046901bfab78371ed97cb5d9487bd", "message": "cleanup unused variable", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "86f3b9e51b3249f2bc0b1998698c3fcef86a5df3", "url": "https://github.com/uyuni-project/uyuni/commit/86f3b9e51b3249f2bc0b1998698c3fcef86a5df3", "message": "Fix typo\n\nCo-Authored-By: Abid Mehmood <amehmood@suse.de>", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "a4d6c78007a0841fc45ac1e571a06bca1ea721e3", "url": "https://github.com/uyuni-project/uyuni/commit/a4d6c78007a0841fc45ac1e571a06bca1ea721e3", "message": "Fix javadoc\n\nCo-Authored-By: Abid Mehmood <amehmood@suse.de>", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "5a4f517d126109832890c2d8175dceabbd0dec19", "url": "https://github.com/uyuni-project/uyuni/commit/5a4f517d126109832890c2d8175dceabbd0dec19", "message": "Fix javadoc\n\nCo-Authored-By: Abid Mehmood <amehmood@suse.de>", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "de23aab71019068ec6d8495d7d0908bd8adcabd8", "url": "https://github.com/uyuni-project/uyuni/commit/de23aab71019068ec6d8495d7d0908bd8adcabd8", "message": "remove unused unused parameter", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "dcf798d7e2efea78698ff3c4867604e5ab555ad7", "url": "https://github.com/uyuni-project/uyuni/commit/dcf798d7e2efea78698ff3c4867604e5ab555ad7", "message": "remove unused constructor", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "6bbace31e3f55a877cf2d499ad289b10c188af75", "url": "https://github.com/uyuni-project/uyuni/commit/6bbace31e3f55a877cf2d499ad289b10c188af75", "message": "fix ApiHandler", "committedDate": "2020-03-19T16:34:27Z", "type": "commit"}, {"oid": "6b818ac91278681705b91463f48afd48e3176c6d", "url": "https://github.com/uyuni-project/uyuni/commit/6b818ac91278681705b91463f48afd48e3176c6d", "message": "remove unused code", "committedDate": "2020-03-19T16:34:28Z", "type": "commit"}, {"oid": "d49933650993519cbb362ee4b9a3ee198a293cdb", "url": "https://github.com/uyuni-project/uyuni/commit/d49933650993519cbb362ee4b9a3ee198a293cdb", "message": "use inheritDoc consistently", "committedDate": "2020-03-19T16:34:28Z", "type": "commit"}, {"oid": "d2787082afd936cb3216d4580832cac8e6ba6f5e", "url": "https://github.com/uyuni-project/uyuni/commit/d2787082afd936cb3216d4580832cac8e6ba6f5e", "message": "rename handler factory methods and move mocking to test package", "committedDate": "2020-03-19T16:34:28Z", "type": "commit"}, {"oid": "be8df239ec17ba376e3e65167971953a22849671", "url": "https://github.com/uyuni-project/uyuni/commit/be8df239ec17ba376e3e65167971953a22849671", "message": "throw descriptive error message when handler does not exist.", "committedDate": "2020-03-19T16:34:28Z", "type": "commit"}, {"oid": "0f8f85a6c0b0c831d3771c77612630c3627614ed", "url": "https://github.com/uyuni-project/uyuni/commit/0f8f85a6c0b0c831d3771c77612630c3627614ed", "message": "remove now unused imports", "committedDate": "2020-03-19T16:34:28Z", "type": "commit"}, {"oid": "0f8f85a6c0b0c831d3771c77612630c3627614ed", "url": "https://github.com/uyuni-project/uyuni/commit/0f8f85a6c0b0c831d3771c77612630c3627614ed", "message": "remove now unused imports", "committedDate": "2020-03-19T16:34:28Z", "type": "forcePushed"}]}