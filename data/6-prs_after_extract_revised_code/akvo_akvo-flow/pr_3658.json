{"pr_number": 3658, "pr_title": "[#3652] using offset to return assigned datapoints", "pr_createdAt": "2020-10-16T13:57:55Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3658", "timeline": [{"oid": "ecb86247de1a1be6b56e533c54ea6dc3c1232909", "url": "https://github.com/akvo/akvo-flow/commit/ecb86247de1a1be6b56e533c54ea6dc3c1232909", "message": "[#3652] using offset to return assigned datapoints\n\nin batches of 30 as query by key does not allow to query with a cursor", "committedDate": "2020-10-16T13:57:01Z", "type": "commit"}, {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085", "url": "https://github.com/akvo/akvo-flow/commit/eb0dc757a91ab0636be8fe9a141822d7b5aa4085", "message": "[#3652] using cursor as offset when assigned datapoints", "committedDate": "2020-10-19T10:59:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA==", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507688388", "bodyText": "If we follow the current behaviour of the app, it will send requests to the backend until the returned results == 0.\nSo take the case of 34 assigned datapoints.\n\nFirst query = 30 datapoints and cursor=30\nsecond query = 4 datapoints and cursor=(4 or 34?)\nthird query = 0 datapoints and cursor=(?)", "author": "muloem", "createdAt": "2020-10-19T11:58:51Z", "path": "GAE/src/org/akvo/flow/api/app/DataPointServlet.java", "diffHunk": "@@ -87,7 +79,11 @@ protected RestResponse handleRequest(RestRequest req) throws Exception {\n         }\n \n         res = convertToResponse(dpList, dpReq.getSurveyId());\n-        res.setCursor(BaseDAO.getCursor(dpList));\n+        String cursor = BaseDAO.getCursor(dpList);\n+        if (cursor == null && dpList.size() > 0) {\n+            cursor = dpList.size() + \"\";\n+        }\n+        res.setCursor(cursor);", "originalCommit": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyOTI0Nw==", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507729247", "bodyText": "cursor would be null, I need to check if it could be an issue", "author": "valllllll2000", "createdAt": "2020-10-19T13:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc0MjcwMw==", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507742703", "bodyText": "I checked and having a null cursor is not an issue. I think in this case it makes sense. User downloads all datapoints assigned to him and cursor is reset to null. Datapoints are assigned/modified. User pressed download -> download restarts from 0 (we have no way to tell if the datapoints have been modified recently because we don't have a \"real\" cursor)", "author": "valllllll2000", "createdAt": "2020-10-19T13:24:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA=="}], "type": "inlineReview", "revised_code": null}]}