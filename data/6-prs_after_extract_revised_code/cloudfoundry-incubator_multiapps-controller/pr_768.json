{"pr_number": 768, "pr_title": "Update messages in new bg-deploy process", "pr_createdAt": "2020-02-18T13:59:24Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/768", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNjMxNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/768#discussion_r381136316", "bodyText": "Add quotes around the names for consistency with the other progress messages.", "author": "nictas", "createdAt": "2020-02-19T08:22:07Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -262,6 +262,7 @@\n     public static final String SERVICE_BROKER_DOES_NOT_EXIST = \"Service broker with name \\\"{0}\\\" does not exist\";\r\n     public static final String EXECUTING_HOOK_0 = \"Executing hook \\\"{0}\\\"\";\r\n     public static final String WAITING_PREVIOUS_OPERATIONS_TO_FINISH = \"Waiting for previous service operations to finish...\";\r\n+    public static final String RENAMING_APPLICATION_0_TO_1 = \"Renaming application {0} to {1}...\";\r", "originalCommit": "d531ebbcdf4b8cb2fc7c2a2b30092a0681d4b445", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java\nindex fc547b149..e9a81c1b6 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java\n\n@@ -262,7 +264,7 @@ public class Messages {\n     public static final String SERVICE_BROKER_DOES_NOT_EXIST = \"Service broker with name \\\"{0}\\\" does not exist\";\n     public static final String EXECUTING_HOOK_0 = \"Executing hook \\\"{0}\\\"\";\n     public static final String WAITING_PREVIOUS_OPERATIONS_TO_FINISH = \"Waiting for previous service operations to finish...\";\n-    public static final String RENAMING_APPLICATION_0_TO_1 = \"Renaming application {0} to {1}...\";\n+    public static final String RENAMING_APPLICATION_0_TO_1 = \"Renaming application '{0}' to '{1}'...\";\n \n     // DEBUG log messages\n     public static final String PROCESS_ENVIRONMENT = \"Process environment: {0}\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNjQ3NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/768#discussion_r381136474", "bodyText": "Same", "author": "nictas", "createdAt": "2020-02-19T08:22:31Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -427,9 +428,7 @@\n     public static final String NO_READ_ONLY_PARAMETERS_ARE_OVERWRITTEN = \"No read-only parameters are overwritten\";\r\n     public static final String MODULE_WITH_APPLICATION_NAME_WAS_MARKED_AS_IDLE = \"Module \\\"{0}\\\" with application name \\\"{1}\\\" was marked as idle\";\r\n     public static final String UPDATING_APP_NAMES_WITH_NEW_SUFFIX = \"Updating application names in deployment descriptor with 'new' suffix\";\r\n-    public static final String RENAMING_NEW_APPLICATIONS = \"Renaming new applications...\";\r\n-    public static final String RENAMING_OLD_APPLICATIONS = \"Renaming old applications...\";\r\n-    public static final String RENAMING_APPLICATION = \"Renaming application {0}\";\r\n+    public static final String UPDATING_CONFIGURATION_SUBSCRIPTION_0_WITH_NAME_1 = \"Updating configuration subscription {0} with name {1}\";\r", "originalCommit": "d531ebbcdf4b8cb2fc7c2a2b30092a0681d4b445", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java\nindex fc547b149..e9a81c1b6 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java\n\n@@ -428,7 +430,7 @@ public class Messages {\n     public static final String NO_READ_ONLY_PARAMETERS_ARE_OVERWRITTEN = \"No read-only parameters are overwritten\";\n     public static final String MODULE_WITH_APPLICATION_NAME_WAS_MARKED_AS_IDLE = \"Module \\\"{0}\\\" with application name \\\"{1}\\\" was marked as idle\";\n     public static final String UPDATING_APP_NAMES_WITH_NEW_SUFFIX = \"Updating application names in deployment descriptor with 'new' suffix\";\n-    public static final String UPDATING_CONFIGURATION_SUBSCRIPTION_0_WITH_NAME_1 = \"Updating configuration subscription {0} with name {1}\";\n+    public static final String UPDATING_CONFIGURATION_SUBSCRIPTION_0_WITH_NAME_1 = \"Updating configuration subscription '{0}' with name '{1}'\";\n \n     protected Messages() {\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNjg2Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/768#discussion_r381136863", "bodyText": "Extract BlueGreenApplicationNameSuffix.removeSuffix(appName) in a variable.", "author": "nictas", "createdAt": "2020-02-19T08:23:29Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java", "diffHunk": "@@ -27,13 +27,12 @@ protected StepPhase executeStep(ExecutionWrapper execution) {\n         if (!StepsUtil.getKeepOriginalAppNamesAfterDeploy(execution.getContext())) {\n             return StepPhase.DONE;\n         }\n-        getStepLogger().info(Messages.RENAMING_NEW_APPLICATIONS);\n \n         List<String> appsToProcess = StepsUtil.getAppsToDeploy(execution.getContext());\n         CloudControllerClient client = execution.getControllerClient();\n \n         for (String appName : appsToProcess) {\n-            getStepLogger().debug(Messages.RENAMING_APPLICATION, appName);\n+            getStepLogger().info(Messages.RENAMING_APPLICATION_0_TO_1, appName, BlueGreenApplicationNameSuffix.removeSuffix(appName));", "originalCommit": "d531ebbcdf4b8cb2fc7c2a2b30092a0681d4b445", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\nindex 20093663d..3bbdb3e4e 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\n\n@@ -32,8 +32,9 @@ public class RemoveNewApplicationsSuffixStep extends SyncFlowableStep {\n         CloudControllerClient client = execution.getControllerClient();\n \n         for (String appName : appsToProcess) {\n-            getStepLogger().info(Messages.RENAMING_APPLICATION_0_TO_1, appName, BlueGreenApplicationNameSuffix.removeSuffix(appName));\n-            client.rename(appName, BlueGreenApplicationNameSuffix.removeSuffix(appName));\n+            String newName = BlueGreenApplicationNameSuffix.removeSuffix(appName);\n+            getStepLogger().info(Messages.RENAMING_APPLICATION_0_TO_1, appName, newName);\n+            client.rename(appName, newName);\n         }\n \n         String mtaId = (String) execution.getContext()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNzQwOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/768#discussion_r381137408", "bodyText": "Extract BlueGreenApplicationNameSuffix.removeSuffix(appName) in a variable and pass it to updateConfigurationSubscription. Otherwise, if you change the code in createNewSubscription you might forget to also change this message.", "author": "nictas", "createdAt": "2020-02-19T08:24:42Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java", "diffHunk": "@@ -50,6 +49,8 @@ private void updateConfigurationSubscribers(List<String> appsToProcess, String m\n                                                                            .list();\n         for (ConfigurationSubscription subscription : subscriptions) {\n             if (appsToProcess.contains(subscription.getAppName())) {\n+                getStepLogger().debug(Messages.UPDATING_CONFIGURATION_SUBSCRIPTION_0_WITH_NAME_1, subscription.getAppName(),\n+                                      BlueGreenApplicationNameSuffix.removeSuffix(subscription.getAppName()));", "originalCommit": "d531ebbcdf4b8cb2fc7c2a2b30092a0681d4b445", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\nindex 20093663d..3bbdb3e4e 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\n\n@@ -49,22 +50,22 @@ public class RemoveNewApplicationsSuffixStep extends SyncFlowableStep {\n                                                                            .list();\n         for (ConfigurationSubscription subscription : subscriptions) {\n             if (appsToProcess.contains(subscription.getAppName())) {\n-                getStepLogger().debug(Messages.UPDATING_CONFIGURATION_SUBSCRIPTION_0_WITH_NAME_1, subscription.getAppName(),\n-                                      BlueGreenApplicationNameSuffix.removeSuffix(subscription.getAppName()));\n-                updateConfigurationSubscription(subscription);\n+                String newAppName = BlueGreenApplicationNameSuffix.removeSuffix(subscription.getAppName());\n+                getStepLogger().debug(Messages.UPDATING_CONFIGURATION_SUBSCRIPTION_0_WITH_NAME_1, subscription.getAppName(), newAppName);\n+                updateConfigurationSubscription(subscription, newAppName);\n             }\n         }\n     }\n \n-    private void updateConfigurationSubscription(ConfigurationSubscription subscription) {\n-        subscriptionService.update(subscription.getId(), createNewSubscription(subscription));\n+    private void updateConfigurationSubscription(ConfigurationSubscription subscription, String newAppName) {\n+        subscriptionService.update(subscription.getId(), createNewSubscription(subscription, newAppName));\n     }\n \n-    private ConfigurationSubscription createNewSubscription(ConfigurationSubscription subscription) {\n+    private ConfigurationSubscription createNewSubscription(ConfigurationSubscription subscription, String newAppName) {\n         return new ConfigurationSubscription(subscription.getId(),\n                                              subscription.getMtaId(),\n                                              subscription.getSpaceId(),\n-                                             BlueGreenApplicationNameSuffix.removeSuffix(subscription.getAppName()),\n+                                             newAppName,\n                                              subscription.getFilter(),\n                                              subscription.getModuleDto(),\n                                              subscription.getResourceDto());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNzUxNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/768#discussion_r381137515", "bodyText": "Extract appName + BlueGreenApplicationNameSuffix.LIVE.asSuffix() in a variable.", "author": "nictas", "createdAt": "2020-02-19T08:24:55Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RenameApplicationsStep.java", "diffHunk": "@@ -72,15 +72,14 @@ public void execute(ExecutionWrapper execution) {\n             }\n \n             getStepLogger().debug(Messages.UPDATING_APP_NAMES_WITH_NEW_SUFFIX);\n-            updateApplicationNamesInDescriptor(context, BlueGreenApplicationNameSuffix.NEW.asSuffix());\n+            updateApplicationNamesInDescriptor(context, BlueGreenApplicationNameSuffix.IDLE.asSuffix());\n         }\n \n         private void renameOldApps(List<String> appsToRename, CloudControllerClient client) {\n-            getStepLogger().info(Messages.RENAMING_OLD_APPLICATIONS);\n-\n             for (String appName : appsToRename) {\n-                getStepLogger().debug(Messages.RENAMING_APPLICATION, appName);\n-                client.rename(appName, appName + BlueGreenApplicationNameSuffix.OLD.asSuffix());\n+                getStepLogger().info(Messages.RENAMING_APPLICATION_0_TO_1, appName,\n+                                     appName + BlueGreenApplicationNameSuffix.LIVE.asSuffix());", "originalCommit": "d531ebbcdf4b8cb2fc7c2a2b30092a0681d4b445", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RenameApplicationsStep.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RenameApplicationsStep.java\nindex 290064e15..5d93ff912 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RenameApplicationsStep.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RenameApplicationsStep.java\n\n@@ -77,9 +77,9 @@ public class RenameApplicationsStep extends SyncFlowableStep {\n \n         private void renameOldApps(List<String> appsToRename, CloudControllerClient client) {\n             for (String appName : appsToRename) {\n-                getStepLogger().info(Messages.RENAMING_APPLICATION_0_TO_1, appName,\n-                                     appName + BlueGreenApplicationNameSuffix.LIVE.asSuffix());\n-                client.rename(appName, appName + BlueGreenApplicationNameSuffix.LIVE.asSuffix());\n+                String newName = appName + BlueGreenApplicationNameSuffix.LIVE.asSuffix();\n+                getStepLogger().info(Messages.RENAMING_APPLICATION_0_TO_1, appName, newName);\n+                client.rename(appName, newName);\n             }\n         }\n \n"}}, {"oid": "01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/01750cee5ff1cbeeffb9d7e957ad1146f61aa59b", "message": "Update messages in new bg-deploy process\n\nUpdate and add messages, and change app name suffixes to -live / -idle\nfrom -old / -new respectively", "committedDate": "2020-02-19T09:39:51Z", "type": "forcePushed"}, {"oid": "8cfd972b0b9ebcb014c59e2c73a04c8b10dc2b45", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/8cfd972b0b9ebcb014c59e2c73a04c8b10dc2b45", "message": "Update messages in new bg-deploy process\n\nUpdate and add messages, and change app name suffixes to -live / -idle\nfrom -old / -new respectively", "committedDate": "2020-02-19T09:43:50Z", "type": "commit"}, {"oid": "8cfd972b0b9ebcb014c59e2c73a04c8b10dc2b45", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/8cfd972b0b9ebcb014c59e2c73a04c8b10dc2b45", "message": "Update messages in new bg-deploy process\n\nUpdate and add messages, and change app name suffixes to -live / -idle\nfrom -old / -new respectively", "committedDate": "2020-02-19T09:43:50Z", "type": "forcePushed"}]}