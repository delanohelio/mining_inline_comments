{"pr_number": 759, "pr_title": "Do not retry when process is aborted", "pr_createdAt": "2020-02-12T18:00:24Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/759", "timeline": [{"oid": "9e6a3ab9d643d3666290c67e3bb6fb0e48eef321", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/9e6a3ab9d643d3666290c67e3bb6fb0e48eef321", "message": "Do not retry when process is aborted", "committedDate": "2020-02-13T08:31:01Z", "type": "forcePushed"}, {"oid": "9080106d2a80dfbe20529d2da21c592023025ef4", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/9080106d2a80dfbe20529d2da21c592023025ef4", "message": "Do not retry when process is aborted", "committedDate": "2020-02-13T09:33:25Z", "type": "forcePushed"}, {"oid": "fae961c2c4118c166f9ea5cfcddb62d34089bc79", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/fae961c2c4118c166f9ea5cfcddb62d34089bc79", "message": "Do not retry when process is aborted", "committedDate": "2020-02-13T14:10:31Z", "type": "forcePushed"}, {"oid": "9df1445ed5af8af4d1cb6b83366f636590c893fc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/9df1445ed5af8af4d1cb6b83366f636590c893fc", "message": "Do not retry when process is aborted", "committedDate": "2020-02-13T14:49:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkxNzkzOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/759#discussion_r378917938", "bodyText": "\"ABORTED\" is a final state. This does not fit with the name of the method.", "author": "nictas", "createdAt": "2020-02-13T15:06:03Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/OperationsHelper.java", "diffHunk": "@@ -95,26 +94,25 @@ public Operation addState(Operation operation) {\n     }\n \n     public Operation.State computeState(String processId) {\n-        ProcessInstance processInstance = flowableFacade.getProcessInstance(processId);\n-        if (processInstance != null) {\n-            return computeNonFinalState(processInstance);\n-        }\n-        return computeFinalState(processId);\n+        return processHelper.findProcessInstanceById(processId)\n+                            .isPresent() ? computeNonFinalState(processId) : computeFinalState(processId);\n     }\n \n-    private Operation.State computeNonFinalState(ProcessInstance processInstance) {\n-        String processInstanceId = processInstance.getProcessInstanceId();\n-        if (flowableFacade.isProcessInstanceAtReceiveTask(processInstanceId)) {\n+    private Operation.State computeNonFinalState(String processInstanceId) {\n+        if (processHelper.isAborted(processInstanceId)) {\n+            return Operation.State.ABORTED;", "originalCommit": "9df1445ed5af8af4d1cb6b83366f636590c893fc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dfbc9e4761749edbd4a1078d7002b667fa1c6a27", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/OperationsHelper.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/OperationsHelper.java\nindex adb7e8b2e..f35b66bee 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/OperationsHelper.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/OperationsHelper.java\n\n@@ -90,29 +90,21 @@ public class OperationsHelper {\n \n     public Operation.State computeState(Operation operation) {\n         LOGGER.debug(MessageFormat.format(Messages.COMPUTING_STATE_OF_OPERATION, operation.getProcessType(), operation.getProcessId()));\n-        return computeState(operation.getProcessId());\n+        return computeProcessState(operation.getProcessId());\n     }\n \n-    public Operation.State computeState(String processId) {\n-        return processHelper.findProcessInstanceById(processId)\n-                            .isPresent() ? computeNonFinalState(processId) : computeFinalState(processId);\n-    }\n-\n-    private Operation.State computeNonFinalState(String processInstanceId) {\n-        if (processHelper.isAborted(processInstanceId)) {\n+    public Operation.State computeProcessState(String processId) {\n+        if (processHelper.isAborted(processId)) {\n             return Operation.State.ABORTED;\n         }\n-        if (processHelper.isAtReceiveTask(processInstanceId)) {\n+        if (processHelper.isAtReceiveTask(processId)) {\n             return Operation.State.ACTION_REQUIRED;\n         }\n-        if (processHelper.isInErrorState(processInstanceId)) {\n+        if (processHelper.isInErrorState(processId)) {\n             return Operation.State.ERROR;\n         }\n-        return Operation.State.RUNNING;\n-    }\n-\n-    private Operation.State computeFinalState(String processId) {\n-        return processHelper.isAborted(processId) ? Operation.State.ABORTED : Operation.State.FINISHED;\n+        return processHelper.findProcessInstanceById(processId)\n+                            .isPresent() ? Operation.State.RUNNING : Operation.State.FINISHED;\n     }\n \n     public List<Operation> findOperations(List<Operation> operations, List<Operation.State> statusList) {\n"}}, {"oid": "dfbc9e4761749edbd4a1078d7002b667fa1c6a27", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/dfbc9e4761749edbd4a1078d7002b667fa1c6a27", "message": "Do not retry when process is aborted", "committedDate": "2020-02-13T15:38:13Z", "type": "commit"}, {"oid": "dfbc9e4761749edbd4a1078d7002b667fa1c6a27", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/dfbc9e4761749edbd4a1078d7002b667fa1c6a27", "message": "Do not retry when process is aborted", "committedDate": "2020-02-13T15:38:13Z", "type": "forcePushed"}]}