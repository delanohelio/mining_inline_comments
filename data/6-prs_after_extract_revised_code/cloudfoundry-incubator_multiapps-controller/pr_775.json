{"pr_number": 775, "pr_title": "Filter mtas by space id as well as mta id", "pr_createdAt": "2020-02-25T15:06:28Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/775", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkzOTc4MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/775#discussion_r383939780", "bodyText": "I'd prefer passing the space GUID in addition to the MTA ID, instead of passing the context, since the context is just a map of variables. It's like passing everything to this method and allowing it to change it.", "author": "nictas", "createdAt": "2020-02-25T15:10:40Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java", "diffHunk": "@@ -37,16 +37,16 @@ protected StepPhase executeStep(ExecutionWrapper execution) {\n             client.rename(appName, newName);\n         }\n \n-        String mtaId = (String) execution.getContext()\n-                                         .getVariable(Constants.PARAM_MTA_ID);\n-        updateConfigurationSubscribers(appsToProcess, mtaId);\n+        updateConfigurationSubscribers(appsToProcess, execution.getContext());\n \n         return StepPhase.DONE;\n     }\n \n-    private void updateConfigurationSubscribers(List<String> appsToProcess, String mtaId) {\n+    private void updateConfigurationSubscribers(List<String> appsToProcess, DelegateExecution context) {", "originalCommit": "673ac3ef4dbc80a629081e0d07293afb3713a41d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0NDgxOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/775#discussion_r383944818", "bodyText": "Done", "author": "radito3", "createdAt": "2020-02-25T15:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkzOTc4MA=="}], "type": "inlineReview", "revised_code": {"commit": "d11426f1c696ae477490d28af71442c2aafff244", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\nindex 1791684f5..8bf821707 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/RemoveNewApplicationsSuffixStep.java\n\n@@ -37,16 +37,18 @@ public class RemoveNewApplicationsSuffixStep extends SyncFlowableStep {\n             client.rename(appName, newName);\n         }\n \n-        updateConfigurationSubscribers(appsToProcess, execution.getContext());\n+        String mtaId = (String) execution.getContext()\n+                                         .getVariable(Constants.PARAM_MTA_ID);\n+        String spaceId = StepsUtil.getSpaceId(execution.getContext());\n+        updateConfigurationSubscribers(appsToProcess, mtaId, spaceId);\n \n         return StepPhase.DONE;\n     }\n \n-    private void updateConfigurationSubscribers(List<String> appsToProcess, DelegateExecution context) {\n-        String mtaId = (String) context.getVariable(Constants.PARAM_MTA_ID);\n+    private void updateConfigurationSubscribers(List<String> appsToProcess, String mtaId, String spaceId) {\n         List<ConfigurationSubscription> subscriptions = subscriptionService.createQuery()\n                                                                            .mtaId(mtaId)\n-                                                                           .spaceId(StepsUtil.getSpaceId(context))\n+                                                                           .spaceId(spaceId)\n                                                                            .list();\n         for (ConfigurationSubscription subscription : subscriptions) {\n             if (appsToProcess.contains(subscription.getAppName())) {\n"}}, {"oid": "599a491e19fb2fcf3f2a0be6487dfd19877f026e", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/599a491e19fb2fcf3f2a0be6487dfd19877f026e", "message": "Filter mtas by space id as well as mta id\n\nWhen updating configuration subscriptions, mtas must be filtered by\nspace id as well, otherwise it would break mtas with same mta id in\ndifferent spaces.\n\nLMCROSSITXSADEPLOY-1159", "committedDate": "2020-02-25T15:16:17Z", "type": "forcePushed"}, {"oid": "d11426f1c696ae477490d28af71442c2aafff244", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d11426f1c696ae477490d28af71442c2aafff244", "message": "Filter mtas by space id as well as mta id\n\nWhen updating configuration subscriptions, mtas must be filtered by\nspace id as well, otherwise it would break mtas with same mta id in\ndifferent spaces.\n\nLMCROSSITXSADEPLOY-1159", "committedDate": "2020-02-25T15:18:14Z", "type": "commit"}, {"oid": "d11426f1c696ae477490d28af71442c2aafff244", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d11426f1c696ae477490d28af71442c2aafff244", "message": "Filter mtas by space id as well as mta id\n\nWhen updating configuration subscriptions, mtas must be filtered by\nspace id as well, otherwise it would break mtas with same mta id in\ndifferent spaces.\n\nLMCROSSITXSADEPLOY-1159", "committedDate": "2020-02-25T15:18:14Z", "type": "forcePushed"}]}