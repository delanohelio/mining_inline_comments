{"pr_number": 995, "pr_title": "App content digest is changed after successful upload", "pr_createdAt": "2020-11-17T07:58:32Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/995", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk4NDU2NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/995#discussion_r524984565", "bodyText": "Why not including setAppContentChanged in proceedWithUpload()?", "author": "boyan-velinov", "createdAt": "2020-11-17T08:55:59Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -75,7 +75,10 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n \n         boolean contentChanged = detectApplicationFileDigestChanges(context, cloudApp, newApplicationDigest);\n         if (contentChanged) {\n-            return proceedWithUpload(context, applicationToProcess, moduleFileName);\n+            proceedWithUpload(context, applicationToProcess, moduleFileName);\n+            attemptToUpdateApplicationDigest(context.getControllerClient(), cloudApp, newApplicationDigest);\n+            setAppContentChanged(context, true);", "originalCommit": "7700f72b76ee15dc0c27a0aadbbe5a5f8f149d10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk2MjI0NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/995#discussion_r525962244", "bodyText": "done", "author": "ikasarov", "createdAt": "2020-11-18T10:06:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk4NDU2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "f14517107fe8b8f6aa2aaf19610adb62bee118cc", "chunk": "diff --git a/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java b/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java\nindex e143579b0..60c3f746d 100644\n--- a/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java\n+++ b/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java\n\n@@ -77,7 +77,6 @@ public class UploadAppStep extends TimeoutAsyncFlowableStep {\n         if (contentChanged) {\n             proceedWithUpload(context, applicationToProcess, moduleFileName);\n             attemptToUpdateApplicationDigest(context.getControllerClient(), cloudApp, newApplicationDigest);\n-            setAppContentChanged(context, true);\n             return StepPhase.POLL;\n         }\n \n"}}, {"oid": "f14517107fe8b8f6aa2aaf19610adb62bee118cc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f14517107fe8b8f6aa2aaf19610adb62bee118cc", "message": "app digest is now only updated after successful upload", "committedDate": "2020-11-18T10:01:20Z", "type": "commit"}, {"oid": "f14517107fe8b8f6aa2aaf19610adb62bee118cc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f14517107fe8b8f6aa2aaf19610adb62bee118cc", "message": "app digest is now only updated after successful upload", "committedDate": "2020-11-18T10:01:20Z", "type": "forcePushed"}]}