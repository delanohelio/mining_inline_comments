{"pr_number": 946, "pr_title": "Log expired flowable jobs", "pr_createdAt": "2020-09-08T11:25:49Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/946", "timeline": [{"oid": "3fb03424e2e190208f689021c2832db357281c76", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/3fb03424e2e190208f689021c2832db357281c76", "message": "Log expired flowable jobs", "committedDate": "2020-09-08T11:41:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg2NTIxOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/946#discussion_r484865219", "bodyText": "maybe split this if for readability", "author": "ikasarov", "createdAt": "2020-09-08T12:07:46Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/listeners/ExpiredJobListener.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.cloudfoundry.multiapps.controller.process.listeners;\n+\n+import static java.text.MessageFormat.format;\n+\n+import java.time.Instant;\n+\n+import javax.inject.Named;\n+\n+import org.cloudfoundry.multiapps.controller.process.Messages;\n+import org.flowable.common.engine.api.delegate.event.FlowableEngineEntityEvent;\n+import org.flowable.engine.delegate.event.AbstractFlowableEngineEventListener;\n+import org.flowable.job.service.impl.persistence.entity.JobEntity;\n+import org.flowable.job.service.impl.persistence.entity.JobInfoEntity;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Named(\"expiredJobListener\")\n+public class ExpiredJobListener extends AbstractFlowableEngineEventListener {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExpiredJobListener.class);\n+\n+    @Override\n+    public boolean isFailOnException() {\n+        return false;\n+    }\n+\n+    @Override\n+    protected void entityDeleted(FlowableEngineEntityEvent event) {\n+        JobEntity jobEntity = getJobEntity(event);\n+        if (jobEntity != null && hasJobEntityExpired(jobEntity)) {", "originalCommit": "3fb03424e2e190208f689021c2832db357281c76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM5MzQ2MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/946#discussion_r485393460", "bodyText": "Done", "author": "theghost5800", "createdAt": "2020-09-09T07:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg2NTIxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "98c0dce0299c6b12587599da59f9e7b2f2e7ba5c", "chunk": "diff --git a/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/listeners/ExpiredJobListener.java b/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/listeners/ExpiredJobListener.java\nindex 9c07def41..bd9b48578 100644\n--- a/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/listeners/ExpiredJobListener.java\n+++ b/multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/listeners/ExpiredJobListener.java\n\n@@ -27,10 +27,13 @@ public class ExpiredJobListener extends AbstractFlowableEngineEventListener {\n     @Override\n     protected void entityDeleted(FlowableEngineEntityEvent event) {\n         JobEntity jobEntity = getJobEntity(event);\n-        if (jobEntity != null && hasJobEntityExpired(jobEntity)) {\n-            LOGGER.info(format(Messages.JOB_WITH_ID_AND_TASK_NAME_EXPIRED, jobEntity.getProcessInstanceId(), jobEntity.getElementName()));\n+        if (jobEntity == null) {\n+            return;\n         }\n \n+        if (hasJobEntityExpired(jobEntity)) {\n+            LOGGER.info(format(Messages.JOB_WITH_ID_AND_TASK_NAME_EXPIRED, jobEntity.getProcessInstanceId(), jobEntity.getElementName()));\n+        }\n     }\n \n     private JobEntity getJobEntity(FlowableEngineEntityEvent event) {\n"}}, {"oid": "98c0dce0299c6b12587599da59f9e7b2f2e7ba5c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/98c0dce0299c6b12587599da59f9e7b2f2e7ba5c", "message": "Split condition statements", "committedDate": "2020-09-08T15:04:55Z", "type": "forcePushed"}, {"oid": "f016cc332795cff2e807acb175165cace937ed9d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f016cc332795cff2e807acb175165cace937ed9d", "message": "Log expired flowable jobs", "committedDate": "2020-09-09T07:30:45Z", "type": "commit"}, {"oid": "f016cc332795cff2e807acb175165cace937ed9d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f016cc332795cff2e807acb175165cace937ed9d", "message": "Log expired flowable jobs", "committedDate": "2020-09-09T07:30:45Z", "type": "forcePushed"}]}