{"pr_number": 824, "pr_title": "Gacd inline content definition", "pr_createdAt": "2020-03-27T12:44:28Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824", "timeline": [{"oid": "f4a7eedd5adf2da65c078182ee4134339c367992", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f4a7eedd5adf2da65c078182ee4134339c367992", "message": "GACD inline content-definition", "committedDate": "2020-03-27T13:00:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MDU2MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399260560", "bodyText": "Delete this comment as well", "author": "radito3", "createdAt": "2020-03-27T13:24:25Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Constants.java", "diffHunk": "@@ -102,7 +102,6 @@\n     public static final String VAR_ALL_MODULES_TO_DEPLOY = \"allModulesToDeploy\";\r\n     public static final String VAR_APPS_TO_DEPLOY = \"appsToDeploy\";\r\n     // TODO: Do we use this variable?\r", "originalCommit": "f4a7eedd5adf2da65c078182ee4134339c367992", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5OTYwNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399299606", "bodyText": "There are plenty of these comments and I think they are related to \"Variables\" change.", "author": "IvanBorislavovDimitrov", "createdAt": "2020-03-27T14:21:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MDU2MA=="}], "type": "inlineReview", "revised_code": {"commit": "91af1cdb43db59bf65ac507d95caaf35a3d25ea6", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Constants.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Constants.java\nindex 2c97071cf..56dcf7fe4 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Constants.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Constants.java\n\n@@ -102,6 +102,7 @@ public class Constants {\n     public static final String VAR_ALL_MODULES_TO_DEPLOY = \"allModulesToDeploy\";\n     public static final String VAR_APPS_TO_DEPLOY = \"appsToDeploy\";\n     // TODO: Do we use this variable?\n+    public static final String VAR_CONTENTS_TO_DEPLOY = \"contentsToDeploy\";\n     public static final String VAR_DEPLOYMENT_MODE = \"deploymentMode\";\n     public static final String VAR_ITERATED_MODULES_IN_PARALLEL = \"iteratedModulesInParallel\";\n     public static final String VAR_MODULES_TO_ITERATE_IN_PARALLEL = \"modulesToIterateInParallel\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MDczNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399260736", "bodyText": "Didn't we have this function elsewhere?", "author": "radito3", "createdAt": "2020-03-27T13:24:45Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/FileUtils.java", "diffHunk": "@@ -57,6 +62,22 @@ public static boolean isDirectory(String fileName) {\n         return fileName.endsWith(\"/\");\n     }\n \n+    public static void cleanUp(Path filePath, Logger logger) {", "originalCommit": "f4a7eedd5adf2da65c078182ee4134339c367992", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5ODkzNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399298934", "bodyText": "Yes, I moved it here because it was copy-pasted.", "author": "IvanBorislavovDimitrov", "createdAt": "2020-03-27T14:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MDczNg=="}], "type": "inlineReview", "revised_code": {"commit": "09036273183c97ab3c4300781d0ebf282bdd94ff", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/FileUtils.java b/com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/FileUtils.java\nindex 13b4deb22..b33ebe411 100755\n--- a/com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/FileUtils.java\n+++ b/com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/FileUtils.java\n\n@@ -71,10 +70,10 @@ public class FileUtils {\n             return;\n         }\n         try {\n-            logger.debug(DELETING_TEMP_FILE, filePath);\n+            logger.debug(Messages.DELETING_TEMP_FILE, filePath);\n             org.apache.commons.io.FileUtils.forceDelete(file);\n         } catch (IOException e) {\n-            logger.warn(ERROR_DELETING_APP_TEMP_FILE, filePath.toAbsolutePath());\n+            logger.warn(Messages.ERROR_DELETING_APP_TEMP_FILE, filePath.toAbsolutePath());\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2Mjg2NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399262865", "bodyText": "Why the change to static imports?", "author": "radito3", "createdAt": "2020-03-27T13:28:03Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/UploadAppStep.java", "diffHunk": "@@ -185,10 +188,10 @@ private void cleanUp(Path filePath) {\n         }\r\n \r\n         try {\r\n-            getStepLogger().debug(Messages.DELETING_TEMP_FILE, filePath);\r\n+            getStepLogger().debug(DELETING_TEMP_FILE, filePath);\r", "originalCommit": "f4a7eedd5adf2da65c078182ee4134339c367992", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "09036273183c97ab3c4300781d0ebf282bdd94ff", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/UploadAppStep.java b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/UploadAppStep.java\nindex e216f7279..d0561a7ad 100644\n--- a/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/UploadAppStep.java\n+++ b/com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/UploadAppStep.java\n\n@@ -178,23 +179,6 @@ public class UploadAppStep extends TimeoutAsyncFlowableStep {\n         return new MonitorUploadStatusCallback(context, app, file);\n     }\n \n-    private void cleanUp(Path filePath) {\n-        if (filePath == null) {\n-            return;\n-        }\n-        File file = filePath.toFile();\n-        if (!file.exists()) {\n-            return;\n-        }\n-\n-        try {\n-            getStepLogger().debug(DELETING_TEMP_FILE, filePath);\n-            FileUtils.forceDelete(file);\n-        } catch (IOException e) {\n-            getStepLogger().warn(ERROR_DELETING_APP_TEMP_FILE, filePath.toAbsolutePath());\n-        }\n-    }\n-\n     @Override\n     protected List<AsyncExecution> getAsyncStepExecutions(ProcessContext context) {\n         return Collections.singletonList(new PollUploadAppStatusExecution());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2ODAyMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399268020", "bodyText": "If the parameters is only going to be a one-entry map, you could use MapUtil.asMap", "author": "radito3", "createdAt": "2020-03-27T13:35:24Z", "path": "com.sap.cloud.lm.sl.cf.web/src/test/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImplTest.java", "diffHunk": "@@ -191,7 +194,12 @@ public void testExecuteOperationActionUnauthorized() {\n \n     @Test\n     public void testStartOperation() {\n-        testedClass.startOperation(mockHttpServletRequest(EXAMPLE_USER), SPACE_GUID, createOperation(null, null));\n+        Map<String, Object> parameters = new HashMap<>();\n+        parameters.put(Constants.PARAM_MTA_ID, \"test\");\n+        Operation operation = createOperation(null, null, parameters);", "originalCommit": "f4a7eedd5adf2da65c078182ee4134339c367992", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5OTcyOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/824#discussion_r399299729", "bodyText": "Done", "author": "IvanBorislavovDimitrov", "createdAt": "2020-03-27T14:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2ODAyMA=="}], "type": "inlineReview", "revised_code": {"commit": "09036273183c97ab3c4300781d0ebf282bdd94ff", "chunk": "diff --git a/com.sap.cloud.lm.sl.cf.web/src/test/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImplTest.java b/com.sap.cloud.lm.sl.cf.web/src/test/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImplTest.java\nindex 273dc5a6f..02c312bd3 100644\n--- a/com.sap.cloud.lm.sl.cf.web/src/test/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImplTest.java\n+++ b/com.sap.cloud.lm.sl.cf.web/src/test/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImplTest.java\n\n@@ -194,8 +194,7 @@ public class OperationsApiServiceImplTest {\n \n     @Test\n     public void testStartOperation() {\n-        Map<String, Object> parameters = new HashMap<>();\n-        parameters.put(Constants.PARAM_MTA_ID, \"test\");\n+        Map<String, Object> parameters = MapUtil.asMap(Constants.PARAM_MTA_ID, \"test\");\n         Operation operation = createOperation(null, null, parameters);\n         Mockito.when(operationsHelper.getProcessDefinitionKey(operation))\n                .thenReturn(\"deploy\");\n"}}, {"oid": "09036273183c97ab3c4300781d0ebf282bdd94ff", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/09036273183c97ab3c4300781d0ebf282bdd94ff", "message": "Adopt multiapps 1.90.0-SNAPSHOT", "committedDate": "2020-03-27T14:17:04Z", "type": "forcePushed"}, {"oid": "91af1cdb43db59bf65ac507d95caaf35a3d25ea6", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/91af1cdb43db59bf65ac507d95caaf35a3d25ea6", "message": "Fix failing test", "committedDate": "2020-04-01T14:25:54Z", "type": "commit"}, {"oid": "744806f87ac665eac688d2023a0928d900a3b33c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/744806f87ac665eac688d2023a0928d900a3b33c", "message": "GACD inline content-definition", "committedDate": "2020-04-01T14:25:55Z", "type": "commit"}, {"oid": "744806f87ac665eac688d2023a0928d900a3b33c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/744806f87ac665eac688d2023a0928d900a3b33c", "message": "GACD inline content-definition", "committedDate": "2020-04-01T14:25:55Z", "type": "forcePushed"}]}