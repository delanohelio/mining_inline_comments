{"pr_number": 881, "pr_title": "Fix scheduling classifier handling of ExclusiveHost hard constraint failures", "pr_createdAt": "2020-07-13T23:20:12Z", "pr_url": "https://github.com/Netflix/titus-control-plane/pull/881", "timeline": [{"oid": "4772a3c3c74d3422e0d5a836bb5ef9dae3835bf9", "url": "https://github.com/Netflix/titus-control-plane/commit/4772a3c3c74d3422e0d5a836bb5ef9dae3835bf9", "message": "KubeApiNotAvailable is a transient scheduling error\n\nIt will not trigger autoscaling, or modify opportunistic scheduling", "committedDate": "2020-07-13T23:09:18Z", "type": "commit"}, {"oid": "e41b5f67c565e0ccb1916da0a01ac029f6b7e4c9", "url": "https://github.com/Netflix/titus-control-plane/commit/e41b5f67c565e0ccb1916da0a01ac029f6b7e4c9", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures.", "committedDate": "2020-07-13T23:20:43Z", "type": "forcePushed"}, {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "url": "https://github.com/Netflix/titus-control-plane/commit/c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures.", "committedDate": "2020-07-13T23:22:17Z", "type": "commit"}, {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "url": "https://github.com/Netflix/titus-control-plane/commit/c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures.", "committedDate": "2020-07-13T23:22:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUwOTc0MQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/881#discussion_r454509741", "bodyText": "Is the priority defined by the declaration order in the enum type?", "author": "tbak", "createdAt": "2020-07-14T17:08:00Z", "path": "titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailure.java", "diffHunk": "@@ -79,31 +79,46 @@\n          */\n         OpportunisticResource,\n \n+        /**\n+         * Task not launched due to other tasks with the exclusiveHost hard constraint on the same agent. It has the lowest priority.\n+         */\n+        ExclusiveHost,", "originalCommit": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0ODcwNg==", "url": "https://github.com/Netflix/titus-control-plane/pull/881#discussion_r454548706", "bodyText": "No, the priority is defined by how TaskPlacementFailureClassifier uses each FailureKind defined here. I will add more comments to reflect that.", "author": "fabiokung", "createdAt": "2020-07-14T18:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUwOTc0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5b670f85db3b7fa28a1bb6167adf8786f3488ab4", "chunk": "diff --git a/titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailure.java b/titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailure.java\nindex 3dccd866d..8f8faffb5 100644\n--- a/titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailure.java\n+++ b/titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailure.java\n\n@@ -81,6 +81,8 @@ public class TaskPlacementFailure {\n \n         /**\n          * Task not launched due to other tasks with the exclusiveHost hard constraint on the same agent. It has the lowest priority.\n+         *\n+         * @see TaskPlacementFailureClassifier for how {@link FailureKind failure kinds} are used and what are their priorities\n          */\n         ExclusiveHost,\n \n"}}, {"oid": "5b670f85db3b7fa28a1bb6167adf8786f3488ab4", "url": "https://github.com/Netflix/titus-control-plane/commit/5b670f85db3b7fa28a1bb6167adf8786f3488ab4", "message": "address PR review comments", "committedDate": "2020-07-14T19:04:18Z", "type": "commit"}]}