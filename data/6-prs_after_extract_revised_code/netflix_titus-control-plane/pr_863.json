{"pr_number": 863, "pr_title": "Support remote data plane region", "pr_createdAt": "2020-06-06T09:04:48Z", "pr_url": "https://github.com/Netflix/titus-control-plane/pull/863", "timeline": [{"oid": "977bddc7bfeaeacc33d15b82157aff95a6f9b48f", "url": "https://github.com/Netflix/titus-control-plane/commit/977bddc7bfeaeacc33d15b82157aff95a6f9b48f", "message": "Refactoring ConstraintValidators to sanitize violation message so it is not an EL expression", "committedDate": "2020-02-29T00:54:26Z", "type": "commit"}, {"oid": "59b0d7d80b1dc3c194b5e7b59d2dff898514cc8c", "url": "https://github.com/Netflix/titus-control-plane/commit/59b0d7d80b1dc3c194b5e7b59d2dff898514cc8c", "message": "Merge pull request #3 from joshi-keyur/VUL-1981/sanitize-violation-message\n\nRefactoring ConstraintValidators to sanitize violation message templates", "committedDate": "2020-02-29T01:35:15Z", "type": "commit"}, {"oid": "b10fc85d64c5ae72663a0de03d3d48bf916af138", "url": "https://github.com/Netflix/titus-control-plane/commit/b10fc85d64c5ae72663a0de03d3d48bf916af138", "message": "Replacing the Wrapper class with a Function which sanitizes the string message", "committedDate": "2020-03-02T20:35:03Z", "type": "commit"}, {"oid": "9eb082394c84d191cc6de9318260b5866ae0ea3f", "url": "https://github.com/Netflix/titus-control-plane/commit/9eb082394c84d191cc6de9318260b5866ae0ea3f", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-03T19:24:20Z", "type": "commit"}, {"oid": "eebceece71c91139503a318afc7ebeeb678ed356", "url": "https://github.com/Netflix/titus-control-plane/commit/eebceece71c91139503a318afc7ebeeb678ed356", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-03T22:20:36Z", "type": "commit"}, {"oid": "bb750fa731641fd1538b2b8057146c114509a858", "url": "https://github.com/Netflix/titus-control-plane/commit/bb750fa731641fd1538b2b8057146c114509a858", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-11T00:15:42Z", "type": "commit"}, {"oid": "e88f776c66c32702286e2ad3e9b1a5888c388804", "url": "https://github.com/Netflix/titus-control-plane/commit/e88f776c66c32702286e2ad3e9b1a5888c388804", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-16T00:47:46Z", "type": "commit"}, {"oid": "205853bb81846f2fa265db2570d392cdcbc54326", "url": "https://github.com/Netflix/titus-control-plane/commit/205853bb81846f2fa265db2570d392cdcbc54326", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-31T21:47:21Z", "type": "commit"}, {"oid": "9737864bccf7114edbb2ab78e0028f483ad613fb", "url": "https://github.com/Netflix/titus-control-plane/commit/9737864bccf7114edbb2ab78e0028f483ad613fb", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-04-10T23:31:27Z", "type": "commit"}, {"oid": "4ab2af94f2e309ccae885329c53b92f7b68e724c", "url": "https://github.com/Netflix/titus-control-plane/commit/4ab2af94f2e309ccae885329c53b92f7b68e724c", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-04-14T00:45:06Z", "type": "commit"}, {"oid": "2a3d0749cd9ff5ac92bebce1c49d275ace83f3d2", "url": "https://github.com/Netflix/titus-control-plane/commit/2a3d0749cd9ff5ac92bebce1c49d275ace83f3d2", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-04-14T19:45:50Z", "type": "commit"}, {"oid": "2acb17cade27bce3a36dc7d03f7ed98d831a0cf4", "url": "https://github.com/Netflix/titus-control-plane/commit/2acb17cade27bce3a36dc7d03f7ed98d831a0cf4", "message": "WIP: Introduce schedulerName to ApplicationSLA and use default scheduler value \"fenzo\"", "committedDate": "2020-04-14T23:40:02Z", "type": "commit"}, {"oid": "26d9906ff53d600ac8b7aeb6ff739b58be4f7f24", "url": "https://github.com/Netflix/titus-control-plane/commit/26d9906ff53d600ac8b7aeb6ff739b58be4f7f24", "message": "PR review comments", "committedDate": "2020-04-15T23:56:07Z", "type": "commit"}, {"oid": "b4c2f61677fbcf244420437b2a9c64dbc9a2f3ec", "url": "https://github.com/Netflix/titus-control-plane/commit/b4c2f61677fbcf244420437b2a9c64dbc9a2f3ec", "message": "Fixed typo", "committedDate": "2020-04-16T17:03:04Z", "type": "commit"}, {"oid": "fa13bb987e90b423cf4ca08b20572c7b2ed64493", "url": "https://github.com/Netflix/titus-control-plane/commit/fa13bb987e90b423cf4ca08b20572c7b2ed64493", "message": "Handle updates by removing previous instance from the scheduler cache", "committedDate": "2020-04-17T21:37:17Z", "type": "commit"}, {"oid": "21fe05c2b85279e2c3943cc593a4703c5d015397", "url": "https://github.com/Netflix/titus-control-plane/commit/21fe05c2b85279e2c3943cc593a4703c5d015397", "message": "Additional tests for find-by-scheduler and update operations", "committedDate": "2020-04-17T21:39:24Z", "type": "commit"}, {"oid": "f4d1e147bb2ff7ffa077ccfa13b1a379f1966472", "url": "https://github.com/Netflix/titus-control-plane/commit/f4d1e147bb2ff7ffa077ccfa13b1a379f1966472", "message": "Merge pull request #4 from joshi-keyur/ApplicationSLA-model-extension\n\nAdd schedulerName attribute to ApplicationSLA and supporting API changes", "committedDate": "2020-04-17T21:44:55Z", "type": "commit"}, {"oid": "c667ac71a53d71d8a07884a4721d157e50e57b6e", "url": "https://github.com/Netflix/titus-control-plane/commit/c667ac71a53d71d8a07884a4721d157e50e57b6e", "message": "Removing Jackson annotations and moving to ApplicationSlaMixIn", "committedDate": "2020-04-18T00:25:21Z", "type": "commit"}, {"oid": "960dc44d5704b1a667bbf1e4b1a47a650ebed680", "url": "https://github.com/Netflix/titus-control-plane/commit/960dc44d5704b1a667bbf1e4b1a47a650ebed680", "message": "Added error logging and more integration tests", "committedDate": "2020-04-21T06:22:33Z", "type": "commit"}, {"oid": "5c93df457a58c4cc7018e8b4f2f2fb2ca2c67182", "url": "https://github.com/Netflix/titus-control-plane/commit/5c93df457a58c4cc7018e8b4f2f2fb2ca2c67182", "message": "Partially reverting the change to fix broken integration tests", "committedDate": "2020-04-21T07:18:49Z", "type": "commit"}, {"oid": "e97936e821c5d5ce8872eecebfbd1dd84ac08374", "url": "https://github.com/Netflix/titus-control-plane/commit/e97936e821c5d5ce8872eecebfbd1dd84ac08374", "message": "Removing TODO comment", "committedDate": "2020-04-22T04:43:20Z", "type": "commit"}, {"oid": "e7b0271e79d4277cd2e30b1e74adf7b1f0acb102", "url": "https://github.com/Netflix/titus-control-plane/commit/e7b0271e79d4277cd2e30b1e74adf7b1f0acb102", "message": "Formatting changes", "committedDate": "2020-04-22T22:24:20Z", "type": "commit"}, {"oid": "3bf829749eebe77a903db8d388c49f696be40d85", "url": "https://github.com/Netflix/titus-control-plane/commit/3bf829749eebe77a903db8d388c49f696be40d85", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-05-19T05:07:54Z", "type": "commit"}, {"oid": "b2063e96091b71807f0cc15a0cd24cd4df236cbd", "url": "https://github.com/Netflix/titus-control-plane/commit/b2063e96091b71807f0cc15a0cd24cd4df236cbd", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-06-01T21:01:51Z", "type": "commit"}, {"oid": "439b60f1d576cb9231a506e949aeff6488736acd", "url": "https://github.com/Netflix/titus-control-plane/commit/439b60f1d576cb9231a506e949aeff6488736acd", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-06-06T08:52:30Z", "type": "commit"}, {"oid": "2674e899826b894de29f4eab59ae47fbd9a9e027", "url": "https://github.com/Netflix/titus-control-plane/commit/2674e899826b894de29f4eab59ae47fbd9a9e027", "message": "Support for remote data plane region", "committedDate": "2020-06-06T08:58:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgwMDQ0NQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/863#discussion_r436800445", "bodyText": "This code looks identical in all provider classes. We should move it to a utility class and share one implementation.", "author": "tbak", "createdAt": "2020-06-08T15:35:14Z", "path": "titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonAutoScalingAsyncProvider.java", "diffHunk": "@@ -33,7 +34,11 @@\n \n     @Inject\n     public AmazonAutoScalingAsyncProvider(AwsConfiguration configuration, AWSCredentialsProvider credentialProvider) {\n-        String region = configuration.getRegion().trim().toLowerCase();\n+        String region = configuration.getDataPlaneRegion().trim().toLowerCase();", "originalCommit": "2674e899826b894de29f4eab59ae47fbd9a9e027", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7a254fb373c5b027649f6c3217c96f8ac1606308", "chunk": "diff --git a/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonAutoScalingAsyncProvider.java b/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonAutoScalingAsyncProvider.java\nindex 42fa67625..3569893dc 100644\n--- a/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonAutoScalingAsyncProvider.java\n+++ b/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonAutoScalingAsyncProvider.java\n\n@@ -34,10 +33,7 @@ public class AmazonAutoScalingAsyncProvider implements Provider<AmazonAutoScalin\n \n     @Inject\n     public AmazonAutoScalingAsyncProvider(AwsConfiguration configuration, AWSCredentialsProvider credentialProvider) {\n-        String region = configuration.getDataPlaneRegion().trim().toLowerCase();\n-        if (StringExt.isEmpty(region)) {\n-            region = configuration.getRegion().trim().toLowerCase();\n-        }\n+        String region = AwsRegionConfigurationUtil.resolveDataPlaneRegion(configuration);\n \n         this.amazonAutoScaling = AmazonAutoScalingAsyncClientBuilder.standard()\n                 .withEndpointConfiguration(new AwsClientBuilder.EndpointConfiguration(\"autoscaling.\" + region + \".amazonaws.com\", region))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgxODMwOA==", "url": "https://github.com/Netflix/titus-control-plane/pull/863#discussion_r436818308", "bodyText": "like above, this logic appears many times.", "author": "corindwyer", "createdAt": "2020-06-08T16:00:39Z", "path": "titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonClientProvider.java", "diffHunk": "@@ -34,7 +35,10 @@ public AmazonElasticLoadBalancingAsync getLoadBalancingClient(String accountId)\n             synchronized (this) {\n                 client = loadBalancerClients.get(accountId);\n                 if (client == null) {\n-                    String region = configuration.getRegion().trim().toLowerCase();\n+                    String region = configuration.getDataPlaneRegion().trim().toLowerCase();", "originalCommit": "2674e899826b894de29f4eab59ae47fbd9a9e027", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7a254fb373c5b027649f6c3217c96f8ac1606308", "chunk": "diff --git a/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonClientProvider.java b/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonClientProvider.java\nindex 11e197630..e54be3bc4 100644\n--- a/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonClientProvider.java\n+++ b/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonClientProvider.java\n\n@@ -35,10 +34,7 @@ public class AmazonClientProvider {\n             synchronized (this) {\n                 client = loadBalancerClients.get(accountId);\n                 if (client == null) {\n-                    String region = configuration.getDataPlaneRegion().trim().toLowerCase();\n-                    if (StringExt.isEmpty(region)) {\n-                        region = configuration.getRegion().trim().toLowerCase();\n-                    }\n+                    String region = AwsRegionConfigurationUtil.resolveDataPlaneRegion(configuration);\n                     AWSCredentialsProvider credentialsProvider = getAwsCredentialsProvider(accountId);\n                     client = AmazonElasticLoadBalancingAsyncClientBuilder.standard()\n                             .withCredentials(credentialsProvider)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgxODYwOA==", "url": "https://github.com/Netflix/titus-control-plane/pull/863#discussion_r436818608", "bodyText": "same as above", "author": "corindwyer", "createdAt": "2020-06-08T16:01:03Z", "path": "titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonEC2AsyncProvider.java", "diffHunk": "@@ -33,7 +34,11 @@\n \n     @Inject\n     public AmazonEC2AsyncProvider(AwsConfiguration configuration, AWSCredentialsProvider credentialProvider) {\n-        String region = configuration.getRegion().trim().toLowerCase();\n+        String region = configuration.getDataPlaneRegion().trim().toLowerCase();", "originalCommit": "2674e899826b894de29f4eab59ae47fbd9a9e027", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7a254fb373c5b027649f6c3217c96f8ac1606308", "chunk": "diff --git a/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonEC2AsyncProvider.java b/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonEC2AsyncProvider.java\nindex 06235718c..798301f50 100644\n--- a/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonEC2AsyncProvider.java\n+++ b/titus-ext/aws/src/main/java/com/netflix/titus/ext/aws/AmazonEC2AsyncProvider.java\n\n@@ -34,10 +33,7 @@ public class AmazonEC2AsyncProvider implements Provider<AmazonEC2Async> {\n \n     @Inject\n     public AmazonEC2AsyncProvider(AwsConfiguration configuration, AWSCredentialsProvider credentialProvider) {\n-        String region = configuration.getDataPlaneRegion().trim().toLowerCase();\n-        if (StringExt.isEmpty(region)) {\n-            region = configuration.getRegion().trim().toLowerCase();\n-        }\n+        String region = AwsRegionConfigurationUtil.resolveDataPlaneRegion(configuration);\n \n         this.amazonEC2Async = AmazonEC2AsyncClientBuilder.standard()\n                 .withEndpointConfiguration(new AwsClientBuilder.EndpointConfiguration(\"ec2.\" + region + \".amazonaws.com\", region))\n"}}, {"oid": "7a254fb373c5b027649f6c3217c96f8ac1606308", "url": "https://github.com/Netflix/titus-control-plane/commit/7a254fb373c5b027649f6c3217c96f8ac1606308", "message": "Add util class for resolving data plane region", "committedDate": "2020-06-08T16:18:57Z", "type": "commit"}]}