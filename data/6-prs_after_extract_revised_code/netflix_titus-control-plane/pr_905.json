{"pr_number": 905, "pr_title": "Rate limit reconciliation of tasks stuck in state", "pr_createdAt": "2020-08-27T19:48:07Z", "pr_url": "https://github.com/Netflix/titus-control-plane/pull/905", "timeline": [{"oid": "de1cac14ead38a8986a412f74d5c3a33cb2bdfc8", "url": "https://github.com/Netflix/titus-control-plane/commit/de1cac14ead38a8986a412f74d5c3a33cb2bdfc8", "message": "rate limit reconciliation of tasks stuck in state\n\n... with dynamic configuration.", "committedDate": "2020-08-27T19:47:05Z", "type": "commit"}, {"oid": "54d6e23c771bdeff83d2aa7ab2b44fa91f953d7a", "url": "https://github.com/Netflix/titus-control-plane/commit/54d6e23c771bdeff83d2aa7ab2b44fa91f953d7a", "message": "use a simple Logger instead of the SystemLogger", "committedDate": "2020-08-27T20:00:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM4Njk2NQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/905#discussion_r479386965", "bodyText": "We should return an actual strategy here.", "author": "tbak", "createdAt": "2020-08-28T15:44:06Z", "path": "titus-common/src/main/java/com/netflix/titus/common/util/limiter/Limiters.java", "diffHunk": "@@ -75,4 +80,54 @@ public static TokenBucket createInstrumentedFixedIntervalTokenBucket(String name\n                 titusRuntime\n         );\n     }\n+\n+    private static class Unlimited implements TokenBucket {\n+        private final String name;\n+\n+        public Unlimited(String name) {\n+            this.name = name;\n+        }\n+\n+        @Override\n+        public String getName() {\n+            return name;\n+        }\n+\n+        @Override\n+        public long getCapacity() {\n+            return Long.MAX_VALUE;\n+        }\n+\n+        @Override\n+        public long getNumberOfTokens() {\n+            return Long.MAX_VALUE;\n+        }\n+\n+        @Override\n+        public boolean tryTake() {\n+            return true;\n+        }\n+\n+        @Override\n+        public boolean tryTake(long numberOfTokens) {\n+            return true;\n+        }\n+\n+        @Override\n+        public void take() {\n+        }\n+\n+        @Override\n+        public void take(long numberOfTokens) {\n+        }\n+\n+        @Override\n+        public void refill(long numberOfToken) {\n+        }\n+\n+        @Override\n+        public RefillStrategy getRefillStrategy() {\n+            return null;", "originalCommit": "54d6e23c771bdeff83d2aa7ab2b44fa91f953d7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3NjUwOQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/905#discussion_r479476509", "bodyText": "Yeah, thanks for keeping me honest. I was being lazy here. I will add it", "author": "fabiokung", "createdAt": "2020-08-28T18:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM4Njk2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "d9c06a145e60d3e37bf1aa3f93e902ab98212135", "chunk": "diff --git a/titus-common/src/main/java/com/netflix/titus/common/util/limiter/Limiters.java b/titus-common/src/main/java/com/netflix/titus/common/util/limiter/Limiters.java\nindex 3d7531233..51d66e6b3 100644\n--- a/titus-common/src/main/java/com/netflix/titus/common/util/limiter/Limiters.java\n+++ b/titus-common/src/main/java/com/netflix/titus/common/util/limiter/Limiters.java\n\n@@ -83,6 +83,7 @@ public class Limiters {\n \n     private static class Unlimited implements TokenBucket {\n         private final String name;\n+        private final UnlimitedRefillStrategy strategy = new UnlimitedRefillStrategy();\n \n         public Unlimited(String name) {\n             this.name = name;\n"}}, {"oid": "d9c06a145e60d3e37bf1aa3f93e902ab98212135", "url": "https://github.com/Netflix/titus-control-plane/commit/d9c06a145e60d3e37bf1aa3f93e902ab98212135", "message": "do not use a `null` refill strategy", "committedDate": "2020-08-28T18:50:50Z", "type": "commit"}]}