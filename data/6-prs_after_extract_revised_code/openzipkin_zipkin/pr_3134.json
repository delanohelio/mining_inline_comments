{"pr_number": 3134, "pr_title": "Removes guava dep in preparation of Datastax Driver 4.x", "pr_createdAt": "2020-07-04T04:02:03Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3134", "timeline": [{"oid": "07a3330119541da704394c311253ee91da065186", "url": "https://github.com/openzipkin/zipkin/commit/07a3330119541da704394c311253ee91da065186", "message": "Removes guava dep in preparation of Datastax Driver 4.x\n\nWe only needed guava for Cassandra. Removing it here makes migration easier.\n\nNote: there's still a guava left in cassandra-v1 which is too complex to undo\nin this PR (Table and Cache apis).", "committedDate": "2020-07-04T03:59:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0NjQ0OQ==", "url": "https://github.com/openzipkin/zipkin/pull/3134#discussion_r449746449", "bodyText": "Looks like don't need reader", "author": "anuraaga", "createdAt": "2020-07-04T06:50:03Z", "path": "zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/Schema.java", "diffHunk": "@@ -145,7 +145,7 @@ static boolean hasUpgrade3_remoteService(KeyspaceMetadata keyspaceMetadata) {\n \n   static void applyCqlFile(String keyspace, Session session, String resource) {\n     try (Reader reader = new InputStreamReader(Schema.class.getResourceAsStream(resource), UTF_8)) {", "originalCommit": "07a3330119541da704394c311253ee91da065186", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0NzIxNQ==", "url": "https://github.com/openzipkin/zipkin/pull/3134#discussion_r449747215", "bodyText": "heh yeah for sure!", "author": "codefromthecrypt", "createdAt": "2020-07-04T07:01:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0NjQ0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "9a1571af2bd6df90af1ff75582a2b06ae9722a00", "chunk": "diff --git a/zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/Schema.java b/zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/Schema.java\nindex 0f1a3430e..5a64a705b 100644\n--- a/zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/Schema.java\n+++ b/zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/Schema.java\n\n@@ -144,15 +140,11 @@ final class Schema {\n   }\n \n   static void applyCqlFile(String keyspace, Session session, String resource) {\n-    try (Reader reader = new InputStreamReader(Schema.class.getResourceAsStream(resource), UTF_8)) {\n-      for (String cmd : resourceToString(resource).split(\";\", 100)) {\n-        cmd = cmd.trim().replace(\" zipkin\", \" \" + keyspace);\n-        if (!cmd.isEmpty()) {\n-          session.execute(cmd);\n-        }\n+    for (String cmd : resourceToString(resource).split(\";\", 100)) {\n+      cmd = cmd.trim().replace(\" zipkin\", \" \" + keyspace);\n+      if (!cmd.isEmpty()) {\n+        session.execute(cmd);\n       }\n-    } catch (IOException ex) {\n-      LOG.error(ex.getMessage(), ex);\n     }\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0NjY0Ng==", "url": "https://github.com/openzipkin/zipkin/pull/3134#discussion_r449746646", "bodyText": "Lowercase since method", "author": "anuraaga", "createdAt": "2020-07-04T06:52:51Z", "path": "zipkin-storage/cassandra/src/main/java/zipkin2/storage/cassandra/CassandraUtil.java", "diffHunk": "@@ -126,4 +132,13 @@ public String toString() {\n     }\n     return result;\n   }\n+\n+  @Nullable static InetAddress InetAddressOrNull(@Nullable String string, @Nullable byte[] bytes) {", "originalCommit": "07a3330119541da704394c311253ee91da065186", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a1571af2bd6df90af1ff75582a2b06ae9722a00", "chunk": "diff --git a/zipkin-storage/cassandra/src/main/java/zipkin2/storage/cassandra/CassandraUtil.java b/zipkin-storage/cassandra/src/main/java/zipkin2/storage/cassandra/CassandraUtil.java\nindex c96874698..5c9323cb9 100644\n--- a/zipkin-storage/cassandra/src/main/java/zipkin2/storage/cassandra/CassandraUtil.java\n+++ b/zipkin-storage/cassandra/src/main/java/zipkin2/storage/cassandra/CassandraUtil.java\n\n@@ -133,7 +133,7 @@ final class CassandraUtil {\n     return result;\n   }\n \n-  @Nullable static InetAddress InetAddressOrNull(@Nullable String string, @Nullable byte[] bytes) {\n+  @Nullable static InetAddress inetAddressOrNull(@Nullable String string, @Nullable byte[] bytes) {\n     try {\n       return bytes == null ? null : InetAddress.getByAddress(bytes);\n     } catch (UnknownHostException e) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0Njk0MA==", "url": "https://github.com/openzipkin/zipkin/pull/3134#discussion_r449746940", "bodyText": "Intentional to leave this one?", "author": "anuraaga", "createdAt": "2020-07-04T06:57:30Z", "path": "zipkin-storage/cassandra/src/test/java/zipkin2/storage/cassandra/internal/call/ResultSetFutureCallTest.java", "diffHunk": "@@ -17,12 +17,11 @@\n import com.datastax.driver.core.exceptions.BusyConnectionException;\n import com.datastax.driver.core.exceptions.BusyPoolException;\n import com.datastax.driver.core.exceptions.QueryConsistencyException;\n+import com.google.common.util.concurrent.SettableFuture;", "originalCommit": "07a3330119541da704394c311253ee91da065186", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0NzA5Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3134#discussion_r449747093", "bodyText": "yeah this version of cassandra uses guava futures, but that becomes a somewhat mechanical change later.", "author": "codefromthecrypt", "createdAt": "2020-07-04T07:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc0Njk0MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "9a1571af2bd6df90af1ff75582a2b06ae9722a00", "url": "https://github.com/openzipkin/zipkin/commit/9a1571af2bd6df90af1ff75582a2b06ae9722a00", "message": "cleanups per feedback", "committedDate": "2020-07-04T07:02:15Z", "type": "commit"}]}