{"pr_number": 3249, "pr_title": "Refactors integration tests to be more isolated", "pr_createdAt": "2020-10-20T15:34:13Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3249", "timeline": [{"oid": "4949831c72599bf3eb135e48ec68140c39c6d8bc", "url": "https://github.com/openzipkin/zipkin/commit/4949831c72599bf3eb135e48ec68140c39c6d8bc", "message": "Refactors integration tests to be more isolated\n\nThis makes all integration tests use unique data. Notably, they no\nlonger use constant trace ID or service names, as this can lead to\ndifficulty when a keyspace is re-used. For example, service names and\ntrace IDs are often partitions. When debugging it is easier when test\ndata is isolated by a service name as it can be easily queried.\n\nThis also pulls the heaviest tests into their own classes so that they\ndon't overload the storage containers used by the bulk of our tests.\n\nFinally, this fixes a few glitches in the v1 cassandra storage.", "committedDate": "2020-10-21T02:28:56Z", "type": "commit"}, {"oid": "4949831c72599bf3eb135e48ec68140c39c6d8bc", "url": "https://github.com/openzipkin/zipkin/commit/4949831c72599bf3eb135e48ec68140c39c6d8bc", "message": "Refactors integration tests to be more isolated\n\nThis makes all integration tests use unique data. Notably, they no\nlonger use constant trace ID or service names, as this can lead to\ndifficulty when a keyspace is re-used. For example, service names and\ntrace IDs are often partitions. When debugging it is easier when test\ndata is isolated by a service name as it can be easily queried.\n\nThis also pulls the heaviest tests into their own classes so that they\ndon't overload the storage containers used by the bulk of our tests.\n\nFinally, this fixes a few glitches in the v1 cassandra storage.", "committedDate": "2020-10-21T02:28:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzA0NzA3Ng==", "url": "https://github.com/openzipkin/zipkin/pull/3249#discussion_r553047076", "bodyText": "@adriancole can you provide us more context about this change? We were implicitly relying on the previous logic that left-padded 0s for trace ids generated by a legacy application. We have a workaround in place to fix the broken pipeline, but we wanted to hear why this explicitly checks for length of 15 (vs 14, 13 etc...)", "author": "karkum", "createdAt": "2021-01-07T00:48:03Z", "path": "zipkin/src/main/java/zipkin2/Span.java", "diffHunk": "@@ -635,6 +635,7 @@ public static String normalizeTraceId(String traceId) {\n     if (length > 32) throw new IllegalArgumentException(\"traceId.length > 32\");\n     int zeros = validateHexAndReturnZeroPrefix(traceId);\n     if (zeros == length) throw new IllegalArgumentException(\"traceId is all zeros\");\n+    if (length == 15) throw new RuntimeException(\"WTF\");", "originalCommit": "4949831c72599bf3eb135e48ec68140c39c6d8bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}