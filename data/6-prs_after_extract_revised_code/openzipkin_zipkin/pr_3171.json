{"pr_number": 3171, "pr_title": "es early deprecation fail", "pr_createdAt": "2020-08-08T16:51:22Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3171", "timeline": [{"oid": "51a8a53578f4c44d7458d8b682937cfa6fbca111", "url": "https://github.com/openzipkin/zipkin/commit/51a8a53578f4c44d7458d8b682937cfa6fbca111", "message": "add note about handling retention", "committedDate": "2020-07-25T13:13:55Z", "type": "commit"}, {"oid": "af182b80ba2a5a05272c0897acbbe17fbf6187df", "url": "https://github.com/openzipkin/zipkin/commit/af182b80ba2a5a05272c0897acbbe17fbf6187df", "message": "Merge pull request #2 from openzipkin/elastic-retention\n\nadd note about handling retention", "committedDate": "2020-07-25T13:17:48Z", "type": "commit"}, {"oid": "b9b8603bb2727c25f4792ffe84e012728115e5a0", "url": "https://github.com/openzipkin/zipkin/commit/b9b8603bb2727c25f4792ffe84e012728115e5a0", "message": "Merge branch 'master' of https://github.com/jorgheymans/zipkin", "committedDate": "2020-07-29T10:01:59Z", "type": "commit"}, {"oid": "13b5ee021dde3010dfec18bd21b3847f87e849e2", "url": "https://github.com/openzipkin/zipkin/commit/13b5ee021dde3010dfec18bd21b3847f87e849e2", "message": "Merge branch 'master' of https://github.com/openzipkin/zipkin", "committedDate": "2020-08-08T07:17:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk0NDUyMA==", "url": "https://github.com/openzipkin/zipkin/pull/3171#discussion_r468944520", "bodyText": "if this is about index templates, possibly we can make this a test instead. ex we don't have ITEnsureIndexTemplate like in cassandra ITEnsureSchema. My assumption is that this is independent of api calls and so only needs to run once, but it should run after we setup the templates. having it as a separate test file will make this part more explicit and close to what fails imho.", "author": "codefromthecrypt", "createdAt": "2020-08-12T00:55:06Z", "path": "zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ElasticsearchStorageExtension.java", "diffHunk": "@@ -71,6 +87,7 @@\n \n     try {\n       tryToInitializeSession();\n+      checkForDeprecatedFeatures();", "originalCommit": "7a987888500e3557e78a25f652e83c5338693b89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyMDA4OQ==", "url": "https://github.com/openzipkin/zipkin/pull/3171#discussion_r499220089", "bodyText": "makes sense, moved to a different test", "author": "jorgheymans", "createdAt": "2020-10-04T08:31:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk0NDUyMA=="}], "type": "inlineReview", "revised_code": {"commit": "674e82c2ffb569ed335a97deaa7f94ff9584bbc5", "chunk": "diff --git a/zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ElasticsearchStorageExtension.java b/zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ElasticsearchStorageExtension.java\nindex c31473e88..e702246f3 100644\n--- a/zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ElasticsearchStorageExtension.java\n+++ b/zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ElasticsearchStorageExtension.java\n\n@@ -87,7 +75,6 @@ class ElasticsearchStorageExtension implements BeforeAllCallback, AfterAllCallba\n \n     try {\n       tryToInitializeSession();\n-      checkForDeprecatedFeatures();\n     } catch (RuntimeException | IOException | Error e) {\n       if (container == null) throw e;\n       LOGGER.warn(\"Couldn't connect to docker image \" + image + \": \" + e.getMessage(), e);\n"}}, {"oid": "674e82c2ffb569ed335a97deaa7f94ff9584bbc5", "url": "https://github.com/openzipkin/zipkin/commit/674e82c2ffb569ed335a97deaa7f94ff9584bbc5", "message": "Merge branch 'master' of https://github.com/openzipkin/zipkin", "committedDate": "2020-09-10T07:14:22Z", "type": "commit"}, {"oid": "66885b6a7a90b7ea5c30b76cf93499a288792105", "url": "https://github.com/openzipkin/zipkin/commit/66885b6a7a90b7ea5c30b76cf93499a288792105", "message": "Merge branch 'master' of https://github.com/openzipkin/zipkin", "committedDate": "2020-10-03T10:10:42Z", "type": "commit"}, {"oid": "85f2ad8d412222dcd059abf89d2c64f134a7d897", "url": "https://github.com/openzipkin/zipkin/commit/85f2ad8d412222dcd059abf89d2c64f134a7d897", "message": "fail IT upon detection of ES 'Warning' header", "committedDate": "2020-08-08T16:50:44Z", "type": "forcePushed"}, {"oid": "d8bf129942419454316a05f920156727a321f0cb", "url": "https://github.com/openzipkin/zipkin/commit/d8bf129942419454316a05f920156727a321f0cb", "message": "add global and per-method deprecation check", "committedDate": "2020-10-04T11:24:32Z", "type": "forcePushed"}, {"oid": "17b7a6ef11d9fec1dbda9e05670d936409356dc2", "url": "https://github.com/openzipkin/zipkin/commit/17b7a6ef11d9fec1dbda9e05670d936409356dc2", "message": "add global and per-method deprecation check", "committedDate": "2020-10-04T11:29:47Z", "type": "commit"}, {"oid": "17b7a6ef11d9fec1dbda9e05670d936409356dc2", "url": "https://github.com/openzipkin/zipkin/commit/17b7a6ef11d9fec1dbda9e05670d936409356dc2", "message": "add global and per-method deprecation check", "committedDate": "2020-10-04T11:29:47Z", "type": "forcePushed"}, {"oid": "cae88e49cd4a63c33f03bab468030f36361d84b0", "url": "https://github.com/openzipkin/zipkin/commit/cae88e49cd4a63c33f03bab468030f36361d84b0", "message": "lowercase 'warning' as header  names in Armeria are always lowercase.", "committedDate": "2020-10-04T12:02:24Z", "type": "commit"}, {"oid": "9eabd8dba5ceba4f2da981d2ef2ab3a66a740dad", "url": "https://github.com/openzipkin/zipkin/commit/9eabd8dba5ceba4f2da981d2ef2ab3a66a740dad", "message": "cluster warnings should not fail tests, because they rely on the configuration of our docker images which is not representative for a site instance. Nevertheless log a big WARN message so it's visible.", "committedDate": "2020-10-04T14:59:50Z", "type": "commit"}, {"oid": "48679213fb3f1e4d6f11f9308a750efc4394b026", "url": "https://github.com/openzipkin/zipkin/commit/48679213fb3f1e4d6f11f9308a750efc4394b026", "message": "- more warning fixes\n- exclude colon warning for ES 6", "committedDate": "2020-10-11T17:56:24Z", "type": "commit"}, {"oid": "72bda5515d29446503cc6a369333f044ebda354a", "url": "https://github.com/openzipkin/zipkin/commit/72bda5515d29446503cc6a369333f044ebda354a", "message": "factor out deprecation warnings that should be ignored", "committedDate": "2020-10-12T19:04:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4MTI5NA==", "url": "https://github.com/openzipkin/zipkin/pull/3171#discussion_r503481294", "bodyText": "because triggers a deprecation warning on ES6", "author": "jorgheymans", "createdAt": "2020-10-12T19:05:36Z", "path": "zipkin-storage/elasticsearch/src/main/java/zipkin2/elasticsearch/VersionSpecificTemplates.java", "diffHunk": "@@ -63,9 +63,7 @@ String indexProperties(float version) {\n       + \"    \\\"index.number_of_shards\\\": \" + indexShards + \",\\n\"\n       + \"    \\\"index.number_of_replicas\\\": \" + indexReplicas + \",\\n\"\n       + \"    \\\"index.requests.cache.enable\\\": true\";\n-    // There is no explicit documentation of index.mapper.dynamic being removed in v7, but it was.", "originalCommit": "72bda5515d29446503cc6a369333f044ebda354a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "1cdcb81aa428e42d13e697ed8a39f32913ab321d", "url": "https://github.com/openzipkin/zipkin/commit/1cdcb81aa428e42d13e697ed8a39f32913ab321d", "message": "license", "committedDate": "2020-10-13T04:49:33Z", "type": "commit"}, {"oid": "fdfbca4b1dec47af3ccd1133cd7ad7add9d1c027", "url": "https://github.com/openzipkin/zipkin/commit/fdfbca4b1dec47af3ccd1133cd7ad7add9d1c027", "message": "license", "committedDate": "2020-10-13T08:55:25Z", "type": "commit"}, {"oid": "08ac52fe896828c78ba31d618a766732e9a2e54c", "url": "https://github.com/openzipkin/zipkin/commit/08ac52fe896828c78ba31d618a766732e9a2e54c", "message": "trigger travis", "committedDate": "2020-10-13T08:56:33Z", "type": "commit"}, {"oid": "4c223412d9c6dc9b14ceae9bb331f475ce08079a", "url": "https://github.com/openzipkin/zipkin/commit/4c223412d9c6dc9b14ceae9bb331f475ce08079a", "message": "Merge branch 'es-early-deprecation-warning' of https://github.com/openzipkin/zipkin into es-early-deprecation-warning", "committedDate": "2020-10-13T08:56:46Z", "type": "commit"}, {"oid": "0f54eed60dbccfb3f931ba0a0bdcba6d9f525292", "url": "https://github.com/openzipkin/zipkin/commit/0f54eed60dbccfb3f931ba0a0bdcba6d9f525292", "message": "trigger travis", "committedDate": "2020-10-13T14:59:53Z", "type": "commit"}, {"oid": "fe1a9dd63204548d2909ad48c5ab28af664ce8c1", "url": "https://github.com/openzipkin/zipkin/commit/fe1a9dd63204548d2909ad48c5ab28af664ce8c1", "message": "import, and we get to kick travis again.", "committedDate": "2020-10-13T15:48:22Z", "type": "commit"}]}