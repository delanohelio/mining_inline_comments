{"pr_number": 3019, "pr_title": "Fixes incorrect handling of getTrace and IT access modifiers", "pr_createdAt": "2020-03-11T08:59:17Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3019", "timeline": [{"oid": "df8fbedf7b2e3f9a8ee00b86554e6ca50aac0ee1", "url": "https://github.com/openzipkin/zipkin/commit/df8fbedf7b2e3f9a8ee00b86554e6ca50aac0ee1", "message": "Fixes incorrect handling of getTrace and IT access modifiers\n\nI noticed porting zipkin-voltdb to latest, that we incorrectly handled\ngetTrace in some places. Basically, we treated a non-nullable result as\nnullable. This fixes that and also corrects method protection so that\nsubclasses of the IT can override (ex to ignore).", "committedDate": "2020-03-11T08:57:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNDg4OA==", "url": "https://github.com/openzipkin/zipkin/pull/3019#discussion_r390824888", "bodyText": "bug", "author": "codefromthecrypt", "createdAt": "2020-03-11T09:00:05Z", "path": "zipkin-server/src/main/java/zipkin2/server/internal/ZipkinQueryApiV2.java", "diffHunk": "@@ -153,7 +153,7 @@ public AggregatedHttpResponse getTraces(\n   public AggregatedHttpResponse getTrace(@Param(\"traceId\") String traceId) throws IOException {\n     traceId = Span.normalizeTraceId(traceId);\n     List<Span> trace = storage.traces().getTrace(traceId).execute();\n-    if (trace == null) {\n+    if (trace.isEmpty()) {", "originalCommit": "df8fbedf7b2e3f9a8ee00b86554e6ca50aac0ee1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNTEwNg==", "url": "https://github.com/openzipkin/zipkin/pull/3019#discussion_r390825106", "bodyText": "deprecated for a really long alternative!", "author": "codefromthecrypt", "createdAt": "2020-03-11T09:00:31Z", "path": "zipkin-tests/src/main/java/zipkin2/storage/ITDependencies.java", "diffHunk": "@@ -77,19 +77,19 @@ protected void processDependencies(List<Span> spans) throws Exception {\n    * Normally, the root-span is where trace id == span id and parent id == null. The default is to\n    * look back one day from today.\n    */\n-  @Test void getDependencies() throws Exception {\n+  @Test protected void getDependencies() throws Exception {\n     processDependencies(TRACE);\n \n     assertThat(store().getDependencies(TRACE_ENDTS, DAY).execute())\n-      .containsOnlyElementsOf(LINKS);\n+      .containsExactlyInAnyOrderElementsOf(LINKS);", "originalCommit": "df8fbedf7b2e3f9a8ee00b86554e6ca50aac0ee1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNTcxOA==", "url": "https://github.com/openzipkin/zipkin/pull/3019#discussion_r390825718", "bodyText": "bug", "author": "codefromthecrypt", "createdAt": "2020-03-11T09:01:35Z", "path": "zipkin/src/main/java/zipkin2/internal/TracesAdapter.java", "diffHunk": "@@ -67,7 +67,7 @@ public TracesAdapter(SpanStore spanStore) {\n     }\n \n     @Override protected void append(List<Span> input, List<List<Span>> output) {\n-      output.add(input);\n+      if (!input.isEmpty()) output.add(input);", "originalCommit": "df8fbedf7b2e3f9a8ee00b86554e6ca50aac0ee1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNTg4OQ==", "url": "https://github.com/openzipkin/zipkin/pull/3019#discussion_r390825889", "bodyText": "unnecessary intellij caught this and it was correct", "author": "codefromthecrypt", "createdAt": "2020-03-11T09:01:56Z", "path": "zipkin/src/main/java/zipkin2/storage/InMemoryStorage.java", "diffHunk": "@@ -369,7 +369,7 @@ private int deleteOldestTrace() {\n   @Override public synchronized Call<List<Span>> getTrace(String traceId) {\n     traceId = Span.normalizeTraceId(traceId);\n     List<Span> spans = spansByTraceId(lowTraceId(traceId));\n-    if (spans == null || spans.isEmpty()) return Call.emptyList();", "originalCommit": "df8fbedf7b2e3f9a8ee00b86554e6ca50aac0ee1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}