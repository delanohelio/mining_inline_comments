{"pr_number": 2656, "pr_title": "add `_int2` and `_int4` for PgServer", "pr_createdAt": "2020-05-25T16:05:55Z", "pr_url": "https://github.com/h2database/h2database/pull/2656", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAwNzUxMQ==", "url": "https://github.com/h2database/h2database/pull/2656#discussion_r430007511", "bodyText": "Where these strings came from? The real PostgreSQL returns smallint[], integer[], and character varying[] from its format_type() function.", "author": "katzyn", "createdAt": "2020-05-25T16:16:55Z", "path": "h2/src/main/org/h2/server/pg/PgServer.java", "diffHunk": "@@ -339,8 +340,12 @@ public static String formatType(int pgType) {\n         case PG_TYPE_FLOAT8:\n             valueType = Value.DOUBLE;\n             break;\n+        case PG_TYPE_INT2_ARRAY:\n+            return \"_int2\";\n+        case PG_TYPE_INT4_ARRAY:\n+            return \"_int4\";\n         case PG_TYPE_VARCHAR_ARRAY:\n-            return \"character varying[]\";\n+            return \"_varchar\";", "originalCommit": "856d4c62e60246d59d0c17b4305276915382ab3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAxMjcxMA==", "url": "https://github.com/h2database/h2database/pull/2656#discussion_r430012710", "bodyText": "I thought they came from pg_type.typname :-P", "author": "auntyellow", "createdAt": "2020-05-25T16:34:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAwNzUxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "adc8c69bc52d4283a7daae0a4bc41e81d298968d", "chunk": "diff --git a/h2/src/main/org/h2/server/pg/PgServer.java b/h2/src/main/org/h2/server/pg/PgServer.java\nindex 60e3880ac..9c3c30787 100644\n--- a/h2/src/main/org/h2/server/pg/PgServer.java\n+++ b/h2/src/main/org/h2/server/pg/PgServer.java\n\n@@ -341,11 +341,11 @@ public static String formatType(int pgType) {\n             valueType = Value.DOUBLE;\n             break;\n         case PG_TYPE_INT2_ARRAY:\n-            return \"_int2\";\n+            return \"smallint[]\";\n         case PG_TYPE_INT4_ARRAY:\n-            return \"_int4\";\n+            return \"integer[]\";\n         case PG_TYPE_VARCHAR_ARRAY:\n-            return \"_varchar\";\n+            return \"character varying[]\";\n         case PG_TYPE_BPCHAR:\n             valueType = Value.CHAR;\n             break;\n"}}, {"oid": "adc8c69bc52d4283a7daae0a4bc41e81d298968d", "url": "https://github.com/h2database/h2database/commit/adc8c69bc52d4283a7daae0a4bc41e81d298968d", "message": "add `_int2` and `_int4` for PgServer\n\nDBeaver can edit rows now :-)", "committedDate": "2020-05-25T16:30:45Z", "type": "commit"}, {"oid": "adc8c69bc52d4283a7daae0a4bc41e81d298968d", "url": "https://github.com/h2database/h2database/commit/adc8c69bc52d4283a7daae0a4bc41e81d298968d", "message": "add `_int2` and `_int4` for PgServer\n\nDBeaver can edit rows now :-)", "committedDate": "2020-05-25T16:30:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAxMzUyOA==", "url": "https://github.com/h2database/h2database/pull/2656#discussion_r430013528", "bodyText": "I think all array types should be grouped together. VARCHAR ARRAY can be defined there too and code in lines 556\u2013572 can skip Value.ARRAY to avoid duplicate definition.", "author": "katzyn", "createdAt": "2020-05-25T16:37:37Z", "path": "h2/src/main/org/h2/mode/PgCatalogTable.java", "diffHunk": "@@ -81,6 +81,16 @@\n \n     private static final int META_TABLE_TYPE_COUNT = PG_USER + 1;\n \n+    private static final Object[][] PG_EXTRA_TYPES = {\n+            { 18, \"char\", 1, 0 },\n+            { 19, \"name\", 64, 18 },\n+            { 22, \"int2vector\", -1, 21 },\n+            { 24, \"regproc\", 4, 0 },\n+            { PgServer.PG_TYPE_INT2_ARRAY, \"_int2\", -1, PgServer.PG_TYPE_INT2 },\n+            { PgServer.PG_TYPE_INT4_ARRAY, \"_int4\", -1, PgServer.PG_TYPE_INT4 },", "originalCommit": "adc8c69bc52d4283a7daae0a4bc41e81d298968d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1fd8b1d273c9a1993a68b8835ca236ba0fe78a4b", "chunk": "diff --git a/h2/src/main/org/h2/mode/PgCatalogTable.java b/h2/src/main/org/h2/mode/PgCatalogTable.java\nindex 2916080f0..184966bba 100644\n--- a/h2/src/main/org/h2/mode/PgCatalogTable.java\n+++ b/h2/src/main/org/h2/mode/PgCatalogTable.java\n\n@@ -88,6 +88,7 @@\n             { 24, \"regproc\", 4, 0 },\n             { PgServer.PG_TYPE_INT2_ARRAY, \"_int2\", -1, PgServer.PG_TYPE_INT2 },\n             { PgServer.PG_TYPE_INT4_ARRAY, \"_int4\", -1, PgServer.PG_TYPE_INT4 },\n+            { PgServer.PG_TYPE_VARCHAR_ARRAY, \"_varchar\", -1, PgServer.PG_TYPE_VARCHAR },\n             { 2205, \"regclass\", 4, 0 },\n     };\n \n"}}, {"oid": "1fd8b1d273c9a1993a68b8835ca236ba0fe78a4b", "url": "https://github.com/h2database/h2database/commit/1fd8b1d273c9a1993a68b8835ca236ba0fe78a4b", "message": "group array types together in `pg_type`", "committedDate": "2020-05-25T16:51:29Z", "type": "commit"}]}