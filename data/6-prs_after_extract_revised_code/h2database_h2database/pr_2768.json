{"pr_number": 2768, "pr_title": "Better separation of MVStore aimed at smaller h2-mvstore jar", "pr_createdAt": "2020-07-18T20:29:05Z", "pr_url": "https://github.com/h2database/h2database/pull/2768", "timeline": [{"oid": "8679942771da8b969818f6b9c903bd95e33bdedc", "url": "https://github.com/h2database/h2database/commit/8679942771da8b969818f6b9c903bd95e33bdedc", "message": "better separation of MVStore aimed at smaller h2-mvstore jar", "committedDate": "2020-07-18T19:39:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0NjIyMg==", "url": "https://github.com/h2database/h2database/pull/2768#discussion_r456846222", "bodyText": "This temporary change shouldn't be here.", "author": "katzyn", "createdAt": "2020-07-19T01:32:57Z", "path": "h2/src/test/org/h2/test/unit/TestFileSystem.java", "diffHunk": "@@ -53,7 +53,11 @@\n     public static void main(String... a) throws Exception {\n         TestBase test = TestBase.createCaller().init();\n         // test.config.traceTest = true;\n-        test.testFromMain();\n+        FilePathEncrypt.register();\n+        for (int i = 0; i < 100; i++) {\n+            ((TestFileSystem)test).testConcurrent(\"encrypt:0007:\" + test.getBaseDir() + \"/fs\");\n+            test.println(\"Done pass #\" + i);\n+        }", "originalCommit": "8679942771da8b969818f6b9c903bd95e33bdedc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1NTAyOQ==", "url": "https://github.com/h2database/h2database/pull/2768#discussion_r456855029", "bodyText": "Sorry, of course, it's unintended leftover", "author": "andreitokar", "createdAt": "2020-07-19T03:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0NjIyMg=="}], "type": "inlineReview", "revised_code": {"commit": "4760e17f1beaaf04362a7391c10da66cb96e230d", "chunk": "diff --git a/h2/src/test/org/h2/test/unit/TestFileSystem.java b/h2/src/test/org/h2/test/unit/TestFileSystem.java\nindex 5cf4d7b9e..8f04c899f 100644\n--- a/h2/src/test/org/h2/test/unit/TestFileSystem.java\n+++ b/h2/src/test/org/h2/test/unit/TestFileSystem.java\n\n@@ -53,11 +53,7 @@\n     public static void main(String... a) throws Exception {\n         TestBase test = TestBase.createCaller().init();\n         // test.config.traceTest = true;\n-        FilePathEncrypt.register();\n-        for (int i = 0; i < 100; i++) {\n-            ((TestFileSystem)test).testConcurrent(\"encrypt:0007:\" + test.getBaseDir() + \"/fs\");\n-            test.println(\"Done pass #\" + i);\n-        }\n+        test.testFromMain();\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0Njc5MA==", "url": "https://github.com/h2database/h2database/pull/2768#discussion_r456846790", "bodyText": "I guess this class is a part of public API of standalone MVStore? Maybe we can find a better name for it? DefaultSpatial, SimpleSpatial, something else?\nI think it would be nice to have this separate implementation, because users of standalone MVStore should not see methods of our internal Value class in SpatialKey.", "author": "katzyn", "createdAt": "2020-07-19T01:41:40Z", "path": "h2/src/main/org/h2/mvstore/rtree/BasicSpatialImpl.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.mvstore.rtree;\n+\n+import java.util.Arrays;\n+\n+/**\n+ * Class BasicSpatialImpl.\n+ *\n+ * @author <a href='mailto:andrei.tokar@gmail.com'>Andrei Tokar</a>\n+ */\n+public final class BasicSpatialImpl implements Spatial", "originalCommit": "8679942771da8b969818f6b9c903bd95e33bdedc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1NTQ5OQ==", "url": "https://github.com/h2database/h2database/pull/2768#discussion_r456855499", "bodyText": "It's not in public API, this class does not have to be public. Better name - sure.", "author": "andreitokar", "createdAt": "2020-07-19T03:56:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0Njc5MA=="}], "type": "inlineReview", "revised_code": {"commit": "4760e17f1beaaf04362a7391c10da66cb96e230d", "chunk": "diff --git a/h2/src/main/org/h2/mvstore/rtree/BasicSpatialImpl.java b/h2/src/main/org/h2/mvstore/rtree/DefaultSpatial.java\nsimilarity index 81%\nrename from h2/src/main/org/h2/mvstore/rtree/BasicSpatialImpl.java\nrename to h2/src/main/org/h2/mvstore/rtree/DefaultSpatial.java\nindex 3d57fa851..f03835d14 100644\n--- a/h2/src/main/org/h2/mvstore/rtree/BasicSpatialImpl.java\n+++ b/h2/src/main/org/h2/mvstore/rtree/DefaultSpatial.java\n\n@@ -12,7 +12,7 @@\n  *\n  * @author <a href='mailto:andrei.tokar@gmail.com'>Andrei Tokar</a>\n  */\n-public final class BasicSpatialImpl implements Spatial\n+final class DefaultSpatial implements Spatial\n {\n     private final long id;\n     private final float[] minMax;\n"}}, {"oid": "4760e17f1beaaf04362a7391c10da66cb96e230d", "url": "https://github.com/h2database/h2database/commit/4760e17f1beaaf04362a7391c10da66cb96e230d", "message": "Code review changes", "committedDate": "2020-07-19T03:55:29Z", "type": "commit"}]}