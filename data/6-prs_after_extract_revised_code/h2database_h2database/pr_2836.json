{"pr_number": 2836, "pr_title": "Assorted fixes", "pr_createdAt": "2020-08-19T13:57:30Z", "pr_url": "https://github.com/h2database/h2database/pull/2836", "timeline": [{"oid": "77a246a072209d0d372da8879d8ce59817e19043", "url": "https://github.com/h2database/h2database/commit/77a246a072209d0d372da8879d8ce59817e19043", "message": "Move character string to numeric conversion code to ValueStringBase", "committedDate": "2020-08-19T10:06:06Z", "type": "commit"}, {"oid": "f7146bf2fae849f61fa9c618495ae3572dae34b9", "url": "https://github.com/h2database/h2database/commit/f7146bf2fae849f61fa9c618495ae3572dae34b9", "message": "Optimize conversions to REAL and DOUBLE PRECISION", "committedDate": "2020-08-19T12:48:01Z", "type": "commit"}, {"oid": "61514ae8309115bf69a34d60b6be92fd443eaab2", "url": "https://github.com/h2database/h2database/commit/61514ae8309115bf69a34d60b6be92fd443eaab2", "message": "Restore YEAR data type for MySQL compatibility mode", "committedDate": "2020-08-19T13:23:33Z", "type": "commit"}, {"oid": "4b2441e0629b8fea2bafca453128b7f7194625b8", "url": "https://github.com/h2database/h2database/commit/4b2441e0629b8fea2bafca453128b7f7194625b8", "message": "Throw better exception for MERGE INTO without updatable columns", "committedDate": "2020-08-19T13:42:04Z", "type": "commit"}, {"oid": "49e3559ad79204b321f726db13a925d541e49985", "url": "https://github.com/h2database/h2database/commit/49e3559ad79204b321f726db13a925d541e49985", "message": "Fix NPE in MathFunction.optimize()", "committedDate": "2020-08-19T13:53:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTYzNQ==", "url": "https://github.com/h2database/h2database/pull/2836#discussion_r473051635", "bodyText": "with -> without", "author": "grandinj", "createdAt": "2020-08-19T13:59:54Z", "path": "h2/src/main/org/h2/command/dml/Merge.java", "diffHunk": "@@ -323,6 +323,10 @@ public void prepare() {\n                 column.getSQL(builder, HasSQL.DEFAULT_SQL_FLAGS).append(\"=?\");\n             }\n         }\n+        if (!hasColumn) {\n+            throw DbException.getSyntaxError(sqlStatement, sqlStatement.length(),\n+                    \"Valid MERGE INTO statement with at least one updatable column\");", "originalCommit": "4b2441e0629b8fea2bafca453128b7f7194625b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1NDc2Nw==", "url": "https://github.com/h2database/h2database/pull/2836#discussion_r473054767", "bodyText": "It is what we expect and not what we found.", "author": "katzyn", "createdAt": "2020-08-19T14:04:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTYzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1OTg5OQ==", "url": "https://github.com/h2database/h2database/pull/2836#discussion_r473059899", "bodyText": "Yes, we expect to \"have at least one updateable column\", but we did not find that.\nSo we should say\n\"Valid MERGE INTO statement requires at least one updatable column\"\nor\n\"MERGE INTO statement without at least one updatable column\"", "author": "grandinj", "createdAt": "2020-08-19T14:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTYzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA2MjgxNA==", "url": "https://github.com/h2database/h2database/pull/2836#discussion_r473062814", "bodyText": "The whole error message is:\nSyntax error in SQL statement \"MERGE INTO T0(C0) KEY(C1) VALUES (1)[*]\"; expected \"Valid MERGE INTO statement with at least one updatable column\"", "author": "katzyn", "createdAt": "2020-08-19T14:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTYzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA2NDUxMQ==", "url": "https://github.com/h2database/h2database/pull/2836#discussion_r473064511", "bodyText": "Ah, you are correct", "author": "grandinj", "createdAt": "2020-08-19T14:17:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTYzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA2NTUwNA==", "url": "https://github.com/h2database/h2database/pull/2836#discussion_r473065504", "bodyText": "It don't want to allocate a new error code for the normal error message for this specific corner case in non-standard command. This command has significant design problems, it can't handle GENERATED ALWAYS identity columns and generated columns well.", "author": "katzyn", "createdAt": "2020-08-19T14:19:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTYzNQ=="}], "type": "inlineReview", "revised_code": null}]}