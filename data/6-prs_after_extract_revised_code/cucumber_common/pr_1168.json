{"pr_number": 1168, "pr_title": "Remove credentials in meta message", "pr_createdAt": "2020-09-02T11:53:20Z", "pr_url": "https://github.com/cucumber/common/pull/1168", "timeline": [{"oid": "2804c003e66b1cfc21a6419bc5e28547021895a3", "url": "https://github.com/cucumber/common/commit/2804c003e66b1cfc21a6419bc5e28547021895a3", "message": "Add example showing sensitive data in the URL", "committedDate": "2020-09-02T09:33:24Z", "type": "commit"}, {"oid": "7d6519b70f4deec543e26b2d55226d4b155a780e", "url": "https://github.com/cucumber/common/commit/7d6519b70f4deec543e26b2d55226d4b155a780e", "message": "Added method to clean up sensitive data, limited to URLs for now", "committedDate": "2020-09-02T09:50:07Z", "type": "commit"}, {"oid": "e83de51b17e2860d5ebe2d86033141b8ae07af3e", "url": "https://github.com/cucumber/common/commit/e83de51b17e2860d5ebe2d86033141b8ae07af3e", "message": "Remove potential sensitive information in Meta.CI.Git.remote message", "committedDate": "2020-09-02T09:54:48Z", "type": "commit"}, {"oid": "5f1f6c385e24773649513d90bca837466be7065f", "url": "https://github.com/cucumber/common/commit/5f1f6c385e24773649513d90bca837466be7065f", "message": "Rename clean_sensitive_info_spec.rb as clean_sensitive_information_spec.rb", "committedDate": "2020-09-02T12:26:54Z", "type": "commit"}, {"oid": "7cd59f9e565a4a6303bed22c03ef382449cef592", "url": "https://github.com/cucumber/common/commit/7cd59f9e565a4a6303bed22c03ef382449cef592", "message": "port changes to Java", "committedDate": "2020-09-02T12:27:38Z", "type": "commit"}, {"oid": "80b3726c58cf45f8d3fe0d6f3d980255389ea02b", "url": "https://github.com/cucumber/common/commit/80b3726c58cf45f8d3fe0d6f3d980255389ea02b", "message": "Merge branch 'master' into remove-credentials-in-meta", "committedDate": "2020-09-02T12:27:55Z", "type": "commit"}, {"oid": "699499d51eec4c61248073b1c4127421cc1c8c35", "url": "https://github.com/cucumber/common/commit/699499d51eec4c61248073b1c4127421cc1c8c35", "message": "Port changes to Javascript\nUpdate CHANGELOG and add a `Security fixes` section in the CHANGELOG", "committedDate": "2020-09-02T13:00:06Z", "type": "commit"}, {"oid": "c70f212bafa291cffe4797ebeb778dfe818d9e79", "url": "https://github.com/cucumber/common/commit/c70f212bafa291cffe4797ebeb778dfe818d9e79", "message": "Merge branch 'master' into remove-credentials-in-meta", "committedDate": "2020-09-02T13:02:44Z", "type": "commit"}, {"oid": "446e5f28075d111ad62a2595162c2fd2083864ea", "url": "https://github.com/cucumber/common/commit/446e5f28075d111ad62a2595162c2fd2083864ea", "message": "Fix typo in const name", "committedDate": "2020-09-02T13:10:26Z", "type": "commit"}, {"oid": "804dc67481d2519b25ee21cb5a436f0b0d446580", "url": "https://github.com/cucumber/common/commit/804dc67481d2519b25ee21cb5a436f0b0d446580", "message": "Merge branch 'master' into remove-credentials-in-meta", "committedDate": "2020-09-02T14:24:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1MzcxNw==", "url": "https://github.com/cucumber/common/pull/1168#discussion_r482153717", "bodyText": "The only field that can contain credentials is the git remote, which is a URL. I think it would be safer to parse the value into a URL object, remove the credentials using the URL API and then write it out again.", "author": "aslakhellesoy", "createdAt": "2020-09-02T15:16:27Z", "path": "create-meta/java/src/main/java/io/cucumber/createmeta/CreateMeta.java", "diffHunk": "@@ -57,6 +57,17 @@\n                 .build();\n     }\n \n+    public static String cleanSensitiveInformation(String value) {", "originalCommit": "804dc67481d2519b25ee21cb5a436f0b0d446580", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE2MjU0NQ==", "url": "https://github.com/cucumber/common/pull/1168#discussion_r482162545", "bodyText": "I've done this now", "author": "aslakhellesoy", "createdAt": "2020-09-02T15:28:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1MzcxNw=="}], "type": "inlineReview", "revised_code": {"commit": "c5a8af9008292d652d0fd1fb9489f0e6d44107db", "chunk": "diff --git a/create-meta/java/src/main/java/io/cucumber/createmeta/CreateMeta.java b/create-meta/java/src/main/java/io/cucumber/createmeta/CreateMeta.java\nindex fcc08cb05..ddda69f89 100644\n--- a/create-meta/java/src/main/java/io/cucumber/createmeta/CreateMeta.java\n+++ b/create-meta/java/src/main/java/io/cucumber/createmeta/CreateMeta.java\n\n@@ -58,15 +60,13 @@ public class CreateMeta {\n     }\n \n     public static String cleanSensitiveInformation(String value) {\n-        Pattern passwordUrlPattern = Pattern.compile(\"^(.*?)://(.*?@)?(.*)$\");\n-        Matcher passwordUrlMatcher = passwordUrlPattern.matcher(value);\n-\n-        if (passwordUrlMatcher.find()) {\n-          return passwordUrlMatcher.group(1) + \"://\" + passwordUrlMatcher.group(3);\n+        try {\n+            URI uri = URI.create(value);\n+            return new URI(uri.getScheme(), null, uri.getHost(), uri.getPort(), uri.getPath(), uri.getQuery(), uri.getFragment()).toASCIIString();\n+        } catch (URISyntaxException | IllegalArgumentException e) {\n+            return value;\n         }\n-\n-        return value;\n-      }\n+    }\n \n     static Messages.Meta.CI detectCI(Map<String, String> env) {\n         List<Messages.Meta.CI> detected = new ArrayList<>();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1NTYyOA==", "url": "https://github.com/cucumber/common/pull/1168#discussion_r482155628", "bodyText": "With JUnit 5 test classes can be package private. This is nice because code completion won't suggest them outside of their package.", "author": "mpkorstanje", "createdAt": "2020-09-02T15:19:01Z", "path": "create-meta/java/src/test/java/io/cucumber/createmeta/CleanSensitiveInformationTest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package io.cucumber.createmeta;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.HashMap;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.matchesPattern;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class CleanSensitiveInformationTest {", "originalCommit": "804dc67481d2519b25ee21cb5a436f0b0d446580", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b083b589a162481187a495f642151906f78eeefe", "chunk": "diff --git a/create-meta/java/src/test/java/io/cucumber/createmeta/CleanSensitiveInformationTest.java b/create-meta/java/src/test/java/io/cucumber/createmeta/CleanSensitiveInformationTest.java\nindex d9c7fc2f3..2de6d8e1f 100644\n--- a/create-meta/java/src/test/java/io/cucumber/createmeta/CleanSensitiveInformationTest.java\n+++ b/create-meta/java/src/test/java/io/cucumber/createmeta/CleanSensitiveInformationTest.java\n\n@@ -10,7 +10,7 @@ import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.matchesPattern;\n import static org.junit.jupiter.api.Assertions.assertEquals;\n \n-public class CleanSensitiveInformationTest {\n+class CleanSensitiveInformationTest {\n   @Test\n   void leaves_the_data_intact_when_no_sensitive_information_is_detected() {\n     assertEquals(\"pretty safe\", CreateMeta.cleanSensitiveInformation(\"pretty safe\"));\n"}}, {"oid": "c5a8af9008292d652d0fd1fb9489f0e6d44107db", "url": "https://github.com/cucumber/common/commit/c5a8af9008292d652d0fd1fb9489f0e6d44107db", "message": "Remove credentials using URI instead of regexp", "committedDate": "2020-09-02T15:27:34Z", "type": "commit"}, {"oid": "b083b589a162481187a495f642151906f78eeefe", "url": "https://github.com/cucumber/common/commit/b083b589a162481187a495f642151906f78eeefe", "message": "Package private test", "committedDate": "2020-09-02T15:28:45Z", "type": "commit"}, {"oid": "bb00aaec5a728776d83494cc17f9452956b0d340", "url": "https://github.com/cucumber/common/commit/bb00aaec5a728776d83494cc17f9452956b0d340", "message": "Use url parser. Handle null and undefined.", "committedDate": "2020-09-02T15:40:55Z", "type": "commit"}, {"oid": "26045fad529c184f049c14ee4e0ec80babd10ec2", "url": "https://github.com/cucumber/common/commit/26045fad529c184f049c14ee4e0ec80babd10ec2", "message": "Handle null", "committedDate": "2020-09-02T15:43:12Z", "type": "commit"}, {"oid": "ed70fbbdebe958843dbbdb45a40ec2d83e894972", "url": "https://github.com/cucumber/common/commit/ed70fbbdebe958843dbbdb45a40ec2d83e894972", "message": "Use URI. Handle nil and undefined.", "committedDate": "2020-09-02T15:53:14Z", "type": "commit"}, {"oid": "bb63729af219c3b7cbfe51f011c46bfb49cc3d1b", "url": "https://github.com/cucumber/common/commit/bb63729af219c3b7cbfe51f011c46bfb49cc3d1b", "message": "Rename method to better describe what it does", "committedDate": "2020-09-02T15:57:58Z", "type": "commit"}, {"oid": "fa4b11544d9a203f3c338de3e9810a0979e63c06", "url": "https://github.com/cucumber/common/commit/fa4b11544d9a203f3c338de3e9810a0979e63c06", "message": "Add another test", "committedDate": "2020-09-02T16:06:58Z", "type": "commit"}, {"oid": "35eaab0da5be19e4812817d15f53ae539cb6c760", "url": "https://github.com/cucumber/common/commit/35eaab0da5be19e4812817d15f53ae539cb6c760", "message": "Merge branch 'master' into remove-credentials-in-meta", "committedDate": "2020-09-03T07:37:27Z", "type": "commit"}]}