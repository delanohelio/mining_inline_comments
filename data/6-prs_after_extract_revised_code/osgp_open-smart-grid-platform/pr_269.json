{"pr_number": 269, "pr_title": "DevicetodeviceMapper will now check for existing Manufacturer & Model\u2026", "pr_createdAt": "2020-04-06T09:16:51Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/269", "timeline": [{"oid": "be0cd83fd5168445afc6efff412fe597421e81b2", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/be0cd83fd5168445afc6efff412fe597421e81b2", "message": "DevicetodeviceMapper will now check for existing Manufacturer & ModelCode combination, also changed deviceinstallation.xsd to force ModelCode and delete Metered and Descirption attributes", "committedDate": "2020-04-06T08:29:01Z", "type": "commit"}, {"oid": "bdd468466b75bbc216409ccd19d1d0283d775581", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/bdd468466b75bbc216409ccd19d1d0283d775581", "message": "FLEX-3161: Remoded setMetered and setDescription from cucumber CreateDeviceSteps", "committedDate": "2020-04-06T09:52:59Z", "type": "commit"}, {"oid": "0541402432f7620d06a714043cb7dfc025b71b47", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0541402432f7620d06a714043cb7dfc025b71b47", "message": "/FLEX-3161: adapted existing AddDevice features not to use Metered and Description attributes", "committedDate": "2020-04-06T12:06:54Z", "type": "commit"}, {"oid": "27de12a6f540fda2d37afd9bb22b00287c9dafad", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/27de12a6f540fda2d37afd9bb22b00287c9dafad", "message": "FLEX-3161: Adapted cucumber scenario in AddDevice.feature to include Manufacturer code", "committedDate": "2020-04-07T07:59:43Z", "type": "commit"}, {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a7ce3cfa557856de3a043a5d14ee844a633ea945", "message": "FLEX-3161 Added cucumbertest to test this functionality", "committedDate": "2020-04-09T11:58:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwNTY1OA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406305658", "bodyText": "Remove this line.", "author": "rlemmers", "createdAt": "2020-04-09T15:54:02Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java", "diffHunk": "@@ -62,6 +62,28 @@ public void receivingAnAddDeviceRequestWithAnUnknownOrganization(final Map<Strin\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n+    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n+    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n+            final Map<String, String> settings) {\n+\n+        System.out.println(\"HELP\");", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMTc2NQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408011765", "bodyText": "hmm.. forgot to commit change it seems.. it should be gone now.", "author": "vsombroek", "createdAt": "2020-04-14T09:53:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwNTY1OA=="}], "type": "inlineReview", "revised_code": {"commit": "d26dae6f089d61876879ab42fa390b9abd33b617", "chunk": "diff --git a/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java b/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java\nindex 137bbfefe5..264a767ff0 100644\n--- a/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java\n+++ b/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java\n\n@@ -62,28 +63,6 @@ public class CreateDeviceSteps {\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n-    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n-    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n-            final Map<String, String> settings) {\n-\n-        System.out.println(\"HELP\");\n-        final AddDeviceRequest request = new AddDeviceRequest();\n-        final Device device = this.createDevice(settings);\n-\n-        final DeviceModel deviceModel = new DeviceModel();\n-        deviceModel.setManufacturer(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MANUFACTURER,\n-                PlatformCommonDefaults.DEFAULT_DEVICE_MODEL_MANUFACTURER));\n-        deviceModel.setModelCode(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MODELCODE, \"nonexistingmodel\"));\n-        device.setDeviceModel(deviceModel);\n-        request.setDevice(device);\n-\n-        try {\n-            ScenarioContext.current().put(PlatformKeys.RESPONSE, this.client.addDevice(request));\n-        } catch (final Exception ex) {\n-            ScenarioContext.current().put(PlatformKeys.RESPONSE, ex);\n-        }\n-    }\n-\n     /**\n      * Verify the response of a add device request.\n      *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTE3MQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406629171", "bodyText": "To get rid of code duplication, add the device model fields (manufacturer and model code) to the map and then call the existing method receivingAnAddDeviceRequest(..).", "author": "rlemmers", "createdAt": "2020-04-10T06:54:23Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java", "diffHunk": "@@ -62,6 +62,28 @@ public void receivingAnAddDeviceRequestWithAnUnknownOrganization(final Map<Strin\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n+    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n+    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n+            final Map<String, String> settings) {\n+\n+        System.out.println(\"HELP\");\n+        final AddDeviceRequest request = new AddDeviceRequest();\n+        final Device device = this.createDevice(settings);\n+\n+        final DeviceModel deviceModel = new DeviceModel();\n+        deviceModel.setManufacturer(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MANUFACTURER,\n+                PlatformCommonDefaults.DEFAULT_DEVICE_MODEL_MANUFACTURER));\n+        deviceModel.setModelCode(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MODELCODE, \"nonexistingmodel\"));\n+        device.setDeviceModel(deviceModel);\n+        request.setDevice(device);\n+\n+        try {\n+            ScenarioContext.current().put(PlatformKeys.RESPONSE, this.client.addDevice(request));\n+        } catch (final Exception ex) {\n+            ScenarioContext.current().put(PlatformKeys.RESPONSE, ex);\n+        }\n+    }\n+", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMjQ3Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408012477", "bodyText": "Done.. got rid of this new/custom createDeviceStep completely", "author": "vsombroek", "createdAt": "2020-04-14T09:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTE3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "d26dae6f089d61876879ab42fa390b9abd33b617", "chunk": "diff --git a/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java b/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java\nindex 137bbfefe5..264a767ff0 100644\n--- a/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java\n+++ b/integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java\n\n@@ -62,28 +63,6 @@ public class CreateDeviceSteps {\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n-    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n-    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n-            final Map<String, String> settings) {\n-\n-        System.out.println(\"HELP\");\n-        final AddDeviceRequest request = new AddDeviceRequest();\n-        final Device device = this.createDevice(settings);\n-\n-        final DeviceModel deviceModel = new DeviceModel();\n-        deviceModel.setManufacturer(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MANUFACTURER,\n-                PlatformCommonDefaults.DEFAULT_DEVICE_MODEL_MANUFACTURER));\n-        deviceModel.setModelCode(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MODELCODE, \"nonexistingmodel\"));\n-        device.setDeviceModel(deviceModel);\n-        request.setDevice(device);\n-\n-        try {\n-            ScenarioContext.current().put(PlatformKeys.RESPONSE, this.client.addDevice(request));\n-        } catch (final Exception ex) {\n-            ScenarioContext.current().put(PlatformKeys.RESPONSE, ex);\n-        }\n-    }\n-\n     /**\n      * Verify the response of a add device request.\n      *\n"}}, {"oid": "d26dae6f089d61876879ab42fa390b9abd33b617", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d26dae6f089d61876879ab42fa390b9abd33b617", "message": "changes that arised from the review comments are now implemented\n\nhttps://github.com/OSGP/open-smart-grid-platform/pull/269", "committedDate": "2020-04-14T10:00:00Z", "type": "commit"}]}