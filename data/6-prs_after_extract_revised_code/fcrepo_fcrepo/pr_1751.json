{"pr_number": 1751, "pr_title": "Allow any authenticated user to POST to /fcr:tx", "pr_createdAt": "2020-09-10T18:01:14Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1751", "timeline": [{"oid": "df9aa2038582d63c7651dd1f5b9a2c85d4e890f7", "url": "https://github.com/fcrepo/fcrepo/commit/df9aa2038582d63c7651dd1f5b9a2c85d4e890f7", "message": "Allow any authenticated user to POST to /fcr:tx\n\nFixes: https://jira.lyrasis.org/browse/FCREPO-3321", "committedDate": "2020-09-10T17:57:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY0NjU0NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1751#discussion_r486646544", "bodyText": "This is already defined in TransactionConstants... although FedoraTypes seems like a logical home. Would you be interested in refactoring these into a single constant?", "author": "awoods", "createdAt": "2020-09-10T21:34:23Z", "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/FedoraTypes.java", "diffHunk": "@@ -99,6 +99,8 @@\n \n     String FCR_TOMBSTONE = \"fcr:tombstone\";\n \n+    String FCR_TX = \"fcr:tx\";", "originalCommit": "df9aa2038582d63c7651dd1f5b9a2c85d4e890f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MTgxMw==", "url": "https://github.com/fcrepo/fcrepo/pull/1751#discussion_r487041813", "bodyText": "@awoods I've modified TX_PREFIX to be defined in terms of the FCR_TX constant.", "author": "peichman-umd", "createdAt": "2020-09-11T13:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY0NjU0NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY1MTk3Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1751#discussion_r486651976", "bodyText": "Could you add the \"currentUser\"s ID to the debug message?", "author": "awoods", "createdAt": "2020-09-10T21:46:50Z", "path": "fcrepo-auth-webac/src/main/java/org/fcrepo/auth/webac/WebACFilter.java", "diffHunk": "@@ -365,6 +367,10 @@ private boolean isAuthorized(final Subject currentUser, final HttpServletRequest\n                 }\n             }\n         case \"POST\":\n+            if (isTxEndpoint && currentUser.isAuthenticated()) {\n+                log.debug(\"POST allowed to transaction endpoint\");", "originalCommit": "df9aa2038582d63c7651dd1f5b9a2c85d4e890f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MjE0MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1751#discussion_r487042140", "bodyText": "Done.", "author": "peichman-umd", "createdAt": "2020-09-11T13:24:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY1MTk3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "57af412301529a6897adcc8bf5cf489ce5fdf415", "chunk": "diff --git a/fcrepo-auth-webac/src/main/java/org/fcrepo/auth/webac/WebACFilter.java b/fcrepo-auth-webac/src/main/java/org/fcrepo/auth/webac/WebACFilter.java\nindex 5526e27643..eb6c7892ca 100644\n--- a/fcrepo-auth-webac/src/main/java/org/fcrepo/auth/webac/WebACFilter.java\n+++ b/fcrepo-auth-webac/src/main/java/org/fcrepo/auth/webac/WebACFilter.java\n\n@@ -368,7 +368,8 @@ public class WebACFilter extends RequestContextFilter {\n             }\n         case \"POST\":\n             if (isTxEndpoint && currentUser.isAuthenticated()) {\n-                log.debug(\"POST allowed to transaction endpoint\");\n+                final String currentUsername = ((Principal) currentUser.getPrincipal()).getName();\n+                log.debug(\"POST allowed to transaction endpoint for authenticated user {}\", currentUsername);\n                 return true;\n             }\n             if (currentUser.isPermitted(toWrite)) {\n"}}, {"oid": "57af412301529a6897adcc8bf5cf489ce5fdf415", "url": "https://github.com/fcrepo/fcrepo/commit/57af412301529a6897adcc8bf5cf489ce5fdf415", "message": "Code review comments.", "committedDate": "2020-09-11T13:22:13Z", "type": "commit"}]}