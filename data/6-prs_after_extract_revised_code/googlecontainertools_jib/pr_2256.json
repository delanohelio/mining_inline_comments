{"pr_number": 2256, "pr_title": "Fix integration test", "pr_createdAt": "2020-01-28T20:20:43Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2256", "timeline": [{"oid": "1cee81c8afa496fddcc7a4902e793eb6c83158da", "url": "https://github.com/GoogleContainerTools/jib/commit/1cee81c8afa496fddcc7a4902e793eb6c83158da", "message": "Fix integration test", "committedDate": "2020-01-28T20:19:58Z", "type": "commit"}, {"oid": "4aae59be2ef55c9a96d0a7992ff8eef673633196", "url": "https://github.com/GoogleContainerTools/jib/commit/4aae59be2ef55c9a96d0a7992ff8eef673633196", "message": "Fix test", "committedDate": "2020-01-28T20:49:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372049083", "bodyText": "I'm not sure I understand the change here", "author": "loosebazooka", "createdAt": "2020-01-28T20:52:18Z", "path": "jib-maven-plugin/src/integration-test/java/com/google/cloud/tools/jib/maven/BuildImageMojoIntegrationTest.java", "diffHunk": "@@ -694,7 +694,10 @@ public void testExecute_springBootPackaged()\n                 \"-c\",\n                 \"/app/classpath/spring-boot-0.1.0.original.jar\")\n             .run();\n-    Assert.assertEquals(\"2749 /app/classpath/spring-boot-0.1.0.original.jar\\n\", sizeOutput);\n+    Assert.assertThat(\n+        sizeOutput, CoreMatchers.containsString(\" /app/classpath/spring-boot-0.1.0.original.jar\"));\n+    int fileSize = Integer.parseInt(sizeOutput.substring(0, sizeOutput.indexOf(' ')));\n+    Assert.assertTrue(fileSize < 3000);", "originalCommit": "4aae59be2ef55c9a96d0a7992ff8eef673633196", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA1MDU0MA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372050540", "bodyText": "was the generated file a different size?", "author": "loosebazooka", "createdAt": "2020-01-28T20:55:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA1MTcyMQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372051721", "bodyText": "Yeah, somehow the size was 2748 instead of 2749 when running locally. The point of the test is to see that the JAR is not fat, so it is sufficient to see it is small.", "author": "chanseokoh", "createdAt": "2020-01-28T20:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA1NDA4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372054086", "bodyText": "I see, okay. Can we add a bug to make this test more robust? This seems fine for the purposes of fixing integ-tests for now (temporary)", "author": "loosebazooka", "createdAt": "2020-01-28T21:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA1NTQwMg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372055402", "bodyText": "I actually think this is a final form to be robust. Thinking how a jar is created by Maven, now I recall that it is almost impossible to reproducibly create the exact same jar. (MANIFEST.MF will have build information for example.)", "author": "chanseokoh", "createdAt": "2020-01-28T21:06:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA1NjU2Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372056566", "bodyText": "What if future springboot examples exceed the size? I guess we don't update our springboot examples all that often. test can be update then.", "author": "loosebazooka", "createdAt": "2020-01-28T21:08:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA2MTE2Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2256#discussion_r372061162", "bodyText": "Yeah, we pin down the Spring Boot version, so I don't think the size will ever noticeably increase.", "author": "chanseokoh", "createdAt": "2020-01-28T21:15:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0OTA4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "eb02b7810c0b75dcd434b0bf481cda9110d51bbb", "chunk": "diff --git a/jib-maven-plugin/src/integration-test/java/com/google/cloud/tools/jib/maven/BuildImageMojoIntegrationTest.java b/jib-maven-plugin/src/integration-test/java/com/google/cloud/tools/jib/maven/BuildImageMojoIntegrationTest.java\nindex 721d893e..d520b763 100644\n--- a/jib-maven-plugin/src/integration-test/java/com/google/cloud/tools/jib/maven/BuildImageMojoIntegrationTest.java\n+++ b/jib-maven-plugin/src/integration-test/java/com/google/cloud/tools/jib/maven/BuildImageMojoIntegrationTest.java\n\n@@ -697,7 +697,7 @@ public class BuildImageMojoIntegrationTest {\n     Assert.assertThat(\n         sizeOutput, CoreMatchers.containsString(\" /app/classpath/spring-boot-0.1.0.original.jar\"));\n     int fileSize = Integer.parseInt(sizeOutput.substring(0, sizeOutput.indexOf(' ')));\n-    Assert.assertTrue(fileSize < 3000);\n+    Assert.assertTrue(fileSize < 3000); // should not be a large fat jar\n \n     HttpGetVerifier.verifyBody(\"Hello world\", new URL(\"http://localhost:8080\"));\n   }\n"}}, {"oid": "eb02b7810c0b75dcd434b0bf481cda9110d51bbb", "url": "https://github.com/GoogleContainerTools/jib/commit/eb02b7810c0b75dcd434b0bf481cda9110d51bbb", "message": "Add comment", "committedDate": "2020-01-28T20:58:37Z", "type": "commit"}]}