{"pr_number": 2242, "pr_title": "Add user agent to update check", "pr_createdAt": "2020-01-23T21:03:51Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2242", "timeline": [{"oid": "c44e8cb3132eb86fb26c73186b5c9ab6ad58e35e", "url": "https://github.com/GoogleContainerTools/jib/commit/c44e8cb3132eb86fb26c73186b5c9ab6ad58e35e", "message": "Add user agent to update check", "committedDate": "2020-01-23T21:00:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM3MjkwMw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2242#discussion_r370372903", "bodyText": "I actually don't like our current string format (#1067), but I guess we'll just go with this for consistency.", "author": "chanseokoh", "createdAt": "2020-01-23T21:48:40Z", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java", "diffHunk": "@@ -139,11 +150,17 @@ void setDisableUpdateCheck(boolean disableUpdateCheck) {\n       }\n \n       // Check for update\n-      HttpURLConnection connection = (HttpURLConnection) new URL(versionUrl).openConnection();\n+      FailoverHttpClient httpClient = new FailoverHttpClient(true, false, log);\n+      Response response =\n+          httpClient.get(\n+              new URL(versionUrl),\n+              Request.builder()\n+                  .setHttpTimeout(3000)\n+                  .setUserAgent(\"jib \" + ProjectInfo.VERSION + \" \" + toolName)", "originalCommit": "c44e8cb3132eb86fb26c73186b5c9ab6ad58e35e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58792f77c56610c1109fd7f4883dba6558ba676a", "chunk": "diff --git a/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java b/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java\nindex 3c1f363e..2d2963ef 100644\n--- a/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java\n+++ b/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java\n\n@@ -151,14 +151,14 @@ public class UpdateChecker {\n \n       // Check for update\n       FailoverHttpClient httpClient = new FailoverHttpClient(true, false, log);\n-      Response response =\n-          httpClient.get(\n-              new URL(versionUrl),\n-              Request.builder()\n-                  .setHttpTimeout(3000)\n-                  .setUserAgent(\"jib \" + ProjectInfo.VERSION + \" \" + toolName)\n-                  .build());\n       try {\n+        Response response =\n+            httpClient.get(\n+                new URL(versionUrl),\n+                Request.builder()\n+                    .setHttpTimeout(3000)\n+                    .setUserAgent(\"jib \" + currentVersion + \" \" + toolName)\n+                    .build());\n         VersionJsonTemplate version =\n             JsonTemplateMapper.readJson(response.getBody(), VersionJsonTemplate.class);\n         Files.write(lastUpdateCheck, Instant.now().toString().getBytes(StandardCharsets.UTF_8));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM3MzMxNQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2242#discussion_r370373315", "bodyText": "You can put this line into try, can't you? Otherwise, if httpClient.get() throws an exception, httpClient.shutDown() is not called.", "author": "chanseokoh", "createdAt": "2020-01-23T21:49:42Z", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java", "diffHunk": "@@ -139,11 +150,17 @@ void setDisableUpdateCheck(boolean disableUpdateCheck) {\n       }\n \n       // Check for update\n-      HttpURLConnection connection = (HttpURLConnection) new URL(versionUrl).openConnection();\n+      FailoverHttpClient httpClient = new FailoverHttpClient(true, false, log);\n+      Response response =\n+          httpClient.get(", "originalCommit": "c44e8cb3132eb86fb26c73186b5c9ab6ad58e35e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58792f77c56610c1109fd7f4883dba6558ba676a", "chunk": "diff --git a/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java b/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java\nindex 3c1f363e..2d2963ef 100644\n--- a/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java\n+++ b/jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java\n\n@@ -151,14 +151,14 @@ public class UpdateChecker {\n \n       // Check for update\n       FailoverHttpClient httpClient = new FailoverHttpClient(true, false, log);\n-      Response response =\n-          httpClient.get(\n-              new URL(versionUrl),\n-              Request.builder()\n-                  .setHttpTimeout(3000)\n-                  .setUserAgent(\"jib \" + ProjectInfo.VERSION + \" \" + toolName)\n-                  .build());\n       try {\n+        Response response =\n+            httpClient.get(\n+                new URL(versionUrl),\n+                Request.builder()\n+                    .setHttpTimeout(3000)\n+                    .setUserAgent(\"jib \" + currentVersion + \" \" + toolName)\n+                    .build());\n         VersionJsonTemplate version =\n             JsonTemplateMapper.readJson(response.getBody(), VersionJsonTemplate.class);\n         Files.write(lastUpdateCheck, Instant.now().toString().getBytes(StandardCharsets.UTF_8));\n"}}, {"oid": "58792f77c56610c1109fd7f4883dba6558ba676a", "url": "https://github.com/GoogleContainerTools/jib/commit/58792f77c56610c1109fd7f4883dba6558ba676a", "message": "Feedback", "committedDate": "2020-01-23T22:03:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4NzU5OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2242#discussion_r370387599", "bodyText": "Actually, maybe it's better to ignore logs?\nnew FailoverHttpClient(true, false, ignored -> {})", "author": "chanseokoh", "createdAt": "2020-01-23T22:25:08Z", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/UpdateChecker.java", "diffHunk": "@@ -139,11 +150,17 @@ void setDisableUpdateCheck(boolean disableUpdateCheck) {\n       }\n \n       // Check for update\n-      HttpURLConnection connection = (HttpURLConnection) new URL(versionUrl).openConnection();\n+      FailoverHttpClient httpClient = new FailoverHttpClient(true, false, log);", "originalCommit": "58792f77c56610c1109fd7f4883dba6558ba676a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4Nzg4NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2242#discussion_r370387885", "bodyText": "True, I'll submit another PR.", "author": "TadCordle", "createdAt": "2020-01-23T22:25:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4NzU5OQ=="}], "type": "inlineReview", "revised_code": null}]}