{"pr_number": 2639, "pr_title": "(Merging to PR #2634) update code styles in PR #2634", "pr_createdAt": "2020-07-28T22:06:55Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2639", "timeline": [{"oid": "568db71c1c26780a96f6bffbf92d9f005f407534", "url": "https://github.com/GoogleContainerTools/jib/commit/568db71c1c26780a96f6bffbf92d9f005f407534", "message": "Update code", "committedDate": "2020-07-28T22:01:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkyMTA3MA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2639#discussion_r461921070", "bodyText": "This is some clever implementation right here", "author": "louismurerwa", "createdAt": "2020-07-28T22:12:21Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/PullBaseImageStep.java", "diffHunk": "@@ -187,35 +189,33 @@ public ImagesAndRegistryClient call()\n    * @throws BadContainerConfigurationFormatException if the container configuration is in a bad\n    *     format\n    */\n-  private ImagesAndRegistryClient pullBaseImages(\n+  private List<Image> pullBaseImages(\n       RegistryClient registryClient, ProgressEventDispatcher progressEventDispatcher)\n       throws IOException, RegistryException, LayerPropertyNotFoundException,\n           LayerCountMismatchException, BadContainerConfigurationFormatException {\n-    List<Image> images = new ArrayList<>();\n-\n     ManifestAndDigest<?> manifestAndDigest =\n         registryClient.pullManifest(buildContext.getBaseImageConfiguration().getImageQualifier());\n     ManifestTemplate manifestTemplate = manifestAndDigest.getManifest();\n \n-    // special handling if we happen upon a manifest list, extract manifests handle them normally\n+    // If a manifest list, search for the manifests matching the given platforms.\n     if (manifestTemplate instanceof V22ManifestListTemplate) {\n-      Set<Platform> platforms = buildContext.getContainerConfiguration().getPlatforms();\n-      for (Platform platform : platforms) {\n+      List<Image> images = new ArrayList<>();\n+\n+      for (Platform platform : buildContext.getContainerConfiguration().getPlatforms()) {\n         manifestAndDigest =\n             obtainPlatformSpecificImageManifest(\n                 registryClient, (V22ManifestListTemplate) manifestTemplate, platform);\n         images.add(jsonManifestToImage(manifestAndDigest, registryClient, progressEventDispatcher));\n       }\n-\n-    } else {\n-      images.add(jsonManifestToImage(manifestAndDigest, registryClient, progressEventDispatcher));\n+      return images;\n     }\n \n-    return new ImagesAndRegistryClient(images, registryClient);\n+    return Collections.singletonList(\n+        jsonManifestToImage(manifestAndDigest, registryClient, progressEventDispatcher));", "originalCommit": "568db71c1c26780a96f6bffbf92d9f005f407534", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}