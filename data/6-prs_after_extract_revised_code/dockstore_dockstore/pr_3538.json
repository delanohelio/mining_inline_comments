{"pr_number": 3538, "pr_title": "Feature/remove refreshorg", "pr_createdAt": "2020-06-08T22:59:44Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3538", "timeline": [{"oid": "0c0823a048023d1808823af4f9e7941e5eb36d15", "url": "https://github.com/dockstore/dockstore/commit/0c0823a048023d1808823af4f9e7941e5eb36d15", "message": "Update to narrow down broken tests", "committedDate": "2020-06-08T20:02:32Z", "type": "commit"}, {"oid": "30c232d8b5b71d076f010478e4a97e01935a89c5", "url": "https://github.com/dockstore/dockstore/commit/30c232d8b5b71d076f010478e4a97e01935a89c5", "message": "Test fixes", "committedDate": "2020-06-08T22:58:42Z", "type": "commit"}, {"oid": "cac6749aae7e0eff79a888b4dd01084d539b6685", "url": "https://github.com/dockstore/dockstore/commit/cac6749aae7e0eff79a888b4dd01084d539b6685", "message": "Merge branch 'develop' into feature/remove_refreshorg", "committedDate": "2020-06-09T14:02:43Z", "type": "commit"}, {"oid": "ae6f859712fbf5cf1f2cf869237573a052f71f35", "url": "https://github.com/dockstore/dockstore/commit/ae6f859712fbf5cf1f2cf869237573a052f71f35", "message": "More fixes and remove obsolete test", "committedDate": "2020-06-09T15:40:45Z", "type": "commit"}, {"oid": "d4125521812571a178ffa066085aa695f5f5fc88", "url": "https://github.com/dockstore/dockstore/commit/d4125521812571a178ffa066085aa695f5f5fc88", "message": "Merge branch 'feature/remove_refreshorg' of github.com:dockstore/dockstore into feature/remove_refreshorg", "committedDate": "2020-06-09T15:44:48Z", "type": "commit"}, {"oid": "c56597bf20d020f0200b2c34fdcf78f9ebc3594a", "url": "https://github.com/dockstore/dockstore/commit/c56597bf20d020f0200b2c34fdcf78f9ebc3594a", "message": "Merge branch 'develop' into feature/remove_refreshorg", "committedDate": "2020-06-09T19:41:17Z", "type": "commit"}, {"oid": "1c97f531d41e931430ad3aadf16b2dd7a888880f", "url": "https://github.com/dockstore/dockstore/commit/1c97f531d41e931430ad3aadf16b2dd7a888880f", "message": "More test fix", "committedDate": "2020-06-09T20:02:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE4ODQ3NA==", "url": "https://github.com/dockstore/dockstore/pull/3538#discussion_r438188474", "bodyText": "handling getLowerShortName() is a nice to have, but the test needs to ensure that the base case works (getShortName())", "author": "garyluu", "createdAt": "2020-06-10T14:55:58Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java", "diffHunk": "@@ -182,12 +182,12 @@ public void testRefresh() {\n     @Test\n     public void testRefreshWorkflow() {\n         ApiClient client = getWebClient(USER_1_USERNAME, testingPostgres);\n-        UsersApi usersApi = new UsersApi(client);\n         WorkflowsApi workflowsApi = new WorkflowsApi(client);\n \n-        // Refresh all\n-        usersApi.refreshWorkflowsByOrganization((long)1, \"DockstoreTestUser\");\n-        usersApi.refreshWorkflowsByOrganization((long)1, \"dockstore_testuser2\");\n+        workflowsApi.manualRegister(SourceControl.GITHUB.name(), \"DockstoreTestUser/dockstore-whalesay-wdl\", \"/dockstore.wdl\", \"\", DescriptorLanguage.WDL.getLowerShortName(), \"\");", "originalCommit": "1c97f531d41e931430ad3aadf16b2dd7a888880f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI0MDEwMA==", "url": "https://github.com/dockstore/dockstore/pull/3538#discussion_r438240100", "bodyText": "Added additional test for manual register", "author": "denis-yuen", "createdAt": "2020-06-10T16:06:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE4ODQ3NA=="}], "type": "inlineReview", "revised_code": {"commit": "8c95e99275976ff6a58780f47f033bf8688c70ad", "chunk": "diff --git a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java\nindex 7426e7713..21568d16a 100644\n--- a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java\n+++ b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java\n\n@@ -176,6 +177,24 @@ public class BasicIT extends BaseIT {\n         }\n     }\n \n+    /**\n+     * Tests that registration works with non-short names\n+     */\n+    @Test\n+    public void testRegistrationWithNonLowerCase() {\n+        ApiClient client = getWebClient(USER_1_USERNAME, testingPostgres);\n+        WorkflowsApi workflowsApi = new WorkflowsApi(client);\n+\n+        workflowsApi.manualRegister(SourceControl.GITHUB.name(), \"DockstoreTestUser/dockstore-whalesay-wdl\", \"/dockstore.wdl\", \"\", DescriptorLanguage.WDL.getShortName(), \"\");\n+\n+        // refresh a specific workflow\n+        Workflow workflow = workflowsApi\n+                .getWorkflowByPath(SourceControl.GITHUB.toString() + \"/DockstoreTestUser/dockstore-whalesay-wdl\", \"\", false);\n+        workflow = workflowsApi.refresh(workflow.getId());\n+        assertFalse(workflow.getWorkflowVersions().isEmpty());\n+    }\n+\n+\n     /**\n      * Tests that refresh workflows works, also that refreshing without a github token should not destroy workflows or their existing versions\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE4OTU1Ng==", "url": "https://github.com/dockstore/dockstore/pull/3538#discussion_r438189556", "bodyText": "\"cwl\" should be DescriptorLanguage.CWL.getShortName()", "author": "garyluu", "createdAt": "2020-06-10T14:57:26Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java", "diffHunk": "@@ -1144,7 +1146,10 @@ public void testRefreshingUserMetadata() {\n         // Refresh all workflows\n         ApiClient client = getWebClient(USER_2_USERNAME, testingPostgres);\n         UsersApi usersApi = new UsersApi(client);\n-        usersApi.refreshWorkflowsByOrganization((long)1, \"dockstore_testuser2\");\n+\n+        WorkflowsApi workflowsApi = new WorkflowsApi(client);\n+        Workflow workflow = manualRegisterAndPublish(workflowsApi, \"DockstoreTestUser2/parameter_test_workflow\", \"testname\", \"cwl\",", "originalCommit": "1c97f531d41e931430ad3aadf16b2dd7a888880f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c95e99275976ff6a58780f47f033bf8688c70ad", "chunk": "diff --git a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\nindex 13011445a..b35e35859 100644\n--- a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n+++ b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n\n@@ -1148,7 +1148,7 @@ public class GeneralWorkflowIT extends BaseIT {\n         UsersApi usersApi = new UsersApi(client);\n \n         WorkflowsApi workflowsApi = new WorkflowsApi(client);\n-        Workflow workflow = manualRegisterAndPublish(workflowsApi, \"DockstoreTestUser2/parameter_test_workflow\", \"testname\", \"cwl\",\n+        Workflow workflow = manualRegisterAndPublish(workflowsApi, \"DockstoreTestUser2/parameter_test_workflow\", \"testname\", DescriptorLanguage.CWL.getShortName(),\n                 SourceControl.GITHUB, \"/Dockstore.cwl\", false);\n \n         // Check that user has been updated\n"}}, {"oid": "03164cfaabdd12cb861dfbe4bf55185c3becece8", "url": "https://github.com/dockstore/dockstore/commit/03164cfaabdd12cb861dfbe4bf55185c3becece8", "message": "Merge branch 'develop' into feature/remove_refreshorg", "committedDate": "2020-06-10T15:10:56Z", "type": "commit"}, {"oid": "8c95e99275976ff6a58780f47f033bf8688c70ad", "url": "https://github.com/dockstore/dockstore/commit/8c95e99275976ff6a58780f47f033bf8688c70ad", "message": "Add test for manual register in non-lower case\n\n* also use constant", "committedDate": "2020-06-10T18:27:04Z", "type": "commit"}, {"oid": "c528e092db75ed0986d26fa14308b0accff1d1e2", "url": "https://github.com/dockstore/dockstore/commit/c528e092db75ed0986d26fa14308b0accff1d1e2", "message": "Merge branch 'develop' into feature/remove_refreshorg", "committedDate": "2020-06-11T18:51:04Z", "type": "commit"}]}