{"pr_number": 3921, "pr_title": "deleting snapshotted version", "pr_createdAt": "2020-11-09T19:33:55Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3921", "timeline": [{"oid": "56d5512ef9d51ae0857b573e998e7f719f365f00", "url": "https://github.com/dockstore/dockstore/commit/56d5512ef9d51ae0857b573e998e7f719f365f00", "message": "deleting snapshotted version", "committedDate": "2020-11-09T19:32:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDEyNjQyOA==", "url": "https://github.com/dockstore/dockstore/pull/3921#discussion_r520126428", "bodyText": "If the version isn't present, it will silently fail as well. Fail less severely than the bug you're fixing, but I think you should throw a 404 in that case.", "author": "coverbeck", "createdAt": "2020-11-09T21:18:56Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -394,6 +394,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Parameter(hidden = true,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+\n+        Optional<U> deleteVersion =  entry.getWorkflowVersions().stream().filter(v -> Objects.equals(v.getName(), version)).findFirst();\n+        if (deleteVersion.isPresent() && deleteVersion.get().isFrozen()) {", "originalCommit": "56d5512ef9d51ae0857b573e998e7f719f365f00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgxNTMzNA==", "url": "https://github.com/dockstore/dockstore/pull/3921#discussion_r524815334", "bodyText": "Oops, forgot about this. Changed", "author": "NatalieEO", "createdAt": "2020-11-17T00:57:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDEyNjQyOA=="}], "type": "inlineReview", "revised_code": {"commit": "7a1f86616c4b82b0e3b51ba9fd1f4024e97d1e6d", "chunk": "diff --git a/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java b/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java\nindex 5ef99a9fd..20e8315f4 100644\n--- a/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java\n+++ b/dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java\n\n@@ -396,7 +396,11 @@ public abstract class AbstractHostedEntryResource<T extends Entry<T, U>, U exten\n         checkHosted(entry);\n \n         Optional<U> deleteVersion =  entry.getWorkflowVersions().stream().filter(v -> Objects.equals(v.getName(), version)).findFirst();\n-        if (deleteVersion.isPresent() && deleteVersion.get().isFrozen()) {\n+        if (deleteVersion.isEmpty()) {\n+            throw new CustomWebApplicationException(\"Cannot find version: \" + version + \" to delete\", HttpStatus.SC_NOT_FOUND);\n+        }\n+\n+        if (deleteVersion.get().isFrozen()) {\n             throw new CustomWebApplicationException(\"Cannot delete a snapshotted version.\", HttpStatus.SC_BAD_REQUEST);\n         }\n \n"}}, {"oid": "7a1f86616c4b82b0e3b51ba9fd1f4024e97d1e6d", "url": "https://github.com/dockstore/dockstore/commit/7a1f86616c4b82b0e3b51ba9fd1f4024e97d1e6d", "message": "throw error if version not found", "committedDate": "2020-11-17T00:57:28Z", "type": "commit"}, {"oid": "e29acb298f413a8f151690d1b10e2629c3f5f9b7", "url": "https://github.com/dockstore/dockstore/commit/e29acb298f413a8f151690d1b10e2629c3f5f9b7", "message": "Merge branch 'develop' into 3915/deletingFrozenHostedVersion", "committedDate": "2020-11-17T00:57:55Z", "type": "commit"}, {"oid": "18dca653105bd4b1abbf73e3c0bc975f356399f2", "url": "https://github.com/dockstore/dockstore/commit/18dca653105bd4b1abbf73e3c0bc975f356399f2", "message": "fix test, never deleted the version before.", "committedDate": "2020-11-19T01:58:11Z", "type": "commit"}, {"oid": "902e2470e2620a9a8bb9a2f571365bb06bc424c5", "url": "https://github.com/dockstore/dockstore/commit/902e2470e2620a9a8bb9a2f571365bb06bc424c5", "message": "add test that deleting frozen version fails", "committedDate": "2020-11-19T17:43:22Z", "type": "commit"}, {"oid": "81f2739b678e9f375217a1da117af7ccf96521f3", "url": "https://github.com/dockstore/dockstore/commit/81f2739b678e9f375217a1da117af7ccf96521f3", "message": "Merge branch 'develop' into 3915/deletingFrozenHostedVersion", "committedDate": "2020-11-19T23:53:57Z", "type": "commit"}]}