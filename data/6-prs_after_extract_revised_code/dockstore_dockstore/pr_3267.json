{"pr_number": 3267, "pr_title": "Add classes for dockstore.yml", "pr_createdAt": "2020-02-26T00:13:50Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3267", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzMTAxMw==", "url": "https://github.com/dockstore/dockstore/pull/3267#discussion_r384531013", "bodyText": "Should we just user uppercase then?", "author": "agduncan94", "createdAt": "2020-02-26T14:36:08Z", "path": "dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ *    Copyright 2020 OICR\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *    you may not use this file except in compliance with the License.\n+ *    You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    Unless required by applicable law or agreed to in writing, software\n+ *    distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *    See the License for the specific language governing permissions and\n+ *    limitations under the License.\n+ */\n+package io.dockstore.common.yaml;\n+\n+import javax.validation.constraints.NotNull;\n+import javax.validation.constraints.Pattern;\n+\n+import io.dockstore.common.DescriptorLanguageSubclass;\n+\n+/**\n+ * A service defined in a 1.2 .dockstore.yml. It differs from 1.1 in that there is a subclass instead of a type property.\n+ * And the subclass property is an enum, not a string.\n+ *\n+ * Couldn't get SnakeYaml to directly load the YAML into the JavaBean with an enum, because our values are lower-case\n+ * and the enums are upper-case. See https://stackoverflow.com/questions/25079332/parse-enum-by-value-using-snakeyaml.", "originalCommit": "efb3d8553066a51cd2e2146a77a3607a5b1fb97e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc0NjMyOA==", "url": "https://github.com/dockstore/dockstore/pull/3267#discussion_r384746328", "bodyText": "\ud83d\udc4d That would make it easier.", "author": "coverbeck", "createdAt": "2020-02-26T20:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzMTAxMw=="}], "type": "inlineReview", "revised_code": {"commit": "1751db5a1e5c479322cc9f4910579086ff3b7627", "chunk": "diff --git a/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java b/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java\nindex f52ceb509..beb63cd54 100644\n--- a/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java\n+++ b/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java\n\n@@ -16,7 +16,6 @@\n package io.dockstore.common.yaml;\n \n import javax.validation.constraints.NotNull;\n-import javax.validation.constraints.Pattern;\n \n import io.dockstore.common.DescriptorLanguageSubclass;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3MDQyNQ==", "url": "https://github.com/dockstore/dockstore/pull/3267#discussion_r384570425", "bodyText": "This model is one of our creation, so could use javadoc particularly with the less intuitive fields like environment, data, port", "author": "denis-yuen", "createdAt": "2020-02-26T15:32:42Z", "path": "dockstore-common/src/main/java/io/dockstore/common/yaml/AbstractYamlService.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ *    Copyright 2020 OICR\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *    you may not use this file except in compliance with the License.\n+ *    You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    Unless required by applicable law or agreed to in writing, software\n+ *    distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *    See the License for the specific language governing permissions and\n+ *    limitations under the License.\n+ */\n+package io.dockstore.common.yaml;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+import javax.validation.constraints.NotNull;\n+\n+/**\n+ * Abstract base class for services defined in .dockstore.yml\n+ */\n+public abstract class AbstractYamlService {\n+    private String name;\n+    private String author;\n+    private String description;\n+    private List<String> files;\n+    private Scripts scripts;\n+    private Map<String, EnvironmentVariable> environment;\n+    private Map<String, DataSet> data;\n+\n+    public String getAuthor() {\n+        return author;\n+    }\n+\n+    public void setAuthor(String author) {\n+        this.author = author;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public String getDescription() {\n+        return description;\n+    }\n+\n+    public void setDescription(String description) {\n+        this.description = description;\n+    }\n+\n+    public List<String> getFiles() {\n+        return files;\n+    }\n+\n+    public void setFiles(List<String> files) {\n+        this.files = files;\n+    }\n+\n+    public Scripts getScripts() {\n+        return scripts;\n+    }\n+\n+    public void setScripts(Scripts scripts) {\n+        this.scripts = scripts;\n+    }\n+\n+    public Map<String, EnvironmentVariable> getEnvironment() {", "originalCommit": "efb3d8553066a51cd2e2146a77a3607a5b1fb97e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1751db5a1e5c479322cc9f4910579086ff3b7627", "chunk": "diff --git a/dockstore-common/src/main/java/io/dockstore/common/yaml/AbstractYamlService.java b/dockstore-common/src/main/java/io/dockstore/common/yaml/AbstractYamlService.java\nindex ea7b41303..8c94d3aba 100644\n--- a/dockstore-common/src/main/java/io/dockstore/common/yaml/AbstractYamlService.java\n+++ b/dockstore-common/src/main/java/io/dockstore/common/yaml/AbstractYamlService.java\n\n@@ -36,7 +36,7 @@ public abstract class AbstractYamlService {\n         return author;\n     }\n \n-    public void setAuthor(String author) {\n+    public void setAuthor(final String author) {\n         this.author = author;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3MTEyNA==", "url": "https://github.com/dockstore/dockstore/pull/3267#discussion_r384571124", "bodyText": "Can probably simplify with !isEmpty", "author": "denis-yuen", "createdAt": "2020-02-26T15:33:39Z", "path": "dockstore-common/src/main/java/io/dockstore/common/yaml/Dockstore12Validator.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ *    Copyright 2020 OICR\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *    you may not use this file except in compliance with the License.\n+ *    You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    Unless required by applicable law or agreed to in writing, software\n+ *    distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *    See the License for the specific language governing permissions and\n+ *    limitations under the License.\n+ */\n+package io.dockstore.common.yaml;\n+\n+import javax.validation.ConstraintValidator;\n+import javax.validation.ConstraintValidatorContext;\n+\n+/**\n+ * Validates that a DockstoreYaml12 instance has at least one workflow or at least one service\n+ */\n+public class Dockstore12Validator implements ConstraintValidator<ValidDockstore12, DockstoreYaml12> {\n+    @Override\n+    public void initialize(ValidDockstore12 constraintAnnotation) {\n+    }\n+\n+    @Override\n+    public boolean isValid(DockstoreYaml12 value, ConstraintValidatorContext context) {\n+        return value.getServices().size() > 0 || value.getWorkflows().size() > 0;", "originalCommit": "efb3d8553066a51cd2e2146a77a3607a5b1fb97e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1751db5a1e5c479322cc9f4910579086ff3b7627", "chunk": "diff --git a/dockstore-common/src/main/java/io/dockstore/common/yaml/Dockstore12Validator.java b/dockstore-common/src/main/java/io/dockstore/common/yaml/Dockstore12Validator.java\nindex 736c223b4..90eb8ebcc 100644\n--- a/dockstore-common/src/main/java/io/dockstore/common/yaml/Dockstore12Validator.java\n+++ b/dockstore-common/src/main/java/io/dockstore/common/yaml/Dockstore12Validator.java\n\n@@ -23,11 +23,12 @@ import javax.validation.ConstraintValidatorContext;\n  */\n public class Dockstore12Validator implements ConstraintValidator<ValidDockstore12, DockstoreYaml12> {\n     @Override\n-    public void initialize(ValidDockstore12 constraintAnnotation) {\n+    public void initialize(final ValidDockstore12 constraintAnnotation) {\n+        // Intentionally empty\n     }\n \n     @Override\n-    public boolean isValid(DockstoreYaml12 value, ConstraintValidatorContext context) {\n-        return value.getServices().size() > 0 || value.getWorkflows().size() > 0;\n+    public boolean isValid(final DockstoreYaml12 value, final ConstraintValidatorContext context) {\n+        return !value.getServices().isEmpty() || !value.getWorkflows().isEmpty();\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3MzEyMQ==", "url": "https://github.com/dockstore/dockstore/pull/3267#discussion_r384573121", "bodyText": "This isn't being highlighted as an annotation in the GitHub web ui, watch out in case there is a formatting thing going on", "author": "denis-yuen", "createdAt": "2020-02-26T15:36:38Z", "path": "dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ *    Copyright 2020 OICR\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *    you may not use this file except in compliance with the License.\n+ *    You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    Unless required by applicable law or agreed to in writing, software\n+ *    distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *    See the License for the specific language governing permissions and\n+ *    limitations under the License.\n+ */\n+package io.dockstore.common.yaml;\n+\n+import javax.validation.constraints.NotNull;\n+import javax.validation.constraints.Pattern;\n+\n+import io.dockstore.common.DescriptorLanguageSubclass;\n+\n+/**\n+ * A service defined in a 1.2 .dockstore.yml. It differs from 1.1 in that there is a subclass instead of a type property.\n+ * And the subclass property is an enum, not a string.\n+ *\n+ * Couldn't get SnakeYaml to directly load the YAML into the JavaBean with an enum, because our values are lower-case\n+ * and the enums are upper-case. See https://stackoverflow.com/questions/25079332/parse-enum-by-value-using-snakeyaml.\n+ */\n+public class Service12 extends AbstractYamlService {\n+\n+    public  static final String SUBCLASS_ERROR = \"subclass value must be \\\"docker-compose\\\", \\\"helm\\\", \\\"swarm\\\", \\\"kubernetes\\\", or \\\"n/a\\\"\";\n+    private String subclass;\n+    private DescriptorLanguageSubclass descriptorLanguageSubclass;\n+\n+\n+    @NotNull(message = \"Missing property \\\"subclass\\\"\")", "originalCommit": "efb3d8553066a51cd2e2146a77a3607a5b1fb97e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5MzQ2OQ==", "url": "https://github.com/dockstore/dockstore/pull/3267#discussion_r384793469", "bodyText": "Hmm, not sure why it's doing that. Added a test to explicitly catch that this message is returned.", "author": "coverbeck", "createdAt": "2020-02-26T22:00:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3MzEyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "1751db5a1e5c479322cc9f4910579086ff3b7627", "chunk": "diff --git a/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java b/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java\nindex f52ceb509..beb63cd54 100644\n--- a/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java\n+++ b/dockstore-common/src/main/java/io/dockstore/common/yaml/Service12.java\n\n@@ -16,7 +16,6 @@\n package io.dockstore.common.yaml;\n \n import javax.validation.constraints.NotNull;\n-import javax.validation.constraints.Pattern;\n \n import io.dockstore.common.DescriptorLanguageSubclass;\n \n"}}, {"oid": "8f14609605b273a6dfc2ca7e869572f38b35f0c2", "url": "https://github.com/dockstore/dockstore/commit/8f14609605b273a6dfc2ca7e869572f38b35f0c2", "message": "Add classes for dockstore.yml\n\n#3241\n\nProbably could come up with a better pattern\nin DockstoreYamlHelper, but this works.", "committedDate": "2020-02-27T17:29:28Z", "type": "commit"}, {"oid": "1751db5a1e5c479322cc9f4910579086ff3b7627", "url": "https://github.com/dockstore/dockstore/commit/1751db5a1e5c479322cc9f4910579086ff3b7627", "message": "PR and Codacy feedback.", "committedDate": "2020-02-27T17:29:29Z", "type": "commit"}, {"oid": "73180024854f8b33f7171cf77278edd5d8289ac0", "url": "https://github.com/dockstore/dockstore/commit/73180024854f8b33f7171cf77278edd5d8289ac0", "message": "More JavaDoc (PR feedback)", "committedDate": "2020-02-27T17:29:29Z", "type": "commit"}, {"oid": "0e0250cb6fefa457320b8d04b010a1afe9d7b91a", "url": "https://github.com/dockstore/dockstore/commit/0e0250cb6fefa457320b8d04b010a1afe9d7b91a", "message": "One more test", "committedDate": "2020-02-27T17:29:31Z", "type": "commit"}, {"oid": "0e0250cb6fefa457320b8d04b010a1afe9d7b91a", "url": "https://github.com/dockstore/dockstore/commit/0e0250cb6fefa457320b8d04b010a1afe9d7b91a", "message": "One more test", "committedDate": "2020-02-27T17:29:31Z", "type": "forcePushed"}]}