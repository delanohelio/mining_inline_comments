{"pr_number": 3839, "pr_title": "Feature/3739/allow adding link to forum", "pr_createdAt": "2020-09-30T20:03:48Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3839", "timeline": [{"oid": "8a929d76386c2b879f8f09c97fb638ee06a31297", "url": "https://github.com/dockstore/dockstore/commit/8a929d76386c2b879f8f09c97fb638ee06a31297", "message": "Added forumUrl column to workflow", "committedDate": "2020-09-25T21:18:33Z", "type": "commit"}, {"oid": "894db98a4a660bb31734dbedf58bbfdbf19919d6", "url": "https://github.com/dockstore/dockstore/commit/894db98a4a660bb31734dbedf58bbfdbf19919d6", "message": "added forumUrl default value, corrected JSON property name", "committedDate": "2020-09-30T15:00:03Z", "type": "commit"}, {"oid": "5e484ec1c02893829ba04814b776cfd815906589", "url": "https://github.com/dockstore/dockstore/commit/5e484ec1c02893829ba04814b776cfd815906589", "message": "removed default forumUrl, updateWorkflow includes updating forumUrl", "committedDate": "2020-09-30T18:11:52Z", "type": "commit"}, {"oid": "b6e7897cfe6945389267652dce7ee290ca5bc91f", "url": "https://github.com/dockstore/dockstore/commit/b6e7897cfe6945389267652dce7ee290ca5bc91f", "message": "wrote test for updating forumUrl", "committedDate": "2020-09-30T19:37:53Z", "type": "commit"}, {"oid": "4b6527e8f0518a6dab35cacfcc7b0238ec691526", "url": "https://github.com/dockstore/dockstore/commit/4b6527e8f0518a6dab35cacfcc7b0238ec691526", "message": "checkstyle errors", "committedDate": "2020-09-30T19:56:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg1ODM3OA==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r497858378", "bodyText": "Closing brace on its own line is the normal pattern.", "author": "coverbeck", "createdAt": "2020-09-30T23:37:44Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java", "diffHunk": "@@ -249,6 +254,13 @@ public void setDefaultWorkflowPath(String defaultWorkflowPath) {\n         getDefaultPaths().put(this.getDescriptorType().getFileType(), defaultWorkflowPath);\n     }\n \n+    @JsonProperty\n+    public String getForumUrl() {\n+        return forumUrl;\n+    }\n+    public void setForumUrl(String forumUrl) {\n+        this.forumUrl = forumUrl; }", "originalCommit": "4b6527e8f0518a6dab35cacfcc7b0238ec691526", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYyNjYxMw==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r505626613", "bodyText": "ugh, gotta fix checkstyle", "author": "garyluu", "createdAt": "2020-10-15T15:15:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg1ODM3OA=="}], "type": "inlineReview", "revised_code": {"commit": "587cdcd0adec3ca537f2dcb090e45eb8ae0127dd", "chunk": "diff --git a/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java b/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java\nindex a5b579a30..18609fe6e 100644\n--- a/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java\n+++ b/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java\n\n@@ -259,7 +261,8 @@ public abstract class Workflow extends Entry<Workflow, WorkflowVersion> {\n         return forumUrl;\n     }\n     public void setForumUrl(String forumUrl) {\n-        this.forumUrl = forumUrl; }\n+        this.forumUrl = forumUrl;\n+    }\n \n     @JsonProperty\n     public String getOrganization() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg1OTQ5MA==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r497859490", "bodyText": "We don't always do this, but I think we should -- can you add @size(max = 256) so that this field is in sync with the database column max in the migrations file? But first see my comment about 256 there.", "author": "coverbeck", "createdAt": "2020-09-30T23:41:38Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java", "diffHunk": "@@ -113,6 +113,10 @@\n     @Convert(converter = SourceControlConverter.class)\n     private SourceControl sourceControl;\n \n+    @Column", "originalCommit": "4b6527e8f0518a6dab35cacfcc7b0238ec691526", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "587cdcd0adec3ca537f2dcb090e45eb8ae0127dd", "chunk": "diff --git a/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java b/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java\nindex a5b579a30..18609fe6e 100644\n--- a/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java\n+++ b/dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java\n\n@@ -114,6 +115,7 @@ public abstract class Workflow extends Entry<Workflow, WorkflowVersion> {\n     private SourceControl sourceControl;\n \n     @Column\n+    @Size(max = 256)\n     @ApiModelProperty(value = \"This is a link to a forum or discussion board\")\n     private String forumUrl;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2MDUxMA==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r497860510", "bodyText": "Do you need this? Shouldn't the forumUrl already be in the DB after line 522? Or are you trying to verify that it sticks after refresh?", "author": "coverbeck", "createdAt": "2020-09-30T23:45:19Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java", "diffHunk": "@@ -503,6 +504,30 @@ public void testUpdateWorkflowPath() throws ApiException {\n         assertEquals(\"test workflow path should be the same as default workflow path, it is \" + testpath, \"/Dockstore.cwl\", testpath);\n     }\n \n+    @Test\n+    public void testAddingWorkflowForumUrl() throws ApiException {\n+        // Set up webservice\n+        ApiClient webClient = WorkflowIT.getWebClient(USER_2_USERNAME, testingPostgres);\n+        WorkflowsApi workflowsApi = new WorkflowsApi(webClient);\n+\n+        UsersApi usersApi = new UsersApi(webClient);\n+        usersApi.getUser();\n+\n+        Workflow workflow = workflowsApi\n+                .manualRegister(\"github\", \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\", \"test-update-workflow\", \"cwl\",\n+                        \"/test.json\");\n+\n+        //update the forumUrl to hello.com\n+        workflow.setForumUrl(\"hello.com\");\n+        workflowsApi.updateWorkflow(workflow.getId(), workflow);\n+        workflowsApi.refresh(workflow.getId());", "originalCommit": "4b6527e8f0518a6dab35cacfcc7b0238ec691526", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI4NzU1OA==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r498287558", "bodyText": "Hm I included the refresh because I was modelling the structure of other update tests. I think verifying it still sticks after is refresh is a good idea, mimics the behaviour of when a user updates the forumUrl", "author": "nrzhao4", "createdAt": "2020-10-01T14:27:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2MDUxMA=="}], "type": "inlineReview", "revised_code": {"commit": "5e19ad7a951d9dc6789b7bec0de0a4aec72112e5", "chunk": "diff --git a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\nindex 63e54a666..d16d6b550 100644\n--- a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n+++ b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n\n@@ -516,6 +515,8 @@ public class GeneralWorkflowIT extends BaseIT {\n         Workflow workflow = workflowsApi\n                 .manualRegister(\"github\", \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\", \"test-update-workflow\", \"cwl\",\n                         \"/test.json\");\n+        SourceControl.GITHUB.getFriendlyName();\n+        DescriptorLanguage.CWL.toString();\n \n         //update the forumUrl to hello.com\n         workflow.setForumUrl(\"hello.com\");\n"}}, {"oid": "587cdcd0adec3ca537f2dcb090e45eb8ae0127dd", "url": "https://github.com/dockstore/dockstore/commit/587cdcd0adec3ca537f2dcb090e45eb8ae0127dd", "message": "added max=256 for column forumurl", "committedDate": "2020-10-05T15:15:19Z", "type": "commit"}, {"oid": "723ee3ee09ab66c386755c791cb5aa9393f50d59", "url": "https://github.com/dockstore/dockstore/commit/723ee3ee09ab66c386755c791cb5aa9393f50d59", "message": "Merge branch 'develop' into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-05T16:22:59Z", "type": "commit"}, {"oid": "baf3676545a859a8e79d45875721d4012aa1e46c", "url": "https://github.com/dockstore/dockstore/commit/baf3676545a859a8e79d45875721d4012aa1e46c", "message": "update proposed database changes", "committedDate": "2020-10-05T17:22:27Z", "type": "commit"}, {"oid": "caed860865e3c174a0702da7f0d9131aa50004f6", "url": "https://github.com/dockstore/dockstore/commit/caed860865e3c174a0702da7f0d9131aa50004f6", "message": "Merge branch 'feature/3739/allowAddingLinkToForum' of https://github.com/dockstore/dockstore into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-05T17:22:58Z", "type": "commit"}, {"oid": "7375c801b8ae8e5643c8a032f8afd78da214b0c4", "url": "https://github.com/dockstore/dockstore/commit/7375c801b8ae8e5643c8a032f8afd78da214b0c4", "message": "Merge branch 'develop' into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-09T18:44:47Z", "type": "commit"}, {"oid": "e936d882036e929c2a8b098cd3f7e688a28f91ed", "url": "https://github.com/dockstore/dockstore/commit/e936d882036e929c2a8b098cd3f7e688a28f91ed", "message": "moved changes in migration file", "committedDate": "2020-10-15T15:04:06Z", "type": "commit"}, {"oid": "4a56fee6ff89238dfac423592a829dc64920804a", "url": "https://github.com/dockstore/dockstore/commit/4a56fee6ff89238dfac423592a829dc64920804a", "message": "Merge branch 'develop' into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-15T15:14:34Z", "type": "commit"}, {"oid": "2626c6fa639bb74e800c8208f7bffae54b5f0d8a", "url": "https://github.com/dockstore/dockstore/commit/2626c6fa639bb74e800c8208f7bffae54b5f0d8a", "message": "Merge branch 'develop' into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-15T18:58:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwMTUxNQ==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r507901515", "bodyText": "SourceControl.GITHUB.getFriendlyName() and DescriptorLanguage.CWL.toString()", "author": "garyluu", "createdAt": "2020-10-19T16:47:49Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java", "diffHunk": "@@ -503,6 +504,30 @@ public void testUpdateWorkflowPath() throws ApiException {\n         assertEquals(\"test workflow path should be the same as default workflow path, it is \" + testpath, \"/Dockstore.cwl\", testpath);\n     }\n \n+    @Test\n+    public void testAddingWorkflowForumUrl() throws ApiException {\n+        // Set up webservice\n+        ApiClient webClient = WorkflowIT.getWebClient(USER_2_USERNAME, testingPostgres);\n+        WorkflowsApi workflowsApi = new WorkflowsApi(webClient);\n+\n+        UsersApi usersApi = new UsersApi(webClient);\n+        usersApi.getUser();\n+\n+        Workflow workflow = workflowsApi\n+                .manualRegister(\"github\", \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\", \"test-update-workflow\", \"cwl\",", "originalCommit": "2626c6fa639bb74e800c8208f7bffae54b5f0d8a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5e19ad7a951d9dc6789b7bec0de0a4aec72112e5", "chunk": "diff --git a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\nindex 63e54a666..d16d6b550 100644\n--- a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n+++ b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n\n@@ -516,6 +515,8 @@ public class GeneralWorkflowIT extends BaseIT {\n         Workflow workflow = workflowsApi\n                 .manualRegister(\"github\", \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\", \"test-update-workflow\", \"cwl\",\n                         \"/test.json\");\n+        SourceControl.GITHUB.getFriendlyName();\n+        DescriptorLanguage.CWL.toString();\n \n         //update the forumUrl to hello.com\n         workflow.setForumUrl(\"hello.com\");\n"}}, {"oid": "26449a068380c34840f0d6c8a79ebf7b33a10355", "url": "https://github.com/dockstore/dockstore/commit/26449a068380c34840f0d6c8a79ebf7b33a10355", "message": "Merge branch 'develop' into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-19T20:33:06Z", "type": "commit"}, {"oid": "5e19ad7a951d9dc6789b7bec0de0a4aec72112e5", "url": "https://github.com/dockstore/dockstore/commit/5e19ad7a951d9dc6789b7bec0de0a4aec72112e5", "message": "changes to test", "committedDate": "2020-10-20T18:14:12Z", "type": "commit"}, {"oid": "d6c86489bfdab3d070cb61240fea3523a53a18a8", "url": "https://github.com/dockstore/dockstore/commit/d6c86489bfdab3d070cb61240fea3523a53a18a8", "message": "Merge branch 'feature/3739/allowAddingLinkToForum' of https://github.com/dockstore/dockstore into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-20T18:14:51Z", "type": "commit"}, {"oid": "a96a29e3c7cd8b55ef8e70fee95bbbdcf126aa17", "url": "https://github.com/dockstore/dockstore/commit/a96a29e3c7cd8b55ef8e70fee95bbbdcf126aa17", "message": "changes to test", "committedDate": "2020-10-20T18:41:03Z", "type": "commit"}, {"oid": "023526c3a35fb0dd82bd2c7f5eb883c62aabe565", "url": "https://github.com/dockstore/dockstore/commit/023526c3a35fb0dd82bd2c7f5eb883c62aabe565", "message": "changed test", "committedDate": "2020-10-20T20:31:29Z", "type": "commit"}, {"oid": "9766a69081ce0da74f0b74576559fed8b4b4a87d", "url": "https://github.com/dockstore/dockstore/commit/9766a69081ce0da74f0b74576559fed8b4b4a87d", "message": "Merge branch 'develop' into feature/3739/allowAddingLinkToForum", "committedDate": "2020-10-23T15:15:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAzNjcwNw==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r511036707", "bodyText": "What's the purpose of this?", "author": "garyluu", "createdAt": "2020-10-23T17:36:04Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java", "diffHunk": "@@ -590,6 +590,31 @@ public void testUpdateWorkflowPath() throws ApiException {\n         assertEquals(\"test workflow path should be the same as default workflow path, it is \" + testpath, \"/Dockstore.cwl\", testpath);\n     }\n \n+    @Test\n+    public void testAddingWorkflowForumUrl() throws ApiException {\n+        // Set up webservice\n+        ApiClient webClient = WorkflowIT.getWebClient(USER_2_USERNAME, testingPostgres);\n+        WorkflowsApi workflowsApi = new WorkflowsApi(webClient);\n+\n+        UsersApi usersApi = new UsersApi(webClient);\n+        usersApi.getUser();", "originalCommit": "9766a69081ce0da74f0b74576559fed8b4b4a87d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6abb422656f6bd0363fce595471842e578674a33", "chunk": "diff --git a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\nindex c908ef2ad..802cb76a1 100644\n--- a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n+++ b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n\n@@ -596,9 +596,6 @@ public class GeneralWorkflowIT extends BaseIT {\n         ApiClient webClient = WorkflowIT.getWebClient(USER_2_USERNAME, testingPostgres);\n         WorkflowsApi workflowsApi = new WorkflowsApi(webClient);\n \n-        UsersApi usersApi = new UsersApi(webClient);\n-        usersApi.getUser();\n-\n         Workflow workflow = workflowsApi\n                 .manualRegister(SourceControl.GITHUB.getFriendlyName(), \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\",\n                         \"test-update-workflow\", DescriptorLanguage.CWL.toString(),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAzNzMyNQ==", "url": "https://github.com/dockstore/dockstore/pull/3839#discussion_r511037325", "bodyText": "For future, you don't have to say \"it is \", the test runner will automatically say something like:\n\"expected: potato\"\n\"actual: tomato\"", "author": "garyluu", "createdAt": "2020-10-23T17:37:18Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java", "diffHunk": "@@ -590,6 +590,31 @@ public void testUpdateWorkflowPath() throws ApiException {\n         assertEquals(\"test workflow path should be the same as default workflow path, it is \" + testpath, \"/Dockstore.cwl\", testpath);\n     }\n \n+    @Test\n+    public void testAddingWorkflowForumUrl() throws ApiException {\n+        // Set up webservice\n+        ApiClient webClient = WorkflowIT.getWebClient(USER_2_USERNAME, testingPostgres);\n+        WorkflowsApi workflowsApi = new WorkflowsApi(webClient);\n+\n+        UsersApi usersApi = new UsersApi(webClient);\n+        usersApi.getUser();\n+\n+        Workflow workflow = workflowsApi\n+                .manualRegister(SourceControl.GITHUB.getFriendlyName(), \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\",\n+                        \"test-update-workflow\", DescriptorLanguage.CWL.toString(),\n+                        \"/test.json\");\n+        \n+        //update the forumUrl to hello.com\n+        workflow.setForumUrl(\"hello.com\");\n+        workflowsApi.updateWorkflow(workflow.getId(), workflow);\n+        workflowsApi.refresh(workflow.getId(), false);\n+\n+        //check the workflow's forumUrl is hello.com\n+        final String updatedForumUrl = testingPostgres\n+                .runSelectStatement(\"select forumurl from workflow where workflowname = 'test-update-workflow'\", String.class);\n+        assertEquals(\"forumUrl should be updated, it is \" + updatedForumUrl, \"hello.com\", updatedForumUrl);", "originalCommit": "9766a69081ce0da74f0b74576559fed8b4b4a87d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6abb422656f6bd0363fce595471842e578674a33", "chunk": "diff --git a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\nindex c908ef2ad..802cb76a1 100644\n--- a/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n+++ b/dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralWorkflowIT.java\n\n@@ -596,9 +596,6 @@ public class GeneralWorkflowIT extends BaseIT {\n         ApiClient webClient = WorkflowIT.getWebClient(USER_2_USERNAME, testingPostgres);\n         WorkflowsApi workflowsApi = new WorkflowsApi(webClient);\n \n-        UsersApi usersApi = new UsersApi(webClient);\n-        usersApi.getUser();\n-\n         Workflow workflow = workflowsApi\n                 .manualRegister(SourceControl.GITHUB.getFriendlyName(), \"DockstoreTestUser2/test_lastmodified\", \"/Dockstore.cwl\",\n                         \"test-update-workflow\", DescriptorLanguage.CWL.toString(),\n"}}, {"oid": "6abb422656f6bd0363fce595471842e578674a33", "url": "https://github.com/dockstore/dockstore/commit/6abb422656f6bd0363fce595471842e578674a33", "message": "removed extra test steps", "committedDate": "2020-10-23T18:22:53Z", "type": "commit"}]}