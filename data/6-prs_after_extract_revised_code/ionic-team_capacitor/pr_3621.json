{"pr_number": 3621, "pr_title": "Permissions improvements", "pr_createdAt": "2020-09-28T20:44:42Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3621", "timeline": [{"oid": "3203f0a1cc132fc8999e6fd9cdb4388cfc509a6b", "url": "https://github.com/ionic-team/capacitor/commit/3203f0a1cc132fc8999e6fd9cdb4388cfc509a6b", "message": "Removed android", "committedDate": "2020-08-13T20:53:38Z", "type": "commit"}, {"oid": "d675b812f0dd5eaf61359134aec8a5a9b037fc4e", "url": "https://github.com/ionic-team/capacitor/commit/d675b812f0dd5eaf61359134aec8a5a9b037fc4e", "message": "Merged in main", "committedDate": "2020-08-24T19:59:43Z", "type": "commit"}, {"oid": "b551235bc732e5d0975af3603f11584d5397570f", "url": "https://github.com/ionic-team/capacitor/commit/b551235bc732e5d0975af3603f11584d5397570f", "message": "Removed more", "committedDate": "2020-08-24T22:29:32Z", "type": "commit"}, {"oid": "45b246cb8dfd6773e0ac47faf688e5184f25ae44", "url": "https://github.com/ionic-team/capacitor/commit/45b246cb8dfd6773e0ac47faf688e5184f25ae44", "message": "Merge branch 'main' into remove-geolocation", "committedDate": "2020-08-25T18:32:26Z", "type": "commit"}, {"oid": "0ba5cd846eafcc14a76fbae51d88d913195b5606", "url": "https://github.com/ionic-team/capacitor/commit/0ba5cd846eafcc14a76fbae51d88d913195b5606", "message": "Added registration mechanism for a geolocation plugin to hook on to permission requst from browser", "committedDate": "2020-09-08T20:54:58Z", "type": "commit"}, {"oid": "8b1503894dc3ab4a706afaf6d7feb9277161d64b", "url": "https://github.com/ionic-team/capacitor/commit/8b1503894dc3ab4a706afaf6d7feb9277161d64b", "message": "Merge branch 'main' into remove-geolocation", "committedDate": "2020-09-08T20:55:25Z", "type": "commit"}, {"oid": "befcd420e2a83ee6d831eb41b279a53e0b6a481c", "url": "https://github.com/ionic-team/capacitor/commit/befcd420e2a83ee6d831eb41b279a53e0b6a481c", "message": "import cleanup/fix", "committedDate": "2020-09-08T21:09:26Z", "type": "commit"}, {"oid": "813288c13d34c42dfa96e717cbd0fbc53453d16c", "url": "https://github.com/ionic-team/capacitor/commit/813288c13d34c42dfa96e717cbd0fbc53453d16c", "message": "prettier", "committedDate": "2020-09-08T21:09:44Z", "type": "commit"}, {"oid": "6b4ad70099f27dd2449173cbc01381ff1221dcb4", "url": "https://github.com/ionic-team/capacitor/commit/6b4ad70099f27dd2449173cbc01381ff1221dcb4", "message": "Merge branch 'main' into remove-geolocation", "committedDate": "2020-09-08T21:10:01Z", "type": "commit"}, {"oid": "550356795c2f2e22428288fee35a549da516c571", "url": "https://github.com/ionic-team/capacitor/commit/550356795c2f2e22428288fee35a549da516c571", "message": "Changed to use an interface", "committedDate": "2020-09-10T17:53:30Z", "type": "commit"}, {"oid": "082e1a04884b13025aa3b435a3333677ff72faab", "url": "https://github.com/ionic-team/capacitor/commit/082e1a04884b13025aa3b435a3333677ff72faab", "message": "mistaken removal", "committedDate": "2020-09-10T17:59:06Z", "type": "commit"}, {"oid": "b1c8816c338ed52646466b4573fd803f36293c51", "url": "https://github.com/ionic-team/capacitor/commit/b1c8816c338ed52646466b4573fd803f36293c51", "message": "add method on Plugin class", "committedDate": "2020-09-10T18:17:13Z", "type": "commit"}, {"oid": "0c51d78526002d170ba95d23d98dcef50a9ded98", "url": "https://github.com/ionic-team/capacitor/commit/0c51d78526002d170ba95d23d98dcef50a9ded98", "message": "Exploring permissions changes", "committedDate": "2020-09-17T20:48:55Z", "type": "commit"}, {"oid": "563f59a382bea92e2c7cb0edae903f2180080402", "url": "https://github.com/ionic-team/capacitor/commit/563f59a382bea92e2c7cb0edae903f2180080402", "message": "Cleanup from some different work", "committedDate": "2020-09-17T20:51:06Z", "type": "commit"}, {"oid": "55b8add1960e5db9c6363278a269e00081f3ad48", "url": "https://github.com/ionic-team/capacitor/commit/55b8add1960e5db9c6363278a269e00081f3ad48", "message": "Registration with new annotation", "committedDate": "2020-09-17T21:07:02Z", "type": "commit"}, {"oid": "a47531b7397f21eab37ce3335466bbe69f2be34c", "url": "https://github.com/ionic-team/capacitor/commit/a47531b7397f21eab37ce3335466bbe69f2be34c", "message": "Changed back handleRequestPermissionsResult method", "committedDate": "2020-09-17T22:42:10Z", "type": "commit"}, {"oid": "c88e9a20bf9b5ead5e8ca43abca97470d6872733", "url": "https://github.com/ionic-team/capacitor/commit/c88e9a20bf9b5ead5e8ca43abca97470d6872733", "message": "New helper with checkPermissions", "committedDate": "2020-09-17T22:53:09Z", "type": "commit"}, {"oid": "2a44cb2ea27656742ae0ce3922cd76efae5e3aa1", "url": "https://github.com/ionic-team/capacitor/commit/2a44cb2ea27656742ae0ce3922cd76efae5e3aa1", "message": "rename", "committedDate": "2020-09-18T21:16:10Z", "type": "commit"}, {"oid": "a30defdd10122577b0ae4bba7dcce7bf61a4a310", "url": "https://github.com/ionic-team/capacitor/commit/a30defdd10122577b0ae4bba7dcce7bf61a4a310", "message": "Merge branch 'main' into remove-geolocation", "committedDate": "2020-09-23T21:39:21Z", "type": "commit"}, {"oid": "14593727040c7f1d5727c3d17748598807813735", "url": "https://github.com/ionic-team/capacitor/commit/14593727040c7f1d5727c3d17748598807813735", "message": "undoing permission work so it can be handled in core", "committedDate": "2020-09-23T21:48:27Z", "type": "commit"}, {"oid": "5d7b444c73539b5a57a1d7449e96bd630bb35300", "url": "https://github.com/ionic-team/capacitor/commit/5d7b444c73539b5a57a1d7449e96bd630bb35300", "message": "Added new methods for checking permissions in the WebChromeClient", "committedDate": "2020-09-23T21:59:49Z", "type": "commit"}, {"oid": "3db9216ca273e44a831e9d153375b3db14e89468", "url": "https://github.com/ionic-team/capacitor/commit/3db9216ca273e44a831e9d153375b3db14e89468", "message": "putting this back...", "committedDate": "2020-09-23T22:02:54Z", "type": "commit"}, {"oid": "0ce95e78a7bff4884fe942c719568cabafd1f7a6", "url": "https://github.com/ionic-team/capacitor/commit/0ce95e78a7bff4884fe942c719568cabafd1f7a6", "message": "Replacing removed import statements that were necessary", "committedDate": "2020-09-23T22:25:17Z", "type": "commit"}, {"oid": "66cae3fffa3f00492b7695b7c4ff4919fc6e2a58", "url": "https://github.com/ionic-team/capacitor/commit/66cae3fffa3f00492b7695b7c4ff4919fc6e2a58", "message": "Merge branch 'main' into remove-geolocation", "committedDate": "2020-09-24T12:17:34Z", "type": "commit"}, {"oid": "2aa0d43db2c248bc2d5ba16a24d64f1c3593f7aa", "url": "https://github.com/ionic-team/capacitor/commit/2aa0d43db2c248bc2d5ba16a24d64f1c3593f7aa", "message": "fmt", "committedDate": "2020-09-24T12:30:48Z", "type": "commit"}, {"oid": "6f3cf572b3867c3b89b4f4327aec70092c0346ff", "url": "https://github.com/ionic-team/capacitor/commit/6f3cf572b3867c3b89b4f4327aec70092c0346ff", "message": "Merge branch 'main' into remove-geolocation", "committedDate": "2020-09-24T21:44:53Z", "type": "commit"}, {"oid": "8c75c32ac27a3d49942bce019fc2ca2e59da2ee9", "url": "https://github.com/ionic-team/capacitor/commit/8c75c32ac27a3d49942bce019fc2ca2e59da2ee9", "message": "Merge branch 'main' into permissions", "committedDate": "2020-09-24T21:50:22Z", "type": "commit"}, {"oid": "1e0b24e5238177c49670fcb80cc79638db4fdbe7", "url": "https://github.com/ionic-team/capacitor/commit/1e0b24e5238177c49670fcb80cc79638db4fdbe7", "message": "Removed permissions code constant class", "committedDate": "2020-09-28T20:57:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODcyOQ==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r496298729", "bodyText": "Is there any way to document what should be used instead?", "author": "imhoffd", "createdAt": "2020-09-28T23:57:45Z", "path": "android/capacitor/src/main/java/com/getcapacitor/NativePlugin.java", "diffHunk": "@@ -7,6 +7,7 @@\n  * Base annotation for all Plugins\n  */\n @Retention(RetentionPolicy.RUNTIME)\n+@Deprecated", "originalCommit": "1e0b24e5238177c49670fcb80cc79638db4fdbe7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "09a9f89bed3ef47d152bc1e8c86bd6c112265119", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/NativePlugin.java b/android/capacitor/src/main/java/com/getcapacitor/NativePlugin.java\nindex 3459374a..c4307624 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/NativePlugin.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/NativePlugin.java\n\n@@ -1,10 +1,13 @@\n package com.getcapacitor;\n \n+import com.getcapacitor.annotation.CapacitorPlugin;\n import java.lang.annotation.Retention;\n import java.lang.annotation.RetentionPolicy;\n \n /**\n  * Base annotation for all Plugins\n+ * @deprecated\n+ * <p> Use {@link CapacitorPlugin} instead\n  */\n @Retention(RetentionPolicy.RUNTIME)\n @Deprecated\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5OTMzMQ==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r496299331", "bodyText": "Since we have the opportunity, would it make sense to create an annotation namespace for this class and for CapacitorPlugin?\nImports would look like this:\nimport com.getcapacitor.annotation.CapacitorPlugin;\nimport com.getcapacitor.annotation.Permission;", "author": "imhoffd", "createdAt": "2020-09-28T23:59:53Z", "path": "android/capacitor/src/main/java/com/getcapacitor/Permission.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.getcapacitor;\n+\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+\n+/**\n+ * Permission annotation for use with @CapacitorPlugin\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+public @interface Permission {", "originalCommit": "1e0b24e5238177c49670fcb80cc79638db4fdbe7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg2MTI5NQ==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r496861295", "bodyText": "Yeah I can do that, would be more organized", "author": "carlpoole", "createdAt": "2020-09-29T16:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5OTMzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "09a9f89bed3ef47d152bc1e8c86bd6c112265119", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/Permission.java b/android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java\nsimilarity index 93%\nrename from android/capacitor/src/main/java/com/getcapacitor/Permission.java\nrename to android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java\nindex cfeef09c..d87e18c3 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/Permission.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java\n\n@@ -1,4 +1,4 @@\n-package com.getcapacitor;\n+package com.getcapacitor.annotation;\n \n import java.lang.annotation.Retention;\n import java.lang.annotation.RetentionPolicy;\n"}}, {"oid": "09a9f89bed3ef47d152bc1e8c86bd6c112265119", "url": "https://github.com/ionic-team/capacitor/commit/09a9f89bed3ef47d152bc1e8c86bd6c112265119", "message": "Relocated annotations to own package, added deprecation doc to NativePlugin", "committedDate": "2020-09-29T16:19:09Z", "type": "commit"}, {"oid": "1201faccc148786887cbdad6068bad93824f7c30", "url": "https://github.com/ionic-team/capacitor/commit/1201faccc148786887cbdad6068bad93824f7c30", "message": "Merge branch 'main' into permissions", "committedDate": "2020-09-29T16:20:41Z", "type": "commit"}, {"oid": "f03e463cef42dc6f222424eca78da9a6f6c4a66b", "url": "https://github.com/ionic-team/capacitor/commit/f03e463cef42dc6f222424eca78da9a6f6c4a66b", "message": "bridge calls new premission callback if using new annotation", "committedDate": "2020-09-29T22:49:31Z", "type": "commit"}, {"oid": "6d960fb166197d27651c80f91b99b08022d1b344", "url": "https://github.com/ionic-team/capacitor/commit/6d960fb166197d27651c80f91b99b08022d1b344", "message": "Added rationale status check ability", "committedDate": "2020-10-05T20:39:19Z", "type": "commit"}, {"oid": "3aa58a9906c6eff449c2c58e0e60deb015a67c34", "url": "https://github.com/ionic-team/capacitor/commit/3aa58a9906c6eff449c2c58e0e60deb015a67c34", "message": "Javadoc", "committedDate": "2020-10-05T22:42:16Z", "type": "commit"}, {"oid": "76f853a5f4873b8623da6f4592844fab54386978", "url": "https://github.com/ionic-team/capacitor/commit/76f853a5f4873b8623da6f4592844fab54386978", "message": "Merge branch 'permissions' of github.com:ionic-team/capacitor into permissions", "committedDate": "2020-10-05T22:44:24Z", "type": "commit"}, {"oid": "54df41cbeca3facca6dfd911184a0c57ef276468", "url": "https://github.com/ionic-team/capacitor/commit/54df41cbeca3facca6dfd911184a0c57ef276468", "message": "Merge branch 'main' into permissions", "committedDate": "2020-10-05T22:45:05Z", "type": "commit"}, {"oid": "fde1a74cc45bbc5dec312ee22fa6a81b4b8ca3db", "url": "https://github.com/ionic-team/capacitor/commit/fde1a74cc45bbc5dec312ee22fa6a81b4b8ca3db", "message": "Modified to allow for multiple different permissions with the same alias in a plugin", "committedDate": "2020-10-06T19:20:45Z", "type": "commit"}, {"oid": "57aa04db1ca772ca14070bae9848c55cfb6199c5", "url": "https://github.com/ionic-team/capacitor/commit/57aa04db1ca772ca14070bae9848c55cfb6199c5", "message": "Added typescript for the new permissions methods", "committedDate": "2020-10-06T20:31:12Z", "type": "commit"}, {"oid": "7cd937f36c8a241784e347c9b0c48f627d09d780", "url": "https://github.com/ionic-team/capacitor/commit/7cd937f36c8a241784e347c9b0c48f627d09d780", "message": "Resolve errors for now in outstanding plugins", "committedDate": "2020-10-06T20:49:21Z", "type": "commit"}, {"oid": "56f828d6677f53f49871a618d40079665150a660", "url": "https://github.com/ionic-team/capacitor/commit/56f828d6677f53f49871a618d40079665150a660", "message": "Merge branch 'main' into permissions", "committedDate": "2020-10-07T19:40:20Z", "type": "commit"}, {"oid": "46b9327a0c6cecd8439fbee0cff6417d7fdf030f", "url": "https://github.com/ionic-team/capacitor/commit/46b9327a0c6cecd8439fbee0cff6417d7fdf030f", "message": "removed rationale method and plugin level permission types", "committedDate": "2020-10-14T20:19:27Z", "type": "commit"}, {"oid": "3519c9a3d9e6e2517db68955ed81ebc0ba14e889", "url": "https://github.com/ionic-team/capacitor/commit/3519c9a3d9e6e2517db68955ed81ebc0ba14e889", "message": "Merged in main, addressed formatting complaints", "committedDate": "2020-10-14T20:22:54Z", "type": "commit"}, {"oid": "51bf6e2e477b478cb9642f3381a738e400fc77d0", "url": "https://github.com/ionic-team/capacitor/commit/51bf6e2e477b478cb9642f3381a738e400fc77d0", "message": "merging in remove-geolocation", "committedDate": "2020-10-14T20:29:06Z", "type": "commit"}, {"oid": "981b117292981aea2224b0cdb953817cc742df35", "url": "https://github.com/ionic-team/capacitor/commit/981b117292981aea2224b0cdb953817cc742df35", "message": "removed permissions method, fixed format complaints", "committedDate": "2020-10-14T20:36:50Z", "type": "commit"}, {"oid": "1ecb605f8ebdc917672bc4b8b2c3953396ecff1e", "url": "https://github.com/ionic-team/capacitor/commit/1ecb605f8ebdc917672bc4b8b2c3953396ecff1e", "message": "geolocation permission code", "committedDate": "2020-10-14T20:42:56Z", "type": "commit"}, {"oid": "2bc83aa50d5799f455901e1527b0a5bf46bdf22c", "url": "https://github.com/ionic-team/capacitor/commit/2bc83aa50d5799f455901e1527b0a5bf46bdf22c", "message": "Merge in main", "committedDate": "2020-10-15T19:50:44Z", "type": "commit"}, {"oid": "836895cef6a9278aeb11ae5cf17154d8a1ab2a2b", "url": "https://github.com/ionic-team/capacitor/commit/836895cef6a9278aeb11ae5cf17154d8a1ab2a2b", "message": "Removed iOS Geolocation code", "committedDate": "2020-10-15T20:11:50Z", "type": "commit"}, {"oid": "d1ffccc7729997ab7ca97ceba574f83e17827e45", "url": "https://github.com/ionic-team/capacitor/commit/d1ffccc7729997ab7ca97ceba574f83e17827e45", "message": "Merged in remove-geolocation", "committedDate": "2020-10-15T20:23:24Z", "type": "commit"}, {"oid": "2571236b1731e6da4c472ddc27caa6e3577e262f", "url": "https://github.com/ionic-team/capacitor/commit/2571236b1731e6da4c472ddc27caa6e3577e262f", "message": "Merge branch 'main' into permissions", "committedDate": "2020-10-16T14:14:07Z", "type": "commit"}, {"oid": "4a973f6ca2337fa8058bed9b29584cf8d42d2a13", "url": "https://github.com/ionic-team/capacitor/commit/4a973f6ca2337fa8058bed9b29584cf8d42d2a13", "message": "Added proper request callback for web browser permission requests", "committedDate": "2020-10-16T15:25:20Z", "type": "commit"}, {"oid": "77955d67bff48b70632701000d840aafd7f2c5cc", "url": "https://github.com/ionic-team/capacitor/commit/77955d67bff48b70632701000d840aafd7f2c5cc", "message": "Merge branch 'permissions' of github.com:ionic-team/capacitor into permissions", "committedDate": "2020-10-16T15:25:59Z", "type": "commit"}, {"oid": "a511010e2a77423b1cb69662de0a1603b447c64f", "url": "https://github.com/ionic-team/capacitor/commit/a511010e2a77423b1cb69662de0a1603b447c64f", "message": "Merged in remove-geolocation", "committedDate": "2020-10-16T15:27:08Z", "type": "commit"}, {"oid": "cb96b88749492085d085421fec0a0e4b1833ce04", "url": "https://github.com/ionic-team/capacitor/commit/cb96b88749492085d085421fec0a0e4b1833ce04", "message": "Merged in main", "committedDate": "2020-10-22T18:14:14Z", "type": "commit"}, {"oid": "2b550ce0a691696fa844cba6cb7a164eda21d829", "url": "https://github.com/ionic-team/capacitor/commit/2b550ce0a691696fa844cba6cb7a164eda21d829", "message": "Refactoring", "committedDate": "2020-10-22T20:44:27Z", "type": "commit"}, {"oid": "e6a7dedfcbc8a1b2faf8ce01c26ab36d076f1fde", "url": "https://github.com/ionic-team/capacitor/commit/e6a7dedfcbc8a1b2faf8ce01c26ab36d076f1fde", "message": "Merge branch 'main' into permissions", "committedDate": "2020-10-23T19:25:56Z", "type": "commit"}, {"oid": "6d89b037e70ecd0f4b206d26c4decb64a1a48e2d", "url": "https://github.com/ionic-team/capacitor/commit/6d89b037e70ecd0f4b206d26c4decb64a1a48e2d", "message": "Added PermissionHelper static class to share methods between Plugin and BridgeWebChromeClient", "committedDate": "2020-10-23T20:42:01Z", "type": "commit"}, {"oid": "a5e2e62c9deb7cc0e349d75ad4e9d94e4f3b8da4", "url": "https://github.com/ionic-team/capacitor/commit/a5e2e62c9deb7cc0e349d75ad4e9d94e4f3b8da4", "message": "Added sharedprefs for plugin state caching.", "committedDate": "2020-10-23T21:49:28Z", "type": "commit"}, {"oid": "867e5bdf6f25f40a1e875d1e610e4e030989713d", "url": "https://github.com/ionic-team/capacitor/commit/867e5bdf6f25f40a1e875d1e610e4e030989713d", "message": "Undo formatting that was done for some reason", "committedDate": "2020-10-26T14:41:07Z", "type": "commit"}, {"oid": "faee1c39d5612271eae9e263c56b2555899081be", "url": "https://github.com/ionic-team/capacitor/commit/faee1c39d5612271eae9e263c56b2555899081be", "message": "Merge branch 'main' into permissions", "committedDate": "2020-10-27T20:03:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA5MTQxNw==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r513091417", "bodyText": "Not sure if this was intentional? Does it need to be wrapped in <p></p> tags?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * <p> Use {@link CapacitorPlugin} instead\n          \n          \n            \n             * Use {@link CapacitorPlugin} instead", "author": "imhoffd", "createdAt": "2020-10-27T23:28:03Z", "path": "android/capacitor/src/main/java/com/getcapacitor/NativePlugin.java", "diffHunk": "@@ -1,12 +1,16 @@\n package com.getcapacitor;\n \n+import com.getcapacitor.annotation.CapacitorPlugin;\n import java.lang.annotation.Retention;\n import java.lang.annotation.RetentionPolicy;\n \n /**\n  * Base annotation for all Plugins\n+ * @deprecated\n+ * <p> Use {@link CapacitorPlugin} instead", "originalCommit": "faee1c39d5612271eae9e263c56b2555899081be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE2MjgxMg==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r513162812", "bodyText": "It's valid. It doesn't look right but it's how the IDE formatted it correctly, I think. https://www.oracle.com/technical-resources/articles/java/javadoc-tool.html#format", "author": "carlpoole", "createdAt": "2020-10-28T03:45:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA5MTQxNw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6ec6d2beaac21037d1c67af16a15aaf027b5d794", "url": "https://github.com/ionic-team/capacitor/commit/6ec6d2beaac21037d1c67af16a15aaf027b5d794", "message": "fix incorrect tuple\n\nCo-authored-by: Dan Imhoff <dwieeb@gmail.com>", "committedDate": "2020-10-28T03:47:16Z", "type": "commit"}, {"oid": "b75ff486367f6a2c269ea224987ec4d80f7bd258", "url": "https://github.com/ionic-team/capacitor/commit/b75ff486367f6a2c269ea224987ec4d80f7bd258", "message": "Added prompt-with-rationale state", "committedDate": "2020-10-28T15:59:55Z", "type": "commit"}, {"oid": "11a79372ee37e1e08567738dad20791a52415a20", "url": "https://github.com/ionic-team/capacitor/commit/11a79372ee37e1e08567738dad20791a52415a20", "message": "merge main", "committedDate": "2020-10-28T18:20:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MTY3Mg==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r513681672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import android.webkit.WebChromeClient;\n          \n      \n    \n    \n  \n\nnot used", "author": "jcesarmobile", "createdAt": "2020-10-28T18:45:32Z", "path": "android/capacitor/src/main/java/com/getcapacitor/Bridge.java", "diffHunk": "@@ -13,8 +13,10 @@\n import android.os.Handler;\n import android.os.HandlerThread;\n import android.webkit.ValueCallback;\n+import android.webkit.WebChromeClient;", "originalCommit": "11a79372ee37e1e08567738dad20791a52415a20", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "03e448bfd7240cfe15482cff9922427aef3f1e1a", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/Bridge.java b/android/capacitor/src/main/java/com/getcapacitor/Bridge.java\nindex 73122a9f..1867d8db 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/Bridge.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/Bridge.java\n\n@@ -17,6 +17,8 @@ import android.webkit.WebChromeClient;\n import android.webkit.WebSettings;\n import android.webkit.WebView;\n import com.getcapacitor.annotation.CapacitorPlugin;\n+import com.getcapacitor.plugin.LocalNotifications;\n+import com.getcapacitor.plugin.PushNotifications;\n import com.getcapacitor.plugin.SplashScreen;\n import com.getcapacitor.util.HostMask;\n import java.io.File;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MzA0OA==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r513683048", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                static final int FILE_CHOOSER = 9007;\n          \n          \n            \n                static final int FILE_CHOOSER_IMAGE_CAPTURE = 9008;\n          \n          \n            \n                static final int FILE_CHOOSER_VIDEO_CAPTURE = 9009;\n          \n          \n            \n                static final int FILE_CHOOSER_CAMERA_PERMISSION = 9010;\n          \n          \n            \n                static final int GET_USER_MEDIA_PERMISSIONS = 9011;\n          \n          \n            \n                static final int GEOLOCATION_REQUEST_PERMISSIONS = 9004;\n          \n          \n            \n                static final int FILE_CHOOSER = 9001;\n          \n          \n            \n                static final int FILE_CHOOSER_IMAGE_CAPTURE = 9002;\n          \n          \n            \n                static final int FILE_CHOOSER_VIDEO_CAPTURE = 9003;\n          \n          \n            \n                static final int FILE_CHOOSER_CAMERA_PERMISSION = 9004;\n          \n          \n            \n                static final int GET_USER_MEDIA_PERMISSIONS = 9005;\n          \n          \n            \n                static final int GEOLOCATION_REQUEST_PERMISSIONS = 9006;\n          \n      \n    \n    \n  \n\nbetter put codes in order for making easier to spot which ones are available in case we need to add more", "author": "jcesarmobile", "createdAt": "2020-10-28T18:47:45Z", "path": "android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java", "diffHunk": "@@ -39,13 +39,12 @@\n  */\n public class BridgeWebChromeClient extends WebChromeClient {\n \n-    static final int FILE_CHOOSER = PluginRequestCodes.FILE_CHOOSER;\n-    static final int FILE_CHOOSER_IMAGE_CAPTURE = PluginRequestCodes.FILE_CHOOSER_IMAGE_CAPTURE;\n-    static final int FILE_CHOOSER_VIDEO_CAPTURE = PluginRequestCodes.FILE_CHOOSER_VIDEO_CAPTURE;\n-    static final int FILE_CHOOSER_CAMERA_PERMISSION = PluginRequestCodes.FILE_CHOOSER_CAMERA_PERMISSION;\n-    static final int GET_USER_MEDIA_PERMISSIONS = PluginRequestCodes.GET_USER_MEDIA_PERMISSIONS;\n-    static final int GEOLOCATION_REQUEST_PERMISSIONS = PluginRequestCodes.GEOLOCATION_REQUEST_PERMISSIONS;\n-    static final String[] geoPermissions = { Manifest.permission.ACCESS_COARSE_LOCATION, Manifest.permission.ACCESS_FINE_LOCATION };\n+    static final int FILE_CHOOSER = 9007;\n+    static final int FILE_CHOOSER_IMAGE_CAPTURE = 9008;\n+    static final int FILE_CHOOSER_VIDEO_CAPTURE = 9009;\n+    static final int FILE_CHOOSER_CAMERA_PERMISSION = 9010;\n+    static final int GET_USER_MEDIA_PERMISSIONS = 9011;\n+    static final int GEOLOCATION_REQUEST_PERMISSIONS = 9004;", "originalCommit": "11a79372ee37e1e08567738dad20791a52415a20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM0MzcwNA==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r514343704", "bodyText": "Will these not conflict with the uses that already used the codes in that range? https://github.com/ionic-team/capacitor/pull/3621/files#diff-120f0e6b31193b391266aa177c18c6825b978c72c444be297115b31a061bb3a1", "author": "carlpoole", "createdAt": "2020-10-29T15:20:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MzA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM2MDE4MA==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r514360180", "bodyText": "In the plugins that used those codes we will need to use different codes from this ones, but plugins need to be updated anyway since this PR removes the file with the constants.\nWe just need to make sure the codes in the plugins are unique.", "author": "jcesarmobile", "createdAt": "2020-10-29T15:40:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MzA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUzNjY1Nw==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r514536657", "bodyText": "I think this is good, but let's do it after we have fixed all the plugins to work with the new permissions. Then we can do all the code changes across all plugins in a single commit and centralize it in one place so we don't miss any.", "author": "carlpoole", "createdAt": "2020-10-29T20:10:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MzA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4Njk2Mg==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r514586962", "bodyText": "Then would be better to revert the removal of PluginRequestCodes.java and remove it once all plugins are migrated", "author": "jcesarmobile", "createdAt": "2020-10-29T21:46:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MzA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxOTQ0OQ==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r514619449", "bodyText": "Makes sense, reverted for now", "author": "carlpoole", "createdAt": "2020-10-29T23:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4MzA0OA=="}], "type": "inlineReview", "revised_code": {"commit": "819a890a48457adf0dec55174d3851d1b81805f2", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java b/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java\nindex e4b41818..00fe8b68 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java\n\n@@ -39,12 +39,12 @@ import org.json.JSONException;\n  */\n public class BridgeWebChromeClient extends WebChromeClient {\n \n-    static final int FILE_CHOOSER = 9007;\n-    static final int FILE_CHOOSER_IMAGE_CAPTURE = 9008;\n-    static final int FILE_CHOOSER_VIDEO_CAPTURE = 9009;\n-    static final int FILE_CHOOSER_CAMERA_PERMISSION = 9010;\n-    static final int GET_USER_MEDIA_PERMISSIONS = 9011;\n-    static final int GEOLOCATION_REQUEST_PERMISSIONS = 9004;\n+    static final int FILE_CHOOSER = PluginRequestCodes.FILE_CHOOSER;\n+    static final int FILE_CHOOSER_IMAGE_CAPTURE = PluginRequestCodes.FILE_CHOOSER_IMAGE_CAPTURE;\n+    static final int FILE_CHOOSER_VIDEO_CAPTURE = PluginRequestCodes.FILE_CHOOSER_VIDEO_CAPTURE;\n+    static final int FILE_CHOOSER_CAMERA_PERMISSION = PluginRequestCodes.FILE_CHOOSER_CAMERA_PERMISSION;\n+    static final int GET_USER_MEDIA_PERMISSIONS = PluginRequestCodes.GET_USER_MEDIA_PERMISSIONS;\n+    static final int GEOLOCATION_REQUEST_PERMISSIONS = PluginRequestCodes.GEOLOCATION_REQUEST_PERMISSIONS;\n \n     private Bridge bridge;\n \n"}}, {"oid": "03e448bfd7240cfe15482cff9922427aef3f1e1a", "url": "https://github.com/ionic-team/capacitor/commit/03e448bfd7240cfe15482cff9922427aef3f1e1a", "message": "Added error when no valid permission or alias provided", "committedDate": "2020-10-29T15:15:11Z", "type": "commit"}, {"oid": "d916c0e32014ad1265781aeb2458ee5d44ce8271", "url": "https://github.com/ionic-team/capacitor/commit/d916c0e32014ad1265781aeb2458ee5d44ce8271", "message": "Merge branch 'permissions' of github.com:ionic-team/capacitor into permissions", "committedDate": "2020-10-29T15:15:34Z", "type": "commit"}, {"oid": "8cc6c82fefd3e1e841ecc5ca317c510d3719c527", "url": "https://github.com/ionic-team/capacitor/commit/8cc6c82fefd3e1e841ecc5ca317c510d3719c527", "message": "remove unused import\n\nCo-authored-by: jcesarmobile <jcesarmobile@gmail.com>", "committedDate": "2020-10-29T15:23:45Z", "type": "commit"}, {"oid": "819a890a48457adf0dec55174d3851d1b81805f2", "url": "https://github.com/ionic-team/capacitor/commit/819a890a48457adf0dec55174d3851d1b81805f2", "message": "Restored permission codes class temporarily for later cleanup", "committedDate": "2020-10-29T23:11:05Z", "type": "commit"}, {"oid": "79817fa2d4ea3063115b05f6719ae4abd8ec8e3f", "url": "https://github.com/ionic-team/capacitor/commit/79817fa2d4ea3063115b05f6719ae4abd8ec8e3f", "message": "Merge branch 'permissions' of github.com:ionic-team/capacitor into permissions", "committedDate": "2020-10-29T23:11:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1NDE1Mg==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r515154152", "bodyText": "The private hasPermissions should probably also be moved to the PermissionHelper", "author": "jcesarmobile", "createdAt": "2020-10-30T14:51:22Z", "path": "android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java", "diffHunk": "@@ -333,7 +334,7 @@ public void onRequestPermissionResult(int requestCode, String[] permissions, int\n \n     private boolean isMediaCaptureSupported() {\n         String[] permissions = { Manifest.permission.CAMERA };\n-        return hasPermissions(permissions) || !hasDefinedPermission(Manifest.permission.CAMERA);\n+        return hasPermissions(permissions) || !PermissionHelper.hasDefinedPermission(bridge.getContext(), Manifest.permission.CAMERA);", "originalCommit": "79817fa2d4ea3063115b05f6719ae4abd8ec8e3f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fb367bcabe524128ddc717e36b19f06795da51c2", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java b/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java\nindex 00fe8b68..f2593721 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/BridgeWebChromeClient.java\n\n@@ -334,7 +333,10 @@ public class BridgeWebChromeClient extends WebChromeClient {\n \n     private boolean isMediaCaptureSupported() {\n         String[] permissions = { Manifest.permission.CAMERA };\n-        return hasPermissions(permissions) || !PermissionHelper.hasDefinedPermission(bridge.getContext(), Manifest.permission.CAMERA);\n+        return (\n+            PermissionHelper.hasPermissions(bridge.getContext(), permissions) ||\n+            !PermissionHelper.hasDefinedPermission(bridge.getContext(), Manifest.permission.CAMERA)\n+        );\n     }\n \n     private void showMediaCaptureOrFilePicker(ValueCallback<Uri[]> filePathCallback, FileChooserParams fileChooserParams, boolean isVideo) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NjcwNw==", "url": "https://github.com/ionic-team/capacitor/pull/3621#discussion_r515166707", "bodyText": "add what should be used instead.", "author": "jcesarmobile", "createdAt": "2020-10-30T15:06:57Z", "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -449,15 +525,18 @@ public void requestPermissions(PluginCall call) {\n      * Handle request permissions result. A plugin can override this to handle the result\n      * themselves, or this method will handle the result for our convenient requestPermissions\n      * call.\n+     * @deprecated", "originalCommit": "79817fa2d4ea3063115b05f6719ae4abd8ec8e3f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fb367bcabe524128ddc717e36b19f06795da51c2", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/Plugin.java b/android/capacitor/src/main/java/com/getcapacitor/Plugin.java\nindex e62964ea..28307f6e 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/Plugin.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/Plugin.java\n\n@@ -522,10 +522,10 @@ public class Plugin {\n     }\n \n     /**\n-     * Handle request permissions result. A plugin can override this to handle the result\n-     * themselves, or this method will handle the result for our convenient requestPermissions\n-     * call.\n-     * @deprecated\n+     * Handle request permissions result. A plugin using the deprecated {@link NativePlugin}\n+     * should override this to handle the result, or this method will handle the result\n+     * for our convenient requestPermissions call.\n+     * @deprecated in favor of using {@link #onRequestPermissionsResult} in conjunction with {@link CapacitorPlugin}\n      *\n      * @param requestCode\n      * @param permissions\n"}}, {"oid": "fb367bcabe524128ddc717e36b19f06795da51c2", "url": "https://github.com/ionic-team/capacitor/commit/fb367bcabe524128ddc717e36b19f06795da51c2", "message": "moved hasPermissions to PerissionHelper, and added more context to permissions callback methods", "committedDate": "2020-10-30T17:53:54Z", "type": "commit"}]}