{"pr_number": 3788, "pr_title": "feat: automatically import Android plugins", "pr_createdAt": "2020-11-10T22:50:38Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3788", "timeline": [{"oid": "afb21adbc6218b2809de9eb14e482ff952c3080b", "url": "https://github.com/ionic-team/capacitor/commit/afb21adbc6218b2809de9eb14e482ff952c3080b", "message": "feat(cli): STUDIO_PATH environment variable", "committedDate": "2020-11-02T19:37:18Z", "type": "commit"}, {"oid": "e1e7f666f3e8ec21a5e4585f5ed345e24d52156c", "url": "https://github.com/ionic-team/capacitor/commit/e1e7f666f3e8ec21a5e4585f5ed345e24d52156c", "message": "check before opening", "committedDate": "2020-11-02T19:58:29Z", "type": "commit"}, {"oid": "cf26a4b246aa841637a10e6983fefc62fa20a61e", "url": "https://github.com/ionic-team/capacitor/commit/cf26a4b246aa841637a10e6983fefc62fa20a61e", "message": "use config for config file name", "committedDate": "2020-11-02T23:01:35Z", "type": "commit"}, {"oid": "c96aa186f666c197ec0bce5cf7612019c709b3b9", "url": "https://github.com/ionic-team/capacitor/commit/c96aa186f666c197ec0bce5cf7612019c709b3b9", "message": "split out extConfig stuff", "committedDate": "2020-11-02T23:21:23Z", "type": "commit"}, {"oid": "d54128741092c616b5eac450231d8ec994e9fd73", "url": "https://github.com/ionic-team/capacitor/commit/d54128741092c616b5eac450231d8ec994e9fd73", "message": "load js", "committedDate": "2020-11-02T23:44:39Z", "type": "commit"}, {"oid": "7d0e5c1bbc5c8d78a043998f96bce317244f5a40", "url": "https://github.com/ionic-team/capacitor/commit/7d0e5c1bbc5c8d78a043998f96bce317244f5a40", "message": "copy = write json from loaded config", "committedDate": "2020-11-02T23:56:19Z", "type": "commit"}, {"oid": "8a47e914b0bfcbaf8923fa6d00fcab260301f0a1", "url": "https://github.com/ionic-team/capacitor/commit/8a47e914b0bfcbaf8923fa6d00fcab260301f0a1", "message": "init for non-json", "committedDate": "2020-11-03T00:02:44Z", "type": "commit"}, {"oid": "5e9860588760cc59e17e5cfac5b958b4e2fa82a1", "url": "https://github.com/ionic-team/capacitor/commit/5e9860588760cc59e17e5cfac5b958b4e2fa82a1", "message": "Merge branch 'main' into dynamic-config", "committedDate": "2020-11-03T16:32:25Z", "type": "commit"}, {"oid": "76264f27f6be0eba8f9886a61c8354d30cace188", "url": "https://github.com/ionic-team/capacitor/commit/76264f27f6be0eba8f9886a61c8354d30cace188", "message": "revert the help output", "committedDate": "2020-11-03T16:35:54Z", "type": "commit"}, {"oid": "9462e6a7ae5b171dae7fa6473fcb36659efb83d8", "url": "https://github.com/ionic-team/capacitor/commit/9462e6a7ae5b171dae7fa6473fcb36659efb83d8", "message": "support TS files", "committedDate": "2020-11-03T20:22:27Z", "type": "commit"}, {"oid": "859c0effe837ee88bfc2c1e30add8f2c85a6e276", "url": "https://github.com/ionic-team/capacitor/commit/859c0effe837ee88bfc2c1e30add8f2c85a6e276", "message": "expose CapacitorConfig type", "committedDate": "2020-11-03T20:48:44Z", "type": "commit"}, {"oid": "c2eb9c376b80eb6949ffd15bc8abad874b8266a2", "url": "https://github.com/ionic-team/capacitor/commit/c2eb9c376b80eb6949ffd15bc8abad874b8266a2", "message": "internalize readonly", "committedDate": "2020-11-03T20:56:41Z", "type": "commit"}, {"oid": "7861b808e034f32068c4df03400f334786e8531f", "url": "https://github.com/ionic-team/capacitor/commit/7861b808e034f32068c4df03400f334786e8531f", "message": "document all the things", "committedDate": "2020-11-03T21:53:51Z", "type": "commit"}, {"oid": "4b3b2bddb1affaff7228d250b69fcb3adb20bdeb", "url": "https://github.com/ionic-team/capacitor/commit/4b3b2bddb1affaff7228d250b69fcb3adb20bdeb", "message": "undo core change", "committedDate": "2020-11-03T21:57:32Z", "type": "commit"}, {"oid": "e6450aa50ea25422dfab1399b7ab760577d1e984", "url": "https://github.com/ionic-team/capacitor/commit/e6450aa50ea25422dfab1399b7ab760577d1e984", "message": "add definitions for plugin config values", "committedDate": "2020-11-04T23:06:43Z", "type": "commit"}, {"oid": "de6e9e18fea268012e223f5331c6d66abca8743e", "url": "https://github.com/ionic-team/capacitor/commit/de6e9e18fea268012e223f5331c6d66abca8743e", "message": "locate plugins by allowlist", "committedDate": "2020-11-04T23:25:06Z", "type": "commit"}, {"oid": "3e8db7852dac2584ecc06e0f1ae56c7932f84522", "url": "https://github.com/ionic-team/capacitor/commit/3e8db7852dac2584ecc06e0f1ae56c7932f84522", "message": "add warning for deprecated usage", "committedDate": "2020-11-06T20:27:47Z", "type": "commit"}, {"oid": "c2075bd1cff55b92b4ad35bad50239cd4ec2f52a", "url": "https://github.com/ionic-team/capacitor/commit/c2075bd1cff55b92b4ad35bad50239cd4ec2f52a", "message": "Merge branch 'main' into plugin-locator", "committedDate": "2020-11-09T21:13:04Z", "type": "commit"}, {"oid": "a56d83dc6ecc6512f8f653b60421e41953855efd", "url": "https://github.com/ionic-team/capacitor/commit/a56d83dc6ecc6512f8f653b60421e41953855efd", "message": "Merge branch 'main' into plugin-locator", "committedDate": "2020-11-10T20:47:28Z", "type": "commit"}, {"oid": "7a83d03492cfe39d17184356ce5d28a7a3d7ee2c", "url": "https://github.com/ionic-team/capacitor/commit/7a83d03492cfe39d17184356ce5d28a7a3d7ee2c", "message": "write capacitor.plugins.json", "committedDate": "2020-11-10T22:01:03Z", "type": "commit"}, {"oid": "9944b81141da618ef83b3ad926088dc73d3a6839", "url": "https://github.com/ionic-team/capacitor/commit/9944b81141da618ef83b3ad926088dc73d3a6839", "message": "load from json", "committedDate": "2020-11-10T22:42:37Z", "type": "commit"}, {"oid": "dd74cdbfeb42e142101bfec21023495196e59b29", "url": "https://github.com/ionic-team/capacitor/commit/dd74cdbfeb42e142101bfec21023495196e59b29", "message": "Merge branch 'main' into auto-android", "committedDate": "2020-11-25T20:42:11Z", "type": "commit"}, {"oid": "917a739f7c5cc8dea26b6c9b8439d514d0ce9bfe", "url": "https://github.com/ionic-team/capacitor/commit/917a739f7c5cc8dea26b6c9b8439d514d0ce9bfe", "message": "Merge branch 'main' into auto-android", "committedDate": "2020-11-25T21:04:27Z", "type": "commit"}, {"oid": "d0ac650089b98bc14e10c42d6632a888ebed120e", "url": "https://github.com/ionic-team/capacitor/commit/d0ac650089b98bc14e10c42d6632a888ebed120e", "message": "no need to override onCreate", "committedDate": "2020-11-25T21:05:18Z", "type": "commit"}, {"oid": "27942d68417a8d43234586e0459fec705f2f86d3", "url": "https://github.com/ionic-team/capacitor/commit/27942d68417a8d43234586e0459fec705f2f86d3", "message": "remove declarations", "committedDate": "2020-11-25T21:05:29Z", "type": "commit"}, {"oid": "633f5a7025b2686a0cd327c08e19dc5dde973e7b", "url": "https://github.com/ionic-team/capacitor/commit/633f5a7025b2686a0cd327c08e19dc5dde973e7b", "message": "refactor(android): consolidate bridge construction", "committedDate": "2020-11-25T22:57:25Z", "type": "commit"}, {"oid": "9f5068bd65cebfe3e12394055540976bc4abad6a", "url": "https://github.com/ionic-team/capacitor/commit/9f5068bd65cebfe3e12394055540976bc4abad6a", "message": "bridge activity changes", "committedDate": "2020-11-29T20:38:27Z", "type": "commit"}, {"oid": "6e94cbba17224975ca7d2e691f7ffe1cd3091dd9", "url": "https://github.com/ionic-team/capacitor/commit/6e94cbba17224975ca7d2e691f7ffe1cd3091dd9", "message": "Merge branch 'main' into auto-android", "committedDate": "2020-11-29T20:43:37Z", "type": "commit"}, {"oid": "9ee879441452807aed56d5741bfb796873047ed2", "url": "https://github.com/ionic-team/capacitor/commit/9ee879441452807aed56d5741bfb796873047ed2", "message": "add plugins shortcut", "committedDate": "2020-11-29T20:53:25Z", "type": "commit"}, {"oid": "b0e2e4ffcf8723ede18d51e92a96dd6aa749ef71", "url": "https://github.com/ionic-team/capacitor/commit/b0e2e4ffcf8723ede18d51e92a96dd6aa749ef71", "message": "take out init deprecations", "committedDate": "2020-11-29T20:58:47Z", "type": "commit"}, {"oid": "c805e409e4404621c5eac51be2351552aff29220", "url": "https://github.com/ionic-team/capacitor/commit/c805e409e4404621c5eac51be2351552aff29220", "message": "revert viz change", "committedDate": "2020-11-29T21:00:27Z", "type": "commit"}, {"oid": "e05bfd92752ce860bc9f4684ed27c9e1ec31ce30", "url": "https://github.com/ionic-team/capacitor/commit/e05bfd92752ce860bc9f4684ed27c9e1ec31ce30", "message": "fix call", "committedDate": "2020-11-29T21:01:14Z", "type": "commit"}, {"oid": "abdc85af8c18a70fd48153725bb5658605da719f", "url": "https://github.com/ionic-team/capacitor/commit/abdc85af8c18a70fd48153725bb5658605da719f", "message": "Merge branch 'main' into refactor-bridge", "committedDate": "2020-11-29T21:02:14Z", "type": "commit"}, {"oid": "6c7c0c336be3ca969aab8708d9166f5743feddf6", "url": "https://github.com/ionic-team/capacitor/commit/6c7c0c336be3ca969aab8708d9166f5743feddf6", "message": "Merge branch 'refactor-bridge' into auto-android\n\nConflicts:\n\tandroid/capacitor/src/main/java/com/getcapacitor/BridgeActivity.java", "committedDate": "2020-11-29T21:05:05Z", "type": "commit"}, {"oid": "979fbe59290398e99c4b6bd1419ac9c5997cd1f8", "url": "https://github.com/ionic-team/capacitor/commit/979fbe59290398e99c4b6bd1419ac9c5997cd1f8", "message": "deprecate and load automatically", "committedDate": "2020-11-29T21:10:52Z", "type": "commit"}, {"oid": "25d7726730b308bc1406407f4987c3f6bc39e5d7", "url": "https://github.com/ionic-team/capacitor/commit/25d7726730b308bc1406407f4987c3f6bc39e5d7", "message": "make it work with NativePlugin annotation", "committedDate": "2020-11-30T22:45:11Z", "type": "commit"}, {"oid": "fcd18a000e56c620d52b9645195615e26f2da16b", "url": "https://github.com/ionic-team/capacitor/commit/fcd18a000e56c620d52b9645195615e26f2da16b", "message": "plugin manager, error handling", "committedDate": "2020-11-30T23:04:48Z", "type": "commit"}, {"oid": "77807c96e7b6ed2f9daafe5997f757a4485696e0", "url": "https://github.com/ionic-team/capacitor/commit/77807c96e7b6ed2f9daafe5997f757a4485696e0", "message": "integrate Builder", "committedDate": "2020-11-30T23:29:02Z", "type": "commit"}, {"oid": "4177c4236f9964967072cff65b360521105b585e", "url": "https://github.com/ionic-team/capacitor/commit/4177c4236f9964967072cff65b360521105b585e", "message": "Merge branch 'main' into refactor-bridge", "committedDate": "2020-11-30T23:32:15Z", "type": "commit"}, {"oid": "ae0003586f9591ec77f2947a13ecc9e01f9c26b2", "url": "https://github.com/ionic-team/capacitor/commit/ae0003586f9591ec77f2947a13ecc9e01f9c26b2", "message": "Merge branch 'refactor-bridge' into auto-android", "committedDate": "2020-11-30T23:32:46Z", "type": "commit"}, {"oid": "b17fa0a262332756fb5ed692c9162b7555f3739d", "url": "https://github.com/ionic-team/capacitor/commit/b17fa0a262332756fb5ed692c9162b7555f3739d", "message": "build() -> create()", "committedDate": "2020-11-30T23:35:22Z", "type": "commit"}, {"oid": "1d6d4b70415ca68bfa7cba4831ec795978aa21cf", "url": "https://github.com/ionic-team/capacitor/commit/1d6d4b70415ca68bfa7cba4831ec795978aa21cf", "message": "Merge branch 'refactor-bridge' into auto-android", "committedDate": "2020-12-01T00:09:11Z", "type": "commit"}, {"oid": "1eb89dd7f009bc1ae678962bfb31c7b4235253f8", "url": "https://github.com/ionic-team/capacitor/commit/1eb89dd7f009bc1ae678962bfb31c7b4235253f8", "message": "Merge branch 'main' into auto-android", "committedDate": "2020-12-01T00:10:32Z", "type": "commit"}, {"oid": "9407e064a10113a45a177d402b7b4fcf641fe2e3", "url": "https://github.com/ionic-team/capacitor/commit/9407e064a10113a45a177d402b7b4fcf641fe2e3", "message": "add deprecation messages", "committedDate": "2020-12-01T00:19:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MTI5OQ==", "url": "https://github.com/ionic-team/capacitor/pull/3788#discussion_r532991299", "bodyText": ":)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    try (BufferedReader br = new BufferedReader(new InputStreamReader(assetManager.open(\"capacitor.plugins.json\")))) {\n          \n          \n            \n                        StringBuilder b = new StringBuilder();\n          \n          \n            \n                        String line;\n          \n          \n            \n                        while ((line = br.readLine()) != null) {\n          \n          \n            \n                            b.append(line);\n          \n          \n            \n                        }\n          \n          \n            \n                        String jsonString = b.toString();\n          \n          \n            \n                    try (BufferedReader reader = new BufferedReader(new InputStreamReader(assetManager.open(\"capacitor.plugins.json\")))) {\n          \n          \n            \n                        StringBuilder builder = new StringBuilder();\n          \n          \n            \n                        String line;\n          \n          \n            \n                        while ((line = reader.readLine()) != null) {\n          \n          \n            \n                            builder.append(line);\n          \n          \n            \n                        }\n          \n          \n            \n                        String jsonString = builder.toString();", "author": "carlpoole", "createdAt": "2020-12-01T00:24:08Z", "path": "android/capacitor/src/main/java/com/getcapacitor/PluginManager.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package com.getcapacitor;\n+\n+import android.content.res.AssetManager;\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.json.JSONArray;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+public class PluginManager {\n+\n+    private final AssetManager assetManager;\n+\n+    public PluginManager(AssetManager assetManager) {\n+        this.assetManager = assetManager;\n+    }\n+\n+    public List<Class<? extends Plugin>> loadPluginClasses() throws PluginLoadException {\n+        JSONArray pluginsJSON = parsePluginsJSON();\n+        ArrayList<Class<? extends Plugin>> pluginList = new ArrayList<>();\n+\n+        try {\n+            for (int i = 0, size = pluginsJSON.length(); i < size; i++) {\n+                JSONObject pluginJSON = pluginsJSON.getJSONObject(i);\n+                String classPath = pluginJSON.getString(\"classpath\");\n+                Class<?> c = Class.forName(classPath);\n+                pluginList.add(c.asSubclass(Plugin.class));\n+            }\n+        } catch (JSONException e) {\n+            throw new PluginLoadException(\"Could not parse capacitor.plugins.json as JSON\");\n+        } catch (ClassNotFoundException e) {\n+            throw new PluginLoadException(\"Could not find class by class path: \" + e.getMessage());\n+        }\n+\n+        return pluginList;\n+    }\n+\n+    private JSONArray parsePluginsJSON() throws PluginLoadException {\n+        try (BufferedReader br = new BufferedReader(new InputStreamReader(assetManager.open(\"capacitor.plugins.json\")))) {\n+            StringBuilder b = new StringBuilder();\n+            String line;\n+            while ((line = br.readLine()) != null) {\n+                b.append(line);\n+            }\n+            String jsonString = b.toString();", "originalCommit": "9407e064a10113a45a177d402b7b4fcf641fe2e3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "20700551e28a276d3597accf4ec18314450f8966", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/PluginManager.java b/android/capacitor/src/main/java/com/getcapacitor/PluginManager.java\nindex 7b707f50..540bc912 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/PluginManager.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/PluginManager.java\n\n@@ -39,13 +39,13 @@ public class PluginManager {\n     }\n \n     private JSONArray parsePluginsJSON() throws PluginLoadException {\n-        try (BufferedReader br = new BufferedReader(new InputStreamReader(assetManager.open(\"capacitor.plugins.json\")))) {\n-            StringBuilder b = new StringBuilder();\n+        try (BufferedReader reader = new BufferedReader(new InputStreamReader(assetManager.open(\"capacitor.plugins.json\")))) {\n+            StringBuilder builder = new StringBuilder();\n             String line;\n-            while ((line = br.readLine()) != null) {\n-                b.append(line);\n+            while ((line = reader.readLine()) != null) {\n+                builder.append(line);\n             }\n-            String jsonString = b.toString();\n+            String jsonString = builder.toString();\n             return new JSONArray(jsonString);\n         } catch (IOException e) {\n             throw new PluginLoadException(\"Could not load capacitor.plugins.json\");\n"}}, {"oid": "20700551e28a276d3597accf4ec18314450f8966", "url": "https://github.com/ionic-team/capacitor/commit/20700551e28a276d3597accf4ec18314450f8966", "message": "Update android/capacitor/src/main/java/com/getcapacitor/PluginManager.java\n\nCo-authored-by: Carl Poole <mail@carlpoole.com>", "committedDate": "2020-12-01T00:31:46Z", "type": "commit"}, {"oid": "d06e23ff26754a1c538807f9dc0552155ee421b0", "url": "https://github.com/ionic-team/capacitor/commit/d06e23ff26754a1c538807f9dc0552155ee421b0", "message": "add registerPlugin/registerPlugins helpers", "committedDate": "2020-12-01T01:42:53Z", "type": "commit"}, {"oid": "c6164e0d3ea040b853417d83faa047454219c4d7", "url": "https://github.com/ionic-team/capacitor/commit/c6164e0d3ea040b853417d83faa047454219c4d7", "message": "Merge branch 'main' into auto-android", "committedDate": "2020-12-01T17:34:36Z", "type": "commit"}, {"oid": "35d1bd8199247d39b74b3ec3b38f398ab04dd96b", "url": "https://github.com/ionic-team/capacitor/commit/35d1bd8199247d39b74b3ec3b38f398ab04dd96b", "message": "Merge branch 'main' into auto-android", "committedDate": "2020-12-01T23:23:06Z", "type": "commit"}]}