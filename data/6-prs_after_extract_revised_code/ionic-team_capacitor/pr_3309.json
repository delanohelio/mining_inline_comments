{"pr_number": 3309, "pr_title": "add preserveAspectRatio to CameraOptions while resizing an image", "pr_createdAt": "2020-07-21T11:39:26Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3309", "timeline": [{"oid": "8ed9ddd0bf924f491fdec66c09a274073b9c02d5", "url": "https://github.com/ionic-team/capacitor/commit/8ed9ddd0bf924f491fdec66c09a274073b9c02d5", "message": "Merge remote-tracking branch 'upstream/2.x' into 2.x", "committedDate": "2020-07-21T09:25:00Z", "type": "commit"}, {"oid": "41c5c5d7b487738f25af6b28d0a32d46dbec9af7", "url": "https://github.com/ionic-team/capacitor/commit/41c5c5d7b487738f25af6b28d0a32d46dbec9af7", "message": "add preserveAspectRatio to CameraOptions to preserve aspect ratio of image", "committedDate": "2020-07-21T10:12:00Z", "type": "commit"}, {"oid": "79863659188fcd59bd219a004f37e2226abf0bcb", "url": "https://github.com/ionic-team/capacitor/commit/79863659188fcd59bd219a004f37e2226abf0bcb", "message": "prevent app crash while saving to gallery on android", "committedDate": "2020-07-21T10:12:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTY4Mw==", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r458299683", "bodyText": "Will this be a breaking change? You've added a new parameter to this public method in the Android platform. Will calls such as ImageUtils.resize(bitmap, 100, 100) continue to work?\nYou can mitigate this by adding the following method:\n  public static Bitmap resize(Bitmap bitmap, final int width, final int height) {\n    resize(bitmap, width, height, false);\n  }", "author": "imhoffd", "createdAt": "2020-07-21T18:21:28Z", "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/camera/ImageUtils.java", "diffHunk": "@@ -17,6 +17,21 @@\n \n public class ImageUtils {\n \n+  /**\n+   * Resize an image to the given width and height considering the preserveAspectRatio flag.\n+   * @param bitmap\n+   * @param width\n+   * @param height\n+   * @param preserveAspectRatio\n+   * @return a new, scaled Bitmap\n+   */\n+  public static Bitmap resize(Bitmap bitmap, final int width, final int height, final boolean preserveAspectRatio) {", "originalCommit": "79863659188fcd59bd219a004f37e2226abf0bcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MDEzNA==", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r458580134", "bodyText": "Actually I think it's not. There's only one call of this static method and it's here. But I've added an overload anyway. \ud83d\udc4d\ud83c\udffd", "author": "iphilgood", "createdAt": "2020-07-22T07:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTY4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "beec0bc78c73a08acf092001ea4d34bb49213505", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/plugin/camera/ImageUtils.java b/android/capacitor/src/main/java/com/getcapacitor/plugin/camera/ImageUtils.java\nindex 48f83df8..f2ad0c6e 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/plugin/camera/ImageUtils.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/plugin/camera/ImageUtils.java\n\n@@ -17,6 +17,17 @@ import java.io.InputStream;\n \n public class ImageUtils {\n \n+  /**\n+   * Resize an image to the given width and height.\n+   * @param bitmap\n+   * @param width\n+   * @param height\n+   * @return a new, scaled Bitmap\n+   */\n+  public static Bitmap resize(Bitmap bitmap, final int width, final int height) {\n+    ImageUtils.resize(bitmap, width, height, false)\n+  }\n+\n   /**\n    * Resize an image to the given width and height considering the preserveAspectRatio flag.\n    * @param bitmap\n"}}, {"oid": "beec0bc78c73a08acf092001ea4d34bb49213505", "url": "https://github.com/ionic-team/capacitor/commit/beec0bc78c73a08acf092001ea4d34bb49213505", "message": "re-add resize method without preserveAspectRatio flag", "committedDate": "2020-07-22T07:03:49Z", "type": "commit"}, {"oid": "2138fc590b09370c38c6d2ad0981d421b20406aa", "url": "https://github.com/ionic-team/capacitor/commit/2138fc590b09370c38c6d2ad0981d421b20406aa", "message": "update doc of preserveAspectRatio flag in CameraOptions", "committedDate": "2020-07-22T07:04:41Z", "type": "commit"}, {"oid": "d9025dd394426566ce822a030bd980895aee9df4", "url": "https://github.com/ionic-team/capacitor/commit/d9025dd394426566ce822a030bd980895aee9df4", "message": "add missing return statement :grin:", "committedDate": "2020-07-22T07:07:49Z", "type": "commit"}, {"oid": "ec45c8ee33ca30cf1d21e104645bfc41ad97573d", "url": "https://github.com/ionic-team/capacitor/commit/ec45c8ee33ca30cf1d21e104645bfc41ad97573d", "message": "add missing semicolon", "committedDate": "2020-07-22T07:14:05Z", "type": "commit"}, {"oid": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3", "url": "https://github.com/ionic-team/capacitor/commit/9bd7192d91f59ca19d26de5af09aff3945ad1aa3", "message": "add camera button to test preserved aspect ratio", "committedDate": "2020-07-22T08:01:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NTEzNA==", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r459595134", "bodyText": "This is not related to the aspect ratio PR, please, keep separate fixes in separate PRs so they can be evaluated independently and the git history have proper information about this change.\nAlso, instead of using UUID, you can get the image name from the path, it should be unique too since is generated from the timeStamp of when the picture was taken", "author": "jcesarmobile", "createdAt": "2020-07-23T16:59:52Z", "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/Camera.java", "diffHunk": "@@ -341,7 +343,12 @@ private void returnResult(PluginCall call, Bitmap bitmap, Uri u) {\n     if (saveToGallery && (imageEditedFileSavePath != null || imageFileSavePath != null)) {\n       try {\n         String fileToSave = imageEditedFileSavePath != null ? imageEditedFileSavePath : imageFileSavePath;\n-        MediaStore.Images.Media.insertImage(getActivity().getContentResolver(), fileToSave, \"\", \"\");\n+        MediaStore.Images.Media.insertImage(\n+            getActivity().getContentResolver(),\n+            fileToSave,\n+            \"IMG_\" + UUID.randomUUID().toString(),\n+            \"\"\n+        );", "originalCommit": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxNDA0MA==", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r459614040", "bodyText": "I noticed on iOS it prompted for a permission to save to my albums when I clicked on the new button. Can we make sure this also isn't happening on iOS?\nnevermind!", "author": "imhoffd", "createdAt": "2020-07-23T17:32:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NTEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5NDY2NQ==", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r459994665", "bodyText": "@jcesarmobile you're right. I'm going to create a separate PR for this fix.", "author": "iphilgood", "createdAt": "2020-07-24T11:22:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NTEzNA=="}], "type": "inlineReview", "revised_code": {"commit": "dd850719c2269dc41c928c769cbbedf3d9e0a9b7", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/plugin/Camera.java b/android/capacitor/src/main/java/com/getcapacitor/plugin/Camera.java\nindex 0f9e7fb8..30a495ab 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/plugin/Camera.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/plugin/Camera.java\n\n@@ -343,12 +343,7 @@ public class Camera extends Plugin {\n     if (saveToGallery && (imageEditedFileSavePath != null || imageFileSavePath != null)) {\n       try {\n         String fileToSave = imageEditedFileSavePath != null ? imageEditedFileSavePath : imageFileSavePath;\n-        MediaStore.Images.Media.insertImage(\n-            getActivity().getContentResolver(),\n-            fileToSave,\n-            \"IMG_\" + UUID.randomUUID().toString(),\n-            \"\"\n-        );\n+        MediaStore.Images.Media.insertImage(getActivity().getContentResolver(), fileToSave, \"\", \"\");\n       } catch (FileNotFoundException e) {\n         Logger.error(getLogTag(), IMAGE_GALLERY_SAVE_ERROR, e);\n       }\n"}}, {"oid": "dd850719c2269dc41c928c769cbbedf3d9e0a9b7", "url": "https://github.com/ionic-team/capacitor/commit/dd850719c2269dc41c928c769cbbedf3d9e0a9b7", "message": "restore save to gallery handling on android\n\nit has nothing to do with aspect ratio", "committedDate": "2020-07-24T14:56:01Z", "type": "commit"}, {"oid": "6db358b716d33e495d33c70c705ee16163a7d3b1", "url": "https://github.com/ionic-team/capacitor/commit/6db358b716d33e495d33c70c705ee16163a7d3b1", "message": "Merge remote-tracking branch 'upstream/2.x' into preserve-aspect-ratio-2.x", "committedDate": "2020-07-24T14:57:21Z", "type": "commit"}, {"oid": "02a4ea9bc8e78cfd883c342ca5d11e07ab99a7e6", "url": "https://github.com/ionic-team/capacitor/commit/02a4ea9bc8e78cfd883c342ca5d11e07ab99a7e6", "message": "remove unused UUID import", "committedDate": "2020-07-24T15:05:38Z", "type": "commit"}, {"oid": "4869ef8b9e7a8f67ccfa8350ff3e00e8facf10fc", "url": "https://github.com/ionic-team/capacitor/commit/4869ef8b9e7a8f67ccfa8350ff3e00e8facf10fc", "message": "update the definition of preserveAspectRatio in CameraOptions", "committedDate": "2020-07-24T17:39:23Z", "type": "commit"}, {"oid": "8f89c07deb1804cdf8771cd4c4e07a401068d5af", "url": "https://github.com/ionic-team/capacitor/commit/8f89c07deb1804cdf8771cd4c4e07a401068d5af", "message": "fix typo", "committedDate": "2020-07-24T17:45:00Z", "type": "commit"}]}