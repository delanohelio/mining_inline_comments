{"pr_number": 3967, "pr_title": "refactor(android): represent permission states using enum", "pr_createdAt": "2020-12-18T16:49:44Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3967", "timeline": [{"oid": "494dbaa1b172ebcfad1e0f337e772f85533a20b0", "url": "https://github.com/ionic-team/capacitor/commit/494dbaa1b172ebcfad1e0f337e772f85533a20b0", "message": "removing requestCode, permissions, grantResults from onRequestPermissionsResult and providing states", "committedDate": "2020-12-17T20:19:28Z", "type": "commit"}, {"oid": "8fb263422d9e014d52c06dc16eaf5b17a945e4c9", "url": "https://github.com/ionic-team/capacitor/commit/8fb263422d9e014d52c06dc16eaf5b17a945e4c9", "message": "saving work so far", "committedDate": "2020-12-17T22:39:48Z", "type": "commit"}, {"oid": "d2b78912c96a9a1526d77a6ff81ef68e0c147713", "url": "https://github.com/ionic-team/capacitor/commit/d2b78912c96a9a1526d77a6ff81ef68e0c147713", "message": "Replace internal use of JSObject with Map", "committedDate": "2020-12-17T23:00:49Z", "type": "commit"}, {"oid": "da44f4453eb43d28870603630b7fe9db1b2e4566", "url": "https://github.com/ionic-team/capacitor/commit/da44f4453eb43d28870603630b7fe9db1b2e4566", "message": "Merge branch 'perm-states-type' into perm-result", "committedDate": "2020-12-17T23:12:14Z", "type": "commit"}, {"oid": "17d6ed5e74d26f9d19d67ac938822a9ba2d448da", "url": "https://github.com/ionic-team/capacitor/commit/17d6ed5e74d26f9d19d67ac938822a9ba2d448da", "message": "new PermissionState enum to represent the permission states possible", "committedDate": "2020-12-17T23:46:18Z", "type": "commit"}, {"oid": "2af06a2add0537f8615240fb05eb1fc78eb9f950", "url": "https://github.com/ionic-team/capacitor/commit/2af06a2add0537f8615240fb05eb1fc78eb9f950", "message": "Merge branch 'perm-states-type' into perm-result", "committedDate": "2020-12-17T23:47:03Z", "type": "commit"}, {"oid": "0d4886efb34918d98cabcd8d575b6566fbec5806", "url": "https://github.com/ionic-team/capacitor/commit/0d4886efb34918d98cabcd8d575b6566fbec5806", "message": "remove JSObject update", "committedDate": "2020-12-18T16:10:21Z", "type": "commit"}, {"oid": "3789cf0c040a4a77d38664dd016402cfd01a7c99", "url": "https://github.com/ionic-team/capacitor/commit/3789cf0c040a4a77d38664dd016402cfd01a7c99", "message": "doc and removed unused import", "committedDate": "2020-12-18T16:45:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExODQwMg==", "url": "https://github.com/ionic-team/capacitor/pull/3967#discussion_r546118402", "bodyText": "We should probably rephrase this to talk about the \"alias\"", "author": "imhoffd", "createdAt": "2020-12-18T22:21:41Z", "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -364,9 +363,9 @@ public void pluginRequestPermission(String permission, int requestCode) {\n      * Helper to check all permissions defined on a plugin and see the state of each.\n      *\n      * @since 3.0.0\n-     * @return an object containing the permission names and the permission result\n+     * @return an map containing the permission names and the permission state", "originalCommit": "3789cf0c040a4a77d38664dd016402cfd01a7c99", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3aafb44c51feecb7c450922a27d00247cb01a43b", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/Plugin.java b/android/capacitor/src/main/java/com/getcapacitor/Plugin.java\nindex 0bc598d5..cc4578ac 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/Plugin.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/Plugin.java\n\n@@ -363,7 +363,7 @@ public class Plugin {\n      * Helper to check all permissions defined on a plugin and see the state of each.\n      *\n      * @since 3.0.0\n-     * @return an map containing the permission names and the permission state\n+     * @return A mapping of permission aliases to the associated granted status.\n      */\n     public Map<String, PermissionState> getPermissionStates() {\n         return bridge.getPermissionStates(this);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExOTA3MQ==", "url": "https://github.com/ionic-team/capacitor/pull/3967#discussion_r546119071", "bodyText": "Do we want to call the plugin instance version?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, getPermissionStates(plugin.getInstance()));\n          \n          \n            \n                                    plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, plugin.getInstance().getPermissionStates());", "author": "imhoffd", "createdAt": "2020-12-18T22:23:26Z", "path": "android/capacitor/src/main/java/com/getcapacitor/Bridge.java", "diffHunk": "@@ -786,10 +787,10 @@ public void onRequestPermissionsResult(int requestCode, String[] permissions, in\n                 if (validatePermissions(plugin.getInstance(), savedPermissionCall, permissions, grantResults)) {\n                     // handle request permissions call\n                     if (savedPermissionCall.getMethodName().equals(\"requestPermissions\")) {\n-                        savedPermissionCall.resolve(plugin.getInstance().getPermissionStates());\n+                        plugin.getInstance().checkPermissions(savedPermissionCall);\n                     } else {\n                         // handle permission requests by other methods on the plugin\n-                        plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, requestCode, permissions, grantResults);\n+                        plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, getPermissionStates(plugin.getInstance()));", "originalCommit": "3789cf0c040a4a77d38664dd016402cfd01a7c99", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d1e0f3b5d97e6ca0c5eaad4b3e13c6844536aa1a", "chunk": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/Bridge.java b/android/capacitor/src/main/java/com/getcapacitor/Bridge.java\nindex 7dd5f784..14358091 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/Bridge.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/Bridge.java\n\n@@ -790,7 +790,7 @@ public class Bridge {\n                         plugin.getInstance().checkPermissions(savedPermissionCall);\n                     } else {\n                         // handle permission requests by other methods on the plugin\n-                        plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, getPermissionStates(plugin.getInstance()));\n+                        plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, plugin.getInstance().getPermissionStates());\n \n                         if (!savedPermissionCall.isReleased() && !savedPermissionCall.isSaved()) {\n                             savedPermissionCall.release(this);\n"}}, {"oid": "d1e0f3b5d97e6ca0c5eaad4b3e13c6844536aa1a", "url": "https://github.com/ionic-team/capacitor/commit/d1e0f3b5d97e6ca0c5eaad4b3e13c6844536aa1a", "message": "call plugin getPermissionStates\n\nCo-authored-by: Dan Imhoff <dwieeb@gmail.com>", "committedDate": "2020-12-18T22:39:35Z", "type": "commit"}, {"oid": "3aafb44c51feecb7c450922a27d00247cb01a43b", "url": "https://github.com/ionic-team/capacitor/commit/3aafb44c51feecb7c450922a27d00247cb01a43b", "message": "clarified javadoc", "committedDate": "2020-12-18T22:45:15Z", "type": "commit"}]}