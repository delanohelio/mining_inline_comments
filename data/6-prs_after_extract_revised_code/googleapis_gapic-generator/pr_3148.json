{"pr_number": 3148, "pr_title": "bazel: go build gen check for cloud in pkg name", "pr_createdAt": "2020-03-25T17:14:54Z", "pr_url": "https://github.com/googleapis/gapic-generator/pull/3148", "timeline": [{"oid": "18442bfed2475eb0c78aac3a7a542b6fffe6c9f1", "url": "https://github.com/googleapis/gapic-generator/commit/18442bfed2475eb0c78aac3a7a542b6fffe6c9f1", "message": "bazel: go build gen check for cloud in pkg name", "committedDate": "2020-03-25T17:12:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA0MDQ4Nw==", "url": "https://github.com/googleapis/gapic-generator/pull/3148#discussion_r398040487", "bodyText": "This looks weird. isCloud should define if it is a cloud or no. Here it does it partially, and it can be overriden by protoPkg value (which also an argument to this function).\nPlease make sure that isCloud completely defines the cloud thing. (i.e. it an be as straightforward as moving protoPkg.contains(\"cloud\") from here to the place where assembleGoImportPath is called.", "author": "vam-google", "createdAt": "2020-03-25T17:31:57Z", "path": "rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java", "diffHunk": "@@ -94,7 +94,7 @@ private String assembleGoImportPath(boolean isCloud, String protoPkg, String goP\n     goPkg = goPkg.replaceFirst(\"cloud\\\\/\", \"\");\n \n     String goImport = \"\";\n-    if (isCloud) {\n+    if (isCloud || protoPkg.contains(\"cloud\")) {", "originalCommit": "18442bfed2475eb0c78aac3a7a542b6fffe6c9f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA0MzgyOA==", "url": "https://github.com/googleapis/gapic-generator/pull/3148#discussion_r398043828", "bodyText": "Ah, good call. I did just that! Done.", "author": "noahdietz", "createdAt": "2020-03-25T17:36:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA0MDQ4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "a092ec0727fa437f5382d53c087ed634a628706f", "chunk": "diff --git a/rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java b/rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java\nindex 47b0ced1c..f4b4ce232 100644\n--- a/rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java\n+++ b/rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java\n\n@@ -94,7 +94,7 @@ class BazelBuildFileView {\n     goPkg = goPkg.replaceFirst(\"cloud\\\\/\", \"\");\n \n     String goImport = \"\";\n-    if (isCloud || protoPkg.contains(\"cloud\")) {\n+    if (isCloud) {\n       goImport = \"cloud.google.com/go/\";\n       goPkg = goPkg.replaceFirst(\"v(.+);\", \"apiv$1;\");\n     } else {\n"}}, {"oid": "a092ec0727fa437f5382d53c087ed634a628706f", "url": "https://github.com/googleapis/gapic-generator/commit/a092ec0727fa437f5382d53c087ed634a628706f", "message": "refactor cloud check", "committedDate": "2020-03-25T17:35:09Z", "type": "commit"}, {"oid": "a047c788ef9bcf85703bad1f118eff0853817344", "url": "https://github.com/googleapis/gapic-generator/commit/a047c788ef9bcf85703bad1f118eff0853817344", "message": "fix protoPkg check", "committedDate": "2020-03-25T17:36:42Z", "type": "commit"}]}