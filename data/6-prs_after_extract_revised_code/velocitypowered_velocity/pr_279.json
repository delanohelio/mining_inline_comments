{"pr_number": 279, "pr_title": "Remove tasks from lookup map upon completion", "pr_createdAt": "2020-03-13T17:17:43Z", "pr_url": "https://github.com/VelocityPowered/Velocity/pull/279", "timeline": [{"oid": "6ec6beedbdd290d094fd6e011e1d20429947121b", "url": "https://github.com/VelocityPowered/Velocity/commit/6ec6beedbdd290d094fd6e011e1d20429947121b", "message": "Remove tasks from lookup map upon completion", "committedDate": "2020-03-13T17:17:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM3MTM0Ng==", "url": "https://github.com/VelocityPowered/Velocity/pull/279#discussion_r392371346", "bodyText": "i think you should call onFinish() only if task is not repeatable", "author": "Leymooo", "createdAt": "2020-03-13T17:29:57Z", "path": "proxy/src/main/java/com/velocitypowered/proxy/scheduler/VelocityScheduler.java", "diffHunk": "@@ -187,6 +187,7 @@ public void run() {\n         } catch (Exception e) {\n           Log.logger.error(\"Exception in task {} by plugin {}\", runnable, plugin, e);\n         } finally {\n+          onFinish();", "originalCommit": "6ec6beedbdd290d094fd6e011e1d20429947121b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM4MzE4Mg==", "url": "https://github.com/VelocityPowered/Velocity/pull/279#discussion_r392383182", "bodyText": "You're absolute right, I missed it :)", "author": "hugmanrique", "createdAt": "2020-03-13T17:52:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM3MTM0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "d7224229473819617b555d22a8da1783ed335fe7", "chunk": "diff --git a/proxy/src/main/java/com/velocitypowered/proxy/scheduler/VelocityScheduler.java b/proxy/src/main/java/com/velocitypowered/proxy/scheduler/VelocityScheduler.java\nindex f0605f0b..1bec0d11 100644\n--- a/proxy/src/main/java/com/velocitypowered/proxy/scheduler/VelocityScheduler.java\n+++ b/proxy/src/main/java/com/velocitypowered/proxy/scheduler/VelocityScheduler.java\n\n@@ -187,7 +186,9 @@ public class VelocityScheduler implements Scheduler {\n         } catch (Exception e) {\n           Log.logger.error(\"Exception in task {} by plugin {}\", runnable, plugin, e);\n         } finally {\n-          onFinish();\n+          if (repeat == 0) {\n+            onFinish();\n+          }\n           currentTaskThread = null;\n         }\n       });\n"}}, {"oid": "d7224229473819617b555d22a8da1783ed335fe7", "url": "https://github.com/VelocityPowered/Velocity/commit/d7224229473819617b555d22a8da1783ed335fe7", "message": "Only finish non-repeating tasks", "committedDate": "2020-03-13T17:52:15Z", "type": "commit"}]}