{"pr_number": 1517, "pr_title": "Fixed #1516", "pr_createdAt": "2020-02-12T06:10:51Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/1517", "timeline": [{"oid": "b87354a39e5f97984fb0cd2d549c59dcffc8edf6", "url": "https://github.com/Slimefun/Slimefun4/commit/b87354a39e5f97984fb0cd2d549c59dcffc8edf6", "message": "Fixed #1516", "committedDate": "2020-02-12T06:07:42Z", "type": "commit"}, {"oid": "c899413f7f8a9f7ad9ed6c4766fa86b79c1ade9b", "url": "https://github.com/Slimefun/Slimefun4/commit/c899413f7f8a9f7ad9ed6c4766fa86b79c1ade9b", "message": "Forgot to import packages", "committedDate": "2020-02-12T06:14:08Z", "type": "commit"}, {"oid": "07b7ed73fa1e6f5a72afc0d1424d51a95521be0a", "url": "https://github.com/Slimefun/Slimefun4/commit/07b7ed73fa1e6f5a72afc0d1424d51a95521be0a", "message": "Fixed give more items when using fortune pickaxe", "committedDate": "2020-02-12T06:39:16Z", "type": "commit"}, {"oid": "c25a39c95506c9835ac3fe18eeeaacdbaa82d688", "url": "https://github.com/Slimefun/Slimefun4/commit/c25a39c95506c9835ac3fe18eeeaacdbaa82d688", "message": "Avoid can't get bonus items", "committedDate": "2020-02-12T08:43:53Z", "type": "commit"}, {"oid": "ef3c1f3d104635e6e461a4d0be1318cc524757fa", "url": "https://github.com/Slimefun/Slimefun4/commit/ef3c1f3d104635e6e461a4d0be1318cc524757fa", "message": "Update TalismanListener.java", "committedDate": "2020-02-12T13:39:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1NTk5Ng==", "url": "https://github.com/Slimefun/Slimefun4/pull/1517#discussion_r378255996", "bodyText": "Look at Math.min", "author": "WalshyDev", "createdAt": "2020-02-12T13:41:16Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java", "diffHunk": "@@ -158,14 +158,12 @@ public void onBlockBreak(BlockBreakEvent e) {\n \t\t\t\tfortune = (e.getBlock().getType() == Material.LAPIS_ORE ? 4 + random.nextInt(5) : 1) * (fortune + 1);\n \t\t\t}\n \n-\t\t\tif (!item.getEnchantments().containsKey(Enchantment.SILK_TOUCH) && e.getBlock().getType().toString().endsWith(\"_ORE\") && Talisman.checkFor(e, (SlimefunItemStack) SlimefunItems.TALISMAN_MINER)) {\n-\t\t\t\tif (drops.isEmpty()) {\n-\t\t\t\t\tdrops = e.getBlock().getDrops();\n-\t\t\t\t}\n-\n-\t\t\t\tfor (ItemStack drop : new ArrayList<>(drops)) {\n+\t\t\tif (!item.getEnchantments().containsKey(Enchantment.SILK_TOUCH) && MaterialCollections.getAllOres().contains(e.getBlock().getType()) && Talisman.checkFor(e, (SlimefunItemStack) SlimefunItems.TALISMAN_MINER)) {\n+\t\t\t\tfor (ItemStack drop : drops) {\n \t\t\t\t\tif (!drop.getType().isBlock()) {\n-\t\t\t\t\t\tdrops.add(new CustomItem(drop, fortune * 2));\n+\t\t\t\t\t\t// Sometimes doubled amount is 0, So make amount at least equals 1\n+\t\t\t\t\t\tint amount = (fortune * 2) - drop.getAmount() == 0 ? 1 : (fortune * 2) - drop.getAmount();", "originalCommit": "ef3c1f3d104635e6e461a4d0be1318cc524757fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM5NTMwMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1517#discussion_r378395301", "bodyText": "What the blob said.", "author": "TheBusyBiscuit", "createdAt": "2020-02-12T17:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1NTk5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "d8c29ec7bba798544bb568dfe29d287d9bcb976e", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java b/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java\nindex 2c7691f2f..709ea022b 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java\n\n@@ -161,9 +161,8 @@ public class TalismanListener implements Listener {\n \t\t\tif (!item.getEnchantments().containsKey(Enchantment.SILK_TOUCH) && MaterialCollections.getAllOres().contains(e.getBlock().getType()) && Talisman.checkFor(e, (SlimefunItemStack) SlimefunItems.TALISMAN_MINER)) {\n \t\t\t\tfor (ItemStack drop : drops) {\n \t\t\t\t\tif (!drop.getType().isBlock()) {\n-\t\t\t\t\t\t// Sometimes doubled amount is 0, So make amount at least equals 1\n-\t\t\t\t\t\tint amount = (fortune * 2) - drop.getAmount() == 0 ? 1 : (fortune * 2) - drop.getAmount();\n-\t\t\t\t\t\te.getPlayer().getInventory().addItem(new CustomItem(drop, amount));\n+\t\t\t\t\t\tint amount = Math.max(1, (fortune * 2) - drop.getAmount());\n+\t\t\t\t\t\te.getBlock().getWorld().dropItemNaturally(e.getBlock().getLocation(), new CustomItem(drop, amount));\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM5NTgxMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/1517#discussion_r378395812", "bodyText": "Adding the items to the inventory directly is a really bad idea.\nJust drop them in the world if you really wanna do it that way...\nBut this will cause problems with full inventories and would be a very inconsistent behaviour.", "author": "TheBusyBiscuit", "createdAt": "2020-02-12T17:18:05Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java", "diffHunk": "@@ -158,14 +158,12 @@ public void onBlockBreak(BlockBreakEvent e) {\n \t\t\t\tfortune = (e.getBlock().getType() == Material.LAPIS_ORE ? 4 + random.nextInt(5) : 1) * (fortune + 1);\n \t\t\t}\n \n-\t\t\tif (!item.getEnchantments().containsKey(Enchantment.SILK_TOUCH) && e.getBlock().getType().toString().endsWith(\"_ORE\") && Talisman.checkFor(e, (SlimefunItemStack) SlimefunItems.TALISMAN_MINER)) {\n-\t\t\t\tif (drops.isEmpty()) {\n-\t\t\t\t\tdrops = e.getBlock().getDrops();\n-\t\t\t\t}\n-\n-\t\t\t\tfor (ItemStack drop : new ArrayList<>(drops)) {\n+\t\t\tif (!item.getEnchantments().containsKey(Enchantment.SILK_TOUCH) && MaterialCollections.getAllOres().contains(e.getBlock().getType()) && Talisman.checkFor(e, (SlimefunItemStack) SlimefunItems.TALISMAN_MINER)) {\n+\t\t\t\tfor (ItemStack drop : drops) {\n \t\t\t\t\tif (!drop.getType().isBlock()) {\n-\t\t\t\t\t\tdrops.add(new CustomItem(drop, fortune * 2));\n+\t\t\t\t\t\t// Sometimes doubled amount is 0, So make amount at least equals 1\n+\t\t\t\t\t\tint amount = (fortune * 2) - drop.getAmount() == 0 ? 1 : (fortune * 2) - drop.getAmount();\n+\t\t\t\t\t\te.getPlayer().getInventory().addItem(new CustomItem(drop, amount));", "originalCommit": "ef3c1f3d104635e6e461a4d0be1318cc524757fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5MzIxNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/1517#discussion_r378593216", "bodyText": "Done.", "author": "StarWishsama", "createdAt": "2020-02-13T00:41:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM5NTgxMg=="}], "type": "inlineReview", "revised_code": {"commit": "d8c29ec7bba798544bb568dfe29d287d9bcb976e", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java b/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java\nindex 2c7691f2f..709ea022b 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/TalismanListener.java\n\n@@ -161,9 +161,8 @@ public class TalismanListener implements Listener {\n \t\t\tif (!item.getEnchantments().containsKey(Enchantment.SILK_TOUCH) && MaterialCollections.getAllOres().contains(e.getBlock().getType()) && Talisman.checkFor(e, (SlimefunItemStack) SlimefunItems.TALISMAN_MINER)) {\n \t\t\t\tfor (ItemStack drop : drops) {\n \t\t\t\t\tif (!drop.getType().isBlock()) {\n-\t\t\t\t\t\t// Sometimes doubled amount is 0, So make amount at least equals 1\n-\t\t\t\t\t\tint amount = (fortune * 2) - drop.getAmount() == 0 ? 1 : (fortune * 2) - drop.getAmount();\n-\t\t\t\t\t\te.getPlayer().getInventory().addItem(new CustomItem(drop, amount));\n+\t\t\t\t\t\tint amount = Math.max(1, (fortune * 2) - drop.getAmount());\n+\t\t\t\t\t\te.getBlock().getWorld().dropItemNaturally(e.getBlock().getLocation(), new CustomItem(drop, amount));\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n"}}, {"oid": "d8c29ec7bba798544bb568dfe29d287d9bcb976e", "url": "https://github.com/Slimefun/Slimefun4/commit/d8c29ec7bba798544bb568dfe29d287d9bcb976e", "message": "Double ores by drop items", "committedDate": "2020-02-13T00:40:18Z", "type": "commit"}, {"oid": "ecfd242c32f011be14dd49dec349510fbc5251d5", "url": "https://github.com/Slimefun/Slimefun4/commit/ecfd242c32f011be14dd49dec349510fbc5251d5", "message": "Merge branch 'master' into patch-2", "committedDate": "2020-02-13T00:46:02Z", "type": "commit"}]}