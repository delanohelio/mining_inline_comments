{"pr_number": 1981, "pr_title": "allow null meta", "pr_createdAt": "2020-06-12T21:12:51Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/1981", "timeline": [{"oid": "6bc28d6b6940a10e7f66ac67df0dbbda60a5d26e", "url": "https://github.com/Slimefun/Slimefun4/commit/6bc28d6b6940a10e7f66ac67df0dbbda60a5d26e", "message": "allow null meta", "committedDate": "2020-06-12T21:09:57Z", "type": "commit"}, {"oid": "56bd432719ad6b30b4bfa192a6c3afe28038f986", "url": "https://github.com/Slimefun/Slimefun4/commit/56bd432719ad6b30b4bfa192a6c3afe28038f986", "message": "check if null in getItemMeta", "committedDate": "2020-06-12T21:29:04Z", "type": "commit"}, {"oid": "e989969713d0fc700dd0eba7da148674c7dcb65d", "url": "https://github.com/Slimefun/Slimefun4/commit/e989969713d0fc700dd0eba7da148674c7dcb65d", "message": "safety check in CustomItemDataService", "committedDate": "2020-06-12T22:01:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MDMwNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439660307", "bodyText": "You should check hasItemMeta, just like your exception in getItemMeta says ;)", "author": "WalshyDev", "createdAt": "2020-06-12T22:04:40Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java", "diffHunk": "@@ -45,6 +45,9 @@ public void setItemData(ItemMeta im, String id) {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n+        if (item.getItemMeta() == null) {", "originalCommit": "e989969713d0fc700dd0eba7da148674c7dcb65d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5f8ae4b1829e2a1bcbb4a839ba8d95dab55b0905", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\nindex e57564e46..565c102dc 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n\n@@ -45,10 +45,11 @@ public class CustomItemDataService implements PersistentDataService, Keyed {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n-        if (item.getItemMeta() == null) {\n+        ItemMeta meta = item.getItemMeta();\n+        if (meta == null) {\n             return Optional.empty();\n         }\n-        return getItemData(item.getItemMeta());\n+        return getItemData(meta);\n     }\n \n     public Optional<String> getItemData(ItemMeta meta) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MDI0Nw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439660247", "bodyText": "You should do .hasItemMeta() here (and maybe also add a null-check for the given ItemStack parameter as pointed out before), otherwise you won't gain any performance benefit from this here, since #getItemMeta() (for normal ItemStacks) will create a new instance of ItemMeta and perform a clone operation which is very costly.\nAs Walshy also pointed out, even for ItemStackWrappers this will throw an UnsupportedOperationException now...", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:04:26Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java", "diffHunk": "@@ -45,6 +45,9 @@ public void setItemData(ItemMeta im, String id) {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n+        if (item.getItemMeta() == null) {", "originalCommit": "e989969713d0fc700dd0eba7da148674c7dcb65d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5f8ae4b1829e2a1bcbb4a839ba8d95dab55b0905", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\nindex e57564e46..565c102dc 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n\n@@ -45,10 +45,11 @@ public class CustomItemDataService implements PersistentDataService, Keyed {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n-        if (item.getItemMeta() == null) {\n+        ItemMeta meta = item.getItemMeta();\n+        if (meta == null) {\n             return Optional.empty();\n         }\n-        return getItemData(item.getItemMeta());\n+        return getItemData(meta);\n     }\n \n     public Optional<String> getItemData(ItemMeta meta) {\n"}}, {"oid": "5f8ae4b1829e2a1bcbb4a839ba8d95dab55b0905", "url": "https://github.com/Slimefun/Slimefun4/commit/5f8ae4b1829e2a1bcbb4a839ba8d95dab55b0905", "message": "don't get it twice", "committedDate": "2020-06-12T22:04:55Z", "type": "commit"}, {"oid": "a232d8285141d86f76f0f3c899c04a99acc5cbe3", "url": "https://github.com/Slimefun/Slimefun4/commit/a232d8285141d86f76f0f3c899c04a99acc5cbe3", "message": "add check", "committedDate": "2020-06-12T22:10:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjQ4MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439662481", "bodyText": "This is redundant, ItemStack#getItemMeta() will never return null, except for ItemStackWrappers but we already handled these in the previous condition. The null-check I suggested was about the ItemStack, not the meta.\nif (item == null || !item.hasItemMeta())", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:12:48Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java", "diffHunk": "@@ -45,7 +45,14 @@ public void setItemData(ItemMeta im, String id) {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n-        return getItemData(item.getItemMeta());\n+        if (!item.hasItemMeta()) {\n+            return Optional.empty();\n+        }\n+        ItemMeta meta = item.getItemMeta();\n+        if (meta == null) {\n+            return Optional.empty();\n+        }", "originalCommit": "a232d8285141d86f76f0f3c899c04a99acc5cbe3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MzE0Ng==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439663146", "bodyText": "why would the item be null", "author": "PhanaticD", "createdAt": "2020-06-12T22:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MzQ2OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439663469", "bodyText": "If I do .getItemData(null) the ItemStack will be null.", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:16:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2NDA3MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439664071", "bodyText": "it did not have a null check for however long this class has existed before, that seems out of the scope of this PR to change", "author": "PhanaticD", "createdAt": "2020-06-12T22:19:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2NTE3NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439665175", "bodyText": "Something being broken for a long time doesn't mean you shouldn't fix it.\nAnd it is very well in scope of this PR since your change broke this method. It's only logical to fully fix this then, rather than doing a half-hearted job and fixing it only halfway through, otherwise the issue will only be delayed to a more distant point in time.", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:23:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjQ4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "0b4904831b80f8cbe8a05a26ab340c147a5b84a8", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\nindex 2dcaa8323..e90e6b7aa 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n\n@@ -45,14 +45,10 @@ public class CustomItemDataService implements PersistentDataService, Keyed {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n-        if (!item.hasItemMeta()) {\n+        if (item == null || !item.hasItemMeta()) {\n             return Optional.empty();\n         }\n-        ItemMeta meta = item.getItemMeta();\n-        if (meta == null) {\n-            return Optional.empty();\n-        }\n-        return getItemData(meta);\n+        return getItemData(item.getItemMeta());\n     }\n \n     public Optional<String> getItemData(ItemMeta meta) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439662563", "bodyText": "This isn't ever null", "author": "WalshyDev", "createdAt": "2020-06-12T22:13:08Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java", "diffHunk": "@@ -45,7 +45,14 @@ public void setItemData(ItemMeta im, String id) {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n-        return getItemData(item.getItemMeta());\n+        if (!item.hasItemMeta()) {\n+            return Optional.empty();\n+        }\n+        ItemMeta meta = item.getItemMeta();\n+        if (meta == null) {", "originalCommit": "a232d8285141d86f76f0f3c899c04a99acc5cbe3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MzE4MA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439663180", "bodyText": "it could be for wrappers", "author": "PhanaticD", "createdAt": "2020-06-12T22:15:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MzQ0OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439663449", "bodyText": "No in the wrapper you throw an exception now", "author": "WalshyDev", "createdAt": "2020-06-12T22:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MzY0MA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439663640", "bodyText": "In that case this code won't even be reached though since we prevent this from ever being called due to the #hasItemMeta() check from before.", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:17:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MzcxMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439663710", "bodyText": "busybiscuit told me to explicitly add a check here, that is the only reason I put it", "author": "PhanaticD", "createdAt": "2020-06-12T22:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2NDIzOA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439664238", "bodyText": "You only seem to read half of our comments then, I already told you this is redundant and that it isn't nullable. Only the actual ItemStack is.", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:19:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2NDg0NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439664844", "bodyText": "I am reading all your comments, you are just confusing, edits are enabled for maintainers, please change the PR to be as you see fit", "author": "PhanaticD", "createdAt": "2020-06-12T22:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2NTY3MA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1981#discussion_r439665670", "bodyText": "Tell us what's unclear then. There is nothing that can't be discussed or cleared up.", "author": "TheBusyBiscuit", "createdAt": "2020-06-12T22:25:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjU2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "0b4904831b80f8cbe8a05a26ab340c147a5b84a8", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\nindex 2dcaa8323..e90e6b7aa 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/services/CustomItemDataService.java\n\n@@ -45,14 +45,10 @@ public class CustomItemDataService implements PersistentDataService, Keyed {\n     }\n \n     public Optional<String> getItemData(ItemStack item) {\n-        if (!item.hasItemMeta()) {\n+        if (item == null || !item.hasItemMeta()) {\n             return Optional.empty();\n         }\n-        ItemMeta meta = item.getItemMeta();\n-        if (meta == null) {\n-            return Optional.empty();\n-        }\n-        return getItemData(meta);\n+        return getItemData(item.getItemMeta());\n     }\n \n     public Optional<String> getItemData(ItemMeta meta) {\n"}}, {"oid": "0b4904831b80f8cbe8a05a26ab340c147a5b84a8", "url": "https://github.com/Slimefun/Slimefun4/commit/0b4904831b80f8cbe8a05a26ab340c147a5b84a8", "message": "update", "committedDate": "2020-06-12T22:52:54Z", "type": "commit"}]}