{"pr_number": 1790, "pr_title": "Cargo Network - optimization", "pr_createdAt": "2020-04-05T15:18:47Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/1790", "timeline": [{"oid": "6d9bd2ccf221bd0505c0fa20c8dfde8148c2c44b", "url": "https://github.com/Slimefun/Slimefun4/commit/6d9bd2ccf221bd0505c0fa20c8dfde8148c2c44b", "message": "Cargo - small performance improvements", "committedDate": "2020-04-04T05:20:56Z", "type": "commit"}, {"oid": "e07c2f5263b8411477f59c7262bc6fadd0799247", "url": "https://github.com/Slimefun/Slimefun4/commit/e07c2f5263b8411477f59c7262bc6fadd0799247", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4", "committedDate": "2020-04-05T02:12:07Z", "type": "commit"}, {"oid": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "url": "https://github.com/Slimefun/Slimefun4/commit/ab41129d6b0eb261018f9ae48dce5af8e414de82", "message": "Cargo - small performance improvements", "committedDate": "2020-04-05T02:26:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNjUyNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403716526", "bodyText": "Keeping a hardcoded list for this is not really the best idea.\nI get that this will save a lot of performance though...\nBy using a switch case here with the values SMOKER, LECTERN, etc... you will be breaking 1.13 compatibility though since those constants do not exist then.", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:23:07Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.github.thebusybiscuit.slimefun4.utils;\n+import org.bukkit.block.Block;\n+public final class BlockUtils {\n+\n+    public static boolean hasInventory(Block block) {\n+        if (block == null) return false;\n+\n+        switch (block.getType()) {\n+            case CHEST:\n+            case TRAPPED_CHEST:\n+            case FURNACE:\n+            case DISPENSER:\n+            case DROPPER:\n+            case HOPPER:\n+            case BREWING_STAND:\n+            case SHULKER_BOX:\n+            case WHITE_SHULKER_BOX:\n+            case ORANGE_SHULKER_BOX:\n+            case MAGENTA_SHULKER_BOX:\n+            case LIGHT_BLUE_SHULKER_BOX:\n+            case YELLOW_SHULKER_BOX:\n+            case LIME_SHULKER_BOX:\n+            case PINK_SHULKER_BOX:\n+            case GRAY_SHULKER_BOX:\n+            case LIGHT_GRAY_SHULKER_BOX:\n+            case CYAN_SHULKER_BOX:\n+            case PURPLE_SHULKER_BOX:\n+            case BLUE_SHULKER_BOX:\n+            case BROWN_SHULKER_BOX:\n+            case GREEN_SHULKER_BOX:\n+            case RED_SHULKER_BOX:\n+            case BLACK_SHULKER_BOX:\n+            case ENDER_CHEST:\n+            case BARREL:\n+            case BLAST_FURNACE:\n+            case LECTERN:\n+            case SMOKER:\n+                return true;\n+            default:\n+                return false;\n+        }\n+    }", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nindex 215f56558..4a09b19a7 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n\n@@ -2,6 +2,8 @@ package io.github.thebusybiscuit.slimefun4.utils;\n import org.bukkit.block.Block;\n public final class BlockUtils {\n \n+    private BlockUtils() {}\n+\n     public static boolean hasInventory(Block block) {\n         if (block == null) return false;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNjYwOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403716609", "bodyText": "Please create a private empty constructor here to prevent instantiation.", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:23:39Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.github.thebusybiscuit.slimefun4.utils;\n+import org.bukkit.block.Block;\n+public final class BlockUtils {\n+\n+    public static boolean hasInventory(Block block) {", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nindex 215f56558..4a09b19a7 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n\n@@ -2,6 +2,8 @@ package io.github.thebusybiscuit.slimefun4.utils;\n import org.bukkit.block.Block;\n public final class BlockUtils {\n \n+    private BlockUtils() {}\n+\n     public static boolean hasInventory(Block block) {\n         if (block == null) return false;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNjg1NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403716855", "bodyText": "Never use wildcard imports...", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:25:24Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java", "diffHunk": "@@ -14,6 +15,8 @@\n import java.util.logging.Level;\n import java.util.logging.Logger;\n \n+import com.google.gson.*;", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java b/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\nindex 6958e376e..c7dc7a916 100644\n--- a/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\n+++ b/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\n\n@@ -15,7 +15,9 @@ import java.util.concurrent.ConcurrentHashMap;\n import java.util.logging.Level;\n import java.util.logging.Logger;\n \n-import com.google.gson.*;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n import com.google.gson.stream.JsonWriter;\n import org.bukkit.Bukkit;\n import org.bukkit.Chunk;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzAzNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403717037", "bodyText": "An AssertionError is completely inappropriate here.\nNo Assertion was made and catching an exception just to throw another one serves no benefit here.\nYou hsould instead properly log the exception rather than creating a new one that makes no real sense here.", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:26:56Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java", "diffHunk": "@@ -378,14 +376,21 @@ private static BlockInfoConfig parseBlockInfo(Location l, String json) {\n         }\n     }\n \n-    private static String serializeBlockInfo(Config cfg) {\n-        JsonObject json = new JsonObject();\n \n-        for (String key : cfg.getKeys()) {\n-            json.add(key, new JsonPrimitive(cfg.getString(key)));\n+    private static String serializeBlockInfo(Config cfg) {\n+        try {\n+            StringWriter stringWriter = new StringWriter();\n+            JsonWriter jsonWriter = new JsonWriter(stringWriter);\n+            jsonWriter.setLenient(true);\n+            jsonWriter.beginObject();\n+            for (String key : cfg.getKeys()) {\n+                jsonWriter.name(key).value(cfg.getString(key));\n+            }\n+            jsonWriter.endObject();\n+            return stringWriter.toString();\n+        } catch (IOException e) {\n+            throw new AssertionError(e);", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java b/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\nindex 6958e376e..c7dc7a916 100644\n--- a/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\n+++ b/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\n\n@@ -388,8 +390,10 @@ public class BlockStorage {\n             }\n             jsonWriter.endObject();\n             return stringWriter.toString();\n-        } catch (IOException e) {\n-            throw new AssertionError(e);\n+        }\n+        catch (IOException x) {\n+            Slimefun.getLogger().log(Level.SEVERE, \"An error occurred while serializing BlockInfo\", x);\n+            return null;\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzA2NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403717064", "bodyText": "What exactly is the advantage of using this right here?", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:27:14Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java", "diffHunk": "@@ -378,14 +376,21 @@ private static BlockInfoConfig parseBlockInfo(Location l, String json) {\n         }\n     }\n \n-    private static String serializeBlockInfo(Config cfg) {\n-        JsonObject json = new JsonObject();\n \n-        for (String key : cfg.getKeys()) {\n-            json.add(key, new JsonPrimitive(cfg.getString(key)));\n+    private static String serializeBlockInfo(Config cfg) {\n+        try {\n+            StringWriter stringWriter = new StringWriter();\n+            JsonWriter jsonWriter = new JsonWriter(stringWriter);\n+            jsonWriter.setLenient(true);\n+            jsonWriter.beginObject();\n+            for (String key : cfg.getKeys()) {\n+                jsonWriter.name(key).value(cfg.getString(key));\n+            }\n+            jsonWriter.endObject();", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzczMTc5OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403731799", "bodyText": "It's same as JsonObject#toString(), but because we don't need the object, we can use JsonWriter directly without creating a new JsonObject.\nThis part of code is get called pretty often and keep showing on profiler. I need to measure it more to see if it could help with performance.", "author": "DNx5", "createdAt": "2020-04-05T17:23:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzA2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzczMjE3NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403732174", "bodyText": "Alright, I see. Some actual performance figures would be cool but I will mark this one as resolved nonetheless. \ud83d\udc4d", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T17:26:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzA2NA=="}], "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java b/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\nindex 6958e376e..c7dc7a916 100644\n--- a/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\n+++ b/src/main/java/me/mrCookieSlime/Slimefun/api/BlockStorage.java\n\n@@ -388,8 +390,10 @@ public class BlockStorage {\n             }\n             jsonWriter.endObject();\n             return stringWriter.toString();\n-        } catch (IOException e) {\n-            throw new AssertionError(e);\n+        }\n+        catch (IOException x) {\n+            Slimefun.getLogger().log(Level.SEVERE, \"An error occurred while serializing BlockInfo\", x);\n+            return null;\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzIxNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403717215", "bodyText": "All of that could be reduced to one if-statement. other than having 17 cases here.", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:28:31Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.github.thebusybiscuit.slimefun4.utils;\n+import org.bukkit.block.Block;\n+public final class BlockUtils {\n+\n+    public static boolean hasInventory(Block block) {\n+        if (block == null) return false;\n+\n+        switch (block.getType()) {\n+            case CHEST:\n+            case TRAPPED_CHEST:\n+            case FURNACE:\n+            case DISPENSER:\n+            case DROPPER:\n+            case HOPPER:\n+            case BREWING_STAND:\n+            case SHULKER_BOX:\n+            case WHITE_SHULKER_BOX:\n+            case ORANGE_SHULKER_BOX:\n+            case MAGENTA_SHULKER_BOX:\n+            case LIGHT_BLUE_SHULKER_BOX:\n+            case YELLOW_SHULKER_BOX:\n+            case LIME_SHULKER_BOX:\n+            case PINK_SHULKER_BOX:\n+            case GRAY_SHULKER_BOX:\n+            case LIGHT_GRAY_SHULKER_BOX:\n+            case CYAN_SHULKER_BOX:\n+            case PURPLE_SHULKER_BOX:\n+            case BLUE_SHULKER_BOX:\n+            case BROWN_SHULKER_BOX:\n+            case GREEN_SHULKER_BOX:\n+            case RED_SHULKER_BOX:\n+            case BLACK_SHULKER_BOX:", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nindex 215f56558..4a09b19a7 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n\n@@ -2,6 +2,8 @@ package io.github.thebusybiscuit.slimefun4.utils;\n import org.bukkit.block.Block;\n public final class BlockUtils {\n \n+    private BlockUtils() {}\n+\n     public static boolean hasInventory(Block block) {\n         if (block == null) return false;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzMzNA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403717334", "bodyText": "Is this of any use to non-cargo related classes? If no, then it may be moved to the cargo package.\nOtherwise it is fine to stay here.", "author": "TheBusyBiscuit", "createdAt": "2020-04-05T15:29:15Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.github.thebusybiscuit.slimefun4.utils;", "originalCommit": "ab41129d6b0eb261018f9ae48dce5af8e414de82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUwMzM0Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r406503343", "bodyText": "It looks like only cargo needed this, I think I will move it.", "author": "DNx5", "createdAt": "2020-04-09T22:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNzMzNA=="}], "type": "inlineReview", "revised_code": {"commit": "2396db25ad795d9694c6c71f393611f31034b1c4", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nindex 215f56558..4a09b19a7 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n\n@@ -2,6 +2,8 @@ package io.github.thebusybiscuit.slimefun4.utils;\n import org.bukkit.block.Block;\n public final class BlockUtils {\n \n+    private BlockUtils() {}\n+\n     public static boolean hasInventory(Block block) {\n         if (block == null) return false;\n \n"}}, {"oid": "2396db25ad795d9694c6c71f393611f31034b1c4", "url": "https://github.com/Slimefun/Slimefun4/commit/2396db25ad795d9694c6c71f393611f31034b1c4", "message": "code cleanup", "committedDate": "2020-04-05T16:25:10Z", "type": "commit"}, {"oid": "94614474101c9db20fbe24311783d64244ed7622", "url": "https://github.com/Slimefun/Slimefun4/commit/94614474101c9db20fbe24311783d64244ed7622", "message": "split shulker boxes check", "committedDate": "2020-04-05T16:30:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcyNzEwNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403727107", "bodyText": "I'd just do name().endsWith(\"SHULKER_BOX\") saves a lot of code", "author": "WalshyDev", "createdAt": "2020-04-05T16:45:04Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -15,32 +16,26 @@ public static boolean hasInventory(Block block) {\n             case DROPPER:\n             case HOPPER:\n             case BREWING_STAND:\n-            case SHULKER_BOX:\n-            case WHITE_SHULKER_BOX:\n-            case ORANGE_SHULKER_BOX:\n-            case MAGENTA_SHULKER_BOX:\n-            case LIGHT_BLUE_SHULKER_BOX:\n-            case YELLOW_SHULKER_BOX:\n-            case LIME_SHULKER_BOX:\n-            case PINK_SHULKER_BOX:\n-            case GRAY_SHULKER_BOX:\n-            case LIGHT_GRAY_SHULKER_BOX:\n-            case CYAN_SHULKER_BOX:\n-            case PURPLE_SHULKER_BOX:\n-            case BLUE_SHULKER_BOX:\n-            case BROWN_SHULKER_BOX:\n-            case GREEN_SHULKER_BOX:\n-            case RED_SHULKER_BOX:\n-            case BLACK_SHULKER_BOX:\n             case ENDER_CHEST:\n             case BARREL:\n             case BLAST_FURNACE:\n             case LECTERN:\n             case SMOKER:\n                 return true;\n             default:\n-                return false;\n+                return isShulkerBox(block);\n         }\n     }\n \n+    public static boolean isShulkerBox(Block block) {\n+        Material type = block.getType();\n+        return type == Material.SHULKER_BOX || type == Material.WHITE_SHULKER_BOX || type == Material.ORANGE_SHULKER_BOX", "originalCommit": "94614474101c9db20fbe24311783d64244ed7622", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcyNzQ3NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403727475", "bodyText": "Should I remove the method?", "author": "DNx5", "createdAt": "2020-04-05T16:47:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcyNzEwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc5MTY0OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r403791649", "bodyText": "I agree, this all can be reduced to the simple .endsWith statement which would be much simpler. I don't think we need an entire method for this.", "author": "TheBusyBiscuit", "createdAt": "2020-04-06T01:44:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcyNzEwNw=="}], "type": "inlineReview", "revised_code": {"commit": "aeab78b174b04e0d6c37bea0564fc1dd52fda3bc", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nindex 9df290f01..89941ca73 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n\n@@ -23,19 +22,7 @@ public final class BlockUtils {\n             case SMOKER:\n                 return true;\n             default:\n-                return isShulkerBox(block);\n+                return block.getType().name().endsWith(\"SHULKER_BOX\");\n         }\n     }\n-\n-    public static boolean isShulkerBox(Block block) {\n-        Material type = block.getType();\n-        return type == Material.SHULKER_BOX || type == Material.WHITE_SHULKER_BOX || type == Material.ORANGE_SHULKER_BOX\n-                || type == Material.MAGENTA_SHULKER_BOX || type == Material.LIGHT_BLUE_SHULKER_BOX\n-                || type == Material.YELLOW_SHULKER_BOX || type == Material.LIME_SHULKER_BOX\n-                || type == Material.PINK_SHULKER_BOX || type == Material.GRAY_SHULKER_BOX\n-                || type == Material.LIGHT_GRAY_SHULKER_BOX || type == Material.CYAN_SHULKER_BOX\n-                || type == Material.PURPLE_SHULKER_BOX || type == Material.BLUE_SHULKER_BOX || type == Material.BROWN_SHULKER_BOX\n-                || type == Material.GREEN_SHULKER_BOX || type == Material.RED_SHULKER_BOX || type == Material.BLACK_SHULKER_BOX;\n-    }\n-\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIyMzQwNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r404223406", "bodyText": "This could be reduced in size to just Math.min(amount, getMaxStackSize", "author": "WalshyDev", "createdAt": "2020-04-06T16:25:03Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java", "diffHunk": "@@ -204,26 +208,28 @@ else if (stack.getType() == Material.BLAZE_POWDER) {\n         }\n \n         for (int slot = minSlot; slot < maxSlot; slot++) {\n-            ItemStack is = inv.getContents()[slot];\n+            ItemStack is = contents[slot];\n \n             if (is == null) {\n                 inv.setItem(slot, stack.clone());\n                 return null;\n             } \n-            else if (SlimefunUtils.isItemSimilar(new CustomItem(is, 1), new CustomItem(stack, 1), true) && is.getAmount() < is.getType().getMaxStackSize()) {\n-                int amount = is.getAmount() + stack.getAmount();\n-                \n-                if (amount > is.getType().getMaxStackSize()) {\n-                    is.setAmount(is.getType().getMaxStackSize());\n-                    stack.setAmount(amount - is.getType().getMaxStackSize());\n-                } \n-                else {\n-                    is.setAmount(amount);\n-                    stack = null;\n-                }\n+            else {\n+                if (SlimefunUtils.isItemSimilar(is, stack, true, false)\n+                        && is.getAmount() < is.getType().getMaxStackSize()) {\n+                    int amount = is.getAmount() + stack.getAmount();\n \n-                inv.setItem(slot, is);\n-                return stack;\n+                    if (amount > is.getType().getMaxStackSize()) {\n+                        is.setAmount(is.getType().getMaxStackSize());\n+                        stack.setAmount(amount - is.getType().getMaxStackSize());\n+                    } else {\n+                        is.setAmount(amount);\n+                        stack = null;", "originalCommit": "94614474101c9db20fbe24311783d64244ed7622", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2233a0314dab1c991452e14f564698a9ff642ced", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\nindex 1ad38324f..f9404e164 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n\n@@ -208,26 +207,26 @@ final class CargoUtils {\n         }\n \n         for (int slot = minSlot; slot < maxSlot; slot++) {\n-            ItemStack is = contents[slot];\n+            ItemStack itemInSlot = contents[slot];\n \n-            if (is == null) {\n-                inv.setItem(slot, stack.clone());\n+            if (itemInSlot == null) {\n+                inv.setItem(slot, stack);\n                 return null;\n             } \n             else {\n-                if (SlimefunUtils.isItemSimilar(is, stack, true, false)\n-                        && is.getAmount() < is.getType().getMaxStackSize()) {\n-                    int amount = is.getAmount() + stack.getAmount();\n-\n-                    if (amount > is.getType().getMaxStackSize()) {\n-                        is.setAmount(is.getType().getMaxStackSize());\n-                        stack.setAmount(amount - is.getType().getMaxStackSize());\n-                    } else {\n-                        is.setAmount(amount);\n+                int maxStackSize = itemInSlot.getType().getMaxStackSize();\n+                if (SlimefunUtils.isItemSimilar(itemInSlot, stack, true, false) && itemInSlot.getAmount() < maxStackSize) {\n+                    int amount = itemInSlot.getAmount() + stack.getAmount();\n+\n+                    if (amount > maxStackSize) {\n+                        stack.setAmount(amount - maxStackSize);\n+                    }\n+                    else {\n                         stack = null;\n                     }\n \n-                    inv.setItem(slot, is);\n+                    itemInSlot.setAmount(Math.min(amount, maxStackSize));\n+                    inv.setItem(slot, itemInSlot);\n                     return stack;\n                 }\n             }\n"}}, {"oid": "aeab78b174b04e0d6c37bea0564fc1dd52fda3bc", "url": "https://github.com/Slimefun/Slimefun4/commit/aeab78b174b04e0d6c37bea0564fc1dd52fda3bc", "message": "simplify the shulker boxes check", "committedDate": "2020-04-09T19:20:54Z", "type": "commit"}, {"oid": "9eb3ee2d53023de10da78932b942c2430c0eb73d", "url": "https://github.com/Slimefun/Slimefun4/commit/9eb3ee2d53023de10da78932b942c2430c0eb73d", "message": "Simplify and optimize the Cargo insertion", "committedDate": "2020-04-09T20:12:30Z", "type": "commit"}, {"oid": "fa8c07884cbddcb09552731f7e09cc99265a83f5", "url": "https://github.com/Slimefun/Slimefun4/commit/fa8c07884cbddcb09552731f7e09cc99265a83f5", "message": "fix 1.13 compatibility", "committedDate": "2020-04-09T21:40:38Z", "type": "commit"}, {"oid": "75564fc7f1b76949f355de3fddc7421d25c1b13a", "url": "https://github.com/Slimefun/Slimefun4/commit/75564fc7f1b76949f355de3fddc7421d25c1b13a", "message": "fix OreCrusher item registration", "committedDate": "2020-04-09T21:41:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUyNjA0Nw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r406526047", "bodyText": "Slimefun has a built-in method for that. And there is no need for making that a field here.\nYou can do SlimefunPlugin.getMinecraftVersion().isAtLeast(MinecraftVersion.MINECRAFT_1_14) instead.\nYour method would break for all 1.15 servers since you check for the exact version, not the minimum.", "author": "TheBusyBiscuit", "createdAt": "2020-04-09T23:13:01Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package io.github.thebusybiscuit.slimefun4.utils;\n+import io.github.thebusybiscuit.cscorelib2.reflection.ReflectionUtils;\n+import org.bukkit.Material;\n+import org.bukkit.block.Block;\n+public final class BlockUtils {\n+\n+    private static final boolean is_1_14 = ReflectionUtils.isVersion(\"v1_14_\");", "originalCommit": "75564fc7f1b76949f355de3fddc7421d25c1b13a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88a5129b1af3c54fb47f5fc4e63c380a6a401e66", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\nsimilarity index 72%\nrename from src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nrename to src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\nindex 2d051fdee..5f0521ed8 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\n\n@@ -1,11 +1,10 @@\n-package io.github.thebusybiscuit.slimefun4.utils;\n-import io.github.thebusybiscuit.cscorelib2.reflection.ReflectionUtils;\n+package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n import org.bukkit.Material;\n import org.bukkit.block.Block;\n public final class BlockUtils {\n \n-    private static final boolean is_1_14 = ReflectionUtils.isVersion(\"v1_14_\");\n-\n     private BlockUtils() {}\n \n     public static boolean hasInventory(Block block) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUyNjMwNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r406526307", "bodyText": "I don't think Ender Chests have Inventories that you can interact with...\nSince those are per-player not per-block.", "author": "TheBusyBiscuit", "createdAt": "2020-04-09T23:13:29Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package io.github.thebusybiscuit.slimefun4.utils;\n+import io.github.thebusybiscuit.cscorelib2.reflection.ReflectionUtils;\n+import org.bukkit.Material;\n+import org.bukkit.block.Block;\n+public final class BlockUtils {\n+\n+    private static final boolean is_1_14 = ReflectionUtils.isVersion(\"v1_14_\");\n+\n+    private BlockUtils() {}\n+\n+    public static boolean hasInventory(Block block) {\n+        if (block == null) return false;\n+\n+        Material type = block.getType();\n+        switch (type) {\n+            case CHEST:\n+            case TRAPPED_CHEST:\n+            case FURNACE:\n+            case DISPENSER:\n+            case DROPPER:\n+            case HOPPER:\n+            case BREWING_STAND:\n+            case ENDER_CHEST:", "originalCommit": "75564fc7f1b76949f355de3fddc7421d25c1b13a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88a5129b1af3c54fb47f5fc4e63c380a6a401e66", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\nsimilarity index 72%\nrename from src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\nrename to src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\nindex 2d051fdee..5f0521ed8 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/utils/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\n\n@@ -1,11 +1,10 @@\n-package io.github.thebusybiscuit.slimefun4.utils;\n-import io.github.thebusybiscuit.cscorelib2.reflection.ReflectionUtils;\n+package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n import org.bukkit.Material;\n import org.bukkit.block.Block;\n public final class BlockUtils {\n \n-    private static final boolean is_1_14 = ReflectionUtils.isVersion(\"v1_14_\");\n-\n     private BlockUtils() {}\n \n     public static boolean hasInventory(Block block) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUyNjU3Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r406526573", "bodyText": "Never override the .register() method.", "author": "TheBusyBiscuit", "createdAt": "2020-04-09T23:14:09Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java", "diffHunk": "@@ -38,18 +39,21 @@ public OreCrusher() {\n \t\t\t\t},\n \t\t\t\tBlockFace.SELF\n \t\t);\n-\t\t\n \t\taddItemSetting(doubleOres);\n-\t\t\n+\t}\n+\n+\t@Override\n+\tpublic void register(SlimefunAddon addon) {\n+\t\tsuper.register(addon);", "originalCommit": "75564fc7f1b76949f355de3fddc7421d25c1b13a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUyNjgwMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r406526801", "bodyText": "You should use the .postRegister() method instead for this.", "author": "TheBusyBiscuit", "createdAt": "2020-04-09T23:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUyNjU3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "4cc2e8c4d2be967d77b0fe9cbe17ad62e84d0fc2", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java b/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java\nindex b24c860d6..838876230 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java\n\n@@ -43,8 +42,8 @@ public class OreCrusher extends MultiBlockMachine {\n \t}\n \n \t@Override\n-\tpublic void register(SlimefunAddon addon) {\n-\t\tsuper.register(addon);\n+\tpublic void postRegister() {\n+\t\tsuper.postRegister();\n \t\tshownRecipes.addAll(Arrays.asList(\n \t\t\t\tnew ItemStack(Material.COAL_ORE), new ItemStack(Material.COAL, isDoubleDropsEnabled() ? 2: 1),\n \t\t\t\tnew ItemStack(Material.LAPIS_ORE), new ItemStack(Material.LAPIS_LAZULI, isDoubleDropsEnabled() ? 14: 7),\n"}}, {"oid": "4cc2e8c4d2be967d77b0fe9cbe17ad62e84d0fc2", "url": "https://github.com/Slimefun/Slimefun4/commit/4cc2e8c4d2be967d77b0fe9cbe17ad62e84d0fc2", "message": "Fix OreCrusher, add recipes on post-register", "committedDate": "2020-04-10T00:04:24Z", "type": "commit"}, {"oid": "88a5129b1af3c54fb47f5fc4e63c380a6a401e66", "url": "https://github.com/Slimefun/Slimefun4/commit/88a5129b1af3c54fb47f5fc4e63c380a6a401e66", "message": "Move BlockUtils into cargo package. removed ender chest from the list. use slimefun's method to check minecraft version", "committedDate": "2020-04-10T00:22:32Z", "type": "commit"}, {"oid": "c00fb1dc1b78f971dde3717b67950f26e381578b", "url": "https://github.com/Slimefun/Slimefun4/commit/c00fb1dc1b78f971dde3717b67950f26e381578b", "message": "simplify cargo withdraw methods.\ntrying to reduce unnecessary item clone as much as possible.", "committedDate": "2020-04-10T01:05:17Z", "type": "commit"}, {"oid": "e4a5e78cc6929a95a7ca6a2bf9a20732b7fcf922", "url": "https://github.com/Slimefun/Slimefun4/commit/e4a5e78cc6929a95a7ca6a2bf9a20732b7fcf922", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4\n\n\u0001 Conflicts:\n\u0001\tpom.xml\n\u0001\tsrc/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java", "committedDate": "2020-04-10T01:08:27Z", "type": "commit"}, {"oid": "2233a0314dab1c991452e14f564698a9ff642ced", "url": "https://github.com/Slimefun/Slimefun4/commit/2233a0314dab1c991452e14f564698a9ff642ced", "message": "added leftover changes, and bug fixes.\nwith possibility of bringing more bugs", "committedDate": "2020-04-10T06:59:50Z", "type": "commit"}, {"oid": "ebd89741553183c0c56e65b03e65f8e102a2ee42", "url": "https://github.com/Slimefun/Slimefun4/commit/ebd89741553183c0c56e65b03e65f8e102a2ee42", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4", "committedDate": "2020-04-10T21:18:27Z", "type": "commit"}, {"oid": "ec6698602c9033b339ed34f056909227ec4acc19", "url": "https://github.com/Slimefun/Slimefun4/commit/ec6698602c9033b339ed34f056909227ec4acc19", "message": "optimize Cargo Node's filter index saving.", "committedDate": "2020-04-10T22:32:18Z", "type": "commit"}, {"oid": "e985698f9f933ff1dcecd64808dcd60ce2796348", "url": "https://github.com/Slimefun/Slimefun4/commit/e985698f9f933ff1dcecd64808dcd60ce2796348", "message": "Implement cargo network tick delay", "committedDate": "2020-04-13T13:19:41Z", "type": "commit"}, {"oid": "f505d6f7405f377e11e73430bef2f965c6ec6aad", "url": "https://github.com/Slimefun/Slimefun4/commit/f505d6f7405f377e11e73430bef2f965c6ec6aad", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/multiblocks/OreCrusher.java", "committedDate": "2020-04-13T13:22:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5NjMzMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r407596331", "bodyText": "Space between package and imports", "author": "WalshyDev", "createdAt": "2020-04-13T17:14:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;", "originalCommit": "f505d6f7405f377e11e73430bef2f965c6ec6aad", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\nindex f359727aa..402bfc741 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\n\n@@ -1,8 +1,10 @@\n package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+\n import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n import org.bukkit.Material;\n import org.bukkit.block.Block;\n+\n final class BlockUtils {\n \n     private BlockUtils() {}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5NjYwNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r407596607", "bodyText": "Space between imports and class.", "author": "WalshyDev", "createdAt": "2020-04-13T17:15:29Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+import org.bukkit.Material;\n+import org.bukkit.block.Block;\n+final class BlockUtils {", "originalCommit": "f505d6f7405f377e11e73430bef2f965c6ec6aad", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\nindex f359727aa..402bfc741 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java\n\n@@ -1,8 +1,10 @@\n package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+\n import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n import org.bukkit.Material;\n import org.bukkit.block.Block;\n+\n final class BlockUtils {\n \n     private BlockUtils() {}\n"}}, {"oid": "078407782165d31530b7afc999c08fefe5e8903e", "url": "https://github.com/Slimefun/Slimefun4/commit/078407782165d31530b7afc999c08fefe5e8903e", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n\u0001\tsrc/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java", "committedDate": "2020-04-20T08:32:45Z", "type": "commit"}, {"oid": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "url": "https://github.com/Slimefun/Slimefun4/commit/70b5a5a9d188e5055026d29682591c3dfcc7d152", "message": "code cleanup", "committedDate": "2020-04-20T08:49:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNDgzNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412204835", "bodyText": "There is no sense in storing this as a class member for each instance of CargoNet, things like that rather belong into the NetworkManager with an appropriate getter and javadocs comments.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T13:53:55Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java", "diffHunk": "@@ -32,6 +32,8 @@\n     private final Set<Location> outputNodes = new HashSet<>();\n \n     private final Map<Location, Integer> roundRobin = new HashMap<>();\n+    private final int tickDelay = SlimefunPlugin.getCfg().getInt(\"URID.cargo-network-tick-delay\");", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzIyMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412523220", "bodyText": "This is specifically made only for Cargo network. I don't think NetworkManager class should contain this, or should I made it for all types of Network?\nHow about moving it into:\nif (tickDelayThreshold < SlimefunPlugin.getCfg().getInt(\"URID.cargo-network-tick-delay\")) {\nI see this kind of usage in some place", "author": "DNx5", "createdAt": "2020-04-21T22:04:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNDgzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzNjQ4Mg==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412536482", "bodyText": "Retrieving the value directly from the config should definitely be avoided, that would just contradict the prupose of optimizing that method anyway.\nEven if the value is only for cargo nets, the NetworkManager may still be an appropriate place for that, if you simply call it \"cargoTickDelay\" accordingly.\nTo elaborate: The NetworkManager is just a singleton that holds references to all Networks and some config values.\nAlternatively, if you really think it should stay in the CargoNet you should definitely make that field static, as it is not cargo network specific but rather a static constant.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T22:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNDgzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "92e8aa955b456ade85da1a5a090d9c7476373ff0", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\nindex ab87d370c..1ada1d36b 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n\n@@ -32,7 +32,6 @@ public class CargoNet extends ChestTerminalNetwork {\n     private final Set<Location> outputNodes = new HashSet<>();\n \n     private final Map<Location, Integer> roundRobin = new HashMap<>();\n-    private final int tickDelay = SlimefunPlugin.getCfg().getInt(\"URID.cargo-network-tick-delay\");\n     private int tickDelayThreshold = 0;\n \n     public static CargoNet getNetworkFromLocation(Location l) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNjI2OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412206268", "bodyText": "This could probably use some comments explaining what it does.\nI know that this delays cargo ticks to only be actually run every X time but it isn't immediately clear, so there should better be a comment for that.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T13:55:37Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java", "diffHunk": "@@ -175,6 +177,12 @@ private void run(Block b, Set<Location> destinations, Map<Integer, List<Location\n             display();\n         }\n \n+        if (tickDelayThreshold < tickDelay) {\n+            tickDelayThreshold++;\n+            return;\n+        }\n+        tickDelayThreshold = 0;", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "92e8aa955b456ade85da1a5a090d9c7476373ff0", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\nindex ab87d370c..1ada1d36b 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n\n@@ -177,11 +176,13 @@ public class CargoNet extends ChestTerminalNetwork {\n             display();\n         }\n \n-        if (tickDelayThreshold < tickDelay) {\n+        // Skip ticking if the threshold is not reached. The delay is not same as minecraft tick,\n+        // but it's based on 'custom-ticker-delay' config.\n+        if (tickDelayThreshold < SlimefunPlugin.getCfg().getInt(\"URID.cargo-network-tick-delay\")) {\n             tickDelayThreshold++;\n             return;\n         }\n-        tickDelayThreshold = 0;\n+        tickDelayThreshold = 0; // reset, so we can start skipping again\n \n         Map<Location, Integer> inputs = new HashMap<>();\n         Set<Location> providers = new HashSet<>();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwOTQyMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412209420", "bodyText": "This statement would probably always return true if Im not mistaken since you removed these default values and added a continue; there.\nSo this condition could maybe be removed if Im not mistaken.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T13:59:19Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java", "diffHunk": "@@ -198,72 +206,67 @@ else if (frequency >= 0 && frequency < 16) {\n         // (Apart from ChestTerminal Buses)\n         for (Map.Entry<Location, Integer> entry : inputs.entrySet()) {\n             Location input = entry.getKey();\n-            Optional<Block> inputTarget = getAttachedBlock(input.getBlock());\n-\n-            if (inputTarget.isPresent()) {\n-                int previousSlot = -1;\n-\n-                Config cfg = BlockStorage.getLocationInfo(input);\n-                boolean roundrobin = \"true\".equals(cfg.getString(\"round-robin\"));\n+            Optional<Block> attachedBlock = getAttachedBlock(input.getBlock());\n+            if (!attachedBlock.isPresent()) {\n+                continue;\n+            }\n \n-                ItemStackAndInteger slot = CargoUtils.withdraw(input.getBlock(), inputTarget.get(), Integer.parseInt(cfg.getString(\"index\")));\n-                ItemStack stack = null;\n+            Block inputTarget = attachedBlock.get();\n+            Config cfg = BlockStorage.getLocationInfo(input);\n+            boolean roundrobin = \"true\".equals(cfg.getString(\"round-robin\"));\n \n-                if (slot != null) {\n-                    stack = slot.getItem();\n-                    previousSlot = slot.getInt();\n-                }\n+            ItemStackAndInteger slot = CargoUtils.withdraw(input.getBlock(), inputTarget, Integer.parseInt(cfg.getString(\"index\")));\n+            if (slot == null) {\n+                continue;\n+            }\n \n-                if (stack != null) {\n-                    List<Location> outputs = output.get(entry.getValue());\n+            ItemStack stack = slot.getItem();\n+            int previousSlot = slot.getInt();\n+            List<Location> outputs = output.get(entry.getValue());\n \n-                    if (outputs != null) {\n-                        List<Location> outputlist = new LinkedList<>(outputs);\n+            if (outputs != null) {\n+                List<Location> outputlist = new LinkedList<>(outputs);\n \n-                        if (roundrobin) {\n-                            int index = roundRobin.getOrDefault(input, 0);\n+                if (roundrobin) {\n+                    int index = roundRobin.getOrDefault(input, 0);\n \n                             if (index < outputlist.size()) {\n                                 for (int i = 0; i < index; i++) {\n                                     Location temp = outputlist.remove(0);\n                                     outputlist.add(temp);\n                                 }\n \n-                                index++;\n-                            }\n-                            else {\n-                                index = 1;\n-                            }\n+                        index++;\n+                    }\n+                    else {\n+                        index = 1;\n+                    }\n \n-                            roundRobin.put(input, index);\n-                        }\n+                    roundRobin.put(input, index);\n+                }\n \n-                        for (Location out : outputlist) {\n-                            Optional<Block> target = getAttachedBlock(out.getBlock());\n+                for (Location out : outputlist) {\n+                    Optional<Block> target = getAttachedBlock(out.getBlock());\n \n-                            if (target.isPresent()) {\n-                                stack = CargoUtils.insert(out.getBlock(), target.get(), stack, -1);\n-                                if (stack == null) break;\n-                            }\n-                        }\n+                    if (target.isPresent()) {\n+                        stack = CargoUtils.insert(out.getBlock(), target.get(), stack, -1);\n+                        if (stack == null) break;\n                     }\n+                }\n+            }\n+\n+            if (stack != null && previousSlot > -1) {", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "81add1caa2466eb3978b1290417de94a3ef5cdc7", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\nindex ab87d370c..ba232ad0d 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n\n@@ -229,13 +230,11 @@ public class CargoNet extends ChestTerminalNetwork {\n \n                 if (roundrobin) {\n                     int index = roundRobin.getOrDefault(input, 0);\n-\n-                            if (index < outputlist.size()) {\n-                                for (int i = 0; i < index; i++) {\n-                                    Location temp = outputlist.remove(0);\n-                                    outputlist.add(temp);\n-                                }\n-\n+                    if (index < outputlist.size()) {\n+                        for (int i = 0; i < index; i++) {\n+                            Location temp = outputlist.remove(0);\n+                            outputlist.add(temp);\n+                        }\n                         index++;\n                     }\n                     else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxMTYxOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412211619", "bodyText": "maxSize would probably be a more sensible name for this variable here. \"inSlotMaxSize\" is rather unpleasant to read.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T14:01:54Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java", "diffHunk": "@@ -139,48 +141,50 @@ public static ItemStack insert(Block node, Block target, ItemStack stack, int in\n         if (!matchesFilter(node, stack, index)) return stack;\n \n         DirtyChestMenu menu = getChestMenu(target);\n+        if (menu == null) {\n+            if (BlockUtils.hasInventory(target)) {\n+                BlockState state = target.getState();\n+                if (state instanceof InventoryHolder) {\n+                    return insertIntoVanillaInventory(stack, ((InventoryHolder) state).getInventory());\n+                }\n+            }\n+            return stack;\n+        }\n \n-        if (menu != null) {\n-            ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n-\n-            for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n-                ItemStack is = menu.getItemInSlot(slot) == null ? null : menu.getItemInSlot(slot).clone();\n+        ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n \n-                if (is == null) {\n-                    menu.replaceExistingItem(slot, stack.clone());\n-                    return null;\n-                }\n-                else if (SlimefunUtils.isItemSimilar(new CustomItem(is, 1), wrapper, true) && is.getAmount() < is.getType().getMaxStackSize()) {\n-                    int amount = is.getAmount() + stack.getAmount();\n+        for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n+            ItemStack itemInSlot = menu.getItemInSlot(slot);\n+            if (itemInSlot == null) {\n+                menu.replaceExistingItem(slot, stack);\n+                return null;\n+            }\n \n-                    if (amount > is.getType().getMaxStackSize()) {\n-                        is.setAmount(is.getType().getMaxStackSize());\n-                        stack.setAmount(amount - is.getType().getMaxStackSize());\n-                    }\n-                    else {\n-                        is.setAmount(amount);\n-                        stack = null;\n-                    }\n+            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "81add1caa2466eb3978b1290417de94a3ef5cdc7", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\nindex 08a97bb2a..dac7740be 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n\n@@ -160,14 +160,14 @@ final class CargoUtils {\n                 return null;\n             }\n \n-            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n-            int inSlotAmount = itemInSlot.getAmount();\n-            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && inSlotAmount < inSlotMaxSize) {\n-                int amount = inSlotAmount + stack.getAmount();\n+            int maxStackSize = itemInSlot.getType().getMaxStackSize();\n+            int currentAmount = itemInSlot.getAmount();\n+            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && currentAmount < maxStackSize) {\n+                int amount = currentAmount + stack.getAmount();\n \n-                itemInSlot.setAmount(Math.max(amount, inSlotMaxSize));\n-                if (amount > inSlotMaxSize) {\n-                    stack.setAmount(amount - inSlotMaxSize);\n+                itemInSlot.setAmount(Math.min(amount, maxStackSize));\n+                if (amount > maxStackSize) {\n+                    stack.setAmount(amount - maxStackSize);\n                 }\n                 else {\n                     stack = null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxMTgwNA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412211804", "bodyText": "currentAmount  would probably be a more sensible name for this variable here. \"inSlotAmount\" is rather unpleasant to read.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T14:02:09Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java", "diffHunk": "@@ -139,48 +141,50 @@ public static ItemStack insert(Block node, Block target, ItemStack stack, int in\n         if (!matchesFilter(node, stack, index)) return stack;\n \n         DirtyChestMenu menu = getChestMenu(target);\n+        if (menu == null) {\n+            if (BlockUtils.hasInventory(target)) {\n+                BlockState state = target.getState();\n+                if (state instanceof InventoryHolder) {\n+                    return insertIntoVanillaInventory(stack, ((InventoryHolder) state).getInventory());\n+                }\n+            }\n+            return stack;\n+        }\n \n-        if (menu != null) {\n-            ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n-\n-            for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n-                ItemStack is = menu.getItemInSlot(slot) == null ? null : menu.getItemInSlot(slot).clone();\n+        ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n \n-                if (is == null) {\n-                    menu.replaceExistingItem(slot, stack.clone());\n-                    return null;\n-                }\n-                else if (SlimefunUtils.isItemSimilar(new CustomItem(is, 1), wrapper, true) && is.getAmount() < is.getType().getMaxStackSize()) {\n-                    int amount = is.getAmount() + stack.getAmount();\n+        for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n+            ItemStack itemInSlot = menu.getItemInSlot(slot);\n+            if (itemInSlot == null) {\n+                menu.replaceExistingItem(slot, stack);\n+                return null;\n+            }\n \n-                    if (amount > is.getType().getMaxStackSize()) {\n-                        is.setAmount(is.getType().getMaxStackSize());\n-                        stack.setAmount(amount - is.getType().getMaxStackSize());\n-                    }\n-                    else {\n-                        is.setAmount(amount);\n-                        stack = null;\n-                    }\n+            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n+            int inSlotAmount = itemInSlot.getAmount();", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "81add1caa2466eb3978b1290417de94a3ef5cdc7", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\nindex 08a97bb2a..dac7740be 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n\n@@ -160,14 +160,14 @@ final class CargoUtils {\n                 return null;\n             }\n \n-            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n-            int inSlotAmount = itemInSlot.getAmount();\n-            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && inSlotAmount < inSlotMaxSize) {\n-                int amount = inSlotAmount + stack.getAmount();\n+            int maxStackSize = itemInSlot.getType().getMaxStackSize();\n+            int currentAmount = itemInSlot.getAmount();\n+            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && currentAmount < maxStackSize) {\n+                int amount = currentAmount + stack.getAmount();\n \n-                itemInSlot.setAmount(Math.max(amount, inSlotMaxSize));\n-                if (amount > inSlotMaxSize) {\n-                    stack.setAmount(amount - inSlotMaxSize);\n+                itemInSlot.setAmount(Math.min(amount, maxStackSize));\n+                if (amount > maxStackSize) {\n+                    stack.setAmount(amount - maxStackSize);\n                 }\n                 else {\n                     stack = null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxMzI3NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412213274", "bodyText": "This should me Math.min, not Math.max\nsince now you are taking the maximum of the two which will make the amount potentially exceed the max size.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T14:03:50Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java", "diffHunk": "@@ -139,48 +141,50 @@ public static ItemStack insert(Block node, Block target, ItemStack stack, int in\n         if (!matchesFilter(node, stack, index)) return stack;\n \n         DirtyChestMenu menu = getChestMenu(target);\n+        if (menu == null) {\n+            if (BlockUtils.hasInventory(target)) {\n+                BlockState state = target.getState();\n+                if (state instanceof InventoryHolder) {\n+                    return insertIntoVanillaInventory(stack, ((InventoryHolder) state).getInventory());\n+                }\n+            }\n+            return stack;\n+        }\n \n-        if (menu != null) {\n-            ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n-\n-            for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n-                ItemStack is = menu.getItemInSlot(slot) == null ? null : menu.getItemInSlot(slot).clone();\n+        ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n \n-                if (is == null) {\n-                    menu.replaceExistingItem(slot, stack.clone());\n-                    return null;\n-                }\n-                else if (SlimefunUtils.isItemSimilar(new CustomItem(is, 1), wrapper, true) && is.getAmount() < is.getType().getMaxStackSize()) {\n-                    int amount = is.getAmount() + stack.getAmount();\n+        for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n+            ItemStack itemInSlot = menu.getItemInSlot(slot);\n+            if (itemInSlot == null) {\n+                menu.replaceExistingItem(slot, stack);\n+                return null;\n+            }\n \n-                    if (amount > is.getType().getMaxStackSize()) {\n-                        is.setAmount(is.getType().getMaxStackSize());\n-                        stack.setAmount(amount - is.getType().getMaxStackSize());\n-                    }\n-                    else {\n-                        is.setAmount(amount);\n-                        stack = null;\n-                    }\n+            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n+            int inSlotAmount = itemInSlot.getAmount();\n+            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && inSlotAmount < inSlotMaxSize) {\n+                int amount = inSlotAmount + stack.getAmount();\n \n-                    menu.replaceExistingItem(slot, is);\n-                    return stack;\n+                itemInSlot.setAmount(Math.max(amount, inSlotMaxSize));", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "81add1caa2466eb3978b1290417de94a3ef5cdc7", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\nindex 08a97bb2a..dac7740be 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n\n@@ -160,14 +160,14 @@ final class CargoUtils {\n                 return null;\n             }\n \n-            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n-            int inSlotAmount = itemInSlot.getAmount();\n-            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && inSlotAmount < inSlotMaxSize) {\n-                int amount = inSlotAmount + stack.getAmount();\n+            int maxStackSize = itemInSlot.getType().getMaxStackSize();\n+            int currentAmount = itemInSlot.getAmount();\n+            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && currentAmount < maxStackSize) {\n+                int amount = currentAmount + stack.getAmount();\n \n-                itemInSlot.setAmount(Math.max(amount, inSlotMaxSize));\n-                if (amount > inSlotMaxSize) {\n-                    stack.setAmount(amount - inSlotMaxSize);\n+                itemInSlot.setAmount(Math.min(amount, maxStackSize));\n+                if (amount > maxStackSize) {\n+                    stack.setAmount(amount - maxStackSize);\n                 }\n                 else {\n                     stack = null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxMzUxMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412213510", "bodyText": "Looks like you are missing a space there.", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T14:04:08Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java", "diffHunk": "@@ -139,48 +141,50 @@ public static ItemStack insert(Block node, Block target, ItemStack stack, int in\n         if (!matchesFilter(node, stack, index)) return stack;\n \n         DirtyChestMenu menu = getChestMenu(target);\n+        if (menu == null) {\n+            if (BlockUtils.hasInventory(target)) {\n+                BlockState state = target.getState();\n+                if (state instanceof InventoryHolder) {\n+                    return insertIntoVanillaInventory(stack, ((InventoryHolder) state).getInventory());\n+                }\n+            }\n+            return stack;\n+        }\n \n-        if (menu != null) {\n-            ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n-\n-            for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n-                ItemStack is = menu.getItemInSlot(slot) == null ? null : menu.getItemInSlot(slot).clone();\n+        ItemStackWrapper wrapper = new ItemStackWrapper(stack);\n \n-                if (is == null) {\n-                    menu.replaceExistingItem(slot, stack.clone());\n-                    return null;\n-                }\n-                else if (SlimefunUtils.isItemSimilar(new CustomItem(is, 1), wrapper, true) && is.getAmount() < is.getType().getMaxStackSize()) {\n-                    int amount = is.getAmount() + stack.getAmount();\n+        for (int slot : menu.getPreset().getSlotsAccessedByItemTransport(menu, ItemTransportFlow.INSERT, stack)) {\n+            ItemStack itemInSlot = menu.getItemInSlot(slot);\n+            if (itemInSlot == null) {\n+                menu.replaceExistingItem(slot, stack);\n+                return null;\n+            }\n \n-                    if (amount > is.getType().getMaxStackSize()) {\n-                        is.setAmount(is.getType().getMaxStackSize());\n-                        stack.setAmount(amount - is.getType().getMaxStackSize());\n-                    }\n-                    else {\n-                        is.setAmount(amount);\n-                        stack = null;\n-                    }\n+            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n+            int inSlotAmount = itemInSlot.getAmount();\n+            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && inSlotAmount < inSlotMaxSize) {\n+                int amount = inSlotAmount + stack.getAmount();\n \n-                    menu.replaceExistingItem(slot, is);\n-                    return stack;\n+                itemInSlot.setAmount(Math.max(amount, inSlotMaxSize));\n+                if (amount > inSlotMaxSize) {\n+                    stack.setAmount(amount - inSlotMaxSize);\n+                }\n+                else {\n+                    stack = null;\n                 }\n-            }\n-        }\n-        else {\n-            BlockState state = target.getState();\n \n-            if (state instanceof InventoryHolder) {\n-                return insertIntoVanillaInventory(stack, ((InventoryHolder) state).getInventory());\n+                menu.replaceExistingItem(slot, itemInSlot);\n+                return stack;\n             }\n         }\n \n         return stack;\n     }\n \n     private static ItemStack insertIntoVanillaInventory(ItemStack stack, Inventory inv) {\n-        int minSlot = 0;\n-        int maxSlot = inv.getContents().length;\n+        ItemStack[] contents = inv.getContents();\n+    \tint minSlot = 0;", "originalCommit": "70b5a5a9d188e5055026d29682591c3dfcc7d152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "81add1caa2466eb3978b1290417de94a3ef5cdc7", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\nindex 08a97bb2a..dac7740be 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoUtils.java\n\n@@ -160,14 +160,14 @@ final class CargoUtils {\n                 return null;\n             }\n \n-            int inSlotMaxSize = itemInSlot.getType().getMaxStackSize();\n-            int inSlotAmount = itemInSlot.getAmount();\n-            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && inSlotAmount < inSlotMaxSize) {\n-                int amount = inSlotAmount + stack.getAmount();\n+            int maxStackSize = itemInSlot.getType().getMaxStackSize();\n+            int currentAmount = itemInSlot.getAmount();\n+            if (SlimefunUtils.isItemSimilar(itemInSlot, wrapper, true, false) && currentAmount < maxStackSize) {\n+                int amount = currentAmount + stack.getAmount();\n \n-                itemInSlot.setAmount(Math.max(amount, inSlotMaxSize));\n-                if (amount > inSlotMaxSize) {\n-                    stack.setAmount(amount - inSlotMaxSize);\n+                itemInSlot.setAmount(Math.min(amount, maxStackSize));\n+                if (amount > maxStackSize) {\n+                    stack.setAmount(amount - maxStackSize);\n                 }\n                 else {\n                     stack = null;\n"}}, {"oid": "92e8aa955b456ade85da1a5a090d9c7476373ff0", "url": "https://github.com/Slimefun/Slimefun4/commit/92e8aa955b456ade85da1a5a090d9c7476373ff0", "message": "- Get the tick delay value directly in method\n- Added comment to explain how the skipping ticks work", "committedDate": "2020-04-21T23:16:03Z", "type": "commit"}, {"oid": "2a22eebd8ae7d304fd2d3d0efe1d03e6a9a91623", "url": "https://github.com/Slimefun/Slimefun4/commit/2a22eebd8ae7d304fd2d3d0efe1d03e6a9a91623", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4\n\n\u0001 Conflicts:\n\u0001\tpom.xml", "committedDate": "2020-04-21T23:16:35Z", "type": "commit"}, {"oid": "81add1caa2466eb3978b1290417de94a3ef5cdc7", "url": "https://github.com/Slimefun/Slimefun4/commit/81add1caa2466eb3978b1290417de94a3ef5cdc7", "message": "code cleanup", "committedDate": "2020-04-21T23:18:42Z", "type": "commit"}, {"oid": "034ff1948a51d7392d8ad40e45bd2fe058e2ca4d", "url": "https://github.com/Slimefun/Slimefun4/commit/034ff1948a51d7392d8ad40e45bd2fe058e2ca4d", "message": "missed a spot", "committedDate": "2020-04-21T23:32:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU2NjczMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412566730", "bodyText": "I just told you to NOT do that...", "author": "TheBusyBiscuit", "createdAt": "2020-04-21T23:44:26Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java", "diffHunk": "@@ -175,6 +176,14 @@ private void run(Block b, Set<Location> destinations, Map<Integer, List<Location\n             display();\n         }\n \n+        // Skip ticking if the threshold is not reached. The delay is not same as minecraft tick,\n+        // but it's based on 'custom-ticker-delay' config.\n+        if (tickDelayThreshold < SlimefunPlugin.getCfg().getInt(\"URID.cargo-network-tick-delay\")) {", "originalCommit": "034ff1948a51d7392d8ad40e45bd2fe058e2ca4d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5cf0487cb7a4c880fa2d5777cc584e9ebb0ceb37", "chunk": "diff --git a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\nindex 3678e81c7..3a4e4c65d 100644\n--- a/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n+++ b/src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/CargoNet.java\n\n@@ -178,7 +179,7 @@ public class CargoNet extends ChestTerminalNetwork {\n \n         // Skip ticking if the threshold is not reached. The delay is not same as minecraft tick,\n         // but it's based on 'custom-ticker-delay' config.\n-        if (tickDelayThreshold < SlimefunPlugin.getCfg().getInt(\"URID.cargo-network-tick-delay\")) {\n+        if (tickDelayThreshold < TICK_DELAY) {\n             tickDelayThreshold++;\n             return;\n         }\n"}}, {"oid": "5cf0487cb7a4c880fa2d5777cc584e9ebb0ceb37", "url": "https://github.com/Slimefun/Slimefun4/commit/5cf0487cb7a4c880fa2d5777cc584e9ebb0ceb37", "message": "Moved the tick delay value into static constant", "committedDate": "2020-04-22T00:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk3NzUwMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/1790#discussion_r412977502", "bodyText": "Check if it's a normal SHULKER_BOX and then ends with _SHULKER_BOX. Slight performance improvement for the basic shulker.", "author": "WalshyDev", "createdAt": "2020-04-22T13:22:47Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/networks/cargo/BlockUtils.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package io.github.thebusybiscuit.slimefun4.core.networks.cargo;\n+\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+import org.bukkit.Material;\n+import org.bukkit.block.Block;\n+\n+final class BlockUtils {\n+\n+    private BlockUtils() {}\n+\n+    public static boolean hasInventory(Block block) {\n+        if (block == null) return false;\n+\n+        Material type = block.getType();\n+        switch (type) {\n+            case CHEST:\n+            case TRAPPED_CHEST:\n+            case FURNACE:\n+            case DISPENSER:\n+            case DROPPER:\n+            case HOPPER:\n+            case BREWING_STAND:\n+                return true;\n+            default:\n+                if (type.name().endsWith(\"SHULKER_BOX\")) return true;", "originalCommit": "5cf0487cb7a4c880fa2d5777cc584e9ebb0ceb37", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}