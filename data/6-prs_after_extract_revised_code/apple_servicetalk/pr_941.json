{"pr_number": 941, "pr_title": "Use `payloadBodyAndTrailers()` to drain payload body", "pr_createdAt": "2020-02-17T17:05:04Z", "pr_url": "https://github.com/apple/servicetalk/pull/941", "timeline": [{"oid": "ef5a58de1f30da1a9c2289e63096eccc2b6dc751", "url": "https://github.com/apple/servicetalk/commit/ef5a58de1f30da1a9c2289e63096eccc2b6dc751", "message": "Use `payloadBodyAndTrailers()` to drain payload body\n\nMotivation:\n\nIn some cases we need to consume payload body and trailers.\nWe usually use `payloadBody().ignoreElements()` pattern.\nHowever, since the request or response comes from the network,\nit's more efficient to do `payloadBodyAndTrailers().ignoreElements()`\nto avoid splitting trailers from payload body.\n\nModifications:\n\n- Replace all `payloadBody().ignoreElements()` usages with\n`payloadBodyAndTrailers().ignoreElements()`;\n- Do the same in tests for consistency;\n- Update `performance.adoc` to demonstrate `payloadBodyAndTrailers`\nfor the draining use-case;\n\nResult:\n\nLess overhead when we need to drain payload body.", "committedDate": "2020-02-15T01:52:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NTc3MQ==", "url": "https://github.com/apple/servicetalk/pull/941#discussion_r380855771", "bodyText": "120", "author": "NiteshKant", "createdAt": "2020-02-18T18:30:00Z", "path": "servicetalk-http-router-jersey/src/testFixtures/java/io/servicetalk/http/router/jersey/CancellationTest.java", "diffHunk": "@@ -239,7 +239,7 @@ public void onSuccess(@Nullable final StreamingHttpResponse result) {\n                         errorRef.compareAndSet(null, new NullPointerException(\"result == null not expected.\"));\n                         cancelledLatch.countDown();\n                     } else {\n-                        result.payloadBody().ignoreElements().afterFinally(cancelledLatch::countDown).subscribe();\n+                        result.payloadBodyAndTrailers().ignoreElements().afterFinally(cancelledLatch::countDown).subscribe();", "originalCommit": "ef5a58de1f30da1a9c2289e63096eccc2b6dc751", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "38582abc7470800f2d37ba7f6ca6596b380cee63", "chunk": "diff --git a/servicetalk-http-router-jersey/src/testFixtures/java/io/servicetalk/http/router/jersey/CancellationTest.java b/servicetalk-http-router-jersey/src/testFixtures/java/io/servicetalk/http/router/jersey/CancellationTest.java\nindex 1beab1583..d77580c8f 100644\n--- a/servicetalk-http-router-jersey/src/testFixtures/java/io/servicetalk/http/router/jersey/CancellationTest.java\n+++ b/servicetalk-http-router-jersey/src/testFixtures/java/io/servicetalk/http/router/jersey/CancellationTest.java\n\n@@ -239,7 +239,8 @@ public class CancellationTest {\n                         errorRef.compareAndSet(null, new NullPointerException(\"result == null not expected.\"));\n                         cancelledLatch.countDown();\n                     } else {\n-                        result.payloadBodyAndTrailers().ignoreElements().afterFinally(cancelledLatch::countDown).subscribe();\n+                        result.payloadBodyAndTrailers().ignoreElements().afterFinally(cancelledLatch::countDown)\n+                                .subscribe();\n                     }\n                 }\n \n"}}, {"oid": "38582abc7470800f2d37ba7f6ca6596b380cee63", "url": "https://github.com/apple/servicetalk/commit/38582abc7470800f2d37ba7f6ca6596b380cee63", "message": "fix checkstyle", "committedDate": "2020-02-18T18:34:46Z", "type": "commit"}]}