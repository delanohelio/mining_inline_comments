{"pr_number": 2391, "pr_title": "2220: Improving Image Null and Invalid Checks", "pr_createdAt": "2020-11-10T18:31:57Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2391", "timeline": [{"oid": "51d8d6daf8784000f260375463818163c904d27a", "url": "https://github.com/MegaMek/megamek/commit/51d8d6daf8784000f260375463818163c904d27a", "message": "Swapping to abstract to provide generic support and added null/empty check", "committedDate": "2020-11-10T18:26:37Z", "type": "commit"}, {"oid": "f44441b28b2c2dc4fb28fb823162d388bce5d338", "url": "https://github.com/MegaMek/megamek/commit/f44441b28b2c2dc4fb28fb823162d388bce5d338", "message": "Null or invalid file validation additions", "committedDate": "2020-11-10T18:26:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MDk5MA==", "url": "https://github.com/MegaMek/megamek/pull/2391#discussion_r520780990", "bodyText": "I'd recommend < 0", "author": "NickAragua", "createdAt": "2020-11-10T18:33:03Z", "path": "megamek/src/megamek/common/util/ImageUtil.java", "diffHunk": "@@ -211,10 +207,13 @@ public Image loadImage(String fileName) {\n                 return null;\n             }\n             Image result = Toolkit.getDefaultToolkit().getImage(fileName);\n-            if(null == result) {\n+            if (result == null) {\n+                return null;\n+            }\n+            final boolean isAnimated = waitUntilLoaded(result);\n+            if ((result.getWidth(null) == -1) || (result.getHeight(null) == -1)) {", "originalCommit": "f44441b28b2c2dc4fb28fb823162d388bce5d338", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4NTA0Mw==", "url": "https://github.com/MegaMek/megamek/pull/2391#discussion_r520785043", "bodyText": "The choice was based on the JavaDoc comment in Image::getWidth and Image::getHeight, but it cannot be less than 0 so that's a better way to handle it. Flipped over.", "author": "Windchild292", "createdAt": "2020-11-10T18:40:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MDk5MA=="}], "type": "inlineReview", "revised_code": {"commit": "f3e0e1a8e7f71e762f57b3496b8a3e00f1318ab9", "chunk": "diff --git a/megamek/src/megamek/common/util/ImageUtil.java b/megamek/src/megamek/common/util/ImageUtil.java\nindex b18308455b..9dbbf3ab78 100644\n--- a/megamek/src/megamek/common/util/ImageUtil.java\n+++ b/megamek/src/megamek/common/util/ImageUtil.java\n\n@@ -211,7 +211,7 @@ public final class ImageUtil {\n                 return null;\n             }\n             final boolean isAnimated = waitUntilLoaded(result);\n-            if ((result.getWidth(null) == -1) || (result.getHeight(null) == -1)) {\n+            if ((result.getWidth(null) < 0) || (result.getHeight(null) < 0)) {\n                 return null;\n             }\n             return isAnimated ? result : ImageUtil.createAcceleratedImage(result);\n"}}, {"oid": "f3e0e1a8e7f71e762f57b3496b8a3e00f1318ab9", "url": "https://github.com/MegaMek/megamek/commit/f3e0e1a8e7f71e762f57b3496b8a3e00f1318ab9", "message": "Applying changes as per review", "committedDate": "2020-11-10T18:40:13Z", "type": "commit"}]}