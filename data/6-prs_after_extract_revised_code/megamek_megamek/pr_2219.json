{"pr_number": 2219, "pr_title": "Track ammo for small support vehicles", "pr_createdAt": "2020-09-14T02:51:17Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2219", "timeline": [{"oid": "bc83ccba857988661d99611d8f016251c5195547", "url": "https://github.com/MegaMek/megamek/commit/bc83ccba857988661d99611d8f016251c5195547", "message": "Ammo stats for infantry pistol weapons.", "committedDate": "2020-06-11T03:47:51Z", "type": "commit"}, {"oid": "d9a5e96629a302dd8e68426636c8ac22dd0a5391", "url": "https://github.com/MegaMek/megamek/commit/d9a5e96629a302dd8e68426636c8ac22dd0a5391", "message": "Ammo stats for infantry rifles.", "committedDate": "2020-06-11T15:07:55Z", "type": "commit"}, {"oid": "01c30f72d13d49651413daa9e157500197730caf", "url": "https://github.com/MegaMek/megamek/commit/01c30f72d13d49651413daa9e157500197730caf", "message": "Ammo stats for infantry shotguns and submachine guns.", "committedDate": "2020-06-11T15:25:35Z", "type": "commit"}, {"oid": "48714f968d61e763f9d9b3bdae329121d2cca239", "url": "https://github.com/MegaMek/megamek/commit/48714f968d61e763f9d9b3bdae329121d2cca239", "message": "Ammo stats for infantry support weapons.", "committedDate": "2020-06-11T16:18:09Z", "type": "commit"}, {"oid": "9cbb13f05ca084bf6ab7aaba3995e033c5958c6e", "url": "https://github.com/MegaMek/megamek/commit/9cbb13f05ca084bf6ab7aaba3995e033c5958c6e", "message": "Infantry weapon ammo costs.", "committedDate": "2020-06-11T18:42:43Z", "type": "commit"}, {"oid": "aee014e2c7aa5a631764344b35e008a624d60f5a", "url": "https://github.com/MegaMek/megamek/commit/aee014e2c7aa5a631764344b35e008a624d60f5a", "message": "Added SmallWeaponAmmoType.java", "committedDate": "2020-06-13T15:07:42Z", "type": "commit"}, {"oid": "b436d03e4b902e52a555433f872e2c178c1b5589", "url": "https://github.com/MegaMek/megamek/commit/b436d03e4b902e52a555433f872e2c178c1b5589", "message": "Merge branch 'master' into small_sv_ammo", "committedDate": "2020-08-11T01:01:59Z", "type": "commit"}, {"oid": "c7a57418dbd1362ff48123b9cd612be501d80084", "url": "https://github.com/MegaMek/megamek/commit/c7a57418dbd1362ff48123b9cd612be501d80084", "message": "Allow simple check for infantry weapon to find inferno and standard variants.\n\nSwitched internal names so inferno variant internal name is standard + \"Inferno\"", "committedDate": "2020-08-11T02:46:53Z", "type": "commit"}, {"oid": "2bb5ebdb4c2573b065b26f416671bbcb68687273", "url": "https://github.com/MegaMek/megamek/commit/2bb5ebdb4c2573b065b26f416671bbcb68687273", "message": "Save number of clips of S/M weapon ammo as mount size.", "committedDate": "2020-08-12T00:37:36Z", "type": "commit"}, {"oid": "1e7193169d2c72d7a557df6ca7a064a7ae56381c", "url": "https://github.com/MegaMek/megamek/commit/1e7193169d2c72d7a557df6ca7a064a7ae56381c", "message": "Include small SV ammo in weight calculation.", "committedDate": "2020-08-15T17:11:14Z", "type": "commit"}, {"oid": "e0de2cf4b1717fae5595cbeeb46c8b81479dddb3", "url": "https://github.com/MegaMek/megamek/commit/e0de2cf4b1717fae5595cbeeb46c8b81479dddb3", "message": "Include small SV ammo in cost calculation.", "committedDate": "2020-08-15T17:16:57Z", "type": "commit"}, {"oid": "dde22ed9aaa425542fdbedf5c2565142d03e67b2", "url": "https://github.com/MegaMek/megamek/commit/dde22ed9aaa425542fdbedf5c2565142d03e67b2", "message": "Add ammo for small SVs when weapon is added.", "committedDate": "2020-08-30T18:37:18Z", "type": "commit"}, {"oid": "f8ecf32ad6509eba174e2d590a7319568b6c98cb", "url": "https://github.com/MegaMek/megamek/commit/f8ecf32ad6509eba174e2d590a7319568b6c98cb", "message": "Add small SV ammo to TRO view.", "committedDate": "2020-08-30T19:15:58Z", "type": "commit"}, {"oid": "656b348f6e18b6d94e4a2992d4cb2762a8aa9fd0", "url": "https://github.com/MegaMek/megamek/commit/656b348f6e18b6d94e4a2992d4cb2762a8aa9fd0", "message": "Add small SV ammo to MechView.", "committedDate": "2020-08-30T20:07:01Z", "type": "commit"}, {"oid": "a094bd6b0392fe75ce99eaa5433211197f2ad3ec", "url": "https://github.com/MegaMek/megamek/commit/a094bd6b0392fe75ce99eaa5433211197f2ad3ec", "message": "Show available ammo for light and medium weapons in weapon panel of unit view.", "committedDate": "2020-08-31T02:31:32Z", "type": "commit"}, {"oid": "71285aac4bcdeabde0f13e43d826ac2859ad7350", "url": "https://github.com/MegaMek/megamek/commit/71285aac4bcdeabde0f13e43d826ac2859ad7350", "message": "Expend small support vehicle ammo.", "committedDate": "2020-08-31T03:10:11Z", "type": "commit"}, {"oid": "6c2ef89c5cf5e5f8cfbd8f380e9ee5c01a0d71d3", "url": "https://github.com/MegaMek/megamek/commit/6c2ef89c5cf5e5f8cfbd8f380e9ee5c01a0d71d3", "message": "Apply style standards to WeaponAmmoChoicePanel", "committedDate": "2020-08-31T13:52:22Z", "type": "commit"}, {"oid": "0b27eb8ef317f71a954d30d4746b28cab202f703", "url": "https://github.com/MegaMek/megamek/commit/0b27eb8ef317f71a954d30d4746b28cab202f703", "message": "Allow splitting clips beteen standard and inferno ammo.", "committedDate": "2020-09-05T18:54:17Z", "type": "commit"}, {"oid": "abfd5350bc2ab84ae69113cba5566445a0960175", "url": "https://github.com/MegaMek/megamek/commit/abfd5350bc2ab84ae69113cba5566445a0960175", "message": "Allow selecting small SV inferno ammo at start.", "committedDate": "2020-09-05T19:18:40Z", "type": "commit"}, {"oid": "c598b825454945029ce44fb059f1d47addb39bd2", "url": "https://github.com/MegaMek/megamek/commit/c598b825454945029ce44fb059f1d47addb39bd2", "message": "Apply small SV starting munition selection.", "committedDate": "2020-09-05T19:32:36Z", "type": "commit"}, {"oid": "fbe5fc089a23455ea007d30a4adf0229cf92d413", "url": "https://github.com/MegaMek/megamek/commit/fbe5fc089a23455ea007d30a4adf0229cf92d413", "message": "Enable switching between standard and inferno ammo during combat.", "committedDate": "2020-09-06T18:27:27Z", "type": "commit"}, {"oid": "4a092c2ea5ffe3f1e33a444536238c12a0c1fb44", "url": "https://github.com/MegaMek/megamek/commit/4a092c2ea5ffe3f1e33a444536238c12a0c1fb44", "message": "Treat SVs using infantry inferno ammo as being in heat mode.", "committedDate": "2020-09-07T04:57:29Z", "type": "commit"}, {"oid": "31838d001489844c954427ac023f9252a3c79244", "url": "https://github.com/MegaMek/megamek/commit/31838d001489844c954427ac023f9252a3c79244", "message": "Show inferno ammo munition type in report.", "committedDate": "2020-09-07T05:17:23Z", "type": "commit"}, {"oid": "3019c20070d315352b784eb310d74fed74e20597", "url": "https://github.com/MegaMek/megamek/commit/3019c20070d315352b784eb310d74fed74e20597", "message": "Fix double use of inferno ammo.", "committedDate": "2020-09-07T05:25:29Z", "type": "commit"}, {"oid": "6faf621dd5a8ed002047e130103eb905769dbbef", "url": "https://github.com/MegaMek/megamek/commit/6faf621dd5a8ed002047e130103eb905769dbbef", "message": "Merge remote-tracking branch 'origin/master' into small_sv_ammo", "committedDate": "2020-09-07T14:48:30Z", "type": "commit"}, {"oid": "16c1361d9fd297407959a03e9488c78a3e627fa7", "url": "https://github.com/MegaMek/megamek/commit/16c1361d9fd297407959a03e9488c78a3e627fa7", "message": "Merge remote-tracking branch 'origin/master' into small_sv_ammo", "committedDate": "2020-09-07T19:57:52Z", "type": "commit"}, {"oid": "1124d5b699bc384413ace69ec55e3841e6ae2300", "url": "https://github.com/MegaMek/megamek/commit/1124d5b699bc384413ace69ec55e3841e6ae2300", "message": "Fix some validation issues with small SV ammo.", "committedDate": "2020-09-12T19:56:41Z", "type": "commit"}, {"oid": "8454a98a5ae77c1af97a184153fdd493cd0c3b4b", "url": "https://github.com/MegaMek/megamek/commit/8454a98a5ae77c1af97a184153fdd493cd0c3b4b", "message": "Set ammo bin size on RRV.", "committedDate": "2020-09-12T20:09:24Z", "type": "commit"}, {"oid": "b4f91631f8d6750fa95eaf1e2e1908068f05705e", "url": "https://github.com/MegaMek/megamek/commit/b4f91631f8d6750fa95eaf1e2e1908068f05705e", "message": "Show shot count on small SV TRO display.", "committedDate": "2020-09-13T21:51:24Z", "type": "commit"}, {"oid": "91f60d6deea4a92a93b955d1dbdeab4648ed1c1e", "url": "https://github.com/MegaMek/megamek/commit/91f60d6deea4a92a93b955d1dbdeab4648ed1c1e", "message": "Record infantry ammo expenditure for small SVs in MUL file.", "committedDate": "2020-09-14T02:25:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0MDc0MA==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r487640740", "bodyText": "What happened to this poor thing?", "author": "NickAragua", "createdAt": "2020-09-14T04:08:26Z", "path": "megamek/src/megamek/common/weapons/infantry/InfantryPistoMachinePistolSPEC7AWeapon.java", "diffHunk": "@@ -1,51 +0,0 @@\n-/**\n- * MegaMek - Copyright (C) 2004,2005 Ben Mazur (bmazur@sev.org)", "originalCommit": "91f60d6deea4a92a93b955d1dbdeab4648ed1c1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMzNDMzMQ==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r488334331", "bodyText": "I don't remember deleting it, but it looks like it's a duplicate of InfantryPistolSMGGHTSpec7aWeapon, so I probably kept the one that was spelled correctly.", "author": "neoancient", "createdAt": "2020-09-15T01:51:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0MDc0MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0MDg5MQ==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r487640891", "bodyText": "Out of curiosity, where's this data come from?", "author": "NickAragua", "createdAt": "2020-09-14T04:09:01Z", "path": "megamek/src/megamek/common/weapons/infantry/InfantryPistolISPulseLaserPistolWeapon.java", "diffHunk": "@@ -36,13 +36,16 @@ public InfantryPistolISPulseLaserPistolWeapon() {\n \t\tsetInternalName(name);\n \t\taddLookupName(\"InfantryPulseLaserpistol\");\n \t\taddLookupName(\"Pulse Laser Pistol\");\n-\t\tammoType = AmmoType.T_NA;\n+\t\tammoType = AmmoType.T_INFANTRY;\n \t\tcost = 1000;\n \t\tbv = 0.13;\n \t\ttonnage = .001;\n \t\tflags = flags.or(F_NO_FIRES).or(F_DIRECT_FIRE).or(F_ENERGY);\n \t\tinfantryDamage = 0.14;\n \t\tinfantryRange = 0;\n+\t\tammoWeight = 0.0003;", "originalCommit": "91f60d6deea4a92a93b955d1dbdeab4648ed1c1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMzNDQxNQ==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r488334415", "bodyText": "The infantry weapon tables in TM.", "author": "neoancient", "createdAt": "2020-09-15T01:51:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0MDg5MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4MTQxMA==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r487981410", "bodyText": "Chain-linked ammo bins?", "author": "NickAragua", "createdAt": "2020-09-14T14:35:07Z", "path": "megamek/src/megamek/common/MechView.java", "diffHunk": "@@ -911,6 +912,30 @@ private ViewElement getAmmo() {\n                 ammoTable.addRow(row);\n             }\n         }\n+        if (entity.getWeightClass() == EntityWeightClass.WEIGHT_SMALL_SUPPORT) {\n+            for (Mounted mounted : entity.getWeaponList()) {\n+                String[] row = {mounted.getName(),\n+                        entity.getLocationAbbr(mounted.getLocation()),\n+                        String.valueOf((int) mounted.getSize() * ((InfantryWeapon) mounted.getType()).getShots()),\n+                        \"\"};\n+                if (entity.isOmni()) {\n+                    row[3] = mounted.isOmniPodMounted() ?\n+                            Messages.getString(\"MechView.Pod\") : //$NON-NLS-1$\n+                            Messages.getString(\"MechView.Fixed\"); //$NON-NLS-1$\n+                }\n+                int shotsLeft = 0;\n+                for (Mounted current = mounted.getLinked(); current != null; current = current.getLinked()) {", "originalCommit": "91f60d6deea4a92a93b955d1dbdeab4648ed1c1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMzNDg1Ng==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r488334856", "bodyText": "As mentioned in the PR description, the way I handled alternate munitions that can only be used by one weapon is to chain link them. So weapons that have alternate inferno ammo get two bins.", "author": "neoancient", "createdAt": "2020-09-15T01:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4MTQxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMzNTAwOA==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r488335008", "bodyText": "This code is agnostic. It works regardless of the number of bins linked to the weapon.", "author": "neoancient", "createdAt": "2020-09-15T01:53:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4MTQxMA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4MzM3NA==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r487983374", "bodyText": "The interior of this if block looks almost identical to the one in the TROView - 1, any reason why the # shots isn't displayed in the TRO view, and 2, any chance to unify this logic?", "author": "NickAragua", "createdAt": "2020-09-14T14:37:44Z", "path": "megamek/src/megamek/common/templates/SupportVeeTROView.java", "diffHunk": "@@ -191,8 +192,21 @@ protected int addEquipment(Entity entity) {\n                 }\n                 fields.put(\"tonnage\", adjustWeight(eq.getTonnage(entity, entry.getKey().getSize()) * count));\n                 fields.put(\"location\", loc);\n-                fields.put(\"slots\", eq.getCriticals(entity, entry.getValue()) * count);\n+                fields.put(\"slots\", eq.getSupportVeeSlots(entity) * count);\n                 weaponList.add(fields);\n+                if (eq instanceof InfantryWeapon) {\n+                    Map<String, Object> ammoFields = new HashMap<>();", "originalCommit": "91f60d6deea4a92a93b955d1dbdeab4648ed1c1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMzNzQ1MA==", "url": "https://github.com/MegaMek/megamek/pull/2219#discussion_r488337450", "bodyText": "The method in TROView never gets called for support vehicles. I think what happened is that I started reworking TROView then realized that some differences in logic would require overriding it, but never removed the extra code from the parent class. This is what comes of working in 10-15 minute sessions with several days between.", "author": "neoancient", "createdAt": "2020-09-15T02:02:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4MzM3NA=="}], "type": "inlineReview", "revised_code": {"commit": "f9348e070e5ab3d44f4298cd46cd59c7fa8834a6", "chunk": "diff --git a/megamek/src/megamek/common/templates/SupportVeeTROView.java b/megamek/src/megamek/common/templates/SupportVeeTROView.java\nindex 8b883633af..47cc52263f 100644\n--- a/megamek/src/megamek/common/templates/SupportVeeTROView.java\n+++ b/megamek/src/megamek/common/templates/SupportVeeTROView.java\n\n@@ -194,7 +194,7 @@ public class SupportVeeTROView extends TROView {\n                 fields.put(\"location\", loc);\n                 fields.put(\"slots\", eq.getSupportVeeSlots(entity) * count);\n                 weaponList.add(fields);\n-                if (eq instanceof InfantryWeapon) {\n+                if ((eq instanceof InfantryWeapon) && includeAmmo) {\n                     Map<String, Object> ammoFields = new HashMap<>();\n                     name += \" Ammo (\" + (entry.getValue() * ((InfantryWeapon) eq).getShots()) + \" shots)\";\n                     ammoFields.put(\"name\", name);\n"}}, {"oid": "0213fa6fcc9f9cef33ba29f57602b186b036aaca", "url": "https://github.com/MegaMek/megamek/commit/0213fa6fcc9f9cef33ba29f57602b186b036aaca", "message": "Remove duplicated code.", "committedDate": "2020-09-15T02:15:09Z", "type": "commit"}, {"oid": "f9348e070e5ab3d44f4298cd46cd59c7fa8834a6", "url": "https://github.com/MegaMek/megamek/commit/f9348e070e5ab3d44f4298cd46cd59c7fa8834a6", "message": "Override general version of method.", "committedDate": "2020-09-15T02:15:31Z", "type": "commit"}]}