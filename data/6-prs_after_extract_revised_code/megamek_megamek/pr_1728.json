{"pr_number": 1728, "pr_title": "Windchild's Personnel Improvements", "pr_createdAt": "2020-02-29T04:12:53Z", "pr_url": "https://github.com/MegaMek/megamek/pull/1728", "timeline": [{"oid": "8b3354036e2b77d4b7f93dd2d02935fd272374cc", "url": "https://github.com/MegaMek/megamek/commit/8b3354036e2b77d4b7f93dd2d02935fd272374cc", "message": "Adding new random name generator functions with split Given Name and Surname", "committedDate": "2020-02-05T17:37:26Z", "type": "commit"}, {"oid": "5b3bf35aa2d8a558e3ee086424e0d6b4aca2c92a", "url": "https://github.com/MegaMek/megamek/commit/5b3bf35aa2d8a558e3ee086424e0d6b4aca2c92a", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-06T18:09:09Z", "type": "commit"}, {"oid": "e6784741eb9e98a538500be0f201b45f29303374", "url": "https://github.com/MegaMek/megamek/commit/e6784741eb9e98a538500be0f201b45f29303374", "message": "Adding generateGivenNameSurnameSplit() to handle unspecified gender", "committedDate": "2020-02-06T19:59:53Z", "type": "commit"}, {"oid": "e29aae858b52794bdfb552fe94753e2d5c15633f", "url": "https://github.com/MegaMek/megamek/commit/e29aae858b52794bdfb552fe94753e2d5c15633f", "message": "Adding extradata to Crew file", "committedDate": "2020-02-13T20:02:54Z", "type": "commit"}, {"oid": "9391785f90da33acbd853ea8c59f6025cb955324", "url": "https://github.com/MegaMek/megamek/commit/9391785f90da33acbd853ea8c59f6025cb955324", "message": "Removing unused import call", "committedDate": "2020-02-13T20:51:51Z", "type": "commit"}, {"oid": "10f1b036d1072e9aa88b9089d269b6996fbcee15", "url": "https://github.com/MegaMek/megamek/commit/10f1b036d1072e9aa88b9089d269b6996fbcee15", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-15T15:52:33Z", "type": "commit"}, {"oid": "f8ac9fce01500d00d915c69abc6cbb3f13c55699", "url": "https://github.com/MegaMek/megamek/commit/f8ac9fce01500d00d915c69abc6cbb3f13c55699", "message": "Adding gender tracking to MegaMek", "committedDate": "2020-02-15T20:46:43Z", "type": "commit"}, {"oid": "59572dda4ca9d20f4d2fdfaec710a9e610b58816", "url": "https://github.com/MegaMek/megamek/commit/59572dda4ca9d20f4d2fdfaec710a9e610b58816", "message": "Removing unused methods in Crew", "committedDate": "2020-02-15T20:58:45Z", "type": "commit"}, {"oid": "89150b411bb256d59f3af391ec0538883be5428b", "url": "https://github.com/MegaMek/megamek/commit/89150b411bb256d59f3af391ec0538883be5428b", "message": "Adding WeightedMap to MegaMek/Util", "committedDate": "2020-02-16T19:44:44Z", "type": "commit"}, {"oid": "f28cd41833241e2e012da53873225d8d80cd51de", "url": "https://github.com/MegaMek/megamek/commit/f28cd41833241e2e012da53873225d8d80cd51de", "message": "Fixes from review", "committedDate": "2020-02-17T01:28:19Z", "type": "commit"}, {"oid": "0397ad76c8238c893986d48dc9b8b2b3c6394cc4", "url": "https://github.com/MegaMek/megamek/commit/0397ad76c8238c893986d48dc9b8b2b3c6394cc4", "message": "Merge branch 'dev_Windchild_NamesTrim' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-17T02:15:06Z", "type": "commit"}, {"oid": "7680249b7e6ee199ea82ab863dc9f0305b1c8ef8", "url": "https://github.com/MegaMek/megamek/commit/7680249b7e6ee199ea82ab863dc9f0305b1c8ef8", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-17T02:49:23Z", "type": "commit"}, {"oid": "733207384c282b305176881b4cd8f2086ee9f881", "url": "https://github.com/MegaMek/megamek/commit/733207384c282b305176881b4cd8f2086ee9f881", "message": "Refactoring in MULParser", "committedDate": "2020-02-17T02:57:28Z", "type": "commit"}, {"oid": "b54edb60a390f5b15ec016229db18f7352f521b7", "url": "https://github.com/MegaMek/megamek/commit/b54edb60a390f5b15ec016229db18f7352f521b7", "message": "Refactoring in MULParser", "committedDate": "2020-02-17T03:01:24Z", "type": "commit"}, {"oid": "669fd852e154381770e459db5b2a0b857bff1a9c", "url": "https://github.com/MegaMek/megamek/commit/669fd852e154381770e459db5b2a0b857bff1a9c", "message": "Writing extraData to file", "committedDate": "2020-02-17T03:11:25Z", "type": "commit"}, {"oid": "254961111efebfb73344a1cedc6c058e98372935", "url": "https://github.com/MegaMek/megamek/commit/254961111efebfb73344a1cedc6c058e98372935", "message": "Adding extraData to MULParser", "committedDate": "2020-02-17T03:25:35Z", "type": "commit"}, {"oid": "fb93d0692aae759f1b4e4716b3fc0d5eb928f92e", "url": "https://github.com/MegaMek/megamek/commit/fb93d0692aae759f1b4e4716b3fc0d5eb928f92e", "message": "Fixing merge conflicts", "committedDate": "2020-02-17T03:27:50Z", "type": "commit"}, {"oid": "58b5e70335fd873dd8242d95d4139194b092a5e1", "url": "https://github.com/MegaMek/megamek/commit/58b5e70335fd873dd8242d95d4139194b092a5e1", "message": "Fixing extraData write to XML", "committedDate": "2020-02-17T15:23:18Z", "type": "commit"}, {"oid": "1cf0bf2ab396e21d6b91ac6a318548266ff04642", "url": "https://github.com/MegaMek/megamek/commit/1cf0bf2ab396e21d6b91ac6a318548266ff04642", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-17T15:23:47Z", "type": "commit"}, {"oid": "24e807124fabe89ab63dd5e7792e02c753bbfcde", "url": "https://github.com/MegaMek/megamek/commit/24e807124fabe89ab63dd5e7792e02c753bbfcde", "message": "Fixing gender in MegaMek and deprecating older Crew constructors", "committedDate": "2020-02-18T05:40:37Z", "type": "commit"}, {"oid": "d5a45453ac2216742c689d1f1ed1699fa13f9ac6", "url": "https://github.com/MegaMek/megamek/commit/d5a45453ac2216742c689d1f1ed1699fa13f9ac6", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-24T14:09:02Z", "type": "commit"}, {"oid": "a37eb2043755767ae47209a57b252ce5820674f7", "url": "https://github.com/MegaMek/megamek/commit/a37eb2043755767ae47209a57b252ce5820674f7", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-24T19:21:07Z", "type": "commit"}, {"oid": "f927227f02f979bfb4bc137c91db43b5b8de2b80", "url": "https://github.com/MegaMek/megamek/commit/f927227f02f979bfb4bc137c91db43b5b8de2b80", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-24T20:19:59Z", "type": "commit"}, {"oid": "1202b4f755ce131ac91221e46e04d4d40b6537ea", "url": "https://github.com/MegaMek/megamek/commit/1202b4f755ce131ac91221e46e04d4d40b6537ea", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-25T18:36:47Z", "type": "commit"}, {"oid": "74c0c5341ca645f9a2280c7bf8a83db8c97e2d33", "url": "https://github.com/MegaMek/megamek/commit/74c0c5341ca645f9a2280c7bf8a83db8c97e2d33", "message": "Adding gender return change to handle MekHQ imports", "committedDate": "2020-02-26T01:21:22Z", "type": "commit"}, {"oid": "562511171f0b8f4165751da4175122d3cd10a3ee", "url": "https://github.com/MegaMek/megamek/commit/562511171f0b8f4165751da4175122d3cd10a3ee", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-26T16:25:02Z", "type": "commit"}, {"oid": "a284412c3edd38a65feb3ddbeedfdefe60486b8c", "url": "https://github.com/MegaMek/megamek/commit/a284412c3edd38a65feb3ddbeedfdefe60486b8c", "message": "Fixing issues with external id in Crew", "committedDate": "2020-02-26T17:18:43Z", "type": "commit"}, {"oid": "0e8f36399b130429cf049a6146ba2dd549915757", "url": "https://github.com/MegaMek/megamek/commit/0e8f36399b130429cf049a6146ba2dd549915757", "message": "Fixing merge conflicts", "committedDate": "2020-02-26T19:59:50Z", "type": "commit"}, {"oid": "5ccfb24bea6bc6eed330318301bb63db852e9845", "url": "https://github.com/MegaMek/megamek/commit/5ccfb24bea6bc6eed330318301bb63db852e9845", "message": "Applying changes from initial review", "committedDate": "2020-02-26T21:40:17Z", "type": "commit"}, {"oid": "73c877e73d2931ae51c3a9a215e4b51fa62fb6dd", "url": "https://github.com/MegaMek/megamek/commit/73c877e73d2931ae51c3a9a215e4b51fa62fb6dd", "message": "Removing deprecation of a name generator class because it is still useful in MegaMek", "committedDate": "2020-02-26T21:48:18Z", "type": "commit"}, {"oid": "e6ed93bee3385b82df4e3e253aef955d111f0109", "url": "https://github.com/MegaMek/megamek/commit/e6ed93bee3385b82df4e3e253aef955d111f0109", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-02-28T22:40:14Z", "type": "commit"}, {"oid": "adf0f72701d6bf88178db9b9f8eccbe38b840ea5", "url": "https://github.com/MegaMek/megamek/commit/adf0f72701d6bf88178db9b9f8eccbe38b840ea5", "message": "Adding unknown gender error message to Crew", "committedDate": "2020-02-28T23:59:36Z", "type": "commit"}, {"oid": "41843f27030555b7d41c5ca604ed997c7cd918de", "url": "https://github.com/MegaMek/megamek/commit/41843f27030555b7d41c5ca604ed997c7cd918de", "message": "Code cleanup in Crew", "committedDate": "2020-02-29T00:59:14Z", "type": "commit"}, {"oid": "24ec11f0a052fb623d47fc607fcb6494209eb1cb", "url": "https://github.com/MegaMek/megamek/commit/24ec11f0a052fb623d47fc607fcb6494209eb1cb", "message": "Fixing readme to ignore new boards in the boards folder", "committedDate": "2020-02-29T01:05:06Z", "type": "commit"}, {"oid": "2b86b0ac767368046aaf2f4d7092850e295fdaf6", "url": "https://github.com/MegaMek/megamek/commit/2b86b0ac767368046aaf2f4d7092850e295fdaf6", "message": "Changing naming to use a constant field in Crew", "committedDate": "2020-02-29T03:24:49Z", "type": "commit"}, {"oid": "911d83bb265a9d0d11500d95b03a590962be1721", "url": "https://github.com/MegaMek/megamek/commit/911d83bb265a9d0d11500d95b03a590962be1721", "message": "Fixing typo in .gitignore", "committedDate": "2020-02-29T15:25:16Z", "type": "commit"}, {"oid": "b43aba5371e08d12cae65166111dae75ef210a1a", "url": "https://github.com/MegaMek/megamek/commit/b43aba5371e08d12cae65166111dae75ef210a1a", "message": "Fixing merge conflicts", "committedDate": "2020-03-02T16:38:14Z", "type": "commit"}, {"oid": "52b4d66b17b5b9ecb5525e5e8c8fb210ccf10e86", "url": "https://github.com/MegaMek/megamek/commit/52b4d66b17b5b9ecb5525e5e8c8fb210ccf10e86", "message": "Fixing merge conflicts", "committedDate": "2020-03-02T18:31:15Z", "type": "commit"}, {"oid": "a468aa3def6d6449cfe8248bcd7a6662ba9bbcfd", "url": "https://github.com/MegaMek/megamek/commit/a468aa3def6d6449cfe8248bcd7a6662ba9bbcfd", "message": "Merge branch 'dev_Windchild_Personnel_Improvements' of https://github.com/Windchild292/megamek into dev_Windchild_Personnel_Improvements", "committedDate": "2020-03-02T18:31:20Z", "type": "commit"}, {"oid": "5dcdb515f367fb84bf5d7f0819067997db4f388d", "url": "https://github.com/MegaMek/megamek/commit/5dcdb515f367fb84bf5d7f0819067997db4f388d", "message": "Adding Rank to ExtraData", "committedDate": "2020-03-05T01:32:37Z", "type": "commit"}, {"oid": "f8ce4f7616235b219841b3df747cca5150b864a0", "url": "https://github.com/MegaMek/megamek/commit/f8ce4f7616235b219841b3df747cca5150b864a0", "message": "Fixing crew portrait getter", "committedDate": "2020-03-05T01:57:59Z", "type": "commit"}, {"oid": "166de33469989d9539a2522edeccbd4acab0d647", "url": "https://github.com/MegaMek/megamek/commit/166de33469989d9539a2522edeccbd4acab0d647", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-03-05T02:33:44Z", "type": "commit"}, {"oid": "0cc31eb8806f427255b192e5b9aa91e2e60b7a2f", "url": "https://github.com/MegaMek/megamek/commit/0cc31eb8806f427255b192e5b9aa91e2e60b7a2f", "message": "Fixing index out of bounds issue", "committedDate": "2020-03-05T02:34:17Z", "type": "commit"}, {"oid": "49831ab097a0c0b019e3af9343b3ccfd425acb30", "url": "https://github.com/MegaMek/megamek/commit/49831ab097a0c0b019e3af9343b3ccfd425acb30", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-03-05T16:45:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDU4OA==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389220588", "bodyText": "What happened to all these functions that got removed?", "author": "NickAragua", "createdAt": "2020-03-07T02:43:36Z", "path": "megamek/src/megamek/common/Crew.java", "diffHunk": "@@ -1173,20 +1252,6 @@ public void setCurrentPilot(int pos) {\n         actedThisTurn[pos] = true;\n     }\n \n-    /**\n-     * Set the gunner slot. If a multicrew cockpit uses the same crew member as both pilot and gunner\n-     * (i.e. cockpit command console), sets the pilot as well.\n-     *\n-     * @param pos The slot index to set as gunner.\n-     */\n-    public void setCurrentGunner(int pos) {", "originalCommit": "49831ab097a0c0b019e3af9343b3ccfd425acb30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMjU0OQ==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389222549", "bodyText": "Unused for years, so I removed them.", "author": "Windchild292", "createdAt": "2020-03-07T03:12:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDU4OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDcwNQ==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389220705", "bodyText": "Isn't this going to break scenarios?", "author": "NickAragua", "createdAt": "2020-03-07T02:45:36Z", "path": "megamek/src/megamek/server/ScenarioLoader.java", "diffHunk": "@@ -555,7 +555,7 @@ private Entity parseEntityLine(String s) throws ScenarioLoaderException {\n             System.out.println(String.format(\"Loading %s\", ms.getName())); //$NON-NLS-1$\n             Entity e = new MechFileParser(ms.getSourceFile(), ms.getEntryName()).getEntity();\n             e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1, Integer.parseInt(parts[2]),\n-                    Integer.parseInt(parts[3])));\n+                    Integer.parseInt(parts[3]), Integer.parseInt(parts[4]), null));", "originalCommit": "49831ab097a0c0b019e3af9343b3ccfd425acb30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMjY0NQ==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389222645", "bodyText": "I think so, this I'll fix immediately.", "author": "Windchild292", "createdAt": "2020-03-07T03:14:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMzE1Mg==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389223152", "bodyText": "Fixed", "author": "Windchild292", "createdAt": "2020-03-07T03:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDcwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "a014a7b9d078318502f31b58916c4946f54d4633", "chunk": "diff --git a/megamek/src/megamek/server/ScenarioLoader.java b/megamek/src/megamek/server/ScenarioLoader.java\nindex 68bf022c36..5560b568d7 100644\n--- a/megamek/src/megamek/server/ScenarioLoader.java\n+++ b/megamek/src/megamek/server/ScenarioLoader.java\n\n@@ -554,9 +554,19 @@ public class ScenarioLoader {\n             }\n             System.out.println(String.format(\"Loading %s\", ms.getName())); //$NON-NLS-1$\n             Entity e = new MechFileParser(ms.getSourceFile(), ms.getEntryName()).getEntity();\n-            e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1, Integer.parseInt(parts[2]),\n-                    Integer.parseInt(parts[3]), Integer.parseInt(parts[4]), null));\n-            if(parts.length >= 7) {\n+\n+            // This if statement ensures that scenarios don't break if they don't have gender, as that\n+            // field was only added in MegaMek 0.47.5\n+            if (parts.length > 4) {\n+                e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1,\n+                        Integer.parseInt(parts[2]), Integer.parseInt(parts[3]),\n+                        Integer.parseInt(parts[4]), null));\n+            } else {\n+                e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1,\n+                        Integer.parseInt(parts[2]), Integer.parseInt(parts[3]),\n+                        Crew.G_RANDOMIZE, null));\n+            }\n+            if (parts.length >= 7) {\n                 String direction = parts[4].toUpperCase(Locale.ROOT);\n                 switch(direction) {\n                     case \"N\": //$NON-NLS-1$\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDk1OA==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389220958", "bodyText": "What's the deal with this function? Why not just either pass in ints or switch the whole thing to a boolean, why convert between the two?", "author": "NickAragua", "createdAt": "2020-03-07T02:49:17Z", "path": "megamek/src/megamek/common/Crew.java", "diffHunk": "@@ -294,10 +369,28 @@ public String getNickname(int pos) {\n         return nickname[pos];\n     }\n \n+    public int getGender() {\n+        return gender[0];\n+    }\n+\n+    public int getGender(int pos) {\n+        // The randomize return value is used in MekHQ to create new personnel following a battle,\n+        // and should not be changed without ensuring it doesn't break on that side\n+        if (pos < gender.length) {\n+            return gender[pos];\n+        } else {\n+            return G_RANDOMIZE;\n+        }\n+    }\n+\n+    public static int getGenderAsInt(boolean isFemale) {", "originalCommit": "49831ab097a0c0b019e3af9343b3ccfd425acb30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMjUxNw==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389222517", "bodyText": "Temporary function to keep functionality while I finished updating names. I'll be removing this in wave 2.", "author": "Windchild292", "createdAt": "2020-03-07T03:12:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyMDk1OA=="}], "type": "inlineReview", "revised_code": {"commit": "143c15fc1af1ff9e0ecc8aa9c2bb589a6acaf44d", "chunk": "diff --git a/megamek/src/megamek/common/Crew.java b/megamek/src/megamek/common/Crew.java\nindex c299f29165..f4298f07d5 100644\n--- a/megamek/src/megamek/common/Crew.java\n+++ b/megamek/src/megamek/common/Crew.java\n\n@@ -383,6 +383,11 @@ public class Crew implements Serializable {\n         }\n     }\n \n+    /**\n+     * @param isFemale whether a person is female or male\n+     * @return the int value of the gender\n+     */\n+    @Deprecated // March 7th, 2020, this is a temporary method to ensure an easy transition\n     public static int getGenderAsInt(boolean isFemale) {\n         return isFemale ? G_FEMALE : G_MALE;\n     }\n"}}, {"oid": "a014a7b9d078318502f31b58916c4946f54d4633", "url": "https://github.com/MegaMek/megamek/commit/a014a7b9d078318502f31b58916c4946f54d4633", "message": "Fixing scenario load from old scenarios", "committedDate": "2020-03-07T03:22:29Z", "type": "commit"}, {"oid": "aa77ad9e7239a3abf826d70976289d94a261b715", "url": "https://github.com/MegaMek/megamek/commit/aa77ad9e7239a3abf826d70976289d94a261b715", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Personnel_Improvements", "committedDate": "2020-03-07T03:29:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzMDQwMA==", "url": "https://github.com/MegaMek/megamek/pull/1728#discussion_r389230400", "bodyText": "Think this might be 'off by one' here as well.", "author": "NickAragua", "createdAt": "2020-03-07T05:35:14Z", "path": "megamek/src/megamek/server/ScenarioLoader.java", "diffHunk": "@@ -554,9 +554,19 @@ private Entity parseEntityLine(String s) throws ScenarioLoaderException {\n             }\n             System.out.println(String.format(\"Loading %s\", ms.getName())); //$NON-NLS-1$\n             Entity e = new MechFileParser(ms.getSourceFile(), ms.getEntryName()).getEntity();\n-            e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1, Integer.parseInt(parts[2]),\n-                    Integer.parseInt(parts[3]), Integer.parseInt(parts[4]), null));\n-            if(parts.length >= 7) {\n+\n+            // This if statement ensures that scenarios don't break if they don't have gender, as that\n+            // field was only added in MegaMek 0.47.5\n+            if (parts.length > 4) {\n+                e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1,\n+                        Integer.parseInt(parts[2]), Integer.parseInt(parts[3]),\n+                        Integer.parseInt(parts[4]), null));\n+            } else {\n+                e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1,\n+                        Integer.parseInt(parts[2]), Integer.parseInt(parts[3]),\n+                        Crew.G_RANDOMIZE, null));\n+            }\n+            if (parts.length >= 7) {", "originalCommit": "a014a7b9d078318502f31b58916c4946f54d4633", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "143c15fc1af1ff9e0ecc8aa9c2bb589a6acaf44d", "chunk": "diff --git a/megamek/src/megamek/server/ScenarioLoader.java b/megamek/src/megamek/server/ScenarioLoader.java\nindex 5560b568d7..ace86e65f3 100644\n--- a/megamek/src/megamek/server/ScenarioLoader.java\n+++ b/megamek/src/megamek/server/ScenarioLoader.java\n\n@@ -547,28 +548,35 @@ public class ScenarioLoader {\n     private Entity parseEntityLine(String s) throws ScenarioLoaderException {\n         try {\n             String[] parts = s.split(SEPARATOR_COMMA, -1);\n-            String sRef = parts[0];\n-            MechSummary ms = MechSummaryCache.getInstance().getMech(sRef);\n+            int i;\n+            MechSummary ms = MechSummaryCache.getInstance().getMech(parts[0]);\n             if (ms == null) {\n-                throw new ScenarioLoaderException(\"missingRequiredEntity\", sRef); //$NON-NLS-1$\n+                throw new ScenarioLoaderException(\"missingRequiredEntity\", parts[0]); //$NON-NLS-1$\n             }\n             System.out.println(String.format(\"Loading %s\", ms.getName())); //$NON-NLS-1$\n             Entity e = new MechFileParser(ms.getSourceFile(), ms.getEntryName()).getEntity();\n \n-            // This if statement ensures that scenarios don't break if they don't have gender, as that\n-            // field was only added in MegaMek 0.47.5\n-            if (parts.length > 4) {\n+            // The following section is used to determine if part 4 of the string includes gender or not\n+            // The regex is used to match a number that might be negative. As the direction is never\n+            // a number, if a number is found it must be gender.\n+            // The i value must be included to ensure that the correct indexes are used for the\n+            // direction calculation below.\n+            if ((parts.length > 4) && parts[4].matches(\"-?\\\\d+\")) {\n                 e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1,\n                         Integer.parseInt(parts[2]), Integer.parseInt(parts[3]),\n                         Integer.parseInt(parts[4]), null));\n+                i = 5; // direction will be part 5, as the scenario has the gender of its pilots included\n             } else {\n                 e.setCrew(new Crew(e.getCrew().getCrewType(), parts[1], 1,\n                         Integer.parseInt(parts[2]), Integer.parseInt(parts[3]),\n-                        Crew.G_RANDOMIZE, null));\n+                        RandomNameGenerator.getInstance().generateGender(), null));\n+                i = 4; // direction will be part 4, as the scenario does not contain gender\n             }\n+\n+            // This uses the i value to ensure it is calculated correctly\n             if (parts.length >= 7) {\n-                String direction = parts[4].toUpperCase(Locale.ROOT);\n-                switch(direction) {\n+                String direction = parts[i++].toUpperCase(Locale.ROOT); //grab value at i, then increment\n+                switch (direction) {\n                     case \"N\": //$NON-NLS-1$\n                         e.setFacing(0);\n                         break;\n"}}, {"oid": "143c15fc1af1ff9e0ecc8aa9c2bb589a6acaf44d", "url": "https://github.com/MegaMek/megamek/commit/143c15fc1af1ff9e0ecc8aa9c2bb589a6acaf44d", "message": "Fixing ScenarioLoader for the gender addition, and adding deprecration notes for fields to be removed in wave 2", "committedDate": "2020-03-07T16:53:12Z", "type": "commit"}]}