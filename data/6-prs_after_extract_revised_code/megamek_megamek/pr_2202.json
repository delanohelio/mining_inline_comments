{"pr_number": 2202, "pr_title": "Inconsistent combat log sprites", "pr_createdAt": "2020-09-07T14:08:01Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2202", "timeline": [{"oid": "0ae73d3698b754a4e2dea0097a87cc224d71df80", "url": "https://github.com/MegaMek/megamek/commit/0ae73d3698b754a4e2dea0097a87cc224d71df80", "message": "Fixed bug that caused sprites to be disabled for all clients when one toggled option", "committedDate": "2020-09-07T13:06:42Z", "type": "commit"}, {"oid": "7c8668d723c44f186dc802f2c3b46dc9dc429beb", "url": "https://github.com/MegaMek/megamek/commit/7c8668d723c44f186dc802f2c3b46dc9dc429beb", "message": "Fixed a string index out of bounds error when inserting image code", "committedDate": "2020-09-07T13:24:57Z", "type": "commit"}, {"oid": "cf1e3add4d87fc05edc242089d412e9789011368", "url": "https://github.com/MegaMek/megamek/commit/cf1e3add4d87fc05edc242089d412e9789011368", "message": "Fixed a string index out of bounds error when inserting image code", "committedDate": "2020-09-07T14:01:33Z", "type": "commit"}, {"oid": "3dd662c2f7b48dc9e3b2cc07e7610ffb5cd56b1f", "url": "https://github.com/MegaMek/megamek/commit/3dd662c2f7b48dc9e3b2cc07e7610ffb5cd56b1f", "message": "Merge branch 'inconsistentCombatLogSprites' of https://github.com/Krashner/megamek into inconsistentCombatLogSprites", "committedDate": "2020-09-07T14:01:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNjUxMw==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r484506513", "bodyText": "Is text.startsWith(\"\\n\") not an option? Simpler than a length check and first char check.", "author": "sixlettervariables", "createdAt": "2020-09-07T16:02:48Z", "path": "megamek/src/megamek/common/Report.java", "diffHunk": "@@ -489,7 +487,7 @@ public String getText() {\n             }\n             //draw the sprite at the beginning of the line\n             if(imageCode != null && imageCode.length() > 0){\n-                if(text.substring(0,1).equals(\"\\n\")){\n+                if(text.length() >= 2 && text.substring(0,1).equals(\"\\n\")){", "originalCommit": "3dd662c2f7b48dc9e3b2cc07e7610ffb5cd56b1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgyMzU0Mg==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r484823542", "bodyText": "Ah, good call. That flew right past me.", "author": "Krashner", "createdAt": "2020-09-08T10:44:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNjUxMw=="}], "type": "inlineReview", "revised_code": {"commit": "a8661baf39ba5132071a85163c54905b8a6ac856", "chunk": "diff --git a/megamek/src/megamek/common/Report.java b/megamek/src/megamek/common/Report.java\nindex c3bed89619..fa09cd5ba2 100755\n--- a/megamek/src/megamek/common/Report.java\n+++ b/megamek/src/megamek/common/Report.java\n\n@@ -485,9 +485,9 @@ public class Report implements Serializable {\n                 }\n                 i++;\n             }\n-            //draw the sprite at the beginning of the line\n-            if(imageCode != null && imageCode.length() > 0){\n-                if(text.length() >= 2 && text.substring(0,1).equals(\"\\n\")){\n+            //add the sprite code at the beginning of the line\n+            if(!imageCode.isEmpty()){\n+                if(text.toString().startsWith(\"\\n\")){\n                     text.insert(1, imageCode);\n                 }\n                 else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNzM1OA==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r484507358", "bodyText": "Are we leaking these BAIS? Or do we need them held open for the BufferedImage's.", "author": "sixlettervariables", "createdAt": "2020-09-07T16:05:12Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,31 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {\n+            cache.put(src, image);\n+        }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        BufferedImage newImage = null;\n-        ByteArrayInputStream bais = null;\n-        try {\n-            bais = new ByteArrayInputStream(\n-                    Base64.getDecoder().decode(b64.getBytes()));\n-            newImage = ImageIO.read(bais);\n-        } catch (Throwable ex) {\n-            ex.printStackTrace();\n+        if(b64 != null) {\n+            BufferedImage newImage = null;\n+            ByteArrayInputStream bais = null;", "originalCommit": "3dd662c2f7b48dc9e3b2cc07e7610ffb5cd56b1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgyMjEyMQ==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r484822121", "bodyText": "They should be closed, I'll fix that.", "author": "Krashner", "createdAt": "2020-09-08T10:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNzM1OA=="}], "type": "inlineReview", "revised_code": {"commit": "a8661baf39ba5132071a85163c54905b8a6ac856", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 0542b71ea2..1b28787742 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -68,6 +68,7 @@ public class BASE64ImageView extends ImageView {\n                 bais = new ByteArrayInputStream(\n                         Base64.getDecoder().decode(b64.getBytes()));\n                 newImage = ImageIO.read(bais);\n+                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"oid": "a8661baf39ba5132071a85163c54905b8a6ac856", "url": "https://github.com/MegaMek/megamek/commit/a8661baf39ba5132071a85163c54905b8a6ac856", "message": "Cleaned up report text check and closed bais", "committedDate": "2020-09-08T10:57:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMjQ5OQ==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487232499", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n          \n          \n            \n                    if (!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)", "author": "Windchild292", "createdAt": "2020-09-11T19:00:21Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1139,7 +1140,8 @@ public String receiveReport(Vector<Report> v) {\n      * returns the stored <img> tag for given unit id\n      */\n     private String getCachedImgTag(int id){\n-        if(imgCache == null || !imgCache.containsKey(id)) {\n+        if(!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "df19b0fd53cbd3f31123fa74f9ff85abdc26dfb2", "chunk": "diff --git a/megamek/src/megamek/client/Client.java b/megamek/src/megamek/client/Client.java\nindex 055fd093cf..bbf172513d 100644\n--- a/megamek/src/megamek/client/Client.java\n+++ b/megamek/src/megamek/client/Client.java\n\n@@ -1140,8 +1140,8 @@ public class Client implements IClientCommandHandler {\n      * returns the stored <img> tag for given unit id\n      */\n     private String getCachedImgTag(int id){\n-        if(!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n-                || imgCache == null || !imgCache.containsKey(id)) {\n+        if (!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n+                || (imgCache == null) || !imgCache.containsKey(id)) {\n             return null;\n         }\n         return imgCache.get(id);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMjYwNQ==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487232605", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            || imgCache == null || !imgCache.containsKey(id)) {\n          \n          \n            \n                            || (imgCache == null) || !imgCache.containsKey(id)) {", "author": "Windchild292", "createdAt": "2020-09-11T19:00:35Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1139,7 +1140,8 @@ public String receiveReport(Vector<Report> v) {\n      * returns the stored <img> tag for given unit id\n      */\n     private String getCachedImgTag(int id){\n-        if(imgCache == null || !imgCache.containsKey(id)) {\n+        if(!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n+                || imgCache == null || !imgCache.containsKey(id)) {", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "df19b0fd53cbd3f31123fa74f9ff85abdc26dfb2", "chunk": "diff --git a/megamek/src/megamek/client/Client.java b/megamek/src/megamek/client/Client.java\nindex 055fd093cf..bbf172513d 100644\n--- a/megamek/src/megamek/client/Client.java\n+++ b/megamek/src/megamek/client/Client.java\n\n@@ -1140,8 +1140,8 @@ public class Client implements IClientCommandHandler {\n      * returns the stored <img> tag for given unit id\n      */\n     private String getCachedImgTag(int id){\n-        if(!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n-                || imgCache == null || !imgCache.containsKey(id)) {\n+        if (!GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n+                || (imgCache == null) || !imgCache.containsKey(id)) {\n             return null;\n         }\n         return imgCache.get(id);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMjY4MQ==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487232681", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(image != null) {\n          \n          \n            \n                    if (image != null) {", "author": "Windchild292", "createdAt": "2020-09-11T19:00:45Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,32 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 1b28787742..a7fa0e71af 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -63,12 +63,9 @@ public class BASE64ImageView extends ImageView {\n         String b64 = getBASE64Image();\n         if(b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMjc1Ng==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487232756", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(b64 != null) {\n          \n          \n            \n                    if (b64 != null) {", "author": "Windchild292", "createdAt": "2020-09-11T19:00:54Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,32 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {\n+            cache.put(src, image);\n+        }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        BufferedImage newImage = null;\n-        ByteArrayInputStream bais = null;\n-        try {\n-            bais = new ByteArrayInputStream(\n-                    Base64.getDecoder().decode(b64.getBytes()));\n-            newImage = ImageIO.read(bais);\n-        } catch (Throwable ex) {\n-            ex.printStackTrace();\n+        if(b64 != null) {", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 1b28787742..a7fa0e71af 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -63,12 +63,9 @@ public class BASE64ImageView extends ImageView {\n         String b64 = getBASE64Image();\n         if(b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNDQ5Nw==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487234497", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        } catch (Throwable ex) {\n          \n          \n            \n                            ex.printStackTrace();\n          \n          \n            \n                        } catch (Exception ex) {\n          \n          \n            \n                            MegaMek.getLogger(getClass(), \"loadImage\", ex);", "author": "Windchild292", "createdAt": "2020-09-11T19:04:38Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,32 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {\n+            cache.put(src, image);\n+        }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        BufferedImage newImage = null;\n-        ByteArrayInputStream bais = null;\n-        try {\n-            bais = new ByteArrayInputStream(\n-                    Base64.getDecoder().decode(b64.getBytes()));\n-            newImage = ImageIO.read(bais);\n-        } catch (Throwable ex) {\n-            ex.printStackTrace();\n+        if(b64 != null) {\n+            BufferedImage newImage = null;\n+            ByteArrayInputStream bais = null;\n+            try {\n+                bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()));\n+                newImage = ImageIO.read(bais);\n+                bais.close();\n+            } catch (Throwable ex) {\n+                ex.printStackTrace();", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 1b28787742..a7fa0e71af 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -63,12 +63,9 @@ public class BASE64ImageView extends ImageView {\n         String b64 = getBASE64Image();\n         if(b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNDU2Nw==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487234567", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }\n          \n          \n            \n                    else{\n          \n          \n            \n                    } else {", "author": "Windchild292", "createdAt": "2020-09-11T19:04:48Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,32 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {\n+            cache.put(src, image);\n+        }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        BufferedImage newImage = null;\n-        ByteArrayInputStream bais = null;\n-        try {\n-            bais = new ByteArrayInputStream(\n-                    Base64.getDecoder().decode(b64.getBytes()));\n-            newImage = ImageIO.read(bais);\n-        } catch (Throwable ex) {\n-            ex.printStackTrace();\n+        if(b64 != null) {\n+            BufferedImage newImage = null;\n+            ByteArrayInputStream bais = null;\n+            try {\n+                bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()));\n+                newImage = ImageIO.read(bais);\n+                bais.close();\n+            } catch (Throwable ex) {\n+                ex.printStackTrace();\n+            }\n+            return newImage;\n+        }\n+        else{", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 1b28787742..a7fa0e71af 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -63,12 +63,9 @@ public class BASE64ImageView extends ImageView {\n         String b64 = getBASE64Image();\n         if(b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNDYzNg==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487234636", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return  null;\n          \n          \n            \n                        return null;", "author": "Windchild292", "createdAt": "2020-09-11T19:04:54Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,32 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {\n+            cache.put(src, image);\n+        }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        BufferedImage newImage = null;\n-        ByteArrayInputStream bais = null;\n-        try {\n-            bais = new ByteArrayInputStream(\n-                    Base64.getDecoder().decode(b64.getBytes()));\n-            newImage = ImageIO.read(bais);\n-        } catch (Throwable ex) {\n-            ex.printStackTrace();\n+        if(b64 != null) {\n+            BufferedImage newImage = null;\n+            ByteArrayInputStream bais = null;\n+            try {\n+                bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()));\n+                newImage = ImageIO.read(bais);\n+                bais.close();\n+            } catch (Throwable ex) {\n+                ex.printStackTrace();\n+            }\n+            return newImage;\n+        }\n+        else{\n+            return  null;", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 1b28787742..a7fa0e71af 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -63,12 +63,9 @@ public class BASE64ImageView extends ImageView {\n         String b64 = getBASE64Image();\n         if(b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNTE0NQ==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487235145", "bodyText": "Can this be done through try with properties?", "author": "Windchild292", "createdAt": "2020-09-11T19:06:00Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -51,25 +51,32 @@ private void populateImage() {\n             cache = new Hashtable<>();\n             getDocument().putProperty(\"imageCache\", cache);\n         }\n-\n         URL src = getImageURL();\n-        cache.put(src, loadImage());\n-\n+        Image image = loadImage();\n+        if(image != null) {\n+            cache.put(src, image);\n+        }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        BufferedImage newImage = null;\n-        ByteArrayInputStream bais = null;\n-        try {\n-            bais = new ByteArrayInputStream(\n-                    Base64.getDecoder().decode(b64.getBytes()));\n-            newImage = ImageIO.read(bais);\n-        } catch (Throwable ex) {\n-            ex.printStackTrace();\n+        if(b64 != null) {\n+            BufferedImage newImage = null;\n+            ByteArrayInputStream bais = null;\n+            try {\n+                bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()));\n+                newImage = ImageIO.read(bais);\n+                bais.close();", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyNTcyMA==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r488825720", "bodyText": "That's a good call, I'll write it in.", "author": "Krashner", "createdAt": "2020-09-15T17:07:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNTE0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 1b28787742..a7fa0e71af 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -63,12 +63,9 @@ public class BASE64ImageView extends ImageView {\n         String b64 = getBASE64Image();\n         if(b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n             } catch (Throwable ex) {\n                 ex.printStackTrace();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNTQzNg==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487235436", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(indentation <= Report.DEFAULT_INDENTATION || showImage) {\n          \n          \n            \n                        if ((indentation <= Report.DEFAULT_INDENTATION) || showImage) {", "author": "Windchild292", "createdAt": "2020-09-11T19:06:34Z", "path": "megamek/src/megamek/common/Report.java", "diffHunk": "@@ -314,9 +313,8 @@ public void choose(boolean choice) {\n      */\n     public void addDesc(Entity entity) {\n         if (entity != null) {\n-            if(GUIPreferences.getInstance().getBoolean(GUIPreferences.ADVANCED_ROUND_REPORT_SPRITES)\n-                    && (indentation <= Report.DEFAULT_INDENTATION || showImage)) {\n-                imageCode = \"<span id='\" +entity.getId() + \"'></span>\";\n+            if(indentation <= Report.DEFAULT_INDENTATION || showImage) {", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "df19b0fd53cbd3f31123fa74f9ff85abdc26dfb2", "chunk": "diff --git a/megamek/src/megamek/common/Report.java b/megamek/src/megamek/common/Report.java\nindex fa09cd5ba2..9b31b48b1a 100755\n--- a/megamek/src/megamek/common/Report.java\n+++ b/megamek/src/megamek/common/Report.java\n\n@@ -313,7 +313,7 @@ public class Report implements Serializable {\n      */\n     public void addDesc(Entity entity) {\n         if (entity != null) {\n-            if(indentation <= Report.DEFAULT_INDENTATION || showImage) {\n+            if ((indentation <= Report.DEFAULT_INDENTATION) || showImage) {\n                 imageCode = \"<span id='\" + entity.getId() + \"'></span>\";\n             }\n             add(\"<font color='0xffffff'><a href=\\\"#entity:\" + entity.getId()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNTY4MA==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r487235680", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(!imageCode.isEmpty()){\n          \n          \n            \n                            if(text.toString().startsWith(\"\\n\")){\n          \n          \n            \n                        if (!imageCode.isEmpty()) {\n          \n          \n            \n                            if (text.toString().startsWith(\"\\n\")) {", "author": "Windchild292", "createdAt": "2020-09-11T19:07:03Z", "path": "megamek/src/megamek/common/Report.java", "diffHunk": "@@ -487,9 +485,9 @@ public String getText() {\n                 }\n                 i++;\n             }\n-            //draw the sprite at the beginning of the line\n-            if(imageCode != null && imageCode.length() > 0){\n-                if(text.substring(0,1).equals(\"\\n\")){\n+            //add the sprite code at the beginning of the line\n+            if(!imageCode.isEmpty()){\n+                if(text.toString().startsWith(\"\\n\")){", "originalCommit": "a8661baf39ba5132071a85163c54905b8a6ac856", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "df19b0fd53cbd3f31123fa74f9ff85abdc26dfb2", "chunk": "diff --git a/megamek/src/megamek/common/Report.java b/megamek/src/megamek/common/Report.java\nindex fa09cd5ba2..9b31b48b1a 100755\n--- a/megamek/src/megamek/common/Report.java\n+++ b/megamek/src/megamek/common/Report.java\n\n@@ -486,8 +486,8 @@ public class Report implements Serializable {\n                 i++;\n             }\n             //add the sprite code at the beginning of the line\n-            if(!imageCode.isEmpty()){\n-                if(text.toString().startsWith(\"\\n\")){\n+            if (!imageCode.isEmpty()) {\n+                if (text.toString().startsWith(\"\\n\")) {\n                     text.insert(1, imageCode);\n                 }\n                 else {\n"}}, {"oid": "58b8c9cc3431375b3c8a877637fef5719c20e7c2", "url": "https://github.com/MegaMek/megamek/commit/58b8c9cc3431375b3c8a877637fef5719c20e7c2", "message": "Added requested change to loadImage", "committedDate": "2020-09-15T17:05:17Z", "type": "commit"}, {"oid": "df19b0fd53cbd3f31123fa74f9ff85abdc26dfb2", "url": "https://github.com/MegaMek/megamek/commit/df19b0fd53cbd3f31123fa74f9ff85abdc26dfb2", "message": "Apply suggestions from code review\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-09-15T17:06:01Z", "type": "commit"}, {"oid": "c6ca70022320199f2c8075cf223638273f363818", "url": "https://github.com/MegaMek/megamek/commit/c6ca70022320199f2c8075cf223638273f363818", "message": "Added missing reference and slight code change", "committedDate": "2020-09-15T17:14:08Z", "type": "commit"}, {"oid": "e50b4ae6a4f3d1be4d0375a63bbf116017f6d8b7", "url": "https://github.com/MegaMek/megamek/commit/e50b4ae6a4f3d1be4d0375a63bbf116017f6d8b7", "message": "Removed line", "committedDate": "2020-09-15T17:16:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMjM4NQ==", "url": "https://github.com/MegaMek/megamek/pull/2202#discussion_r488832385", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            MegaMek.getLogger().error(this.getClass(), \"loadImage()\", ex);\n          \n          \n            \n                            MegaMek.getLogger().error(this, ex);", "author": "Windchild292", "createdAt": "2020-09-15T17:19:41Z", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -53,29 +54,25 @@ private void populateImage() {\n         }\n         URL src = getImageURL();\n         Image image = loadImage();\n-        if(image != null) {\n+        if (image != null) {\n             cache.put(src, image);\n         }\n     }\n \n     //decodes the Base64 string into an image and returns it\n     private Image loadImage() {\n         String b64 = getBASE64Image();\n-        if(b64 != null) {\n+        if (b64 != null) {\n             BufferedImage newImage = null;\n-            ByteArrayInputStream bais = null;\n-            try {\n-                bais = new ByteArrayInputStream(\n-                        Base64.getDecoder().decode(b64.getBytes()));\n+            try (ByteArrayInputStream bais = new ByteArrayInputStream(\n+                        Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n-                bais.close();\n-            } catch (Throwable ex) {\n-                ex.printStackTrace();\n+            } catch (Exception ex) {\n+                MegaMek.getLogger().error(this.getClass(), \"loadImage()\", ex);", "originalCommit": "e50b4ae6a4f3d1be4d0375a63bbf116017f6d8b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "60cb19974d8a2c3188151f1e06227c7484c4d333", "chunk": "diff --git a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\nindex 45a353dea8..416157868a 100644\n--- a/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n+++ b/megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java\n\n@@ -68,7 +68,7 @@ public class BASE64ImageView extends ImageView {\n                         Base64.getDecoder().decode(b64.getBytes()))) {\n                 newImage = ImageIO.read(bais);\n             } catch (Exception ex) {\n-                MegaMek.getLogger().error(this.getClass(), \"loadImage()\", ex);\n+                MegaMek.getLogger().error(this, ex);\n             }\n             return newImage;\n         } else {\n"}}, {"oid": "60cb19974d8a2c3188151f1e06227c7484c4d333", "url": "https://github.com/MegaMek/megamek/commit/60cb19974d8a2c3188151f1e06227c7484c4d333", "message": "Add suggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-09-15T18:34:03Z", "type": "commit"}]}