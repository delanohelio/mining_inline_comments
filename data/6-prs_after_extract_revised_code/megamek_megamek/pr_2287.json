{"pr_number": 2287, "pr_title": "isCrippled/isDmgLight/isDmgModerate/isDmgHeavy Debug Logging", "pr_createdAt": "2020-10-01T19:10:03Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2287", "timeline": [{"oid": "b06ff4a423a7bc0a16da2ecbff8b80d47f4f3152", "url": "https://github.com/MegaMek/megamek/commit/b06ff4a423a7bc0a16da2ecbff8b80d47f4f3152", "message": "Adding logging for entity status checks and varied bugfixes relating to isCrippled", "committedDate": "2020-10-01T19:04:49Z", "type": "commit"}, {"oid": "aebc46c1d8247c0aab1d86aaf936c355bfbe6329", "url": "https://github.com/MegaMek/megamek/commit/aebc46c1d8247c0aab1d86aaf936c355bfbe6329", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_EntityStatusLogging", "committedDate": "2020-10-03T17:25:37Z", "type": "commit"}, {"oid": "9bb7aef0a025e6db161665107298abbd92607f2f", "url": "https://github.com/MegaMek/megamek/commit/9bb7aef0a025e6db161665107298abbd92607f2f", "message": "Modernizing Entity Status logging", "committedDate": "2020-10-03T17:33:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3NTY3MA==", "url": "https://github.com/MegaMek/megamek/pull/2287#discussion_r501175670", "bodyText": "Is this a bug fix?", "author": "sixlettervariables", "createdAt": "2020-10-07T17:10:01Z", "path": "megamek/src/megamek/common/GunEmplacement.java", "diffHunk": "@@ -612,18 +594,18 @@ public void setDeployed(boolean deployed) {\n      */\n     @Override\n     public double getArmorRemainingPercent() {\n-        if(getPosition() == null) {\n+        if (getPosition() == null) {\n             return 1.0;\n         }\n         \n         Building occupiedStructure = getGame().getBoard().getBuildingAt(getPosition());\n         \n         // we'll consider undeployed emplacements to be fully intact\n-        if((occupiedStructure == null) || (initialBuildingCF + initialBuildingArmor == 0)) {\n+        if ((occupiedStructure == null) || (initialBuildingCF + initialBuildingArmor == 0)) {\n             return 1.0;\n         }\n         \n-        return (occupiedStructure.getCurrentCF(getPosition()) + occupiedStructure.getArmor(getPosition())) / \n-                (initialBuildingCF + initialBuildingArmor);\n+        return (1.0 * (occupiedStructure.getCurrentCF(getPosition()) + occupiedStructure.getArmor(getPosition())))", "originalCommit": "9bb7aef0a025e6db161665107298abbd92607f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4NDY5MA==", "url": "https://github.com/MegaMek/megamek/pull/2287#discussion_r501284690", "bodyText": "It is, it was trying to return a double from an int/int.", "author": "Windchild292", "createdAt": "2020-10-07T20:19:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3NTY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5NDM5OQ==", "url": "https://github.com/MegaMek/megamek/pull/2287#discussion_r501294399", "bodyText": "More obvious to cast the denominator to double. I presume this means that gun emplacements never showed the correct amount of armor remaining? (always 0)", "author": "sixlettervariables", "createdAt": "2020-10-07T20:37:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3NTY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxNDgzMw==", "url": "https://github.com/MegaMek/megamek/pull/2287#discussion_r501414833", "bodyText": "Swapped, and I believe so. This was a catch from my IDE.", "author": "Windchild292", "createdAt": "2020-10-08T02:38:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3NTY3MA=="}], "type": "inlineReview", "revised_code": {"commit": "29100e727e9fc35e949f4f68124a94bde3dea5b6", "chunk": "diff --git a/megamek/src/megamek/common/GunEmplacement.java b/megamek/src/megamek/common/GunEmplacement.java\nindex c1480c2c93..bebb768f98 100644\n--- a/megamek/src/megamek/common/GunEmplacement.java\n+++ b/megamek/src/megamek/common/GunEmplacement.java\n\n@@ -605,7 +605,7 @@ public class GunEmplacement extends Tank {\n             return 1.0;\n         }\n         \n-        return (1.0 * (occupiedStructure.getCurrentCF(getPosition()) + occupiedStructure.getArmor(getPosition())))\n-                / (initialBuildingCF + initialBuildingArmor);\n+        return (occupiedStructure.getCurrentCF(getPosition()) + occupiedStructure.getArmor(getPosition()))\n+                / ((double) (initialBuildingCF + initialBuildingArmor));\n     }\n }\n"}}, {"oid": "29100e727e9fc35e949f4f68124a94bde3dea5b6", "url": "https://github.com/MegaMek/megamek/commit/29100e727e9fc35e949f4f68124a94bde3dea5b6", "message": "Applying review changes", "committedDate": "2020-10-08T02:38:03Z", "type": "commit"}]}