{"pr_number": 1992, "pr_title": "Inclines and cliffs", "pr_createdAt": "2020-06-06T12:38:13Z", "pr_url": "https://github.com/MegaMek/megamek/pull/1992", "timeline": [{"oid": "0083f438d96150847c0d2d95d460d9a21941859a", "url": "https://github.com/MegaMek/megamek/commit/0083f438d96150847c0d2d95d460d9a21941859a", "message": "Added incline terrain and test images", "committedDate": "2020-05-13T15:04:30Z", "type": "commit"}, {"oid": "3ef7fcefcaafe3b669bfe06c13482e284061b61f", "url": "https://github.com/MegaMek/megamek/commit/3ef7fcefcaafe3b669bfe06c13482e284061b61f", "message": "Merge branch 'MM_master4' into SJ_Incline\n\nConflicts:\n\tmegamek/data/images/hexes/saxarba.tileset\n\tmegamek/src/megamek/common/Terrains.java", "committedDate": "2020-05-13T18:31:16Z", "type": "commit"}, {"oid": "08f9bff068d3849284bbc71e473d36ae92ed5e8b", "url": "https://github.com/MegaMek/megamek/commit/08f9bff068d3849284bbc71e473d36ae92ed5e8b", "message": "Implementing Incline and Cliff gfx #1", "committedDate": "2020-05-18T19:08:55Z", "type": "commit"}, {"oid": "27f98454dfe1906968c5ae975ba447e9506b3bbd", "url": "https://github.com/MegaMek/megamek/commit/27f98454dfe1906968c5ae975ba447e9506b3bbd", "message": "Implementing Incline and Cliff gfx #2", "committedDate": "2020-05-19T18:25:59Z", "type": "commit"}, {"oid": "a6774ede90941206585fa16a9a3e84c7a8514997", "url": "https://github.com/MegaMek/megamek/commit/a6774ede90941206585fa16a9a3e84c7a8514997", "message": "Implementing Incline and Cliff gfx #3", "committedDate": "2020-05-19T18:26:50Z", "type": "commit"}, {"oid": "04889b36d037263874b3945444cd46b11ac36def", "url": "https://github.com/MegaMek/megamek/commit/04889b36d037263874b3945444cd46b11ac36def", "message": "Add high inclines, automatic handling for all, hide terrains in Editor", "committedDate": "2020-05-23T06:57:53Z", "type": "commit"}, {"oid": "8162e50d0d9d0cd9c169e41c2cd99ead3822b105", "url": "https://github.com/MegaMek/megamek/commit/8162e50d0d9d0cd9c169e41c2cd99ead3822b105", "message": "Implementing Cliffs&Inclines, rules effects, avoid saving auto terrain", "committedDate": "2020-05-28T20:20:13Z", "type": "commit"}, {"oid": "9f0967718d02618425a3300d8f8ffb3463db0a13", "url": "https://github.com/MegaMek/megamek/commit/9f0967718d02618425a3300d8f8ffb3463db0a13", "message": "Add incline graphics by Saxarba", "committedDate": "2020-05-31T12:49:58Z", "type": "commit"}, {"oid": "33aa606090b1d9de7e1e8bd785eb6cf9f877c82f", "url": "https://github.com/MegaMek/megamek/commit/33aa606090b1d9de7e1e8bd785eb6cf9f877c82f", "message": "Implement sheer cliff rules", "committedDate": "2020-05-31T12:50:28Z", "type": "commit"}, {"oid": "3d5d6465a397cb80976bc50cd043b54219f5d01a", "url": "https://github.com/MegaMek/megamek/commit/3d5d6465a397cb80976bc50cd043b54219f5d01a", "message": "Correct small mistake", "committedDate": "2020-05-31T12:54:55Z", "type": "commit"}, {"oid": "c04970c5f5350fe64533b5e33dac92f7b280efdd", "url": "https://github.com/MegaMek/megamek/commit/c04970c5f5350fe64533b5e33dac92f7b280efdd", "message": "Merge branch 'MM_master_8' into SJ_Incline", "committedDate": "2020-06-01T06:13:56Z", "type": "commit"}, {"oid": "13cba75d8746591441bf448bcdf4b21b3a51ebb3", "url": "https://github.com/MegaMek/megamek/commit/13cba75d8746591441bf448bcdf4b21b3a51ebb3", "message": "Replace Tabs with spaces, Find PSRs in cliff steps", "committedDate": "2020-06-01T08:58:37Z", "type": "commit"}, {"oid": "8319a863ce40eb2ca63579a68b7b279f6b39079c", "url": "https://github.com/MegaMek/megamek/commit/8319a863ce40eb2ca63579a68b7b279f6b39079c", "message": "Add sheer cliff rules for infantry", "committedDate": "2020-06-02T14:19:02Z", "type": "commit"}, {"oid": "5d095923bbe96c1af674e150f5eb81d1460a5d12", "url": "https://github.com/MegaMek/megamek/commit/5d095923bbe96c1af674e150f5eb81d1460a5d12", "message": "Add Infantry, refactor all the cliff tests", "committedDate": "2020-06-05T14:28:54Z", "type": "commit"}, {"oid": "db3b8280dc83a09885340cb150d079db6402f080", "url": "https://github.com/MegaMek/megamek/commit/db3b8280dc83a09885340cb150d079db6402f080", "message": "Add GUIP setting for incline graphics", "committedDate": "2020-06-05T21:20:41Z", "type": "commit"}, {"oid": "6fd8b2ac3d2c28ce475092fca57b72850f0f7432", "url": "https://github.com/MegaMek/megamek/commit/6fd8b2ac3d2c28ce475092fca57b72850f0f7432", "message": "Merge branch 'master10' into SJ_Incline\n\nConflicts:\n\tmegamek/src/megamek/client/ui/swing/HexTileset.java\n\tmegamek/src/megamek/common/Board.java", "committedDate": "2020-06-05T21:24:21Z", "type": "commit"}, {"oid": "c5bb058d9d3706da790c6cd55b10260460df65bf", "url": "https://github.com/MegaMek/megamek/commit/c5bb058d9d3706da790c6cd55b10260460df65bf", "message": "GUI Option for incline terrain", "committedDate": "2020-06-06T09:41:07Z", "type": "commit"}, {"oid": "2624d12c07a9f8680708d80ee048bfe9b24f9613", "url": "https://github.com/MegaMek/megamek/commit/2624d12c07a9f8680708d80ee048bfe9b24f9613", "message": "Small changes", "committedDate": "2020-06-06T13:49:07Z", "type": "commit"}, {"oid": "137feb7b877f147275cbcfa6a508857b73eaca23", "url": "https://github.com/MegaMek/megamek/commit/137feb7b877f147275cbcfa6a508857b73eaca23", "message": "Merge branch 'master11' into SJ_Incline", "committedDate": "2020-06-08T15:10:27Z", "type": "commit"}, {"oid": "7c9a47c4f671a10242eb4283f62a44c692b26fb9", "url": "https://github.com/MegaMek/megamek/commit/7c9a47c4f671a10242eb4283f62a44c692b26fb9", "message": "Adapt shadows to inc., add cliffs to tilesets, correct order of PSRs", "committedDate": "2020-06-10T13:55:19Z", "type": "commit"}, {"oid": "57bf723520d3657f942b3633d35535f0c4a21db5", "url": "https://github.com/MegaMek/megamek/commit/57bf723520d3657f942b3633d35535f0c4a21db5", "message": "Cleanup", "committedDate": "2020-06-10T14:41:43Z", "type": "commit"}, {"oid": "3a40d13339d046aaddb178f498b1a41218f86869", "url": "https://github.com/MegaMek/megamek/commit/3a40d13339d046aaddb178f498b1a41218f86869", "message": "ProtoMechs and cliffs, apply incline gfx to all tilesets", "committedDate": "2020-06-12T05:31:34Z", "type": "commit"}, {"oid": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "url": "https://github.com/MegaMek/megamek/commit/d5ae66882841d64c9cd845de44f62960b8a21dcd", "message": "Roads cancel cliffs, acc. falls from cliffs", "committedDate": "2020-06-24T15:01:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MjUzNA==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r459172534", "bodyText": "Seems to me like this logic and the logic in SharedUtility.NagPSR should be unified somehow to avoid inconsistencies if/ when it needs to be updated. Keeping it in a distinct method will also allow it to be referenced by other code that may need it (e.g. the bot)", "author": "NickAragua", "createdAt": "2020-07-23T01:35:05Z", "path": "megamek/src/megamek/common/Compute.java", "diffHunk": "@@ -548,6 +548,42 @@ public static boolean isPilotingSkillNeeded(IGame game, int entityId,\n                 && !isPavementStep) {\n             return true;\n         }\n+        \n+        // Sheer Cliffs, TO p.39\n+        // Roads over cliffs cancel the cliff effects for units that move on roads\n+        boolean quadveeVehMode = entity instanceof QuadVee ", "originalCommit": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MjcwMg==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r459172702", "bodyText": "Normally I don't bother about white space formatting, but it looks like the tabs got completely clobbered here.", "author": "NickAragua", "createdAt": "2020-07-23T01:35:43Z", "path": "megamek/src/megamek/common/Compute.java", "diffHunk": "@@ -3160,72 +3196,72 @@ public static float getExpectedDamage(IGame g, WeaponAttackAction waa,\n                         g.getEntity(waa.getTargetId()).getPosition());\n                 //Convert AV to fDamage for bay weapons, fighters, etc\n                 if (attacker.usesWeaponBays()){\n-                \tdouble av = 0;\n-                \tdouble threat = 1;\n+                    double av = 0;\n+                    double threat = 1;\n                     for (int wId : weapon.getBayWeapons()) {\n-                    \tMounted bayW = attacker.getEquipment(wId);\n-                    \tWeaponType bayWType = ((WeaponType) bayW.getType());\n-                \t//Capital weapons have a different range scale\n+                        Mounted bayW = attacker.getEquipment(wId);\n+                        WeaponType bayWType = ((WeaponType) bayW.getType());\n+                    //Capital weapons have a different range scale\n                         if (wt.isCapital()) {\n-                        \t// Capital missiles get higher priority than standard missiles:\n+                            // Capital missiles get higher priority than standard missiles:\n                             // damage plus a bonus for the critical hit threat they represent\n-                        \tthreat = 12;\n-                        \tif (rangeToTarget > 50) {\n-                \t\t\tav = 0;\n-                        \t} else if (rangeToTarget > 40) {\n-                \t\t\tav += bayWType.getExtAV();\n-                        \t} else if (rangeToTarget > 25) {\n-                \t\t\tav += bayWType.getLongAV();\n-                        \t} else if (rangeToTarget > 12) {\n-                \t\t\tav += bayWType.getMedAV();\n-                        \t} else {\n-                \t\t\tav += bayWType.getShortAV();\n-                        \t}\n+                            threat = 12;", "originalCommit": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEwMjgwMg==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r460102802", "bodyText": "OK, autoindented it.", "author": "SJuliez", "createdAt": "2020-07-24T14:51:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MjcwMg=="}], "type": "inlineReview", "revised_code": {"commit": "e32f1f3bb46681396a585240acb0c83f443d43a7", "chunk": "diff --git a/megamek/src/megamek/common/Compute.java b/megamek/src/megamek/common/Compute.java\nindex 6baba9596a..32c83d0bbe 100644\n--- a/megamek/src/megamek/common/Compute.java\n+++ b/megamek/src/megamek/common/Compute.java\n\n@@ -3201,33 +3201,33 @@ public class Compute {\n                     for (int wId : weapon.getBayWeapons()) {\n                         Mounted bayW = attacker.getEquipment(wId);\n                         WeaponType bayWType = ((WeaponType) bayW.getType());\n-                    //Capital weapons have a different range scale\n+                        //Capital weapons have a different range scale\n                         if (wt.isCapital()) {\n                             // Capital missiles get higher priority than standard missiles:\n                             // damage plus a bonus for the critical hit threat they represent\n                             threat = 12;\n                             if (rangeToTarget > 50) {\n-                            av = 0;\n+                                av = 0;\n                             } else if (rangeToTarget > 40) {\n-                            av += bayWType.getExtAV();\n+                                av += bayWType.getExtAV();\n                             } else if (rangeToTarget > 25) {\n-                            av += bayWType.getLongAV();\n+                                av += bayWType.getLongAV();\n                             } else if (rangeToTarget > 12) {\n-                            av += bayWType.getMedAV();\n+                                av += bayWType.getMedAV();\n                             } else {\n-                            av += bayWType.getShortAV();\n+                                av += bayWType.getShortAV();\n                             }\n                         } else {\n                             if (rangeToTarget > 25) {\n-                            av = 0;\n+                                av = 0;\n                             } else if (rangeToTarget > 20) {\n-                            av += bayWType.getExtAV();\n+                                av += bayWType.getExtAV();\n                             } else if (rangeToTarget > 12) {\n-                            av += bayWType.getLongAV();\n+                                av += bayWType.getLongAV();\n                             } else if (rangeToTarget > 6) {\n-                            av += bayWType.getMedAV();\n+                                av += bayWType.getMedAV();\n                             } else {\n-                            av += bayWType.getShortAV();\n+                                av += bayWType.getShortAV();\n                             }\n                         }\n                         fDamage = (float) (av * threat);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3Mjc5Ng==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r459172796", "bodyText": "Let's put a comment on this public method.", "author": "NickAragua", "createdAt": "2020-07-23T01:36:12Z", "path": "megamek/src/megamek/common/Hex.java", "diffHunk": "@@ -590,20 +590,23 @@ public void getUnstuckModifier(int elev, PilotingRollData rollTarget) {\n             terrain.getUnstuckModifier(elev, rollTarget);\n         }\n     }\n+    \n+    public boolean hasCliffTopTowards(IHex otherHex) {", "originalCommit": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEwMjk4MQ==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r460102981", "bodyText": "Did.", "author": "SJuliez", "createdAt": "2020-07-24T14:52:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3Mjc5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b6098c0995f6213e5c84c5ecf5cde918f22dd2d1", "chunk": "diff --git a/megamek/src/megamek/common/Hex.java b/megamek/src/megamek/common/Hex.java\nindex 1d900aba65..d798dfc1ed 100644\n--- a/megamek/src/megamek/common/Hex.java\n+++ b/megamek/src/megamek/common/Hex.java\n\n@@ -591,6 +591,12 @@ public class Hex implements IHex, Serializable {\n         }\n     }\n     \n+    /** \n+     * True if this hex has a clifftop towards otherHex. This hex\n+     * must have the terrain CLIFF_TOP, it must have exits\n+     * specified (exits set to active) for the CLIFF_TOP terrain,\n+     * and must have an exit in the direction of otherHex.  \n+     */\n     public boolean hasCliffTopTowards(IHex otherHex) {\n     \treturn containsTerrain(Terrains.CLIFF_TOP) \n \t\t&& getTerrain(Terrains.CLIFF_TOP).hasExitsSpecified()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MjkyNw==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r459172927", "bodyText": "Should probably uncomment these guys?", "author": "NickAragua", "createdAt": "2020-07-23T01:36:34Z", "path": "megamek/src/megamek/common/MechSummaryCache.java", "diffHunk": "@@ -489,8 +489,8 @@ private boolean loadMechsFromDirectory(Vector<MechSummary> vMechs,\n             Set<String> sKnownFiles, long lLastCheck, File fDir,\n             boolean ignoreUnofficial) {\n         boolean bNeedsUpdate = false;\n-        loadReport.append(\"  Looking in \").append(fDir.getPath())\n-                .append(\"...\\n\");\n+//        loadReport.append(\"  Looking in \").append(fDir.getPath())", "originalCommit": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEwMzM0NA==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r460103344", "bodyText": "Right :) Although these clutter up the log.", "author": "SJuliez", "createdAt": "2020-07-24T14:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MjkyNw=="}], "type": "inlineReview", "revised_code": {"commit": "b6098c0995f6213e5c84c5ecf5cde918f22dd2d1", "chunk": "diff --git a/megamek/src/megamek/common/MechSummaryCache.java b/megamek/src/megamek/common/MechSummaryCache.java\nindex ffec1b72d3..2e8b20d62c 100644\n--- a/megamek/src/megamek/common/MechSummaryCache.java\n+++ b/megamek/src/megamek/common/MechSummaryCache.java\n\n@@ -489,8 +489,8 @@ public class MechSummaryCache {\n             Set<String> sKnownFiles, long lLastCheck, File fDir,\n             boolean ignoreUnofficial) {\n         boolean bNeedsUpdate = false;\n-//        loadReport.append(\"  Looking in \").append(fDir.getPath())\n-//                .append(\"...\\n\");\n+        loadReport.append(\"  Looking in \").append(fDir.getPath())\n+                .append(\"...\\n\");\n         int thisDirectoriesFileCount = 0;\n         String[] sa = fDir.list();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MzI0Mg==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r459173242", "bodyText": "It looks like a triplication of the 'is this affected by a cliff' code, so yet another argument to consolidate that logic.", "author": "NickAragua", "createdAt": "2020-07-23T01:38:01Z", "path": "megamek/src/megamek/common/MoveStep.java", "diffHunk": "@@ -3356,24 +3364,76 @@ public boolean isMovementPossible(IGame game, Coords src, int srcEl, CachedEntit\n                 return false;\n             }\n         }\n+        \n+        // Sheer Cliffs, TO p.39\n+        // Roads over cliffs cancel the cliff effects for units that move on roads\n+        boolean vehicleAffectedByCliff = entity instanceof Tank ", "originalCommit": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MzMyOQ==", "url": "https://github.com/MegaMek/megamek/pull/1992#discussion_r459173329", "bodyText": "A quadruplication!", "author": "NickAragua", "createdAt": "2020-07-23T01:38:27Z", "path": "megamek/src/megamek/server/Server.java", "diffHunk": "@@ -8720,6 +8721,69 @@ else if (bldgExited.equals(bldgEntered)\n                     }\n                 }\n             }\n+            \n+            // Sheer Cliffs, TO p.39\n+            boolean vehicleAffectedByCliff = entity instanceof Tank ", "originalCommit": "d5ae66882841d64c9cd845de44f62960b8a21dcd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "b6098c0995f6213e5c84c5ecf5cde918f22dd2d1", "url": "https://github.com/MegaMek/megamek/commit/b6098c0995f6213e5c84c5ecf5cde918f22dd2d1", "message": "Formatting, correcting mistakes", "committedDate": "2020-07-24T14:46:41Z", "type": "commit"}, {"oid": "e32f1f3bb46681396a585240acb0c83f443d43a7", "url": "https://github.com/MegaMek/megamek/commit/e32f1f3bb46681396a585240acb0c83f443d43a7", "message": "Formatting", "committedDate": "2020-07-24T14:50:29Z", "type": "commit"}, {"oid": "6fe1c049709b78929bb977a8133f0eaadf94a647", "url": "https://github.com/MegaMek/megamek/commit/6fe1c049709b78929bb977a8133f0eaadf94a647", "message": "Merge branch 'master17' into SJ_Incline\n\nConflicts:\n\tmegamek/data/images/hexes/bw_atmospheric.tileset\n\tmegamek/data/images/hexes/hq_atmospheric.tileset\n\tmegamek/data/images/hexes/hq_isometric.tileset\n\tmegamek/src/megamek/client/ui/swing/HexTileset.java", "committedDate": "2020-07-24T15:01:06Z", "type": "commit"}, {"oid": "0e9788c0e37c13457ac90b7677d3961ca879f183", "url": "https://github.com/MegaMek/megamek/commit/0e9788c0e37c13457ac90b7677d3961ca879f183", "message": "Switch grass and desert for the inclines", "committedDate": "2020-07-24T15:11:41Z", "type": "commit"}]}