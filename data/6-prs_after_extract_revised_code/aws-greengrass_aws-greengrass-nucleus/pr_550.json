{"pr_number": 550, "pr_title": "Send if component is root or not. Send FSS update on kernel start", "pr_createdAt": "2020-10-20T18:57:31Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/550", "timeline": [{"oid": "35b7f07f85afb28354a260241087e8bed363fb7b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/35b7f07f85afb28354a260241087e8bed363fb7b", "message": "Send if component is root or not. Send FSS message on kernel start.", "committedDate": "2020-10-22T20:53:40Z", "type": "forcePushed"}, {"oid": "3c10a387e4dbea73d338ac453174f8c16c6cc3f5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3c10a387e4dbea73d338ac453174f8c16c6cc3f5", "message": "Send if component is root or not. Send FSS message on kernel start.", "committedDate": "2020-10-22T20:56:45Z", "type": "forcePushed"}, {"oid": "457168071cc0664cefd90e599ec65b3d0f3a48f0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/457168071cc0664cefd90e599ec65b3d0f3a48f0", "message": "Send if component is root or not. Send FSS message on kernel start.", "committedDate": "2020-10-22T21:22:47Z", "type": "commit"}, {"oid": "457168071cc0664cefd90e599ec65b3d0f3a48f0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/457168071cc0664cefd90e599ec65b3d0f3a48f0", "message": "Send if component is root or not. Send FSS message on kernel start.", "committedDate": "2020-10-22T21:22:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ5NDE5OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/550#discussion_r510494198", "bodyText": "Can we compute this information in setComponentsToGroupsMapping?\nAlso it would be slightly more efficient if we use normal loop and break when isRoot is true", "author": "hui-yang", "createdAt": "2020-10-22T22:29:43Z", "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -571,4 +571,24 @@ private void setComponentsToGroupsMapping(Topics groupsToRootComponents) {\n         }\n         return allGroupNames;\n     }\n+\n+    /**\n+     * Checks whether a component is a root component or not.\n+     * @param componentName The name of the component.\n+     * @return a boolean indicating whether a component is a root component or not.\n+     */\n+    public boolean isComponentRoot(String componentName) {\n+        Topics groupToRootComponentsTopics = config.lookupTopics(GROUP_TO_ROOT_COMPONENTS_TOPICS);\n+        AtomicBoolean isRoot = new AtomicBoolean(false);\n+        if (groupToRootComponentsTopics != null) {\n+            groupToRootComponentsTopics.children.values().stream().map(n -> (Topics) n)\n+                    .forEach(topics -> topics.children.values().stream().map(n -> (Topics) n)\n+                            .forEach(componentTopics -> {\n+                                if (componentName.equals(componentTopics.getName())) {\n+                                    isRoot.set(true);\n+                                }\n+                            }));", "originalCommit": "457168071cc0664cefd90e599ec65b3d0f3a48f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDUwMTk5Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/550#discussion_r510501997", "bodyText": "Not really. Don't want to use that mapping for more than what it suggests. Will make it into a normal for.", "author": "nikkhilmuthye", "createdAt": "2020-10-22T22:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ5NDE5OA=="}], "type": "inlineReview", "revised_code": {"commit": "67a9d9c1f16ade009f58d53c2ba27dd5d437756b", "chunk": "diff --git a/src/main/java/com/aws/greengrass/deployment/DeploymentService.java b/src/main/java/com/aws/greengrass/deployment/DeploymentService.java\nindex e015959dc..1e6c292bc 100644\n--- a/src/main/java/com/aws/greengrass/deployment/DeploymentService.java\n+++ b/src/main/java/com/aws/greengrass/deployment/DeploymentService.java\n\n@@ -579,16 +580,21 @@ public class DeploymentService extends GreengrassService {\n      */\n     public boolean isComponentRoot(String componentName) {\n         Topics groupToRootComponentsTopics = config.lookupTopics(GROUP_TO_ROOT_COMPONENTS_TOPICS);\n-        AtomicBoolean isRoot = new AtomicBoolean(false);\n         if (groupToRootComponentsTopics != null) {\n-            groupToRootComponentsTopics.children.values().stream().map(n -> (Topics) n)\n-                    .forEach(topics -> topics.children.values().stream().map(n -> (Topics) n)\n-                            .forEach(componentTopics -> {\n-                                if (componentName.equals(componentTopics.getName())) {\n-                                    isRoot.set(true);\n-                                }\n-                            }));\n+            for (Node node: groupToRootComponentsTopics.children.values()) {\n+                if (node instanceof Topics) {\n+                    Topics groupTopics = (Topics) node;\n+                    for (Node componentNode: groupTopics.children.values()) {\n+                        if (componentNode instanceof Topics) {\n+                            Topics componentTopics = (Topics) componentNode;\n+                            if (componentName.equals(componentTopics.getName())) {\n+                                return true;\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n         }\n-        return isRoot.get();\n+        return false;\n     }\n }\n"}}, {"oid": "67a9d9c1f16ade009f58d53c2ba27dd5d437756b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/67a9d9c1f16ade009f58d53c2ba27dd5d437756b", "message": "Address PR comments.", "committedDate": "2020-10-22T23:06:32Z", "type": "commit"}, {"oid": "a0ae9de39132ba7bf77031cec3f1c33bf9812037", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a0ae9de39132ba7bf77031cec3f1c33bf9812037", "message": "Merge branch 'master' into fssChanges", "committedDate": "2020-10-22T23:08:11Z", "type": "commit"}]}