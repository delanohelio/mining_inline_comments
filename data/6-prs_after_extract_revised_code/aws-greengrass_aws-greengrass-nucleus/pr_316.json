{"pr_number": 316, "pr_title": "Fixing E2E test as newly added cloud behavior to cancel old job if a \u2026", "pr_createdAt": "2020-07-16T01:00:08Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316", "timeline": [{"oid": "8533c2146202b4eccd7bc03535ff77df5efc7758", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8533c2146202b4eccd7bc03535ff77df5efc7758", "message": "Fixing E2E test as newly added cloud behavior to cancel old job if a new configuration for same group is set", "committedDate": "2020-07-16T00:59:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0OTM3OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316#discussion_r455449378", "bodyText": "do we need 5 minutes on the cancelled, seems a bit long", "author": "MikeDombo", "createdAt": "2020-07-16T01:01:53Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/MultipleDeploymentsTest.java", "diffHunk": "@@ -115,20 +117,25 @@ void GIVEN_offline_device_WHEN_create_multiple_deployments_THEN_deployments_exec\n \n             IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n                     Duration.ofMinutes(1), s -> s.ordinal() >= JobExecutionStatus.QUEUED.ordinal());\n-            logger.atWarn().kv(\"jobId\", helper.jobId).log(\"Created IoT Job\");\n+            logger.atWarn().kv(\"jobId\", helper.jobId).kv(\"index\", helper.index).log(\"Created IoT Job\");\n         }\n-\n-        subscribeToLocalDeploymentStatus(kernel, helpers);\n+        // Only the last job should execute\n+        subscribeToLocalDeploymentStatus(kernel, Arrays.asList(mostRecentJobHelper));\n \n         // Start kernel and connect IoT cloud\n         kernel.launch();\n \n         // Wait for all jobs to finish\n         for (DeploymentJobHelper helper : helpers) {\n-            assertTrue(helper.jobCompleted.await(2, TimeUnit.MINUTES), \"Deployment job timed out: \" + helper.jobId);\n-\n-            IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n-                    Duration.ofMinutes(5), s -> s.equals(JobExecutionStatus.SUCCEEDED));\n+            if (helper.index == 3) {\n+                assertTrue(helper.jobCompleted.await(2, TimeUnit.MINUTES), \"Deployment job timed out: \" + helper.jobId);\n+\n+                IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n+                        Duration.ofMinutes(5), s -> s.equals(JobExecutionStatus.SUCCEEDED));\n+            } else {\n+                IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n+                        Duration.ofMinutes(5), s -> s.equals(JobExecutionStatus.CANCELED));", "originalCommit": "8533c2146202b4eccd7bc03535ff77df5efc7758", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "b87b67681388157cf83b6e3311c019d1a76cc0d3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b87b67681388157cf83b6e3311c019d1a76cc0d3", "message": "Merge branch 'master' into E2ETestFix", "committedDate": "2020-07-16T05:47:36Z", "type": "commit"}]}