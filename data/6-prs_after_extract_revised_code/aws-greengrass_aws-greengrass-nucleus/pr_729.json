{"pr_number": 729, "pr_title": "Report deployment status before flipping symlinks in kernel update", "pr_createdAt": "2020-11-25T20:01:23Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/729", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcwMzI1Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/729#discussion_r530703256", "bodyText": "Shouldn't this block be after line 299?", "author": "fengwang666", "createdAt": "2020-11-26T00:12:48Z", "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -287,6 +288,14 @@ private void finishCurrentDeployment() throws InterruptedException {\n                             .persistAndPublishDeploymentStatus(currentDeploymentTaskMetadata.getDeploymentId(),\n                                                                currentDeploymentTaskMetadata.getDeploymentType(),\n                                                                JobStatus.SUCCEEDED.toString(), statusDetails);\n+\n+                    if (currentDeploymentTaskMetadata.getDeploymentTask() instanceof KernelUpdateDeploymentTask) {\n+                        try {\n+                            kernel.getContext().get(KernelAlternatives.class).activationSucceeds();\n+                        } catch (IOException e) {\n+                            logger.atError().log(\"Failed to reset Kernel activate directory\", e);\n+                        }\n+                    }", "originalCommit": "6343c3ec00905f3c3820d95b92c22e5f7bb765dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcwNzgwNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/729#discussion_r530707806", "bodyText": "I don't think so. If anything breaks before ln294, we can still restart into kernel activate and the ongoing deployment artifacts are needed.\nFailing to clean up the ongoing deployment artifacts is not as critical. If we have to process the new deployment or the same deployment again for some reason, the ongoing deployment artifacts will be cleaned up then as well.", "author": "hui-yang", "createdAt": "2020-11-26T00:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcwMzI1Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "712cd9c5c8bb696aac093a7cae9f1f74b3620be8", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/712cd9c5c8bb696aac093a7cae9f1f74b3620be8", "message": "Report deployment status before flipping symlinks", "committedDate": "2020-11-27T17:53:17Z", "type": "forcePushed"}, {"oid": "465b94e5024c0b2a77d7a13c629ddd0460e1b79e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/465b94e5024c0b2a77d7a13c629ddd0460e1b79e", "message": "Report deployment status before flipping symlinks", "committedDate": "2020-11-27T22:04:53Z", "type": "commit"}, {"oid": "8a0cd3c089a988736bb7e718fd363ebff7258581", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8a0cd3c089a988736bb7e718fd363ebff7258581", "message": "Figure out correct config file on launch", "committedDate": "2020-11-27T22:04:53Z", "type": "forcePushed"}, {"oid": "be9e01e8ee847ff499df7bf719aab22382f2dd07", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/be9e01e8ee847ff499df7bf719aab22382f2dd07", "message": "Figure out correct config file on launch", "committedDate": "2020-11-27T22:28:56Z", "type": "forcePushed"}, {"oid": "be01073e1a6cae94367ab85d347735f872eb0d11", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/be01073e1a6cae94367ab85d347735f872eb0d11", "message": "Figure out correct config file on launch", "committedDate": "2020-11-27T23:27:07Z", "type": "commit"}, {"oid": "be01073e1a6cae94367ab85d347735f872eb0d11", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/be01073e1a6cae94367ab85d347735f872eb0d11", "message": "Figure out correct config file on launch", "committedDate": "2020-11-27T23:27:07Z", "type": "forcePushed"}, {"oid": "fdfe642a644df36985e8549c8a762045d498077b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fdfe642a644df36985e8549c8a762045d498077b", "message": "Merge branch 'master' into P42006266", "committedDate": "2020-11-29T03:26:45Z", "type": "commit"}]}