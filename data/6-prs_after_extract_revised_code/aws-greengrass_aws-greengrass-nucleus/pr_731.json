{"pr_number": 731, "pr_title": "Revert \"Revert \"Redo - Get filename from greengrass uri (#594) (#647)\u2026", "pr_createdAt": "2020-11-25T21:02:17Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/731", "timeline": [{"oid": "29d4e502ceb6c8bc5b559eba83dd2f9c953028e2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/29d4e502ceb6c8bc5b559eba83dd2f9c953028e2", "message": "Revert \"Revert \"Redo - Get filename from greengrass uri (#594) (#647)\" (#667)\"\n\nThis reverts commit 5693d8c31beff4d5f222d43964e6d4edb09a3bcb.", "committedDate": "2020-11-25T21:01:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY1MjExNQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/731#discussion_r530652115", "bodyText": "Didn't realize we can write this way!", "author": "ShirleyZheng92", "createdAt": "2020-11-25T21:30:37Z", "path": "src/test/java/com/aws/greengrass/componentmanager/plugins/GreengrassRepositoryDownloaderTest.java", "diffHunk": "@@ -94,33 +90,33 @@ void GIVEN_artifact_url_WHEN_attempt_download_THEN_task_succeed() throws Excepti\n         Path saveToPath = testCache.resolve(\"CoolService\").resolve(\"1.0.0\");\n         Files.createDirectories(saveToPath);\n \n-        GreengrassRepositoryDownloader downloader = spy(new GreengrassRepositoryDownloader(clientFactory,\n-                pkgId, artifact, saveToPath, componentStore));\n+        GreengrassRepositoryDownloader downloader =\n+                spy(new GreengrassRepositoryDownloader(clientFactory, pkgId, artifact, saveToPath, componentStore));\n+\n+        assertThat(downloader.getArtifactFilename(), is(\"artifact.txt\"));\n \n         // mock requests to get downloadSize and local file name\n         GetComponentVersionArtifactResult result =\n                 new GetComponentVersionArtifactResult().withPreSignedUrl(\"https://www.amazon.com/artifact.txt\");\n-        when(client.getComponentVersionArtifact(getComponentVersionArtifactRequestArgumentCaptor.capture())).thenReturn(result);\n+        when(client.getComponentVersionArtifact(getComponentVersionArtifactRequestArgumentCaptor.capture()))\n+                .thenReturn(result);\n \n+        // mock requests to return partial stream\n         doReturn(connection).when(downloader).connect(any());\n-        when(connection.getResponseCode()).thenReturn(HttpURLConnection.HTTP_OK);\n         when(connection.getContentLengthLong()).thenReturn(Files.size(mockArtifactPath));\n-        when(connection.getHeaderField(\"Content-Disposition\")).thenReturn(\"filename=artifact.txt\");\n-        assertThat(downloader.getArtifactFilename(), is(\"artifact.txt\"));\n-\n-        // mock requests to return partial stream\n-        when(connection.getResponseCode()).thenReturn(HttpURLConnection.HTTP_PARTIAL);\n+        when(connection.getResponseCode()).thenReturn(HttpURLConnection.HTTP_OK)\n+                .thenReturn(HttpURLConnection.HTTP_PARTIAL);", "originalCommit": "29d4e502ceb6c8bc5b559eba83dd2f9c953028e2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "6771f0e9e6a20349967528c4b13cdaad1dd9c338", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6771f0e9e6a20349967528c4b13cdaad1dd9c338", "message": "Merge branch 'master' into revert-last-time", "committedDate": "2020-11-25T22:01:55Z", "type": "commit"}]}