{"pr_number": 336, "pr_title": "Integrate with cloud for safe-to-update check", "pr_createdAt": "2020-07-29T00:09:52Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336", "timeline": [{"oid": "8a40a820c99bf54a3a72930ffd2b23795bd577db", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8a40a820c99bf54a3a72930ffd2b23795bd577db", "message": "Integrate with cloud for safe-to-update check\n\nIntegrate with cloud for safe-to-update check. Add e2e test, make e2e\ntest to use cloud gamma endpoint.", "committedDate": "2020-07-29T00:02:33Z", "type": "commit"}, {"oid": "75eac9c39c4d677d4d208b5d45736ff2c4e9204a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/75eac9c39c4d677d4d208b5d45736ff2c4e9204a", "message": "update e2e test region", "committedDate": "2020-07-29T00:09:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2Mzk0Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336#discussion_r461963943", "bodyText": "TODO?", "author": "MikeDombo", "createdAt": "2020-07-29T00:11:07Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -249,12 +252,21 @@ protected static synchronized AWSEvergreen getFcsClient() {\n     @SuppressWarnings(\"PMD.LinguisticNaming\")\n     protected PublishConfigurationResult setAndPublishFleetConfiguration(SetConfigurationRequest setRequest) {\n         AWSEvergreen client = getFcsClient();\n+\n+        // update package name with random suffix to avoid conflict in cloud", "originalCommit": "75eac9c39c4d677d4d208b5d45736ff2c4e9204a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3MjUzNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336#discussion_r461972537", "bodyText": "It's not a TODO, it's modifying the setRequest", "author": "ShirleyZheng92", "createdAt": "2020-07-29T00:41:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2Mzk0Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NDQ3Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336#discussion_r461964477", "bodyText": "why do we need a new test, don't we have this covered by other tests?", "author": "MikeDombo", "createdAt": "2020-07-29T00:12:41Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/DeploymentE2ETest.java", "diffHunk": "@@ -275,6 +274,58 @@ void GIVEN_some_running_services_WHEN_cancel_event_received_and_kernel_is_waitin\n         Slf4jLogAdapter.removeGlobalListener(logListener);\n     }\n \n+    @Timeout(value = 10, unit = TimeUnit.MINUTES)\n+    @Test\n+    void GIVEN_deployment_received_WHEN_skip_safety_check_THEN_safety_check_skipped() throws Exception {", "originalCommit": "75eac9c39c4d677d4d208b5d45736ff2c4e9204a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3MjY0Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336#discussion_r461972642", "bodyText": "the SKIP_SAFETY_CHECK is not tested in e2e test, therefore I add here", "author": "ShirleyZheng92", "createdAt": "2020-07-29T00:42:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NDQ3Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8c2c1d773a2bd37150d35733398daed273516b12", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8c2c1d773a2bd37150d35733398daed273516b12", "message": "Merge branch 'master' into SafeToUpdateCheck", "committedDate": "2020-07-29T22:39:49Z", "type": "commit"}, {"oid": "37a42fbe4dc5b4404a926d3fab1fcd54a7623638", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/37a42fbe4dc5b4404a926d3fab1fcd54a7623638", "message": "Merge branch 'master' into SafeToUpdateCheck", "committedDate": "2020-07-30T17:21:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3NzU1Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336#discussion_r463177552", "bodyText": "This will only change the FCS endpoint to Gamma, the CMS endpoint seems to be coming from here https://github.com/aws/aws-greengrass-kernel/blob/master/src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java#L74 We should be changing this as well,\nThis is the endpoint information I got from the cloud team today -\nFor ComponentManagementService:\nBeta: https://uqtyx1gsuk.execute-api.us-east-1.amazonaws.com/Beta\nGamma: https://nztb5z87k6.execute-api.us-east-1.amazonaws.com/Gamma", "author": "shaguptashaikh", "createdAt": "2020-07-30T18:04:53Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -69,8 +72,8 @@\n  */\n @ExtendWith(EGExtension.class)\n public class BaseE2ETestCase implements AutoCloseable {\n-    protected static final String FCS_BETA_ENDPOINT = \"https://aqzw8qdn5l.execute-api.us-east-1.amazonaws.com/Beta\";\n-    protected static final Region BETA_REGION = Region.US_EAST_1;\n+    protected static final String FCS_GAMMA_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";", "originalCommit": "37a42fbe4dc5b4404a926d3fab1fcd54a7623638", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIwNzc1Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/336#discussion_r463207752", "bodyText": "Tried the CMS Gamma endpoint and get InvalidInputException of \"Artifacts can't be empty\" . Need to follow up with cloud on that later. Let's keep the Beta CMS endpoint for now", "author": "ShirleyZheng92", "createdAt": "2020-07-30T19:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3NzU1Mg=="}], "type": "inlineReview", "revised_code": null}]}