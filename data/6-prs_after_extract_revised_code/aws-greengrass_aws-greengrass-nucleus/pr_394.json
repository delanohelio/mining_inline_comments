{"pr_number": 394, "pr_title": "Fix S3 region again", "pr_createdAt": "2020-08-26T23:09:36Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/394", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY1OTE4Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/394#discussion_r477659182", "bodyText": "Should we log this?", "author": "philcali", "createdAt": "2020-08-26T23:17:01Z", "path": "src/main/java/com/aws/iot/evergreen/util/S3SdkClientFactory.java", "diffHunk": "@@ -25,14 +27,21 @@\n     /**\n      * Constructor.\n      *\n+     * @param deviceConfiguration device configuration\n      * @param credentialsProvider credential provider from TES\n      */\n     @Inject\n-    public S3SdkClientFactory(LazyCredentialProvider credentialsProvider) {\n+    public S3SdkClientFactory(DeviceConfiguration deviceConfiguration, LazyCredentialProvider credentialsProvider) {\n         this.credentialsProvider = credentialsProvider;\n+        Region region;\n+        try {\n+            region = new DefaultAwsRegionProviderChain().getRegion();\n+        } catch (RuntimeException ignored) {\n+            region = Region.of(Coerce.toString(deviceConfiguration.getAWSRegion()));\n+        }", "originalCommit": "01e71dd0432c1411b5e3513e8c3fd9d50668c72d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2fe948c797ecb0c6161796d834ec708f971d2af9", "chunk": "diff --git a/src/main/java/com/aws/iot/evergreen/util/S3SdkClientFactory.java b/src/main/java/com/aws/iot/evergreen/util/S3SdkClientFactory.java\nindex 586c9137d..30233a1aa 100644\n--- a/src/main/java/com/aws/iot/evergreen/util/S3SdkClientFactory.java\n+++ b/src/main/java/com/aws/iot/evergreen/util/S3SdkClientFactory.java\n\n@@ -31,6 +31,7 @@ public class S3SdkClientFactory {\n      * @param credentialsProvider credential provider from TES\n      */\n     @Inject\n+    @SuppressWarnings(\"PMD.AvoidCatchingGenericException\")\n     public S3SdkClientFactory(DeviceConfiguration deviceConfiguration, LazyCredentialProvider credentialsProvider) {\n         this.credentialsProvider = credentialsProvider;\n         Region region;\n"}}, {"oid": "2fe948c797ecb0c6161796d834ec708f971d2af9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2fe948c797ecb0c6161796d834ec708f971d2af9", "message": "Fix S3 region again", "committedDate": "2020-08-26T23:18:26Z", "type": "commit"}, {"oid": "2fe948c797ecb0c6161796d834ec708f971d2af9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2fe948c797ecb0c6161796d834ec708f971d2af9", "message": "Fix S3 region again", "committedDate": "2020-08-26T23:18:26Z", "type": "forcePushed"}]}