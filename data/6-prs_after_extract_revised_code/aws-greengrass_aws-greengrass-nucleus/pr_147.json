{"pr_number": 147, "pr_title": "Launch parameter", "pr_createdAt": "2020-04-01T18:57:19Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147", "timeline": [{"oid": "463af39dc1ce56159aef075ff84284839079076b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/463af39dc1ce56159aef075ff84284839079076b", "message": "Update parameter parsing to default root to a subdirectory of ~, and\nre-enable the -r switch.", "committedDate": "2020-03-31T22:38:14Z", "type": "commit"}, {"oid": "e045a1b6571044221f2ea2fb8caf3fc0f5f4e1d4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e045a1b6571044221f2ea2fb8caf3fc0f5f4e1d4", "message": "Update parameter parsing to default root to a subdirectory of ~, and\nre-enable the -r switch.", "committedDate": "2020-04-01T18:50:04Z", "type": "commit"}, {"oid": "efe22d08b91fb77111aef6c3976127a0ced1cf22", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/efe22d08b91fb77111aef6c3976127a0ced1cf22", "message": "Merge branch 'master' into launchParameter", "committedDate": "2020-04-01T19:26:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg2NjU5Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#discussion_r401866597", "bodyText": "better than (String) topic.getOnce()...", "author": "leaf94", "createdAt": "2020-04-01T19:46:18Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -161,12 +155,26 @@ public Kernel parseArgs(String... args) {\n                 case \"-print\":\n                     writeConfig(new OutputStreamWriter(System.out, StandardCharsets.UTF_8));\n                     break;\n+                case \"-root\":\n+                case \"-r\":\n+                    rootAbsolutePath = getArg();\n+                    break;\n                 default:\n                     logger.atError().log(\"Undefined command line argument: {}\", arg);\n                     broken = true;\n                     break;\n             }\n         }\n+        if (Utils.isEmpty(rootAbsolutePath)) {\n+            rootAbsolutePath = \"~/.evergreen\";  // Default to hidden subdirectory of home.\n+        }\n+        rootAbsolutePath = deTilde(rootAbsolutePath);\n+        if (!ensureCreated(Paths.get(rootAbsolutePath))) {\n+            logger.atError().log(\"{}: not a valid root directory\", rootAbsolutePath);\n+            broken = true;\n+        }\n+        lookup(\"system\", \"rootpath\").dflt(rootAbsolutePath)\n+                .subscribe((whatHappened, topic) -> initPaths(Coerce.toString(topic)));", "originalCommit": "efe22d08b91fb77111aef6c3976127a0ced1cf22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0ODk3Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#discussion_r401948973", "bodyText": "Yes, Coerce.* methods generally cover more of the odd corner cases.", "author": "JamesGosling", "createdAt": "2020-04-01T22:32:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg2NjU5Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg3MjM4Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#discussion_r401872382", "bodyText": "I guess new assignment of rootAbsolutePath  cannot be applied to the logging store for now, given how log4j initialized the file appender.\nBut we probably want to change that entirely and to re-instate the log queue, which would solve that from the source of evil (Sorry log4j...).", "author": "leaf94", "createdAt": "2020-04-01T19:56:37Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -161,12 +155,26 @@ public Kernel parseArgs(String... args) {\n                 case \"-print\":\n                     writeConfig(new OutputStreamWriter(System.out, StandardCharsets.UTF_8));\n                     break;\n+                case \"-root\":\n+                case \"-r\":\n+                    rootAbsolutePath = getArg();\n+                    break;\n                 default:\n                     logger.atError().log(\"Undefined command line argument: {}\", arg);\n                     broken = true;\n                     break;\n             }\n         }\n+        if (Utils.isEmpty(rootAbsolutePath)) {\n+            rootAbsolutePath = \"~/.evergreen\";  // Default to hidden subdirectory of home.\n+        }\n+        rootAbsolutePath = deTilde(rootAbsolutePath);", "originalCommit": "efe22d08b91fb77111aef6c3976127a0ced1cf22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1OTAwMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#discussion_r401959002", "bodyText": "In time...", "author": "JamesGosling", "createdAt": "2020-04-01T23:00:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg3MjM4Mg=="}], "type": "inlineReview", "revised_code": null}]}