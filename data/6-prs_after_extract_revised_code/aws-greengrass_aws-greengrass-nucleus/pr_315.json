{"pr_number": 315, "pr_title": "Fix tes test", "pr_createdAt": "2020-07-16T00:10:02Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315", "timeline": [{"oid": "70522281cab842083bf6ae9c24473bc14117608e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/70522281cab842083bf6ae9c24473bc14117608e", "message": "Fix tes test", "committedDate": "2020-07-16T00:04:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNTk3NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#discussion_r455435974", "bodyText": "save these in fields so you don't have to keep concatenating them together.", "author": "MikeDombo", "createdAt": "2020-07-16T00:12:29Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java", "diffHunk": "@@ -59,7 +60,7 @@ void tearDown() {\n         } finally {\n             deviceProvisioningHelper.cleanThing(IotSdkClientFactory.getIotClient(AWS_REGION), thingInfo);\n             IotJobsUtils.cleanUpIotRoleForTest(IotSdkClientFactory.getIotClient(AWS_REGION), IamSdkClientFactory.getIamClient(),\n-                    TES_ROLE_NAME, TES_ROLE_ALIAS_NAME, thingInfo.getCertificateArn());\n+                    TES_ROLE_NAME + roleId, TES_ROLE_ALIAS_NAME + roleId, thingInfo.getCertificateArn());", "originalCommit": "70522281cab842083bf6ae9c24473bc14117608e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9aed2a9d3bd0fa8589afda31e49858ad880471e", "chunk": "diff --git a/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java b/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java\nindex 4a50ae22b..c5d4ba730 100644\n--- a/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java\n+++ b/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java\n\n@@ -60,7 +64,7 @@ class TESTest extends BaseITCase {\n         } finally {\n             deviceProvisioningHelper.cleanThing(IotSdkClientFactory.getIotClient(AWS_REGION), thingInfo);\n             IotJobsUtils.cleanUpIotRoleForTest(IotSdkClientFactory.getIotClient(AWS_REGION), IamSdkClientFactory.getIamClient(),\n-                    TES_ROLE_NAME + roleId, TES_ROLE_ALIAS_NAME + roleId, thingInfo.getCertificateArn());\n+                    roleName, roleAliasName, thingInfo.getCertificateArn());\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNjExMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#discussion_r455436112", "bodyText": "Prefix these with e2etest so that we know what they are used for and can more easily find and delete them if needed.", "author": "MikeDombo", "createdAt": "2020-07-16T00:13:00Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java", "diffHunk": "@@ -38,8 +39,7 @@\n     private Kernel kernel;\n     private ThingInfo thingInfo;\n     private DeviceProvisioningHelper deviceProvisioningHelper;\n-    private static final String POLICY_NAME = \"TES_INTEG_TEST_POLICY\";\n-    private static final String THING_NAME = \"TES_INTEG_THING\";\n+    private String roleId;\n     private static final String AWS_REGION = \"us-east-1\";\n     private static final String TES_ROLE_NAME = \"TES_INTEG_ROLE\";\n     private static final String TES_ROLE_ALIAS_NAME = \"TES_INTEG_ROLE_ALIAS\";", "originalCommit": "70522281cab842083bf6ae9c24473bc14117608e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9aed2a9d3bd0fa8589afda31e49858ad880471e", "chunk": "diff --git a/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java b/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java\nindex 4a50ae22b..c5d4ba730 100644\n--- a/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java\n+++ b/src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java\n\n@@ -40,9 +40,11 @@ class TESTest extends BaseITCase {\n     private ThingInfo thingInfo;\n     private DeviceProvisioningHelper deviceProvisioningHelper;\n     private String roleId;\n+    private String roleName;\n+    private String roleAliasName;\n     private static final String AWS_REGION = \"us-east-1\";\n-    private static final String TES_ROLE_NAME = \"TES_INTEG_ROLE\";\n-    private static final String TES_ROLE_ALIAS_NAME = \"TES_INTEG_ROLE_ALIAS\";\n+    private static final String TES_ROLE_NAME = \"e2etest-TES_INTEG_ROLE\";\n+    private static final String TES_ROLE_ALIAS_NAME = \"e2etest-TES_INTEG_ROLE_ALIAS\";\n \n     @BeforeEach\n     void setupKernel() throws IOException {\n"}}, {"oid": "b9aed2a9d3bd0fa8589afda31e49858ad880471e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b9aed2a9d3bd0fa8589afda31e49858ad880471e", "message": "Add e2e prefix", "committedDate": "2020-07-16T01:16:48Z", "type": "commit"}, {"oid": "1a7444509924b8dc51df0f175411147f4f030bf4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1a7444509924b8dc51df0f175411147f4f030bf4", "message": "Delete all policies in cleanThing", "committedDate": "2020-07-16T02:35:10Z", "type": "commit"}, {"oid": "d4872701a54c35c05fb1048ac993f70bc4f3bb8e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d4872701a54c35c05fb1048ac993f70bc4f3bb8e", "message": "Remove unused imports", "committedDate": "2020-07-16T02:42:36Z", "type": "commit"}, {"oid": "bf47f33754712e931ed32eb108b7940da211aecb", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bf47f33754712e931ed32eb108b7940da211aecb", "message": "Modify unit test", "committedDate": "2020-07-16T03:26:58Z", "type": "commit"}, {"oid": "be0cf2db6209c3ba863e8cef2f59813385ae1446", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/be0cf2db6209c3ba863e8cef2f59813385ae1446", "message": "Merge branch 'master' into fix-tes-test", "committedDate": "2020-07-16T06:18:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTU1MjQwOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#discussion_r455552409", "bodyText": "formatting looks a bit off here, please reformat with intellij", "author": "MikeDombo", "createdAt": "2020-07-16T07:00:05Z", "path": "src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java", "diffHunk": "@@ -180,6 +184,12 @@ public void cleanThing(IotClient client, ThingInfo thing) {\n         client.deleteThing(DeleteThingRequest.builder().thingName(thing.thingName).build());\n         client.updateCertificate(UpdateCertificateRequest.builder().certificateId(thing.certificateId)\n                 .newStatus(CertificateStatus.INACTIVE).build());\n+        for (Policy p: client.listAttachedPolicies(", "originalCommit": "be0cf2db6209c3ba863e8cef2f59813385ae1446", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9e7aff5130217aae5becd9b3ba9f79f3c7fa32b7", "chunk": "diff --git a/src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java b/src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java\nindex 050dc1ed0..15799db68 100644\n--- a/src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java\n+++ b/src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java\n\n@@ -184,8 +183,9 @@ public class DeviceProvisioningHelper {\n         client.deleteThing(DeleteThingRequest.builder().thingName(thing.thingName).build());\n         client.updateCertificate(UpdateCertificateRequest.builder().certificateId(thing.certificateId)\n                 .newStatus(CertificateStatus.INACTIVE).build());\n-        for (Policy p: client.listAttachedPolicies(\n-                        ListAttachedPoliciesRequest.builder().target(thing.certificateArn).build()).policies()) {\n+        for (Policy p : client\n+                .listAttachedPolicies(ListAttachedPoliciesRequest.builder().target(thing.certificateArn).build())\n+                .policies()) {\n             client.detachPolicy(\n                     DetachPolicyRequest.builder().policyName(p.policyName()).target(thing.certificateArn).build());\n             client.deletePolicy(DeletePolicyRequest.builder().policyName(p.policyName()).build());\n"}}, {"oid": "9e7aff5130217aae5becd9b3ba9f79f3c7fa32b7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e7aff5130217aae5becd9b3ba9f79f3c7fa32b7", "message": "reformat", "committedDate": "2020-07-16T15:28:46Z", "type": "commit"}, {"oid": "92d9766061a4a20a416fe14d251ddfe254590a17", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/92d9766061a4a20a416fe14d251ddfe254590a17", "message": "Merge branch 'master' into fix-tes-test", "committedDate": "2020-07-16T17:03:23Z", "type": "commit"}]}