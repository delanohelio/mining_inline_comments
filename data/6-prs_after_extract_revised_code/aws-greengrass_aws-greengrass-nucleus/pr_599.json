{"pr_number": 599, "pr_title": "Use anonymous credentials for GCS", "pr_createdAt": "2020-11-02T00:30:16Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/599", "timeline": [{"oid": "5f3de697f1cb028cd055f250037112868079e943", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5f3de697f1cb028cd055f250037112868079e943", "message": "Use anonymous credentials for GCS", "committedDate": "2020-11-02T00:47:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY5OTMyNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/599#discussion_r515699326", "bodyText": "Can you add a comment explaining that we don't need a credential provider since GCS requests go through device gateway?", "author": "jbutler", "createdAt": "2020-11-02T01:09:07Z", "path": "src/main/java/com/aws/greengrass/componentmanager/GreengrassComponentServiceClientFactory.java", "diffHunk": "@@ -65,7 +67,9 @@ public GreengrassComponentServiceClientFactory(\n                     .log(\"Error during configure greengrass client mutual auth\", e);\n         }\n         AWSEvergreenClientBuilder clientBuilder =\n-                AWSEvergreenClientBuilder.standard().withClientConfiguration(clientConfiguration);\n+                AWSEvergreenClientBuilder.standard()\n+                        .withCredentials(new AWSStaticCredentialsProvider(new AnonymousAWSCredentials()))\n+                        .withClientConfiguration(clientConfiguration);", "originalCommit": "5f3de697f1cb028cd055f250037112868079e943", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6cc2e2ad55082c4af39e48eea560fb3d27c5e420", "chunk": "diff --git a/src/main/java/com/aws/greengrass/componentmanager/GreengrassComponentServiceClientFactory.java b/src/main/java/com/aws/greengrass/componentmanager/GreengrassComponentServiceClientFactory.java\nindex a211b81fcf..31dfcf23b0 100644\n--- a/src/main/java/com/aws/greengrass/componentmanager/GreengrassComponentServiceClientFactory.java\n+++ b/src/main/java/com/aws/greengrass/componentmanager/GreengrassComponentServiceClientFactory.java\n\n@@ -68,6 +68,8 @@ public class GreengrassComponentServiceClientFactory {\n         }\n         AWSEvergreenClientBuilder clientBuilder =\n                 AWSEvergreenClientBuilder.standard()\n+                        // Use an empty credential provider because our requests don't need SigV4\n+                        // signing, as they are going through IoT Core instead\n                         .withCredentials(new AWSStaticCredentialsProvider(new AnonymousAWSCredentials()))\n                         .withClientConfiguration(clientConfiguration);\n         String region = Coerce.toString(deviceConfiguration.getAWSRegion());\n"}}, {"oid": "6cc2e2ad55082c4af39e48eea560fb3d27c5e420", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6cc2e2ad55082c4af39e48eea560fb3d27c5e420", "message": "Use anonymous credentials for GCS", "committedDate": "2020-11-02T01:46:02Z", "type": "commit"}, {"oid": "6cc2e2ad55082c4af39e48eea560fb3d27c5e420", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6cc2e2ad55082c4af39e48eea560fb3d27c5e420", "message": "Use anonymous credentials for GCS", "committedDate": "2020-11-02T01:46:02Z", "type": "forcePushed"}]}