{"pr_number": 405, "pr_title": "Fixing deployment problems", "pr_createdAt": "2020-09-01T06:30:55Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405", "timeline": [{"oid": "942b401de45532aac55545f6a990fc6b45966afd", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/942b401de45532aac55545f6a990fc6b45966afd", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel", "committedDate": "2020-09-01T06:33:06Z", "type": "forcePushed"}, {"oid": "327462e9f4dd47caed559b48e23cddab59d9b5d4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/327462e9f4dd47caed559b48e23cddab59d9b5d4", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel", "committedDate": "2020-09-01T07:29:12Z", "type": "forcePushed"}, {"oid": "e8b4aeeba066ebc065f15697debd84edc673242a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e8b4aeeba066ebc065f15697debd84edc673242a", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel", "committedDate": "2020-09-01T16:13:12Z", "type": "forcePushed"}, {"oid": "333818f02402297635b2abe57e13397465b1998a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/333818f02402297635b2abe57e13397465b1998a", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel", "committedDate": "2020-09-01T16:45:56Z", "type": "commit"}, {"oid": "333818f02402297635b2abe57e13397465b1998a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/333818f02402297635b2abe57e13397465b1998a", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel", "committedDate": "2020-09-01T16:45:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyNTk1Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#discussion_r481325952", "bodyText": "Will service.reachedDesiredState() include evaluating RUNNING and FINISHED check?", "author": "abanthiy", "createdAt": "2020-09-01T17:51:15Z", "path": "src/main/java/com/aws/iot/evergreen/deployment/DeploymentConfigMerger.java", "diffHunk": "@@ -131,7 +131,8 @@ public static void waitForServicesToStart(Collection<EvergreenService> servicesT\n                     allServicesRunning = false;\n                     continue;\n                 }\n-                if (State.RUNNING.equals(state) || State.FINISHED.equals(state)) {\n+                if (State.RUNNING.equals(state) || State.FINISHED.equals(state) || !service.shouldAutoStart()\n+                        && service.reachedDesiredState()) {", "originalCommit": "333818f02402297635b2abe57e13397465b1998a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMDk0OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#discussion_r481330948", "bodyText": "I didn't want to change the existing behavior, so that's why I'm only checking for desired state when the service isn't autostarted (ie. for on-demand lambda).\nTechnically the desired state could be fulfilled by a regular service if it isn't running or finished because the state transition list could just be empty (before getting filled up)", "author": "MikeDombo", "createdAt": "2020-09-01T17:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyNTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM0MTYwNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#discussion_r481341607", "bodyText": "ok, ya that race condition can happen. NIT: Might be good to wrap the last condition in its own brackets.", "author": "abanthiy", "createdAt": "2020-09-01T18:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyNTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM0MzExNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#discussion_r481343114", "bodyText": "Yeah, I did, but PMD complained that they were unnecessary. I guess I could have just ignored it.", "author": "MikeDombo", "createdAt": "2020-09-01T18:22:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyNTk1Mg=="}], "type": "inlineReview", "revised_code": null}]}