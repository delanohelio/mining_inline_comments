{"pr_number": 175, "pr_title": "Cleanup service logging, address ignored InterruptedExceptions", "pr_createdAt": "2020-04-10T22:07:44Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175", "timeline": [{"oid": "f233853eb14a2a5a978409f7d0283da6e50fb94d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f233853eb14a2a5a978409f7d0283da6e50fb94d", "message": "Cleanup service logging, address ignored InterruptedExceptions", "committedDate": "2020-04-10T22:12:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk3NTExOA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#discussion_r406975118", "bodyText": "Use the short form?\nlogger.atInfo(\"service-set-state\").kv(\"newState\", newState).log();", "author": "fengwang666", "createdAt": "2020-04-10T22:56:38Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -95,8 +94,7 @@ private void updateStateAndBroadcast(State newState) {\n         }\n \n         // TODO: Add validation\n-        logger.atInfo().setEventType(\"service-set-state\").kv(CURRENT_STATE_METRIC_NAME, currentState)\n-                .kv(\"newState\", newState).log();\n+        logger.atInfo().setEventType(\"service-set-state\").kv(\"newState\", newState).log();", "originalCommit": "f233853eb14a2a5a978409f7d0283da6e50fb94d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk3NjMwMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#discussion_r406976303", "bodyText": "Fixed.", "author": "MikeDombo", "createdAt": "2020-04-10T23:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk3NTExOA=="}], "type": "inlineReview", "revised_code": {"commit": "c9868928230a3f32cc18019f74a67a8fe5a00ce6", "chunk": "diff --git a/src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java b/src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java\nindex 0421e0461..918044057 100644\n--- a/src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java\n+++ b/src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java\n\n@@ -94,7 +94,7 @@ public class Lifecycle {\n         }\n \n         // TODO: Add validation\n-        logger.atInfo().setEventType(\"service-set-state\").kv(\"newState\", newState).log();\n+        logger.atInfo(\"service-set-state\").kv(\"newState\", newState).log();\n \n         // Sync on State.class to make sure the order of setValue and globalNotifyStateChanged are consistent\n         // across different services.\n"}}, {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c9868928230a3f32cc18019f74a67a8fe5a00ce6", "message": "Cleanup service logging, address ignored InterruptedExceptions", "committedDate": "2020-04-10T23:24:26Z", "type": "commit"}, {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c9868928230a3f32cc18019f74a67a8fe5a00ce6", "message": "Cleanup service logging, address ignored InterruptedExceptions", "committedDate": "2020-04-10T23:24:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk4OTY4NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#discussion_r406989685", "bodyText": "how does this fix the loop you mentioned, just curious. Wont the thread wait at stateEventQueue.take() anyway?", "author": "fahadmohammed01", "createdAt": "2020-04-11T00:09:46Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -290,8 +283,8 @@ private boolean handleCurrentStateBroken(Optional<State> desiredState) {\n         if (State.NEW.equals(desiredState.get())) {\n             updateStateAndBroadcast(State.NEW);\n         } else {\n-            logger.atError().setEventType(\"service-broken\")\n-                    .log(\"service is broken. Deployment is needed\");\n+            logger.atError(\"service-broken\").log(\"service is broken. Deployment is needed\");\n+            return true;", "originalCommit": "c9868928230a3f32cc18019f74a67a8fe5a00ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk4OTc3NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#discussion_r406989774", "bodyText": "Yes, exactly. It waits instead of looping around forever. Without the change, it would repeat that error log all the time.", "author": "MikeDombo", "createdAt": "2020-04-11T00:10:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk4OTY4NQ=="}], "type": "inlineReview", "revised_code": null}]}