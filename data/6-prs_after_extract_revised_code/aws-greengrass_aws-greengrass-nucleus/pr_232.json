{"pr_number": 232, "pr_title": "Code clean up in config package", "pr_createdAt": "2020-05-11T19:23:25Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/232", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2Njk5Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/232#discussion_r423266992", "bodyText": "this isn't accurate to the real implementation since the service should be under services key.", "author": "MikeDombo", "createdAt": "2020-05-11T19:26:05Z", "path": "src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java", "diffHunk": "@@ -78,7 +79,8 @@ void setupContext() {\n         context.put(ExecutorService.class, executorService);\n         context.put(ThreadPoolExecutor.class, ses);\n \n-        config = new Topics(context, \"MockService\", null);\n+        Topics rootConfig = new Configuration(context).getRoot();\n+        config = rootConfig.createInteriorChild(\"MockService\");", "originalCommit": "cd461ad4cc3818e80930c977b9d137bc3f3412ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NjQwNQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/232#discussion_r423286405", "bodyText": "sure", "author": "ShirleyZheng92", "createdAt": "2020-05-11T20:03:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2Njk5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f159277ddf8fea51c37b961013e976deef98d9f5", "chunk": "diff --git a/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java b/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java\nindex 2d6c912d7..62c4e8300 100644\n--- a/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java\n+++ b/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java\n\n@@ -80,7 +80,8 @@ public class LifecycleTest {\n         context.put(ThreadPoolExecutor.class, ses);\n \n         Topics rootConfig = new Configuration(context).getRoot();\n-        config = rootConfig.createInteriorChild(\"MockService\");\n+        config = rootConfig.createInteriorChild(EvergreenService.SERVICES_NAMESPACE_TOPIC)\n+                .createInteriorChild(\"MockService\");\n         try (InputStream inputStream = new ByteArrayInputStream(BLANK_CONFIG_YAML_WITH_TIMEOUT.getBytes())) {\n             config.mergeMap(0, (Map) JSON.std.with(new YAMLFactory()).anyFrom(inputStream));\n         } catch (IOException e) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NzEzMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/232#discussion_r423267132", "bodyText": "Use the const we have for services.", "author": "MikeDombo", "createdAt": "2020-05-11T19:26:21Z", "path": "src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java", "diffHunk": "@@ -342,11 +344,11 @@ private void initLifecycleState(Lifecycle lf, State initState) {\n \n     @Test\n     public void GIVEN_service_starting_WHEN_dependency_errored_THEN_service_restarted() throws Exception {\n-        Topics serviceRoot = new Topics(context, \"services\", null);\n-        Topics testServiceTopics = new Topics(context, \"testService\", serviceRoot);\n+        Topics serviceRoot = new Configuration(context).getRoot().createInteriorChild(\"services\");", "originalCommit": "cd461ad4cc3818e80930c977b9d137bc3f3412ba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f159277ddf8fea51c37b961013e976deef98d9f5", "chunk": "diff --git a/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java b/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java\nindex 2d6c912d7..62c4e8300 100644\n--- a/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java\n+++ b/src/test/java/com/aws/iot/evergreen/kernel/LifecycleTest.java\n\n@@ -344,7 +345,8 @@ public class LifecycleTest {\n \n     @Test\n     public void GIVEN_service_starting_WHEN_dependency_errored_THEN_service_restarted() throws Exception {\n-        Topics serviceRoot = new Configuration(context).getRoot().createInteriorChild(\"services\");\n+        Topics serviceRoot = new Configuration(context).getRoot()\n+                .createInteriorChild(EvergreenService.SERVICES_NAMESPACE_TOPIC);\n         Topics testServiceTopics = serviceRoot.createInteriorChild(\"testService\");\n         TestService testService = new TestService(testServiceTopics);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NzY1MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/232#discussion_r423267650", "bodyText": "Please make sure that the internal http server doesn't rely on this, and if it does, then make a PR for that as well with the renaming.", "author": "MikeDombo", "createdAt": "2020-05-11T19:27:25Z", "path": "src/main/java/com/aws/iot/evergreen/config/Node.java", "diffHunk": "@@ -93,7 +93,7 @@ public String toString() {\n      * @param s a watcher to be added\n      * @return true if this is a new watcher; false if its a duplicate\n      */\n-    protected boolean listen(Watcher s) {\n+    protected boolean addWatcher(Watcher s) {", "originalCommit": "cd461ad4cc3818e80930c977b9d137bc3f3412ba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "f159277ddf8fea51c37b961013e976deef98d9f5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f159277ddf8fea51c37b961013e976deef98d9f5", "message": "Code clean up in config package", "committedDate": "2020-05-11T20:13:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNzM4NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/232#discussion_r423327384", "bodyText": "Remove this from Topics.java below as well", "author": "hui-yang", "createdAt": "2020-05-11T21:21:35Z", "path": "src/main/java/com/aws/iot/evergreen/config/Topic.java", "diffHunk": "@@ -71,15 +71,11 @@ public Object getOnce() {\n         return value;\n     }\n \n-    public void appendValueTo(Appendable a) throws IOException {", "originalCommit": "f159277ddf8fea51c37b961013e976deef98d9f5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "6544815f4932caa6d54c66d57864819cd74689c5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6544815f4932caa6d54c66d57864819cd74689c5", "message": "Code clean up in config package", "committedDate": "2020-05-11T22:00:52Z", "type": "commit"}, {"oid": "6544815f4932caa6d54c66d57864819cd74689c5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6544815f4932caa6d54c66d57864819cd74689c5", "message": "Code clean up in config package", "committedDate": "2020-05-11T22:00:52Z", "type": "forcePushed"}]}