{"pr_number": 588, "pr_title": "Move thing name out of nucleus recipe, add thing name env var to all \u2026", "pr_createdAt": "2020-10-30T05:05:32Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/588", "timeline": [{"oid": "eda381ca572529c82b4310476c41b9add2c78e48", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eda381ca572529c82b4310476c41b9add2c78e48", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T05:19:28Z", "type": "forcePushed"}, {"oid": "2d54514145d3ce84cfdf575fd823ca246b8bb485", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2d54514145d3ce84cfdf575fd823ca246b8bb485", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T05:23:55Z", "type": "forcePushed"}, {"oid": "89f3027de530687268779109bb12f8cef83d8c3c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/89f3027de530687268779109bb12f8cef83d8c3c", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T16:35:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI3Mjc0Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/588#discussion_r515272743", "bodyText": "Alternative place to add the common env var https://github.com/aws/aws-greengrass-nucleus/blob/1bd55b9439e26453f7ec8fdc3d941a2dbd752be4/src/main/java/com/aws/greengrass/lifecyclemanager/ShellRunner.java#L56-L63", "author": "hui-yang", "createdAt": "2020-10-30T17:41:43Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -563,6 +564,9 @@ protected void addEnv(Exec exec, Topics src) {\n                 }\n             });\n         }\n+\n+        // Always add thing name env var\n+        exec.setenv(AWS_IOT_THING_NAME_ENV, Coerce.toString(deviceConfiguration.getThingName()));", "originalCommit": "89f3027de530687268779109bb12f8cef83d8c3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5MzY3OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/588#discussion_r515293678", "bodyText": "It's just readily available in the service object, let me see if the deviceConfiguration object which supplies the thing name can be injected easily to this instead", "author": "shaguptashaikh", "createdAt": "2020-10-30T18:15:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI3Mjc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5NTMzMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/588#discussion_r515295332", "bodyText": "I would prefer to inject it in DeviceConfiguration which is what we do for AWS_REGION", "author": "MikeDombo", "createdAt": "2020-10-30T18:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI3Mjc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5NzU2Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/588#discussion_r515297562", "bodyText": "I thought about that, does it get propagated to each service if we set it there?", "author": "shaguptashaikh", "createdAt": "2020-10-30T18:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI3Mjc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5OTEzNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/588#discussion_r515299134", "bodyText": "Yeah, setting the top-level setenv applies to everything", "author": "MikeDombo", "createdAt": "2020-10-30T18:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI3Mjc0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "5f42fd7f9cfb0c601ef2ba4634eceb2fc83d470d", "chunk": "diff --git a/src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java b/src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java\nindex 0a89c9a4f7..34577c01eb 100644\n--- a/src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java\n+++ b/src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java\n\n@@ -564,9 +563,6 @@ public class GenericExternalService extends GreengrassService {\n                 }\n             });\n         }\n-\n-        // Always add thing name env var\n-        exec.setenv(AWS_IOT_THING_NAME_ENV, Coerce.toString(deviceConfiguration.getThingName()));\n     }\n \n     protected Exec addUserGroup(Exec exec) {\n"}}, {"oid": "51a0e0de9d7ea28ae6211735829f8c9d4c293172", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/51a0e0de9d7ea28ae6211735829f8c9d4c293172", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T18:18:52Z", "type": "forcePushed"}, {"oid": "5f42fd7f9cfb0c601ef2ba4634eceb2fc83d470d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5f42fd7f9cfb0c601ef2ba4634eceb2fc83d470d", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T18:56:16Z", "type": "forcePushed"}, {"oid": "23abb1152a65f6dd5b2c0bbc2a046d35b14679c9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/23abb1152a65f6dd5b2c0bbc2a046d35b14679c9", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T19:03:14Z", "type": "commit"}, {"oid": "23abb1152a65f6dd5b2c0bbc2a046d35b14679c9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/23abb1152a65f6dd5b2c0bbc2a046d35b14679c9", "message": "Move thing name out of nucleus recipe, add thing name env var to all components", "committedDate": "2020-10-30T19:03:14Z", "type": "forcePushed"}, {"oid": "2d129445a584f5e14fa37901bbcaaf9787774920", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2d129445a584f5e14fa37901bbcaaf9787774920", "message": "Merge branch 'master' into thingname", "committedDate": "2020-10-30T20:36:31Z", "type": "commit"}]}