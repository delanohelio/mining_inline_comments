{"pr_number": 790, "pr_title": "Fixing a race condition during validate config", "pr_createdAt": "2020-12-13T20:39:35Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/790", "timeline": [{"oid": "0e27172de6f6b602027f9c6f70a6905af4bbaa75", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0e27172de6f6b602027f9c6f70a6905af4bbaa75", "message": "Fixing a race condition during validate config", "committedDate": "2020-12-13T20:42:48Z", "type": "commit"}, {"oid": "0e27172de6f6b602027f9c6f70a6905af4bbaa75", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0e27172de6f6b602027f9c6f70a6905af4bbaa75", "message": "Fixing a race condition during validate config", "committedDate": "2020-12-13T20:42:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAwNjA4OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/790#discussion_r542006088", "bodyText": "Don't we remove all the todos as part of the open source effort? @jbutler", "author": "fengwang666", "createdAt": "2020-12-13T21:09:21Z", "path": "src/main/java/com/aws/greengrass/builtin/services/configstore/ConfigStoreIPCEventStreamAgent.java", "diffHunk": "@@ -524,13 +524,15 @@ public boolean validateConfiguration(String componentName, String deploymentId,\n             throws ValidateEventRegistrationException {\n         for (Map.Entry<String, BiConsumer<String, Map<String, Object>>> e : configValidationListeners.entrySet()) {\n             if (e.getKey().equals(componentName)) {\n+                Pair componentToDeploymentId = new Pair<>(componentName, deploymentId);\n                 try {\n+                    configValidationReportFutures.put(componentToDeploymentId, reportFuture);\n                     e.getValue().accept(deploymentId, configuration);\n-                    configValidationReportFutures.put(new Pair<>(componentName, deploymentId), reportFuture);\n                     return true;\n                 } catch (Exception ex) {\n                     // TODO: [P41211196]: Retries, timeouts & and better exception handling in sending server event to", "originalCommit": "0e27172de6f6b602027f9c6f70a6905af4bbaa75", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}