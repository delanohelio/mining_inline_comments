{"pr_number": 404, "pr_title": "Support local deployment's param version matching", "pr_createdAt": "2020-08-31T23:15:03Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/404", "timeline": [{"oid": "1a2dc0a4515f209c6779897104b140c3927ce92e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1a2dc0a4515f209c6779897104b140c3927ce92e", "message": "Support local deployment's param version matching", "committedDate": "2020-08-31T23:08:45Z", "type": "commit"}, {"oid": "6e7ec30bc4258f43f6a4c4c1bc3c1b3ee47ce793", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6e7ec30bc4258f43f6a4c4c1bc3c1b3ee47ce793", "message": "style", "committedDate": "2020-08-31T23:16:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MDEyMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/404#discussion_r480470121", "bodyText": "Is findAny() still correct?", "author": "shaguptashaikh", "createdAt": "2020-08-31T23:24:27Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/KernelConfigResolver.java", "diffHunk": "@@ -295,8 +297,12 @@ private String lookupParameterValueForComponent(\n                                                                                             String packageName,\n                                                                                             String packageVersion) {\n         return document.getDeploymentPackageConfigurationList().stream()\n-                .filter(packageConfig -> packageName.equals(packageConfig.getPackageName()) && packageVersion\n-                        .equals(packageConfig.getResolvedVersion())).findAny();\n+                       .filter(packageConfig ->\n+                               packageName.equals(packageConfig.getPackageName())\n+                                       // TODO packageConfig.getResolvedVersion() should be strongly typed when created\n+                                       && Requirement.buildNPM(packageConfig.getResolvedVersion())\n+                                                     .isSatisfiedBy(new Semver(packageVersion, Semver.SemverType.NPM)))\n+                       .findAny();", "originalCommit": "6e7ec30bc4258f43f6a4c4c1bc3c1b3ee47ce793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyMDU5MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/404#discussion_r481320590", "bodyText": "Good question. findAny and findFirst might both be correct, as a deployment doc could have multiple entries that satisfy the resolved version (which might change). Let's keep it for now I guess.", "author": "leaf94", "createdAt": "2020-09-01T17:42:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MDEyMQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "713e14f052d98bee1dcf66a07ca1ac310cfdb29a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/713e14f052d98bee1dcf66a07ca1ac310cfdb29a", "message": "Fix test due to a potential semver bug", "committedDate": "2020-09-01T17:30:42Z", "type": "commit"}, {"oid": "e552aed9c745e0863142876c456939dce9df309c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e552aed9c745e0863142876c456939dce9df309c", "message": "Get back tests", "committedDate": "2020-09-01T17:45:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzNDYyMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/404#discussion_r481334622", "bodyText": "What if the customer isn't specifying requirements? What if it is just 1.2?", "author": "MikeDombo", "createdAt": "2020-09-01T18:06:38Z", "path": "src/test/java/com/aws/iot/evergreen/packagemanager/KernelConfigResolverTest.java", "diffHunk": "@@ -406,7 +406,7 @@ void GIVEN_deployment_with_artifact_WHEN_config_resolution_requested_THEN_artifa\n         }}, Collections.emptyList(), Collections.emptyMap(), null);\n \n         DeploymentPackageConfiguration rootPackageDeploymentConfig =\n-                new DeploymentPackageConfiguration(TEST_INPUT_PACKAGE_A, true, \"1.2\", Collections.emptyMap());\n+                new DeploymentPackageConfiguration(TEST_INPUT_PACKAGE_A, true, \"=1.2\", Collections.emptyMap());", "originalCommit": "e552aed9c745e0863142876c456939dce9df309c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzNTI1Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/404#discussion_r481335257", "bodyText": "If it needs to be a version range, then we need to make this clear in the cloud", "author": "MikeDombo", "createdAt": "2020-09-01T18:07:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzNDYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM0Mzc0Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/404#discussion_r481343747", "bodyText": "1.2 should also work but it doesn't now. But 1.2.0 works. Took me some time to debug and found a werid error from Semver lib... I opened an issue with them: vdurmont/semver4j#46\nBut in reality, right now cloud and local will send a valid \"x.y.z\" with patch version specified, so we should be good.", "author": "leaf94", "createdAt": "2020-09-01T18:23:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzNDYyMg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a4170b1d56d5372a6c291d3243816e08030eae50", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a4170b1d56d5372a6c291d3243816e08030eae50", "message": "Merge branch 'master' into local_dev_param_version_match", "committedDate": "2020-09-01T18:24:15Z", "type": "commit"}]}