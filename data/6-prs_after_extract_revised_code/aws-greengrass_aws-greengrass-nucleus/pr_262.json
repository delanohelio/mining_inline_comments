{"pr_number": 262, "pr_title": "[Bug fix] When config path not given, initialize main service config \u2026", "pr_createdAt": "2020-06-01T16:57:03Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/262", "timeline": [{"oid": "a6adb692742410ecf12f28cfad076ef95141a4b4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a6adb692742410ecf12f28cfad076ef95141a4b4", "message": "[Bug fix] When config path not given, initialize main service config with minimal keys", "committedDate": "2020-06-01T16:54:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3MDUyNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/262#discussion_r433370526", "bodyText": "I don't think that this is exactly correct because it should try to read the config.yaml file from the root dir if nothing is specified. This logic should be even after that. Perhaps in the kernel launch.", "author": "MikeDombo", "createdAt": "2020-06-01T17:11:02Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java", "diffHunk": "@@ -95,6 +97,12 @@ public void parseArgs(String... args) {\n                     throw rte;\n             }\n         }\n+        // If no config path was given then initialize with default blank config\n+        if (!haveRead) {", "originalCommit": "a6adb692742410ecf12f28cfad076ef95141a4b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NDM1MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/262#discussion_r433384350", "bodyText": "I think it shouldn't matter, because if you want to launch the kernel then main service has to exist. In case if you have to look up config in the root.config folder it means that the config is not coming from outside but was written either before crash or was streamed/copied from some other device, and so it must have main service. After removing the child tree for lifecycle it does and means the same as doing this after reading from those files in the KernelLifecycle class. I have moved this there while trying to fix the build but either way it doesn't matter", "author": "shaguptashaikh", "createdAt": "2020-06-01T17:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3MDUyNg=="}], "type": "inlineReview", "revised_code": {"commit": "cda4f3380fcc4782e18e2f444a36134405932d4c", "chunk": "diff --git a/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java b/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java\nindex 77b398d01..c9707e0b5 100644\n--- a/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java\n+++ b/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java\n\n@@ -97,12 +95,6 @@ public class KernelCommandLine {\n                     throw rte;\n             }\n         }\n-        // If no config path was given then initialize with default blank config\n-        if (!haveRead) {\n-            kernel.getConfig()\n-                    .lookup(SERVICES_NAMESPACE_TOPIC, mainServiceName, SERVICE_LIFECYCLE_NAMESPACE_TOPIC, \"run\")\n-                    .withValue(\"echo \\\"Main Running\\\"\");\n-        }\n         if (Utils.isEmpty(rootAbsolutePath)) {\n             rootAbsolutePath = \"~/.evergreen\";  // Default to hidden subdirectory of home.\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3MDc3Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/262#discussion_r433370776", "bodyText": "You don't need to provide and should not provide a run by default.", "author": "MikeDombo", "createdAt": "2020-06-01T17:11:33Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java", "diffHunk": "@@ -95,6 +97,12 @@ public void parseArgs(String... args) {\n                     throw rte;\n             }\n         }\n+        // If no config path was given then initialize with default blank config\n+        if (!haveRead) {\n+            kernel.getConfig()\n+                    .lookup(SERVICES_NAMESPACE_TOPIC, mainServiceName, SERVICE_LIFECYCLE_NAMESPACE_TOPIC, \"run\")", "originalCommit": "a6adb692742410ecf12f28cfad076ef95141a4b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjE2OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/262#discussion_r433382168", "bodyText": "Yes I realized that later", "author": "shaguptashaikh", "createdAt": "2020-06-01T17:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3MDc3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "cda4f3380fcc4782e18e2f444a36134405932d4c", "chunk": "diff --git a/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java b/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java\nindex 77b398d01..c9707e0b5 100644\n--- a/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java\n+++ b/src/main/java/com/aws/iot/evergreen/kernel/KernelCommandLine.java\n\n@@ -97,12 +95,6 @@ public class KernelCommandLine {\n                     throw rte;\n             }\n         }\n-        // If no config path was given then initialize with default blank config\n-        if (!haveRead) {\n-            kernel.getConfig()\n-                    .lookup(SERVICES_NAMESPACE_TOPIC, mainServiceName, SERVICE_LIFECYCLE_NAMESPACE_TOPIC, \"run\")\n-                    .withValue(\"echo \\\"Main Running\\\"\");\n-        }\n         if (Utils.isEmpty(rootAbsolutePath)) {\n             rootAbsolutePath = \"~/.evergreen\";  // Default to hidden subdirectory of home.\n         }\n"}}, {"oid": "cda4f3380fcc4782e18e2f444a36134405932d4c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cda4f3380fcc4782e18e2f444a36134405932d4c", "message": "Fix", "committedDate": "2020-06-01T17:31:51Z", "type": "forcePushed"}, {"oid": "d42ee1f82d9b4065ebaeea060b9337012f972698", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d42ee1f82d9b4065ebaeea060b9337012f972698", "message": "Fix", "committedDate": "2020-06-01T18:08:51Z", "type": "commit"}, {"oid": "d42ee1f82d9b4065ebaeea060b9337012f972698", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d42ee1f82d9b4065ebaeea060b9337012f972698", "message": "Fix", "committedDate": "2020-06-01T18:08:51Z", "type": "forcePushed"}]}