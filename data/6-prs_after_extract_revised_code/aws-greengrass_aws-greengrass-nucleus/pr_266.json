{"pr_number": 266, "pr_title": "Use zt-process-killer/pkill to help us kill the whole process tree", "pr_createdAt": "2020-06-02T22:21:00Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/266", "timeline": [{"oid": "f5d4bdfb69444b581d9f5f8a869b869e8793bbaa", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f5d4bdfb69444b581d9f5f8a869b869e8793bbaa", "message": "Use zt-process-killer to help us kill the whole process tree", "committedDate": "2020-06-02T23:09:22Z", "type": "forcePushed"}, {"oid": "5a8fb98c717331792472a133a3075792d7c89328", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5a8fb98c717331792472a133a3075792d7c89328", "message": "Use zt-process-killer to help us kill the whole process tree", "committedDate": "2020-06-03T00:16:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTMxNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/266#discussion_r434251317", "bodyText": "Since you included windows here, we might also need setGracefulDestroyEnabled(true). It seems destroyGracefully is not allowed by default on windows.", "author": "hui-yang", "createdAt": "2020-06-03T00:52:11Z", "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -394,19 +399,30 @@ public synchronized void close() throws IOException {\n         if (p == null || !p.isAlive()) {\n             return;\n         }\n-        p.destroy();\n+\n+        PidProcess pp = Processes.newPidProcess(p);\n+\n+        if (pp instanceof UnixProcess) {\n+            pp = new UnixParentProcess(p, pp.getPid());\n+        } else if (pp instanceof WindowsProcess) {\n+            ((WindowsProcess) pp).setIncludeChildren(true);", "originalCommit": "5a8fb98c717331792472a133a3075792d7c89328", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7427e7d1bafd3aea22910c4a537a99ec5ef8ca0b", "chunk": "diff --git a/src/main/java/com/aws/iot/evergreen/util/Exec.java b/src/main/java/com/aws/iot/evergreen/util/Exec.java\nindex c225c9930..d04bf0a58 100644\n--- a/src/main/java/com/aws/iot/evergreen/util/Exec.java\n+++ b/src/main/java/com/aws/iot/evergreen/util/Exec.java\n\n@@ -406,6 +406,7 @@ public final class Exec implements Closeable {\n             pp = new UnixParentProcess(p, pp.getPid());\n         } else if (pp instanceof WindowsProcess) {\n             ((WindowsProcess) pp).setIncludeChildren(true);\n+            ((WindowsProcess) pp).setGracefulDestroyEnabled(true);\n         }\n \n         try {\n"}}, {"oid": "7427e7d1bafd3aea22910c4a537a99ec5ef8ca0b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7427e7d1bafd3aea22910c4a537a99ec5ef8ca0b", "message": "Use zt-process-killer to help us kill the whole process tree", "committedDate": "2020-06-03T02:56:25Z", "type": "commit"}, {"oid": "7427e7d1bafd3aea22910c4a537a99ec5ef8ca0b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7427e7d1bafd3aea22910c4a537a99ec5ef8ca0b", "message": "Use zt-process-killer to help us kill the whole process tree", "committedDate": "2020-06-03T02:56:25Z", "type": "forcePushed"}, {"oid": "77919d8e016413668cccb7fe4b92a9ab8b54424e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/77919d8e016413668cccb7fe4b92a9ab8b54424e", "message": "Merge branch 'master' into kill-children", "committedDate": "2020-06-03T18:07:20Z", "type": "commit"}]}