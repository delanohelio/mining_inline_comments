{"pr_number": 713, "pr_title": "Only log in pubsub when it actually subscribes or unsubscribes", "pr_createdAt": "2020-11-20T22:08:58Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/713", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzk5OTU1MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/713#discussion_r527999550", "bodyText": "why is unsub at debug while subscribe is info? I'd prefer if both were info", "author": "rbattle", "createdAt": "2020-11-20T22:14:49Z", "path": "src/main/java/com/aws/greengrass/builtin/services/pubsub/PubSubIPCEventStreamAgent.java", "diffHunk": "@@ -84,8 +85,14 @@ public void subscribe(String topic, Consumer<PublishEvent> cb, String serviceNam\n      * @param serviceName name of the service unsubscribing.\n      */\n     public void unsubscribe(String topic, Consumer<PublishEvent> cb, String serviceName) {\n-        log.atDebug().kv(COMPONENT_NAME, serviceName).log(\"Unsubscribing from topic {}\", topic);\n-        listeners.computeIfPresent(topic, (s, objects) -> objects.remove(cb) && objects.isEmpty() ? null : objects);\n+        AtomicBoolean removed = new AtomicBoolean(false);\n+        listeners.computeIfPresent(topic, (s, objects) -> {\n+            removed.set(objects.remove(cb));\n+            return objects.isEmpty() ? null : objects;\n+        });\n+        if (removed.get()) {\n+            log.atDebug().kv(COMPONENT_NAME, serviceName).log(\"Unsubscribed from topic {}\", topic);", "originalCommit": "70294da835bc68992e91cf48bd5314369c7e64b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMDE2NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/713#discussion_r528000165", "bodyText": "Just left it as it was. But updated now for you.", "author": "MikeDombo", "createdAt": "2020-11-20T22:16:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzk5OTU1MA=="}], "type": "inlineReview", "revised_code": {"commit": "fbe4bf22d79d5a1b76372656700c946d21ba1bc6", "chunk": "diff --git a/src/main/java/com/aws/greengrass/builtin/services/pubsub/PubSubIPCEventStreamAgent.java b/src/main/java/com/aws/greengrass/builtin/services/pubsub/PubSubIPCEventStreamAgent.java\nindex aaa721261..988dc3951 100644\n--- a/src/main/java/com/aws/greengrass/builtin/services/pubsub/PubSubIPCEventStreamAgent.java\n+++ b/src/main/java/com/aws/greengrass/builtin/services/pubsub/PubSubIPCEventStreamAgent.java\n\n@@ -91,7 +91,7 @@ public class PubSubIPCEventStreamAgent {\n             return objects.isEmpty() ? null : objects;\n         });\n         if (removed.get()) {\n-            log.atDebug().kv(COMPONENT_NAME, serviceName).log(\"Unsubscribed from topic {}\", topic);\n+            log.atInfo().kv(COMPONENT_NAME, serviceName).log(\"Unsubscribed from topic {}\", topic);\n         }\n     }\n \n"}}, {"oid": "fbe4bf22d79d5a1b76372656700c946d21ba1bc6", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fbe4bf22d79d5a1b76372656700c946d21ba1bc6", "message": "Only log in pubsub when it actually subscribes or unsubscribes", "committedDate": "2020-11-20T22:16:03Z", "type": "forcePushed"}, {"oid": "aa46c2cff5d26a64ae17d46114dab312daa0aac1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aa46c2cff5d26a64ae17d46114dab312daa0aac1", "message": "Only log in pubsub when it actually subscribes or unsubscribes", "committedDate": "2020-11-20T23:58:15Z", "type": "commit"}, {"oid": "aa46c2cff5d26a64ae17d46114dab312daa0aac1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aa46c2cff5d26a64ae17d46114dab312daa0aac1", "message": "Only log in pubsub when it actually subscribes or unsubscribes", "committedDate": "2020-11-20T23:58:15Z", "type": "forcePushed"}]}