{"pr_number": 3539, "pr_title": "Fix wrong IP when resolving many domain names (conflict)", "pr_createdAt": "2020-08-18T12:55:31Z", "pr_url": "https://github.com/eclipse-vertx/vert.x/pull/3539", "timeline": [{"oid": "991e8691ee3ef6c457568f56b7eb0ba51aafc701", "url": "https://github.com/eclipse-vertx/vert.x/commit/991e8691ee3ef6c457568f56b7eb0ba51aafc701", "message": "Fix wrong IP when resolving many domain names (conflict)\n\nSigned-off-by: Joxit <joxit972@gmail.com>", "committedDate": "2020-08-18T12:57:50Z", "type": "commit"}, {"oid": "991e8691ee3ef6c457568f56b7eb0ba51aafc701", "url": "https://github.com/eclipse-vertx/vert.x/commit/991e8691ee3ef6c457568f56b7eb0ba51aafc701", "message": "Fix wrong IP when resolving many domain names (conflict)\n\nSigned-off-by: Joxit <joxit972@gmail.com>", "committedDate": "2020-08-18T12:57:50Z", "type": "forcePushed"}, {"oid": "4173feacd13acafa68bce1757dfc9abdf88fa512", "url": "https://github.com/eclipse-vertx/vert.x/commit/4173feacd13acafa68bce1757dfc9abdf88fa512", "message": "Use LongObjectMap<Query> instead of Map<String, Query>\n\nSigned-off-by: Joxit <joxit972@gmail.com>", "committedDate": "2020-08-20T16:30:27Z", "type": "commit"}, {"oid": "4173feacd13acafa68bce1757dfc9abdf88fa512", "url": "https://github.com/eclipse-vertx/vert.x/commit/4173feacd13acafa68bce1757dfc9abdf88fa512", "message": "Use LongObjectMap<Query> instead of Map<String, Query>\n\nSigned-off-by: Joxit <joxit972@gmail.com>", "committedDate": "2020-08-20T16:30:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEyODMyMg==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3539#discussion_r474128322", "bodyText": "why do we need to add a trailing dot and lower case the query ?", "author": "vietj", "createdAt": "2020-08-20T16:44:10Z", "path": "src/main/java/io/vertx/core/dns/impl/DnsClientImpl.java", "diffHunk": "@@ -279,6 +279,14 @@ public DnsClient reverseLookup(String address, Handler<AsyncResult<String>> hand\n     return promise.future();\n   }\n \n+  private long dnsMessageId(int id, String query) {\n+    query = query.toLowerCase();", "originalCommit": "4173feacd13acafa68bce1757dfc9abdf88fa512", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE2MzM4NA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3539#discussion_r474163384", "bodyText": "The trailing dot is from the DNS spec. And we can see it in Netty Codec, they are adding the trailing dot in the decode domain name function, so we need to add it when it's not present (we see the dot even with dig command line).\nI thought DNS servers were also insensitive to the case, but apparently not, so I can remove the toLowerCase()", "author": "Joxit", "createdAt": "2020-08-20T17:43:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEyODMyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzNzgyMg==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3539#discussion_r474537822", "bodyText": "I see, in this case I think we should in the client itself add a trailing dot to our queries when they are performed instead of having the encoder do it for us, e.g in the Query constructor, that would be more clear rather than doing it when computing the message id.", "author": "vietj", "createdAt": "2020-08-21T08:48:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEyODMyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5Mzc1NA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3539#discussion_r474793754", "bodyText": "I agree ! Updated :)", "author": "Joxit", "createdAt": "2020-08-21T16:11:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEyODMyMg=="}], "type": "inlineReview", "revised_code": {"commit": "914a4a722ed706e0321f565692d0d32b6bb7cfdd", "chunk": "diff --git a/src/main/java/io/vertx/core/dns/impl/DnsClientImpl.java b/src/main/java/io/vertx/core/dns/impl/DnsClientImpl.java\nindex b408cf960..c02623eca 100644\n--- a/src/main/java/io/vertx/core/dns/impl/DnsClientImpl.java\n+++ b/src/main/java/io/vertx/core/dns/impl/DnsClientImpl.java\n\n@@ -280,7 +280,6 @@ public final class DnsClientImpl implements DnsClient {\n   }\n \n   private long dnsMessageId(int id, String query) {\n-    query = query.toLowerCase();\n     if (!query.endsWith(\".\")) {\n       query += \".\";\n     }\n"}}, {"oid": "914a4a722ed706e0321f565692d0d32b6bb7cfdd", "url": "https://github.com/eclipse-vertx/vert.x/commit/914a4a722ed706e0321f565692d0d32b6bb7cfdd", "message": "Remove toLowerCase on query\n\nSigned-off-by: Joxit <joxit972@gmail.com>", "committedDate": "2020-08-20T17:45:58Z", "type": "commit"}, {"oid": "3b3c97f04cbf719a7d802b30a1db0619108d593c", "url": "https://github.com/eclipse-vertx/vert.x/commit/3b3c97f04cbf719a7d802b30a1db0619108d593c", "message": "Move trailling dot in Query constructor\n\nSigned-off-by: Joxit <joxit972@gmail.com>", "committedDate": "2020-08-21T16:09:51Z", "type": "commit"}]}