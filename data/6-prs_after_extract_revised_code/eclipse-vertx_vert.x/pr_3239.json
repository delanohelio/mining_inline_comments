{"pr_number": 3239, "pr_title": "Added default value for query parameters.", "pr_createdAt": "2020-01-01T13:08:09Z", "pr_url": "https://github.com/eclipse-vertx/vert.x/pull/3239", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYzNjMwNw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r363636307", "bodyText": "\"Return the first param value with the specified name or @code{defaultValue} when the query param is not present.\"", "author": "vietj", "createdAt": "2020-01-07T08:27:04Z", "path": "src/main/java/io/vertx/core/http/HttpServerRequest.java", "diffHunk": "@@ -170,6 +169,18 @@ default String getParam(String paramName) {\n     return params().get(paramName);\n   }\n \n+  /**\n+   * Return the first param value or defaultValue if the query param is not provided.", "originalCommit": "0def904ddcffbcd813602956ecf8583d81c3ce5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEwNDI5NA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r364104294", "bodyText": "Done.", "author": "hradecek", "createdAt": "2020-01-08T08:08:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYzNjMwNw=="}], "type": "inlineReview", "revised_code": {"commit": "70d9d24e20b84ab7b6b272ff8facb72f1753d5b0", "chunk": "diff --git a/src/main/java/io/vertx/core/http/HttpServerRequest.java b/src/main/java/io/vertx/core/http/HttpServerRequest.java\nindex 24f8b0ed1..ddac76b9d 100644\n--- a/src/main/java/io/vertx/core/http/HttpServerRequest.java\n+++ b/src/main/java/io/vertx/core/http/HttpServerRequest.java\n\n@@ -170,15 +170,16 @@ public interface HttpServerRequest extends ReadStream<Buffer> {\n   }\n \n   /**\n-   * Return the first param value or defaultValue if the query param is not provided.\n+   * Return the first param value with the specified name or {@code defaultValue} when the query param is not present\n    *\n    * @param paramName    the param name\n    * @param defaultValue the default value, must be non-null\n-   * @return the param value or default value\n+   * @return the param value or {@code defaultValue} when not present\n    */\n   default String getParam(String paramName, String defaultValue) {\n     Objects.requireNonNull(defaultValue, \"defaultValue\");\n-    return params().contains(paramName) ? params().get(paramName) : defaultValue;\n+    final String paramValue = params().get(paramName);\n+    return paramValue != null ? paramValue : defaultValue;\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYzNjUzMw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r363636533", "bodyText": "\"the param value or @code{defaultValue} when not present\"", "author": "vietj", "createdAt": "2020-01-07T08:27:41Z", "path": "src/main/java/io/vertx/core/http/HttpServerRequest.java", "diffHunk": "@@ -170,6 +169,18 @@ default String getParam(String paramName) {\n     return params().get(paramName);\n   }\n \n+  /**\n+   * Return the first param value or defaultValue if the query param is not provided.\n+   *\n+   * @param paramName    the param name\n+   * @param defaultValue the default value, must be non-null\n+   * @return the param value or default value", "originalCommit": "0def904ddcffbcd813602956ecf8583d81c3ce5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEwNDMyNQ==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r364104325", "bodyText": "Done.", "author": "hradecek", "createdAt": "2020-01-08T08:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYzNjUzMw=="}], "type": "inlineReview", "revised_code": {"commit": "70d9d24e20b84ab7b6b272ff8facb72f1753d5b0", "chunk": "diff --git a/src/main/java/io/vertx/core/http/HttpServerRequest.java b/src/main/java/io/vertx/core/http/HttpServerRequest.java\nindex 24f8b0ed1..ddac76b9d 100644\n--- a/src/main/java/io/vertx/core/http/HttpServerRequest.java\n+++ b/src/main/java/io/vertx/core/http/HttpServerRequest.java\n\n@@ -170,15 +170,16 @@ public interface HttpServerRequest extends ReadStream<Buffer> {\n   }\n \n   /**\n-   * Return the first param value or defaultValue if the query param is not provided.\n+   * Return the first param value with the specified name or {@code defaultValue} when the query param is not present\n    *\n    * @param paramName    the param name\n    * @param defaultValue the default value, must be non-null\n-   * @return the param value or default value\n+   * @return the param value or {@code defaultValue} when not present\n    */\n   default String getParam(String paramName, String defaultValue) {\n     Objects.requireNonNull(defaultValue, \"defaultValue\");\n-    return params().contains(paramName) ? params().get(paramName) : defaultValue;\n+    final String paramValue = params().get(paramName);\n+    return paramValue != null ? paramValue : defaultValue;\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk0MDc4MQ==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r363940781", "bodyText": "This method is a good idea! \ud83d\ude0e  I know I'm nitpicking, but may I suggest to skip the contains() call and just do a get() and if nul\ufffdl, then return defaultValue?  This will skip at least one MultiMap call.", "author": "petarov", "createdAt": "2020-01-07T20:40:28Z", "path": "src/main/java/io/vertx/core/http/HttpServerRequest.java", "diffHunk": "@@ -170,6 +169,18 @@ default String getParam(String paramName) {\n     return params().get(paramName);\n   }\n \n+  /**\n+   * Return the first param value or defaultValue if the query param is not provided.\n+   *\n+   * @param paramName    the param name\n+   * @param defaultValue the default value, must be non-null\n+   * @return the param value or default value\n+   */\n+  default String getParam(String paramName, String defaultValue) {\n+    Objects.requireNonNull(defaultValue, \"defaultValue\");\n+    return params().contains(paramName) ? params().get(paramName) : defaultValue;", "originalCommit": "0def904ddcffbcd813602956ecf8583d81c3ce5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEwNDU3Mw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r364104573", "bodyText": "I know I'm nitpicking\n\nNoo, I was actually thinking about this way of implementation too, but I found contains() then get() more general and interface-friendlier.\nBut you're right as definition of MultiMap#get() is: Something or null if there is no such entry.\nRe-implemented as you have suggested, thanks.", "author": "hradecek", "createdAt": "2020-01-08T08:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk0MDc4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "70d9d24e20b84ab7b6b272ff8facb72f1753d5b0", "chunk": "diff --git a/src/main/java/io/vertx/core/http/HttpServerRequest.java b/src/main/java/io/vertx/core/http/HttpServerRequest.java\nindex 24f8b0ed1..ddac76b9d 100644\n--- a/src/main/java/io/vertx/core/http/HttpServerRequest.java\n+++ b/src/main/java/io/vertx/core/http/HttpServerRequest.java\n\n@@ -170,15 +170,16 @@ public interface HttpServerRequest extends ReadStream<Buffer> {\n   }\n \n   /**\n-   * Return the first param value or defaultValue if the query param is not provided.\n+   * Return the first param value with the specified name or {@code defaultValue} when the query param is not present\n    *\n    * @param paramName    the param name\n    * @param defaultValue the default value, must be non-null\n-   * @return the param value or default value\n+   * @return the param value or {@code defaultValue} when not present\n    */\n   default String getParam(String paramName, String defaultValue) {\n     Objects.requireNonNull(defaultValue, \"defaultValue\");\n-    return params().contains(paramName) ? params().get(paramName) : defaultValue;\n+    final String paramValue = params().get(paramName);\n+    return paramValue != null ? paramValue : defaultValue;\n   }\n \n   /**\n"}}, {"oid": "70d9d24e20b84ab7b6b272ff8facb72f1753d5b0", "url": "https://github.com/eclipse-vertx/vert.x/commit/70d9d24e20b84ab7b6b272ff8facb72f1753d5b0", "message": "Added default value for query parameters.\n\nSigned-off-by: Ivo Hr\u00e1dek <ivohradek@gmail.com>", "committedDate": "2020-01-08T08:05:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMTIwMg==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3239#discussion_r364221202", "bodyText": "please start server like in other tests (using testAddress) so the test can run with other config such as native transport.", "author": "vietj", "createdAt": "2020-01-08T13:08:09Z", "path": "src/test/java/io/vertx/core/http/HttpTest.java", "diffHunk": "@@ -782,6 +782,29 @@ public void testNoParams() {\n     await();\n   }\n \n+  @Test\n+  public void testGetParamDefaultValue() {\n+    String paramName1 = \"foo\";\n+    String paramName1Value = \"bar\";\n+    String paramName2 = \"notPresentParam\";\n+    String defaultValue = \"defaultValue\";\n+    String reqUri = String.format(\"%s/?%s=%s\", DEFAULT_TEST_URI, paramName1, paramName1Value);\n+\n+    server.requestHandler(req -> {\n+      assertTrue(req.params().contains(paramName1));\n+      assertEquals(paramName1Value, req.getParam(paramName1, defaultValue));\n+      assertFalse(req.params().contains(paramName2));\n+      assertEquals(defaultValue, req.getParam(paramName2, defaultValue));\n+      req.response().end();\n+    });\n+\n+    server.listen(onSuccess(server -> {", "originalCommit": "70d9d24e20b84ab7b6b272ff8facb72f1753d5b0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "10a2b6c4cf6acffa5990f1c78fcbb40c2dc324af", "chunk": "diff --git a/src/test/java/io/vertx/core/http/HttpTest.java b/src/test/java/io/vertx/core/http/HttpTest.java\nindex 0bdd02739..8a1165cf2 100644\n--- a/src/test/java/io/vertx/core/http/HttpTest.java\n+++ b/src/test/java/io/vertx/core/http/HttpTest.java\n\n@@ -775,8 +847,10 @@ public abstract class HttpTest extends HttpTestBase {\n       req.response().end();\n     });\n \n-    server.listen(onSuccess(server -> {\n-      client.request(HttpMethod.GET, DEFAULT_HTTP_PORT, DEFAULT_HTTP_HOST, DEFAULT_TEST_URI, resp -> testComplete()).end();\n+    server.listen(testAddress, onSuccess(server -> {\n+      client.request(requestOptions).onComplete(onSuccess(req -> {\n+        req.send(onSuccess(resp -> testComplete()));\n+      }));\n     }));\n \n     await();\n"}}, {"oid": "10a2b6c4cf6acffa5990f1c78fcbb40c2dc324af", "url": "https://github.com/eclipse-vertx/vert.x/commit/10a2b6c4cf6acffa5990f1c78fcbb40c2dc324af", "message": "Added default value for query parameters.\n\nSigned-off-by: Ivo Hradek <ivohradek@gmail.com>", "committedDate": "2020-11-19T13:47:53Z", "type": "forcePushed"}, {"oid": "e0db7922631d000ea61ee9b2409198be193e3fd4", "url": "https://github.com/eclipse-vertx/vert.x/commit/e0db7922631d000ea61ee9b2409198be193e3fd4", "message": "Added default value for query parameters.\n\nSigned-off-by: Ivo Hradek <ivohradek@gmail.com>", "committedDate": "2021-07-02T06:30:22Z", "type": "commit"}, {"oid": "e0db7922631d000ea61ee9b2409198be193e3fd4", "url": "https://github.com/eclipse-vertx/vert.x/commit/e0db7922631d000ea61ee9b2409198be193e3fd4", "message": "Added default value for query parameters.\n\nSigned-off-by: Ivo Hradek <ivohradek@gmail.com>", "committedDate": "2021-07-02T06:30:22Z", "type": "forcePushed"}]}