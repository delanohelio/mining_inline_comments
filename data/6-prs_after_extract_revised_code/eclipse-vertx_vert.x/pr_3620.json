{"pr_number": 3620, "pr_title": "Don't disable resource leak detector if set by user", "pr_createdAt": "2020-10-30T17:04:11Z", "pr_url": "https://github.com/eclipse-vertx/vert.x/pull/3620", "timeline": [{"oid": "25bbc9fe10c46b086a2967c437de23e7003e6fcf", "url": "https://github.com/eclipse-vertx/vert.x/commit/25bbc9fe10c46b086a2967c437de23e7003e6fcf", "message": "Don't disable resource leak detector if set by user\n\nFixes https://github.com/eclipse-vertx/vert.x/issues/3616\n\nSigned-off-by: Jorge Vicente Cantero <jorgevc@fastmail.es>", "committedDate": "2020-10-30T17:47:01Z", "type": "commit"}, {"oid": "25bbc9fe10c46b086a2967c437de23e7003e6fcf", "url": "https://github.com/eclipse-vertx/vert.x/commit/25bbc9fe10c46b086a2967c437de23e7003e6fcf", "message": "Don't disable resource leak detector if set by user\n\nFixes https://github.com/eclipse-vertx/vert.x/issues/3616\n\nSigned-off-by: Jorge Vicente Cantero <jorgevc@fastmail.es>", "committedDate": "2020-10-30T17:47:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4MDQ5OA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3620#discussion_r515380498", "bodyText": "why 2 distinct property names ?", "author": "vietj", "createdAt": "2020-10-30T20:59:46Z", "path": "src/main/java/io/vertx/core/impl/VertxImpl.java", "diffHunk": "@@ -86,8 +86,12 @@\n   private static final int NETTY_IO_RATIO = Integer.getInteger(NETTY_IO_RATIO_PROPERTY_NAME, 50);\n \n   static {\n-    // Netty resource leak detection has a performance overhead and we do not need it in Vert.x\n-    ResourceLeakDetector.setLevel(ResourceLeakDetector.Level.DISABLED);\n+    // Disable Netty's resource leak detection to reduce the performance overhead if not set by user\n+    if (System.getProperty(\"io.netty.leakDetection.level\") != null ||", "originalCommit": "25bbc9fe10c46b086a2967c437de23e7003e6fcf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM5MjUyMw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3620#discussion_r515392523", "bodyText": "The second property name is a legacy one still used by some applications. I can remove it if you want but I preferred to add it for the sake of completeness, as migrating away from old system properties is not always trivial.", "author": "jvican", "createdAt": "2020-10-30T21:33:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4MDQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ3NzMxMg==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3620#discussion_r515477312", "bodyText": "can you add a comment about it ?", "author": "vietj", "createdAt": "2020-10-31T09:27:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4MDQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ3Nzc3Mw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3620#discussion_r515477773", "bodyText": "Sure thing \ud83d\udc4d", "author": "jvican", "createdAt": "2020-10-31T09:33:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4MDQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEzMDM3OA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3620#discussion_r516130378", "bodyText": "Done @vietj", "author": "jvican", "createdAt": "2020-11-02T17:17:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4MDQ5OA=="}], "type": "inlineReview", "revised_code": {"commit": "90b19f7cf5e005595d1a6f80d48c9eb8648648ad", "chunk": "diff --git a/src/main/java/io/vertx/core/impl/VertxImpl.java b/src/main/java/io/vertx/core/impl/VertxImpl.java\nindex 813dbaed9..c2de1aaad 100644\n--- a/src/main/java/io/vertx/core/impl/VertxImpl.java\n+++ b/src/main/java/io/vertx/core/impl/VertxImpl.java\n\n@@ -87,6 +87,7 @@ public class VertxImpl implements VertxInternal, MetricsProvider {\n \n   static {\n     // Disable Netty's resource leak detection to reduce the performance overhead if not set by user\n+    // Supports both the default netty leak detection system property and the deprecated one\n     if (System.getProperty(\"io.netty.leakDetection.level\") != null ||\n         System.getProperty(\"io.netty.leakDetectionLevel\") != null) {\n       ResourceLeakDetector.setLevel(ResourceLeakDetector.Level.DISABLED);\n"}}, {"oid": "90b19f7cf5e005595d1a6f80d48c9eb8648648ad", "url": "https://github.com/eclipse-vertx/vert.x/commit/90b19f7cf5e005595d1a6f80d48c9eb8648648ad", "message": "Clarify why we use two different system properties\n\nSigned-off-by: Jorge Vicente Cantero <jorgevc@fastmail.es>", "committedDate": "2020-11-02T17:18:15Z", "type": "commit"}, {"oid": "90b19f7cf5e005595d1a6f80d48c9eb8648648ad", "url": "https://github.com/eclipse-vertx/vert.x/commit/90b19f7cf5e005595d1a6f80d48c9eb8648648ad", "message": "Clarify why we use two different system properties\n\nSigned-off-by: Jorge Vicente Cantero <jorgevc@fastmail.es>", "committedDate": "2020-11-02T17:18:15Z", "type": "forcePushed"}]}