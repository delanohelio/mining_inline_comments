{"pr_number": 3532, "pr_title": "Add route support to http server metrics.", "pr_createdAt": "2020-08-14T21:55:07Z", "pr_url": "https://github.com/eclipse-vertx/vert.x/pull/3532", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MDE0MQ==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3532#discussion_r470950141", "bodyText": "rename it routed like the original method.", "author": "vietj", "createdAt": "2020-08-15T07:37:04Z", "path": "src/main/java/io/vertx/core/http/impl/Http2ServerStream.java", "diffHunk": "@@ -128,4 +128,13 @@ void handleClose() {\n       }\n     }\n   }\n+\n+  void hasBeenRoutedTo(String routeName) {", "originalCommit": "8a2429c6efaa20bba61ff18305e31f4bc6b7a021", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MTYxNw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3532#discussion_r470951617", "bodyText": "I had it that way but it created an overload issue when not also returning the same type, which is not really possible here. Ideas?", "author": "jekkel", "createdAt": "2020-08-15T07:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MDE0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3Mjg4Nw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3532#discussion_r470972887", "bodyText": "Done.", "author": "jekkel", "createdAt": "2020-08-15T12:28:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MDE0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "6959883cb1b48dce9260df7c47a49bc5e8bd8908", "chunk": "diff --git a/src/main/java/io/vertx/core/http/impl/Http2ServerStream.java b/src/main/java/io/vertx/core/http/impl/Http2ServerStream.java\nindex 09a2f5895..4268c6a64 100644\n--- a/src/main/java/io/vertx/core/http/impl/Http2ServerStream.java\n+++ b/src/main/java/io/vertx/core/http/impl/Http2ServerStream.java\n\n@@ -129,12 +129,13 @@ abstract class Http2ServerStream extends VertxHttp2Stream<Http2ServerConnection>\n     }\n   }\n \n-  void hasBeenRoutedTo(String routeName) {\n+  HttpServerRequest routed(String route) {\n     if (METRICS_ENABLED) {\n       HttpServerMetrics metrics = conn.metrics();\n       if (metrics != null) {\n-        metrics.requestRouted(metric, routeName);\n+        metrics.requestRouted(metric, route);\n       }\n     }\n+    return null;\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MzI3NQ==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3532#discussion_r470973275", "bodyText": "rather route than routeName, in practice the literal route value is provided by vertx-web", "author": "vietj", "createdAt": "2020-08-15T12:32:58Z", "path": "src/main/java/io/vertx/core/http/HttpServerRequest.java", "diffHunk": "@@ -412,4 +412,15 @@ default int cookieCount() {\n    */\n   Map<String, Cookie> cookieMap();\n \n+\t/**\n+\t * Marks this request as being routed to the given route. This is purely informational and is\n+\t * being provided to metrics.\n+\t *\n+\t * @param routeName The name of the route this request has been routed to.\n+\t */\n+\t@Fluent\n+\tdefault HttpServerRequest routed(String routeName) {", "originalCommit": "cf61fc7b1e22035b576b12410cbfad8ec8825216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4MTYzMw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3532#discussion_r472881633", "bodyText": "gotcha. done.", "author": "jekkel", "createdAt": "2020-08-19T09:11:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MzI3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "6959883cb1b48dce9260df7c47a49bc5e8bd8908", "chunk": "diff --git a/src/main/java/io/vertx/core/http/HttpServerRequest.java b/src/main/java/io/vertx/core/http/HttpServerRequest.java\nindex ab1c7d8d0..79a590c76 100644\n--- a/src/main/java/io/vertx/core/http/HttpServerRequest.java\n+++ b/src/main/java/io/vertx/core/http/HttpServerRequest.java\n\n@@ -416,10 +416,10 @@ public interface HttpServerRequest extends ReadStream<Buffer> {\n \t * Marks this request as being routed to the given route. This is purely informational and is\n \t * being provided to metrics.\n \t *\n-\t * @param routeName The name of the route this request has been routed to.\n+\t * @param route The route this request has been routed to.\n \t */\n \t@Fluent\n-\tdefault HttpServerRequest routed(String routeName) {\n+\tdefault HttpServerRequest routed(String route) {\n \t  return this;\n   }\n \n"}}, {"oid": "6959883cb1b48dce9260df7c47a49bc5e8bd8908", "url": "https://github.com/eclipse-vertx/vert.x/commit/6959883cb1b48dce9260df7c47a49bc5e8bd8908", "message": "Add route support to http server metrics.\n\nSigned-off-by: J\u00f6rg Eichhorn <joerg.eichhorn@kiwigrid.com>", "committedDate": "2020-08-19T09:10:19Z", "type": "commit"}, {"oid": "9dbc07b8709da7df4e69d636cefa41441b2af1a1", "url": "https://github.com/eclipse-vertx/vert.x/commit/9dbc07b8709da7df4e69d636cefa41441b2af1a1", "message": "route metrics: ignore `routed()` if it's too late\n\nSigned-off-by: J\u00f6rg Eichhorn <joerg.eichhorn@kiwigrid.com>", "committedDate": "2020-08-20T18:25:25Z", "type": "commit"}]}