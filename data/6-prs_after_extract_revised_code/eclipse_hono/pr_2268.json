{"pr_number": 2268, "pr_title": "[#2267] Add implementation of Telemetry and EventSender", "pr_createdAt": "2020-10-27T10:54:22Z", "pr_url": "https://github.com/eclipse/hono/pull/2268", "timeline": [{"oid": "67b235e343a0be46558a1d943e88ce087a2727a2", "url": "https://github.com/eclipse/hono/commit/67b235e343a0be46558a1d943e88ce087a2727a2", "message": "[#2267] Add implementation of Telemetry and EventSender\n\nThe implementation reuses the existing vertx-proton based\nimplementations but replaces the existing factories.\n\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-27T10:51:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTAxMg==", "url": "https://github.com/eclipse/hono/pull/2268#discussion_r512669012", "bodyText": "The forRemoval param is Java 1.9 API, however the hono-core pom defines Java 1.8 to be used, so this gets marked as an error here. (Also in two more places in this class.)", "author": "calohmn", "createdAt": "2020-10-27T12:57:35Z", "path": "core/src/main/java/org/eclipse/hono/util/MessageHelper.java", "diffHunk": "@@ -1093,7 +1181,9 @@ public static Message newMessage(\n      * @return The message with its properties set.\n      * @throws NullPointerException if message or adapterTypeName are {@code null}.\n      * @throws IllegalArgumentException if target is {@code null} and the message does not have an address set.\n+     * @deprecated Use {@link #addProperties(Message, ResourceIdentifier, TenantObject, Map, Map, boolean, boolean)} instead.\n      */\n+    @Deprecated(forRemoval = true)", "originalCommit": "67b235e343a0be46558a1d943e88ce087a2727a2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "035c6839f498fabbc1f87c6bfe845106c0826d73", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/util/MessageHelper.java b/core/src/main/java/org/eclipse/hono/util/MessageHelper.java\nindex 5db984777..84c42013b 100644\n--- a/core/src/main/java/org/eclipse/hono/util/MessageHelper.java\n+++ b/core/src/main/java/org/eclipse/hono/util/MessageHelper.java\n\n@@ -1183,7 +1178,7 @@ public final class MessageHelper {\n      * @throws IllegalArgumentException if target is {@code null} and the message does not have an address set.\n      * @deprecated Use {@link #addProperties(Message, ResourceIdentifier, TenantObject, Map, Map, boolean, boolean)} instead.\n      */\n-    @Deprecated(forRemoval = true)\n+    @Deprecated\n     public static Message addProperties(\n             final Message msg,\n             final QoS qos,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTg3OQ==", "url": "https://github.com/eclipse/hono/pull/2268#discussion_r512669879", "bodyText": "Map.of and timeToLive.toSeconds() are Java 1.9 API (see above).", "author": "calohmn", "createdAt": "2020-10-27T12:58:55Z", "path": "core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java", "diffHunk": "@@ -315,24 +333,21 @@ public void testNewMessageUsesGivenTtlValue() {\n     public void testNewMessageLimitsTtlToMaxValue() {\n \n         final Duration timeToLive = Duration.ofSeconds(50);\n+        final Map<String, Object> props = Map.of(MessageHelper.SYS_HEADER_PROPERTY_TTL, timeToLive.toSeconds());", "originalCommit": "67b235e343a0be46558a1d943e88ce087a2727a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcwODM5Mw==", "url": "https://github.com/eclipse/hono/pull/2268#discussion_r512708393", "bodyText": "That is true. I wonder why the animal sniffer plugin doesn't detect this during the build ...", "author": "sophokles73", "createdAt": "2020-10-27T13:51:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTg3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcyMzgyMw==", "url": "https://github.com/eclipse/hono/pull/2268#discussion_r512723823", "bodyText": "Looks like version 1.18 of the sniffer plugin does not work, after upgrading to 1.19 the problems are detected by the build ...", "author": "sophokles73", "createdAt": "2020-10-27T14:09:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTg3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "035c6839f498fabbc1f87c6bfe845106c0826d73", "chunk": "diff --git a/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java b/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java\nindex ed6d4b164..68b5356d4 100644\n--- a/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java\n+++ b/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java\n\n@@ -333,7 +334,7 @@ public class MessageHelperTest {\n     public void testNewMessageLimitsTtlToMaxValue() {\n \n         final Duration timeToLive = Duration.ofSeconds(50);\n-        final Map<String, Object> props = Map.of(MessageHelper.SYS_HEADER_PROPERTY_TTL, timeToLive.toSeconds());\n+        final Map<String, Object> props = Collections.singletonMap(MessageHelper.SYS_HEADER_PROPERTY_TTL, timeToLive.getSeconds());\n         final ResourceIdentifier target = ResourceIdentifier.from(EventConstants.EVENT_ENDPOINT,\n                 Constants.DEFAULT_TENANT, \"4711\");\n         final TenantObject tenant = TenantObject.from(Constants.DEFAULT_TENANT, true);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3MDQ3Mw==", "url": "https://github.com/eclipse/hono/pull/2268#discussion_r512670473", "bodyText": "Map.of and timeToLive.toSeconds() are Java 1.9 API (see above).", "author": "calohmn", "createdAt": "2020-10-27T12:59:48Z", "path": "core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java", "diffHunk": "@@ -283,25 +304,22 @@ public void testAddPropertiesLimitsTtlToMaxValue() {\n     public void testNewMessageUsesGivenTtlValue() {\n \n         final Duration timeToLive = Duration.ofSeconds(10);\n+        final Map<String, Object> props = Map.of(MessageHelper.SYS_HEADER_PROPERTY_TTL, timeToLive.toSeconds());", "originalCommit": "67b235e343a0be46558a1d943e88ce087a2727a2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "035c6839f498fabbc1f87c6bfe845106c0826d73", "chunk": "diff --git a/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java b/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java\nindex ed6d4b164..68b5356d4 100644\n--- a/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java\n+++ b/core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java\n\n@@ -304,7 +305,7 @@ public class MessageHelperTest {\n     public void testNewMessageUsesGivenTtlValue() {\n \n         final Duration timeToLive = Duration.ofSeconds(10);\n-        final Map<String, Object> props = Map.of(MessageHelper.SYS_HEADER_PROPERTY_TTL, timeToLive.toSeconds());\n+        final Map<String, Object> props = Collections.singletonMap(MessageHelper.SYS_HEADER_PROPERTY_TTL, timeToLive.getSeconds());\n         final ResourceIdentifier target = ResourceIdentifier.from(EventConstants.EVENT_ENDPOINT,\n                 Constants.DEFAULT_TENANT, \"4711\");\n         final TenantObject tenant = TenantObject.from(Constants.DEFAULT_TENANT, true);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NjkxMQ==", "url": "https://github.com/eclipse/hono/pull/2268#discussion_r512676911", "bodyText": "The timeToLive parameter isn't used anymore.", "author": "calohmn", "createdAt": "2020-10-27T13:09:46Z", "path": "core/src/main/java/org/eclipse/hono/util/MessageHelper.java", "diffHunk": "@@ -953,9 +956,26 @@ public static Message newMessage(\n             final Duration timeToLive,", "originalCommit": "67b235e343a0be46558a1d943e88ce087a2727a2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "035c6839f498fabbc1f87c6bfe845106c0826d73", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/util/MessageHelper.java b/core/src/main/java/org/eclipse/hono/util/MessageHelper.java\nindex 5db984777..84c42013b 100644\n--- a/core/src/main/java/org/eclipse/hono/util/MessageHelper.java\n+++ b/core/src/main/java/org/eclipse/hono/util/MessageHelper.java\n\n@@ -956,22 +956,17 @@ public final class MessageHelper {\n             final Duration timeToLive,\n             final String adapterTypeName) {\n \n-        Objects.requireNonNull(target);\n-        Objects.requireNonNull(adapterTypeName);\n-\n-        final Map<String, Object> props = new HashMap<>();\n-        props.put(MessageHelper.APP_PROPERTY_ORIG_ADAPTER, adapterTypeName);\n-        if (qos != null) {\n-            props.put(MessageHelper.APP_PROPERTY_QOS, qos.ordinal());\n-        }\n-\n-        return MessageHelper.newMessage(\n+        return newMessage(\n+                qos,\n                 target,\n+                null,\n                 contentType,\n                 payload,\n                 tenant,\n-                props,\n                 null,\n+                null,\n+                timeToLive,\n+                adapterTypeName,\n                 false,\n                 false);\n     }\n"}}, {"oid": "035c6839f498fabbc1f87c6bfe845106c0826d73", "url": "https://github.com/eclipse/hono/commit/035c6839f498fabbc1f87c6bfe845106c0826d73", "message": "Do not use Java 9 API\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-27T14:40:53Z", "type": "commit"}]}