{"pr_number": 2092, "pr_title": "CoAP adapter: fix tracing info and add tests", "pr_createdAt": "2020-07-28T06:21:17Z", "pr_url": "https://github.com/eclipse/hono/pull/2092", "timeline": [{"oid": "f3e0d7b2203efdb6e4ebdf040ce2e5b273ee6521", "url": "https://github.com/eclipse/hono/commit/f3e0d7b2203efdb6e4ebdf040ce2e5b273ee6521", "message": "Add CoAP C&C tests concerning an unauthenticated device.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-07-24T12:39:19Z", "type": "commit"}, {"oid": "9f193237f76bfe5f8e3df3991807e8e70e7e7157", "url": "https://github.com/eclipse/hono/commit/9f193237f76bfe5f8e3df3991807e8e70e7e7157", "message": "Fix tracing info about whether a CoAP request is authenticated.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-07-28T06:12:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM3ODc2Ng==", "url": "https://github.com/eclipse/hono/pull/2092#discussion_r461378766", "bodyText": "I'm not sure, if a device, which doesn't use coaps, could be considered to be authenticated?", "author": "boaks", "createdAt": "2020-07-28T07:36:32Z", "path": "tests/src/test/java/org/eclipse/hono/tests/coap/CoapTestBase.java", "diffHunk": "@@ -1053,6 +1059,53 @@ private URI getRequestUri(final String scheme, final String resource) {\n         }\n     }\n \n+    /**\n+     * Creates a CoAP request using either the <em>coaps</em> or <em>coap</em> scheme,\n+     * depending on the given endpoint configuration.\n+     *\n+     * @param endpointConfig The endpoint configuration.\n+     * @param requestDeviceId The identifier of the device to publish data for.\n+     * @param msgNo The message number.\n+     * @return The request to send.\n+     */\n+    protected Request createCoapsOrCoapRequest(\n+            final CoapCommandEndpointConfiguration endpointConfig,\n+            final String requestDeviceId,\n+            final int msgNo) {\n+\n+        if (endpointConfig.isSubscribeAsGatewayForSingleDevice()) {\n+            return createCoapsRequest(Code.PUT, getMessageType(), getPutResource(tenantId, requestDeviceId), msgNo);\n+        } else if (endpointConfig.isSubscribeAsUnauthenticatedDevice()) {\n+            return createCoapRequest(Code.PUT, getMessageType(), getPutResource(tenantId, requestDeviceId), msgNo);\n+        } else {\n+            return createCoapsRequest(Code.POST, getMessageType(), getPostResource(), msgNo);", "originalCommit": "9f193237f76bfe5f8e3df3991807e8e70e7e7157", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM4MTgwMQ==", "url": "https://github.com/eclipse/hono/pull/2092#discussion_r461381801", "bodyText": "The not-using-coaps request handling is done in the UnauthenticatedDevice block.", "author": "calohmn", "createdAt": "2020-07-28T07:42:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM3ODc2Ng=="}], "type": "inlineReview", "revised_code": null}]}