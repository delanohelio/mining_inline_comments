{"pr_number": 1853, "pr_title": "TenantInformation service should return result instead of the direct \u2026", "pr_createdAt": "2020-03-23T16:57:48Z", "pr_url": "https://github.com/eclipse/hono/pull/1853", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkzOTI0OQ==", "url": "https://github.com/eclipse/hono/pull/1853#discussion_r396939249", "bodyText": "is there a particular reason why you are using flatMap in some places and compose in other places?", "author": "sophokles73", "createdAt": "2020-03-24T07:09:34Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/device/AbstractRegistrationService.java", "diffHunk": "@@ -110,15 +111,17 @@ public void setTenantInformationService(final TenantInformationService tenantInf\n      * {@link #processAssertRegistration(DeviceKey, Span) processAssertRegistration} method to work.\n      */\n     @Override\n-    public Future<RegistrationResult>  assertRegistration(final String tenantId, final String deviceId, final Span span) {\n+    public Future<RegistrationResult> assertRegistration(final String tenantId, final String deviceId, final Span span) {\n \n         Objects.requireNonNull(tenantId);\n         Objects.requireNonNull(deviceId);\n         Objects.requireNonNull(span);\n \n         return this.tenantInformationService\n                 .tenantExists(tenantId, span)\n-                .flatMap(tenantKey -> processAssertRegistration(DeviceKey.from(tenantKey, deviceId), span)\n+                .flatMap(tenantKeyResult -> tenantKeyResult.isError()", "originalCommit": "e9fbd75e180f997cb49bf30d9af437e2fcbc02b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NTg5MQ==", "url": "https://github.com/eclipse/hono/pull/1853#discussion_r396995891", "bodyText": "Changed everything to compose to make it uniform across the codebase.", "author": "dejanb", "createdAt": "2020-03-24T09:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkzOTI0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "9107073eb35f2b9c6b50d52daf9a298a3f1c350a", "chunk": "diff --git a/services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/device/AbstractRegistrationService.java b/services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/device/AbstractRegistrationService.java\nindex 86d38c166..e43aff6d1 100644\n--- a/services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/device/AbstractRegistrationService.java\n+++ b/services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/device/AbstractRegistrationService.java\n\n@@ -119,7 +119,7 @@ public abstract class AbstractRegistrationService implements RegistrationService\n \n         return this.tenantInformationService\n                 .tenantExists(tenantId, span)\n-                .flatMap(tenantKeyResult -> tenantKeyResult.isError()\n+                .compose(tenantKeyResult -> tenantKeyResult.isError()\n                         ? Future.succeededFuture(RegistrationResult.from(tenantKeyResult.getStatus()))\n                         : processAssertRegistration(DeviceKey.from(tenantKeyResult.getPayload(), deviceId), span)\n                         .compose(result -> {\n"}}, {"oid": "9107073eb35f2b9c6b50d52daf9a298a3f1c350a", "url": "https://github.com/eclipse/hono/commit/9107073eb35f2b9c6b50d52daf9a298a3f1c350a", "message": "TenantInformation service should return result instead of the direct value", "committedDate": "2020-03-24T09:03:52Z", "type": "commit"}, {"oid": "9107073eb35f2b9c6b50d52daf9a298a3f1c350a", "url": "https://github.com/eclipse/hono/commit/9107073eb35f2b9c6b50d52daf9a298a3f1c350a", "message": "TenantInformation service should return result instead of the direct value", "committedDate": "2020-03-24T09:03:52Z", "type": "forcePushed"}]}