{"pr_number": 1852, "pr_title": "[#1272] Add tracing in HotrodBasedDeviceConnectionInfo", "pr_createdAt": "2020-03-23T08:24:06Z", "pr_url": "https://github.com/eclipse/hono/pull/1852", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjI5OTg0MQ==", "url": "https://github.com/eclipse/hono/pull/1852#discussion_r396299841", "bodyText": "get command handling adapter instances?\notherwise, it will be hard to guess what this span is for, won't it?", "author": "sophokles73", "createdAt": "2020-03-23T09:06:13Z", "path": "client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java", "diffHunk": "@@ -201,9 +206,12 @@ public HotrodBasedDeviceConnectionInfo(final RemoteCache<String, String> cache,\n     public Future<JsonObject> getCommandHandlingAdapterInstances(final String tenantId, final String deviceId,\n             final Set<String> viaGateways, final SpanContext context) {\n \n+        final Span span = createSpan(\"get command handling instances\", tenantId, deviceId, null, context);", "originalCommit": "2c613872ce6b9ffcddc195c4cd0c8a9901ac460a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNDI3OQ==", "url": "https://github.com/eclipse/hono/pull/1852#discussion_r396304279", "bodyText": "I've changed it accordingly.", "author": "calohmn", "createdAt": "2020-03-23T09:14:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjI5OTg0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "ecd4989654df81ae57238903e51ad61f8bfcd1d0", "chunk": "diff --git a/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java b/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java\nindex 3736ca87f..f68ee7f79 100644\n--- a/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java\n+++ b/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java\n\n@@ -206,7 +206,7 @@ public final class HotrodBasedDeviceConnectionInfo implements DeviceConnectionIn\n     public Future<JsonObject> getCommandHandlingAdapterInstances(final String tenantId, final String deviceId,\n             final Set<String> viaGateways, final SpanContext context) {\n \n-        final Span span = createSpan(\"get command handling instances\", tenantId, deviceId, null, context);\n+        final Span span = createSpan(\"get command handling adapter instances\", tenantId, deviceId, null, context);\n \n         final Future<JsonObject> resultFuture;\n         if (viaGateways.isEmpty()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwMTU5NQ==", "url": "https://github.com/eclipse/hono/pull/1852#discussion_r396301595", "bodyText": "IMHO this is a client as we are retrieving data from the remote grid, aren't we?", "author": "sophokles73", "createdAt": "2020-03-23T09:09:25Z", "path": "client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java", "diffHunk": "@@ -437,4 +484,17 @@ private void checkForCacheAvailability(final Promise<Status> status) {\n     @Override\n     public void registerLivenessChecks(final HealthCheckHandler livenessHandler) {\n     }\n+\n+    private Span createSpan(final String operationName, final String tenantId, final String deviceId,\n+            final String adapterInstanceId, final SpanContext spanContext) {\n+        final Tracer.SpanBuilder spanBuilder = TracingHelper.buildChildSpan(tracer, spanContext, operationName, getClass().getSimpleName())\n+                .withTag(Tags.SPAN_KIND.getKey(), Tags.SPAN_KIND_SERVER)", "originalCommit": "2c613872ce6b9ffcddc195c4cd0c8a9901ac460a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNDkwMg==", "url": "https://github.com/eclipse/hono/pull/1852#discussion_r396304902", "bodyText": "Yes, right. I've changed it to SPAN_KIND_CONSUMER.", "author": "calohmn", "createdAt": "2020-03-23T09:15:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwMTU5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMxNjA1OA==", "url": "https://github.com/eclipse/hono/pull/1852#discussion_r396316058", "bodyText": "FMPOV it should be SPAN_KIND_CLIENT as we invoke a remote API and get back a result (the data from the grid) ...", "author": "sophokles73", "createdAt": "2020-03-23T09:34:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwMTU5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMTAyMw==", "url": "https://github.com/eclipse/hono/pull/1852#discussion_r396321023", "bodyText": "Yes, fits better. I've changed it accordingly.", "author": "calohmn", "createdAt": "2020-03-23T09:42:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwMTU5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "ecd4989654df81ae57238903e51ad61f8bfcd1d0", "chunk": "diff --git a/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java b/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java\nindex 3736ca87f..f68ee7f79 100644\n--- a/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java\n+++ b/client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodBasedDeviceConnectionInfo.java\n\n@@ -488,7 +488,7 @@ public final class HotrodBasedDeviceConnectionInfo implements DeviceConnectionIn\n     private Span createSpan(final String operationName, final String tenantId, final String deviceId,\n             final String adapterInstanceId, final SpanContext spanContext) {\n         final Tracer.SpanBuilder spanBuilder = TracingHelper.buildChildSpan(tracer, spanContext, operationName, getClass().getSimpleName())\n-                .withTag(Tags.SPAN_KIND.getKey(), Tags.SPAN_KIND_SERVER)\n+                .withTag(Tags.SPAN_KIND.getKey(), Tags.SPAN_KIND_CONSUMER)\n                 .withTag(MessageHelper.APP_PROPERTY_TENANT_ID, tenantId)\n                 .withTag(MessageHelper.APP_PROPERTY_DEVICE_ID, deviceId);\n         if (adapterInstanceId != null) {\n"}}, {"oid": "ecd4989654df81ae57238903e51ad61f8bfcd1d0", "url": "https://github.com/eclipse/hono/commit/ecd4989654df81ae57238903e51ad61f8bfcd1d0", "message": "[#1272] Add tracing in HotrodBasedDeviceConnectionInfo.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-23T09:13:47Z", "type": "forcePushed"}, {"oid": "cc31e46133dbd578a10f7173b5cc4f783d2154e9", "url": "https://github.com/eclipse/hono/commit/cc31e46133dbd578a10f7173b5cc4f783d2154e9", "message": "[#1272] Add tracing in HotrodBasedDeviceConnectionInfo.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-23T09:39:34Z", "type": "commit"}, {"oid": "cc31e46133dbd578a10f7173b5cc4f783d2154e9", "url": "https://github.com/eclipse/hono/commit/cc31e46133dbd578a10f7173b5cc4f783d2154e9", "message": "[#1272] Add tracing in HotrodBasedDeviceConnectionInfo.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-23T09:39:34Z", "type": "forcePushed"}]}