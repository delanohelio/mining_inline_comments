{"pr_number": 1812, "pr_title": "Add tracer instance in HotrodBasedDeviceConnectionInfo", "pr_createdAt": "2020-03-05T09:53:53Z", "pr_url": "https://github.com/eclipse/hono/pull/1812", "timeline": [{"oid": "6db54d0267221477c1f6405b449eedf25a3696b9", "url": "https://github.com/eclipse/hono/commit/6db54d0267221477c1f6405b449eedf25a3696b9", "message": "Add tracer instance in HotrodBasedDeviceConnectionInfo.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-05T09:45:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NDM2Ng==", "url": "https://github.com/eclipse/hono/pull/1812#discussion_r388394366", "bodyText": "this will throw a NullPointerException if tracer is null, right? Is there actually a factory method producing an Optional<Tracer>?", "author": "sophokles73", "createdAt": "2020-03-05T16:05:52Z", "path": "client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/HotrodCacheConfig.java", "diffHunk": "@@ -79,12 +83,15 @@ public RemoteCacheManager remoteCacheManager() {\n      * in an Infinispan data grid.\n      *\n      * @param cache The remote cache in the Infinispan data grid.\n+     * @param tracer The OpenTracing {@code Tracer} to use for tracking requests done by clients created by this factory.\n+     *               If an empty Optional is given, the {@code NoopTracer} from OpenTracing will be used.\n      * @return The factory.\n      */\n     @Bean\n     @Qualifier(DeviceConnectionConstants.DEVICE_CONNECTION_ENDPOINT)\n     @ConditionalOnProperty(prefix = \"hono.device-connection\", name = \"server-list\")\n-    public BasicDeviceConnectionClientFactory hotrodBasedDeviceConnectionClientFactory(final HotrodCache<String, String> cache) {\n-        return new HotrodBasedDeviceConnectionClientFactory(cache);\n+    public BasicDeviceConnectionClientFactory hotrodBasedDeviceConnectionClientFactory(\n+            final HotrodCache<String, String> cache, final Optional<Tracer> tracer) {\n+        return new HotrodBasedDeviceConnectionClientFactory(cache, tracer.orElse(NoopTracerFactory.create()));", "originalCommit": "6db54d0267221477c1f6405b449eedf25a3696b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjA5NQ==", "url": "https://github.com/eclipse/hono/pull/1812#discussion_r388412095", "bodyText": "The method is supposed to be called by Spring.\nUsing Optional here is a way to tell Spring that such a Tracer bean is optional. In that sense it is an equivalent to using @Autowired(required = false) on a field or method (using Autowired on a method parameter is mostly ignored, as written here. Another alternative would be to use a @Nullable annotation, which I also see as a good solution, which would require an additional dependency though (com.google.code.findbugs:jsr305 I guess we haven't discussed usage of that yet).", "author": "calohmn", "createdAt": "2020-03-05T16:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NDM2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxNDcyMg==", "url": "https://github.com/eclipse/hono/pull/1812#discussion_r388414722", "bodyText": "Ah, I learn something new every day :-) In any case, IMHO you should document the NullPointerException ...", "author": "sophokles73", "createdAt": "2020-03-05T16:36:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NDM2Ng=="}], "type": "inlineReview", "revised_code": null}]}