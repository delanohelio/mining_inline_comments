{"pr_number": 2090, "pr_title": "Improve configuration classes", "pr_createdAt": "2020-07-23T11:54:35Z", "pr_url": "https://github.com/eclipse/hono/pull/2090", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMzkyOA==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r460733928", "bodyText": "I think it's common practice to rather use char[] for password fields.", "author": "calohmn", "createdAt": "2020-07-27T08:38:48Z", "path": "core/src/main/java/org/eclipse/hono/config/AbstractConfig.java", "diffHunk": "@@ -41,25 +41,23 @@\n     /**\n      *  A logger to be shared with subclasses.\n      */\n-    protected final Logger LOG = LoggerFactory.getLogger(getClass());\n+    public static final Logger LOG = LoggerFactory.getLogger(AbstractConfig.class);\n \n-    private String trustStorePath;\n-    private char[] trustStorePassword;\n-    private TrustOptions trustOptions;\n+    private String trustStorePath = \"\";\n+    private String trustStorePassword = \"\";", "originalCommit": "cbf1587e9b40d9fb62c394e887b84ba61c5e25e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYxOTM0NQ==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r461619345", "bodyText": "As all other libraries we are passing these passwords to are keeping them as Strings in memory, I don't think we're getting any benefits from keeping them as char arrays ourselves.\nAnd if we still chose to do so, I think getter/setter methods should follow that as well.\nAnyway, in my opinion we're just keeping a lot of transformation code that gives us no real benefits.", "author": "dejanb", "createdAt": "2020-07-28T14:20:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMzkyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2Mjk0OA==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r461862948", "bodyText": "Ok.", "author": "calohmn", "createdAt": "2020-07-28T20:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMzkyOA=="}], "type": "inlineReview", "revised_code": {"commit": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java b/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java\nindex 9f52d0add..083959275 100644\n--- a/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java\n+++ b/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java\n\n@@ -41,7 +41,7 @@ public abstract class AbstractConfig {\n     /**\n      *  A logger to be shared with subclasses.\n      */\n-    public static final Logger LOG = LoggerFactory.getLogger(AbstractConfig.class);\n+    protected final Logger LOG = LoggerFactory.getLogger(getClass());\n \n     private String trustStorePath = \"\";\n     private String trustStorePassword = \"\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczOTI5NA==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r460739294", "bodyText": "Can you explain the motivation here? With the old definition, there is the added info in the log from which actual (sub)class the log statements are coming.", "author": "calohmn", "createdAt": "2020-07-27T08:47:41Z", "path": "core/src/main/java/org/eclipse/hono/config/AbstractConfig.java", "diffHunk": "@@ -41,25 +41,23 @@\n     /**\n      *  A logger to be shared with subclasses.\n      */\n-    protected final Logger LOG = LoggerFactory.getLogger(getClass());\n+    public static final Logger LOG = LoggerFactory.getLogger(AbstractConfig.class);", "originalCommit": "cbf1587e9b40d9fb62c394e887b84ba61c5e25e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYxNjA1NQ==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r461616055", "bodyText": "That was left from the PoC phase as there were some issues with native image. Now everything works fine, so I reverted it back.", "author": "dejanb", "createdAt": "2020-07-28T14:16:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczOTI5NA=="}], "type": "inlineReview", "revised_code": {"commit": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java b/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java\nindex 9f52d0add..083959275 100644\n--- a/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java\n+++ b/core/src/main/java/org/eclipse/hono/config/AbstractConfig.java\n\n@@ -41,7 +41,7 @@ public abstract class AbstractConfig {\n     /**\n      *  A logger to be shared with subclasses.\n      */\n-    public static final Logger LOG = LoggerFactory.getLogger(AbstractConfig.class);\n+    protected final Logger LOG = LoggerFactory.getLogger(getClass());\n \n     private String trustStorePath = \"\";\n     private String trustStorePassword = \"\";\n"}}, {"oid": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "url": "https://github.com/eclipse/hono/commit/7b8ab2cda2916db2950778c3aa7d540731d4150f", "message": "Improve configuration classes", "committedDate": "2020-07-28T13:32:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2MDc5Ng==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464360796", "bodyText": "what's the reason for having to use an empty string as the initial value?", "author": "sophokles73", "createdAt": "2020-08-03T11:43:06Z", "path": "core/src/main/java/org/eclipse/hono/config/AuthenticatingClientConfigProperties.java", "diffHunk": "@@ -29,14 +30,15 @@\n \n     public static final String SERVER_ROLE_UNKNOWN = \"unknown\";\n \n-    private String credentialsPath;\n+    private String credentialsPath = \"\";\n     private String host = \"localhost\";\n     private boolean hostnameVerificationRequired = true;\n-    private char[] password;\n-    private int port;\n+    private String password = \"\";\n+    private int port = Constants.PORT_AMQPS;", "originalCommit": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQyNjk1MA==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464426950", "bodyText": "@sophokles73 At the moment with the way we use Quarkus, it is complaining when properties don't have default values. So this is a workaround. I haven't yet raised this with the Quarkus devs, but I can do that and we can revert it in the future. I'm not too fond of it myself either, but I wouldn't block the work just because of it.", "author": "dejanb", "createdAt": "2020-08-03T13:51:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2MDc5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzNzEyNg==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464437126", "bodyText": "yes, please do so. Honestly, I hate the guts out of it ;-)", "author": "sophokles73", "createdAt": "2020-08-03T14:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2MDc5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkzNDAwMg==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464934002", "bodyText": "Setting them explicitly to null also does the trick and it looks a bit nicer. So let's go with that for the moment and push for the fix.", "author": "dejanb", "createdAt": "2020-08-04T09:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2MDc5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b34cb122afc040c310dd1e005362f00af583eb57", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/config/AuthenticatingClientConfigProperties.java b/core/src/main/java/org/eclipse/hono/config/AuthenticatingClientConfigProperties.java\nindex 30160113a..8c8268147 100644\n--- a/core/src/main/java/org/eclipse/hono/config/AuthenticatingClientConfigProperties.java\n+++ b/core/src/main/java/org/eclipse/hono/config/AuthenticatingClientConfigProperties.java\n\n@@ -30,15 +30,15 @@ public class AuthenticatingClientConfigProperties extends AbstractConfig {\n \n     public static final String SERVER_ROLE_UNKNOWN = \"unknown\";\n \n-    private String credentialsPath = \"\";\n+    private String credentialsPath = null;\n     private String host = \"localhost\";\n     private boolean hostnameVerificationRequired = true;\n-    private String password = \"\";\n+    private String password = null;\n     private int port = Constants.PORT_AMQPS;\n     private String serverRole = SERVER_ROLE_UNKNOWN;\n \n     private boolean tlsEnabled = false;\n-    private String username = \"\";\n+    private String username = null;\n \n     /**\n      * Creates new properties with default values.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzODM1OQ==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464438359", "bodyText": "I do see value in creating the options once only. However, we then should also return the already created instance in subsequent invocations of this method. WDYT?", "author": "sophokles73", "createdAt": "2020-08-03T14:10:26Z", "path": "core/src/main/java/org/eclipse/hono/config/AbstractConfig.java", "diffHunk": "@@ -186,25 +175,21 @@ public final TrustOptions getTrustOptions() {\n         switch (format) {\n         case PEM:\n             LOG.debug(\"using certificates from file [{}] as trust anchor\", this.trustStorePath);\n-            trustOptions = new PemTrustOptions().addCertPath(this.trustStorePath);\n-            break;\n+            return new PemTrustOptions().addCertPath(this.trustStorePath);\n         case PKCS12:\n             LOG.debug(\"using certificates from PKCS12 key store [{}] as trust anchor\", this.trustStorePath);\n-            trustOptions = new PfxOptions()\n+            return new PfxOptions()\n                     .setPath(getTrustStorePath())\n                     .setPassword(getTrustStorePassword());\n-            break;\n         case JKS:\n             LOG.debug(\"using certificates from JKS key store [{}] as trust anchor\", this.trustStorePath);\n-            trustOptions = new JksOptions()\n+            return new JksOptions()", "originalCommit": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzOTQwNg==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464439406", "bodyText": "StringUtils.isNullOrEmpty()?", "author": "sophokles73", "createdAt": "2020-08-03T14:12:13Z", "path": "core/src/main/java/org/eclipse/hono/config/KeyLoader.java", "diffHunk": "@@ -162,10 +162,10 @@ public static KeyLoader fromFiles(final Vertx vertx, final String keyPath, final\n         PrivateKey privateKey = null;\n         List<Certificate> certChain = null;\n \n-        if (keyPath != null) {\n+        if (keyPath != null && !keyPath.isEmpty()) {", "originalCommit": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b34cb122afc040c310dd1e005362f00af583eb57", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/config/KeyLoader.java b/core/src/main/java/org/eclipse/hono/config/KeyLoader.java\nindex 4bbd366db..0d1077b9a 100644\n--- a/core/src/main/java/org/eclipse/hono/config/KeyLoader.java\n+++ b/core/src/main/java/org/eclipse/hono/config/KeyLoader.java\n\n@@ -162,10 +163,10 @@ public final class KeyLoader {\n         PrivateKey privateKey = null;\n         List<Certificate> certChain = null;\n \n-        if (keyPath != null && !keyPath.isEmpty()) {\n+        if (!Strings.isNullOrEmpty(keyPath)) {\n             privateKey = loadPrivateKeyFromFile(vertx, keyPath);\n         }\n-        if (certPath != null && !certPath.isEmpty()) {\n+        if (!Strings.isNullOrEmpty(certPath)) {\n             certChain = loadCertsFromFile(vertx, certPath);\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ0MDE0MQ==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464440141", "bodyText": "We usually use an abstract type for field declarations, don't we? Why can't we keep the Map here?", "author": "sophokles73", "createdAt": "2020-08-03T14:13:25Z", "path": "core/src/main/java/org/eclipse/hono/config/ProtocolAdapterProperties.java", "diffHunk": "@@ -36,7 +36,7 @@\n     private long eventLoopBlockedCheckTimeout = 5000L;\n     private int maxConnections = 0;\n     private Duration tenantIdleTimeout = DEFAULT_TENANT_IDLE_TIMEOUT;\n-    private Map<String, MapperEndpoint> mapperEndpoints = new HashMap<>();\n+    private HashMap<String, MapperEndpoint> mapperEndpoints = new HashMap<>();", "originalCommit": "7b8ab2cda2916db2950778c3aa7d540731d4150f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkzNTYxMw==", "url": "https://github.com/eclipse/hono/pull/2090#discussion_r464935613", "bodyText": "We're basically hitting this with using the Map: quarkusio/quarkus#8017. And that's not considered as the issue at the moment. We can create our own converter perhaps and I'll ask if there are a better way to do all this, but to me this is a quick/easy workaround that we can use for now.", "author": "dejanb", "createdAt": "2020-08-04T09:52:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ0MDE0MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "b34cb122afc040c310dd1e005362f00af583eb57", "url": "https://github.com/eclipse/hono/commit/b34cb122afc040c310dd1e005362f00af583eb57", "message": "Improve configuration classes", "committedDate": "2020-08-04T09:47:58Z", "type": "commit"}, {"oid": "b34cb122afc040c310dd1e005362f00af583eb57", "url": "https://github.com/eclipse/hono/commit/b34cb122afc040c310dd1e005362f00af583eb57", "message": "Improve configuration classes", "committedDate": "2020-08-04T09:47:58Z", "type": "forcePushed"}]}