{"pr_number": 1743, "pr_title": "[#1441] Make hard-coded event bus send timeout configurable.", "pr_createdAt": "2020-02-04T13:19:36Z", "pr_url": "https://github.com/eclipse/hono/pull/1743", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374691829", "bodyText": "does it make sense to set this to 0?", "author": "sophokles73", "createdAt": "2020-02-04T14:11:37Z", "path": "core/src/main/java/org/eclipse/hono/config/ServiceConfigProperties.java", "diffHunk": "@@ -205,4 +212,32 @@ public final String getCorsAllowedOrigin() {\n     public final void setCorsAllowedOrigin(final String corsAllowedOrigin) {\n         this.corsAllowedOrigin = Objects.requireNonNull(corsAllowedOrigin);\n     }\n+\n+    /**\n+     * Gets the send timeout value in milliseconds, which is to be used when sending a \n+     * message on the vert.x event bus.\n+     * <p>\n+     * The default value of this property is {@link #DEFAULT_SEND_TIMEOUT_IN_MS}.\n+     * \n+     * @return The send timeout value in milliseconds.\n+     */\n+    public final long getSendTimeOut() {\n+        return sendTimeOutInMs;\n+    }\n+\n+    /**\n+     * Sets the send timeout value in milliseconds, which is to be used when sending a \n+     * message on the vert.x event bus.\n+     * <p>\n+     * The default value of this property is {@link #DEFAULT_SEND_TIMEOUT_IN_MS}.\n+     * \n+     * @param sendTimeOutInMs The send timeout value in milliseconds.\n+     * @throws IllegalArgumentException if the timeout is negative.\n+     */\n+    public final void setSendTimeOut(final long sendTimeOutInMs) {\n+        if (sendTimeOutInMs < 0) {\n+            throw new IllegalArgumentException(\"send time out value must not be negative\");", "originalCommit": "42d359f706cbc3e08a13b6e034fe0cd57c4f2a36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczODAwOQ==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374738009", "bodyText": "Just I checked the implementation of DeliveryOptions.setSendTimeout(long timeout). They throw IllegalArgumentException, if the value is < 1 but its not documented in that method's javadoc. Anyway it cannot be set to 0. I will update it.", "author": "kaniyan", "createdAt": "2020-02-04T15:24:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc0MjE0OA==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374742148", "bodyText": "My point is actually that IMHO it doesn't make sense to accept a very small value here, i.e. we should enforce a minimum value that makes some sense, e.g. 500ms?", "author": "sophokles73", "createdAt": "2020-02-04T15:30:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc0OTI3OQ==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374749279", "bodyText": "I see now what do you mean. But how do we conclude for such a minimum value?  Anyway we set a default value of 3000ms. DeliveryOptions.setSendTimeout(...) allows to set any timeout value greater than 0ms. IMHO why should we forbid this flexibility by setting a minimum value?", "author": "kaniyan", "createdAt": "2020-02-04T15:41:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1Mzk1MA==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374753950", "bodyText": "Well, as I pointed out: because the system will not work if you set it to 1ms, will it?", "author": "sophokles73", "createdAt": "2020-02-04T15:48:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc2MDk2MA==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374760960", "bodyText": "Well, as I pointed out: because the system will not work if you set it to 1ms, will it?\n\nOk I see the point. The systems commonly we use are not yet so fast enough to set the value to 1 ms ;-). I will update it to a minimum value of 500ms.", "author": "kaniyan", "createdAt": "2020-02-04T15:59:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc4MDg4NA==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r374780884", "bodyText": "I have updated it with a minimum value of 500ms and pushed the changes. Would you mind taking a look?", "author": "kaniyan", "createdAt": "2020-02-04T16:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5MTgyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "58a57150dbbc42cffce8b9a3465adc25fb170aba", "chunk": "diff --git a/core/src/main/java/org/eclipse/hono/config/ServiceConfigProperties.java b/core/src/main/java/org/eclipse/hono/config/ServiceConfigProperties.java\nindex ea841622e..1bf4fb149 100644\n--- a/core/src/main/java/org/eclipse/hono/config/ServiceConfigProperties.java\n+++ b/core/src/main/java/org/eclipse/hono/config/ServiceConfigProperties.java\n\n@@ -232,11 +232,11 @@ public class ServiceConfigProperties extends ServerConfig {\n      * The default value of this property is {@link #DEFAULT_SEND_TIMEOUT_IN_MS}.\n      * \n      * @param sendTimeOutInMs The send timeout value in milliseconds.\n-     * @throws IllegalArgumentException if the timeout is negative.\n+     * @throws IllegalArgumentException if the timeout is less than 1 ms.\n      */\n     public final void setSendTimeOut(final long sendTimeOutInMs) {\n-        if (sendTimeOutInMs < 0) {\n-            throw new IllegalArgumentException(\"send time out value must not be negative\");\n+        if (sendTimeOutInMs < 1) {\n+            throw new IllegalArgumentException(\"send time out value must be > 0\");\n         }\n         this.sendTimeOutInMs = sendTimeOutInMs;\n     }\n"}}, {"oid": "58a57150dbbc42cffce8b9a3465adc25fb170aba", "url": "https://github.com/eclipse/hono/commit/58a57150dbbc42cffce8b9a3465adc25fb170aba", "message": "[#1441] Make hardcoded event bus send timeout configurable.\n\n This timeout value is used when sending a message on the vert.x event bus.\n\nSigned-off-by: Kartheeswaran Kalidass <Kartheeswaran.Kalidass@bosch.io>", "committedDate": "2020-02-04T15:32:10Z", "type": "forcePushed"}, {"oid": "b994f72923a9d22eaac9a117891b235dcc019fec", "url": "https://github.com/eclipse/hono/commit/b994f72923a9d22eaac9a117891b235dcc019fec", "message": "[#1441] Make hardcoded event bus send timeout configurable.\n\n This timeout value is used when sending a message on the vert.x event bus.\n\nSigned-off-by: Kartheeswaran Kalidass <Kartheeswaran.Kalidass@bosch.io>", "committedDate": "2020-02-04T16:28:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIzODk1MQ==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r375238951", "bodyText": "no need to deprecate this anymore, since it is private API now ...", "author": "sophokles73", "createdAt": "2020-02-05T12:57:02Z", "path": "service-base/src/main/java/org/eclipse/hono/service/AbstractEndpoint.java", "diffHunk": "@@ -171,10 +172,23 @@ public void registerReadinessChecks(final HealthCheckHandler handler) {\n      *  \n      * @param spanContext The {@code SpanContext} (may be {@code null}).\n      * @return The {@code DeliveryOptions}.\n+     * @deprecated Use {@link #createEventBusMessageDeliveryOptions(long, SpanContext)} instead.", "originalCommit": "b994f72923a9d22eaac9a117891b235dcc019fec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3NDI5Mg==", "url": "https://github.com/eclipse/hono/pull/1743#discussion_r375274292", "bodyText": "ok, I will remove it.", "author": "kaniyan", "createdAt": "2020-02-05T14:07:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIzODk1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "6b68adeee1583eb398d7dec149aa2a342717ae56", "chunk": "diff --git a/service-base/src/main/java/org/eclipse/hono/service/AbstractEndpoint.java b/service-base/src/main/java/org/eclipse/hono/service/AbstractEndpoint.java\nindex b08809e02..429d5352f 100644\n--- a/service-base/src/main/java/org/eclipse/hono/service/AbstractEndpoint.java\n+++ b/service-base/src/main/java/org/eclipse/hono/service/AbstractEndpoint.java\n\n@@ -165,20 +136,6 @@ public abstract class AbstractEndpoint implements Endpoint {\n         // empty default implementation\n     }\n \n-    /**\n-     * Creates {@code DeliveryOptions} that contain the given {@code SpanContext}.\n-     * <p>\n-     * To be used when sending a message on the vert.x event bus.\n-     *  \n-     * @param spanContext The {@code SpanContext} (may be {@code null}).\n-     * @return The {@code DeliveryOptions}.\n-     * @deprecated Use {@link #createEventBusMessageDeliveryOptions(long, SpanContext)} instead.\n-     */\n-    @Deprecated\n-    protected final DeliveryOptions createEventBusMessageDeliveryOptions(final SpanContext spanContext) {\n-        return createEventBusMessageDeliveryOptions(ServiceConfigProperties.DEFAULT_SEND_TIMEOUT_IN_MS, spanContext);\n-    }\n-\n     /**\n      * Creates {@code DeliveryOptions} that contain the given {@code SpanContext}.\n      *\n"}}, {"oid": "6b68adeee1583eb398d7dec149aa2a342717ae56", "url": "https://github.com/eclipse/hono/commit/6b68adeee1583eb398d7dec149aa2a342717ae56", "message": "[#1441] Make hardcoded event bus send timeout configurable.\n\n This timeout value is used when sending a message on the vert.x event bus.\n\nSigned-off-by: Kartheeswaran Kalidass <Kartheeswaran.Kalidass@bosch.io>", "committedDate": "2020-02-05T14:43:45Z", "type": "commit"}, {"oid": "6b68adeee1583eb398d7dec149aa2a342717ae56", "url": "https://github.com/eclipse/hono/commit/6b68adeee1583eb398d7dec149aa2a342717ae56", "message": "[#1441] Make hardcoded event bus send timeout configurable.\n\n This timeout value is used when sending a message on the vert.x event bus.\n\nSigned-off-by: Kartheeswaran Kalidass <Kartheeswaran.Kalidass@bosch.io>", "committedDate": "2020-02-05T14:43:45Z", "type": "forcePushed"}]}