{"pr_number": 1948, "pr_title": "[#1632] Keep link open on cmd disposition update timeout", "pr_createdAt": "2020-05-07T12:01:54Z", "pr_url": "https://github.com/eclipse/hono/pull/1948", "timeline": [{"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "url": "https://github.com/eclipse/hono/commit/4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "message": "[#1632] Keep link open on cmd disposition update timeout.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-05-07T14:22:46Z", "type": "commit"}, {"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "url": "https://github.com/eclipse/hono/commit/4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "message": "[#1632] Keep link open on cmd disposition update timeout.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-05-07T14:22:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgyNTU4Mg==", "url": "https://github.com/eclipse/hono/pull/1948#discussion_r422825582", "bodyText": "why not log the error to the span?", "author": "sophokles73", "createdAt": "2020-05-11T07:06:18Z", "path": "adapters/amqp-vertx/src/main/java/org/eclipse/hono/adapter/amqp/impl/VertxBasedAmqpProtocolAdapter.java", "diffHunk": "@@ -762,18 +749,29 @@ protected void handleRemoteSenderOpenForCommands(\n         });\n     }\n \n+    private void onCommandConnectionClose(final String tenantId, final String deviceId, final Device authenticatedDevice,\n+            final ProtocolAdapterCommandConsumer consumer, final OptionalInt traceSamplingPriority) {\n+\n+        final Span span = newSpan(\"handle closing of command connection\", authenticatedDevice, traceSamplingPriority);\n+        final Future<ProtonDelivery> sendEventFuture = sendDisconnectedTtdEvent(tenantId, deviceId, authenticatedDevice,\n+                span.context());\n+        final Future<Void> closeConsumerFuture = consumer.close(span.context());\n+\n+        CompositeFuture.join(sendEventFuture, closeConsumerFuture).recover(thr -> {\n+            Tags.ERROR.set(span, true);", "originalCommit": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg4MDIxOA==", "url": "https://github.com/eclipse/hono/pull/1948#discussion_r422880218", "bodyText": "The error(s) will be logged at the respective child spans. Therefore I think it's not needed here, also because both of the child operations could have failed, meaning there are 2 errors.", "author": "calohmn", "createdAt": "2020-05-11T08:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgyNTU4Mg=="}], "type": "inlineReview", "revised_code": null}]}