{"pr_number": 1032, "pr_title": "Port optimizations for primitive set operations to SetIterables.", "pr_createdAt": "2020-11-14T00:40:35Z", "pr_url": "https://github.com/eclipse/eclipse-collections/pull/1032", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzMwMzcyNg==", "url": "https://github.com/eclipse/eclipse-collections/pull/1032#discussion_r523303726", "bodyText": "the order doesn't seem to make any difference here...", "author": "mohrezaei", "createdAt": "2020-11-14T00:51:03Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java", "diffHunk": "@@ -51,8 +52,16 @@ private SetIterables()\n             SetIterable<? extends E> setB,\n             R targetSet)\n     {\n-        Iterate.addAllIterable(setA, targetSet);\n-        Iterate.addAllIterable(setB, targetSet);\n+        if (setA.size() > setB.size())", "originalCommit": "f18875bcfe503288aaf3f0803e623a7f2d54a916", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzMyNTM5Mw==", "url": "https://github.com/eclipse/eclipse-collections/pull/1032#discussion_r523325393", "bodyText": "Yes, I changed back to optimizing union so I can use UnifiedSet.newSet(setA) or UnifiedSet.newSet(setB), and reverted unionInto.", "author": "donraab", "createdAt": "2020-11-14T01:21:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzMwMzcyNg=="}], "type": "inlineReview", "revised_code": {"commit": "8ffdc4110079ba9cbbf5eadc9924a26feda5073b", "chunk": "diff --git a/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java b/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java\nindex 4902d638..0ee264ec 100644\n--- a/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java\n+++ b/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java\n\n@@ -44,7 +42,13 @@ public final class SetIterables\n             SetIterable<? extends E> setA,\n             SetIterable<? extends E> setB)\n     {\n-        return SetIterables.unionInto(setA, setB, UnifiedSet.newSet());\n+        if (setA.size() > setB.size())\n+        {\n+            UnifiedSet<E> result = UnifiedSet.newSet(setA);\n+            return result.withAll(setB);\n+        }\n+        UnifiedSet<E> result = UnifiedSet.newSet(setB);\n+        return result.withAll(setA);\n     }\n \n     public static <E, R extends Set<E>> R unionInto(\n"}}, {"oid": "8ffdc4110079ba9cbbf5eadc9924a26feda5073b", "url": "https://github.com/eclipse/eclipse-collections/commit/8ffdc4110079ba9cbbf5eadc9924a26feda5073b", "message": "Port optimizations for primitive set operations to SetIterables.\n\nSigned-off-by: Donald Raab <Donald.Raab@bnymellon.com>", "committedDate": "2020-11-14T05:40:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM4MDk5MQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/1032#discussion_r523380991", "bodyText": "The following code should reduce bytecode size and increase inlining chance:\nif (setA.size() > setB.size())\n{\n    SetIterable<? extends E> tmp = setA;\n    setA = setB;\n    setB = tmp;\n}\n(and below)", "author": "mohrezaei", "createdAt": "2020-11-14T05:48:46Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java", "diffHunk": "@@ -43,7 +42,13 @@ private SetIterables()\n             SetIterable<? extends E> setA,\n             SetIterable<? extends E> setB)\n     {\n-        return SetIterables.unionInto(setA, setB, UnifiedSet.newSet());\n+        if (setA.size() > setB.size())\n+        {\n+            UnifiedSet<E> result = UnifiedSet.newSet(setA);", "originalCommit": "8ffdc4110079ba9cbbf5eadc9924a26feda5073b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "895d6cfcebe052e63f7606188e0d97672c5174ed", "chunk": "diff --git a/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java b/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java\nindex 0ee264ec..8ca9b073 100644\n--- a/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java\n+++ b/eclipse-collections/src/main/java/org/eclipse/collections/impl/utility/internal/SetIterables.java\n\n@@ -42,13 +42,13 @@ public final class SetIterables\n             SetIterable<? extends E> setA,\n             SetIterable<? extends E> setB)\n     {\n-        if (setA.size() > setB.size())\n+        if (setB.size() > setA.size())\n         {\n-            UnifiedSet<E> result = UnifiedSet.newSet(setA);\n-            return result.withAll(setB);\n+            SetIterable<? extends E> tmp = setA;\n+            setA = setB;\n+            setB = tmp;\n         }\n-        UnifiedSet<E> result = UnifiedSet.newSet(setB);\n-        return result.withAll(setA);\n+        return UnifiedSet.<E>newSet(setA).withAll(setB);\n     }\n \n     public static <E, R extends Set<E>> R unionInto(\n"}}, {"oid": "895d6cfcebe052e63f7606188e0d97672c5174ed", "url": "https://github.com/eclipse/eclipse-collections/commit/895d6cfcebe052e63f7606188e0d97672c5174ed", "message": "Port optimizations for primitive set operations to SetIterables.\n\nSigned-off-by: Donald Raab <Donald.Raab@bnymellon.com>", "committedDate": "2020-11-15T03:59:53Z", "type": "forcePushed"}, {"oid": "2592a827eaef7d924fd842a05ceaa6ba40a814aa", "url": "https://github.com/eclipse/eclipse-collections/commit/2592a827eaef7d924fd842a05ceaa6ba40a814aa", "message": "Port optimizations for primitive set operations to SetIterables.\n\nSigned-off-by: Donald Raab <Donald.Raab@bnymellon.com>", "committedDate": "2020-11-15T04:15:11Z", "type": "forcePushed"}, {"oid": "6627e07a9427e7c1b689287d4000ee0bd47386ea", "url": "https://github.com/eclipse/eclipse-collections/commit/6627e07a9427e7c1b689287d4000ee0bd47386ea", "message": "Port optimizations for primitive set operations to SetIterables.\n\nSigned-off-by: Donald Raab <Donald.Raab@bnymellon.com>", "committedDate": "2020-11-17T00:53:28Z", "type": "forcePushed"}, {"oid": "5c19c28431520e1fbf949250a8bbeb99e482a16a", "url": "https://github.com/eclipse/eclipse-collections/commit/5c19c28431520e1fbf949250a8bbeb99e482a16a", "message": "Port optimizations for primitive set operations to SetIterables.\n\nSigned-off-by: Donald Raab <Donald.Raab@bnymellon.com>", "committedDate": "2020-11-17T01:20:34Z", "type": "commit"}, {"oid": "5c19c28431520e1fbf949250a8bbeb99e482a16a", "url": "https://github.com/eclipse/eclipse-collections/commit/5c19c28431520e1fbf949250a8bbeb99e482a16a", "message": "Port optimizations for primitive set operations to SetIterables.\n\nSigned-off-by: Donald Raab <Donald.Raab@bnymellon.com>", "committedDate": "2020-11-17T01:20:34Z", "type": "forcePushed"}]}