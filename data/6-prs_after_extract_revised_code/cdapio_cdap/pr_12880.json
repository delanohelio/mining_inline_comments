{"pr_number": 12880, "pr_title": "CDAP-17389 improvements to dataproc provisioner", "pr_createdAt": "2020-12-04T06:03:38Z", "pr_url": "https://github.com/cdapio/cdap/pull/12880", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2MjM5NA==", "url": "https://github.com/cdapio/cdap/pull/12880#discussion_r535862394", "bodyText": "Does this change the default from standard to ssd? Is there cost implication?", "author": "chtyim", "createdAt": "2020-12-04T06:17:53Z", "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocConf.java", "diffHunk": "@@ -435,7 +461,15 @@ static DataprocConf create(Map<String, String> properties, @Nullable SSHPublicKe\n     int workerMemoryGB = getInt(properties, \"workerMemoryMB\", 15 * 1024);\n \n     int masterDiskGB = getInt(properties, \"masterDiskGB\", 1000);\n+    String masterDiskType = getString(properties, \"masterDiskType\");\n+    if (masterDiskType == null) {\n+      masterDiskType = \"pd-standard\";\n+    }\n     int workerDiskGB = getInt(properties, \"workerDiskGB\", 1000);\n+    String workerDiskType = getString(properties, \"workerDiskType\");\n+    if (workerDiskType == null) {\n+      workerDiskType = \"pd-ssd\";", "originalCommit": "ee73d725aadc3e8a22a13393569f414910518808", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2OTU1Mg==", "url": "https://github.com/cdapio/cdap/pull/12880#discussion_r535869552", "bodyText": "oops this was unintentional, changing it to standard", "author": "albertshau", "createdAt": "2020-12-04T06:37:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2MjM5NA=="}], "type": "inlineReview", "revised_code": {"commit": "b12fb3a20339c3388c7bdbf6f1c9eeedca4ad901", "chunk": "diff --git a/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocConf.java b/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocConf.java\nindex 0176e58a2c4..22649ef4742 100644\n--- a/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocConf.java\n+++ b/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocConf.java\n\n@@ -468,7 +468,7 @@ final class DataprocConf {\n     int workerDiskGB = getInt(properties, \"workerDiskGB\", 1000);\n     String workerDiskType = getString(properties, \"workerDiskType\");\n     if (workerDiskType == null) {\n-      workerDiskType = \"pd-ssd\";\n+      workerDiskType = \"pd-standard\";\n     }\n \n     long pollCreateDelay = getLong(properties, \"pollCreateDelay\", 60);\n"}}, {"oid": "b12fb3a20339c3388c7bdbf6f1c9eeedca4ad901", "url": "https://github.com/cdapio/cdap/commit/b12fb3a20339c3388c7bdbf6f1c9eeedca4ad901", "message": "CDAP-17389 improvements to dataproc provisioner\n\nFixed the provisioner to use the same worker disk settings for\nsecondary workers, and to use non-preemptible secondary workers.\nThis makes autoscaling reliable instead of causing pipelines\nto fail. Also added a property for the number of secondary\nworker nodes since some autoscale policies require a minimum\nnumber of secondary nodes. This required bumping the dataproc\nlibrary version and switching from v1beta2 api to v1.\n\nAdded a disk type property for master and worker nodes to support\ncreating clusters with SSDs.\n\nFixed the widget for Component Gateway to correctly send\n'true' and 'false' instead of 'on' and 'off' to the backend.\n\nChanged all boolean properties to toggles for consistency.\n\nRemoved 'Beta' and 'Experimental' from descriptions/lables.\n\nMoved a bunch of optional properties to the 'Advanced' section.", "committedDate": "2020-12-04T18:03:27Z", "type": "commit"}, {"oid": "b12fb3a20339c3388c7bdbf6f1c9eeedca4ad901", "url": "https://github.com/cdapio/cdap/commit/b12fb3a20339c3388c7bdbf6f1c9eeedca4ad901", "message": "CDAP-17389 improvements to dataproc provisioner\n\nFixed the provisioner to use the same worker disk settings for\nsecondary workers, and to use non-preemptible secondary workers.\nThis makes autoscaling reliable instead of causing pipelines\nto fail. Also added a property for the number of secondary\nworker nodes since some autoscale policies require a minimum\nnumber of secondary nodes. This required bumping the dataproc\nlibrary version and switching from v1beta2 api to v1.\n\nAdded a disk type property for master and worker nodes to support\ncreating clusters with SSDs.\n\nFixed the widget for Component Gateway to correctly send\n'true' and 'false' instead of 'on' and 'off' to the backend.\n\nChanged all boolean properties to toggles for consistency.\n\nRemoved 'Beta' and 'Experimental' from descriptions/lables.\n\nMoved a bunch of optional properties to the 'Advanced' section.", "committedDate": "2020-12-04T18:03:27Z", "type": "forcePushed"}]}