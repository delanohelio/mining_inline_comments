{"pr_number": 12581, "pr_title": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental\u2026", "pr_createdAt": "2020-08-06T19:33:25Z", "pr_url": "https://github.com/cdapio/cdap/pull/12581", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY0Mjk1Ng==", "url": "https://github.com/cdapio/cdap/pull/12581#discussion_r466642956", "bodyText": "Why we need two separate config? Just the policyURI is good enough, right? If it is not null nor empty, then we'll apply the policy", "author": "chtyim", "createdAt": "2020-08-06T19:38:50Z", "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java", "diffHunk": "@@ -436,6 +437,18 @@ public ClusterOperationMetadata createCluster(String name, String imageVersion,\n             .build());\n       }\n \n+      //Set Auto Scaling Policy\n+      if (conf.isAutoPolicyEnabled()) {", "originalCommit": "9052546478c8f20a61410d7e2c5e6ea706e6a383", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1MTY4NQ==", "url": "https://github.com/cdapio/cdap/pull/12581#discussion_r466651685", "bodyText": "yea we dont need it", "author": "CuriousVini", "createdAt": "2020-08-06T19:55:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY0Mjk1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "d45ab83df0011336ab6fdf0faf55bcb80f4e22df", "chunk": "diff --git a/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java b/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java\nindex 6e124c8d33c..4fd5fa99b28 100644\n--- a/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java\n+++ b/cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java\n\n@@ -437,13 +437,14 @@ final class DataprocClient implements AutoCloseable {\n             .build());\n       }\n \n-      //Set Auto Scaling Policy\n-      if (conf.isAutoPolicyEnabled()) {\n-        String policyURI = conf.getAutoScalingPolicy();\n+      // Set Auto Scaling Policy\n+      String autoScalingPolicy = conf.getAutoScalingPolicy();\n+      if (!Strings.isNullOrEmpty(autoScalingPolicy)) {\n+        String policyURI = autoScalingPolicy;\n         //Check if policy is URI or ID. If ID Convert to URI\n         if (!policyURI.contains(\"/\")) {\n           policyURI = \"projects/\" + conf.getProjectId() + \"/regions/\" + conf.getRegion()\n-            + \"/autoscalingPolicies/\" + conf.getAutoScalingPolicy();\n+            + \"/autoscalingPolicies/\" + autoScalingPolicy;\n         }\n         builder.setAutoscalingConfig(AutoscalingConfig.newBuilder().setPolicyUri(policyURI).build());\n       }\n"}}, {"oid": "d45ab83df0011336ab6fdf0faf55bcb80f4e22df", "url": "https://github.com/cdapio/cdap/commit/d45ab83df0011336ab6fdf0faf55bcb80f4e22df", "message": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental feature)", "committedDate": "2020-08-06T20:08:01Z", "type": "forcePushed"}, {"oid": "76cf1b88962d30cf79bd6f6a2e0035d65e818b40", "url": "https://github.com/cdapio/cdap/commit/76cf1b88962d30cf79bd6f6a2e0035d65e818b40", "message": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental feature)", "committedDate": "2020-08-06T20:10:41Z", "type": "forcePushed"}, {"oid": "c5792dcc78bddeadc1930b1e6a48bdfe8b11124d", "url": "https://github.com/cdapio/cdap/commit/c5792dcc78bddeadc1930b1e6a48bdfe8b11124d", "message": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental feature)", "committedDate": "2020-08-06T20:11:57Z", "type": "forcePushed"}, {"oid": "cf2d8f2071642002e8e48e29f6159953394a26a9", "url": "https://github.com/cdapio/cdap/commit/cf2d8f2071642002e8e48e29f6159953394a26a9", "message": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental feature)", "committedDate": "2020-08-06T23:51:31Z", "type": "forcePushed"}, {"oid": "bf64552d4bb247507530a632a5afa7a31d3f4a83", "url": "https://github.com/cdapio/cdap/commit/bf64552d4bb247507530a632a5afa7a31d3f4a83", "message": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental feature)", "committedDate": "2020-08-07T01:08:40Z", "type": "commit"}, {"oid": "bf64552d4bb247507530a632a5afa7a31d3f4a83", "url": "https://github.com/cdapio/cdap/commit/bf64552d4bb247507530a632a5afa7a31d3f4a83", "message": "[CDAP-16668] Dataproc enhancements to support autoscale (experimental feature)", "committedDate": "2020-08-07T01:08:40Z", "type": "forcePushed"}]}