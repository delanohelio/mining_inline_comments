{"pr_number": 12213, "pr_title": "CDAP-16709 implement manual broadcasts", "pr_createdAt": "2020-05-27T19:45:25Z", "pr_url": "https://github.com/cdapio/cdap/pull/12213", "timeline": [{"oid": "e5a66dcac27756b467066bde358e5f177c83e54d", "url": "https://github.com/cdapio/cdap/commit/e5a66dcac27756b467066bde358e5f177c83e54d", "message": "CDAP-16709 implement manual broadcasts\n\nHonor the broadcast flag set in the JoinDefinition when joining\nmultiple DataFrames. Added a small tweak to the join logic to\njoin all non-broadcasted datasets first in order to ensure that\nboth sides of the join are not broadcast, and to reduce the amount\nof data that is being shuffled in non-broadcast intermediate joins.", "committedDate": "2020-05-27T21:54:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1ODcyOQ==", "url": "https://github.com/cdapio/cdap/pull/12213#discussion_r432058729", "bodyText": "Is there any constant class we can use for these config?", "author": "yaojiefeng", "createdAt": "2020-05-28T19:07:52Z", "path": "cdap-app-templates/cdap-etl/hydrator-spark-core-base/src/main/java/io/cdap/cdap/etl/spark/batch/ETLSpark.java", "diffHunk": "@@ -95,6 +95,9 @@ public void initialize() throws Exception {\n \n     SparkConf sparkConf = new SparkConf();\n     sparkConf.set(\"spark.speculation\", \"false\");\n+    // turn off auto-broadcast by default until we better understand the implications and can set this to a\n+    // value that we are confident is safe.\n+    sparkConf.set(\"spark.sql.autoBroadcastJoinThreshold\", \"-1\");", "originalCommit": "e5a66dcac27756b467066bde358e5f177c83e54d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTY2Mw==", "url": "https://github.com/cdapio/cdap/pull/12213#discussion_r432095663", "bodyText": "not that I know of. If there was, it could potentially change across different Spark versions too.", "author": "albertshau", "createdAt": "2020-05-28T20:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1ODcyOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "9064e40622c16cdc4756a80516594a4a2e2a24ec", "url": "https://github.com/cdapio/cdap/commit/9064e40622c16cdc4756a80516594a4a2e2a24ec", "message": "CDAP-16709 implement manual broadcasts\n\nHonor the broadcast flag set in the JoinDefinition when joining\nmultiple DataFrames. Added a small tweak to the join logic to\njoin all non-broadcasted datasets first in order to ensure that\nboth sides of the join are not broadcast, and to reduce the amount\nof data that is being shuffled in non-broadcast intermediate joins.", "committedDate": "2020-05-28T20:28:19Z", "type": "forcePushed"}, {"oid": "65d9edc9377053b63ffde8ea2cb52346d16e6d80", "url": "https://github.com/cdapio/cdap/commit/65d9edc9377053b63ffde8ea2cb52346d16e6d80", "message": "CDAP-16709 implement manual broadcasts\n\nHonor the broadcast flag set in the JoinDefinition when joining\nmultiple DataFrames. Added a small tweak to the join logic to\njoin all non-broadcasted datasets first in order to ensure that\nboth sides of the join are not broadcast, and to reduce the amount\nof data that is being shuffled in non-broadcast intermediate joins.", "committedDate": "2020-05-28T21:17:00Z", "type": "commit"}, {"oid": "65d9edc9377053b63ffde8ea2cb52346d16e6d80", "url": "https://github.com/cdapio/cdap/commit/65d9edc9377053b63ffde8ea2cb52346d16e6d80", "message": "CDAP-16709 implement manual broadcasts\n\nHonor the broadcast flag set in the JoinDefinition when joining\nmultiple DataFrames. Added a small tweak to the join logic to\njoin all non-broadcasted datasets first in order to ensure that\nboth sides of the join are not broadcast, and to reduce the amount\nof data that is being shuffled in non-broadcast intermediate joins.", "committedDate": "2020-05-28T21:17:00Z", "type": "forcePushed"}]}