{"pr_number": 11928, "pr_title": "CDAP-16390 fix fll cycle", "pr_createdAt": "2020-03-06T15:02:16Z", "pr_url": "https://github.com/cdapio/cdap/pull/11928", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwMDk2MQ==", "url": "https://github.com/cdapio/cdap/pull/11928#discussion_r389200961", "bodyText": "nit: indentation", "author": "albertshau", "createdAt": "2020-03-07T00:10:00Z", "path": "cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java", "diffHunk": "@@ -590,6 +591,35 @@ public void testMultiPathFieldLineage() {\n     Assert.assertEquals(expectedOperations, outgoingOperations);\n   }\n \n+  @Test\n+  public void testNonCycle() {\n+    EndPoint readEndPoint = EndPoint.of(\"ns\", \"src\");\n+    EndPoint writeEndPoint = EndPoint.of(\"ns\", \"dest\");\n+\n+    ReadOperation read = new ReadOperation(\"read\", \"read\", readEndPoint, \"a\", \"b\");\n+    TransformOperation combine = new TransformOperation(\"combine\", \"combine\",\n+                                                          Arrays.asList(InputField.of(\"read\", \"a\"),", "originalCommit": "514065dbf829d87c47bd15eba19e86104f1a214d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e82275fb2c34d7d26bb6a289d16803e6552d5a6d", "chunk": "diff --git a/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java b/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java\nindex cee2030114b..65007b52405 100644\n--- a/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java\n+++ b/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java\n\n@@ -598,9 +598,9 @@ public class FieldLineageInfoTest {\n \n     ReadOperation read = new ReadOperation(\"read\", \"read\", readEndPoint, \"a\", \"b\");\n     TransformOperation combine = new TransformOperation(\"combine\", \"combine\",\n-                                                          Arrays.asList(InputField.of(\"read\", \"a\"),\n-                                                                        InputField.of(\"read\", \"b\")),\n-                                                          \"a\", \"b\");\n+                                                        Arrays.asList(InputField.of(\"read\", \"a\"),\n+                                                                      InputField.of(\"read\", \"b\")),\n+                                                        \"a\", \"b\");\n     // an operation with no incoming inputs, this should not be considered an cycle, but should get treat like a\n     // read operation\n     TransformOperation generate = new TransformOperation(\"generate\", \"generate\",\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwMTg4Ng==", "url": "https://github.com/cdapio/cdap/pull/11928#discussion_r389201886", "bodyText": "can you add a test for if the generated field comes from the sink? More specifically, something like:\nread a, b -> write a, b, c\nThis can happen if the sink always adds additional data. For example, something can write an additional 'updated_time' field or something like that.", "author": "albertshau", "createdAt": "2020-03-07T00:14:48Z", "path": "cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java", "diffHunk": "@@ -590,6 +591,35 @@ public void testMultiPathFieldLineage() {\n     Assert.assertEquals(expectedOperations, outgoingOperations);\n   }\n \n+  @Test\n+  public void testNonCycle() {", "originalCommit": "514065dbf829d87c47bd15eba19e86104f1a214d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNzQyMQ==", "url": "https://github.com/cdapio/cdap/pull/11928#discussion_r389217421", "bodyText": "This kind of operation cannot be defined like this, if you like at the contract of WriteOperation: https://github.com/cdapio/cdap/blob/develop/cdap-api/src/main/java/io/cdap/cdap/api/lineage/field/WriteOperation.java#L40, the write operation can only take a list of input fields, so in order to generate c. The above operation will must look something like:\nread [a,b],\ntransform [] -> [c],\nwrite [read.a, read.b, transform.c]\nThis kind of scenario is already added in this unit test.", "author": "yaojiefeng", "createdAt": "2020-03-07T02:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwMTg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNzU0Mg==", "url": "https://github.com/cdapio/cdap/pull/11928#discussion_r389217542", "bodyText": "To be more clear, if a sink adds a column, then that sink will need to emit that generate transform, and then add the write operation.", "author": "yaojiefeng", "createdAt": "2020-03-07T02:05:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwMTg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxODQxMw==", "url": "https://github.com/cdapio/cdap/pull/11928#discussion_r389218413", "bodyText": "I see, \ud83d\udc4d", "author": "albertshau", "createdAt": "2020-03-07T02:15:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwMTg4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "e82275fb2c34d7d26bb6a289d16803e6552d5a6d", "chunk": "diff --git a/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java b/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java\nindex cee2030114b..65007b52405 100644\n--- a/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java\n+++ b/cdap-data-fabric/src/test/java/io/cdap/cdap/data2/metadata/lineage/field/FieldLineageInfoTest.java\n\n@@ -598,9 +598,9 @@ public class FieldLineageInfoTest {\n \n     ReadOperation read = new ReadOperation(\"read\", \"read\", readEndPoint, \"a\", \"b\");\n     TransformOperation combine = new TransformOperation(\"combine\", \"combine\",\n-                                                          Arrays.asList(InputField.of(\"read\", \"a\"),\n-                                                                        InputField.of(\"read\", \"b\")),\n-                                                          \"a\", \"b\");\n+                                                        Arrays.asList(InputField.of(\"read\", \"a\"),\n+                                                                      InputField.of(\"read\", \"b\")),\n+                                                        \"a\", \"b\");\n     // an operation with no incoming inputs, this should not be considered an cycle, but should get treat like a\n     // read operation\n     TransformOperation generate = new TransformOperation(\"generate\", \"generate\",\n"}}, {"oid": "e82275fb2c34d7d26bb6a289d16803e6552d5a6d", "url": "https://github.com/cdapio/cdap/commit/e82275fb2c34d7d26bb6a289d16803e6552d5a6d", "message": "CDAP-16390 fix fll cycle", "committedDate": "2020-03-07T02:39:44Z", "type": "commit"}, {"oid": "e82275fb2c34d7d26bb6a289d16803e6552d5a6d", "url": "https://github.com/cdapio/cdap/commit/e82275fb2c34d7d26bb6a289d16803e6552d5a6d", "message": "CDAP-16390 fix fll cycle", "committedDate": "2020-03-07T02:39:44Z", "type": "forcePushed"}]}