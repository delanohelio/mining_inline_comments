{"pr_number": 11988, "pr_title": "(CDAP-16353) Replace ArtifactRepository param with PluginFinder for AbstractConfigurer\u2026", "pr_createdAt": "2020-03-20T20:52:23Z", "pr_url": "https://github.com/cdapio/cdap/pull/11988", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2Nzk0NA==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398167944", "bodyText": "Unused?", "author": "yaojiefeng", "createdAt": "2020-03-25T21:03:52Z", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -21,6 +21,7 @@\n import com.google.common.collect.ImmutableList;\n import com.google.inject.AbstractModule;\n import com.google.inject.Module;\n+import com.google.inject.PrivateModule;", "originalCommit": "1bcd1bd269ea04b9d0f5dcc1092da1c456075f32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE5ODkzMw==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398198933", "bodyText": "Removed", "author": "wyzhang", "createdAt": "2020-03-25T22:05:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2Nzk0NA=="}], "type": "inlineReview", "revised_code": {"commit": "01bf58303655610efbbe2425b92015f3ae976722", "chunk": "diff --git a/cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java b/cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java\nindex 9754b8a6ec3..609f8d26e29 100644\n--- a/cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java\n+++ b/cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java\n\n@@ -21,7 +21,6 @@ import com.google.common.base.Throwables;\n import com.google.common.collect.ImmutableList;\n import com.google.inject.AbstractModule;\n import com.google.inject.Module;\n-import com.google.inject.PrivateModule;\n import com.google.inject.Provides;\n import com.google.inject.Scopes;\n import com.google.inject.TypeLiteral;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2OTczOA==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398169738", "bodyText": "why do we need the change here and remove the ones in InMemoryProgramRunnerModule?", "author": "yaojiefeng", "createdAt": "2020-03-25T21:07:15Z", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -270,6 +273,7 @@ private AppFabricServiceModule(Class<? extends HttpHandler>... handlerClasses) {\n     protected void configure() {\n       bind(PipelineFactory.class).to(SynchronousPipelineFactory.class);\n \n+      bind(PluginFinder.class).to(LocalPluginFinder.class);", "originalCommit": "1bcd1bd269ea04b9d0f5dcc1092da1c456075f32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMjM5MA==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398202390", "bodyText": "After the change, LocalApplicationManager used by AppFabric and PreviewApplicationManager used by Preview requires this binding. But Preview uses AppFabricServiceRuntime module, so have to move the binding to AppFabricServiceRuntimeModule to satisfy the need by both appfab and preview.", "author": "wyzhang", "createdAt": "2020-03-25T22:13:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2OTczOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3MDU0Mw==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398170543", "bodyText": "nit - unused", "author": "yaojiefeng", "createdAt": "2020-03-25T21:08:42Z", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/DefaultPreviewRunnerModule.java", "diffHunk": "@@ -46,6 +46,8 @@\n import io.cdap.cdap.internal.app.runtime.ProgramRuntimeProviderLoader;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactRepository;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactStore;\n+import io.cdap.cdap.internal.app.runtime.artifact.LocalPluginFinder;", "originalCommit": "1bcd1bd269ea04b9d0f5dcc1092da1c456075f32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMjY2Ng==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398202666", "bodyText": "Removed", "author": "wyzhang", "createdAt": "2020-03-25T22:13:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3MDU0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "01bf58303655610efbbe2425b92015f3ae976722", "chunk": "diff --git a/cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/DefaultPreviewRunnerModule.java b/cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/DefaultPreviewRunnerModule.java\nindex 6a699777ba5..0c0236cc31b 100644\n--- a/cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/DefaultPreviewRunnerModule.java\n+++ b/cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/DefaultPreviewRunnerModule.java\n\n@@ -46,8 +46,6 @@ import io.cdap.cdap.internal.app.preview.DefaultPreviewRunner;\n import io.cdap.cdap.internal.app.runtime.ProgramRuntimeProviderLoader;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactRepository;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactStore;\n-import io.cdap.cdap.internal.app.runtime.artifact.LocalPluginFinder;\n-import io.cdap.cdap.internal.app.runtime.artifact.PluginFinder;\n import io.cdap.cdap.internal.app.runtime.workflow.BasicWorkflowStateWriter;\n import io.cdap.cdap.internal.app.runtime.workflow.WorkflowStateWriter;\n import io.cdap.cdap.internal.app.store.DefaultStore;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3MDgwMQ==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398170801", "bodyText": "nit - these imports can be removed", "author": "yaojiefeng", "createdAt": "2020-03-25T21:09:05Z", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/InMemoryProgramRunnerModule.java", "diffHunk": "@@ -72,9 +72,7 @@ protected void configure() {\n               .build(ArtifactManagerFactory.class));\n     expose(ArtifactManagerFactory.class);\n \n-    bind(PluginFinder.class).to(LocalPluginFinder.class);", "originalCommit": "1bcd1bd269ea04b9d0f5dcc1092da1c456075f32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMjkwNg==", "url": "https://github.com/cdapio/cdap/pull/11988#discussion_r398202906", "bodyText": "Done", "author": "wyzhang", "createdAt": "2020-03-25T22:14:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3MDgwMQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "01bf58303655610efbbe2425b92015f3ae976722", "url": "https://github.com/cdapio/cdap/commit/01bf58303655610efbbe2425b92015f3ae976722", "message": "(CDAP-16353) Replace ArtifactRepository param with PluginFinder for AbstractConfigurer\n\nMotivation:\nAbstractConfigurer uses ArtifactRepository just to find the artifact for a given plugin,\nthis functionality is already provided by PluginFinder which has local and remote implementations,\nthereby allowing us to use local impl when having shared SQL and remote version for non-shared\nper service local levelDB.", "committedDate": "2020-03-25T23:51:21Z", "type": "commit"}, {"oid": "01bf58303655610efbbe2425b92015f3ae976722", "url": "https://github.com/cdapio/cdap/commit/01bf58303655610efbbe2425b92015f3ae976722", "message": "(CDAP-16353) Replace ArtifactRepository param with PluginFinder for AbstractConfigurer\n\nMotivation:\nAbstractConfigurer uses ArtifactRepository just to find the artifact for a given plugin,\nthis functionality is already provided by PluginFinder which has local and remote implementations,\nthereby allowing us to use local impl when having shared SQL and remote version for non-shared\nper service local levelDB.", "committedDate": "2020-03-25T23:51:21Z", "type": "forcePushed"}]}