{"pr_number": 12034, "pr_title": "(CDAP-16353) Refactor k8s deployment building in KubeTwillPreparer to a separate function", "pr_createdAt": "2020-04-05T06:13:29Z", "pr_url": "https://github.com/cdapio/cdap/pull/12034", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2MTE0NQ==", "url": "https://github.com/cdapio/cdap/pull/12034#discussion_r403661145", "bodyText": "Usually method exposed for testing should be kept as package private instead of public.", "author": "chtyim", "createdAt": "2020-04-05T07:22:46Z", "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java", "diffHunk": "@@ -321,7 +322,21 @@ public TwillController start(long timeout, TimeUnit timeoutUnit) {\n     }\n   }\n \n-  private V1Deployment createDeployment(V1ConfigMap configMap, long startTimeoutMillis) throws ApiException {\n+  /**\n+   * Return a {@link V1Deployment} object that will be deployed in Kubernetes to run the program\n+   */\n+  @VisibleForTesting\n+  public V1Deployment buildDeployment(RunId runid,", "originalCommit": "fe5a26243411bf75ee4fa38827aeac1ec0be6115", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg1ODU4Nw==", "url": "https://github.com/cdapio/cdap/pull/12034#discussion_r403858587", "bodyText": "Fixed", "author": "wyzhang", "createdAt": "2020-04-06T06:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2MTE0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "b2c45410be3158c1d51d10bc4622ef215ea9591f", "chunk": "diff --git a/cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java b/cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java\nindex 0d44fef6577..88dbca4ff94 100644\n--- a/cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java\n+++ b/cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java\n\n@@ -326,7 +326,7 @@ class KubeTwillPreparer implements TwillPreparer {\n    * Return a {@link V1Deployment} object that will be deployed in Kubernetes to run the program\n    */\n   @VisibleForTesting\n-  public V1Deployment buildDeployment(RunId runid,\n+  V1Deployment buildDeployment(RunId runid,\n                                       String appSpec,\n                                       String programOptions,\n                                       V1ObjectMeta deploymentMetadata,\n"}}, {"oid": "b2c45410be3158c1d51d10bc4622ef215ea9591f", "url": "https://github.com/cdapio/cdap/commit/b2c45410be3158c1d51d10bc4622ef215ea9591f", "message": "(CDAP-16353) Refactor KubeTwillPreparer k8s deployment building into its own function\n\nWhat:\nRefactor the k8s deployment object building into a separate function\nwith all external data required passed in via parameters.\n\nWhy:\nAllow us to write a unit test for this function to verify the state of\ndeployment k8s object is as expectd.", "committedDate": "2020-04-06T06:22:04Z", "type": "commit"}, {"oid": "b2c45410be3158c1d51d10bc4622ef215ea9591f", "url": "https://github.com/cdapio/cdap/commit/b2c45410be3158c1d51d10bc4622ef215ea9591f", "message": "(CDAP-16353) Refactor KubeTwillPreparer k8s deployment building into its own function\n\nWhat:\nRefactor the k8s deployment object building into a separate function\nwith all external data required passed in via parameters.\n\nWhy:\nAllow us to write a unit test for this function to verify the state of\ndeployment k8s object is as expectd.", "committedDate": "2020-04-06T06:22:04Z", "type": "forcePushed"}]}