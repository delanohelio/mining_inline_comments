{"pr_number": 1334, "pr_title": "KYLIN-4653 Make the capacity for the LinkedBlockingQueue", "pr_createdAt": "2020-07-28T13:44:26Z", "pr_url": "https://github.com/apache/kylin/pull/1334", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwNjQxMA==", "url": "https://github.com/apache/kylin/pull/1334#discussion_r462406410", "bodyText": "How about making it possible to use unbounded LinkedBlockingQueue like following?\nthis.recordsQueue = maxQueueSize <= 0 ? new LinkedBlockingQueue<>() : new LinkedBlockingQueue<>(maxQueueSize);", "author": "kyotoYaho", "createdAt": "2020-07-29T15:53:37Z", "path": "core-metrics/src/main/java/org/apache/kylin/metrics/lib/impl/BlockingReservoir.java", "diffHunk": "@@ -60,14 +60,15 @@ public BlockingReservoir(int minReportSize, int maxReportSize) {\n     }\n \n     public BlockingReservoir(int minReportSize, int maxReportSize, int maxReportTime) {\n-        this(minReportSize, maxReportSize, maxReportSize, MAX_QUEUE_SIZE);\n+        this(minReportSize, maxReportSize, maxReportTime, MAX_QUEUE_SIZE);\n     }\n \n     public BlockingReservoir(int minReportSize, int maxReportSize, int maxReportTime, int maxQueueSize) {\n         Preconditions.checkArgument(minReportSize > 0, \"minReportSize should be larger than 0\");\n         Preconditions.checkArgument(maxReportSize >= minReportSize,\n                 \"maxReportSize should not be less than minBatchSize\");\n         Preconditions.checkArgument(maxReportTime > 0, \"maxReportTime should be larger than 0\");\n+        Preconditions.checkArgument(maxQueueSize > 0, \"maxQueueSize should be larger than 0\");", "originalCommit": "19bde8ef620a79570894fcf513aa317dca6de04d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0NTA3Nw==", "url": "https://github.com/apache/kylin/pull/1334#discussion_r462945077", "bodyText": "Good advice!", "author": "hit-lacus", "createdAt": "2020-07-30T11:58:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwNjQxMA=="}], "type": "inlineReview", "revised_code": {"commit": "d062b965881bdc9e80e0d5daa8ed424a8d4986e1", "chunk": "diff --git a/core-metrics/src/main/java/org/apache/kylin/metrics/lib/impl/BlockingReservoir.java b/core-metrics/src/main/java/org/apache/kylin/metrics/lib/impl/BlockingReservoir.java\nindex 0e638f6f0..7b4d07c77 100644\n--- a/core-metrics/src/main/java/org/apache/kylin/metrics/lib/impl/BlockingReservoir.java\n+++ b/core-metrics/src/main/java/org/apache/kylin/metrics/lib/impl/BlockingReservoir.java\n\n@@ -68,12 +68,11 @@ public class BlockingReservoir extends AbstractActiveReservoir {\n         Preconditions.checkArgument(maxReportSize >= minReportSize,\n                 \"maxReportSize should not be less than minBatchSize\");\n         Preconditions.checkArgument(maxReportTime > 0, \"maxReportTime should be larger than 0\");\n-        Preconditions.checkArgument(maxQueueSize > 0, \"maxQueueSize should be larger than 0\");\n-        this.minReportSize = minReportSize;\n         this.maxReportSize = maxReportSize;\n         this.maxReportTime = maxReportTime * 60 * 1000L;\n \n-        this.recordsQueue = new LinkedBlockingQueue<>(maxQueueSize);\n+        this.recordsQueue = maxQueueSize <= 0 ? new LinkedBlockingQueue<>() : new LinkedBlockingQueue<>(maxQueueSize);\n+        this.minReportSize = minReportSize;\n         this.listeners = Lists.newArrayList();\n \n         this.records = Lists.newArrayListWithExpectedSize(this.maxReportSize);\n"}}, {"oid": "d062b965881bdc9e80e0d5daa8ed424a8d4986e1", "url": "https://github.com/apache/kylin/commit/d062b965881bdc9e80e0d5daa8ed424a8d4986e1", "message": "KYLIN-4653 Make the capacity for the LinkedBlockingQueue of BlockingReservoir configurable", "committedDate": "2020-07-30T11:57:37Z", "type": "forcePushed"}, {"oid": "b17e78d4097a97d4f7d93e8ccd09e73c1c1b76dc", "url": "https://github.com/apache/kylin/commit/b17e78d4097a97d4f7d93e8ccd09e73c1c1b76dc", "message": "KYLIN-4653 Make the capacity for the LinkedBlockingQueue of BlockingReservoir configurable", "committedDate": "2020-07-31T01:50:49Z", "type": "commit"}, {"oid": "b17e78d4097a97d4f7d93e8ccd09e73c1c1b76dc", "url": "https://github.com/apache/kylin/commit/b17e78d4097a97d4f7d93e8ccd09e73c1c1b76dc", "message": "KYLIN-4653 Make the capacity for the LinkedBlockingQueue of BlockingReservoir configurable", "committedDate": "2020-07-31T01:50:49Z", "type": "forcePushed"}]}