{"pr_number": 1312, "pr_title": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "pr_createdAt": "2020-07-09T02:05:15Z", "pr_url": "https://github.com/apache/kylin/pull/1312", "timeline": [{"oid": "e75e929b3d55740a24e46dd64dcaf0242cac07ce", "url": "https://github.com/apache/kylin/commit/e75e929b3d55740a24e46dd64dcaf0242cac07ce", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-09T02:48:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI5NTQ1NA==", "url": "https://github.com/apache/kylin/pull/1312#discussion_r452295454", "bodyText": "UT is unittest, but local is local. So isLocalEnv()?", "author": "bigxiaochu", "createdAt": "2020-07-09T15:16:48Z", "path": "kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/NSparkExecutable.java", "diffHunk": "@@ -146,7 +146,7 @@ protected ExecuteResult doWork(ExecutableContext context) throws ExecuteExceptio\n             throw new ExecuteException(\"meta dump failed\", e);\n         }\n         String filePath = dumpArgs();\n-        if (config.isUTEnv() || config.isZKLocal()) {\n+        if (config.isUTEnv() || config.isLOCALEnv() || config.isZKLocal()) {", "originalCommit": "e75e929b3d55740a24e46dd64dcaf0242cac07ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQwOTkyNw==", "url": "https://github.com/apache/kylin/pull/1312#discussion_r453409927", "bodyText": "Agreed. Please capitalize local .", "author": "hit-lacus", "createdAt": "2020-07-13T02:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI5NTQ1NA=="}], "type": "inlineReview", "revised_code": {"commit": "60071ad0e15e2d75469aa07f6544eecac7e1e6df", "chunk": "diff --git a/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/NSparkExecutable.java b/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/NSparkExecutable.java\nindex 06e5e1d0b..a877b2181 100644\n--- a/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/NSparkExecutable.java\n+++ b/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/NSparkExecutable.java\n\n@@ -146,7 +146,7 @@ public class NSparkExecutable extends AbstractExecutable {\n             throw new ExecuteException(\"meta dump failed\", e);\n         }\n         String filePath = dumpArgs();\n-        if (config.isUTEnv() || config.isLOCALEnv() || config.isZKLocal()) {\n+        if (config.isUTEnv() || config.isLocalEnv() || config.isZKLocal()) {\n             return runLocalMode(filePath, config);\n         } else {\n             logger.info(\"Task id: {}\", getId());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI5Nzc2NA==", "url": "https://github.com/apache/kylin/pull/1312#discussion_r452297764", "bodyText": "why ut path is \"../../examples/test_case_data/parquet_test/data/\", but local path is  \"../parquet_test/data/\"?\ncan they use same path?", "author": "bigxiaochu", "createdAt": "2020-07-09T15:20:17Z", "path": "kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/source/CsvSource.java", "diffHunk": "@@ -59,7 +59,12 @@ public CsvSource(KylinConfig config) {\n                         && (parameters != null && parameters.get(\"separator\") == null)) {\n                     path = \"file:///\" + new File(getUtMetaDir(),\n                             \"../../examples/test_case_data/parquet_test/data/\" + table.identity() + \".csv\")\n-                                    .getAbsolutePath();\n+                            .getAbsolutePath();\n+                    separator = \"\";\n+                } else if (kylinConfig.getDeployEnv().equals(\"LOCAL\")) {\n+                    path = \"file:///\" + new File(getUtMetaDir(),\n+                            \"../parquet_test/data/\" + table.identity() + \".csv\")", "originalCommit": "e75e929b3d55740a24e46dd64dcaf0242cac07ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxMDg2Mw==", "url": "https://github.com/apache/kylin/pull/1312#discussion_r453410863", "bodyText": "Agreed, these two path confusing me too.", "author": "hit-lacus", "createdAt": "2020-07-13T03:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI5Nzc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "60071ad0e15e2d75469aa07f6544eecac7e1e6df", "chunk": "diff --git a/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/source/CsvSource.java b/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/source/CsvSource.java\nindex f59295858..d0cb8b47c 100644\n--- a/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/source/CsvSource.java\n+++ b/kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/source/CsvSource.java\n\n@@ -62,8 +62,8 @@ public class CsvSource implements ISource {\n                             .getAbsolutePath();\n                     separator = \"\";\n                 } else if (kylinConfig.getDeployEnv().equals(\"LOCAL\")) {\n-                    path = \"file:///\" + new File(getUtMetaDir(),\n-                            \"../parquet_test/data/\" + table.identity() + \".csv\")\n+                    path = \"file:///\" + new File(kylinConfig.getMetadataUrlPrefix(),\n+                            \"data/\" + table.identity() + \".csv\")\n                             .getAbsolutePath();\n                     separator = \"\";\n                 } else {\n"}}, {"oid": "df12cd7bdcfc5b86e254c0337cef2a7bea1d8152", "url": "https://github.com/apache/kylin/commit/df12cd7bdcfc5b86e254c0337cef2a7bea1d8152", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-10T10:09:24Z", "type": "forcePushed"}, {"oid": "60071ad0e15e2d75469aa07f6544eecac7e1e6df", "url": "https://github.com/apache/kylin/commit/60071ad0e15e2d75469aa07f6544eecac7e1e6df", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-14T09:33:47Z", "type": "forcePushed"}, {"oid": "222b6d61d5981e35fd0ed2b78966c2499bdc3885", "url": "https://github.com/apache/kylin/commit/222b6d61d5981e35fd0ed2b78966c2499bdc3885", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-14T10:33:25Z", "type": "forcePushed"}, {"oid": "45e2b194fa1657e79d9429c01b0a03d38bf6b120", "url": "https://github.com/apache/kylin/commit/45e2b194fa1657e79d9429c01b0a03d38bf6b120", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-14T11:05:26Z", "type": "forcePushed"}, {"oid": "a249ffadca3e03f6b479b6fe5c5bbb09c2139148", "url": "https://github.com/apache/kylin/commit/a249ffadca3e03f6b479b6fe5c5bbb09c2139148", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-14T11:06:24Z", "type": "forcePushed"}, {"oid": "5ef2a53a453d20ff6ae55d30ef416a4e3dc36b90", "url": "https://github.com/apache/kylin/commit/5ef2a53a453d20ff6ae55d30ef416a4e3dc36b90", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-14T11:13:34Z", "type": "commit"}, {"oid": "5ef2a53a453d20ff6ae55d30ef416a4e3dc36b90", "url": "https://github.com/apache/kylin/commit/5ef2a53a453d20ff6ae55d30ef416a4e3dc36b90", "message": "KYLIN-4625 Debug the code of Kylin on Parquet without hadoop environment", "committedDate": "2020-07-14T11:13:34Z", "type": "forcePushed"}]}