{"pr_number": 1218, "pr_title": "KYLIN-4485 Create a self service interface for cube migration", "pr_createdAt": "2020-05-20T06:47:24Z", "pr_url": "https://github.com/apache/kylin/pull/1218", "timeline": [{"oid": "8cbb81b4f06b4b05b7c656cf0eb31c8e6507c3a1", "url": "https://github.com/apache/kylin/commit/8cbb81b4f06b4b05b7c656cf0eb31c8e6507c3a1", "message": "KYLIN-4489 Create a tool for migration cross clusters", "committedDate": "2020-05-25T04:09:38Z", "type": "forcePushed"}, {"oid": "bfb2899b3167638298a7675dba0834d9d6e4e3d3", "url": "https://github.com/apache/kylin/commit/bfb2899b3167638298a7675dba0834d9d6e4e3d3", "message": "KYLIN-4489 Create a tool for migration cross clusters", "committedDate": "2020-05-25T05:48:26Z", "type": "forcePushed"}, {"oid": "d0d4ff37aac13d4002b51d0b6c35ec23a9be9023", "url": "https://github.com/apache/kylin/commit/d0d4ff37aac13d4002b51d0b6c35ec23a9be9023", "message": "KYLIN-4489 Create a tool for migration cross clusters", "committedDate": "2020-05-25T05:50:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxNTkyNw==", "url": "https://github.com/apache/kylin/pull/1218#discussion_r434315927", "bodyText": "please remove 'KConstants'  class, it's not used.", "author": "zzcclp", "createdAt": "2020-06-03T05:28:13Z", "path": "core-common/src/main/java/org/apache/kylin/common/KConstants.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.kylin.common;\n+\n+public class KConstants {", "originalCommit": "d0d4ff37aac13d4002b51d0b6c35ec23a9be9023", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dee7914c39d4d121dc5d6d9e8b7eb04dac75101b", "chunk": "diff --git a/core-common/src/main/java/org/apache/kylin/common/KConstants.java b/core-common/src/main/java/org/apache/kylin/common/KConstants.java\ndeleted file mode 100644\nindex 5e1723c06..000000000\n--- a/core-common/src/main/java/org/apache/kylin/common/KConstants.java\n+++ /dev/null\n\n@@ -1,23 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-package org.apache.kylin.common;\n-\n-public class KConstants {\n-    public static final int DEFAULT_SERVICE_PORT = 7070;\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc0MTQwMA==", "url": "https://github.com/apache/kylin/pull/1218#discussion_r435741400", "bodyText": "add one blank space before '\" +'", "author": "zzcclp", "createdAt": "2020-06-05T07:35:16Z", "path": "server-base/src/main/java/org/apache/kylin/rest/service/TableService.java", "diffHunk": "@@ -105,6 +117,37 @@\n     @Autowired\n     private AclEvaluate aclEvaluate;\n \n+    public TableSchemaUpdateChecker getSchemaUpdateChecker() {\n+        return new TableSchemaUpdateChecker(getTableManager(), getCubeManager(), getDataModelManager());\n+    }\n+\n+    public void checkTableCompatibility(String prj, TableDesc tableDesc) {\n+        TableSchemaUpdateChecker.CheckResult result = getSchemaUpdateChecker().allowReload(tableDesc, prj);\n+        result.raiseExceptionWhenInvalid();\n+    }\n+\n+    public void checkHiveTableCompatibility(String prj, TableDesc tableDesc) throws Exception {\n+        Preconditions.checkNotNull(tableDesc.getDatabase());\n+        Preconditions.checkNotNull(tableDesc.getName());\n+\n+        String database = tableDesc.getDatabase().toUpperCase(Locale.ROOT);\n+        String tableName = tableDesc.getName().toUpperCase(Locale.ROOT);\n+        ProjectInstance projectInstance = getProjectManager().getProject(prj);\n+        ISourceMetadataExplorer explr = SourceManager.getSource(projectInstance).getSourceMetadataExplorer();\n+\n+        TableDesc hiveTableDesc;\n+        try {\n+            Pair<TableDesc, TableExtDesc> pair = explr.loadTableMetadata(database, tableName, prj);\n+            hiveTableDesc = pair.getFirst();\n+        } catch (Exception e) {\n+            logger.error(\"Fail to get metadata for hive table {} due to \", tableDesc.getIdentity(), e);\n+            throw new RuntimeException(\"Fail to get metadata for hive table\" + tableDesc.getIdentity());", "originalCommit": "d0d4ff37aac13d4002b51d0b6c35ec23a9be9023", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dee7914c39d4d121dc5d6d9e8b7eb04dac75101b", "chunk": "diff --git a/server-base/src/main/java/org/apache/kylin/rest/service/TableService.java b/server-base/src/main/java/org/apache/kylin/rest/service/TableService.java\nindex 0420ad816..0d3f9f0be 100644\n--- a/server-base/src/main/java/org/apache/kylin/rest/service/TableService.java\n+++ b/server-base/src/main/java/org/apache/kylin/rest/service/TableService.java\n\n@@ -141,7 +141,7 @@ public class TableService extends BasicService {\n             hiveTableDesc = pair.getFirst();\n         } catch (Exception e) {\n             logger.error(\"Fail to get metadata for hive table {} due to \", tableDesc.getIdentity(), e);\n-            throw new RuntimeException(\"Fail to get metadata for hive table\" + tableDesc.getIdentity());\n+            throw new RuntimeException(\"Fail to get metadata for hive table \" + tableDesc.getIdentity());\n         }\n \n         TableSchemaUpdateChecker.CheckResult result = getSchemaUpdateChecker().allowMigrate(tableDesc, hiveTableDesc);\n"}}, {"oid": "dee7914c39d4d121dc5d6d9e8b7eb04dac75101b", "url": "https://github.com/apache/kylin/commit/dee7914c39d4d121dc5d6d9e8b7eb04dac75101b", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-10T05:15:34Z", "type": "forcePushed"}, {"oid": "4bd680c5b2dce0fa891c17871e8947aa1724a071", "url": "https://github.com/apache/kylin/commit/4bd680c5b2dce0fa891c17871e8947aa1724a071", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-10T07:12:22Z", "type": "forcePushed"}, {"oid": "1241591d44e87f2610a8428d199d4ab90bd3ec5d", "url": "https://github.com/apache/kylin/commit/1241591d44e87f2610a8428d199d4ab90bd3ec5d", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-10T07:29:54Z", "type": "forcePushed"}, {"oid": "46e824598f4cfad9e4fe9919362d060c549b1c91", "url": "https://github.com/apache/kylin/commit/46e824598f4cfad9e4fe9919362d060c549b1c91", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-10T07:47:55Z", "type": "forcePushed"}, {"oid": "aa42d8c7fc590c8f68d35225eddcf0f7172310f8", "url": "https://github.com/apache/kylin/commit/aa42d8c7fc590c8f68d35225eddcf0f7172310f8", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-10T07:49:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzMTU3Nw==", "url": "https://github.com/apache/kylin/pull/1218#discussion_r438231577", "bodyText": "@kyotoYaho Please fix the failed test case: AdminServiceTest.testGetPublicConfig, it needs to add this property into expected results.", "author": "zzcclp", "createdAt": "2020-06-10T15:54:03Z", "path": "core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java", "diffHunk": "@@ -2125,14 +2154,15 @@ public boolean isWebDashboardEnabled() {\n \n     public String getPropertiesWhiteList() {\n         return getOptional(\"kylin.web.properties.whitelist\", \"kylin.web.timezone,kylin.query.cache-enabled,kylin.env,\"\n+                + \"kylin.cube.migration.enabled,\"", "originalCommit": "aa42d8c7fc590c8f68d35225eddcf0f7172310f8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0aa2ef6d69405bb5d04a3db3d7c489b8e9468fd", "chunk": "diff --git a/core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java b/core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java\nindex c2242becb..d33a73d85 100644\n--- a/core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java\n+++ b/core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java\n\n@@ -2152,9 +2225,12 @@ public abstract class KylinConfigBase implements Serializable {\n         return Boolean.parseBoolean(getOptional(\"kylin.web.dashboard-enabled\", FALSE));\n     }\n \n+    public boolean isWebConfigEnabled() {\n+        return Boolean.parseBoolean(getOptional(\"kylin.web.set-config-enable\", FALSE));\n+    }\n+\n     public String getPropertiesWhiteList() {\n         return getOptional(\"kylin.web.properties.whitelist\", \"kylin.web.timezone,kylin.query.cache-enabled,kylin.env,\"\n-                + \"kylin.cube.migration.enabled,\"\n                 + \"kylin.web.hive-limit,kylin.storage.default,\"\n                 + \"kylin.engine.default,kylin.web.link-hadoop,kylin.web.link-diagnostic,\"\n                 + \"kylin.web.contact-mail,kylin.web.help.length,kylin.web.help.0,kylin.web.help.1,kylin.web.help.2,\"\n"}}, {"oid": "aa2b4811955fbf3278bf2fb8cd8b68e6b3ef2dbd", "url": "https://github.com/apache/kylin/commit/aa2b4811955fbf3278bf2fb8cd8b68e6b3ef2dbd", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-11T01:59:35Z", "type": "forcePushed"}, {"oid": "e0aa2ef6d69405bb5d04a3db3d7c489b8e9468fd", "url": "https://github.com/apache/kylin/commit/e0aa2ef6d69405bb5d04a3db3d7c489b8e9468fd", "message": "KYLIN-4420 Add model compatibility check to allow more compatible update", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "a5ebd43cf1f6732145fc48ce1158056441ddea17", "url": "https://github.com/apache/kylin/commit/a5ebd43cf1f6732145fc48ce1158056441ddea17", "message": "KYLIN-4421 Add table alias field for root fact table in DataModelDesc", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "ac59efdcc132cda8769d8f32bc4589e54ed1a926", "url": "https://github.com/apache/kylin/commit/ac59efdcc132cda8769d8f32bc4589e54ed1a926", "message": "KYLIN-4421 Allow to update table & database name", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "1d725e9c95f10b1e660f7bcda10aaeccafd70192", "url": "https://github.com/apache/kylin/commit/1d725e9c95f10b1e660f7bcda10aaeccafd70192", "message": "KYLIN-4421 Add a rest API for updating table & database name", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "c46e944dcff127c89966363ab60ac9ab3cfa5911", "url": "https://github.com/apache/kylin/commit/c46e944dcff127c89966363ab60ac9ab3cfa5911", "message": "KYLIN-4422 Allow to change data type from varchar to datetime", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "2013b57612a9541fabf67cb86fb191fd9229f381", "url": "https://github.com/apache/kylin/commit/2013b57612a9541fabf67cb86fb191fd9229f381", "message": "KYLIN-4484 Relax checkValidationInModel() in TableSchemaUpdateChecker", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "f4a71ed35a4d1048f6fe0cbd78edc05b7c1674b1", "url": "https://github.com/apache/kylin/commit/f4a71ed35a4d1048f6fe0cbd78edc05b7c1674b1", "message": "KYLIN-4419 Refine IT sqls with adding order by", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "146285c38badfe7abaf3cee415b39ac56c2eaa75", "url": "https://github.com/apache/kylin/commit/146285c38badfe7abaf3cee415b39ac56c2eaa75", "message": "KYLIN-4487 Backend support for auto-migration to allow user to do cube migration by self service", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "c56da0a42b6f9eaa8bc7a61c9ff30bb719c72244", "url": "https://github.com/apache/kylin/commit/c56da0a42b6f9eaa8bc7a61c9ff30bb719c72244", "message": "KYLIN-4499 Extract kylin server self discovery service from CuratorScheduler", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "2d19066f3632f93de65fc05066b442ea815d7eb3", "url": "https://github.com/apache/kylin/commit/2d19066f3632f93de65fc05066b442ea815d7eb3", "message": "KYLIN-4488 Revert KYLIN-2999", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "bd3f2759c62f5b87d9b62177e9c01e0907a33e5b", "url": "https://github.com/apache/kylin/commit/bd3f2759c62f5b87d9b62177e9c01e0907a33e5b", "message": "KYLIN-4488 Frontend support for auto-migration to allow user to do cube migration by self service", "committedDate": "2020-06-12T10:53:53Z", "type": "commit"}, {"oid": "f4cf61fa07e65127aa5cbddee7304c9d60cde91b", "url": "https://github.com/apache/kylin/commit/f4cf61fa07e65127aa5cbddee7304c9d60cde91b", "message": "KYLIN-4489 Add hive table compatibility check rest service", "committedDate": "2020-06-12T10:53:54Z", "type": "commit"}, {"oid": "6085c5d37869ec18deb6abed84a8b7c7991c6402", "url": "https://github.com/apache/kylin/commit/6085c5d37869ec18deb6abed84a8b7c7991c6402", "message": "KYLIN-4489 Create a tool for migration cross clusters", "committedDate": "2020-06-12T10:53:54Z", "type": "commit"}, {"oid": "39410dc2e979ace810ada53d2edf3155cd70b956", "url": "https://github.com/apache/kylin/commit/39410dc2e979ace810ada53d2edf3155cd70b956", "message": "KYLIN-4485 Minor fix", "committedDate": "2020-06-12T10:53:54Z", "type": "commit"}, {"oid": "c561c523d2aa6a38c3317b415b74442c4d827507", "url": "https://github.com/apache/kylin/commit/c561c523d2aa6a38c3317b415b74442c4d827507", "message": "KYLIN-4429 Auto convert filter date values to date format string when the related column type is string", "committedDate": "2020-06-12T10:54:13Z", "type": "commit"}, {"oid": "c561c523d2aa6a38c3317b415b74442c4d827507", "url": "https://github.com/apache/kylin/commit/c561c523d2aa6a38c3317b415b74442c4d827507", "message": "KYLIN-4429 Auto convert filter date values to date format string when the related column type is string", "committedDate": "2020-06-12T10:54:13Z", "type": "forcePushed"}]}