{"pr_number": 7468, "pr_title": "Fix Build failures:  testAnki2Updates and testTabOrder", "pr_createdAt": "2020-10-24T08:56:56Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7468", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQxODgzMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511418831", "bodyText": "Utils.equals seems to be what you are looking for here", "author": "Arthur-Milchior", "createdAt": "2020-10-24T11:59:50Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/utils/ObjectUtils.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ *  Copyright (c) 2020 David Allison <davidallisongithub@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify it under\n+ *  the terms of the GNU General Public License as published by the Free Software\n+ *  Foundation; either version 3 of the License, or (at your option) any later\n+ *  version.\n+ *\n+ *  This program is distributed in the hope that it will be useful, but WITHOUT ANY\n+ *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n+ *  PARTICULAR PURPOSE. See the GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License along with\n+ *  this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.ichi2.libanki.utils;\n+\n+public class ObjectUtils {\n+    private ObjectUtils() {\n+\n+    }\n+\n+    public static boolean equals(Object a, Object b) {\n+        // Normally we'd use compat - but we're optimising for perf.", "originalCommit": "967408551a9524e80dc0f4dc4d8058022555ab28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQyMDI2NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511420264", "bodyText": "I couldn't find it - thanks!", "author": "david-allison-1", "createdAt": "2020-10-24T12:04:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQxODgzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "796afea7f8ee5044ac984076565907b97a6cf72f", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/utils/ObjectUtils.java b/AnkiDroid/src/main/java/com/ichi2/libanki/utils/ObjectUtils.java\ndeleted file mode 100644\nindex 4a3b12fe4..000000000\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/utils/ObjectUtils.java\n+++ /dev/null\n\n@@ -1,32 +0,0 @@\n-/*\n- *  Copyright (c) 2020 David Allison <davidallisongithub@gmail.com>\n- *\n- *  This program is free software; you can redistribute it and/or modify it under\n- *  the terms of the GNU General Public License as published by the Free Software\n- *  Foundation; either version 3 of the License, or (at your option) any later\n- *  version.\n- *\n- *  This program is distributed in the hope that it will be useful, but WITHOUT ANY\n- *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n- *  PARTICULAR PURPOSE. See the GNU General Public License for more details.\n- *\n- *  You should have received a copy of the GNU General Public License along with\n- *  this program.  If not, see <http://www.gnu.org/licenses/>.\n- */\n-\n-package com.ichi2.libanki.utils;\n-\n-public class ObjectUtils {\n-    private ObjectUtils() {\n-\n-    }\n-\n-    public static boolean equals(Object a, Object b) {\n-        // Normally we'd use compat - but we're optimising for perf.\n-        // API 19: replace with Objects.equals\n-        if (a == b) {\n-            return true;\n-        }\n-        return a != null && a.equals(b);\n-    }\n-}\n"}}, {"oid": "796afea7f8ee5044ac984076565907b97a6cf72f", "url": "https://github.com/ankidroid/Anki-Android/commit/796afea7f8ee5044ac984076565907b97a6cf72f", "message": "Fix test failure\n\ncom.ichi2.anki.tests.libanki.ImportTest > testAnki2Updates[test(AVD) - 4.1.2] FAILED\n\tjava.lang.AssertionError: expected:<1> but was:<0>\n\tat org.junit.Assert.fail(Assert.java:88)\n\nFixes 7467", "committedDate": "2020-10-24T12:06:34Z", "type": "commit"}, {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "url": "https://github.com/ankidroid/Anki-Android/commit/aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "message": "Fix inconsistent use of mid", "committedDate": "2020-10-24T12:06:34Z", "type": "commit"}, {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "url": "https://github.com/ankidroid/Anki-Android/commit/aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "message": "Fix inconsistent use of mid", "committedDate": "2020-10-24T12:06:34Z", "type": "forcePushed"}, {"oid": "bd39a634329a857504150d5025830dbd618051cc", "url": "https://github.com/ankidroid/Anki-Android/commit/bd39a634329a857504150d5025830dbd618051cc", "message": "Fix Test: Ignore testTabOrder on API 25 and 30\n\nFixes 7470", "committedDate": "2020-10-24T14:02:28Z", "type": "commit"}, {"oid": "bd39a634329a857504150d5025830dbd618051cc", "url": "https://github.com/ankidroid/Anki-Android/commit/bd39a634329a857504150d5025830dbd618051cc", "message": "Fix Test: Ignore testTabOrder on API 25 and 30\n\nFixes 7470", "committedDate": "2020-10-24T14:02:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MzA4MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511483080", "bodyText": "Wellll....that's unexpected. Wow.", "author": "mikehardy", "createdAt": "2020-10-24T15:19:52Z", "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/NoteEditorTabOrderTest.java", "diffHunk": "@@ -44,21 +45,22 @@\n import static org.junit.Assume.assumeThat;\n \n @RunWith(androidx.test.ext.junit.runners.AndroidJUnit4.class)\n-public class NoteEditorTest {\n-\n-    @Rule public ActivityScenarioRule<NoteEditor> activityRule = new ActivityScenarioRule<>(getStartActivityIntent());\n-    @Rule public GrantPermissionRule mRuntimePermissionRule = GrantPermissionRule.grant(WRITE_EXTERNAL_STORAGE);\n-\n-    @NonNull\n-    private Intent getStartActivityIntent() {\n-        Intent intent = new Intent(getTargetContext(), NoteEditor.class);\n-        intent.setComponent(new ComponentName(getTargetContext(), NoteEditor.class));\n-        intent.putExtra(NoteEditor.EXTRA_CALLER, NoteEditor.CALLER_DECKPICKER);\n-        return intent;\n+public class NoteEditorTabOrderTest {\n+\n+    public NoteEditorTabOrderTest() {\n+        // Rules mean that we get a failure on API 25.\n+        // Even if we ignore the tests, the rules cause a failure.\n+        // We can't ignore the test in @BeforeClass (\"Test run failed to complete. Expected 150 tests, received 149\")\n+        // and @Before executes after the rule.\n+        // So, disable the rules in the constructor, and ignore in before.", "originalCommit": "bd39a634329a857504150d5025830dbd618051cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MzEzMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511483133", "bodyText": "interesting! I guess that was a confluence of your change at the same time as the \"less long\" PR", "author": "mikehardy", "createdAt": "2020-10-24T15:20:18Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -408,7 +408,7 @@ private void _prepareModels() {\n             if (srcScm.equals(dstScm)) {\n                 // they do; we can reuse this mid\n                 Model model = srcModel.deepClone();\n-                model.put(\"id\", mid);\n+                model.put(\"id\", (long) mid);", "originalCommit": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MzM2OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511483369", "bodyText": "I didn't touch this line - came about from the conversion to Long, one of the two branches was converted.", "author": "david-allison-1", "createdAt": "2020-10-24T15:22:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MzEzMw=="}], "type": "inlineReview", "revised_code": null}]}