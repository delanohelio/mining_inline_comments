{"pr_number": 6416, "pr_title": "Allow user to set Language Hints for Note Editor fields", "pr_createdAt": "2020-06-09T13:13:30Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6416", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxMDcwMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6416#discussion_r437410701", "bodyText": "Flagging in case there's a better way here", "author": "david-allison-1", "createdAt": "2020-06-09T13:20:16Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/ModelFieldEditor.java", "diffHunk": "@@ -537,6 +545,54 @@ public void onBackPressed() {\n             case ModelEditorContextMenu.FIELD_TOGGLE_STICKY:\n                 toggleStickyField();\n                 break;\n+            default: {\n+                //need this as we can't switch on a @RequiresApi", "originalCommit": "87e8477c5919545865dbec79cbffa7f275702a14", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b8e3c4145e584bf749656d97252f2567cd59e0e", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/ModelFieldEditor.java b/AnkiDroid/src/main/java/com/ichi2/anki/ModelFieldEditor.java\nindex 39f6e7c56..300150f7f 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/ModelFieldEditor.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/ModelFieldEditor.java\n\n@@ -545,54 +551,6 @@ public class ModelFieldEditor extends AnkiActivity implements LocaleSelectionDia\n             case ModelEditorContextMenu.FIELD_TOGGLE_STICKY:\n                 toggleStickyField();\n                 break;\n-            default: {\n-                //need this as we can't switch on a @RequiresApi\n-                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N && selection == ModelEditorContextMenu.FIELD_ADD_LANGUAGE_HINT) {\n-                    Timber.i(\"displaying locale hint dialog\");\n-                    localeHintDialog();\n-                    break;\n-                }\n-            }\n         }\n     };\n-\n-\n-    @RequiresApi(api = Build.VERSION_CODES.N)\n-    private void localeHintDialog() {\n-        //We don't currently show the current value, but we may want to in the future\n-        DialogFragment dialogFragment = LocaleSelectionDialog.newInstance(this);\n-        showDialogFragment(dialogFragment);\n-    }\n-\n-\n-    /*\n-     * Sets the Locale Hint of the field to the provided value.\n-     * This allows some keyboard (GBoard) to change language\n-     */\n-    @RequiresApi(api = Build.VERSION_CODES.N)\n-    private void addFieldLocaleHint(@NonNull Locale selectedLocale) {\n-        String input = selectedLocale.toLanguageTag();\n-        JSONObject field = (JSONObject) mNoteFields.get(mCurrentPos);\n-        field.put(\"ad-hint-locale\", input);\n-        mCol.getModels().save();\n-        Timber.i(\"Set field locale to %s\", selectedLocale);\n-        String format = getString(R.string.model_field_editor_language_hint_dialog_success_result, selectedLocale.getDisplayName());\n-        UIUtils.showSimpleSnackbar(this, format, true);\n-    }\n-\n-\n-\n-    @Override\n-    @RequiresApi(api = Build.VERSION_CODES.N)\n-    public void onSelectedLocale(@NonNull Locale selectedLocale) {\n-        addFieldLocaleHint(selectedLocale);\n-        dismissAllDialogFragments();\n-    }\n-\n-\n-    @Override\n-    @RequiresApi(api = Build.VERSION_CODES.N)\n-    public void onLocaleSelectionCancelled() {\n-        dismissAllDialogFragments();\n-    }\n }\n"}}, {"oid": "08669c60f732d814ef785452e87163f932d78a4d", "url": "https://github.com/ankidroid/Anki-Android/commit/08669c60f732d814ef785452e87163f932d78a4d", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality", "committedDate": "2020-06-09T13:35:01Z", "type": "forcePushed"}, {"oid": "694d9843ad72fa5d6f95059210331cba34ebe9de", "url": "https://github.com/ankidroid/Anki-Android/commit/694d9843ad72fa5d6f95059210331cba34ebe9de", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality", "committedDate": "2020-08-07T01:23:25Z", "type": "forcePushed"}, {"oid": "5b8e3c4145e584bf749656d97252f2567cd59e0e", "url": "https://github.com/ankidroid/Anki-Android/commit/5b8e3c4145e584bf749656d97252f2567cd59e0e", "message": "NF: Extract getEntryCount\n\nTo be used in a later refactoring", "committedDate": "2020-08-18T18:39:48Z", "type": "commit"}, {"oid": "e7d04589b7a96b7ea634dad79f9ec2507b1f922c", "url": "https://github.com/ankidroid/Anki-Android/commit/e7d04589b7a96b7ea634dad79f9ec2507b1f922c", "message": "Extract setNoteTypePosition\n\nTo be used in a later refactoring - moves this before populateEditFields", "committedDate": "2020-08-18T18:39:48Z", "type": "commit"}, {"oid": "4c389ea419f8fcd0ddc921a41c65c334e5be7e7b", "url": "https://github.com/ankidroid/Anki-Android/commit/4c389ea419f8fcd0ddc921a41c65c334e5be7e7b", "message": "NF/PERF: Make Models.fieldMap static\n\nAlso planned to be used in a later commit", "committedDate": "2020-08-18T18:45:33Z", "type": "commit"}, {"oid": "0ff0179e2f07797b27100ce12c13e0d6b0812512", "url": "https://github.com/ankidroid/Anki-Android/commit/0ff0179e2f07797b27100ce12c13e0d6b0812512", "message": "Add \"set keyboard language hint\" to fields\n\nAndroid >= N (24). TextViews can have `setImeHintLocales` called\nwhich will change a multilingual keyboard to the provided locale if\navailable.\n\nThis does not currently work for SwiftKey, but does work with GBoard.\n\nFixes #3496", "committedDate": "2020-08-18T18:47:48Z", "type": "commit"}, {"oid": "120d74eadef7eee5e05a9c8681684dde4488da17", "url": "https://github.com/ankidroid/Anki-Android/commit/120d74eadef7eee5e05a9c8681684dde4488da17", "message": "NF: Refactor onPrepareActionMode\n\nIn preparation for adding in another menu item", "committedDate": "2020-08-18T18:47:51Z", "type": "commit"}, {"oid": "7875a948a31c7d11331658693a11bb3a072dca08", "url": "https://github.com/ankidroid/Anki-Android/commit/7875a948a31c7d11331658693a11bb3a072dca08", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality", "committedDate": "2020-08-18T18:47:52Z", "type": "commit"}, {"oid": "7875a948a31c7d11331658693a11bb3a072dca08", "url": "https://github.com/ankidroid/Anki-Android/commit/7875a948a31c7d11331658693a11bb3a072dca08", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality", "committedDate": "2020-08-18T18:47:52Z", "type": "forcePushed"}]}