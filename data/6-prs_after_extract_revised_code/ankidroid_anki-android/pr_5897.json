{"pr_number": 5897, "pr_title": "Reviewer: Action Bar buttons disabled while DeckTask working", "pr_createdAt": "2020-04-02T08:00:41Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5897", "timeline": [{"oid": "449172f9c379724b886950c41509a92d49a619da", "url": "https://github.com/ankidroid/Anki-Android/commit/449172f9c379724b886950c41509a92d49a619da", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded.", "committedDate": "2020-04-09T12:40:05Z", "type": "forcePushed"}, {"oid": "0b7ca56e1f6ff54d13e55750734a270efea5275d", "url": "https://github.com/ankidroid/Anki-Android/commit/0b7ca56e1f6ff54d13e55750734a270efea5275d", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded.", "committedDate": "2020-04-09T14:08:33Z", "type": "forcePushed"}, {"oid": "4c05af88f5caa6eaf0402784011a4f549e51fc43", "url": "https://github.com/ankidroid/Anki-Android/commit/4c05af88f5caa6eaf0402784011a4f549e51fc43", "message": "Undo and Dismiss block controls too", "committedDate": "2020-04-11T17:57:04Z", "type": "commit"}, {"oid": "531a28dbe23387ddbca19e4770328b5769425cc6", "url": "https://github.com/ankidroid/Anki-Android/commit/531a28dbe23387ddbca19e4770328b5769425cc6", "message": "Knowing whether controls are currently blocked", "committedDate": "2020-04-11T17:57:04Z", "type": "commit"}, {"oid": "db37168c6502191db87e30749a52823990710aec", "url": "https://github.com/ankidroid/Anki-Android/commit/db37168c6502191db87e30749a52823990710aec", "message": "don't bury/suspend note when blocked\n\nThis commit may seems useles. But it allows to avoid accessing the\ndatabase and save time", "committedDate": "2020-04-11T17:57:41Z", "type": "commit"}, {"oid": "c158e2fb83e7bd77bf23ecb91b94f27221547b25", "url": "https://github.com/ankidroid/Anki-Android/commit/c158e2fb83e7bd77bf23ecb91b94f27221547b25", "message": "Blocking/unblocking change top menu buttons too", "committedDate": "2020-04-11T17:57:41Z", "type": "commit"}, {"oid": "58ec2523777845955f3f7bfbb375c44c4339e818", "url": "https://github.com/ankidroid/Anki-Android/commit/58ec2523777845955f3f7bfbb375c44c4339e818", "message": "top menu items are deactivated when buttons are blocked", "committedDate": "2020-04-11T17:57:41Z", "type": "commit"}, {"oid": "c51c3547c9ef271fea65a9240638c6da945a4b88", "url": "https://github.com/ankidroid/Anki-Android/commit/c51c3547c9ef271fea65a9240638c6da945a4b88", "message": "don't put \"undo\" to color enabled\n\nEnabled is the default, so it's useless and actually put back the\ncolor uselessly", "committedDate": "2020-04-11T17:57:41Z", "type": "commit"}, {"oid": "c51c3547c9ef271fea65a9240638c6da945a4b88", "url": "https://github.com/ankidroid/Anki-Android/commit/c51c3547c9ef271fea65a9240638c6da945a4b88", "message": "don't put \"undo\" to color enabled\n\nEnabled is the default, so it's useless and actually put back the\ncolor uselessly", "committedDate": "2020-04-11T17:57:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxNzU4NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5897#discussion_r407217585", "bodyText": "Interesting - this is definitely following the pattern we have established, but (not in this PR, just as an idea) this might need investigation with regard to night mode", "author": "mikehardy", "createdAt": "2020-04-12T15:59:57Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -367,7 +367,20 @@ private void addNote() {\n     private void setCustomButtons(Menu menu) {\n         for(int itemId : mCustomButtons.keySet()) {\n             if(mCustomButtons.get(itemId) != MENU_DISABLED) {\n-                menu.findItem(itemId).setShowAsAction(mCustomButtons.get(itemId));\n+                MenuItem item = menu.findItem(itemId);\n+                item.setShowAsAction(mCustomButtons.get(itemId));\n+                Drawable icon = item.getIcon();\n+                if (getControlBlocked()) {\n+                    item.setEnabled(false);\n+                    if (icon != null) {\n+                        icon.setAlpha(Themes.ALPHA_ICON_DISABLED_LIGHT);", "originalCommit": "58ec2523777845955f3f7bfbb375c44c4339e818", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}