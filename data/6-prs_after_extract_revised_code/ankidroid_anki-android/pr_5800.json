{"pr_number": 5800, "pr_title": "Avoid crashing on import even if collection not found", "pr_createdAt": "2020-03-08T17:35:52Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5800", "timeline": [{"oid": "2caf54388bf43d19158392543c6223672ac1d7ca", "url": "https://github.com/ankidroid/Anki-Android/commit/2caf54388bf43d19158392543c6223672ac1d7ca", "message": "Avoid crashing on import even if collection not found", "committedDate": "2020-03-08T17:31:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDQyNQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5800#discussion_r389420425", "bodyText": "Are you getting the whole list as a sublist here? Why is that necessary? \ud83e\udd14", "author": "timrae", "createdAt": "2020-03-08T23:57:12Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Utils.java", "diffHunk": "@@ -847,14 +847,11 @@ public static double utcOffset() {\n     public static List<File> getImportableDecks(Context context) {\n         String deckPath = CollectionHelper.getCurrentAnkiDroidDirectory(context);\n         File dir = new File(deckPath);\n-        int deckCount = 0;\n-        File[] deckList = null;\n+        List<File> decks = new ArrayList<>();\n         if (dir.exists() && dir.isDirectory()) {\n-            deckList = dir.listFiles(pathname -> pathname.isFile() && ImportUtils.isValidPackageName(pathname.getName()));\n-            deckCount = deckList.length;\n+            File[] deckList = dir.listFiles(pathname -> pathname.isFile() && ImportUtils.isValidPackageName(pathname.getName()));\n+            decks.addAll(Arrays.asList(deckList).subList(0, deckList.length));", "originalCommit": "2caf54388bf43d19158392543c6223672ac1d7ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0Mzk2OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5800#discussion_r389443968", "bodyText": "It was already doing that, 2 lines down\nmy goal with this change was to do nothing semantic, simply to guarantee that the returned variable was initialized prior to the directory check and that the 'Arrays.asList' (which was the crashing call) was only called when deckList was initialized", "author": "mikehardy", "createdAt": "2020-03-09T02:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDQyNQ=="}], "type": "inlineReview", "revised_code": null}]}