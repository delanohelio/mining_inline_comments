{"pr_number": 6577, "pr_title": "NF: _groupChildrenMain deal with unchecked deck collection (performance)", "pr_createdAt": "2020-06-29T00:49:21Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6577", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTEyMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#discussion_r446971123", "bodyText": "Would be useful to extract into a method/input to the function, given that it's duplicated 3 times.", "author": "david-allison-1", "createdAt": "2020-06-29T13:28:30Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -454,10 +454,20 @@ protected int _walkingCount(LimitMethod limFn, CountMethod cntFn) {\n              * current one itself.  I.e., they are subdecks that stem\n              * from this node.  This is our version of python's\n              * itertools.groupby. */\n+            if (!checkDone && node.getDepth() != depth) {\n+                JSONObject deck = mCol.getDecks().get(node.getDid());", "originalCommit": "567a1630f19464aa8565b0d4819df466c93064f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyNTUwNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#discussion_r447025504", "bodyText": "I want to agree, and wanted to do it. The trouble I quickly had is that I can't create a method which just call \"continue\". I can't even create a method for the conjunction, since in one case\u00a0I want to check the numbers are distinct and in the other case I want to check the numbers are equal. Even the debugging message is different. So I don't really know what to do now", "author": "Arthur-Milchior", "createdAt": "2020-06-29T14:43:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTEyMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3NjY4NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#discussion_r446976685", "bodyText": "I don't know what checkDone means, a comment would be useful.", "author": "david-allison-1", "createdAt": "2020-06-29T13:36:41Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -245,7 +245,7 @@ private void unburyCardsForDeck(List<Long> allDecks) {\n \n \n     @Override\n-    protected List<DeckDueTreeNode> _groupChildrenMain(List<DeckDueTreeNode> grps, int depth) {\n+    protected List<DeckDueTreeNode> _groupChildrenMain(List<DeckDueTreeNode> grps, int depth, boolean checkDone) {", "originalCommit": "567a1630f19464aa8565b0d4819df466c93064f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzMjA4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#discussion_r447032083", "bodyText": "Done", "author": "Arthur-Milchior", "createdAt": "2020-06-29T14:52:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3NjY4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "3b5154918e20cbec8adb9399fd8bcb957450312a", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java b/AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java\nindex 86e593513..b062eca08 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java\n\n@@ -244,6 +244,17 @@ public class Sched extends SchedV2 {\n     }\n \n \n+    /**\n+        @return the tree structure of all decks from @grps, starting\n+        at specified depth.\n+\n+        @param grps a list of decks of dept at least depth, having all\n+        the same first depth name elements, sorted in deck order.\n+        @param depth The depth of the tree we are creating\n+        @param checkDone whether the set of deck was checked. If\n+        false, we can't assume all decks have parents and that there\n+        is no duplicate. Instead, we'll ignore problems.\n+     */\n     @Override\n     protected List<DeckDueTreeNode> _groupChildrenMain(List<DeckDueTreeNode> grps, int depth, boolean checkDone) {\n         List<DeckDueTreeNode> tree = new ArrayList<>();\n"}}, {"oid": "3b5154918e20cbec8adb9399fd8bcb957450312a", "url": "https://github.com/ankidroid/Anki-Android/commit/3b5154918e20cbec8adb9399fd8bcb957450312a", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent.", "committedDate": "2020-06-29T14:51:53Z", "type": "forcePushed"}, {"oid": "09b073e9cc81c45deb05b8908d144a58d0923366", "url": "https://github.com/ankidroid/Anki-Android/commit/09b073e9cc81c45deb05b8908d144a58d0923366", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent.", "committedDate": "2020-06-29T19:47:16Z", "type": "commit"}, {"oid": "09b073e9cc81c45deb05b8908d144a58d0923366", "url": "https://github.com/ankidroid/Anki-Android/commit/09b073e9cc81c45deb05b8908d144a58d0923366", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent.", "committedDate": "2020-06-29T19:47:16Z", "type": "forcePushed"}]}