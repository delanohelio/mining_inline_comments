{"pr_number": 7675, "pr_title": "Card Browser: Fix \"Undo\" not appearing and stale data", "pr_createdAt": "2020-11-14T04:39:12Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7675", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NTkzNQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#discussion_r523395935", "bodyText": "Why did days became position?", "author": "Arthur-Milchior", "createdAt": "2020-11-14T08:52:27Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1169,10 +1169,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                     getString(R.string.reposition_card_dialog_title),\n                     getString(R.string.reposition_card_dialog_message),\n                     5);\n-            repositionDialog.setCallbackRunnable(days ->\n-                    CollectionTask.launchCollectionTask(DISMISS_MULTI, repositionCardHandler(),\n-                            new TaskData(new Object[] {cardIds, Collection.DismissType.REPOSITION_CARDS, days}))\n-            );\n+            repositionDialog.setCallbackRunnable(position -> repositionCardsNoValidation(cardIds, position));", "originalCommit": "43dc158f43983b7988e63c8567c1cdf2acbf8b87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQzODc0Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#discussion_r523438746", "bodyText": "Because days was an incorrect variable name", "author": "david-allison-1", "createdAt": "2020-11-14T16:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NTkzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "5d20f8fd85d9fe58d5fedf12a9a1a7bd22968297", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java b/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java\nindex 64e9df7d2..a4f149e4e 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java\n\n@@ -1169,7 +1167,10 @@ public class CardBrowser extends NavigationDrawerActivity implements\n                     getString(R.string.reposition_card_dialog_title),\n                     getString(R.string.reposition_card_dialog_message),\n                     5);\n-            repositionDialog.setCallbackRunnable(position -> repositionCardsNoValidation(cardIds, position));\n+            repositionDialog.setCallbackRunnable(days ->\n+                    CollectionTask.launchCollectionTask(DISMISS_MULTI, repositionCardHandler(),\n+                            new TaskData(new Object[] {cardIds, Collection.DismissType.REPOSITION_CARDS, days}))\n+            );\n             showDialogFragment(repositionDialog);\n             return true;\n         } else if (itemId == R.id.action_edit_note) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NjYyNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#discussion_r523396627", "bodyText": "Nice.\nMay I suggest to move it in its own commit, and update the four tests where it's used to remove the array and make code smaller", "author": "Arthur-Milchior", "createdAt": "2020-11-14T09:00:37Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -2745,7 +2770,7 @@ void rerenderAllCards() {\n     }\n \n     @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n-    void checkCardsAtPositions(int[] positions) {\n+    void checkCardsAtPositions(int... positions) {", "originalCommit": "e755714d9c5cb5339f910b4a27e252b9854d6b08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5d20f8fd85d9fe58d5fedf12a9a1a7bd22968297", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java b/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java\nindex 470e2138e..a4f149e4e 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java\n\n@@ -2770,7 +2715,7 @@ public class CardBrowser extends NavigationDrawerActivity implements\n     }\n \n     @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n-    void checkCardsAtPositions(int... positions) {\n+    void checkCardsAtPositions(int[] positions) {\n         for (int position : positions) {\n             if (position >= mCards.size()) {\n                 throw new IllegalStateException(\n"}}, {"oid": "5d20f8fd85d9fe58d5fedf12a9a1a7bd22968297", "url": "https://github.com/ankidroid/Anki-Android/commit/5d20f8fd85d9fe58d5fedf12a9a1a7bd22968297", "message": "NF: Rename checkedCardsAtPositions\n\ncheckCardsAtPositions makes more sense as we perform the \"check\" action", "committedDate": "2020-11-14T16:49:45Z", "type": "commit"}, {"oid": "27c3b0a39ea7b5584e05ce852fda0aef4a686bd2", "url": "https://github.com/ankidroid/Anki-Android/commit/27c3b0a39ea7b5584e05ce852fda0aef4a686bd2", "message": "NF: extract repositionCardsNoValidation\n\nUseful for testing", "committedDate": "2020-11-14T16:49:46Z", "type": "commit"}, {"oid": "77731f8786a5761de2bd6e770dd44f18bb3cb96e", "url": "https://github.com/ankidroid/Anki-Android/commit/77731f8786a5761de2bd6e770dd44f18bb3cb96e", "message": "NF: Extract rescheduleWithoutValidation\n\nuseful for testing", "committedDate": "2020-11-14T16:49:47Z", "type": "commit"}, {"oid": "db364b559e8d611c91d640184fcb633d1a98163a", "url": "https://github.com/ankidroid/Anki-Android/commit/db364b559e8d611c91d640184fcb633d1a98163a", "message": "NF: Extract onResetProgress\n\nuseful for testing", "committedDate": "2020-11-14T16:49:48Z", "type": "commit"}, {"oid": "cdadc7920b4572b813e9ffec8443f37ded16e845", "url": "https://github.com/ankidroid/Anki-Android/commit/cdadc7920b4572b813e9ffec8443f37ded16e845", "message": "NF: Extract resetProgressNoConfirm\n\nuseful for testing", "committedDate": "2020-11-14T16:49:49Z", "type": "commit"}, {"oid": "8b063ff4b2998dd4f2b25a0d546d35c776d42e1f", "url": "https://github.com/ankidroid/Anki-Android/commit/8b063ff4b2998dd4f2b25a0d546d35c776d42e1f", "message": "NF: checkCardsAtPositions - accept varargs\n\nSlightly cleans up the code", "committedDate": "2020-11-14T16:53:23Z", "type": "commit"}, {"oid": "408ef4c4cfa411e1db2036c531f4cd755422b6fa", "url": "https://github.com/ankidroid/Anki-Android/commit/408ef4c4cfa411e1db2036c531f4cd755422b6fa", "message": "Refresh Card Browser data on reposition\n\nData was stale\n\nReposition, reset and reschedule\n\nFixes 7674", "committedDate": "2020-11-14T16:53:24Z", "type": "commit"}, {"oid": "0e0821a04fc48664333d61ce02af17971db350e5", "url": "https://github.com/ankidroid/Anki-Android/commit/0e0821a04fc48664333d61ce02af17971db350e5", "message": "Show undo menu on reset, reposition and resched\n\nTests are sadly wonky under Robolectric\n\nFixes 7674", "committedDate": "2020-11-14T16:53:25Z", "type": "commit"}, {"oid": "f373ccac6587d861ddf3c81ab63bccea119efc2d", "url": "https://github.com/ankidroid/Anki-Android/commit/f373ccac6587d861ddf3c81ab63bccea119efc2d", "message": "BugFix: Undo - Ensure data in grid is updated\n\nCause: 23f9d804f22cb87af322c279db7804b943f8d503 (7535)\n\nDouble searches were cancelled\n\nFixes 7674", "committedDate": "2020-11-14T16:53:25Z", "type": "commit"}, {"oid": "f373ccac6587d861ddf3c81ab63bccea119efc2d", "url": "https://github.com/ankidroid/Anki-Android/commit/f373ccac6587d861ddf3c81ab63bccea119efc2d", "message": "BugFix: Undo - Ensure data in grid is updated\n\nCause: 23f9d804f22cb87af322c279db7804b943f8d503 (7535)\n\nDouble searches were cancelled\n\nFixes 7674", "committedDate": "2020-11-14T16:53:25Z", "type": "forcePushed"}]}