{"pr_number": 6604, "pr_title": "Enum case", "pr_createdAt": "2020-07-03T20:10:21Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6604", "timeline": [{"oid": "257d849671ecad8295460d445dab209eb3bfd71b", "url": "https://github.com/ankidroid/Anki-Android/commit/257d849671ecad8295460d445dab209eb3bfd71b", "message": "NF: Task type becomes an enum\n\nThe main reason is that, instead of having timber stating:\n\"interrupted while waiting for previous task: 23\", I'll gett\n\"interrupted while waiting for previous task:\nTASK_TYPE_UPDATE_VALUES_FROM_DECK\", and that will be really more readable", "committedDate": "2020-07-03T20:06:51Z", "type": "commit"}, {"oid": "adbd265a1d2a3c65df9c5efb3c0b8b82ded17c96", "url": "https://github.com/ankidroid/Anki-Android/commit/adbd265a1d2a3c65df9c5efb3c0b8b82ded17c96", "message": "NF: Remove TASK_TYPE from enum name\n\nThe type should now be sufficient to understand what we are dealing\nwith. Timber message gets simpler", "committedDate": "2020-07-03T20:06:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcxNTE2Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6604#discussion_r449715167", "bodyText": "Can you please define the integer values explicitly - I think we'll be fine here, but I've been burned a few times by someone adding enum values in the middle, or at the start, which changes all the values, and can lead to mismatches if they're persisted anywhere.", "author": "david-allison-1", "createdAt": "2020-07-03T22:44:05Z", "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -75,43 +75,45 @@\n  */\n public class CollectionTask extends BaseAsyncTask<CollectionTask.TaskData, CollectionTask.TaskData, CollectionTask.TaskData> {\n \n-    public static final int TASK_TYPE_SAVE_COLLECTION = 2;\n-    public static final int TASK_TYPE_ANSWER_CARD = 3;\n-    public static final int TASK_TYPE_ADD_NOTE = 6;\n-    public static final int TASK_TYPE_UPDATE_NOTE = 7;\n-    public static final int TASK_TYPE_UPDATE_NOTES_MULTI = 9;\n-    public static final int TASK_TYPE_UNDO = 8;\n-    public static final int TASK_TYPE_DISMISS = 11;\n-    public static final int TASK_TYPE_DISMISS_MULTI = 12;\n-    public static final int TASK_TYPE_CHECK_DATABASE = 14;\n-    public static final int TASK_TYPE_REPAIR_DECK = 20;\n-    public static final int TASK_TYPE_LOAD_DECK_COUNTS = 22;\n-    public static final int TASK_TYPE_UPDATE_VALUES_FROM_DECK = 23;\n-    public static final int TASK_TYPE_DELETE_DECK = 25;\n-    public static final int TASK_TYPE_REBUILD_CRAM = 26;\n-    public static final int TASK_TYPE_EMPTY_CRAM = 27;\n-    public static final int TASK_TYPE_IMPORT = 28;\n-    public static final int TASK_TYPE_IMPORT_REPLACE = 29;\n-    public static final int TASK_TYPE_SEARCH_CARDS = 30;\n-    public static final int TASK_TYPE_EXPORT_APKG = 31;\n-    public static final int TASK_TYPE_REORDER = 32;\n-    public static final int TASK_TYPE_CONF_CHANGE = 33;\n-    public static final int TASK_TYPE_CONF_RESET = 34;\n-    public static final int TASK_TYPE_CONF_REMOVE = 35;\n-    public static final int TASK_TYPE_CONF_SET_SUBDECKS = 36;\n-    public static final int TASK_TYPE_RENDER_BROWSER_QA = 37;\n-    public static final int TASK_TYPE_CHECK_MEDIA = 38;\n-    public static final int TASK_TYPE_ADD_TEMPLATE = 39;\n-    public static final int TASK_TYPE_REMOVE_TEMPLATE = 40;\n-    public static final int TASK_TYPE_COUNT_MODELS = 41;\n-    public static final int TASK_TYPE_DELETE_MODEL = 42;\n-    public static final int TASK_TYPE_DELETE_FIELD = 43;\n-    public static final int TASK_TYPE_REPOSITION_FIELD = 44;\n-    public static final int TASK_TYPE_ADD_FIELD = 45;\n-    public static final int TASK_TYPE_CHANGE_SORT_FIELD = 46;\n-    public static final int TASK_TYPE_SAVE_MODEL = 47;\n-    public static final int TASK_TYPE_FIND_EMPTY_CARDS = 48;\n-    public static final int TASK_TYPE_CHECK_CARD_SELECTION = 49;\n+    public enum TASK_TYPE {", "originalCommit": "adbd265a1d2a3c65df9c5efb3c0b8b82ded17c96", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "26999c981e4a1e6dcfc5ee31ba40b77d97d0890e", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java b/AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java\nindex 7718e7d4f..a7e496550 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java\n\n@@ -23,96 +23,52 @@ import android.content.res.Resources;\n import android.os.AsyncTask;\n \n import com.google.gson.stream.JsonReader;\n-import com.ichi2.anki.AnkiDroidApp;\n-import com.ichi2.anki.BackupManager;\n-import com.ichi2.anki.CardBrowser;\n-import com.ichi2.anki.CardUtils;\n-import com.ichi2.anki.CollectionHelper;\n-import com.ichi2.anki.R;\n-import com.ichi2.anki.TemporaryModel;\n-import com.ichi2.anki.exception.ConfirmModSchemaException;\n-import com.ichi2.anki.exception.ImportExportException;\n-import com.ichi2.libanki.WrongId;\n-import com.ichi2.libanki.sched.AbstractSched;\n-import com.ichi2.libanki.AnkiPackageExporter;\n-import com.ichi2.libanki.Card;\n-import com.ichi2.libanki.Collection;\n-import com.ichi2.libanki.Consts;\n-import com.ichi2.libanki.DB;\n-import com.ichi2.libanki.Decks;\n-import com.ichi2.libanki.Note;\n-import com.ichi2.libanki.Storage;\n-import com.ichi2.libanki.Utils;\n-import com.ichi2.libanki.importer.AnkiPackageImporter;\n-\n-import com.ichi2.utils.JSONArray;\n-import com.ichi2.utils.JSONException;\n-import com.ichi2.utils.JSONObject;\n-\n-import java.io.File;\n-import java.io.FileNotFoundException;\n-import java.io.FileReader;\n-import java.io.IOException;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.Collections;\n-import java.util.Comparator;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n-import java.util.TreeMap;\n-import java.util.concurrent.CancellationException;\n-import java.util.concurrent.ExecutionException;\n-import java.util.concurrent.TimeUnit;\n-import org.apache.commons.compress.archivers.zip.ZipFile;\n-\n-import androidx.annotation.Nullable;\n-import timber.log.Timber;\n-\n-/**\n- * Loading in the background, so that AnkiDroid does not look like frozen.\n- */\n-public class CollectionTask extends BaseAsyncTask<CollectionTask.TaskData, CollectionTask.TaskData, CollectionTask.TaskData> {\n-\n-    public enum TASK_TYPE {\n-        SAVE_COLLECTION,\n-        ANSWER_CARD,\n-        ADD_NOTE,\n-        UPDATE_NOTE,\n-        UPDATE_NOTES_MULTI,\n-        UNDO,\n-        DISMISS,\n-        DISMISS_MULTI,\n-        CHECK_DATABASE,\n-        REPAIR_DECK,\n-        LOAD_DECK_COUNTS,\n-        UPDATE_VALUES_FROM_DECK,\n-        DELETE_DECK,\n-        REBUILD_CRAM,\n-        EMPTY_CRAM,\n-        IMPORT,\n-        IMPORT_REPLACE,\n-        SEARCH_CARDS,\n-        EXPORT_APKG,\n-        REORDER,\n-        CONF_CHANGE,\n-        CONF_RESET,\n-        CONF_REMOVE,\n-        CONF_SET_SUBDECKS,\n-        RENDER_BROWSER_QA,\n-        CHECK_MEDIA,\n-        ADD_TEMPLATE,\n-        REMOVE_TEMPLATE,\n-        COUNT_MODELS,\n-        DELETE_MODEL,\n-        DELETE_FIELD,\n-        REPOSITION_FIELD,\n-        ADD_FIELD,\n-        CHANGE_SORT_FIELD,\n-        SAVE_MODEL,\n-        FIND_EMPTY_CARDS,\n-        CHECK_CARD_SELECTION,\n+        SAVE_COLLECTION(2),\n+        ANSWER_CARD(3),\n+        ADD_NOTE(6),\n+        UPDATE_NOTE(7),\n+        UPDATE_NOTES_MULTI(9),\n+        UNDO(8),\n+        DISMISS(11),\n+        DISMISS_MULTI(12),\n+        CHECK_DATABASE(14),\n+        REPAIR_DECK(20),\n+        LOAD_DECK_COUNTS(22),\n+        UPDATE_VALUES_FROM_DECK(23),\n+        DELETE_DECK(25),\n+        REBUILD_CRAM(26),\n+        EMPTY_CRAM(27),\n+        IMPORT(28),\n+        IMPORT_REPLACE(29),\n+        SEARCH_CARDS(30),\n+        EXPORT_APKG(31),\n+        REORDER(32),\n+        CONF_CHANGE(33),\n+        CONF_RESET(34),\n+        CONF_REMOVE(35),\n+        CONF_SET_SUBDECKS(36),\n+        RENDER_BROWSER_QA(37),\n+        CHECK_MEDIA(38),\n+        ADD_TEMPLATE(39),\n+        REMOVE_TEMPLATE(40),\n+        COUNT_MODELS(41),\n+        DELETE_MODEL(42),\n+        DELETE_FIELD(43),\n+        REPOSITION_FIELD(44),\n+        ADD_FIELD(45),\n+        CHANGE_SORT_FIELD(46),\n+        SAVE_MODEL(47),\n+        FIND_EMPTY_CARDS(48),\n+        CHECK_CARD_SELECTION(49);\n+        private int mValue;\n+\n+        private TASK_TYPE(int value) {\n+            this.mValue = value;\n+        }\n+\n+        public int getmValue() {\n+            return mValue;\n+        }\n     }\n \n     /**\n"}}, {"oid": "26999c981e4a1e6dcfc5ee31ba40b77d97d0890e", "url": "https://github.com/ankidroid/Anki-Android/commit/26999c981e4a1e6dcfc5ee31ba40b77d97d0890e", "message": "NF: Remove TASK_TYPE from enum name\n\nThe type should now be sufficient to understand what we are dealing\nwith. Timber message gets simpler", "committedDate": "2020-07-03T23:16:55Z", "type": "forcePushed"}, {"oid": "ed80647401956ddc475c0ab3dc03e3bf90cd5adb", "url": "https://github.com/ankidroid/Anki-Android/commit/ed80647401956ddc475c0ab3dc03e3bf90cd5adb", "message": "NF: Remove TASK_TYPE from enum name\n\nThe type should now be sufficient to understand what we are dealing\nwith. Timber message gets simpler", "committedDate": "2020-07-03T23:18:11Z", "type": "forcePushed"}, {"oid": "4285be98ddcdd0b982a70d6e26803981f01f0395", "url": "https://github.com/ankidroid/Anki-Android/commit/4285be98ddcdd0b982a70d6e26803981f01f0395", "message": "NF: Remove TASK_TYPE from enum name\n\nThe type should now be sufficient to understand what we are dealing\nwith. Timber message gets simpler", "committedDate": "2020-07-03T23:19:05Z", "type": "forcePushed"}, {"oid": "adbd265a1d2a3c65df9c5efb3c0b8b82ded17c96", "url": "https://github.com/ankidroid/Anki-Android/commit/adbd265a1d2a3c65df9c5efb3c0b8b82ded17c96", "message": "NF: Remove TASK_TYPE from enum name\n\nThe type should now be sufficient to understand what we are dealing\nwith. Timber message gets simpler", "committedDate": "2020-07-03T20:06:55Z", "type": "forcePushed"}]}