{"pr_number": 6247, "pr_title": "Tex instead of error", "pr_createdAt": "2020-05-22T09:41:35Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6247", "timeline": [{"oid": "f563c089000c6a8528af9ec4dfd35b969f091359", "url": "https://github.com/ankidroid/Anki-Android/commit/f563c089000c6a8528af9ec4dfd35b969f091359", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code.", "committedDate": "2020-05-22T09:41:52Z", "type": "forcePushed"}, {"oid": "d68a685fd058afc98591d94caf91c49ae3af26b1", "url": "https://github.com/ankidroid/Anki-Android/commit/d68a685fd058afc98591d94caf91c49ae3af26b1", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code.", "committedDate": "2020-05-22T09:42:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2ODQ3Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#discussion_r429168477", "bodyText": "Maybe: \n  \n    \n      Anki-Android/AnkiDroid/src/main/java/com/ichi2/libanki/Media.java\n    \n    \n        Lines 531 to 533\n      in\n      4740941\n    \n    \n    \n    \n\n        \n          \n           public boolean have(String fname) { \n        \n\n        \n          \n               return new File(dir(), fname).exists(); \n        \n\n        \n          \n           }", "author": "david-allison-1", "createdAt": "2020-05-22T10:28:16Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java", "diffHunk": "@@ -96,7 +97,11 @@ private static String _imgLink(String latex, JSONObject model) {\n         }\n \n         String fname = \"latex-\" + Utils.checksum(txt) + \".\" + ext;\n-        return \"<img class=latex src=\\\"\" + fname + \"\\\">\";\n+        if (new File(col.getMedia().dir(), fname).exists()) {", "originalCommit": "d68a685fd058afc98591d94caf91c49ae3af26b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQwNTAxMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#discussion_r429405010", "bodyText": "Ooups. I should have looked for this before reimplementing it. Sorry", "author": "Arthur-Milchior", "createdAt": "2020-05-22T18:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2ODQ3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java b/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java\nindex fab9f3654..ff2207f26 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java\n\n@@ -97,7 +97,7 @@ public class LaTeX {\n         }\n \n         String fname = \"latex-\" + Utils.checksum(txt) + \".\" + ext;\n-        if (new File(col.getMedia().dir(), fname).exists()) {\n+        if (m.have(fname)) {\n             return \"<img class=latex src=\\\"\" + fname + \"\\\">\";\n         } else {\n             return Matcher.quoteReplacement(latex);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2OTE4Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#discussion_r429169182", "bodyText": "Nit: Could you pass in Media here to reduce the API surface area", "author": "david-allison-1", "createdAt": "2020-05-22T10:29:52Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java", "diffHunk": "@@ -87,7 +88,7 @@ public static String mungeQA(String html, Collection col, JSONObject model) {\n     /**\n      * Return an img link for LATEX.\n      */\n-    private static String _imgLink(String latex, JSONObject model) {\n+    private static String _imgLink(String latex, JSONObject model, Collection col) {", "originalCommit": "d68a685fd058afc98591d94caf91c49ae3af26b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQwNTYzMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#discussion_r429405632", "bodyText": "okay", "author": "Arthur-Milchior", "createdAt": "2020-05-22T18:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2OTE4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java b/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java\nindex fab9f3654..ff2207f26 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java\n\n@@ -88,7 +88,7 @@ public class LaTeX {\n     /**\n      * Return an img link for LATEX.\n      */\n-    private static String _imgLink(String latex, JSONObject model, Collection col) {\n+    private static String _imgLink(String latex, JSONObject model, Media m) {\n         String txt = _latexFromHtml(latex);\n \n         String ext = \"png\";\n"}}, {"oid": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "url": "https://github.com/ankidroid/Anki-Android/commit/cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code.", "committedDate": "2020-05-22T19:05:33Z", "type": "commit"}, {"oid": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "url": "https://github.com/ankidroid/Anki-Android/commit/cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code.", "committedDate": "2020-05-22T19:05:33Z", "type": "forcePushed"}]}