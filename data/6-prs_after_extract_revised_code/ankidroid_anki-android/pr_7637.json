{"pr_number": 7637, "pr_title": "Json array >list", "pr_createdAt": "2020-11-09T17:39:07Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7637", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMzQzOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7637#discussion_r520003439", "bodyText": "I don't understand this, could you provide an example in the JavaDoc", "author": "david-allison-1", "createdAt": "2020-11-09T17:49:28Z", "path": "AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java", "diffHunk": "@@ -384,4 +386,40 @@ public Long next() {\n             }\n         };\n     }\n+\n+    public List<JSONObject> toJSONObjectList() {\n+        List<JSONObject> l = new ArrayList<>(length());\n+        for (JSONObject object : jsonObjectIterable()) {\n+            l.add(object);\n+        }\n+        return l;\n+    }\n+\n+    public List<Long> toLongList() {\n+        List<Long> l = new ArrayList<>(length());\n+        for (Long object : longIterable()) {\n+            l.add(object);\n+        }\n+        return l;\n+    }\n+\n+    public List<String> toStringList() {\n+        List<String> l = new ArrayList<>(length());\n+        for (String object : stringIterable()) {\n+            l.add(object);\n+        }\n+        return l;\n+    }\n+\n+\n+    /**\n+     * @return Given an array of object with names, get the names\n+     */\n+    public List<String> toNames() {", "originalCommit": "4b5d59d870ea5c6bd2e245197f19698a6ce6f71c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7274060ab7344269e7c94d8bcdbd094320f72850", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java b/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java\nindex c82cc362c..f938198e9 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java\n\n@@ -410,16 +410,4 @@ public class JSONArray extends org.json.JSONArray {\n         }\n         return l;\n     }\n-\n-\n-    /**\n-     * @return Given an array of object with names, get the names\n-     */\n-    public List<String> toNames() {\n-        List<String> l = new ArrayList<>(length());\n-        for (JSONObject object : jsonObjectIterable()) {\n-            l.add(object.getString(\"key\"));\n-        }\n-        return l;\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNDk2Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7637#discussion_r520004967", "bodyText": "? I don't think this is the same - needs regression cover either way.", "author": "david-allison-1", "createdAt": "2020-11-09T17:51:57Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1866,14 +1863,10 @@ public CheckDatabaseResult fixIntegrity(CollectionTask.ProgressCallback progress\n         ArrayList<String> problems = new ArrayList<>();\n         notifyProgress.run();\n         if (m.getInt(\"type\") == Consts.MODEL_STD) {\n-            ArrayList<Integer> ords = new ArrayList<>();\n             JSONArray tmpls = m.getJSONArray(\"tmpls\");\n-            for (JSONObject tmpl: tmpls.jsonObjectIterable()) {\n-                ords.add(tmpl.getInt(\"ord\"));\n-            }\n             // cards with invalid ordinal\n             ArrayList<Long> ids = mDb.queryLongList(\n-                    \"SELECT id FROM cards WHERE ord NOT IN \" + Utils.ids2str(ords) + \" AND nid IN ( \" +\n+                    \"SELECT id FROM cards WHERE ord NOT IN \" + Utils.ids2str(tmpls) + \" AND nid IN ( \" +", "originalCommit": "4b5d59d870ea5c6bd2e245197f19698a6ce6f71c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7274060ab7344269e7c94d8bcdbd094320f72850", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java b/AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java\nindex 82581ad6b..f80becb60 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java\n\n@@ -1863,10 +1863,14 @@ public class Collection {\n         ArrayList<String> problems = new ArrayList<>();\n         notifyProgress.run();\n         if (m.getInt(\"type\") == Consts.MODEL_STD) {\n+            ArrayList<Integer> ords = new ArrayList<>();\n             JSONArray tmpls = m.getJSONArray(\"tmpls\");\n+            for (JSONObject tmpl: tmpls.jsonObjectIterable()) {\n+                ords.add(tmpl.getInt(\"ord\"));\n+            }\n             // cards with invalid ordinal\n             ArrayList<Long> ids = mDb.queryLongList(\n-                    \"SELECT id FROM cards WHERE ord NOT IN \" + Utils.ids2str(tmpls) + \" AND nid IN ( \" +\n+                    \"SELECT id FROM cards WHERE ord NOT IN \" + Utils.ids2str(ords) + \" AND nid IN ( \" +\n                             \"SELECT id FROM notes WHERE mid = ?)\", m.getLong(\"id\"));\n             if (ids.size() > 0) {\n                 problems.add(\"Deleted \" + ids.size() + \" card(s) with missing template.\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNTYwMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7637#discussion_r520005601", "bodyText": "shouldn't this be \"name\"?\nRegardless, I feel this method is more complex than the previous code, and would be better reverted.", "author": "david-allison-1", "createdAt": "2020-11-09T17:52:56Z", "path": "AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java", "diffHunk": "@@ -384,4 +386,40 @@ public Long next() {\n             }\n         };\n     }\n+\n+    public List<JSONObject> toJSONObjectList() {\n+        List<JSONObject> l = new ArrayList<>(length());\n+        for (JSONObject object : jsonObjectIterable()) {\n+            l.add(object);\n+        }\n+        return l;\n+    }\n+\n+    public List<Long> toLongList() {\n+        List<Long> l = new ArrayList<>(length());\n+        for (Long object : longIterable()) {\n+            l.add(object);\n+        }\n+        return l;\n+    }\n+\n+    public List<String> toStringList() {\n+        List<String> l = new ArrayList<>(length());\n+        for (String object : stringIterable()) {\n+            l.add(object);\n+        }\n+        return l;\n+    }\n+\n+\n+    /**\n+     * @return Given an array of object with names, get the names\n+     */\n+    public List<String> toNames() {\n+        List<String> l = new ArrayList<>(length());\n+        for (JSONObject object : jsonObjectIterable()) {\n+            l.add(object.getString(\"key\"));", "originalCommit": "4b5d59d870ea5c6bd2e245197f19698a6ce6f71c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwODM1NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/7637#discussion_r520008354", "bodyText": "did you see the remaining of the changes of the last commit ?  Because the remaining seems nicer to me.\nOf course, the comment may need to be more clear", "author": "Arthur-Milchior", "createdAt": "2020-11-09T17:57:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNTYwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxMDM1Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7637#discussion_r520010352", "bodyText": "I initially thought about doing it simply with\ngetStringList(String key)\nto get the list of values (assumed to be string) of those objects. And then I realized that it only uses \"name\", so I removed the argument", "author": "Arthur-Milchior", "createdAt": "2020-11-09T18:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNTYwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzE0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7637#discussion_r520023142", "bodyText": "I'd be happier with getStringList(String key), but I (slightly) think it's over-abstracted in general", "author": "david-allison-1", "createdAt": "2020-11-09T18:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNTYwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "7274060ab7344269e7c94d8bcdbd094320f72850", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java b/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java\nindex c82cc362c..f938198e9 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/utils/JSONArray.java\n\n@@ -410,16 +410,4 @@ public class JSONArray extends org.json.JSONArray {\n         }\n         return l;\n     }\n-\n-\n-    /**\n-     * @return Given an array of object with names, get the names\n-     */\n-    public List<String> toNames() {\n-        List<String> l = new ArrayList<>(length());\n-        for (JSONObject object : jsonObjectIterable()) {\n-            l.add(object.getString(\"key\"));\n-        }\n-        return l;\n-    }\n }\n"}}, {"oid": "7274060ab7344269e7c94d8bcdbd094320f72850", "url": "https://github.com/ankidroid/Anki-Android/commit/7274060ab7344269e7c94d8bcdbd094320f72850", "message": "NF: array to typed list", "committedDate": "2020-11-09T17:58:48Z", "type": "commit"}, {"oid": "280d287e7bde01a8f181830362f3d7d8409ebfc1", "url": "https://github.com/ankidroid/Anki-Android/commit/280d287e7bde01a8f181830362f3d7d8409ebfc1", "message": "NF: JSONArray -> names", "committedDate": "2020-11-09T17:58:49Z", "type": "forcePushed"}, {"oid": "7274060ab7344269e7c94d8bcdbd094320f72850", "url": "https://github.com/ankidroid/Anki-Android/commit/7274060ab7344269e7c94d8bcdbd094320f72850", "message": "NF: array to typed list", "committedDate": "2020-11-09T17:58:48Z", "type": "forcePushed"}]}