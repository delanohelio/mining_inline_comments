{"pr_number": 6421, "pr_title": "Add Missing Statistics Data to Overview ", "pr_createdAt": "2020-06-09T19:41:08Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6421", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MjUyMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437692522", "bodyText": "magic number 2?", "author": "mikehardy", "createdAt": "2020-06-09T20:17:03Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java", "diffHunk": "@@ -1053,6 +1075,47 @@ public boolean calculateAnswerButtons(AxisType type) {\n         mValueLabels = new int[] { R.string.statistics_learn, R.string.statistics_young, R.string.statistics_mature};\n         mColors = new int[] { R.attr.stats_learn, R.attr.stats_young, R.attr.stats_mature};\n         mType = type;\n+        ArrayList<double[]> list = eases(type);\n+\n+        //TODO adjust for AnswerButton, for now only copied from intervals\n+        // small adjustment for a proper chartbuilding with achartengine\n+        if (list.size() == 0) {\n+            list.add(0, new double[]{0, 1, 0});\n+        }\n+\n+        mSeriesList = new double[4][list.size()+1];\n+\n+        for (int i = 0; i < list.size(); i++) {\n+            double[] data = list.get(i);\n+            int currentType = (int)data[0];\n+            double ease = data[1];\n+            double cnt = data[2];\n+\n+            if (currentType == Consts.CARD_TYPE_LRN) {\n+                ease += 5;\n+            } else if (currentType == 2) {", "originalCommit": "0739ebe710da8f375c7dff3165dde3ec1a97cb68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5NjM2OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437696369", "bodyText": "Extracted method - not my code", "author": "david-allison-1", "createdAt": "2020-06-09T20:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MjUyMg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5Mjk1MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437692951", "bodyText": "magic number 1? (I think that 1 should be a Const)", "author": "mikehardy", "createdAt": "2020-06-09T20:17:54Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java", "diffHunk": "@@ -302,8 +302,30 @@ public void calculateOverviewStatistics(AxisType timespan, OverviewStatsBuilder.\n \n         oStats.totalNewCards = getNewCards(timespan);\n         oStats.newCardsPerDay = (double) oStats.totalNewCards / (double) oStats.allDays;\n+\n+        ArrayList<double[]> list = eases(timespan);\n+        oStats.newCardsOverview = toOverview(0, list);\n+        oStats.youngCardsOverview = toOverview(1, list);\n+        oStats.matureCardsOverview = toOverview(2, list);\n     }\n \n+\n+    private OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview toOverview(int type, ArrayList<double[]> list) {\n+        OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview answerButtonsOverview = new OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview();\n+\n+        //type, ease, count\n+        for (double[] elements : list) {\n+            if (elements[0] != type) {\n+                continue;\n+            }\n+            answerButtonsOverview.total += elements[2];\n+            answerButtonsOverview.correct += elements[1] == 1 ? 0 : elements[2];", "originalCommit": "0739ebe710da8f375c7dff3165dde3ec1a97cb68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5NjQ3Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437696472", "bodyText": "This is my code! I can't turn it into a class, but I'll magic it up", "author": "david-allison-1", "createdAt": "2020-06-09T20:24:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5Mjk1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "3286ad3d2d373e0002156174ee00cf3ab184220a", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java b/AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java\nindex 3ebc2b2570..02efc264f9 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java\n\n@@ -310,16 +311,26 @@ public class Stats {\n     }\n \n \n-    private OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview toOverview(int type, ArrayList<double[]> list) {\n-        OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview answerButtonsOverview = new OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview();\n+    private AnswerButtonsOverview toOverview(int type, ArrayList<double[]> list) {\n+        AnswerButtonsOverview answerButtonsOverview = new AnswerButtonsOverview();\n+\n+        final int INDEX_TYPE = 0; //0:learn; 1:young; 2:mature\n+        final int INDEX_EASE = 1; //1...4 - AGAIN - EASY\n+        final int INDEX_COUNT = 2;\n+\n+        final double EASE_AGAIN = 1d;\n \n-        //type, ease, count\n         for (double[] elements : list) {\n-            if (elements[0] != type) {\n+            //if we're not of the type we're looking for, continue\n+            if (elements[INDEX_TYPE] != type) {\n                 continue;\n             }\n-            answerButtonsOverview.total += elements[2];\n-            answerButtonsOverview.correct += elements[1] == 1 ? 0 : elements[2];\n+\n+            double answersCountForTypeAndEase = elements[INDEX_COUNT];\n+            boolean isAgain = elements[INDEX_EASE] == EASE_AGAIN;\n+\n+            answerButtonsOverview.total += answersCountForTypeAndEase;\n+            answerButtonsOverview.correct += isAgain ? 0 : answersCountForTypeAndEase;\n         }\n \n         return answerButtonsOverview;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MzUyNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437693527", "bodyText": "I think this default empty thing is also a 0, 1, 0 of magic instead of const?", "author": "mikehardy", "createdAt": "2020-06-09T20:19:06Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java", "diffHunk": "@@ -1053,6 +1075,47 @@ public boolean calculateAnswerButtons(AxisType type) {\n         mValueLabels = new int[] { R.string.statistics_learn, R.string.statistics_young, R.string.statistics_mature};\n         mColors = new int[] { R.attr.stats_learn, R.attr.stats_young, R.attr.stats_mature};\n         mType = type;\n+        ArrayList<double[]> list = eases(type);\n+\n+        //TODO adjust for AnswerButton, for now only copied from intervals\n+        // small adjustment for a proper chartbuilding with achartengine\n+        if (list.size() == 0) {\n+            list.add(0, new double[]{0, 1, 0});", "originalCommit": "0739ebe710da8f375c7dff3165dde3ec1a97cb68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5NjYwMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437696602", "bodyText": "Not my code change, just extracted", "author": "david-allison-1", "createdAt": "2020-06-09T20:24:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MzUyNw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "3286ad3d2d373e0002156174ee00cf3ab184220a", "url": "https://github.com/ankidroid/Anki-Android/commit/3286ad3d2d373e0002156174ee00cf3ab184220a", "message": "Statistics: Add \"Answer Buttons\" to Overview\n\nFixes 4326\nImproves 5266", "committedDate": "2020-06-09T21:25:43Z", "type": "commit"}, {"oid": "b06de61dd04e0e43714cfb6f64744789df079d2f", "url": "https://github.com/ankidroid/Anki-Android/commit/b06de61dd04e0e43714cfb6f64744789df079d2f", "message": "Statistics: Add \"Total Time\" to Overview\n\nImproves 5266", "committedDate": "2020-06-09T21:25:53Z", "type": "commit"}, {"oid": "429afec7d97ad2f55644c6d08d29e129c3bf59d5", "url": "https://github.com/ankidroid/Anki-Android/commit/429afec7d97ad2f55644c6d08d29e129c3bf59d5", "message": "Statistics: Add \"Average Answer Time\" to Overview\n\nImproves 5266", "committedDate": "2020-06-09T21:25:53Z", "type": "commit"}, {"oid": "eacea4fb9b48fa8457e7d686b7280c473e746b42", "url": "https://github.com/ankidroid/Anki-Android/commit/eacea4fb9b48fa8457e7d686b7280c473e746b42", "message": "Statistics: Add \"Total Card/Notes\" to Overview\n\nImproves 5266", "committedDate": "2020-06-09T21:25:54Z", "type": "commit"}, {"oid": "bae815ed7e09f308b18929ea30359b50da7277d7", "url": "https://github.com/ankidroid/Anki-Android/commit/bae815ed7e09f308b18929ea30359b50da7277d7", "message": "Statistics: Add \"Low/Avg/Hi Ease\" to Overview\n\nFinishes 5266", "committedDate": "2020-06-09T21:25:54Z", "type": "commit"}, {"oid": "bae815ed7e09f308b18929ea30359b50da7277d7", "url": "https://github.com/ankidroid/Anki-Android/commit/bae815ed7e09f308b18929ea30359b50da7277d7", "message": "Statistics: Add \"Low/Avg/Hi Ease\" to Overview\n\nFinishes 5266", "committedDate": "2020-06-09T21:25:54Z", "type": "forcePushed"}]}