{"pr_number": 6031, "pr_title": "handleDeckSelection uses a function for cards in learning instead of reset", "pr_createdAt": "2020-04-16T16:04:50Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6031", "timeline": [{"oid": "9dbd1b6b09b17ac53c0699182ebc3e4142a774c7", "url": "https://github.com/ankidroid/Anki-Android/commit/9dbd1b6b09b17ac53c0699182ebc3e4142a774c7", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study.", "committedDate": "2020-04-16T15:50:28Z", "type": "forcePushed"}, {"oid": "2010c19a13c1630bfaf2cff66ad054ace3210a35", "url": "https://github.com/ankidroid/Anki-Android/commit/2010c19a13c1630bfaf2cff66ad054ace3210a35", "message": "Prepare next card for reviewer in background", "committedDate": "2020-04-17T17:56:14Z", "type": "forcePushed"}, {"oid": "9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "url": "https://github.com/ankidroid/Anki-Android/commit/9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study.", "committedDate": "2020-04-17T18:05:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU0MjAyMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6031#discussion_r436542022", "bodyText": "Maybe: hasCardsTodayAfterStudyAheadLimit", "author": "david-allison-1", "createdAt": "2020-06-08T08:44:48Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -2009,9 +2009,7 @@ private void handleDeckSelection(long did, boolean dontSkipStudyOptions) {\n             }\n             return;\n         }\n-        getCol().getSched().reset();\n-        int[] studyOptionsCounts = getCol().getSched().counts();\n-        if (studyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0) {\n+        if (getCol().getSched().lrnDueFromToday()) {", "originalCommit": "9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYzNzc4Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6031#discussion_r436637787", "bodyText": "Seems a little strange, as the name describe why we use it and not what it does, but that's fine with me.", "author": "Arthur-Milchior", "createdAt": "2020-06-08T11:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU0MjAyMg=="}], "type": "inlineReview", "revised_code": {"commit": "f522f80ed448dba22c4979ea1ad2b0ca578ff45b", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java b/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java\nindex 6f4a27c6a..01bb2cb10 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java\n\n@@ -2009,7 +2051,9 @@ public class DeckPicker extends NavigationDrawerActivity implements\n             }\n             return;\n         }\n-        if (getCol().getSched().lrnDueFromToday()) {\n+        getCol().getSched().reset();\n+        int[] studyOptionsCounts = getCol().getSched().counts();\n+        if (studyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0) {\n             // If there are cards due that can't be studied yet (due to the learn ahead limit) then go to study options\n             openStudyOptions(false);\n         } else if (getCol().getSched().newDue() || getCol().getSched().revDue()) {\n"}}, {"oid": "f522f80ed448dba22c4979ea1ad2b0ca578ff45b", "url": "https://github.com/ankidroid/Anki-Android/commit/f522f80ed448dba22c4979ea1ad2b0ca578ff45b", "message": "lrnDueFromToday\n\nThis method allows to check whether a card in learning will be due\ntoday; it avoids to reset entirely the deck, and so allows to decide\nquickly what action should be done when a deck is selected and no\ncards can be seen immediatly.", "committedDate": "2020-06-08T11:49:55Z", "type": "commit"}, {"oid": "4e058c53524dc2e5b1dba889284412d918249f93", "url": "https://github.com/ankidroid/Anki-Android/commit/4e058c53524dc2e5b1dba889284412d918249f93", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study.", "committedDate": "2020-06-08T11:50:07Z", "type": "commit"}, {"oid": "4e058c53524dc2e5b1dba889284412d918249f93", "url": "https://github.com/ankidroid/Anki-Android/commit/4e058c53524dc2e5b1dba889284412d918249f93", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study.", "committedDate": "2020-06-08T11:50:07Z", "type": "forcePushed"}]}