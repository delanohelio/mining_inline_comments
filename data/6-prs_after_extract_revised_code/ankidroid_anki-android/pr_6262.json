{"pr_number": 6262, "pr_title": "Remove unnecessary version code checks", "pr_createdAt": "2020-05-23T18:17:14Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6262", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODUwMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429568500", "bodyText": "Can we remove this preference entirely?", "author": "david-allison-1", "createdAt": "2020-05-23T18:37:15Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -886,9 +886,7 @@ private void removeUnnecessaryAdvancedPrefs(PreferenceScreen screen) {\n             CheckBoxPreference fixHebrewText = (CheckBoxPreference) screen.findPreference(\"fixHebrewText\");\n             CompatHelper.removeHiddenPreferences(this.getApplicationContext());\n \n-            if (CompatHelper.getSdkVersion() >= 16) {\n-                workarounds.removePreference(fixHebrewText);\n-            }\n+            workarounds.removePreference(fixHebrewText);", "originalCommit": "e4c5317bda2e9608858591da7a45eb65a04db13b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MzQ5NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429573494", "bodyText": "Yes, it can be done. Should I remove related strings (like description) too?", "author": "RSBat", "createdAt": "2020-05-23T19:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NDI3NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429574275", "bodyText": "Yep! No point in burdening our translators with strings that people will never see.", "author": "david-allison-1", "createdAt": "2020-05-23T20:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3ODA0OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429578048", "bodyText": "done", "author": "RSBat", "createdAt": "2020-05-23T21:01:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODUwMA=="}], "type": "inlineReview", "revised_code": {"commit": "6347d6690decec4024771b8e18afa9466165d9b4", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java b/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java\nindex a676b8753..8a49983a6 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java\n\n@@ -880,14 +847,6 @@ public class Preferences extends AppCompatPreferenceActivity implements Preferen\n                 plugins.removePreference(doubleScrolling);\n             }\n         }\n-\n-        PreferenceCategory workarounds = (PreferenceCategory) screen.findPreference(\"category_workarounds\");\n-        if (workarounds != null) {\n-            CheckBoxPreference fixHebrewText = (CheckBoxPreference) screen.findPreference(\"fixHebrewText\");\n-            CompatHelper.removeHiddenPreferences(this.getApplicationContext());\n-\n-            workarounds.removePreference(fixHebrewText);\n-        }\n     }\n \n \n"}}, {"oid": "c1aeffe765834b32341874ea57a27b3687205a36", "url": "https://github.com/ankidroid/Anki-Android/commit/c1aeffe765834b32341874ea57a27b3687205a36", "message": "Remove unnecessary version code checks\n\nSince minSdkVersion was bumped to 16 (Jelly Bean) all these checks are\nnow constant and can be simplified", "committedDate": "2020-05-23T19:48:59Z", "type": "commit"}, {"oid": "c1aeffe765834b32341874ea57a27b3687205a36", "url": "https://github.com/ankidroid/Anki-Android/commit/c1aeffe765834b32341874ea57a27b3687205a36", "message": "Remove unnecessary version code checks\n\nSince minSdkVersion was bumped to 16 (Jelly Bean) all these checks are\nnow constant and can be simplified", "committedDate": "2020-05-23T19:48:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NDQ1OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429574458", "bodyText": "Sorry about the mess, thank you!", "author": "david-allison-1", "createdAt": "2020-05-23T20:06:57Z", "path": "AnkiDroid/src/test/java/com/ichi2/compat/customtabs/CustomTabActivityHelperTest.java", "diffHunk": "@@ -58,7 +68,13 @@ public void invalidClientMeansFallbackIsCalled() {\n         customTabActivityHelper.onServiceConnected(badClient);\n \n         CustomTabActivityHelper.CustomTabFallback fallback = mock(CustomTabActivityHelper.CustomTabFallback.class);\n-        CustomTabActivityHelper.openCustomTab(null, null, null, fallback);\n+        Activity activity = mock(Activity.class);", "originalCommit": "c1aeffe765834b32341874ea57a27b3687205a36", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NTgzMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429575830", "bodyText": "should get rid of this at the same time I think since it is going away completely", "author": "mikehardy", "createdAt": "2020-05-23T20:27:36Z", "path": "AnkiDroid/src/main/java/com/ichi2/compat/CompatHelper.java", "diffHunk": "@@ -96,8 +96,6 @@ public static boolean hasScrollKeys() {\n \n     public static void removeHiddenPreferences(Context context) {\n         SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);\n-        if (getSdkVersion() >= 16) {\n-            preferences.edit().remove(\"fixHebrewText\").apply();\n-        }\n+        preferences.edit().remove(\"fixHebrewText\").apply();", "originalCommit": "c1aeffe765834b32341874ea57a27b3687205a36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3ODAzMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429578032", "bodyText": "done", "author": "RSBat", "createdAt": "2020-05-23T21:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NTgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "6347d6690decec4024771b8e18afa9466165d9b4", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/compat/CompatHelper.java b/AnkiDroid/src/main/java/com/ichi2/compat/CompatHelper.java\nindex e5be0beb3..de024ebc1 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/compat/CompatHelper.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/compat/CompatHelper.java\n\n@@ -93,9 +90,4 @@ public class CompatHelper {\n     public static boolean hasScrollKeys() {\n         return KeyCharacterMap.deviceHasKey(92) || KeyCharacterMap.deviceHasKey(93);\n     }\n-\n-    public static void removeHiddenPreferences(Context context) {\n-        SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);\n-        preferences.edit().remove(\"fixHebrewText\").apply();\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NTg2Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429575866", "bodyText": "This is unrelated to the PR. I'm not against the change but PRs in general should stay focused on a single purpose", "author": "mikehardy", "createdAt": "2020-05-23T20:28:08Z", "path": "AnkiDroid/src/main/java/com/ichi2/compat/customtabs/CustomTabActivityHelper.java", "diffHunk": "@@ -51,7 +52,7 @@\n      * @param uri the Uri to be opened.\n      * @param fallback a CustomTabFallback to be used if Custom Tabs is not available.\n      */\n-    public static void openCustomTab(Activity activity,\n+    public static void openCustomTab(@NonNull Activity activity,", "originalCommit": "c1aeffe765834b32341874ea57a27b3687205a36", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "6347d6690decec4024771b8e18afa9466165d9b4", "url": "https://github.com/ankidroid/Anki-Android/commit/6347d6690decec4024771b8e18afa9466165d9b4", "message": "Remove \"Hebrew fix\" preference\n\nThis preference was not shown on api >= 16. Now minSdkVersion is 16\nso it will never be shown and can be safely removed.", "committedDate": "2020-05-23T21:07:22Z", "type": "forcePushed"}, {"oid": "514c15959fc9d1767318103473e981b084487746", "url": "https://github.com/ankidroid/Anki-Android/commit/514c15959fc9d1767318103473e981b084487746", "message": "Remove \"Hebrew fix\" preference\n\nThis preference was not shown on api >= 16. Now minSdkVersion is 16\nso it will never be shown and can be safely removed.", "committedDate": "2020-05-23T21:37:22Z", "type": "commit"}, {"oid": "514c15959fc9d1767318103473e981b084487746", "url": "https://github.com/ankidroid/Anki-Android/commit/514c15959fc9d1767318103473e981b084487746", "message": "Remove \"Hebrew fix\" preference\n\nThis preference was not shown on api >= 16. Now minSdkVersion is 16\nso it will never be shown and can be safely removed.", "committedDate": "2020-05-23T21:37:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MTkwMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429581900", "bodyText": "Just a note for @Arthur-Milchior if you are working on Hooks that the HebreFixFilter hook is going away in this PR, it is dropped as no longer needed now that we are minSdkVersion of API16 for Android from #5665", "author": "mikehardy", "createdAt": "2020-05-23T22:07:38Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/hooks/Hooks.java", "diffHunk": "@@ -53,9 +53,6 @@ private Hooks(Context context) {\n         new Leech().installHook(this);\n \n         // Preferences activated hooks\n-        if (prefs.getBoolean(\"fixHebrewText\", false)) {\n-            HebrewFixFilter.install(this);", "originalCommit": "514c15959fc9d1767318103473e981b084487746", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4NTA3Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429585076", "bodyText": "I'm working on top of master, so if this disappear quickly, I would probably notice it soon. I'll thus consider this hook last.", "author": "Arthur-Milchior", "createdAt": "2020-05-23T23:12:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MTkwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4NTMxNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6262#discussion_r429585316", "bodyText": "@Arthur-Milchior merged just now - no more HebrewFixFilter on master", "author": "mikehardy", "createdAt": "2020-05-23T23:17:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MTkwMA=="}], "type": "inlineReview", "revised_code": null}]}