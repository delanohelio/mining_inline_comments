{"pr_number": 6451, "pr_title": "Save whiteboard while reviewing ", "pr_createdAt": "2020-06-13T10:49:43Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6451", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczMDIyNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439730224", "bodyText": "Pass in the exception first and Timber will nicely format it.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Timber.e(\"Whiteboard image saving failed %s\", e.toString());\n          \n          \n            \n                        Timber.e(e, \"Whiteboard image saving failed\");", "author": "david-allison-1", "createdAt": "2020-06-13T10:58:10Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +391,31 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void saveWhiteboard() {\n+        Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n+        String finalFileName = baseFileName + newName;\n+        File saveImgFile = new File(currentAnkiDroidDirectory, finalFileName);\n+\n+        if (isInNightMode()) {\n+            canvas.drawColor(Color.BLACK);\n+        } else {\n+            canvas.drawColor(Color.WHITE);\n+        }\n+\n+        try {\n+            mWhiteboard.draw(canvas);\n+            bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveImgFile));\n+        } catch (FileNotFoundException e) {\n+            Timber.e(\"Whiteboard image saving failed %s\", e.toString());", "originalCommit": "34b372df4eb840374f04728e4808057e430e4379", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 69c886800..25828a693 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -392,15 +417,23 @@ public class Reviewer extends AbstractFlashcardViewer {\n     }\n \n \n-    private void saveWhiteboard() {\n+\n+    private void saveWhiteboardInternal() {\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n-        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n         String baseFileName = \"Whiteboard\";\n         String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n         String finalFileName = baseFileName + newName;\n-        File saveImgFile = new File(currentAnkiDroidDirectory, finalFileName);\n+\n+        File saveImgFile = new File(ankiDroidFolder, finalFileName);\n \n         if (isInNightMode()) {\n             canvas.drawColor(Color.BLACK);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczMDI3Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439730276", "bodyText": "Could you rename this to saveWhiteboardInternal, and have saveWhiteboard call it inside a try..catch. Remove the catch IOException from saveWhiteboardInternal\nWe need to show a toast to users if this fails.", "author": "david-allison-1", "createdAt": "2020-06-13T10:59:30Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +391,31 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void saveWhiteboard() {", "originalCommit": "34b372df4eb840374f04728e4808057e430e4379", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 69c886800..25828a693 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -392,15 +417,23 @@ public class Reviewer extends AbstractFlashcardViewer {\n     }\n \n \n-    private void saveWhiteboard() {\n+\n+    private void saveWhiteboardInternal() {\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n-        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n         String baseFileName = \"Whiteboard\";\n         String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n         String finalFileName = baseFileName + newName;\n-        File saveImgFile = new File(currentAnkiDroidDirectory, finalFileName);\n+\n+        File saveImgFile = new File(ankiDroidFolder, finalFileName);\n \n         if (isInNightMode()) {\n             canvas.drawColor(Color.BLACK);\n"}}, {"oid": "34b372df4eb840374f04728e4808057e430e4379", "url": "https://github.com/ankidroid/Anki-Android/commit/34b372df4eb840374f04728e4808057e430e4379", "message": "\tSave whiteboard", "committedDate": "2020-06-13T10:34:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzU0NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737544", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);\n          \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()), true);", "author": "david-allison-1", "createdAt": "2020-06-13T12:59:46Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -316,7 +318,11 @@ public boolean onOptionsItemSelected(MenuItem item) {\n             case R.id.action_save_whiteboard:\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n-                    saveWhiteboard();\n+                    try {\n+                        saveWhiteboardInternal();\n+                    } catch (Exception e) {\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);", "originalCommit": "d7bef753fba14127b4ba5912720049f6b65b1d88", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "571280e5aff69b0613553285b4c6e3d3c201617d", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 8469aeca8..75520cc68 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -318,11 +340,15 @@ public class Reviewer extends AbstractFlashcardViewer {\n             case R.id.action_save_whiteboard:\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n+<<<<<<< HEAD\n                     try {\n                         saveWhiteboardInternal();\n                     } catch (Exception e) {\n                         UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);\n                     }\n+=======\n+                    saveWhiteboard();\n+>>>>>>> 34b372df4... \tSave whiteboard\n                 }\n                 break;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzU3Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737572", "bodyText": "Remove this catch, and let the wrapper handle it", "author": "david-allison-1", "createdAt": "2020-06-13T13:00:07Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -412,7 +425,7 @@ private void saveWhiteboard() {\n             mWhiteboard.draw(canvas);\n             bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveImgFile));\n         } catch (FileNotFoundException e) {", "originalCommit": "d7bef753fba14127b4ba5912720049f6b65b1d88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczODU4NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439738584", "bodyText": "Getting this error,\n\nAdded exception method signature", "author": "infinyte7", "createdAt": "2020-06-13T13:15:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0MTIwNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439741206", "bodyText": "Yep, needs to be added to the method signature if it's not caught", "author": "david-allison-1", "createdAt": "2020-06-13T13:58:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 8469aeca8..25828a693 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -428,6 +448,41 @@ public class Reviewer extends AbstractFlashcardViewer {\n             Timber.e(e, \"Whiteboard image saving failed\");\n         }\n     }\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar != null) {\n+            // It exists swap visibility status\n+            if (mMicToolBar.getVisibility() != View.VISIBLE) {\n+                mMicToolBar.setVisibility(View.VISIBLE);\n+            } else {\n+                mMicToolBar.setVisibility(View.GONE);\n+            }\n+        } else {\n+            // Record mic tool bar does not exist yet\n+            mTempAudioPath = AudioView.generateTempAudioFile(this);\n+            if (mTempAudioPath == null) {\n+                return;\n+            }\n+            mMicToolBar = AudioView.createRecorderInstance(this, R.drawable.av_play, R.drawable.av_pause,\n+                        R.drawable.av_stop, R.drawable.av_rec, R.drawable.av_rec_stop, mTempAudioPath);\n+            if (mMicToolBar == null) {\n+                mTempAudioPath = null;\n+                return;\n+            }\n+            FrameLayout.LayoutParams lp2 = new FrameLayout.LayoutParams(\n+                    ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n+            mMicToolBar.setLayoutParams(lp2);\n+            LinearLayout micToolBarLayer = findViewById(R.id.mic_tool_bar_layer);\n+            micToolBarLayer.addView(mMicToolBar);\n+        }\n+    }\n+\n+    public void onRequestPermissionsResult (int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n+        if ( (requestCode == REQUEST_AUDIO_PERMISSION) &&\n+                (permissions.length >= 1) && (grantResults[0] == PackageManager.PERMISSION_GRANTED)) {\n+            // Get get audio record permission, so we can create the record tool bar\n+            toggleMicToolBar();\n+        }\n+    }\n \n     private void showRescheduleCardDialog() {\n         Consumer<Integer> runnable = days ->\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzYwMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737601", "bodyText": "Can we Timber the exception here?", "author": "david-allison-1", "createdAt": "2020-06-13T13:00:22Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -316,7 +318,11 @@ public boolean onOptionsItemSelected(MenuItem item) {\n             case R.id.action_save_whiteboard:\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n-                    saveWhiteboard();\n+                    try {\n+                        saveWhiteboardInternal();\n+                    } catch (Exception e) {\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);", "originalCommit": "d7bef753fba14127b4ba5912720049f6b65b1d88", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "571280e5aff69b0613553285b4c6e3d3c201617d", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 8469aeca8..75520cc68 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -318,11 +340,15 @@ public class Reviewer extends AbstractFlashcardViewer {\n             case R.id.action_save_whiteboard:\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n+<<<<<<< HEAD\n                     try {\n                         saveWhiteboardInternal();\n                     } catch (Exception e) {\n                         UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);\n                     }\n+=======\n+                    saveWhiteboard();\n+>>>>>>> 34b372df4... \tSave whiteboard\n                 }\n                 break;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzYxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737617", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!ankiDroidFolder.exists()) {\n          \n          \n            \n                    if (!ankiDroidFolder.exists()) {", "author": "david-allison-1", "createdAt": "2020-06-13T13:00:35Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -392,15 +398,22 @@ public boolean onOptionsItemSelected(MenuItem item) {\n     }\n \n \n-    private void saveWhiteboard() {\n+    private void saveWhiteboardInternal() {\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n-        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {", "originalCommit": "d7bef753fba14127b4ba5912720049f6b65b1d88", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 8469aeca8..25828a693 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -398,6 +417,7 @@ public class Reviewer extends AbstractFlashcardViewer {\n     }\n \n \n+\n     private void saveWhiteboardInternal() {\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n"}}, {"oid": "e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "url": "https://github.com/ankidroid/Anki-Android/commit/e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "message": "Save whiteboard\n\n\tUpdated Reviewer.java\n\n\tUpadted Reviewer.java, 02-strings.xml\n\n\tUpdated ActionButtonStatus.java, preferences_custom_buttons.xml", "committedDate": "2020-06-21T06:43:39Z", "type": "commit"}, {"oid": "571280e5aff69b0613553285b4c6e3d3c201617d", "url": "https://github.com/ankidroid/Anki-Android/commit/571280e5aff69b0613553285b4c6e3d3c201617d", "message": "Save whiteboard", "committedDate": "2020-06-21T06:50:35Z", "type": "forcePushed"}, {"oid": "2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "url": "https://github.com/ankidroid/Anki-Android/commit/2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "message": "Save whiteboard", "committedDate": "2020-06-21T07:15:48Z", "type": "commit"}, {"oid": "2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "url": "https://github.com/ankidroid/Anki-Android/commit/2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "message": "Save whiteboard", "committedDate": "2020-06-21T07:15:48Z", "type": "forcePushed"}, {"oid": "ce737e2786f55568e7cd53804c02fdf6de5fc37f", "url": "https://github.com/ankidroid/Anki-Android/commit/ce737e2786f55568e7cd53804c02fdf6de5fc37f", "message": "\tUpdated Reviewer.java", "committedDate": "2020-06-21T07:21:28Z", "type": "commit"}, {"oid": "6cecb368ffe34bd9b15a48e9170259a18467fbaa", "url": "https://github.com/ankidroid/Anki-Android/commit/6cecb368ffe34bd9b15a48e9170259a18467fbaa", "message": "  Update Reviewer.java", "committedDate": "2020-06-21T07:23:37Z", "type": "commit"}, {"oid": "78d221c46e976b697deec9db08deb3be23ca95ee", "url": "https://github.com/ankidroid/Anki-Android/commit/78d221c46e976b697deec9db08deb3be23ca95ee", "message": "\tUpdate Reviewer.java", "committedDate": "2020-06-21T07:25:36Z", "type": "commit"}, {"oid": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4", "url": "https://github.com/ankidroid/Anki-Android/commit/6031ebad77f20e5ee03f0153411e1d84a9bf08d4", "message": "    Show taost when image saved", "committedDate": "2020-06-21T07:42:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTA4NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443205085", "bodyText": "Could you extract this functionality into Whiteboard class: use AnkiDroidFolder as the default folder, and allow an override which will accept the folder.\nso something along the lines of:\npublic void saveWhiteBoaard() {\n    File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n    File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n   saveWhiteBoard(ankiDroidFolder );\n}\n\npublic void saveWhiteboard(File folder) {\n   ...\n}", "author": "david-allison-1", "createdAt": "2020-06-21T10:25:34Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -400,8 +420,37 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         }\n         return true;\n     }\n+    private void saveWhiteboardInternal() {", "originalCommit": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyMjgzMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443222833", "bodyText": "It can be done. But how can get height and width\n Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n\n\nand this one\nmWhiteboard.draw(canvas);\n\nInside whiteboard.java", "author": "infinyte7", "createdAt": "2020-06-21T14:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTA4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyMzE0Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443223146", "bodyText": "You should be able to use this.draw() and this.getHeight()", "author": "david-allison-1", "createdAt": "2020-06-21T14:09:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTA4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyNzk0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443227942", "bodyText": "Okay, Now extracted saveWhiteboard() to Whiteboard.java", "author": "infinyte7", "createdAt": "2020-06-21T14:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTA4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "25f4649a785fc6b7f1b827e35f2b84dba12153ed", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 30aac59aa..724c50398 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -420,12 +420,13 @@ public class Reviewer extends AbstractFlashcardViewer {\n         }\n         return true;\n     }\n-    private void saveWhiteboardInternal() {\n+\n+    private void saveWhiteboardInternal() throws FileNotFoundException{\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n         File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n-        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");\n \n         if(!ankiDroidFolder.exists()) {\n             ankiDroidFolder.mkdirs();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTEwOA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443205108", "bodyText": "Can you remove this try, and add a throws to the method", "author": "david-allison-1", "createdAt": "2020-06-21T10:25:51Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -400,8 +420,37 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         }\n         return true;\n     }\n+    private void saveWhiteboardInternal() {\n+        Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n+        String finalFileName = baseFileName + newName;\n \n+        File saveImgFile = new File(ankiDroidFolder, finalFileName);\n \n+        if (isInNightMode()) {\n+            canvas.drawColor(Color.BLACK);\n+        } else {\n+            canvas.drawColor(Color.WHITE);\n+        }\n+\n+        try {", "originalCommit": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "25f4649a785fc6b7f1b827e35f2b84dba12153ed", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 30aac59aa..724c50398 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -420,12 +420,13 @@ public class Reviewer extends AbstractFlashcardViewer {\n         }\n         return true;\n     }\n-    private void saveWhiteboardInternal() {\n+\n+    private void saveWhiteboardInternal() throws FileNotFoundException{\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n         File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n-        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");\n \n         if(!ankiDroidFolder.exists()) {\n             ankiDroidFolder.mkdirs();\n"}}, {"oid": "25f4649a785fc6b7f1b827e35f2b84dba12153ed", "url": "https://github.com/ankidroid/Anki-Android/commit/25f4649a785fc6b7f1b827e35f2b84dba12153ed", "message": "\tUpdated Reviewer.java", "committedDate": "2020-06-21T14:20:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyNTA0Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443225046", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");\n          \n          \n            \n                    File ankiDroidFolder = new File(pictures, \"AnkiDroid\");", "author": "david-allison-1", "createdAt": "2020-06-21T14:28:26Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -420,12 +420,13 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         }\n         return true;\n     }\n-    private void saveWhiteboardInternal() {\n+\n+    private void saveWhiteboardInternal() throws FileNotFoundException{\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n         File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n-        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");", "originalCommit": "25f4649a785fc6b7f1b827e35f2b84dba12153ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 724c50398..2eae5d691 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -421,34 +414,6 @@ public class Reviewer extends AbstractFlashcardViewer {\n         return true;\n     }\n \n-    private void saveWhiteboardInternal() throws FileNotFoundException{\n-        Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n-        Canvas canvas = new Canvas(bitmap);\n-\n-        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n-        File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");\n-\n-        if(!ankiDroidFolder.exists()) {\n-            ankiDroidFolder.mkdirs();\n-        }\n-\n-        String baseFileName = \"Whiteboard\";\n-        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n-        String finalFileName = baseFileName + newName;\n-\n-        File saveImgFile = new File(ankiDroidFolder, finalFileName);\n-\n-        if (isInNightMode()) {\n-            canvas.drawColor(Color.BLACK);\n-        } else {\n-            canvas.drawColor(Color.WHITE);\n-        }\n-\n-        mWhiteboard.draw(canvas);\n-        bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveImgFile));\n-        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, saveImgFile.getAbsolutePath()),true);\n-    }\n-\n     private void toggleMicToolBar() {\n         if (mMicToolBar != null) {\n             // It exists swap visibility status\n"}}, {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "url": "https://github.com/ankidroid/Anki-Android/commit/1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "message": "\tFunction extracted to Whiteboard.java", "committedDate": "2020-06-21T14:56:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTE1OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229159", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!ankiDroidFolder.exists()) {\n          \n          \n            \n                    if (!ankiDroidFolder.exists()) {", "author": "david-allison-1", "createdAt": "2020-06-21T15:12:38Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -416,4 +425,36 @@ public boolean empty() {\n     public boolean isCurrentlyDrawing() {\n         return mCurrentlyDrawing;\n     }\n+\n+    protected void saveWhiteboard() throws FileNotFoundException {\n+\n+        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {", "originalCommit": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0f9f9d533feb51a87eedad53d060d3fa64300bc2", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\nindex 0255b1e2a..096eba071 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n\n@@ -434,7 +434,7 @@ public class Whiteboard extends View {\n         File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n         File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n \n-        if(!ankiDroidFolder.exists()) {\n+        if (!ankiDroidFolder.exists()) {\n             ankiDroidFolder.mkdirs();\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTE2Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229163", "bodyText": "Would be better to return the string from the method, then you can remove the member variable.", "author": "david-allison-1", "createdAt": "2020-06-21T15:12:43Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -416,4 +425,36 @@ public boolean empty() {\n     public boolean isCurrentlyDrawing() {\n         return mCurrentlyDrawing;\n     }\n+\n+    protected void saveWhiteboard() throws FileNotFoundException {\n+\n+        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n+        String finalFileName = baseFileName + newName;\n+\n+        saveWhiteboardImagFile = new File(ankiDroidFolder, finalFileName);\n+\n+        if (foregroundColor != Color.BLACK) {\n+            canvas.drawColor(Color.BLACK);\n+        } else {\n+            canvas.drawColor(Color.WHITE);\n+        }\n+\n+        this.draw(canvas);\n+        bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveWhiteboardImagFile));\n+    }\n+\n+    protected String getSaveImagePath() {", "originalCommit": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0f9f9d533feb51a87eedad53d060d3fa64300bc2", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\nindex 0255b1e2a..096eba071 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n\n@@ -434,7 +434,7 @@ public class Whiteboard extends View {\n         File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n         File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n \n-        if(!ankiDroidFolder.exists()) {\n+        if (!ankiDroidFolder.exists()) {\n             ankiDroidFolder.mkdirs();\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTIxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229217", "bodyText": "I think this was accidentally removed", "author": "david-allison-1", "createdAt": "2020-06-21T15:13:23Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -65,15 +72,17 @@\n     private boolean mInvertedColors;\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n+    private int foregroundColor;\n \n+    File saveWhiteboardImagFile;\n \n     public Whiteboard(AbstractFlashcardViewer cardViewer, boolean inverted, boolean monochrome) {\n         super(cardViewer, null);\n         mCardViewer = new WeakReference<>(cardViewer);\n         mInvertedColors = inverted;\n         mMonochrome = monochrome;\n \n-        int foregroundColor;\n+", "originalCommit": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTU2Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229563", "bodyText": "No I used that to check for night mode status.\nAt line 445\n        saveWhiteboardImagFile = new File(ankiDroidFolder, finalFileName);\n\n        if (foregroundColor != Color.BLACK) {\n            canvas.drawColor(Color.BLACK);\n        } else {\n            canvas.drawColor(Color.WHITE);\n        }", "author": "infinyte7", "createdAt": "2020-06-21T15:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTIxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTk5NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229995", "bodyText": "Ah! Added a quick comment, but that's understandable. Was reviewing per-commit and missed it.", "author": "david-allison-1", "createdAt": "2020-06-21T15:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTIxNw=="}], "type": "inlineReview", "revised_code": {"commit": "df7f3c87f13f03fd768a65397f9d1a2e8bb929a6", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\nindex 0255b1e2a..de3be1058 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n\n@@ -72,7 +72,7 @@ public class Whiteboard extends View {\n     private boolean mInvertedColors;\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n-    private int foregroundColor;\n+    private final int foregroundColor;\n \n     File saveWhiteboardImagFile;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTI1Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229257", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()),true);\n          \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()), true);", "author": "david-allison-1", "createdAt": "2020-06-21T15:13:50Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -343,7 +335,8 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n                     try {\n-                        saveWhiteboardInternal();\n+                        mWhiteboard.saveWhiteboard();\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()),true);", "originalCommit": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0f9f9d533feb51a87eedad53d060d3fa64300bc2", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\nindex 2eae5d691..7861e75a5 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java\n\n@@ -336,9 +336,9 @@ public class Reviewer extends AbstractFlashcardViewer {\n                 if (mWhiteboard != null) {\n                     try {\n                         mWhiteboard.saveWhiteboard();\n-                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()),true);\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()), true);\n                     } catch (Exception e) {\n-                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()), true);\n                     }\n                 }\n                 break;\n"}}, {"oid": "b9c327e57c707a97a5449fa7d90e835dba37cb7f", "url": "https://github.com/ankidroid/Anki-Android/commit/b9c327e57c707a97a5449fa7d90e835dba37cb7f", "message": "\tMenu updated reviewer.xml", "committedDate": "2020-06-21T15:14:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTY4Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229686", "bodyText": "Here is\nprivate int foregroundColor;", "author": "infinyte7", "createdAt": "2020-06-21T15:18:34Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -65,15 +72,17 @@\n     private boolean mInvertedColors;\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n+    private int foregroundColor;", "originalCommit": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDAyNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443230026", "bodyText": "Whoops! missed that, thanks!!\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private int foregroundColor;\n          \n          \n            \n                private final int mForegroundColor;", "author": "david-allison-1", "createdAt": "2020-06-21T15:22:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTY4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDU1MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443230551", "bodyText": "After renaming the change will reflected here also.\n        if (!mInvertedColors) {\n            if (mMonochrome) {\n                foregroundColor = Color.BLACK;\n            } else {\n                foregroundColor = ContextCompat.getColor(cardViewer, R.color.wb_fg_color);\n            }\n        } else {\n            if (mMonochrome) {\n                foregroundColor = Color.WHITE;\n            } else {\n                foregroundColor = ContextCompat.getColor(cardViewer, R.color.wb_fg_color_inv);\n            }\n        }", "author": "infinyte7", "createdAt": "2020-06-21T15:28:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTY4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "df7f3c87f13f03fd768a65397f9d1a2e8bb929a6", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\nindex 0255b1e2a..de3be1058 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n\n@@ -72,7 +72,7 @@ public class Whiteboard extends View {\n     private boolean mInvertedColors;\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n-    private int foregroundColor;\n+    private final int foregroundColor;\n \n     File saveWhiteboardImagFile;\n \n"}}, {"oid": "0f9f9d533feb51a87eedad53d060d3fa64300bc2", "url": "https://github.com/ankidroid/Anki-Android/commit/0f9f9d533feb51a87eedad53d060d3fa64300bc2", "message": "\tUpdated Reviewer.java", "committedDate": "2020-06-21T15:34:31Z", "type": "commit"}, {"oid": "df7f3c87f13f03fd768a65397f9d1a2e8bb929a6", "url": "https://github.com/ankidroid/Anki-Android/commit/df7f3c87f13f03fd768a65397f9d1a2e8bb929a6", "message": "\tUpdate Whiteboard.java", "committedDate": "2020-06-21T15:35:47Z", "type": "commit"}, {"oid": "cf711e2347b4de33905b233acbec8afaf931d2af", "url": "https://github.com/ankidroid/Anki-Android/commit/cf711e2347b4de33905b233acbec8afaf931d2af", "message": "\tUpdated Reviewer.java Whiteboard.java", "committedDate": "2020-06-21T15:58:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDYwOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443244609", "bodyText": "Hey @david-allison-1 - should this use TimeUtils ? I'm working through something else with regard to temporary image files (the crop PR) so it is top of mind.\nimport com.ichi2.libanki.utils.SystemTime;\nimport com.ichi2.libanki.utils.TimeUtils;\n\n    // Put this where class variables are instantiated right at the top\n    private SystemTime mTime = new SystemTime();\n\n        // Use them like this:\n        String timeStamp = TimeUtils.getTimestamp(mTime);\n        String newName = timeStamp + \".png\";", "author": "mikehardy", "createdAt": "2020-06-21T18:29:51Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -416,4 +423,33 @@ public boolean empty() {\n     public boolean isCurrentlyDrawing() {\n         return mCurrentlyDrawing;\n     }\n+\n+    protected String saveWhiteboard() throws FileNotFoundException {\n+\n+        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if (!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());", "originalCommit": "cf711e2347b4de33905b233acbec8afaf931d2af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI1MDk1MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443250950", "bodyText": "Looks like a good change to me", "author": "david-allison-1", "createdAt": "2020-06-21T19:45:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI1MTM0Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443251347", "bodyText": "Okay @infinyte7 can you slice those in there then? Sorry to be late in the game but while you and David were collaborating I didn't want to cross-talk. Should be a trivial alteration though and this allows for easier testing of the component since time can be controlled externally for file creation control", "author": "mikehardy", "createdAt": "2020-06-21T19:50:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYzNDk4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r444634983", "bodyText": "I have updated it.", "author": "infinyte7", "createdAt": "2020-06-24T04:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDYwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "d15abb514dc96db3cb3e659097f47bb1c5612c84", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\nindex 39984860d..1c4a154f2 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\n\n@@ -437,8 +439,8 @@ public class Whiteboard extends View {\n         }\n \n         String baseFileName = \"Whiteboard\";\n-        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n-        String finalFileName = baseFileName + newName;\n+        String timeStamp = TimeUtils.getTimestamp(mTime);\n+        String finalFileName = baseFileName + timeStamp + \".png\";\n \n         File saveWhiteboardImagFile = new File(ankiDroidFolder, finalFileName);\n \n"}}, {"oid": "d15abb514dc96db3cb3e659097f47bb1c5612c84", "url": "https://github.com/ankidroid/Anki-Android/commit/d15abb514dc96db3cb3e659097f47bb1c5612c84", "message": "\tUpdated Whiteboard.java", "committedDate": "2020-06-24T04:15:20Z", "type": "commit"}, {"oid": "c5bee104852ae85fc046d846ab4285ac422c5929", "url": "https://github.com/ankidroid/Anki-Android/commit/c5bee104852ae85fc046d846ab4285ac422c5929", "message": "Merge branch 'master' into save-add-whiteboard", "committedDate": "2020-06-25T21:11:51Z", "type": "commit"}]}