{"pr_number": 7126, "pr_title": "HACK - Use Clipboard to allow MIUI Cloze", "pr_createdAt": "2020-09-17T01:18:34Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7126", "timeline": [{"oid": "74225f894db2f8e4bf40706cfa3cb60377a7213b", "url": "https://github.com/ankidroid/Anki-Android/commit/74225f894db2f8e4bf40706cfa3cb60377a7213b", "message": "HACK - Use Clipboard to allow MIUI Cloze\n\nWe add the selected value to the clipboard surrounded by cloze marks\n\nThis allows MIUI users with GBoard to paste it in immediately (and other keyboards to use Paste)\n\nHACK before 7124 obsoletes this", "committedDate": "2020-09-17T02:14:18Z", "type": "commit"}, {"oid": "74225f894db2f8e4bf40706cfa3cb60377a7213b", "url": "https://github.com/ankidroid/Anki-Android/commit/74225f894db2f8e4bf40706cfa3cb60377a7213b", "message": "HACK - Use Clipboard to allow MIUI Cloze\n\nWe add the selected value to the clipboard surrounded by cloze marks\n\nThis allows MIUI users with GBoard to paste it in immediately (and other keyboards to use Paste)\n\nHACK before 7124 obsoletes this", "committedDate": "2020-09-17T02:14:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkwNjc2NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7126#discussion_r489906765", "bodyText": "\ud83e\udd23", "author": "mikehardy", "createdAt": "2020-09-17T02:50:40Z", "path": "AnkiDroid/src/main/java/com/ichi2/utils/AdaptionUtil.java", "diffHunk": "@@ -121,4 +123,34 @@ public static boolean isRestrictedLearningDevice() {\n         }\n         return sIsRestrictedLearningDevice;\n     }\n+\n+    public static boolean canUseContextMenu() {\n+        return !isRunningMiui();\n+    }\n+\n+    private static boolean isRunningMiui() {\n+        if (sIsRunningMiUI == null) {\n+            sIsRunningMiUI = queryIsMiui();\n+        }\n+        return sIsRunningMiUI;\n+    }\n+\n+    // https://stackoverflow.com/questions/47610456/how-to-detect-miui-rom-programmatically-in-android\n+    private static boolean isIntentResolved(Context ctx, Intent intent) {\n+        return (intent != null && ctx.getPackageManager().resolveActivity(intent, PackageManager.MATCH_DEFAULT_ONLY) != null);\n+    }\n+\n+    private static boolean queryIsMiui() {\n+        Context ctx = AnkiDroidApp.getInstance();\n+        return isIntentResolved(ctx, new Intent(\"miui.intent.action.OP_AUTO_START\").addCategory(Intent.CATEGORY_DEFAULT))\n+                || isIntentResolved(ctx, new Intent().setComponent(new ComponentName(\"com.miui.securitycenter\", \"com.miui.permcenter.autostart.AutoStartManagementActivity\")))\n+                || isIntentResolved(ctx, new Intent(\"miui.intent.action.POWER_HIDE_MODE_APP_LIST\").addCategory(Intent.CATEGORY_DEFAULT))\n+                || isIntentResolved(ctx, new Intent().setComponent(new ComponentName(\"com.miui.securitycenter\", \"com.miui.powercenter.PowerSettings\")));\n+    }\n+\n+\n+    @SuppressWarnings( {\"unused\", \"RedundantSuppression\"})\n+    public static boolean shouldCurrentUserBuyDifferentPhone() {", "originalCommit": "74225f894db2f8e4bf40706cfa3cb60377a7213b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}