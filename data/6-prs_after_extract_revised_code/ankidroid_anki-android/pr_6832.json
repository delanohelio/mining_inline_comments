{"pr_number": 6832, "pr_title": "NF: Incr decr reps", "pr_createdAt": "2020-08-06T19:39:38Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6832", "timeline": [{"oid": "4edd45b1a84e0575ca365244d89343790ac8f667", "url": "https://github.com/ankidroid/Anki-Android/commit/4edd45b1a84e0575ca365244d89343790ac8f667", "message": "NF: remove duplicate getter/setter", "committedDate": "2020-08-06T18:34:17Z", "type": "commit"}, {"oid": "03275a67a92b800e984143b68e25b51e588e8a34", "url": "https://github.com/ankidroid/Anki-Android/commit/03275a67a92b800e984143b68e25b51e588e8a34", "message": "NF: incr/decr Reps\n\nFor clarity", "committedDate": "2020-08-06T18:39:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjQxOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6832#discussion_r466662419", "bodyText": "I don't understand how this is NF?", "author": "mikehardy", "createdAt": "2020-08-06T20:17:57Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -602,12 +602,6 @@ protected void displayNext(Card nextCard) {\n                 AbstractFlashcardViewer.this.displayCardQuestion();\n             }\n \n-            // Since reps are incremented on fetch of next card, we will miss counting the\n-            // last rep since there isn't a next card. We manually account for it here.\n-            if (mNoMoreCards) {\n-                mSched.incrReps();\n-            }\n-", "originalCommit": "a08fa6631b85f9089eb1d9c5da2db034816e71a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2Mjg0Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6832#discussion_r466662843", "bodyText": "...and I'll quickly add, I do not work with the scheduler hahaha", "author": "mikehardy", "createdAt": "2020-08-06T20:18:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2NDM4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6832#discussion_r466664383", "bodyText": "This is why we have two reviewers! Nice catch \ud83e\udd26\u200d\u2642\ufe0f", "author": "david-allison-1", "createdAt": "2020-08-06T20:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5MzAxNQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6832#discussion_r466693015", "bodyText": "Removed...\nI mean, added back.\nThis is actually NF, but that was certainly not supposed to be in this PR, but in a separate PR related to #6775 were this particular case can be discussed in details. I fear I did the change in the wrong branch", "author": "Arthur-Milchior", "createdAt": "2020-08-06T21:21:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5NDk5MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6832#discussion_r466694990", "bodyText": "We should get a Unit Test in if that wasn't caught", "author": "david-allison-1", "createdAt": "2020-08-06T21:25:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5Nzk0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6832#discussion_r466697942", "bodyText": "I don't understand your point. This change is actually NF. How do you want a unit test to catch it ?\nIt's not trivial that it's NF and I don't expect to put it in this\u00a0PR which contains only trivial changes.\nI can give an explanation if you want: the number of reps allows to see how many card you reviewed in a time box. I.e in an interval of let's say 15 minutes with the reviewer open. If there is no more card, the timebox will never ends, and the number of reps is not considered anymore. So in this case, increasing the number of reps is actually an operation that is never going to be noticed by the user, since this increase will be ignored next time reps is used, i.e., when they start reviewing again.\nOf course, we could test that, technically, this variable which is not read again before being reset is incremented, but I should admit I don't see the point.\nTo be very precise, what is considered is the difference in value between reps between the end and the start of the timebox. The number of reps is not technically resets. However, increasing the number of reps does not change the difference in the number of reps", "author": "Arthur-Milchior", "createdAt": "2020-08-06T21:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjQxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "61cc0786054f904726a851285cc81fd393961163", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java b/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java\nindex 27457a4d5..562cdcf3f 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java\n\n@@ -602,6 +602,12 @@ public abstract class AbstractFlashcardViewer extends NavigationDrawerActivity i\n                 AbstractFlashcardViewer.this.displayCardQuestion();\n             }\n \n+            // Since reps are incremented on fetch of next card, we will miss counting the\n+            // last rep since there isn't a next card. We manually account for it here.\n+            if (mNoMoreCards) {\n+                mSched.incrReps();\n+            }\n+\n             Long[] elapsed = getCol().timeboxReached();\n             if (elapsed != null) {\n                 // AnkiDroid is always counting one rep ahead, so we decrement it before displaying\n"}}, {"oid": "61cc0786054f904726a851285cc81fd393961163", "url": "https://github.com/ankidroid/Anki-Android/commit/61cc0786054f904726a851285cc81fd393961163", "message": "Cards:incrReps", "committedDate": "2020-08-06T21:19:29Z", "type": "commit"}, {"oid": "61cc0786054f904726a851285cc81fd393961163", "url": "https://github.com/ankidroid/Anki-Android/commit/61cc0786054f904726a851285cc81fd393961163", "message": "Cards:incrReps", "committedDate": "2020-08-06T21:19:29Z", "type": "forcePushed"}]}