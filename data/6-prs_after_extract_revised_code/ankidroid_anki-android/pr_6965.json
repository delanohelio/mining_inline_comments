{"pr_number": 6965, "pr_title": "More non real time ", "pr_createdAt": "2020-08-25T10:28:37Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6965", "timeline": [{"oid": "2c5ff65a17ae569dc5a4bd8d44eee274b0ef8a49", "url": "https://github.com/ankidroid/Anki-Android/commit/2c5ff65a17ae569dc5a4bd8d44eee274b0ef8a49", "message": "NF: scheduleNotification uses col time", "committedDate": "2020-08-28T15:15:23Z", "type": "forcePushed"}, {"oid": "41dfd941df5f0a9ff98ef236a414c9d75835f011", "url": "https://github.com/ankidroid/Anki-Android/commit/41dfd941df5f0a9ff98ef236a414c9d75835f011", "message": "NF: suppress lint when real time should be used", "committedDate": "2020-08-29T12:14:28Z", "type": "forcePushed"}, {"oid": "fdf9545e19c5c538408ed751de01f586ef80972d", "url": "https://github.com/ankidroid/Anki-Android/commit/fdf9545e19c5c538408ed751de01f586ef80972d", "message": "NF: suppress lint when real time should be used", "committedDate": "2020-08-29T12:16:07Z", "type": "forcePushed"}, {"oid": "6e63482bc2e2a4faac1070f1a7f8836842ab1aea", "url": "https://github.com/ankidroid/Anki-Android/commit/6e63482bc2e2a4faac1070f1a7f8836842ab1aea", "message": "NF: suppress lint when real time should be used", "committedDate": "2020-08-29T15:13:10Z", "type": "forcePushed"}, {"oid": "20c2d2e6a254f53f1a19dae6c726cc66cf40b644", "url": "https://github.com/ankidroid/Anki-Android/commit/20c2d2e6a254f53f1a19dae6c726cc66cf40b644", "message": "NF: suppress lint when real time should be used", "committedDate": "2020-08-29T16:53:23Z", "type": "forcePushed"}, {"oid": "b1ab1c5c67511497ddec68d4c8bf1427e360a7f8", "url": "https://github.com/ankidroid/Anki-Android/commit/b1ab1c5c67511497ddec68d4c8bf1427e360a7f8", "message": "NF: use of col's time", "committedDate": "2020-08-29T20:04:50Z", "type": "commit"}, {"oid": "f253eb58450db4bcc1eab1b5c793ee0920ad9d92", "url": "https://github.com/ankidroid/Anki-Android/commit/f253eb58450db4bcc1eab1b5c793ee0920ad9d92", "message": "NF: Time contains method to create calendar from time\n\nThis ensure we don't create calendar object, which contains real time, outside of Time", "committedDate": "2020-08-29T20:04:50Z", "type": "commit"}, {"oid": "f00db86da7ff0fc90d69f56d5611f56820cc82d3", "url": "https://github.com/ankidroid/Anki-Android/commit/f00db86da7ff0fc90d69f56d5611f56820cc82d3", "message": "NF: moved utcOffset to Time\n\nThis ensure all classes using real time are in Time. Easier for lint", "committedDate": "2020-08-29T20:04:50Z", "type": "commit"}, {"oid": "af213037f010473ddce848dba99d62f5840f7f72", "url": "https://github.com/ankidroid/Anki-Android/commit/af213037f010473ddce848dba99d62f5840f7f72", "message": "NF: ReminderToCalendar takes time", "committedDate": "2020-08-29T20:04:50Z", "type": "commit"}, {"oid": "30d7cd033daa3987943b07f9dea424713024b779", "url": "https://github.com/ankidroid/Anki-Android/commit/30d7cd033daa3987943b07f9dea424713024b779", "message": "NF: scheduleNotification uses col time", "committedDate": "2020-08-29T20:04:50Z", "type": "commit"}, {"oid": "f2687a310fbdf996c83a991da1e90711f2c6a0e4", "url": "https://github.com/ankidroid/Anki-Android/commit/f2687a310fbdf996c83a991da1e90711f2c6a0e4", "message": "NF: suppress lint when real time should be used", "committedDate": "2020-08-29T20:04:50Z", "type": "commit"}, {"oid": "3ddab6236c530b9ea2a8c8021cc6bbd9c03f5bca", "url": "https://github.com/ankidroid/Anki-Android/commit/3ddab6236c530b9ea2a8c8021cc6bbd9c03f5bca", "message": "NF: getToday moved to Time", "committedDate": "2020-08-29T20:04:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY4OTY0MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6965#discussion_r479689641", "bodyText": "Could we add a getTimeSafe() - get col time, or return a new instance. This can potentially crash as it is.", "author": "david-allison-1", "createdAt": "2020-08-29T20:59:34Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java", "diffHunk": "@@ -243,9 +244,11 @@ public MaterialDialog onCreateDialog(Bundle savedInstanceState) {\n                         .positiveText(res.getString(R.string.dialog_positive_create))\n                         .negativeText(res.getString(R.string.dialog_cancel))\n                         .onPositive((inner_dialog, which) -> {\n-                            CollectionHelper.getInstance().closeCollection(false, \"DatabaseErrorDialog: Before Create New Collection\");\n+                            CollectionHelper ch = CollectionHelper.getInstance();\n+                            Time time = ch.getColSafe(getContext()).getTime();", "originalCommit": "3ddab6236c530b9ea2a8c8021cc6bbd9c03f5bca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY5MDYzMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6965#discussion_r479690633", "bodyText": "Done. Hopefully what you wanted", "author": "Arthur-Milchior", "createdAt": "2020-08-29T21:13:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY4OTY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcwMjA1Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6965#discussion_r479702057", "bodyText": "Looks to be addressed, implementation looks good. Lots of CI to chew through but marking pending merge", "author": "mikehardy", "createdAt": "2020-08-29T23:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY4OTY0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "c53df5f8f18da4b2bef08f5c67d09a87001cc8b6", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java b/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java\nindex 05518e3df..c2f3d1385 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java\n\n@@ -244,11 +243,9 @@ public class DatabaseErrorDialog extends AsyncDialogFragment {\n                         .positiveText(res.getString(R.string.dialog_positive_create))\n                         .negativeText(res.getString(R.string.dialog_cancel))\n                         .onPositive((inner_dialog, which) -> {\n-                            CollectionHelper ch = CollectionHelper.getInstance();\n-                            Time time = ch.getColSafe(getContext()).getTime();\n-                            ch.closeCollection(false, \"DatabaseErrorDialog: Before Create New Collection\");\n+                            CollectionHelper.getInstance().closeCollection(false, \"DatabaseErrorDialog: Before Create New Collection\");\n                             String path1 = CollectionHelper.getCollectionPath(getActivity());\n-                            if (BackupManager.moveDatabaseToBrokenFolder(path1, false, time)) {\n+                            if (BackupManager.moveDatabaseToBrokenFolder(path1, false)) {\n                                 ((DeckPicker) getActivity()).restartActivity();\n                             } else {\n                                 ((DeckPicker) getActivity()).showDatabaseErrorDialog(DIALOG_LOAD_FAILED);\n"}}, {"oid": "c53df5f8f18da4b2bef08f5c67d09a87001cc8b6", "url": "https://github.com/ankidroid/Anki-Android/commit/c53df5f8f18da4b2bef08f5c67d09a87001cc8b6", "message": "NF: getTimeSafe", "committedDate": "2020-08-29T21:12:13Z", "type": "commit"}, {"oid": "f8beade2c9d917e95579968ec70f2b24719af1c2", "url": "https://github.com/ankidroid/Anki-Android/commit/f8beade2c9d917e95579968ec70f2b24719af1c2", "message": "NF: getToday moved to Time", "committedDate": "2020-08-29T21:12:50Z", "type": "commit"}, {"oid": "f8beade2c9d917e95579968ec70f2b24719af1c2", "url": "https://github.com/ankidroid/Anki-Android/commit/f8beade2c9d917e95579968ec70f2b24719af1c2", "message": "NF: getToday moved to Time", "committedDate": "2020-08-29T21:12:50Z", "type": "forcePushed"}]}