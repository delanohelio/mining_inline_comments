{"pr_number": 6652, "pr_title": "mLrnQueue has encoded as a class", "pr_createdAt": "2020-07-07T21:24:58Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6652", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MzUwMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6652#discussion_r451153502", "bodyText": "Just to note: bugFix is here.", "author": "david-allison-1", "createdAt": "2020-07-07T21:27:23Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -891,15 +911,10 @@ protected boolean _fillLrn() {\n                             \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue IN (\" + Consts.QUEUE_TYPE_LRN + \", \" + Consts.QUEUE_TYPE_PREVIEW + \") AND due < ?\"\n                             + \" AND id != ? LIMIT ?\", new Object[] { cutoff, currentCardId(), mReportLimit});\n             while (cur.moveToNext()) {\n-                mLrnQueue.add(new long[] { cur.getLong(0), currentCardId(), cur.getLong(1) });\n+                mLrnQueue.add(new LrnCard(cur.getLong(0), cur.getLong(1)));", "originalCommit": "d8459b572467ea4f9e54444bbab4efa8326f4939", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1NzA1Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6652#discussion_r451157052", "bodyText": "Want I split in two commits ?", "author": "Arthur-Milchior", "createdAt": "2020-07-07T21:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MzUwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3NjI2Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6652#discussion_r451176262", "bodyText": "Would be useful for anyone in the future", "author": "david-allison-1", "createdAt": "2020-07-07T22:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MzUwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3NzA1Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6652#discussion_r451177053", "bodyText": "Done", "author": "Arthur-Milchior", "createdAt": "2020-07-07T22:22:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MzUwMg=="}], "type": "inlineReview", "revised_code": {"commit": "48d028219b1c17214ffb464545307e428943d5d9", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java b/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java\nindex ac53298e9..8ecea946c 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java\n\n@@ -909,7 +907,7 @@ public class SchedV2 extends AbstractSched {\n                     .getDatabase()\n                     .query(\n                             \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue IN (\" + Consts.QUEUE_TYPE_LRN + \", \" + Consts.QUEUE_TYPE_PREVIEW + \") AND due < ?\"\n-                            + \" AND id != ? LIMIT ?\", new Object[] { cutoff, currentCardId(), mReportLimit});\n+                            + \" AND id != ? LIMIT ?\", new Object[] { cutoff, mReportLimit});\n             while (cur.moveToNext()) {\n                 mLrnQueue.add(new LrnCard(cur.getLong(0), cur.getLong(1)));\n             }\n"}}, {"oid": "64e0fe278d216fd754c750239711311dccd6d525", "url": "https://github.com/ankidroid/Anki-Android/commit/64e0fe278d216fd754c750239711311dccd6d525", "message": "mLrnQueue is a pair instead of an array", "committedDate": "2020-07-07T22:08:19Z", "type": "forcePushed"}, {"oid": "7f7e597993906c2f2baa6d529bded526a7bade00", "url": "https://github.com/ankidroid/Anki-Android/commit/7f7e597993906c2f2baa6d529bded526a7bade00", "message": "mLrnQueue is a pair instead of an array", "committedDate": "2020-07-07T22:09:39Z", "type": "forcePushed"}, {"oid": "8b4df2ab90b9c7fbcd50216a191aafebb02b31a4", "url": "https://github.com/ankidroid/Anki-Android/commit/8b4df2ab90b9c7fbcd50216a191aafebb02b31a4", "message": "mLrnQueue is a pair instead of an array", "committedDate": "2020-07-07T22:09:52Z", "type": "forcePushed"}, {"oid": "48d028219b1c17214ffb464545307e428943d5d9", "url": "https://github.com/ankidroid/Anki-Android/commit/48d028219b1c17214ffb464545307e428943d5d9", "message": "mLrnQueue is a pair instead of an array", "committedDate": "2020-07-07T22:21:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3OTc2MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6652#discussion_r451179761", "bodyText": "You have 3 substitutions, but only use 2.", "author": "david-allison-1", "createdAt": "2020-07-07T22:28:50Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -889,17 +907,12 @@ protected boolean _fillLrn() {\n                     .getDatabase()\n                     .query(\n                             \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue IN (\" + Consts.QUEUE_TYPE_LRN + \", \" + Consts.QUEUE_TYPE_PREVIEW + \") AND due < ?\"\n-                            + \" AND id != ? LIMIT ?\", new Object[] { cutoff, currentCardId(), mReportLimit});\n+                            + \" AND id != ? LIMIT ?\", new Object[] { cutoff, mReportLimit});", "originalCommit": "48d028219b1c17214ffb464545307e428943d5d9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4e7f3e35061c76d4387f12d391195489f0e30646", "chunk": "diff --git a/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java b/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java\nindex 8ecea946c..99cef944f 100644\n--- a/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java\n+++ b/AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java\n\n@@ -907,12 +889,17 @@ public class SchedV2 extends AbstractSched {\n                     .getDatabase()\n                     .query(\n                             \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue IN (\" + Consts.QUEUE_TYPE_LRN + \", \" + Consts.QUEUE_TYPE_PREVIEW + \") AND due < ?\"\n-                            + \" AND id != ? LIMIT ?\", new Object[] { cutoff, mReportLimit});\n+                            + \" AND id != ? LIMIT ?\", new Object[] { cutoff, currentCardId(), mReportLimit});\n             while (cur.moveToNext()) {\n-                mLrnQueue.add(new LrnCard(cur.getLong(0), cur.getLong(1)));\n+                mLrnQueue.add(new long[] { cur.getLong(0), cur.getLong(1) });\n             }\n             // as it arrives sorted by did first, we need to sort it\n-            Collections.sort(mLrnQueue);\n+            Collections.sort(mLrnQueue, new Comparator<long[]>() {\n+                @Override\n+                public int compare(long[] lhs, long[] rhs) {\n+                    return Long.compare(lhs[0], rhs[0]);\n+                }\n+            });\n             return !mLrnQueue.isEmpty();\n         } finally {\n             if (cur != null && !cur.isClosed()) {\n"}}, {"oid": "4e7f3e35061c76d4387f12d391195489f0e30646", "url": "https://github.com/ankidroid/Anki-Android/commit/4e7f3e35061c76d4387f12d391195489f0e30646", "message": "Correct 6645\n\nThis value was supposed to be in the query instead. It was added in an earlier commit", "committedDate": "2020-07-08T01:45:11Z", "type": "commit"}, {"oid": "2105477153e6a0de50a1e6391d1f2dda16616957", "url": "https://github.com/ankidroid/Anki-Android/commit/2105477153e6a0de50a1e6391d1f2dda16616957", "message": "mLrnQueue is a pair instead of an array", "committedDate": "2020-07-08T01:45:20Z", "type": "commit"}, {"oid": "2105477153e6a0de50a1e6391d1f2dda16616957", "url": "https://github.com/ankidroid/Anki-Android/commit/2105477153e6a0de50a1e6391d1f2dda16616957", "message": "mLrnQueue is a pair instead of an array", "committedDate": "2020-07-08T01:45:20Z", "type": "forcePushed"}]}