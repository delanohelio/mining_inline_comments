{"pr_number": 822, "pr_title": "DPC-162 add auth related logging filter", "pr_createdAt": "2020-05-28T02:47:12Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/822", "timeline": [{"oid": "6059cf210abc5e795003211eda6a295311435603", "url": "https://github.com/CMSgov/dpc-app/commit/6059cf210abc5e795003211eda6a295311435603", "message": "add auth related logging filter", "committedDate": "2020-05-28T02:39:51Z", "type": "commit"}, {"oid": "4e6879d7695179430910211384d610b243f82516", "url": "https://github.com/CMSgov/dpc-app/commit/4e6879d7695179430910211384d610b243f82516", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string", "committedDate": "2020-05-28T02:48:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNTIyNg==", "url": "https://github.com/CMSgov/dpc-app/pull/822#discussion_r432015226", "bodyText": "Could we make this client_assertion (singular) since that's likely the name for the parameter? Or maybe include both to show that client_assertion anywhere is rejected.", "author": "em1", "createdAt": "2020-05-28T17:48:15Z", "path": "dpc-common/src/test/java/gov/cms/dpc/common/logging/filters/AuthRelatedLoggingFilterTest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package gov.cms.dpc.common.logging.filters;\n+\n+\n+import ch.qos.logback.access.spi.IAccessEvent;\n+import ch.qos.logback.core.filter.Filter;\n+import ch.qos.logback.core.spi.FilterReply;\n+import io.dropwizard.logging.filter.FilterFactory;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.mockito.Mockito;\n+\n+import java.util.stream.Stream;\n+\n+public class AuthRelatedLoggingFilterTest {\n+\n+    private Filter<IAccessEvent> filter;\n+    private IAccessEvent event = Mockito.mock(IAccessEvent.class);\n+\n+    @BeforeEach\n+    public void setUp() {\n+        FilterFactory<IAccessEvent> filterFactory = new AuthRelatedLoggingFilter();\n+        filter = filterFactory.build();\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"stringSource\")\n+    public void testQueryString(String queryString, FilterReply expectedReply) {\n+        Mockito.when(event.getQueryString()).thenReturn(queryString);\n+        FilterReply reply = filter.decide(event);\n+        Assertions.assertEquals(expectedReply, reply);\n+    }\n+\n+    private static Stream<Arguments> stringSource() {\n+        return Stream.of(\n+                Arguments.of(\"client_assertions=secret_token\", FilterReply.DENY),", "originalCommit": "4e6879d7695179430910211384d610b243f82516", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA4NjE3MA==", "url": "https://github.com/CMSgov/dpc-app/pull/822#discussion_r432086170", "bodyText": "ah good catch, I even copied it from the token resource so I have no idea how an s got appended lol", "author": "MrBilnon", "createdAt": "2020-05-28T19:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNTIyNg=="}], "type": "inlineReview", "revised_code": {"commit": "dbf2be14edb92bd74d9b237a15f9749dbf02447d", "chunk": "diff --git a/dpc-common/src/test/java/gov/cms/dpc/common/logging/filters/AuthRelatedLoggingFilterTest.java b/dpc-common/src/test/java/gov/cms/dpc/common/logging/filters/AuthRelatedLoggingFilterTest.java\nindex 5591bc6a..b5bf42dd 100644\n--- a/dpc-common/src/test/java/gov/cms/dpc/common/logging/filters/AuthRelatedLoggingFilterTest.java\n+++ b/dpc-common/src/test/java/gov/cms/dpc/common/logging/filters/AuthRelatedLoggingFilterTest.java\n\n@@ -37,6 +37,8 @@ public class AuthRelatedLoggingFilterTest {\n         return Stream.of(\n                 Arguments.of(\"client_assertions=secret_token\", FilterReply.DENY),\n                 Arguments.of(\"someotherstuff=stuff&client_assertions=secret_token\", FilterReply.DENY),\n+                Arguments.of(\"client_assertion=secret_token\", FilterReply.DENY),\n+                Arguments.of(\"someotherstuff=stuff&client_assertion=secret_token\", FilterReply.DENY),\n                 Arguments.of(\"someotherstuff=stuff\", FilterReply.NEUTRAL)\n         );\n     }\n"}}, {"oid": "dbf2be14edb92bd74d9b237a15f9749dbf02447d", "url": "https://github.com/CMSgov/dpc-app/commit/dbf2be14edb92bd74d9b237a15f9749dbf02447d", "message": "add test cases for client_assertion (singular)", "committedDate": "2020-05-28T21:50:29Z", "type": "commit"}, {"oid": "ee7dcb93e5d386a09b279968022defd744e41d7f", "url": "https://github.com/CMSgov/dpc-app/commit/ee7dcb93e5d386a09b279968022defd744e41d7f", "message": "Merge remote-tracking branch 'origin/DPC-162-filter-out-jwt-tokens-in-query-string' into DPC-162-filter-out-jwt-tokens-in-query-string", "committedDate": "2020-05-28T21:51:13Z", "type": "commit"}, {"oid": "a96c032524d7162ebf97d343e111e264297fd312", "url": "https://github.com/CMSgov/dpc-app/commit/a96c032524d7162ebf97d343e111e264297fd312", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string", "committedDate": "2020-06-01T20:10:38Z", "type": "commit"}, {"oid": "633688d9aa176c48a0e0fba416bdf77685d23f4a", "url": "https://github.com/CMSgov/dpc-app/commit/633688d9aa176c48a0e0fba416bdf77685d23f4a", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string", "committedDate": "2020-06-02T05:26:15Z", "type": "commit"}, {"oid": "a8fd9edc2ee234658baa11c85bdd02105d57c075", "url": "https://github.com/CMSgov/dpc-app/commit/a8fd9edc2ee234658baa11c85bdd02105d57c075", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string", "committedDate": "2020-06-02T19:54:21Z", "type": "commit"}, {"oid": "414b24eac336280f0d667e194157755de767fb59", "url": "https://github.com/CMSgov/dpc-app/commit/414b24eac336280f0d667e194157755de767fb59", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string", "committedDate": "2020-06-04T15:32:15Z", "type": "commit"}]}