{"pr_number": 809, "pr_title": "fix smoke tests", "pr_createdAt": "2020-05-20T04:36:09Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/809", "timeline": [{"oid": "86cd1bf3b9ef92e12364ced0541375d9ec103e4a", "url": "https://github.com/CMSgov/dpc-app/commit/86cd1bf3b9ef92e12364ced0541375d9ec103e4a", "message": "fix smoke tests", "committedDate": "2020-05-20T04:31:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMDQwOA==", "url": "https://github.com/CMSgov/dpc-app/pull/809#discussion_r428000408", "bodyText": "What kinds of exceptions are possible here? Anything worth logging (even if just at DEBUG level)?", "author": "em1", "createdAt": "2020-05-20T13:16:05Z", "path": "dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java", "diffHunk": "@@ -127,6 +128,19 @@ public static String createGoldenMacaroon(String taskURL) throws IOException {\n         }\n     }\n \n+    public static String generateNPI() {\n+        int randomNumber = (int) Math.floor(Math.random()*(999999999-100000000+1)+100000000);\n+        String checkDigit = null;\n+        do {\n+            try {\n+                checkDigit = LuhnCheckDigit.LUHN_CHECK_DIGIT.calculate(String.valueOf(randomNumber));\n+            } catch (Exception e) {\n+                //do nothing", "originalCommit": "86cd1bf3b9ef92e12364ced0541375d9ec103e4a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1af4a470f7fd08165216536c3d0dd63498720c69", "chunk": "diff --git a/dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java b/dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java\nindex 1ad9e48e..6f27cee4 100644\n--- a/dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java\n+++ b/dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java\n\n@@ -135,7 +137,7 @@ public class FHIRHelpers {\n             try {\n                 checkDigit = LuhnCheckDigit.LUHN_CHECK_DIGIT.calculate(String.valueOf(randomNumber));\n             } catch (Exception e) {\n-                //do nothing\n+                logger.debug(\"Failed to generate check digit for: {}, trying again\", randomNumber);\n             }\n         } while (checkDigit == null);\n         return randomNumber + checkDigit;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMTE2MQ==", "url": "https://github.com/CMSgov/dpc-app/pull/809#discussion_r428001161", "bodyText": "Could we call this npi so no one mistakes it for a constant?", "author": "em1", "createdAt": "2020-05-20T13:17:04Z", "path": "dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java", "diffHunk": "@@ -138,7 +138,8 @@ public SampleResult runTest(JavaSamplerContext javaSamplerContext) {\n \n             orgRegistrationResult.sampleStart();\n             try {\n-                clientToken = FHIRHelpers.registerOrganization(adminClient, ctx.newJsonParser(), organizationID, \"1121111110\",adminURL);\n+                String NPI = FHIRHelpers.generateNPI();", "originalCommit": "86cd1bf3b9ef92e12364ced0541375d9ec103e4a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1af4a470f7fd08165216536c3d0dd63498720c69", "chunk": "diff --git a/dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java b/dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java\nindex ee92ecbb..4472afef 100644\n--- a/dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java\n+++ b/dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java\n\n@@ -138,8 +138,8 @@ public class SmokeTest extends AbstractJavaSamplerClient {\n \n             orgRegistrationResult.sampleStart();\n             try {\n-                String NPI = FHIRHelpers.generateNPI();\n-                clientToken = FHIRHelpers.registerOrganization(adminClient, ctx.newJsonParser(), organizationID, NPI ,adminURL);\n+                String npi = FHIRHelpers.generateNPI();\n+                clientToken = FHIRHelpers.registerOrganization(adminClient, ctx.newJsonParser(), organizationID, npi ,adminURL);\n                 orgRegistrationResult.setSuccessful(true);\n             } catch (Exception e) {\n                 orgRegistrationResult.setSuccessful(false);\n"}}, {"oid": "1af4a470f7fd08165216536c3d0dd63498720c69", "url": "https://github.com/CMSgov/dpc-app/commit/1af4a470f7fd08165216536c3d0dd63498720c69", "message": "change variable to lower case and add log statement to generateNPI", "committedDate": "2020-05-20T14:27:28Z", "type": "commit"}, {"oid": "a5c52b36618869a031c39e56ea9fdef1b3ac313b", "url": "https://github.com/CMSgov/dpc-app/commit/a5c52b36618869a031c39e56ea9fdef1b3ac313b", "message": "Merge branch 'master' into fix-smoke-tests", "committedDate": "2020-05-20T18:06:53Z", "type": "commit"}, {"oid": "e77d0e72b24b49fda4b761629db9e038e55a1930", "url": "https://github.com/CMSgov/dpc-app/commit/e77d0e72b24b49fda4b761629db9e038e55a1930", "message": "oops, generate correct NPI", "committedDate": "2020-05-21T01:45:25Z", "type": "commit"}, {"oid": "081625c8a0b37bc62f6a754ed1e3c256d794e942", "url": "https://github.com/CMSgov/dpc-app/commit/081625c8a0b37bc62f6a754ed1e3c256d794e942", "message": "renamed NPIValidationUtil to NPIUtil and moved generate NPI to NPIUtil", "committedDate": "2020-05-21T02:47:36Z", "type": "commit"}, {"oid": "82b4d216f28f4fc6cb747134c5e0fd50d49bafb9", "url": "https://github.com/CMSgov/dpc-app/commit/82b4d216f28f4fc6cb747134c5e0fd50d49bafb9", "message": "Merge branch 'master' into fix-smoke-tests", "committedDate": "2020-05-21T18:45:41Z", "type": "commit"}, {"oid": "e33a854d4f4c027964a6456365c562fb2372cc9f", "url": "https://github.com/CMSgov/dpc-app/commit/e33a854d4f4c027964a6456365c562fb2372cc9f", "message": "Merge branch 'master' into fix-smoke-tests", "committedDate": "2020-05-21T20:02:48Z", "type": "commit"}]}