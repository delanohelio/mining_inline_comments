{"pr_number": 4528, "pr_title": "Support TLSv1.3", "pr_createdAt": "2020-07-13T10:54:08Z", "pr_url": "https://github.com/eclipse-ee4j/jersey/pull/4528", "timeline": [{"oid": "8cd38a37d5ae4ec06be8beb625c2576fb1466d34", "url": "https://github.com/eclipse-ee4j/jersey/commit/8cd38a37d5ae4ec06be8beb625c2576fb1466d34", "message": "Support TLSv 1.3\n\nSigned-off-by: Jorge Bescos Gascon <jorge.bescos.gascon@oracle.com>", "committedDate": "2020-07-13T11:27:56Z", "type": "commit"}, {"oid": "8cd38a37d5ae4ec06be8beb625c2576fb1466d34", "url": "https://github.com/eclipse-ee4j/jersey/commit/8cd38a37d5ae4ec06be8beb625c2576fb1466d34", "message": "Support TLSv 1.3\n\nSigned-off-by: Jorge Bescos Gascon <jorge.bescos.gascon@oracle.com>", "committedDate": "2020-07-13T11:27:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDU0Mg==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4528#discussion_r458120542", "bodyText": "I would advice to move direct text into localization.properties and use LocalizableMessageFactory instead.", "author": "senivam", "createdAt": "2020-07-21T14:01:35Z", "path": "connectors/jdk-connector/src/main/java/org/glassfish/jersey/jdk/connector/internal/SslFilter.java", "diffHunk": "@@ -416,12 +419,8 @@ private boolean doHandshakeStep(ByteBuffer networkData) {\n                         }\n \n                         case FINISHED: {\n-                            /* According to SSLEngine javadoc FINISHED status can be returned only in SSLEngineResult,\n-                            but just to make sure we don't end up in an infinite loop when presented with an SSLEngine\n-                            implementation that does not respect this:*/\n-                            stepFinished = true;\n-                            handshakeFinished = true;\n-                            break;\n+                            throw new IllegalStateException(\"Trying to handshake, but SSL engine not in HANDSHAKING state.\"", "originalCommit": "8cd38a37d5ae4ec06be8beb625c2576fb1466d34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY3NDUxNg==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4528#discussion_r458674516", "bodyText": "@senivam although that is unreachable (in theory), I decided to keep it as it was. It will not throw exception.\nI added the localization property for the case of NOT_HANDSHAKING, because it was throwing the same exception.\nI also modified the test to force to test all supported SSL protocols. For the case of JDK11 the TLSv13 is included.", "author": "jbescos", "createdAt": "2020-07-22T09:52:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY5NjA3OA==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4528#discussion_r458696078", "bodyText": "I just verified with Wireshark that we need to execute the tests in different JVMs. So I had to set <reuseForks>false</reuseForks> and move each protocol to a different test class. It seems when you use @Parametrized tests are executed in the same JVM.", "author": "jbescos", "createdAt": "2020-07-22T10:32:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDU0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "25ce79c47ea27ea44928e3919976fbd9d5a863c1", "chunk": "diff --git a/connectors/jdk-connector/src/main/java/org/glassfish/jersey/jdk/connector/internal/SslFilter.java b/connectors/jdk-connector/src/main/java/org/glassfish/jersey/jdk/connector/internal/SslFilter.java\nindex a2af601df..85f4541f5 100644\n--- a/connectors/jdk-connector/src/main/java/org/glassfish/jersey/jdk/connector/internal/SslFilter.java\n+++ b/connectors/jdk-connector/src/main/java/org/glassfish/jersey/jdk/connector/internal/SslFilter.java\n\n@@ -413,14 +413,16 @@ class SslFilter extends Filter<ByteBuffer, ByteBuffer, ByteBuffer, ByteBuffer> {\n                             /* This should never happen. If we are here and not handshaking, it means a bug\n                             in the state machine of this class, because we stopped handshaking and did not exit this while loop.\n                             The could be caused either by overlooking FINISHED state or incorrectly treating an error. */\n-\n-                            throw new IllegalStateException(\"Trying to handshake, but SSL engine not in HANDSHAKING state.\"\n-                                    + \"SSL filter state: \\n\" + getDebugState());\n+                            throw new IllegalStateException(\n+                                    LocalizationMessages.HTTP_CONNECTION_INVALID_HANDSHAKE_STATUS(getDebugState()));\n                         }\n-\n                         case FINISHED: {\n-                            throw new IllegalStateException(\"Trying to handshake, but SSL engine not in HANDSHAKING state.\"\n-                                    + \"SSL filter state: \\n\" + getDebugState());\n+                            /* According to SSLEngine javadoc FINISHED status can be returned only in SSLEngineResult,\n+                            but just to make sure we don't end up in an infinite loop when presented with an SSLEngine\n+                            implementation that does not respect this:*/\n+                            stepFinished = true;\n+                            handshakeFinished = true;\n+                            break;\n                         }\n                         // needs to write data to the network\n                         case NEED_WRAP: {\n"}}, {"oid": "25ce79c47ea27ea44928e3919976fbd9d5a863c1", "url": "https://github.com/eclipse-ee4j/jersey/commit/25ce79c47ea27ea44928e3919976fbd9d5a863c1", "message": "Adding test for each supported SSL protocol\n\nSigned-off-by: Jorge Bescos Gascon <jorge.bescos.gascon@oracle.com>", "committedDate": "2020-07-22T09:42:48Z", "type": "commit"}, {"oid": "ca67208c3a83644fce40fe84f07b69603a8acb09", "url": "https://github.com/eclipse-ee4j/jersey/commit/ca67208c3a83644fce40fe84f07b69603a8acb09", "message": "Each test needs to be executed in different JVM\n\nSigned-off-by: Jorge Bescos Gascon <jorge.bescos.gascon@oracle.com>", "committedDate": "2020-07-22T10:30:27Z", "type": "commit"}, {"oid": "a6a1a7ba663afffdb91e03164e873026126bd24f", "url": "https://github.com/eclipse-ee4j/jersey/commit/a6a1a7ba663afffdb91e03164e873026126bd24f", "message": "Fix copyright\n\nSigned-off-by: Jorge Bescos Gascon <jorge.bescos.gascon@oracle.com>", "committedDate": "2020-07-24T10:07:04Z", "type": "commit"}]}