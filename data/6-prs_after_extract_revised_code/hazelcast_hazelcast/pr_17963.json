{"pr_number": 17963, "pr_title": "Improve ClientFailoverConfig documentation", "pr_createdAt": "2020-12-10T12:29:47Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17963", "timeline": [{"oid": "a71951f27bbcc102fdc87ce7cd919f2bede6b725", "url": "https://github.com/hazelcast/hazelcast/commit/a71951f27bbcc102fdc87ce7cd919f2bede6b725", "message": "Improve ClientFailoverConfig documentation", "committedDate": "2020-12-10T12:28:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MDU0Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540740543", "bodyText": "@puzpuzpuz First of all, thanks for the pr. Not sure how did I miss Javadoc on a public API.\nIt did not understand what you mean by client element.\nAnd I think we explain much more here. The term connection retries can easily confuse users. Similarly I would replace the same term in the javadoc of getTryCount.\nA suggestion from me:\nSets the count of attempts to connect to a cluster. For each alternative cluster, a client will try to connect to the cluster respecting related ConnectionRetryConfig. When the client can not connect a cluster, it will try to connect tryCount times going over the alternative client configs in a round-robin session.\nThis is triggered at the start and also when the client disconnects from the cluster and can not connect back to it by exhausting attempts described in ConnectionRetryConfig. In that case, the client will continue from where it is left off in ClientConfig lists, and try the next one again in round-robin tryCount times.", "author": "sancar", "createdAt": "2020-12-11T07:22:47Z", "path": "hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java", "diffHunk": "@@ -79,27 +93,62 @@ public static ClientFailoverConfig load() {\n         }\n     }\n \n+    /**\n+     * Adds the client config to the end of the alternative client configurations list.\n+     *\n+     * @param clientConfig the ClientConfig to add\n+     * @return this for chaining\n+     */\n     public ClientFailoverConfig addClientConfig(ClientConfig clientConfig) {\n         validateClientConfig(clientConfig);\n         clientConfigs.add(clientConfig);\n         return this;\n     }\n \n+    /**\n+     * Sets the count of connection retries by the client to the alternative clusters.\n+     * <p>\n+     * When this value is reached and the client still could not connect to a cluster,\n+     * the client shuts down. Note that this value applies to the alternative clusters\n+     * whose configurations are provided with the client element.", "originalCommit": "a71951f27bbcc102fdc87ce7cd919f2bede6b725", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MjkzOA==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540742938", "bodyText": "It did not understand what you mean by client element.\n\nThat's a 1-to-1 copy from our ref manual. See: https://docs.hazelcast.org/docs/latest/manual/html-single/index.html#configuring-without-cname\nI'm going to apply proposed changes, but the same should be done with the ref manual, I guess. cc @Serdaro", "author": "puzpuzpuz", "createdAt": "2020-12-11T07:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MDU0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0NDAyMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540744022", "bodyText": "Addressed in 98cb759", "author": "puzpuzpuz", "createdAt": "2020-12-11T07:31:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MDU0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0OTc2NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540749765", "bodyText": "I see. the meaning of the client element makes sense since it is talking about the client tag in the XML.\nAfter reading the reference manual, I have realized that tryCount means trying the whole list tryCount times.\nAfter that, I read my suggestion, and not sure if I could make it clear also.", "author": "sancar", "createdAt": "2020-12-11T07:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MDU0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "cf58f0389c8c153e560c5932366c5efcdc354fb4", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java b/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\nindex 3269b88ce1..fdecd1bb04 100644\n--- a/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\n+++ b/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\n\n@@ -106,13 +106,21 @@ public class ClientFailoverConfig {\n     }\n \n     /**\n-     * Sets the count of connection retries by the client to the alternative clusters.\n+     * Sets the count of attempts to connect to a cluster. For each alternative cluster,\n+     * the client will try to connect to the cluster respecting related ConnectionRetryConfig.\n      * <p>\n-     * When this value is reached and the client still could not connect to a cluster,\n-     * the client shuts down. Note that this value applies to the alternative clusters\n-     * whose configurations are provided with the client element.\n+     * When the client can not connect a cluster, it will try to connect tryCount times going\n+     * over the alternative client configs in a round-robin fashion. This is triggered at the\n+     * start and also when the client disconnects from the cluster and can not connect back\n+     * to it by exhausting attempts described in ConnectionRetryConfig. In that case,\n+     * the client will continue from where it is left off in ClientConfig lists, and try\n+     * the next one again in round-robin tryCount times.\n+     * <p>\n+     * For example, if two alternative clusters are given in the ClientConfig list and\n+     * the tryCount is set as 4, the maximum number of subsequent connection attempts done\n+     * by the client is 4 x 2 = 8.\n      *\n-     * @param tryCount the number of attempts\n+     * @param tryCount the count of attempts\n      * @return this for chaining\n      */\n     public ClientFailoverConfig setTryCount(int tryCount) {\n"}}, {"oid": "cf58f0389c8c153e560c5932366c5efcdc354fb4", "url": "https://github.com/hazelcast/hazelcast/commit/cf58f0389c8c153e560c5932366c5efcdc354fb4", "message": "Address review comments", "committedDate": "2020-12-11T07:52:33Z", "type": "commit"}, {"oid": "cf58f0389c8c153e560c5932366c5efcdc354fb4", "url": "https://github.com/hazelcast/hazelcast/commit/cf58f0389c8c153e560c5932366c5efcdc354fb4", "message": "Address review comments", "committedDate": "2020-12-11T07:52:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwMzQxOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540803419", "bodyText": "Looking at the implementation, it seems that clusterName also does not have to match", "author": "mdumandag", "createdAt": "2020-12-11T09:20:56Z", "path": "hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java", "diffHunk": "@@ -31,18 +31,32 @@\n import static com.hazelcast.client.config.ClientConnectionStrategyConfig.ReconnectMode.OFF;\n \n /**\n- * Config class to configure multiple client configs to be used by single client instance\n- * The client will try to connect them in given order.\n- * When the connected cluster fails or the client blacklisted from the cluster via the management center, the client will\n+ * Config class to configure multiple client configs to be used by single client instance.\n+ * The client will try to connect them in given order. When the connected cluster fails\n+ * or the client blacklisted from the cluster via the Management Center, the client will\n  * search for alternative clusters with given configs.\n+ * <p>\n+ * The client configurations must be exactly the same except the following configuration options:", "originalCommit": "cf58f0389c8c153e560c5932366c5efcdc354fb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg2MjM4MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540862380", "bodyText": "Yes, you're right. I took the list from the ref manual. cc @Serdaro", "author": "puzpuzpuz", "createdAt": "2020-12-11T10:55:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwMzQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg2MzcyMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540863723", "bodyText": "Addressed in ce976c3", "author": "puzpuzpuz", "createdAt": "2020-12-11T10:57:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwMzQxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "ce976c31e4e9bd3a6920d42540a62fcdd12b1f83", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java b/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\nindex fdecd1bb04..1c19602230 100644\n--- a/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\n+++ b/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\n\n@@ -38,6 +38,7 @@ import static com.hazelcast.client.config.ClientConnectionStrategyConfig.Reconne\n  * <p>\n  * The client configurations must be exactly the same except the following configuration options:\n  * <ul>\n+ * <li>{@code clusterName}</li>\n  * <li>{@code SecurityConfig}</li>\n  * <li>{@code NetworkConfig.Addresses}</li>\n  * <li>{@code NetworkConfig.SocketInterceptorConfig}</li>\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwNTY1NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540805654", "bodyText": "Not related to these changes, but while you are on it, could you also fix the line here https://github.com/hazelcast/hazelcast/blob/master/hazelcast/src/main/java/com/hazelcast/client/impl/clientside/FailoverClientConfigSupport.java#L228\nIt should be something like network:outboundPorts instead of network:smartRouting", "author": "mdumandag", "createdAt": "2020-12-11T09:24:26Z", "path": "hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java", "diffHunk": "@@ -31,18 +31,32 @@\n import static com.hazelcast.client.config.ClientConnectionStrategyConfig.ReconnectMode.OFF;", "originalCommit": "cf58f0389c8c153e560c5932366c5efcdc354fb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg2MzY4MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17963#discussion_r540863680", "bodyText": "Sure. Addressed in ce976c3", "author": "puzpuzpuz", "createdAt": "2020-12-11T10:57:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwNTY1NA=="}], "type": "inlineReview", "revised_code": {"commit": "ce976c31e4e9bd3a6920d42540a62fcdd12b1f83", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java b/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\nindex fdecd1bb04..1c19602230 100644\n--- a/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\n+++ b/hazelcast/src/main/java/com/hazelcast/client/config/ClientFailoverConfig.java\n\n@@ -38,6 +38,7 @@ import static com.hazelcast.client.config.ClientConnectionStrategyConfig.Reconne\n  * <p>\n  * The client configurations must be exactly the same except the following configuration options:\n  * <ul>\n+ * <li>{@code clusterName}</li>\n  * <li>{@code SecurityConfig}</li>\n  * <li>{@code NetworkConfig.Addresses}</li>\n  * <li>{@code NetworkConfig.SocketInterceptorConfig}</li>\n"}}, {"oid": "ce976c31e4e9bd3a6920d42540a62fcdd12b1f83", "url": "https://github.com/hazelcast/hazelcast/commit/ce976c31e4e9bd3a6920d42540a62fcdd12b1f83", "message": "Address review comments", "committedDate": "2020-12-11T10:57:09Z", "type": "commit"}]}