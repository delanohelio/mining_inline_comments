{"pr_number": 16683, "pr_title": "Create less objects during metrics scan ", "pr_createdAt": "2020-02-25T10:24:38Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/16683", "timeline": [{"oid": "fc072b56fbe4eb6040dd6d9131b14ab6baf6288d", "url": "https://github.com/hazelcast/hazelcast/commit/fc072b56fbe4eb6040dd6d9131b14ab6baf6288d", "message": "Create less objects during metrics scan", "committedDate": "2020-02-25T11:25:35Z", "type": "forcePushed"}, {"oid": "fc13cb1efcb4da6ce17943b31eb913a311d9e292", "url": "https://github.com/hazelcast/hazelcast/commit/fc13cb1efcb4da6ce17943b31eb913a311d9e292", "message": "Create less objects during metrics scan", "committedDate": "2020-02-25T12:51:47Z", "type": "forcePushed"}, {"oid": "a5a1bf3674aa810f5646ddbdcb37f6629c9237e8", "url": "https://github.com/hazelcast/hazelcast/commit/a5a1bf3674aa810f5646ddbdcb37f6629c9237e8", "message": "Create less objects during metrics scan", "committedDate": "2020-02-25T14:41:33Z", "type": "forcePushed"}, {"oid": "c012beabf3a6f049cf1404f3a2a011bba3f80fe4", "url": "https://github.com/hazelcast/hazelcast/commit/c012beabf3a6f049cf1404f3a2a011bba3f80fe4", "message": "Create less objects during metrics scan", "committedDate": "2020-02-26T11:58:03Z", "type": "forcePushed"}, {"oid": "6691fc6c6ec30f9dcad94d1b93622fb6385c3474", "url": "https://github.com/hazelcast/hazelcast/commit/6691fc6c6ec30f9dcad94d1b93622fb6385c3474", "message": "Create less objects during metrics scan", "committedDate": "2020-02-26T12:06:23Z", "type": "forcePushed"}, {"oid": "7cf44f3822ee606a4219b4d727e0d8ed9ad39f37", "url": "https://github.com/hazelcast/hazelcast/commit/7cf44f3822ee606a4219b4d727e0d8ed9ad39f37", "message": "Create less objects during metrics scan", "committedDate": "2020-02-26T12:56:13Z", "type": "forcePushed"}, {"oid": "91d371e46002d7f9a323b13b89bd4d4631929735", "url": "https://github.com/hazelcast/hazelcast/commit/91d371e46002d7f9a323b13b89bd4d4631929735", "message": "Create less objects during metrics scan", "committedDate": "2020-02-26T15:31:28Z", "type": "forcePushed"}, {"oid": "3f0e47a3ef632bc9112634136750dfd617dd504e", "url": "https://github.com/hazelcast/hazelcast/commit/3f0e47a3ef632bc9112634136750dfd617dd504e", "message": "Create less objects during metrics scan", "committedDate": "2020-02-26T22:10:27Z", "type": "forcePushed"}, {"oid": "13e46d647020f2920275325599bf7f5d274bc525", "url": "https://github.com/hazelcast/hazelcast/commit/13e46d647020f2920275325599bf7f5d274bc525", "message": "Create less objects during metrics scan", "committedDate": "2020-02-27T13:12:04Z", "type": "forcePushed"}, {"oid": "76e3b9d6e1167c98fd1ce73fcc4decd032e541aa", "url": "https://github.com/hazelcast/hazelcast/commit/76e3b9d6e1167c98fd1ce73fcc4decd032e541aa", "message": "Create less objects during metrics scan", "committedDate": "2020-02-27T13:35:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI2NDI5Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/16683#discussion_r386264297", "bodyText": "Can't we create many arrays with this change if there are high partition counts? Maybe we should calculate the size upfront.", "author": "blazember", "createdAt": "2020-03-02T08:59:28Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/partition/impl/InternalPartitionServiceImpl.java", "diffHunk": "@@ -982,7 +981,7 @@ public PartitionReplicaVersionManager getPartitionReplicaVersionManager() {\n \n     @Override\n     public List<Integer> getMemberPartitions(Address target) {\n-        List<Integer> ownedPartitions = new LinkedList<>();\n+        List<Integer> ownedPartitions = new ArrayList<>();", "originalCommit": "76e3b9d6e1167c98fd1ce73fcc4decd032e541aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzOTUxMw==", "url": "https://github.com/hazelcast/hazelcast/pull/16683#discussion_r386339513", "bodyText": "Reverted this change, seems a left over.", "author": "ahmetmircik", "createdAt": "2020-03-02T11:29:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI2NDI5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "12dfd6c986f462bbfdee3a9396c5b6eaefd61702", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/internal/partition/impl/InternalPartitionServiceImpl.java b/hazelcast/src/main/java/com/hazelcast/internal/partition/impl/InternalPartitionServiceImpl.java\nindex 3453412f1cf..f18b3f20d77 100644\n--- a/hazelcast/src/main/java/com/hazelcast/internal/partition/impl/InternalPartitionServiceImpl.java\n+++ b/hazelcast/src/main/java/com/hazelcast/internal/partition/impl/InternalPartitionServiceImpl.java\n\n@@ -981,7 +982,7 @@ public class InternalPartitionServiceImpl implements InternalPartitionService,\n \n     @Override\n     public List<Integer> getMemberPartitions(Address target) {\n-        List<Integer> ownedPartitions = new ArrayList<>();\n+        List<Integer> ownedPartitions = new LinkedList<>();\n         for (int i = 0; i < partitionCount; i++) {\n             final Address owner = getPartitionOwner(i);\n             if (target.equals(owner)) {\n"}}, {"oid": "a9641a7d197ae2ddd2f6d744714749fab22301fc", "url": "https://github.com/hazelcast/hazelcast/commit/a9641a7d197ae2ddd2f6d744714749fab22301fc", "message": "Create less objects during metrics scan", "committedDate": "2020-03-02T11:27:11Z", "type": "commit"}, {"oid": "12dfd6c986f462bbfdee3a9396c5b6eaefd61702", "url": "https://github.com/hazelcast/hazelcast/commit/12dfd6c986f462bbfdee3a9396c5b6eaefd61702", "message": "address reviews", "committedDate": "2020-03-02T11:28:37Z", "type": "commit"}, {"oid": "12dfd6c986f462bbfdee3a9396c5b6eaefd61702", "url": "https://github.com/hazelcast/hazelcast/commit/12dfd6c986f462bbfdee3a9396c5b6eaefd61702", "message": "address reviews", "committedDate": "2020-03-02T11:28:37Z", "type": "forcePushed"}]}