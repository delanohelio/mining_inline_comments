{"pr_number": 16860, "pr_title": "Kerberos authentication method added.", "pr_createdAt": "2020-04-07T14:24:17Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/16860", "timeline": [{"oid": "d9c0d23dcd0d9d3c2921f8d30b867fabe0177379", "url": "https://github.com/hazelcast/hazelcast/commit/d9c0d23dcd0d9d3c2921f8d30b867fabe0177379", "message": "Kerberos authentication method added.", "committedDate": "2020-04-09T10:16:56Z", "type": "commit"}, {"oid": "d9c0d23dcd0d9d3c2921f8d30b867fabe0177379", "url": "https://github.com/hazelcast/hazelcast/commit/d9c0d23dcd0d9d3c2921f8d30b867fabe0177379", "message": "Kerberos authentication method added.", "committedDate": "2020-04-09T10:16:56Z", "type": "forcePushed"}, {"oid": "da25d9967f286683a4254c5db89e1ea09da4ef31", "url": "https://github.com/hazelcast/hazelcast/commit/da25d9967f286683a4254c5db89e1ea09da4ef31", "message": "Unrelated checkstyle fix", "committedDate": "2020-04-09T10:51:39Z", "type": "commit"}, {"oid": "da25d9967f286683a4254c5db89e1ea09da4ef31", "url": "https://github.com/hazelcast/hazelcast/commit/da25d9967f286683a4254c5db89e1ea09da4ef31", "message": "Unrelated checkstyle fix", "committedDate": "2020-04-09T10:51:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM5MzQxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/16860#discussion_r407393416", "bodyText": "Why do we print a secret systemUserPassword here?", "author": "galibey", "createdAt": "2020-04-13T09:16:19Z", "path": "hazelcast/src/main/java/com/hazelcast/config/security/LdapAuthenticationConfig.java", "diffHunk": "@@ -228,85 +232,85 @@ public LdapAuthenticationConfig setUserSearchScope(LdapSearchScope userSearchSco\n         setIfConfigured(props, \"roleSearchScope\", roleSearchScope);\n         setIfConfigured(props, \"userNameAttribute\", userNameAttribute);\n \n-        if (useSystemUser) {\n+        if (!isNullOrEmpty(systemUserDn)) {\n             props.setProperty(Context.SECURITY_AUTHENTICATION, \"simple\");\n             props.setProperty(Context.SECURITY_PRINCIPAL, systemUserDn);\n             setIfConfigured(props, Context.SECURITY_CREDENTIALS, systemUserPassword);\n             setIfConfigured(props, \"passwordAttribute\", passwordAttribute);\n             setIfConfigured(props, \"userContext\", userContext);\n             setIfConfigured(props, \"userFilter\", userFilter);\n             setIfConfigured(props, \"userSearchScope\", userSearchScope);\n+            setIfConfigured(props, \"skipAuthentication\", skipAuthentication);\n         }\n+        return props;\n+    }\n+\n+    @Override\n+    public LoginModuleConfig[] asLoginModuleConfigs() {\n+        boolean useSystemUser = !isNullOrEmpty(systemUserDn);\n+        LoginModuleConfig loginModuleConfig = new LoginModuleConfig(\n+                useSystemUser ? \"com.hazelcast.security.loginimpl.LdapLoginModule\"\n+                        : \"com.hazelcast.security.loginimpl.BasicLdapLoginModule\",\n+                LoginModuleUsage.REQUIRED);\n+\n+        loginModuleConfig.setProperties(initLoginModuleProperties());\n \n         return new LoginModuleConfig[] { loginModuleConfig };\n     }\n \n     @Override\n     public String toString() {\n-        return \"LdapAuthenticationConfig [url=\" + url + \", socketFactoryClassName=\" + socketFactoryClassName + \", systemUserDN=\"\n-                + systemUserDn + \", systemUserPassword=***, parseDN=\" + parseDn + \", roleContext=\"\n+        return \"LdapAuthenticationConfig [url=\" + url + \", socketFactoryClassName=\" + socketFactoryClassName + \", systemUserDn=\"\n+                + systemUserDn + \", systemUserPassword=\" + systemUserPassword + \", parseDn=\" + parseDn + \", roleContext=\"", "originalCommit": "da25d9967f286683a4254c5db89e1ea09da4ef31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgzODY3NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/16860#discussion_r408838675", "bodyText": "Nice catch. I'll fix it. It was caused by regenerating the toString method in the Eclipse IDE.", "author": "kwart", "createdAt": "2020-04-15T13:25:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM5MzQxNg=="}], "type": "inlineReview", "revised_code": {"commit": "1e456d75dc527260f502e3fca0a2ff4fcb87cda5", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/config/security/LdapAuthenticationConfig.java b/hazelcast/src/main/java/com/hazelcast/config/security/LdapAuthenticationConfig.java\nindex 0c347ba81aa..84ebcafaa2f 100644\n--- a/hazelcast/src/main/java/com/hazelcast/config/security/LdapAuthenticationConfig.java\n+++ b/hazelcast/src/main/java/com/hazelcast/config/security/LdapAuthenticationConfig.java\n\n@@ -261,7 +261,7 @@ public class LdapAuthenticationConfig extends AbstractClusterLoginConfig<LdapAut\n     @Override\n     public String toString() {\n         return \"LdapAuthenticationConfig [url=\" + url + \", socketFactoryClassName=\" + socketFactoryClassName + \", systemUserDn=\"\n-                + systemUserDn + \", systemUserPassword=\" + systemUserPassword + \", parseDn=\" + parseDn + \", roleContext=\"\n+                + systemUserDn + \", systemUserPassword=***, parseDn=\" + parseDn + \", roleContext=\"\n                 + roleContext + \", roleFilter=\" + roleFilter + \", roleMappingAttribute=\" + roleMappingAttribute\n                 + \", roleMappingMode=\" + roleMappingMode + \", roleNameAttribute=\" + roleNameAttribute\n                 + \", roleRecursionMaxDepth=\" + roleRecursionMaxDepth + \", roleSearchScope=\" + roleSearchScope\n"}}, {"oid": "1e456d75dc527260f502e3fca0a2ff4fcb87cda5", "url": "https://github.com/hazelcast/hazelcast/commit/1e456d75dc527260f502e3fca0a2ff4fcb87cda5", "message": "Fix password masking in LdapAuthenticationConfig", "committedDate": "2020-04-15T13:32:02Z", "type": "commit"}]}