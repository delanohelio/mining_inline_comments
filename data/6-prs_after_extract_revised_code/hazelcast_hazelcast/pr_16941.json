{"pr_number": 16941, "pr_title": "Send all the Diagnostics logs to the stdout, instead of local files", "pr_createdAt": "2020-04-29T12:35:04Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/16941", "timeline": [{"oid": "ed5cabccf53fff9a1a3ea190d95c3aa7a15aee7b", "url": "https://github.com/hazelcast/hazelcast/commit/ed5cabccf53fff9a1a3ea190d95c3aa7a15aee7b", "message": "Send all the Diagnostics logs to the stdout, instead of storing on the file system.", "committedDate": "2020-04-29T12:32:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg1NTA0Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/16941#discussion_r417855047", "bodyText": "Why don't we rename this to DiagnosticsLog? I like simple names.\nAnd then we have 2 classes:\nDiagnosticsStdout\nDiagnosticsLogFile", "author": "pveentjer", "createdAt": "2020-04-30T08:49:45Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogOutput.java", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.internal.diagnostics;\n+\n+public interface DiagnosticsLogOutput {", "originalCommit": "ed5cabccf53fff9a1a3ea190d95c3aa7a15aee7b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a5dac0eed49ee92f254097b5cc7aeda8494c0a0a", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogOutput.java b/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLog.java\nsimilarity index 94%\nrename from hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogOutput.java\nrename to hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLog.java\nindex 0367b15443..1d7e824460 100644\n--- a/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogOutput.java\n+++ b/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLog.java\n\n@@ -16,6 +16,6 @@\n \n package com.hazelcast.internal.diagnostics;\n \n-public interface DiagnosticsLogOutput {\n+public interface DiagnosticsLog {\n     void write(DiagnosticsPlugin plugin);\n }\n"}}, {"oid": "a5dac0eed49ee92f254097b5cc7aeda8494c0a0a", "url": "https://github.com/hazelcast/hazelcast/commit/a5dac0eed49ee92f254097b5cc7aeda8494c0a0a", "message": "Use simple names for Diagnostics log classes", "committedDate": "2020-05-01T10:14:32Z", "type": "commit"}, {"oid": "1719d6298e973ceb7153ad6c576e02cb5d9832dc", "url": "https://github.com/hazelcast/hazelcast/commit/1719d6298e973ceb7153ad6c576e02cb5d9832dc", "message": "Add more logging about diagnostics log output", "committedDate": "2020-05-01T11:19:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NTU3OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/16941#discussion_r419275579", "bodyText": "I would print the directory.\nDiagnostics log directory is [....]", "author": "pveentjer", "createdAt": "2020-05-04T08:15:35Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogFile.java", "diffHunk": "@@ -98,7 +98,9 @@ public void write(DiagnosticsPlugin plugin) {\n \n     private File newFile(int index) {\n         createDirectoryIfDoesNotExist();\n-        return new File(diagnostics.directory, format(fileName, index));\n+        File fresh = new File(diagnostics.directory, format(fileName, index));\n+        logger.info(\"Current diagnostics log file is \" + fresh.getAbsolutePath());", "originalCommit": "1719d6298e973ceb7153ad6c576e02cb5d9832dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNTg1OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/16941#discussion_r419905859", "bodyText": "INFO: [192.168.1.5]:5701 [dev] [4.1-SNAPSHOT] Diagnostics log directory is [/Users/buraksezer/Projects/hazelcast]\n\nIs that OK? I'm not sure about the square brackets.", "author": "buraksezer", "createdAt": "2020-05-05T07:12:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NTU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMTg5MA==", "url": "https://github.com/hazelcast/hazelcast/pull/16941#discussion_r419931890", "bodyText": "That is good. With customer provides strings it is best to add something like [...] around it so it is easier for them to understand what they have configured.", "author": "pveentjer", "createdAt": "2020-05-05T08:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NTU3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "2026f45e77582ce88f807b7ffa64bb5a487237f7", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogFile.java b/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogFile.java\nindex 921a9179e2..ed1fe3bda1 100644\n--- a/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogFile.java\n+++ b/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/DiagnosticsLogFile.java\n\n@@ -98,9 +98,8 @@ final class DiagnosticsLogFile implements DiagnosticsLog {\n \n     private File newFile(int index) {\n         createDirectoryIfDoesNotExist();\n-        File fresh = new File(diagnostics.directory, format(fileName, index));\n-        logger.info(\"Current diagnostics log file is \" + fresh.getAbsolutePath());\n-        return fresh;\n+        logger.info(\"Diagnostics log directory is [\" + diagnostics.directory + \"]\");\n+        return new File(diagnostics.directory, format(fileName, index));\n     }\n \n     private void createDirectoryIfDoesNotExist() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMjQ4NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/16941#discussion_r419932485", "bodyText": "Can you convert this into using a ternary operator?\nthis.diagnosticsLogs = stdOut ? new DiagnosticsStdout(this) :  new DiagnosticsLogFile(this);\n\nIt makes the code less verbose.", "author": "pveentjer", "createdAt": "2020-05-05T08:06:58Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/diagnostics/Diagnostics.java", "diffHunk": "@@ -207,7 +219,12 @@ public void start() {\n             return;\n         }\n \n-        this.diagnosticsLogFile = new DiagnosticsLogFile(this);\n+        if (stdout) {", "originalCommit": "1719d6298e973ceb7153ad6c576e02cb5d9832dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5bafe1524c27514263f6230ef04d5fd7c0ace70b", "chunk": "diff --git a/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/Diagnostics.java b/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/Diagnostics.java\nindex b3b6854cda..2106929531 100644\n--- a/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/Diagnostics.java\n+++ b/hazelcast/src/main/java/com/hazelcast/internal/diagnostics/Diagnostics.java\n\n@@ -219,12 +219,8 @@ public class Diagnostics {\n             return;\n         }\n \n-        if (stdout) {\n-            this.diagnosticsLog = new DiagnosticsStdout(this);\n-        } else {\n-            this.diagnosticsLog = new DiagnosticsLogFile(this);\n-        }\n-\n+        this.diagnosticsLog = stdout ? new DiagnosticsStdout(this) :  new DiagnosticsLogFile(this);\n+        \n         this.scheduler = new ScheduledThreadPoolExecutor(1, new DiagnosticSchedulerThreadFactory());\n \n         logger.info(\"Diagnostics started\");\n"}}, {"oid": "2026f45e77582ce88f807b7ffa64bb5a487237f7", "url": "https://github.com/hazelcast/hazelcast/commit/2026f45e77582ce88f807b7ffa64bb5a487237f7", "message": "Print log directory instead of files", "committedDate": "2020-05-06T13:12:06Z", "type": "commit"}, {"oid": "5bafe1524c27514263f6230ef04d5fd7c0ace70b", "url": "https://github.com/hazelcast/hazelcast/commit/5bafe1524c27514263f6230ef04d5fd7c0ace70b", "message": "Use a ternary operator for stdout condition", "committedDate": "2020-05-06T13:20:16Z", "type": "commit"}]}