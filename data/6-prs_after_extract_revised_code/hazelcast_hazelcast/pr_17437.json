{"pr_number": 17437, "pr_title": "Recover exceptions wrapped in same class correctly", "pr_createdAt": "2020-08-31T13:26:20Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17437", "timeline": [{"oid": "1c224fa9217b16f4184182f50fdec8c49d93e9e9", "url": "https://github.com/hazelcast/hazelcast/commit/1c224fa9217b16f4184182f50fdec8c49d93e9e9", "message": "Recover exceptions wrapped in same class correctly\n\nFollow up to https://github.com/hazelcast/hazelcast/pull/17212\n\nWe have added exceptions created by ExceptionUtil.tryWrapInSameClass\nmethods to the client.\n\nClientExceptionFactory.createException method was not handling these\nexceptions correctly. More specifically, the cause was not set to the\nexception if there was no Constructor with cause. This pr adds changes\nto mitigate that.\n\nrelated to https://github.com/hazelcast/hazelcast/issues/17433", "committedDate": "2020-08-31T13:20:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzNzY4Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17437#discussion_r480137686", "bodyText": "i think it would be better and clearer to set it correctly at the factory in the first place, e.g. https://github.com/hazelcast/hazelcast/blob/master/hazelcast/src/main/java/com/hazelcast/client/impl/clientside/ClientExceptionFactory.java#L220 rather than trying to fix it here.", "author": "ihsandemir", "createdAt": "2020-08-31T13:39:52Z", "path": "hazelcast/src/main/java/com/hazelcast/client/impl/clientside/ClientExceptionFactory.java", "diffHunk": "@@ -329,7 +329,11 @@ private Throwable createException(Iterator<ErrorHolder> iterator) {\n         if (exceptionFactory == null) {\n             throwable = new UndefinedErrorCodeException(errorHolder.getMessage(), errorHolder.getClassName());\n         } else {\n-            throwable = exceptionFactory.createException(errorHolder.getMessage(), createException(iterator));\n+            Throwable cause = createException(iterator);\n+            throwable = exceptionFactory.createException(errorHolder.getMessage(), cause);\n+            if (throwable.getCause() == null && cause != null) {\n+                throwable.initCause(cause);", "originalCommit": "1c224fa9217b16f4184182f50fdec8c49d93e9e9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg5OTU3MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17437#discussion_r480899571", "bodyText": "An off-topic proposal. This branch could be further improved to handle causes for unknown exceptions. See hazelcast/hazelcast-nodejs-client#576 (comment) for more details.", "author": "puzpuzpuz", "createdAt": "2020-09-01T07:05:30Z", "path": "hazelcast/src/main/java/com/hazelcast/client/impl/clientside/ClientExceptionFactory.java", "diffHunk": "@@ -329,7 +329,11 @@ private Throwable createException(Iterator<ErrorHolder> iterator) {\n         if (exceptionFactory == null) {\n             throwable = new UndefinedErrorCodeException(errorHolder.getMessage(), errorHolder.getClassName());", "originalCommit": "1c224fa9217b16f4184182f50fdec8c49d93e9e9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}