{"pr_number": 328, "pr_title": "Migrate to access-widener library", "pr_createdAt": "2020-10-28T20:13:49Z", "pr_url": "https://github.com/FabricMC/fabric-loader/pull/328", "timeline": [{"oid": "42030df7084ce8b14629a042f263bf10decb2566", "url": "https://github.com/FabricMC/fabric-loader/commit/42030df7084ce8b14629a042f263bf10decb2566", "message": "Migrate to access-widener library", "committedDate": "2020-10-28T20:12:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNzMyMw==", "url": "https://github.com/FabricMC/fabric-loader/pull/328#discussion_r514637323", "bodyText": "This should really be passing in \"intermediary\" too given the remapper is renaming from that. If the access widener isn't using intermediary names chances are it won't be applying properly because of that. Also makes FabricMC/access-widener#3 fixable without breaking anything.", "author": "Chocohead", "createdAt": "2020-10-30T00:12:30Z", "path": "src/main/java/net/fabricmc/loader/discovery/RuntimeModRemapper.java", "diffHunk": "@@ -162,14 +164,16 @@\n \n \tprivate static byte[] remapAccessWidener(byte[] input, Remapper remapper) {\n \t\ttry (BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(input), StandardCharsets.UTF_8))) {\n-\t\t\tAccessWidener accessWidener = new AccessWidener(FabricLoader.INSTANCE);\n-\t\t\taccessWidener.read(bufferedReader, null);\n+\t\t\tAccessWidener accessWidener = new AccessWidener();\n+\t\t\tAccessWidenerReader accessWidenerReader = new AccessWidenerReader(accessWidener);\n+\t\t\taccessWidenerReader.read(bufferedReader);", "originalCommit": "42030df7084ce8b14629a042f263bf10decb2566", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f56cb86649b7ef9b5bf0f3c3f80c93f3a3714dd3", "chunk": "diff --git a/src/main/java/net/fabricmc/loader/discovery/RuntimeModRemapper.java b/src/main/java/net/fabricmc/loader/discovery/RuntimeModRemapper.java\nindex ffe0a46..5aac5d4 100644\n--- a/src/main/java/net/fabricmc/loader/discovery/RuntimeModRemapper.java\n+++ b/src/main/java/net/fabricmc/loader/discovery/RuntimeModRemapper.java\n\n@@ -166,7 +166,7 @@ public final class RuntimeModRemapper {\n \t\ttry (BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(input), StandardCharsets.UTF_8))) {\n \t\t\tAccessWidener accessWidener = new AccessWidener();\n \t\t\tAccessWidenerReader accessWidenerReader = new AccessWidenerReader(accessWidener);\n-\t\t\taccessWidenerReader.read(bufferedReader);\n+\t\t\taccessWidenerReader.read(bufferedReader, \"intermediary\");\n \n \t\t\tAccessWidenerRemapper accessWidenerRemapper = new AccessWidenerRemapper(accessWidener, remapper, \"named\");\n \t\t\tAccessWidener remapped = accessWidenerRemapper.remap();\n"}}, {"oid": "f56cb86649b7ef9b5bf0f3c3f80c93f3a3714dd3", "url": "https://github.com/FabricMC/fabric-loader/commit/f56cb86649b7ef9b5bf0f3c3f80c93f3a3714dd3", "message": "Enforce input namespace", "committedDate": "2020-10-30T17:18:39Z", "type": "commit"}]}