{"pr_number": 1253, "pr_title": "Fix issue #1127: Transactions were lost in reorganizations", "pr_createdAt": "2020-06-09T20:17:11Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1253", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU3MjIzMQ==", "url": "https://github.com/rsksmart/rskj/pull/1253#discussion_r443572231", "bodyText": "This check shouldn\u2019t be done inside the Comparator logic?", "author": "patogallaiovlabs", "createdAt": "2020-06-22T13:50:39Z", "path": "rskj-core/src/main/java/co/rsk/core/bc/TransactionPoolImpl.java", "diffHunk": "@@ -299,15 +302,23 @@ public synchronized void processBest(Block block) {\n             }\n         }\n \n-        removeObsoleteTransactions(block.getNumber(), this.outdatedThreshold, this.outdatedTimeout);\n-\n-        bestBlock = block;\n+        removeObsoleteTransactions(this.outdatedThreshold, this.outdatedTimeout);\n \n         if (listener != null) {\n             EventDispatchThread.invokeLater(() -> listener.onTransactionPoolChanged(TransactionPoolImpl.this));\n         }\n     }\n \n+    private BlockFork getFork(Block oldBestBlock, Block newBestBlock) {\n+        if (oldBestBlock != null) {", "originalCommit": "96a0b53bcc27aef316135310a932745bc7c0d2a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2NDY0Nw==", "url": "https://github.com/rsksmart/rskj/pull/1253#discussion_r444364647", "bodyText": "I don't think so. I see the fact that oldBestBlock can be null as an implementation detail of this class.", "author": "nicops", "createdAt": "2020-06-23T16:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU3MjIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2OTk1NA==", "url": "https://github.com/rsksmart/rskj/pull/1253#discussion_r445169954", "bodyText": "Shouldn't calculateFork() have a check for null params?", "author": "patogallaiovlabs", "createdAt": "2020-06-24T21:02:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU3MjIzMQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "325fbfe5540a5613e2ab40a7b3fb626fc2ab89c1", "url": "https://github.com/rsksmart/rskj/commit/325fbfe5540a5613e2ab40a7b3fb626fc2ab89c1", "message": "Fix issue #1127: Transactions were lost in reorganizations", "committedDate": "2020-06-24T21:13:11Z", "type": "commit"}, {"oid": "f16b97097961bc7cd6e80f46d5b6a59b898dc071", "url": "https://github.com/rsksmart/rskj/commit/f16b97097961bc7cd6e80f46d5b6a59b898dc071", "message": "added extra tests for \"Transactions were lost in reorganizations\"", "committedDate": "2020-06-24T21:13:11Z", "type": "commit"}, {"oid": "f16b97097961bc7cd6e80f46d5b6a59b898dc071", "url": "https://github.com/rsksmart/rskj/commit/f16b97097961bc7cd6e80f46d5b6a59b898dc071", "message": "added extra tests for \"Transactions were lost in reorganizations\"", "committedDate": "2020-06-24T21:13:11Z", "type": "forcePushed"}]}