{"pr_number": 1303, "pr_title": "QG in red fixes", "pr_createdAt": "2020-09-07T22:05:21Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1303", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzMTc2NA==", "url": "https://github.com/rsksmart/rskj/pull/1303#discussion_r485531764", "bodyText": "how about this way?\n    public static int numBytes(String val) {\n        return new BigInteger(val).bitLength() / 8 + 1;\n    }", "author": "Vovchyk", "createdAt": "2020-09-09T11:16:28Z", "path": "rskj-core/src/main/java/org/ethereum/util/ByteUtil.java", "diffHunk": "@@ -366,14 +366,14 @@ public static String oneByteToHexString(byte value) {\n     public static int numBytes(String val) {\n \n         BigInteger bInt = new BigInteger(val);\n-        int bytes = 0;\n+        int bytes = 1;", "originalCommit": "016625b9c574f10cc777555b6d7bca6fe716fc1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg1MjQxNQ==", "url": "https://github.com/rsksmart/rskj/pull/1303#discussion_r485852415", "bodyText": "worked like a charm!", "author": "patogallaiovlabs", "createdAt": "2020-09-09T19:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzMTc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "c475d157765a7b8560d2baa29d7f469b3f5ce582", "chunk": "diff --git a/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java b/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java\nindex 7951d62fa..2940292cc 100644\n--- a/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java\n+++ b/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java\n\n@@ -364,18 +364,7 @@ public class ByteUtil {\n      * @return number of min bytes used to encode the number\n      */\n     public static int numBytes(String val) {\n-\n-        BigInteger bInt = new BigInteger(val);\n-        int bytes = 1;\n-\n-        while (!bInt.equals(BigInteger.ZERO)) {\n-            bInt = bInt.shiftRight(8);\n-            ++bytes;\n-        }\n-        if (bytes > 1) {\n-            --bytes;\n-        }\n-        return bytes;\n+        return new BigInteger(val).bitLength() / 8 + 1;\n     }\n \n     public static int firstNonZeroByte(byte[] data) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY0NTA5NA==", "url": "https://github.com/rsksmart/rskj/pull/1303#discussion_r485645094", "bodyText": "I don't think this is the right way to tackle this. Instead, I would change the logging level of the test logback.xml", "author": "nicops", "createdAt": "2020-09-09T14:13:11Z", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainFlusher.java", "diffHunk": "@@ -77,9 +78,9 @@ public void stop() {\n     }\n \n     private void closeAll() {\n-        logger.trace(\"closing blockStore.\");\n+        getLogger().trace(\"closing blockStore.\");", "originalCommit": "016625b9c574f10cc777555b6d7bca6fe716fc1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg1NTA1MA==", "url": "https://github.com/rsksmart/rskj/pull/1303#discussion_r485855050", "bodyText": "changed as suggested, thanks!", "author": "patogallaiovlabs", "createdAt": "2020-09-09T19:19:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY0NTA5NA=="}], "type": "inlineReview", "revised_code": {"commit": "c475d157765a7b8560d2baa29d7f469b3f5ce582", "chunk": "diff --git a/rskj-core/src/main/java/co/rsk/core/bc/BlockChainFlusher.java b/rskj-core/src/main/java/co/rsk/core/bc/BlockChainFlusher.java\nindex bd73f76d5..e09621b63 100644\n--- a/rskj-core/src/main/java/co/rsk/core/bc/BlockChainFlusher.java\n+++ b/rskj-core/src/main/java/co/rsk/core/bc/BlockChainFlusher.java\n\n@@ -78,9 +77,9 @@ public class BlockChainFlusher implements InternalService {\n     }\n \n     private void closeAll() {\n-        getLogger().trace(\"closing blockStore.\");\n+        logger.trace(\"closing blockStore.\");\n         blockStore.close();\n-        getLogger().trace(\"blockStore closed.\");\n+        logger.trace(\"blockStore closed.\");\n     }\n \n     private void flush() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY0NjExNw==", "url": "https://github.com/rsksmart/rskj/pull/1303#discussion_r485646117", "bodyText": "SonarQube says this expression is always true, but that seems off. Surely it is not guaranteed it is always true, given the while above? bad static analysis?", "author": "nicops", "createdAt": "2020-09-09T14:14:34Z", "path": "rskj-core/src/main/java/org/ethereum/util/ByteUtil.java", "diffHunk": "@@ -366,14 +366,14 @@ public static String oneByteToHexString(byte value) {\n     public static int numBytes(String val) {\n \n         BigInteger bInt = new BigInteger(val);\n-        int bytes = 0;\n+        int bytes = 1;\n \n         while (!bInt.equals(BigInteger.ZERO)) {\n             bInt = bInt.shiftRight(8);\n             ++bytes;\n         }\n-        if (bytes == 0) {", "originalCommit": "016625b9c574f10cc777555b6d7bca6fe716fc1e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c475d157765a7b8560d2baa29d7f469b3f5ce582", "chunk": "diff --git a/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java b/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java\nindex 7951d62fa..2940292cc 100644\n--- a/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java\n+++ b/rskj-core/src/main/java/org/ethereum/util/ByteUtil.java\n\n@@ -364,18 +364,7 @@ public class ByteUtil {\n      * @return number of min bytes used to encode the number\n      */\n     public static int numBytes(String val) {\n-\n-        BigInteger bInt = new BigInteger(val);\n-        int bytes = 1;\n-\n-        while (!bInt.equals(BigInteger.ZERO)) {\n-            bInt = bInt.shiftRight(8);\n-            ++bytes;\n-        }\n-        if (bytes > 1) {\n-            --bytes;\n-        }\n-        return bytes;\n+        return new BigInteger(val).bitLength() / 8 + 1;\n     }\n \n     public static int firstNonZeroByte(byte[] data) {\n"}}, {"oid": "287da349d1da9d276c60756746fc159379db2ca0", "url": "https://github.com/rsksmart/rskj/commit/287da349d1da9d276c60756746fc159379db2ca0", "message": "QG in red fixes", "committedDate": "2020-09-10T13:15:20Z", "type": "commit"}, {"oid": "c475d157765a7b8560d2baa29d7f469b3f5ce582", "url": "https://github.com/rsksmart/rskj/commit/c475d157765a7b8560d2baa29d7f469b3f5ce582", "message": "changes after PR comments from Vlad/Nico", "committedDate": "2020-09-10T13:15:20Z", "type": "commit"}, {"oid": "c475d157765a7b8560d2baa29d7f469b3f5ce582", "url": "https://github.com/rsksmart/rskj/commit/c475d157765a7b8560d2baa29d7f469b3f5ce582", "message": "changes after PR comments from Vlad/Nico", "committedDate": "2020-09-10T13:15:20Z", "type": "forcePushed"}]}