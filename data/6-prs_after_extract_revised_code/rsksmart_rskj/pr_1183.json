{"pr_number": 1183, "pr_title": "Light client capability handshake", "pr_createdAt": "2020-03-04T19:57:45Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1183", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI5NzQ3Mw==", "url": "https://github.com/rsksmart/rskj/pull/1183#discussion_r388297473", "bodyText": "we should change this comment to reflect new behaviour", "author": "smcsicardi", "createdAt": "2020-03-05T13:39:01Z", "path": "rskj-core/src/main/java/org/ethereum/net/rlpx/HandshakeHandler.java", "diffHunk": "@@ -375,18 +376,23 @@ private void recordEvent(ChannelHandlerContext ctx, EventType event) {\n     private void processHelloMessage(ChannelHandlerContext ctx, HelloMessage helloMessage) {\n         List<Capability> capInCommon = configCapabilities.getSupportedCapabilities(helloMessage);\n         channel.initMessageCodes(capInCommon);\n+        List<Capability> capsToActivate = new LinkedList();\n         for (Capability capability : capInCommon) {\n             // It seems that the only supported capability is RSK, and everything else is ignored.", "originalCommit": "cb15f034fde8e28a8083b7d670c282a23cf13fb3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6fae570afd2dd8389f0ee38a77505231ccee753c", "chunk": "diff --git a/rskj-core/src/main/java/org/ethereum/net/rlpx/HandshakeHandler.java b/rskj-core/src/main/java/org/ethereum/net/rlpx/HandshakeHandler.java\nindex 5697938c8..5532056a0 100644\n--- a/rskj-core/src/main/java/org/ethereum/net/rlpx/HandshakeHandler.java\n+++ b/rskj-core/src/main/java/org/ethereum/net/rlpx/HandshakeHandler.java\n\n@@ -378,13 +377,12 @@ public class HandshakeHandler extends ByteToMessageDecoder {\n         channel.initMessageCodes(capInCommon);\n         List<Capability> capsToActivate = new LinkedList();\n         for (Capability capability : capInCommon) {\n-            // It seems that the only supported capability is RSK, and everything else is ignored.\n             if (Capability.RSK.equals(capability.getName()) || Capability.LC.equals(capability.getName())) {\n                 capsToActivate.add(capability);\n             }\n         }\n \n-        if (capsToActivate.size() != 0) {\n+        if (capsToActivate.isEmpty()) {\n             publicRLPxHandshakeFinished(ctx, helloMessage, capsToActivate);\n             return;\n         }\n"}}, {"oid": "6fae570afd2dd8389f0ee38a77505231ccee753c", "url": "https://github.com/rsksmart/rskj/commit/6fae570afd2dd8389f0ee38a77505231ccee753c", "message": "light client added as part of the handshake, test has been modified too", "committedDate": "2020-03-05T13:50:29Z", "type": "forcePushed"}, {"oid": "e80003f16b62487b68fc384d45d098299f3dc18e", "url": "https://github.com/rsksmart/rskj/commit/e80003f16b62487b68fc384d45d098299f3dc18e", "message": "light client added as part of the handshake, test has been modified too", "committedDate": "2020-03-05T14:01:40Z", "type": "commit"}, {"oid": "e80003f16b62487b68fc384d45d098299f3dc18e", "url": "https://github.com/rsksmart/rskj/commit/e80003f16b62487b68fc384d45d098299f3dc18e", "message": "light client added as part of the handshake, test has been modified too", "committedDate": "2020-03-05T14:01:40Z", "type": "forcePushed"}]}