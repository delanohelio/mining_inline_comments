{"pr_number": 1278, "pr_title": "Logging improvements", "pr_createdAt": "2020-07-22T15:06:51Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1278", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI4OTUxMg==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r460289512", "bodyText": "I think we could fix this at this point. assigning \"s\" while returning makes no sense, am i right?", "author": "patogallaiovlabs", "createdAt": "2020-07-24T21:09:54Z", "path": "rskj-core/src/main/java/co/rsk/rpc/modules/personal/PersonalModuleWalletEnabled.java", "diffHunk": "@@ -172,7 +173,7 @@ public String dumpRawKey(String address) throws Exception {\n                 throw new Exception(\"Address private key is locked or could not be found in this node\");\n             }\n \n-            return s = TypeConverter.toJsonHex(Hex.toHexString(account.getEcKey().getPrivKeyBytes()));\n+            return s = TypeConverter.toJsonHex(ByteUtil.toHexString(account.getEcKey().getPrivKeyBytes()));", "originalCommit": "0c5e81a2c251dd86b13169feb86fa4df054a44a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM5MzE3OQ==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r461393179", "bodyText": "s is being used below in the final block for logging. This style of coding with the s and final block is used in multiple places in the code, not only here. Not sure we should address this sort of refactoring in scope of this pull request (as this pr is already pretty big).", "author": "Vovchyk", "createdAt": "2020-07-28T08:01:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI4OTUxMg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1NDg2NA==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r461054864", "bodyText": "Are ignored tests?", "author": "patogallaiovlabs", "createdAt": "2020-07-27T17:32:58Z", "path": "rskj-core/src/test/java/org/ethereum/core/LogInfoTest.java", "diffHunk": "@@ -19,16 +19,14 @@\n \n package org.ethereum.core;\n \n+import org.bouncycastle.util.encoders.Hex;\n+import org.ethereum.util.ByteUtil;\n import org.ethereum.vm.LogInfo;\n-\n+import org.junit.Ignore;", "originalCommit": "0c5e81a2c251dd86b13169feb86fa4df054a44a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM5NDk5OQ==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r461394999", "bodyText": "yes, correct. One test is ignored in this class.", "author": "Vovchyk", "createdAt": "2020-07-28T08:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1NDg2NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "65e55e67b2b0346e82c8690cb2efafcda2542019", "url": "https://github.com/rsksmart/rskj/commit/65e55e67b2b0346e82c8690cb2efafcda2542019", "message": "Added logging of tx hash in Program class", "committedDate": "2020-07-28T08:10:43Z", "type": "forcePushed"}, {"oid": "f814d78a9d10b897f1134106f0edc87873dd1163", "url": "https://github.com/rsksmart/rskj/commit/f814d78a9d10b897f1134106f0edc87873dd1163", "message": "Added logging of tx hash in Program class", "committedDate": "2020-07-28T09:15:28Z", "type": "forcePushed"}, {"oid": "472e04b88c51cd0767f8b77a48cbec448bc176db", "url": "https://github.com/rsksmart/rskj/commit/472e04b88c51cd0767f8b77a48cbec448bc176db", "message": "Added extra tests", "committedDate": "2020-07-30T10:25:03Z", "type": "forcePushed"}, {"oid": "ab7916b839d897e0e6db98da9b880a8eb5cf5fe1", "url": "https://github.com/rsksmart/rskj/commit/ab7916b839d897e0e6db98da9b880a8eb5cf5fe1", "message": "Added extra tests", "committedDate": "2020-07-30T14:28:29Z", "type": "forcePushed"}, {"oid": "454466e31c2cb0caed9a0b69b76d2ab8f37dfc51", "url": "https://github.com/rsksmart/rskj/commit/454466e31c2cb0caed9a0b69b76d2ab8f37dfc51", "message": "Added extra tests", "committedDate": "2020-07-30T14:44:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyNjk3OQ==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r463626979", "bodyText": "Would be nice to have at least 1 assert. I understand that you are testing that this doesn't fail, but would be better if we are clear on that.", "author": "patogallaiovlabs", "createdAt": "2020-07-31T13:57:22Z", "path": "rskj-core/src/test/java/org/ethereum/core/TransactionTest.java", "diffHunk": "@@ -712,6 +712,32 @@ function doIt(address invokedAddress) {\n         Assert.assertEquals(1, executor.getVMLogs().size());\n     }\n \n+    @Test\n+    public void verifyTx_noSignature() {\n+        BigInteger value = new BigInteger(\"1000000000000000000000\");\n+        byte[] privKey = HashUtil.keccak256(\"cat\".getBytes());\n+        ECKey ecKey = ECKey.fromPrivate(privKey);\n+        byte[] gasPrice = Hex.decode(\"09184e72a000\");\n+        byte[] gas = Hex.decode(\"4255\");\n+\n+        Transaction tx = new Transaction(new byte[0], gasPrice, gas, ecKey.getAddress(), value.toByteArray(),null);\n+        tx.verify();", "originalCommit": "454466e31c2cb0caed9a0b69b76d2ab8f37dfc51", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0a6f9b1b963336d920a0bfa53a791710950212bd", "chunk": "diff --git a/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java b/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java\nindex 9b632373e..e1014563a 100644\n--- a/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java\n+++ b/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java\n\n@@ -721,7 +720,11 @@ public class TransactionTest {\n         byte[] gas = Hex.decode(\"4255\");\n \n         Transaction tx = new Transaction(new byte[0], gasPrice, gas, ecKey.getAddress(), value.toByteArray(),null);\n-        tx.verify();\n+        try {\n+            tx.verify();\n+        } catch (Exception e) {\n+            fail(e.getMessage());\n+        }\n     }\n \n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyNzkwOQ==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r463627909", "bodyText": "Same here.", "author": "patogallaiovlabs", "createdAt": "2020-07-31T13:58:58Z", "path": "rskj-core/src/test/java/org/ethereum/core/TransactionTest.java", "diffHunk": "@@ -712,6 +712,32 @@ function doIt(address invokedAddress) {\n         Assert.assertEquals(1, executor.getVMLogs().size());\n     }\n \n+    @Test\n+    public void verifyTx_noSignature() {\n+        BigInteger value = new BigInteger(\"1000000000000000000000\");\n+        byte[] privKey = HashUtil.keccak256(\"cat\".getBytes());\n+        ECKey ecKey = ECKey.fromPrivate(privKey);\n+        byte[] gasPrice = Hex.decode(\"09184e72a000\");\n+        byte[] gas = Hex.decode(\"4255\");\n+\n+        Transaction tx = new Transaction(new byte[0], gasPrice, gas, ecKey.getAddress(), value.toByteArray(),null);\n+        tx.verify();\n+    }\n+\n+    @Test\n+    public void verifyTx_withSignature() {\n+        BigInteger value = new BigInteger(\"1000000000000000000000\");\n+        byte[] senderPrivKey = HashUtil.keccak256(\"cow\".getBytes());\n+        byte[] privKey = HashUtil.keccak256(\"cat\".getBytes());\n+        ECKey ecKey = ECKey.fromPrivate(privKey);\n+        byte[] gasPrice = Hex.decode(\"09184e72a000\");\n+        byte[] gas = Hex.decode(\"4255\");\n+\n+        Transaction tx = new Transaction(new byte[0], gasPrice, gas, ecKey.getAddress(), value.toByteArray(),null);\n+        tx.sign(senderPrivKey);\n+        tx.verify();", "originalCommit": "454466e31c2cb0caed9a0b69b76d2ab8f37dfc51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMwMTI4Ng==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r464301286", "bodyText": "done", "author": "Vovchyk", "createdAt": "2020-08-03T09:32:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyNzkwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "0a6f9b1b963336d920a0bfa53a791710950212bd", "chunk": "diff --git a/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java b/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java\nindex 9b632373e..e1014563a 100644\n--- a/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java\n+++ b/rskj-core/src/test/java/org/ethereum/core/TransactionTest.java\n\n@@ -721,7 +720,11 @@ public class TransactionTest {\n         byte[] gas = Hex.decode(\"4255\");\n \n         Transaction tx = new Transaction(new byte[0], gasPrice, gas, ecKey.getAddress(), value.toByteArray(),null);\n-        tx.verify();\n+        try {\n+            tx.verify();\n+        } catch (Exception e) {\n+            fail(e.getMessage());\n+        }\n     }\n \n     @Test\n"}}, {"oid": "0a6f9b1b963336d920a0bfa53a791710950212bd", "url": "https://github.com/rsksmart/rskj/commit/0a6f9b1b963336d920a0bfa53a791710950212bd", "message": "Added extra tests", "committedDate": "2020-08-03T09:13:02Z", "type": "forcePushed"}, {"oid": "ccca6d9ca34d87bdd340b0b0ec8592b1a2a41083", "url": "https://github.com/rsksmart/rskj/commit/ccca6d9ca34d87bdd340b0b0ec8592b1a2a41083", "message": "Added extra tests", "committedDate": "2020-08-03T10:23:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg4MjU0NA==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r465882544", "bodyText": "fix indentation?", "author": "nicops", "createdAt": "2020-08-05T17:18:29Z", "path": "rskj-core/src/main/java/org/ethereum/core/TransactionReceipt.java", "diffHunk": "@@ -19,21 +19,17 @@\n \n package org.ethereum.core;\n \n-import org.bouncycastle.util.BigIntegers;\n-import org.bouncycastle.util.encoders.Hex;\n-import org.ethereum.util.RLP;\n-import org.ethereum.util.RLPElement;\n-import org.ethereum.util.RLPItem;\n-import org.ethereum.util.RLPList;\n-import org.ethereum.vm.LogInfo;\n-\n-import java.math.BigInteger;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.List;\n-\n-import static co.rsk.util.ListArrayUtil.nullToEmpty;\n-import static org.ethereum.util.ByteUtil.EMPTY_BYTE_ARRAY;\n+    import org.bouncycastle.util.BigIntegers;\n+    import org.ethereum.util.*;\n+    import org.ethereum.vm.LogInfo;\n+\n+    import java.math.BigInteger;\n+    import java.util.ArrayList;\n+    import java.util.Arrays;\n+    import java.util.List;\n+\n+    import static co.rsk.util.ListArrayUtil.nullToEmpty;\n+    import static org.ethereum.util.ByteUtil.EMPTY_BYTE_ARRAY;", "originalCommit": "ccca6d9ca34d87bdd340b0b0ec8592b1a2a41083", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIzMDQ0NA==", "url": "https://github.com/rsksmart/rskj/pull/1278#discussion_r466230444", "bodyText": "Not sure I've got the question. This was done automatically by an IDE (Optimize Imports command)", "author": "Vovchyk", "createdAt": "2020-08-06T08:20:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg4MjU0NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1260eba9f217f4458d15ad79d2c2635392ca06a8", "url": "https://github.com/rsksmart/rskj/commit/1260eba9f217f4458d15ad79d2c2635392ca06a8", "message": "Logging improvements", "committedDate": "2020-08-14T14:06:59Z", "type": "commit"}, {"oid": "489b003ce602fff53c513ddf3c258676205a71ab", "url": "https://github.com/rsksmart/rskj/commit/489b003ce602fff53c513ddf3c258676205a71ab", "message": "Added logging of tx hash in Program class", "committedDate": "2020-08-14T14:06:59Z", "type": "commit"}, {"oid": "b7febb16e5a6463c20945e597ef05d83a98b51d8", "url": "https://github.com/rsksmart/rskj/commit/b7febb16e5a6463c20945e597ef05d83a98b51d8", "message": "Added extra tests", "committedDate": "2020-08-14T14:06:59Z", "type": "commit"}, {"oid": "b7febb16e5a6463c20945e597ef05d83a98b51d8", "url": "https://github.com/rsksmart/rskj/commit/b7febb16e5a6463c20945e597ef05d83a98b51d8", "message": "Added extra tests", "committedDate": "2020-08-14T14:06:59Z", "type": "forcePushed"}]}