{"pr_number": 1288, "pr_title": "Add thread names & mdc to log", "pr_createdAt": "2020-08-05T15:09:24Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1288", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwNjY3Mw==", "url": "https://github.com/rsksmart/rskj/pull/1288#discussion_r466306673", "bodyText": "Could we add the block number and short hash to the log message? It could help when grep over the log lines. I'm not sure about the current format (there is a pull request that standardize the format)", "author": "ajlopezrsk", "createdAt": "2020-08-06T10:06:07Z", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -457,8 +457,11 @@ private void saveReceipts(Block block, BlockResult result) {\n     }\n \n     private void processBest(final Block block) {\n+        logger.debug(\"Starting to run transactionPool.processBest(block)\");", "originalCommit": "a8c4b45d64d63c3f448c8e02a6b0b5522d9d1b68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcwMjU5NA==", "url": "https://github.com/rsksmart/rskj/pull/1288#discussion_r468702594", "bodyText": "Added it directly as MDC keys to the whole block processing", "author": "nicops", "createdAt": "2020-08-11T16:17:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwNjY3Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "980ec96b4b2b3c9d59e40c32dbb86b9c3b62432c", "url": "https://github.com/rsksmart/rskj/commit/980ec96b4b2b3c9d59e40c32dbb86b9c3b62432c", "message": "Logging improvements\n\nAdded mdc & thread to log output.\nAdded mdc keys to BlockChainImpl (blockHash & blockHeight)\nAdded names to various threads\nAdded logging around BlockChainImpl calls to transactionPool", "committedDate": "2020-08-11T16:07:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ4MTY3NQ==", "url": "https://github.com/rsksmart/rskj/pull/1288#discussion_r469481675", "bodyText": "Wouldn't be better if we wrap-up org.slf4j.MDC with an own implementation? Kind of helper or sthg?", "author": "patogallaiovlabs", "createdAt": "2020-08-12T19:11:56Z", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -144,6 +144,9 @@ public ImportResult tryToConnect(Block block) {\n             }\n \n             try {\n+                org.slf4j.MDC.put(\"blockHash\", block.getHash().toHexString());\n+                org.slf4j.MDC.put(\"blockHeight\", Long.toString(block.getNumber()));", "originalCommit": "980ec96b4b2b3c9d59e40c32dbb86b9c3b62432c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUxOTM0OA==", "url": "https://github.com/rsksmart/rskj/pull/1288#discussion_r469519348", "bodyText": "AFAIR, this is an auxiliary class, which its only real use is in regtest. Maybe we could add also the name of the thread to MinerServer, it has a thread", "author": "ajlopezrsk", "createdAt": "2020-08-12T20:25:58Z", "path": "rskj-core/src/main/java/co/rsk/mine/MinerClientImpl.java", "diffHunk": "@@ -77,7 +77,7 @@ public RefreshWork createRefreshWork() {\n     }\n \n     public Thread createDoWorkThread() {\n-        return new Thread() {\n+        return new Thread(\"miner client\") {", "originalCommit": "980ec96b4b2b3c9d59e40c32dbb86b9c3b62432c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0MDQ5Ng==", "url": "https://github.com/rsksmart/rskj/pull/1288#discussion_r470040496", "bodyText": "Yes, but still, it's nice to have the logs in regtest. I didn't add the name to the MinerSever thread... because the name is already set: https://github.com/rsksmart/rskj/blob/master/rskj-core/src/main/java/co/rsk/mine/MinerServerImpl.java#L194", "author": "nicops", "createdAt": "2020-08-13T15:32:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUxOTM0OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "92df76a3c838671d2987e990a4d6a96f2ab7f171", "url": "https://github.com/rsksmart/rskj/commit/92df76a3c838671d2987e990a4d6a96f2ab7f171", "message": "Logging improvements\n\nAdded mdc & thread to log output.\nAdded mdc keys to BlockChainImpl (blockHash & blockHeight)\nAdded names to various threads\nAdded logging around BlockChainImpl calls to transactionPool", "committedDate": "2020-08-13T15:30:27Z", "type": "commit"}, {"oid": "92df76a3c838671d2987e990a4d6a96f2ab7f171", "url": "https://github.com/rsksmart/rskj/commit/92df76a3c838671d2987e990a4d6a96f2ab7f171", "message": "Logging improvements\n\nAdded mdc & thread to log output.\nAdded mdc keys to BlockChainImpl (blockHash & blockHeight)\nAdded names to various threads\nAdded logging around BlockChainImpl calls to transactionPool", "committedDate": "2020-08-13T15:30:27Z", "type": "forcePushed"}]}