{"pr_number": 25, "pr_title": "FM2-23: Add paging provider", "pr_createdAt": "2020-01-14T17:35:50Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/25", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUxNzk2MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/25#discussion_r366517960", "bodyText": "These should be \"fhir2.paging.default\". Otherwise, this is good.", "author": "ibacher", "createdAt": "2020-01-14T19:03:40Z", "path": "api/src/main/java/org/openmrs/module/fhir2/FhirConstants.java", "diffHunk": "@@ -29,6 +29,10 @@ private FhirConstants() {\n \t\n \tpublic static String OPENMRS_FHIR_EXT_ADDRESS = OPENMRS_FHIR_EXT_PREFIX + \"/address\";\n \t\n+\tpublic static String OPENMRS_FHIR_DEFAULT_PAGE_SIZE = \"fhir.paging.default\";", "originalCommit": "af2fe32cf49149d6bf35dbdd024304860f5ba9cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "139d04576fb315fefb727589574dbf8e2041f223", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/FhirConstants.java b/api/src/main/java/org/openmrs/module/fhir2/FhirConstants.java\nindex f965ccee..2748d73d 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/FhirConstants.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/FhirConstants.java\n\n@@ -28,10 +28,10 @@ public class FhirConstants {\n \tpublic static String OPENMRS_FHIR_EXT_NAME = OPENMRS_FHIR_EXT_PREFIX + \"/name\";\n \t\n \tpublic static String OPENMRS_FHIR_EXT_ADDRESS = OPENMRS_FHIR_EXT_PREFIX + \"/address\";\n-\t\n-\tpublic static String OPENMRS_FHIR_DEFAULT_PAGE_SIZE = \"fhir.paging.default\";\n-\t\n-\tpublic static String OPENMRS_FHIR_MAXIMUM_PAGE_SIZE = \"fhir.paging.maximum\";\n+\n+\tpublic static String OPENMRS_FHIR_DEFAULT_PAGE_SIZE = \"fhir2.paging.default\";\n+\n+\tpublic static String OPENMRS_FHIR_MAXIMUM_PAGE_SIZE = \"fhir2.paging.maximum\";\n \t\n \tpublic static String PATIENT = \"Patient\";\n \t\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUxODMyMg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/25#discussion_r366518322", "bodyText": "This should be moved to below the try / catch block or else this is going to throw a NullPointerException", "author": "ibacher", "createdAt": "2020-01-14T19:04:31Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -45,6 +50,14 @@\n \tprotected void initialize() {\n \t\t// ensure properties for this class are properly injected\n \t\t// TODO find a way around this hack!\n+\t\tint defaultPageSize = Integer.parseInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_DEFAULT_PAGE_SIZE));", "originalCommit": "af2fe32cf49149d6bf35dbdd024304860f5ba9cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "139d04576fb315fefb727589574dbf8e2041f223", "chunk": "diff --git a/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java b/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java\nindex cb42ab58..8c97169d 100644\n--- a/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java\n+++ b/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java\n\n@@ -50,17 +48,20 @@ public class FhirRestServlet extends RestfulServer {\n \tprotected void initialize() {\n \t\t// ensure properties for this class are properly injected\n \t\t// TODO find a way around this hack!\n-\t\tint defaultPageSize = Integer.parseInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_DEFAULT_PAGE_SIZE));\n-\t\tint maximumPageSize = Integer.parseInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_MAXIMUM_PAGE_SIZE));\n-\t\tFifoMemoryPagingProvider pp = new FifoMemoryPagingProvider(defaultPageSize);\n-\n-\t\tpp.setDefaultPageSize(defaultPageSize);\n-\t\tpp.setMaximumPageSize(maximumPageSize);\n-\t\tsetPagingProvider(pp);\n \n \t\ttry {\n \t\t\t((ServiceContext) FieldUtils.readStaticField(Context.class, \"serviceContext\", true)).getApplicationContext()\n-\t\t\t        .getAutowireCapableBeanFactory().autowireBean(this);\n+\t\t\t\t\t.getAutowireCapableBeanFactory().autowireBean(this);\n+\n+\t\t\tint defaultPageSize = NumberUtils\n+\t\t\t\t\t.toInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_DEFAULT_PAGE_SIZE));\n+\t\t\tint maximumPageSize = NumberUtils\n+\t\t\t\t\t.toInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_MAXIMUM_PAGE_SIZE));\n+\n+\t\t\tFifoMemoryPagingProvider pp = new FifoMemoryPagingProvider(defaultPageSize);\n+\t\t\tpp.setDefaultPageSize(defaultPageSize);\n+\t\t\tpp.setMaximumPageSize(maximumPageSize);\n+\t\t\tsetPagingProvider(pp);\n \t\t}\n \t\tcatch (IllegalAccessException e) {\n \t\t\tthrow new RuntimeException(e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUxOTc2OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/25#discussion_r366519768", "bodyText": "We should use NumberUtils#toInt() to parse this.", "author": "ibacher", "createdAt": "2020-01-14T19:07:44Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -45,6 +50,14 @@\n \tprotected void initialize() {\n \t\t// ensure properties for this class are properly injected\n \t\t// TODO find a way around this hack!\n+\t\tint defaultPageSize = Integer.parseInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_DEFAULT_PAGE_SIZE));", "originalCommit": "af2fe32cf49149d6bf35dbdd024304860f5ba9cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "139d04576fb315fefb727589574dbf8e2041f223", "chunk": "diff --git a/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java b/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java\nindex cb42ab58..8c97169d 100644\n--- a/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java\n+++ b/omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java\n\n@@ -50,17 +48,20 @@ public class FhirRestServlet extends RestfulServer {\n \tprotected void initialize() {\n \t\t// ensure properties for this class are properly injected\n \t\t// TODO find a way around this hack!\n-\t\tint defaultPageSize = Integer.parseInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_DEFAULT_PAGE_SIZE));\n-\t\tint maximumPageSize = Integer.parseInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_MAXIMUM_PAGE_SIZE));\n-\t\tFifoMemoryPagingProvider pp = new FifoMemoryPagingProvider(defaultPageSize);\n-\n-\t\tpp.setDefaultPageSize(defaultPageSize);\n-\t\tpp.setMaximumPageSize(maximumPageSize);\n-\t\tsetPagingProvider(pp);\n \n \t\ttry {\n \t\t\t((ServiceContext) FieldUtils.readStaticField(Context.class, \"serviceContext\", true)).getApplicationContext()\n-\t\t\t        .getAutowireCapableBeanFactory().autowireBean(this);\n+\t\t\t\t\t.getAutowireCapableBeanFactory().autowireBean(this);\n+\n+\t\t\tint defaultPageSize = NumberUtils\n+\t\t\t\t\t.toInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_DEFAULT_PAGE_SIZE));\n+\t\t\tint maximumPageSize = NumberUtils\n+\t\t\t\t\t.toInt(globalPropertyService.getGlobalProperty(FhirConstants.OPENMRS_FHIR_MAXIMUM_PAGE_SIZE));\n+\n+\t\t\tFifoMemoryPagingProvider pp = new FifoMemoryPagingProvider(defaultPageSize);\n+\t\t\tpp.setDefaultPageSize(defaultPageSize);\n+\t\t\tpp.setMaximumPageSize(maximumPageSize);\n+\t\t\tsetPagingProvider(pp);\n \t\t}\n \t\tcatch (IllegalAccessException e) {\n \t\t\tthrow new RuntimeException(e);\n"}}, {"oid": "139d04576fb315fefb727589574dbf8e2041f223", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/139d04576fb315fefb727589574dbf8e2041f223", "message": "Add paging provider", "committedDate": "2020-01-14T20:48:54Z", "type": "commit"}, {"oid": "139d04576fb315fefb727589574dbf8e2041f223", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/139d04576fb315fefb727589574dbf8e2041f223", "message": "Add paging provider", "committedDate": "2020-01-14T20:48:54Z", "type": "forcePushed"}, {"oid": "a50a4003db0477db7730b08a67abfa10c1412a10", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/a50a4003db0477db7730b08a67abfa10c1412a10", "message": "Merge branch 'master' into FM2-23", "committedDate": "2020-01-14T21:15:03Z", "type": "commit"}, {"oid": "02548560aef681ecdde363d6b5f6286814115990", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/02548560aef681ecdde363d6b5f6286814115990", "message": "Update FhirRestServlet.java", "committedDate": "2020-01-14T21:16:39Z", "type": "commit"}]}