{"pr_number": 213, "pr_title": "FM2-229: Update Task resource to support paging", "pr_createdAt": "2020-06-16T18:21:29Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/213", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MjQ1Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/213#discussion_r441292453", "bodyText": "These changes aren't part of Task resource. You should move to a different commit, PR", "author": "corneliouzbett", "createdAt": "2020-06-17T05:41:24Z", "path": "api-2.2/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl_2_2.java", "diffHunk": "@@ -151,7 +151,7 @@ protected void setupSearchParams(Criteria criteria, SearchParameterMap theParams\n \t\t\t\tcase FhirConstants.CODED_SEARCH_HANDLER:\n \t\t\t\t\tentry.getValue().forEach(param -> handleCode(criteria, (TokenAndListParam) param.getParam()));\n \t\t\t\t\tbreak;\n-\t\t\t\tcase FhirConstants.CONDITION_CLINICAL_STATUS_HANDLER:\n+\t\t\t\tcase FhirConstants.STATUS_SEARCH_HANDLER:", "originalCommit": "a1f495f0c57a9e1309ca39575e3f2c09a62fdede", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "chunk": "diff --git a/api-2.2/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl_2_2.java b/api-2.2/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl_2_2.java\nindex d7a95179..2f25149c 100644\n--- a/api-2.2/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl_2_2.java\n+++ b/api-2.2/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl_2_2.java\n\n@@ -151,7 +151,7 @@ public class FhirConditionDaoImpl_2_2 extends BaseFhirDao<Condition> implements\n \t\t\t\tcase FhirConstants.CODED_SEARCH_HANDLER:\n \t\t\t\t\tentry.getValue().forEach(param -> handleCode(criteria, (TokenAndListParam) param.getParam()));\n \t\t\t\t\tbreak;\n-\t\t\t\tcase FhirConstants.STATUS_SEARCH_HANDLER:\n+\t\t\t\tcase FhirConstants.CONDITION_CLINICAL_STATUS_HANDLER:\n \t\t\t\t\tentry.getValue().forEach(param -> handleClinicalStatus(criteria, (TokenAndListParam) param.getParam()));\n \t\t\t\t\tbreak;\n \t\t\t\tcase FhirConstants.DATE_RANGE_SEARCH_HANDLER:\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MjU1OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/213#discussion_r441292558", "bodyText": "Ditto", "author": "corneliouzbett", "createdAt": "2020-06-17T05:41:42Z", "path": "api-2.2/src/main/java/org/openmrs/module/fhir2/api/impl/FhirConditionServiceImpl_2_2.java", "diffHunk": "@@ -57,7 +57,7 @@ public IBundleProvider searchConditions(ReferenceAndListParam patientParam, Toke\n \t\tSearchParameterMap theParams = new SearchParameterMap()\n \t\t        .addParameter(FhirConstants.PATIENT_REFERENCE_SEARCH_HANDLER, patientParam)\n \t\t        .addParameter(FhirConstants.CODED_SEARCH_HANDLER, code)\n-\t\t        .addParameter(FhirConstants.CONDITION_CLINICAL_STATUS_HANDLER, clinicalStatus)\n+\t\t        .addParameter(FhirConstants.STATUS_SEARCH_HANDLER, clinicalStatus)\n \t\t        .addParameter(FhirConstants.QUANTITY_SEARCH_HANDLER, onsetAge)", "originalCommit": "a1f495f0c57a9e1309ca39575e3f2c09a62fdede", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "chunk": "diff --git a/api-2.2/src/main/java/org/openmrs/module/fhir2/api/impl/FhirConditionServiceImpl_2_2.java b/api-2.2/src/main/java/org/openmrs/module/fhir2/api/impl/FhirConditionServiceImpl_2_2.java\nindex f58ceb0f..18224705 100644\n--- a/api-2.2/src/main/java/org/openmrs/module/fhir2/api/impl/FhirConditionServiceImpl_2_2.java\n+++ b/api-2.2/src/main/java/org/openmrs/module/fhir2/api/impl/FhirConditionServiceImpl_2_2.java\n\n@@ -57,7 +57,7 @@ public class FhirConditionServiceImpl_2_2 extends BaseFhirService<Condition, org\n \t\tSearchParameterMap theParams = new SearchParameterMap()\n \t\t        .addParameter(FhirConstants.PATIENT_REFERENCE_SEARCH_HANDLER, patientParam)\n \t\t        .addParameter(FhirConstants.CODED_SEARCH_HANDLER, code)\n-\t\t        .addParameter(FhirConstants.STATUS_SEARCH_HANDLER, clinicalStatus)\n+\t\t        .addParameter(FhirConstants.CONDITION_CLINICAL_STATUS_HANDLER, clinicalStatus)\n \t\t        .addParameter(FhirConstants.QUANTITY_SEARCH_HANDLER, onsetAge)\n \t\t        .addParameter(FhirConstants.DATE_RANGE_SEARCH_HANDLER, \"onsetDate\", onsetDate)\n \t\t        .addParameter(FhirConstants.DATE_RANGE_SEARCH_HANDLER, \"dateCreated\", recordedDate).setSortSpec(sort);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5NTU5NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/213#discussion_r441295594", "bodyText": "Also, remove this formatting changes from this PR", "author": "corneliouzbett", "createdAt": "2020-06-17T05:51:11Z", "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r3/ConditionFhirR3ResourceProviderTest.java", "diffHunk": "@@ -178,36 +178,36 @@ public void searchConditions_shouldReturnConditionReturnedByService() {\n \t\tassertThat(resultList.size(), greaterThanOrEqualTo(1));\n \t\tassertThat(resultList.iterator().next().fhirType(), equalTo(FhirConstants.CONDITION));\n \t}\n-\n+\t\n \t@Test\n \tpublic void searchConditions_shouldReturnConditionReturnedByServiceWhenPatientIsNull() {\n \t\tReferenceAndListParam subjectReference = new ReferenceAndListParam();\n \t\tsubjectReference.addValue(new ReferenceOrListParam().add(new ReferenceParam(Patient.SP_GIVEN, \"subject name\")));\n-\n+\t\t\n \t\tTokenAndListParam codeList = new TokenAndListParam();\n \t\tcodeList.addValue(new TokenOrListParam().add(new TokenParam(\"test code\")));\n-\n+\t\t\n \t\tTokenAndListParam clinicalList = new TokenAndListParam();\n \t\tclinicalList.addValue(new TokenOrListParam().add(new TokenParam(\"test clinical\")));\n-\n+\t\t\n \t\tDateRangeParam onsetDate = new DateRangeParam().setLowerBound(\"lower date\").setUpperBound(\"upper date\");\n-\n+\t\t\n \t\tQuantityAndListParam onsetAge = new QuantityAndListParam();", "originalCommit": "a1f495f0c57a9e1309ca39575e3f2c09a62fdede", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "chunk": "diff --git a/api/src/test/java/org/openmrs/module/fhir2/providers/r3/ConditionFhirR3ResourceProviderTest.java b/api/src/test/java/org/openmrs/module/fhir2/providers/r3/ConditionFhirR3ResourceProviderTest.java\nindex eabcaaa0..1195b9ff 100644\n--- a/api/src/test/java/org/openmrs/module/fhir2/providers/r3/ConditionFhirR3ResourceProviderTest.java\n+++ b/api/src/test/java/org/openmrs/module/fhir2/providers/r3/ConditionFhirR3ResourceProviderTest.java\n\n@@ -178,36 +178,36 @@ public class ConditionFhirR3ResourceProviderTest extends BaseFhirR3ProvenanceRes\n \t\tassertThat(resultList.size(), greaterThanOrEqualTo(1));\n \t\tassertThat(resultList.iterator().next().fhirType(), equalTo(FhirConstants.CONDITION));\n \t}\n-\t\n+\n \t@Test\n \tpublic void searchConditions_shouldReturnConditionReturnedByServiceWhenPatientIsNull() {\n \t\tReferenceAndListParam subjectReference = new ReferenceAndListParam();\n \t\tsubjectReference.addValue(new ReferenceOrListParam().add(new ReferenceParam(Patient.SP_GIVEN, \"subject name\")));\n-\t\t\n+\n \t\tTokenAndListParam codeList = new TokenAndListParam();\n \t\tcodeList.addValue(new TokenOrListParam().add(new TokenParam(\"test code\")));\n-\t\t\n+\n \t\tTokenAndListParam clinicalList = new TokenAndListParam();\n \t\tclinicalList.addValue(new TokenOrListParam().add(new TokenParam(\"test clinical\")));\n-\t\t\n+\n \t\tDateRangeParam onsetDate = new DateRangeParam().setLowerBound(\"lower date\").setUpperBound(\"upper date\");\n-\t\t\n+\n \t\tQuantityAndListParam onsetAge = new QuantityAndListParam();\n \t\tonsetAge.addValue(new QuantityOrListParam().add(new QuantityParam(12)));\n-\t\t\n+\n \t\tDateRangeParam recordDate = new DateRangeParam().setLowerBound(\"lower record date\")\n-\t\t        .setUpperBound(\"upper record date\");\n-\t\t\n+\t\t\t\t.setUpperBound(\"upper record date\");\n+\n \t\tSortSpec sort = new SortSpec(\"sort param\");\n-\t\t\n+\n \t\twhen(conditionService.searchConditions(subjectReference, codeList, clinicalList, onsetDate, onsetAge, recordDate,\n-\t\t    sort)).thenReturn(new MockIBundleProvider<>(Collections.singletonList(condition), 10, 1));\n-\t\t\n-\t\tIBundleProvider result = resourceProvider.searchConditions(null, subjectReference, codeList, clinicalList, onsetDate,\n-\t\t    onsetAge, recordDate, sort);\n-\t\t\n+\t\t\t\tsort)).thenReturn(new MockIBundleProvider<>(Collections.singletonList(condition), 10, 1));\n+\n+\t\tIBundleProvider result = resourceProvider.searchConditions(null, subjectReference, codeList,\n+\t\t\t\tclinicalList, onsetDate, onsetAge, recordDate, sort);\n+\n \t\tList<IBaseResource> resultList = get(result);\n-\t\t\n+\n \t\tassertThat(result, notNullValue());\n \t\tassertThat(resultList.size(), greaterThanOrEqualTo(1));\n \t\tassertThat(resultList.iterator().next().fhirType(), equalTo(FhirConstants.CONDITION));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5Njc0Nw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/213#discussion_r441296747", "bodyText": "I guess you forgot about this. You should probably remove", "author": "corneliouzbett", "createdAt": "2020-06-17T05:54:50Z", "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r3/TaskFhirResourceProviderTest.java", "diffHunk": "@@ -170,25 +188,24 @@ public void getTaskHistoryByWithWrongId_shouldThrowResourceNotFoundException() {\n \t//\t\tresourceProvider.updateTask(new IdType().setValue(WRONG_TASK_UUID), wrongTask);\n \t//\t}\n \t\n-\t//TODO ERROR\n-\t//\t@Test\n-\t//\tpublic void searchTasks_shouldReturnMatchingTasks() {\n-\t//\t\tList<org.hl7.fhir.r4.model.Task> tasks = new ArrayList<>();\n-\t//\t\ttasks.add(task);\n-\t//\n-\t//\t\twhen(taskService.searchForTasks(any(), any(), any(), any())).thenReturn(tasks);\n-\t//\n-\t//\t\tTokenOrListParam status = new TokenOrListParam();\n-\t//\t\tTokenParam statusToken = new TokenParam();\n-\t//\t\tstatusToken.setValue(\"ACCEPTED\");\n-\t//\t\tstatus.add(statusToken);\n-\t//\n-\t//\t\tBundle results = resourceProvider.searchTasks(null, null, status, null);\n-\t//\n-\t//\t\tassertThat(results, notNullValue());\n-\t//\t\tassertThat(results.getTotal(), equalTo(1));\n-\t//\t\tassertThat(results.getEntry(), notNullValue());\n-\t//\t\tassertThat(results.getEntry().get(0).getResource().fhirType(), equalTo(\"Task\"));\n-\t//\t\tassertThat(results.getEntry().get(0).getResource().getId(), equalTo(TASK_UUID));\n-\t//\t}", "originalCommit": "a1f495f0c57a9e1309ca39575e3f2c09a62fdede", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcyMDE1Ng==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/213#discussion_r441720156", "bodyText": "I have added the correct test for this just below it. Hence deleted.", "author": "varung-31", "createdAt": "2020-06-17T17:45:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5Njc0Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "message": "FM2-229: Update Task resource to support paging", "committedDate": "2020-06-17T17:36:45Z", "type": "commit"}, {"oid": "daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/daa53f3f2087a6c1775c3d1c12a469feb3c85a9a", "message": "FM2-229: Update Task resource to support paging", "committedDate": "2020-06-17T17:36:45Z", "type": "forcePushed"}]}