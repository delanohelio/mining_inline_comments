{"pr_number": 16, "pr_title": "Added search by name for location resource", "pr_createdAt": "2020-01-10T09:01:54Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16", "timeline": [{"oid": "2444c0e95760449293fdaeb5c33234fd87413e78", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/2444c0e95760449293fdaeb5c33234fd87413e78", "message": "Added search by name for location resource", "committedDate": "2020-01-10T09:12:57Z", "type": "forcePushed"}, {"oid": "a124b26b5b646247a67e6b0ace7745ef0def1ce0", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/a124b26b5b646247a67e6b0ace7745ef0def1ce0", "message": "Added search by name for location resource", "committedDate": "2020-01-10T09:27:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE3Mzk1MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16#discussion_r365173950", "bodyText": "The method name doesn't match the test", "author": "corneliouzbett", "createdAt": "2020-01-10T10:42:24Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/impl/FhirLocationServiceImplTest.java", "diffHunk": "@@ -62,4 +62,19 @@ public void shouldGetLocationByUuid() {\n \t\torg.hl7.fhir.r4.model.Location result = fhirLocationService.getLocationByUuid(LOCATION_UUID);\n \t\tassertNotNull(location);\n \t}\n+\n+\t@Test\n+\tpublic void shouldGetLocationByName() {\n+\t\tLocation location = new Location();\n+\t\tlocation.setUuid(LOCATION_UUID);\n+\t\tlocation.setName(LOCATION_NAME);\n+\t\tlocation.setDescription(LOCATION_DESCRIPTION);\n+\t\tlocation.setDateCreated(new Date());\n+\t\tlocation.setRetired(false);\n+\n+\t\twhen(locationDao.getLocationByName(LOCATION_UUID)).thenReturn(location);\n+\n+\t\torg.hl7.fhir.r4.model.Location result = fhirLocationService.getLocationByUuid(LOCATION_UUID);\n+\t\tassertNotNull(location);\n+\t}", "originalCommit": "a124b26b5b646247a67e6b0ace7745ef0def1ce0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE3NTEyMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16#discussion_r365175123", "bodyText": "Also, add more assertions to check if it returns location with the correct name and even Id", "author": "corneliouzbett", "createdAt": "2020-01-10T10:45:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE3Mzk1MA=="}], "type": "inlineReview", "revised_code": {"commit": "9fef1e8aab9e3452b8417b79caa1bde2a045f5f9", "chunk": "diff --git a/api/src/test/java/org/openmrs/module/fhir2/api/impl/FhirLocationServiceImplTest.java b/api/src/test/java/org/openmrs/module/fhir2/api/impl/FhirLocationServiceImplTest.java\nindex a9fbca75..fec2dd4f 100644\n--- a/api/src/test/java/org/openmrs/module/fhir2/api/impl/FhirLocationServiceImplTest.java\n+++ b/api/src/test/java/org/openmrs/module/fhir2/api/impl/FhirLocationServiceImplTest.java\n\n@@ -41,40 +42,47 @@ public class FhirLocationServiceImplTest {\n \t\n \tprivate FhirLocationServiceImpl fhirLocationService;\n \t\n+\tprivate Location location;\n+\t\n+\tprivate org.hl7.fhir.r4.model.Location fhirLocation;\n+\t\n \t@Before\n \tpublic void setUp() {\n \t\tfhirLocationService = new FhirLocationServiceImpl();\n \t\tfhirLocationService.setLocationDao(locationDao);\n \t\tfhirLocationService.setLocationTranslator(locationTranslator);\n-\t}\n-\t\n-\t@Test\n-\tpublic void shouldGetLocationByUuid() {\n-\t\tLocation location = new Location();\n+\t\t\n+\t\tlocation = new Location();\n \t\tlocation.setUuid(LOCATION_UUID);\n \t\tlocation.setName(LOCATION_NAME);\n \t\tlocation.setDescription(LOCATION_DESCRIPTION);\n \t\tlocation.setDateCreated(new Date());\n \t\tlocation.setRetired(false);\n \t\t\n+\t\tfhirLocation = new org.hl7.fhir.r4.model.Location();\n+\t\tfhirLocation.setId(LOCATION_UUID);\n+\t\tfhirLocation.setName(LOCATION_NAME);\n+\t\tfhirLocation.setDescription(LOCATION_DESCRIPTION);\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldGetLocationByUuid() {\n \t\twhen(locationDao.getLocationByUuid(LOCATION_UUID)).thenReturn(location);\n+\t\twhen(locationTranslator.toFhirResource(location)).thenReturn(fhirLocation);\n \t\t\n \t\torg.hl7.fhir.r4.model.Location result = fhirLocationService.getLocationByUuid(LOCATION_UUID);\n-\t\tassertNotNull(location);\n+\t\tassertNotNull(result);\n+\t\tassertEquals(result.getId(), fhirLocation.getId());\n+\t\t\n \t}\n-\n+\t\n \t@Test\n \tpublic void shouldGetLocationByName() {\n-\t\tLocation location = new Location();\n-\t\tlocation.setUuid(LOCATION_UUID);\n-\t\tlocation.setName(LOCATION_NAME);\n-\t\tlocation.setDescription(LOCATION_DESCRIPTION);\n-\t\tlocation.setDateCreated(new Date());\n-\t\tlocation.setRetired(false);\n-\n-\t\twhen(locationDao.getLocationByName(LOCATION_UUID)).thenReturn(location);\n-\n-\t\torg.hl7.fhir.r4.model.Location result = fhirLocationService.getLocationByUuid(LOCATION_UUID);\n-\t\tassertNotNull(location);\n+\t\twhen(locationDao.getLocationByName(LOCATION_NAME)).thenReturn(location);\n+\t\twhen(locationTranslator.toFhirResource(location)).thenReturn(fhirLocation);\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location result = fhirLocationService.getLocationByName(LOCATION_NAME);\n+\t\tassertNotNull(result);\n+\t\tassertEquals(result.getId(), fhirLocation.getId());\n \t}\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4MDI5Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16#discussion_r365180293", "bodyText": "Search operations should return a list or collection. In this case, It should be returning a bundle.", "author": "corneliouzbett", "createdAt": "2020-01-10T10:58:04Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java", "diffHunk": "@@ -47,4 +50,14 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\t}\n \t\treturn location;\n \t}\n+\n+\t@Search\n+\t@SuppressWarnings(\"unused\")\n+\tpublic Location getLocationByName(@RequiredParam(name = Location.SP_NAME) StringParam name) {\n+\t\tLocation location = fhirLocationService.getLocationByName(name.getValue());\n+\t\tif (location == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find location with location name \" + name.getValue());\n+\t\t}\n+\t\treturn location;", "originalCommit": "a124b26b5b646247a67e6b0ace7745ef0def1ce0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9fef1e8aab9e3452b8417b79caa1bde2a045f5f9", "chunk": "diff --git a/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java b/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java\nindex 3e73def6..fc8a8da0 100644\n--- a/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java\n+++ b/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java\n\n@@ -50,7 +50,7 @@ public class LocationFhirResourceProvider implements IResourceProvider {\n \t\t}\n \t\treturn location;\n \t}\n-\n+\t\n \t@Search\n \t@SuppressWarnings(\"unused\")\n \tpublic Location getLocationByName(@RequiredParam(name = Location.SP_NAME) StringParam name) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4MzQzNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16#discussion_r365183436", "bodyText": "I understand that the name is unique from the database.\nSo this qualifies to be a Read operation @Read", "author": "corneliouzbett", "createdAt": "2020-01-10T11:06:04Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java", "diffHunk": "@@ -47,4 +50,14 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\t}\n \t\treturn location;\n \t}\n+\n+\t@Search\n+\t@SuppressWarnings(\"unused\")\n+\tpublic Location getLocationByName(@RequiredParam(name = Location.SP_NAME) StringParam name) {", "originalCommit": "a124b26b5b646247a67e6b0ace7745ef0def1ce0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9fef1e8aab9e3452b8417b79caa1bde2a045f5f9", "chunk": "diff --git a/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java b/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java\nindex 3e73def6..fc8a8da0 100644\n--- a/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java\n+++ b/omod/src/main/java/org/openmrs/module/fhir2/providers/LocationFhirResourceProvider.java\n\n@@ -50,7 +50,7 @@ public class LocationFhirResourceProvider implements IResourceProvider {\n \t\t}\n \t\treturn location;\n \t}\n-\n+\t\n \t@Search\n \t@SuppressWarnings(\"unused\")\n \tpublic Location getLocationByName(@RequiredParam(name = Location.SP_NAME) StringParam name) {\n"}}, {"oid": "9fef1e8aab9e3452b8417b79caa1bde2a045f5f9", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/9fef1e8aab9e3452b8417b79caa1bde2a045f5f9", "message": "Added search by name for location resource", "committedDate": "2020-01-10T11:44:18Z", "type": "forcePushed"}, {"oid": "78bc0b3fc38738d52bba3e259242d9616fbb7ab5", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/78bc0b3fc38738d52bba3e259242d9616fbb7ab5", "message": "FM2-24 : Added search by name for location resource", "committedDate": "2020-01-10T12:41:43Z", "type": "forcePushed"}, {"oid": "d30cc8c62bcdb68060367b810fe3e4d47fc31c0c", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d30cc8c62bcdb68060367b810fe3e4d47fc31c0c", "message": "FM2-24 : Added search by name for location resource", "committedDate": "2020-01-10T12:45:01Z", "type": "forcePushed"}, {"oid": "318240a789be7eae320f18274931984ee4dc4a6f", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/318240a789be7eae320f18274931984ee4dc4a6f", "message": "FM2-24 : Added search by name for location resource", "committedDate": "2020-01-10T12:52:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIyNjIxNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16#discussion_r365226216", "bodyText": "You should change the method name to\n\nfindLocationByName", "author": "corneliouzbett", "createdAt": "2020-01-10T13:10:44Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/FhirLocationService.java", "diffHunk": "@@ -12,8 +12,11 @@\n import org.hl7.fhir.r4.model.Location;\n \n import javax.validation.constraints.NotNull;\n+import java.util.Collection;\n \n public interface FhirLocationService {\n \t\n \tLocation getLocationByUuid(@NotNull String uuid);\n+\t\n+\tCollection<Location> getLocationByName(@NotNull String name);\n }", "originalCommit": "318240a789be7eae320f18274931984ee4dc4a6f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "08ae801d68832c678c0c89381b1b51abd6a3288b", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/FhirLocationService.java b/api/src/main/java/org/openmrs/module/fhir2/api/FhirLocationService.java\nindex c33fbf0b..ea86f5b6 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/FhirLocationService.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/FhirLocationService.java\n\n@@ -18,5 +18,5 @@ public interface FhirLocationService {\n \t\n \tLocation getLocationByUuid(@NotNull String uuid);\n \t\n-\tCollection<Location> getLocationByName(@NotNull String name);\n+\tCollection<Location> findLocationByName(@NotNull String name);\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIyNjgzNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/16#discussion_r365226835", "bodyText": "Ditto", "author": "corneliouzbett", "createdAt": "2020-01-10T13:12:26Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirLocationDao.java", "diffHunk": "@@ -12,8 +12,11 @@\n import org.openmrs.Location;\n \n import javax.validation.constraints.NotNull;\n+import java.util.Collection;\n \n public interface FhirLocationDao {\n \t\n \tLocation getLocationByUuid(@NotNull String uuid);\n+\t\n+\tCollection<Location> getLocationByName(@NotNull String name);", "originalCommit": "318240a789be7eae320f18274931984ee4dc4a6f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "08ae801d68832c678c0c89381b1b51abd6a3288b", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirLocationDao.java b/api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirLocationDao.java\nindex 42969a54..2d2ed56e 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirLocationDao.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirLocationDao.java\n\n@@ -18,5 +18,5 @@ public interface FhirLocationDao {\n \t\n \tLocation getLocationByUuid(@NotNull String uuid);\n \t\n-\tCollection<Location> getLocationByName(@NotNull String name);\n+\tCollection<Location> findLocationByName(@NotNull String name);\n }\n"}}, {"oid": "08ae801d68832c678c0c89381b1b51abd6a3288b", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/08ae801d68832c678c0c89381b1b51abd6a3288b", "message": "FM2-24 : Added search by name for location resource", "committedDate": "2020-01-10T13:17:52Z", "type": "commit"}, {"oid": "08ae801d68832c678c0c89381b1b51abd6a3288b", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/08ae801d68832c678c0c89381b1b51abd6a3288b", "message": "FM2-24 : Added search by name for location resource", "committedDate": "2020-01-10T13:17:52Z", "type": "forcePushed"}]}