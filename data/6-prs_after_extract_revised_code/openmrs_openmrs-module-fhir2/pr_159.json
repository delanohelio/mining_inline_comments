{"pr_number": 159, "pr_title": "FM2-155 : Update ObservationDAO and Service", "pr_createdAt": "2020-05-01T11:31:25Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3NDgzOA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r418574838", "bodyText": "@sherrif10 The declaration here should be Obs toOpenmrsType(Observation observation), i.e., translating from a FHIR Observation object to an OpenMRS Obs.", "author": "ibacher", "createdAt": "2020-05-01T14:49:19Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/ObservationTranslator.java", "diffHunk": "@@ -53,4 +53,6 @@ default Obs toOpenmrsType(Obs existingObs, Observation observation) {\n \t * @return an updated version of the current obs\n \t */\n \tObs toOpenmrsType(Obs existingObs, Observation observation, Supplier<Obs> groupedObsFactory);\n+\t\n+\tObs toOpenmrsType(Obs fhirObs);", "originalCommit": "8b4b850c11fe9114598121832b45cdff79d98ab6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/translators/ObservationTranslator.java b/api/src/main/java/org/openmrs/module/fhir2/api/translators/ObservationTranslator.java\nindex b5f013a5..0c289eba 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/translators/ObservationTranslator.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/translators/ObservationTranslator.java\n\n@@ -54,5 +54,5 @@ public interface ObservationTranslator extends ToFhirTranslator<Obs, Observation\n \t */\n \tObs toOpenmrsType(Obs existingObs, Observation observation, Supplier<Obs> groupedObsFactory);\n \t\n-\tObs toOpenmrsType(Obs fhirObs);\n+\tObs toOpenmrsType(Observation observation);\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4MjYyNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r418682626", "bodyText": "This should also be changed to public Obs to OpenmrsType(Observation fhirObservation)", "author": "ibacher", "createdAt": "2020-05-01T18:48:17Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java", "diffHunk": "@@ -121,6 +121,11 @@ public Observation toFhirResource(Obs observation) {\n \t\treturn obs;\n \t}\n \t\n+\t@Override\n+\tpublic Obs toOpenmrsType(Obs fhirObs) {", "originalCommit": "0237ebcbd31af52c6c3d2de319d1ca95b3e9815f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java b/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java\nindex 70dd0928..5287667a 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java\n\n@@ -122,8 +122,8 @@ public class ObservationTranslatorImpl implements ObservationTranslator {\n \t}\n \t\n \t@Override\n-\tpublic Obs toOpenmrsType(Obs fhirObs) {\n-\t\treturn toOpenmrsType(new Obs());\n+\tpublic Obs toOpenmrsType(Observation fhirObservation) {\n+\t\treturn toOpenmrsType(new Obs(), fhirObservation);\n \t}\n \t\n \t@Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODQxNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r419548415", "bodyText": "This should go right above the @Setter annotation.", "author": "ibacher", "createdAt": "2020-05-04T16:05:19Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java", "diffHunk": "@@ -31,10 +32,11 @@\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n+@Getter(AccessLevel.PROTECTED)", "originalCommit": "f1bbf841bbdc6ec5f465c9cb26b044a04b1115de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5OTM3MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420099370", "bodyText": "O k let me do it now", "author": "sherrif10", "createdAt": "2020-05-05T13:15:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODQxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\nindex feea2ce5..edecda53 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n\n@@ -32,9 +32,10 @@ import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n-@Getter(AccessLevel.PROTECTED)\n+\n @Component\n @Transactional\n+@Getter(AccessLevel.PROTECTED)\n @Setter(AccessLevel.PACKAGE)\n public class FhirObservationServiceImpl extends BaseFhirService<Observation, org.openmrs.Obs> implements FhirObservationService {\n \t\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODY5OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r419548698", "bodyText": "Remember that you need to rename the observationTranslator field to translator", "author": "ibacher", "createdAt": "2020-05-04T16:05:46Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java", "diffHunk": "@@ -31,10 +32,11 @@\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n+@Getter(AccessLevel.PROTECTED)\n @Component\n @Transactional\n @Setter(AccessLevel.PACKAGE)\n-public class FhirObservationServiceImpl implements FhirObservationService {\n+public class FhirObservationServiceImpl extends BaseFhirService<Observation, org.openmrs.Obs> implements FhirObservationService {", "originalCommit": "f1bbf841bbdc6ec5f465c9cb26b044a04b1115de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NzE5OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420187198", "bodyText": "Am not getting you by here renaming ObservationTranslator to translator", "author": "sherrif10", "createdAt": "2020-05-05T15:12:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODY5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzc1Ng==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420207756", "bodyText": "The field called observationTranslator in this class should be named translator.", "author": "ibacher", "createdAt": "2020-05-05T15:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODY5OA=="}], "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\nindex feea2ce5..edecda53 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n\n@@ -32,9 +32,10 @@ import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n-@Getter(AccessLevel.PROTECTED)\n+\n @Component\n @Transactional\n+@Getter(AccessLevel.PROTECTED)\n @Setter(AccessLevel.PACKAGE)\n public class FhirObservationServiceImpl extends BaseFhirService<Observation, org.openmrs.Obs> implements FhirObservationService {\n \t\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDAwMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420240003", "bodyText": "This should be private ObservationTranslator translator;", "author": "ibacher", "createdAt": "2020-05-05T16:25:08Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java", "diffHunk": "@@ -43,7 +44,7 @@\n \tprivate FhirObservationDao dao;\n \t\n \t@Autowired\n-\tprivate ObservationTranslator observationTranslator;\n+\tprivate Translator translator;", "originalCommit": "16455424e2a9de35a14995981861d5523646fd36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MTAzMQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420241031", "bodyText": "What's happening here is that we're using Lombok to automatically generate a getter and setter for the field. By naming the field translator, Lombok automatically generates a getTranslator() function, which the BaseFhirService class requires. But the type of translator (i.e., what it's translating between) doesn't change. As-is, this won't compile correctly.", "author": "ibacher", "createdAt": "2020-05-05T16:26:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NDA2MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420244061", "bodyText": "Finished", "author": "sherrif10", "createdAt": "2020-05-05T16:31:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NTM1OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420245358", "bodyText": "Actually i was asking my self why we change to translator but thanks", "author": "sherrif10", "createdAt": "2020-05-05T16:33:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDAwMw=="}], "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\nindex 5a17b6c9..edecda53 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n\n@@ -44,7 +43,7 @@ public class FhirObservationServiceImpl extends BaseFhirService<Observation, org\n \tprivate FhirObservationDao dao;\n \t\n \t@Autowired\n-\tprivate Translator translator;\n+\tprivate ObservationTranslator translator;\n \t\n \t@Autowired\n \tprivate SearchQuery<Obs, Observation, FhirObservationDao, ObservationTranslator> searchQuery;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDExNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420240115", "bodyText": "Please remove this import.", "author": "ibacher", "createdAt": "2020-05-05T16:25:18Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java", "diffHunk": "@@ -17,6 +17,7 @@\n import ca.uhn.fhir.rest.param.ReferenceParam;\n import ca.uhn.fhir.rest.param.StringAndListParam;\n import ca.uhn.fhir.rest.param.TokenAndListParam;\n+import javassist.Translator;", "originalCommit": "16455424e2a9de35a14995981861d5523646fd36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0Mzg1NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420243854", "bodyText": "Finished", "author": "sherrif10", "createdAt": "2020-05-05T16:30:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDExNQ=="}], "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\nindex 5a17b6c9..edecda53 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirObservationServiceImpl.java\n\n@@ -17,7 +17,6 @@ import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n import ca.uhn.fhir.rest.param.ReferenceParam;\n import ca.uhn.fhir.rest.param.StringAndListParam;\n import ca.uhn.fhir.rest.param.TokenAndListParam;\n-import javassist.Translator;\n import lombok.AccessLevel;\n import lombok.Getter;\n import lombok.Setter;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3NjIxNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420276215", "bodyText": "Last thing. This should be return toOpenmrsType(new Obs(), fhirObservation); That way, it actually does something.", "author": "ibacher", "createdAt": "2020-05-05T17:18:16Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java", "diffHunk": "@@ -121,6 +121,11 @@ public Observation toFhirResource(Obs observation) {\n \t\treturn obs;\n \t}\n \t\n+\t@Override\n+\tpublic Obs toOpenmrsType(Observation fhirObservation) {\n+\t\treturn new Obs();", "originalCommit": "fab45d44e4ee71fa88ebfb17aef248e34e96f255", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4NTYxMg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420285612", "bodyText": "Finished", "author": "sherrif10", "createdAt": "2020-05-05T17:32:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3NjIxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4NjA1MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/159#discussion_r420286051", "bodyText": "This time travis has taken long to cope up with building", "author": "sherrif10", "createdAt": "2020-05-05T17:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3NjIxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "ab104962a888107106cdc04b329b7e618d7f91dd", "chunk": "diff --git a/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java b/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java\nindex defc6bae..5287667a 100644\n--- a/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java\n+++ b/api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImpl.java\n\n@@ -123,7 +123,7 @@ public class ObservationTranslatorImpl implements ObservationTranslator {\n \t\n \t@Override\n \tpublic Obs toOpenmrsType(Observation fhirObservation) {\n-\t\treturn new Obs();\n+\t\treturn toOpenmrsType(new Obs(), fhirObservation);\n \t}\n \t\n \t@Override\n"}}, {"oid": "ab104962a888107106cdc04b329b7e618d7f91dd", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/ab104962a888107106cdc04b329b7e618d7f91dd", "message": "FM2-155 : Update ObservationDAO and Service\n\nhttps://issues.openmrs.org/browse/FM2-155", "committedDate": "2020-05-05T20:16:14Z", "type": "commit"}, {"oid": "24b11c2292b45f89bde6d5aa031f73d145122c00", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/24b11c2292b45f89bde6d5aa031f73d145122c00", "message": "Merge branch 'master' into FM2-155", "committedDate": "2020-05-05T20:19:42Z", "type": "commit"}]}