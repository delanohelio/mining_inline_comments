{"pr_number": 10207, "pr_title": "Dns resolver: honor resolv.conf timeout, rotate and attempts options", "pr_createdAt": "2020-04-24T05:41:01Z", "pr_url": "https://github.com/netty/netty/pull/10207", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMzAzMw==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414313033", "bodyText": "let's not change the default values used here.", "author": "normanmaurer", "createdAt": "2020-04-24T05:54:25Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolverBuilder.java", "diffHunk": "@@ -46,16 +45,17 @@\n     private Integer minTtl;\n     private Integer maxTtl;\n     private Integer negativeTtl;\n-    private long queryTimeoutMillis = 5000;\n+    private long queryTimeoutMillis = -1;\n     private ResolvedAddressTypes resolvedAddressTypes = DnsNameResolver.DEFAULT_RESOLVE_ADDRESS_TYPES;\n     private boolean completeOncePreferredResolved;\n     private boolean recursionDesired = true;\n-    private int maxQueriesPerResolve = 16;\n+    private int maxQueriesPerResolve = -1;", "originalCommit": "b5e60bd69fa874e6e2c7d81b97052d4340176740", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxNDcxNw==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414314717", "bodyText": "ah never mind... this is because we use the one configured by the system in DnsNameResolver then", "author": "normanmaurer", "createdAt": "2020-04-24T05:58:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMzAzMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMzQ2Mg==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414313462", "bodyText": "2020", "author": "normanmaurer", "createdAt": "2020-04-24T05:55:34Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2017 The Netty Project", "originalCommit": "b5e60bd69fa874e6e2c7d81b97052d4340176740", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "91c83cde190359599bd577a10f406d935a85022b", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\nindex ea3d76f1e0..d47564e7d2 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2017 The Netty Project\n+ * Copyright 2020 The Netty Project\n  *\n  * The Netty Project licenses this file to you under the Apache License,\n  * version 2.0 (the \"License\"); you may not use this file except in compliance\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxNTU4NQ==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414315585", "bodyText": "@fabienrenaud I wonder if we should better do this as part of the builder ?", "author": "normanmaurer", "createdAt": "2020-04-24T06:01:06Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -401,7 +403,7 @@ public DnsNameResolver(\n                                                                dnsQueryLifecycleObserverFactory) :\n                 checkNotNull(dnsQueryLifecycleObserverFactory, \"dnsQueryLifecycleObserverFactory\");\n         this.searchDomains = searchDomains != null ? searchDomains.clone() : DEFAULT_SEARCH_DOMAINS;\n-        this.ndots = ndots >= 0 ? ndots : DEFAULT_NDOTS;\n+        this.ndots = ndots >= 0 ? ndots : DEFAULT_OPTIONS.ndots();", "originalCommit": "b5e60bd69fa874e6e2c7d81b97052d4340176740", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM5MTgwOA==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414391808", "bodyText": "Doable.\nBut I'd need to keep this ndots >= 0 ? ndots : DEFAULT_NDOTS (with DEFAULT_NDOTS loaded from resolv.conf) just in case some users invoke the deprecated constructors with ndots=-1 and expect the value to be loaded from file automatically.\nLet me know which way you prefer.", "author": "fabienrenaud", "createdAt": "2020-04-24T08:26:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxNTU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUxMTQ0OQ==", "url": "https://github.com/netty/netty/pull/10207#discussion_r415511449", "bodyText": "never mind... lets keep it as you did.", "author": "normanmaurer", "createdAt": "2020-04-27T05:01:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxNTU4NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "91c83cde190359599bd577a10f406d935a85022b", "url": "https://github.com/netty/netty/commit/91c83cde190359599bd577a10f406d935a85022b", "message": "Dns resolver: honor resolv.conf timeout, rotate and attempts options\n\nMotivations\n-----------\nDnsNameResolverBuilder and DnsNameResolver do not auto-configure\nthemselves uing default options define in /etc/resolv.conf.\nIn particular, rotate, timeout and attempts options are ignored.\n\nModifications\n-------------\n - Modified UnixResolverDnsServerAddressStreamProvider to parse ndots,\nattempts and timeout options all at once and use these defaults to\nconfigure DnsNameResolver when values are not provided by the\nDnsNameResolverBuilder.\n - When rotate option is specified, the DnsServerAddresses returned by\nUnixResolverDnsServerAddressStreamProvider is rotational.\n - Amend resolv.conf options with the RES_OPTIONS environment variable\nwhen present.", "committedDate": "2020-04-24T08:19:34Z", "type": "forcePushed"}, {"oid": "7b2535e376669ae682a3e8786bce7f60a83d2de4", "url": "https://github.com/netty/netty/commit/7b2535e376669ae682a3e8786bce7f60a83d2de4", "message": "Dns resolver: honor resolv.conf timeout, rotate and attempts options\n\nMotivations\n-----------\nDnsNameResolverBuilder and DnsNameResolver do not auto-configure\nthemselves uing default options define in /etc/resolv.conf.\nIn particular, rotate, timeout and attempts options are ignored.\n\nModifications\n-------------\n - Modified UnixResolverDnsServerAddressStreamProvider to parse ndots,\nattempts and timeout options all at once and use these defaults to\nconfigure DnsNameResolver when values are not provided by the\nDnsNameResolverBuilder.\n - When rotate option is specified, the DnsServerAddresses returned by\nUnixResolverDnsServerAddressStreamProvider is rotational.\n - Amend resolv.conf options with the RES_OPTIONS environment variable\nwhen present.", "committedDate": "2020-04-24T08:25:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1MDM2Nw==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414550367", "bodyText": "why not use int ?", "author": "normanmaurer", "createdAt": "2020-04-24T12:50:04Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.resolver.dns;\n+\n+/**\n+ * Represents options defined in a file of the format <a href=https://linux.die.net/man/5/resolver>etc/resolv.conf</a>.\n+ */\n+final class UnixResolverOptions {\n+\n+    private final int ndots;\n+    private final int timeout;\n+    private final int attempts;\n+\n+    UnixResolverOptions(int ndots, int timeout, int attempts) {\n+        this.ndots = ndots;\n+        this.timeout = timeout;\n+        this.attempts = attempts;\n+    }\n+\n+    public static UnixResolverOptions.Builder newBuilder() {\n+        return new UnixResolverOptions.Builder();\n+    }\n+\n+    /**\n+     * The number of dots which must appear in a name before an initial absolute query is made.\n+     * The default value is {@code 1}.\n+     */\n+    public int ndots() {\n+        return ndots;\n+    }\n+\n+    /**\n+     * The timeout of each DNS query performed by this resolver (in seconds).\n+     * The default value is {@code 5}.\n+     */\n+    public int timeout() {\n+        return timeout;\n+    }\n+\n+    /**\n+     * The maximum allowed number of DNS queries to send when resolving a host name.\n+     * The default value is {@code 16}.\n+     */\n+    public int attempts() {\n+        return attempts;\n+    }\n+\n+    public static final class Builder {\n+\n+        private int ndots = 1;\n+        private int timeout = 5;\n+        private int attempts = 16;\n+\n+        private Builder() {\n+        }\n+\n+        public void setNdots(Integer ndots) {", "originalCommit": "7b2535e376669ae682a3e8786bce7f60a83d2de4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYxNDE3NA==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414614174", "bodyText": "null values are used for error control when parsing from strings failed for example (and not override defaults).\nBut I see you don't like it (I'm not fond of it either), so I moved catching NumberFormatException from parseResIntOption to parseResOption.", "author": "fabienrenaud", "createdAt": "2020-04-24T14:21:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1MDM2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\nindex d47564e7d2..742df4e542 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n\n@@ -67,22 +67,16 @@ final class UnixResolverOptions {\n         private Builder() {\n         }\n \n-        public void setNdots(Integer ndots) {\n-            if (ndots != null) {\n-                this.ndots = ndots;\n-            }\n+        public void setNdots(int ndots) {\n+            this.ndots = ndots;\n         }\n \n-        public void setTimeout(Integer timeout) {\n-            if (timeout != null) {\n-                this.timeout = timeout;\n-            }\n+        public void setTimeout(int timeout) {\n+            this.timeout = timeout;\n         }\n \n-        public void setAttempts(Integer attempts) {\n-            if (attempts != null) {\n-                this.attempts = attempts;\n-            }\n+        public void setAttempts(int attempts) {\n+            this.attempts = attempts;\n         }\n \n         public UnixResolverOptions build() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1MDQyNw==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414550427", "bodyText": "why not use int ?", "author": "normanmaurer", "createdAt": "2020-04-24T12:50:09Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.resolver.dns;\n+\n+/**\n+ * Represents options defined in a file of the format <a href=https://linux.die.net/man/5/resolver>etc/resolv.conf</a>.\n+ */\n+final class UnixResolverOptions {\n+\n+    private final int ndots;\n+    private final int timeout;\n+    private final int attempts;\n+\n+    UnixResolverOptions(int ndots, int timeout, int attempts) {\n+        this.ndots = ndots;\n+        this.timeout = timeout;\n+        this.attempts = attempts;\n+    }\n+\n+    public static UnixResolverOptions.Builder newBuilder() {\n+        return new UnixResolverOptions.Builder();\n+    }\n+\n+    /**\n+     * The number of dots which must appear in a name before an initial absolute query is made.\n+     * The default value is {@code 1}.\n+     */\n+    public int ndots() {\n+        return ndots;\n+    }\n+\n+    /**\n+     * The timeout of each DNS query performed by this resolver (in seconds).\n+     * The default value is {@code 5}.\n+     */\n+    public int timeout() {\n+        return timeout;\n+    }\n+\n+    /**\n+     * The maximum allowed number of DNS queries to send when resolving a host name.\n+     * The default value is {@code 16}.\n+     */\n+    public int attempts() {\n+        return attempts;\n+    }\n+\n+    public static final class Builder {\n+\n+        private int ndots = 1;\n+        private int timeout = 5;\n+        private int attempts = 16;\n+\n+        private Builder() {\n+        }\n+\n+        public void setNdots(Integer ndots) {\n+            if (ndots != null) {\n+                this.ndots = ndots;\n+            }\n+        }\n+\n+        public void setTimeout(Integer timeout) {", "originalCommit": "7b2535e376669ae682a3e8786bce7f60a83d2de4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\nindex d47564e7d2..742df4e542 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n\n@@ -67,22 +67,16 @@ final class UnixResolverOptions {\n         private Builder() {\n         }\n \n-        public void setNdots(Integer ndots) {\n-            if (ndots != null) {\n-                this.ndots = ndots;\n-            }\n+        public void setNdots(int ndots) {\n+            this.ndots = ndots;\n         }\n \n-        public void setTimeout(Integer timeout) {\n-            if (timeout != null) {\n-                this.timeout = timeout;\n-            }\n+        public void setTimeout(int timeout) {\n+            this.timeout = timeout;\n         }\n \n-        public void setAttempts(Integer attempts) {\n-            if (attempts != null) {\n-                this.attempts = attempts;\n-            }\n+        public void setAttempts(int attempts) {\n+            this.attempts = attempts;\n         }\n \n         public UnixResolverOptions build() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1MDUxNQ==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414550515", "bodyText": "why not use int ?", "author": "normanmaurer", "createdAt": "2020-04-24T12:50:16Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.resolver.dns;\n+\n+/**\n+ * Represents options defined in a file of the format <a href=https://linux.die.net/man/5/resolver>etc/resolv.conf</a>.\n+ */\n+final class UnixResolverOptions {\n+\n+    private final int ndots;\n+    private final int timeout;\n+    private final int attempts;\n+\n+    UnixResolverOptions(int ndots, int timeout, int attempts) {\n+        this.ndots = ndots;\n+        this.timeout = timeout;\n+        this.attempts = attempts;\n+    }\n+\n+    public static UnixResolverOptions.Builder newBuilder() {\n+        return new UnixResolverOptions.Builder();\n+    }\n+\n+    /**\n+     * The number of dots which must appear in a name before an initial absolute query is made.\n+     * The default value is {@code 1}.\n+     */\n+    public int ndots() {\n+        return ndots;\n+    }\n+\n+    /**\n+     * The timeout of each DNS query performed by this resolver (in seconds).\n+     * The default value is {@code 5}.\n+     */\n+    public int timeout() {\n+        return timeout;\n+    }\n+\n+    /**\n+     * The maximum allowed number of DNS queries to send when resolving a host name.\n+     * The default value is {@code 16}.\n+     */\n+    public int attempts() {\n+        return attempts;\n+    }\n+\n+    public static final class Builder {\n+\n+        private int ndots = 1;\n+        private int timeout = 5;\n+        private int attempts = 16;\n+\n+        private Builder() {\n+        }\n+\n+        public void setNdots(Integer ndots) {\n+            if (ndots != null) {\n+                this.ndots = ndots;\n+            }\n+        }\n+\n+        public void setTimeout(Integer timeout) {\n+            if (timeout != null) {", "originalCommit": "7b2535e376669ae682a3e8786bce7f60a83d2de4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\nindex d47564e7d2..742df4e542 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n\n@@ -67,22 +67,16 @@ final class UnixResolverOptions {\n         private Builder() {\n         }\n \n-        public void setNdots(Integer ndots) {\n-            if (ndots != null) {\n-                this.ndots = ndots;\n-            }\n+        public void setNdots(int ndots) {\n+            this.ndots = ndots;\n         }\n \n-        public void setTimeout(Integer timeout) {\n-            if (timeout != null) {\n-                this.timeout = timeout;\n-            }\n+        public void setTimeout(int timeout) {\n+            this.timeout = timeout;\n         }\n \n-        public void setAttempts(Integer attempts) {\n-            if (attempts != null) {\n-                this.attempts = attempts;\n-            }\n+        public void setAttempts(int attempts) {\n+            this.attempts = attempts;\n         }\n \n         public UnixResolverOptions build() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1MDU5OQ==", "url": "https://github.com/netty/netty/pull/10207#discussion_r414550599", "bodyText": "why not use int ?", "author": "normanmaurer", "createdAt": "2020-04-24T12:50:25Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.resolver.dns;\n+\n+/**\n+ * Represents options defined in a file of the format <a href=https://linux.die.net/man/5/resolver>etc/resolv.conf</a>.\n+ */\n+final class UnixResolverOptions {\n+\n+    private final int ndots;\n+    private final int timeout;\n+    private final int attempts;\n+\n+    UnixResolverOptions(int ndots, int timeout, int attempts) {\n+        this.ndots = ndots;\n+        this.timeout = timeout;\n+        this.attempts = attempts;\n+    }\n+\n+    public static UnixResolverOptions.Builder newBuilder() {\n+        return new UnixResolverOptions.Builder();\n+    }\n+\n+    /**\n+     * The number of dots which must appear in a name before an initial absolute query is made.\n+     * The default value is {@code 1}.\n+     */\n+    public int ndots() {\n+        return ndots;\n+    }\n+\n+    /**\n+     * The timeout of each DNS query performed by this resolver (in seconds).\n+     * The default value is {@code 5}.\n+     */\n+    public int timeout() {\n+        return timeout;\n+    }\n+\n+    /**\n+     * The maximum allowed number of DNS queries to send when resolving a host name.\n+     * The default value is {@code 16}.\n+     */\n+    public int attempts() {\n+        return attempts;\n+    }\n+\n+    public static final class Builder {\n+\n+        private int ndots = 1;\n+        private int timeout = 5;\n+        private int attempts = 16;\n+\n+        private Builder() {\n+        }\n+\n+        public void setNdots(Integer ndots) {\n+            if (ndots != null) {\n+                this.ndots = ndots;\n+            }\n+        }\n+\n+        public void setTimeout(Integer timeout) {\n+            if (timeout != null) {\n+                this.timeout = timeout;\n+            }\n+        }\n+\n+        public void setAttempts(Integer attempts) {", "originalCommit": "7b2535e376669ae682a3e8786bce7f60a83d2de4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\nindex d47564e7d2..742df4e542 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n\n@@ -67,22 +67,16 @@ final class UnixResolverOptions {\n         private Builder() {\n         }\n \n-        public void setNdots(Integer ndots) {\n-            if (ndots != null) {\n-                this.ndots = ndots;\n-            }\n+        public void setNdots(int ndots) {\n+            this.ndots = ndots;\n         }\n \n-        public void setTimeout(Integer timeout) {\n-            if (timeout != null) {\n-                this.timeout = timeout;\n-            }\n+        public void setTimeout(int timeout) {\n+            this.timeout = timeout;\n         }\n \n-        public void setAttempts(Integer attempts) {\n-            if (attempts != null) {\n-                this.attempts = attempts;\n-            }\n+        public void setAttempts(int attempts) {\n+            this.attempts = attempts;\n         }\n \n         public UnixResolverOptions build() {\n"}}, {"oid": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "url": "https://github.com/netty/netty/commit/fe7b3fa401b90b98843c860e913c2896c6e10fdf", "message": "Dns resolver: honor resolv.conf timeout, rotate and attempts options\n\nMotivations\n-----------\nDnsNameResolverBuilder and DnsNameResolver do not auto-configure\nthemselves uing default options define in /etc/resolv.conf.\nIn particular, rotate, timeout and attempts options are ignored.\n\nModifications\n-------------\n - Modified UnixResolverDnsServerAddressStreamProvider to parse ndots,\nattempts and timeout options all at once and use these defaults to\nconfigure DnsNameResolver when values are not provided by the\nDnsNameResolverBuilder.\n - When rotate option is specified, the DnsServerAddresses returned by\nUnixResolverDnsServerAddressStreamProvider is rotational.\n - Amend resolv.conf options with the RES_OPTIONS environment variable\nwhen present.", "committedDate": "2020-04-24T14:18:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MzM1Nw==", "url": "https://github.com/netty/netty/pull/10207#discussion_r415793357", "bodyText": "nit: make all of the methods package-private as the class is package-private as well. This also ensures we no expose these by mistake at some point.", "author": "normanmaurer", "createdAt": "2020-04-27T13:03:14Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.resolver.dns;\n+\n+/**\n+ * Represents options defined in a file of the format <a href=https://linux.die.net/man/5/resolver>etc/resolv.conf</a>.\n+ */\n+final class UnixResolverOptions {\n+\n+    private final int ndots;\n+    private final int timeout;\n+    private final int attempts;\n+\n+    UnixResolverOptions(int ndots, int timeout, int attempts) {\n+        this.ndots = ndots;\n+        this.timeout = timeout;\n+        this.attempts = attempts;\n+    }\n+\n+    public static UnixResolverOptions.Builder newBuilder() {", "originalCommit": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0MTE4MQ==", "url": "https://github.com/netty/netty/pull/10207#discussion_r415941181", "bodyText": "done", "author": "fabienrenaud", "createdAt": "2020-04-27T16:00:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MzM1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "f52d62f7a5abb5724dd8e320d9469d6001802e2a", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\nindex 742df4e542..dcfedd8baa 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverOptions.java\n\n@@ -30,7 +30,7 @@ final class UnixResolverOptions {\n         this.attempts = attempts;\n     }\n \n-    public static UnixResolverOptions.Builder newBuilder() {\n+    static UnixResolverOptions.Builder newBuilder() {\n         return new UnixResolverOptions.Builder();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MzU5OQ==", "url": "https://github.com/netty/netty/pull/10207#discussion_r415793599", "bodyText": "add a comment why its ok to ignore.", "author": "normanmaurer", "createdAt": "2020-04-27T13:03:38Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverDnsServerAddressStreamProvider.java", "diffHunk": "@@ -306,7 +312,34 @@ static int parseEtcResolverFirstNdots(File etcResolvConf) throws IOException {\n                 br.close();\n             }\n         }\n-        return DEFAULT_NDOTS;\n+\n+        // amend options\n+        if (RES_OPTIONS != null) {\n+            parseResOptions(RES_OPTIONS, optionsBuilder);\n+        }\n+\n+        return optionsBuilder.build();\n+    }\n+\n+    private static void parseResOptions(String line, UnixResolverOptions.Builder builder) {\n+        String[] opts = WHITESPACE_PATTERN.split(line);\n+        for (String opt : opts) {\n+            try {\n+                if (opt.startsWith(\"ndots:\")) {\n+                    builder.setNdots(parseResIntOption(opt, \"ndots:\"));\n+                } else if (opt.startsWith(\"attempts:\")) {\n+                    builder.setAttempts(parseResIntOption(opt, \"attempts:\"));\n+                } else if (opt.startsWith(\"timeout:\")) {\n+                    builder.setTimeout(parseResIntOption(opt, \"timeout:\"));\n+                }\n+            } catch (NumberFormatException ignore) {\n+            }", "originalCommit": "fe7b3fa401b90b98843c860e913c2896c6e10fdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0MTI0Nw==", "url": "https://github.com/netty/netty/pull/10207#discussion_r415941247", "bodyText": "done", "author": "fabienrenaud", "createdAt": "2020-04-27T16:00:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MzU5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f52d62f7a5abb5724dd8e320d9469d6001802e2a", "chunk": "diff --git a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverDnsServerAddressStreamProvider.java b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverDnsServerAddressStreamProvider.java\nindex df0bee79fd..0bbe9136af 100644\n--- a/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverDnsServerAddressStreamProvider.java\n+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/UnixResolverDnsServerAddressStreamProvider.java\n\n@@ -333,6 +333,7 @@ public final class UnixResolverDnsServerAddressStreamProvider implements DnsServ\n                     builder.setTimeout(parseResIntOption(opt, \"timeout:\"));\n                 }\n             } catch (NumberFormatException ignore) {\n+                // skip bad int values from resolv.conf to keep value already set in UnixResolverOptions\n             }\n         }\n     }\n"}}, {"oid": "f52d62f7a5abb5724dd8e320d9469d6001802e2a", "url": "https://github.com/netty/netty/commit/f52d62f7a5abb5724dd8e320d9469d6001802e2a", "message": "Dns resolver: honor resolv.conf timeout, rotate and attempts options\n\nMotivations\n-----------\nDnsNameResolverBuilder and DnsNameResolver do not auto-configure\nthemselves uing default options define in /etc/resolv.conf.\nIn particular, rotate, timeout and attempts options are ignored.\n\nModifications\n-------------\n - Modified UnixResolverDnsServerAddressStreamProvider to parse ndots,\nattempts and timeout options all at once and use these defaults to\nconfigure DnsNameResolver when values are not provided by the\nDnsNameResolverBuilder.\n - When rotate option is specified, the DnsServerAddresses returned by\nUnixResolverDnsServerAddressStreamProvider is rotational.\n - Amend resolv.conf options with the RES_OPTIONS environment variable\nwhen present.", "committedDate": "2020-04-27T16:00:41Z", "type": "commit"}, {"oid": "f52d62f7a5abb5724dd8e320d9469d6001802e2a", "url": "https://github.com/netty/netty/commit/f52d62f7a5abb5724dd8e320d9469d6001802e2a", "message": "Dns resolver: honor resolv.conf timeout, rotate and attempts options\n\nMotivations\n-----------\nDnsNameResolverBuilder and DnsNameResolver do not auto-configure\nthemselves uing default options define in /etc/resolv.conf.\nIn particular, rotate, timeout and attempts options are ignored.\n\nModifications\n-------------\n - Modified UnixResolverDnsServerAddressStreamProvider to parse ndots,\nattempts and timeout options all at once and use these defaults to\nconfigure DnsNameResolver when values are not provided by the\nDnsNameResolverBuilder.\n - When rotate option is specified, the DnsServerAddresses returned by\nUnixResolverDnsServerAddressStreamProvider is rotational.\n - Amend resolv.conf options with the RES_OPTIONS environment variable\nwhen present.", "committedDate": "2020-04-27T16:00:41Z", "type": "forcePushed"}]}