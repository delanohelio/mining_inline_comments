{"pr_number": 10444, "pr_title": "Create a new h2 stream only if the parent channel is still active", "pr_createdAt": "2020-08-01T02:56:00Z", "pr_url": "https://github.com/netty/netty/pull/10444", "timeline": [{"oid": "bb9e540419b74534b408c6b7ccd809493e049351", "url": "https://github.com/netty/netty/commit/bb9e540419b74534b408c6b7ccd809493e049351", "message": "Create a new h2 stream only if the parent channel is still active\n\nMotivation:\n\nIf a request to open a new h2 stream was made from outside of the\nEventLoop it will be scheduled for future execution on the EventLoop.\nHowever, during the time before the `open0` task will be executed the\nparent channel may already be closed. As the result,\n`Http2MultiplexHandler#newOutboundStream()` will throw an\n`IllegalStateException` with the message that is hard to\ninterpret correctly for this use-case: \"Http2FrameCodec not found. Has\nthe handler been added to a pipeline?\".\n\nModifications:\n\n- Check that the parent h2 `Channel` is still active before creating a\nnew stream when `open0` task is picked up by EventLoop;\n\nResult:\n\nUsers see a correct `ClosedChannelException` in case the parent h2\n`Channel` was closed concurrently with a request for a new stream.", "committedDate": "2020-08-01T02:55:16Z", "type": "commit"}, {"oid": "72425906d5668d44ba2095d1efdf276e8f1a42ee", "url": "https://github.com/netty/netty/commit/72425906d5668d44ba2095d1efdf276e8f1a42ee", "message": "Add unit-test", "committedDate": "2020-08-05T02:17:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMTM3MA==", "url": "https://github.com/netty/netty/pull/10444#discussion_r465511370", "bodyText": "nit: add license header", "author": "normanmaurer", "createdAt": "2020-08-05T06:52:42Z", "path": "codec-http2/src/test/java/io/netty/handler/codec/http2/Http2StreamChannelBootstrapTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package io.netty.handler.codec.http2;", "originalCommit": "72425906d5668d44ba2095d1efdf276e8f1a42ee", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d7f366c6838073be957053656e7cde6c17785c0", "chunk": "diff --git a/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2StreamChannelBootstrapTest.java b/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2StreamChannelBootstrapTest.java\nindex a454b2f67e..f37daa111f 100644\n--- a/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2StreamChannelBootstrapTest.java\n+++ b/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2StreamChannelBootstrapTest.java\n\n@@ -1,3 +1,18 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n package io.netty.handler.codec.http2;\n \n import io.netty.bootstrap.Bootstrap;\n"}}, {"oid": "6d7f366c6838073be957053656e7cde6c17785c0", "url": "https://github.com/netty/netty/commit/6d7f366c6838073be957053656e7cde6c17785c0", "message": "add license header", "committedDate": "2020-08-05T16:20:05Z", "type": "commit"}, {"oid": "cdeeac764c5766261432d0d0835c90d6a4e2d3fe", "url": "https://github.com/netty/netty/commit/cdeeac764c5766261432d0d0835c90d6a4e2d3fe", "message": "Merge branch '4.1' into stream-channel-is-active", "committedDate": "2020-08-06T06:36:14Z", "type": "commit"}, {"oid": "6898ae2ec11037e07d6c7f5950b7c87e8143b7b4", "url": "https://github.com/netty/netty/commit/6898ae2ec11037e07d6c7f5950b7c87e8143b7b4", "message": "Fix compile error", "committedDate": "2020-08-06T07:25:01Z", "type": "commit"}, {"oid": "d1b1920825cc10a5c9180d022273c141f49fac6e", "url": "https://github.com/netty/netty/commit/d1b1920825cc10a5c9180d022273c141f49fac6e", "message": "Fix check style", "committedDate": "2020-08-06T08:58:25Z", "type": "commit"}]}