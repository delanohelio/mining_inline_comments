{"pr_number": 10714, "pr_title": "DatagramDnsResponseDecoder should rethrow as CorruptedFrameException", "pr_createdAt": "2020-10-20T15:56:41Z", "pr_url": "https://github.com/netty/netty/pull/10714", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1NjM1OQ==", "url": "https://github.com/netty/netty/pull/10714#discussion_r508756359", "bodyText": "Dropped packets need to be released", "author": "idelpivnitskiy", "createdAt": "2020-10-20T18:41:20Z", "path": "codec-dns/src/main/java/io/netty/handler/codec/dns/DatagramDnsResponseDecoder.java", "diffHunk": "@@ -55,7 +55,10 @@ protected DnsResponse newResponse(InetSocketAddress sender, InetSocketAddress re\n \n     @Override\n     protected void decode(ChannelHandlerContext ctx, DatagramPacket packet, List<Object> out) throws Exception {\n-        out.add(decodeResponse(ctx, packet));\n+        // If the content is not readable we should just drop it on the floor as there is nothing we can do with it.\n+        if (packet.content().isReadable()) {", "originalCommit": "c4c02c5dfae36d829f5c38445492b924e33c5f96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA1MjU5NA==", "url": "https://github.com/netty/netty/pull/10714#discussion_r509052594", "bodyText": "no... MessageToMessageDecoder will release by itself.", "author": "normanmaurer", "createdAt": "2020-10-21T07:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1NjM1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "6925a61f1cf5b64dab42bc8ccc2c1a371cef2dc6", "chunk": "diff --git a/codec-dns/src/main/java/io/netty/handler/codec/dns/DatagramDnsResponseDecoder.java b/codec-dns/src/main/java/io/netty/handler/codec/dns/DatagramDnsResponseDecoder.java\nindex 3554fcc0c5..748c0e9bbf 100644\n--- a/codec-dns/src/main/java/io/netty/handler/codec/dns/DatagramDnsResponseDecoder.java\n+++ b/codec-dns/src/main/java/io/netty/handler/codec/dns/DatagramDnsResponseDecoder.java\n\n@@ -55,9 +56,10 @@ public class DatagramDnsResponseDecoder extends MessageToMessageDecoder<Datagram\n \n     @Override\n     protected void decode(ChannelHandlerContext ctx, DatagramPacket packet, List<Object> out) throws Exception {\n-        // If the content is not readable we should just drop it on the floor as there is nothing we can do with it.\n-        if (packet.content().isReadable()) {\n+        try {\n             out.add(decodeResponse(ctx, packet));\n+        } catch (IndexOutOfBoundsException e) {\n+            throw new CorruptedFrameException(\"Unable to decode response\", e);\n         }\n     }\n \n"}}, {"oid": "6925a61f1cf5b64dab42bc8ccc2c1a371cef2dc6", "url": "https://github.com/netty/netty/commit/6925a61f1cf5b64dab42bc8ccc2c1a371cef2dc6", "message": "DatagramDnsResponseDecoder should rethrow as CorruptedFrameException\n\nMotivation:\n\nDatagramDnsResponseDecoder should rethrow as CorruptedFrameException if an IndexOutOfBoundsException happens.\n\nModifications:\n\n- Catch IndexOutOfBoundsException and rethrow as CorruptedFrameException\n- Add a testcase\n\nResult:\n\nLess noise in the logs", "committedDate": "2020-10-21T07:59:12Z", "type": "commit"}, {"oid": "6925a61f1cf5b64dab42bc8ccc2c1a371cef2dc6", "url": "https://github.com/netty/netty/commit/6925a61f1cf5b64dab42bc8ccc2c1a371cef2dc6", "message": "DatagramDnsResponseDecoder should rethrow as CorruptedFrameException\n\nMotivation:\n\nDatagramDnsResponseDecoder should rethrow as CorruptedFrameException if an IndexOutOfBoundsException happens.\n\nModifications:\n\n- Catch IndexOutOfBoundsException and rethrow as CorruptedFrameException\n- Add a testcase\n\nResult:\n\nLess noise in the logs", "committedDate": "2020-10-21T07:59:12Z", "type": "forcePushed"}]}