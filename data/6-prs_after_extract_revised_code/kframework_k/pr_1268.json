{"pr_number": 1268, "pr_title": "Support priority attribute in macros", "pr_createdAt": "2020-05-07T14:43:45Z", "pr_url": "https://github.com/kframework/k/pull/1268", "timeline": [{"oid": "2e2c37a66ddf0dd7e182de695bbc64e1db43e23b", "url": "https://github.com/kframework/k/commit/2e2c37a66ddf0dd7e182de695bbc64e1db43e23b", "message": "refactor use of owise attribute", "committedDate": "2020-05-07T14:28:38Z", "type": "commit"}, {"oid": "02c9dd4fd1280cfc701e50f6653e805ead6f3e68", "url": "https://github.com/kframework/k/commit/02c9dd4fd1280cfc701e50f6653e805ead6f3e68", "message": "use priority attribute when sorting macros", "committedDate": "2020-05-07T14:28:45Z", "type": "commit"}, {"oid": "913bff1121967a45558fa2ee376ab7ff6bbe3480", "url": "https://github.com/kframework/k/commit/913bff1121967a45558fa2ee376ab7ff6bbe3480", "message": "don't box", "committedDate": "2020-05-07T14:30:16Z", "type": "commit"}, {"oid": "5434689bd8ccf21f6b1307e0057326da4d09c5d7", "url": "https://github.com/kframework/k/commit/5434689bd8ccf21f6b1307e0057326da4d09c5d7", "message": "fix indent", "committedDate": "2020-05-07T14:35:29Z", "type": "commit"}, {"oid": "b139d05281605a3f26e7e5500546f527418c73a0", "url": "https://github.com/kframework/k/commit/b139d05281605a3f26e7e5500546f527418c73a0", "message": "add missing constant", "committedDate": "2020-05-07T14:35:32Z", "type": "commit"}, {"oid": "b179b1101f27bb2aeb503b5532a0f618bb19cfcb", "url": "https://github.com/kframework/k/commit/b179b1101f27bb2aeb503b5532a0f618bb19cfcb", "message": "add test", "committedDate": "2020-05-07T14:42:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyNjE3Ng==", "url": "https://github.com/kframework/k/pull/1268#discussion_r421626176", "bodyText": "This same function should be re-used for ModuleToKORE to make sure that we keep any logic about how to compute the priority of a rule in sync.", "author": "ehildenb", "createdAt": "2020-05-07T16:13:43Z", "path": "kernel/src/main/java/org/kframework/compile/ExpandMacros.java", "diffHunk": "@@ -107,6 +107,19 @@ public ExpandMacros(ResolveFunctionWithConfig transformer, Module mod, FileUtil\n         }\n     }\n \n+    private int getPriority(Att att) {\n+        if (att.contains(Att.PRIORITY())) {\n+            try {\n+                return Integer.parseInt(att.get(Att.PRIORITY()));\n+            } catch (NumberFormatException e) {\n+                throw KEMException.compilerError(\"Invalid value for priority attribute: \" + att.get(Att.PRIORITY()) + \". Must be an integer.\", e);\n+            }\n+        } else if (att.contains(Att.OWISE())) {\n+            return 200;\n+        }\n+        return 50;\n+    }", "originalCommit": "b179b1101f27bb2aeb503b5532a0f618bb19cfcb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "17146494c1f84b7c9b803e6f6c42c5d1ec5e999c", "chunk": "diff --git a/kernel/src/main/java/org/kframework/compile/ExpandMacros.java b/kernel/src/main/java/org/kframework/compile/ExpandMacros.java\nindex 1f38dfb94..0d5069abe 100644\n--- a/kernel/src/main/java/org/kframework/compile/ExpandMacros.java\n+++ b/kernel/src/main/java/org/kframework/compile/ExpandMacros.java\n\n@@ -107,19 +108,6 @@ public class ExpandMacros {\n         }\n     }\n \n-    private int getPriority(Att att) {\n-        if (att.contains(Att.PRIORITY())) {\n-            try {\n-                return Integer.parseInt(att.get(Att.PRIORITY()));\n-            } catch (NumberFormatException e) {\n-                throw KEMException.compilerError(\"Invalid value for priority attribute: \" + att.get(Att.PRIORITY()) + \". Must be an integer.\", e);\n-            }\n-        } else if (att.contains(Att.OWISE())) {\n-            return 200;\n-        }\n-        return 50;\n-    }\n-\n     private K getLeft(Rule r, boolean reverse) {\n         if (reverse) {\n             return RewriteToTop.toRight(r.body());\n"}}, {"oid": "17146494c1f84b7c9b803e6f6c42c5d1ec5e999c", "url": "https://github.com/kframework/k/commit/17146494c1f84b7c9b803e6f6c42c5d1ec5e999c", "message": "refactor out getPriority method", "committedDate": "2020-05-07T17:01:42Z", "type": "commit"}, {"oid": "9d70770842e165be937ba1cde8975685046c6594", "url": "https://github.com/kframework/k/commit/9d70770842e165be937ba1cde8975685046c6594", "message": "Merge branch 'master' into macro3", "committedDate": "2020-05-08T10:51:00Z", "type": "commit"}]}