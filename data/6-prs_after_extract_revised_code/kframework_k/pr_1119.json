{"pr_number": 1119, "pr_title": "fix bug in AddEmptyLists where lub sort cannot be determined", "pr_createdAt": "2020-02-25T17:03:55Z", "pr_url": "https://github.com/kframework/k/pull/1119", "timeline": [{"oid": "cf6d223e45c48487827a6440111a72a872ce29d1", "url": "https://github.com/kframework/k/commit/cf6d223e45c48487827a6440111a72a872ce29d1", "message": "add test", "committedDate": "2020-02-25T16:19:31Z", "type": "commit"}, {"oid": "dee1ebfe39910137ce806cb2df109e90967d9690", "url": "https://github.com/kframework/k/commit/dee1ebfe39910137ce806cb2df109e90967d9690", "message": "fix bug in AddEmptyLists where lub sort cannot be determined", "committedDate": "2020-02-25T17:02:08Z", "type": "commit"}, {"oid": "f597c9150c776d64821709f553daefee53c7b47e", "url": "https://github.com/kframework/k/commit/f597c9150c776d64821709f553daefee53c7b47e", "message": "expected sort of KSequence is K on rhs", "committedDate": "2020-02-25T17:48:26Z", "type": "commit"}, {"oid": "83d7d997561bfa5e710dd526ab2acb7eee511a85", "url": "https://github.com/kframework/k/commit/83d7d997561bfa5e710dd526ab2acb7eee511a85", "message": "add another test", "committedDate": "2020-02-25T17:52:44Z", "type": "commit"}, {"oid": "7fbab1bb4ea41a9c625b98acad8330e294383d53", "url": "https://github.com/kframework/k/commit/7fbab1bb4ea41a9c625b98acad8330e294383d53", "message": "fix case when parametric production appears on rhs under KSequence\n\nAnother issue with sort inference that was discovered when we started\nfiltering by the expected sort when computing the LUB sort was that we\nwere not setting the correct expected sort for children of KSequence\non the RHS. On the lhs, KSequence children have an expected sort of\nKItem because they have to match on a cons list, however, because of the\ncons list append operation, children on the rhs can be of sort K. This\nwas causing an error where we filtered out all possible sorts and were\nunable to assign a sort to parametric productions that appeared under a\nKSequence on the RHS. Now we correctly assign sort K in these cases.", "committedDate": "2020-02-25T17:52:51Z", "type": "commit"}, {"oid": "635af3afa527fee289ca302ca9949f880376c288", "url": "https://github.com/kframework/k/commit/635af3afa527fee289ca302ca9949f880376c288", "message": "Merge branch 'master' into lub", "committedDate": "2020-02-25T20:50:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExOTMzMw==", "url": "https://github.com/kframework/k/pull/1119#discussion_r384119333", "bodyText": "The name of this function looks funny to me. Could you at least add some documentation?", "author": "radumereuta", "createdAt": "2020-02-25T20:52:46Z", "path": "kernel/src/main/java/org/kframework/parser/concrete2kore/disambiguation/AddEmptyLists.java", "diffHunk": "@@ -63,6 +63,24 @@ public AddEmptyLists(Module m, Sort expectedSort) {\n         this.expectedSort = expectedSort;\n     }\n \n+    private Tuple2<Either<Set<KEMException>, Term>, Set<KEMException>> superApply(TermCons tc) {", "originalCommit": "635af3afa527fee289ca302ca9949f880376c288", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "630faffc9731e92f414087fcd7ef935c6f4ed9ba", "chunk": "diff --git a/kernel/src/main/java/org/kframework/parser/concrete2kore/disambiguation/AddEmptyLists.java b/kernel/src/main/java/org/kframework/parser/concrete2kore/disambiguation/AddEmptyLists.java\nindex 6ddc16a9a..adf408654 100644\n--- a/kernel/src/main/java/org/kframework/parser/concrete2kore/disambiguation/AddEmptyLists.java\n+++ b/kernel/src/main/java/org/kframework/parser/concrete2kore/disambiguation/AddEmptyLists.java\n\n@@ -63,6 +63,10 @@ public class AddEmptyLists extends SetsGeneralTransformer<KEMException, KEMExcep\n         this.expectedSort = expectedSort;\n     }\n \n+    // instead of calling super.apply in the apply function below, we should\n+    // call this function, because super.apply does not correctly set the\n+    // expected sort before recursing, which means that we end up with\n+    // the wrong sort computations otherwise\n     private Tuple2<Either<Set<KEMException>, Term>, Set<KEMException>> superApply(TermCons tc) {\n         Set<KEMException> warns = new HashSet<>();\n         TermCons orig = tc;\n"}}, {"oid": "630faffc9731e92f414087fcd7ef935c6f4ed9ba", "url": "https://github.com/kframework/k/commit/630faffc9731e92f414087fcd7ef935c6f4ed9ba", "message": "add comment", "committedDate": "2020-02-26T19:00:44Z", "type": "commit"}, {"oid": "0958160f70164d892df23b16817b0938fa7c1409", "url": "https://github.com/kframework/k/commit/0958160f70164d892df23b16817b0938fa7c1409", "message": "Merge branch 'master' into lub", "committedDate": "2020-02-26T19:55:06Z", "type": "commit"}]}