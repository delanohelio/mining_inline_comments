{"pr_number": 832, "pr_title": "token downscoping for folders endpoints", "pr_createdAt": "2020-07-29T18:14:57Z", "pr_url": "https://github.com/box/box-java-sdk/pull/832", "timeline": [{"oid": "b37dde730029145d34644fe4079ec87466ad089d", "url": "https://github.com/box/box-java-sdk/commit/b37dde730029145d34644fe4079ec87466ad089d", "message": "token downscoping for folders endpoints", "committedDate": "2020-07-29T17:46:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc5MTE5OQ==", "url": "https://github.com/box/box-java-sdk/pull/832#discussion_r464791199", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        final String apiFilesEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";\n          \n          \n            \n                        final String apiFilesEndpointPattern = \".*box.com/2.0/files/\\\\d+\";\n          \n      \n    \n    \n  \n\nI didn't catch this before.  I think we should we allow for more flexibility with the subdomains, right?", "author": "PJSimon", "createdAt": "2020-08-04T04:25:03Z", "path": "src/main/java/com/box/sdk/BoxAPIConnection.java", "diffHunk": "@@ -843,10 +843,11 @@ protected ResourceLinkType determineResourceLinkType(String resourceLink) {\n         try {\n             URL validUrl = new URL(resourceLink);\n             String validURLStr = validUrl.toString();\n-            final String apiEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";\n+            final String apiFilesEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";", "originalCommit": "b37dde730029145d34644fe4079ec87466ad089d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a2528bf41c90a72aef82e9ba9ddf671f807ab6c5", "chunk": "diff --git a/src/main/java/com/box/sdk/BoxAPIConnection.java b/src/main/java/com/box/sdk/BoxAPIConnection.java\nindex ae440ece..d1912e5c 100644\n--- a/src/main/java/com/box/sdk/BoxAPIConnection.java\n+++ b/src/main/java/com/box/sdk/BoxAPIConnection.java\n\n@@ -843,11 +843,12 @@ public class BoxAPIConnection {\n         try {\n             URL validUrl = new URL(resourceLink);\n             String validURLStr = validUrl.toString();\n-            final String apiFilesEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";\n-            final String apiFoldersEndpointPattern = \"https://api.box.com/2.0/folders/\\\\d+\";\n+            final String apiFilesEndpointPattern = \".*box.com/2.0/files/\\\\d+\";\n+            final String apiFoldersEndpointPattern = \".*box.com/2.0/folders/\\\\d+\";\n             final String sharedLinkPattern = \"(.*box.com/s/.*|.*box.com.*s=.*)\";\n \n-            if (Pattern.matches(apiFilesEndpointPattern, validURLStr) || Pattern.matches(apiFoldersEndpointPattern, validURLStr)) {\n+            if (Pattern.matches(apiFilesEndpointPattern, validURLStr)\n+                    || Pattern.matches(apiFoldersEndpointPattern, validURLStr)) {\n                 resourceType = ResourceLinkType.APIEndpoint;\n             } else if (Pattern.matches(sharedLinkPattern, validURLStr)) {\n                 resourceType = ResourceLinkType.SharedLink;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc5MTM5Ng==", "url": "https://github.com/box/box-java-sdk/pull/832#discussion_r464791396", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        final String apiFoldersEndpointPattern = \"https://api.box.com/2.0/folders/\\\\d+\";\n          \n          \n            \n                        final String apiFoldersEndpointPattern = \".*box.com/2.0/folders/\\\\d+\";\n          \n      \n    \n    \n  \n\nI didn't catch this before.  I think we should we allow for more flexibility with the subdomains, right?", "author": "PJSimon", "createdAt": "2020-08-04T04:25:47Z", "path": "src/main/java/com/box/sdk/BoxAPIConnection.java", "diffHunk": "@@ -843,10 +843,11 @@ protected ResourceLinkType determineResourceLinkType(String resourceLink) {\n         try {\n             URL validUrl = new URL(resourceLink);\n             String validURLStr = validUrl.toString();\n-            final String apiEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";\n+            final String apiFilesEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";\n+            final String apiFoldersEndpointPattern = \"https://api.box.com/2.0/folders/\\\\d+\";", "originalCommit": "b37dde730029145d34644fe4079ec87466ad089d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a2528bf41c90a72aef82e9ba9ddf671f807ab6c5", "chunk": "diff --git a/src/main/java/com/box/sdk/BoxAPIConnection.java b/src/main/java/com/box/sdk/BoxAPIConnection.java\nindex ae440ece..d1912e5c 100644\n--- a/src/main/java/com/box/sdk/BoxAPIConnection.java\n+++ b/src/main/java/com/box/sdk/BoxAPIConnection.java\n\n@@ -843,11 +843,12 @@ public class BoxAPIConnection {\n         try {\n             URL validUrl = new URL(resourceLink);\n             String validURLStr = validUrl.toString();\n-            final String apiFilesEndpointPattern = \"https://api.box.com/2.0/files/\\\\d+\";\n-            final String apiFoldersEndpointPattern = \"https://api.box.com/2.0/folders/\\\\d+\";\n+            final String apiFilesEndpointPattern = \".*box.com/2.0/files/\\\\d+\";\n+            final String apiFoldersEndpointPattern = \".*box.com/2.0/folders/\\\\d+\";\n             final String sharedLinkPattern = \"(.*box.com/s/.*|.*box.com.*s=.*)\";\n \n-            if (Pattern.matches(apiFilesEndpointPattern, validURLStr) || Pattern.matches(apiFoldersEndpointPattern, validURLStr)) {\n+            if (Pattern.matches(apiFilesEndpointPattern, validURLStr)\n+                    || Pattern.matches(apiFoldersEndpointPattern, validURLStr)) {\n                 resourceType = ResourceLinkType.APIEndpoint;\n             } else if (Pattern.matches(sharedLinkPattern, validURLStr)) {\n                 resourceType = ResourceLinkType.SharedLink;\n"}}, {"oid": "a2528bf41c90a72aef82e9ba9ddf671f807ab6c5", "url": "https://github.com/box/box-java-sdk/commit/a2528bf41c90a72aef82e9ba9ddf671f807ab6c5", "message": "more general regex URL matching and line break on conditional for linting", "committedDate": "2020-08-12T17:34:34Z", "type": "commit"}, {"oid": "ae34791739a0093a08a301d1b3058336bf358761", "url": "https://github.com/box/box-java-sdk/commit/ae34791739a0093a08a301d1b3058336bf358761", "message": "Merge branch 'master' into bug/folder-token-downscoping", "committedDate": "2020-08-20T21:41:51Z", "type": "commit"}]}