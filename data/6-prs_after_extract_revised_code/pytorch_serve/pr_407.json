{"pr_number": 407, "pr_title": "Error handling - non ssl request", "pr_createdAt": "2020-05-27T19:36:11Z", "pr_url": "https://github.com/pytorch/serve/pull/407", "timeline": [{"oid": "7b8ce94f032864a1957320dbef31b5715614c4d1", "url": "https://github.com/pytorch/serve/commit/7b8ce94f032864a1957320dbef31b5715614c4d1", "message": "Added ExtendedSSLHandler to gracefully handle non ssl request", "committedDate": "2020-05-27T19:33:52Z", "type": "commit"}, {"oid": "636125ebcf0cf44e05200a1583b0dcfbd69fd283", "url": "https://github.com/pytorch/serve/commit/636125ebcf0cf44e05200a1583b0dcfbd69fd283", "message": "Merge branch 'staging_0_1_1' into issue_202", "committedDate": "2020-05-27T19:38:37Z", "type": "commit"}, {"oid": "12ebe494462fdef63cb7a87cd0e4f3efdab2ac8c", "url": "https://github.com/pytorch/serve/commit/12ebe494462fdef63cb7a87cd0e4f3efdab2ac8c", "message": "formatted the java files", "committedDate": "2020-05-27T19:44:25Z", "type": "commit"}, {"oid": "10c0bed07f2840d2c981c690b3d2ef6ecc9e252a", "url": "https://github.com/pytorch/serve/commit/10c0bed07f2840d2c981c690b3d2ef6ecc9e252a", "message": "Merge branch 'issue_202' of https://github.com/pytorch/serve into issue_202", "committedDate": "2020-05-27T19:44:43Z", "type": "commit"}, {"oid": "7d4ad62691783bd646e73ddc398c61cdac2de839", "url": "https://github.com/pytorch/serve/commit/7d4ad62691783bd646e73ddc398c61cdac2de839", "message": "Merge branch 'staging_0_1_1' into issue_202", "committedDate": "2020-05-28T04:13:42Z", "type": "commit"}, {"oid": "4996b906c3d13427bf04576c5099cceafe154169", "url": "https://github.com/pytorch/serve/commit/4996b906c3d13427bf04576c5099cceafe154169", "message": "Fixed pmd error and added mar file cleanup", "committedDate": "2020-05-28T09:24:40Z", "type": "commit"}, {"oid": "018ab48ebbab9612e9e028b0e95a868efa12b374", "url": "https://github.com/pytorch/serve/commit/018ab48ebbab9612e9e028b0e95a868efa12b374", "message": "Merge branch 'staging_0_1_1' into issue_202", "committedDate": "2020-05-30T10:38:00Z", "type": "commit"}, {"oid": "9a1a448d919e3e6610af6a43aa9af5cac8ce991a", "url": "https://github.com/pytorch/serve/commit/9a1a448d919e3e6610af6a43aa9af5cac8ce991a", "message": "Merge branch 'staging_0_1_1' into issue_202", "committedDate": "2020-06-03T04:22:07Z", "type": "commit"}, {"oid": "75c4ad74ffb710db3685d9c48f5d4ec243c6cb71", "url": "https://github.com/pytorch/serve/commit/75c4ad74ffb710db3685d9c48f5d4ec243c6cb71", "message": "reverted to the change which was intended and mar file removal happens during unregister call", "committedDate": "2020-06-04T17:19:20Z", "type": "commit"}, {"oid": "3038a6f102b093d61e9ff6fe0a1256853e1976c6", "url": "https://github.com/pytorch/serve/commit/3038a6f102b093d61e9ff6fe0a1256853e1976c6", "message": "removed blank line", "committedDate": "2020-06-04T17:22:15Z", "type": "commit"}, {"oid": "7d8376996409761b5ec9aca311f7cda17d3bb31e", "url": "https://github.com/pytorch/serve/commit/7d8376996409761b5ec9aca311f7cda17d3bb31e", "message": "Merge branch 'staging_0_1_1' into issue_202", "committedDate": "2020-06-10T03:03:39Z", "type": "commit"}, {"oid": "e4a8ea35d60ab0ce6809183b322806d95a8aafea", "url": "https://github.com/pytorch/serve/commit/e4a8ea35d60ab0ce6809183b322806d95a8aafea", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-06-29T04:48:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwMTA4Nw==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r450401087", "bodyText": "@dhaniram-kshirsagar Why is the url hardcoded here? Can we remove it?", "author": "chauhang", "createdAt": "2020-07-06T18:20:34Z", "path": "frontend/server/src/main/java/org/pytorch/serve/util/ConfigManager.java", "diffHunk": "@@ -655,6 +661,18 @@ public boolean isSnapshotDisabled() {\n         return snapshotDisabled;\n     }\n \n+    public boolean isSSLEnabled() {\n+        String inferenceAddress = prop.getProperty(TS_INFERENCE_ADDRESS, \"http://127.0.0.1:8080\");", "originalCommit": "e4a8ea35d60ab0ce6809183b322806d95a8aafea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAxMzM4Mg==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r451013382", "bodyText": "This is the default value (i.e. http) for the cases when the user has not supplied any address via config or env properties. Here in this function, the address portion is not used however to keep our existing pattern validator happy added the numbers post http.", "author": "dhaniram-kshirsagar", "createdAt": "2020-07-07T17:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwMTA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY4NDAzMg==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r456684032", "bodyText": "Can there be a mix of ssl and non ssl endpoints e.g. http://127.0.0.1:8080 and https://127.0.0.1:8444? Either we should clarify or handle that case", "author": "maaquib", "createdAt": "2020-07-17T21:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwMTA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMyMTE2Mg==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r457321162", "bodyText": "@maaquib can you please elaborate on this.", "author": "dhaniram-kshirsagar", "createdAt": "2020-07-20T12:04:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwMTA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzNzY0Mw==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r458337643", "bodyText": "@dhaniram-kshirsagar We now have 3 endpoints for TS -- Management API, Inference API, Metrics API. If user selects combination of http/https across the three will that be supported? It will be better to have all endpoints of same type", "author": "chauhang", "createdAt": "2020-07-21T19:30:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwMTA4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c652fb421e1405e76c6c22647ca34f1faace7ccb", "chunk": "diff --git a/frontend/server/src/main/java/org/pytorch/serve/util/ConfigManager.java b/frontend/server/src/main/java/org/pytorch/serve/util/ConfigManager.java\nindex f0c6346a..637cb832 100644\n--- a/frontend/server/src/main/java/org/pytorch/serve/util/ConfigManager.java\n+++ b/frontend/server/src/main/java/org/pytorch/serve/util/ConfigManager.java\n\n@@ -657,6 +693,11 @@ public final class ConfigManager {\n         }\n     }\n \n+    public List<String> getAllowedUrls() {\n+        String allowedURL = prop.getProperty(TS_ALLOWED_URLS, \"file://.*|http(s)?://.*\");\n+        return Arrays.asList(allowedURL.split(\",\"));\n+    }\n+\n     public boolean isSnapshotDisabled() {\n         return snapshotDisabled;\n     }\n"}}, {"oid": "d7edbc4eb8defebc1437dc82ff34c62804242d9a", "url": "https://github.com/pytorch/serve/commit/d7edbc4eb8defebc1437dc82ff34c62804242d9a", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-07-07T04:59:28Z", "type": "commit"}, {"oid": "7b79e6b3078dc6f9b27689b8dfad4d8b87a13610", "url": "https://github.com/pytorch/serve/commit/7b79e6b3078dc6f9b27689b8dfad4d8b87a13610", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-07-09T04:07:38Z", "type": "commit"}, {"oid": "bbd8a6608edfe6de9eb993d83b544049bf32e974", "url": "https://github.com/pytorch/serve/commit/bbd8a6608edfe6de9eb993d83b544049bf32e974", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-07-15T17:35:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY4NTg1Ng==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r456685856", "bodyText": "Use io.netty.handler.ssl.SslUtils.SSL_RECORD_HEADER_LENGTH instead", "author": "maaquib", "createdAt": "2020-07-17T21:40:23Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ExtendedSSLHandler.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.pytorch.serve.http;\n+\n+import io.netty.buffer.ByteBuf;\n+import io.netty.channel.ChannelHandlerContext;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.netty.handler.ssl.OptionalSslHandler;\n+import io.netty.handler.ssl.SslContext;\n+import io.netty.handler.ssl.SslHandler;\n+import java.util.List;\n+import org.pytorch.serve.util.ConfigManager;\n+import org.pytorch.serve.util.NettyUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class ExtendedSSLHandler extends OptionalSslHandler {\n+    private static final Logger logger = LoggerFactory.getLogger(ExtendedSSLHandler.class);\n+    /** the length of the ssl record header (in bytes) */\n+    private static final int SSL_RECORD_HEADER_LENGTH = 5;", "originalCommit": "bbd8a6608edfe6de9eb993d83b544049bf32e974", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzI5NjcwOA==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r457296708", "bodyText": "Tried that earlier however it is not visible[protected] netty.", "author": "dhaniram-kshirsagar", "createdAt": "2020-07-20T11:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY4NTg1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ed302953d189222e0520ca0576998a5d125aa74f", "chunk": "diff --git a/frontend/server/src/main/java/org/pytorch/serve/http/ExtendedSSLHandler.java b/frontend/server/src/main/java/org/pytorch/serve/http/ExtendedSSLHandler.java\nindex 53273272..9ed62897 100644\n--- a/frontend/server/src/main/java/org/pytorch/serve/http/ExtendedSSLHandler.java\n+++ b/frontend/server/src/main/java/org/pytorch/serve/http/ExtendedSSLHandler.java\n\n@@ -8,6 +8,7 @@ import io.netty.handler.ssl.SslContext;\n import io.netty.handler.ssl.SslHandler;\n import java.util.List;\n import org.pytorch.serve.util.ConfigManager;\n+import org.pytorch.serve.util.ConnectorType;\n import org.pytorch.serve.util.NettyUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n"}}, {"oid": "c7ea390a8c0c192e77a44a5acb42f5e2ba5e59bc", "url": "https://github.com/pytorch/serve/commit/c7ea390a8c0c192e77a44a5acb42f5e2ba5e59bc", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-07-20T08:09:15Z", "type": "commit"}, {"oid": "bb31db6fa23234c45c6bd1d44535701d4968fc25", "url": "https://github.com/pytorch/serve/commit/bb31db6fa23234c45c6bd1d44535701d4968fc25", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-07-21T16:57:14Z", "type": "commit"}, {"oid": "e1c97db31dad39e542da29e63e1f9ea29dbe7bad", "url": "https://github.com/pytorch/serve/commit/e1c97db31dad39e542da29e63e1f9ea29dbe7bad", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-07-29T11:15:16Z", "type": "commit"}, {"oid": "e006e89aacf45c2b53b0bea4e4b3de8ed772563d", "url": "https://github.com/pytorch/serve/commit/e006e89aacf45c2b53b0bea4e4b3de8ed772563d", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-08-08T04:23:28Z", "type": "commit"}, {"oid": "c652fb421e1405e76c6c22647ca34f1faace7ccb", "url": "https://github.com/pytorch/serve/commit/c652fb421e1405e76c6c22647ca34f1faace7ccb", "message": "Merge branch 'master' into issue_202", "committedDate": "2020-12-09T10:03:48Z", "type": "commit"}, {"oid": "4ab1d77eb4de423136b0bdf8e2c1583eed6b13c3", "url": "https://github.com/pytorch/serve/commit/4ab1d77eb4de423136b0bdf8e2c1583eed6b13c3", "message": "fixed compilation issue", "committedDate": "2020-12-09T10:13:34Z", "type": "commit"}, {"oid": "ed302953d189222e0520ca0576998a5d125aa74f", "url": "https://github.com/pytorch/serve/commit/ed302953d189222e0520ca0576998a5d125aa74f", "message": "check if ssl enabled based on connector type", "committedDate": "2021-03-12T01:37:46Z", "type": "commit"}, {"oid": "76467898b04f6f3f919613a4b06e8e454d52366e", "url": "https://github.com/pytorch/serve/commit/76467898b04f6f3f919613a4b06e8e454d52366e", "message": "check if ssl enabled based on connector type", "committedDate": "2021-03-12T01:44:32Z", "type": "commit"}, {"oid": "2d015d663f2bfd86c5698622e19afddb1bc8433f", "url": "https://github.com/pytorch/serve/commit/2d015d663f2bfd86c5698622e19afddb1bc8433f", "message": "Merge branch 'master' into issue_202", "committedDate": "2021-03-12T02:00:54Z", "type": "commit"}, {"oid": "f0256a41f3f89a0fc232a4b7c1b02111687a28e6", "url": "https://github.com/pytorch/serve/commit/f0256a41f3f89a0fc232a4b7c1b02111687a28e6", "message": "fmt", "committedDate": "2021-03-12T02:39:37Z", "type": "commit"}, {"oid": "c42586b1633df1c903602b8aca66bfab0fb3124c", "url": "https://github.com/pytorch/serve/commit/c42586b1633df1c903602b8aca66bfab0fb3124c", "message": "fix conflict", "committedDate": "2021-03-12T03:02:13Z", "type": "commit"}, {"oid": "1898fd43e882f836dd84c09ef52ce64b3026f479", "url": "https://github.com/pytorch/serve/commit/1898fd43e882f836dd84c09ef52ce64b3026f479", "message": "fix import order", "committedDate": "2021-03-12T03:15:28Z", "type": "commit"}, {"oid": "b4be92d62be5811d18a059032a202f4605d603a6", "url": "https://github.com/pytorch/serve/commit/b4be92d62be5811d18a059032a202f4605d603a6", "message": "fmt", "committedDate": "2021-03-12T03:33:17Z", "type": "commit"}, {"oid": "419d1372d77da8be41fedee692050653c468722e", "url": "https://github.com/pytorch/serve/commit/419d1372d77da8be41fedee692050653c468722e", "message": "fmt ConfigManager.java", "committedDate": "2021-03-12T03:50:26Z", "type": "commit"}, {"oid": "d1dc90f344ddccadb3b47111056c47d851bffe16", "url": "https://github.com/pytorch/serve/commit/d1dc90f344ddccadb3b47111056c47d851bffe16", "message": "Merge branch 'master' into issue_202", "committedDate": "2021-03-18T04:27:14Z", "type": "commit"}, {"oid": "4917b8003f99b957443b1080371a01038984835e", "url": "https://github.com/pytorch/serve/commit/4917b8003f99b957443b1080371a01038984835e", "message": "Merge branch 'master' into issue_202", "committedDate": "2021-03-19T23:22:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODQ1MDE3OQ==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r598450179", "bodyText": "@dhaniram-kshirsagar  Why are the port numbers hard coded here? As these are configurable, how are things expected to work if the user picked other port numbers? Same comment for the other port numbers", "author": "chauhang", "createdAt": "2021-03-22T06:22:14Z", "path": "frontend/server/src/main/java/org/pytorch/serve/util/ConfigManager.java", "diffHunk": "@@ -718,6 +724,30 @@ public boolean isSnapshotDisabled() {\n         return snapshotDisabled;\n     }\n \n+    public boolean isSSLEnabled(ConnectorType connectorType) {\n+        String address = prop.getProperty(TS_INFERENCE_ADDRESS, \"http://127.0.0.1:8080\");", "originalCommit": "4917b8003f99b957443b1080371a01038984835e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODg4ODgxNg==", "url": "https://github.com/pytorch/serve/pull/407#discussion_r598888816", "bodyText": "the hard coded port is default port. It is used only if user doesn't customize the ports.", "author": "lxning", "createdAt": "2021-03-22T16:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODQ1MDE3OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5efea7fa9e38b8c6c057d78f03caf041b77a87f5", "url": "https://github.com/pytorch/serve/commit/5efea7fa9e38b8c6c057d78f03caf041b77a87f5", "message": "Merge branch 'master' into issue_202", "committedDate": "2021-04-15T21:53:38Z", "type": "commit"}]}