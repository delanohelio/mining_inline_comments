{"pr_number": 1804, "pr_title": "Task/dynamic metadata persistence", "pr_createdAt": "2020-01-27T12:53:21Z", "pr_url": "https://github.com/telefonicaid/fiware-cygnus/pull/1804", "timeline": [{"oid": "d01a8b12283c364b01cd4e4048c6b91caf39809f", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/d01a8b12283c364b01cd4e4048c6b91caf39809f", "message": "add column csv batch test", "committedDate": "2020-01-27T11:48:09Z", "type": "commit"}, {"oid": "ed9f0435b78de71e5d4490c71767552edae97168", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/ed9f0435b78de71e5d4490c71767552edae97168", "message": "validate content of metadata to create objects", "committedDate": "2020-01-27T11:49:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyNzA2Mw==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1804#discussion_r371227063", "bodyText": "CNR entry is missing.\nIn addition, should be some modification piece to be modified due to the new functionality? Maybe not... just checking", "author": "fgalan", "createdAt": "2020-01-27T13:02:38Z", "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSIHDFSSink.java", "diffHunk": "@@ -68,7 +68,7 @@\n     /**", "originalCommit": "ed9f0435b78de71e5d4490c71767552edae97168", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NDY5MQ==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1804#discussion_r371264691", "bodyText": "Fixed in d116da2", "author": "IvanHdzC", "createdAt": "2020-01-27T14:19:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyNzA2Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8a7f408689c74e0eee1cea53dcbf4cc73605f77f", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/8a7f408689c74e0eee1cea53dcbf4cc73605f77f", "message": "add CNR entry", "committedDate": "2020-01-27T13:06:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1MzkxOQ==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1804#discussion_r371253919", "bodyText": "could mdAggregation var be inside the if? It seems that it's not used in other scope.", "author": "manucarrace", "createdAt": "2020-01-27T13:59:26Z", "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSIHDFSSink.java", "diffHunk": "@@ -940,28 +943,37 @@ public void aggregate(NGSIEvent event) throws CygnusBadContextData {\n                         attrType);\n                 String printableAttrMdFileName = \"hdfs:///user/\" + username + \"/\" + attrMdFileName;", "originalCommit": "8a7f408689c74e0eee1cea53dcbf4cc73605f77f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1NDM4Mg==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1804#discussion_r371254382", "bodyText": "The same with printableAttrMdFileName var", "author": "manucarrace", "createdAt": "2020-01-27T14:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1MzkxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2MTM1MA==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1804#discussion_r371261350", "bodyText": "Fixed in 1b941e4", "author": "IvanHdzC", "createdAt": "2020-01-27T14:13:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1MzkxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "1b941e49c4152bdb3c728b1b1ba1bcb836ae98ad", "chunk": "diff --git a/cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSIHDFSSink.java b/cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSIHDFSSink.java\nindex a1be2cd6..5de9dbaf 100644\n--- a/cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSIHDFSSink.java\n+++ b/cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSIHDFSSink.java\n\n@@ -937,13 +937,13 @@ public class NGSIHDFSSink extends NGSISink {\n                 LOGGER.debug(\"[\" + getName() + \"] Processing context attribute (name=\" + attrName + \", type=\"\n                         + attrType + \")\");\n \n-                // this has to be done notification by notification and not at initialization since in row mode not all\n-                // the notifications contain all the attributes\n-                String attrMdFileName = buildAttrMdFilePath(service, servicePathForNaming, entityForNaming, attrName,\n-                        attrType);\n-                String printableAttrMdFileName = \"hdfs:///user/\" + username + \"/\" + attrMdFileName;\n-                String mdAggregation = mdAggregations.get(attrMdFileName);\n                 if (attrMetadata!= null && !attrMetadata.isEmpty() && !attrMetadata.equals(\"[]\")) {\n+                    // this has to be done notification by notification and not at initialization since in row mode not all\n+                    // the notifications contain all the attributes\n+                    String attrMdFileName = buildAttrMdFilePath(service, servicePathForNaming, entityForNaming, attrName,\n+                            attrType);\n+                    String printableAttrMdFileName = \"hdfs:///user/\" + username + \"/\" + attrMdFileName;\n+                    String mdAggregation = mdAggregations.get(attrMdFileName);\n                     if (mdAggregation == null) {\n                         mdAggregation = new String();\n                     } // if\n"}}, {"oid": "1b941e49c4152bdb3c728b1b1ba1bcb836ae98ad", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/1b941e49c4152bdb3c728b1b1ba1bcb836ae98ad", "message": "optimization", "committedDate": "2020-01-27T14:10:01Z", "type": "commit"}, {"oid": "d702b25e60983f85c720be11ff2fb1a969f23a5c", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/d702b25e60983f85c720be11ff2fb1a969f23a5c", "message": "update CNR and updated docs", "committedDate": "2020-01-27T14:33:44Z", "type": "commit"}, {"oid": "d702b25e60983f85c720be11ff2fb1a969f23a5c", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/d702b25e60983f85c720be11ff2fb1a969f23a5c", "message": "update CNR and updated docs", "committedDate": "2020-01-27T14:33:44Z", "type": "forcePushed"}]}