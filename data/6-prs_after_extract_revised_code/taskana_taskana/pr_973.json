{"pr_number": 973, "pr_title": "Tsk 442", "pr_createdAt": "2020-03-12T14:58:27Z", "pr_url": "https://github.com/Taskana/taskana/pull/973", "timeline": [{"oid": "2b4e905546746681ddfdd177332fd74ffaac7d3b", "url": "https://github.com/Taskana/taskana/commit/2b4e905546746681ddfdd177332fd74ffaac7d3b", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-18T17:02:51Z", "type": "forcePushed"}, {"oid": "ac865d0101ffea28934507b83ab07c065a85be94", "url": "https://github.com/Taskana/taskana/commit/ac865d0101ffea28934507b83ab07c065a85be94", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-19T07:04:04Z", "type": "forcePushed"}, {"oid": "f7903bb2c876d902f12f394310a40efb683d8244", "url": "https://github.com/Taskana/taskana/commit/f7903bb2c876d902f12f394310a40efb683d8244", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-19T08:57:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA2NjE5NQ==", "url": "https://github.com/Taskana/taskana/pull/973#discussion_r395066195", "bodyText": "This should obviously be configurable, shouldn't it? Otherwise the switch does not make sense.", "author": "holgerhagen", "createdAt": "2020-03-19T14:27:02Z", "path": "lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java", "diffHunk": "@@ -135,6 +135,8 @@ public TaskanaEngineConfiguration(\n       this.rolesSeparator = rolesSeparator;\n     }\n \n+    setGermanPublicHolidaysEnabled(true);", "originalCommit": "f7903bb2c876d902f12f394310a40efb683d8244", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEwMTEwMQ==", "url": "https://github.com/Taskana/taskana/pull/973#discussion_r395101101", "bodyText": "The setGermanPublicHolidaysEnabled() method is public.It is the interface, the customer can use to configure the TaskanaEngineConfiguration with respect to german holidays.\nThe referenced call simply sets the default to true. Without this call, the default is false.\nSince the product is developed and mostly used in Germany, I think that true is the correct default...", "author": "BerndBreier", "createdAt": "2020-03-19T15:11:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA2NjE5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "3cc0b046b4cfb4009e72332f152611930034d872", "chunk": "diff --git a/lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java b/lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java\nindex ef37b9297..62d50c20b 100644\n--- a/lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java\n+++ b/lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java\n\n@@ -135,8 +135,6 @@ public class TaskanaEngineConfiguration {\n       this.rolesSeparator = rolesSeparator;\n     }\n \n-    setGermanPublicHolidaysEnabled(true);\n-\n     if (dataSource != null) {\n       this.dataSource = dataSource;\n     } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA2OTU4MQ==", "url": "https://github.com/Taskana/taskana/pull/973#discussion_r395069581", "bodyText": "We do have TaskanaEngineImpl.runAsAdmin(). Do you think we could reuse this here instead of creating a separate method?", "author": "holgerhagen", "createdAt": "2020-03-19T14:31:08Z", "path": "lib/taskana-core/src/main/java/pro/taskana/common/internal/jobs/JobRunner.java", "diffHunk": "@@ -114,6 +149,24 @@ private void runScheduledJob(ScheduledJob scheduledJob) {\n               + e.getMessage(),\n           e);\n     }\n-    LOGGER.debug(\"exit from runScheduledJob\");\n+  }\n+\n+  private Subject getAdminSubject() {", "originalCommit": "f7903bb2c876d902f12f394310a40efb683d8244", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEwODgxMw==", "url": "https://github.com/Taskana/taskana/pull/973#discussion_r395108813", "bodyText": "This was my first idea: use InternalTaskanaEngineImpl.runAsAdmin. However, that method is a method on InternalTaskanaEngineImpl and JobRunner  has no access to InternalTaskanaEngineImpl, only to TaskanaEngineImpl.", "author": "BerndBreier", "createdAt": "2020-03-19T15:21:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA2OTU4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "3cc0b046b4cfb4009e72332f152611930034d872", "chunk": "diff --git a/lib/taskana-core/src/main/java/pro/taskana/common/internal/jobs/JobRunner.java b/lib/taskana-core/src/main/java/pro/taskana/common/internal/jobs/JobRunner.java\nindex ae75abf73..2309da7cc 100644\n--- a/lib/taskana-core/src/main/java/pro/taskana/common/internal/jobs/JobRunner.java\n+++ b/lib/taskana-core/src/main/java/pro/taskana/common/internal/jobs/JobRunner.java\n\n@@ -149,24 +114,6 @@ public class JobRunner {\n               + e.getMessage(),\n           e);\n     }\n-  }\n-\n-  private Subject getAdminSubject() {\n-    Subject subject = new Subject();\n-    List<Principal> principalList = new ArrayList<>();\n-    try {\n-      principalList.add(\n-          new UserPrincipal(\n-              taskanaEngine\n-                  .getConfiguration()\n-                  .getRoleMap()\n-                  .get(TaskanaRole.ADMIN)\n-                  .iterator()\n-                  .next()));\n-    } catch (Exception t) {\n-      LOGGER.warn(\"Could not determine a configured admin user.\", t);\n-    }\n-    subject.getPrincipals().addAll(principalList);\n-    return subject;\n+    LOGGER.debug(\"exit from runScheduledJob\");\n   }\n }\n"}}, {"oid": "326ddd38778a0658d4ca0cb3e63336bfa34ea26d", "url": "https://github.com/Taskana/taskana/commit/326ddd38778a0658d4ca0cb3e63336bfa34ea26d", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-19T14:51:10Z", "type": "forcePushed"}, {"oid": "813c9643e021cde3bb70eca7e78bf0bccafab822", "url": "https://github.com/Taskana/taskana/commit/813c9643e021cde3bb70eca7e78bf0bccafab822", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-23T17:37:37Z", "type": "forcePushed"}, {"oid": "95e1cd920b0d74b73c683eca9dad0b008f900db6", "url": "https://github.com/Taskana/taskana/commit/95e1cd920b0d74b73c683eca9dad0b008f900db6", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-24T06:46:21Z", "type": "forcePushed"}, {"oid": "3cc0b046b4cfb4009e72332f152611930034d872", "url": "https://github.com/Taskana/taskana/commit/3cc0b046b4cfb4009e72332f152611930034d872", "message": "TSK-1143C mismatch between forward and backward calculation between planned and due", "committedDate": "2020-03-25T11:46:07Z", "type": "commit"}, {"oid": "dcc01dd50abd851854c598974665ff76dea5cd77", "url": "https://github.com/Taskana/taskana/commit/dcc01dd50abd851854c598974665ff76dea5cd77", "message": "TSK-1143 UpdateTask with Planned sometimes fails", "committedDate": "2020-03-25T11:46:08Z", "type": "commit"}, {"oid": "1448200ad0f2dd6a377911c22f0e72efc36b5422", "url": "https://github.com/Taskana/taskana/commit/1448200ad0f2dd6a377911c22f0e72efc36b5422", "message": "TSK-1143 UpdateTask planned - comments from Holger", "committedDate": "2020-03-25T11:46:08Z", "type": "commit"}, {"oid": "119ba53e1939615f5f01cdcd9990d312ac5d18ec", "url": "https://github.com/Taskana/taskana/commit/119ba53e1939615f5f01cdcd9990d312ac5d18ec", "message": "TSK-1143 UpdateTask planned - comments from Holger", "committedDate": "2020-03-25T11:46:08Z", "type": "commit"}, {"oid": "04f8463421ba1d9fdf68a918222ecfd4a6f95bf6", "url": "https://github.com/Taskana/taskana/commit/04f8463421ba1d9fdf68a918222ecfd4a6f95bf6", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-25T11:46:08Z", "type": "commit"}, {"oid": "04f8463421ba1d9fdf68a918222ecfd4a6f95bf6", "url": "https://github.com/Taskana/taskana/commit/04f8463421ba1d9fdf68a918222ecfd4a6f95bf6", "message": "TSK-442 improve task refresh on classification update", "committedDate": "2020-03-25T11:46:08Z", "type": "forcePushed"}]}