{"pr_number": 3162, "pr_title": "Fixed Cruise Control metrics reporter bootstrap server", "pr_createdAt": "2020-06-05T17:41:02Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162", "timeline": [{"oid": "c02fa554114698655f09e78fa7eb6d38b626f6ba", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c02fa554114698655f09e78fa7eb6d38b626f6ba", "message": "Fixed tests\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-05T18:42:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNDQ4OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#discussion_r436104489", "bodyText": "Could you add a comment similar to what you wrote in the commit/PR to make clear why we are using the service with unready endpoint resolvability?\nCan imagine someone coming back to this later may be confused why the boostrap config property is not set to the bootstrap ;)", "author": "samuel-hawker", "createdAt": "2020-06-05T18:49:47Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java", "diffHunk": "@@ -78,7 +78,7 @@ public KafkaBrokerConfigurationBuilder withCruiseControl(String clusterName, Cru\n             printSectionHeader(\"Cruise Control configuration\");\n             writer.println(\"cruise.control.metrics.topic=strimzi.cruisecontrol.metrics\");\n             writer.println(\"cruise.control.metrics.reporter.ssl.endpoint.identification.algorithm=HTTPS\");\n-            writer.println(\"cruise.control.metrics.reporter.bootstrap.servers=\" + KafkaResources.bootstrapServiceName(clusterName) + \":9091\");\n+            writer.println(\"cruise.control.metrics.reporter.bootstrap.servers=\" + KafkaResources.brokersServiceName(clusterName) + \":9091\");", "originalCommit": "c02fa554114698655f09e78fa7eb6d38b626f6ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNzEyMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#discussion_r436107122", "bodyText": "good idea.", "author": "ppatierno", "createdAt": "2020-06-05T18:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNDQ4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "chunk": "diff --git a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java\nindex c9cb87ab76..566b319880 100644\n--- a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java\n+++ b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java\n\n@@ -78,6 +78,8 @@ public class KafkaBrokerConfigurationBuilder {\n             printSectionHeader(\"Cruise Control configuration\");\n             writer.println(\"cruise.control.metrics.topic=strimzi.cruisecontrol.metrics\");\n             writer.println(\"cruise.control.metrics.reporter.ssl.endpoint.identification.algorithm=HTTPS\");\n+            // using the brokers service because the Admin client, in the Cruise Control metrics reporter, is not able to connect\n+            // to the pods behind the bootstrap one when they are not ready during startup.\n             writer.println(\"cruise.control.metrics.reporter.bootstrap.servers=\" + KafkaResources.brokersServiceName(clusterName) + \":9091\");\n             writer.println(\"cruise.control.metrics.reporter.security.protocol=SSL\");\n             writer.println(\"cruise.control.metrics.reporter.ssl.keystore.type=PKCS12\");\n"}}, {"oid": "7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-09T06:45:06Z", "type": "forcePushed"}, {"oid": "b37766de8eeff16f5ed904af02d63d573bacfa95", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b37766de8eeff16f5ed904af02d63d573bacfa95", "message": "Fixed Cruise Control metrics reporter bootstrap server\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-09T08:25:25Z", "type": "commit"}, {"oid": "12b6a70fb6e3ce71071478ffa068115566a6804a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/12b6a70fb6e3ce71071478ffa068115566a6804a", "message": "Fixed tests\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-09T08:25:25Z", "type": "commit"}, {"oid": "21a723fe7ee259a1b8e8d60ca4167d4b38abb816", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/21a723fe7ee259a1b8e8d60ca4167d4b38abb816", "message": "Fixed comment\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-09T08:25:25Z", "type": "commit"}, {"oid": "929060d05dee722a6636febcd8a8d2ccce5ab5c5", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/929060d05dee722a6636febcd8a8d2ccce5ab5c5", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-09T08:25:25Z", "type": "commit"}, {"oid": "929060d05dee722a6636febcd8a8d2ccce5ab5c5", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/929060d05dee722a6636febcd8a8d2ccce5ab5c5", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-06-09T08:25:25Z", "type": "forcePushed"}]}