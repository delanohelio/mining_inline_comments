{"pr_number": 3334, "pr_title": "Single node kafka with CC fix", "pr_createdAt": "2020-07-17T07:36:12Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334", "timeline": [{"oid": "079a98c29e7314ad2454fae90f344414bbf087f4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/079a98c29e7314ad2454fae90f344414bbf087f4", "message": "Single node kafka with CC fix\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-07-17T07:31:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3ODk1Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#discussion_r456278952", "bodyText": "Not sure the the should be there. Maybe some native speaker can comment.", "author": "scholzj", "createdAt": "2020-07-17T07:51:43Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java", "diffHunk": "@@ -479,6 +479,11 @@ public static KafkaCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup vers\n             addAll(metricReporterList, configuration.getConfigOption(KAFKA_METRIC_REPORTERS_CONFIG_FIELD).split(\",\"));\n         }\n \n+        if (kafkaClusterSpec.getReplicas() < 2 && kafkaSpec.getCruiseControl() != null) {\n+            throw new InvalidResourceException(\"Kafka \" +\n+                    kafkaAssembly.getMetadata().getNamespace() + \"/\" + kafkaAssembly.getMetadata().getName() +\n+                    \" has invalid configuration. Cruise Control cannot be deployed with the single node Kafka cluster.\");", "originalCommit": "079a98c29e7314ad2454fae90f344414bbf087f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI4NTIzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#discussion_r456285233", "bodyText": "You need an a, as the issue is you're using a single-node cluster.\nMaybe this is clearer: Cruise Control cannot be deployed with a single-node Kafka cluster. It requires at least two Kafka nodes.", "author": "PaulRMellor", "createdAt": "2020-07-17T08:04:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3ODk1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "be23214b761e63a389af2555c68a73ef275b6b27", "chunk": "diff --git a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java\nindex 9e3cdf5377..84a053ed61 100644\n--- a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java\n+++ b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java\n\n@@ -482,7 +482,7 @@ public class KafkaCluster extends AbstractModel {\n         if (kafkaClusterSpec.getReplicas() < 2 && kafkaSpec.getCruiseControl() != null) {\n             throw new InvalidResourceException(\"Kafka \" +\n                     kafkaAssembly.getMetadata().getNamespace() + \"/\" + kafkaAssembly.getMetadata().getName() +\n-                    \" has invalid configuration. Cruise Control cannot be deployed with the single node Kafka cluster.\");\n+                    \" has invalid configuration. Cruise Control cannot be deployed with a single-node Kafka cluster. It requires at least two Kafka nodes.\");\n         }\n         result.cruiseControlSpec  = kafkaSpec.getCruiseControl();\n         if (result.cruiseControlSpec != null) {\n"}}, {"oid": "be23214b761e63a389af2555c68a73ef275b6b27", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/be23214b761e63a389af2555c68a73ef275b6b27", "message": "English\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-07-17T08:13:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMzNTU0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#discussion_r456335549", "bodyText": "sorry to be picky, I would invert the conditions in the if. Logically you should check the number of replicas only if CC is deployed otherwise it's useless :-)", "author": "ppatierno", "createdAt": "2020-07-17T09:40:13Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java", "diffHunk": "@@ -479,6 +479,11 @@ public static KafkaCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup vers\n             addAll(metricReporterList, configuration.getConfigOption(KAFKA_METRIC_REPORTERS_CONFIG_FIELD).split(\",\"));\n         }\n \n+        if (kafkaClusterSpec.getReplicas() < 2 && kafkaSpec.getCruiseControl() != null) {", "originalCommit": "be23214b761e63a389af2555c68a73ef275b6b27", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2f8c03759e4b486020bb92e327b382448bef75e8", "chunk": "diff --git a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java\nindex 84a053ed61..005d334f00 100644\n--- a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java\n+++ b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java\n\n@@ -479,7 +479,7 @@ public class KafkaCluster extends AbstractModel {\n             addAll(metricReporterList, configuration.getConfigOption(KAFKA_METRIC_REPORTERS_CONFIG_FIELD).split(\",\"));\n         }\n \n-        if (kafkaClusterSpec.getReplicas() < 2 && kafkaSpec.getCruiseControl() != null) {\n+        if (kafkaSpec.getCruiseControl() != null && kafkaClusterSpec.getReplicas() < 2) {\n             throw new InvalidResourceException(\"Kafka \" +\n                     kafkaAssembly.getMetadata().getNamespace() + \"/\" + kafkaAssembly.getMetadata().getName() +\n                     \" has invalid configuration. Cruise Control cannot be deployed with a single-node Kafka cluster. It requires at least two Kafka nodes.\");\n"}}, {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2f8c03759e4b486020bb92e327b382448bef75e8", "message": "Paolo's comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-07-17T09:42:14Z", "type": "commit"}, {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2f8c03759e4b486020bb92e327b382448bef75e8", "message": "Paolo's comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-07-17T09:42:14Z", "type": "forcePushed"}]}