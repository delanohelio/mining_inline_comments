{"pr_number": 3276, "pr_title": "Refactor systemtest package structure", "pr_createdAt": "2020-07-02T13:59:32Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExNTU3Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449115576", "bodyText": "I wonder if this should actually be called AbstractST\nTo match with the naming conventions we've gone elsewhere in Strimzi, i.e. AbstractModel", "author": "samuel-hawker", "createdAt": "2020-07-02T15:56:24Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -510,7 +510,7 @@ protected void checkReadinessLivenessProbe(String podNamePrefix, String containe\n         }", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/BaseST.java b/systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\nsimilarity index 92%\nrename from systemtest/src/test/java/io/strimzi/systemtest/BaseST.java\nrename to systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\nindex bbcfc9e9f7..0ad59101fd 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/BaseST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\n\n@@ -511,10 +479,10 @@ public abstract class BaseST implements TestSeparator {\n     }\n \n     protected void verifyLabelsForKafkaCluster(String clusterName, String appName) {\n-        verifyLabelsForKafkaOrZkPods(clusterName, \"zookeeper\", appName);\n-        verifyLabelsForKafkaOrZkPods(clusterName, \"kafka\", appName);\n+        verifyLabelsOnPods(clusterName, \"zookeeper\", appName, Kafka.RESOURCE_KIND);\n+        verifyLabelsOnPods(clusterName, \"kafka\", appName, Kafka.RESOURCE_KIND);\n         verifyLabelsOnCOPod();\n-        verifyLabelsOnPods(clusterName, \"entity-operator\", appName, \"Kafka\");\n+        verifyLabelsOnPods(clusterName, \"entity-operator\", appName, Kafka.RESOURCE_KIND);\n         verifyLabelsForCRDs();\n         verifyLabelsForKafkaAndZKServices(clusterName, appName);\n         verifyLabelsForSecrets(clusterName, appName);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExNjQyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449116426", "bodyText": "Probably best to split this function into two different ones, i.e.\nverifyLabelsForKafkaPods(clusterName, appName);\nverifyLabelsForZookeeperPods(clusterName, appName);", "author": "samuel-hawker", "createdAt": "2020-07-02T15:57:39Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -510,7 +510,7 @@ protected void checkReadinessLivenessProbe(String podNamePrefix, String containe\n         }\n     }\n \n-    void verifyLabelsForKafkaCluster(String clusterName, String appName) {\n+    protected void verifyLabelsForKafkaCluster(String clusterName, String appName) {\n         verifyLabelsForKafkaOrZkPods(clusterName, \"zookeeper\", appName);", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwNDQ4Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449304482", "bodyText": "Maybe we could use verifyLabelsOnPods and remove verifyLabelsForKafkaOrZkPodscompletely, because its do bsically the same thing", "author": "Frawless", "createdAt": "2020-07-02T23:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExNjQyNg=="}], "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/BaseST.java b/systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\nsimilarity index 92%\nrename from systemtest/src/test/java/io/strimzi/systemtest/BaseST.java\nrename to systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\nindex bbcfc9e9f7..0ad59101fd 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/BaseST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\n\n@@ -511,10 +479,10 @@ public abstract class BaseST implements TestSeparator {\n     }\n \n     protected void verifyLabelsForKafkaCluster(String clusterName, String appName) {\n-        verifyLabelsForKafkaOrZkPods(clusterName, \"zookeeper\", appName);\n-        verifyLabelsForKafkaOrZkPods(clusterName, \"kafka\", appName);\n+        verifyLabelsOnPods(clusterName, \"zookeeper\", appName, Kafka.RESOURCE_KIND);\n+        verifyLabelsOnPods(clusterName, \"kafka\", appName, Kafka.RESOURCE_KIND);\n         verifyLabelsOnCOPod();\n-        verifyLabelsOnPods(clusterName, \"entity-operator\", appName, \"Kafka\");\n+        verifyLabelsOnPods(clusterName, \"entity-operator\", appName, Kafka.RESOURCE_KIND);\n         verifyLabelsForCRDs();\n         verifyLabelsForKafkaAndZKServices(clusterName, appName);\n         verifyLabelsForSecrets(clusterName, appName);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExODgwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449118800", "bodyText": "Not sure about the package components , I'm not sure that the previous structure wasn't right (for atleast this set of tests) - what is the components package doing here?\nAren't all the STs basically testing components?", "author": "samuel-hawker", "createdAt": "2020-07-02T16:01:08Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/components/bridge/HttpBridgeCors.java", "diffHunk": "@@ -2,7 +2,7 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest.bridge;\n+package io.strimzi.systemtest.components.bridge;", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMjM5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449302390", "bodyText": "Yes that's true. I was just thinking to separate it somehow from other because tests in bridge focus mostly on the functionality of Bridge for example", "author": "Frawless", "createdAt": "2020-07-02T23:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExODgwMA=="}], "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/components/bridge/HttpBridgeCors.java b/systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeCors.java\nsimilarity index 98%\nrename from systemtest/src/test/java/io/strimzi/systemtest/components/bridge/HttpBridgeCors.java\nrename to systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeCors.java\nindex fe3d8dff29..24f8312a41 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/components/bridge/HttpBridgeCors.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeCors.java\n\n@@ -2,7 +2,7 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest.components.bridge;\n+package io.strimzi.systemtest.bridge;\n \n import io.fabric8.kubernetes.api.model.Service;\n import io.strimzi.api.kafka.model.KafkaBridgeHttpCors;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExOTE5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449119198", "bodyText": "I do like that you've put this in the kafka package, but I think that components here is just redundant...", "author": "samuel-hawker", "createdAt": "2020-07-02T16:01:47Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/components/kafka/KafkaST.java", "diffHunk": "@@ -2,7 +2,7 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest;\n+package io.strimzi.systemtest.components.kafka;", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMjY5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449302698", "bodyText": "Ye, that sounds reasonable to me", "author": "Frawless", "createdAt": "2020-07-02T23:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExOTE5OA=="}], "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/components/kafka/KafkaST.java b/systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java\nsimilarity index 99%\nrename from systemtest/src/test/java/io/strimzi/systemtest/components/kafka/KafkaST.java\nrename to systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java\nindex 5a19f96755..31e7299456 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/components/kafka/KafkaST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java\n\n@@ -2,7 +2,7 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest.components.kafka;\n+package io.strimzi.systemtest.kafka;\n \n import io.fabric8.kubernetes.api.model.ConfigMap;\n import io.fabric8.kubernetes.api.model.HasMetadata;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMDM3Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449120373", "bodyText": "I wonder if all the namespace tests should go in a package like watcher\ni.e. io.strimzi.systemtest.watcher.AllNamespaceST\nio.strimzi.systemtest.watcher.MultipleNamespaceST\nThe package being the intent/theme of all the tests and then the class being more specific", "author": "samuel-hawker", "createdAt": "2020-07-02T16:03:43Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/multiplenamespace/AllNamespaceST.java", "diffHunk": "@@ -2,14 +2,15 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest;\n+package io.strimzi.systemtest.multiplenamespace;", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/multiplenamespace/AllNamespaceST.java b/systemtest/src/test/java/io/strimzi/systemtest/watcher/AllNamespaceST.java\nsimilarity index 99%\nrename from systemtest/src/test/java/io/strimzi/systemtest/multiplenamespace/AllNamespaceST.java\nrename to systemtest/src/test/java/io/strimzi/systemtest/watcher/AllNamespaceST.java\nindex 99c07f3e25..ddcb32f1c9 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/multiplenamespace/AllNamespaceST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/watcher/AllNamespaceST.java\n\n@@ -2,7 +2,7 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest.multiplenamespace;\n+package io.strimzi.systemtest.watcher;\n \n import io.fabric8.kubernetes.api.model.Secret;\n import io.fabric8.kubernetes.api.model.SecretBuilder;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMDk1MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449120951", "bodyText": "Surely this is part of the operators package", "author": "samuel-hawker", "createdAt": "2020-07-02T16:04:36Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/recovery/RecoveryST.java", "diffHunk": "@@ -2,10 +2,11 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest;\n+package io.strimzi.systemtest.recovery;", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwNjcyNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449306724", "bodyText": "So maybe both classes from recovery put into operators.cluster ?", "author": "Frawless", "createdAt": "2020-07-02T23:21:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMDk1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/recovery/RecoveryST.java b/systemtest/src/test/java/io/strimzi/systemtest/operators/RecoveryST.java\nsimilarity index 99%\nrename from systemtest/src/test/java/io/strimzi/systemtest/recovery/RecoveryST.java\nrename to systemtest/src/test/java/io/strimzi/systemtest/operators/RecoveryST.java\nindex 08abcd9445..83f4b5a4ae 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/recovery/RecoveryST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/operators/RecoveryST.java\n\n@@ -2,11 +2,11 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest.recovery;\n+package io.strimzi.systemtest.operators;\n \n import io.strimzi.api.kafka.model.KafkaBridgeResources;\n import io.strimzi.api.kafka.model.KafkaResources;\n-import io.strimzi.systemtest.BaseST;\n+import io.strimzi.systemtest.AbstractST;\n import io.strimzi.systemtest.utils.kubeUtils.controllers.ConfigMapUtils;\n import io.strimzi.systemtest.utils.kubeUtils.controllers.DeploymentUtils;\n import io.strimzi.systemtest.utils.kubeUtils.controllers.StatefulSetUtils;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMTQyMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449121422", "bodyText": "Security seems fine here, as a package name, as security is a pretty big topic and is mostly about ensuring you have no gaps and everything is correctly configured/encrypted etc", "author": "samuel-hawker", "createdAt": "2020-07-02T16:05:17Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/security/oauth/OauthAuthorizationST.java", "diffHunk": "@@ -2,7 +2,7 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest.oauth;\n+package io.strimzi.systemtest.security.oauth;", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMTcyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449121726", "bodyText": "Perhaps this should be infrastructure or deployment or install", "author": "samuel-hawker", "createdAt": "2020-07-02T16:05:49Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/specific/HelmChartST.java", "diffHunk": "@@ -2,9 +2,10 @@\n  * Copyright Strimzi authors.\n  * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n  */\n-package io.strimzi.systemtest;\n+package io.strimzi.systemtest.specific;", "originalCommit": "f180142a5f10a5bb5462f74e104af8695bf0d918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMzY5Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r449303696", "bodyText": "I think we will remove this class soon. I want to do same thing as I did with OLM installation - add a posibility to run most of the tests against CO installed via helm", "author": "Frawless", "createdAt": "2020-07-02T23:09:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMTcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDg1NjQxNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3276#discussion_r450856416", "bodyText": "Makes sense to me!", "author": "samuel-hawker", "createdAt": "2020-07-07T13:18:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyMTcyNg=="}], "type": "inlineReview", "revised_code": {"commit": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/specific/HelmChartST.java b/systemtest/src/test/java/io/strimzi/systemtest/specific/HelmChartST.java\nindex c0aea2d55d..2b260d4382 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/specific/HelmChartST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/specific/HelmChartST.java\n\n@@ -5,7 +5,7 @@\n package io.strimzi.systemtest.specific;\n \n import io.strimzi.api.kafka.model.KafkaResources;\n-import io.strimzi.systemtest.BaseST;\n+import io.strimzi.systemtest.AbstractST;\n import io.strimzi.systemtest.utils.kubeUtils.controllers.StatefulSetUtils;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n"}}, {"oid": "054d20f1575d02b7e26707a39bbfdcadf28ff14f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/054d20f1575d02b7e26707a39bbfdcadf28ff14f", "message": "Rebase fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T12:50:25Z", "type": "forcePushed"}, {"oid": "5bf2a656cf816728a41c94cc72c23e158c838976", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5bf2a656cf816728a41c94cc72c23e158c838976", "message": "Refactor systemtest package structure\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T17:45:12Z", "type": "commit"}, {"oid": "be543f63083790ce51d9f81ed41779ae813ea892", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/be543f63083790ce51d9f81ed41779ae813ea892", "message": "Move few packages back\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T17:45:12Z", "type": "commit"}, {"oid": "7ba7f71f97013421e390fae204a427ab60c74c55", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7ba7f71f97013421e390fae204a427ab60c74c55", "message": "fixup! Move few packages back\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T17:45:12Z", "type": "commit"}, {"oid": "497ea05c165ccafb624be081cea69d6912ff1c90", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/497ea05c165ccafb624be081cea69d6912ff1c90", "message": "Rename BaseST -> AbstractST to have same naming convention as in other modules\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T17:45:12Z", "type": "commit"}, {"oid": "2bfc673e820e86545ec96e3bf947269f47ff9e55", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2bfc673e820e86545ec96e3bf947269f47ff9e55", "message": "Rebase fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T17:45:12Z", "type": "commit"}, {"oid": "2bfc673e820e86545ec96e3bf947269f47ff9e55", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2bfc673e820e86545ec96e3bf947269f47ff9e55", "message": "Rebase fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-07-07T17:45:12Z", "type": "forcePushed"}]}