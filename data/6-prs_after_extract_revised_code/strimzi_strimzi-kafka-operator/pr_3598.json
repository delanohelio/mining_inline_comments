{"pr_number": 3598, "pr_title": "ST: Add transactional producer to system test", "pr_createdAt": "2020-09-03T10:39:59Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3598", "timeline": [{"oid": "67a451c40a5134032b420f613df270af2ef67da8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/67a451c40a5134032b420f613df270af2ef67da8", "message": "some changes\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-03T08:57:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQwOTkyNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3598#discussion_r483409924", "bodyText": "It's only a question, but why do we need to rename it? Was there some issue?", "author": "im-konge", "createdAt": "2020-09-04T06:18:31Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/AlternativeReconcileTriggersST.java", "diffHunk": "@@ -50,47 +50,51 @@\n     @Test\n     void testManualTriggeringRollingUpdate() {\n         String topicName = KafkaTopicUtils.generateRandomNameOfTopic();\n+        String clusterName = CLUSTER_NAME + \"-manual-rolling\";", "originalCommit": "64c787d2cf3bf5824e5a24c08d65b8d39c5c8e72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQyNDIyOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3598#discussion_r483424229", "bodyText": "Yes, I think the second test get same PV (or something like that) and CO wasn't able to roll some pods.", "author": "Frawless", "createdAt": "2020-09-04T06:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQwOTkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ0NDEwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3598#discussion_r483444104", "bodyText": "That makes sense :) thanks for explanation.", "author": "im-konge", "createdAt": "2020-09-04T07:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQwOTkyNA=="}], "type": "inlineReview", "revised_code": {"commit": "67b1646d6ada46b8e67a3a12acce5c91bb5a957e", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/AlternativeReconcileTriggersST.java b/systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/AlternativeReconcileTriggersST.java\nindex 9b7991a5ad..25101b4952 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/AlternativeReconcileTriggersST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/AlternativeReconcileTriggersST.java\n\n@@ -50,51 +50,49 @@ class AlternativeReconcileTriggersST extends AbstractST {\n     @Test\n     void testManualTriggeringRollingUpdate() {\n         String topicName = KafkaTopicUtils.generateRandomNameOfTopic();\n-        String clusterName = CLUSTER_NAME + \"-manual-rolling\";\n         String continuousTopicName = \"continuous-topic\";\n         // 500 messages will take 500 seconds in that case\n         int continuousClientsMessageCount = 500;\n         String producerName = \"hello-world-producer\";\n         String consumerName = \"hello-world-consumer\";\n \n-        KafkaResource.kafkaPersistent(clusterName, 3, 3).done();\n+        KafkaResource.kafkaPersistent(CLUSTER_NAME, 3, 3).done();\n \n-        String kafkaName = KafkaResources.kafkaStatefulSetName(clusterName);\n-        String zkName = KafkaResources.zookeeperStatefulSetName(clusterName);\n+        String kafkaName = KafkaResources.kafkaStatefulSetName(CLUSTER_NAME);\n+        String zkName = KafkaResources.zookeeperStatefulSetName(CLUSTER_NAME);\n         Map<String, String> kafkaPods = StatefulSetUtils.ssSnapshot(kafkaName);\n         Map<String, String> zkPods = StatefulSetUtils.ssSnapshot(zkName);\n \n-        KafkaTopicResource.topic(clusterName, topicName).done();\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n         // ##############################\n         // Attach clients which will continuously produce/consume messages to/from Kafka brokers during rolling update\n         // ##############################\n         // Setup topic, which has 3 replicas and 2 min.isr to see if producer will be able to work during rolling update\n-        KafkaTopicResource.topic(clusterName, continuousTopicName, 3, 3, 2).done();\n+        KafkaTopicResource.topic(CLUSTER_NAME, continuousTopicName, 3, 3, 2).done();\n         String producerAdditionConfiguration = \"delivery.timeout.ms=20000\\nrequest.timeout.ms=20000\";\n-        // Add transactional id to make producer transactional\n         producerAdditionConfiguration = producerAdditionConfiguration.concat(\"\\ntransactional.id=\" + continuousTopicName + \".1\");\n         producerAdditionConfiguration = producerAdditionConfiguration.concat(\"\\nenable.idempotence=true\");\n \n         KafkaBasicClientResource kafkaBasicClientJob = new KafkaBasicClientResource(producerName, consumerName,\n-            KafkaResources.plainBootstrapAddress(clusterName), continuousTopicName, continuousClientsMessageCount, producerAdditionConfiguration, ClientUtils.generateRandomConsumerGroup(), 1000);\n+            KafkaResources.plainBootstrapAddress(CLUSTER_NAME), continuousTopicName, continuousClientsMessageCount, producerAdditionConfiguration, ClientUtils.generateRandomConsumerGroup(), 1000);\n \n         kafkaBasicClientJob.producerStrimzi().done();\n         kafkaBasicClientJob.consumerStrimzi().done();\n         // ##############################\n \n         String userName = KafkaUserUtils.generateRandomNameOfKafkaUser();\n-        KafkaUser user = KafkaUserResource.tlsUser(clusterName, userName).done();\n+        KafkaUser user = KafkaUserResource.tlsUser(CLUSTER_NAME, userName).done();\n \n-        KafkaClientsResource.deployKafkaClients(true, clusterName + \"-\" + Constants.KAFKA_CLIENTS, user).done();\n+        KafkaClientsResource.deployKafkaClients(true, CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS, user).done();\n \n         final String defaultKafkaClientsPodName =\n-            ResourceManager.kubeClient().listPodsByPrefixInName(clusterName + \"-\" + Constants.KAFKA_CLIENTS).get(0).getMetadata().getName();\n+            ResourceManager.kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS).get(0).getMetadata().getName();\n \n         InternalKafkaClient internalKafkaClient = new InternalKafkaClient.Builder()\n             .withUsingPodName(defaultKafkaClientsPodName)\n             .withTopicName(topicName)\n             .withNamespaceName(NAMESPACE)\n-            .withClusterName(clusterName)\n+            .withClusterName(CLUSTER_NAME)\n             .withMessageCount(MESSAGE_COUNT)\n             .withKafkaUsername(userName)\n             .build();\n"}}, {"oid": "67b1646d6ada46b8e67a3a12acce5c91bb5a957e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/67b1646d6ada46b8e67a3a12acce5c91bb5a957e", "message": "WIP: transactional clients\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-08T11:13:56Z", "type": "commit"}, {"oid": "1b22adfe530c54f048d460bc64c13fc4689f173b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1b22adfe530c54f048d460bc64c13fc4689f173b", "message": "some changes\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-08T11:13:56Z", "type": "commit"}, {"oid": "1a20146bfe4deb4bd9a90506b05ae81b96517ec7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1a20146bfe4deb4bd9a90506b05ae81b96517ec7", "message": "Rename cluster in one test to avoid collision\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-08T11:13:56Z", "type": "commit"}, {"oid": "83c3e9e3d0c7bb2456764bf2b703f0593e993558", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/83c3e9e3d0c7bb2456764bf2b703f0593e993558", "message": "Change restart policy for clients\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-08T12:19:20Z", "type": "commit"}, {"oid": "83c3e9e3d0c7bb2456764bf2b703f0593e993558", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/83c3e9e3d0c7bb2456764bf2b703f0593e993558", "message": "Change restart policy for clients\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-08T12:19:20Z", "type": "forcePushed"}]}