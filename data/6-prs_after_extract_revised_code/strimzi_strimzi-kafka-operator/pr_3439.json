{"pr_number": 3439, "pr_title": "Remove Prometheus port and annotations from services", "pr_createdAt": "2020-08-03T12:49:16Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3439", "timeline": [{"oid": "8f0d15e8b05839cbf9c74ee4d2f01c775404b42e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8f0d15e8b05839cbf9c74ee4d2f01c775404b42e", "message": "Removed metrics port from services\nRemoved Prometheus annotations from services\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nRemoved Kafka Exporter service with no ports anymore\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nUpdated CHANGELOG\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-03T19:16:03Z", "type": "forcePushed"}, {"oid": "681ce11c50601010a6c34d66505a0bab64c261a2", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/681ce11c50601010a6c34d66505a0bab64c261a2", "message": "Removed metrics port from services\nRemoved Prometheus annotations from services\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nRemoved Kafka Exporter service with no ports anymore\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nUpdated CHANGELOG\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-03T19:28:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4NTg3NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3439#discussion_r464685875", "bodyText": "I guess we do not need the mergeLabelsOrAnnotations here?", "author": "scholzj", "createdAt": "2020-08-03T22:03:30Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -342,13 +342,10 @@ static Affinity affinity(ZookeeperClusterSpec zookeeperClusterSpec) {\n     }\n \n     public Service generateService() {\n-        List<ServicePort> ports = new ArrayList<>(2);\n-        if (isMetricsEnabled()) {\n-            ports.add(createServicePort(METRICS_PORT_NAME, METRICS_PORT, METRICS_PORT, \"TCP\"));\n-        }\n+        List<ServicePort> ports = new ArrayList<>(1);\n         ports.add(createServicePort(CLIENT_TLS_PORT_NAME, CLIENT_TLS_PORT, CLIENT_TLS_PORT, \"TCP\"));\n \n-        return createService(\"ClusterIP\", ports, Util.mergeLabelsOrAnnotations(prometheusAnnotations(), templateServiceAnnotations));\n+        return createService(\"ClusterIP\", ports, Util.mergeLabelsOrAnnotations(templateServiceAnnotations));", "originalCommit": "681ce11c50601010a6c34d66505a0bab64c261a2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "36e96d3025b72aba02d4f83d90f502e9de0692d5", "chunk": "diff --git a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java\nindex 3b6d4a87f9..ad2c814a38 100644\n--- a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java\n+++ b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java\n\n@@ -345,7 +345,7 @@ public class ZookeeperCluster extends AbstractModel {\n         List<ServicePort> ports = new ArrayList<>(1);\n         ports.add(createServicePort(CLIENT_TLS_PORT_NAME, CLIENT_TLS_PORT, CLIENT_TLS_PORT, \"TCP\"));\n \n-        return createService(\"ClusterIP\", ports, Util.mergeLabelsOrAnnotations(templateServiceAnnotations));\n+        return createService(\"ClusterIP\", ports, templateServiceAnnotations);\n     }\n \n     public static String policyName(String cluster) {\n"}}, {"oid": "c8c0adec0e392290043fedf393f42d78cbbe7142", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c8c0adec0e392290043fedf393f42d78cbbe7142", "message": "Removed metrics port from services\nRemoved Prometheus annotations from services\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nRemoved Kafka Exporter service with no ports anymore\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nUpdated CHANGELOG\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-04T06:55:36Z", "type": "commit"}, {"oid": "c8c0adec0e392290043fedf393f42d78cbbe7142", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c8c0adec0e392290043fedf393f42d78cbbe7142", "message": "Removed metrics port from services\nRemoved Prometheus annotations from services\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nRemoved Kafka Exporter service with no ports anymore\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nUpdated CHANGELOG\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>\n\nFixed checkstyle\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-04T06:55:36Z", "type": "forcePushed"}, {"oid": "36e96d3025b72aba02d4f83d90f502e9de0692d5", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/36e96d3025b72aba02d4f83d90f502e9de0692d5", "message": "Fixed comments\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-04T07:13:45Z", "type": "commit"}, {"oid": "35a52739fc66ee5f7f277aabc31e94d4995d59fa", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/35a52739fc66ee5f7f277aabc31e94d4995d59fa", "message": "Fixed CHANGELOG\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-04T12:25:58Z", "type": "commit"}, {"oid": "f09203f0830f8fdb6f60ce3735d8c341ef12508b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f09203f0830f8fdb6f60ce3735d8c341ef12508b", "message": "Fixed comment\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>", "committedDate": "2020-08-04T12:26:54Z", "type": "commit"}]}