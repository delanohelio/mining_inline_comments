{"pr_number": 2850, "pr_title": "Deflakiness of TO IT", "pr_createdAt": "2020-04-17T11:44:39Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2850", "timeline": [{"oid": "7b5bc890718c7c908b14ae3d0eab200d9cb62928", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7b5bc890718c7c908b14ae3d0eab200d9cb62928", "message": "Deflakines of TO IT\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T11:54:48Z", "type": "commit"}, {"oid": "7b5bc890718c7c908b14ae3d0eab200d9cb62928", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7b5bc890718c7c908b14ae3d0eab200d9cb62928", "message": "Deflakines of TO IT\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T11:54:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMTE1OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2850#discussion_r410201159", "bodyText": "To reviewers: Github diff might seem like a mess. Basically it is just moving vertx instantiation from BrforeAll to BeforeEach (similarly with closing it).", "author": "sknot-rh", "createdAt": "2020-04-17T12:52:04Z", "path": "topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java", "diffHunk": "@@ -67,22 +65,14 @@\n \n     // TODO this is all in common with TOIT, so factor out a common base class\n \n-    @BeforeAll\n-    public static void before() {\n+    @BeforeEach", "originalCommit": "7b5bc890718c7c908b14ae3d0eab200d9cb62928", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c52c7bf5b3ed869a8311f89e2d9af88abdedbd0f", "chunk": "diff --git a/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java b/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java\nindex 94b189a13..5437a025d 100644\n--- a/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java\n+++ b/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java\n\n@@ -65,14 +67,22 @@ public class TopicOperatorMockTest {\n \n     // TODO this is all in common with TOIT, so factor out a common base class\n \n-    @BeforeEach\n-    public void createMockKube(VertxTestContext context) throws Exception {\n+    @BeforeAll\n+    public static void before() {\n         VertxOptions options = new VertxOptions().setMetricsOptions(\n                 new MicrometerMetricsOptions()\n                         .setPrometheusOptions(new VertxPrometheusOptions().setEnabled(true))\n                         .setEnabled(true));\n         vertx = Vertx.vertx(options);\n+    }\n \n+    @AfterAll\n+    public static void after() {\n+        vertx.close();\n+    }\n+\n+    @BeforeEach\n+    public void createMockKube(VertxTestContext context) throws Exception {\n         assumeTrue(System.getenv(\"TRAVIS\") == null, \"This test is flaky on Travis, for unknown reasons\");\n         MockKube mockKube = new MockKube();\n         mockKube.withCustomResourceDefinition(Crds.kafkaTopic(),\n"}}, {"oid": "c52c7bf5b3ed869a8311f89e2d9af88abdedbd0f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c52c7bf5b3ed869a8311f89e2d9af88abdedbd0f", "message": "wait for undeploy\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T13:30:11Z", "type": "commit"}, {"oid": "c52c7bf5b3ed869a8311f89e2d9af88abdedbd0f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c52c7bf5b3ed869a8311f89e2d9af88abdedbd0f", "message": "wait for undeploy\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T13:30:11Z", "type": "forcePushed"}, {"oid": "146a005b90fdb17f4e4ac101afe6136930bedb77", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/146a005b90fdb17f4e4ac101afe6136930bedb77", "message": "enable test on travis\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T13:32:11Z", "type": "commit"}, {"oid": "89c40c23e0f4f23280468f72f6173daa31b50bae", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/89c40c23e0f4f23280468f72f6173daa31b50bae", "message": "real waiting\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T13:56:52Z", "type": "commit"}, {"oid": "89c40c23e0f4f23280468f72f6173daa31b50bae", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/89c40c23e0f4f23280468f72f6173daa31b50bae", "message": "real waiting\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T13:56:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI0MTIzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2850#discussion_r410241233", "bodyText": "Not even a suggested change, but context.checkpoint() calls context.checkpoint(1) and generally in the rest of the code we have been calling the argument-less call. But that aside this looks like a good change to me.", "author": "samuel-hawker", "createdAt": "2020-04-17T13:58:27Z", "path": "topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java", "diffHunk": "@@ -138,15 +136,18 @@ public void createMockKube(VertxTestContext context) throws Exception {\n     }\n \n     @AfterEach\n-    public void tearDown() {\n+    public void tearDown(VertxTestContext context) {\n+        Checkpoint checkpoint = context.checkpoint(1);", "originalCommit": "89c40c23e0f4f23280468f72f6173daa31b50bae", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3880c062cc4c12d1c7dee317871607c2ca973a1", "chunk": "diff --git a/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java b/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java\nindex 252d014da..d3a29c1f1 100644\n--- a/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java\n+++ b/topic-operator/src/test/java/io/strimzi/operator/topic/TopicOperatorMockTest.java\n\n@@ -137,7 +137,7 @@ public class TopicOperatorMockTest {\n \n     @AfterEach\n     public void tearDown(VertxTestContext context) {\n-        Checkpoint checkpoint = context.checkpoint(1);\n+        Checkpoint checkpoint = context.checkpoint();\n         if (vertx != null && deploymentId != null) {\n             vertx.undeploy(deploymentId, undeployResult -> {\n                 if (adminClient != null) {\n"}}, {"oid": "f3880c062cc4c12d1c7dee317871607c2ca973a1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f3880c062cc4c12d1c7dee317871607c2ca973a1", "message": "suggestion\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-04-17T15:11:16Z", "type": "commit"}]}