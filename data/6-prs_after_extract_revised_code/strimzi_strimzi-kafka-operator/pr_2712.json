{"pr_number": 2712, "pr_title": "[systemtest] ConnectS2IST: fix tests", "pr_createdAt": "2020-03-18T09:40:01Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712", "timeline": [{"oid": "31d15bb105b8f6fd303b99c37aacf9f490af583a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/31d15bb105b8f6fd303b99c37aacf9f490af583a", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-19T01:30:10Z", "type": "forcePushed"}, {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5506d55f85a8249fd942e05dfd679b69958ee050", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-19T10:30:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzNDczMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712#discussion_r395534733", "bodyText": "Isn't this line useless ?", "author": "Frawless", "createdAt": "2020-03-20T09:58:31Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -89,17 +90,19 @@ void testDeployS2IWithMongoDBPlugin() throws InterruptedException, IOException {\n \n         KafkaConnectS2IUtils.waitForConnectS2IStatus(kafkaConnectS2IName, \"Ready\");\n \n-        // Make sure that Connenct API is ready\n-        KafkaConnectS2IUtils.waitForRebalancingDone(kafkaConnectS2IName);\n-\n-        String createConnectorOutput = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"POST\", \"-H\", \"Accept:application/json\", \"-H\", \"Content-Type:application/json\",\n-                \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\", \"-d\", mongoDbConfig).out();\n-        LOGGER.info(\"Create Connector result: {}\", createConnectorOutput);\n+        TestUtils.waitFor(\"ConnectS2I will be ready and POST will be executed\", Constants.GLOBAL_POLL_INTERVAL, Constants.TIMEOUT_FOR_RESOURCE_CREATION, () -> {\n+            String createConnectorOutput = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"POST\", \"-H\", \"Accept:application/json\", \"-H\", \"Content-Type:application/json\",\n+                    \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\", \"-d\", mongoDbConfig).out();\n+            LOGGER.info(\"Create Connector result: {}\", createConnectorOutput);\n+            return !createConnectorOutput.contains(\"error_code\");\n+        });\n \n         // Make sure that connector is really created\n         Thread.sleep(10_000);\n \n         String connectorStatus = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"GET\", \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\" + kafkaConnectS2IName + \"/status\").out();\n+\n+        KafkaConnectS2IUtils.waitForConnectS2IStatus(kafkaConnectS2IName, \"Ready\");", "originalCommit": "5506d55f85a8249fd942e05dfd679b69958ee050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM1NDExMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712#discussion_r396354110", "bodyText": "Removed :)", "author": "im-konge", "createdAt": "2020-03-23T10:37:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzNDczMw=="}], "type": "inlineReview", "revised_code": {"commit": "81348db65c501595b7fd157d7b6bb80e92da9b70", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java b/systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java\nindex 06094ba856..258e6cf3b5 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java\n\n@@ -102,7 +103,6 @@ class ConnectS2IST extends BaseST {\n \n         String connectorStatus = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"GET\", \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\" + kafkaConnectS2IName + \"/status\").out();\n \n-        KafkaConnectS2IUtils.waitForConnectS2IStatus(kafkaConnectS2IName, \"Ready\");\n         assertThat(connectorStatus, containsString(\"RUNNING\"));\n     }\n \n"}}, {"oid": "65cfa667df3ca6b21beb428c83b0ddb1db0fbd95", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/65cfa667df3ca6b21beb428c83b0ddb1db0fbd95", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-23T10:34:02Z", "type": "commit"}, {"oid": "81348db65c501595b7fd157d7b6bb80e92da9b70", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/81348db65c501595b7fd157d7b6bb80e92da9b70", "message": "fixup! ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-23T10:34:02Z", "type": "commit"}, {"oid": "81348db65c501595b7fd157d7b6bb80e92da9b70", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/81348db65c501595b7fd157d7b6bb80e92da9b70", "message": "fixup! ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-23T10:34:02Z", "type": "forcePushed"}]}