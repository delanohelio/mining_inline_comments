{"pr_number": 3589, "pr_title": "FIX(SystemTests) Dynamic Log changes unable to check from kafka-pods", "pr_createdAt": "2020-09-02T11:59:18Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3589", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1NzMwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3589#discussion_r482057305", "bodyText": "Why is this changed?\nAnd Kafka doesn't have container kafka-clients.", "author": "im-konge", "createdAt": "2020-09-02T13:12:37Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java", "diffHunk": "@@ -848,13 +849,13 @@ void testDynamicallySetKafkaExternalLogging() {\n \n         TestUtils.waitFor(\"Verify logger change\", Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_TIMEOUT,\n             () -> cmdKubeClient().execInPodContainer(KafkaResources.kafkaPodName(CLUSTER_NAME, 0),\n-                        \"kafka\", \"/bin/bash\", \"-c\", \"bin/kafka-configs.sh --bootstrap-server localhost:9092 --describe --entity-type broker-loggers --entity-name 0\").out()\n+                        \"kafka-clients\", \"/bin/bash\", \"-c\", \"bin/kafka-configs.sh --bootstrap-server localhost:9092 --describe --entity-type broker-loggers --entity-name 0\").out()", "originalCommit": "7cdd4c5ccb3bc877a2dec2370b60b4815a37b5d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA2MjAzOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3589#discussion_r482062038", "bodyText": "This is a mistake in completely different test. Thanks for spotting that!", "author": "michalxo", "createdAt": "2020-09-02T13:19:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1NzMwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "539d6919984e9998617e5adc266db64a1a09d5b4", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java b/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\nindex 04be2a2e72..0c777ad099 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\n\n@@ -849,7 +851,7 @@ class LoggingChangeST extends AbstractST {\n \n         TestUtils.waitFor(\"Verify logger change\", Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_TIMEOUT,\n             () -> cmdKubeClient().execInPodContainer(KafkaResources.kafkaPodName(CLUSTER_NAME, 0),\n-                        \"kafka-clients\", \"/bin/bash\", \"-c\", \"bin/kafka-configs.sh --bootstrap-server localhost:9092 --describe --entity-type broker-loggers --entity-name 0\").out()\n+                        \"kafka\", \"/bin/bash\", \"-c\", \"bin/kafka-configs.sh --bootstrap-server localhost:9092 --describe --entity-type broker-loggers --entity-name 0\").out()\n                         .contains(\"kafka.authorizer.logger=DEBUG\"));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1OTEwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3589#discussion_r482059105", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String kafkaMM2PodName = kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.MIRROR_MAKER2).get(0).getMetadata().getName();\n          \n          \n            \n                    String kafkaMM2PodName = KafkaMirrorMaker2Resource.kafkaMirrorMaker2Client().inNamespace(NAMESPACE).withName(CLUSTER_NAME).get().getMetadata().getName();", "author": "im-konge", "createdAt": "2020-09-02T13:15:17Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java", "diffHunk": "@@ -864,6 +865,8 @@ void testDynamicallySetMM2LoggingLevels() throws InterruptedException {\n         KafkaResource.kafkaEphemeral(CLUSTER_NAME + \"-target\", 3).done();\n         KafkaClientsResource.deployKafkaClients(false, KAFKA_CLIENTS_NAME).done();\n         KafkaMirrorMaker2Resource.kafkaMirrorMaker2(CLUSTER_NAME, CLUSTER_NAME + \"-target\", CLUSTER_NAME + \"-source\", 1, false).done();\n+        String kafkaMM2PodName = kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.MIRROR_MAKER2).get(0).getMetadata().getName();", "originalCommit": "7cdd4c5ccb3bc877a2dec2370b60b4815a37b5d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA2MDkxOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3589#discussion_r482060919", "bodyText": "Thanks, I will update it right away.", "author": "michalxo", "createdAt": "2020-09-02T13:17:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1OTEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEwMjI1OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3589#discussion_r482102258", "bodyText": "Sorry, my bad \ud83d\ude04 I meant this:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String kafkaMM2PodName = kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.MIRROR_MAKER2).get(0).getMetadata().getName();\n          \n          \n            \n                    String kafkaMM2PodName = kubeClient().listPods(Labels.STRIMZI_KIND_LABEL, KafkaMirrorMaker2.RESOURCE_KIND).get(0).getMetadata().getName();", "author": "im-konge", "createdAt": "2020-09-02T14:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1OTEwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "539d6919984e9998617e5adc266db64a1a09d5b4", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java b/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\nindex 04be2a2e72..0c777ad099 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\n\n@@ -865,8 +867,8 @@ class LoggingChangeST extends AbstractST {\n         KafkaResource.kafkaEphemeral(CLUSTER_NAME + \"-target\", 3).done();\n         KafkaClientsResource.deployKafkaClients(false, KAFKA_CLIENTS_NAME).done();\n         KafkaMirrorMaker2Resource.kafkaMirrorMaker2(CLUSTER_NAME, CLUSTER_NAME + \"-target\", CLUSTER_NAME + \"-source\", 1, false).done();\n-        String kafkaMM2PodName = kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.MIRROR_MAKER2).get(0).getMetadata().getName();\n-\n+        String kafkaMM2PodName = kubeClient().listPods(Labels.STRIMZI_KIND_LABEL, KafkaMirrorMaker2.RESOURCE_KIND).get(0).getMetadata().getName();\n+        String mm2LogCheckCmd = \"http://localhost:8083/admin/loggers/root\";\n \n         Map<String, String> mm2Snapshot = DeploymentUtils.depSnapshot(KafkaMirrorMaker2Resources.deploymentName(CLUSTER_NAME));\n \n"}}, {"oid": "539d6919984e9998617e5adc266db64a1a09d5b4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/539d6919984e9998617e5adc266db64a1a09d5b4", "message": "FIX(SystemTests) Logging changes are not checked from kafka pod (use kafka clients pod)\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-02T14:28:16Z", "type": "forcePushed"}, {"oid": "87c0f3456bcb8390c9ac9acf51624a4fe18f7f5d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/87c0f3456bcb8390c9ac9acf51624a4fe18f7f5d", "message": "FIX(SystemTests) Logging changes are not checked from kafka pod (use kafka clients pod)\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-02T19:05:08Z", "type": "commit"}, {"oid": "87c0f3456bcb8390c9ac9acf51624a4fe18f7f5d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/87c0f3456bcb8390c9ac9acf51624a4fe18f7f5d", "message": "FIX(SystemTests) Logging changes are not checked from kafka pod (use kafka clients pod)\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-02T19:05:08Z", "type": "forcePushed"}]}