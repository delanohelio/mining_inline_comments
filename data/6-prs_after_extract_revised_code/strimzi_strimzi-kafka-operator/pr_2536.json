{"pr_number": 2536, "pr_title": "ST: Improve checks for nodeport status", "pr_createdAt": "2020-02-11T13:23:09Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2536", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1MTM4MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2536#discussion_r379151381", "bodyText": "You check if it has external listener but not the type. That is a bit weird. Either you expect the resource above and you do not need to check for any of them or you should check for both of them, or?", "author": "scholzj", "createdAt": "2020-02-13T22:19:04Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1035,6 +1039,31 @@ void testNodePort() throws Exception {\n             .done();\n \n         kafkaClient.sendAndRecvMessages(NAMESPACE);\n+\n+        // Check that Kafka status has correct addresses in NodePort external listener part\n+        for (ListenerStatus listenerStatus : KafkaResource.getKafkaStatus(CLUSTER_NAME, NAMESPACE).getListeners()) {\n+            if (listenerStatus.getType().equals(\"external\")) {", "originalCommit": "741e9fac01f04349ad7f6cdaa155b7e3436cde41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI3OTM2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2536#discussion_r379279367", "bodyText": "It's used only in NodePort test so I expect that operator will create node port correctly.", "author": "Frawless", "createdAt": "2020-02-14T07:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1MTM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUwNDI5Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2536#discussion_r379504297", "bodyText": "I guess you are right. I misread the code.", "author": "scholzj", "createdAt": "2020-02-14T15:50:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1MTM4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "eb0a951e0025394f8d41b6177c646488ece4a17c", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java b/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\nindex c30ba5296a..54797abfd0 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\n\n@@ -1038,7 +1061,11 @@ class KafkaST extends BaseST {\n             .endSpec()\n             .done();\n \n-        kafkaClient.sendAndRecvMessages(NAMESPACE);\n+        Future<Integer> producer = externalBasicKafkaClient.sendMessages(TOPIC_NAME, NAMESPACE, CLUSTER_NAME, MESSAGE_COUNT);\n+        Future<Integer> consumer = externalBasicKafkaClient.receiveMessages(TOPIC_NAME, NAMESPACE, CLUSTER_NAME, MESSAGE_COUNT);\n+\n+        assertThat(producer.get(2, TimeUnit.MINUTES), is(MESSAGE_COUNT));\n+        assertThat(consumer.get(2, TimeUnit.MINUTES), is(MESSAGE_COUNT));\n \n         // Check that Kafka status has correct addresses in NodePort external listener part\n         for (ListenerStatus listenerStatus : KafkaResource.getKafkaStatus(CLUSTER_NAME, NAMESPACE).getListeners()) {\n"}}, {"oid": "eb0a951e0025394f8d41b6177c646488ece4a17c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eb0a951e0025394f8d41b6177c646488ece4a17c", "message": "Add check to testNodePort to see if status of Kafka is set properly with node addresses\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-02-17T08:40:07Z", "type": "commit"}, {"oid": "1901dac43042f3474303846a55f1445d6a4d003f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1901dac43042f3474303846a55f1445d6a4d003f", "message": "Checkstyle fixups\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-02-17T08:40:10Z", "type": "commit"}, {"oid": "571b0da62eea6def7ce4bc0d5a78075d5ab24f81", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/571b0da62eea6def7ce4bc0d5a78075d5ab24f81", "message": "Change the way how to collect node address for comparison with status\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-02-17T09:45:15Z", "type": "commit"}, {"oid": "571b0da62eea6def7ce4bc0d5a78075d5ab24f81", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/571b0da62eea6def7ce4bc0d5a78075d5ab24f81", "message": "Change the way how to collect node address for comparison with status\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-02-17T09:45:15Z", "type": "forcePushed"}, {"oid": "fd1f3b3ee0b38963b7b96df3be6695f2fa04eca0", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fd1f3b3ee0b38963b7b96df3be6695f2fa04eca0", "message": "fixup! Change the way how to collect node address for comparison with status\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-02-17T09:57:03Z", "type": "commit"}]}