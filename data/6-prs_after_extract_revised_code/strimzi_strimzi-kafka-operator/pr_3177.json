{"pr_number": 3177, "pr_title": "ST: Create a bunch of topics for upgrade for upgrade tests", "pr_createdAt": "2020-06-09T12:52:36Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177", "timeline": [{"oid": "5031b5b42e8e78a352a2c714c84ab54161e74770", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5031b5b42e8e78a352a2c714c84ab54161e74770", "message": "Create a bunch of topics for upgrade for upgrade tests\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-06-11T15:18:14Z", "type": "commit"}, {"oid": "fd36c078fe03a6de56dd66f6787422d6912143dd", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fd36c078fe03a6de56dd66f6787422d6912143dd", "message": "Run bucnch topics upgrade only after TO fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-06-11T15:18:15Z", "type": "commit"}, {"oid": "1685f2a14e96730dab64e4d966c3fb47dba3f7dd", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1685f2a14e96730dab64e4d966c3fb47dba3f7dd", "message": "fixup! Run bucnch topics upgrade only after TO fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-06-11T15:18:26Z", "type": "commit"}, {"oid": "1685f2a14e96730dab64e4d966c3fb47dba3f7dd", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1685f2a14e96730dab64e4d966c3fb47dba3f7dd", "message": "fixup! Run bucnch topics upgrade only after TO fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-06-11T15:18:26Z", "type": "forcePushed"}, {"oid": "99889b09153cf41570020b5c075c774b14272e4b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/99889b09153cf41570020b5c075c774b14272e4b", "message": "fixup! fixup! Run bucnch topics upgrade only after TO fix\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-06-12T08:03:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r439488252", "bodyText": "I don't mean to sound pedantic but bunchTopicsUpgrade as a parameter is a little meaningless without context, maybe generateTopics would be a little more informative and means we can re-use it in other tests if need be.\nI wonder also if there is any value in making the topic names generated a little more random, if this is a check that data is persisted, it might be worth making more problematic topic names to check those also behave  - but i admit that might not have too much value.", "author": "samuel-hawker", "createdAt": "2020-06-12T15:27:50Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/StrimziUpgradeST.java", "diffHunk": "@@ -252,6 +236,16 @@ private void performUpgrade(JsonObject testParameters, int produceMessagesCount,\n             LOGGER.info(\"Going to deploy KafkaTopic from: {}\", kafkaTopicYaml.getPath());\n             cmdKubeClient().create(kafkaTopicYaml);\n         }\n+        // Create bunch of topics for upgrade if it's specified in configuration\n+        if (testParameters.getBoolean(\"bunchTopicsUpgrade\")) {", "originalCommit": "99889b09153cf41570020b5c075c774b14272e4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU5NDE0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r439594149", "bodyText": "TBH when I wrote it, I was hoping someone will have better name on mind :) I can change it for sure.\nYou mean something like you'll pass a specific value as a seed to a method and it will generate a specific list of names which we could use later to validate a test results with the same method call? ... Or we can save each randomly generated topic name (we have method for it) in a list and then validate collected topics against this list. I am just thinking, but the way with randomly generate topics and keep store them for a future validation sounds like a good idea to me.", "author": "Frawless", "createdAt": "2020-06-12T19:01:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYwMDA0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r439600047", "bodyText": "Phew glad it's not unwelcome name change! I think an input for it having a predictable and repeatable set of topics would be useful but perhaps default it to seed using the current unixepoch? That way each test run has a different randomly generated set , this way if weird things happen with a specific topic name we can repeat it and debug why. Again it seems super unlikely that this will ever happen- but making a random topic name that obeys Kafka topic name regex is probably not too hard.", "author": "samuel-hawker", "createdAt": "2020-06-12T19:15:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk3NjU5NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r439976594", "bodyText": "Yes, sounds reasonable. Opened #3194", "author": "Frawless", "createdAt": "2020-06-15T07:22:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwOTI2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r440009269", "bodyText": "Cool, were you planning on changing the param name prior to merge?", "author": "samuel-hawker", "createdAt": "2020-06-15T08:24:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwOTQ2OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r440009468", "bodyText": "bunchTopicsUpgrade -> generateTopics", "author": "samuel-hawker", "createdAt": "2020-06-15T08:25:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyMjMzMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r440022330", "bodyText": "yes, going to do it right now", "author": "Frawless", "createdAt": "2020-06-15T08:47:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyNTQxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3177#discussion_r440025418", "bodyText": "Done :) thanks for reminding me", "author": "Frawless", "createdAt": "2020-06-15T08:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4ODI1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "fc8c6a2646ec7a6de1267264211016c40c1b40fa", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/upgrade/StrimziUpgradeST.java b/systemtest/src/test/java/io/strimzi/systemtest/upgrade/StrimziUpgradeST.java\nindex 651a4f5d59..755fe05775 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/upgrade/StrimziUpgradeST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/upgrade/StrimziUpgradeST.java\n\n@@ -237,7 +237,7 @@ public class StrimziUpgradeST extends BaseST {\n             cmdKubeClient().create(kafkaTopicYaml);\n         }\n         // Create bunch of topics for upgrade if it's specified in configuration\n-        if (testParameters.getBoolean(\"bunchTopicsUpgrade\")) {\n+        if (testParameters.getBoolean(\"generateTopics\")) {\n             for (int x = 0; x < upgradeTopicCount; x++) {\n                 KafkaTopicResource.topicWithoutWait(KafkaTopicResource.defaultTopic(CLUSTER_NAME, topicName + \"-\" + x, 1, 1, 1)\n                     .editSpec()\n"}}, {"oid": "fc8c6a2646ec7a6de1267264211016c40c1b40fa", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fc8c6a2646ec7a6de1267264211016c40c1b40fa", "message": "Rename flag for generate topics during upgrade\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-06-15T08:52:03Z", "type": "commit"}]}