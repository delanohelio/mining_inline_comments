{"pr_number": 3414, "pr_title": "Small typos & test CC for extra perf options", "pr_createdAt": "2020-07-30T07:35:57Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414", "timeline": [{"oid": "edc64a3c2836050e8cd34400f0a9024ff6266851", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/edc64a3c2836050e8cd34400f0a9024ff6266851", "message": "NEW(Tests) Added checks for CC perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-07-30T10:31:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwODQ0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r462908449", "bodyText": "You can iterate over the created enum.", "author": "see-quick", "createdAt": "2020-07-30T10:39:51Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java", "diffHunk": "@@ -225,6 +227,75 @@ void testConfigurationFileIsCreated() {\n \n         assertThat(cruiseControlConfigurationFileContent, not(nullValue()));\n     }\n+\n+    @Order(6)\n+    @Test\n+    void testConfigurationPerformanceOptions() throws IOException {\n+        Container cruiseControlContainer = null;\n+        EnvVar cruiseControlConfiguration = null;\n+\n+        Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n+        Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+\n+        KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n+\n+            LOGGER.info(\"Changing cruise control performance tuning options\");\n+\n+            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n+                    .addToConfig(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue())\n+                    .addToConfig(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue())\n+                    .addToConfig(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue())\n+                    .addToConfig(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                            CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue())", "originalCommit": "edc64a3c2836050e8cd34400f0a9024ff6266851", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "34d188f315eed21feb6e22158b9b2b929b78f6e9", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\nindex 3a8830e816..244e7a1b36 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\n@@ -292,8 +302,14 @@ public class CruiseControlConfigurationST extends AbstractST {\n                 CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n                 CruiseControlServerParameters.REPLICATION_THROTTLE.getName()\n         );\n+\n+        LOGGER.info(\"Verifying Cruise control configuration keys changes\");\n+        IsIterableContainingInAnyOrder.containsInAnyOrder(containerConfiguration.stringPropertyNames(),\n+                hasItems(checkCCProperties));\n+\n+        LOGGER.info(\"Verifying Cruise control configuration default value changes\");\n         for (String propertyName : checkCCProperties) {\n-            assertThat(containerConfiguration.getProperty(propertyName), is(fileConfiguration.getProperty(propertyName)));\n+            assertThat(\"Check CC defined config values\", containerConfiguration.getProperty(propertyName), is(fileConfiguration.getProperty(propertyName)));\n         }\n     }\n     \n"}}, {"oid": "28b41ec01f34ba691813f46b9f9c8dd9d5a40f12", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/28b41ec01f34ba691813f46b9f9c8dd9d5a40f12", "message": "NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-07-30T11:05:12Z", "type": "forcePushed"}, {"oid": "f5b5a17cd617cd38c7dccec58e878bb4941f380b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f5b5a17cd617cd38c7dccec58e878bb4941f380b", "message": "NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-07-30T11:21:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5MzY3OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r463193679", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                CruiseControlServerParameters(String name, Object defaulValue) {\n          \n          \n            \n                CruiseControlServerParameters(String name, Object defaultValue) {", "author": "samuel-hawker", "createdAt": "2020-07-30T18:34:30Z", "path": "operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+public enum CruiseControlServerParameters {\n+\n+    CONCURRENT_PARTITION_MOVEMENTS(\"num.concurrent.partition.movements.per.broker\", 5),\n+    CONCURRENT_INTRA_PARTITION_MOVEMENTS(\"num.concurrent.intra.broker.partition.movements\", 2),\n+    CONCURRENT_LEADER_MOVEMENTS(\"num.concurrent.leader.movements\", 1000),\n+    REPLICATION_THROTTLE(\"default.replication.throttle\", -1),\n+    BROKER_METRICS_WINDOWS(\"num.broker.metrics.windows\", \"20\"),\n+    BROKER_METRICS_WINDOW_MS(\"broker.metrics.window.ms\", Integer.toString(300_000)),\n+    PARTITION_METRICS_WINDOWS(\"num.partition.metrics.windows\", \"1\"),\n+    PARTITION_METRICS_WINDOW_MS(\"partition.metrics.window.ms\", Integer.toString(300_000)),\n+    COMPLETED_USER_TASK_RETENTION_MS(\"completed.user.task.retention.time.ms\", Long.toString(TimeUnit.DAYS.toMillis(1))),\n+    // TODO io/strimzi/operator/cluster/model/CruiseControlConfiguration.java:101\n+    GOALS(\"goals\", xxx),\n+    DEFAULT_GOALS(\"default.goals\", XXX);\n+\n+    private final String name;\n+    private final Object defaultValue;\n+\n+    CruiseControlServerParameters(String name, Object defaulValue) {", "originalCommit": "f5b5a17cd617cd38c7dccec58e878bb4941f380b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1OTkzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r464959933", "bodyText": "Fixed", "author": "michalxo", "createdAt": "2020-08-04T10:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5MzY3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "34d188f315eed21feb6e22158b9b2b929b78f6e9", "chunk": "diff --git a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java\nindex 43665a55c7..9a5b2932a8 100644\n--- a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java\n+++ b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java\n\n@@ -4,6 +4,7 @@ import java.util.concurrent.TimeUnit;\n \n public enum CruiseControlServerParameters {\n \n+    // 'goals' and 'default.goals' are currently not defined, due to unnecessary dependency pulling for now\n     CONCURRENT_PARTITION_MOVEMENTS(\"num.concurrent.partition.movements.per.broker\", 5),\n     CONCURRENT_INTRA_PARTITION_MOVEMENTS(\"num.concurrent.intra.broker.partition.movements\", 2),\n     CONCURRENT_LEADER_MOVEMENTS(\"num.concurrent.leader.movements\", 1000),\n"}}, {"oid": "34d188f315eed21feb6e22158b9b2b929b78f6e9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/34d188f315eed21feb6e22158b9b2b929b78f6e9", "message": "fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-04T11:04:01Z", "type": "forcePushed"}, {"oid": "83cdcfd109e2bd2cc2ca6371fa5085ee95e0bc11", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/83cdcfd109e2bd2cc2ca6371fa5085ee95e0bc11", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-04T11:23:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM1MjM4MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r465352381", "bodyText": "Because you're not using assertThat I think this doesn't error if it doesnt match. I also recommend you static import the matches to reduce the length of the line.", "author": "samuel-hawker", "createdAt": "2020-08-04T21:55:14Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java", "diffHunk": "@@ -225,6 +237,81 @@ void testConfigurationFileIsCreated() {\n \n         assertThat(cruiseControlConfigurationFileContent, not(nullValue()));\n     }\n+\n+    @Order(6)\n+    @Test\n+    void testConfigurationPerformanceOptions() throws IOException {\n+        Container cruiseControlContainer = null;\n+        EnvVar cruiseControlConfiguration = null;\n+\n+        Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n+        Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+\n+        KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n+\n+            LOGGER.info(\"Changing cruise control performance tuning options\");\n+\n+            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n+                    .addToConfig(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue())\n+                    .addToConfig(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue())\n+                    .addToConfig(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue())\n+                    .addToConfig(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                            CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue())\n+                .build();\n+\n+            kafka.getSpec().setCruiseControl(cruiseControl);\n+        });\n+\n+        LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n+        DeploymentUtils.waitTillDepHasRolled(CruiseControlResources.deploymentName(CLUSTER_NAME), 1, cruiseControlSnapShot);\n+\n+        LOGGER.info(\"Verifying that Kafka pods did not roll\");\n+        StatefulSetUtils.waitForNoRollingUpdate(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME), kafkaSnapShot);\n+\n+        LOGGER.info(\"Verifying new configuration in the Kafka CR\");\n+        Pod cruiseControlPod = kubeClient().listPodsByPrefixInName(CRUISE_CONTROL_POD_PREFIX).get(0);\n+        String cruiseControlPodName = cruiseControlPod.getMetadata().getName();\n+\n+        // Get CruiseControl resource properties\n+        for (Container container : cruiseControlPod.getSpec().getContainers()) {\n+            if (container.getName().equals(\"cruise-control\")) {\n+                cruiseControlContainer = container;\n+            }\n+        }\n+        for (EnvVar envVar : Objects.requireNonNull(cruiseControlContainer).getEnv()) {\n+            if (envVar.getName().equals(\"CRUISE_CONTROL_CONFIGURATION\")) {\n+                cruiseControlConfiguration = envVar;\n+            }\n+        }\n+        InputStream configurationContainerStream = new ByteArrayInputStream(Objects.requireNonNull(cruiseControlConfiguration).getValue().getBytes(StandardCharsets.UTF_8));\n+        Properties containerConfiguration = new Properties();\n+        containerConfiguration.load(configurationContainerStream);\n+\n+        String configurationFileContent = cmdKubeClient().execInPod(cruiseControlPodName, \"/bin/bash\", \"-c\", \"cat \" + CRUISE_CONTROL_CONFIGURATION_FILE_PATH).out();\n+        InputStream configurationFileStream = new ByteArrayInputStream(configurationFileContent.getBytes(StandardCharsets.UTF_8));\n+        Properties fileConfiguration = new Properties();\n+        fileConfiguration.load(configurationFileStream);\n+\n+        LOGGER.info(\"Verifying Cruise control performance options are set in Kafka CR\");\n+        List<String> checkCCProperties = Arrays.asList(\n+                CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                CruiseControlServerParameters.REPLICATION_THROTTLE.getName()\n+        );\n+\n+        LOGGER.info(\"Verifying Cruise control configuration keys changes\");\n+        IsIterableContainingInAnyOrder.containsInAnyOrder(containerConfiguration.stringPropertyNames(),", "originalCommit": "83cdcfd109e2bd2cc2ca6371fa5085ee95e0bc11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyMTM1NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r465621355", "bodyText": "Fixed by simplifying this whole part. Thank you for looking at it. I hope now it's better and simpler. :)", "author": "michalxo", "createdAt": "2020-08-05T10:14:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM1MjM4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "40ffc3e6ba6c520bd79873cf3c33b9a3212fd705", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\nindex 244e7a1b36..bf3092449b 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\n@@ -246,20 +246,23 @@ public class CruiseControlConfigurationST extends AbstractST {\n \n         Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n         Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+        Map<String, Object> performanceTuningOpts = ImmutableMap.<String, Object>builder()\n+                .put(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue())\n+                .put(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue())\n+                .put(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                            CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue())\n+                .put(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                            CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue())\n+                .build();\n \n         KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n \n             LOGGER.info(\"Changing cruise control performance tuning options\");\n \n             CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n-                    .addToConfig(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n-                            CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue())\n-                    .addToConfig(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n-                            CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue())\n-                    .addToConfig(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n-                            CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue())\n-                    .addToConfig(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n-                            CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue())\n+                    .addToConfig(performanceTuningOpts)\n                 .build();\n \n             kafka.getSpec().setCruiseControl(cruiseControl);\n"}}, {"oid": "40ffc3e6ba6c520bd79873cf3c33b9a3212fd705", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/40ffc3e6ba6c520bd79873cf3c33b9a3212fd705", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-05T10:11:43Z", "type": "forcePushed"}, {"oid": "07c649a34868b8f9e489564b54637698601455dc", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/07c649a34868b8f9e489564b54637698601455dc", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-05T10:15:24Z", "type": "forcePushed"}, {"oid": "f8f912b6b424aa080ecb25810795104b10b27538", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8f912b6b424aa080ecb25810795104b10b27538", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-05T10:20:26Z", "type": "forcePushed"}, {"oid": "cb85a173aaa290cef2abb7d3a6f7ce33610762d4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/cb85a173aaa290cef2abb7d3a6f7ce33610762d4", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-05T10:25:19Z", "type": "forcePushed"}, {"oid": "a43c806e68e665273b7c468aad5f140f6cc13ea7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a43c806e68e665273b7c468aad5f140f6cc13ea7", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-05T10:50:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ3MzU0MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467473540", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n          \n          \n            \n            \n          \n          \n            \n                        LOGGER.info(\"Changing cruise control performance tuning options\");\n          \n          \n            \n            \n          \n          \n            \n                        CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n          \n          \n            \n                                .addToConfig(performanceTuningOpts).build();\n          \n          \n            \n            \n          \n          \n            \n                        kafka.getSpec().setCruiseControl(cruiseControl);\n          \n          \n            \n                    });\n          \n          \n            \n                    KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n          \n          \n            \n                    \n          \n          \n            \n                        LOGGER.info(\"Changing cruise control performance tuning options\");\n          \n          \n            \n                        kafka = KafkaBuilder(kafka)\n          \n          \n            \n                            .editSpec()\n          \n          \n            \n                              .editCruiseControl()\n          \n          \n            \n                                .addToConfig(performanceTuningOpts)\n          \n          \n            \n                              .endCruiseControl()\n          \n          \n            \n                            .endSpec()\n          \n          \n            \n                            .build\n          \n          \n            \n                    });\n          \n      \n    \n    \n  \n\nI haven't ran this locally so unsure if it actually works, but this would be slightly more readable and guarantees the prior cruiseControl configuration is not lost (as we are not doing a replace but an edit)", "author": "samuel-hawker", "createdAt": "2020-08-08T15:07:19Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java", "diffHunk": "@@ -226,6 +236,65 @@ void testConfigurationFileIsCreated() {\n \n         assertThat(cruiseControlConfigurationFileContent, not(nullValue()));\n     }\n+\n+    @Order(6)\n+    @Test\n+    void testConfigurationPerformanceOptions() throws IOException {\n+        Container cruiseControlContainer = null;\n+        EnvVar cruiseControlConfiguration = null;\n+\n+        Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n+        Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+        Map<String, Object> performanceTuningOpts = new HashMap<String, Object>() {{\n+                put(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                    CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue());\n+            }};\n+\n+        KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n+\n+            LOGGER.info(\"Changing cruise control performance tuning options\");\n+\n+            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts).build();\n+\n+            kafka.getSpec().setCruiseControl(cruiseControl);\n+        });", "originalCommit": "a43c806e68e665273b7c468aad5f140f6cc13ea7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzczMjU4NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467732585", "bodyText": "Ok, I will try this.", "author": "michalxo", "createdAt": "2020-08-10T07:37:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ3MzU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgzMDkwNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467830906", "bodyText": "I have tried it, and rolling update never happened. No idea why. I am going with:\nKafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n            LOGGER.info(\"Changing cruise control performance tuning options\");\n            kafka.getSpec().setCruiseControl(new CruiseControlSpecBuilder()\n                    .addToConfig(performanceTuningOpts)\n                    .build());\n        });", "author": "michalxo", "createdAt": "2020-08-10T11:05:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ3MzU0MA=="}], "type": "inlineReview", "revised_code": {"commit": "e0b1fa4aba531c715816a4d50d3d466f41d0d36b", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\nindex 69b93d6672..420cc4fa64 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\n@@ -257,13 +259,10 @@ public class CruiseControlConfigurationST extends AbstractST {\n             }};\n \n         KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n-\n             LOGGER.info(\"Changing cruise control performance tuning options\");\n-\n-            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n-                    .addToConfig(performanceTuningOpts).build();\n-\n-            kafka.getSpec().setCruiseControl(cruiseControl);\n+            kafka.getSpec().setCruiseControl(new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts)\n+                    .build());\n         });\n \n         LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ3Mzg2OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467473868", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (Container container : cruiseControlPod.getSpec().getContainers()) {\n          \n          \n            \n                        if (container.getName().equals(\"cruise-control\")) {\n          \n          \n            \n                            cruiseControlContainer = container;\n          \n          \n            \n                        }\n          \n          \n            \n                    }\n          \n          \n            \n                    cruiseControlContainer = cruiseControlPod.getSpec().getContainers().stream()\n          \n          \n            \n                      .filter(container -> container.getName().equals(CruiseControl.CRUISE_CONTROL_CONTAINER_NAME))\n          \n          \n            \n                      .findFirst().orElse(null)", "author": "samuel-hawker", "createdAt": "2020-08-08T15:10:13Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java", "diffHunk": "@@ -226,6 +236,65 @@ void testConfigurationFileIsCreated() {\n \n         assertThat(cruiseControlConfigurationFileContent, not(nullValue()));\n     }\n+\n+    @Order(6)\n+    @Test\n+    void testConfigurationPerformanceOptions() throws IOException {\n+        Container cruiseControlContainer = null;\n+        EnvVar cruiseControlConfiguration = null;\n+\n+        Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n+        Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+        Map<String, Object> performanceTuningOpts = new HashMap<String, Object>() {{\n+                put(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                    CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue());\n+            }};\n+\n+        KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n+\n+            LOGGER.info(\"Changing cruise control performance tuning options\");\n+\n+            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts).build();\n+\n+            kafka.getSpec().setCruiseControl(cruiseControl);\n+        });\n+\n+        LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n+        DeploymentUtils.waitTillDepHasRolled(CruiseControlResources.deploymentName(CLUSTER_NAME), 1, cruiseControlSnapShot);\n+\n+        LOGGER.info(\"Verifying that Kafka pods did not roll\");\n+        StatefulSetUtils.waitForNoRollingUpdate(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME), kafkaSnapShot);\n+\n+        LOGGER.info(\"Verifying new configuration in the Kafka CR\");\n+        Pod cruiseControlPod = kubeClient().listPodsByPrefixInName(CRUISE_CONTROL_POD_PREFIX).get(0);\n+\n+        // Get CruiseControl resource properties\n+        for (Container container : cruiseControlPod.getSpec().getContainers()) {\n+            if (container.getName().equals(\"cruise-control\")) {\n+                cruiseControlContainer = container;\n+            }\n+        }", "originalCommit": "a43c806e68e665273b7c468aad5f140f6cc13ea7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0b1fa4aba531c715816a4d50d3d466f41d0d36b", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\nindex 69b93d6672..420cc4fa64 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\n@@ -257,13 +259,10 @@ public class CruiseControlConfigurationST extends AbstractST {\n             }};\n \n         KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n-\n             LOGGER.info(\"Changing cruise control performance tuning options\");\n-\n-            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n-                    .addToConfig(performanceTuningOpts).build();\n-\n-            kafka.getSpec().setCruiseControl(cruiseControl);\n+            kafka.getSpec().setCruiseControl(new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts)\n+                    .build());\n         });\n \n         LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ3NDAxOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467474019", "bodyText": "Use a similar filter here", "author": "samuel-hawker", "createdAt": "2020-08-08T15:11:50Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java", "diffHunk": "@@ -226,6 +236,65 @@ void testConfigurationFileIsCreated() {\n \n         assertThat(cruiseControlConfigurationFileContent, not(nullValue()));\n     }\n+\n+    @Order(6)\n+    @Test\n+    void testConfigurationPerformanceOptions() throws IOException {\n+        Container cruiseControlContainer = null;\n+        EnvVar cruiseControlConfiguration = null;\n+\n+        Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n+        Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+        Map<String, Object> performanceTuningOpts = new HashMap<String, Object>() {{\n+                put(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                    CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue());\n+            }};\n+\n+        KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n+\n+            LOGGER.info(\"Changing cruise control performance tuning options\");\n+\n+            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts).build();\n+\n+            kafka.getSpec().setCruiseControl(cruiseControl);\n+        });\n+\n+        LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n+        DeploymentUtils.waitTillDepHasRolled(CruiseControlResources.deploymentName(CLUSTER_NAME), 1, cruiseControlSnapShot);\n+\n+        LOGGER.info(\"Verifying that Kafka pods did not roll\");\n+        StatefulSetUtils.waitForNoRollingUpdate(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME), kafkaSnapShot);\n+\n+        LOGGER.info(\"Verifying new configuration in the Kafka CR\");\n+        Pod cruiseControlPod = kubeClient().listPodsByPrefixInName(CRUISE_CONTROL_POD_PREFIX).get(0);\n+\n+        // Get CruiseControl resource properties\n+        for (Container container : cruiseControlPod.getSpec().getContainers()) {\n+            if (container.getName().equals(\"cruise-control\")) {\n+                cruiseControlContainer = container;\n+            }\n+        }\n+        for (EnvVar envVar : Objects.requireNonNull(cruiseControlContainer).getEnv()) {", "originalCommit": "a43c806e68e665273b7c468aad5f140f6cc13ea7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0b1fa4aba531c715816a4d50d3d466f41d0d36b", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\nindex 69b93d6672..420cc4fa64 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\n@@ -257,13 +259,10 @@ public class CruiseControlConfigurationST extends AbstractST {\n             }};\n \n         KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n-\n             LOGGER.info(\"Changing cruise control performance tuning options\");\n-\n-            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n-                    .addToConfig(performanceTuningOpts).build();\n-\n-            kafka.getSpec().setCruiseControl(cruiseControl);\n+            kafka.getSpec().setCruiseControl(new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts)\n+                    .build());\n         });\n \n         LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ3NDA2NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467474064", "bodyText": "rm comment", "author": "samuel-hawker", "createdAt": "2020-08-08T15:12:24Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java", "diffHunk": "@@ -226,6 +236,65 @@ void testConfigurationFileIsCreated() {\n \n         assertThat(cruiseControlConfigurationFileContent, not(nullValue()));\n     }\n+\n+    @Order(6)\n+    @Test\n+    void testConfigurationPerformanceOptions() throws IOException {\n+        Container cruiseControlContainer = null;\n+        EnvVar cruiseControlConfiguration = null;\n+\n+        Map<String, String> kafkaSnapShot = StatefulSetUtils.ssSnapshot(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME));\n+        Map<String, String> cruiseControlSnapShot = DeploymentUtils.depSnapshot(CruiseControlResources.deploymentName(CLUSTER_NAME));\n+        Map<String, Object> performanceTuningOpts = new HashMap<String, Object>() {{\n+                put(CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_INTRA_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_PARTITION_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getName(),\n+                    CruiseControlServerParameters.CONCURRENT_LEADER_MOVEMENTS.getDefaultValue());\n+                put(CruiseControlServerParameters.REPLICATION_THROTTLE.getName(),\n+                    CruiseControlServerParameters.REPLICATION_THROTTLE.getDefaultValue());\n+            }};\n+\n+        KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n+\n+            LOGGER.info(\"Changing cruise control performance tuning options\");\n+\n+            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts).build();\n+\n+            kafka.getSpec().setCruiseControl(cruiseControl);\n+        });\n+\n+        LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n+        DeploymentUtils.waitTillDepHasRolled(CruiseControlResources.deploymentName(CLUSTER_NAME), 1, cruiseControlSnapShot);\n+\n+        LOGGER.info(\"Verifying that Kafka pods did not roll\");\n+        StatefulSetUtils.waitForNoRollingUpdate(KafkaResources.kafkaStatefulSetName(CLUSTER_NAME), kafkaSnapShot);\n+\n+        LOGGER.info(\"Verifying new configuration in the Kafka CR\");\n+        Pod cruiseControlPod = kubeClient().listPodsByPrefixInName(CRUISE_CONTROL_POD_PREFIX).get(0);\n+\n+        // Get CruiseControl resource properties\n+        for (Container container : cruiseControlPod.getSpec().getContainers()) {\n+            if (container.getName().equals(\"cruise-control\")) {\n+                cruiseControlContainer = container;\n+            }\n+        }\n+        for (EnvVar envVar : Objects.requireNonNull(cruiseControlContainer).getEnv()) {\n+            if (envVar.getName().equals(\"CRUISE_CONTROL_CONFIGURATION\")) {\n+                cruiseControlConfiguration = envVar;\n+            }\n+        }\n+        InputStream configurationContainerStream = new ByteArrayInputStream(Objects.requireNonNull(cruiseControlConfiguration).getValue().getBytes(StandardCharsets.UTF_8));\n+        Properties containerConfiguration = new Properties();\n+        containerConfiguration.load(configurationContainerStream);\n+\n+        LOGGER.info(\"Verifying Cruise control performance options are set in Kafka CR\");\n+//        Map<String, String> tmpContainerConfigMap = Maps.fromProperties(containerConfiguration);", "originalCommit": "a43c806e68e665273b7c468aad5f140f6cc13ea7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0b1fa4aba531c715816a4d50d3d466f41d0d36b", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\nindex 69b93d6672..420cc4fa64 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\n@@ -257,13 +259,10 @@ public class CruiseControlConfigurationST extends AbstractST {\n             }};\n \n         KafkaResource.replaceKafkaResource(CLUSTER_NAME, kafka -> {\n-\n             LOGGER.info(\"Changing cruise control performance tuning options\");\n-\n-            CruiseControlSpec cruiseControl = new CruiseControlSpecBuilder()\n-                    .addToConfig(performanceTuningOpts).build();\n-\n-            kafka.getSpec().setCruiseControl(cruiseControl);\n+            kafka.getSpec().setCruiseControl(new CruiseControlSpecBuilder()\n+                    .addToConfig(performanceTuningOpts)\n+                    .build());\n         });\n \n         LOGGER.info(\"Verifying that CC pod is rolling, after changing options\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NTczMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467785730", "bodyText": "As we have a CruiseControlServerParameters enum and these values are server configs I think I would make sense to put move these to that enum so there is a single source of truth for these Keys. Otherwise we now have to manage these in two places?", "author": "tomncooper", "createdAt": "2020-08-10T09:28:03Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java", "diffHunk": "@@ -79,6 +79,11 @@\n     public static final String CRUISE_CONTROL_HARD_GOALS_CONFIG_KEY = \"hard.goals\";\n     public static final String CRUISE_CONTROL_SELF_HEALING_CONFIG_KEY = \"self.healing.goals\";\n     public static final String CRUISE_CONTROL_ANOMALY_DETECTION_CONFIG_KEY = \"anomaly.detection.goals\";\n+    public static final String CRUISE_CONTROL_PARTITION_METRICS_WINDOW_MS_CONFIG_KEY = \"partition.metrics.window.ms\";\n+    public static final String CRUISE_CONTROL_PARTITION_METRICS_WINDOW_NUM_CONFIG_KEY = \"num.partition.metrics.windows\";\n+    public static final String CRUISE_CONTROL_BROKER_METRICS_WINDOW_MS_CONFIG_KEY = \"broker.metrics.window.ms\";\n+    public static final String CRUISE_CONTROL_BROKER_METRICS_WINDOW_NUM_CONFIG_KEY = \"num.broker.metrics.windows\";\n+    public static final String CRUISE_CONTROL_COMPLETED_USER_TASK_RETENTION_MS_CONFIG_KEY = \"completed.user.task.retention.time.ms\";", "originalCommit": "a43c806e68e665273b7c468aad5f140f6cc13ea7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NzE0MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467787141", "bodyText": "I am very happy to move them there. I will dig out their default values as well.\nAlso, just those 4 vars, or more?", "author": "michalxo", "createdAt": "2020-08-10T09:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NTczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc5MDI1Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467790256", "bodyText": "Well ideally it would be all of them, you would have to move all the goals lists definitions as well and be careful to refactor all the tests that use those lists.\n@ppatierno wdyt about making the CruiseControlServerParameters enum the single source of truth for the CC server config keys and their defaults? Or should we just use the enum for the key names and define the defaults in the CruiseControlConfiguration class?", "author": "tomncooper", "createdAt": "2020-08-10T09:36:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NTczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg5MTE5NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467891194", "bodyText": "I am fine to move everything there.", "author": "ppatierno", "createdAt": "2020-08-10T13:10:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NTczMA=="}], "type": "inlineReview", "revised_code": {"commit": "d80ddfa65916412695d70673a693b475812b6941", "chunk": "diff --git a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java\nindex fd02678a2f..f7e0314c93 100644\n--- a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java\n+++ b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java\n\n@@ -79,12 +80,6 @@ public class CruiseControlConfiguration extends AbstractConfiguration {\n     public static final String CRUISE_CONTROL_HARD_GOALS_CONFIG_KEY = \"hard.goals\";\n     public static final String CRUISE_CONTROL_SELF_HEALING_CONFIG_KEY = \"self.healing.goals\";\n     public static final String CRUISE_CONTROL_ANOMALY_DETECTION_CONFIG_KEY = \"anomaly.detection.goals\";\n-    public static final String CRUISE_CONTROL_PARTITION_METRICS_WINDOW_MS_CONFIG_KEY = \"partition.metrics.window.ms\";\n-    public static final String CRUISE_CONTROL_PARTITION_METRICS_WINDOW_NUM_CONFIG_KEY = \"num.partition.metrics.windows\";\n-    public static final String CRUISE_CONTROL_BROKER_METRICS_WINDOW_MS_CONFIG_KEY = \"broker.metrics.window.ms\";\n-    public static final String CRUISE_CONTROL_BROKER_METRICS_WINDOW_NUM_CONFIG_KEY = \"num.broker.metrics.windows\";\n-    public static final String CRUISE_CONTROL_COMPLETED_USER_TASK_RETENTION_MS_CONFIG_KEY = \"completed.user.task.retention.time.ms\";\n-\n    /*\n     * Map containing default values for required configuration properties\n     */\n"}}, {"oid": "e0b1fa4aba531c715816a4d50d3d466f41d0d36b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e0b1fa4aba531c715816a4d50d3d466f41d0d36b", "message": "fixup! fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts", "committedDate": "2020-08-10T11:08:57Z", "type": "forcePushed"}, {"oid": "47505523fa86aa3a519a6f20af02cc3b299d7825", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/47505523fa86aa3a519a6f20af02cc3b299d7825", "message": "fixup! fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-10T11:09:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg5MTU2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467891567", "bodyText": "can we change in CruiseControlConfigurationParameters? wdyt @tomncooper ?", "author": "ppatierno", "createdAt": "2020-08-10T13:10:58Z", "path": "operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+public enum CruiseControlServerParameters {", "originalCommit": "47505523fa86aa3a519a6f20af02cc3b299d7825", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkxNDQ2NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467914464", "bodyText": "Agreed. That is a better name.", "author": "tomncooper", "createdAt": "2020-08-10T13:46:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg5MTU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5NDYwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r468094601", "bodyText": "Resolved", "author": "michalxo", "createdAt": "2020-08-10T18:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg5MTU2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "d80ddfa65916412695d70673a693b475812b6941", "chunk": "diff --git a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\nsimilarity index 61%\nrename from operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java\nrename to operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\nindex 1215756f11..d14a58ab51 100644\n--- a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlServerParameters.java\n+++ b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\n\n@@ -6,7 +6,7 @@ package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n \n import java.util.concurrent.TimeUnit;\n \n-public enum CruiseControlServerParameters {\n+public enum CruiseControlConfigurationParameters {\n \n     // 'goals' and 'default.goals' are currently not defined, due to unnecessary dependency pulling for now\n     CONCURRENT_PARTITION_MOVEMENTS(\"num.concurrent.partition.movements.per.broker\", 5),\n"}}, {"oid": "d80ddfa65916412695d70673a693b475812b6941", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d80ddfa65916412695d70673a693b475812b6941", "message": "REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-10T14:50:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3MzkwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467973900", "bodyText": "We could move the default goal list definitions into this class as well? WDYT @ppatierno?", "author": "tomncooper", "createdAt": "2020-08-10T15:12:00Z", "path": "operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+public enum CruiseControlConfigurationParameters {\n+\n+    // 'goals' and 'default.goals' are currently not defined, due to unnecessary dependency pulling for now", "originalCommit": "d80ddfa65916412695d70673a693b475812b6941", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e19995248adb14d2d60c7bfdda2372c0ca6efe24", "chunk": "diff --git a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\nindex d14a58ab51..6109179b6b 100644\n--- a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\n+++ b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\n\n@@ -41,7 +41,7 @@ public enum CruiseControlConfigurationParameters {\n     }\n \n     @Override\n-    public String toString(){\n+    public String toString() {\n         return name;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3NDk1Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467974953", "bodyText": "Even if you define the list in this class you can still move the key to the Enum and just leave the default value as null? We want to avoid having these config keys defined in two places.", "author": "tomncooper", "createdAt": "2020-08-10T15:13:38Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java", "diffHunk": "@@ -79,7 +80,6 @@\n     public static final String CRUISE_CONTROL_HARD_GOALS_CONFIG_KEY = \"hard.goals\";", "originalCommit": "d80ddfa65916412695d70673a693b475812b6941", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5NTE2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r468095162", "bodyText": "I can but it looked a bit weird to my eyes, as it has no value and it is just a config key without value :/", "author": "michalxo", "createdAt": "2020-08-10T18:25:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3NDk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODM1ODMxOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r468358319", "bodyText": "I added it there, with making default value as empty string, as all those default values are joined list of String goals.\nWould you prefer null instead as default value?", "author": "michalxo", "createdAt": "2020-08-11T06:39:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3NDk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIxMzEyOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r469213128", "bodyText": "I still think it feel wrong to have the CC defaults defined in 2 places. I think you should move the goal list definitions into the Enum too (as that is where all the other definitions are made, but then that makes the class a bit messy. WDYT @ppatierno?", "author": "tomncooper", "createdAt": "2020-08-12T12:15:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3NDk1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "7277fdd09556792ce078d58003f6abeb27813404", "chunk": "diff --git a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java\nindex f7e0314c93..0381960311 100644\n--- a/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java\n+++ b/cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java\n\n@@ -66,21 +66,16 @@ public class CruiseControlConfiguration extends AbstractConfiguration {\n \n     protected static final List<String> CRUISE_CONTROL_DEFAULT_ANOMALY_DETECTION_GOALS_LIST = Collections.unmodifiableList(\n         Arrays.asList(\n-                CruiseControlConfigurationGoals.RACK_AWARENESS_GOAL.toString(),\n-                CruiseControlConfigurationGoals.REPLICA_CAPACITY_GOAL.toString(),\n-                CruiseControlConfigurationGoals.DISK_CAPACITY_GOAL.toString()\n+                CruiseControlGoals.RACK_AWARENESS_GOAL.toString(),\n+                CruiseControlGoals.REPLICA_CAPACITY_GOAL.toString(),\n+                CruiseControlGoals.DISK_CAPACITY_GOAL.toString()\n         )\n     );\n \n     public static final String CRUISE_CONTROL_DEFAULT_ANOMALY_DETECTION_GOALS =\n             String.join(\",\", CRUISE_CONTROL_DEFAULT_ANOMALY_DETECTION_GOALS_LIST);\n \n-    public static final String CRUISE_CONTROL_GOALS_CONFIG_KEY = \"goals\";\n-    public static final String CRUISE_CONTROL_DEFAULT_GOALS_CONFIG_KEY = \"default.goals\";\n-    public static final String CRUISE_CONTROL_HARD_GOALS_CONFIG_KEY = \"hard.goals\";\n-    public static final String CRUISE_CONTROL_SELF_HEALING_CONFIG_KEY = \"self.healing.goals\";\n-    public static final String CRUISE_CONTROL_ANOMALY_DETECTION_CONFIG_KEY = \"anomaly.detection.goals\";\n-   /*\n+    /*\n     * Map containing default values for required configuration properties\n     */\n     private static final Map<String, String> CRUISE_CONTROL_DEFAULT_PROPERTIES_MAP;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3NTYwMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r467975602", "bodyText": "I would just call this CruiseControlGoals", "author": "tomncooper", "createdAt": "2020-08-10T15:14:37Z", "path": "operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationGoals.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n+\n+public enum CruiseControlConfigurationGoals {", "originalCommit": "d80ddfa65916412695d70673a693b475812b6941", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5NTIyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r468095226", "bodyText": "fixed", "author": "michalxo", "createdAt": "2020-08-10T18:25:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3NTYwMg=="}], "type": "inlineReview", "revised_code": {"commit": "e19995248adb14d2d60c7bfdda2372c0ca6efe24", "chunk": "diff --git a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationGoals.java b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlGoals.java\nsimilarity index 94%\nrename from operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationGoals.java\nrename to operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlGoals.java\nindex f849472195..a91149906a 100644\n--- a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationGoals.java\n+++ b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlGoals.java\n\n@@ -4,7 +4,7 @@\n  */\n package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n \n-public enum CruiseControlConfigurationGoals {\n+public enum CruiseControlGoals {\n \n     RACK_AWARENESS_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal\"),\n     REPLICA_CAPACITY_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal\"),\n"}}, {"oid": "e19995248adb14d2d60c7bfdda2372c0ca6efe24", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e19995248adb14d2d60c7bfdda2372c0ca6efe24", "message": "fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-10T19:14:54Z", "type": "forcePushed"}, {"oid": "7277fdd09556792ce078d58003f6abeb27813404", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7277fdd09556792ce078d58003f6abeb27813404", "message": "fixup! fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-11T07:04:50Z", "type": "forcePushed"}, {"oid": "10a663ec5464763163edd08d15cad49d7a7c0d37", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/10a663ec5464763163edd08d15cad49d7a7c0d37", "message": "FIX(Typo) Minor typo in defaultClusterOperator\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "589c4daa0af2830c2b23053800ecb7face78e312", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/589c4daa0af2830c2b23053800ecb7face78e312", "message": "NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "28221fae9124fbde64ec0505ab78884b874ec397", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/28221fae9124fbde64ec0505ab78884b874ec397", "message": "fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "41ca0e75ee80ef102fbb18ec205df7f53d203461", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/41ca0e75ee80ef102fbb18ec205df7f53d203461", "message": "fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "6afdda5e322cb73b0b74a02d0118207e56c21fc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6afdda5e322cb73b0b74a02d0118207e56c21fc2", "message": "fixup! fixup! fixup! NEW(Tests) Added test for CruiseControl perf tuning opts\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "b3c91bd2f2dc3bc435cd184fc2cc972da61107a1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b3c91bd2f2dc3bc435cd184fc2cc972da61107a1", "message": "REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "9d3a1ff00ff896fc6a2253a536790052eb7072cd", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9d3a1ff00ff896fc6a2253a536790052eb7072cd", "message": "fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "03def3c2f767e5145f9f29ef417f441a46c1c49e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/03def3c2f767e5145f9f29ef417f441a46c1c49e", "message": "fixup! fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:10:09Z", "type": "commit"}, {"oid": "c92b56995bd9a2ef6b3d664f446c960051f12fff", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c92b56995bd9a2ef6b3d664f446c960051f12fff", "message": "fixup! fixup! fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:58:22Z", "type": "commit"}, {"oid": "c92b56995bd9a2ef6b3d664f446c960051f12fff", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c92b56995bd9a2ef6b3d664f446c960051f12fff", "message": "fixup! fixup! fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-13T07:58:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0Mzk5Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r469843993", "bodyText": "I think the goals made sense as a separate enum, they are not really config parameter keys but rather values assigned to the keys. However, that might be being too picky.", "author": "tomncooper", "createdAt": "2020-08-13T10:08:42Z", "path": "operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.operator.cluster.operator.resource.cruisecontrol;\n+\n+public enum CruiseControlConfigurationParameters {\n+\n+    CONCURRENT_PARTITION_MOVEMENTS(\"num.concurrent.partition.movements.per.broker\"),\n+    CONCURRENT_INTRA_PARTITION_MOVEMENTS(\"num.concurrent.intra.broker.partition.movements\"),\n+    CONCURRENT_LEADER_MOVEMENTS(\"num.concurrent.leader.movements\"),\n+    REPLICATION_THROTTLE(\"default.replication.throttle\"),\n+    BROKER_METRICS_WINDOWS(\"num.broker.metrics.windows\"),\n+    BROKER_METRICS_WINDOW_MS(\"broker.metrics.window.ms\"),\n+    PARTITION_METRICS_WINDOWS(\"num.partition.metrics.windows\"),\n+    PARTITION_METRICS_WINDOW_MS(\"partition.metrics.window.ms\"),\n+    COMPLETED_USER_TASK_RETENTION_MS(\"completed.user.task.retention.time.ms\"),\n+    CRUISE_CONTROL_PARTITION_METRICS_WINDOW_MS_CONFIG_KEY(\"partition.metrics.window.ms\"),\n+    CRUISE_CONTROL_PARTITION_METRICS_WINDOW_NUM_CONFIG_KEY(\"num.partition.metrics.windows\"),\n+    CRUISE_CONTROL_BROKER_METRICS_WINDOW_MS_CONFIG_KEY(\"broker.metrics.window.ms\"),\n+    CRUISE_CONTROL_BROKER_METRICS_WINDOW_NUM_CONFIG_KEY(\"num.broker.metrics.windows\"),\n+    CRUISE_CONTROL_COMPLETED_USER_TASK_RETENTION_MS_CONFIG_KEY(\"completed.user.task.retention.time.ms\"),\n+\n+    // Goals String lists\n+    CRUISE_CONTROL_GOALS_CONFIG_KEY(\"goals\"),\n+    CRUISE_CONTROL_DEFAULT_GOALS_CONFIG_KEY(\"default.goals\"),\n+    CRUISE_CONTROL_HARD_GOALS_CONFIG_KEY(\"hard.goals\"),\n+    CRUISE_CONTROL_SELF_HEALING_CONFIG_KEY(\"self.healing.goals\"),\n+    CRUISE_CONTROL_ANOMALY_DETECTION_CONFIG_KEY(\"anomaly.detection.goals\"),\n+\n+    RACK_AWARENESS_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal\"),", "originalCommit": "c92b56995bd9a2ef6b3d664f446c960051f12fff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0OTU2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3414#discussion_r469849569", "bodyText": "ok, I can move them back. I thought it's logical to keep it all under 1 separate Enum (CC configs :) )", "author": "michalxo", "createdAt": "2020-08-13T10:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0Mzk5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b5cdc23585a7fe2cbe77a337c5abf8d5f4ab2dfb", "chunk": "diff --git a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\nindex c44f663329..50801c437a 100644\n--- a/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\n+++ b/operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlConfigurationParameters.java\n\n@@ -26,24 +26,7 @@ public enum CruiseControlConfigurationParameters {\n     CRUISE_CONTROL_DEFAULT_GOALS_CONFIG_KEY(\"default.goals\"),\n     CRUISE_CONTROL_HARD_GOALS_CONFIG_KEY(\"hard.goals\"),\n     CRUISE_CONTROL_SELF_HEALING_CONFIG_KEY(\"self.healing.goals\"),\n-    CRUISE_CONTROL_ANOMALY_DETECTION_CONFIG_KEY(\"anomaly.detection.goals\"),\n-\n-    RACK_AWARENESS_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal\"),\n-    REPLICA_CAPACITY_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal\"),\n-    DISK_CAPACITY_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.DiskCapacityGoal\"),\n-    NETWORK_INBOUND_CAPACITY_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundCapacityGoal\"),\n-    NETWORK_OUTBOUND_CAPACITY_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundCapacityGoal\"),\n-    CPU_CAPACITY_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.CpuCapacityGoal\"),\n-    REPLICA_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaDistributionGoal\"),\n-    POTENTIAL_NETWORK_OUTAGE_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.PotentialNwOutGoal\"),\n-    DISK_USAGE_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.DiskUsageDistributionGoal\"),\n-    NETWORK_INBOUND_USAGE_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundUsageDistributionGoal\"),\n-    NETWORK_OUTBOUND_USAGE_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundUsageDistributionGoal\"),\n-    CPU_USAGE_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.CpuUsageDistributionGoal\"),\n-    TOPIC_REPLICA_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.TopicReplicaDistributionGoal\"),\n-    LEADER_REPLICA_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.LeaderReplicaDistributionGoal\"),\n-    LEADER_BYTES_IN_DISTRIBUTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.LeaderBytesInDistributionGoal\"),\n-    PREFERRED_LEADER_ELECTION_GOAL(\"com.linkedin.kafka.cruisecontrol.analyzer.goals.PreferredLeaderElectionGoal\");\n+    CRUISE_CONTROL_ANOMALY_DETECTION_CONFIG_KEY(\"anomaly.detection.goals\");\n \n     private final String name;\n \n"}}, {"oid": "b5cdc23585a7fe2cbe77a337c5abf8d5f4ab2dfb", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b5cdc23585a7fe2cbe77a337c5abf8d5f4ab2dfb", "message": "fixup! fixup! fixup! fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-17T06:43:00Z", "type": "commit"}, {"oid": "b5cdc23585a7fe2cbe77a337c5abf8d5f4ab2dfb", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b5cdc23585a7fe2cbe77a337c5abf8d5f4ab2dfb", "message": "fixup! fixup! fixup! fixup! REF(CC) Goals and Config options refactor\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-17T06:43:00Z", "type": "forcePushed"}]}