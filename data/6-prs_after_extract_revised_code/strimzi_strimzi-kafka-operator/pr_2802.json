{"pr_number": 2802, "pr_title": "[MO] - [clients] -> removing future + solving issue with vertx", "pr_createdAt": "2020-04-07T15:41:33Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2802", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2NTI3MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2802#discussion_r405065270", "bodyText": "Do we still need the TODO?", "author": "scholzj", "createdAt": "2020-04-07T19:40:43Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/externalClients/Consumer.java", "diffHunk": "@@ -13,8 +14,8 @@\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.function.IntPredicate;\n \n-\n-public class Consumer extends ClientHandlerBase<Integer> {\n+// TODO: autocloseable to close vertx always...", "originalCommit": "050815acd53e9a899f745452239a72aeef360c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQxOTE5Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2802#discussion_r405419197", "bodyText": "No, we do not. I will remove it ;)", "author": "see-quick", "createdAt": "2020-04-08T10:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2NTI3MA=="}], "type": "inlineReview", "revised_code": {"commit": "7c8cefe4c7df2c28f3fcbf77b12ec0888b7ce15c", "chunk": "diff --git a/systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/externalClients/Consumer.java b/systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/externalClients/Consumer.java\nindex 28441aabf7..ebb3bf2eec 100644\n--- a/systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/externalClients/Consumer.java\n+++ b/systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/externalClients/Consumer.java\n\n@@ -14,7 +14,6 @@ import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.function.IntPredicate;\n \n-// TODO: autocloseable to close vertx always...\n public class Consumer extends ClientHandlerBase<Integer> implements AutoCloseable {\n     private static final Logger LOGGER = LogManager.getLogger(Consumer.class);\n     private KafkaClientProperties properties;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI4Mjg4MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2802#discussion_r405282880", "bodyText": "can we remove these lines?", "author": "ppatierno", "createdAt": "2020-04-08T06:19:00Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1290,11 +1286,11 @@ void testNodePortTls() throws Exception {\n                 .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n                 .build();\n \n-        Future<Integer> producer = basicExternalKafkaClient.sendMessagesTls();\n-        Future<Integer> consumer = basicExternalKafkaClient.receiveMessagesTls();\n-\n-        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n-        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+//        Future<Integer> producer = basicExternalKafkaClient.sendMessagesTls();\n+//        Future<Integer> consumer = basicExternalKafkaClient.receiveMessagesTls();\n+//\n+//        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+//        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));", "originalCommit": "050815acd53e9a899f745452239a72aeef360c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQyMzcyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2802#discussion_r405423726", "bodyText": "yeah, good point!!", "author": "see-quick", "createdAt": "2020-04-08T10:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI4Mjg4MA=="}], "type": "inlineReview", "revised_code": {"commit": "7c8cefe4c7df2c28f3fcbf77b12ec0888b7ce15c", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java b/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\nindex f2e0ffa220..d91e46bada 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\n\n@@ -1286,17 +1285,16 @@ class KafkaST extends BaseST {\n                 .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n                 .build();\n \n-//        Future<Integer> producer = basicExternalKafkaClient.sendMessagesTls();\n-//        Future<Integer> consumer = basicExternalKafkaClient.receiveMessagesTls();\n-//\n-//        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n-//        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+        basicExternalKafkaClient.verifyProducedAndConsumedMessages(\n+            basicExternalKafkaClient.sendMessagesTls(),\n+            basicExternalKafkaClient.receiveMessagesTls()\n+        );\n     }\n \n     @Test\n     @Tag(LOADBALANCER_SUPPORTED)\n     @Tag(EXTERNAL_CLIENTS_USED)\n-    void testLoadBalancer() throws Exception {\n+    void testLoadBalancer() {\n         KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n             .editSpec()\n                 .editKafka()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI4Mjk0MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2802#discussion_r405282940", "bodyText": "ditto as above?", "author": "ppatierno", "createdAt": "2020-04-08T06:19:08Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1324,11 +1320,11 @@ void testLoadBalancer() throws Exception {\n                 .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n                 .build();\n \n-        Future<Integer> producer = basicExternalKafkaClient.sendMessagesPlain();\n-        Future<Integer> consumer = basicExternalKafkaClient.receiveMessagesPlain();\n-\n-        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n-        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+//        Future<Integer> producer = basicExternalKafkaClient.sendMessagesPlain();\n+//        Future<Integer> consumer = basicExternalKafkaClient.receiveMessagesPlain();\n+//\n+//        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+//        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));", "originalCommit": "050815acd53e9a899f745452239a72aeef360c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7c8cefe4c7df2c28f3fcbf77b12ec0888b7ce15c", "chunk": "diff --git a/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java b/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\nindex f2e0ffa220..d91e46bada 100644\n--- a/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\n+++ b/systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java\n\n@@ -1320,18 +1318,17 @@ class KafkaST extends BaseST {\n                 .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n                 .build();\n \n-//        Future<Integer> producer = basicExternalKafkaClient.sendMessagesPlain();\n-//        Future<Integer> consumer = basicExternalKafkaClient.receiveMessagesPlain();\n-//\n-//        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n-//        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+        basicExternalKafkaClient.verifyProducedAndConsumedMessages(\n+            basicExternalKafkaClient.sendMessagesPlain(),\n+            basicExternalKafkaClient.receiveMessagesPlain()\n+        );\n     }\n \n     @Test\n     @Tag(ACCEPTANCE)\n     @Tag(LOADBALANCER_SUPPORTED)\n     @Tag(EXTERNAL_CLIENTS_USED)\n-    void testLoadBalancerTls() throws Exception {\n+    void testLoadBalancerTls() {\n         KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n             .editSpec()\n                 .editKafka()\n"}}, {"oid": "709e7242628732abdcdae6e4a929c01b811865ae", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/709e7242628732abdcdae6e4a929c01b811865ae", "message": "[MO] - [clients] -> removing future + solving issue with vertx\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-04-08T11:16:00Z", "type": "commit"}, {"oid": "6a8a8a3eefde91c4ba993662a026138edaf91798", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6a8a8a3eefde91c4ba993662a026138edaf91798", "message": "[MO] -[fix] -> fix\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-04-08T11:16:00Z", "type": "commit"}, {"oid": "7c8cefe4c7df2c28f3fcbf77b12ec0888b7ce15c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7c8cefe4c7df2c28f3fcbf77b12ec0888b7ce15c", "message": "[MO] - [refactor] -> jakub commends\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-04-08T11:16:00Z", "type": "commit"}, {"oid": "f8f7be9ffce8aad546b50ce90e77783e282fc6be", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8f7be9ffce8aad546b50ce90e77783e282fc6be", "message": "[MO] - [refactor] -> removing instance\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-04-08T11:16:00Z", "type": "commit"}, {"oid": "f8f7be9ffce8aad546b50ce90e77783e282fc6be", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8f7be9ffce8aad546b50ce90e77783e282fc6be", "message": "[MO] - [refactor] -> removing instance\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-04-08T11:16:00Z", "type": "forcePushed"}, {"oid": "336fa2a5100a7dab3aa660bc379ef282f40210bb", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/336fa2a5100a7dab3aa660bc379ef282f40210bb", "message": "[MO] - [oauth] -> removing\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-04-08T11:16:53Z", "type": "commit"}]}