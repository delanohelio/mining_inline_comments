{"pr_number": 8626, "pr_title": "MULE-18030: HttpPolicyPointcutParameters, only use the headers if a", "pr_createdAt": "2020-02-04T17:35:32Z", "pr_url": "https://github.com/mulesoft/mule/pull/8626", "timeline": [{"oid": "a34d222b3ef2cf6368d8bab5aaab151e0f3014fe", "url": "https://github.com/mulesoft/mule/commit/a34d222b3ef2cf6368d8bab5aaab151e0f3014fe", "message": "MULE-18030: HttpPolicyPointcutParameters, only use the headers if a\npointcut actually needs them", "committedDate": "2020-02-04T17:28:29Z", "type": "commit"}, {"oid": "72429c52a6bd353e07832cf87bcc87ec3ef62eeb", "url": "https://github.com/mulesoft/mule/commit/72429c52a6bd353e07832cf87bcc87ec3ef62eeb", "message": "review", "committedDate": "2020-02-04T18:44:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwNDgxMQ==", "url": "https://github.com/mulesoft/mule/pull/8626#discussion_r374904811", "bodyText": "This is coupling HTTP to the policy engine. It should probably be in http-policy-api", "author": "balbifm", "createdAt": "2020-02-04T20:28:04Z", "path": "core/src/main/java/org/mule/runtime/core/api/policy/PolicyProvider.java", "diffHunk": "@@ -29,6 +29,22 @@\n    */\n   List<Policy> findSourceParameterizedPolicies(PolicyPointcutParameters policyPointcutParameters);\n \n+  /**\n+   * @return {@code true} if there is at least one source policy applied that relies on the headers to check for the pointcut\n+   *         match.\n+   *\n+   * @since 4.3\n+   */\n+  boolean isAnySourcePolicyHeadersAware();", "originalCommit": "72429c52a6bd353e07832cf87bcc87ec3ef62eeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIzNTMxMQ==", "url": "https://github.com/mulesoft/mule/pull/8626#discussion_r375235311", "bodyText": "yep, fixed", "author": "elrodro83", "createdAt": "2020-02-05T12:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwNDgxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "f8374bfcf00bb435c2daa055d313cb0850958fc8", "chunk": "diff --git a/core/src/main/java/org/mule/runtime/core/api/policy/PolicyProvider.java b/core/src/main/java/org/mule/runtime/core/api/policy/PolicyProvider.java\nindex a464a024467..949ad01e9b1 100644\n--- a/core/src/main/java/org/mule/runtime/core/api/policy/PolicyProvider.java\n+++ b/core/src/main/java/org/mule/runtime/core/api/policy/PolicyProvider.java\n\n@@ -30,20 +32,11 @@ public interface PolicyProvider {\n   List<Policy> findSourceParameterizedPolicies(PolicyPointcutParameters policyPointcutParameters);\n \n   /**\n-   * @return {@code true} if there is at least one source policy applied that relies on the headers to check for the pointcut\n-   *         match.\n+   * @return The attributes that are required by the pointcuts of the currently deployed policies.\n    *\n    * @since 4.3\n    */\n-  boolean isAnySourcePolicyHeadersAware();\n-\n-  /**\n-   * @return {@code true} if there is at least one source policy applied that relies on the request path to check for the pointcut\n-   *         match.\n-   *\n-   * @since 4.3\n-   */\n-  boolean isAnySourcePolicyPathAware();\n+  Set<PolicyAwareAttribute> sourcePolicyAwareAtributes();\n \n   /**\n    * Creates a collection of {@link Policy} with the policy chain be applied to an operation.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwNTY0Mg==", "url": "https://github.com/mulesoft/mule/pull/8626#discussion_r374905642", "bodyText": "I got lost, where is this used?", "author": "balbifm", "createdAt": "2020-02-04T20:29:56Z", "path": "core/src/main/java/org/mule/runtime/core/internal/policy/DefaultPolicyManager.java", "diffHunk": "@@ -200,6 +200,11 @@ public SourcePolicy createSourcePolicyInstance(Component source, CoreEvent sourc\n     return sourcePolicy;\n   }\n \n+  @Override\n+  public boolean isAnySourcePolicyHeadersAware() {", "originalCommit": "72429c52a6bd353e07832cf87bcc87ec3ef62eeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIzNTI3Mw==", "url": "https://github.com/mulesoft/mule/pull/8626#discussion_r375235273", "bodyText": "removed this", "author": "elrodro83", "createdAt": "2020-02-05T12:48:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwNTY0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f8374bfcf00bb435c2daa055d313cb0850958fc8", "chunk": "diff --git a/core/src/main/java/org/mule/runtime/core/internal/policy/DefaultPolicyManager.java b/core/src/main/java/org/mule/runtime/core/internal/policy/DefaultPolicyManager.java\nindex d2189365e79..0f44b30bcb5 100644\n--- a/core/src/main/java/org/mule/runtime/core/internal/policy/DefaultPolicyManager.java\n+++ b/core/src/main/java/org/mule/runtime/core/internal/policy/DefaultPolicyManager.java\n\n@@ -200,11 +200,6 @@ public class DefaultPolicyManager implements PolicyManager, Lifecycle {\n     return sourcePolicy;\n   }\n \n-  @Override\n-  public boolean isAnySourcePolicyHeadersAware() {\n-    return policyProvider.isAnySourcePolicyHeadersAware();\n-  }\n-\n   @Override\n   public PolicyPointcutParameters addSourcePointcutParametersIntoEvent(Component source, TypedValue<?> attributes,\n                                                                        InternalEvent event) {\n"}}, {"oid": "f8374bfcf00bb435c2daa055d313cb0850958fc8", "url": "https://github.com/mulesoft/mule/commit/f8374bfcf00bb435c2daa055d313cb0850958fc8", "message": "review", "committedDate": "2020-02-05T02:00:18Z", "type": "commit"}, {"oid": "f6b3e9e0476a087c0fb3c068dcf033bb80b74821", "url": "https://github.com/mulesoft/mule/commit/f6b3e9e0476a087c0fb3c068dcf033bb80b74821", "message": "fix typo", "committedDate": "2020-02-05T12:48:17Z", "type": "commit"}, {"oid": "9797cadb46154d81be207178c706305bdb20b90e", "url": "https://github.com/mulesoft/mule/commit/9797cadb46154d81be207178c706305bdb20b90e", "message": "non breaking api", "committedDate": "2020-02-05T15:30:16Z", "type": "commit"}]}