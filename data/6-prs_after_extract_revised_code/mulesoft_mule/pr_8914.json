{"pr_number": 8914, "pr_title": "MULE-18375: Working fix", "pr_createdAt": "2020-06-11T01:49:26Z", "pr_url": "https://github.com/mulesoft/mule/pull/8914", "timeline": [{"oid": "fbfef4371f578924a487aef2274af982acd336b9", "url": "https://github.com/mulesoft/mule/commit/fbfef4371f578924a487aef2274af982acd336b9", "message": "Add @since", "committedDate": "2020-06-11T10:53:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MzM2Ng==", "url": "https://github.com/mulesoft/mule/pull/8914#discussion_r438943366", "bodyText": "comment", "author": "marianogonzalez", "createdAt": "2020-06-11T17:15:04Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java", "diffHunk": "@@ -154,6 +156,18 @@\n   protected ExecutionMediator executionMediator;\n   protected ComponentExecutor componentExecutor;\n   protected ReturnDelegate returnDelegate;\n+  /**", "originalCommit": "524e0ed9fd2946d6cf7ba1315f9b44cc1fcd80b0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "de1d641d5398298fc5d9a35a4fcfb8cac026e3e2", "chunk": "diff --git a/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java b/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java\nindex 67d0ceefbe9..db3d7e877ff 100644\n--- a/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java\n+++ b/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java\n\n@@ -156,16 +156,14 @@ public abstract class ComponentMessageProcessor<T extends ComponentModel> extend\n   protected ExecutionMediator executionMediator;\n   protected ComponentExecutor componentExecutor;\n   protected ReturnDelegate returnDelegate;\n-  /**\n-   * MULE-18375: When a policy is applied to an operation that has defined a target, it's necessary to wait until the policy\n+  /*\n+   * TODO: MULE-18483 When a policy is applied to an operation that has defined a target, it's necessary to wait until the policy\n    * finishes to calculate the return value with {@link #returnDelegate}. But in this case, because of in order to execute the\n-   * rest of the policy we need to transform the {@link Result} returned by the operation into a {@link CoreEvent}, we use\n-   * {@link #valueReturnDelegate} as a helper class to do this transformation. It's used only when there is an operation that\n-   * defines a target, and at the same time, there are operation policies applied to it. Finally, when the policy finishes, the\n-   * proper {@link #returnDelegate} is executed.\n-   * <p>\n-   * It's an horrible solution, we only need a piece of code that transforms an {@link Object} into a {@link CoreEvent} and not a\n-   * {@link ReturnDelegate} .\n+   * rest of the policy we need to transform the {@link Result} returned by the operation into a {@link CoreEvent}, we use {@link\n+   * #valueReturnDelegate} as a helper class to do this transformation. It's used only when there is an operation that defines a\n+   * target, and at the same time, there are operation policies applied to it. Finally, when the policy finishes, the proper\n+   * {@link #returnDelegate} is executed. It'd be ideal to improve this by extracting from {@link ReturnDelegate} the logic\n+   * that transforms an {@link Object} into a {@link CoreEvent}.\n    */\n   private ReturnDelegate valueReturnDelegate;\n   protected PolicyManager policyManager;\n"}}, {"oid": "5eeb219ec0604c94af3d8a9f780794d8decd034a", "url": "https://github.com/mulesoft/mule/commit/5eeb219ec0604c94af3d8a9f780794d8decd034a", "message": "MULE-18375: OperationPolicy behaving unexpectedly when operation has target", "committedDate": "2020-06-11T20:26:18Z", "type": "commit"}, {"oid": "4712def71422f4fbadbedf4f573e2bb6c6c39410", "url": "https://github.com/mulesoft/mule/commit/4712def71422f4fbadbedf4f573e2bb6c6c39410", "message": "Add @since", "committedDate": "2020-06-11T20:26:18Z", "type": "commit"}, {"oid": "1fcf892b32148ad98659186eb6088bd8c73a0224", "url": "https://github.com/mulesoft/mule/commit/1fcf892b32148ad98659186eb6088bd8c73a0224", "message": "Add error handling logic", "committedDate": "2020-06-11T20:26:18Z", "type": "commit"}, {"oid": "de1d641d5398298fc5d9a35a4fcfb8cac026e3e2", "url": "https://github.com/mulesoft/mule/commit/de1d641d5398298fc5d9a35a4fcfb8cac026e3e2", "message": "Clarify TODO", "committedDate": "2020-06-11T20:26:18Z", "type": "commit"}, {"oid": "de1d641d5398298fc5d9a35a4fcfb8cac026e3e2", "url": "https://github.com/mulesoft/mule/commit/de1d641d5398298fc5d9a35a4fcfb8cac026e3e2", "message": "Clarify TODO", "committedDate": "2020-06-11T20:26:18Z", "type": "forcePushed"}]}