{"pr_number": 9745, "pr_title": "MULE-18906-4.3.x: Watermark in polling sources is updated when source is stopping. ", "pr_createdAt": "2020-11-18T14:32:27Z", "pr_url": "https://github.com/mulesoft/mule/pull/9745", "timeline": [{"oid": "ae5c0922e2ef1e9579f463397927fbecd4355fd6", "url": "https://github.com/mulesoft/mule/commit/ae5c0922e2ef1e9579f463397927fbecd4355fd6", "message": "MULE-18906: Watermark in polling sources is updated when source is stopping. (#9736)", "committedDate": "2020-11-18T14:14:49Z", "type": "commit"}, {"oid": "7729839b3b771208a8514be90197804779779940", "url": "https://github.com/mulesoft/mule/commit/7729839b3b771208a8514be90197804779779940", "message": "formatter", "committedDate": "2020-11-18T16:44:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIxNTY4MA==", "url": "https://github.com/mulesoft/mule/pull/9745#discussion_r527215680", "bodyText": "We should remove the other call to this method.", "author": "ndinu", "createdAt": "2020-11-19T21:36:27Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/poll/PollingSourceWrapper.java", "diffHunk": "@@ -254,7 +256,9 @@ public PollItemStatus accept(Consumer<PollItem<T, A>> consumer) {\n       pollItem.validate();\n \n       PollItemStatus status;\n-      if (!acquireItem(pollItem, callbackContext)) {\n+      if (isRequestedToStop()) {", "originalCommit": "7729839b3b771208a8514be90197804779779940", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI2MDE3MA==", "url": "https://github.com/mulesoft/mule/pull/9745#discussion_r527260170", "bodyText": "nice catch. thanks.", "author": "SebaElizalde", "createdAt": "2020-11-19T22:57:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIxNTY4MA=="}], "type": "inlineReview", "revised_code": {"commit": "810c55566899abad4a71828894ef4ce6cd9a40de", "chunk": "diff --git a/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/poll/PollingSourceWrapper.java b/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/poll/PollingSourceWrapper.java\nindex 83eab849a88..77fd3c3fb06 100644\n--- a/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/poll/PollingSourceWrapper.java\n+++ b/modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/poll/PollingSourceWrapper.java\n\n@@ -262,8 +262,6 @@ public class PollingSourceWrapper<T, A> extends SourceWrapper<T, A> implements R\n         status = ALREADY_IN_PROCESS;\n       } else if (!passesWatermark(pollItem)) {\n         status = FILTERED_BY_WATERMARK;\n-      } else if (isRequestedToStop()) {\n-        status = SOURCE_STOPPING;\n       } else {\n         sourceCallback.handle(pollItem.getResult(), callbackContext);\n         status = ACCEPTED;\n"}}, {"oid": "810c55566899abad4a71828894ef4ce6cd9a40de", "url": "https://github.com/mulesoft/mule/commit/810c55566899abad4a71828894ef4ce6cd9a40de", "message": "pr review", "committedDate": "2020-11-19T23:17:11Z", "type": "commit"}]}