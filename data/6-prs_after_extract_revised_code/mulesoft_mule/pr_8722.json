{"pr_number": 8722, "pr_title": "EE-7188: Mule license checker is not writing to STDERR", "pr_createdAt": "2020-03-10T12:30:48Z", "pr_url": "https://github.com/mulesoft/mule/pull/8722", "timeline": [{"oid": "2783af647455c409f203384f79e02810f7062c16", "url": "https://github.com/mulesoft/mule/commit/2783af647455c409f203384f79e02810f7062c16", "message": "EE-7188: Mule license checker is not writing to STDERR", "committedDate": "2020-03-10T12:14:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDg1OQ==", "url": "https://github.com/mulesoft/mule/pull/8722#discussion_r391170859", "bodyText": "this is effectively the same as reverting MULE-15508", "author": "marianogonzalez", "createdAt": "2020-03-11T18:15:51Z", "path": "modules/launcher/src/main/java/org/mule/runtime/module/launcher/MuleContainer.java", "diffHunk": "@@ -96,6 +96,9 @@\n   private static MuleLog4jContextFactory log4jContextFactory;\n \n   static {\n+    // Before doing any further action, we need to check for a valid license\n+    validateLicense();", "originalCommit": "2783af647455c409f203384f79e02810f7062c16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5NTAxOQ==", "url": "https://github.com/mulesoft/mule/pull/8722#discussion_r391195019", "bodyText": "The reason because I changed this behaviour was that if we call validateLicense() from MuleContainer::start, when MuleContainer is instanced, artifactResourcesRegistry instance variable will be built, which indirectly calls MuleEmbeddedLicenseCheck.checkLicense(); because of the aspect defined in LicenseCheckAspect.aj.\nIn short, the validation will happen earlier in another place, and the error message will be a RuntimeException.\nWe could defer the validateLicense() invocation until the MuleContainer constructor, but it still will block the start of the runtime until the validation finishes.  What do you think?", "author": "szaffarano", "createdAt": "2020-03-11T18:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDg1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "1b7d64bddbb24d03eab9ce05fe050536e10b0e60", "chunk": "diff --git a/modules/launcher/src/main/java/org/mule/runtime/module/launcher/MuleContainer.java b/modules/launcher/src/main/java/org/mule/runtime/module/launcher/MuleContainer.java\nindex 86e0eb38eac..c6c3dfb7c67 100755\n--- a/modules/launcher/src/main/java/org/mule/runtime/module/launcher/MuleContainer.java\n+++ b/modules/launcher/src/main/java/org/mule/runtime/module/launcher/MuleContainer.java\n\n@@ -96,9 +96,6 @@ public class MuleContainer {\n   private static MuleLog4jContextFactory log4jContextFactory;\n \n   static {\n-    // Before doing any further action, we need to check for a valid license\n-    validateLicense();\n-\n     if (getProperty(MULE_SIMPLE_LOG) == null) {\n       // We need to force the creation of a logger before we can change the manager factory.\n       // This is because if not, any logger that will be acquired by MuleLog4jContextFactory code\n"}}, {"oid": "505689514537a20a579d3e943c7c81bd16db856e", "url": "https://github.com/mulesoft/mule/commit/505689514537a20a579d3e943c7c81bd16db856e", "message": "Revert change because of a change of aproach", "committedDate": "2020-03-12T12:45:38Z", "type": "commit"}, {"oid": "45e412d2a89cee03f97c703d0c9632d342a77aea", "url": "https://github.com/mulesoft/mule/commit/45e412d2a89cee03f97c703d0c9632d342a77aea", "message": "Print stacktrace using tanuki logging", "committedDate": "2020-03-12T13:03:34Z", "type": "commit"}, {"oid": "1b7d64bddbb24d03eab9ce05fe050536e10b0e60", "url": "https://github.com/mulesoft/mule/commit/1b7d64bddbb24d03eab9ce05fe050536e10b0e60", "message": "Fix reverted changes", "committedDate": "2020-03-12T13:14:10Z", "type": "commit"}, {"oid": "1b7d64bddbb24d03eab9ce05fe050536e10b0e60", "url": "https://github.com/mulesoft/mule/commit/1b7d64bddbb24d03eab9ce05fe050536e10b0e60", "message": "Fix reverted changes", "committedDate": "2020-03-12T13:14:10Z", "type": "forcePushed"}]}