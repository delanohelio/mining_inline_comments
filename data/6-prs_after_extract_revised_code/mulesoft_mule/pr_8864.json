{"pr_number": 8864, "pr_title": "MULE-18407: Remove `type` from ComponentModel", "pr_createdAt": "2020-05-14T21:31:18Z", "pr_url": "https://github.com/mulesoft/mule/pull/8864", "timeline": [{"oid": "a5f1f44f699e9abe4e74bc32c994e26571c0eff2", "url": "https://github.com/mulesoft/mule/commit/a5f1f44f699e9abe4e74bc32c994e26571c0eff2", "message": "MULE-18407: Remove `type` from ComponentModel", "committedDate": "2020-05-14T21:27:09Z", "type": "commit"}, {"oid": "e29ab7c90513cc7960e5d5a063ab693c1556371e", "url": "https://github.com/mulesoft/mule/commit/e29ab7c90513cc7960e5d5a063ab693c1556371e", "message": "sonar", "committedDate": "2020-05-18T12:42:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NTQzMQ==", "url": "https://github.com/mulesoft/mule/pull/8864#discussion_r426795431", "bodyText": "How did you do now with these cases? This was relying on the Type (class) to build the metadataTypeModelAdapter for the parameterAst... how does this work from now on?", "author": "gsfernandes", "createdAt": "2020-05-18T17:47:48Z", "path": "modules/spring-config/src/main/java/org/mule/runtime/config/internal/model/ComponentModel.java", "diffHunk": "@@ -485,530 +424,6 @@ public void setComponentType(TypedComponentIdentifier.ComponentType componentTyp\n     return empty();\n   }\n \n-  public void resolveTypedComponentIdentifier(ExtensionModelHelper extensionModelHelper, boolean runtimeMode) {\n-    executeOnComponentTree(this, componentModel -> {\n-      componentModel.doResolveTypedComponentIdentifier(extensionModelHelper, runtimeMode);\n-    });\n-  }\n-\n-  private void doResolveTypedComponentIdentifier(ExtensionModelHelper extensionModelHelper, boolean runtimeMode) {\n-    extensionModelHelper.walkToComponent(getIdentifier(), new ExtensionWalkerModelDelegate() {\n-\n-      @Override\n-      public void onConfiguration(ConfigurationModel model) {\n-        setConfigurationModel(model);\n-        onParameterizedModel(model);\n-      }\n-\n-      @Override\n-      public void onConnectionProvider(ConnectionProviderModel model) {\n-        setConnectionProviderModel(model);\n-        onParameterizedModel(model);\n-      }\n-\n-      @Override\n-      public void onOperation(OperationModel model) {\n-        setComponentModel(model);\n-        onParameterizedModel(model);\n-      }\n-\n-      @Override\n-      public void onSource(SourceModel model) {\n-        setComponentModel(model);\n-        onParameterizedModel(model);\n-      }\n-\n-      @Override\n-      public void onConstruct(ConstructModel model) {\n-        setComponentModel(model);\n-        onParameterizedModel(model);\n-      }\n-\n-      @Override\n-      public void onNestableElement(NestableElementModel model) {\n-        setNestableElementModel(model);\n-        if (model instanceof ParameterizedModel) {\n-          onParameterizedModel((ParameterizedModel) model);\n-        }\n-      }\n-\n-      private void onParameterizedModel(ParameterizedModel model) {\n-        if (runtimeMode) {\n-          handleNestedParametersWithoutPopulatingObjectTypes(ComponentModel.this, extensionModelHelper, model);\n-        } else {\n-          DslElementSyntax elementDsl = extensionModelHelper.resolveDslElementModel(model, getIdentifier());\n-          onParameterizedModel(elementDsl, model, parameterModel -> true);\n-        }\n-      }\n-\n-      private void onParameterizedModel(DslElementSyntax elementDsl, ParameterizedModel model,\n-                                        Predicate<ParameterModel> parameterModelFilter) {\n-        Multimap<ComponentIdentifier, ComponentModel> nestedComponents = getNestedComponents(ComponentModel.this);\n-\n-        List<ParameterModel> inlineGroupedParameters = model.getParameterGroupModels().stream()\n-            .filter(ParameterGroupModel::isShowInDsl)\n-            .map(group -> addInlineGroup(elementDsl, nestedComponents, group, extensionModelHelper))\n-            .flatMap(g -> g.getParameterModels().stream())\n-            .collect(toList());\n-\n-        handleNestedParameters(ComponentModel.this, ComponentModel.this.directChildrenStream()\n-            .filter(childComp -> childComp != ComponentModel.this),\n-                               nestedComponents, extensionModelHelper,\n-                               model,\n-                               parameterModel -> parameterModelFilter.test(parameterModel)\n-                                   && !inlineGroupedParameters.contains(parameterModel));\n-      }\n-\n-    });\n-\n-    // Last resort to try to find a matching metadata type for this component\n-    if (!getModel(HasStereotypeModel.class).isPresent()) {\n-      extensionModelHelper.findMetadataType(getType())", "originalCommit": "e29ab7c90513cc7960e5d5a063ab693c1556371e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NzM2OQ==", "url": "https://github.com/mulesoft/mule/pull/8864#discussion_r426797369", "bodyText": "I moved this here: https://github.com/mulesoft/mule/pull/8864/files#diff-343feb8864aee8603a8a65aa05f549a3R162 (ApplicationModelTypeUtils.java line 162)", "author": "elrodro83", "createdAt": "2020-05-18T17:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NTQzMQ=="}], "type": "inlineReview", "revised_code": null}]}