{"pr_number": 8830, "pr_title": "MULE-18355: Avoid component location recalculation after xmlSdk1 macroexpansion", "pr_createdAt": "2020-04-28T16:28:59Z", "pr_url": "https://github.com/mulesoft/mule/pull/8830", "timeline": [{"oid": "9b40e33604aba1a85f8a4df89d335dea08274ff4", "url": "https://github.com/mulesoft/mule/commit/9b40e33604aba1a85f8a4df89d335dea08274ff4", "message": "MULE-18355: Avoid component location recalculation after xmlSdk1\nmacroexpansion", "committedDate": "2020-04-27T18:57:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3NzEwOA==", "url": "https://github.com/mulesoft/mule/pull/8830#discussion_r418177108", "bodyText": "If we don't resolveComponentTypes those componentAst will not be associated to a parameter model etc therefore it will not be able to call getParameterAst by the parsers.", "author": "gsfernandes", "createdAt": "2020-04-30T17:36:21Z", "path": "modules/spring-config/src/main/java/org/mule/runtime/config/internal/model/ApplicationModel.java", "diffHunk": "@@ -337,24 +337,22 @@ public ApplicationModel(ArtifactConfig artifactConfig, ArtifactDeclaration artif\n     topLevelComponentsStream()\n         .forEach(componentModel -> ((ComponentModel) componentModel).resolveTypedComponentIdentifier(extensionModelHelper,\n                                                                                                      runtimeMode));\n-    final ComponentLocationVisitor clv = new ComponentLocationVisitor();\n-    recursiveStreamWithHierarchy().forEach(clv);\n+    recursiveStreamWithHierarchy().forEach(new ComponentLocationVisitor());\n   }\n \n   public void macroExpandXmlSdkComponents(Set<ExtensionModel> extensionModels) {\n     expandModules(extensionModels, () -> {\n       // TODO MULE-13894 do this only on runtimeMode=true once unified extensionModel names to use camelCase (see smart connectors\n       // connectors and crafted declared extension models)\n+\n+      // TODO MULE-17419 (AST) Remove these 2 actions", "originalCommit": "9b40e33604aba1a85f8a4df89d335dea08274ff4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4NDAyNA==", "url": "https://github.com/mulesoft/mule/pull/8830#discussion_r418184024", "bodyText": "if those are already resolved for the AST of the smart connector definition, the idea is to keep and use them. In that case, there's no need to recalculate them here. That's one of the golas of the linked TODO.", "author": "elrodro83", "createdAt": "2020-04-30T17:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3NzEwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4NDgxOQ==", "url": "https://github.com/mulesoft/mule/pull/8830#discussion_r418184819", "bodyText": "\ud83d\udc4d", "author": "gsfernandes", "createdAt": "2020-04-30T17:49:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3NzEwOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3NzkxNw==", "url": "https://github.com/mulesoft/mule/pull/8830#discussion_r418177917", "bodyText": "static import", "author": "gsfernandes", "createdAt": "2020-04-30T17:37:40Z", "path": "modules/spring-config/src/test/java/org/mule/runtime/config/internal/factories/FlowRefFactoryBeanTestCase.java", "diffHunk": "@@ -262,7 +262,7 @@ public void dynamicFlowRefDoesNotExist() throws Exception {\n   private FlowRefFactoryBean createFlowRefFactoryBean(String name) throws Exception {\n     FlowRefFactoryBean flowRefFactoryBean = new FlowRefFactoryBean();\n     flowRefFactoryBean.setName(name);\n-    flowRefFactoryBean.setAnnotations(singletonMap(LOCATION_KEY, fromSingleComponent(\"flow\")));\n+    flowRefFactoryBean.setAnnotations(singletonMap(LOCATION_KEY, DefaultComponentLocation.from(\"flow\")));", "originalCommit": "9b40e33604aba1a85f8a4df89d335dea08274ff4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MzI1OQ==", "url": "https://github.com/mulesoft/mule/pull/8830#discussion_r418183259", "bodyText": "there's already Flux.from (or Mono.from, done really remember now) statically imported in this class", "author": "elrodro83", "createdAt": "2020-04-30T17:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3NzkxNw=="}], "type": "inlineReview", "revised_code": null}]}