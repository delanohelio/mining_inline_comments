{"pr_number": 3084, "pr_title": "check the value before putting to average key lengths map", "pr_createdAt": "2020-03-23T10:00:13Z", "pr_url": "https://github.com/oracle/opengrok/pull/3084", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0MzMxNg==", "url": "https://github.com/oracle/opengrok/pull/3084#discussion_r396343316", "bodyText": "I'd prefer the condition to check lookup.getCount() but that's not a big deal.", "author": "ahornace", "createdAt": "2020-03-23T10:19:23Z", "path": "suggester/src/main/java/org/opengrok/suggest/SuggesterProjectData.java", "diffHunk": "@@ -261,8 +261,10 @@ private WFSTCompletionLookup build(final IndexReader indexReader, final String f\n         WFSTCompletionLookup lookup = createWFST();\n         lookup.build(iterator);\n \n-        double averageLength = (double) iterator.termLengthAccumulator / lookup.getCount();\n-        averageLengths.put(field, averageLength);\n+        if (iterator.termLengthAccumulator > 0) {", "originalCommit": "a2dcc4a801dd7a4cc551ba27be66806bd71c6cff", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b7bfaec1104779973bbe6b77d3e0352419d6cc28", "chunk": "diff --git a/suggester/src/main/java/org/opengrok/suggest/SuggesterProjectData.java b/suggester/src/main/java/org/opengrok/suggest/SuggesterProjectData.java\nindex 180e475613..5e18a85fbf 100644\n--- a/suggester/src/main/java/org/opengrok/suggest/SuggesterProjectData.java\n+++ b/suggester/src/main/java/org/opengrok/suggest/SuggesterProjectData.java\n\n@@ -261,7 +261,7 @@ class SuggesterProjectData implements Closeable {\n         WFSTCompletionLookup lookup = createWFST();\n         lookup.build(iterator);\n \n-        if (iterator.termLengthAccumulator > 0) {\n+        if (lookup.getCount() > 0) {\n             double averageLength = (double) iterator.termLengthAccumulator / lookup.getCount();\n             averageLengths.put(field, averageLength);\n         }\n"}}, {"oid": "b7bfaec1104779973bbe6b77d3e0352419d6cc28", "url": "https://github.com/oracle/opengrok/commit/b7bfaec1104779973bbe6b77d3e0352419d6cc28", "message": "check the value before putting to average key lengths map", "committedDate": "2020-03-23T11:39:48Z", "type": "commit"}, {"oid": "8bdb39a44e9d0450cd1c681201ebc5fd9de26a64", "url": "https://github.com/oracle/opengrok/commit/8bdb39a44e9d0450cd1c681201ebc5fd9de26a64", "message": "catch IllegalArgumentException", "committedDate": "2020-03-23T11:39:48Z", "type": "commit"}, {"oid": "8bdb39a44e9d0450cd1c681201ebc5fd9de26a64", "url": "https://github.com/oracle/opengrok/commit/8bdb39a44e9d0450cd1c681201ebc5fd9de26a64", "message": "catch IllegalArgumentException", "committedDate": "2020-03-23T11:39:48Z", "type": "forcePushed"}]}