{"pr_number": 3317, "pr_title": "handle some exceptions related to path descriptions", "pr_createdAt": "2020-10-26T09:11:48Z", "pr_url": "https://github.com/oracle/opengrok/pull/3317", "timeline": [{"oid": "e573bb4ae074847089fbf838c502ac4b1058ed56", "url": "https://github.com/oracle/opengrok/commit/e573bb4ae074847089fbf838c502ac4b1058ed56", "message": "try with resources", "committedDate": "2020-10-26T08:58:43Z", "type": "commit"}, {"oid": "07eb0018b0bbd68e68a538ed2cf5dda9c9f79635", "url": "https://github.com/oracle/opengrok/commit/07eb0018b0bbd68e68a538ed2cf5dda9c9f79635", "message": "handle exceptions from EftarFileReader#getNode() in extraListTo()\n\nfixes #3316", "committedDate": "2020-10-26T08:59:14Z", "type": "commit"}, {"oid": "4e82dcfd66c4f44d7ea95750e0465af441a2a4cb", "url": "https://github.com/oracle/opengrok/commit/4e82dcfd66c4f44d7ea95750e0465af441a2a4cb", "message": "add test", "committedDate": "2020-10-26T09:19:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NDQzMw==", "url": "https://github.com/oracle/opengrok/pull/3317#discussion_r511994433", "bodyText": "The test looks weird without any assertion. It's not clear what is being tested. I'd definitely welcome a comment. I don't know of a nice way how to express in JUnit that the code should not throw an exception. I guess it's implied :D", "author": "ahornace", "createdAt": "2020-10-26T14:18:18Z", "path": "opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java", "diffHunk": "@@ -365,4 +373,14 @@ public void directoryListing() throws Exception {\n             validateEntry((Element) nl.item(i));\n         }\n     }\n+\n+    @Test\n+    public void directoryListingWithEftarException() throws IOException, HistoryException {", "originalCommit": "4e82dcfd66c4f44d7ea95750e0465af441a2a4cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAxNjAyMA==", "url": "https://github.com/oracle/opengrok/pull/3317#discussion_r512016020", "bodyText": "right. added verify()", "author": "vladak", "createdAt": "2020-10-26T14:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NDQzMw=="}], "type": "inlineReview", "revised_code": {"commit": "48964303d46940b6e9b20fb0ba71525dcdf3aba3", "chunk": "diff --git a/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java b/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java\nindex 18a7db011c..7df8fb4634 100644\n--- a/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java\n+++ b/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java\n\n@@ -380,7 +379,9 @@ public class DirectoryListingTest {\n         when(mockReader.getNode(anyString())).thenThrow(IOException.class);\n         DirectoryListing instance = new DirectoryListing(mockReader);\n         File file = new File(directory, \"foo\");\n-        instance.extraListTo(\"ctx\", directory, new StringWriter(), directory.getPath(),\n+        StringWriter mockWriter = spy(StringWriter.class);\n+        instance.extraListTo(\"ctx\", directory, mockWriter, directory.getPath(),\n                 Collections.singletonList(new DirectoryEntry(file)));\n+        verify(mockWriter, atLeast(1)). write(anyString());\n     }\n }\n"}}, {"oid": "48964303d46940b6e9b20fb0ba71525dcdf3aba3", "url": "https://github.com/oracle/opengrok/commit/48964303d46940b6e9b20fb0ba71525dcdf3aba3", "message": "add verify()", "committedDate": "2020-10-26T14:44:57Z", "type": "commit"}, {"oid": "932bd238d11b61b8e1e7cd3a9d966dc8487a2439", "url": "https://github.com/oracle/opengrok/commit/932bd238d11b61b8e1e7cd3a9d966dc8487a2439", "message": "bump the count", "committedDate": "2020-10-26T14:46:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAxODcyMQ==", "url": "https://github.com/oracle/opengrok/pull/3317#discussion_r512018721", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    verify(mockWriter, atLeast(20)). write(anyString());\n          \n          \n            \n                    verify(mockWriter, atLeast(20)).write(anyString());", "author": "ahornace", "createdAt": "2020-10-26T14:48:45Z", "path": "opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java", "diffHunk": "@@ -365,4 +372,16 @@ public void directoryListing() throws Exception {\n             validateEntry((Element) nl.item(i));\n         }\n     }\n+\n+    @Test\n+    public void directoryListingWithEftarException() throws IOException, HistoryException {\n+        EftarFileReader mockReader = mock(EftarFileReader.class);\n+        when(mockReader.getNode(anyString())).thenThrow(IOException.class);\n+        DirectoryListing instance = new DirectoryListing(mockReader);\n+        File file = new File(directory, \"foo\");\n+        StringWriter mockWriter = spy(StringWriter.class);\n+        instance.extraListTo(\"ctx\", directory, mockWriter, directory.getPath(),\n+                Collections.singletonList(new DirectoryEntry(file)));\n+        verify(mockWriter, atLeast(20)). write(anyString());", "originalCommit": "932bd238d11b61b8e1e7cd3a9d966dc8487a2439", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "659af3879560aee5b960d569a922423c2ca420e5", "chunk": "diff --git a/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java b/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java\nindex 95b82a7a84..58e6ba6b67 100644\n--- a/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java\n+++ b/opengrok-web/src/test/java/org/opengrok/web/DirectoryListingTest.java\n\n@@ -382,6 +382,6 @@ public class DirectoryListingTest {\n         StringWriter mockWriter = spy(StringWriter.class);\n         instance.extraListTo(\"ctx\", directory, mockWriter, directory.getPath(),\n                 Collections.singletonList(new DirectoryEntry(file)));\n-        verify(mockWriter, atLeast(20)). write(anyString());\n+        verify(mockWriter, atLeast(20)).write(anyString());\n     }\n }\n"}}, {"oid": "659af3879560aee5b960d569a922423c2ca420e5", "url": "https://github.com/oracle/opengrok/commit/659af3879560aee5b960d569a922423c2ca420e5", "message": "remove extra space", "committedDate": "2020-10-26T14:50:54Z", "type": "commit"}, {"oid": "e4724de3985dfdedddbf594a6a23fb53efe4f916", "url": "https://github.com/oracle/opengrok/commit/e4724de3985dfdedddbf594a6a23fb53efe4f916", "message": "avoid wildcard imports", "committedDate": "2020-10-26T14:53:07Z", "type": "commit"}]}