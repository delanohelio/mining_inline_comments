{"pr_number": 951, "pr_title": "Vsam config and helpers", "pr_createdAt": "2020-11-25T14:48:45Z", "pr_url": "https://github.com/zowe/api-layer/pull/951", "timeline": [{"oid": "11df48681547f426436010f58383f9c5beb57797", "url": "https://github.com/zowe/api-layer/commit/11df48681547f426436010f58383f9c5beb57797", "message": "Vsam config and helpers\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-11-25T14:48:19Z", "type": "commit"}, {"oid": "df216d1f0963fb23b79e8cd0c8ab2bba9dd141cb", "url": "https://github.com/zowe/api-layer/commit/df216d1f0963fb23b79e8cd0c8ab2bba9dd141cb", "message": "Merge branch 'master' into rip/GH863/partial-vsam-config-helpers", "committedDate": "2020-11-26T07:40:24Z", "type": "commit"}, {"oid": "76bd2b8a06406b64fe78f93f374eb1b7a5676fd7", "url": "https://github.com/zowe/api-layer/commit/76bd2b8a06406b64fe78f93f374eb1b7a5676fd7", "message": "Merge branch 'master' into rip/GH863/partial-vsam-config-helpers", "committedDate": "2020-11-26T09:40:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzMzk3MA==", "url": "https://github.com/zowe/api-layer/pull/951#discussion_r530933970", "bodyText": "Any reason why you didn't use this: StringUtils.rightPad()", "author": "balhar-jakub", "createdAt": "2020-11-26T10:39:47Z", "path": "caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\r\n+ * This program and the accompanying materials are made available under the terms of the\r\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\r\n+ * https://www.eclipse.org/legal/epl-v20.html\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *\r\n+ * Copyright Contributors to the Zowe Project.\r\n+ */\r\n+\r\n+package org.zowe.apiml.caching.service.vsam;\r\n+\r\n+import lombok.Getter;\r\n+import org.zowe.apiml.caching.config.VsamConfig;\r\n+import org.zowe.apiml.caching.model.KeyValue;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+\r\n+public class VsamKey {\r\n+\r\n+    private final VsamConfig config;\r\n+\r\n+    @Getter\r\n+    int keyLength;\r\n+\r\n+    public VsamKey(VsamConfig config) {\r\n+\r\n+        if (config.getKeyLength() < 23) {\r\n+            throw new IllegalArgumentException(\"VsamKey cannot have length smaller than 23 characters\");\r\n+        }\r\n+        this.config = config;\r\n+        this.keyLength = config.getKeyLength();\r\n+    }\r\n+\r\n+    @Override\r\n+    public String toString() {\r\n+        return \"vsamkey\";\r\n+    }\r\n+\r\n+    public String getKey(String serviceId, String key) {\r\n+        return VsamUtils.padToLength(serviceId.hashCode() + \":\" + key.hashCode(), keyLength);\r", "originalCommit": "76bd2b8a06406b64fe78f93f374eb1b7a5676fd7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "933b0a26cca21dc5c9f56c17a7dfc01ff1487db2", "chunk": "diff --git a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java\nindex f2b8cb87..f54f0d11 100644\n--- a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java\n+++ b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java\n\n@@ -16,6 +16,13 @@ import org.zowe.apiml.caching.model.KeyValue;\n \n import java.io.UnsupportedEncodingException;\n \n+\n+/**\n+ * Key for VSAM record\n+ * Composed of ServiceId hash : Record key hash\n+ *\n+ * Takes configuration from {@link VsamConfig}\n+ */\n public class VsamKey {\n \n     private final VsamConfig config;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzNDM1MQ==", "url": "https://github.com/zowe/api-layer/pull/951#discussion_r530934351", "bodyText": "I would delete it as there is the same functionality in the StringUtils in Apache Commons among others.", "author": "balhar-jakub", "createdAt": "2020-11-26T10:40:22Z", "path": "caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamUtils.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\r\n+ * This program and the accompanying materials are made available under the terms of the\r\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\r\n+ * https://www.eclipse.org/legal/epl-v20.html\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *\r\n+ * Copyright Contributors to the Zowe Project.\r\n+ */\r\n+\r\n+package org.zowe.apiml.caching.service.vsam;\r\n+import lombok.experimental.UtilityClass;\r\n+\r\n+@UtilityClass\r\n+public class VsamUtils {\r", "originalCommit": "76bd2b8a06406b64fe78f93f374eb1b7a5676fd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAwMTU5Mg==", "url": "https://github.com/zowe/api-layer/pull/951#discussion_r531001592", "bodyText": "Good point", "author": "jandadav", "createdAt": "2020-11-26T12:39:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzNDM1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "94eb5d43142f7131651e195e37ded2d9fde03cc3", "chunk": "diff --git a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamUtils.java b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamUtils.java\ndeleted file mode 100644\nindex 91da1f18..00000000\n--- a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamUtils.java\n+++ /dev/null\n\n@@ -1,26 +0,0 @@\n-/*\n- * This program and the accompanying materials are made available under the terms of the\n- * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n- * https://www.eclipse.org/legal/epl-v20.html\n- *\n- * SPDX-License-Identifier: EPL-2.0\n- *\n- * Copyright Contributors to the Zowe Project.\n- */\n-\n-package org.zowe.apiml.caching.service.vsam;\n-import lombok.experimental.UtilityClass;\n-\n-@UtilityClass\n-public class VsamUtils {\n-\n-    /**\n-     * Pad a string with spaces to a specified length\n-     */\n-    static String padToLength(String s, int len) {\n-        StringBuilder sb = new StringBuilder(len);\n-        sb.append(s);\n-        for (int i = s.length(); i < len; i++) sb.append(' ');\n-        return sb.toString();\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzNDgxNw==", "url": "https://github.com/zowe/api-layer/pull/951#discussion_r530934817", "bodyText": "What about\nreturn getKey(serviceId, keyValue.getKey());", "author": "balhar-jakub", "createdAt": "2020-11-26T10:41:09Z", "path": "caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\r\n+ * This program and the accompanying materials are made available under the terms of the\r\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\r\n+ * https://www.eclipse.org/legal/epl-v20.html\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *\r\n+ * Copyright Contributors to the Zowe Project.\r\n+ */\r\n+\r\n+package org.zowe.apiml.caching.service.vsam;\r\n+\r\n+import lombok.Getter;\r\n+import org.zowe.apiml.caching.config.VsamConfig;\r\n+import org.zowe.apiml.caching.model.KeyValue;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+\r\n+public class VsamKey {\r\n+\r\n+    private final VsamConfig config;\r\n+\r\n+    @Getter\r\n+    int keyLength;\r\n+\r\n+    public VsamKey(VsamConfig config) {\r\n+\r\n+        if (config.getKeyLength() < 23) {\r\n+            throw new IllegalArgumentException(\"VsamKey cannot have length smaller than 23 characters\");\r\n+        }\r\n+        this.config = config;\r\n+        this.keyLength = config.getKeyLength();\r\n+    }\r\n+\r\n+    @Override\r\n+    public String toString() {\r\n+        return \"vsamkey\";\r\n+    }\r\n+\r\n+    public String getKey(String serviceId, String key) {\r\n+        return VsamUtils.padToLength(serviceId.hashCode() + \":\" + key.hashCode(), keyLength);\r\n+    }\r\n+\r\n+    public String getKey(String serviceId, KeyValue keyValue) {\r\n+        return VsamUtils.padToLength(serviceId.hashCode() + \":\" + keyValue.getKey().hashCode(), keyLength);\r", "originalCommit": "76bd2b8a06406b64fe78f93f374eb1b7a5676fd7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "933b0a26cca21dc5c9f56c17a7dfc01ff1487db2", "chunk": "diff --git a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java\nindex f2b8cb87..f54f0d11 100644\n--- a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java\n+++ b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamKey.java\n\n@@ -16,6 +16,13 @@ import org.zowe.apiml.caching.model.KeyValue;\n \n import java.io.UnsupportedEncodingException;\n \n+\n+/**\n+ * Key for VSAM record\n+ * Composed of ServiceId hash : Record key hash\n+ *\n+ * Takes configuration from {@link VsamConfig}\n+ */\n public class VsamKey {\n \n     private final VsamConfig config;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzNTIzMA==", "url": "https://github.com/zowe/api-layer/pull/951#discussion_r530935230", "bodyText": "I guess that you plan to add Documentation later?", "author": "balhar-jakub", "createdAt": "2020-11-26T10:41:46Z", "path": "caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamRecord.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\r\n+ * This program and the accompanying materials are made available under the terms of the\r\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\r\n+ * https://www.eclipse.org/legal/epl-v20.html\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *\r\n+ * Copyright Contributors to the Zowe Project.\r\n+ */\r\n+\r\n+package org.zowe.apiml.caching.service.vsam;\r\n+\r\n+import com.fasterxml.jackson.core.JsonProcessingException;\r\n+import com.fasterxml.jackson.databind.ObjectMapper;\r\n+import org.zowe.apiml.caching.config.VsamConfig;\r\n+import org.zowe.apiml.caching.model.KeyValue;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+\r\n+public class VsamRecord {\r", "originalCommit": "76bd2b8a06406b64fe78f93f374eb1b7a5676fd7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "933b0a26cca21dc5c9f56c17a7dfc01ff1487db2", "chunk": "diff --git a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamRecord.java b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamRecord.java\nindex 8e792df0..12173c81 100644\n--- a/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamRecord.java\n+++ b/caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamRecord.java\n\n@@ -17,6 +17,16 @@ import org.zowe.apiml.caching.model.KeyValue;\n \n import java.io.UnsupportedEncodingException;\n \n+/**\n+ * Represents a record data structure in VSAM file.\n+ *\n+ * The structure is composed of {@link VsamKey} and {@link KeyValue}, serialized to JSON format.\n+ * Configuration is driven from {@link VsamConfig}\n+ *\n+ * Constructors provide ways to create record from raw bytes or from POJOs.\n+ * Provides methods to serialize to bytes in platform's encoding.\n+ */\n+\n public class VsamRecord {\n \n     private final VsamConfig config;\n"}}, {"oid": "933b0a26cca21dc5c9f56c17a7dfc01ff1487db2", "url": "https://github.com/zowe/api-layer/commit/933b0a26cca21dc5c9f56c17a7dfc01ff1487db2", "message": "add javadoc\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-11-26T12:27:02Z", "type": "commit"}, {"oid": "3b365f8430886f48eda7e0ebcb8507f01a9ccf34", "url": "https://github.com/zowe/api-layer/commit/3b365f8430886f48eda7e0ebcb8507f01a9ccf34", "message": "more javadoc\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-11-26T12:30:11Z", "type": "commit"}, {"oid": "94eb5d43142f7131651e195e37ded2d9fde03cc3", "url": "https://github.com/zowe/api-layer/commit/94eb5d43142f7131651e195e37ded2d9fde03cc3", "message": "get rid of VsamUtils\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-11-26T12:36:49Z", "type": "commit"}, {"oid": "9fdcf5ef4dbff3f8271d4b33325e7c8fba9cfbfd", "url": "https://github.com/zowe/api-layer/commit/9fdcf5ef4dbff3f8271d4b33325e7c8fba9cfbfd", "message": "reuse getKey method\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-11-26T12:41:17Z", "type": "commit"}, {"oid": "ad3f50cc9dfca5379e072146e682721a249ed52b", "url": "https://github.com/zowe/api-layer/commit/ad3f50cc9dfca5379e072146e682721a249ed52b", "message": "Merge branch 'master' into rip/GH863/partial-vsam-config-helpers", "committedDate": "2020-11-26T12:42:28Z", "type": "commit"}]}