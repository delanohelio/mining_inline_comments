{"pr_number": 64275, "pr_title": "Deprecate the no-jdk distributions", "pr_createdAt": "2020-10-28T11:36:04Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64275", "timeline": [{"oid": "51a9d163fc66211d3b01f50f35418e01da89d099", "url": "https://github.com/elastic/elasticsearch/commit/51a9d163fc66211d3b01f50f35418e01da89d099", "message": "Deprecate the no-jdk distributions\n\nThis commit adds logging to indicate that the no-jdk distributions are\ndeprecated and will be removed in a future release.", "committedDate": "2020-10-28T11:34:41Z", "type": "commit"}, {"oid": "be9f1e34bb04a3f262fe3a699e1ab17d77933fc7", "url": "https://github.com/elastic/elasticsearch/commit/be9f1e34bb04a3f262fe3a699e1ab17d77933fc7", "message": "Fix expected warning header in tests", "committedDate": "2020-10-28T12:02:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5OTU5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/64275#discussion_r513399597", "bodyText": "Doesn't this conflict with the comment just above?", "author": "pugnascotia", "createdAt": "2020-10-28T12:23:07Z", "path": "server/src/main/java/org/elasticsearch/node/Node.java", "diffHunk": "@@ -255,7 +256,8 @@\n      * Logger initialized in the ctor because if it were initialized statically\n      * then it wouldn't get the node name.\n      */\n-    private final Logger logger;\n+    private final Logger logger = LogManager.getLogger(Node.class);", "originalCommit": "be9f1e34bb04a3f262fe3a699e1ab17d77933fc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQxODU4MA==", "url": "https://github.com/elastic/elasticsearch/pull/64275#discussion_r513418580", "bodyText": "Good catch, I think the comment is unclear since it refers to static initialization, which is not what is happening here, this is merely instance field initialization, a normal part of instance construction. That is, I read the comment thinking it was explaining why the field is not a static field, as is often the case with loggers. I also think this comment should be located where the initialization needs to take place, rather than on the field itself since that's where someone is going to see the initialization and wonder why?", "author": "jasontedor", "createdAt": "2020-10-28T12:55:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5OTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyMjU4OA==", "url": "https://github.com/elastic/elasticsearch/pull/64275#discussion_r513422588", "bodyText": "Actually, I still think the change is correct and it's the comment that is unclear and confusing. I think the key is in fact that it be an instance field and not static. There is absolutely no practical difference between this field being initialized separately, and as the first line of the constructor.", "author": "jasontedor", "createdAt": "2020-10-28T13:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5OTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyMjY3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/64275#discussion_r513422673", "bodyText": "I'm leaving the change as-is and will clean up the comment.", "author": "jasontedor", "createdAt": "2020-10-28T13:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5OTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyNzA5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/64275#discussion_r513427092", "bodyText": "In fact, we could make this logger instance a static instance if we moved the node.name setting out of the Node class and into its own class. The current problem is that touching this setting initializes the class. If the logger were static, then it would initialize the logger too, prematurely. If the setting were moved out of this class, we could touch the setting without initializing the logger here. That should be a follow-up.", "author": "jasontedor", "createdAt": "2020-10-28T13:08:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5OTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyODIzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/64275#discussion_r513428231", "bodyText": "I pushed 1053cfb.", "author": "jasontedor", "createdAt": "2020-10-28T13:10:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5OTU5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "1053cfbcc0db18f14cb04dcb4f0544a36f2533d8", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/node/Node.java b/server/src/main/java/org/elasticsearch/node/Node.java\nindex dde3a880cfa..c734c23bf65 100644\n--- a/server/src/main/java/org/elasticsearch/node/Node.java\n+++ b/server/src/main/java/org/elasticsearch/node/Node.java\n\n@@ -253,8 +253,12 @@ public class Node implements Closeable {\n     private final Lifecycle lifecycle = new Lifecycle();\n \n     /**\n-     * Logger initialized in the ctor because if it were initialized statically\n-     * then it wouldn't get the node name.\n+     * This logger instance is an instance field as opposed to a static field. This ensures that the field is not\n+     * initialized until an instance of Node is constructed, which is sure to happen after the logging infrastructure\n+     * has been initialized to include the hostname. If this field were static, then it would be initialized when the\n+     * class initializer runs. Alas, this happens too early, before logging is initialized as this class is referred to\n+     * in InternalSettingsPreparer#finalizeSettings, which runs when creating the Environment, before logging is\n+     * initialized.\n      */\n     private final Logger logger = LogManager.getLogger(Node.class);\n     private final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(Node.class);\n"}}, {"oid": "1053cfbcc0db18f14cb04dcb4f0544a36f2533d8", "url": "https://github.com/elastic/elasticsearch/commit/1053cfbcc0db18f14cb04dcb4f0544a36f2533d8", "message": "Clarify comment", "committedDate": "2020-10-28T13:09:40Z", "type": "commit"}, {"oid": "e0ae7cdd560fefcce36512f5b1315b9cbb54a532", "url": "https://github.com/elastic/elasticsearch/commit/e0ae7cdd560fefcce36512f5b1315b9cbb54a532", "message": "Warnings are not extracted", "committedDate": "2020-10-28T13:34:08Z", "type": "commit"}]}