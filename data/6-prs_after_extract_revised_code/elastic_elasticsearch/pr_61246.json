{"pr_number": 61246, "pr_title": "Add DEBUG logging for undefined role mapping field", "pr_createdAt": "2020-08-18T04:54:42Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61246", "timeline": [{"oid": "3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664", "url": "https://github.com/elastic/elasticsearch/commit/3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664", "message": "Add DEBUG logging for undefined role mapping field\n\nA role mapping with the following content:\n\n    \"rules\": { \"field\": { \"userid\" : \"admin\" } }\n\nwill never match because `userid` is not a valid field. The correct\nfield is `username`.\n\nThis change adds DEBUG logging when an undefined field is referenced.\n\nThe choice to use DEBUG rather than INFO/WARN is that the set of\nfields is partially dynamic (e.g. the `metadata.*` fields), so\nit may be perfectly reasonable to check a field that is not defined\nfor that user. For example this rule:\n\n    \"rules\": { \"field\": { \"metadata.ranking\" : \"A\" } }\n\nwould generate a log message for an unranked user, which would\nerroneously suggest that such a rule is an error.\nThis DEBUG logging will assist in diagnosing problems, without\nintroducing that confusion.", "committedDate": "2020-08-18T04:20:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc3OTM2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/61246#discussion_r472779361", "bodyText": "This string format will not be very useful if the value is an array. But I think it can only be primitive values as guaranteed by ExpressionParser#parseFieldValue?", "author": "ywangd", "createdAt": "2020-08-19T06:58:53Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/support/mapper/expressiondsl/FieldExpression.java", "diffHunk": "@@ -148,6 +148,11 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n             return builder.value(value);\n         }\n \n+        @Override\n+        public String toString() {\n+            return Objects.toString(value);", "originalCommit": "3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQyNzAxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/61246#discussion_r474427015", "bodyText": "Yes, multi-valued expression are a List<FieldValue> rather than a FieldValue over a list/array.\nGiven that, I don't think it's worth trying to detect an array here. If there was an easily available method for maybeDeepToString(Object) we could call it, but I don't know of one in our codebase.", "author": "tvernum", "createdAt": "2020-08-21T06:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc3OTM2MQ=="}], "type": "inlineReview", "revised_code": null}]}