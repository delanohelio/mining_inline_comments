{"pr_number": 58429, "pr_title": "SQL: fix handling of escaped chars in JDBC connection string", "pr_createdAt": "2020-06-23T12:28:49Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58429", "timeline": [{"oid": "96508fe93fd10fc8ade6f647cfd57b90558b3598", "url": "https://github.com/elastic/elasticsearch/commit/96508fe93fd10fc8ade6f647cfd57b90558b3598", "message": "Fix: preserve URI query and fragment char escaping\n\nThis commit fixes an issue emerging when the connection string URI\ncontains escaped characters.\n\nThe original URI is pre-parsed in order to re-assemble a new URI having\nthe optional elements filled in with defaults. The new URI has been\nusing however the unescaped query and fragment parts. So if these\ncontained any escaped `&` or `=` (such as in the password option value),\nthe unescaping would reveal them and make them later interfere with the\noptions parsing.\n\nThe commit changes that, so that the new URI be built from the unescaped\n\"raw\" parts of the original URI.", "committedDate": "2020-06-23T12:11:58Z", "type": "commit"}, {"oid": "1ff8944c66f2edbaebf8d3bd8513d141f1f7162f", "url": "https://github.com/elastic/elasticsearch/commit/1ff8944c66f2edbaebf8d3bd8513d141f1f7162f", "message": "Merge branch 'master' into fix/57927_escaped_chars_in_uri_query", "committedDate": "2020-06-23T13:42:27Z", "type": "commit"}, {"oid": "5ee799532c27d56ff16100d672874fb6641dbe81", "url": "https://github.com/elastic/elasticsearch/commit/5ee799532c27d56ff16100d672874fb6641dbe81", "message": "Merge branch 'master' into fix/57927_escaped_chars_in_uri_query", "committedDate": "2020-06-24T07:36:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzMjUyNA==", "url": "https://github.com/elastic/elasticsearch/pull/58429#discussion_r444832524", "bodyText": "minor: I would trim the url and use a local var to avoid trimming it potentially twice.", "author": "matriv", "createdAt": "2020-06-24T11:39:44Z", "path": "x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcConfiguration.java", "diffHunk": "@@ -208,7 +215,8 @@ public boolean indexIncludeFrozen() {\n     }\n \n     public static boolean canAccept(String url) {\n-        return (StringUtils.hasText(url) && url.trim().startsWith(JdbcConfiguration.URL_PREFIX));\n+        return (StringUtils.hasText(url) &&", "originalCommit": "5ee799532c27d56ff16100d672874fb6641dbe81", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9f74792259ca61768d8ffcfef505cccb60b2d0f1", "chunk": "diff --git a/x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcConfiguration.java b/x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcConfiguration.java\nindex b7d4651b9544..0fa86cb51e0d 100644\n--- a/x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcConfiguration.java\n+++ b/x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcConfiguration.java\n\n@@ -215,8 +215,9 @@ public class JdbcConfiguration extends ConnectionConfiguration {\n     }\n \n     public static boolean canAccept(String url) {\n-        return (StringUtils.hasText(url) &&\n-            (url.trim().startsWith(JdbcConfiguration.URL_PREFIX) || url.trim().startsWith(JdbcConfiguration.URL_FULL_PREFIX)));\n+        String u = url.trim();\n+        return (StringUtils.hasText(u) &&\n+            (u.startsWith(JdbcConfiguration.URL_PREFIX) || u.startsWith(JdbcConfiguration.URL_FULL_PREFIX)));\n     }\n \n     public DriverPropertyInfo[] driverPropertyInfo() {\n"}}, {"oid": "9f74792259ca61768d8ffcfef505cccb60b2d0f1", "url": "https://github.com/elastic/elasticsearch/commit/9f74792259ca61768d8ffcfef505cccb60b2d0f1", "message": "Address review comments\n\n- prevent double trimming of the connection string;\n- improve docs", "committedDate": "2020-06-25T20:39:06Z", "type": "commit"}]}