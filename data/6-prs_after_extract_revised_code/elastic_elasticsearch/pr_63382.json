{"pr_number": 63382, "pr_title": "Fix XContentTypeTests where version was a negative byte", "pr_createdAt": "2020-10-07T06:55:29Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63382", "timeline": [{"oid": "d2a85d218b02a2e5a0a016b2785dfc6a1c8e1fc9", "url": "https://github.com/elastic/elasticsearch/commit/d2a85d218b02a2e5a0a016b2785dfc6a1c8e1fc9", "message": "Fix XContentTypeTests where version was a negative byte\n\na random byte could be -128 and when used with Math.abs it would result\nin an int 128. That in turn when casting back to byte would overflow and\nresult in -128 again.\nFixed with a randomNonNegativeByte method\n\ncloses #63342", "committedDate": "2020-10-07T06:51:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1Njk5OA==", "url": "https://github.com/elastic/elasticsearch/pull/63382#discussion_r501156998", "bodyText": "nit: just use randomByte()?", "author": "rjernst", "createdAt": "2020-10-07T16:40:39Z", "path": "test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java", "diffHunk": "@@ -607,6 +607,11 @@ public static byte randomByte() {\n         return (byte) random().nextInt();\n     }\n \n+    public static byte randomNonNegativeByte() {\n+        byte randomByte =  (byte) random().nextInt();", "originalCommit": "d2a85d218b02a2e5a0a016b2785dfc6a1c8e1fc9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "be07febedc05bc26a49bab95d693538ebea95430", "chunk": "diff --git a/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java\nindex b70986ddb77..82d94a24ba4 100644\n--- a/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java\n+++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java\n\n@@ -608,7 +608,7 @@ public abstract class ESTestCase extends LuceneTestCase {\n     }\n \n     public static byte randomNonNegativeByte() {\n-        byte randomByte =  (byte) random().nextInt();\n+        byte randomByte =  randomByte();\n         return (byte) (randomByte == Byte.MIN_VALUE ? 0 : Math.abs(randomByte));\n     }\n \n"}}, {"oid": "be07febedc05bc26a49bab95d693538ebea95430", "url": "https://github.com/elastic/elasticsearch/commit/be07febedc05bc26a49bab95d693538ebea95430", "message": "use rnadomByte()", "committedDate": "2020-10-08T06:49:37Z", "type": "commit"}, {"oid": "145951947f880725c403195c3cd886643958744d", "url": "https://github.com/elastic/elasticsearch/commit/145951947f880725c403195c3cd886643958744d", "message": "Merge branch 'master' into test/fix_negative_byte", "committedDate": "2020-10-08T07:47:11Z", "type": "commit"}]}