{"pr_number": 50594, "pr_title": "Remove the 'local' parameter of /_cat/nodes", "pr_createdAt": "2020-01-03T11:06:29Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/50594", "timeline": [{"oid": "80f0241d8d7f706b08014f78c058c051306bc316", "url": "https://github.com/elastic/elasticsearch/commit/80f0241d8d7f706b08014f78c058c051306bc316", "message": "Remove the 'local' parameter of /_cat/nodes\n\nThe cat nodes API performs a `ClusterStateAction` then a `NodesInfoAction`.\nToday it accepts the `?local` parameter and passes this to the\n`ClusterStateAction` but this parameter has no effect on the `NodesInfoAction`.\nThis is surprising, because `GET _cat/nodes?local` looks like it might be a\ncompletely local call but in fact it still depends on every node in the\ncluster.\n\nThis parameter was deprecated in 7.x in #50499 and this commit removes it.\n\nRelates #50088", "committedDate": "2020-01-03T11:04:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNTUxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/50594#discussion_r363305519", "bodyText": "Why not Version.V_8_0_0.major? :)", "author": "original-brownbear", "createdAt": "2020-01-06T14:03:39Z", "path": "server/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java", "diffHunk": "@@ -92,10 +87,9 @@ protected void documentation(StringBuilder sb) {\n     public RestChannelConsumer doCatRequest(final RestRequest request, final NodeClient client) {\n         final ClusterStateRequest clusterStateRequest = new ClusterStateRequest();\n         clusterStateRequest.clear().nodes(true);\n-        if (request.hasParam(\"local\")) {\n-            deprecationLogger.deprecated(LOCAL_DEPRECATED_MESSAGE);\n+        if (request.hasParam(\"local\") && Version.CURRENT.major == Version.V_7_0_0.major + 1) { // only needed in v8 to catch breaking usages", "originalCommit": "80f0241d8d7f706b08014f78c058c051306bc316", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNzk5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/50594#discussion_r363307993", "bodyText": "So we get a compile error when we move to v9 and drop the v7 version constants.", "author": "DaveCTurner", "createdAt": "2020-01-06T14:09:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNTUxOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNTgyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/50594#discussion_r363305829", "bodyText": "Wouldn't we want to assertTrue here so that this starts failing on the version bump and we can remove it instaed of having it live on as dead code in a skipped test?", "author": "original-brownbear", "createdAt": "2020-01-06T14:04:36Z", "path": "server/src/test/java/org/elasticsearch/rest/action/cat/RestNodesActionTests.java", "diffHunk": "@@ -69,15 +70,14 @@ public void testBuildTableDoesNotThrowGivenNullNodeInfoAndStats() {\n         action.buildTable(false, new FakeRestRequest(), clusterStateResponse, nodesInfoResponse, nodesStatsResponse);\n     }\n \n-    public void testCatNodesWithLocalDeprecationWarning() {\n+    public void testCatNodesRejectsLocalParameter() {\n+        assumeTrue(\"test is only needed in v8, can be removed in v9\", Version.CURRENT.major == Version.V_7_0_0.major + 1);", "originalCommit": "80f0241d8d7f706b08014f78c058c051306bc316", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwODc0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/50594#discussion_r363308749", "bodyText": "I figured we could defer this until we drop the v7 version constants, which normally happens some time after moving to v9. The compile error from Version.V_7_0_0.major  will limit how long this lives.", "author": "DaveCTurner", "createdAt": "2020-01-06T14:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNTgyOQ=="}], "type": "inlineReview", "revised_code": null}]}