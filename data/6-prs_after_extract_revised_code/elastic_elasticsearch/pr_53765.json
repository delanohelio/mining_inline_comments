{"pr_number": 53765, "pr_title": "Scripting: Increase ingest script cache defaults", "pr_createdAt": "2020-03-18T20:46:45Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53765", "timeline": [{"oid": "6a2bbfdfce615984d0390d93c44bfe603918e666", "url": "https://github.com/elastic/elasticsearch/commit/6a2bbfdfce615984d0390d93c44bfe603918e666", "message": "Scripting: Increase ingest script cache defaults\n\n* Adds ability for contexts to specify their own defaults.\n* Context defaults are applied if no context-specific or\n  general setting exists.\n* See 070ea7e for settings keys.\n\n* Increases the per-context default for the `ingest` context.\n* Cache size is doubled, 200 compared to default of 100\n* Cache expiration is unchanged at no expiration\n* Cache max compilation is quintupled, 375/5m instead of 75/5m\n\nRefs: #50152", "committedDate": "2020-03-18T20:42:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgxMDE1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53765#discussion_r395810159", "bodyText": "While I understand the reasoning for increasing this specifically for ingest (beats modules using many ingest scripts), allowing so high numbers seems like we are easily allowing thrashing, especially since one ingest request can have dozens of scripts. Can you please open a followup issue to investigate ways to allow ingest to utilize many scripts in one request without tripping the limit?\nAlso, don't we need a similar change for IngestConditionalScript, which are more likely to be unique and numerous?", "author": "rjernst", "createdAt": "2020-03-20T18:10:09Z", "path": "server/src/main/java/org/elasticsearch/script/IngestScript.java", "diffHunk": "@@ -30,7 +33,8 @@\n     public static final String[] PARAMETERS = { \"ctx\" };\n \n     /** The context used to compile {@link IngestScript} factories. */\n-    public static final ScriptContext<Factory> CONTEXT = new ScriptContext<>(\"ingest\", Factory.class);\n+    public static final ScriptContext<Factory> CONTEXT = new ScriptContext<>(\"ingest\", Factory.class,\n+        200, TimeValue.timeValueMillis(0), new Tuple<>(375, TimeValue.timeValueMinutes(5)));", "originalCommit": "6a2bbfdfce615984d0390d93c44bfe603918e666", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2Mjg4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53765#discussion_r395862883", "bodyText": "Can you please open a followup issue to investigate ways to allow ingest to utilize many scripts in one request without tripping the limit?\n\n#53896\n\nAlso, don't we need a similar change for IngestConditionalScript, which are more likely to be unique and numerous?\n\nAdded", "author": "stu-elastic", "createdAt": "2020-03-20T20:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgxMDE1OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "0e6b6e7f8e8dae55394826fbb1f435ede7513b96", "url": "https://github.com/elastic/elasticsearch/commit/0e6b6e7f8e8dae55394826fbb1f435ede7513b96", "message": "Add ingest conditional script", "committedDate": "2020-03-20T19:54:11Z", "type": "commit"}, {"oid": "27c2e95337d538732d99bbe7b243f76f9f1073bb", "url": "https://github.com/elastic/elasticsearch/commit/27c2e95337d538732d99bbe7b243f76f9f1073bb", "message": "Merge branch 'master' of github.com:elastic/elasticsearch into fix/50152-painless-limit-per-context__03__per_context_defaults", "committedDate": "2020-03-20T19:57:14Z", "type": "commit"}]}