{"pr_number": 63797, "pr_title": "Nit fixes and formatting following #62490 comments", "pr_createdAt": "2020-10-16T10:14:13Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63797", "timeline": [{"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648", "url": "https://github.com/elastic/elasticsearch/commit/e17c289be8b02f4dd48f14619039059a3b3d1648", "message": "Nit fixes and formatting following #62490 comments\n\nResolves: #63792", "committedDate": "2020-10-16T10:10:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyOTA5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506329097", "bodyText": "The parameter order of assertEquals should be first \"expected\", then \"actual\", i.e.:\nassertEquals(SecuritySettingsSource.TEST_USER_NAME, response.getAuthentication().getUser().getUsername());", "author": "ywangd", "createdAt": "2020-10-16T11:43:05Z", "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -134,7 +134,8 @@ public void testTokenServiceCanRotateKeys() throws Exception {\n             assertNotNull(userTokenFuture.actionGet());\n             assertNotEquals(activeKeyHash, tokenService.getActiveKeyHash());\n         }\n-        assertNotNull(response.getAuthenticationResponse());\n+        assertNotNull(response.getAuthentication());\n+        assertEquals(response.getAuthentication().getUser().getUsername(), SecuritySettingsSource.TEST_USER_NAME);", "originalCommit": "e17c289be8b02f4dd48f14619039059a3b3d1648", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDUyMA==", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504520", "bodyText": "Done", "author": "BigPandaToo", "createdAt": "2020-10-16T14:48:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyOTA5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "bc2758967ce4ba5085145b0a048d0911cc612704", "chunk": "diff --git a/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java b/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java\nindex 1308e0aea0a..9f6ec02bbe1 100644\n--- a/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java\n+++ b/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java\n\n@@ -135,7 +135,7 @@ public class TokenAuthIntegTests extends SecurityIntegTestCase {\n             assertNotEquals(activeKeyHash, tokenService.getActiveKeyHash());\n         }\n         assertNotNull(response.getAuthentication());\n-        assertEquals(response.getAuthentication().getUser().getUsername(), SecuritySettingsSource.TEST_USER_NAME);\n+        assertEquals(SecuritySettingsSource.TEST_USER_NAME, response.getAuthentication().getUser().getUsername());\n     }\n \n     public void testExpiredTokensDeletedAfterExpiration() throws Exception {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTA1NA==", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506331054", "bodyText": "We should also assert the authentication's principal here for the same reason that there are two credentials involved.\nThis comment also applies to where the authentication object is verified in OpenIdConnectAuthIT and SamlAuthenticationIT, i.e. authentication principal should be checked in those places as well.", "author": "ywangd", "createdAt": "2020-10-16T11:45:28Z", "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java", "diffHunk": "@@ -149,7 +149,7 @@ public void testDelegateThenAuthenticate() throws Exception {\n                         optionsBuilder.build());\n                 String token = delegatePkiResponse.getAccessToken();\n                 assertThat(token, is(notNullValue()));\n-                assertNotNull(delegatePkiResponse.getAuthenticationResponse());\n+                assertNotNull(delegatePkiResponse.getAuthentication());", "originalCommit": "e17c289be8b02f4dd48f14619039059a3b3d1648", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDY2OA==", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504668", "bodyText": "Done", "author": "BigPandaToo", "createdAt": "2020-10-16T14:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTA1NA=="}], "type": "inlineReview", "revised_code": {"commit": "bc2758967ce4ba5085145b0a048d0911cc612704", "chunk": "diff --git a/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java b/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java\nindex 50f5a06bf3e..cf0aac87f6c 100644\n--- a/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java\n+++ b/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java\n\n@@ -150,6 +150,7 @@ public class PkiAuthDelegationIntegTests extends SecurityIntegTestCase {\n                 String token = delegatePkiResponse.getAccessToken();\n                 assertThat(token, is(notNullValue()));\n                 assertNotNull(delegatePkiResponse.getAuthentication());\n+                assertEquals(\"Elasticsearch Test Client\", delegatePkiResponse.getAuthentication().getUser().getUsername());\n \n                 // authenticate\n                 optionsBuilder = RequestOptions.DEFAULT.toBuilder();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzNzI2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506337269", "bodyText": "Can we assert authentication principal here as well? Because this is a refresh response which goes through a different transport action than the token creation with password grant (which is asserted).", "author": "ywangd", "createdAt": "2020-10-16T11:53:47Z", "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -367,7 +368,7 @@ public void testRefreshingToken() throws IOException {\n \n         // Assert that we can authenticate with the refreshed access token\n         assertAuthenticateWithToken(refreshResponse.getAccessToken(), SecuritySettingsSource.TEST_USER_NAME);\n-        assertNotNull(refreshResponse.getAuthenticationResponse());\n+        assertNotNull(refreshResponse.getAuthentication());", "originalCommit": "e17c289be8b02f4dd48f14619039059a3b3d1648", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDgxMw==", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504813", "bodyText": "Done", "author": "BigPandaToo", "createdAt": "2020-10-16T14:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzNzI2OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "bc2758967ce4ba5085145b0a048d0911cc612704", "url": "https://github.com/elastic/elasticsearch/commit/bc2758967ce4ba5085145b0a048d0911cc612704", "message": "Nit fixes and formatting following #62490 comments\n\nResolves: #63792", "committedDate": "2020-10-16T12:49:58Z", "type": "commit"}, {"oid": "7dd0839723119b32891d4b5e0599c9d09ad81c87", "url": "https://github.com/elastic/elasticsearch/commit/7dd0839723119b32891d4b5e0599c9d09ad81c87", "message": "Nit fixes and formatting following #62490 comments\nFixing username", "committedDate": "2020-10-16T13:41:20Z", "type": "commit"}, {"oid": "a4dd6e29038d5e53c0f60d4fb02fc7fc01ffb0a8", "url": "https://github.com/elastic/elasticsearch/commit/a4dd6e29038d5e53c0f60d4fb02fc7fc01ffb0a8", "message": "Nit fixes and formatting following #62490 comments\nFixing formatting", "committedDate": "2020-10-16T14:47:58Z", "type": "commit"}]}