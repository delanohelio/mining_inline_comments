{"pr_number": 52870, "pr_title": "SQL: refactor In predicate moving it to QL project", "pr_createdAt": "2020-02-27T08:26:11Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52870", "timeline": [{"oid": "657e7767160b9a9001f92ae69b15a9f3bce56366", "url": "https://github.com/elastic/elasticsearch/commit/657e7767160b9a9001f92ae69b15a9f3bce56366", "message": "Move In, InPipe and InProcessor out of SQL to the common QL project.\nMove tests classes to the QL project.\nCreate SQL dedicated In class to handle SQL specific data types.\nUpdate SQL classes to use the InPipe and InProcessor QL classes.\nExtract common Foldables methods in QL project.", "committedDate": "2020-02-27T08:19:26Z", "type": "commit"}, {"oid": "ffbcd10fadc97ebdf77b1416b77ef3b8ab0bd1af", "url": "https://github.com/elastic/elasticsearch/commit/ffbcd10fadc97ebdf77b1416b77ef3b8ab0bd1af", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 52637_impl", "committedDate": "2020-02-27T08:23:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwNTQxMg==", "url": "https://github.com/elastic/elasticsearch/pull/52870#discussion_r385005412", "bodyText": "I would remove this from ql since it's a trappy class. It uses DataTypeConverter which is QL specific and SQL would end up using that instead of SqlDataTypeConverter.\nThat is, Foldables is really reusable because of that and as such, I would just inline the methods.", "author": "costin", "createdAt": "2020-02-27T09:30:28Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/Foldables.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.ql.expression;\n+\n+import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n+import org.elasticsearch.xpack.ql.type.DataType;\n+import org.elasticsearch.xpack.ql.type.DataTypeConverter;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+public abstract class Foldables {\n+    \n+    @SuppressWarnings(\"unchecked\")\n+    private static <T> T valueOf(Expression e, DataType to) {", "originalCommit": "ffbcd10fadc97ebdf77b1416b77ef3b8ab0bd1af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyMzg5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52870#discussion_r385023891", "bodyText": "+1", "author": "matriv", "createdAt": "2020-02-27T10:01:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwNTQxMg=="}], "type": "inlineReview", "revised_code": {"commit": "f6809568f76e5e1d5f94483a04a1f10d9c880552", "chunk": "diff --git a/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/Foldables.java b/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/Foldables.java\nindex eef0bdfeaf1..53cb62acae3 100644\n--- a/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/Foldables.java\n+++ b/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/Foldables.java\n\n@@ -3,38 +3,12 @@\n  * or more contributor license agreements. Licensed under the Elastic License;\n  * you may not use this file except in compliance with the Elastic License.\n  */\n-\n package org.elasticsearch.xpack.ql.expression;\n \n import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n-import org.elasticsearch.xpack.ql.type.DataType;\n-import org.elasticsearch.xpack.ql.type.DataTypeConverter;\n-\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.List;\n \n public abstract class Foldables {\n-    \n-    @SuppressWarnings(\"unchecked\")\n-    private static <T> T valueOf(Expression e, DataType to) {\n-        if (e.foldable()) {\n-            return (T) DataTypeConverter.convert(e.fold(), to);\n-        }\n-        throw new QlIllegalArgumentException(\"Cannot determine value for {}\", e);\n-    }\n-\n-    public static <T> List<T> valuesOf(List<Expression> list, DataType to) {\n-        return foldTo(list, to, new ArrayList<>(list.size()));\n-    }\n \n-    private static <T, C extends Collection<T>> C foldTo(Collection<Expression> expressions, DataType to, C values) {\n-        for (Expression e : expressions) {\n-            values.add(valueOf(e, to));\n-        }\n-        return values;\n-    }\n-    \n     public static Object valueOf(Expression e) {\n         if (e.foldable()) {\n             return e.fold();\n"}}, {"oid": "f6809568f76e5e1d5f94483a04a1f10d9c880552", "url": "https://github.com/elastic/elasticsearch/commit/f6809568f76e5e1d5f94483a04a1f10d9c880552", "message": "Be more explicit when folding and converting a foldable value, by\nremoving most of the code inside Foldables class.", "committedDate": "2020-02-27T16:10:02Z", "type": "commit"}, {"oid": "b19a577b6c7c1d10bb3d3ce0839c21914fad7000", "url": "https://github.com/elastic/elasticsearch/commit/b19a577b6c7c1d10bb3d3ce0839c21914fad7000", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 52637_impl", "committedDate": "2020-02-27T16:10:30Z", "type": "commit"}, {"oid": "e2907797e1f9d8055b4f23a64fe9dc771b115e0f", "url": "https://github.com/elastic/elasticsearch/commit/e2907797e1f9d8055b4f23a64fe9dc771b115e0f", "message": "Clean up", "committedDate": "2020-02-27T16:15:40Z", "type": "commit"}]}