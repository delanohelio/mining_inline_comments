{"pr_number": 54363, "pr_title": "Refactor nodes stats request builders to match requests", "pr_createdAt": "2020-03-27T18:58:40Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54363", "timeline": [{"oid": "472827683c75ee5c2896730aea88a8c367e27854", "url": "https://github.com/elastic/elasticsearch/commit/472827683c75ee5c2896730aea88a8c367e27854", "message": "Remove hard-coded setters from NodesInfoRequestBuilder", "committedDate": "2020-03-27T16:06:05Z", "type": "commit"}, {"oid": "4e065ae3437ab6f9b506e230db9d28ff26feed27", "url": "https://github.com/elastic/elasticsearch/commit/4e065ae3437ab6f9b506e230db9d28ff26feed27", "message": "Remove hard-coded setters from NodesStatsRequest", "committedDate": "2020-03-27T17:58:54Z", "type": "commit"}, {"oid": "521a6abe931882bdfca639ecd8ef836c707990a4", "url": "https://github.com/elastic/elasticsearch/commit/521a6abe931882bdfca639ecd8ef836c707990a4", "message": "Merge branch 'master' into nodes-info-stats-request-builder-refactor", "committedDate": "2020-03-27T19:53:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5ODkzMg==", "url": "https://github.com/elastic/elasticsearch/pull/54363#discussion_r400098932", "bodyText": "Not that it would save a lot of bytes, but what do you think about adding an override that takes a NodesStatsRequest.Metric?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .addMetric(NodesStatsRequest.Metric.INGEST.metricName())\n          \n          \n            \n                        .addMetric(NodesStatsRequest.Metric.INGEST)\n          \n      \n    \n    \n  \n\nThis would be a bit more type-safe at least?", "author": "pugnascotia", "createdAt": "2020-03-30T10:51:37Z", "path": "modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestRestartIT.java", "diffHunk": "@@ -95,7 +96,9 @@ public void testFailureInConditionalProcessor() {\n         );\n         assertTrue(e.getMessage().contains(\"this script always fails\"));\n \n-        NodesStatsResponse r = client().admin().cluster().prepareNodesStats(internalCluster().getNodeNames()).setIngest(true).get();\n+        NodesStatsResponse r = client().admin().cluster().prepareNodesStats(internalCluster().getNodeNames())\n+            .addMetric(NodesStatsRequest.Metric.INGEST.metricName())", "originalCommit": "521a6abe931882bdfca639ecd8ef836c707990a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEwMTUxMA==", "url": "https://github.com/elastic/elasticsearch/pull/54363#discussion_r400101510", "bodyText": "I'd be tempted use some static imports to abbreviate the code a little, too.", "author": "pugnascotia", "createdAt": "2020-03-30T10:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5ODkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2NTY4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54363#discussion_r400265687", "bodyText": "The NodesStatsRequest.Metric construct is just temporary and will eventually be replaced with a more pluggable solution. That is to say, the addMetric method will need to accept strings that are defined by plugins. Those strings will have to be validated dynamically, possibly by the NodeService.", "author": "williamrandolph", "createdAt": "2020-03-30T15:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5ODkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2ODE0NA==", "url": "https://github.com/elastic/elasticsearch/pull/54363#discussion_r400268144", "bodyText": "I agree on static imports improving readability; I'll make that change.", "author": "williamrandolph", "createdAt": "2020-03-30T15:08:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5ODkzMg=="}], "type": "inlineReview", "revised_code": {"commit": "226ba9b8c1b78b64afb46a40154c8b02584e5de8", "chunk": "diff --git a/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestRestartIT.java b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestRestartIT.java\nindex d407e808a55..c9e4e1ebb4b 100644\n--- a/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestRestartIT.java\n+++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestRestartIT.java\n\n@@ -97,7 +97,7 @@ public class IngestRestartIT extends ESIntegTestCase {\n         assertTrue(e.getMessage().contains(\"this script always fails\"));\n \n         NodesStatsResponse r = client().admin().cluster().prepareNodesStats(internalCluster().getNodeNames())\n-            .addMetric(NodesStatsRequest.Metric.INGEST.metricName())\n+            .addMetric(INGEST.metricName())\n             .get();\n         int nodeCount = r.getNodes().size();\n         for (int k = 0; k < nodeCount; k++) {\n"}}, {"oid": "226ba9b8c1b78b64afb46a40154c8b02584e5de8", "url": "https://github.com/elastic/elasticsearch/commit/226ba9b8c1b78b64afb46a40154c8b02584e5de8", "message": "Use static imports to reduce clutter", "committedDate": "2020-03-30T15:37:41Z", "type": "commit"}, {"oid": "31147e25d89863f53016f1deb11becb3077e2b01", "url": "https://github.com/elastic/elasticsearch/commit/31147e25d89863f53016f1deb11becb3077e2b01", "message": "Merge branch 'master' into nodes-info-stats-request-builder-refactor", "committedDate": "2020-04-01T15:36:18Z", "type": "commit"}]}