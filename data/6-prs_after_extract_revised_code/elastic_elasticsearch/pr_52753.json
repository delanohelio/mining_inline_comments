{"pr_number": 52753, "pr_title": "Emphasize keyword over fielddata as the preferred way to use String\u2026", "pr_createdAt": "2020-02-25T11:06:47Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52753", "timeline": [{"oid": "0ec7664e5557f379f6d205f35d7e5831afbf3d4c", "url": "https://github.com/elastic/elasticsearch/commit/0ec7664e5557f379f6d205f35d7e5831afbf3d4c", "message": "Emphasize keyword over fielddata as the preferred way to use String fields for aggregations or sorting", "committedDate": "2020-02-25T11:03:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0MjY2MA==", "url": "https://github.com/elastic/elasticsearch/pull/52753#discussion_r384042660", "bodyText": "This looks good, I had some minor suggestions to try to keep the error message as precise/ short as possible:\n\nText fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [field] in order to load field data by uninverting the inverted index. Note that this can use significant memory.", "author": "jtibshirani", "createdAt": "2020-02-25T18:25:26Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java", "diffHunk": "@@ -749,9 +749,10 @@ public static boolean hasGaps(TokenStream stream) throws IOException {\n         @Override\n         public IndexFieldData.Builder fielddataBuilder(String fullyQualifiedIndexName) {\n             if (fielddata == false) {\n-                throw new IllegalArgumentException(\"Fielddata is disabled on text fields by default. Set fielddata=true on [\" + name()\n-                        + \"] in order to load fielddata in memory by uninverting the inverted index. Note that this can however \"\n-                                + \"use significant memory. Alternatively use a keyword field instead.\");\n+                throw new IllegalArgumentException(\"Text fields are not optimised for aggregations and/or sorting and therefore these \"", "originalCommit": "0ec7664e5557f379f6d205f35d7e5831afbf3d4c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ebe5b63294317616ffc411515095f9a06a2e6efb", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java\nindex 3ecf3866e63..b562e3d1379 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java\n\n@@ -749,10 +749,10 @@ public class TextFieldMapper extends FieldMapper {\n         @Override\n         public IndexFieldData.Builder fielddataBuilder(String fullyQualifiedIndexName) {\n             if (fielddata == false) {\n-                throw new IllegalArgumentException(\"Text fields are not optimised for aggregations and/or sorting and therefore these \"\n-                    + \"operations are disabled by default. Please use a field with a keyword datatype instead. \"\n-                        + \"Otherwise Set fielddata=true on [\" + name() + \"] in order to load fielddata in memory \"\n-                            + \"by uninverting the inverted index. Note that this can however use significant memory.\");\n+            throw new IllegalArgumentException(\"Text fields are not optimised for operations that require per-document \"\n+                + \"field data like aggregations and sorting, so these operations are disabled by default. Please use a \"\n+                    + \" keyword field instead. Alternatively, set fielddata=true on [\" + name() + \"] in order to load \"\n+                        + \"field data by uninverting the inverted index. Note that this can use significant memory.\");\n             }\n             return new PagedBytesIndexFieldData.Builder(fielddataMinFrequency, fielddataMaxFrequency, fielddataMinSegmentSize);\n         }\n"}}, {"oid": "ebe5b63294317616ffc411515095f9a06a2e6efb", "url": "https://github.com/elastic/elasticsearch/commit/ebe5b63294317616ffc411515095f9a06a2e6efb", "message": "minor changes to try to keep the error message as precise/short as possible", "committedDate": "2020-02-25T18:44:22Z", "type": "commit"}, {"oid": "5a163c9d164817ce604743ee56d330ad5964c8a8", "url": "https://github.com/elastic/elasticsearch/commit/5a163c9d164817ce604743ee56d330ad5964c8a8", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch", "committedDate": "2020-02-25T19:15:33Z", "type": "commit"}, {"oid": "5cf4728cc5653059f29de1f3e057ae9b4b0f09cf", "url": "https://github.com/elastic/elasticsearch/commit/5cf4728cc5653059f29de1f3e057ae9b4b0f09cf", "message": "typo", "committedDate": "2020-02-25T19:32:04Z", "type": "commit"}, {"oid": "cbb88331e1d79bdde398b98ecf9c0ab9fcf49f54", "url": "https://github.com/elastic/elasticsearch/commit/cbb88331e1d79bdde398b98ecf9c0ab9fcf49f54", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch", "committedDate": "2020-02-25T22:16:59Z", "type": "commit"}, {"oid": "0696e1b268076cfe1c04384614af76777795e56a", "url": "https://github.com/elastic/elasticsearch/commit/0696e1b268076cfe1c04384614af76777795e56a", "message": "change the expected error message", "committedDate": "2020-02-25T22:27:54Z", "type": "commit"}]}