{"pr_number": 61983, "pr_title": "Ensure domain_name setting for AD realm is present", "pr_createdAt": "2020-09-04T12:42:23Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61983", "timeline": [{"oid": "208cd5b72b86c635c35c9040aa283eee67faacb2", "url": "https://github.com/elastic/elasticsearch/commit/208cd5b72b86c635c35c9040aa283eee67faacb2", "message": "Ensure domain_name setting for AD realm is present\n\nWe would only check for a null value and not for an empty string so\nthat meant that we were not actually enforcing this mandatory\nsetting.\nThis is another take at #61859 . Moved the validation to the setting\nitself as we would use it's value in SessionFactory.ldapServers to\nbuild the LDAP URL before the existing valdation actually happened\nin ActiveDirectorySessionFactory. This would throw an LDAPSDK\nexception before we can validate and throw an IAE.", "committedDate": "2020-09-04T12:40:55Z", "type": "commit"}, {"oid": "e483f3270aa75dc0b35ce228fa1f14a7e34c1c53", "url": "https://github.com/elastic/elasticsearch/commit/e483f3270aa75dc0b35ce228fa1f14a7e34c1c53", "message": "Cause one has to forget the same test every time they raise the same PR", "committedDate": "2020-09-04T13:30:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0MzE3NA==", "url": "https://github.com/elastic/elasticsearch/pull/61983#discussion_r484643174", "bodyText": "You should be able to use RealmSettings.affixSetting instead here, which will make it a tiny bit shorter.", "author": "tvernum", "createdAt": "2020-09-08T04:28:11Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java", "diffHunk": "@@ -17,7 +18,12 @@\n public final class ActiveDirectorySessionFactorySettings {\n     private static final String AD_DOMAIN_NAME_SETTING_KEY = \"domain_name\";\n     public static final Setting.AffixSetting<String> AD_DOMAIN_NAME_SETTING\n-            = RealmSettings.simpleString(AD_TYPE, AD_DOMAIN_NAME_SETTING_KEY, Setting.Property.NodeScope);\n+        = Setting.affixKeySetting(RealmSettings.realmSettingPrefix(AD_TYPE), AD_DOMAIN_NAME_SETTING_KEY,", "originalCommit": "e483f3270aa75dc0b35ce228fa1f14a7e34c1c53", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e0cd4c2c9ef51b26eff9bc627f00c65a92d1bb5", "chunk": "diff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java\nindex 1fcc8a9055d..b039c9edf58 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java\n\n@@ -12,13 +12,14 @@ import org.elasticsearch.xpack.core.security.authc.ldap.support.SessionFactorySe\n \n import java.util.HashSet;\n import java.util.Set;\n+import java.util.function.Function;\n \n import static org.elasticsearch.xpack.core.security.authc.ldap.LdapRealmSettings.AD_TYPE;\n \n public final class ActiveDirectorySessionFactorySettings {\n     private static final String AD_DOMAIN_NAME_SETTING_KEY = \"domain_name\";\n-    public static final Setting.AffixSetting<String> AD_DOMAIN_NAME_SETTING\n-        = Setting.affixKeySetting(RealmSettings.realmSettingPrefix(AD_TYPE), AD_DOMAIN_NAME_SETTING_KEY,\n+    public static final Function<String, Setting.AffixSetting<String>> AD_DOMAIN_NAME_SETTING\n+        = RealmSettings.affixSetting(AD_DOMAIN_NAME_SETTING_KEY,\n         key -> Setting.simpleString(key, v -> {\n             if (Strings.isNullOrEmpty(v)) {\n                 throw new IllegalArgumentException(\"missing [\" + key + \"] setting for active directory\");\n"}}, {"oid": "b2c819563e57995cbafb95531e2bca5df041ed5a", "url": "https://github.com/elastic/elasticsearch/commit/b2c819563e57995cbafb95531e2bca5df041ed5a", "message": "Merge commit '208cd5b72b86c635c35c9040aa283eee67faacb2' into domain_name_mandatory_take2", "committedDate": "2020-09-28T13:29:59Z", "type": "commit"}, {"oid": "75af83d1d0e902aca366c52ee2fc0b032263fa93", "url": "https://github.com/elastic/elasticsearch/commit/75af83d1d0e902aca366c52ee2fc0b032263fa93", "message": "Merge commit 'e483f3270aa75dc0b35ce228fa1f14a7e34c1c53' into domain_name_mandatory_take2", "committedDate": "2020-09-28T13:30:27Z", "type": "commit"}, {"oid": "7e0cd4c2c9ef51b26eff9bc627f00c65a92d1bb5", "url": "https://github.com/elastic/elasticsearch/commit/7e0cd4c2c9ef51b26eff9bc627f00c65a92d1bb5", "message": "Use RealmSettings.AffixSetting", "committedDate": "2020-09-28T13:31:03Z", "type": "commit"}, {"oid": "7e0cd4c2c9ef51b26eff9bc627f00c65a92d1bb5", "url": "https://github.com/elastic/elasticsearch/commit/7e0cd4c2c9ef51b26eff9bc627f00c65a92d1bb5", "message": "Use RealmSettings.AffixSetting", "committedDate": "2020-09-28T13:31:03Z", "type": "forcePushed"}]}