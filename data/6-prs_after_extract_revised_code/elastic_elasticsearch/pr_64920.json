{"pr_number": 64920, "pr_title": "[ML] adds persistent task state reason for anomaly and analytics jobs failing to start", "pr_createdAt": "2020-11-11T13:08:56Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64920", "timeline": [{"oid": "842c7676b66358d418cc983d9d499e8fb901c6ad", "url": "https://github.com/elastic/elasticsearch/commit/842c7676b66358d418cc983d9d499e8fb901c6ad", "message": "[ML] adds persistent task state reason for anomaly and analytics jobs if job fails while waiting to start", "committedDate": "2020-11-11T12:50:30Z", "type": "commit"}, {"oid": "ecf36636c1ce54936687311eadff4210071e2422", "url": "https://github.com/elastic/elasticsearch/commit/ecf36636c1ce54936687311eadff4210071e2422", "message": "Merge branch 'master' into feature/ml-better-job-failure-messaging", "committedDate": "2020-11-11T15:19:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzOTgxMA==", "url": "https://github.com/elastic/elasticsearch/pull/64920#discussion_r521439810", "bodyText": "Can you change the message to include reason only if it is known please.\n\"Unexpected job state [XX] with reason [UNKNOWN]... \" is a message that can only frustrate", "author": "davidkyle", "createdAt": "2020-11-11T15:31:30Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java", "diffHunk": "@@ -309,13 +317,20 @@ public boolean test(PersistentTasksCustomMetadata.PersistentTask<?> persistentTa\n                     node = persistentTask.getExecutorNode();\n                     return true;\n                 case CLOSING:\n-                    exception = ExceptionsHelper.conflictStatusException(\"The job has been \" + JobState.CLOSED + \" while waiting to be \"\n-                            + JobState.OPENED);\n+                    exception = ExceptionsHelper.conflictStatusException(\n+                        \"The job has been {} while waiting to be {}\",\n+                        JobState.CLOSED,\n+                        JobState.OPENED);\n                     return true;\n                 case FAILED:\n                 default:\n-                    exception = ExceptionsHelper.serverError(\"Unexpected job state [\" + jobState\n-                            + \"] while waiting for job to be \" + JobState.OPENED);\n+                    // Default http status is SERVER ERROR\n+                    exception = ExceptionsHelper.serverError(\n+                        \"Unexpected job state [{}] with reason [{}] while waiting for job to be {}\",", "originalCommit": "ecf36636c1ce54936687311eadff4210071e2422", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3a7a02ca1477d3f623a2379349696cfa36923b84", "chunk": "diff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java\nindex 5319bf6f003..751c13fd51a 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java\n\n@@ -326,9 +326,9 @@ public class TransportOpenJobAction extends TransportMasterNodeAction<OpenJobAct\n                 default:\n                     // Default http status is SERVER ERROR\n                     exception = ExceptionsHelper.serverError(\n-                        \"Unexpected job state [{}] with reason [{}] while waiting for job to be {}\",\n+                        \"Unexpected job state [{}] {}while waiting for job to be {}\",\n                         jobState,\n-                        reason,\n+                        reason == null ? \"\" : \"with reason [\" + reason + \"] \",\n                         JobState.OPENED\n                     );\n                     return true;\n"}}, {"oid": "3a7a02ca1477d3f623a2379349696cfa36923b84", "url": "https://github.com/elastic/elasticsearch/commit/3a7a02ca1477d3f623a2379349696cfa36923b84", "message": "addresing pr comments", "committedDate": "2020-11-11T16:55:59Z", "type": "commit"}, {"oid": "26d4caa397dffaa7542964cee2da89f3acf567ea", "url": "https://github.com/elastic/elasticsearch/commit/26d4caa397dffaa7542964cee2da89f3acf567ea", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-better-job-failure-messaging", "committedDate": "2020-11-11T16:56:06Z", "type": "commit"}, {"oid": "ea6faee7ab4132f72c2c0f372b2fc984e3096764", "url": "https://github.com/elastic/elasticsearch/commit/ea6faee7ab4132f72c2c0f372b2fc984e3096764", "message": "Merge branch 'feature/ml-better-job-failure-messaging' of github.com:benwtrent/elasticsearch into feature/ml-better-job-failure-messaging", "committedDate": "2020-11-11T16:56:18Z", "type": "commit"}]}