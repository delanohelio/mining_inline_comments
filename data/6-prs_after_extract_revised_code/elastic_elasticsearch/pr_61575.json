{"pr_number": 61575, "pr_title": "Autoscaling decision return absolute capacity", "pr_createdAt": "2020-08-26T11:45:57Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61575", "timeline": [{"oid": "2decc2a20799484fd041d19a54dc25c0764049c7", "url": "https://github.com/elastic/elasticsearch/commit/2decc2a20799484fd041d19a54dc25c0764049c7", "message": "Autoscaling decision return absolute capacity\n\nThe autoscaling decision API now returns an absolute capacity,\nand leaves the actual decision of whether a scale up or down\nis needed to the orchestration system.\n\nThe decision API now returns both a tier and node level required\nand current capacity as wells as a decider level breakdown of the\nsame.", "committedDate": "2020-08-26T11:43:41Z", "type": "commit"}, {"oid": "6d58686c80f97890d2f26ac47d9d8fc50a689406", "url": "https://github.com/elastic/elasticsearch/commit/6d58686c80f97890d2f26ac47d9d8fc50a689406", "message": "Clarify javadoc", "committedDate": "2020-08-26T14:28:45Z", "type": "commit"}, {"oid": "4ea7ac2f562dd3a6fca0e7a62bfbfb228489cea2", "url": "https://github.com/elastic/elasticsearch/commit/4ea7ac2f562dd3a6fca0e7a62bfbfb228489cea2", "message": "decisions is never empty.", "committedDate": "2020-08-26T20:05:39Z", "type": "commit"}, {"oid": "f828987e921f3b1b8b267afd53268900e315d4cb", "url": "https://github.com/elastic/elasticsearch/commit/f828987e921f3b1b8b267afd53268900e315d4cb", "message": "Slightly nicer ordering", "committedDate": "2020-08-26T20:21:31Z", "type": "commit"}, {"oid": "5eeb11b7d3b701277b31a365a3e65e966ec94087", "url": "https://github.com/elastic/elasticsearch/commit/5eeb11b7d3b701277b31a365a3e65e966ec94087", "message": "Remove unnecessary exception", "committedDate": "2020-08-26T20:22:24Z", "type": "commit"}, {"oid": "4977c03523923490569078bf4698418433cb9803", "url": "https://github.com/elastic/elasticsearch/commit/4977c03523923490569078bf4698418433cb9803", "message": "spotless", "committedDate": "2020-08-26T20:25:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgzOTkxMw==", "url": "https://github.com/elastic/elasticsearch/pull/61575#discussion_r489839913", "bodyText": "I wonder if the name of this should be general from the beginning, something indicating resources like AutoscalingResources?", "author": "jasontedor", "createdAt": "2020-09-17T01:04:46Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingCapacity.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.decision;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.io.stream.Writeable;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.xcontent.ToXContent;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.Objects;\n+\n+/**\n+ * Represents current/required capacity of a single tier.\n+ */\n+public class AutoscalingCapacity implements ToXContent, Writeable {\n+\n+    private final StorageAndMemory tier;", "originalCommit": "4977c03523923490569078bf4698418433cb9803", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTg0MDQ0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/61575#discussion_r489840449", "bodyText": "To be clear, I'm not suggesting that it be a general container, it would still be only storage and memory today, but we'll have CPU later and then we'd rename this to CpuStorageAndMemory? That's what I mean by general, the name only.", "author": "jasontedor", "createdAt": "2020-09-17T01:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgzOTkxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTAxNDc0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/61575#discussion_r491014747", "bodyText": "Yes, that is nicer, chose your name in 7bed89e", "author": "henningandersen", "createdAt": "2020-09-18T15:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgzOTkxMw=="}], "type": "inlineReview", "revised_code": {"commit": "7bed89ea2c27042fd8d036dd0e8358533679a76c", "chunk": "diff --git a/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingCapacity.java b/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingCapacity.java\nindex 0d596524630..6cd9943fc53 100644\n--- a/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingCapacity.java\n+++ b/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingCapacity.java\n\n@@ -22,22 +22,22 @@ import java.util.Objects;\n  */\n public class AutoscalingCapacity implements ToXContent, Writeable {\n \n-    private final StorageAndMemory tier;\n-    private final StorageAndMemory node;\n+    private final AutoscalingResources tier;\n+    private final AutoscalingResources node;\n \n-    public static class StorageAndMemory implements ToXContent, Writeable {\n+    public static class AutoscalingResources implements ToXContent, Writeable {\n         private final ByteSizeValue storage;\n         private final ByteSizeValue memory;\n \n-        public static final StorageAndMemory ZERO = new StorageAndMemory(new ByteSizeValue(0), new ByteSizeValue(0));\n+        public static final AutoscalingResources ZERO = new AutoscalingResources(new ByteSizeValue(0), new ByteSizeValue(0));\n \n-        public StorageAndMemory(ByteSizeValue storage, ByteSizeValue memory) {\n+        public AutoscalingResources(ByteSizeValue storage, ByteSizeValue memory) {\n             assert storage != null || memory != null;\n             this.storage = storage;\n             this.memory = memory;\n         }\n \n-        public StorageAndMemory(StreamInput in) throws IOException {\n+        public AutoscalingResources(StreamInput in) throws IOException {\n             this.storage = in.readOptionalWriteable(ByteSizeValue::new);\n             this.memory = in.readOptionalWriteable(ByteSizeValue::new);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTg0MTgyOA==", "url": "https://github.com/elastic/elasticsearch/pull/61575#discussion_r489841828", "bodyText": "If these are expected to be immutable (i.e., there's never a setter), we have a rather loose guideline that we'd name it summary.", "author": "jasontedor", "createdAt": "2020-09-17T01:07:32Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingDecision.java", "diffHunk": "@@ -16,70 +17,70 @@\n import java.util.Objects;\n \n /**\n- * Represents an autoscaling decision.\n+ * Represents an autoscaling decision from a single decider\n  */\n public class AutoscalingDecision implements ToXContent, Writeable {\n \n-    private final String name;\n+    private final AutoscalingCapacity requiredCapacity;\n+    private final Reason reason;\n \n-    public String name() {\n-        return name;\n+    public interface Reason extends ToXContent, NamedWriteable {\n+        String getSummary();", "originalCommit": "4977c03523923490569078bf4698418433cb9803", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTAxNDQyNw==", "url": "https://github.com/elastic/elasticsearch/pull/61575#discussion_r491014427", "bodyText": "\ud83d\udc4d , fixed in 75e410b", "author": "henningandersen", "createdAt": "2020-09-18T15:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTg0MTgyOA=="}], "type": "inlineReview", "revised_code": {"commit": "75e410b9fad9c4e7a4b5324ee4cb45731af42a04", "chunk": "diff --git a/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingDecision.java b/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingDecision.java\nindex 9133e3a379c..509f3416eb2 100644\n--- a/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingDecision.java\n+++ b/x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/decision/AutoscalingDecision.java\n\n@@ -25,7 +25,7 @@ public class AutoscalingDecision implements ToXContent, Writeable {\n     private final Reason reason;\n \n     public interface Reason extends ToXContent, NamedWriteable {\n-        String getSummary();\n+        String summary();\n     }\n \n     /**\n"}}, {"oid": "e5414f072d4387fbceb0578d70da518f9f3d6b4b", "url": "https://github.com/elastic/elasticsearch/commit/e5414f072d4387fbceb0578d70da518f9f3d6b4b", "message": "Merge remote-tracking branch 'origin/master' into enhance_autoscaling_decision_absolute_numbers", "committedDate": "2020-09-18T14:22:15Z", "type": "commit"}, {"oid": "75e410b9fad9c4e7a4b5324ee4cb45731af42a04", "url": "https://github.com/elastic/elasticsearch/commit/75e410b9fad9c4e7a4b5324ee4cb45731af42a04", "message": "Follow non-get convention for summary.", "committedDate": "2020-09-18T14:31:30Z", "type": "commit"}, {"oid": "7bed89ea2c27042fd8d036dd0e8358533679a76c", "url": "https://github.com/elastic/elasticsearch/commit/7bed89ea2c27042fd8d036dd0e8358533679a76c", "message": "Rename StorageAndMemory to AutoscalingResources", "committedDate": "2020-09-18T15:06:35Z", "type": "commit"}]}