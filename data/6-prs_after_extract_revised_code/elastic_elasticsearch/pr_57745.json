{"pr_number": 57745, "pr_title": "Add description to submit and get async search, as well as cancel tasks", "pr_createdAt": "2020-06-05T15:51:58Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57745", "timeline": [{"oid": "073b53d8a68a9be2eeea4770b70c2b030c681369", "url": "https://github.com/elastic/elasticsearch/commit/073b53d8a68a9be2eeea4770b70c2b030c681369", "message": "Add description to submit and get async search, as well as cancel tasks\n\nThis makes it easier to debug where such tasks come from in case they are returned from the get tasks API.\n\nAlso renamed the last occurrence of waitForCompletion to waitForCompletionTimeout in get async search request.", "committedDate": "2020-06-05T15:50:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxNTg4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/57745#discussion_r436015887", "bodyText": "SubmitAsyncSearchRequest should also override  getDescription  ?", "author": "jimczi", "createdAt": "2020-06-05T15:59:40Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/search/action/SubmitAsyncSearchRequest.java", "diffHunk": "@@ -157,6 +157,15 @@ public boolean shouldCancelChildrenOnCancellation() {\n                 // we cancel the underlying search action explicitly in the submit action\n                 return false;\n             }\n+\n+            @Override\n+            public String getDescription() {\n+                // generating description in a lazy way since source can be quite big\n+                return \"waitForCompletionTimeout[\" + waitForCompletionTimeout +\n+                    \"], keepOnCompletion[\" + keepOnCompletion +\n+                    \"] keepAlive[\" + keepAlive +\n+                    \"], request=\" + request.getDescription();", "originalCommit": "073b53d8a68a9be2eeea4770b70c2b030c681369", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAyMjU2NA==", "url": "https://github.com/elastic/elasticsearch/pull/57745#discussion_r436022564", "bodyText": "ehm, actually, what I did is not needed for submit, because we already provide the description to createTask, which is the result of submit#toString, which holds the same info that I meant to add. So nothing to do for submit unless we want to generate the description in a lazy way like search does.", "author": "javanna", "createdAt": "2020-06-05T16:11:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxNTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1NjIyNA==", "url": "https://github.com/elastic/elasticsearch/pull/57745#discussion_r436056224", "bodyText": "let's do it lazily since we print the request too ?", "author": "jimczi", "createdAt": "2020-06-05T17:18:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxNTg4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c56b3b54b61e55052c420a85691057669871ff69", "chunk": "diff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/search/action/SubmitAsyncSearchRequest.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/search/action/SubmitAsyncSearchRequest.java\nindex 25f2622f2ee..f7459c84880 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/search/action/SubmitAsyncSearchRequest.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/search/action/SubmitAsyncSearchRequest.java\n\n@@ -151,7 +151,7 @@ public class SubmitAsyncSearchRequest extends ActionRequest {\n \n     @Override\n     public Task createTask(long id, String type, String action, TaskId parentTaskId, Map<String, String> headers) {\n-        return new CancellableTask(id, type, action, toString(), parentTaskId, headers) {\n+        return new CancellableTask(id, type, action, null, parentTaskId, headers) {\n             @Override\n             public boolean shouldCancelChildrenOnCancellation() {\n                 // we cancel the underlying search action explicitly in the submit action\n"}}, {"oid": "c56b3b54b61e55052c420a85691057669871ff69", "url": "https://github.com/elastic/elasticsearch/commit/c56b3b54b61e55052c420a85691057669871ff69", "message": "add tests and make submit description work", "committedDate": "2020-06-05T18:42:12Z", "type": "commit"}]}