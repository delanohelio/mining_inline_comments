{"pr_number": 58281, "pr_title": "Minimum node version check before creating data stream", "pr_createdAt": "2020-06-17T18:41:34Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58281", "timeline": [{"oid": "ed0b0911d5372b486752e24d35f5128dd7050e8e", "url": "https://github.com/elastic/elasticsearch/commit/ed0b0911d5372b486752e24d35f5128dd7050e8e", "message": "ensure all nodes are 7.9+ before permitting creation of data stream", "committedDate": "2020-06-17T18:39:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxMjgzMg==", "url": "https://github.com/elastic/elasticsearch/pull/58281#discussion_r442012832", "bodyText": "I think check is a bit clearer: currentState.nodes().getMinNodeVersion().before(Version.V_8_0_0)", "author": "martijnvg", "createdAt": "2020-06-18T07:09:01Z", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -121,6 +122,10 @@ public CreateDataStreamClusterStateUpdateRequest(String name,\n     static ClusterState createDataStream(MetadataCreateIndexService metadataCreateIndexService,\n                                          ClusterState currentState,\n                                          CreateDataStreamClusterStateUpdateRequest request) throws Exception {\n+        if (currentState.nodes().getMinNodeVersion().compareTo(Version.V_8_0_0) < 0) {", "originalCommit": "ed0b0911d5372b486752e24d35f5128dd7050e8e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1138abb49b32b37136ed13d722f8a9622c58618a", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java b/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java\nindex b2d0057f8cca..59c5c408fa0e 100644\n--- a/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java\n+++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java\n\n@@ -122,7 +122,7 @@ public class MetadataCreateDataStreamService {\n     static ClusterState createDataStream(MetadataCreateIndexService metadataCreateIndexService,\n                                          ClusterState currentState,\n                                          CreateDataStreamClusterStateUpdateRequest request) throws Exception {\n-        if (currentState.nodes().getMinNodeVersion().compareTo(Version.V_8_0_0) < 0) {\n+        if (currentState.nodes().getMinNodeVersion().before(Version.V_8_0_0)) {\n             throw new IllegalStateException(\"data streams require minimum node version of \" + Version.V_8_0_0);\n         }\n \n"}}, {"oid": "1138abb49b32b37136ed13d722f8a9622c58618a", "url": "https://github.com/elastic/elasticsearch/commit/1138abb49b32b37136ed13d722f8a9622c58618a", "message": "simplify version check", "committedDate": "2020-06-19T14:30:22Z", "type": "commit"}, {"oid": "5d178713b15310f97152d34db901c0a43409f8a5", "url": "https://github.com/elastic/elasticsearch/commit/5d178713b15310f97152d34db901c0a43409f8a5", "message": "Merge branch 'master' into min_version_check", "committedDate": "2020-06-19T14:47:48Z", "type": "commit"}]}