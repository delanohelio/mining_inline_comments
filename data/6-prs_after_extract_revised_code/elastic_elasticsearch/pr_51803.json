{"pr_number": 51803, "pr_title": "Increase disruption test publish timeout to 5s", "pr_createdAt": "2020-02-03T10:53:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51803", "timeline": [{"oid": "32c30c989ff4b4141a40a81da3594a1448a4e9cb", "url": "https://github.com/elastic/elasticsearch/commit/32c30c989ff4b4141a40a81da3594a1448a4e9cb", "message": "Increase disruption publish timeout to 5s\n\nWith the new mechanism for storing cluster state in lucene, we store\nindex metadata in multiple data paths too. This causes cluster state\npublish to timeout too frequently with a 1s timeout, so increasing it to\n5s.\n\nCloses #51329", "committedDate": "2020-02-03T10:46:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NDMxMA==", "url": "https://github.com/elastic/elasticsearch/pull/51803#discussion_r374044310", "bodyText": "I think we should do the same for the follower check, which is also racing publication and can depend on writing out state. For full symmetry, perhaps also for leader check.", "author": "ywelsch", "createdAt": "2020-02-03T11:10:15Z", "path": "server/src/test/java/org/elasticsearch/discovery/AbstractDisruptionTestCase.java", "diffHunk": "@@ -128,7 +128,7 @@ protected void beforeIndexDeletion() throws Exception {\n             .put(FollowersChecker.FOLLOWER_CHECK_TIMEOUT_SETTING.getKey(), \"1s\") // for hitting simulated network failures quickly\n             .put(FollowersChecker.FOLLOWER_CHECK_RETRY_COUNT_SETTING.getKey(), 1) // for hitting simulated network failures quickly\n             .put(JoinHelper.JOIN_TIMEOUT_SETTING.getKey(), \"10s\") // still long to induce failures but to long so test won't time out\n-            .put(Coordinator.PUBLISH_TIMEOUT_SETTING.getKey(), \"1s\") // <-- for hitting simulated network failures quickly\n+            .put(Coordinator.PUBLISH_TIMEOUT_SETTING.getKey(), \"5s\") // <-- for hitting simulated network failures quickly", "originalCommit": "32c30c989ff4b4141a40a81da3594a1448a4e9cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1MzY2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51803#discussion_r374053666", "bodyText": "Fixed here 3163f62", "author": "henningandersen", "createdAt": "2020-02-03T11:33:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NDMxMA=="}], "type": "inlineReview", "revised_code": {"commit": "3163f62c1587691013261b086d76ec4a9cc85e2c", "chunk": "diff --git a/server/src/test/java/org/elasticsearch/discovery/AbstractDisruptionTestCase.java b/server/src/test/java/org/elasticsearch/discovery/AbstractDisruptionTestCase.java\nindex 22fb666cf4d..a411b7a4fcf 100644\n--- a/server/src/test/java/org/elasticsearch/discovery/AbstractDisruptionTestCase.java\n+++ b/server/src/test/java/org/elasticsearch/discovery/AbstractDisruptionTestCase.java\n\n@@ -123,9 +123,9 @@ public abstract class AbstractDisruptionTestCase extends ESIntegTestCase {\n     }\n \n     static final Settings DEFAULT_SETTINGS = Settings.builder()\n-            .put(LeaderChecker.LEADER_CHECK_TIMEOUT_SETTING.getKey(), \"1s\") // for hitting simulated network failures quickly\n+            .put(LeaderChecker.LEADER_CHECK_TIMEOUT_SETTING.getKey(), \"5s\") // for hitting simulated network failures quickly\n             .put(LeaderChecker.LEADER_CHECK_RETRY_COUNT_SETTING.getKey(), 1) // for hitting simulated network failures quickly\n-            .put(FollowersChecker.FOLLOWER_CHECK_TIMEOUT_SETTING.getKey(), \"1s\") // for hitting simulated network failures quickly\n+            .put(FollowersChecker.FOLLOWER_CHECK_TIMEOUT_SETTING.getKey(), \"5s\") // for hitting simulated network failures quickly\n             .put(FollowersChecker.FOLLOWER_CHECK_RETRY_COUNT_SETTING.getKey(), 1) // for hitting simulated network failures quickly\n             .put(JoinHelper.JOIN_TIMEOUT_SETTING.getKey(), \"10s\") // still long to induce failures but to long so test won't time out\n             .put(Coordinator.PUBLISH_TIMEOUT_SETTING.getKey(), \"5s\") // <-- for hitting simulated network failures quickly\n"}}, {"oid": "3163f62c1587691013261b086d76ec4a9cc85e2c", "url": "https://github.com/elastic/elasticsearch/commit/3163f62c1587691013261b086d76ec4a9cc85e2c", "message": "More 5s timeouts.", "committedDate": "2020-02-03T11:31:31Z", "type": "commit"}]}