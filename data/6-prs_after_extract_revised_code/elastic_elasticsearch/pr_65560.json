{"pr_number": 65560, "pr_title": "Make runtime fields highlightable", "pr_createdAt": "2020-11-26T16:57:17Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65560", "timeline": [{"oid": "48bf4b683f786e68c8576b2abaa2cdfad08dfe68", "url": "https://github.com/elastic/elasticsearch/commit/48bf4b683f786e68c8576b2abaa2cdfad08dfe68", "message": "Use ValueFetcher when loading text snippets to highlight", "committedDate": "2020-10-12T17:55:50Z", "type": "commit"}, {"oid": "36469e3966afc9ee9282bd8b974601de03a3bdb3", "url": "https://github.com/elastic/elasticsearch/commit/36469e3966afc9ee9282bd8b974601de03a3bdb3", "message": "Add back stored-fields branch", "committedDate": "2020-10-13T07:58:14Z", "type": "commit"}, {"oid": "972a635210ce44c8c50bf9fcd0e296e8622063a7", "url": "https://github.com/elastic/elasticsearch/commit/972a635210ce44c8c50bf9fcd0e296e8622063a7", "message": "Merge remote-tracking branch 'origin/master' into highlight/fetcher", "committedDate": "2020-10-13T07:58:29Z", "type": "commit"}, {"oid": "5b72b8bddcbe09cc6c73a19cba497485090a4e97", "url": "https://github.com/elastic/elasticsearch/commit/5b72b8bddcbe09cc6c73a19cba497485090a4e97", "message": "Merge remote-tracking branch 'origin/master' into highlight/fetcher", "committedDate": "2020-11-19T14:19:19Z", "type": "commit"}, {"oid": "a3baf24b5eba540425f2fc0e550339f72b08d49e", "url": "https://github.com/elastic/elasticsearch/commit/a3baf24b5eba540425f2fc0e550339f72b08d49e", "message": "Check for nulls in tokencount", "committedDate": "2020-11-19T14:27:41Z", "type": "commit"}, {"oid": "1c28877ca19adbb799d58139d345b4874df27e4b", "url": "https://github.com/elastic/elasticsearch/commit/1c28877ca19adbb799d58139d345b4874df27e4b", "message": "test for copy_to highlighting; check *all* source paths", "committedDate": "2020-11-19T14:50:40Z", "type": "commit"}, {"oid": "2ea506de64a10a5bd3c56c126d4204f166a5d086", "url": "https://github.com/elastic/elasticsearch/commit/2ea506de64a10a5bd3c56c126d4204f166a5d086", "message": "Merge remote-tracking branch 'origin/master' into highlight/fetcher", "committedDate": "2020-11-23T15:16:01Z", "type": "commit"}, {"oid": "0b3ecee4c4b47cb4529cbae29df4b89dd9473cff", "url": "https://github.com/elastic/elasticsearch/commit/0b3ecee4c4b47cb4529cbae29df4b89dd9473cff", "message": "Call it forceSource again", "committedDate": "2020-11-23T15:20:08Z", "type": "commit"}, {"oid": "70e68809a342eb7531852c24c7935d28359965d6", "url": "https://github.com/elastic/elasticsearch/commit/70e68809a342eb7531852c24c7935d28359965d6", "message": "change test expectation", "committedDate": "2020-11-23T15:41:06Z", "type": "commit"}, {"oid": "dc7585591e0957937d29929f123b36983d002d10", "url": "https://github.com/elastic/elasticsearch/commit/dc7585591e0957937d29929f123b36983d002d10", "message": "Merge remote-tracking branch 'origin/master' into highlight/fetcher", "committedDate": "2020-11-24T13:48:52Z", "type": "commit"}, {"oid": "daa4dd1fc618b6ada96c0247a3fec247b15f35e8", "url": "https://github.com/elastic/elasticsearch/commit/daa4dd1fc618b6ada96c0247a3fec247b15f35e8", "message": "Add failing test - still need to fix it", "committedDate": "2020-11-25T10:00:41Z", "type": "commit"}, {"oid": "07767a7fe4ac2bdd7d8a78c24fbc735d72bd291b", "url": "https://github.com/elastic/elasticsearch/commit/07767a7fe4ac2bdd7d8a78c24fbc735d72bd291b", "message": "Allow configurable unmapped field index analyzer", "committedDate": "2020-11-26T13:17:21Z", "type": "commit"}, {"oid": "650617a739efca421a9ac55414bdd072fa734d0e", "url": "https://github.com/elastic/elasticsearch/commit/650617a739efca421a9ac55414bdd072fa734d0e", "message": "Merge remote-tracking branch 'origin/master' into runtime/highlights", "committedDate": "2020-11-26T14:16:31Z", "type": "commit"}, {"oid": "28d7f65929d01a59b6e40ec84987fd55b2bc5600", "url": "https://github.com/elastic/elasticsearch/commit/28d7f65929d01a59b6e40ec84987fd55b2bc5600", "message": "Add note re DocValuesFetchers not working", "committedDate": "2020-11-26T14:18:44Z", "type": "commit"}, {"oid": "c40d8069e1be1bc2eabcff2d696db4f33faf7ded", "url": "https://github.com/elastic/elasticsearch/commit/c40d8069e1be1bc2eabcff2d696db4f33faf7ded", "message": "duh", "committedDate": "2020-11-26T15:43:49Z", "type": "commit"}, {"oid": "6f5c80b9451bf3ba302acf4930c6f74cfc965baa", "url": "https://github.com/elastic/elasticsearch/commit/6f5c80b9451bf3ba302acf4930c6f74cfc965baa", "message": "Merge remote-tracking branch 'origin/master' into runtime/highlights", "committedDate": "2020-11-26T15:43:56Z", "type": "commit"}, {"oid": "a8c88c1bd2030f199621e43dd1e9c58bc6cd6204", "url": "https://github.com/elastic/elasticsearch/commit/a8c88c1bd2030f199621e43dd1e9c58bc6cd6204", "message": "remove comment", "committedDate": "2020-11-26T15:46:49Z", "type": "commit"}, {"oid": "b3d7a0a60b84c4000a2f13e3d346ea1ea701a6a3", "url": "https://github.com/elastic/elasticsearch/commit/b3d7a0a60b84c4000a2f13e3d346ea1ea701a6a3", "message": "MLT analyzer equals check", "committedDate": "2020-11-26T16:50:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE1NzYyMg==", "url": "https://github.com/elastic/elasticsearch/pull/65560#discussion_r531157622", "bodyText": "Maybe rename unmappedFieldAnalyzer into defaultAnalyzer ? That feels wrong to rely on something called unmapped for runtime fields ?", "author": "jimczi", "createdAt": "2020-11-26T17:17:52Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -445,8 +445,19 @@ public Analyzer indexAnalyzer() {\n         return this.indexAnalyzer;\n     }\n \n+    public NamedAnalyzer indexAnalyzer(String field, Function<String, NamedAnalyzer> unmappedFieldAnalyzer) {", "originalCommit": "b3d7a0a60b84c4000a2f13e3d346ea1ea701a6a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE1Nzc1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/65560#discussion_r531157753", "bodyText": "Can you also add javadoc for the function ?", "author": "jimczi", "createdAt": "2020-11-26T17:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE1NzYyMg=="}], "type": "inlineReview", "revised_code": {"commit": "5d24448049dccfc663c68fa8a73c572c3222d5b4", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java b/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java\nindex 8741eb8bc29..f7ba7b67f2b 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java\n\n@@ -445,11 +445,17 @@ public class MapperService extends AbstractIndexComponent implements Closeable {\n         return this.indexAnalyzer;\n     }\n \n-    public NamedAnalyzer indexAnalyzer(String field, Function<String, NamedAnalyzer> unmappedFieldAnalyzer) {\n+    /**\n+     * Return the index-time analyzer associated with a particular field\n+     * @param field                     the field name\n+     * @param unindexedFieldAnalyzer    a function to return an Analyzer for a field with no\n+     *                                  directly associated index-time analyzer\n+     */\n+    public NamedAnalyzer indexAnalyzer(String field, Function<String, NamedAnalyzer> unindexedFieldAnalyzer) {\n         if (this.mapper == null) {\n-            return unmappedFieldAnalyzer.apply(field);\n+            return unindexedFieldAnalyzer.apply(field);\n         }\n-        return this.mapper.mappers().indexAnalyzer(field, unmappedFieldAnalyzer);\n+        return this.mapper.mappers().indexAnalyzer(field, unindexedFieldAnalyzer);\n     }\n \n     public boolean containsBrokenAnalysis(String field) {\n"}}, {"oid": "5d24448049dccfc663c68fa8a73c572c3222d5b4", "url": "https://github.com/elastic/elasticsearch/commit/5d24448049dccfc663c68fa8a73c572c3222d5b4", "message": "javadoc; fix test", "committedDate": "2020-11-26T18:43:14Z", "type": "commit"}]}