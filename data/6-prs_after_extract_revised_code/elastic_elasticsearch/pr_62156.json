{"pr_number": 62156, "pr_title": "Populate data stream fields when xOpaqueId not provided", "pr_createdAt": "2020-09-09T10:16:54Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62156", "timeline": [{"oid": "7ea16b1276874b2c5a486c0c4fa0b9df7625e04c", "url": "https://github.com/elastic/elasticsearch/commit/7ea16b1276874b2c5a486c0c4fa0b9df7625e04c", "message": "Populate data stream fields when xOpaqueId not provided\n\ndatastream related fields should be always be provided.\nmessage field is already set with a lazy value (Object.toString) within\nESLogMessage", "committedDate": "2020-09-09T10:15:07Z", "type": "commit"}, {"oid": "7c69c67c92ccca98460f1b8922532c58a7596602", "url": "https://github.com/elastic/elasticsearch/commit/7c69c67c92ccca98460f1b8922532c58a7596602", "message": "tests", "committedDate": "2020-09-09T11:42:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0ODAyNA==", "url": "https://github.com/elastic/elasticsearch/pull/62156#discussion_r485548024", "bodyText": "Should we check for the presence of key here?", "author": "pugnascotia", "createdAt": "2020-09-09T11:48:05Z", "path": "qa/logging-config/src/test/java/org/elasticsearch/common/logging/JsonLoggerTests.java", "diffHunk": "@@ -203,22 +202,17 @@ public void testDeprecatedMessageWithoutXOpaqueId() throws IOException {\n                     hasEntry(\"cluster.name\", \"elasticsearch\"),\n                     hasEntry(\"node.name\", \"sample-name\"),\n                     hasEntry(\"message\", \"deprecated message1\"),\n-                    not(hasKey(\"x-opaque-id\"))\n-                ),\n-                allOf(\n-                    hasEntry(\"type\", \"deprecation\"),\n-                    hasEntry(\"log.level\", \"DEPRECATION\"),\n-                    hasEntry(\"log.logger\", \"deprecation.test\"),\n-                    hasEntry(\"cluster.name\", \"elasticsearch\"),\n-                    hasEntry(\"node.name\", \"sample-name\"),\n-                    hasEntry(\"message\", \"deprecated message2\"),\n+                    hasEntry(\"data_stream.type\", \"logs\"),\n+                    hasEntry(\"data_stream.datatype\", \"deprecation\"),\n+                    hasEntry(\"data_stream.namespace\", \"elasticsearch\"),\n+                    hasEntry(\"ecs.version\", DeprecatedMessage.ECS_VERSION),", "originalCommit": "7c69c67c92ccca98460f1b8922532c58a7596602", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1NDA4OA==", "url": "https://github.com/elastic/elasticsearch/pull/62156#discussion_r485554088", "bodyText": "yes, will add - missed it", "author": "pgomulka", "createdAt": "2020-09-09T11:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0ODAyNA=="}], "type": "inlineReview", "revised_code": {"commit": "0efc7a62583a0865c202e1b565e5df970b30a74e", "chunk": "diff --git a/qa/logging-config/src/test/java/org/elasticsearch/common/logging/JsonLoggerTests.java b/qa/logging-config/src/test/java/org/elasticsearch/common/logging/JsonLoggerTests.java\nindex f9b30b6d14e..1a1ee8b8a26 100644\n--- a/qa/logging-config/src/test/java/org/elasticsearch/common/logging/JsonLoggerTests.java\n+++ b/qa/logging-config/src/test/java/org/elasticsearch/common/logging/JsonLoggerTests.java\n\n@@ -206,6 +207,7 @@ public class JsonLoggerTests extends ESTestCase {\n                     hasEntry(\"data_stream.datatype\", \"deprecation\"),\n                     hasEntry(\"data_stream.namespace\", \"elasticsearch\"),\n                     hasEntry(\"ecs.version\", DeprecatedMessage.ECS_VERSION),\n+                    hasEntry(\"key\", \"a key\"),\n                     not(hasKey(\"x-opaque-id\"))\n                 )\n                 )\n"}}, {"oid": "0efc7a62583a0865c202e1b565e5df970b30a74e", "url": "https://github.com/elastic/elasticsearch/commit/0efc7a62583a0865c202e1b565e5df970b30a74e", "message": "missing key assertion", "committedDate": "2020-09-09T11:59:44Z", "type": "commit"}, {"oid": "3d392b3a3a0022c6ea1d373ff0241a05dd041b7e", "url": "https://github.com/elastic/elasticsearch/commit/3d392b3a3a0022c6ea1d373ff0241a05dd041b7e", "message": "fix test", "committedDate": "2020-09-14T15:02:34Z", "type": "commit"}, {"oid": "576053e3b5aefff357261fca714f51863474ac66", "url": "https://github.com/elastic/elasticsearch/commit/576053e3b5aefff357261fca714f51863474ac66", "message": "Merge branch 'master' into logs/deprecation", "committedDate": "2020-09-15T06:47:00Z", "type": "commit"}]}