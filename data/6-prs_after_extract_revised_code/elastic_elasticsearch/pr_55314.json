{"pr_number": 55314, "pr_title": "Retry follow task when remote connection queue full", "pr_createdAt": "2020-04-16T14:48:05Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55314", "timeline": [{"oid": "8def9225b33106d239f11d4488f7c405e929aba9", "url": "https://github.com/elastic/elasticsearch/commit/8def9225b33106d239f11d4488f7c405e929aba9", "message": "Retry follow task when remote connection queue full", "committedDate": "2020-04-16T14:42:23Z", "type": "commit"}, {"oid": "8e911a4aff093dcd95eaa45c62ec615f7f532f66", "url": "https://github.com/elastic/elasticsearch/commit/8e911a4aff093dcd95eaa45c62ec615f7f532f66", "message": "Merge branch 'master' into remote-connect-queue", "committedDate": "2020-04-16T16:06:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcwOTk2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/55314#discussion_r409709961", "bodyText": "I don't think there was a lot of thought to the connection listener limit. If there is a strong reason to increase it past 100 we could probably do that. Also does does this name make sense? We only allow a single connection round at a time. Should the name be cluster.remote.max_pending_connection_listeners?", "author": "tbrooks8", "createdAt": "2020-04-16T16:59:31Z", "path": "server/src/main/java/org/elasticsearch/transport/RemoteConnectionStrategy.java", "diffHunk": "@@ -105,10 +105,14 @@ public int getNumberOfChannels() {\n             Setting.Property.NodeScope,\n             Setting.Property.Dynamic));\n \n+    // this setting is intentionally not registered, it is only used in tests\n+    public static final Setting<Integer> REMOTE_MAX_CONNECTION_QUEUE_SIZE =\n+        Setting.intSetting(\"cluster.remote.max_connection_queue_size\", 100, Setting.Property.NodeScope);", "originalCommit": "8e911a4aff093dcd95eaa45c62ec615f7f532f66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcyODYwNw==", "url": "https://github.com/elastic/elasticsearch/pull/55314#discussion_r409728607", "bodyText": "Should the name be cluster.remote.max_pending_connection_listeners?\n\n++. I renamed it in f9c807f.\n\nI don't think there was a lot of thought to the connection listener limit. If there is a strong reason to increase it past 100 we could probably do that.\n\nYeah, I think we chose this value quite arbitrarily. I think it's fine to increase this value as we should not have many concurrent remote searches, and CCR will retry on this error anyway. I've increased this to 1000. WDYT?", "author": "dnhatn", "createdAt": "2020-04-16T17:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcwOTk2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f9c807f7a1b1acd387b8f3901941a8bc5ad5842e", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/transport/RemoteConnectionStrategy.java b/server/src/main/java/org/elasticsearch/transport/RemoteConnectionStrategy.java\nindex 8651a83793d..f72f9cdda23 100644\n--- a/server/src/main/java/org/elasticsearch/transport/RemoteConnectionStrategy.java\n+++ b/server/src/main/java/org/elasticsearch/transport/RemoteConnectionStrategy.java\n\n@@ -106,10 +106,10 @@ public abstract class RemoteConnectionStrategy implements TransportConnectionLis\n             Setting.Property.Dynamic));\n \n     // this setting is intentionally not registered, it is only used in tests\n-    public static final Setting<Integer> REMOTE_MAX_CONNECTION_QUEUE_SIZE =\n-        Setting.intSetting(\"cluster.remote.max_connection_queue_size\", 100, Setting.Property.NodeScope);\n+    public static final Setting<Integer> REMOTE_MAX_PENDING_CONNECTION_LISTENERS =\n+        Setting.intSetting(\"cluster.remote.max_pending_connection_listeners\", 100, Setting.Property.NodeScope);\n \n-    private final int maxConnectionQueueSize;\n+    private final int maxPendingConnectionListeners;\n \n     private static final Logger logger = LogManager.getLogger(RemoteConnectionStrategy.class);\n \n"}}, {"oid": "f9c807f7a1b1acd387b8f3901941a8bc5ad5842e", "url": "https://github.com/elastic/elasticsearch/commit/f9c807f7a1b1acd387b8f3901941a8bc5ad5842e", "message": "rename to max_pending_connection_listeners", "committedDate": "2020-04-16T17:23:59Z", "type": "commit"}, {"oid": "6c3e803e3f9f3ec33a47965b85e3d2c3b4ead31d", "url": "https://github.com/elastic/elasticsearch/commit/6c3e803e3f9f3ec33a47965b85e3d2c3b4ead31d", "message": "increase to 1k", "committedDate": "2020-04-16T17:24:31Z", "type": "commit"}]}