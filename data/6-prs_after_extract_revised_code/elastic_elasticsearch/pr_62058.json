{"pr_number": 62058, "pr_title": "Convert RangeFieldMapper to parametrized form", "pr_createdAt": "2020-09-07T13:09:31Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62058", "timeline": [{"oid": "4efcbd525dd3e589e655b263d66561e7b15693c4", "url": "https://github.com/elastic/elasticsearch/commit/4efcbd525dd3e589e655b263d66561e7b15693c4", "message": "Convert RangeFieldMapper to parametrized form", "committedDate": "2020-09-07T13:06:43Z", "type": "commit"}, {"oid": "455dce213b5338679964affaaf3182be97363138", "url": "https://github.com/elastic/elasticsearch/commit/455dce213b5338679964affaaf3182be97363138", "message": "Merge branch 'master' into mapper/rangefield", "committedDate": "2020-09-07T13:31:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NDUxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/62058#discussion_r484444511", "bodyText": "Should this just be a BooleanSupplier? If includeDefaults is false would you ever include it?", "author": "nik9000", "createdAt": "2020-09-07T13:52:33Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java", "diffHunk": "@@ -145,6 +146,7 @@ protected final void doXContentBody(XContentBuilder builder, boolean includeDefa\n         private boolean acceptsNull = false;\n         private Consumer<T> validator = null;\n         private Serializer<T> serializer = XContentBuilder::field;\n+        private Predicate<Boolean> serializerPredicate = id -> true;", "originalCommit": "455dce213b5338679964affaaf3182be97363138", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NTAwNA==", "url": "https://github.com/elastic/elasticsearch/pull/62058#discussion_r484445004", "bodyText": "It feels weird to make it a Predicate because it isn't really a predicate on the boolean, it is a predicate on the state of the field mapper.", "author": "nik9000", "createdAt": "2020-09-07T13:53:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NDUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ1NzMyNg==", "url": "https://github.com/elastic/elasticsearch/pull/62058#discussion_r484457326", "bodyText": "You're quite right, have updated.", "author": "romseygeek", "createdAt": "2020-09-07T14:14:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NDUxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "7b9a52a754a65f1901da6fe8c3acbb2f23b0d49b", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java\nindex 34603098ca8..c51795bc5b3 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java\n\n@@ -146,7 +147,7 @@ public abstract class ParametrizedFieldMapper extends FieldMapper {\n         private boolean acceptsNull = false;\n         private Consumer<T> validator = null;\n         private Serializer<T> serializer = XContentBuilder::field;\n-        private Predicate<Boolean> serializerPredicate = id -> true;\n+        private BooleanSupplier serializerPredicate = () -> true;\n         private Function<T, String> conflictSerializer = Object::toString;\n         private T value;\n         private boolean isSet;\n"}}, {"oid": "d4d627d6fce01163aa4cb43899fd18592cd3d2f8", "url": "https://github.com/elastic/elasticsearch/commit/d4d627d6fce01163aa4cb43899fd18592cd3d2f8", "message": "Convert RangeFieldMapper to parametrized form", "committedDate": "2020-09-07T14:06:56Z", "type": "commit"}, {"oid": "7b9a52a754a65f1901da6fe8c3acbb2f23b0d49b", "url": "https://github.com/elastic/elasticsearch/commit/7b9a52a754a65f1901da6fe8c3acbb2f23b0d49b", "message": "use booleansupplier", "committedDate": "2020-09-07T14:10:22Z", "type": "commit"}, {"oid": "ad40917758564ad2fbc55e34ced4afbcc9f6b45c", "url": "https://github.com/elastic/elasticsearch/commit/ad40917758564ad2fbc55e34ced4afbcc9f6b45c", "message": "Merge remote-tracking branch 'romseygeek/mapper/rangefield' into mapper/rangefield", "committedDate": "2020-09-07T14:12:30Z", "type": "commit"}, {"oid": "12fe03ddf8dc4e3e92b586d9bd8221d8f2d2a77c", "url": "https://github.com/elastic/elasticsearch/commit/12fe03ddf8dc4e3e92b586d9bd8221d8f2d2a77c", "message": "sake", "committedDate": "2020-09-07T14:29:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg3NDg4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/62058#discussion_r484874886", "bodyText": "Maybe change the name of this method? shouldSerializeDefault or something?", "author": "nik9000", "createdAt": "2020-09-08T12:25:01Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java", "diffHunk": "@@ -229,6 +231,16 @@ public boolean isConfigured() {\n             return this;\n         }\n \n+        /**\n+         * Set a serialization predicate for this parameter.\n+         *\n+         * The predicate is passed the value of `include_defaults`\n+         */\n+        public Parameter<T> setSerializerPredicate(BooleanSupplier serializerPredicate) {", "originalCommit": "12fe03ddf8dc4e3e92b586d9bd8221d8f2d2a77c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg4NDI4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/62058#discussion_r484884283", "bodyText": "++, I've changed it to setShouldSerialize and made the javadoc a bit clearer.", "author": "romseygeek", "createdAt": "2020-09-08T12:41:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg3NDg4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "794448035c3024bacbfd24760a8517d6715a9f74", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java\nindex 9cb0dc392ae..53b612cd453 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/ParametrizedFieldMapper.java\n\n@@ -232,12 +232,11 @@ public abstract class ParametrizedFieldMapper extends FieldMapper {\n         }\n \n         /**\n-         * Set a serialization predicate for this parameter.\n-         *\n-         * The predicate is passed the value of `include_defaults`\n+         * Sets an additional check on whether or not this parameter should be serialized,\n+         * after the existing 'set' and 'include_defaults' checks.\n          */\n-        public Parameter<T> setSerializerPredicate(BooleanSupplier serializerPredicate) {\n-            this.serializerPredicate = serializerPredicate;\n+        public Parameter<T> setShouldSerialize(BooleanSupplier shouldSerialize) {\n+            this.serializerPredicate = shouldSerialize;\n             return this;\n         }\n \n"}}, {"oid": "2077fe3caaabe8cb1a12ea264b21aded382321a6", "url": "https://github.com/elastic/elasticsearch/commit/2077fe3caaabe8cb1a12ea264b21aded382321a6", "message": "Merge remote-tracking branch 'origin/master' into mapper/rangefield", "committedDate": "2020-09-08T12:36:55Z", "type": "commit"}, {"oid": "794448035c3024bacbfd24760a8517d6715a9f74", "url": "https://github.com/elastic/elasticsearch/commit/794448035c3024bacbfd24760a8517d6715a9f74", "message": "names are hard", "committedDate": "2020-09-08T12:40:44Z", "type": "commit"}, {"oid": "21928199cd09efaab029026e6beeb0e43a59d048", "url": "https://github.com/elastic/elasticsearch/commit/21928199cd09efaab029026e6beeb0e43a59d048", "message": "Merge branch 'master' into mapper/rangefield", "committedDate": "2020-09-08T13:55:33Z", "type": "commit"}, {"oid": "af1dc62ed2d7488bd98b9ef5fbb89317f38b6b24", "url": "https://github.com/elastic/elasticsearch/commit/af1dc62ed2d7488bd98b9ef5fbb89317f38b6b24", "message": "Merge branch 'master' into mapper/rangefield", "committedDate": "2020-09-08T15:37:04Z", "type": "commit"}, {"oid": "45141d10abb02f37723a196c81350da4f8733890", "url": "https://github.com/elastic/elasticsearch/commit/45141d10abb02f37723a196c81350da4f8733890", "message": "Merge branch 'master' into mapper/rangefield", "committedDate": "2020-09-08T16:09:59Z", "type": "commit"}]}