{"pr_number": 64100, "pr_title": "Fix SearchableSnapshotDirectoryTests.testClearCache", "pr_createdAt": "2020-10-23T19:30:20Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64100", "timeline": [{"oid": "4d4cdde86ed30b16c9c94d2e8b58802ef805197d", "url": "https://github.com/elastic/elasticsearch/commit/4d4cdde86ed30b16c9c94d2e8b58802ef805197d", "message": "Fix SearchableSnapshotDirectoryTests.testClearCache\n\nThere is a small chance that the file deletion will run\non the searchable snapshot thread pool and not on the test\nthread now that the cache is non-blocking in which case\nwe fail the assertion unless we wait for that thread.", "committedDate": "2020-10-23T19:28:22Z", "type": "commit"}, {"oid": "67ad718fe8ce4547279d0a4cd3a6791222d56de6", "url": "https://github.com/elastic/elasticsearch/commit/67ad718fe8ce4547279d0a4cd3a6791222d56de6", "message": "fix-leak-file", "committedDate": "2020-10-23T20:30:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MTcwNw==", "url": "https://github.com/elastic/elasticsearch/pull/64100#discussion_r511141707", "bodyText": "Gotta make sure to only terminate the pool after shutting down everything else, otherwise we might leak a file listener from an action that has a reference to the file never executing.\nSee https://gradle-enterprise.elastic.co/s/wccywnq4vwa7i/console-log?anchor=8057", "author": "original-brownbear", "createdAt": "2020-10-23T20:31:38Z", "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/index/store/SearchableSnapshotDirectoryTests.java", "diffHunk": "@@ -629,6 +627,8 @@ protected void assertSnapshotOrGenericThread() {\n             } finally {\n                 Releasables.close(releasables);\n             }\n+        } finally {\n+            terminate(threadPool);", "originalCommit": "67ad718fe8ce4547279d0a4cd3a6791222d56de6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}