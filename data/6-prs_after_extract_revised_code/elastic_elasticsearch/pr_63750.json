{"pr_number": 63750, "pr_title": "Add view_index_metadata over metricbeat-* for monitoring agent", "pr_createdAt": "2020-10-15T14:54:50Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63750", "timeline": [{"oid": "ef1eb01178cd1d2754eec6b81a77362962eca975", "url": "https://github.com/elastic/elasticsearch/commit/ef1eb01178cd1d2754eec6b81a77362962eca975", "message": "Done", "committedDate": "2020-10-15T14:45:10Z", "type": "commit"}, {"oid": "c89d0e901a6023405eb42cb6ea130903bfc89b97", "url": "https://github.com/elastic/elasticsearch/commit/c89d0e901a6023405eb42cb6ea130903bfc89b97", "message": "rename", "committedDate": "2020-10-15T14:47:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcyOTg4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/63750#discussion_r505729881", "bodyText": "Why did you change it ti remoteMonitoringCollectorRole while the changes are added to remote_monitoring_agent?", "author": "BigPandaToo", "createdAt": "2020-10-15T17:50:53Z", "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java", "diffHunk": "@@ -750,108 +760,116 @@ public void testRemoteMonitoringCollectorRole() {\n         assertNotNull(roleDescriptor);\n         assertThat(roleDescriptor.getMetadata(), hasEntry(\"_reserved\", true));\n \n-        Role remoteMonitoringAgentRole = Role.builder(roleDescriptor, null).build();\n-        assertThat(remoteMonitoringAgentRole.cluster().check(ClusterHealthAction.NAME, request, authentication), is(true));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(ClusterStateAction.NAME, request, authentication), is(true));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(ClusterStatsAction.NAME, request, authentication), is(true));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(GetIndexTemplatesAction.NAME, request, authentication), is(false));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(PutIndexTemplateAction.NAME, request, authentication), is(false));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(DeleteIndexTemplateAction.NAME, request, authentication), is(false));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(ClusterRerouteAction.NAME, request, authentication), is(false));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(ClusterUpdateSettingsAction.NAME, request, authentication), is(false));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(MonitoringBulkAction.NAME, request, authentication), is(false));\n-        assertThat(remoteMonitoringAgentRole.cluster().check(DelegatePkiAuthenticationAction.NAME, request, authentication), is(false));\n-\n-        assertThat(remoteMonitoringAgentRole.runAs().check(randomAlphaOfLengthBetween(1, 12)), is(false));\n-\n-        assertThat(remoteMonitoringAgentRole.indices().allowedIndicesMatcher(RecoveryAction.NAME)\n+        Role remoteMonitoringCollectorRole = Role.builder(roleDescriptor, null).build();", "originalCommit": "c89d0e901a6023405eb42cb6ea130903bfc89b97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTczMTgzMA==", "url": "https://github.com/elastic/elasticsearch/pull/63750#discussion_r505731830", "bodyText": "It's mainly a rename see: c89d0e9 .\nBesides the rename, because the roles are similar sounding but different in scopee I've tested that only one of them grants the desired privileges.", "author": "albertzaharovits", "createdAt": "2020-10-15T17:54:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcyOTg4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "6ceffa8a2deaa1a17cc55547a530b3e0998894d6", "chunk": "diff --git a/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java\nindex 238e705a6c1..0fffc364eae 100644\n--- a/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java\n+++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java\n\n@@ -806,8 +806,6 @@ public class ReservedRolesStoreTests extends ESTestCase {\n                     .test(mockIndexAbstraction(index)), is(false));\n             assertThat(remoteMonitoringCollectorRole.indices().allowedIndicesMatcher(GetAliasesAction.NAME)\n                     .test(mockIndexAbstraction(index)), is(false));\n-            assertThat(remoteMonitoringCollectorRole.indices().allowedIndicesMatcher(IndicesSegmentsAction.NAME)\n-                    .test(mockIndexAbstraction(index)), is(false));\n             assertThat(remoteMonitoringCollectorRole.indices().allowedIndicesMatcher(RemoveIndexLifecyclePolicyAction.NAME)\n                     .test(mockIndexAbstraction(index)), is(false));\n             assertThat(remoteMonitoringCollectorRole.indices().allowedIndicesMatcher(DeleteAction.NAME)\n"}}, {"oid": "6ceffa8a2deaa1a17cc55547a530b3e0998894d6", "url": "https://github.com/elastic/elasticsearch/commit/6ceffa8a2deaa1a17cc55547a530b3e0998894d6", "message": "mhm", "committedDate": "2020-10-15T17:54:53Z", "type": "commit"}]}