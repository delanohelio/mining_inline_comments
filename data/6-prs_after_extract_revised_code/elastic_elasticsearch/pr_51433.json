{"pr_number": 51433, "pr_title": "Install plugins in a single transaction in tests", "pr_createdAt": "2020-01-24T17:11:14Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51433", "timeline": [{"oid": "7d2b31082c3c8e65804f57590dc459f9a3613d0f", "url": "https://github.com/elastic/elasticsearch/commit/7d2b31082c3c8e65804f57590dc459f9a3613d0f", "message": "Install plugins in a single transaction in tests\n\nWhen building clusters for integration tests, today we install plugins\nsequentially. We recently introduced the ability to install plugins in a\nsingle invocation of the install plugin command. Using this can save\nsubstantial time starting up JVMs. This commit changes the build\ninfrastructure to install multiple plugins at once when building\nclusters for integration tests.\n\nFor the docs integration tests in particular, where we install many\nplugins, this change makes a substantial difference. On my laptop, prior\nto this change, installing the plugins sequentially took 115\nseconds. After this change, it takes 14 seconds.", "committedDate": "2020-01-24T17:05:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc0NjM2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/51433#discussion_r370746363", "bodyText": "Is this intermediary collection really necessary? All it's doing is saving us a single toString() call later on.\nI mainly say that as it's a bit confusing. Having a separate \"plugins to install\" to me implies that this.plugins is some kind of superset of that, which isn't the case. We always install all configured plugins for the cluster.", "author": "mark-vieira", "createdAt": "2020-01-24T17:15:25Z", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchNode.java", "diffHunk": "@@ -428,14 +428,27 @@ public synchronized void start() {\n \n         createConfiguration();\n \n+        final List<String> pluginsToInstall = new ArrayList<>();", "originalCommit": "7d2b31082c3c8e65804f57590dc459f9a3613d0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc1OTQzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/51433#discussion_r370759439", "bodyText": "Note that we sometimes add x-pack to the list. However, we can remove that code in master. Let me do that in a follow-up, and then we can remove the extra collection then, too.", "author": "jasontedor", "createdAt": "2020-01-24T17:45:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc0NjM2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0ODIyNg==", "url": "https://github.com/elastic/elasticsearch/pull/51433#discussion_r370848226", "bodyText": "I opened #51441 for this.", "author": "jasontedor", "createdAt": "2020-01-24T21:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc0NjM2Mw=="}], "type": "inlineReview", "revised_code": null}]}