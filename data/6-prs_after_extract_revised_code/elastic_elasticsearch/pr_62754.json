{"pr_number": 62754, "pr_title": "Add case insensitive prefix and wildcard to 'version' field", "pr_createdAt": "2020-09-22T10:23:49Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62754", "timeline": [{"oid": "d2d6c88d20a7a94f494ff5dd96efc09cbfe20d25", "url": "https://github.com/elastic/elasticsearch/commit/d2d6c88d20a7a94f494ff5dd96efc09cbfe20d25", "message": "Add caseInsensitive option for prefix and wildcard query", "committedDate": "2020-09-22T10:05:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyODE2MA==", "url": "https://github.com/elastic/elasticsearch/pull/62754#discussion_r492628160", "bodyText": "Wanted to use this, let me know if this shouldn't be that open. Another option is simpyl copying the logic over I think.", "author": "cbuescher", "createdAt": "2020-09-22T10:25:10Z", "path": "server/src/main/java/org/elasticsearch/common/lucene/search/AutomatonQueries.java", "diffHunk": "@@ -129,11 +129,11 @@ public static Automaton toCaseInsensitiveString(String s, int maxDeterminizedSta\n         Automaton a = Operations.concatenate(list);\n         a = MinimizationOperations.minimize(a, maxDeterminizedStates);\n         return a;\n- \n-    \n+\n+\n     }\n \n-    protected static Automaton toCaseInsensitiveChar(int codepoint, int maxDeterminizedStates) {\n+    public static Automaton toCaseInsensitiveChar(int codepoint, int maxDeterminizedStates) {", "originalCommit": "d2d6c88d20a7a94f494ff5dd96efc09cbfe20d25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY1NTAzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/62754#discussion_r492655031", "bodyText": "LGTM", "author": "markharwood", "createdAt": "2020-09-22T11:18:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyODE2MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MjgyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/62754#discussion_r492662829", "bodyText": "Typo - missing i in Insensitive.", "author": "markharwood", "createdAt": "2020-09-22T11:34:03Z", "path": "x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java", "diffHunk": "@@ -139,7 +139,7 @@ public Query existsQuery(QueryShardContext context) {\n \n         @Override\n         public Query prefixQuery(String value, MultiTermQuery.RewriteMethod method, boolean caseInsensitve, QueryShardContext context) {\n-            return wildcardQuery(value + \"*\", method, context);\n+            return wildcardQuery(value + \"*\", method, caseInsensitve, context);\n         }", "originalCommit": "d2d6c88d20a7a94f494ff5dd96efc09cbfe20d25", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6de210e4bbd0e87f9f72c45153a3bc3ddc698423", "chunk": "diff --git a/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java b/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java\nindex adc73e399a4..dc89eb7aef3 100644\n--- a/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java\n+++ b/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java\n\n@@ -138,8 +138,8 @@ public class VersionStringFieldMapper extends ParametrizedFieldMapper {\n         }\n \n         @Override\n-        public Query prefixQuery(String value, MultiTermQuery.RewriteMethod method, boolean caseInsensitve, QueryShardContext context) {\n-            return wildcardQuery(value + \"*\", method, caseInsensitve, context);\n+        public Query prefixQuery(String value, MultiTermQuery.RewriteMethod method, boolean caseInsensitive, QueryShardContext context) {\n+            return wildcardQuery(value + \"*\", method, caseInsensitive, context);\n         }\n \n         /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MzAxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/62754#discussion_r492663019", "bodyText": "Typo", "author": "markharwood", "createdAt": "2020-09-22T11:34:30Z", "path": "x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java", "diffHunk": "@@ -244,7 +244,7 @@ public Query wildcardQuery(String value, MultiTermQuery.RewriteMethod method, bo\n                 );\n             }\n \n-            VersionFieldWildcardQuery query = new VersionFieldWildcardQuery(new Term(name(), value));\n+            VersionFieldWildcardQuery query = new VersionFieldWildcardQuery(new Term(name(), value), caseInsensitve);\n             QueryParsers.setRewriteMethod(query, method);", "originalCommit": "d2d6c88d20a7a94f494ff5dd96efc09cbfe20d25", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6de210e4bbd0e87f9f72c45153a3bc3ddc698423", "chunk": "diff --git a/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java b/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java\nindex adc73e399a4..dc89eb7aef3 100644\n--- a/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java\n+++ b/x-pack/plugin/versionfield/src/main/java/org/elasticsearch/xpack/versionfield/VersionStringFieldMapper.java\n\n@@ -237,14 +237,14 @@ public class VersionStringFieldMapper extends ParametrizedFieldMapper {\n         }\n \n         @Override\n-        public Query wildcardQuery(String value, MultiTermQuery.RewriteMethod method, boolean caseInsensitve, QueryShardContext context) {\n+        public Query wildcardQuery(String value, MultiTermQuery.RewriteMethod method, boolean caseInsensitive, QueryShardContext context) {\n             if (context.allowExpensiveQueries() == false) {\n                 throw new ElasticsearchException(\n                     \"[wildcard] queries cannot be executed when '\" + ALLOW_EXPENSIVE_QUERIES.getKey() + \"' is set to false.\"\n                 );\n             }\n \n-            VersionFieldWildcardQuery query = new VersionFieldWildcardQuery(new Term(name(), value), caseInsensitve);\n+            VersionFieldWildcardQuery query = new VersionFieldWildcardQuery(new Term(name(), value), caseInsensitive);\n             QueryParsers.setRewriteMethod(query, method);\n             return query;\n         }\n"}}, {"oid": "6de210e4bbd0e87f9f72c45153a3bc3ddc698423", "url": "https://github.com/elastic/elasticsearch/commit/6de210e4bbd0e87f9f72c45153a3bc3ddc698423", "message": "typo", "committedDate": "2020-09-22T13:09:29Z", "type": "commit"}, {"oid": "04cda01386f7aa2b7e286f8a1d71fd78be3c7f68", "url": "https://github.com/elastic/elasticsearch/commit/04cda01386f7aa2b7e286f8a1d71fd78be3c7f68", "message": "Merge branch 'master' into versionfield-caseinsensitive", "committedDate": "2020-09-22T16:05:13Z", "type": "commit"}, {"oid": "5a319f4a7dbc49a9d9fd449141479c3b24874fc5", "url": "https://github.com/elastic/elasticsearch/commit/5a319f4a7dbc49a9d9fd449141479c3b24874fc5", "message": "Merge branch 'master' into versionfield-caseinsensitive", "committedDate": "2020-09-22T17:09:42Z", "type": "commit"}]}