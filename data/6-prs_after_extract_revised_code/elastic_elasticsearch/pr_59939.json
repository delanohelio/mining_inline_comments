{"pr_number": 59939, "pr_title": "Introduce javaRestTest source set/task and convert modules", "pr_createdAt": "2020-07-20T23:34:43Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59939", "timeline": [{"oid": "a65914c9d588d030a780b796f1c4aadce0768797", "url": "https://github.com/elastic/elasticsearch/commit/a65914c9d588d030a780b796f1c4aadce0768797", "message": "new javaRestTest plugin and 1/2 modules converted", "committedDate": "2020-07-20T22:30:22Z", "type": "commit"}, {"oid": "45bf3d85a0756b528cb26e04c01d41766a0b5b71", "url": "https://github.com/elastic/elasticsearch/commit/45bf3d85a0756b528cb26e04c01d41766a0b5b71", "message": "should all work", "committedDate": "2020-07-20T23:33:13Z", "type": "commit"}, {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f", "url": "https://github.com/elastic/elasticsearch/commit/319d6fac4b71d76dccd37fa44e73f0176f7aa70f", "message": "spotless", "committedDate": "2020-07-21T12:53:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDk4OA==", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458120988", "bodyText": "this was pulled from YamlRestTestPlugin so it can be reused with JavaRestTestPlugin. There are no substantive changes introduced here ... just copy/pasted.", "author": "jakelandis", "createdAt": "2020-07-21T14:02:15Z", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle.test.rest;\n+\n+import org.elasticsearch.gradle.VersionProperties;\n+import org.elasticsearch.gradle.info.BuildParams;\n+import org.elasticsearch.gradle.plugin.PluginPropertiesExtension;\n+import org.elasticsearch.gradle.test.RestIntegTestTask;\n+import org.elasticsearch.gradle.testclusters.RestTestRunnerTask;\n+import org.gradle.api.Plugin;\n+import org.gradle.api.Project;\n+import org.gradle.api.plugins.JavaBasePlugin;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.bundling.Zip;\n+\n+/**\n+ * Helper parent to configure the necessary tasks and dependencies.\n+ */\n+public abstract class AbstractRestTestPlugin implements Plugin<Project> {", "originalCommit": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NjM1OA==", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458376358", "bodyText": "All these methods can be static and therefore live in a utility class rather than an abstract class that must be extended.", "author": "mark-vieira", "createdAt": "2020-07-21T20:44:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDk4OA=="}], "type": "inlineReview", "revised_code": {"commit": "01521f972fc1d79ca201ce7e3f14ef1444f24626", "chunk": "diff --git a/buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java b/buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestTestUtil.java\nsimilarity index 90%\nrename from buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java\nrename to buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestTestUtil.java\nindex 5150b601850..ed3711183b4 100644\n--- a/buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java\n+++ b/buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestTestUtil.java\n\n@@ -24,21 +24,22 @@ import org.elasticsearch.gradle.info.BuildParams;\n import org.elasticsearch.gradle.plugin.PluginPropertiesExtension;\n import org.elasticsearch.gradle.test.RestIntegTestTask;\n import org.elasticsearch.gradle.testclusters.RestTestRunnerTask;\n-import org.gradle.api.Plugin;\n import org.gradle.api.Project;\n import org.gradle.api.plugins.JavaBasePlugin;\n import org.gradle.api.tasks.SourceSet;\n import org.gradle.api.tasks.bundling.Zip;\n \n /**\n- * Helper parent to configure the necessary tasks and dependencies.\n+ * Utility class to configure the necessary tasks and dependencies.\n  */\n-public abstract class AbstractRestTestPlugin implements Plugin<Project> {\n+public class RestTestUtil {\n+\n+    private RestTestUtil() {}\n \n     /**\n      * Creates a task with the source set name of type {@link RestIntegTestTask}\n      */\n-    protected RestIntegTestTask setupTask(Project project, String sourceSetName) {\n+    static RestIntegTestTask setupTask(Project project, String sourceSetName) {\n         // create task - note can not use .register due to the work in RestIntegTestTask's constructor :(\n         // see: https://github.com/elastic/elasticsearch/issues/47804\n         RestIntegTestTask testTask = project.getTasks().create(sourceSetName, RestIntegTestTask.class);\n"}}, {"oid": "d5e45728ec18fa707685582cc0db065d45591f59", "url": "https://github.com/elastic/elasticsearch/commit/d5e45728ec18fa707685582cc0db065d45591f59", "message": "minor review changes", "committedDate": "2020-07-21T19:08:14Z", "type": "commit"}, {"oid": "01521f972fc1d79ca201ce7e3f14ef1444f24626", "url": "https://github.com/elastic/elasticsearch/commit/01521f972fc1d79ca201ce7e3f14ef1444f24626", "message": "withPlugin and static methods", "committedDate": "2020-07-21T21:09:59Z", "type": "commit"}]}