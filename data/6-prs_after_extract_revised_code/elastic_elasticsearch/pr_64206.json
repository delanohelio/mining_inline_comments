{"pr_number": 64206, "pr_title": "EQL: Improve request logging", "pr_createdAt": "2020-10-27T11:51:04Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64206", "timeline": [{"oid": "e4a303259ce78e0061e9ba3469c42f383e03814d", "url": "https://github.com/elastic/elasticsearch/commit/e4a303259ce78e0061e9ba3469c42f383e03814d", "message": "EQL: Improve request logging\n\nAdd logging to multi-search queries\nLog response count", "committedDate": "2020-10-27T11:48:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4MjQwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/64206#discussion_r512682409", "bodyText": "Why getTotalHits() wasn't the best option?", "author": "astefan", "createdAt": "2020-10-27T13:17:38Z", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/execution/search/RuntimeUtils.java", "diffHunk": "@@ -54,8 +96,10 @@ static void logSearchResponse(SearchResponse response, Logger logger) {\n             aggsNames.append(aggs.get(i).getName() + (i + 1 == aggs.size() ? \"\" : \", \"));\n         }\n \n+        SearchHit[] hits = response.getHits().getHits();\n+        int count = hits != null ? hits.length : 0;\n         logger.trace(\"Got search response [hits {}, {} aggregations: [{}], {} failed shards, {} skipped shards, \"\n-                + \"{} successful shards, {} total shards, took {}, timed out [{}]]\", response.getHits().getTotalHits(), aggs.size(),\n+                + \"{} successful shards, {} total shards, took {}, timed out [{}]]\", count, aggs.size(),", "originalCommit": "e4a303259ce78e0061e9ba3469c42f383e03814d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcyOTgzMg==", "url": "https://github.com/elastic/elasticsearch/pull/64206#discussion_r512729832", "bodyText": "It requires accurate counts - if total hits is disabled (don't track hits), it returns null. Plus it does not tell you the number of results returned but rather the total number of results found.", "author": "costin", "createdAt": "2020-10-27T14:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4MjQwOQ=="}], "type": "inlineReview", "revised_code": null}]}