{"pr_number": 53507, "pr_title": "[ML] Add a model memory estimation endpoint for anomaly detection", "pr_createdAt": "2020-03-12T18:18:57Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53507", "timeline": [{"oid": "5546bd2576b186671245a9f3655463da4cc28387", "url": "https://github.com/elastic/elasticsearch/commit/5546bd2576b186671245a9f3655463da4cc28387", "message": "[ML] Add a model memory estimation endpoint for anomaly detection\n\nThis PR completes the implementation of the model\nmemory estimation endpoint:\n\nPOST _ml/anomaly_detectors/estimate_model_memory\n\nCloses #53219", "committedDate": "2020-03-12T18:18:30Z", "type": "commit"}, {"oid": "258a900ed71f0f57f3283f60c3136fcc432d503e", "url": "https://github.com/elastic/elasticsearch/commit/258a900ed71f0f57f3283f60c3136fcc432d503e", "message": "Addressing docs comments", "committedDate": "2020-03-13T13:30:05Z", "type": "commit"}, {"oid": "ce16b385665dc3e356be193cdad5ac4daf830e44", "url": "https://github.com/elastic/elasticsearch/commit/ce16b385665dc3e356be193cdad5ac4daf830e44", "message": "Adding numbers for more functions", "committedDate": "2020-03-19T15:45:28Z", "type": "commit"}, {"oid": "b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "url": "https://github.com/elastic/elasticsearch/commit/b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "message": "Merge branch 'master' into hlrc_for_estimate_model_memory", "committedDate": "2020-03-24T10:19:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5NTEwNA==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397095104", "bodyText": "Removing this setter and making this.analysisConfig final would be more in style with the HLRC code", "author": "davidkyle", "createdAt": "2020-03-24T11:53:24Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/EstimateModelMemoryRequest.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.client.ml;\n+\n+import org.elasticsearch.client.Validatable;\n+import org.elasticsearch.client.ValidationException;\n+import org.elasticsearch.client.ml.job.config.AnalysisConfig;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+/**\n+ * Request to estimate the model memory an analysis config is likely to need given supplied field cardinalities.\n+ */\n+public class EstimateModelMemoryRequest implements Validatable, ToXContentObject {\n+\n+    public static final String ANALYSIS_CONFIG = \"analysis_config\";\n+    public static final String OVERALL_CARDINALITY = \"overall_cardinality\";\n+    public static final String MAX_BUCKET_CARDINALITY = \"max_bucket_cardinality\";\n+\n+    private AnalysisConfig analysisConfig;\n+    private Map<String, Long> overallCardinality = Collections.emptyMap();\n+    private Map<String, Long> maxBucketCardinality = Collections.emptyMap();\n+\n+    @Override\n+    public Optional<ValidationException> validate() {\n+        return Optional.empty();\n+    }\n+\n+    public EstimateModelMemoryRequest(AnalysisConfig analysisConfig) {\n+        this.analysisConfig = Objects.requireNonNull(analysisConfig);\n+    }\n+\n+    public AnalysisConfig getAnalysisConfig() {\n+        return analysisConfig;\n+    }\n+\n+    public void setAnalysisConfig(AnalysisConfig analysisConfig) {\n+        this.analysisConfig = Objects.requireNonNull(analysisConfig);", "originalCommit": "b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "chunk": "diff --git a/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/EstimateModelMemoryRequest.java b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/EstimateModelMemoryRequest.java\nindex d3d2c7c52a7..b0dc8bb7c29 100644\n--- a/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/EstimateModelMemoryRequest.java\n+++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/EstimateModelMemoryRequest.java\n\n@@ -40,7 +40,7 @@ public class EstimateModelMemoryRequest implements Validatable, ToXContentObject\n     public static final String OVERALL_CARDINALITY = \"overall_cardinality\";\n     public static final String MAX_BUCKET_CARDINALITY = \"max_bucket_cardinality\";\n \n-    private AnalysisConfig analysisConfig;\n+    private final AnalysisConfig analysisConfig;\n     private Map<String, Long> overallCardinality = Collections.emptyMap();\n     private Map<String, Long> maxBucketCardinality = Collections.emptyMap();\n \n"}}, {"oid": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "url": "https://github.com/elastic/elasticsearch/commit/0caf242c5313ad39ca053c8824642fb7151cdc5b", "message": "Address review comments", "committedDate": "2020-03-24T12:43:59Z", "type": "commit"}, {"oid": "95dede2d050ea49f2c50459878467e892f1acae3", "url": "https://github.com/elastic/elasticsearch/commit/95dede2d050ea49f2c50459878467e892f1acae3", "message": "Apply docs suggestions from code review\n\nCo-Authored-By: Lisa Cawley <lcawley@elastic.co>", "committedDate": "2020-03-24T16:39:10Z", "type": "commit"}, {"oid": "d51c6f4cdf232a9ebbea831e35795e44035ac119", "url": "https://github.com/elastic/elasticsearch/commit/d51c6f4cdf232a9ebbea831e35795e44035ac119", "message": "A few refinements", "committedDate": "2020-03-24T19:23:52Z", "type": "commit"}, {"oid": "2896f290a01153ffd1f3118020366c90903154db", "url": "https://github.com/elastic/elasticsearch/commit/2896f290a01153ffd1f3118020366c90903154db", "message": "Merge branch 'master' into hlrc_for_estimate_model_memory", "committedDate": "2020-03-24T20:33:18Z", "type": "commit"}]}