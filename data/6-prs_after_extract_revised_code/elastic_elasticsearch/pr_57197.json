{"pr_number": 57197, "pr_title": "Move classes from build scripts to buildSrc", "pr_createdAt": "2020-05-27T10:00:06Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57197", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyNzUwMg==", "url": "https://github.com/elastic/elasticsearch/pull/57197#discussion_r431427502", "bodyText": "Man, this whole thing is a goofy hack. It's really just so we can alias :distribution:run as simply run and still pass along the CLI options.\n@rjernst since pretty much everyone just uses ./gradlew :run why don't we just move that task to the root project rather than creation it in the :distribution project and do this weird aliasing nonsense?", "author": "mark-vieira", "createdAt": "2020-05-27T20:38:29Z", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/tasks/Run.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package org.elasticsearch.gradle.tasks;\n+\n+import org.elasticsearch.gradle.testclusters.RunTask;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.tasks.Internal;\n+import org.gradle.api.tasks.TaskProvider;\n+import org.gradle.api.tasks.options.Option;\n+\n+public class Run extends DefaultTask {", "originalCommit": "42c5b0b40c01299250a8f88e9b5ff6cf41196142", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2NTY1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/57197#discussion_r431465657", "bodyText": "That's fine I guess. It means pulling in testclusters into the root project.", "author": "rjernst", "createdAt": "2020-05-27T21:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyNzUwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwNTAzMA==", "url": "https://github.com/elastic/elasticsearch/pull/57197#discussion_r431905030", "bodyText": "I've changed this and moved all related to this into gradle/run.gradle script and apply it on the root project now", "author": "breskeby", "createdAt": "2020-05-28T14:59:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyNzUwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ5NjU4NA==", "url": "https://github.com/elastic/elasticsearch/pull/57197#discussion_r432496584", "bodyText": "It means pulling in testclusters into the root project.\n\nI think that's fine, and a net-zero since we can then remove that plugin from the :distribution project.", "author": "mark-vieira", "createdAt": "2020-05-29T13:51:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyNzUwMg=="}], "type": "inlineReview", "revised_code": {"commit": "e495d3183deaab2e827f183a78b999a4ecd0a0be", "chunk": "diff --git a/buildSrc/src/main/java/org/elasticsearch/gradle/tasks/Run.java b/buildSrc/src/main/java/org/elasticsearch/gradle/tasks/Run.java\ndeleted file mode 100644\nindex ea00a541c69..00000000000\n--- a/buildSrc/src/main/java/org/elasticsearch/gradle/tasks/Run.java\n+++ /dev/null\n\n@@ -1,37 +0,0 @@\n-package org.elasticsearch.gradle.tasks;\n-\n-import org.elasticsearch.gradle.testclusters.RunTask;\n-import org.gradle.api.DefaultTask;\n-import org.gradle.api.tasks.Internal;\n-import org.gradle.api.tasks.TaskProvider;\n-import org.gradle.api.tasks.options.Option;\n-\n-public class Run extends DefaultTask {\n-\n-    @Internal\n-    private boolean debug = false;\n-\n-    @Option(option = \"debug-jvm\", description = \"Enable debugging configuration, to allow attaching a debugger to elasticsearch.\")\n-    public void setDebug(boolean enabled) {\n-        getDistributionRunTask().configure(runTask -> runTask.setDebug(enabled));\n-    }\n-\n-    @Option(option = \"data-dir\", description = \"Override the base data directory used by the testcluster\")\n-    public void setDataDir(String dataDirStr) {\n-        getDistributionRunTask().configure((r) -> r.setDataDir(dataDirStr));\n-    }\n-\n-    @Option(option = \"keystore-password\", description = \"Set the elasticsearch keystore password\")\n-    public void setKeystorePassword(String password) {\n-        getDistributionRunTask().configure(runTask -> runTask.setKeystorePassword(password));\n-    }\n-\n-    public boolean getDebug() {\n-        return debug;\n-    }\n-\n-    private TaskProvider<RunTask> getDistributionRunTask() {\n-        return getProject().project(\":distribution\").getTasks().withType(RunTask.class).named(\"run\");\n-    }\n-\n-}\n"}}, {"oid": "e495d3183deaab2e827f183a78b999a4ecd0a0be", "url": "https://github.com/elastic/elasticsearch/commit/e495d3183deaab2e827f183a78b999a4ecd0a0be", "message": "Remove :run workaround", "committedDate": "2020-05-28T14:56:53Z", "type": "forcePushed"}, {"oid": "4ea902ee7fd875cdaf678f6afcaeaa685320edd6", "url": "https://github.com/elastic/elasticsearch/commit/4ea902ee7fd875cdaf678f6afcaeaa685320edd6", "message": "Move classes from build scripts to buildSrc\n\n- move Run task\n- move duplicate SanEvaluator", "committedDate": "2020-06-02T07:25:59Z", "type": "commit"}, {"oid": "f3a132e551c9673f3fc60aaaa742a2f3df311b29", "url": "https://github.com/elastic/elasticsearch/commit/f3a132e551c9673f3fc60aaaa742a2f3df311b29", "message": "Remove :run workaround", "committedDate": "2020-06-02T07:27:24Z", "type": "commit"}, {"oid": "c9d37d541d764df4055dae5028039d241e7c6c37", "url": "https://github.com/elastic/elasticsearch/commit/c9d37d541d764df4055dae5028039d241e7c6c37", "message": "Some little cleanup on build scripts on the way", "committedDate": "2020-06-02T07:30:28Z", "type": "commit"}, {"oid": "c9d37d541d764df4055dae5028039d241e7c6c37", "url": "https://github.com/elastic/elasticsearch/commit/c9d37d541d764df4055dae5028039d241e7c6c37", "message": "Some little cleanup on build scripts on the way", "committedDate": "2020-06-02T07:30:28Z", "type": "forcePushed"}]}