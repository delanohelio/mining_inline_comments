{"pr_number": 51246, "pr_title": "Fix Rest Tests Failing to Cleanup Rollup Jobs", "pr_createdAt": "2020-01-21T10:18:33Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51246", "timeline": [{"oid": "3e089f5c183763ffc571f3ef5a5d6c8111913f86", "url": "https://github.com/elastic/elasticsearch/commit/3e089f5c183763ffc571f3ef5a5d6c8111913f86", "message": "Fix Rest Tests Failing to Cleanup Rollup Jobs\n\nIf the rollup jobs index doesn't exist for some reason (like running against a 6.x cluster)\nwe should just assume the jobs have been cleaned up and move on.\n\nCloses #50819", "committedDate": "2020-01-21T10:16:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk3Mzk5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/51246#discussion_r368973993", "bodyText": "I think it is worth adding a comment here explaining why this is ok.", "author": "nik9000", "createdAt": "2020-01-21T12:33:00Z", "path": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java", "diffHunk": "@@ -663,7 +663,15 @@ private void wipeClusterSettings() throws IOException {\n     }\n \n     private void wipeRollupJobs() throws IOException {\n-        Response response = adminClient().performRequest(new Request(\"GET\", \"/_rollup/job/_all\"));\n+        final Response response;\n+        try {\n+            response = adminClient().performRequest(new Request(\"GET\", \"/_rollup/job/_all\"));\n+        } catch (ResponseException e) {\n+            if (e.getResponse().getStatusLine().getStatusCode() == RestStatus.NOT_FOUND.getStatus()) {\n+                return;\n+            }", "originalCommit": "3e089f5c183763ffc571f3ef5a5d6c8111913f86", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "351d795b69ff9df4413b2057de961b7bf5979684", "chunk": "diff --git a/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java\nindex dbd8b6b3dec..63f2d3f1267 100644\n--- a/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java\n+++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java\n\n@@ -667,6 +667,7 @@ public abstract class ESRestTestCase extends ESTestCase {\n         try {\n             response = adminClient().performRequest(new Request(\"GET\", \"/_rollup/job/_all\"));\n         } catch (ResponseException e) {\n+            // If we don't see the rollup endpoint (possibly because of running against an older ES version) we just bail\n             if (e.getResponse().getStatusLine().getStatusCode() == RestStatus.NOT_FOUND.getStatus()) {\n                 return;\n             }\n"}}, {"oid": "c2b1540058c4934a8e33593e76fae8fc188d42ab", "url": "https://github.com/elastic/elasticsearch/commit/c2b1540058c4934a8e33593e76fae8fc188d42ab", "message": "Merge remote-tracking branch 'elastic/master' into fix-bwc-50819", "committedDate": "2020-01-21T15:47:22Z", "type": "commit"}, {"oid": "351d795b69ff9df4413b2057de961b7bf5979684", "url": "https://github.com/elastic/elasticsearch/commit/351d795b69ff9df4413b2057de961b7bf5979684", "message": "add comment", "committedDate": "2020-01-21T15:48:36Z", "type": "commit"}, {"oid": "e82dcd55969d2861617a5e582d7b5c67cf1ad441", "url": "https://github.com/elastic/elasticsearch/commit/e82dcd55969d2861617a5e582d7b5c67cf1ad441", "message": "Merge remote-tracking branch 'elastic/master' into fix-bwc-50819", "committedDate": "2020-01-22T08:42:20Z", "type": "commit"}]}