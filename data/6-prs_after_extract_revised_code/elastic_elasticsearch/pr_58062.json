{"pr_number": 58062, "pr_title": "QL: wildcard field type support", "pr_createdAt": "2020-06-12T16:28:47Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58062", "timeline": [{"oid": "319205949bbc7e14cd5bef1eddbbaf8723206240", "url": "https://github.com/elastic/elasticsearch/commit/319205949bbc7e14cd5bef1eddbbaf8723206240", "message": "WIP", "committedDate": "2020-06-12T15:25:27Z", "type": "commit"}, {"oid": "45a94c872c959459543c6433c4efa5f479969e84", "url": "https://github.com/elastic/elasticsearch/commit/45a94c872c959459543c6433c4efa5f479969e84", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 54184_impl", "committedDate": "2020-06-12T16:10:14Z", "type": "commit"}, {"oid": "07451948c91c88eccd1caefd422dfe0c565df805", "url": "https://github.com/elastic/elasticsearch/commit/07451948c91c88eccd1caefd422dfe0c565df805", "message": "Fix test", "committedDate": "2020-06-12T16:21:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MDE4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r440170185", "bodyText": "The issues seems fixed, can you remove the workaround?", "author": "matriv", "createdAt": "2020-06-15T13:20:56Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java", "diffHunk": "@@ -32,7 +33,9 @@\n         if (doc.containsKey(fieldName)) {\n             ScriptDocValues<T> docValues = doc.get(fieldName);\n             if (!docValues.isEmpty()) {\n-                return docValues.get(0);\n+                T value = docValues.get(0);\n+                // FIXME temporary workaround until https://github.com/elastic/elasticsearch/issues/58044 gets fixed", "originalCommit": "07451948c91c88eccd1caefd422dfe0c565df805", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c4dfed9525a3ebc3d3b4c65ed7595b1c6e2b8c4f", "chunk": "diff --git a/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java b/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java\nindex 59f61049d94..c27f4e6e0f6 100644\n--- a/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java\n+++ b/x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java\n\n@@ -33,9 +32,7 @@ public class InternalQlScriptUtils {\n         if (doc.containsKey(fieldName)) {\n             ScriptDocValues<T> docValues = doc.get(fieldName);\n             if (!docValues.isEmpty()) {\n-                T value = docValues.get(0);\n-                // FIXME temporary workaround until https://github.com/elastic/elasticsearch/issues/58044 gets fixed\n-                return value instanceof BytesRef ? ((BytesRef) value).utf8ToString() : value;\n+                return docValues.get(0);\n             }\n         }\n         return null;\n"}}, {"oid": "c4dfed9525a3ebc3d3b4c65ed7595b1c6e2b8c4f", "url": "https://github.com/elastic/elasticsearch/commit/c4dfed9525a3ebc3d3b4c65ed7595b1c6e2b8c4f", "message": "w", "committedDate": "2020-06-17T14:59:01Z", "type": "commit"}, {"oid": "31f5b19f5f404a416eb89d4d424292a9da83318e", "url": "https://github.com/elastic/elasticsearch/commit/31f5b19f5f404a416eb89d4d424292a9da83318e", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 54184_impl", "committedDate": "2020-06-17T15:00:31Z", "type": "commit"}, {"oid": "7f3e16920265dd760f1a48fa526650d707387d4c", "url": "https://github.com/elastic/elasticsearch/commit/7f3e16920265dd760f1a48fa526650d707387d4c", "message": "Remove the wildcard field data type. Take 1", "committedDate": "2020-07-31T14:27:44Z", "type": "commit"}, {"oid": "bf72022789a56c4de558c96e9ba49ff2bd0870b3", "url": "https://github.com/elastic/elasticsearch/commit/bf72022789a56c4de558c96e9ba49ff2bd0870b3", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 54184_impl", "committedDate": "2020-07-31T14:40:59Z", "type": "commit"}, {"oid": "c0e60d341ffd6beb7534ba05fb9b63b6c95e6022", "url": "https://github.com/elastic/elasticsearch/commit/c0e60d341ffd6beb7534ba05fb9b63b6c95e6022", "message": "More fixes", "committedDate": "2020-07-31T14:53:37Z", "type": "commit"}, {"oid": "8759d6cafcbf8ae2af5d6f14c108c866a7367906", "url": "https://github.com/elastic/elasticsearch/commit/8759d6cafcbf8ae2af5d6f14c108c866a7367906", "message": "Tests fixes", "committedDate": "2020-08-03T11:27:16Z", "type": "commit"}, {"oid": "5a5786c33345dabc21a95dc437a40147edc62845", "url": "https://github.com/elastic/elasticsearch/commit/5a5786c33345dabc21a95dc437a40147edc62845", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 54184_impl", "committedDate": "2020-08-03T11:27:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NDkwNg==", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r471454906", "bodyText": "Why is this needed? Aren't wildcard returned as keywords? Or is this using a different API/source?", "author": "costin", "createdAt": "2020-08-17T12:48:56Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/type/Types.java", "diffHunk": "@@ -48,8 +48,12 @@\n \n     private static DataType getType(DataTypeRegistry typeRegistry, Map<String, Object> content) {\n         if (content.containsKey(\"type\")) {\n+            String typeName = content.get(\"type\").toString();\n+            if (\"wildcard\".equals(typeName)) {", "originalCommit": "5a5786c33345dabc21a95dc437a40147edc62845", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NzkwMw==", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r471457903", "bodyText": "That's for testing. We use .json files having an index' complete mapping (see org.elasticsearch.xpack.ql.type.TypesTests) and the wildcard comparison is for bypassing SQL's and EQL's specific data types auto-resolver in the specific case of wildcard.", "author": "astefan", "createdAt": "2020-08-17T12:54:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NDkwNg=="}], "type": "inlineReview", "revised_code": null}]}