{"pr_number": 53712, "pr_title": "Increase step between checks for cancellation", "pr_createdAt": "2020-03-18T08:51:15Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53712", "timeline": [{"oid": "a1839d08e6273cbf12fa86f440d5d078804756ba", "url": "https://github.com/elastic/elasticsearch/commit/a1839d08e6273cbf12fa86f440d5d078804756ba", "message": "Increase step between checks for cancellation\n\nCheck for cancellation every 1024 docs instead of every 15 to lower\nthe impact of the check in query's performance.\n\nFixes: #53496", "committedDate": "2020-03-18T08:43:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIzOTY3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53712#discussion_r394239673", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    private static final int MAX_CALLS_BEFORE_QUERY_TIMEOUT_CHECK = 1 << 10; // 1024\n          \n          \n            \n                    private static final int MAX_CALLS_BEFORE_QUERY_TIMEOUT_CHECK = (1 << 10) - 1; // 1023", "author": "jimczi", "createdAt": "2020-03-18T10:19:58Z", "path": "server/src/main/java/org/elasticsearch/search/internal/ExitableDirectoryReader.java", "diffHunk": "@@ -245,7 +245,7 @@ public int getDocCount() {\n \n     private static class ExitableIntersectVisitor implements PointValues.IntersectVisitor {\n \n-        private static final int MAX_CALLS_BEFORE_QUERY_TIMEOUT_CHECK = (1 << 4) - 1; // 15\n+        private static final int MAX_CALLS_BEFORE_QUERY_TIMEOUT_CHECK = 1 << 10; // 1024", "originalCommit": "a1839d08e6273cbf12fa86f440d5d078804756ba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ebf2f166da9d5a8aee2c73fe6939a7c679ecc0b", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/search/internal/ExitableDirectoryReader.java b/server/src/main/java/org/elasticsearch/search/internal/ExitableDirectoryReader.java\nindex a809209394a2..51a94f4023b6 100644\n--- a/server/src/main/java/org/elasticsearch/search/internal/ExitableDirectoryReader.java\n+++ b/server/src/main/java/org/elasticsearch/search/internal/ExitableDirectoryReader.java\n\n@@ -245,7 +245,7 @@ class ExitableDirectoryReader extends FilterDirectoryReader {\n \n     private static class ExitableIntersectVisitor implements PointValues.IntersectVisitor {\n \n-        private static final int MAX_CALLS_BEFORE_QUERY_TIMEOUT_CHECK = 1 << 10; // 1024\n+        private static final int MAX_CALLS_BEFORE_QUERY_TIMEOUT_CHECK = (1 << 10) - 1; // 1023\n \n         private final PointValues.IntersectVisitor in;\n         private final QueryCancellation queryCancellation;\n"}}, {"oid": "0ebf2f166da9d5a8aee2c73fe6939a7c679ecc0b", "url": "https://github.com/elastic/elasticsearch/commit/0ebf2f166da9d5a8aee2c73fe6939a7c679ecc0b", "message": "address comment", "committedDate": "2020-03-18T10:42:26Z", "type": "commit"}]}