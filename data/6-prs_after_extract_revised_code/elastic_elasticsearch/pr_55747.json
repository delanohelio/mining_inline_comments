{"pr_number": 55747, "pr_title": "Removed ValuesSourceRegistry.registerAny()", "pr_createdAt": "2020-04-24T20:05:26Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55747", "timeline": [{"oid": "44d2abb5fac91012e0773fc703830a2fa6b28f95", "url": "https://github.com/elastic/elasticsearch/commit/44d2abb5fac91012e0773fc703830a2fa6b28f95", "message": "Removed VSRegistry.registerAny()\n\nAll ValuesSourceTypes must be registered\nexplicitly", "committedDate": "2020-04-24T19:52:26Z", "type": "commit"}, {"oid": "1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f", "url": "https://github.com/elastic/elasticsearch/commit/1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f", "message": "Minor style changes", "committedDate": "2020-04-24T20:21:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzQ1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r414857455", "bodyText": "I think ALL might be a bit confusing here. I wonder if renaming it into ALL_CORE or using Arrays.asList(CoreValuesSourceType.values()) instead of the constant will better demonstrate the actual scope here for future readers.", "author": "imotov", "createdAt": "2020-04-24T20:55:09Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/CoreValuesSourceType.java", "diffHunk": "@@ -288,4 +291,6 @@ public String value() {\n         return name().toLowerCase(Locale.ROOT);\n     }\n \n+    /** List containing all members of the enumeration. */\n+    public static List<ValuesSourceType> ALL = Arrays.asList(CoreValuesSourceType.values());", "originalCommit": "1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI5NjgyMA==", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r415296820", "bodyText": "To me it seemed clear that CoreValuesSourceType.ALL is about all core VST. I renamed it to CoreValuesSourceType.ALL_CORE hoping that this can't be misunderstood.", "author": "csoulios", "createdAt": "2020-04-26T12:17:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzQ1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "4033b98b78adc8e893db3aece581dae6bc1f5ea2", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/search/aggregations/support/CoreValuesSourceType.java b/server/src/main/java/org/elasticsearch/search/aggregations/support/CoreValuesSourceType.java\nindex e406eca7dab..3462607034b 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/support/CoreValuesSourceType.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/support/CoreValuesSourceType.java\n\n@@ -292,5 +292,5 @@ public enum CoreValuesSourceType implements ValuesSourceType {\n     }\n \n     /** List containing all members of the enumeration. */\n-    public static List<ValuesSourceType> ALL = Arrays.asList(CoreValuesSourceType.values());\n+    public static List<ValuesSourceType> ALL_CORE = Arrays.asList(CoreValuesSourceType.values());\n }\n"}}, {"oid": "4033b98b78adc8e893db3aece581dae6bc1f5ea2", "url": "https://github.com/elastic/elasticsearch/commit/4033b98b78adc8e893db3aece581dae6bc1f5ea2", "message": "Renamed CoreValuesSourceType.ALL to ALL_CORE", "committedDate": "2020-04-26T12:19:21Z", "type": "commit"}, {"oid": "2c709d3558cd05ba1d97a35343925130dcf64a3f", "url": "https://github.com/elastic/elasticsearch/commit/2c709d3558cd05ba1d97a35343925130dcf64a3f", "message": "Removed lambdas in ValuesSourceRegistry", "committedDate": "2020-04-26T14:40:12Z", "type": "commit"}, {"oid": "3feb89965c0bd312715ca4bd515b0bfc4dd7fd15", "url": "https://github.com/elastic/elasticsearch/commit/3feb89965c0bd312715ca4bd515b0bfc4dd7fd15", "message": "Merge branch 'master' into vsregistry-remove-any", "committedDate": "2020-04-26T16:04:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg0MjUyNA==", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r415842524", "bodyText": "This doesn't need to be a List now.  We can just make it Map<String, Map<ValuesSourceType, AggregatorSupplier>>. \u00a0The list was only necessary because lambdas make bad hash keys.", "author": "not-napoleon", "createdAt": "2020-04-27T14:06:37Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceRegistry.java", "diffHunk": "@@ -42,99 +41,67 @@\n  */\n public class ValuesSourceRegistry {\n     public static class Builder {\n-        private Map<String, List<Map.Entry<Predicate<ValuesSourceType>, AggregatorSupplier>>> aggregatorRegistry = new HashMap<>();\n+        private Map<String, List<Map.Entry<ValuesSourceType, AggregatorSupplier>>> aggregatorRegistry = new HashMap<>();", "originalCommit": "3feb89965c0bd312715ca4bd515b0bfc4dd7fd15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg0OTg0OA==", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r415849848", "bodyText": "Can I do it later in a separate PR? This will really mess me up if it is done in this PR.", "author": "imotov", "createdAt": "2020-04-27T14:15:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg0MjUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkzODUyOA==", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r415938528", "bodyText": "No problem @imotov if you are both ok with this, I will merge this PR and you can change this List to Map later.", "author": "csoulios", "createdAt": "2020-04-27T15:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg0MjUyNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "90ea7ddd1a6eaaeb7faecc83e01a91278def008c", "url": "https://github.com/elastic/elasticsearch/commit/90ea7ddd1a6eaaeb7faecc83e01a91278def008c", "message": "Merge branch 'master' into vsregistry-remove-any", "committedDate": "2020-04-27T20:45:45Z", "type": "commit"}]}