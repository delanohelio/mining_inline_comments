{"pr_number": 64590, "pr_title": "Add configurable op_type for index watcher action", "pr_createdAt": "2020-11-04T13:42:04Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64590", "timeline": [{"oid": "e8948282c2ba9d73e8703be47b74f433ab227e96", "url": "https://github.com/elastic/elasticsearch/commit/e8948282c2ba9d73e8703be47b74f433ab227e96", "message": "add configurable op_type for index watcher action", "committedDate": "2020-11-04T13:39:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQwNzk3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/64590#discussion_r517407973", "bodyText": "maybe validate that only create or index op type can be used?", "author": "martijnvg", "createdAt": "2020-11-04T15:01:42Z", "path": "x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/index/IndexAction.java", "diffHunk": "@@ -143,6 +156,13 @@ public static IndexAction parse(String watchId, String actionId, XContentParser\n             } else if (token == XContentParser.Token.VALUE_STRING) {\n                 if (Field.DOC_ID.match(currentFieldName, parser.getDeprecationHandler())) {\n                     docId = parser.text();\n+                } else if (Field.OP_TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                    try {\n+                        opType = DocWriteRequest.OpType.fromString(parser.text());", "originalCommit": "e8948282c2ba9d73e8703be47b74f433ab227e96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwMDA0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/64590#discussion_r517500047", "bodyText": "Thanks, @martijnvg. What versions do you think we should target for this?", "author": "danhermann", "createdAt": "2020-11-04T17:10:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQwNzk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg3MDcwNw==", "url": "https://github.com/elastic/elasticsearch/pull/64590#discussion_r517870707", "bodyText": "8.0.0 and 7.11?", "author": "martijnvg", "createdAt": "2020-11-05T08:30:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQwNzk3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "fe61aaa7be00b549bae3d862d8f9e87ff7889951", "chunk": "diff --git a/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/index/IndexAction.java b/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/index/IndexAction.java\nindex 6f8c1ac9723..ecbd4eb0eb6 100644\n--- a/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/index/IndexAction.java\n+++ b/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/index/IndexAction.java\n\n@@ -159,6 +160,10 @@ public class IndexAction implements Action {\n                 } else if (Field.OP_TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n                     try {\n                         opType = DocWriteRequest.OpType.fromString(parser.text());\n+                        if (List.of(DocWriteRequest.OpType.CREATE, DocWriteRequest.OpType.INDEX).contains(opType) == false) {\n+                            throw new ElasticsearchParseException(\"could not parse [{}] action [{}/{}]. op_type value for field [{}] \" +\n+                                \"must be [index] or [create]\", TYPE, watchId, actionId, currentFieldName);\n+                        }\n                     } catch (IllegalArgumentException e) {\n                         throw new ElasticsearchParseException(\"could not parse [{}] action [{}/{}]. failed to parse op_type value for \" +\n                             \"field [{}]\", TYPE, watchId, actionId, currentFieldName);\n"}}, {"oid": "fe61aaa7be00b549bae3d862d8f9e87ff7889951", "url": "https://github.com/elastic/elasticsearch/commit/fe61aaa7be00b549bae3d862d8f9e87ff7889951", "message": "limit to index and create op_types", "committedDate": "2020-11-04T17:08:04Z", "type": "commit"}, {"oid": "0706985104f6a93699c887bb899e881a7ace7c16", "url": "https://github.com/elastic/elasticsearch/commit/0706985104f6a93699c887bb899e881a7ace7c16", "message": "fix test", "committedDate": "2020-11-04T17:26:26Z", "type": "commit"}, {"oid": "118739d7b77c48610aacd16e02fc8a9d4cc8526a", "url": "https://github.com/elastic/elasticsearch/commit/118739d7b77c48610aacd16e02fc8a9d4cc8526a", "message": "update docs", "committedDate": "2020-11-04T18:48:43Z", "type": "commit"}]}