{"pr_number": 64433, "pr_title": "Enhance logging for timed out transport requests", "pr_createdAt": "2020-10-30T17:35:39Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64433", "timeline": [{"oid": "dc579d21489e46a8db8826ec147437af2ba0dcdd", "url": "https://github.com/elastic/elasticsearch/commit/dc579d21489e46a8db8826ec147437af2ba0dcdd", "message": "Enhance logging for timed out transport requests\n\nThe current logging:\n\n```\nReceived response for a request that has timed out, sent [2148898ms] ago, timed out [348859ms] ago\n```\n\nThis just saves having to do the mental math for milliseconds and produces:\n\n```\nReceived response for a request that has timed out, sent [35.8m/2148898ms] ago, timed out [5.8m/348859ms] ago\n```", "committedDate": "2020-10-30T17:32:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMyNTIyNw==", "url": "https://github.com/elastic/elasticsearch/pull/64433#discussion_r515325227", "bodyText": "nit: maybe calculate these in a local, rather then doing each twice", "author": "rjernst", "createdAt": "2020-10-30T19:22:12Z", "path": "server/src/main/java/org/elasticsearch/transport/TransportService.java", "diffHunk": "@@ -947,8 +947,10 @@ private void checkForTimeout(long requestId) {\n         TimeoutInfoHolder timeoutInfoHolder = timeoutInfoHandlers.remove(requestId);\n         if (timeoutInfoHolder != null) {\n             long time = threadPool.relativeTimeInMillis();\n-            logger.warn(\"Received response for a request that has timed out, sent [{}ms] ago, timed out [{}ms] ago, \" +\n-                    \"action [{}], node [{}], id [{}]\", time - timeoutInfoHolder.sentTime(), time - timeoutInfoHolder.timeoutTime(),\n+            logger.warn(\"Received response for a request that has timed out, sent [{}/{}ms] ago, timed out [{}/{}ms] ago, \" +\n+                    \"action [{}], node [{}], id [{}]\",\n+                TimeValue.timeValueMillis(time - timeoutInfoHolder.sentTime()), time - timeoutInfoHolder.sentTime(),", "originalCommit": "dc579d21489e46a8db8826ec147437af2ba0dcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9f446868af080483f221d0243d188f49a516486", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/transport/TransportService.java b/server/src/main/java/org/elasticsearch/transport/TransportService.java\nindex dd5fb9893e2..6ec09c683b1 100644\n--- a/server/src/main/java/org/elasticsearch/transport/TransportService.java\n+++ b/server/src/main/java/org/elasticsearch/transport/TransportService.java\n\n@@ -947,10 +947,12 @@ public class TransportService extends AbstractLifecycleComponent implements Repo\n         TimeoutInfoHolder timeoutInfoHolder = timeoutInfoHandlers.remove(requestId);\n         if (timeoutInfoHolder != null) {\n             long time = threadPool.relativeTimeInMillis();\n+            long sentMs = time - timeoutInfoHolder.sentTime();\n+            long timedOutMs = time - timeoutInfoHolder.timeoutTime();\n             logger.warn(\"Received response for a request that has timed out, sent [{}/{}ms] ago, timed out [{}/{}ms] ago, \" +\n                     \"action [{}], node [{}], id [{}]\",\n-                TimeValue.timeValueMillis(time - timeoutInfoHolder.sentTime()), time - timeoutInfoHolder.sentTime(),\n-                TimeValue.timeValueMillis(time - timeoutInfoHolder.timeoutTime()), time - timeoutInfoHolder.timeoutTime(),\n+                TimeValue.timeValueMillis(sentMs), sentMs,\n+                TimeValue.timeValueMillis(timedOutMs), timedOutMs,\n                 timeoutInfoHolder.action(), timeoutInfoHolder.node(), requestId);\n             action = timeoutInfoHolder.action();\n             sourceNode = timeoutInfoHolder.node();\n"}}, {"oid": "b9f446868af080483f221d0243d188f49a516486", "url": "https://github.com/elastic/elasticsearch/commit/b9f446868af080483f221d0243d188f49a516486", "message": "Pull into local var and only subtract one time", "committedDate": "2020-11-02T16:45:31Z", "type": "commit"}, {"oid": "4d416f6959a9001f5a9fb0e7b7b09be1b4850b06", "url": "https://github.com/elastic/elasticsearch/commit/4d416f6959a9001f5a9fb0e7b7b09be1b4850b06", "message": "Merge branch 'master' into enhance-logging", "committedDate": "2020-11-02T16:46:07Z", "type": "commit"}]}