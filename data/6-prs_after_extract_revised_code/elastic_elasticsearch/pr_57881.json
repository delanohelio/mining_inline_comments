{"pr_number": 57881, "pr_title": "Add range query support to wildcard field", "pr_createdAt": "2020-06-09T14:38:52Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57881", "timeline": [{"oid": "f67942df6667ea730c6cb7b8edf87af7b802451a", "url": "https://github.com/elastic/elasticsearch/commit/f67942df6667ea730c6cb7b8edf87af7b802451a", "message": "Add range query support to wildcard field\n\nCloses #57816", "committedDate": "2020-06-09T16:27:56Z", "type": "commit"}, {"oid": "f67942df6667ea730c6cb7b8edf87af7b802451a", "url": "https://github.com/elastic/elasticsearch/commit/f67942df6667ea730c6cb7b8edf87af7b802451a", "message": "Add range query support to wildcard field\n\nCloses #57816", "committedDate": "2020-06-09T16:27:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0ODc1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/57881#discussion_r438348755", "bodyText": "maybe add a specific test for case (e.g: ProgramFiles => programFiles)  and one without a common prefix ?", "author": "jimczi", "createdAt": "2020-06-10T19:09:02Z", "path": "x-pack/plugin/wildcard/src/test/java/org/elasticsearch/xpack/wildcard/mapper/WildcardFieldMapperTests.java", "diffHunk": "@@ -485,6 +494,54 @@ public void testFuzzyAcceleration() throws IOException, ParseException {\n         }\n     }    \n     \n+    \n+    static class RangeTest {\n+        String lower;\n+        String upper;\n+        String ngrams;\n+\n+        RangeTest(\n+            String lower,\n+            String upper,\n+            String ngrams\n+        ) {\n+            super();\n+            this.lower = lower;\n+            this.upper = upper;\n+            this.ngrams = ngrams;\n+        }\n+\n+        Query getRangeQuery() {\n+            return wildcardFieldType.fieldType().rangeQuery(lower, upper, true, true, null, null, null, MOCK_QSC);\n+        }\n+\n+        Query getExpectedApproxQuery() throws ParseException {\n+            BooleanQuery.Builder bq = new BooleanQuery.Builder();\n+            if (ngrams != null) {\n+                String[] tokens = ngrams.split(\" \");\n+                for (String token : tokens) {\n+                    Query ngramQuery = new TermQuery(\n+                        new Term(WILDCARD_FIELD_NAME, token.replaceAll(\"_\", WildcardFieldMapper.TOKEN_START_STRING))\n+                    );\n+                    bq.add(ngramQuery, Occur.MUST);\n+                }\n+            }\n+            return bq.build();\n+        }\n+    }    \n+    \n+    public void testRangeAcceleration() throws IOException, ParseException {\n+\n+        RangeTest[] tests = {\n+            new RangeTest(\"c:/a.txt\", \"c:/z.txt\", \"_c: c:/\"),\n+            new RangeTest(\"C:/ProgramFiles/a.txt\", \"C:/ProgramFiles/z.txt\", \"_c: :/p pro ogr ram mfi ile es/\"),", "originalCommit": "f67942df6667ea730c6cb7b8edf87af7b802451a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "dd951fa4e5130b8797ad29d4988d363f0dceae80", "url": "https://github.com/elastic/elasticsearch/commit/dd951fa4e5130b8797ad29d4988d363f0dceae80", "message": "Added test and fix for bug it revealed.", "committedDate": "2020-06-11T09:39:21Z", "type": "commit"}]}