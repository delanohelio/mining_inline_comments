{"pr_number": 59513, "pr_title": "Fix SYS COLUMNS schema in ODBC mode", "pr_createdAt": "2020-07-14T09:58:09Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59513", "timeline": [{"oid": "6fe569bddefc189eb92b38ba7d253fa0779ddef9", "url": "https://github.com/elastic/elasticsearch/commit/6fe569bddefc189eb92b38ba7d253fa0779ddef9", "message": "Fix SYS COLUMNS schema in ODBC mode\n\nThis fixes a regression when certain ODBC-specific columns that need to\nbe of the short type were returned as the integer type.", "committedDate": "2020-07-14T09:54:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI1MTMzNA==", "url": "https://github.com/elastic/elasticsearch/pull/59513#discussion_r454251334", "bodyText": "Personal preference: I like to have the private methods at the bottom of the class and not before they are first used.", "author": "matriv", "createdAt": "2020-07-14T10:14:14Z", "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/plan/logical/command/sys/SysColumnsTests.java", "diffHunk": "@@ -501,10 +506,29 @@ public void testSysColumnsWithNullCatalog() throws Exception {\n         }, mapping);\n     }\n \n+    private static void checkOdbcShortTypes(SchemaRowSet r) {", "originalCommit": "6fe569bddefc189eb92b38ba7d253fa0779ddef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI2MTQ4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/59513#discussion_r454261486", "bodyText": "Thanks, updated.\nI've also updated the actual fix, since it wasn't entirely correct regarding pagination.", "author": "bpintea", "createdAt": "2020-07-14T10:33:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI1MTMzNA=="}], "type": "inlineReview", "revised_code": {"commit": "365ac5b621c9ff11d0d0132b7113c167573122ff", "chunk": "diff --git a/x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/plan/logical/command/sys/SysColumnsTests.java b/x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/plan/logical/command/sys/SysColumnsTests.java\nindex c233c1859e9..515b9e17581 100644\n--- a/x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/plan/logical/command/sys/SysColumnsTests.java\n+++ b/x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/plan/logical/command/sys/SysColumnsTests.java\n\n@@ -506,16 +506,6 @@ public class SysColumnsTests extends ESTestCase {\n         }, mapping);\n     }\n \n-    private static void checkOdbcShortTypes(SchemaRowSet r) {\n-        assertEquals(15, r.size());\n-        // https://github.com/elastic/elasticsearch/issues/35376\n-        // cols that need to be of short type: DATA_TYPE, DECIMAL_DIGITS, NUM_PREC_RADIX, NULLABLE, SQL_DATA_TYPE, SQL_DATETIME_SUB\n-        List<Integer> cols = Arrays.asList(4, 8, 9, 10, 13, 14);\n-        for (Integer i: cols) {\n-            assertEquals(\"short\", r.schema().get(i).type().name().toLowerCase(Locale.ROOT));\n-        }\n-    }\n-\n     public void testSysColumnsTypesInOdbcMode() throws Exception {\n         executeCommand(\"SYS COLUMNS\", emptyList(), Mode.ODBC, SysColumnsTests::checkOdbcShortTypes, mapping);\n         executeCommand(\"SYS COLUMNS TABLE LIKE 'test'\", emptyList(), Mode.ODBC, SysColumnsTests::checkOdbcShortTypes, mapping);\n"}}, {"oid": "365ac5b621c9ff11d0d0132b7113c167573122ff", "url": "https://github.com/elastic/elasticsearch/commit/365ac5b621c9ff11d0d0132b7113c167573122ff", "message": "Fix results pagination\n\nA ListCursor needs to be providing the Page, otherwise the pagination is\nnot respected.\n\nAlso fix review comments.", "committedDate": "2020-07-14T10:29:21Z", "type": "commit"}, {"oid": "0a9f1aac21c2044351f453a247bf5dd2ebd574c9", "url": "https://github.com/elastic/elasticsearch/commit/0a9f1aac21c2044351f453a247bf5dd2ebd574c9", "message": "Merge branch 'master' into fix/59506", "committedDate": "2020-07-14T10:31:44Z", "type": "commit"}, {"oid": "a7b4a8ef427959f20148e2db5470dfb87c79549a", "url": "https://github.com/elastic/elasticsearch/commit/a7b4a8ef427959f20148e2db5470dfb87c79549a", "message": "Fix test stubbing. Add cursor test\n\nThis fixes the stubbing for the *-indices SYS COLUMN commands.\n\nIt also adds testing for response pagination in ODBC mode.", "committedDate": "2020-07-23T10:21:02Z", "type": "commit"}, {"oid": "83ef45dfd97d18f807b5e8c7118f52a56e340ad4", "url": "https://github.com/elastic/elasticsearch/commit/83ef45dfd97d18f807b5e8c7118f52a56e340ad4", "message": "Fix style violation\n\nTrim a line to 140 border.", "committedDate": "2020-07-23T11:20:08Z", "type": "commit"}, {"oid": "aa6bc87e5d8819f644978a8e8c8fa71fee6fd14c", "url": "https://github.com/elastic/elasticsearch/commit/aa6bc87e5d8819f644978a8e8c8fa71fee6fd14c", "message": "Merge branch 'master' into fix/59506", "committedDate": "2020-07-23T11:21:02Z", "type": "commit"}]}