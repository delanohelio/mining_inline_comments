{"pr_number": 56253, "pr_title": "Add prefer_v2_templates parameter to Reindex", "pr_createdAt": "2020-05-05T22:12:45Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56253", "timeline": [{"oid": "30c83baf19d4eed0a253b4127ad4663ae0adfdb1", "url": "https://github.com/elastic/elasticsearch/commit/30c83baf19d4eed0a253b4127ad4663ae0adfdb1", "message": "prefer_v2_templates for reindex", "committedDate": "2020-05-04T21:48:09Z", "type": "commit"}, {"oid": "9b41be4b6802aa96d373844bd45538e4951818de", "url": "https://github.com/elastic/elasticsearch/commit/9b41be4b6802aa96d373844bd45538e4951818de", "message": "hlrc", "committedDate": "2020-05-04T21:55:11Z", "type": "commit"}, {"oid": "f3d11049e296243a1a1b4f5e3854fed891795ae9", "url": "https://github.com/elastic/elasticsearch/commit/f3d11049e296243a1a1b4f5e3854fed891795ae9", "message": "tests", "committedDate": "2020-05-05T22:07:36Z", "type": "commit"}, {"oid": "44009a13cebc19618b8b6d2944d909a4b0f28158", "url": "https://github.com/elastic/elasticsearch/commit/44009a13cebc19618b8b6d2944d909a4b0f28158", "message": "fix for backport", "committedDate": "2020-05-05T22:08:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ2ODAyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/56253#discussion_r420468021", "bodyText": "I think this is going to have to be 8.0.0 until this gets backported", "author": "dakrone", "createdAt": "2020-05-05T23:31:54Z", "path": "server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java", "diffHunk": "@@ -86,6 +91,9 @@ public ReindexRequest(StreamInput in) throws IOException {\n         super(in);\n         destination = new IndexRequest(in);\n         remoteInfo = in.readOptionalWriteable(RemoteInfo::new);\n+        if (in.getVersion().onOrAfter(Version.V_7_8_0)) {", "originalCommit": "44009a13cebc19618b8b6d2944d909a4b0f28158", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMTA3NA==", "url": "https://github.com/elastic/elasticsearch/pull/56253#discussion_r420911074", "bodyText": "Yep, you're right, changed it and will follow up after backport", "author": "probakowski", "createdAt": "2020-05-06T16:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ2ODAyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "026d0b23bd39dc963cbe05249aba1f280c1b43cf", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex 8d9f72529e1..4f333474bcd 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n\n@@ -91,7 +90,7 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n         super(in);\n         destination = new IndexRequest(in);\n         remoteInfo = in.readOptionalWriteable(RemoteInfo::new);\n-        if (in.getVersion().onOrAfter(Version.V_7_8_0)) {\n+        if (in.getVersion().onOrAfter(Version.V_8_0_0)) {\n             preferV2Templates = in.readOptionalBoolean();\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ2ODE4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/56253#discussion_r420468182", "bodyText": "Same comment here about this having to be 8.0.0 until backport (or else the BWC tests will likely fail)", "author": "dakrone", "createdAt": "2020-05-05T23:32:24Z", "path": "server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java", "diffHunk": "@@ -262,6 +280,9 @@ public void writeTo(StreamOutput out) throws IOException {\n         super.writeTo(out);\n         destination.writeTo(out);\n         out.writeOptionalWriteable(remoteInfo);\n+        if (out.getVersion().onOrAfter(Version.V_7_8_0)) {", "originalCommit": "44009a13cebc19618b8b6d2944d909a4b0f28158", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMTIwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/56253#discussion_r420911201", "bodyText": "Yep, you're right, changed it and will follow up after backport", "author": "probakowski", "createdAt": "2020-05-06T16:06:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ2ODE4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "026d0b23bd39dc963cbe05249aba1f280c1b43cf", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex 8d9f72529e1..4f333474bcd 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n\n@@ -280,7 +279,7 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n         super.writeTo(out);\n         destination.writeTo(out);\n         out.writeOptionalWriteable(remoteInfo);\n-        if (out.getVersion().onOrAfter(Version.V_7_8_0)) {\n+        if (out.getVersion().onOrAfter(Version.V_8_0_0)) {\n             out.writeOptionalBoolean(preferV2Templates);\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyODQ1Ng==", "url": "https://github.com/elastic/elasticsearch/pull/56253#discussion_r420628456", "bodyText": "for 8.0 we want this to default to true if it's not specified by the user (this is just a reminder to change this after backport)", "author": "andreidan", "createdAt": "2020-05-06T08:35:44Z", "path": "modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java", "diffHunk": "@@ -68,6 +68,11 @@ protected ReindexRequest buildRequest(RestRequest request) throws IOException {\n         if (request.hasParam(\"scroll\")) {\n             internal.setScroll(parseTimeValue(request.param(\"scroll\"), \"scroll\"));\n         }\n+\n+        if (request.hasParam(\"prefer_v2_templates\")) {\n+            internal.preferV2Templates(Boolean.parseBoolean(request.param(\"prefer_v2_templates\")));", "originalCommit": "44009a13cebc19618b8b6d2944d909a4b0f28158", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMzIzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/56253#discussion_r420913235", "bodyText": "I wonder if we should change it here or simply pass null down the road and let create index request pick up correct default (for making it DRY and using only single place to set defaults)", "author": "probakowski", "createdAt": "2020-05-06T16:09:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyODQ1Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "026d0b23bd39dc963cbe05249aba1f280c1b43cf", "url": "https://github.com/elastic/elasticsearch/commit/026d0b23bd39dc963cbe05249aba1f280c1b43cf", "message": "bwc version fix", "committedDate": "2020-05-06T15:57:36Z", "type": "commit"}, {"oid": "0460958b9dd2fb710854711af02bd79b9082b1bd", "url": "https://github.com/elastic/elasticsearch/commit/0460958b9dd2fb710854711af02bd79b9082b1bd", "message": "Merge remote-tracking branch 'origin/master' into reindex-prefer-v2-templates", "committedDate": "2020-05-06T17:14:19Z", "type": "commit"}]}