{"pr_number": 51690, "pr_title": "Remove \"extractVariables\" phase from Painless user tree", "pr_createdAt": "2020-01-30T17:35:20Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51690", "timeline": [{"oid": "2249a44e3c44aafa15306674d47360e7bd491d9c", "url": "https://github.com/elastic/elasticsearch/commit/2249a44e3c44aafa15306674d47360e7bd491d9c", "message": "remove extract variables pass", "committedDate": "2020-01-30T17:05:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEyMTM2NA==", "url": "https://github.com/elastic/elasticsearch/pull/51690#discussion_r373121364", "bodyText": "Why is functionScope the container for these?  They used to be spread all over.", "author": "stu-elastic", "createdAt": "2020-01-30T18:36:05Z", "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SClass.java", "diffHunk": "@@ -159,6 +141,8 @@ public ScriptRoot analyze(PainlessLookup painlessLookup, CompilerSettings settin\n             allEscape = statement.allEscape;\n         }\n \n+        scriptRoot.setUsedVariables(functionScope.getUsedVariables());", "originalCommit": "2249a44e3c44aafa15306674d47360e7bd491d9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzNDA1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/51690#discussion_r373134051", "bodyText": "Good question as this is in transition. It was easier to move it a single place for this PR since we only care about which function scope variables are used, but it turns out with removal of some of the custom code for the execute method in both trees it will be required throughout all scopes. This will be updated in future PRs, so I would prefer to not change it here.", "author": "jdconrad", "createdAt": "2020-01-30T19:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEyMTM2NA=="}], "type": "inlineReview", "revised_code": null}]}