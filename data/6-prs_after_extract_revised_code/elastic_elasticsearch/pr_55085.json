{"pr_number": 55085, "pr_title": "Fix TranslogTests#testStats", "pr_createdAt": "2020-04-10T19:58:34Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55085", "timeline": [{"oid": "9b2c5cea29272896b0c5363e31d8782425580ad1", "url": "https://github.com/elastic/elasticsearch/commit/9b2c5cea29272896b0c5363e31d8782425580ad1", "message": "Fix TranslogTests#testStats", "committedDate": "2020-04-10T19:51:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzAzOTcyOA==", "url": "https://github.com/elastic/elasticsearch/pull/55085#discussion_r407039728", "bodyText": "I think we should eventually fix the time source used by the translog to not be System.currentTimeMillis() here and use the ThreadPool time suppliers we already use elsewhere. But for now this should be fine :)", "author": "original-brownbear", "createdAt": "2020-04-11T09:13:17Z", "path": "server/src/test/java/org/elasticsearch/index/translog/TranslogTests.java", "diffHunk": "@@ -419,6 +419,8 @@ public void testFindEarliestLastModifiedAge() throws IOException {\n     }\n \n     public void testStats() throws IOException {\n+        assertThat(translog.getCurrent().getLastModifiedTime(), lessThanOrEqualTo(System.currentTimeMillis()));\n+        long lastModifiedAge = System.currentTimeMillis() - translog.getCurrent().getLastModifiedTime();", "originalCommit": "9b2c5cea29272896b0c5363e31d8782425580ad1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2MzgxNg==", "url": "https://github.com/elastic/elasticsearch/pull/55085#discussion_r407063816", "bodyText": "I think we should eventually fix the time source used by the translog to not be System.currentTimeMillis() here and use the ThreadPool time suppliers we already use elsewhere\n\n++", "author": "dnhatn", "createdAt": "2020-04-11T13:26:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzAzOTcyOA=="}], "type": "inlineReview", "revised_code": null}]}