{"pr_number": 58226, "pr_title": "Add new extensions for Lucene86 points codec to FsDirectoryFactory", "pr_createdAt": "2020-06-17T08:19:01Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58226", "timeline": [{"oid": "62514ecd12525f2bf44a9bf2493e1a8dd1aedeab", "url": "https://github.com/elastic/elasticsearch/commit/62514ecd12525f2bf44a9bf2493e1a8dd1aedeab", "message": "Add new extensions for Lucene86 points codec to FsDirectoryFactory", "committedDate": "2020-06-17T08:14:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM3MjcyOA==", "url": "https://github.com/elastic/elasticsearch/pull/58226#discussion_r441372728", "bodyText": "add a comment that this one can be removed when we are on Lucene 10 since it only applies to Lucene 8.x indices?", "author": "jpountz", "createdAt": "2020-06-17T08:28:04Z", "path": "server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java", "diffHunk": "@@ -161,6 +161,9 @@ boolean useDelegate(String name) {\n                 // well if using mmap.\n                 case \"tip\":\n                 case \"dim\":", "originalCommit": "62514ecd12525f2bf44a9bf2493e1a8dd1aedeab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e9a401b8a104b7d2c926e7d6fcdd1bc7ddbfbc70", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java b/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java\nindex 214ac796b5d..950ddf1d147 100644\n--- a/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java\n+++ b/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java\n\n@@ -160,10 +160,10 @@ public class FsDirectoryFactory implements IndexStorePlugin.DirectoryFactory {\n                 // We want to open the terms index and KD-tree index off-heap to save memory, but this only performs\n                 // well if using mmap.\n                 case \"tip\":\n+                // dim files only apply up to lucene 8.x indices. It can be removed once we are in lucene 10\n                 case \"dim\":\n                 case \"kdd\":\n                 case \"kdi\":\n-                case \"kdm\":\n                 // Compound files are tricky because they store all the information for the segment. Benchmarks\n                 // suggested that not mapping them hurts performance.\n                 case \"cfs\":\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM3MjkxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/58226#discussion_r441372915", "bodyText": "we don't need to mmap the kdm file which is a read-once file", "author": "jpountz", "createdAt": "2020-06-17T08:28:23Z", "path": "server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java", "diffHunk": "@@ -161,6 +161,9 @@ boolean useDelegate(String name) {\n                 // well if using mmap.\n                 case \"tip\":\n                 case \"dim\":\n+                case \"kdd\":\n+                case \"kdi\":\n+                case \"kdm\":", "originalCommit": "62514ecd12525f2bf44a9bf2493e1a8dd1aedeab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e9a401b8a104b7d2c926e7d6fcdd1bc7ddbfbc70", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java b/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java\nindex 214ac796b5d..950ddf1d147 100644\n--- a/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java\n+++ b/server/src/main/java/org/elasticsearch/index/store/FsDirectoryFactory.java\n\n@@ -160,10 +160,10 @@ public class FsDirectoryFactory implements IndexStorePlugin.DirectoryFactory {\n                 // We want to open the terms index and KD-tree index off-heap to save memory, but this only performs\n                 // well if using mmap.\n                 case \"tip\":\n+                // dim files only apply up to lucene 8.x indices. It can be removed once we are in lucene 10\n                 case \"dim\":\n                 case \"kdd\":\n                 case \"kdi\":\n-                case \"kdm\":\n                 // Compound files are tricky because they store all the information for the segment. Benchmarks\n                 // suggested that not mapping them hurts performance.\n                 case \"cfs\":\n"}}, {"oid": "e9a401b8a104b7d2c926e7d6fcdd1bc7ddbfbc70", "url": "https://github.com/elastic/elasticsearch/commit/e9a401b8a104b7d2c926e7d6fcdd1bc7ddbfbc70", "message": "Address review comments", "committedDate": "2020-06-17T08:38:37Z", "type": "commit"}]}