{"pr_number": 56565, "pr_title": "Adjust warning for heap size bootstrap check", "pr_createdAt": "2020-05-12T03:57:02Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56565", "timeline": [{"oid": "b3c3dc9f2195d28f59ccce8dad5e3fd6475643d6", "url": "https://github.com/elastic/elasticsearch/commit/b3c3dc9f2195d28f59ccce8dad5e3fd6475643d6", "message": "Adjust warning for heap size bootstrap check\n\nToday the heap size check warns the user about two issues why they might\ncare about the heap size check: resize pauses, and if memory locking is\nenabled. Yet, we unconditionally make mention of the memory locking\nreason, even if memory locking is not enabled. This can confuse some\nusers, so we adjust the warning about memory locking to only display if\nmemory locking is enabled.", "committedDate": "2020-05-12T03:54:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ2NzE1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/56565#discussion_r423467151", "bodyText": "Shouldn't the memory locking part be in the other condition's message, since this is the not memory locked case?", "author": "rjernst", "createdAt": "2020-05-12T05:17:00Z", "path": "server/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java", "diffHunk": "@@ -226,12 +226,22 @@ public BootstrapCheckResult check(BootstrapContext context) {\n             final long initialHeapSize = getInitialHeapSize();\n             final long maxHeapSize = getMaxHeapSize();\n             if (initialHeapSize != 0 && maxHeapSize != 0 && initialHeapSize != maxHeapSize) {\n-                final String message = String.format(\n+                final String message;\n+                if (isMemoryLocked()) {\n+                    message = String.format(\n+                        Locale.ROOT,\n+                        \"initial heap size [%d] not equal to maximum heap size [%d]; \" +\n+                            \"this can cause resize pauses\",\n+                        getInitialHeapSize(),\n+                        getMaxHeapSize());\n+                } else {\n+                    message = String.format(\n                         Locale.ROOT,\n                         \"initial heap size [%d] not equal to maximum heap size [%d]; \" +\n-                                \"this can cause resize pauses and prevents mlockall from locking the entire heap\",\n+                            \"this can cause resize pauses and prevents memory locking from locking the entire heap\",", "originalCommit": "b3c3dc9f2195d28f59ccce8dad5e3fd6475643d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e66fb276d561e9768f32aa63d0a4e1741a4ee6c7", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java b/server/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java\nindex e008e2ecd92..c34d84d7883 100644\n--- a/server/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java\n+++ b/server/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java\n\n@@ -231,14 +231,14 @@ final class BootstrapChecks {\n                     message = String.format(\n                         Locale.ROOT,\n                         \"initial heap size [%d] not equal to maximum heap size [%d]; \" +\n-                            \"this can cause resize pauses\",\n+                            \"this can cause resize pauses and prevents memory locking from locking the entire heap\",\n                         getInitialHeapSize(),\n                         getMaxHeapSize());\n                 } else {\n                     message = String.format(\n                         Locale.ROOT,\n                         \"initial heap size [%d] not equal to maximum heap size [%d]; \" +\n-                            \"this can cause resize pauses and prevents memory locking from locking the entire heap\",\n+                            \"this can cause resize pauses\",\n                         getInitialHeapSize(),\n                         getMaxHeapSize());\n                 }\n"}}, {"oid": "e66fb276d561e9768f32aa63d0a4e1741a4ee6c7", "url": "https://github.com/elastic/elasticsearch/commit/e66fb276d561e9768f32aa63d0a4e1741a4ee6c7", "message": "Iteration", "committedDate": "2020-05-12T17:24:30Z", "type": "commit"}, {"oid": "45d5f98eb9943c535fe1e8879adb74f592b40ff2", "url": "https://github.com/elastic/elasticsearch/commit/45d5f98eb9943c535fe1e8879adb74f592b40ff2", "message": "Merge branch 'master' into heap-size-checking-conditional-memory-locking", "committedDate": "2020-05-12T17:48:36Z", "type": "commit"}]}