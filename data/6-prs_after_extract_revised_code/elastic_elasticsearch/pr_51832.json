{"pr_number": 51832, "pr_title": "Test modifications for FIPS 140 mode", "pr_createdAt": "2020-02-03T21:43:16Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51832", "timeline": [{"oid": "a93ab918384be2136f1b5289cc0b3cf12e683103", "url": "https://github.com/elastic/elasticsearch/commit/a93ab918384be2136f1b5289cc0b3cf12e683103", "message": "Test modifications for FIPS 140 mode\n\n- Enable SunJGSS provider for Kerberos tests\n- Handle the fact that in the decrypt method in KeyStoreWrapper might\nnot throw immediately when the GCM cipher is from BouncyCastle FIPS\nand we end up with a DataInputStream that has reached it's end.\n- Disable tests, jarHell, testingConventions for ingest attachment\nplugin. We don't support this plugin (and document this) in FIPS\nmode.\n- Don't attempt to install ingest-attachment in smoke-test-plugins", "committedDate": "2020-02-03T21:34:48Z", "type": "commit"}, {"oid": "32766a59a437d1710163e247d63c3d1a833fd742", "url": "https://github.com/elastic/elasticsearch/commit/32766a59a437d1710163e247d63c3d1a833fd742", "message": "fix casting in stream", "committedDate": "2020-02-04T05:37:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU1NDExNg==", "url": "https://github.com/elastic/elasticsearch/pull/51832#discussion_r374554116", "bodyText": "Should be the following instead? The other uses of stringMatchers in this method aren't wrapped in Arrays.asList.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assertThat(logfile, anyOf(Arrays.asList(stringMatchers)));\n          \n          \n            \n                        assertThat(logfile, anyOf(stringMatchers));", "author": "pugnascotia", "createdAt": "2020-02-04T09:21:06Z", "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackagingTestCase.java", "diffHunk": "@@ -310,23 +316,28 @@ public void startElasticsearch() throws Exception {\n         return Archives.startElasticsearchWithTty(installation, sh, password);\n     }\n \n-\n     public void assertElasticsearchFailure(Shell.Result result, String expectedMessage, Packages.JournaldWrapper journaldWrapper) {\n+        assertElasticsearchFailure(result, Collections.singletonList(expectedMessage), journaldWrapper);\n+    }\n \n+    public void assertElasticsearchFailure(Shell.Result result, List<String> expectedMessages, Packages.JournaldWrapper journaldWrapper) {\n+        @SuppressWarnings(\"unchecked\")\n+        Matcher<String>[] stringMatchers = expectedMessages.stream().map(CoreMatchers::containsString).toArray(Matcher[]::new);\n         if (Files.exists(installation.logs.resolve(\"elasticsearch.log\"))) {\n \n             // If log file exists, then we have bootstrapped our logging and the\n             // error should be in the logs\n             assertTrue(\"log file exists\", Files.exists(installation.logs.resolve(\"elasticsearch.log\")));\n             String logfile = FileUtils.slurp(installation.logs.resolve(\"elasticsearch.log\"));\n-            assertThat(logfile, containsString(expectedMessage));\n+\n+            assertThat(logfile, anyOf(Arrays.asList(stringMatchers)));", "originalCommit": "32766a59a437d1710163e247d63c3d1a833fd742", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU1NzMxMA==", "url": "https://github.com/elastic/elasticsearch/pull/51832#discussion_r374557310", "bodyText": "Both work as anyOf has multiple signatures, one that takes a vararg ( so we can pass an array of Matcher ) and it also has one that takes an Iterable ( so we can pass a List  ). That said, the Arrays.asList is a leftover from a previous attempt and we gain nothing from converting the Array to a List, so I'll change for consistency", "author": "jkakavas", "createdAt": "2020-02-04T09:27:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU1NDExNg=="}], "type": "inlineReview", "revised_code": {"commit": "6dc96e63ab119212eefbff8979fbab86bdcd3027", "chunk": "diff --git a/qa/os/src/test/java/org/elasticsearch/packaging/test/PackagingTestCase.java b/qa/os/src/test/java/org/elasticsearch/packaging/test/PackagingTestCase.java\nindex 338cdb6fc31..0c8af75d44f 100644\n--- a/qa/os/src/test/java/org/elasticsearch/packaging/test/PackagingTestCase.java\n+++ b/qa/os/src/test/java/org/elasticsearch/packaging/test/PackagingTestCase.java\n\n@@ -330,7 +330,7 @@ public abstract class PackagingTestCase extends Assert {\n             assertTrue(\"log file exists\", Files.exists(installation.logs.resolve(\"elasticsearch.log\")));\n             String logfile = FileUtils.slurp(installation.logs.resolve(\"elasticsearch.log\"));\n \n-            assertThat(logfile, anyOf(Arrays.asList(stringMatchers)));\n+            assertThat(logfile, anyOf(stringMatchers));\n \n         } else if (distribution().isPackage() && Platforms.isSystemd()) {\n \n"}}, {"oid": "6dc96e63ab119212eefbff8979fbab86bdcd3027", "url": "https://github.com/elastic/elasticsearch/commit/6dc96e63ab119212eefbff8979fbab86bdcd3027", "message": "remove unnecessary wrapping to List", "committedDate": "2020-02-04T09:58:33Z", "type": "commit"}, {"oid": "a841a6a290632d3be09faf55e9c68996495a1730", "url": "https://github.com/elastic/elasticsearch/commit/a841a6a290632d3be09faf55e9c68996495a1730", "message": "checkstyle", "committedDate": "2020-02-04T10:18:39Z", "type": "commit"}]}