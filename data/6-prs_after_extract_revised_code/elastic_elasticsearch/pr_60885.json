{"pr_number": 60885, "pr_title": "Avoid a race condition while waiting for pre warm to finish on SearchableSnapshotDirectoryTests", "pr_createdAt": "2020-08-10T10:26:38Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60885", "timeline": [{"oid": "9c30d4d64de80cee886d8c0c94e136dc64456ad0", "url": "https://github.com/elastic/elasticsearch/commit/9c30d4d64de80cee886d8c0c94e136dc64456ad0", "message": "Avoid a race condition while waiting for pre warm to finish on SearchableSnapshotDirectoryTests", "committedDate": "2020-08-10T10:22:24Z", "type": "commit"}, {"oid": "a4d94bd130435a6c416afb9c97178d7f4b756bb2", "url": "https://github.com/elastic/elasticsearch/commit/a4d94bd130435a6c416afb9c97178d7f4b756bb2", "message": "Remove unused imports", "committedDate": "2020-08-10T10:45:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg0NDIwMA==", "url": "https://github.com/elastic/elasticsearch/pull/60885#discussion_r467844200", "bodyText": "Naming nit, I think we should call this preWarmComplete (here and related names) rather than preWarmFinished since if there are any failures the prewarming process still finishes, although the shard was not completely prewarmed.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public synchronized void setPreWarmFinished() {\n          \n          \n            \n                public synchronized void setPreWarmComplete() {", "author": "DaveCTurner", "createdAt": "2020-08-10T11:35:00Z", "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/indices/recovery/SearchableSnapshotRecoveryState.java", "diffHunk": "@@ -37,7 +37,7 @@ public synchronized RecoveryState setStage(Stage stage) {\n         return super.setStage(stage);\n     }\n \n-    public synchronized void preWarmFinished() {\n+    public synchronized void setPreWarmFinished() {", "originalCommit": "a4d94bd130435a6c416afb9c97178d7f4b756bb2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bd8675bb0fcc4a1dc89b5c5f4d04f9ef6d169330", "chunk": "diff --git a/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/indices/recovery/SearchableSnapshotRecoveryState.java b/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/indices/recovery/SearchableSnapshotRecoveryState.java\nindex 9ed4ad6d762..d412e792212 100644\n--- a/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/indices/recovery/SearchableSnapshotRecoveryState.java\n+++ b/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/indices/recovery/SearchableSnapshotRecoveryState.java\n\n@@ -29,7 +29,7 @@ public final class SearchableSnapshotRecoveryState extends RecoveryState {\n \n         // Pre-warm is still running, hold the state transition\n         // until the pre-warm process finishes\n-        if (preWarmFinished == false && stage == Stage.DONE) {\n+        if (preWarmComplete == false && stage == Stage.DONE) {\n             validateCurrentStage(Stage.FINALIZE);\n             return this;\n         }\n"}}, {"oid": "bd8675bb0fcc4a1dc89b5c5f4d04f9ef6d169330", "url": "https://github.com/elastic/elasticsearch/commit/bd8675bb0fcc4a1dc89b5c5f4d04f9ef6d169330", "message": "Rename preWarmFinished to preWarmComplete", "committedDate": "2020-08-10T12:08:17Z", "type": "commit"}, {"oid": "eecaed4409972dbf895978c641fa0d9ea15dcef5", "url": "https://github.com/elastic/elasticsearch/commit/eecaed4409972dbf895978c641fa0d9ea15dcef5", "message": "Merge remote-tracking branch 'origin/master' into fix-searchable-snapshot-directory-tests", "committedDate": "2020-08-10T13:41:43Z", "type": "commit"}]}