{"pr_number": 52967, "pr_title": "SQL: use a proper error message for queries directed at empty mapping indices", "pr_createdAt": "2020-02-28T18:36:22Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52967", "timeline": [{"oid": "b9f7b269bf7ca19ab71c57964d62d02d95cf3c9a", "url": "https://github.com/elastic/elasticsearch/commit/b9f7b269bf7ca19ab71c57964d62d02d95cf3c9a", "message": "Issue a different error message in case an index doesn't have a mapping", "committedDate": "2020-02-28T18:31:13Z", "type": "commit"}, {"oid": "4ca64926f81e6a55f90c8207a973b2c1737b3824", "url": "https://github.com/elastic/elasticsearch/commit/4ca64926f81e6a55f90c8207a973b2c1737b3824", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 52865_fix", "committedDate": "2020-02-28T18:32:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0ODAxMA==", "url": "https://github.com/elastic/elasticsearch/pull/52967#discussion_r386048010", "bodyText": "I think this is incorrect - if we know the index is empty, we should return no columns since we can determine them and know there are none.", "author": "costin", "createdAt": "2020-02-29T18:56:32Z", "path": "x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/cli/ErrorsTestCase.java", "diffHunk": "@@ -37,15 +37,30 @@ public void testSelectFromMissingIndex() throws IOException {\n     }\n \n     @Override\n-    public void testSelectFromIndexWithoutTypes() throws Exception {\n+    public void testSelectColumnFromMissingIndex() throws Exception {\n+        assertFoundOneProblem(command(\"SELECT abc FROM test\"));\n+        assertEquals(\"line 1:17: Unknown index [test]\" + END, readLine());\n+    }\n+\n+    @Override\n+    public void testSelectFromEmptyIndex() throws Exception {\n         // Create an index without any types\n         Request request = new Request(\"PUT\", \"/test\");\n         request.setJsonEntity(\"{}\");\n         client().performRequest(request);\n \n         assertFoundOneProblem(command(\"SELECT * FROM test\"));\n-        //assertEquals(\"line 1:15: [test] doesn't have any types so it is incompatible with sql\" + END, readLine());\n-        assertEquals(\"line 1:15: Unknown index [test]\" + END, readLine());\n+        assertEquals(\"line 1:8: Cannot determine columns for [*]\" + END, readLine());", "originalCommit": "4ca64926f81e6a55f90c8207a973b2c1737b3824", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMyMjg1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52967#discussion_r386322859", "bodyText": "Created #53001", "author": "astefan", "createdAt": "2020-03-02T10:53:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0ODAxMA=="}], "type": "inlineReview", "revised_code": null}]}