{"pr_number": 66263, "pr_title": "Simplify searchable snapshot CacheKey", "pr_createdAt": "2020-12-14T15:25:02Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66263", "timeline": [{"oid": "d28685684bc0d44126b2bc0f5253694f4ff97dfc", "url": "https://github.com/elastic/elasticsearch/commit/d28685684bc0d44126b2bc0f5253694f4ff97dfc", "message": "Simplify CacheKey", "committedDate": "2020-12-14T15:13:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUxMzM2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/66263#discussion_r542513362", "bodyText": "Maybe rename this to SNAPSHOT_INDEX_NAME_FIELD?", "author": "henningandersen", "createdAt": "2020-12-14T16:17:31Z", "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/PersistentCache.java", "diffHunk": "@@ -555,8 +547,8 @@ private static String getValue(Document document, String fieldName) {\n \n     private static CacheKey buildCacheKey(Document document) {\n         return new CacheKey(\n-            new SnapshotId(getValue(document, SNAPSHOT_NAME_FIELD), getValue(document, SNAPSHOT_ID_FIELD)),\n-            new IndexId(getValue(document, INDEX_NAME_FIELD), getValue(document, INDEX_ID_FIELD)),\n+            getValue(document, SNAPSHOT_ID_FIELD),\n+            getValue(document, INDEX_NAME_FIELD),", "originalCommit": "d28685684bc0d44126b2bc0f5253694f4ff97dfc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU0MzQ3MA==", "url": "https://github.com/elastic/elasticsearch/pull/66263#discussion_r542543470", "bodyText": "Good idea", "author": "tlrx", "createdAt": "2020-12-14T16:55:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUxMzM2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "05a89255079d3bfb896b5f25b9a007cd8acc8a78", "chunk": "diff --git a/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/PersistentCache.java b/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/PersistentCache.java\nindex f4ba4fd6167..86fbbe46ed6 100644\n--- a/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/PersistentCache.java\n+++ b/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/PersistentCache.java\n\n@@ -548,7 +544,7 @@ public class PersistentCache implements Closeable {\n     private static CacheKey buildCacheKey(Document document) {\n         return new CacheKey(\n             getValue(document, SNAPSHOT_ID_FIELD),\n-            getValue(document, INDEX_NAME_FIELD),\n+            getValue(document, SNAPSHOT_INDEX_NAME_FIELD),\n             new ShardId(\n                 new Index(getValue(document, SHARD_INDEX_NAME_FIELD), getValue(document, SHARD_INDEX_ID_FIELD)),\n                 Integer.parseInt(getValue(document, SHARD_ID_FIELD))\n"}}, {"oid": "05a89255079d3bfb896b5f25b9a007cd8acc8a78", "url": "https://github.com/elastic/elasticsearch/commit/05a89255079d3bfb896b5f25b9a007cd8acc8a78", "message": "nits", "committedDate": "2020-12-14T16:57:08Z", "type": "commit"}]}