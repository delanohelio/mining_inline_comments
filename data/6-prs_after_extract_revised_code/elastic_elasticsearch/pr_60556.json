{"pr_number": 60556, "pr_title": "Refactor extendedBounds to use DoubleBounds", "pr_createdAt": "2020-07-31T21:45:14Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60556", "timeline": [{"oid": "703c2a73ab1805291a682f4e6330560e2b92a173", "url": "https://github.com/elastic/elasticsearch/commit/703c2a73ab1805291a682f4e6330560e2b92a173", "message": "Refactor extendedBounds to use DoubleBounds\n\nRefactors extendedBounds to use DoubleBounds instead\nof 2 variables.\n\nThis is a follow up for #59175", "committedDate": "2020-07-31T21:44:11Z", "type": "commit"}, {"oid": "1ee94c9d7c5e9df94aab44c7e891f7c5ea3c52ce", "url": "https://github.com/elastic/elasticsearch/commit/1ee94c9d7c5e9df94aab44c7e891f7c5ea3c52ce", "message": "Fix typos", "committedDate": "2020-08-03T14:50:41Z", "type": "commit"}, {"oid": "8fecc088808666eb3f38c0cd6309584d7be7538e", "url": "https://github.com/elastic/elasticsearch/commit/8fecc088808666eb3f38c0cd6309584d7be7538e", "message": "Fix NPE in bounds comparison", "committedDate": "2020-08-03T15:22:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzE4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/60556#discussion_r464623187", "bodyText": "Nit: Could we provide a default DoubleBounds(null, null) in the constructor, and then just call DoubleBounds#effectiveMin here? (ditto for max and the below usage).  Especially since the logic for what to use for undefined is a little arbitrary (e.g. it's not obvious at a glance why we use POSITIVE_INFINITY instead of NAN), I'd rather just keep that logic in one place if possible.", "author": "not-napoleon", "createdAt": "2020-08-03T19:41:00Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AbstractHistogramAggregator.java", "diffHunk": "@@ -100,7 +97,10 @@ public AbstractHistogramAggregator(\n \n                 EmptyBucketInfo emptyBucketInfo = null;\n                 if (minDocCount == 0) {\n-                    emptyBucketInfo = new EmptyBucketInfo(interval, offset, minBound, maxBound, buildEmptySubAggregations());\n+                    emptyBucketInfo = new EmptyBucketInfo(interval, offset,\n+                        extendedBounds == null || extendedBounds.getMin() == null ? Double.POSITIVE_INFINITY : extendedBounds.getMin(),", "originalCommit": "8fecc088808666eb3f38c0cd6309584d7be7538e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "06182f776edc1dec676e5acb33df8aa5313fa16e", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AbstractHistogramAggregator.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AbstractHistogramAggregator.java\nindex c4c24c7a89f..f594fd20f98 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AbstractHistogramAggregator.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AbstractHistogramAggregator.java\n\n@@ -97,10 +100,8 @@ public abstract class AbstractHistogramAggregator extends BucketsAggregator {\n \n                 EmptyBucketInfo emptyBucketInfo = null;\n                 if (minDocCount == 0) {\n-                    emptyBucketInfo = new EmptyBucketInfo(interval, offset,\n-                        extendedBounds == null || extendedBounds.getMin() == null ? Double.POSITIVE_INFINITY : extendedBounds.getMin(),\n-                        extendedBounds == null || extendedBounds.getMax() == null ? Double.NEGATIVE_INFINITY : extendedBounds.getMax(),\n-                        buildEmptySubAggregations());\n+                    emptyBucketInfo = new EmptyBucketInfo(interval, offset, getEffectiveMin(extendedBounds),\n+                        getEffectiveMax(extendedBounds), buildEmptySubAggregations());\n                 }\n                 return new InternalHistogram(name, buckets, order, minDocCount, emptyBucketInfo, formatter, keyed, metadata());\n             });\n"}}, {"oid": "06182f776edc1dec676e5acb33df8aa5313fa16e", "url": "https://github.com/elastic/elasticsearch/commit/06182f776edc1dec676e5acb33df8aa5313fa16e", "message": "Address review comments", "committedDate": "2020-08-04T14:42:09Z", "type": "commit"}]}