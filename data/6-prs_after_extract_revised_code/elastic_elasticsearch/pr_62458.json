{"pr_number": 62458, "pr_title": "EQL: Forbid usage of ['] for string literals", "pr_createdAt": "2020-09-16T13:25:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62458", "timeline": [{"oid": "647e7b351e3c08836e9a53db7fedded2cfe4bb23", "url": "https://github.com/elastic/elasticsearch/commit/647e7b351e3c08836e9a53db7fedded2cfe4bb23", "message": "EQL: Forbid usage of ['] for string literals\n\nThe usage of single quotes to wrap a string literal is forbidden\nand an error encouraging the user to user double quotes is returned.\n\nTests are properly adjusted.\n\nRelated to #61659", "committedDate": "2020-09-16T13:23:41Z", "type": "commit"}, {"oid": "8f7c305baebb91ef12d9788b6e5e60b4a5e47181", "url": "https://github.com/elastic/elasticsearch/commit/8f7c305baebb91ef12d9788b6e5e60b4a5e47181", "message": "fix tests", "committedDate": "2020-09-16T13:42:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzMTA2NA==", "url": "https://github.com/elastic/elasticsearch/pull/62458#discussion_r489531064", "bodyText": "Why \\\\\\\" and not just \\\"?", "author": "costin", "createdAt": "2020-09-16T15:32:01Z", "path": "x-pack/plugin/eql/qa/common/src/main/java/org/elasticsearch/test/eql/stats/RestEqlUsageTestCase.java", "diffHunk": "@@ -178,7 +178,7 @@ public void testEqlRestUsage() throws IOException {\n                 \"  [process where serial_event_id < 4] by exit_code\" + \n                 \"  [process where opcode == 1] by user\" + \n                 \"  [process where opcode == 2] by user\" + \n-                \"  [file where parent_process_name == 'file_delete_event'] by exit_code\" +\n+                \"  [file where parent_process_name == \\\\\\\"file_delete_event\\\\\\\"] by exit_code\" +", "originalCommit": "8f7c305baebb91ef12d9788b6e5e60b4a5e47181", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzNTE5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/62458#discussion_r489535193", "bodyText": "It's because of the runEql() which constructs a json body, so with \\\" it's escaped in the java string but then it's interpreted as a closing \" in json.", "author": "matriv", "createdAt": "2020-09-16T15:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzMTA2NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzMzAyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/62458#discussion_r489533029", "bodyText": "Use double quotes [\"] for defining string literals, not single quotes [']", "author": "costin", "createdAt": "2020-09-16T15:34:44Z", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java", "diffHunk": "@@ -173,6 +177,13 @@ public static String unquoteString(String text) {\n         return resultString.toString();\n     }\n \n+    private static void checkForSingleQuotedString(Source source, String text, int i) {\n+        if (text.charAt(i) == '\\'') {\n+            throw new ParsingException(source,\n+                    \"Single quotes ['] are not supported around literal strings, please use double quotes [\\\"]\");", "originalCommit": "8f7c305baebb91ef12d9788b6e5e60b4a5e47181", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzNjI5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/62458#discussion_r489536291", "bodyText": "I will make it: Use double quotes [\"] to define string literals, not single quotes [']", "author": "matriv", "createdAt": "2020-09-16T15:39:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzMzAyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "efddcbbf446fda3d6eeda3d4def7937bc8195f34", "chunk": "diff --git a/x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java b/x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java\nindex 0293313cc43..56d687584d1 100644\n--- a/x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java\n+++ b/x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java\n\n@@ -180,7 +180,7 @@ abstract class AbstractBuilder extends EqlBaseBaseVisitor<Object> {\n     private static void checkForSingleQuotedString(Source source, String text, int i) {\n         if (text.charAt(i) == '\\'') {\n             throw new ParsingException(source,\n-                    \"Single quotes ['] are not supported around literal strings, please use double quotes [\\\"]\");\n+                    \"Use double quotes [\\\"] to define string literals, not single quotes [']\");\n         }\n     }\n \n"}}, {"oid": "efddcbbf446fda3d6eeda3d4def7937bc8195f34", "url": "https://github.com/elastic/elasticsearch/commit/efddcbbf446fda3d6eeda3d4def7937bc8195f34", "message": "rephrase error message", "committedDate": "2020-09-16T15:43:10Z", "type": "commit"}, {"oid": "33aa213af7c6d0393935e6a3a73fe49bff708d39", "url": "https://github.com/elastic/elasticsearch/commit/33aa213af7c6d0393935e6a3a73fe49bff708d39", "message": "Merge remote-tracking branch 'upstream/master' into forbid-single-quotes", "committedDate": "2020-09-16T15:46:25Z", "type": "commit"}, {"oid": "6ee279cb2a971f80a46c63b57f9788d449de22de", "url": "https://github.com/elastic/elasticsearch/commit/6ee279cb2a971f80a46c63b57f9788d449de22de", "message": "fix tests", "committedDate": "2020-09-16T16:03:17Z", "type": "commit"}]}