{"pr_number": 62903, "pr_title": "Make sure that IdFieldType#isAggregatable is accurate.", "pr_createdAt": "2020-09-24T19:14:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62903", "timeline": [{"oid": "4240bd27f12c54c434524f5500e293ea75095bfc", "url": "https://github.com/elastic/elasticsearch/commit/4240bd27f12c54c434524f5500e293ea75095bfc", "message": "Make sure that IdFieldType#isAggregatable is accurate.\n\nBefore, it always returned 'true' even when the setting\n\"indices.id_field_data.enabled\" was false.", "committedDate": "2020-09-24T19:41:47Z", "type": "forcePushed"}, {"oid": "bdb4f8b19e23d9c9863b2d66f53818fa3c49f09a", "url": "https://github.com/elastic/elasticsearch/commit/bdb4f8b19e23d9c9863b2d66f53818fa3c49f09a", "message": "Make sure that IdFieldType#isAggregatable is accurate.\n\nBefore, it always returned 'true' even when the setting\n\"indices.id_field_data.enabled\" was false.", "committedDate": "2020-09-24T20:48:27Z", "type": "commit"}, {"oid": "bdb4f8b19e23d9c9863b2d66f53818fa3c49f09a", "url": "https://github.com/elastic/elasticsearch/commit/bdb4f8b19e23d9c9863b2d66f53818fa3c49f09a", "message": "Make sure that IdFieldType#isAggregatable is accurate.\n\nBefore, it always returned 'true' even when the setting\n\"indices.id_field_data.enabled\" was false.", "committedDate": "2020-09-24T20:48:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDcxMTcyNw==", "url": "https://github.com/elastic/elasticsearch/pull/62903#discussion_r494711727", "bodyText": "I kept the deprecation message here so we don't issue a warning on every call to field caps.", "author": "jtibshirani", "createdAt": "2020-09-25T02:29:30Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java", "diffHunk": "@@ -156,11 +165,6 @@ public Query termsQuery(List<?> values, QueryShardContext context) {\n                     CircuitBreakerService breakerService,\n                     MapperService mapperService\n                 ) {\n-                    if (mapperService.isIdFieldDataEnabled() == false) {\n-                        throw new IllegalArgumentException(\"Fielddata access on the _id field is disallowed, \"\n-                            + \"you can re-enable it by updating the dynamic cluster setting: \"\n-                            + IndicesService.INDICES_ID_FIELD_DATA_ENABLED_SETTING.getKey());\n-                    }\n                     deprecationLogger.deprecate(\"id_field_data\", ID_FIELD_DATA_DEPRECATION_MESSAGE);", "originalCommit": "bdb4f8b19e23d9c9863b2d66f53818fa3c49f09a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "24a878bb5a313c025322049a25cc719e7c1461fa", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java\nindex 487d2ae7b16..de68a55e083 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java\n\n@@ -162,12 +164,11 @@ public class IdFieldMapper extends MetadataFieldMapper {\n                 @Override\n                 public IndexFieldData<?> build(\n                     IndexFieldDataCache cache,\n-                    CircuitBreakerService breakerService,\n-                    MapperService mapperService\n+                    CircuitBreakerService breakerService\n                 ) {\n                     deprecationLogger.deprecate(\"id_field_data\", ID_FIELD_DATA_DEPRECATION_MESSAGE);\n                     final IndexFieldData<?> fieldData = fieldDataBuilder.build(cache,\n-                        breakerService, mapperService);\n+                        breakerService);\n                     return new IndexFieldData<>() {\n                         @Override\n                         public String getFieldName() {\n"}}, {"oid": "24a878bb5a313c025322049a25cc719e7c1461fa", "url": "https://github.com/elastic/elasticsearch/commit/24a878bb5a313c025322049a25cc719e7c1461fa", "message": "Merge remote-tracking branch 'upstream/master' into pr", "committedDate": "2020-10-05T16:10:43Z", "type": "commit"}, {"oid": "045a9bcf4258835215891fbe12a53ca5434467f6", "url": "https://github.com/elastic/elasticsearch/commit/045a9bcf4258835215891fbe12a53ca5434467f6", "message": "Fix leftover changes from merge.", "committedDate": "2020-10-05T16:26:06Z", "type": "commit"}]}