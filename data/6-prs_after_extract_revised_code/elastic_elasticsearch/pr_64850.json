{"pr_number": 64850, "pr_title": "Introduce licensed plugins", "pr_createdAt": "2020-11-10T09:55:45Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64850", "timeline": [{"oid": "83c785bc0863a907ce7ad91e278197b33f2f4107", "url": "https://github.com/elastic/elasticsearch/commit/83c785bc0863a907ce7ad91e278197b33f2f4107", "message": "Move quota-aware-fs plugin under x-pack/ and mark it licensed", "committedDate": "2020-11-05T12:55:11Z", "type": "commit"}, {"oid": "18f22e8a43f98b5f30a59fcd4836bc9fe639377a", "url": "https://github.com/elastic/elasticsearch/commit/18f22e8a43f98b5f30a59fcd4836bc9fe639377a", "message": "Prompt to accept license when installing licensed plugin", "committedDate": "2020-11-05T13:03:29Z", "type": "commit"}, {"oid": "a3f3abf5aee55996e4ea820ebcbdf8b9944d5ff7", "url": "https://github.com/elastic/elasticsearch/commit/a3f3abf5aee55996e4ea820ebcbdf8b9944d5ff7", "message": "Test fix", "committedDate": "2020-11-05T13:04:06Z", "type": "commit"}, {"oid": "f298b031490639dd799445df03e98098adc1706b", "url": "https://github.com/elastic/elasticsearch/commit/f298b031490639dd799445df03e98098adc1706b", "message": "Always print something in batch mode, make everything more testable", "committedDate": "2020-11-05T13:05:04Z", "type": "commit"}, {"oid": "146a95babf899d2d3015bc977eab405037bb5d8f", "url": "https://github.com/elastic/elasticsearch/commit/146a95babf899d2d3015bc977eab405037bb5d8f", "message": "Fixes after forward-port of 6.8 prototype", "committedDate": "2020-11-05T13:32:16Z", "type": "commit"}, {"oid": "147cb8cf87d845232c3d6ab5c68fbafd72631b02", "url": "https://github.com/elastic/elasticsearch/commit/147cb8cf87d845232c3d6ab5c68fbafd72631b02", "message": "Merge remote-tracking branch 'upstream/master' into move-quota-aware-fs-plugin-to-xpack", "committedDate": "2020-11-09T16:25:17Z", "type": "commit"}, {"oid": "a23ec454ec5cca7c2e4cce8a84574531277c4580", "url": "https://github.com/elastic/elasticsearch/commit/a23ec454ec5cca7c2e4cce8a84574531277c4580", "message": "Change license check to just abort on non-default distros", "committedDate": "2020-11-09T20:32:39Z", "type": "commit"}, {"oid": "4fe4b59e1c1ccdbfec1f9e12479e968f1f9d4722", "url": "https://github.com/elastic/elasticsearch/commit/4fe4b59e1c1ccdbfec1f9e12479e968f1f9d4722", "message": "Merge remote-tracking branch 'upstream/master' into move-quota-aware-fs-plugin-to-xpack", "committedDate": "2020-11-09T20:39:36Z", "type": "commit"}, {"oid": "4f5757a4d85959cd92c9ce28cba41c760b80e839", "url": "https://github.com/elastic/elasticsearch/commit/4f5757a4d85959cd92c9ce28cba41c760b80e839", "message": "Fixes", "committedDate": "2020-11-10T10:14:40Z", "type": "commit"}, {"oid": "6837fc59394ea54bcdf58cefc7de3c1992b4c728", "url": "https://github.com/elastic/elasticsearch/commit/6837fc59394ea54bcdf58cefc7de3c1992b4c728", "message": "Only run QuotaAwareFsTests on default distro", "committedDate": "2020-11-10T10:46:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4NTA4MA==", "url": "https://github.com/elastic/elasticsearch/pull/64850#discussion_r524485080", "bodyText": "Is there a reason this method couldn't exist within InstallPluginCommand?", "author": "rjernst", "createdAt": "2020-11-16T18:30:57Z", "path": "distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/LicensedPlugin.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.plugins;\n+\n+import org.elasticsearch.Build;\n+import org.elasticsearch.cli.ExitCodes;\n+import org.elasticsearch.cli.Terminal;\n+import org.elasticsearch.cli.UserException;\n+\n+import java.util.List;\n+\n+public class LicensedPlugin {\n+\n+    static void checkCanInstallationProceed(Terminal terminal, Build.Flavor flavor, PluginInfo info) throws Exception {", "originalCommit": "6837fc59394ea54bcdf58cefc7de3c1992b4c728", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NzQ5OA==", "url": "https://github.com/elastic/elasticsearch/pull/64850#discussion_r525077498", "bodyText": "There used to be more code involved here, which is why I split it out, but as you rightly point out it's just short-ish method now. I've folded it back into the installer class.", "author": "pugnascotia", "createdAt": "2020-11-17T11:19:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4NTA4MA=="}], "type": "inlineReview", "revised_code": {"commit": "02608ba4a7e27c9105b4afa0682ebff710743876", "chunk": "diff --git a/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/LicensedPlugin.java b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/LicensedPlugin.java\ndeleted file mode 100644\nindex 35982cc3581..00000000000\n--- a/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/LicensedPlugin.java\n+++ /dev/null\n\n@@ -1,51 +0,0 @@\n-/*\n- * Licensed to Elasticsearch under one or more contributor\n- * license agreements. See the NOTICE file distributed with\n- * this work for additional information regarding copyright\n- * ownership. Elasticsearch licenses this file to you under\n- * the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *         http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-\n-package org.elasticsearch.plugins;\n-\n-import org.elasticsearch.Build;\n-import org.elasticsearch.cli.ExitCodes;\n-import org.elasticsearch.cli.Terminal;\n-import org.elasticsearch.cli.UserException;\n-\n-import java.util.List;\n-\n-public class LicensedPlugin {\n-\n-    static void checkCanInstallationProceed(Terminal terminal, Build.Flavor flavor, PluginInfo info) throws Exception {\n-        if (info.isLicensed() == false) {\n-            return;\n-        }\n-\n-        if (flavor == Build.Flavor.DEFAULT) {\n-            return;\n-        }\n-\n-        List.of(\n-            \"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\",\n-            \"@            ERROR: This is a licensed plugin             @\",\n-            \"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\",\n-            \"\",\n-            \"This plugin is covered by the Elastic license, but this\",\n-            \"installation of Elasticsearch is: [\" + flavor + \"].\"\n-        ).forEach(terminal::errorPrintln);\n-\n-        throw new UserException(ExitCodes.NOPERM, \"Plugin license is incompatible with [\" + flavor + \"] installation\");\n-    }\n-}\n"}}, {"oid": "e3e5e7681fd2f8031f6a8a26637897ca5dc7f445", "url": "https://github.com/elastic/elasticsearch/commit/e3e5e7681fd2f8031f6a8a26637897ca5dc7f445", "message": "Merge remote-tracking branch 'upstream/master' into move-quota-aware-fs-plugin-to-xpack", "committedDate": "2020-11-17T11:02:36Z", "type": "commit"}, {"oid": "02608ba4a7e27c9105b4afa0682ebff710743876", "url": "https://github.com/elastic/elasticsearch/commit/02608ba4a7e27c9105b4afa0682ebff710743876", "message": "Address review comments", "committedDate": "2020-11-17T11:18:04Z", "type": "commit"}, {"oid": "c9b7f56666700174ab5e23cb515bb15c616cce99", "url": "https://github.com/elastic/elasticsearch/commit/c9b7f56666700174ab5e23cb515bb15c616cce99", "message": "Formatting", "committedDate": "2020-11-17T11:25:20Z", "type": "commit"}]}