{"pr_number": 62649, "pr_title": "Fix standard filter BWC check to allow for cacheing bug", "pr_createdAt": "2020-09-18T16:40:17Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62649", "timeline": [{"oid": "7a90048ec96a23437a2dbe0aa7cac080af4214ba", "url": "https://github.com/elastic/elasticsearch/commit/7a90048ec96a23437a2dbe0aa7cac080af4214ba", "message": "Fix standard filter BWC check to allow for cacheing bug", "committedDate": "2020-09-18T16:35:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA3MDUwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/62649#discussion_r491070501", "bodyText": "Can you add a comment here so that we don't forget why it's 7.6 and not 7.0 ?", "author": "jimczi", "createdAt": "2020-09-18T16:45:33Z", "path": "server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java", "diffHunk": "@@ -181,7 +181,7 @@ public boolean requiresAnalysisSettings() {\n         // Add \"standard\" for old indices (bwc)\n         preConfiguredTokenFilters.register( \"standard\",\n             PreConfiguredTokenFilter.elasticsearchVersion(\"standard\", true, (reader, version) -> {\n-                if (version.before(Version.V_7_0_0)) {\n+                if (version.before(Version.V_7_6_0)) {", "originalCommit": "7a90048ec96a23437a2dbe0aa7cac080af4214ba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2f41c464f878627da8d982615044d72122201382", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java b/server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java\nindex 328201f9c0a0..c3b5bbf7d0c1 100644\n--- a/server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java\n+++ b/server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java\n\n@@ -181,6 +181,9 @@ public final class AnalysisModule {\n         // Add \"standard\" for old indices (bwc)\n         preConfiguredTokenFilters.register( \"standard\",\n             PreConfiguredTokenFilter.elasticsearchVersion(\"standard\", true, (reader, version) -> {\n+                // This was originally removed in 7_0_0 but due to a cacheing bug it was still possible\n+                // in certain circumstances to create a new index referencing the standard token filter\n+                // until version 7_5_2\n                 if (version.before(Version.V_7_6_0)) {\n                     deprecationLogger.deprecate(\"standard_deprecation\",\n                         \"The [standard] token filter is deprecated and will be removed in a future version.\");\n"}}, {"oid": "2f41c464f878627da8d982615044d72122201382", "url": "https://github.com/elastic/elasticsearch/commit/2f41c464f878627da8d982615044d72122201382", "message": "add comment", "committedDate": "2020-09-20T16:31:17Z", "type": "commit"}, {"oid": "bb3e110c08a7496e5287a53db72bdc8a61c2e6b8", "url": "https://github.com/elastic/elasticsearch/commit/bb3e110c08a7496e5287a53db72bdc8a61c2e6b8", "message": "Merge branch 'master' into bug/standard-tokenfilter", "committedDate": "2020-09-21T07:57:46Z", "type": "commit"}]}