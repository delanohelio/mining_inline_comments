{"pr_number": 58332, "pr_title": "Submit _async search task should cancel children on cancellation", "pr_createdAt": "2020-06-18T14:39:33Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58332", "timeline": [{"oid": "088736ec066e09bc8ba7bba1daf501faeb389bcb", "url": "https://github.com/elastic/elasticsearch/commit/088736ec066e09bc8ba7bba1daf501faeb389bcb", "message": "Submit _async search task should cancel children on cancellation\n\nThis change allows the submit async search task to cancel children\nand removes the manual indirection that cancels the search task when the submit\ntask is cancelled. This is now handled by the task cancellation, which can cancel\ngrand-children since #54757.", "committedDate": "2020-06-18T14:37:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MjgwNg==", "url": "https://github.com/elastic/elasticsearch/pull/58332#discussion_r442482806", "bodyText": "I was wondering if it can still happen that we get here and submit is cancelled.", "author": "javanna", "createdAt": "2020-06-18T20:25:29Z", "path": "x-pack/plugin/async-search/src/main/java/org/elasticsearch/xpack/search/TransportSubmitAsyncSearchAction.java", "diffHunk": "@@ -88,42 +85,34 @@ public void onResponse(AsyncSearchResponse searchResponse) {\n                         // the task is still running and the user cannot wait more so we create\n                         // a document for further retrieval\n                         try {\n-                            if (submitTask.isCancelled()) {", "originalCommit": "088736ec066e09bc8ba7bba1daf501faeb389bcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NDgyMg==", "url": "https://github.com/elastic/elasticsearch/pull/58332#discussion_r444684822", "bodyText": "I think that's ok, the cancelled may be delayed but we'll remove the document at the end (onFinalResponse checks if the task was cancelled).", "author": "jimczi", "createdAt": "2020-06-24T07:00:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MjgwNg=="}], "type": "inlineReview", "revised_code": null}]}