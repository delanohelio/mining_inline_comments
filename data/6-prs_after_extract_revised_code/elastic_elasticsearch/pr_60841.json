{"pr_number": 60841, "pr_title": "Add flip index ir nodes", "pr_createdAt": "2020-08-06T17:12:37Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60841", "timeline": [{"oid": "fe4f7bfb438f38e88f596b19ce38ae4cd49ec5c6", "url": "https://github.com/elastic/elasticsearch/commit/fe4f7bfb438f38e88f596b19ce38ae4cd49ec5c6", "message": "Move bootstrap injection into the the ir tree builder phase", "committedDate": "2020-07-27T18:11:02Z", "type": "commit"}, {"oid": "02b70959c0a4be12ee85565aaf25ee1cae4ebea5", "url": "https://github.com/elastic/elasticsearch/commit/02b70959c0a4be12ee85565aaf25ee1cae4ebea5", "message": "move ScriptClassInfo out of walker and remove unncessary injection\nphases", "committedDate": "2020-07-27T18:42:59Z", "type": "commit"}, {"oid": "be17b14018e28414e10b9e7e02e3f7c299fc2589", "url": "https://github.com/elastic/elasticsearch/commit/be17b14018e28414e10b9e7e02e3f7c299fc2589", "message": "add AccessNode in place of ECall, EBrace, and EDot", "committedDate": "2020-07-27T20:46:00Z", "type": "commit"}, {"oid": "1725972243f755a6e7b51583ca490140517b70be", "url": "https://github.com/elastic/elasticsearch/commit/1725972243f755a6e7b51583ca490140517b70be", "message": "rename some nodes", "committedDate": "2020-07-27T21:24:32Z", "type": "commit"}, {"oid": "d979077dc6248a0ec0dbdf7101fdcf4e11307e9f", "url": "https://github.com/elastic/elasticsearch/commit/d979077dc6248a0ec0dbdf7101fdcf4e11307e9f", "message": "add flip nodes", "committedDate": "2020-07-27T21:38:42Z", "type": "commit"}, {"oid": "a4d61ba2e61783c5e884a3af0c161dcff2e42cf4", "url": "https://github.com/elastic/elasticsearch/commit/a4d61ba2e61783c5e884a3af0c161dcff2e42cf4", "message": "Merge branch 'master' into semantic010", "committedDate": "2020-07-29T17:45:57Z", "type": "commit"}, {"oid": "fd130aeb8b8eda556cc45047887ab537d590f61d", "url": "https://github.com/elastic/elasticsearch/commit/fd130aeb8b8eda556cc45047887ab537d590f61d", "message": "Merge branch 'semantic010' into semantic011", "committedDate": "2020-07-29T17:46:17Z", "type": "commit"}, {"oid": "d2f27b89f8a20646232083535d05d3bd81817d3b", "url": "https://github.com/elastic/elasticsearch/commit/d2f27b89f8a20646232083535d05d3bd81817d3b", "message": "Merge branch 'semantic011' into semantic013", "committedDate": "2020-07-29T17:46:37Z", "type": "commit"}, {"oid": "3fbd0bcdf699ca71db447a21ea00ce18e8aacbd5", "url": "https://github.com/elastic/elasticsearch/commit/3fbd0bcdf699ca71db447a21ea00ce18e8aacbd5", "message": "Merge branch 'master' into semantic010", "committedDate": "2020-08-05T16:59:29Z", "type": "commit"}, {"oid": "b3fd76361e7e1d00df0f0d4070949130845f6271", "url": "https://github.com/elastic/elasticsearch/commit/b3fd76361e7e1d00df0f0d4070949130845f6271", "message": "response to pr comments", "committedDate": "2020-08-05T17:24:53Z", "type": "commit"}, {"oid": "2e1e958536707210b141a4a495da5ee315e88b06", "url": "https://github.com/elastic/elasticsearch/commit/2e1e958536707210b141a4a495da5ee315e88b06", "message": "Merge branch 'master' into semantic010", "committedDate": "2020-08-05T19:35:03Z", "type": "commit"}, {"oid": "397c7b1f728cf0f7a7fda6552090ab4d2ccf23b8", "url": "https://github.com/elastic/elasticsearch/commit/397c7b1f728cf0f7a7fda6552090ab4d2ccf23b8", "message": "Merge branch 'semantic010' into semantic011", "committedDate": "2020-08-05T19:36:47Z", "type": "commit"}, {"oid": "a8bc699f649519c4d1d7b8b28d31e7add3406966", "url": "https://github.com/elastic/elasticsearch/commit/a8bc699f649519c4d1d7b8b28d31e7add3406966", "message": "fix spacing", "committedDate": "2020-08-05T20:42:28Z", "type": "commit"}, {"oid": "aab90f387c3bb5600f90f45d9e27ca0b1b041cb9", "url": "https://github.com/elastic/elasticsearch/commit/aab90f387c3bb5600f90f45d9e27ca0b1b041cb9", "message": "Merge branch 'master' into semantic011", "committedDate": "2020-08-06T16:05:28Z", "type": "commit"}, {"oid": "9ee21c7cba9d202259bac2e25edda5994341fe66", "url": "https://github.com/elastic/elasticsearch/commit/9ee21c7cba9d202259bac2e25edda5994341fe66", "message": "Merge branch 'semantic011' into semantic013", "committedDate": "2020-08-06T16:10:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwOTg5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60841#discussion_r468109891", "bodyText": "This semi is lonely.", "author": "stu-elastic", "createdAt": "2020-08-10T18:53:01Z", "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/phase/DefaultUserTreeToIRTreePhase.java", "diffHunk": "@@ -1368,20 +1372,31 @@ public void visitBrace(EBrace userBraceNode, ScriptScope scriptScope) {\n         Class<?> prefixValueType = scriptScope.getDecoration(userBraceNode.getPrefixNode(), ValueType.class).getValueType();\n \n         if (prefixValueType.isArray()) {\n+            FlipArrayIndex irFlipArrayIndex = new FlipArrayIndex();\n+            irFlipArrayIndex.setLocation(userBraceNode.getIndexNode().getLocation());\n+            irFlipArrayIndex.setExpressionType(int.class);\n+            irFlipArrayIndex.setIndexNode(injectCast(userBraceNode.getIndexNode(), scriptScope));\n+\n             BraceSubNode irBraceSubNode = new BraceSubNode();\n-            irBraceSubNode.setChildNode(injectCast(userBraceNode.getIndexNode(), scriptScope));\n+            irBraceSubNode.setIndexNode(irFlipArrayIndex);\n             irBraceSubNode.setLocation(userBraceNode.getLocation());\n             irBraceSubNode.setExpressionType(scriptScope.getDecoration(userBraceNode, ValueType.class).getValueType());\n             irExpressionNode = irBraceSubNode;\n         } else if (prefixValueType == def.class) {\n+            ;", "originalCommit": "9ee21c7cba9d202259bac2e25edda5994341fe66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExMzkzNA==", "url": "https://github.com/elastic/elasticsearch/pull/60841#discussion_r468113934", "bodyText": "Good catch. Fixed!", "author": "jdconrad", "createdAt": "2020-08-10T19:00:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwOTg5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "416801084c6dd5c2fc8179a4ee5f67b5a0e2dddb", "chunk": "diff --git a/modules/lang-painless/src/main/java/org/elasticsearch/painless/phase/DefaultUserTreeToIRTreePhase.java b/modules/lang-painless/src/main/java/org/elasticsearch/painless/phase/DefaultUserTreeToIRTreePhase.java\nindex 778d62ee039..f25c2310177 100644\n--- a/modules/lang-painless/src/main/java/org/elasticsearch/painless/phase/DefaultUserTreeToIRTreePhase.java\n+++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/phase/DefaultUserTreeToIRTreePhase.java\n\n@@ -1383,7 +1383,6 @@ public class DefaultUserTreeToIRTreePhase implements UserTreeVisitor<ScriptScope\n             irBraceSubNode.setExpressionType(scriptScope.getDecoration(userBraceNode, ValueType.class).getValueType());\n             irExpressionNode = irBraceSubNode;\n         } else if (prefixValueType == def.class) {\n-            ;\n             FlipDefIndex irFlipDefIndex = new FlipDefIndex();\n             irFlipDefIndex.setLocation(userBraceNode.getIndexNode().getLocation());\n             irFlipDefIndex.setExpressionType(scriptScope.getDecoration(userBraceNode.getIndexNode(), ValueType.class).getValueType());\n"}}, {"oid": "f9e3de4df0b053f324a0a8600399718f67f11d11", "url": "https://github.com/elastic/elasticsearch/commit/f9e3de4df0b053f324a0a8600399718f67f11d11", "message": "Merge branch 'master' into semantic013", "committedDate": "2020-08-10T18:58:06Z", "type": "commit"}, {"oid": "416801084c6dd5c2fc8179a4ee5f67b5a0e2dddb", "url": "https://github.com/elastic/elasticsearch/commit/416801084c6dd5c2fc8179a4ee5f67b5a0e2dddb", "message": "remove extraneous semicolon", "committedDate": "2020-08-10T18:59:56Z", "type": "commit"}]}