{"pr_number": 65362, "pr_title": "Allow passing versioned media types to 7.x server", "pr_createdAt": "2020-11-23T12:43:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65362", "timeline": [{"oid": "7e39e815df929c8be3d8fd658a9cf66002b358d6", "url": "https://github.com/elastic/elasticsearch/commit/7e39e815df929c8be3d8fd658a9cf66002b358d6", "message": "Allow passing versioned media types to 7.x server\n\na follow up after #63071 where it missed the XContentType.fromMediaType\nmethod.\nThat method also have to remove the vendor specific substrings\n(vnd.elasticsearch+ and compatible-with parameter) from mediaType value\n\nrelates #51816", "committedDate": "2020-11-23T12:37:56Z", "type": "commit"}, {"oid": "690b1af836b47069e240897d825293fa91da4476", "url": "https://github.com/elastic/elasticsearch/commit/690b1af836b47069e240897d825293fa91da4476", "message": "Merge remote-tracking branch 'upstream/7.x' into compat/7x_allow_parsing_vnd_media_type", "committedDate": "2020-11-23T12:51:55Z", "type": "commit"}, {"oid": "5d822231c00903b77cd176a8ef964b29251c5ec1", "url": "https://github.com/elastic/elasticsearch/commit/5d822231c00903b77cd176a8ef964b29251c5ec1", "message": "remove redundant test case", "committedDate": "2020-11-23T13:42:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1NzY1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/65362#discussion_r529657655", "bodyText": "not sure I understand the comment ?", "author": "jakelandis", "createdAt": "2020-11-24T15:43:59Z", "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/XContentType.java", "diffHunk": "@@ -151,7 +151,8 @@ public static XContentType fromMediaTypeOrFormat(String mediaType) {\n     private static String removeVersionInMediaType(String mediaType) {\n         if (mediaType.contains(\"vnd.elasticsearch\")) {\n             return mediaType.replaceAll(\"vnd.elasticsearch\\\\+\", \"\")\n-                .replaceAll(\"\\\\s*;\\\\s*compatible-with=\\\\d+\", \"\");\n+                .replaceAll(\"\\\\s*;\\\\s*compatible-with=\\\\d+\", \"\")\n+                .replaceAll(\"\\\\s*;\\\\s*\",\";\"); // to allow matching using startsWith", "originalCommit": "5d822231c00903b77cd176a8ef964b29251c5ec1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDIyMTc0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/65362#discussion_r530221741", "bodyText": "matching in fromMediaTypeOrFormat can use startsWith so that\napplication/json; charset=utf-8 can be matched. however this assumes that ; is immediately following mediaTypeWithoutParameters\nI don't want to refactor this in 7.x, the intention of  .replaceAll(\"\\\\s*;\\\\s*\",\";\"); was to make it slightly easier if you provided application/vnd.elasticsearch+json;compatible-with=7 ; charset=utf-8 with accidental space.", "author": "pgomulka", "createdAt": "2020-11-25T09:24:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1NzY1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDIyMTk2MA==", "url": "https://github.com/elastic/elasticsearch/pull/65362#discussion_r530221960", "bodyText": "I have updated the comment with a reference to a method", "author": "pgomulka", "createdAt": "2020-11-25T09:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1NzY1NQ=="}], "type": "inlineReview", "revised_code": null}]}