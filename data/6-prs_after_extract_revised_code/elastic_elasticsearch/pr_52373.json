{"pr_number": 52373, "pr_title": "Filter empty lines from \"docker ls\" response (#52081)", "pr_createdAt": "2020-02-14T16:42:10Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52373", "timeline": [{"oid": "cd064c50350a93538d16e57ce62d309c8fda02a7", "url": "https://github.com/elastic/elasticsearch/commit/cd064c50350a93538d16e57ce62d309c8fda02a7", "message": "Filter empty lines from \"docker ls\" response (#52081)\n\n* Filter empty lines from docker ls response\r\n\r\nIn order to cut down on test time, our docker/vagrant tests build the\r\ndocker image outside of the vagrant VM. When we get around to launching\r\nthe Vagrant VM, we mount that already-built docker image to a known\r\nlocation. At that point, we need to load the docker image. But we only\r\nwant to load it once. As we're running tests, we use \"docker ls\" to\r\ncheck whether the local image is loaded for use. Empty output from the\r\nparticular ls invocation means no image is loaded.\r\n\r\nThere was a bug in how we checked this. In Java, splitting an empty\r\nstring will yield an array containing one empty string. So when we're\r\ncounting the output from the docker ls command, we need to filter out\r\nempty lines in order to proceed to loading the image for docker tests.", "committedDate": "2020-02-14T16:40:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU2ODU4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52373#discussion_r379568587", "bodyText": "nit: This can be simplified as .filter(not(String::isEmpty))", "author": "rjernst", "createdAt": "2020-02-14T18:01:56Z", "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Docker.java", "diffHunk": "@@ -74,7 +75,12 @@\n      * @param distribution details about the docker image to potentially load.\n      */\n     public static void ensureImageIsLoaded(Distribution distribution) {\n-        final long count = sh.run(\"docker image ls --format '{{.Repository}}' \" + distribution.flavor.name).stdout.split(\"\\n\").length;\n+        Shell.Result result = sh.run(\"docker image ls --format '{{.Repository}}' \" + distribution.flavor.name);\n+\n+        final long count = Arrays.stream(result.stdout.split(\"\\n\"))\n+            .map(String::trim)\n+            .filter(s -> s.isEmpty() == false)", "originalCommit": "cd064c50350a93538d16e57ce62d309c8fda02a7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}