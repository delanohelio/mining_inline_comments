{"pr_number": 63313, "pr_title": "[Transform] disallow field and script being empty for group sources", "pr_createdAt": "2020-10-06T10:19:14Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63313", "timeline": [{"oid": "2a5910342d572cf165958cfc01ba39cc68e04ff7", "url": "https://github.com/elastic/elasticsearch/commit/2a5910342d572cf165958cfc01ba39cc68e04ff7", "message": "disallow field and script being empty for group sources", "committedDate": "2020-10-06T09:55:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwMzY2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63313#discussion_r500203662", "bodyText": "The parser is for receiving data from the server. Consequently, it should follow the same leniency that the lenient server parser has.\nSo, I don't think this declaration should be here (same for the rest of the HLRC group sources).", "author": "benwtrent", "createdAt": "2020-10-06T11:34:10Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/pivot/TermsGroupSource.java", "diffHunk": "@@ -42,6 +42,8 @@\n         PARSER.declareString(optionalConstructorArg(), FIELD);\n         Script.declareScript(PARSER, optionalConstructorArg(), SCRIPT);\n         PARSER.declareBoolean(optionalConstructorArg(), MISSING_BUCKET);\n+        // either a script or a field must be declared, or both\n+        PARSER.declareRequiredFieldSet(FIELD.getPreferredName(), SCRIPT.getPreferredName());", "originalCommit": "2a5910342d572cf165958cfc01ba39cc68e04ff7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIxOTE1OA==", "url": "https://github.com/elastic/elasticsearch/pull/63313#discussion_r500219158", "bodyText": "\ud83d\udc4d yes, you are right. I also need to move the other check into the builders, as the constructor is used from the parser.", "author": "hendrikmuhs", "createdAt": "2020-10-06T12:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwMzY2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzMTA0MA==", "url": "https://github.com/elastic/elasticsearch/pull/63313#discussion_r500231040", "bodyText": "however, I can't find any other place that validates. I will simply revert all HLRC changes.", "author": "hendrikmuhs", "createdAt": "2020-10-06T12:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwMzY2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "16585ca41ff747b555967bd445269f0a739433af", "chunk": "diff --git a/client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/pivot/TermsGroupSource.java b/client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/pivot/TermsGroupSource.java\nindex a8f06d89ff8..4a977466cfb 100644\n--- a/client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/pivot/TermsGroupSource.java\n+++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/pivot/TermsGroupSource.java\n\n@@ -42,8 +42,6 @@ public class TermsGroupSource extends SingleGroupSource implements ToXContentObj\n         PARSER.declareString(optionalConstructorArg(), FIELD);\n         Script.declareScript(PARSER, optionalConstructorArg(), SCRIPT);\n         PARSER.declareBoolean(optionalConstructorArg(), MISSING_BUCKET);\n-        // either a script or a field must be declared, or both\n-        PARSER.declareRequiredFieldSet(FIELD.getPreferredName(), SCRIPT.getPreferredName());\n     }\n \n     public static TermsGroupSource fromXContent(final XContentParser parser) {\n"}}, {"oid": "16585ca41ff747b555967bd445269f0a739433af", "url": "https://github.com/elastic/elasticsearch/commit/16585ca41ff747b555967bd445269f0a739433af", "message": "revert hlrc changes, only alter tests, so they cover field==null, which can\nbe valid", "committedDate": "2020-10-06T12:24:48Z", "type": "commit"}]}