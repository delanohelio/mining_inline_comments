{"pr_number": 54187, "pr_title": "Schedule commands in current thread context", "pr_createdAt": "2020-03-25T13:50:43Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54187", "timeline": [{"oid": "f31635fee4927b1dab84d25e35b68e9ab9090a52", "url": "https://github.com/elastic/elasticsearch/commit/f31635fee4927b1dab84d25e35b68e9ab9090a52", "message": "Schedule commands in current thread context\n\nCloses #17143", "committedDate": "2020-03-25T13:42:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk1MzM1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/54187#discussion_r397953352", "bodyText": "Should preserveContext be private now?", "author": "nik9000", "createdAt": "2020-03-25T15:37:38Z", "path": "server/src/main/java/org/elasticsearch/threadpool/ThreadPool.java", "diffHunk": "@@ -339,6 +337,7 @@ public ExecutorService executor(String name) {\n      */\n     @Override\n     public ScheduledCancellable schedule(Runnable command, TimeValue delay, String executor) {\n+        command = preserveContext(command);", "originalCommit": "f31635fee4927b1dab84d25e35b68e9ab9090a52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5NTc1NA==", "url": "https://github.com/elastic/elasticsearch/pull/54187#discussion_r397995754", "bodyText": "I've removed the method from the Scheduler interface in 34a704d", "author": "ywelsch", "createdAt": "2020-03-25T16:31:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk1MzM1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "34a704d4edfcbdb7a7f599e42fe08499063f8503", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/threadpool/ThreadPool.java b/server/src/main/java/org/elasticsearch/threadpool/ThreadPool.java\nindex 5d395f7e363..99e3143f315 100644\n--- a/server/src/main/java/org/elasticsearch/threadpool/ThreadPool.java\n+++ b/server/src/main/java/org/elasticsearch/threadpool/ThreadPool.java\n\n@@ -337,7 +337,7 @@ public class ThreadPool implements Scheduler {\n      */\n     @Override\n     public ScheduledCancellable schedule(Runnable command, TimeValue delay, String executor) {\n-        command = preserveContext(command);\n+        command = threadContext.preserveContext(command);\n         if (!Names.SAME.equals(executor)) {\n             command = new ThreadedRunnable(command, executor(executor));\n         }\n"}}, {"oid": "34a704d4edfcbdb7a7f599e42fe08499063f8503", "url": "https://github.com/elastic/elasticsearch/commit/34a704d4edfcbdb7a7f599e42fe08499063f8503", "message": "Remove preserveThreadContext method on Scheduler", "committedDate": "2020-03-25T16:30:31Z", "type": "commit"}]}