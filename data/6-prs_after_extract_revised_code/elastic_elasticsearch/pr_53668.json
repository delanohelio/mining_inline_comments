{"pr_number": 53668, "pr_title": "Fix potential bug in concurrent token refresh support", "pr_createdAt": "2020-03-17T14:35:46Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53668", "timeline": [{"oid": "57e91af16c411c146e174294d08664f21a1edbbc", "url": "https://github.com/elastic/elasticsearch/commit/57e91af16c411c146e174294d08664f21a1edbbc", "message": "Fix potential bug in concurrent token refresh support\n\nEnsure that we do not proceed execution after calling the\nlisterer's onFailure", "committedDate": "2020-03-17T14:21:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA2MDA1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53668#discussion_r394060053", "bodyText": "This sure works. An alternative is to \"return\" immediately after \"onFailure\", which could be safer for future changes, e.g. a new statement is accidentally added below to this if-else block.", "author": "ywangd", "createdAt": "2020-03-18T01:33:55Z", "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/TokenService.java", "diffHunk": "@@ -1101,9 +1101,10 @@ void decryptAndReturnSupersedingTokens(String refreshToken, RefreshTokenStatus r\n             if (decryptedTokens.length != 2) {\n                 logger.warn(\"Decrypted tokens string is not correctly formatted\");\n                 listener.onFailure(invalidGrantException(\"could not refresh the requested token\"));\n+            } else {", "originalCommit": "57e91af16c411c146e174294d08664f21a1edbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}