{"pr_number": 54166, "pr_title": "Improve stability of SamlServiceProviderIndexTests", "pr_createdAt": "2020-03-25T10:48:18Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54166", "timeline": [{"oid": "cfb24a58222b7f6173a7f1b8708b9dc3280ab594", "url": "https://github.com/elastic/elasticsearch/commit/cfb24a58222b7f6173a7f1b8708b9dc3280ab594", "message": "Improve stability of SamlServiceProviderIndexTests\n\nThis test assumed cluster events would be processed quickly which is\nnot always true", "committedDate": "2020-03-25T10:34:38Z", "type": "commit"}, {"oid": "a63fc64aa8226f20ebeca0786aec64b37ef52d8b", "url": "https://github.com/elastic/elasticsearch/commit/a63fc64aa8226f20ebeca0786aec64b37ef52d8b", "message": "Fix import", "committedDate": "2020-03-25T11:03:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4OTAyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/54166#discussion_r398989025", "bodyText": "Am I reading this wrong? There is nothing changing in the assertBusy here, wouldn't you need to reexecute the template get inside the assertBusy?", "author": "jasontedor", "createdAt": "2020-03-27T01:41:55Z", "path": "x-pack/plugin/identity-provider/src/test/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderIndexTests.java", "diffHunk": "@@ -160,12 +160,16 @@ public void testWritesViaAliasIfItExists() {\n         assertThat(readDocument(document.docId), equalTo(document));\n     }\n \n-    public void testInstallTemplateAutomaticallyOnClusterChange() {\n+    public void testInstallTemplateAutomaticallyOnClusterChange() throws Exception {\n         // Create an index that will trigger a cluster state change\n-        client().admin().indices().create(new CreateIndexRequest(randomAlphaOfLength(7).toLowerCase(Locale.ROOT))).actionGet();\n+        final String indexName = randomAlphaOfLength(7).toLowerCase(Locale.ROOT);\n+        client().admin().indices().create(new CreateIndexRequest(indexName)).actionGet();\n+\n+        ensureGreen(indexName);\n \n         IndexTemplateMetaData templateMeta = clusterService.state().metaData().templates().get(SamlServiceProviderIndex.TEMPLATE_NAME);\n-        assertNotNull(templateMeta);\n+\n+        assertBusy(() -> assertThat(\"template should have been installed\", templateMeta, notNullValue()));", "originalCommit": "a63fc64aa8226f20ebeca0786aec64b37ef52d8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMzE5MA==", "url": "https://github.com/elastic/elasticsearch/pull/54166#discussion_r399023190", "bodyText": "No you're not reading that wrong, I just need more sleep.", "author": "tvernum", "createdAt": "2020-03-27T04:02:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4OTAyNQ=="}], "type": "inlineReview", "revised_code": null}]}