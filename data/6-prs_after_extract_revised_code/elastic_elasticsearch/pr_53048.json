{"pr_number": 53048, "pr_title": "SQL: [Tests] Add tests for optimization of aliased expressions", "pr_createdAt": "2020-03-03T11:44:02Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53048", "timeline": [{"oid": "3830c8b16a3efc0425eadb978f7c775bf9b6db03", "url": "https://github.com/elastic/elasticsearch/commit/3830c8b16a3efc0425eadb978f7c775bf9b6db03", "message": "SQL: [Tests] Add tests for optimization of aliased expressions\n\nAdd a unit test to verify that the optimization of expression\n(e.g. COALESCE) is applied to all instances of the expression:\nSELECT, WHERE, GROUP BY.\n\nRelates to #35270", "committedDate": "2020-03-03T11:38:49Z", "type": "commit"}, {"oid": "487cc23c5bcd2963847ced09b39a93787153872e", "url": "https://github.com/elastic/elasticsearch/commit/487cc23c5bcd2963847ced09b39a93787153872e", "message": "test also having optimization", "committedDate": "2020-03-03T12:50:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzAwNzEzOA==", "url": "https://github.com/elastic/elasticsearch/pull/53048#discussion_r387007138", "bodyText": "Aggs does not expose its internal state - I would use instead the asAggBuilder() and its string to do the test matching.", "author": "costin", "createdAt": "2020-03-03T13:09:12Z", "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/querydsl/agg/Aggs.java", "diffHunk": "@@ -70,6 +70,11 @@ public Aggs(List<GroupByKey> groups, List<LeafAgg> simpleAggs, List<PipelineAgg>\n         return groups;\n     }\n \n+    // For testing\n+    public List<PipelineAgg> pipelineAggs() {", "originalCommit": "487cc23c5bcd2963847ced09b39a93787153872e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "966b699c778d57b21b08335941348c3e08c5a22e", "chunk": "diff --git a/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/querydsl/agg/Aggs.java b/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/querydsl/agg/Aggs.java\nindex b9b40b00c9d..573aa320a48 100644\n--- a/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/querydsl/agg/Aggs.java\n+++ b/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/querydsl/agg/Aggs.java\n\n@@ -70,11 +70,6 @@ public class Aggs {\n         return groups;\n     }\n \n-    // For testing\n-    public List<PipelineAgg> pipelineAggs() {\n-        return pipelineAggs;\n-    }\n-\n     public AggregationBuilder asAggBuilder() {\n         AggregationBuilder rootGroup = null;\n \n"}}, {"oid": "966b699c778d57b21b08335941348c3e08c5a22e", "url": "https://github.com/elastic/elasticsearch/commit/966b699c778d57b21b08335941348c3e08c5a22e", "message": "Address comments", "committedDate": "2020-03-03T14:12:33Z", "type": "commit"}]}