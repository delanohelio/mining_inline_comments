{"pr_number": 50564, "pr_title": "x-content: Support collapsed named objects", "pr_createdAt": "2020-01-02T17:32:37Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/50564", "timeline": [{"oid": "c94a8885ea038fed958504a3b35acc2b11e8e6c1", "url": "https://github.com/elastic/elasticsearch/commit/c94a8885ea038fed958504a3b35acc2b11e8e6c1", "message": "x-content: Support collapsed named objects\n\nThis adds support for \"collapsed\" named object to `ObjectParser`. In\nparticular, this supports the sort of xcontent that we use to specify\nsignificance heuristics. See #25519 and this example:\n\n```\nGET /_search\n{\n    \"query\" : {\n        \"terms\" : {\"force\" : [ \"British Transport Police\" ]}\n    },\n    \"aggregations\" : {\n        \"significant_crime_types\" : {\n            \"significant_terms\" : {\n                \"field\" : \"crime_type\",\n                \"mutual_information\" : { <<------- This is the name\n                    \"include_negatives\": true\n                }\n            }\n        }\n    }\n}\n```\n\nI believe there are a couple of things that work this way.\n\nI've held off on moving the actual parsing of the significant heuristics\nto this code to kep the review more compact. The moving is pretty\nmechanical stuff in the aggs framework.", "committedDate": "2020-01-02T17:22:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc0MDM0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/50564#discussion_r362740349", "bodyText": "Maybe Creates a new named ObjectParser that consumes unknown fields as generic Objects?  Otherwise it sounds as though the name is doing the consuming...", "author": "romseygeek", "createdAt": "2020-01-03T09:06:14Z", "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java", "diffHunk": "@@ -164,7 +178,7 @@ public ObjectParser(String name, boolean ignoreUnknownFields, @Nullable Supplier\n     }\n \n     /**\n-     * Creates a new ObjectParser instance with a name.\n+     * Creates a new ObjectParser instance with a name that consumes unknown fields as generic Objects.", "originalCommit": "c94a8885ea038fed958504a3b35acc2b11e8e6c1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d1c24af4a581226e99a81874a5230928df565dcc", "chunk": "diff --git a/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java b/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java\nindex ef4a81cff1e..09a997e7a15 100644\n--- a/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java\n+++ b/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java\n\n@@ -178,7 +179,7 @@ public final class ObjectParser<Value, Context> extends AbstractObjectParser<Val\n     }\n \n     /**\n-     * Creates a new ObjectParser instance with a name that consumes unknown fields as generic Objects.\n+     * Creates a new ObjectParser that consumes unknown fields as generic Objects.\n      * @param name the parsers name, used to reference the parser in exceptions and messages.\n      * @param unknownFieldConsumer how to consume parsed unknown fields\n      * @param valueSupplier a supplier that creates a new Value instance used when the parser is used as an inner object parser.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc0MDQxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/50564#discussion_r362740419", "bodyText": "Same as above", "author": "romseygeek", "createdAt": "2020-01-03T09:06:32Z", "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java", "diffHunk": "@@ -173,6 +187,24 @@ public ObjectParser(String name, UnknownFieldConsumer<Value> unknownFieldConsume\n         this(name, consumeUnknownField(unknownFieldConsumer), valueSupplier);\n     }\n \n+    /**\n+     * Creates a new ObjectParser instance with a name that attempts to resolve unknown fields", "originalCommit": "c94a8885ea038fed958504a3b35acc2b11e8e6c1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d1c24af4a581226e99a81874a5230928df565dcc", "chunk": "diff --git a/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java b/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java\nindex ef4a81cff1e..09a997e7a15 100644\n--- a/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java\n+++ b/libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java\n\n@@ -188,8 +189,7 @@ public final class ObjectParser<Value, Context> extends AbstractObjectParser<Val\n     }\n \n     /**\n-     * Creates a new ObjectParser instance with a name that attempts to resolve unknown fields\n-     * as {@link XContentParser#namedObject namedObjects}.\n+     * Creates a new ObjectParser that attempts to resolve unknown fields as {@link XContentParser#namedObject namedObjects}.\n      * @param <C> the type of named object that unknown fields are expected to be\n      * @param name the parsers name, used to reference the parser in exceptions and messages.\n      * @param categoryClass the type of named object that unknown fields are expected to be\n"}}, {"oid": "dac9f2eee807bcf1cdb8c5465bfc8a5343808af0", "url": "https://github.com/elastic/elasticsearch/commit/dac9f2eee807bcf1cdb8c5465bfc8a5343808af0", "message": "Merge branch 'master' into xcontent_unknown_named_object", "committedDate": "2020-01-03T16:07:42Z", "type": "commit"}, {"oid": "d1c24af4a581226e99a81874a5230928df565dcc", "url": "https://github.com/elastic/elasticsearch/commit/d1c24af4a581226e99a81874a5230928df565dcc", "message": "Javadoc", "committedDate": "2020-01-03T16:10:49Z", "type": "commit"}]}