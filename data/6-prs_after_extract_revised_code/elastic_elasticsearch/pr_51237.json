{"pr_number": 51237, "pr_title": "Truncate SAML Response in trace log", "pr_createdAt": "2020-01-20T18:39:07Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51237", "timeline": [{"oid": "9d6b841bd854bd410738ff2ed6b7dc57a92b19d8", "url": "https://github.com/elastic/elasticsearch/commit/9d6b841bd854bd410738ff2ed6b7dc57a92b19d8", "message": "Truncate SAML Response in trace log\n\nIn not truncated, a long SAML response XML document can fill max\nline length and mask the actual exception message that the trace\nstatement is meant to inform about.\nThe same XML Document is also printed in full on trace level in\nSamlRequestHandler#parseSamlMessage().", "committedDate": "2020-01-20T18:35:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODgyNzg1MA==", "url": "https://github.com/elastic/elasticsearch/pull/51237#discussion_r368827850", "bodyText": "This is fine, but I wonder if we should indicate that we truncated ?", "author": "tvernum", "createdAt": "2020-01-21T06:21:50Z", "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/saml/SamlAuthenticator.java", "diffHunk": "@@ -68,7 +68,8 @@ SamlAttributes authenticate(SamlToken token) {\n             try {\n                 return authenticateResponse(root, token.getAllowedSamlRequestIds());\n             } catch (ElasticsearchSecurityException e) {\n-                logger.trace(\"Rejecting SAML response {} because {}\", SamlUtils.toString(root), e.getMessage());\n+                logger.trace(\"Rejecting SAML response {} because {}\", Strings.cleanTruncate(SamlUtils.toString(root), 512),\n+                    e.getMessage());", "originalCommit": "9d6b841bd854bd410738ff2ed6b7dc57a92b19d8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "265fa52fc2b2918d6c73404defa708aedc684981", "chunk": "diff --git a/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/saml/SamlAuthenticator.java b/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/saml/SamlAuthenticator.java\nindex 951dcdf4ff2..77fe28f8701 100644\n--- a/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/saml/SamlAuthenticator.java\n+++ b/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/saml/SamlAuthenticator.java\n\n@@ -68,7 +68,7 @@ class SamlAuthenticator extends SamlRequestHandler {\n             try {\n                 return authenticateResponse(root, token.getAllowedSamlRequestIds());\n             } catch (ElasticsearchSecurityException e) {\n-                logger.trace(\"Rejecting SAML response {} because {}\", Strings.cleanTruncate(SamlUtils.toString(root), 512),\n+                logger.trace(\"Rejecting SAML response [{}...] because {}\", Strings.cleanTruncate(SamlUtils.toString(root), 512),\n                     e.getMessage());\n                 throw e;\n             }\n"}}, {"oid": "265fa52fc2b2918d6c73404defa708aedc684981", "url": "https://github.com/elastic/elasticsearch/commit/265fa52fc2b2918d6c73404defa708aedc684981", "message": "address feedback", "committedDate": "2020-01-21T11:07:03Z", "type": "commit"}]}