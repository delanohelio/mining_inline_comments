{"pr_number": 61584, "pr_title": "Call ActionListener.onResponse exactly once", "pr_createdAt": "2020-08-26T14:35:35Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61584", "timeline": [{"oid": "34a4713fb7539915f525ee85c513e22d1e2e385f", "url": "https://github.com/elastic/elasticsearch/commit/34a4713fb7539915f525ee85c513e22d1e2e385f", "message": "Call ActionListener.onResponse exactly once\n\nUnder specific circumstances we would call onResponse twice, which\nled to unexpected behavior.", "committedDate": "2020-08-26T14:28:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTkzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/61584#discussion_r477355935", "bodyText": "can you add a test to ensure the listener is only called once?", "author": "jaymode", "createdAt": "2020-08-26T14:42:24Z", "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/esnative/ReservedRealm.java", "diffHunk": "@@ -129,8 +129,9 @@ protected void doLookupUser(String username, ActionListener<User> listener) {\n         if (realmEnabled == false) {\n             if (anonymousEnabled && AnonymousUser.isAnonymousUsername(username, config.settings())) {\n                 listener.onResponse(anonymousUser);\n+            } else {\n+                listener.onResponse(null);", "originalCommit": "34a4713fb7539915f525ee85c513e22d1e2e385f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1ODExNw==", "url": "https://github.com/elastic/elasticsearch/pull/61584#discussion_r477358117", "bodyText": "yes, good call, will do", "author": "jkakavas", "createdAt": "2020-08-26T14:45:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTkzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzg2ODUwNw==", "url": "https://github.com/elastic/elasticsearch/pull/61584#discussion_r477868507", "bodyText": "I recently had to do exactly that, if you're looking for a possible approach, look here: #60497", "author": "tvernum", "createdAt": "2020-08-27T01:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTkzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI4MjA4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/61584#discussion_r478282085", "bodyText": "added in ad62802", "author": "jkakavas", "createdAt": "2020-08-27T09:27:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTkzNQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ad628029660092078e2e8cfe6c150c5d3e3f8078", "url": "https://github.com/elastic/elasticsearch/commit/ad628029660092078e2e8cfe6c150c5d3e3f8078", "message": "add test", "committedDate": "2020-08-27T09:26:39Z", "type": "commit"}]}