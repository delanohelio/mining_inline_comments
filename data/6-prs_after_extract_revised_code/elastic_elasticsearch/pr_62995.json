{"pr_number": 62995, "pr_title": "InternalClusterInfoService should not ignore hidden indices", "pr_createdAt": "2020-09-29T10:14:11Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62995", "timeline": [{"oid": "946418f917b433917b9790b2e76688ddff7c5644", "url": "https://github.com/elastic/elasticsearch/commit/946418f917b433917b9790b2e76688ddff7c5644", "message": "InternalClusterInfoService should not ignore hidden indices", "committedDate": "2020-09-29T10:03:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY2OTA4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/62995#discussion_r496669082", "bodyText": "nit: just use randomBoolean()?", "author": "henningandersen", "createdAt": "2020-09-29T12:18:00Z", "path": "server/src/internalClusterTest/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java", "diffHunk": "@@ -117,13 +118,18 @@ private void setClusterInfoTimeout(String timeValue) {\n \n     public void testClusterInfoServiceCollectsInformation() {\n         internalCluster().startNodes(2);\n-        assertAcked(prepareCreate(\"test\").setSettings(Settings.builder()\n-            .put(Store.INDEX_STORE_STATS_REFRESH_INTERVAL_SETTING.getKey(), 0)\n-            .put(EnableAllocationDecider.INDEX_ROUTING_REBALANCE_ENABLE_SETTING.getKey(), EnableAllocationDecider.Rebalance.NONE).build()));\n+\n+        final String indexName = (rarely() ? \".\" : \"\") + randomAlphaOfLength(5).toLowerCase(Locale.ROOT);", "originalCommit": "946418f917b433917b9790b2e76688ddff7c5644", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjczMjg4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/62995#discussion_r496732882", "bodyText": "done", "author": "tlrx", "createdAt": "2020-09-29T13:49:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY2OTA4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "9b29ed729ee87059a3133d7019c0407a12249e44", "chunk": "diff --git a/server/src/internalClusterTest/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java b/server/src/internalClusterTest/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java\nindex 115770ac07a..c361082df91 100644\n--- a/server/src/internalClusterTest/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java\n+++ b/server/src/internalClusterTest/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java\n\n@@ -119,7 +119,7 @@ public class ClusterInfoServiceIT extends ESIntegTestCase {\n     public void testClusterInfoServiceCollectsInformation() {\n         internalCluster().startNodes(2);\n \n-        final String indexName = (rarely() ? \".\" : \"\") + randomAlphaOfLength(5).toLowerCase(Locale.ROOT);\n+        final String indexName = (randomBoolean() ? \".\" : \"\") + randomAlphaOfLength(5).toLowerCase(Locale.ROOT);\n         assertAcked(prepareCreate(indexName)\n             .setSettings(Settings.builder()\n                 .put(Store.INDEX_STORE_STATS_REFRESH_INTERVAL_SETTING.getKey(), 0)\n"}}, {"oid": "9b29ed729ee87059a3133d7019c0407a12249e44", "url": "https://github.com/elastic/elasticsearch/commit/9b29ed729ee87059a3133d7019c0407a12249e44", "message": "Use randomBoolean", "committedDate": "2020-09-29T13:49:00Z", "type": "commit"}, {"oid": "839512ea7d4dd27ac719b4b485b59194c088269f", "url": "https://github.com/elastic/elasticsearch/commit/839512ea7d4dd27ac719b4b485b59194c088269f", "message": "Merge branch 'master' into fix-hidden-indices-in-internal-cluster-info", "committedDate": "2020-09-29T13:49:16Z", "type": "commit"}, {"oid": "99b262fb03ca6bb93aff05d7493445693a413b4d", "url": "https://github.com/elastic/elasticsearch/commit/99b262fb03ca6bb93aff05d7493445693a413b4d", "message": "Also test system indices", "committedDate": "2020-09-29T13:59:14Z", "type": "commit"}, {"oid": "55ce2b06b5f8af0c42ddc0389d6b60c20aa59acc", "url": "https://github.com/elastic/elasticsearch/commit/55ce2b06b5f8af0c42ddc0389d6b60c20aa59acc", "message": "Merge branch 'master' into fix-hidden-indices-in-internal-cluster-info", "committedDate": "2020-09-29T15:05:45Z", "type": "commit"}]}