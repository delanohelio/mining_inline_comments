{"pr_number": 54429, "pr_title": "Fix a master->7.x serialization bug", "pr_createdAt": "2020-03-30T14:45:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54429", "timeline": [{"oid": "57db6114cc1b7e34ade8edfdee553dc3ec8a20e7", "url": "https://github.com/elastic/elasticsearch/commit/57db6114cc1b7e34ade8edfdee553dc3ec8a20e7", "message": "Fix a master->7.x serialization bug\n\n`master` wasn't sending `auto_date_histogram`'s\n`minimumIntervalExpression` over the wire to `7.x` nodes even though\neverything above `7.3` expected it. We never noticed this because we\ndidn't have any yml tests for `auto_date_histogram` until I added some\nin #54161.\n\nCloses #54396", "committedDate": "2020-03-30T14:41:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1MDQ3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/54429#discussion_r400250479", "bodyText": "I'm moving these below the ctor to make me feel better.", "author": "nik9000", "createdAt": "2020-03-30T14:46:29Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java", "diffHunk": "@@ -110,20 +110,6 @@\n \n     private String minimumIntervalExpression;\n \n-    public String getMinimumIntervalExpression() {", "originalCommit": "57db6114cc1b7e34ade8edfdee553dc3ec8a20e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1MDcwMg==", "url": "https://github.com/elastic/elasticsearch/pull/54429#discussion_r400250702", "bodyText": "I'm moving this up under the reading ctor so it is easier to compare.", "author": "nik9000", "createdAt": "2020-03-30T14:46:45Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java", "diffHunk": "@@ -138,6 +124,14 @@ public AutoDateHistogramAggregationBuilder(StreamInput in) throws IOException {\n         }\n     }\n \n+    @Override", "originalCommit": "57db6114cc1b7e34ade8edfdee553dc3ec8a20e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88b645ffea5cbd69f247d3f40eec42ad655c8e51", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java\nindex 4ae831d8875..2036a312b18 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java\n\n@@ -127,7 +127,7 @@ public class AutoDateHistogramAggregationBuilder\n     @Override\n     protected void innerWriteTo(StreamOutput out) throws IOException {\n         out.writeVInt(numBuckets);\n-        if (out.getVersion().onOrAfter(Version.V_8_0_0)) {\n+        if (out.getVersion().onOrAfter(Version.V_7_3_0)) {\n             out.writeOptionalString(minimumIntervalExpression);\n         }\n     }\n"}}, {"oid": "88b645ffea5cbd69f247d3f40eec42ad655c8e51", "url": "https://github.com/elastic/elasticsearch/commit/88b645ffea5cbd69f247d3f40eec42ad655c8e51", "message": "Actually fix bug", "committedDate": "2020-03-30T14:47:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1MTkyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/54429#discussion_r400251925", "bodyText": "Changing this from 8_0_0 to 7_3_0 is the actual fix.", "author": "nik9000", "createdAt": "2020-03-30T14:48:20Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java", "diffHunk": "@@ -138,6 +124,14 @@ public AutoDateHistogramAggregationBuilder(StreamInput in) throws IOException {\n         }\n     }\n \n+    @Override\n+    protected void innerWriteTo(StreamOutput out) throws IOException {\n+        out.writeVInt(numBuckets);\n+        if (out.getVersion().onOrAfter(Version.V_7_3_0)) {", "originalCommit": "88b645ffea5cbd69f247d3f40eec42ad655c8e51", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}