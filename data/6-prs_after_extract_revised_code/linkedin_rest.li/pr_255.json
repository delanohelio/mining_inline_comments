{"pr_number": 255, "pr_title": "Enable arg file for resolver path to avoid arg too long errors.", "pr_createdAt": "2020-04-10T00:07:34Z", "pr_url": "https://github.com/linkedin/rest.li/pull/255", "timeline": [{"oid": "87f5eec089e0e59cf1096f5e036666cba56d4065", "url": "https://github.com/linkedin/rest.li/commit/87f5eec089e0e59cf1096f5e036666cba56d4065", "message": "Enable arg file for resolver path to avoid arg too long errors.", "committedDate": "2020-04-10T00:04:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU0MjY2MA==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406542660", "bodyText": "Nice. Thanks @evanw555 for convincing me to extract isArgFile(String) to a utility class.", "author": "DPUkyle", "createdAt": "2020-04-10T00:13:55Z", "path": "generator/src/main/java/com/linkedin/pegasus/generator/PegasusDataTemplateGenerator.java", "diffHunk": "@@ -97,7 +98,15 @@ public static void main(String[] args)\n \n     final String generateImportedProperty = System.getProperty(PegasusDataTemplateGenerator.GENERATOR_GENERATE_IMPORTED);\n     final boolean generateImported = generateImportedProperty == null ? true : Boolean.parseBoolean(generateImportedProperty);\n-    PegasusDataTemplateGenerator.run(System.getProperty(AbstractGenerator.GENERATOR_RESOLVER_PATH),\n+    String resolverPath = System.getProperty(AbstractGenerator.GENERATOR_RESOLVER_PATH);\n+    if (resolverPath != null && ArgumentFileProcessor.isArgFile(resolverPath))", "originalCommit": "87f5eec089e0e59cf1096f5e036666cba56d4065", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU0MzIxMg==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406543212", "bodyText": "Are you sure you want to globally enable this feature? Evan and I reserved it as off by default, and allowing consumers with javaexec issues to opt-in in their build.gradle files.", "author": "DPUkyle", "createdAt": "2020-04-10T00:16:07Z", "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1493,6 +1493,7 @@ protected void configureConversionUtilities(Project project, SourceSet sourceSet\n       }\n       task.setKeepOriginal(keepOriginal);\n       task.setSkipVerification(skipVerification);\n+      task.setEnableArgFile(true);", "originalCommit": "87f5eec089e0e59cf1096f5e036666cba56d4065", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2MzM4OA==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406563388", "bodyText": "+1 on this. We've seen before that gradle-plugins and restli-tools are not always locked to the same version. Kyle and I think it's better to keep it opt-in for now, then make it enabled by default later (or if/when we create newer more resilient tools)", "author": "evanw555", "createdAt": "2020-04-10T01:43:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU0MzIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3MjIwOQ==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406572209", "bodyText": "Done", "author": "karthikbalasub", "createdAt": "2020-04-10T02:21:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU0MzIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3Mzk5MQ==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406573991", "bodyText": "Actually, after thinking about this a little harder, I've realized that: convertXXXToPdl and reformatXXXPdl are not part of the normal build process, so enabling arg file by default may not be that risky. However, the same cannot be said for generateXXXDataTemplate or XXXTranslateSchemas; these should be opt-in IMO.", "author": "evanw555", "createdAt": "2020-04-10T02:29:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU0MzIxMg=="}], "type": "inlineReview", "revised_code": {"commit": "d90075f7554efef7b096415d73dd74234b6d0244", "chunk": "diff --git a/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java b/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\nindex 6c9e98d3e..84c5ea999 100644\n--- a/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\n+++ b/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\n\n@@ -1493,7 +1493,6 @@ public class PegasusPlugin implements Plugin<Project>\n       }\n       task.setKeepOriginal(keepOriginal);\n       task.setSkipVerification(skipVerification);\n-      task.setEnableArgFile(true);\n \n       task.onlyIf(t -> task.getInputDir().exists());\n       task.doLast(new CacheableAction<>(t ->\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3NDgwNw==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406574807", "bodyText": "Is this necessary? Task inputs can be configured directly as such:\ngenerateMainDataTemplate {\n  enableArgFile = true\n}\n\nThis is how the fix for generateXXXRestClient is enabled.", "author": "evanw555", "createdAt": "2020-04-10T02:33:01Z", "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -527,6 +527,7 @@\n   // by default it is disabled, because it triggers hot-reload (even if it results in a no-op)\n   private static final String DESTROY_STALE_FILES_ENABLE = \"enableDestroyStaleFiles\";\n   public static final Collection<String> DATA_TEMPLATE_FILE_SUFFIXES = new ArrayList<>();\n+  private static final String DATA_TEMPLATE_ENABLE_ARGFILE = \"generateDataTemplate.enableArgFile\";", "originalCommit": "7effd61bc9b11b59977230cac7e872e125339561", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3ODEwNg==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406578106", "bodyText": "Remove the property based logic. We can enable this using task args directly.", "author": "karthikbalasub", "createdAt": "2020-04-10T02:47:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3NDgwNw=="}], "type": "inlineReview", "revised_code": {"commit": "d90075f7554efef7b096415d73dd74234b6d0244", "chunk": "diff --git a/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java b/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\nindex 999c71aeb..84c5ea999 100644\n--- a/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\n+++ b/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\n\n@@ -527,7 +527,6 @@ public class PegasusPlugin implements Plugin<Project>\n   // by default it is disabled, because it triggers hot-reload (even if it results in a no-op)\n   private static final String DESTROY_STALE_FILES_ENABLE = \"enableDestroyStaleFiles\";\n   public static final Collection<String> DATA_TEMPLATE_FILE_SUFFIXES = new ArrayList<>();\n-  private static final String DATA_TEMPLATE_ENABLE_ARGFILE = \"generateDataTemplate.enableArgFile\";\n \n   public static final String IDL_FILE_SUFFIX = \".restspec.json\";\n   public static final String SNAPSHOT_FILE_SUFFIX = \".snapshot.json\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3NDg3Mw==", "url": "https://github.com/linkedin/rest.li/pull/255#discussion_r406574873", "bodyText": "nit: misspelled \"schemas\"", "author": "evanw555", "createdAt": "2020-04-10T02:33:18Z", "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -546,6 +547,7 @@\n   private static final String CONVERT_TO_PDL_KEEP_ORIGINAL = \"convertToPdl.keepOriginal\";\n   private static final String CONVERT_TO_PDL_SKIP_VERIFICATION = \"convertToPdl.skipVerification\";\n   private static final String CONVERT_TO_PDL_PRESERVE_SOURCE_CMD = \"convertToPdl.preserveSourceCmd\";\n+  private static final String TRANSLATE_SCHMEAS_ENABLE_ARGFILE = \"translateSchemas.enableArgFile\";", "originalCommit": "7effd61bc9b11b59977230cac7e872e125339561", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d90075f7554efef7b096415d73dd74234b6d0244", "chunk": "diff --git a/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java b/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\nindex 999c71aeb..84c5ea999 100644\n--- a/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\n+++ b/gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java\n\n@@ -547,7 +546,6 @@ public class PegasusPlugin implements Plugin<Project>\n   private static final String CONVERT_TO_PDL_KEEP_ORIGINAL = \"convertToPdl.keepOriginal\";\n   private static final String CONVERT_TO_PDL_SKIP_VERIFICATION = \"convertToPdl.skipVerification\";\n   private static final String CONVERT_TO_PDL_PRESERVE_SOURCE_CMD = \"convertToPdl.preserveSourceCmd\";\n-  private static final String TRANSLATE_SCHMEAS_ENABLE_ARGFILE = \"translateSchemas.enableArgFile\";\n \n   // Below variables are used to collect data across all pegasus projects (sub-projects) and then print information\n   // to the user at the end after build is finished.\n"}}, {"oid": "d90075f7554efef7b096415d73dd74234b6d0244", "url": "https://github.com/linkedin/rest.li/commit/d90075f7554efef7b096415d73dd74234b6d0244", "message": "Address review comments.\nRelease 28.2.4", "committedDate": "2020-04-10T02:41:32Z", "type": "commit"}, {"oid": "d90075f7554efef7b096415d73dd74234b6d0244", "url": "https://github.com/linkedin/rest.li/commit/d90075f7554efef7b096415d73dd74234b6d0244", "message": "Address review comments.\nRelease 28.2.4", "committedDate": "2020-04-10T02:41:32Z", "type": "forcePushed"}]}