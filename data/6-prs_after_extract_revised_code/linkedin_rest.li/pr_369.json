{"pr_number": 369, "pr_title": "Create client side config to enable relative load balancer from client library", "pr_createdAt": "2020-08-06T06:06:34Z", "pr_url": "https://github.com/linkedin/rest.li/pull/369", "timeline": [{"oid": "bdf6bde8854000286fdf4c84fbe7ed44e9199086", "url": "https://github.com/linkedin/rest.li/commit/bdf6bde8854000286fdf4c84fbe7ed44e9199086", "message": "Create client side config to enable relative load balancer from client library", "committedDate": "2020-08-06T05:58:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwNTI3Nw==", "url": "https://github.com/linkedin/rest.li/pull/369#discussion_r469405277", "bodyText": "What if enableRelativeLoadBalancer  set to false while the srategyList only have relativeLoadBalancer?\nI guess this option will be removed before full follout?", "author": "cx-super", "createdAt": "2020-08-12T16:57:51Z", "path": "d2/src/main/java/com/linkedin/d2/balancer/D2ClientBuilder.java", "diffHunk": "@@ -479,6 +480,12 @@ public D2ClientBuilder setD2JmxManagerPrefix(String d2JmxManagerPrefix)\n     return this;\n   }\n \n+  public D2ClientBuilder setEnableRelativeLoadBalancer(boolean enableRelativeLoadBalancer)\n+  {\n+    _config.enableRelativeLoadBalancer = enableRelativeLoadBalancer;", "originalCommit": "bdf6bde8854000286fdf4c84fbe7ed44e9199086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTg1OQ==", "url": "https://github.com/linkedin/rest.li/pull/369#discussion_r469491859", "bodyText": "Yes it will be a problem if server only has \"RELATIVE\" and client set it to enableRelativeLoadBalancer to false. Initially I want server to always set both in the strategy list before we turn on the enableRelativeLoadBalancer to true by default for everyone. So before full rollout, we will enable relative on client as the default behavior.\nBut we still do not have fully control. One thing I can do is to use \"degrader\" as the backup, but if server really removed the degrader support, we may have to read global default degrader config for that case. Let me know what you think.", "author": "rachelhanhan", "createdAt": "2020-08-12T19:31:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwNTI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU2MjM5MQ==", "url": "https://github.com/linkedin/rest.li/pull/369#discussion_r469562391", "bodyText": "I understand we need this for testing purpose. What I'm expecting is that we remove it before fully roll out.\nIf you look at r2d2 configuration, there are very few properties are overridable from client side. Even if one does, it still needs permissions from the server side. Having this flag makes it implicit if relativeLB is used or not when you investigate a problem. It's probably better have it only enable it from d2 config directly.", "author": "cx-super", "createdAt": "2020-08-12T21:39:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwNTI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU3MzAxMg==", "url": "https://github.com/linkedin/rest.li/pull/369#discussion_r469573012", "bodyText": "Since the default client-side behavior after rollout would enable the relative strategy, then if a client explicitly calls setEnableRelativeLoadBalancer to disable the relative feature, they probably should have a good reason to do so. If we're adding this client-side tuner, is it more reasonable to use degrader as a backup in this case?", "author": "rickzx", "createdAt": "2020-08-12T22:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwNTI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNjI2Nw==", "url": "https://github.com/linkedin/rest.li/pull/369#discussion_r469606267", "bodyText": "Makes sense, to summarize:\n\nWe will only use enableRelativeLoadBalancer for piloting services, after pilot we will turn it on for everyone and rely on server side control.\nIn the short-term, if anyone set the enableRelativeLoadBalancer to false, I will add the backup option.", "author": "rachelhanhan", "createdAt": "2020-08-12T23:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwNTI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3NTE3OA==", "url": "https://github.com/linkedin/rest.li/pull/369#discussion_r470275178", "bodyText": "Sounds great.", "author": "cx-super", "createdAt": "2020-08-13T22:06:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwNTI3Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "59fba63ad0ab9b3eee840120c2be9519be2c725a", "url": "https://github.com/linkedin/rest.li/commit/59fba63ad0ab9b3eee840120c2be9519be2c725a", "message": "Add degrader strategy as fallback", "committedDate": "2020-08-13T08:11:17Z", "type": "commit"}]}