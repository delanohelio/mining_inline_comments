{"pr_number": 379, "pr_title": "add callback based ClusterInfoProvider.getDarkClusterConfigMap", "pr_createdAt": "2020-08-13T00:37:42Z", "pr_url": "https://github.com/linkedin/rest.li/pull/379", "timeline": [{"oid": "82a658a52c6e104a5049e0dc4ad82fa6f11eb8dc", "url": "https://github.com/linkedin/rest.li/commit/82a658a52c6e104a5049e0dc4ad82fa6f11eb8dc", "message": "add callback based ClusterInfoProvider.getDarkClusterConfigMap", "committedDate": "2020-08-13T00:30:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI1Nzc1NA==", "url": "https://github.com/linkedin/rest.li/pull/379#discussion_r470257754", "bodyText": "Is this comment got cut-off at the end of the line?", "author": "li-bsoetarman", "createdAt": "2020-08-13T21:25:17Z", "path": "darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterStrategyFactoryImpl.java", "diffHunk": "@@ -85,14 +85,11 @@ public DarkClusterStrategyFactoryImpl(@Nonnull Facilities facilities,\n   public void start()\n   {\n     // make sure we're listening to the source cluster and have strategies for any\n-    // associated dark clusters. The order matters here: we directly invoke onClusterAdded to\n-    // directly query zookeeper for the DarkClusterConfigMap, and then we add the listener.\n-    // Doing it in reverse causes a timeout. Ideally, registerClusterListener would have some\n-    // functionality similar to SimpleLoadBalancer.listenToCluster that both adds a listener and\n-    // requests the data through the eventbus, which will trigger ClusterSubscriber::handlePut and\n-    // and iterate through the ClusterListeners.\n-    _clusterListener.onClusterAdded(_sourceClusterName);\n+    // associated dark clusters. While registering the cluster listener is enough,\n+    // we also \"warm up\" the strategies directly by triggering the clusterListener so that\n+    // we retrieve the dark clusters before any inbound request. This is a", "originalCommit": "82a658a52c6e104a5049e0dc4ad82fa6f11eb8dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2MzQ3Ng==", "url": "https://github.com/linkedin/rest.li/pull/379#discussion_r470263476", "bodyText": "oops, will remove that, thanks for catching.", "author": "davidhoa", "createdAt": "2020-08-13T21:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI1Nzc1NA=="}], "type": "inlineReview", "revised_code": {"commit": "a0b561ffe80e3dcc561f0791d3dbf2fff1e95b43", "chunk": "diff --git a/darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterStrategyFactoryImpl.java b/darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterStrategyFactoryImpl.java\nindex a68147b95..d3a42e4de 100644\n--- a/darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterStrategyFactoryImpl.java\n+++ b/darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterStrategyFactoryImpl.java\n\n@@ -87,7 +87,7 @@ public class DarkClusterStrategyFactoryImpl implements DarkClusterStrategyFactor\n     // make sure we're listening to the source cluster and have strategies for any\n     // associated dark clusters. While registering the cluster listener is enough,\n     // we also \"warm up\" the strategies directly by triggering the clusterListener so that\n-    // we retrieve the dark clusters before any inbound request. This is a\n+    // we retrieve the dark clusters before any inbound request.\n     _facilities.getClusterInfoProvider().registerClusterListener(_clusterListener);\n     _clusterListener.onClusterAdded(_sourceClusterName);\n     LOG.info(\"listening to dark clusters on \" + _sourceClusterName);\n"}}, {"oid": "a0b561ffe80e3dcc561f0791d3dbf2fff1e95b43", "url": "https://github.com/linkedin/rest.li/commit/a0b561ffe80e3dcc561f0791d3dbf2fff1e95b43", "message": "fixed typo.", "committedDate": "2020-08-13T21:36:56Z", "type": "commit"}]}