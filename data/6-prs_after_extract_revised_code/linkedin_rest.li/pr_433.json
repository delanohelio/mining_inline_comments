{"pr_number": 433, "pr_title": "Fix collectionMetadata missing link issue when collection count is 0", "pr_createdAt": "2020-10-02T07:11:51Z", "pr_url": "https://github.com/linkedin/rest.li/pull/433", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2MjIxNw==", "url": "https://github.com/linkedin/rest.li/pull/433#discussion_r498662217", "bodyText": "I thought we already send \"self\" links when I suggested adding this.\nSince we don't do that for count >0, the consistent solution would be to return an empty links array when count ==0.\nOther option is to add \"self\" for both cases (at the end when count >0). But this might increase the payload size.", "author": "karthikbalasub", "createdAt": "2020-10-02T07:42:07Z", "path": "restli-server/src/main/java/com/linkedin/restli/internal/server/util/RestUtils.java", "diffHunk": "@@ -126,6 +125,17 @@ public static CollectionMetadata buildMetadata(final URI requestUri,\n \n       metadata.setLinks(links);\n     }\n+    else if (pagingContext.getCount() == 0)\n+    {\n+      // even when we are getting count = 0, we should honor that links\n+      // is a required field in the CollectionMetadata record\n+      Link selfLink = new Link();\n+      selfLink.setRel(\"self\");", "originalCommit": "86f91b08c885bd21f5b62310ec97090cad35bb79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk2NDI0OA==", "url": "https://github.com/linkedin/rest.li/pull/433#discussion_r498964248", "bodyText": "Yeah, I looked back the ticket, the empty array is the common expectation", "author": "BrianPin", "createdAt": "2020-10-02T17:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2MjIxNw=="}], "type": "inlineReview", "revised_code": {"commit": "06832e3a195af7a4ac0b228aad361b81d9091981", "chunk": "diff --git a/restli-server/src/main/java/com/linkedin/restli/internal/server/util/RestUtils.java b/restli-server/src/main/java/com/linkedin/restli/internal/server/util/RestUtils.java\nindex 494ce7fe7..aa5b6d7f2 100644\n--- a/restli-server/src/main/java/com/linkedin/restli/internal/server/util/RestUtils.java\n+++ b/restli-server/src/main/java/com/linkedin/restli/internal/server/util/RestUtils.java\n\n@@ -123,19 +123,10 @@ public class RestUtils\n         links.add(nextLink);\n       }\n \n-      metadata.setLinks(links);\n-    }\n-    else if (pagingContext.getCount() == 0)\n-    {\n-      // even when we are getting count = 0, we should honor that links\n-      // is a required field in the CollectionMetadata record\n-      Link selfLink = new Link();\n-      selfLink.setRel(\"self\");\n-      selfLink.setHref(requestUri.toString());\n-      selfLink.setType(bestEncoding);\n-      links.add(selfLink);\n-      metadata.setLinks(links);\n     }\n+    // even when we are getting count = 0, we should honor that links\n+    // is a required field in the CollectionMetadata record\n+    metadata.setLinks(links);\n     return metadata;\n   }\n \n"}}, {"oid": "06832e3a195af7a4ac0b228aad361b81d9091981", "url": "https://github.com/linkedin/rest.li/commit/06832e3a195af7a4ac0b228aad361b81d9091981", "message": "Fix collectionMetadata missing link issue when collection count is 0", "committedDate": "2020-10-02T17:48:00Z", "type": "forcePushed"}, {"oid": "d69ba05bd4eb63e3b51876785e53669cfc1244d5", "url": "https://github.com/linkedin/rest.li/commit/d69ba05bd4eb63e3b51876785e53669cfc1244d5", "message": "Fix collectionMetadata missing link issue when collection count is 0", "committedDate": "2020-10-02T20:15:26Z", "type": "commit"}, {"oid": "21f2e6d6438562e576230830f9cb978d9b3c8861", "url": "https://github.com/linkedin/rest.li/commit/21f2e6d6438562e576230830f9cb978d9b3c8861", "message": "Bump version for releae", "committedDate": "2020-10-02T20:18:23Z", "type": "commit"}, {"oid": "21f2e6d6438562e576230830f9cb978d9b3c8861", "url": "https://github.com/linkedin/rest.li/commit/21f2e6d6438562e576230830f9cb978d9b3c8861", "message": "Bump version for releae", "committedDate": "2020-10-02T20:18:23Z", "type": "forcePushed"}]}