{"pr_number": 2481, "pr_title": "[java] Fix JUnitSpellingRule false positive", "pr_createdAt": "2020-05-12T22:56:51Z", "pr_url": "https://github.com/pmd/pmd/pull/2481", "timeline": [{"oid": "d349d6669661d78921c730fbfb343b794a040cc4", "url": "https://github.com/pmd/pmd/commit/d349d6669661d78921c730fbfb343b794a040cc4", "message": "fix JUnitSpellingRule false positive, closes #2477. Also add two more tests", "committedDate": "2020-05-12T22:46:36Z", "type": "commit"}, {"oid": "8b5be784fd34a6af8c530af8eebdc671dcfd3977", "url": "https://github.com/pmd/pmd/commit/8b5be784fd34a6af8c530af8eebdc671dcfd3977", "message": "fix pmd violation", "committedDate": "2020-05-12T23:05:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzNTU0Nw==", "url": "https://github.com/pmd/pmd/pull/2481#discussion_r425335547", "bodyText": "I'd not expose these methods.\nThese methods are called already when visiting CompilationUnit and the result is stored in fields, see lines 38-40 above.\nI'd make these fields protected, so that you can use it in the rule.", "author": "adangel", "createdAt": "2020-05-14T18:08:53Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/AbstractJUnitRule.java", "diffHunk": "@@ -89,7 +89,7 @@ private boolean isJUnit3Method(ASTMethodDeclaration method) {\n         return isJUnit3Class && method.isVoid() && method.getName().startsWith(\"test\");\n     }\n \n-    private boolean isJUnit3Class(ASTCompilationUnit node) {\n+    protected boolean isJUnit3Class(ASTCompilationUnit node) {", "originalCommit": "8b5be784fd34a6af8c530af8eebdc671dcfd3977", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4NzkzMg==", "url": "https://github.com/pmd/pmd/pull/2481#discussion_r426187932", "bodyText": "Indeed, fixed.", "author": "KroArtem", "createdAt": "2020-05-16T20:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzNTU0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "ad68cdda24038bfce80c50f327587eb98724343b", "chunk": "diff --git a/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/AbstractJUnitRule.java b/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/AbstractJUnitRule.java\nindex be7500f7bc..48a5ee69e6 100644\n--- a/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/AbstractJUnitRule.java\n+++ b/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/AbstractJUnitRule.java\n\n@@ -89,7 +89,7 @@ public abstract class AbstractJUnitRule extends AbstractJavaRule {\n         return isJUnit3Class && method.isVoid() && method.getName().startsWith(\"test\");\n     }\n \n-    protected boolean isJUnit3Class(ASTCompilationUnit node) {\n+    private boolean isJUnit3Class(ASTCompilationUnit node) {\n         ASTClassOrInterfaceDeclaration cid = node.getFirstDescendantOfType(ASTClassOrInterfaceDeclaration.class);\n         if (cid == null) {\n             return false;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzNTk3OQ==", "url": "https://github.com/pmd/pmd/pull/2481#discussion_r425335979", "bodyText": "If using the protected fields from the base class, you don't need to search here again for the compilation unit and call again the methods - that was already done....", "author": "adangel", "createdAt": "2020-05-14T18:09:45Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/errorprone/JUnitSpellingRule.java", "diffHunk": "@@ -5,13 +5,19 @@\n \n package net.sourceforge.pmd.lang.java.rule.errorprone;\n \n+import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;\n import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;\n import net.sourceforge.pmd.lang.java.rule.AbstractJUnitRule;\n \n public class JUnitSpellingRule extends AbstractJUnitRule {\n \n     @Override\n     public Object visit(ASTMethodDeclaration node, Object data) {\n+        ASTCompilationUnit acu = node.getFirstParentOfType(ASTCompilationUnit.class);\n+        if (isJUnit5Class(acu) || isJUnit4Class(acu)) {", "originalCommit": "8b5be784fd34a6af8c530af8eebdc671dcfd3977", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4Nzk0Nw==", "url": "https://github.com/pmd/pmd/pull/2481#discussion_r426187947", "bodyText": "You're right", "author": "KroArtem", "createdAt": "2020-05-16T20:24:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzNTk3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "ad68cdda24038bfce80c50f327587eb98724343b", "chunk": "diff --git a/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/errorprone/JUnitSpellingRule.java b/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/errorprone/JUnitSpellingRule.java\nindex de5399c7e7..573b5a1c6d 100644\n--- a/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/errorprone/JUnitSpellingRule.java\n+++ b/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/errorprone/JUnitSpellingRule.java\n\n@@ -5,7 +5,6 @@\n \n package net.sourceforge.pmd.lang.java.rule.errorprone;\n \n-import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;\n import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;\n import net.sourceforge.pmd.lang.java.rule.AbstractJUnitRule;\n \n"}}, {"oid": "ad68cdda24038bfce80c50f327587eb98724343b", "url": "https://github.com/pmd/pmd/commit/ad68cdda24038bfce80c50f327587eb98724343b", "message": "Fix review remarks", "committedDate": "2020-05-16T20:26:24Z", "type": "commit"}]}