{"pr_number": 2281, "pr_title": "[java] Implement AST-based symbols", "pr_createdAt": "2020-02-12T21:24:22Z", "pr_url": "https://github.com/pmd/pmd/pull/2281", "timeline": [{"oid": "9d17bb59d5cccc365d95c870bef0789db79ebf37", "url": "https://github.com/pmd/pmd/commit/9d17bb59d5cccc365d95c870bef0789db79ebf37", "message": "Checkout AST symbols", "committedDate": "2020-02-12T17:00:42Z", "type": "commit"}, {"oid": "16b8be05db7a2cd41efd53b3db413fe99c5cedc9", "url": "https://github.com/pmd/pmd/commit/16b8be05db7a2cd41efd53b3db413fe99c5cedc9", "message": "Checkout ast sym tables", "committedDate": "2020-02-12T17:01:22Z", "type": "commit"}, {"oid": "e9ccaa682178ada7ab122bb5a39d7a726cd3800f", "url": "https://github.com/pmd/pmd/commit/e9ccaa682178ada7ab122bb5a39d7a726cd3800f", "message": "Add tests", "committedDate": "2020-02-12T17:01:24Z", "type": "commit"}, {"oid": "65263b3285ac8a3ac1fc920f7379170c83db8ea7", "url": "https://github.com/pmd/pmd/commit/65263b3285ac8a3ac1fc920f7379170c83db8ea7", "message": "Test type params scoping", "committedDate": "2020-02-12T17:01:24Z", "type": "commit"}, {"oid": "de9daf43605546b296bc72b3e3caab5d7d4b54f9", "url": "https://github.com/pmd/pmd/commit/de9daf43605546b296bc72b3e3caab5d7d4b54f9", "message": "Make decent toStrings", "committedDate": "2020-02-12T17:01:24Z", "type": "commit"}, {"oid": "c53aed240c7e541d6de9b00ba550301372c5e0c1", "url": "https://github.com/pmd/pmd/commit/c53aed240c7e541d6de9b00ba550301372c5e0c1", "message": "Fix scoping in modifier lists", "committedDate": "2020-02-12T17:01:24Z", "type": "commit"}, {"oid": "65329d60bd5accbeca26359a3c601b0150ca2f5a", "url": "https://github.com/pmd/pmd/commit/65329d60bd5accbeca26359a3c601b0150ca2f5a", "message": "Fix scope of for statements", "committedDate": "2020-02-12T17:01:24Z", "type": "commit"}, {"oid": "a451a4aae807a2abbbf22cb2a4089533058bc275", "url": "https://github.com/pmd/pmd/commit/a451a4aae807a2abbbf22cb2a4089533058bc275", "message": "Simplify some things", "committedDate": "2020-02-12T17:01:55Z", "type": "commit"}, {"oid": "dd6c63984396d55ad925e31ea5fb6deb82e5d01e", "url": "https://github.com/pmd/pmd/commit/dd6c63984396d55ad925e31ea5fb6deb82e5d01e", "message": "Handle synthetic symbols more generally", "committedDate": "2020-02-12T17:01:56Z", "type": "commit"}, {"oid": "2b1d3a9ee7a2589e42eeb18cf67767d6892ba6b6", "url": "https://github.com/pmd/pmd/commit/2b1d3a9ee7a2589e42eeb18cf67767d6892ba6b6", "message": "Checkstyle", "committedDate": "2020-02-12T17:01:56Z", "type": "commit"}, {"oid": "87afc7360cb3fdeda29d5573914abc5e3aa0b81a", "url": "https://github.com/pmd/pmd/commit/87afc7360cb3fdeda29d5573914abc5e3aa0b81a", "message": "Add tests for ast symbols", "committedDate": "2020-02-12T17:01:56Z", "type": "commit"}, {"oid": "f1404ce062620f0253cf163345e630f76163ea61", "url": "https://github.com/pmd/pmd/commit/f1404ce062620f0253cf163345e630f76163ea61", "message": "Reactivate old symtable", "committedDate": "2020-02-12T17:01:56Z", "type": "commit"}, {"oid": "9c6f5a2e3a9c7d7b3ad3793a4d2326646c0b8ddd", "url": "https://github.com/pmd/pmd/commit/9c6f5a2e3a9c7d7b3ad3793a4d2326646c0b8ddd", "message": "Checkstyle", "committedDate": "2020-02-12T17:01:56Z", "type": "commit"}, {"oid": "f1154c7493c7c335f86381b2a99b1a9b79aeea25", "url": "https://github.com/pmd/pmd/commit/f1154c7493c7c335f86381b2a99b1a9b79aeea25", "message": "REVERT ME: Remove local sym tables", "committedDate": "2020-02-12T20:46:26Z", "type": "commit"}, {"oid": "094ba5f447779eb606358f476ce4df10ad3b8abb", "url": "https://github.com/pmd/pmd/commit/094ba5f447779eb606358f476ce4df10ad3b8abb", "message": "Cleanup toString", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "7a4efa268d1d88ca3d2db3884ff3456b7db0f1e8", "url": "https://github.com/pmd/pmd/commit/7a4efa268d1d88ca3d2db3884ff3456b7db0f1e8", "message": "Add sym visitor", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "9719637b88ff6a65ca3b906826256454593b0700", "url": "https://github.com/pmd/pmd/commit/9719637b88ff6a65ca3b906826256454593b0700", "message": "Fix build", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "19d8e2fc6943e6fc7b224724fbcd998d4a969c37", "url": "https://github.com/pmd/pmd/commit/19d8e2fc6943e6fc7b224724fbcd998d4a969c37", "message": "REVERT ME remove dependency on #2271", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "9e6da0006909f5a099b95f7a492c2bdb49d6f342", "url": "https://github.com/pmd/pmd/commit/9e6da0006909f5a099b95f7a492c2bdb49d6f342", "message": "Make base class for symbol declarators", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "33afd7e0de4f0e68c6f71b0b2a749332c43b34b6", "url": "https://github.com/pmd/pmd/commit/33afd7e0de4f0e68c6f71b0b2a749332c43b34b6", "message": "Simplify factory logic", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "4c81633a884fbff66a20490f63776501a3cfff46", "url": "https://github.com/pmd/pmd/commit/4c81633a884fbff66a20490f63776501a3cfff46", "message": "Add a bunch of additional tests", "committedDate": "2020-02-12T20:46:30Z", "type": "commit"}, {"oid": "35193446c471523b3654e3304897c33f0d78405c", "url": "https://github.com/pmd/pmd/commit/35193446c471523b3654e3304897c33f0d78405c", "message": "Fix tests", "committedDate": "2020-02-12T21:20:58Z", "type": "commit"}, {"oid": "a39819a473b6938d32a42a5f082323f2081c57a3", "url": "https://github.com/pmd/pmd/commit/a39819a473b6938d32a42a5f082323f2081c57a3", "message": "Merge branch 'java-grammar' into sym-ast-impl3", "committedDate": "2020-02-17T22:39:25Z", "type": "commit"}, {"oid": "3a7e2766f8983cbaf2e4d39a55756908d0c8e21f", "url": "https://github.com/pmd/pmd/commit/3a7e2766f8983cbaf2e4d39a55756908d0c8e21f", "message": "Revert \"REVERT ME remove dependency on #2271\"\n\nThis reverts commit 19d8e2fc6943e6fc7b224724fbcd998d4a969c37.", "committedDate": "2020-02-17T22:40:04Z", "type": "commit"}, {"oid": "184b368c8249ae7556002b3d4977be1ac9c95bb6", "url": "https://github.com/pmd/pmd/commit/184b368c8249ae7556002b3d4977be1ac9c95bb6", "message": "Merge branch 'java-grammar' into sym-ast-impl3", "committedDate": "2020-02-19T13:53:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg1ODQzNQ==", "url": "https://github.com/pmd/pmd/pull/2281#discussion_r381858435", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns the canonical name of this class, it it exists.\n          \n          \n            \n                 * Returns the canonical name of this class, if it exists.", "author": "adangel", "createdAt": "2020-02-20T08:52:33Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTAnyTypeDeclaration.java", "diffHunk": "@@ -49,9 +55,57 @@ default String getSimpleName() {\n      * Returns the binary name of this type declaration. This\n      * is like {@link Class#getName()}.\n      */\n-    // @NotNull\n+    @NonNull\n     String getBinaryName();\n \n+\n+    /**\n+     * Returns the canonical name of this class, it it exists.", "originalCommit": "184b368c8249ae7556002b3d4977be1ac9c95bb6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e2734cdacc3a1af1b826c688c247dfd47f42e3f4", "chunk": "diff --git a/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTAnyTypeDeclaration.java b/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTAnyTypeDeclaration.java\nindex 5f148bcec7..ff1bc65588 100644\n--- a/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTAnyTypeDeclaration.java\n+++ b/pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTAnyTypeDeclaration.java\n\n@@ -60,7 +60,7 @@ public interface ASTAnyTypeDeclaration\n \n \n     /**\n-     * Returns the canonical name of this class, it it exists.\n+     * Returns the canonical name of this class, if it exists.\n      * Otherwise returns null. This is like {@link Class#getCanonicalName()}.\n      *\n      * <p>A canonical name exists if all enclosing types have a\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2MzczOQ==", "url": "https://github.com/pmd/pmd/pull/2281#discussion_r381863739", "bodyText": "This is a bit surprising in comparison the formal parameters - in ASTFormalParameter, the owner node is the direct parent and not the grand parent. Maybe something to consider later?\nASTFormalParameter::getOwnerList() vs. ASTTypeParameter::getOwner() ...", "author": "adangel", "createdAt": "2020-02-20T09:02:29Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTTypeParameter.java", "diffHunk": "@@ -62,6 +64,13 @@ public ASTType getTypeBoundNode() {\n         return getFirstChildOfType(ASTType.class);\n     }\n \n+    /**\n+     * Returns the node to which this type parameter belongs.\n+     */\n+    public TypeParamOwnerNode getOwner() {\n+        return (TypeParamOwnerNode) jjtGetParent().jjtGetParent();", "originalCommit": "184b368c8249ae7556002b3d4977be1ac9c95bb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Mjk5MQ==", "url": "https://github.com/pmd/pmd/pull/2281#discussion_r382582991", "bodyText": "That's true, I'll add a TODO on the wiki to review that", "author": "oowekyala", "createdAt": "2020-02-21T13:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2MzczOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2OTY4Mg==", "url": "https://github.com/pmd/pmd/pull/2281#discussion_r381869682", "bodyText": "So this will become what previously was called \"SymbolTableFacade\"? \ud83d\udc4d", "author": "adangel", "createdAt": "2020-02-20T09:13:41Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/qname/QualifiedNameResolver.java", "diffHunk": "@@ -18,20 +20,30 @@\n import net.sourceforge.pmd.lang.java.ast.ASTAnyTypeDeclaration;\n import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;\n import net.sourceforge.pmd.lang.java.ast.ASTConstructorDeclaration;\n+import net.sourceforge.pmd.lang.java.ast.ASTFormalParameter;\n import net.sourceforge.pmd.lang.java.ast.ASTFormalParameters;\n import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;\n+import net.sourceforge.pmd.lang.java.ast.ASTMethodOrConstructorDeclaration;\n import net.sourceforge.pmd.lang.java.ast.ASTPackageDeclaration;\n+import net.sourceforge.pmd.lang.java.ast.ASTVariableDeclaratorId;\n import net.sourceforge.pmd.lang.java.ast.InternalApiBridge;\n import net.sourceforge.pmd.lang.java.ast.JavaParserVisitorAdapter;\n import net.sourceforge.pmd.lang.java.ast.JavaQualifiableNode;\n import net.sourceforge.pmd.lang.java.ast.internal.PrettyPrintingUtil;\n import net.sourceforge.pmd.lang.java.qname.ImmutableList.ListFactory;\n-import net.sourceforge.pmd.lang.java.typeresolution.PMDASMClassLoader;\n+import net.sourceforge.pmd.lang.java.symbols.JClassSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JExecutableSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JTypeParameterOwnerSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.internal.impl.ast.AstSymFactory;\n \n \n /**\n  * Populates {@link JavaQualifiableNode} instances with their qualified names.\n  *\n+ * <p>In fact, populates symbols on declaration nodes.\n+ * TODO in the near future we'll get rid of qualified names, and can\n+ * reuse this class just to build symbols (moving it to symbols.impl.ast).", "originalCommit": "184b368c8249ae7556002b3d4977be1ac9c95bb6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3MzAzMA==", "url": "https://github.com/pmd/pmd/pull/2281#discussion_r381873030", "bodyText": "This looks like another API PMD provides now... we'll definitively need good documentations and usage examples...", "author": "adangel", "createdAt": "2020-02-20T09:19:45Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/symbols/SymbolVisitor.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n+ */\n+\n+package net.sourceforge.pmd.lang.java.symbols;\n+\n+/**\n+ * Visitor over symbols.\n+ */\n+public interface SymbolVisitor<R, P> {", "originalCommit": "184b368c8249ae7556002b3d4977be1ac9c95bb6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzcxNg==", "url": "https://github.com/pmd/pmd/pull/2281#discussion_r381877716", "bodyText": "I'm wondering, whether we really want to have both internal and impl - what's the difference? Looks to me the same...", "author": "adangel", "createdAt": "2020-02-20T09:27:52Z", "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/symbols/internal/impl/ast/AbstractAstBackedSymbol.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n+ */\n+\n+package net.sourceforge.pmd.lang.java.symbols.internal.impl.ast;", "originalCommit": "184b368c8249ae7556002b3d4977be1ac9c95bb6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "e2734cdacc3a1af1b826c688c247dfd47f42e3f4", "url": "https://github.com/pmd/pmd/commit/e2734cdacc3a1af1b826c688c247dfd47f42e3f4", "message": "Update pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/ASTAnyTypeDeclaration.java", "committedDate": "2020-02-20T09:36:39Z", "type": "commit"}]}