{"pr_number": 2807, "pr_title": "[core] Pmd7 test cleanups", "pr_createdAt": "2020-09-28T18:55:29Z", "pr_url": "https://github.com/pmd/pmd/pull/2807", "timeline": [{"oid": "d25c66137b43d2f956f94789547917298310b57e", "url": "https://github.com/pmd/pmd/commit/d25c66137b43d2f956f94789547917298310b57e", "message": "Extract some test cleanups", "committedDate": "2020-09-28T16:58:32Z", "type": "commit"}, {"oid": "05602452981517fc2ebdc02e7a0875535763606c", "url": "https://github.com/pmd/pmd/commit/05602452981517fc2ebdc02e7a0875535763606c", "message": "Refactor DefaultRVFactory", "committedDate": "2020-09-28T17:32:54Z", "type": "commit"}, {"oid": "5c59de5d5277b23abb763f821de1e6b1f9d9a67a", "url": "https://github.com/pmd/pmd/commit/5c59de5d5277b23abb763f821de1e6b1f9d9a67a", "message": "Checkout changes to test utils", "committedDate": "2020-09-28T17:46:34Z", "type": "commit"}, {"oid": "8f4c48c00a3a614a8f9a5a5bb8546c47b9f1a706", "url": "https://github.com/pmd/pmd/commit/8f4c48c00a3a614a8f9a5a5bb8546c47b9f1a706", "message": "Require non null suppress marker", "committedDate": "2020-09-28T17:49:33Z", "type": "commit"}, {"oid": "020fa899d515697f6383d1d53d399beda5352015", "url": "https://github.com/pmd/pmd/commit/020fa899d515697f6383d1d53d399beda5352015", "message": "Fix tests", "committedDate": "2020-09-28T18:12:04Z", "type": "commit"}, {"oid": "5c047b0e3e55999ea9aab0b4317cc1c976a93d60", "url": "https://github.com/pmd/pmd/commit/5c047b0e3e55999ea9aab0b4317cc1c976a93d60", "message": "Fix java tests", "committedDate": "2020-09-28T18:20:32Z", "type": "commit"}, {"oid": "f3d2591a80a4b642eaf5b364eacc6356b82bf21b", "url": "https://github.com/pmd/pmd/commit/f3d2591a80a4b642eaf5b364eacc6356b82bf21b", "message": "Checkstyle", "committedDate": "2020-09-28T18:37:30Z", "type": "commit"}, {"oid": "64e8dc66bcab38ae3cb852b57ba422988a1fb5bc", "url": "https://github.com/pmd/pmd/commit/64e8dc66bcab38ae3cb852b57ba422988a1fb5bc", "message": "Be more defensive", "committedDate": "2020-09-28T18:40:05Z", "type": "commit"}, {"oid": "afb3a9e387959d059af8cd52fe1d966922d30082", "url": "https://github.com/pmd/pmd/commit/afb3a9e387959d059af8cd52fe1d966922d30082", "message": "Fix js tests", "committedDate": "2020-09-28T19:05:29Z", "type": "commit"}, {"oid": "1089da7da2ea38e8551f70bfda9bc267b4fd5dbc", "url": "https://github.com/pmd/pmd/commit/1089da7da2ea38e8551f70bfda9bc267b4fd5dbc", "message": "Hide most methods of RuleTst\n\nThe supported API is now just the junit integration", "committedDate": "2020-09-30T11:21:02Z", "type": "commit"}, {"oid": "36d6896221a3caa70da0bbabe2ef96f267ece519", "url": "https://github.com/pmd/pmd/commit/36d6896221a3caa70da0bbabe2ef96f267ece519", "message": "Merge branch '7.0.x' into pmd7-test-cleanups", "committedDate": "2020-10-17T14:28:39Z", "type": "commit"}, {"oid": "649ad9975519da276a33840a29ce446f7dc46483", "url": "https://github.com/pmd/pmd/commit/649ad9975519da276a33840a29ce446f7dc46483", "message": "Remove some changes to RuleTst", "committedDate": "2020-10-17T14:37:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE1MTMwNg==", "url": "https://github.com/pmd/pmd/pull/2807#discussion_r510151306", "bodyText": "Deprecated or DeprecatedUntil700?\nIf deprecated, we need to merge this back to master -> API change...", "author": "adangel", "createdAt": "2020-10-22T13:14:58Z", "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/rule/ParametricRuleViolation.java", "diffHunk": "@@ -34,26 +35,39 @@\n     // RuleViolationFactory to support identifying without a Node, and update\n     // Rule base classes too.\n     // TODO we never need a node. We just have to have a \"position\", ie line/column, or offset, + file, whatever\n+\n+    /**\n+     * @deprecated Use {@link #ParametricRuleViolation(Rule, String, Node, String)}\n+     */\n+    @Deprecated", "originalCommit": "649ad9975519da276a33840a29ce446f7dc46483", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE1NDMzNQ==", "url": "https://github.com/pmd/pmd/pull/2807#discussion_r510154335", "bodyText": "I think, we don't need a null check here anymore, do we?", "author": "adangel", "createdAt": "2020-10-22T13:19:09Z", "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ParserOptions.java", "diffHunk": "@@ -30,11 +37,11 @@ public boolean equals(Object obj) {\n             return false;\n         }\n         final ParserOptions that = (ParserOptions) obj;\n-        return this.suppressMarker.equals(that.suppressMarker);\n+        return this.getSuppressMarker().equals(that.getSuppressMarker());\n     }\n \n     @Override\n     public int hashCode() {\n-        return suppressMarker != null ? suppressMarker.hashCode() : 0;\n+        return getSuppressMarker() != null ? getSuppressMarker().hashCode() : 0;", "originalCommit": "649ad9975519da276a33840a29ce446f7dc46483", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE1NjQ4NA==", "url": "https://github.com/pmd/pmd/pull/2807#discussion_r510156484", "bodyText": "ruleContext.getSourceCodeFilename() only returns the simple name. We need to use here String.valueOf(ruleContext.getSourceCodeFile()). I'll fix that on pmd/7.0.x and add a unit test (hopefully not forgetting that there is also windows...)", "author": "adangel", "createdAt": "2020-10-22T13:21:59Z", "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/rule/RuleViolationFactory.java", "diffHunk": "@@ -34,8 +44,43 @@\n      * @param args\n      *            arguments to embed in the rule violation message\n      */\n-    void addViolation(RuleContext ruleContext, Rule rule, @Nullable Node node, String message, Object[] args);\n+    @Deprecated\n+    default void addViolation(RuleContext ruleContext, Rule rule, @NonNull Node node, @NonNull String message, Object[] args) {\n+        addViolation(ruleContext, rule, node, message, node.getBeginLine(), node.getEndLine(), args);\n+    }\n+\n+\n+    @Deprecated\n+    default void addViolation(RuleContext ruleContext, Rule rule, @NonNull Node node, @NonNull String message, int beginLine, int endLine, @NonNull Object[] args) {\n+        Objects.requireNonNull(node);\n+        Objects.requireNonNull(message);\n+        Objects.requireNonNull(args);\n+        RuleViolation rv = formatViolation(rule, node, ruleContext.getSourceCodeFilename(), message, args);", "originalCommit": "649ad9975519da276a33840a29ce446f7dc46483", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE1NzQ2NQ==", "url": "https://github.com/pmd/pmd/pull/2807#discussion_r510157465", "bodyText": "Probably DeprecatedUntil700 as well?", "author": "adangel", "createdAt": "2020-10-22T13:23:23Z", "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/rule/RuleViolationFactory.java", "diffHunk": "@@ -34,8 +44,43 @@\n      * @param args\n      *            arguments to embed in the rule violation message\n      */\n-    void addViolation(RuleContext ruleContext, Rule rule, @Nullable Node node, String message, Object[] args);\n+    @Deprecated", "originalCommit": "649ad9975519da276a33840a29ce446f7dc46483", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE2ODQ4OQ==", "url": "https://github.com/pmd/pmd/pull/2807#discussion_r510168489", "bodyText": "I think, we should deprecate this field on master...", "author": "adangel", "createdAt": "2020-10-22T13:38:19Z", "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ParserOptions.java", "diffHunk": "@@ -4,20 +4,27 @@\n \n package net.sourceforge.pmd.lang;\n \n+import java.util.Objects;\n+\n+import org.checkerframework.checker.nullness.qual.NonNull;\n+\n+import net.sourceforge.pmd.PMD;\n+\n /**\n  * Represents a set of configuration options for a {@link Parser}. For each\n  * unique combination of ParserOptions a Parser will be used to create an AST.\n  * Therefore, implementations must implement {@link Object#equals(Object)} and\n  * {@link Object#hashCode()}.\n  */\n public class ParserOptions {\n-    protected String suppressMarker;\n+    private String suppressMarker = PMD.SUPPRESS_MARKER;", "originalCommit": "649ad9975519da276a33840a29ce446f7dc46483", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}