{"pr_number": 4717, "pr_title": "Locale resolver", "pr_createdAt": "2020-12-15T16:42:45Z", "pr_url": "https://github.com/micronaut-projects/micronaut-core/pull/4717", "timeline": [{"oid": "f2d9800455efdc2e90b9b04f6d8637bcd06febac", "url": "https://github.com/micronaut-projects/micronaut-core/commit/f2d9800455efdc2e90b9b04f6d8637bcd06febac", "message": "Initial cut of locale resolution", "committedDate": "2020-12-11T21:09:49Z", "type": "commit"}, {"oid": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "url": "https://github.com/micronaut-projects/micronaut-core/commit/8e55e13b7a060d5359b00efed96fce1666e4bcdd", "message": "Checkstyle. Make interface generic. Docs", "committedDate": "2020-12-15T16:41:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxMDE1MQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543510151", "bodyText": "Needs javadoc and @NonNull or @Nullable on return type", "author": "graemerocher", "createdAt": "2020-12-15T16:47:55Z", "path": "core/src/main/java/io/micronaut/core/util/LocaleResolver.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.core.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.core.order.Ordered;\n+\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+/**\n+ * Responsible for determining the current locale given a context.\n+ *\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n+public interface LocaleResolver<T> extends Ordered {\n+\n+    /**\n+     * Resolves the locale for the given context.\n+     *\n+     * @param context The context to retrieve the locale from\n+     * @return The locale\n+     */\n+    Optional<Locale> resolve(@NonNull T context);\n+\n+    Locale resolveOrDefault(@NonNull T context);", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/core/src/main/java/io/micronaut/core/util/LocaleResolver.java b/core/src/main/java/io/micronaut/core/util/LocaleResolver.java\nindex 637709793..c518ff5e4 100644\n--- a/core/src/main/java/io/micronaut/core/util/LocaleResolver.java\n+++ b/core/src/main/java/io/micronaut/core/util/LocaleResolver.java\n\n@@ -26,6 +26,7 @@ import java.util.Optional;\n  *\n  * @author James Kleeh\n  * @since 2.3.0\n+ * @param <T> The context object which will be used to resolve the locale\n  */\n public interface LocaleResolver<T> extends Ordered {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxMTIzNg==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543511236", "bodyText": "Missing javadoc. Should this be public? Does it need to be an additional bean? Can it be registered programmatically in DefaultRequestBinderRegistry", "author": "graemerocher", "createdAt": "2020-12-15T16:49:23Z", "path": "http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.binding;\n+\n+import io.micronaut.core.convert.ArgumentConversionContext;\n+import io.micronaut.core.type.Argument;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.bind.binders.TypedRequestArgumentBinder;\n+import io.micronaut.http.server.util.HttpLocaleResolver;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+public class LocaleArgumentBinder implements TypedRequestArgumentBinder<Locale> {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxODgxNw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r546018817", "bodyText": "@jameskleeh what about this part of the comment:\n\nShould this be public? Does it need to be an additional bean? Can it be registered programmatically in DefaultRequestBinderRegistry", "author": "sdelamo", "createdAt": "2020-12-18T18:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxMTIzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyNzU3Mw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r546027573", "bodyText": "It should be an additional bean so we don't need to tie the dependency on locale resolver to the binder registry", "author": "jameskleeh", "createdAt": "2020-12-18T18:55:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxMTIzNg=="}], "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java b/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java\nindex 238f3472e..3d0d21389 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java\n\n@@ -19,7 +19,7 @@ import io.micronaut.core.convert.ArgumentConversionContext;\n import io.micronaut.core.type.Argument;\n import io.micronaut.http.HttpRequest;\n import io.micronaut.http.bind.binders.TypedRequestArgumentBinder;\n-import io.micronaut.http.server.util.HttpLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpLocaleResolver;\n \n import javax.inject.Singleton;\n import java.util.Locale;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxMTM4NA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543511384", "bodyText": "Missing javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:49:33Z", "path": "http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.binding;\n+\n+import io.micronaut.core.convert.ArgumentConversionContext;\n+import io.micronaut.core.type.Argument;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.bind.binders.TypedRequestArgumentBinder;\n+import io.micronaut.http.server.util.HttpLocaleResolver;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+public class LocaleArgumentBinder implements TypedRequestArgumentBinder<Locale> {\n+\n+    private final HttpLocaleResolver localeResolver;\n+\n+    public LocaleArgumentBinder(HttpLocaleResolver localeResolver) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java b/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java\nindex 238f3472e..3d0d21389 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/binding/LocaleArgumentBinder.java\n\n@@ -19,7 +19,7 @@ import io.micronaut.core.convert.ArgumentConversionContext;\n import io.micronaut.core.type.Argument;\n import io.micronaut.http.HttpRequest;\n import io.micronaut.http.bind.binders.TypedRequestArgumentBinder;\n-import io.micronaut.http.server.util.HttpLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpLocaleResolver;\n \n import javax.inject.Singleton;\n import java.util.Locale;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxMzg5OQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543513899", "bodyText": "Should be annotated with @Indexed(HttpLocalResolver.class) since there can be multiple", "author": "graemerocher", "createdAt": "2020-12-15T16:52:28Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/HttpLocaleResolver.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import io.micronaut.core.util.LocaleResolver;\n+import io.micronaut.http.HttpRequest;\n+\n+/**\n+ * Responsible for determining the current locale from a request.\n+ *\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n+public interface HttpLocaleResolver extends LocaleResolver<HttpRequest<?>> {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/HttpLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/HttpLocaleResolver.java\nsimilarity index 86%\nrename from http-server/src/main/java/io/micronaut/http/server/util/HttpLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/HttpLocaleResolver.java\nindex a9a0bebbf..ac8384263 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/HttpLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/HttpLocaleResolver.java\n\n@@ -13,8 +13,9 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n+import io.micronaut.core.annotation.Indexed;\n import io.micronaut.core.util.LocaleResolver;\n import io.micronaut.http.HttpRequest;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxNjIwMw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543516203", "bodyText": "javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:55:23Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.core.util.StringUtils;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".header\", notEquals = StringUtils.FALSE)\n+public class RequestLocaleResolver implements HttpLocaleResolver {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/RequestLocaleResolver.java\nsimilarity index 59%\nrename from http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/RequestLocaleResolver.java\nindex 677bacfef..315e066b3 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/RequestLocaleResolver.java\n\n@@ -13,7 +13,7 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxNjI2Mg==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543516262", "bodyText": "javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:55:28Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.core.util.StringUtils;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".header\", notEquals = StringUtils.FALSE)\n+public class RequestLocaleResolver implements HttpLocaleResolver {\n+\n+    public static final Integer ORDER = 100;\n+\n+    private final Locale defaultLocale;\n+\n+    public RequestLocaleResolver(HttpServerConfiguration serverConfiguration) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/RequestLocaleResolver.java\nsimilarity index 59%\nrename from http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/RequestLocaleResolver.java\nindex 677bacfef..315e066b3 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/RequestLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/RequestLocaleResolver.java\n\n@@ -13,7 +13,7 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxNjUyMg==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543516522", "bodyText": "javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:55:49Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".fixed\")\n+public class FixedLocaleResolver implements HttpLocaleResolver {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java\ndeleted file mode 100644\nindex e0245a28f..000000000\n--- a/http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java\n+++ /dev/null\n\n@@ -1,50 +0,0 @@\n-/*\n- * Copyright 2017-2020 original authors\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * https://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.micronaut.http.server.util;\n-\n-import edu.umd.cs.findbugs.annotations.NonNull;\n-import io.micronaut.context.annotation.Requires;\n-import io.micronaut.http.HttpRequest;\n-import io.micronaut.http.server.HttpServerConfiguration;\n-\n-import javax.inject.Singleton;\n-import java.util.Locale;\n-import java.util.Objects;\n-import java.util.Optional;\n-\n-@Singleton\n-@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".fixed\")\n-public class FixedLocaleResolver implements HttpLocaleResolver {\n-\n-    private final Locale locale;\n-\n-    public FixedLocaleResolver(HttpServerConfiguration serverConfiguration) {\n-        HttpServerConfiguration.LocaleResolutionConfiguration resolutionConfiguration = Objects.requireNonNull(serverConfiguration.getLocaleResolution());\n-\n-        this.locale = resolutionConfiguration.getFixed()\n-                .orElseThrow(() -> new IllegalArgumentException(\"The fixed locale must be set\"));\n-    }\n-\n-    @Override\n-    public Optional<Locale> resolve(@NonNull HttpRequest<?> request) {\n-        return Optional.of(locale);\n-    }\n-\n-    @Override\n-    public Locale resolveOrDefault(@NonNull HttpRequest<?> request) {\n-        return locale;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxNjU5OA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543516598", "bodyText": "javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:55:54Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".fixed\")\n+public class FixedLocaleResolver implements HttpLocaleResolver {\n+\n+    private final Locale locale;\n+\n+    public FixedLocaleResolver(HttpServerConfiguration serverConfiguration) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java\ndeleted file mode 100644\nindex e0245a28f..000000000\n--- a/http-server/src/main/java/io/micronaut/http/server/util/FixedLocaleResolver.java\n+++ /dev/null\n\n@@ -1,50 +0,0 @@\n-/*\n- * Copyright 2017-2020 original authors\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * https://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.micronaut.http.server.util;\n-\n-import edu.umd.cs.findbugs.annotations.NonNull;\n-import io.micronaut.context.annotation.Requires;\n-import io.micronaut.http.HttpRequest;\n-import io.micronaut.http.server.HttpServerConfiguration;\n-\n-import javax.inject.Singleton;\n-import java.util.Locale;\n-import java.util.Objects;\n-import java.util.Optional;\n-\n-@Singleton\n-@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".fixed\")\n-public class FixedLocaleResolver implements HttpLocaleResolver {\n-\n-    private final Locale locale;\n-\n-    public FixedLocaleResolver(HttpServerConfiguration serverConfiguration) {\n-        HttpServerConfiguration.LocaleResolutionConfiguration resolutionConfiguration = Objects.requireNonNull(serverConfiguration.getLocaleResolution());\n-\n-        this.locale = resolutionConfiguration.getFixed()\n-                .orElseThrow(() -> new IllegalArgumentException(\"The fixed locale must be set\"));\n-    }\n-\n-    @Override\n-    public Optional<Locale> resolve(@NonNull HttpRequest<?> request) {\n-        return Optional.of(locale);\n-    }\n-\n-    @Override\n-    public Locale resolveOrDefault(@NonNull HttpRequest<?> request) {\n-        return locale;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxNjY5OA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543516698", "bodyText": "javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:56:02Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".cookie-name\")\n+public class CookieLocaleResolver implements HttpLocaleResolver {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CookieLocaleResolver.java\nsimilarity index 56%\nrename from http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CookieLocaleResolver.java\nindex e56dd6b72..1645d89eb 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CookieLocaleResolver.java\n\n@@ -13,7 +13,7 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUxNjc4MQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r543516781", "bodyText": "javadoc", "author": "graemerocher", "createdAt": "2020-12-15T16:56:09Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".cookie-name\")\n+public class CookieLocaleResolver implements HttpLocaleResolver {\n+\n+    public static final Integer ORDER = RequestLocaleResolver.ORDER - 50;\n+\n+    private final String cookieName;\n+    private final Locale defaultLocale;\n+\n+    public CookieLocaleResolver(HttpServerConfiguration serverConfiguration) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CookieLocaleResolver.java\nsimilarity index 56%\nrename from http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CookieLocaleResolver.java\nindex e56dd6b72..1645d89eb 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/CookieLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CookieLocaleResolver.java\n\n@@ -13,7 +13,7 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM3ODAyNg==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544378026", "bodyText": "Add @NonNull", "author": "sdelamo", "createdAt": "2020-12-16T15:12:34Z", "path": "core/src/main/java/io/micronaut/core/util/LocaleResolver.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.core.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.core.order.Ordered;\n+\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+/**\n+ * Responsible for determining the current locale given a context.\n+ *\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n+public interface LocaleResolver<T> extends Ordered {\n+\n+    /**\n+     * Resolves the locale for the given context.\n+     *\n+     * @param context The context to retrieve the locale from\n+     * @return The locale\n+     */\n+    Optional<Locale> resolve(@NonNull T context);", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/core/src/main/java/io/micronaut/core/util/LocaleResolver.java b/core/src/main/java/io/micronaut/core/util/LocaleResolver.java\nindex 637709793..c518ff5e4 100644\n--- a/core/src/main/java/io/micronaut/core/util/LocaleResolver.java\n+++ b/core/src/main/java/io/micronaut/core/util/LocaleResolver.java\n\n@@ -26,6 +26,7 @@ import java.util.Optional;\n  *\n  * @author James Kleeh\n  * @since 2.3.0\n+ * @param <T> The context object which will be used to resolve the locale\n  */\n public interface LocaleResolver<T> extends Ordered {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM3OTg1NA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544379854", "bodyText": "I will add @NonNull to the return type.", "author": "sdelamo", "createdAt": "2020-12-16T15:14:48Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDE1MQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544380151", "bodyText": "I will annotate it with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:15:11Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMjM3NA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544812374", "bodyText": "I don't think thats necessary in a config props class", "author": "jameskleeh", "createdAt": "2020-12-17T04:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwOTc0NQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r546009745", "bodyText": "It is not necessary. But I think we should try to mark nullability with @NonNull and @Nullable as much as possible going forward. It helps us with IDE, it help us with Kotlin, it helps us preventing NPE.", "author": "sdelamo", "createdAt": "2020-12-18T18:22:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDE1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDI2MQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544380261", "bodyText": "I will annotate it with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:15:19Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMjQ1OA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544812458", "bodyText": "I don't think thats necessary in a config props class", "author": "jameskleeh", "createdAt": "2020-12-17T04:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDI2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDQxMQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544380411", "bodyText": "I will annotate it with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:15:29Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMjQ5OQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544812499", "bodyText": "I don't think thats necessary in a config props class", "author": "jameskleeh", "createdAt": "2020-12-17T04:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MDQxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MTEwNQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544381105", "bodyText": "I would annotate the parameter with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:16:24Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MTM4OQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544381389", "bodyText": "I would annotate the return type with @NonNull", "author": "sdelamo", "createdAt": "2020-12-16T15:16:46Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {\n+            this.fixed = fixed;\n+        }\n+\n+        /**\n+         * @return The key in the session that stores the locale\n+         */\n+        public Optional<String> getSessionAttribute() {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MTY1Mw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544381653", "bodyText": "I would annotate the parameter with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:17:03Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {\n+            this.fixed = fixed;\n+        }\n+\n+        /**\n+         * @return The key in the session that stores the locale\n+         */\n+        public Optional<String> getSessionAttribute() {\n+            return Optional.ofNullable(sessionAttribute);\n+        }\n+\n+        /**\n+         * Sets the key in the session to look for the locale.\n+         *\n+         * @param sessionAttribute The session attribute key\n+         */\n+        public void setSessionAttribute(String sessionAttribute) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MTgwMA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544381800", "bodyText": "I would annotate the return type with @NonNull", "author": "sdelamo", "createdAt": "2020-12-16T15:17:13Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {\n+            this.fixed = fixed;\n+        }\n+\n+        /**\n+         * @return The key in the session that stores the locale\n+         */\n+        public Optional<String> getSessionAttribute() {\n+            return Optional.ofNullable(sessionAttribute);\n+        }\n+\n+        /**\n+         * Sets the key in the session to look for the locale.\n+         *\n+         * @param sessionAttribute The session attribute key\n+         */\n+        public void setSessionAttribute(String sessionAttribute) {\n+            this.sessionAttribute = sessionAttribute;\n+        }\n+\n+        /**\n+         * @return The locale to be used if one cannot be resolved.\n+         */\n+        public Locale getDefaultLocale() {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MjEyMQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544382121", "bodyText": "I would annotate the parameter with @NonNull", "author": "sdelamo", "createdAt": "2020-12-16T15:17:34Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {\n+            this.fixed = fixed;\n+        }\n+\n+        /**\n+         * @return The key in the session that stores the locale\n+         */\n+        public Optional<String> getSessionAttribute() {\n+            return Optional.ofNullable(sessionAttribute);\n+        }\n+\n+        /**\n+         * Sets the key in the session to look for the locale.\n+         *\n+         * @param sessionAttribute The session attribute key\n+         */\n+        public void setSessionAttribute(String sessionAttribute) {\n+            this.sessionAttribute = sessionAttribute;\n+        }\n+\n+        /**\n+         * @return The locale to be used if one cannot be resolved.\n+         */\n+        public Locale getDefaultLocale() {\n+            return defaultLocale;\n+        }\n+\n+        /**\n+         * Sets the locale that will be used if the locale cannot be\n+         * resolved through any means. Defaults to the system default.\n+         *\n+         * @param defaultLocale The default locale.\n+         */\n+        public void setDefaultLocale(Locale defaultLocale) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MjIyMQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544382221", "bodyText": "I would annotate the return type with @NonNull", "author": "sdelamo", "createdAt": "2020-12-16T15:17:41Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {\n+            this.fixed = fixed;\n+        }\n+\n+        /**\n+         * @return The key in the session that stores the locale\n+         */\n+        public Optional<String> getSessionAttribute() {\n+            return Optional.ofNullable(sessionAttribute);\n+        }\n+\n+        /**\n+         * Sets the key in the session to look for the locale.\n+         *\n+         * @param sessionAttribute The session attribute key\n+         */\n+        public void setSessionAttribute(String sessionAttribute) {\n+            this.sessionAttribute = sessionAttribute;\n+        }\n+\n+        /**\n+         * @return The locale to be used if one cannot be resolved.\n+         */\n+        public Locale getDefaultLocale() {\n+            return defaultLocale;\n+        }\n+\n+        /**\n+         * Sets the locale that will be used if the locale cannot be\n+         * resolved through any means. Defaults to the system default.\n+         *\n+         * @param defaultLocale The default locale.\n+         */\n+        public void setDefaultLocale(Locale defaultLocale) {\n+            this.defaultLocale = defaultLocale;\n+        }\n+\n+        /**\n+         * @return The name of the cookie that contains the locale.\n+         */\n+        public Optional<String> getCookieName() {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MjQ1Mw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544382453", "bodyText": "I would annotate the parameter with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:17:59Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();\n+\n+        /**\n+         * @return The fixed locale\n+         */\n+        public Optional<Locale> getFixed() {\n+            return Optional.ofNullable(fixed);\n+        }\n+\n+        /**\n+         * Set the language tag for the locale. Supports BCP 47 language\n+         * tags (e.g. \"en-US\") and ISO standard (e.g \"en_US\").\n+         *\n+         * @param fixed The fixed locale\n+         */\n+        public void setFixed(Locale fixed) {\n+            this.fixed = fixed;\n+        }\n+\n+        /**\n+         * @return The key in the session that stores the locale\n+         */\n+        public Optional<String> getSessionAttribute() {\n+            return Optional.ofNullable(sessionAttribute);\n+        }\n+\n+        /**\n+         * Sets the key in the session to look for the locale.\n+         *\n+         * @param sessionAttribute The session attribute key\n+         */\n+        public void setSessionAttribute(String sessionAttribute) {\n+            this.sessionAttribute = sessionAttribute;\n+        }\n+\n+        /**\n+         * @return The locale to be used if one cannot be resolved.\n+         */\n+        public Locale getDefaultLocale() {\n+            return defaultLocale;\n+        }\n+\n+        /**\n+         * Sets the locale that will be used if the locale cannot be\n+         * resolved through any means. Defaults to the system default.\n+         *\n+         * @param defaultLocale The default locale.\n+         */\n+        public void setDefaultLocale(Locale defaultLocale) {\n+            this.defaultLocale = defaultLocale;\n+        }\n+\n+        /**\n+         * @return The name of the cookie that contains the locale.\n+         */\n+        public Optional<String> getCookieName() {\n+            return Optional.ofNullable(cookieName);\n+        }\n+\n+        /**\n+         * Sets the name of the cookie that is used to store the locale.\n+         *\n+         * @param cookieName The name of the cookie used to store the locale\n+         */\n+        public void setCookieName(String cookieName) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MjY1Mw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544382653", "bodyText": "I will annotate it with @NonNull", "author": "sdelamo", "createdAt": "2020-12-16T15:18:15Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -735,4 +752,103 @@ public void setPortInHost(boolean portInHost) {\n             this.portInHost = portInHost;\n         }\n     }\n+\n+    /**\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     */\n+    @ConfigurationProperties(\"locale-resolution\")\n+    public static class LocaleResolutionConfiguration {\n+\n+        public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n+        private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n+\n+        private Locale fixed;\n+        private String sessionAttribute;\n+        private String cookieName;\n+        private boolean header = DEFAULT_HEADER_RESOLUTION;\n+        private Locale defaultLocale = Locale.getDefault();", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -754,10 +755,10 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     }\n \n     /**\n-     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.HttpLocaleResolver}.\n+     * Configuration for locale resolution used by {@link io.micronaut.http.server.util.localeresolution.HttpLocaleResolver}.\n      */\n     @ConfigurationProperties(\"locale-resolution\")\n-    public static class LocaleResolutionConfiguration {\n+    public static class HttpLocaleResolutionConfigurationProperties implements HttpLocaleResolutionConfiguration {\n \n         public static final String PREFIX = HttpServerConfiguration.PREFIX + \".locale-resolution\";\n         private static final boolean DEFAULT_HEADER_RESOLUTION = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MzAzOQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544383039", "bodyText": "I would annotate the parameter with @Nullable", "author": "sdelamo", "createdAt": "2020-12-16T15:18:41Z", "path": "http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java", "diffHunk": "@@ -433,6 +443,13 @@ public void setHostResolution(HostResolutionConfiguration hostResolution) {\n         this.hostResolution = hostResolution;\n     }\n \n+    /**\n+     * @param localeResolution The locale resolution configuration\n+     */\n+    public void setLocaleResolution(LocaleResolutionConfiguration localeResolution) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\nindex 529c3ca4f..aa00384af 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/HttpServerConfiguration.java\n\n@@ -446,7 +447,7 @@ public class HttpServerConfiguration implements ServerContextPathProvider {\n     /**\n      * @param localeResolution The locale resolution configuration\n      */\n-    public void setLocaleResolution(LocaleResolutionConfiguration localeResolution) {\n+    public void setLocaleResolution(HttpLocaleResolutionConfigurationProperties localeResolution) {\n         this.localeResolution = localeResolution;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4MzgxOQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544383819", "bodyText": "Missing Java doc", "author": "sdelamo", "createdAt": "2020-12-16T15:19:38Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Primary;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Arrays;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Primary\n+public class CompositeHttpLocaleResolver implements HttpLocaleResolver {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nsimilarity index 66%\nrename from http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nindex ea871c168..11bd42087 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\n\n@@ -13,31 +13,38 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Primary;\n import io.micronaut.http.HttpRequest;\n-import io.micronaut.http.server.HttpServerConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Arrays;\n import java.util.Locale;\n import java.util.Optional;\n \n+/**\n+ * {@link Primary} {@link HttpLocaleResolver} which evaluates every {@link HttpLocaleResolver} by order to resolve a {@link java.util.Locale}.\n+ *\n+ * @author Sergio del Amo\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n @Singleton\n @Primary\n-public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+public class CompositeHttpLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final HttpLocaleResolver[] localeResolvers;\n-    private final Locale defaultLocale;\n \n+    /**\n+     * @param localeResolvers HTTP Locale Resolvers\n+     * @param httpLocaleResolutionConfiguration Locale Resolution configuration for HTTP Requests\n+     */\n     public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,\n-                                       HttpServerConfiguration serverConfiguration) {\n+                                       HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n         this.localeResolvers = localeResolvers;\n-        this.defaultLocale = Optional.ofNullable(serverConfiguration.getLocaleResolution())\n-                .map(HttpServerConfiguration.LocaleResolutionConfiguration::getDefaultLocale)\n-                .orElse(Locale.getDefault());\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4Mzk1MQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544383951", "bodyText": "Missing javadoc", "author": "sdelamo", "createdAt": "2020-12-16T15:19:46Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Primary;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Arrays;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Primary\n+public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+\n+    private final HttpLocaleResolver[] localeResolvers;\n+    private final Locale defaultLocale;\n+\n+    public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nsimilarity index 66%\nrename from http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nindex ea871c168..11bd42087 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\n\n@@ -13,31 +13,38 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Primary;\n import io.micronaut.http.HttpRequest;\n-import io.micronaut.http.server.HttpServerConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Arrays;\n import java.util.Locale;\n import java.util.Optional;\n \n+/**\n+ * {@link Primary} {@link HttpLocaleResolver} which evaluates every {@link HttpLocaleResolver} by order to resolve a {@link java.util.Locale}.\n+ *\n+ * @author Sergio del Amo\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n @Singleton\n @Primary\n-public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+public class CompositeHttpLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final HttpLocaleResolver[] localeResolvers;\n-    private final Locale defaultLocale;\n \n+    /**\n+     * @param localeResolvers HTTP Locale Resolvers\n+     * @param httpLocaleResolutionConfiguration Locale Resolution configuration for HTTP Requests\n+     */\n     public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,\n-                                       HttpServerConfiguration serverConfiguration) {\n+                                       HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n         this.localeResolvers = localeResolvers;\n-        this.defaultLocale = Optional.ofNullable(serverConfiguration.getLocaleResolution())\n-                .map(HttpServerConfiguration.LocaleResolutionConfiguration::getDefaultLocale)\n-                .orElse(Locale.getDefault());\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDQ1Ng==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544810456", "bodyText": "I think we have to order the localeResolvers with OrderUtil.sort(localeResolvers); before assigning them.", "author": "sdelamo", "createdAt": "2020-12-17T04:51:04Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Primary;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Arrays;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Primary\n+public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+\n+    private final HttpLocaleResolver[] localeResolvers;\n+    private final Locale defaultLocale;\n+\n+    public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,\n+                                       HttpServerConfiguration serverConfiguration) {\n+        this.localeResolvers = localeResolvers;", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMTc5Nw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544811797", "bodyText": "That is not true. Ordered beans are sorted before injection", "author": "jameskleeh", "createdAt": "2020-12-17T04:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDQ1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nsimilarity index 66%\nrename from http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nindex ea871c168..11bd42087 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\n\n@@ -13,31 +13,38 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Primary;\n import io.micronaut.http.HttpRequest;\n-import io.micronaut.http.server.HttpServerConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Arrays;\n import java.util.Locale;\n import java.util.Optional;\n \n+/**\n+ * {@link Primary} {@link HttpLocaleResolver} which evaluates every {@link HttpLocaleResolver} by order to resolve a {@link java.util.Locale}.\n+ *\n+ * @author Sergio del Amo\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n @Singleton\n @Primary\n-public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+public class CompositeHttpLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final HttpLocaleResolver[] localeResolvers;\n-    private final Locale defaultLocale;\n \n+    /**\n+     * @param localeResolvers HTTP Locale Resolvers\n+     * @param httpLocaleResolutionConfiguration Locale Resolution configuration for HTTP Requests\n+     */\n     public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,\n-                                       HttpServerConfiguration serverConfiguration) {\n+                                       HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n         this.localeResolvers = localeResolvers;\n-        this.defaultLocale = Optional.ofNullable(serverConfiguration.getLocaleResolution())\n-                .map(HttpServerConfiguration.LocaleResolutionConfiguration::getDefaultLocale)\n-                .orElse(Locale.getDefault());\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDY0Nw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544810647", "bodyText": "This method is repeated in every resolver. We could create a parent abstract class.", "author": "sdelamo", "createdAt": "2020-12-17T04:51:39Z", "path": "http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.http.server.util;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Primary;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Arrays;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Primary\n+public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+\n+    private final HttpLocaleResolver[] localeResolvers;\n+    private final Locale defaultLocale;\n+\n+    public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,\n+                                       HttpServerConfiguration serverConfiguration) {\n+        this.localeResolvers = localeResolvers;\n+        this.defaultLocale = Optional.ofNullable(serverConfiguration.getLocaleResolution())\n+                .map(HttpServerConfiguration.LocaleResolutionConfiguration::getDefaultLocale)\n+                .orElse(Locale.getDefault());\n+    }\n+\n+    @Override\n+    public Optional<Locale> resolve(@NonNull HttpRequest<?> request) {\n+        return Arrays.stream(localeResolvers)\n+                .map(resolver -> resolver.resolve(request))\n+                .filter(Optional::isPresent)\n+                .findFirst()\n+                .orElse(Optional.empty());\n+    }\n+\n+    @Override\n+    public Locale resolveOrDefault(@NonNull HttpRequest<?> request) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMjAxNA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544812014", "bodyText": "It's not repeated for the fixed resolver. I don't think this warrants an abstract class", "author": "jameskleeh", "createdAt": "2020-12-17T04:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDY0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nsimilarity index 66%\nrename from http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\nrename to http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\nindex ea871c168..11bd42087 100644\n--- a/http-server/src/main/java/io/micronaut/http/server/util/CompositeHttpLocaleResolver.java\n+++ b/http-server/src/main/java/io/micronaut/http/server/util/localeresolution/CompositeHttpLocaleResolver.java\n\n@@ -13,31 +13,38 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package io.micronaut.http.server.util;\n+package io.micronaut.http.server.util.localeresolution;\n \n import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Primary;\n import io.micronaut.http.HttpRequest;\n-import io.micronaut.http.server.HttpServerConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Arrays;\n import java.util.Locale;\n import java.util.Optional;\n \n+/**\n+ * {@link Primary} {@link HttpLocaleResolver} which evaluates every {@link HttpLocaleResolver} by order to resolve a {@link java.util.Locale}.\n+ *\n+ * @author Sergio del Amo\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n @Singleton\n @Primary\n-public class CompositeHttpLocaleResolver implements HttpLocaleResolver {\n+public class CompositeHttpLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final HttpLocaleResolver[] localeResolvers;\n-    private final Locale defaultLocale;\n \n+    /**\n+     * @param localeResolvers HTTP Locale Resolvers\n+     * @param httpLocaleResolutionConfiguration Locale Resolution configuration for HTTP Requests\n+     */\n     public CompositeHttpLocaleResolver(HttpLocaleResolver[] localeResolvers,\n-                                       HttpServerConfiguration serverConfiguration) {\n+                                       HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n         this.localeResolvers = localeResolvers;\n-        this.defaultLocale = Optional.ofNullable(serverConfiguration.getLocaleResolution())\n-                .map(HttpServerConfiguration.LocaleResolutionConfiguration::getDefaultLocale)\n-                .orElse(Locale.getDefault());\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDkxMQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544810911", "bodyText": "Missing Java doc.", "author": "sdelamo", "createdAt": "2020-12-17T04:52:22Z", "path": "session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.session.http;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+import io.micronaut.http.server.util.HttpLocaleResolver;\n+import io.micronaut.http.server.util.RequestLocaleResolver;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".session-attribute\")", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\nindex 9d15d5b75..62f35a44a 100644\n--- a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n+++ b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n\n@@ -19,29 +19,24 @@ import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n import io.micronaut.http.HttpRequest;\n import io.micronaut.http.server.HttpServerConfiguration;\n-import io.micronaut.http.server.util.HttpLocaleResolver;\n-import io.micronaut.http.server.util.RequestLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpAbstractLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpLocaleResolutionConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Locale;\n-import java.util.Objects;\n import java.util.Optional;\n \n @Singleton\n-@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".session-attribute\")\n-public class SessionLocaleResolver implements HttpLocaleResolver {\n-\n-    public static final Integer ORDER = RequestLocaleResolver.ORDER - 50;\n+@Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")\n+@Requires(classes = SessionForRequest.class)\n+public class SessionLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final String sessionAttribute;\n-    private final Locale defaultLocale;\n-\n-    public SessionLocaleResolver(HttpServerConfiguration serverConfiguration) {\n-        HttpServerConfiguration.LocaleResolutionConfiguration resolutionConfiguration = Objects.requireNonNull(serverConfiguration.getLocaleResolution());\n \n-        this.sessionAttribute = resolutionConfiguration.getSessionAttribute()\n+    public SessionLocaleResolver(HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n+        this.sessionAttribute = httpLocaleResolutionConfiguration.getSessionAttribute()\n                 .orElseThrow(() -> new IllegalArgumentException(\"The session attribute must be set\"));\n-        this.defaultLocale = resolutionConfiguration.getDefaultLocale();\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDkzNA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544810934", "bodyText": "Missing JavaDoc", "author": "sdelamo", "createdAt": "2020-12-17T04:52:30Z", "path": "session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.session.http;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+import io.micronaut.http.server.util.HttpLocaleResolver;\n+import io.micronaut.http.server.util.RequestLocaleResolver;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".session-attribute\")\n+public class SessionLocaleResolver implements HttpLocaleResolver {\n+\n+    public static final Integer ORDER = RequestLocaleResolver.ORDER - 50;\n+\n+    private final String sessionAttribute;\n+    private final Locale defaultLocale;\n+\n+    public SessionLocaleResolver(HttpServerConfiguration serverConfiguration) {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\nindex 9d15d5b75..62f35a44a 100644\n--- a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n+++ b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n\n@@ -19,29 +19,24 @@ import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n import io.micronaut.http.HttpRequest;\n import io.micronaut.http.server.HttpServerConfiguration;\n-import io.micronaut.http.server.util.HttpLocaleResolver;\n-import io.micronaut.http.server.util.RequestLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpAbstractLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpLocaleResolutionConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Locale;\n-import java.util.Objects;\n import java.util.Optional;\n \n @Singleton\n-@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".session-attribute\")\n-public class SessionLocaleResolver implements HttpLocaleResolver {\n-\n-    public static final Integer ORDER = RequestLocaleResolver.ORDER - 50;\n+@Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")\n+@Requires(classes = SessionForRequest.class)\n+public class SessionLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final String sessionAttribute;\n-    private final Locale defaultLocale;\n-\n-    public SessionLocaleResolver(HttpServerConfiguration serverConfiguration) {\n-        HttpServerConfiguration.LocaleResolutionConfiguration resolutionConfiguration = Objects.requireNonNull(serverConfiguration.getLocaleResolution());\n \n-        this.sessionAttribute = resolutionConfiguration.getSessionAttribute()\n+    public SessionLocaleResolver(HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n+        this.sessionAttribute = httpLocaleResolutionConfiguration.getSessionAttribute()\n                 .orElseThrow(() -> new IllegalArgumentException(\"The session attribute must be set\"));\n-        this.defaultLocale = resolutionConfiguration.getDefaultLocale();\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMDk4NQ==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r544810985", "bodyText": "Missing a test", "author": "sdelamo", "createdAt": "2020-12-17T04:52:39Z", "path": "session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.session.http;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+import io.micronaut.http.server.util.HttpLocaleResolver;\n+import io.micronaut.http.server.util.RequestLocaleResolver;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".session-attribute\")\n+public class SessionLocaleResolver implements HttpLocaleResolver {", "originalCommit": "8e55e13b7a060d5359b00efed96fce1666e4bcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "chunk": "diff --git a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\nindex 9d15d5b75..62f35a44a 100644\n--- a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n+++ b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n\n@@ -19,29 +19,24 @@ import edu.umd.cs.findbugs.annotations.NonNull;\n import io.micronaut.context.annotation.Requires;\n import io.micronaut.http.HttpRequest;\n import io.micronaut.http.server.HttpServerConfiguration;\n-import io.micronaut.http.server.util.HttpLocaleResolver;\n-import io.micronaut.http.server.util.RequestLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpAbstractLocaleResolver;\n+import io.micronaut.http.server.util.localeresolution.HttpLocaleResolutionConfiguration;\n \n import javax.inject.Singleton;\n import java.util.Locale;\n-import java.util.Objects;\n import java.util.Optional;\n \n @Singleton\n-@Requires(property = HttpServerConfiguration.LocaleResolutionConfiguration.PREFIX + \".session-attribute\")\n-public class SessionLocaleResolver implements HttpLocaleResolver {\n-\n-    public static final Integer ORDER = RequestLocaleResolver.ORDER - 50;\n+@Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")\n+@Requires(classes = SessionForRequest.class)\n+public class SessionLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final String sessionAttribute;\n-    private final Locale defaultLocale;\n-\n-    public SessionLocaleResolver(HttpServerConfiguration serverConfiguration) {\n-        HttpServerConfiguration.LocaleResolutionConfiguration resolutionConfiguration = Objects.requireNonNull(serverConfiguration.getLocaleResolution());\n \n-        this.sessionAttribute = resolutionConfiguration.getSessionAttribute()\n+    public SessionLocaleResolver(HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n+        super(httpLocaleResolutionConfiguration);\n+        this.sessionAttribute = httpLocaleResolutionConfiguration.getSessionAttribute()\n                 .orElseThrow(() -> new IllegalArgumentException(\"The session attribute must be set\"));\n-        this.defaultLocale = resolutionConfiguration.getDefaultLocale();\n     }\n \n     @Override\n"}}, {"oid": "2fde87571f5ce5e45d15df9872d412a3aec92647", "url": "https://github.com/micronaut-projects/micronaut-core/commit/2fde87571f5ce5e45d15df9872d412a3aec92647", "message": "Merge branch '2.3.x' into locale_resolver", "committedDate": "2020-12-17T05:24:07Z", "type": "commit"}, {"oid": "b35f4436a2872a59cba338ee83f9297cddbbd39d", "url": "https://github.com/micronaut-projects/micronaut-core/commit/b35f4436a2872a59cba338ee83f9297cddbbd39d", "message": "refactor: changes to locale resolver (#4727)\n\n* refactor: changes to locale resolver\r\n\r\n* :%s/DefaultLocaleResolver/AbstractLocaleResolver\r\n\r\n* add a padding to fixed locale resolver\r\n\r\n* don't sort locale resolvers they are already sorted\r\n\r\n* remove @Indexed\r\n\r\n* don't override getOrder in Composite\r\n\r\n* make test more robust for ordering\r\n\r\n* don't extend FixedLocaleResolver from AbstractLocaleResolver\r\n\r\n* Split default and fix configuration", "committedDate": "2020-12-17T17:15:36Z", "type": "commit"}, {"oid": "6d38c5ac08a36631a9a09b811293affd377a461d", "url": "https://github.com/micronaut-projects/micronaut-core/commit/6d38c5ac08a36631a9a09b811293affd377a461d", "message": "Rename package. Remove unnecessary interfaces", "committedDate": "2020-12-17T21:44:35Z", "type": "commit"}, {"oid": "9984cb59486237f6dc08c047c6a9788ba0435d01", "url": "https://github.com/micronaut-projects/micronaut-core/commit/9984cb59486237f6dc08c047c6a9788ba0435d01", "message": "Fix tests", "committedDate": "2020-12-18T17:49:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxMTIzNw==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r546011237", "bodyText": "Missing javadoc", "author": "sdelamo", "createdAt": "2020-12-18T18:25:43Z", "path": "session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.session.http;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+import io.micronaut.http.server.util.locale.HttpAbstractLocaleResolver;\n+import io.micronaut.http.server.util.locale.HttpLocaleResolutionConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")", "originalCommit": "9984cb59486237f6dc08c047c6a9788ba0435d01", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bc6a661fb740b483dc0b72f7dcd26d4c42d31d7e", "chunk": "diff --git a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\nindex 712cf2a1b..b4a3c39e7 100644\n--- a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n+++ b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n\n@@ -26,13 +26,21 @@ import javax.inject.Singleton;\n import java.util.Locale;\n import java.util.Optional;\n \n+/**\n+ * Resolves the locale from a property in a session.\n+ *\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n @Singleton\n @Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")\n-@Requires(classes = SessionForRequest.class)\n public class SessionLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final String sessionAttribute;\n \n+    /**\n+     * @param httpLocaleResolutionConfiguration The locale resolution configuration\n+     */\n     public SessionLocaleResolver(HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n         super(httpLocaleResolutionConfiguration);\n         this.sessionAttribute = httpLocaleResolutionConfiguration.getSessionAttribute()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxMTMyMg==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4717#discussion_r546011322", "bodyText": "missing javadoc", "author": "sdelamo", "createdAt": "2020-12-18T18:25:56Z", "path": "session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.session.http;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.context.annotation.Requires;\n+import io.micronaut.http.HttpRequest;\n+import io.micronaut.http.server.HttpServerConfiguration;\n+import io.micronaut.http.server.util.locale.HttpAbstractLocaleResolver;\n+import io.micronaut.http.server.util.locale.HttpLocaleResolutionConfiguration;\n+\n+import javax.inject.Singleton;\n+import java.util.Locale;\n+import java.util.Optional;\n+\n+@Singleton\n+@Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")\n+@Requires(classes = SessionForRequest.class)\n+public class SessionLocaleResolver extends HttpAbstractLocaleResolver {\n+\n+    private final String sessionAttribute;\n+\n+    public SessionLocaleResolver(HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {", "originalCommit": "9984cb59486237f6dc08c047c6a9788ba0435d01", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bc6a661fb740b483dc0b72f7dcd26d4c42d31d7e", "chunk": "diff --git a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\nindex 712cf2a1b..b4a3c39e7 100644\n--- a/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n+++ b/session/src/main/java/io/micronaut/session/http/SessionLocaleResolver.java\n\n@@ -26,13 +26,21 @@ import javax.inject.Singleton;\n import java.util.Locale;\n import java.util.Optional;\n \n+/**\n+ * Resolves the locale from a property in a session.\n+ *\n+ * @author James Kleeh\n+ * @since 2.3.0\n+ */\n @Singleton\n @Requires(property = HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.PREFIX + \".session-attribute\")\n-@Requires(classes = SessionForRequest.class)\n public class SessionLocaleResolver extends HttpAbstractLocaleResolver {\n \n     private final String sessionAttribute;\n \n+    /**\n+     * @param httpLocaleResolutionConfiguration The locale resolution configuration\n+     */\n     public SessionLocaleResolver(HttpLocaleResolutionConfiguration httpLocaleResolutionConfiguration) {\n         super(httpLocaleResolutionConfiguration);\n         this.sessionAttribute = httpLocaleResolutionConfiguration.getSessionAttribute()\n"}}, {"oid": "bc6a661fb740b483dc0b72f7dcd26d4c42d31d7e", "url": "https://github.com/micronaut-projects/micronaut-core/commit/bc6a661fb740b483dc0b72f7dcd26d4c42d31d7e", "message": "Add javadoc", "committedDate": "2020-12-18T18:28:42Z", "type": "commit"}, {"oid": "2538bf76a59f9e828135514a6977b0394fc91157", "url": "https://github.com/micronaut-projects/micronaut-core/commit/2538bf76a59f9e828135514a6977b0394fc91157", "message": "Add more javadoc", "committedDate": "2020-12-18T18:34:05Z", "type": "commit"}]}