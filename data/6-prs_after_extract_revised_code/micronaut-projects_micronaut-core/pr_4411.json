{"pr_number": 4411, "pr_title": "Issue 4306 - Bean validation should fail if @Valid field is not introspected", "pr_createdAt": "2020-10-29T20:33:51Z", "pr_url": "https://github.com/micronaut-projects/micronaut-core/pull/4411", "timeline": [{"oid": "d5215d1b9b8b43bad518c7e2d3c1f52772ee8a36", "url": "https://github.com/micronaut-projects/micronaut-core/commit/d5215d1b9b8b43bad518c7e2d3c1f52772ee8a36", "message": "Issue 4306 - Bean validation should fail if @Valid field is not introspected\n- emit validation failure when @Valid alone is applied to a container of elements where the element type is not @Introspected.\n- this does not address cases with additional constraint(s), since that might still be legal if the element type is supported by those constraints directly (e.g. @Valid @Size(min=1, max=2) List<String> strs), even though something like @Valid @Size(min=1, max=2) List<NotIntrospected> oops might be bogus.", "committedDate": "2020-10-29T20:30:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3MTIxOA==", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4411#discussion_r514571218", "bodyText": "@Valid is not annotated with @Constraint so you can just look for the presence of that annotation instead of comparing the annotation names", "author": "jameskleeh", "createdAt": "2020-10-29T21:13:15Z", "path": "validation/src/main/java/io/micronaut/validation/validator/DefaultValidator.java", "diffHunk": "@@ -1331,6 +1320,14 @@ public void keyedValue(String nodeName, Object key, Object keyedValue) {\n             @Nullable DefaultPropertyNode container) {\n \n         final BeanIntrospection<Object> beanIntrospection = getBeanIntrospection(propertyValue);\n+        AnnotationMetadata annotationMetadata = cascadeProperty.getAnnotationMetadata();\n+        if (beanIntrospection == null && annotationMetadata.getDeclaredAnnotationNames().equals(", "originalCommit": "d5215d1b9b8b43bad518c7e2d3c1f52772ee8a36", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "70622ee7b8b6990eb6c22b710564d9ecbbf4b7c2", "chunk": "diff --git a/validation/src/main/java/io/micronaut/validation/validator/DefaultValidator.java b/validation/src/main/java/io/micronaut/validation/validator/DefaultValidator.java\nindex cbd0d36ff..9de908726 100644\n--- a/validation/src/main/java/io/micronaut/validation/validator/DefaultValidator.java\n+++ b/validation/src/main/java/io/micronaut/validation/validator/DefaultValidator.java\n\n@@ -1321,8 +1321,7 @@ public class DefaultValidator implements Validator, ExecutableMethodValidator, R\n \n         final BeanIntrospection<Object> beanIntrospection = getBeanIntrospection(propertyValue);\n         AnnotationMetadata annotationMetadata = cascadeProperty.getAnnotationMetadata();\n-        if (beanIntrospection == null && annotationMetadata.getDeclaredAnnotationNames().equals(\n-            Collections.singleton(javax.validation.Valid.class.getName()))) {\n+        if (beanIntrospection == null && annotationMetadata.getDeclaredAnnotation(Constraint.class) == null) {\n             // error: only has @Valid but the propertyValue class is not @Introspected\n             overallViolations.add(createIntrospectionConstraintViolation(\n                 rootClass, rootBean, context, propertyValue.getClass(), propertyValue));\n"}}, {"oid": "70622ee7b8b6990eb6c22b710564d9ecbbf4b7c2", "url": "https://github.com/micronaut-projects/micronaut-core/commit/70622ee7b8b6990eb6c22b710564d9ecbbf4b7c2", "message": "Issue 4306 - Bean validation should fail if @Valid field is not introspected\n- emit validation failure when @Valid alone is applied to a container of elements where the element type is not @Introspected.\n- this does not address cases with additional constraint(s), since that might still be legal if the element type is supported by those constraints directly (e.g. @Valid @Size(min=1, max=2) List<String> strs), even though something like @Valid @Size(min=1, max=2) List<NotIntrospected> oops might be bogus.", "committedDate": "2020-10-29T21:34:54Z", "type": "commit"}, {"oid": "6c0fbd8cae2f4f293483b52b9fb62c33d9344f7e", "url": "https://github.com/micronaut-projects/micronaut-core/commit/6c0fbd8cae2f4f293483b52b9fb62c33d9344f7e", "message": "Issue 4306 - Bean validation should fail if @Valid field is not introspected\n- emit validation failure when @Valid alone is applied to a container of elements where the element type is not @Introspected.\n- this does not address cases with additional constraint(s), since that might still be legal if the element type is supported by those constraints directly (e.g. @Valid @Size(min=1, max=2) List<String> strs), even though something like @Valid @Size(min=1, max=2) List<NotIntrospected> oops might be bogus.", "committedDate": "2020-10-29T21:44:10Z", "type": "commit"}]}