{"pr_number": 8518, "pr_title": "ISPN-12067 HTTP/2 framing error for invalid requests", "pr_createdAt": "2020-06-30T11:01:50Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8518", "timeline": [{"oid": "e52161356f340492d5c38a3a9cbe16f79210b48d", "url": "https://github.com/infinispan/infinispan/commit/e52161356f340492d5c38a3a9cbe16f79210b48d", "message": "ISPN-12067 Reproducer", "committedDate": "2020-06-30T10:54:24Z", "type": "commit"}, {"oid": "9362633c04c40f186f6c66c0d36ec8092faf5956", "url": "https://github.com/infinispan/infinispan/commit/9362633c04c40f186f6c66c0d36ec8092faf5956", "message": "ISPN-12067 HTTP/2 framing error for invalid requests", "committedDate": "2020-06-30T11:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY0NTI0OQ==", "url": "https://github.com/infinispan/infinispan/pull/8518#discussion_r447645249", "bodyText": "shouldn't use HTTP2?", "author": "pruivo", "createdAt": "2020-06-30T12:31:57Z", "path": "server/rest/src/test/java/org/infinispan/rest/Http2Test.java", "diffHunk": "@@ -68,6 +69,28 @@ public void shouldUseHTTP2WithPriorKnowledge() throws Exception {\n       clearTextUpgrade(true);\n    }\n \n+   @Test\n+   public void shouldReportErrorCorrectly() throws Exception {\n+      restServer = RestServerHelper.defaultRestServer()\n+            .withKeyStore(KEY_STORE_PATH, \"secret\", \"pkcs12\")\n+            .withTrustStore(KEY_STORE_PATH, \"secret\", \"pkcs12\")\n+            .start(TestResourceTracker.getCurrentTestShortName());\n+\n+      RestClientConfigurationBuilder config = new RestClientConfigurationBuilder();\n+\n+      config.addServer().host(restServer.getHost()).port(restServer.getPort())\n+            .protocol(HTTP_20).priorKnowledge(true)\n+            .security().ssl().enable()\n+            .trustStoreFileName(KEY_STORE_PATH).trustStorePassword(\"secret\".toCharArray()).trustStoreType(\"pkcs12\")\n+            .keyStoreFileName(KEY_STORE_PATH).keyStorePassword(\"secret\".toCharArray()).keyStoreType(\"pkcs12\");\n+\n+      client = NettyHttpClient.forConfiguration(config.build());\n+\n+      FullHttpRequest getRequest = new DefaultFullHttpRequest(HTTP_1_1, GET, \"invalid\");", "originalCommit": "9362633c04c40f186f6c66c0d36ec8092faf5956", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1NzQwMw==", "url": "https://github.com/infinispan/infinispan/pull/8518#discussion_r447657403", "bodyText": "The DefaultFullHttpRequest doesn't support it, but the client is configured as HTTP/2, so it will pass the request through a HTTP/2 pipeline", "author": "gustavonalle", "createdAt": "2020-06-30T12:52:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY0NTI0OQ=="}], "type": "inlineReview", "revised_code": null}]}