{"pr_number": 8657, "pr_title": "ISPN-12271 Allow different servers for server integration test suite", "pr_createdAt": "2020-08-28T19:12:20Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8657", "timeline": [{"oid": "37fa207df2d3293e22351ab48c848c0fb2783fda", "url": "https://github.com/infinispan/infinispan/commit/37fa207df2d3293e22351ab48c848c0fb2783fda", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-08-31T12:50:17Z", "type": "forcePushed"}, {"oid": "876b6b0dd627c155a8b2f62daa9bb9a69b477a47", "url": "https://github.com/infinispan/infinispan/commit/876b6b0dd627c155a8b2f62daa9bb9a69b477a47", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-08-31T14:10:01Z", "type": "forcePushed"}, {"oid": "4c1f97b4292559c92a4137ef2b7566e0b1a6a5b1", "url": "https://github.com/infinispan/infinispan/commit/4c1f97b4292559c92a4137ef2b7566e0b1a6a5b1", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-08-31T14:19:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NzY4OQ==", "url": "https://github.com/infinispan/infinispan/pull/8657#discussion_r480197689", "bodyText": "IMO if we have jboss-deployment-structure.xml inside src/test/resources/eap/jboss-deployment-structure.xmlis way better than work with string into the code", "author": "gustavolira", "createdAt": "2020-08-31T15:13:48Z", "path": "integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.infinispan.test.integration;\n+\n+import java.io.File;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.jboss.shrinkwrap.resolver.api.maven.Maven;\n+import org.jboss.shrinkwrap.resolver.api.maven.MavenResolverSystem;\n+\n+public class DeploymentHelper {\n+\n+   public static WebArchive createDeployment() {\n+\n+      WebArchive war = ShrinkWrap.create(WebArchive.class, \"infinispan-server-integration.war\");\n+      String arquillianLaunch = System.getProperty(\"arquillian.launch\");\n+\n+      if (arquillianLaunch.equals(\"tomcat\")) {\n+         tomcat(war);\n+      } else if (arquillianLaunch.equals(\"wildfly\")) {\n+         wildfly(war);\n+      } else {\n+         throw new IllegalStateException(String.format(\"%s not supported\", arquillianLaunch));\n+      }\n+\n+      MavenResolverSystem resolver = Maven.resolver();\n+      addLibrary(war, resolver\n+            .loadPomFromFile(\"pom.xml\")\n+            .resolve(\"org.infinispan:infinispan-client-hotrod\")\n+            .withTransitivity().as(File.class));\n+      return war;\n+   }\n+\n+   private static void wildfly(WebArchive war) {\n+      String jbossDeploymentStructure = \"<jboss-deployment-structure xmlns=\\\"urn:jboss:deployment-structure:1.1\\\">\\n\" +", "originalCommit": "4c1f97b4292559c92a4137ef2b7566e0b1a6a5b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1a9a9bdeb3f51295a9d92ebfabec581cd37f34b2", "chunk": "diff --git a/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java b/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java\nindex 5fbf7d5a10..95d6bdb3a0 100644\n--- a/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java\n+++ b/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java\n\n@@ -3,7 +3,7 @@\n import java.io.File;\n \n import org.jboss.shrinkwrap.api.ShrinkWrap;\n-import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.asset.FileAsset;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n import org.jboss.shrinkwrap.resolver.api.maven.Maven;\n import org.jboss.shrinkwrap.resolver.api.maven.MavenResolverSystem;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1MDg5Mg==", "url": "https://github.com/infinispan/infinispan/pull/8657#discussion_r481150892", "bodyText": "update the author and since", "author": "pruivo", "createdAt": "2020-09-01T13:48:13Z", "path": "integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/thirdparty/HotRodClientIT.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.infinispan.test.integration.thirdparty;\n+\n+import org.infinispan.test.integration.DeploymentHelper;\n+import org.infinispan.test.integration.as.client.AbstractHotRodClientIT;\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.shrinkwrap.api.Archive;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * Test the Infinispan AS remote client module integration\n+ *\n+ * @author Pedro Ruivo", "originalCommit": "4c1f97b4292559c92a4137ef2b7566e0b1a6a5b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1NzI3NQ==", "url": "https://github.com/infinispan/infinispan/pull/8657#discussion_r481157275", "bodyText": "I copied and pasted. Nothing changed", "author": "diegolovison", "createdAt": "2020-09-01T13:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1MDg5Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1a9a9bdeb3f51295a9d92ebfabec581cd37f34b2", "url": "https://github.com/infinispan/infinispan/commit/1a9a9bdeb3f51295a9d92ebfabec581cd37f34b2", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-09-03T18:32:00Z", "type": "forcePushed"}, {"oid": "2fa3a0aad0348b9250f9340986f18e93c7eea730", "url": "https://github.com/infinispan/infinispan/commit/2fa3a0aad0348b9250f9340986f18e93c7eea730", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-09-03T18:34:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY1NjE0Mg==", "url": "https://github.com/infinispan/infinispan/pull/8657#discussion_r483656142", "bodyText": "is this intentional?", "author": "pruivo", "createdAt": "2020-09-04T14:37:49Z", "path": "integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.infinispan.test.integration;\n+\n+import java.io.File;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.FileAsset;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.jboss.shrinkwrap.resolver.api.maven.Maven;\n+import org.jboss.shrinkwrap.resolver.api.maven.MavenResolverSystem;\n+\n+public class DeploymentHelper {\n+\n+   public static WebArchive createDeployment() {\n+\n+      WebArchive war = ShrinkWrap.create(WebArchive.class, \"infinispan-server-integration.war\");\n+      String arquillianLaunch = System.getProperty(\"arquillian.launch\");\n+\n+      if (arquillianLaunch.equals(\"tomcat\")) {\n+         tomcat(war);\n+      } else if (arquillianLaunch.equals(\"wildfly\")) {\n+         wildfly(war);\n+      } else {\n+         throw new IllegalStateException(String.format(\"%s not supported\", arquillianLaunch));\n+      }\n+\n+      MavenResolverSystem resolver = Maven.resolver();\n+      addLibrary(war, resolver\n+            .loadPomFromFile(\"pom.xml\")\n+            .resolve(\"org.infinispan:infinispan-client-hotrod\")\n+            .withTransitivity().as(File.class));\n+      return war;\n+   }\n+\n+   private static void wildfly(WebArchive war) {\n+      war.add(new FileAsset(new File(\"src/test/resources/wildfly/jboss-deployment-structure.xml\")), \"WEB-INF/jboss-deployment-structure.xml\");\n+   }\n+\n+   private static void tomcat(WebArchive war) {", "originalCommit": "2fa3a0aad0348b9250f9340986f18e93c7eea730", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc4NzA0MQ==", "url": "https://github.com/infinispan/infinispan/pull/8657#discussion_r483787041", "bodyText": "Yes. I added a comment. Please let me know what you think,", "author": "diegolovison", "createdAt": "2020-09-04T18:31:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY1NjE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MjM5OQ==", "url": "https://github.com/infinispan/infinispan/pull/8657#discussion_r483792399", "bodyText": "looks good.", "author": "pruivo", "createdAt": "2020-09-04T18:44:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY1NjE0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "38fb79fce8983b52537a5ce6e892d3d8c3b20e60", "chunk": "diff --git a/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java b/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java\nindex 95d6bdb3a0..8d80b1efee 100644\n--- a/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java\n+++ b/integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/DeploymentHelper.java\n\n@@ -36,6 +36,7 @@ private static void wildfly(WebArchive war) {\n    }\n \n    private static void tomcat(WebArchive war) {\n+      // intentionally empty. if you need to implement a custom deploy the code is 'ready'\n    }\n \n    private static void addLibrary(WebArchive war, File[]... libGroup) {\n"}}, {"oid": "38fb79fce8983b52537a5ce6e892d3d8c3b20e60", "url": "https://github.com/infinispan/infinispan/commit/38fb79fce8983b52537a5ce6e892d3d8c3b20e60", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-09-04T18:30:22Z", "type": "forcePushed"}, {"oid": "88ded7950fc42fb6c7c896df8f6f5975ded37760", "url": "https://github.com/infinispan/infinispan/commit/88ded7950fc42fb6c7c896df8f6f5975ded37760", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-09-04T19:18:31Z", "type": "commit"}, {"oid": "88ded7950fc42fb6c7c896df8f6f5975ded37760", "url": "https://github.com/infinispan/infinispan/commit/88ded7950fc42fb6c7c896df8f6f5975ded37760", "message": "ISPN-12271 Allow different servers for server integration test suite", "committedDate": "2020-09-04T19:18:31Z", "type": "forcePushed"}]}