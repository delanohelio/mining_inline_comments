{"pr_number": 8924, "pr_title": "ISPN-12565 Converts lifespan and maxidle to seconds", "pr_createdAt": "2020-12-09T21:19:59Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8924", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r540469574", "bodyText": "So I must admit this seems a bit odd to me. Why even have the created and last used if we are converting the lifespan and max idle to seconds? Should we not convert all of them? Or maybe we don't even need created or last used?", "author": "wburns", "createdAt": "2020-12-10T20:19:55Z", "path": "server/rest/src/main/java/org/infinispan/rest/CacheEntryInputStream.java", "diffHunk": "@@ -207,7 +208,13 @@ private void loadMetadata() {\n          InternalCacheEntry ice = (InternalCacheEntry) currentEntry;\n          // add metadata\n          long lifespan = ice.getLifespan();\n+         if (lifespan > -1) {", "originalCommit": "4a6cce5300e5ace14cbd02d944f412dba67c5756", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU0MTc2NQ==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r540541765", "bodyText": "the rest api works in seconds for maxidle and lifespan\n\n  \n    \n      infinispan/server/rest/src/main/java/org/infinispan/rest/NettyRestResponse.java\n    \n    \n         Line 194\n      in\n      4e9596f\n    \n    \n    \n    \n\n        \n          \n           public Builder timeToLive(long timeToLive) {", "author": "karesti", "createdAt": "2020-12-10T22:24:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU0MzEwOQ==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r540543109", "bodyText": "the other parameters are translated to dates from the long on the headers", "author": "karesti", "createdAt": "2020-12-10T22:27:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU0NDgzMg==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r540544832", "bodyText": "and for put entry for example we send timeToLiveSeconds\nhttps://infinispan.org/docs/dev/titles/rest/rest.html#rest_v2_add_entries", "author": "karesti", "createdAt": "2020-12-10T22:30:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwOTE2Mw==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r540809163", "bodyText": "@gustavonalle here", "author": "karesti", "createdAt": "2020-12-11T09:29:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIwNTcyOA==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r541205728", "bodyText": "@wburns since gustavo is not coming until next year, could we move forward this please? I need this fix for the console because other wise data is not consistent. I can do conversion directly from the console, but it's very weird to me to work on seconds everywhere in the REST api but not here. I was disturbed myself", "author": "karesti", "createdAt": "2020-12-11T19:38:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIwNjQwNQ==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r541206405", "bodyText": "I'm planning to implement the CLI operation on this as well", "author": "karesti", "createdAt": "2020-12-11T19:39:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzNDM1MQ==", "url": "https://github.com/infinispan/infinispan/pull/8924#discussion_r542534351", "bodyText": "Yeah, I understand we use seconds for REST. I was more asking because we have a Metadata class and normally metadata is in ms internally. Maybe just change the instance variables to lifespanSeconds instead? This would be on the Metadata class as well.", "author": "wburns", "createdAt": "2020-12-14T16:43:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ2OTU3NA=="}], "type": "inlineReview", "revised_code": {"commit": "ed27d933f176eac392f0504f35daebbfb18fbb7a", "chunk": "diff --git a/server/rest/src/main/java/org/infinispan/rest/CacheEntryInputStream.java b/server/rest/src/main/java/org/infinispan/rest/CacheEntryInputStream.java\nindex 9f9ceb21bf..1a5e19e0be 100644\n--- a/server/rest/src/main/java/org/infinispan/rest/CacheEntryInputStream.java\n+++ b/server/rest/src/main/java/org/infinispan/rest/CacheEntryInputStream.java\n\n@@ -207,18 +205,18 @@ private void loadMetadata() {\n       if (currentEntry instanceof InternalCacheEntry) {\n          InternalCacheEntry ice = (InternalCacheEntry) currentEntry;\n          // add metadata\n-         long lifespan = ice.getLifespan();\n-         if (lifespan > -1) {\n-            lifespan = TimeUnit.MILLISECONDS.toSeconds(lifespan);\n+         long lifespanInSeconds = ice.getLifespan();\n+         if (lifespanInSeconds > -1) {\n+            lifespanInSeconds = TimeUnit.MILLISECONDS.toSeconds(lifespanInSeconds);\n          }\n-         long maxIdle = ice.getMaxIdle();\n-         if (maxIdle > -1) {\n-            maxIdle = TimeUnit.MILLISECONDS.toSeconds(maxIdle);\n+         long maxIdleInSeconds = ice.getMaxIdle();\n+         if (maxIdleInSeconds > -1) {\n+            maxIdleInSeconds = TimeUnit.MILLISECONDS.toSeconds(maxIdleInSeconds);\n          }\n          long created = ice.getCreated();\n          long lastUsed = ice.getLastUsed();\n          long expiryTime = ice.getExpiryTime();\n-         currentMetadata = new Metadata(lifespan, maxIdle, created, lastUsed, expiryTime).bytes();\n+         currentMetadata = new Metadata(lifespanInSeconds, maxIdleInSeconds, created, lastUsed, expiryTime).bytes();\n       } else {\n          currentMetadata = Metadata.EMPTY;\n       }\n"}}, {"oid": "ed27d933f176eac392f0504f35daebbfb18fbb7a", "url": "https://github.com/infinispan/infinispan/commit/ed27d933f176eac392f0504f35daebbfb18fbb7a", "message": "ISPN-12565 Converts lifespan and maxidle to seconds", "committedDate": "2020-12-14T17:14:39Z", "type": "commit"}, {"oid": "ed27d933f176eac392f0504f35daebbfb18fbb7a", "url": "https://github.com/infinispan/infinispan/commit/ed27d933f176eac392f0504f35daebbfb18fbb7a", "message": "ISPN-12565 Converts lifespan and maxidle to seconds", "committedDate": "2020-12-14T17:14:39Z", "type": "forcePushed"}]}