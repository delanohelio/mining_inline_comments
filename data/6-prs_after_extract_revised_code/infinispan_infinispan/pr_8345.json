{"pr_number": 8345, "pr_title": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "pr_createdAt": "2020-05-19T14:33:45Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8345", "timeline": [{"oid": "439f7e4415187369be4a12b63cdead05cd64f3d6", "url": "https://github.com/infinispan/infinispan/commit/439f7e4415187369be4a12b63cdead05cd64f3d6", "message": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "committedDate": "2020-05-19T14:50:18Z", "type": "forcePushed"}, {"oid": "168b1b3ddcd6c2049cf9346f7729de739048f17b", "url": "https://github.com/infinispan/infinispan/commit/168b1b3ddcd6c2049cf9346f7729de739048f17b", "message": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "committedDate": "2020-05-19T14:59:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3ODM2Mg==", "url": "https://github.com/infinispan/infinispan/pull/8345#discussion_r427378362", "bodyText": "Why not use infinispan.cluster.stack?", "author": "danberindei", "createdAt": "2020-05-19T15:07:56Z", "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/TestSystemPropertyNames.java", "diffHunk": "@@ -33,4 +33,8 @@\n     * The path to a local installation of the server\n     */\n    public static final String INFINISPAN_TEST_SERVER_DIR = \"org.infinispan.test.server.dir\";\n+   /**\n+    * The name of the JGroups stack. Defaults to `test-tcp`\n+    */\n+   public static final String INFINISPAN_TEST_SERVER_CLUSTER_STACK = \"org.infinispan.test.server.cluster.stack\";", "originalCommit": "168b1b3ddcd6c2049cf9346f7729de739048f17b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMDcxNw==", "url": "https://github.com/infinispan/infinispan/pull/8345#discussion_r427400717", "bodyText": "That change is going to be in #8276\nFor this PR, I just would like to fix the issue.", "author": "diegolovison", "createdAt": "2020-05-19T15:37:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3ODM2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "9e31e3a96735b894788d7b17d002f0c2dd380ddb", "chunk": "diff --git a/server/testdriver/core/src/main/java/org/infinispan/server/test/core/TestSystemPropertyNames.java b/server/testdriver/core/src/main/java/org/infinispan/server/test/core/TestSystemPropertyNames.java\nindex 1a236e4446..07425d9d2c 100644\n--- a/server/testdriver/core/src/main/java/org/infinispan/server/test/core/TestSystemPropertyNames.java\n+++ b/server/testdriver/core/src/main/java/org/infinispan/server/test/core/TestSystemPropertyNames.java\n\n@@ -33,6 +33,11 @@\n     * The path to a local installation of the server\n     */\n    public static final String INFINISPAN_TEST_SERVER_DIR = \"org.infinispan.test.server.dir\";\n+   /**\n+    * The log file for the container server driver\n+    * It should be a file name located in the module server/tests/src/test/resources/configuration or a full path\n+    */\n+   public static final String INFINISPAN_TEST_SERVER_LOG_FILE = \"org.infinispan.test.server.container.logFile\";\n    /**\n     * The name of the JGroups stack. Defaults to `test-tcp`\n     */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4MjY2OQ==", "url": "https://github.com/infinispan/infinispan/pull/8345#discussion_r427382669", "bodyText": "I think this will work from IntelliJ, as it picks up the properties from Maven into its run configurations, but still I'd like a default so that the driver works when the system property is not set.\nI'd also move these lines up to replace args.add(\"-Djgroups.bind.address=SITE_LOCAL\");, because they have more in common with -b than with the JMX system properties that follow, and because -Djgroups.bind.address after -b seems redundant.", "author": "danberindei", "createdAt": "2020-05-19T15:13:38Z", "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "diffHunk": "@@ -105,6 +105,8 @@ protected void start(String name, File rootDir, String configurationFile) {\n          args.add(\"-Dcom.sun.management.jmxremote.authenticate=false\");\n          args.add(\"-Dcom.sun.management.jmxremote.ssl=false\");\n       }\n+      args.add(\"-j\");\n+      args.add(System.getProperty(TestSystemPropertyNames.INFINISPAN_TEST_SERVER_CLUSTER_STACK));", "originalCommit": "168b1b3ddcd6c2049cf9346f7729de739048f17b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMzg0Mw==", "url": "https://github.com/infinispan/infinispan/pull/8345#discussion_r427403843", "bodyText": "-b SITE_LOCAL is for the server bind address.\n-Djgroups.bind.address=SITE_LOCAL is for the JGroups bind address.", "author": "diegolovison", "createdAt": "2020-05-19T15:42:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4MjY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwNTIyMg==", "url": "https://github.com/infinispan/infinispan/pull/8345#discussion_r427405222", "bodyText": "I'd like a default so that the driver works when the system property is not set\n\nFixed", "author": "diegolovison", "createdAt": "2020-05-19T15:43:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4MjY2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f5d5d4985d58e133346d29fd7ccaa2bfe69d5b1a", "chunk": "diff --git a/server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java b/server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java\nindex c675e3f946..4fdf2e4e8b 100644\n--- a/server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java\n+++ b/server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java\n\n@@ -98,6 +98,8 @@ protected void start(String name, File rootDir, String configurationFile) {\n       args.add(\"-b\");\n       args.add(\"SITE_LOCAL\");\n       args.add(\"-Djgroups.bind.address=SITE_LOCAL\");\n+      args.add(\"-j\");\n+      args.add(System.getProperty(TestSystemPropertyNames.INFINISPAN_TEST_SERVER_CLUSTER_STACK, \"test-tcp\"));\n       args.add(\"-Dinfinispan.cluster.name=\" + name);\n       args.add(\"-D\" + TEST_HOST_ADDRESS + \"=\" + testHostAddress.getHostAddress());\n       if (configuration.isJMXEnabled()) {\n"}}, {"oid": "f5d5d4985d58e133346d29fd7ccaa2bfe69d5b1a", "url": "https://github.com/infinispan/infinispan/commit/f5d5d4985d58e133346d29fd7ccaa2bfe69d5b1a", "message": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "committedDate": "2020-05-19T15:43:04Z", "type": "forcePushed"}, {"oid": "9e31e3a96735b894788d7b17d002f0c2dd380ddb", "url": "https://github.com/infinispan/infinispan/commit/9e31e3a96735b894788d7b17d002f0c2dd380ddb", "message": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "committedDate": "2020-05-19T17:29:18Z", "type": "forcePushed"}, {"oid": "c03d75bac07254212966c63161a5383a2d8ea879", "url": "https://github.com/infinispan/infinispan/commit/c03d75bac07254212966c63161a5383a2d8ea879", "message": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "committedDate": "2020-05-28T11:50:06Z", "type": "commit"}, {"oid": "c03d75bac07254212966c63161a5383a2d8ea879", "url": "https://github.com/infinispan/infinispan/commit/c03d75bac07254212966c63161a5383a2d8ea879", "message": "ISPN-11861 ContainerInfinispanServerDriver is not setting the JGroups stack to the server", "committedDate": "2020-05-28T11:50:06Z", "type": "forcePushed"}]}