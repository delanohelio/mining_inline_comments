{"pr_number": 8849, "pr_title": "ISPN-12496 Support port offset for JGroups ports in the server", "pr_createdAt": "2020-11-13T08:08:37Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8849", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA0NTQ3NA==", "url": "https://github.com/infinispan/infinispan/pull/8849#discussion_r525045474", "bodyText": "this is going to change the UDP & MPING ports.\nNodes aren't able to see each other anymore without manually setting this property.\nRunning these commands in 2 different terminals no longer form a cluster\n$ ./bin/server.sh \n$ ./bin/server.sh -s server2 -o 100", "author": "pruivo", "createdAt": "2020-11-17T10:27:21Z", "path": "server/runtime/src/main/java/org/infinispan/server/Bootstrap.java", "diffHunk": "@@ -100,6 +100,13 @@ protected void handleArgumentCommand(String command, String parameter, Iterator<\n             // Fall through\n          case \"--port-offset\":\n             properties.setProperty(Server.INFINISPAN_PORT_OFFSET, parameter);\n+            int offset = Integer.parseInt(parameter);\n+            if (!properties.containsKey(Server.JGROUPS_BIND_PORT)) {\n+               properties.setProperty(Server.JGROUPS_BIND_PORT, Integer.toString(Server.DEFAULT_JGROUPS_BIND_PORT + offset));\n+            }\n+            if (!properties.containsKey(Server.JGROUPS_MCAST_PORT)) {\n+               properties.setProperty(Server.JGROUPS_MCAST_PORT, Integer.toString(Server.DEFAULT_JGROUPS_MCAST_PORT + offset));", "originalCommit": "ea81e058fbe7c95b2f904870b49bc5bc8e821e0e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "53c0368708987e947615eab0c5079a7ee3444877", "chunk": "diff --git a/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java b/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java\nindex 9323610413..115f6fa90d 100644\n--- a/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java\n+++ b/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java\n\n@@ -104,9 +104,6 @@ protected void handleArgumentCommand(String command, String parameter, Iterator<\n             if (!properties.containsKey(Server.JGROUPS_BIND_PORT)) {\n                properties.setProperty(Server.JGROUPS_BIND_PORT, Integer.toString(Server.DEFAULT_JGROUPS_BIND_PORT + offset));\n             }\n-            if (!properties.containsKey(Server.JGROUPS_MCAST_PORT)) {\n-               properties.setProperty(Server.JGROUPS_MCAST_PORT, Integer.toString(Server.DEFAULT_JGROUPS_MCAST_PORT + offset));\n-            }\n             break;\n          default:\n             throw new IllegalArgumentException();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA0NjU3Mg==", "url": "https://github.com/infinispan/infinispan/pull/8849#discussion_r525046572", "bodyText": "JGroups increments the bind_port if it isn't available. Is this a user request? what's the use case?", "author": "pruivo", "createdAt": "2020-11-17T10:29:02Z", "path": "server/runtime/src/main/java/org/infinispan/server/Bootstrap.java", "diffHunk": "@@ -100,6 +100,13 @@ protected void handleArgumentCommand(String command, String parameter, Iterator<\n             // Fall through\n          case \"--port-offset\":\n             properties.setProperty(Server.INFINISPAN_PORT_OFFSET, parameter);\n+            int offset = Integer.parseInt(parameter);\n+            if (!properties.containsKey(Server.JGROUPS_BIND_PORT)) {\n+               properties.setProperty(Server.JGROUPS_BIND_PORT, Integer.toString(Server.DEFAULT_JGROUPS_BIND_PORT + offset));", "originalCommit": "ea81e058fbe7c95b2f904870b49bc5bc8e821e0e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "53c0368708987e947615eab0c5079a7ee3444877", "chunk": "diff --git a/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java b/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java\nindex 9323610413..115f6fa90d 100644\n--- a/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java\n+++ b/server/runtime/src/main/java/org/infinispan/server/Bootstrap.java\n\n@@ -104,9 +104,6 @@ protected void handleArgumentCommand(String command, String parameter, Iterator<\n             if (!properties.containsKey(Server.JGROUPS_BIND_PORT)) {\n                properties.setProperty(Server.JGROUPS_BIND_PORT, Integer.toString(Server.DEFAULT_JGROUPS_BIND_PORT + offset));\n             }\n-            if (!properties.containsKey(Server.JGROUPS_MCAST_PORT)) {\n-               properties.setProperty(Server.JGROUPS_MCAST_PORT, Integer.toString(Server.DEFAULT_JGROUPS_MCAST_PORT + offset));\n-            }\n             break;\n          default:\n             throw new IllegalArgumentException();\n"}}, {"oid": "53c0368708987e947615eab0c5079a7ee3444877", "url": "https://github.com/infinispan/infinispan/commit/53c0368708987e947615eab0c5079a7ee3444877", "message": "ISPN-12496 Support port offset for JGroups ports in the server", "committedDate": "2020-11-17T20:43:14Z", "type": "commit"}, {"oid": "53c0368708987e947615eab0c5079a7ee3444877", "url": "https://github.com/infinispan/infinispan/commit/53c0368708987e947615eab0c5079a7ee3444877", "message": "ISPN-12496 Support port offset for JGroups ports in the server", "committedDate": "2020-11-17T20:43:14Z", "type": "forcePushed"}]}