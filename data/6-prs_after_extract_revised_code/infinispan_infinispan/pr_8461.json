{"pr_number": 8461, "pr_title": "ISPN-11989 Fix ThreadLocalLeakTest", "pr_createdAt": "2020-06-10T13:05:08Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8461", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE0MzE3MA==", "url": "https://github.com/infinispan/infinispan/pull/8461#discussion_r438143170", "bodyText": "Looking at how the global configuration is defined, I think it should either enable global state or not call globalBuilder.globalState().persistentLocation(tmpDirectory).", "author": "danberindei", "createdAt": "2020-06-10T13:58:04Z", "path": "core/src/test/java/org/infinispan/util/ThreadLocalLeakTest.java", "diffHunk": "@@ -60,7 +60,7 @@ public void testCheckThreadLocalLeaks() throws Exception {\n             .memory().size(4096)\n             .locking().concurrencyLevel(2048)\n             .persistence().passivation(false)\n-               .addSingleFileStore().shared(false).preload(true);\n+               .addSingleFileStore().location(tmpDirectory).shared(false).preload(true);", "originalCommit": "fe170af3c662bf88ff0f2f8695ba509eae1698a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE1NTQzMA==", "url": "https://github.com/infinispan/infinispan/pull/8461#discussion_r438155430", "bodyText": "Good point, I forgot to update the global config originally. I went with enabling the global state as it's location is already configured and is a smaller diff.", "author": "ryanemerson", "createdAt": "2020-06-10T14:14:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE0MzE3MA=="}], "type": "inlineReview", "revised_code": {"commit": "1dd4549c4ed3b2077d4b6a38c30412cc230f8087", "chunk": "diff --git a/core/src/test/java/org/infinispan/util/ThreadLocalLeakTest.java b/core/src/test/java/org/infinispan/util/ThreadLocalLeakTest.java\nindex f1d9187d81..429bd34788 100644\n--- a/core/src/test/java/org/infinispan/util/ThreadLocalLeakTest.java\n+++ b/core/src/test/java/org/infinispan/util/ThreadLocalLeakTest.java\n\n@@ -60,7 +60,7 @@ public void testCheckThreadLocalLeaks() throws Exception {\n             .memory().size(4096)\n             .locking().concurrencyLevel(2048)\n             .persistence().passivation(false)\n-               .addSingleFileStore().location(tmpDirectory).shared(false).preload(true);\n+               .addSingleFileStore().shared(false).preload(true);\n \n       Future<Map<String, Map<ThreadLocal<?>, Object>>> result = fork(() -> {\n                TestResourceTracker.testThreadStarted(ThreadLocalLeakTest.this.getTestName());\n"}}, {"oid": "36253e9a96c888c9a005753e6966bed4a6e06c37", "url": "https://github.com/infinispan/infinispan/commit/36253e9a96c888c9a005753e6966bed4a6e06c37", "message": "ISPN-11989 Fix ThreadLocalLeakTest", "committedDate": "2020-06-10T14:10:44Z", "type": "forcePushed"}, {"oid": "1dd4549c4ed3b2077d4b6a38c30412cc230f8087", "url": "https://github.com/infinispan/infinispan/commit/1dd4549c4ed3b2077d4b6a38c30412cc230f8087", "message": "ISPN-11989 Fix ThreadLocalLeakTest", "committedDate": "2020-06-10T14:12:27Z", "type": "commit"}, {"oid": "1dd4549c4ed3b2077d4b6a38c30412cc230f8087", "url": "https://github.com/infinispan/infinispan/commit/1dd4549c4ed3b2077d4b6a38c30412cc230f8087", "message": "ISPN-11989 Fix ThreadLocalLeakTest", "committedDate": "2020-06-10T14:12:27Z", "type": "forcePushed"}]}