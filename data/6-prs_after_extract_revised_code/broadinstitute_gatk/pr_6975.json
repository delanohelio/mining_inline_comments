{"pr_number": 6975, "pr_title": "support for non-AS called data", "pr_createdAt": "2020-11-20T15:58:37Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6975", "timeline": [{"oid": "8909a983dab55a6cecb7ddb628390738e93d273a", "url": "https://github.com/broadinstitute/gatk/commit/8909a983dab55a6cecb7ddb628390738e93d273a", "message": "support for non-AS called data", "committedDate": "2020-11-20T15:51:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5MzMzMw==", "url": "https://github.com/broadinstitute/gatk/pull/6975#discussion_r527793333", "bodyText": "I think this is close enough. I tended to distribute when I did this for other metrics, but I don't think it matters and we don't want half of a read in the output anyway :)", "author": "meganshand", "createdAt": "2020-11-20T16:06:08Z", "path": "src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java", "diffHunk": "@@ -121,7 +121,26 @@ public String getColumnValue(final VariantContext variant) {\n \n     AS_RAW_MQRankSum { // TODO -- maybe rely on 1/1 for call_GT, also get rid of the | at the beginning\n         public String getColumnValue(final VariantContext variant) {\n+            // e.g. AS_RAW_MQRankSum=|1.4,1|NaN;\n             String out =  getAttribute(variant, GATKVCFConstants.AS_RAW_MAP_QUAL_RANK_SUM_KEY, null);\n+\n+            if (out == null) {\n+                // Try to use non-AS version\n+                // TODO: it looks like the AS_RAW version also trims to a single decimal point??\n+                // e.g. MQRankSum=1.465 and turn it into |-0.511,1|\n+                String outNotAlleleSpecific = getAttribute(variant, GATKVCFConstants.READ_POS_RANK_SUM_KEY, null);\n+\n+                if (variant.getAlleles().size() == 3) { // GT 0/1 1/1\n+                    out = \"|\" + outNotAlleleSpecific + \",1|\";\n+\n+                } else if (variant.getAlleles().size() == 4) { // GT 1/2\n+                    // TODO: just replicate rather than distribute, is this right?", "originalCommit": "8909a983dab55a6cecb7ddb628390738e93d273a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "44558c0c94aa301bcb0fdca3a4a3d10c7ffd7645", "chunk": "diff --git a/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java b/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java\nindex b469b72fd..0a770a28d 100644\n--- a/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java\n+++ b/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java\n\n@@ -127,9 +127,14 @@ public enum VetFieldEnum {\n             if (out == null) {\n                 // Try to use non-AS version\n                 // TODO: it looks like the AS_RAW version also trims to a single decimal point??\n-                // e.g. MQRankSum=1.465 and turn it into |-0.511,1|\n+                // e.g. MQRankSum=1.465 and turn it into |1.465,1|\n                 String outNotAlleleSpecific = getAttribute(variant, GATKVCFConstants.READ_POS_RANK_SUM_KEY, null);\n-\n+                \n+                \n+                if ( outNotAlleleSpecific == null || \"\".equals(outNotAlleleSpecific) || outNotAlleleSpecific.contentEquals(\"||\") || outNotAlleleSpecific.contentEquals(\"|||\") ) {\n+                    return \"\";\n+                }\n+                \n                 if (variant.getAlleles().size() == 3) { // GT 0/1 1/1\n                     out = \"|\" + outNotAlleleSpecific + \",1|\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDMwMQ==", "url": "https://github.com/broadinstitute/gatk/pull/6975#discussion_r527794301", "bodyText": "I'm confused here, how did 1.465 become -0.511?", "author": "meganshand", "createdAt": "2020-11-20T16:07:39Z", "path": "src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java", "diffHunk": "@@ -121,7 +121,26 @@ public String getColumnValue(final VariantContext variant) {\n \n     AS_RAW_MQRankSum { // TODO -- maybe rely on 1/1 for call_GT, also get rid of the | at the beginning\n         public String getColumnValue(final VariantContext variant) {\n+            // e.g. AS_RAW_MQRankSum=|1.4,1|NaN;\n             String out =  getAttribute(variant, GATKVCFConstants.AS_RAW_MAP_QUAL_RANK_SUM_KEY, null);\n+\n+            if (out == null) {\n+                // Try to use non-AS version\n+                // TODO: it looks like the AS_RAW version also trims to a single decimal point??\n+                // e.g. MQRankSum=1.465 and turn it into |-0.511,1|", "originalCommit": "8909a983dab55a6cecb7ddb628390738e93d273a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgwMzUzMQ==", "url": "https://github.com/broadinstitute/gatk/pull/6975#discussion_r527803531", "bodyText": "lol -- cut and paste!", "author": "kcibul", "createdAt": "2020-11-20T16:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDMwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "44558c0c94aa301bcb0fdca3a4a3d10c7ffd7645", "chunk": "diff --git a/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java b/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java\nindex b469b72fd..0a770a28d 100644\n--- a/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java\n+++ b/src/main/java/org/broadinstitute/hellbender/tools/variantdb/nextgen/VetFieldEnum.java\n\n@@ -127,9 +127,14 @@ public enum VetFieldEnum {\n             if (out == null) {\n                 // Try to use non-AS version\n                 // TODO: it looks like the AS_RAW version also trims to a single decimal point??\n-                // e.g. MQRankSum=1.465 and turn it into |-0.511,1|\n+                // e.g. MQRankSum=1.465 and turn it into |1.465,1|\n                 String outNotAlleleSpecific = getAttribute(variant, GATKVCFConstants.READ_POS_RANK_SUM_KEY, null);\n-\n+                \n+                \n+                if ( outNotAlleleSpecific == null || \"\".equals(outNotAlleleSpecific) || outNotAlleleSpecific.contentEquals(\"||\") || outNotAlleleSpecific.contentEquals(\"|||\") ) {\n+                    return \"\";\n+                }\n+                \n                 if (variant.getAlleles().size() == 3) { // GT 0/1 1/1\n                     out = \"|\" + outNotAlleleSpecific + \",1|\";\n \n"}}, {"oid": "44558c0c94aa301bcb0fdca3a4a3d10c7ffd7645", "url": "https://github.com/broadinstitute/gatk/commit/44558c0c94aa301bcb0fdca3a4a3d10c7ffd7645", "message": "fixed null case", "committedDate": "2020-11-21T20:08:33Z", "type": "commit"}]}