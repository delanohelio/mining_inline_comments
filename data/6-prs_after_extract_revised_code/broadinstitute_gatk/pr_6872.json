{"pr_number": 6872, "pr_title": "optionally provide sample-map-file instead of sample-map-table", "pr_createdAt": "2020-10-08T04:32:21Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6872", "timeline": [{"oid": "4d4124cae02488196d8966ed6aad9dba7a9b209d", "url": "https://github.com/broadinstitute/gatk/commit/4d4124cae02488196d8966ed6aad9dba7a9b209d", "message": "optionally provide sample-map-file instead of sample-map-table", "committedDate": "2020-10-08T04:27:38Z", "type": "commit"}, {"oid": "34189496a8589af0c6ab6dd9a63467f7e50d7dd3", "url": "https://github.com/broadinstitute/gatk/commit/34189496a8589af0c6ab6dd9a63467f7e50d7dd3", "message": "fix variantstore test", "committedDate": "2020-10-13T18:41:57Z", "type": "commit"}, {"oid": "3f4a300d73ee5124b2cf633a0765b3dc932e3757", "url": "https://github.com/broadinstitute/gatk/commit/3f4a300d73ee5124b2cf633a0765b3dc932e3757", "message": "trying to fix test", "committedDate": "2020-10-16T21:24:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1ODgwOQ==", "url": "https://github.com/broadinstitute/gatk/pull/6872#discussion_r507758809", "bodyText": "There are two implication here -- you need permission, but also this is where the cost of using the storage API will be attributed.  This was set to the destination table project since (a) the user just created that table so they should have permission and (b) the cost for the temporary storage of that table and the cost to use the read API against it should go to to the same place.\nIf we need the extra flexibility to provide an independent project here, rather than the default I would make another argument like \"read-api-project\" or something that can be passed in to override the default of the table project", "author": "kcibul", "createdAt": "2020-10-19T13:46:01Z", "path": "src/main/java/org/broadinstitute/hellbender/utils/bigquery/StorageAPIAvroReader.java", "diffHunk": "@@ -50,7 +51,7 @@ public StorageAPIAvroReader(final TableReference tableRef, final String rowRestr\n         try {\n             this.client = BigQueryStorageClient.create();\n \n-            final String parent = String.format(\"projects/%s\", tableRef.tableProject);\n+            final String parent = String.format(\"projects/%s\", BigQueryOptions.getDefaultInstance().getProjectId());", "originalCommit": "3f4a300d73ee5124b2cf633a0765b3dc932e3757", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4cc8731c9e423f4259182f9d3e3297bdad4a1150", "chunk": "diff --git a/src/main/java/org/broadinstitute/hellbender/utils/bigquery/StorageAPIAvroReader.java b/src/main/java/org/broadinstitute/hellbender/utils/bigquery/StorageAPIAvroReader.java\nindex f4f843eb3..2320f4341 100644\n--- a/src/main/java/org/broadinstitute/hellbender/utils/bigquery/StorageAPIAvroReader.java\n+++ b/src/main/java/org/broadinstitute/hellbender/utils/bigquery/StorageAPIAvroReader.java\n\n@@ -43,15 +42,19 @@ public class StorageAPIAvroReader implements GATKAvroReader {\n     private GenericRecord nextRow = null;\n \n     public StorageAPIAvroReader(final TableReference tableRef) {\n-        this(tableRef, null);\n+        this(tableRef, null, \"\");\n     }\n \n-    public StorageAPIAvroReader(final TableReference tableRef, final String rowRestriction) {\n+    public StorageAPIAvroReader(final TableReference tableRef, String parentProjectId) {\n+        this(tableRef, null, parentProjectId);\n+    }\n+\n+    public StorageAPIAvroReader(final TableReference tableRef, final String rowRestriction, String parentProjectId) {\n \n         try {\n             this.client = BigQueryStorageClient.create();\n \n-            final String parent = String.format(\"projects/%s\", BigQueryOptions.getDefaultInstance().getProjectId());\n+            final String parent = String.format(\"projects/%s\", parentProjectId == null || parentProjectId.isEmpty() ? tableRef.tableProject : parentProjectId);\n \n             final TableReferenceProto.TableReference tableReference = TableReferenceProto.TableReference.newBuilder()\n                     .setProjectId(tableRef.tableProject)\n"}}, {"oid": "4cc8731c9e423f4259182f9d3e3297bdad4a1150", "url": "https://github.com/broadinstitute/gatk/commit/4cc8731c9e423f4259182f9d3e3297bdad4a1150", "message": "pass in read project id", "committedDate": "2020-10-19T17:01:53Z", "type": "commit"}, {"oid": "13bf40a2c6e2de7685654e56935f0b204ea24ec6", "url": "https://github.com/broadinstitute/gatk/commit/13bf40a2c6e2de7685654e56935f0b204ea24ec6", "message": "empty string -> null", "committedDate": "2020-10-19T17:59:44Z", "type": "commit"}, {"oid": "0643ae961b9546b7362bc0245f3e3d9c0adda87c", "url": "https://github.com/broadinstitute/gatk/commit/0643ae961b9546b7362bc0245f3e3d9c0adda87c", "message": "make read-project-id optional", "committedDate": "2020-10-19T18:39:34Z", "type": "commit"}]}