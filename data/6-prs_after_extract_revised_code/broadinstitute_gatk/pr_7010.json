{"pr_number": 7010, "pr_title": "Yf make BaseUtils methods more robust to handle all possible byte values", "pr_createdAt": "2020-12-18T22:11:28Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/7010", "timeline": [{"oid": "e2f80c24a389a49309efbafcd8ac9aeaeffa81f7", "url": "https://github.com/broadinstitute/gatk/commit/e2f80c24a389a49309efbafcd8ac9aeaeffa81f7", "message": "- test to show that BaseUtils.convertIUPACtoN fails for the \"top half\" of bytes, as they are interpreted as negatives.", "committedDate": "2020-12-18T22:07:12Z", "type": "commit"}, {"oid": "3768c752f55f7d57d569fd200e05b01592c04516", "url": "https://github.com/broadinstitute/gatk/commit/3768c752f55f7d57d569fd200e05b01592c04516", "message": "- fixed access to baseIndexMap and baseIndexWithIupacMap so that it converts the input byte to unsigned first.", "committedDate": "2020-12-18T22:07:12Z", "type": "commit"}, {"oid": "e991a345d9b3affd7e84cf094d83d82e866877ca", "url": "https://github.com/broadinstitute/gatk/commit/e991a345d9b3affd7e84cf094d83d82e866877ca", "message": "fixed imports", "committedDate": "2020-12-18T22:09:54Z", "type": "commit"}, {"oid": "e0357d17bc33157ff671708cc5fc66f6f3acceef", "url": "https://github.com/broadinstitute/gatk/commit/e0357d17bc33157ff671708cc5fc66f6f3acceef", "message": "let IntelliJ drive a little", "committedDate": "2020-12-18T22:11:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk0NDcxMw==", "url": "https://github.com/broadinstitute/gatk/pull/7010#discussion_r555944713", "bodyText": "Can you also add a call to BaseUtils.simpleBaseToBaseIndex() in this test method, to cover the other change you made?", "author": "droazen", "createdAt": "2021-01-12T17:23:19Z", "path": "src/test/java/org/broadinstitute/hellbender/utils/BaseUtilsUnitTest.java", "diffHunk": "@@ -27,34 +29,49 @@ public void testConvertIUPACtoN() {\n         checkBytesAreEqual(BaseUtils.convertIUPACtoN(new byte[]{'M', 'M', 'M'}, false, false), new byte[]{'N', 'N', 'N'});\n     }\n \n+    @DataProvider\n+    Iterator<Object[]> allByteValues() {\n+        final List<Object[]> bytes = new ArrayList<>(256);\n+        for (int i = 0; i < 256; i++) {\n+            final byte oneByte = (byte) i;\n+            bytes.add(new Object[]{oneByte});\n+        }\n+        return bytes.iterator();\n+    }\n+\n+    @Test(dataProvider = \"allByteValues\")\n+    public void testCanConvertAllBytes(final byte b) {\n+        BaseUtils.convertIUPACtoN(new byte[]{b, b, b}, false, false);", "originalCommit": "e0357d17bc33157ff671708cc5fc66f6f3acceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk3ODM4Mg==", "url": "https://github.com/broadinstitute/gatk/pull/7010#discussion_r555978382", "bodyText": "will do.", "author": "yfarjoun", "createdAt": "2021-01-12T18:16:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk0NDcxMw=="}], "type": "inlineReview", "revised_code": {"commit": "533439bb9a7261b2f5eda0991ce97b8b78338e66", "chunk": "diff --git a/src/test/java/org/broadinstitute/hellbender/utils/BaseUtilsUnitTest.java b/src/test/java/org/broadinstitute/hellbender/utils/BaseUtilsUnitTest.java\nindex 8a2c23c6d..e393b55c5 100644\n--- a/src/test/java/org/broadinstitute/hellbender/utils/BaseUtilsUnitTest.java\n+++ b/src/test/java/org/broadinstitute/hellbender/utils/BaseUtilsUnitTest.java\n\n@@ -44,6 +46,16 @@ public final class BaseUtilsUnitTest extends GATKBaseTest {\n         BaseUtils.convertIUPACtoN(new byte[]{b, b, b}, false, false);\n     }\n \n+    /** from the javaDoc of {@link BaseUtils#simpleBaseToBaseIndex} */\n+    private final static Integer[] possibleResults = {0, 1, 2, 3, -1};\n+    private final static Set<Integer> possibleResultsSet = new HashSet<>(Arrays.asList(possibleResults));\n+\n+    @Test(dataProvider = \"allByteValues\")\n+    public void testCanConvertToBaseIndex(final byte b) {\n+        Assert.assertTrue(possibleResultsSet.contains(BaseUtils.simpleBaseToBaseIndex(b)));\n+    }\n+\n+    // TODO: where should this be?\n     private void checkBytesAreEqual(final byte[] b1, final byte[] b2) {\n         for ( int i = 0; i < b1.length; i++ )\n             Assert.assertEquals(b1[i], b2[i]);\n"}}, {"oid": "533439bb9a7261b2f5eda0991ce97b8b78338e66", "url": "https://github.com/broadinstitute/gatk/commit/533439bb9a7261b2f5eda0991ce97b8b78338e66", "message": "Added a test for simpleBaseToBaseIndex", "committedDate": "2021-01-12T18:26:37Z", "type": "commit"}]}