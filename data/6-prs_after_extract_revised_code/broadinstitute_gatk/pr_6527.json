{"pr_number": 6527, "pr_title": "more control over scattering genomics DB in M2 pon wdl", "pr_createdAt": "2020-03-26T08:09:37Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6527", "timeline": [{"oid": "f911321d05327a2d78bc0c323ebe9bf4b6838edf", "url": "https://github.com/broadinstitute/gatk/commit/f911321d05327a2d78bc0c323ebe9bf4b6838edf", "message": "SplitIntervals dont-mix-contigs option", "committedDate": "2020-03-26T04:23:39Z", "type": "commit"}, {"oid": "2c5978e8051ab7cc0068a2861f22b791b945ce47", "url": "https://github.com/broadinstitute/gatk/commit/2c5978e8051ab7cc0068a2861f22b791b945ce47", "message": "boy scout rule", "committedDate": "2020-03-26T04:37:25Z", "type": "commit"}, {"oid": "b4fde8b11c62577814f9ecc525819f53d051ef7c", "url": "https://github.com/broadinstitute/gatk/commit/b4fde8b11c62577814f9ecc525819f53d051ef7c", "message": "ability to scatter genomics DB in M2 pon WDL", "committedDate": "2020-03-26T04:42:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg1NTM0Mg==", "url": "https://github.com/broadinstitute/gatk/pull/6527#discussion_r404855342", "bodyText": "consider using ctrl + alt + L here, to fix the spacing here", "author": "fleharty", "createdAt": "2020-04-07T14:30:51Z", "path": "src/main/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervals.java", "diffHunk": "@@ -128,8 +134,21 @@ public void onTraversalStart() {\n         final IntervalListScatterer scatterer = subdivisionMode.make();\n         final List<IntervalList> scattered = scatterer.scatter(intervalList, scatterCount);\n \n+        // optionally split interval lists that contain intervals from multiple contigs\n+        final List<IntervalList> scatteredFinal = !dontMixContigs ? scattered :\n+                scattered.stream().flatMap(il -> il.getIntervals().stream()\n+                        .collect(Collectors.groupingBy(Interval::getContig)).entrySet().stream()    // group each interval list into sublists", "originalCommit": "b4fde8b11c62577814f9ecc525819f53d051ef7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxNDA0OQ==", "url": "https://github.com/broadinstitute/gatk/pull/6527#discussion_r405214049", "bodyText": "done", "author": "davidbenjamin", "createdAt": "2020-04-08T01:56:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg1NTM0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "0ccbc8d090b1dce44f35236b8d5d6660e54e0bac", "chunk": "diff --git a/src/main/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervals.java b/src/main/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervals.java\nindex 3c3644577..6e1effe17 100644\n--- a/src/main/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervals.java\n+++ b/src/main/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervals.java\n\n@@ -138,13 +138,13 @@ public class SplitIntervals extends GATKTool {\n         final List<IntervalList> scatteredFinal = !dontMixContigs ? scattered :\n                 scattered.stream().flatMap(il -> il.getIntervals().stream()\n                         .collect(Collectors.groupingBy(Interval::getContig)).entrySet().stream()    // group each interval list into sublists\n-                .sorted(Comparator.comparingInt(entry -> sequenceDictionary.getSequenceIndex(entry.getKey())))  // sort entries by contig\n-                 .map(entry -> entry.getValue()) // discard the keys and just keep the lists of intervals\n-                .map(list -> {\n-                    final IntervalList singleContigList = new IntervalList(sequenceDictionary);\n-                    singleContigList.addall(list);\n-                    return singleContigList;\n-                })  // turn the intervals back into an IntervalList\n+                        .sorted(Comparator.comparingInt(entry -> sequenceDictionary.getSequenceIndex(entry.getKey())))  // sort entries by contig\n+                        .map(entry -> entry.getValue()) // discard the keys and just keep the lists of intervals\n+                        .map(list -> {\n+                            final IntervalList singleContigList = new IntervalList(sequenceDictionary);\n+                            singleContigList.addall(list);\n+                            return singleContigList;\n+                        })  // turn the intervals back into an IntervalList\n                 ).collect(Collectors.toList());\n \n         final DecimalFormat formatter = new DecimalFormat(\"0000\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg2Mzk3MA==", "url": "https://github.com/broadinstitute/gatk/pull/6527#discussion_r404863970", "bodyText": "I believe this causes line 19 and 20 to no longer be needed.\nimport java.nio.file.Path;\nimport java.nio.file.Paths;", "author": "fleharty", "createdAt": "2020-04-07T14:42:12Z", "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervalsIntegrationTest.java", "diffHunk": "@@ -84,33 +86,49 @@ public void testSingleScatter() {\n     public void testTwoIntervals() {\n         final int scatterCount = 5;\n         final File outputDir = createTempDir(\"output\");\n-        final String[] args = {\n-                \"-L\", \"20:1000000-2000000\",\n-                \"-L\", \"20:3000000-4000000\",\n-                \"-R\", REFERENCE.toAbsolutePath().toString(),\n-                \"-\" + SplitIntervals.SCATTER_COUNT_SHORT_NAME, Integer.toString(scatterCount),\n-                \"-O\", outputDir.getAbsolutePath()\n-        };\n+        final ArgumentsBuilder args = new ArgumentsBuilder()", "originalCommit": "b4fde8b11c62577814f9ecc525819f53d051ef7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMzkyNQ==", "url": "https://github.com/broadinstitute/gatk/pull/6527#discussion_r405213925", "bodyText": "done", "author": "davidbenjamin", "createdAt": "2020-04-08T01:56:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg2Mzk3MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "0ccbc8d090b1dce44f35236b8d5d6660e54e0bac", "url": "https://github.com/broadinstitute/gatk/commit/0ccbc8d090b1dce44f35236b8d5d6660e54e0bac", "message": "review edits", "committedDate": "2020-04-08T01:57:05Z", "type": "commit"}]}