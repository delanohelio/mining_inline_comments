{"pr_number": 6563, "pr_title": "Fix HC OOB -- Assumed ploidy two in a dumb spot -- no calls were always diploid", "pr_createdAt": "2020-04-22T15:25:29Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6563", "timeline": [{"oid": "b7078e4ec2294ce7dfd54e5cec12811fec56e83f", "url": "https://github.com/broadinstitute/gatk/commit/b7078e4ec2294ce7dfd54e5cec12811fec56e83f", "message": "Assumed ploidy two in a dumb spot -- no calls were always diploid", "committedDate": "2020-04-22T15:23:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE0OTc5NA==", "url": "https://github.com/broadinstitute/gatk/pull/6563#discussion_r413149794", "bodyText": "Don't you want to assert that the ploidy of the call is haploid here?", "author": "droazen", "createdAt": "2020-04-22T16:52:27Z", "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/haplotypecaller/HaplotypeCallerIntegrationTest.java", "diffHunk": "@@ -1341,6 +1341,27 @@ public void testLeadingDeletionInAltHaplotype() {\n         Assert.assertTrue(has28BaseDeletion);\n     }\n \n+    @Test\n+    public void testHaploidNoCall() {\n+        final File bam = new File(TEST_FILES_DIR, \"haploidNoCallSnippet.bam\");\n+\n+        final File output = createTempFile(\"output\", \".vcf\");\n+\n+        final ArgumentsBuilder args = new ArgumentsBuilder()\n+                .addInput(bam)\n+                .addReference(hg38Reference)\n+                .addInterval(\"chrY:11315390\")\n+                .add(AssemblyBasedCallerArgumentCollection.EMIT_REF_CONFIDENCE_LONG_NAME, ReferenceConfidenceMode.GVCF.toString())\n+                .add(GenotypeCalculationArgumentCollection.SAMPLE_PLOIDY_SHORT_NAME, 1)\n+                .addOutput(output);\n+        runCommandLine(args);\n+\n+        final boolean hasGQ0call = VariantContextTestUtils.streamVcf(output)\n+                .anyMatch(vc -> vc.getStart() == 11315390 && vc.getGenotype(0).hasGQ() && vc.getGenotype(0).getGQ() == 0);", "originalCommit": "b7078e4ec2294ce7dfd54e5cec12811fec56e83f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0c6c0297176801a0f9e53dcf2c2521caa6d2b6e9", "chunk": "diff --git a/src/test/java/org/broadinstitute/hellbender/tools/walkers/haplotypecaller/HaplotypeCallerIntegrationTest.java b/src/test/java/org/broadinstitute/hellbender/tools/walkers/haplotypecaller/HaplotypeCallerIntegrationTest.java\nindex 8644a3a4b..1d4a9806c 100644\n--- a/src/test/java/org/broadinstitute/hellbender/tools/walkers/haplotypecaller/HaplotypeCallerIntegrationTest.java\n+++ b/src/test/java/org/broadinstitute/hellbender/tools/walkers/haplotypecaller/HaplotypeCallerIntegrationTest.java\n\n@@ -1357,7 +1357,8 @@ public class HaplotypeCallerIntegrationTest extends CommandLineProgramTest {\n         runCommandLine(args);\n \n         final boolean hasGQ0call = VariantContextTestUtils.streamVcf(output)\n-                .anyMatch(vc -> vc.getStart() == 11315390 && vc.getGenotype(0).hasGQ() && vc.getGenotype(0).getGQ() == 0);\n+                .anyMatch(vc -> vc.getStart() == 11315390 && vc.getGenotype(0).getPloidy() == 1 &&\n+                        vc.getGenotype(0).hasGQ() && vc.getGenotype(0).getGQ() == 0);\n \n         Assert.assertTrue(hasGQ0call);\n     }\n"}}, {"oid": "0c6c0297176801a0f9e53dcf2c2521caa6d2b6e9", "url": "https://github.com/broadinstitute/gatk/commit/0c6c0297176801a0f9e53dcf2c2521caa6d2b6e9", "message": "Stricter test", "committedDate": "2020-04-22T17:08:13Z", "type": "commit"}]}