{"pr_number": 1970, "pr_title": "Close JarFile", "pr_createdAt": "2020-12-30T15:40:57Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970", "timeline": [{"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/fb5762923459b11ddcbc2b2b7d890af36aa9c5d9", "message": "Close JarFile", "committedDate": "2020-12-30T15:40:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551114491", "bodyText": "Do we need to change the url.getFile()?", "author": "anuraaga", "createdAt": "2021-01-04T04:36:53Z", "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "originalCommit": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNjYyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551206629", "bodyText": "If path contains a space then url.getFile() will leave it as %20, url.toURI().getPath() decodes it as an actual space character", "author": "laurit", "createdAt": "2021-01-04T09:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNzc0Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551207743", "bodyText": "Does it cause a problem? I'm surprised the more direct way of getting a File would cause JarFile constructor to fail, if you're seeing an exception let's add a comment above this line on what exception we are trying to prevent with the indirect code.", "author": "anuraaga", "createdAt": "2021-01-04T09:41:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIxODMwMg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551218302", "bodyText": "URL.getFile returns a String. As the url is constructed with new File(exporterJar).toURI().toURL(); which encodes space -> %20 when getting file from url we should use a way that translates %20 back to space.", "author": "laurit", "createdAt": "2021-01-04T10:01:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMyMDg3MA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551320870", "bodyText": "So it sounds like there is a problem when the path has a space. If so yeah we need to fix it :) But it's confusing, so we need at least a comment documenting the failure case. Even better is a test that fails before the change and passes after, then no one will accidentally revert and regress.\nAlternatively, we can keep the code similarly as before and file an issue - the PR title is about closing the jar file but is doing more than just that. It's ok but we need to do it completely, otherwise let's not make too many changes.", "author": "anuraaga", "createdAt": "2021-01-04T13:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU4NjM3Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551586372", "bodyText": "Added test", "author": "laurit", "createdAt": "2021-01-04T21:44:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c1c4b2268f6f35278e05c8e3273e4b7093b15bdd", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c1c4b2268f6f35278e05c8e3273e4b7093b15bdd", "message": "test loading exporter jar that has a space in the path", "committedDate": "2021-01-04T17:45:19Z", "type": "commit"}, {"oid": "4f2251b733d58f91b5832e06d755bf03606040ad", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/4f2251b733d58f91b5832e06d755bf03606040ad", "message": "change class to private", "committedDate": "2021-01-04T18:21:03Z", "type": "commit"}, {"oid": "a58a2aae9eb0677e0595b40c3c0b094d33270788", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a58a2aae9eb0677e0595b40c3c0b094d33270788", "message": "try to convince groovy compiler not to create references to java.lang.Module", "committedDate": "2021-01-04T19:25:09Z", "type": "commit"}]}