{"pr_number": 4514, "pr_title": "[CAMEL-15757] Add rawPayload support in camel-salesforce composite", "pr_createdAt": "2020-10-26T09:19:50Z", "pr_url": "https://github.com/apache/camel/pull/4514", "timeline": [{"oid": "8d988687ea19d8ece763253c26302de9351896cf", "url": "https://github.com/apache/camel/commit/8d988687ea19d8ece763253c26302de9351896cf", "message": "[CAMEL-15757] Add composite support in camel-salesforce\n\nAuthor: Ahmed Ben Salha <ahmedbensalha@hotmail.com>\nSigned off: JB Onofr\u00e9 <jbonofre@apache.org>", "committedDate": "2020-10-26T09:20:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgyMTI4Nw==", "url": "https://github.com/apache/camel/pull/4514#discussion_r511821287", "bodyText": "Please remove todos", "author": "oscerd", "createdAt": "2020-10-26T09:28:15Z", "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java", "diffHunk": "@@ -98,6 +98,14 @@ protected void processRequest(Exchange exchange) throws SalesforceException {\n                 exchange.setProperty(RESPONSE_CLASS, CreateSObjectResult.class);\n                 break;\n \n+            /**\n+             * TODO AHMEDBS", "originalCommit": "8d988687ea19d8ece763253c26302de9351896cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg3NjU3NQ==", "url": "https://github.com/apache/camel/pull/4514#discussion_r511876575", "bodyText": "I will. Thanks.", "author": "jbonofre", "createdAt": "2020-10-26T11:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgyMTI4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "db20609d0241b3164d87ac22f243a807867c68b0", "chunk": "diff --git a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java\nindex 2496e89225f..b75326086d0 100644\n--- a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java\n+++ b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java\n\n@@ -95,20 +97,21 @@ public class JsonRestProcessor extends AbstractRestProcessor {\n \n             case UPSERT_SOBJECT:\n                 // handle known response type\n-                exchange.setProperty(RESPONSE_CLASS, CreateSObjectResult.class);\n+                exchange.setProperty(RESPONSE_CLASS, UpsertSObjectResult.class);\n                 break;\n \n-            /**\n-             * TODO AHMEDBS\n-             */\n-            case COMPOSITE_SOBJECTS:\n+            case COMPOSITE_BATCH_SOBJECTS:\n                 // handle known response type\n                 exchange.setProperty(RESPONSE_CLASS, CreateSObjectResult.class);\n                 break;\n \n             case SEARCH:\n                 // handle known response type\n-                exchange.setProperty(RESPONSE_TYPE, TypeReferences.SEARCH_RESULT_TYPE);\n+                if (Double.parseDouble(endpoint.getConfiguration().getApiVersion()) >= 37.0) {\n+                    exchange.setProperty(RESPONSE_CLASS, SearchResult2.class);\n+                } else {\n+                    exchange.setProperty(RESPONSE_TYPE, TypeReferences.SEARCH_RESULT_TYPE);\n+                }\n                 break;\n \n             case RECENT:\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgyMTM3OQ==", "url": "https://github.com/apache/camel/pull/4514#discussion_r511821379", "bodyText": "Ditto", "author": "oscerd", "createdAt": "2020-10-26T09:28:25Z", "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/XmlRestProcessor.java", "diffHunk": "@@ -124,6 +124,13 @@ protected void processRequest(Exchange exchange) throws SalesforceException {\n                 exchange.setProperty(RESPONSE_CLASS, CreateSObjectResult.class);\n                 break;\n \n+            /**\n+             * TODO AHMEDBS", "originalCommit": "8d988687ea19d8ece763253c26302de9351896cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg3NjEyNg==", "url": "https://github.com/apache/camel/pull/4514#discussion_r511876126", "bodyText": "I will fix. Thanks.", "author": "jbonofre", "createdAt": "2020-10-26T10:59:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgyMTM3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "db20609d0241b3164d87ac22f243a807867c68b0", "chunk": "diff --git a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/XmlRestProcessor.java b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/XmlRestProcessor.java\nindex 23d95627be8..7801f757437 100644\n--- a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/XmlRestProcessor.java\n+++ b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/XmlRestProcessor.java\n\n@@ -121,16 +123,14 @@ public class XmlRestProcessor extends AbstractRestProcessor {\n \n             case UPSERT_SOBJECT:\n                 // handle known response type\n-                exchange.setProperty(RESPONSE_CLASS, CreateSObjectResult.class);\n+                exchange.setProperty(RESPONSE_CLASS, UpsertSObjectResult.class);\n                 break;\n \n-            /**\n-             * TODO AHMEDBS\n-             */\n-            case COMPOSITE_SOBJECTS:\n+            case COMPOSITE_BATCH_SOBJECTS:\n                 // handle known response type\n                 exchange.setProperty(RESPONSE_CLASS, CreateSObjectResult.class);\n                 break;\n+\n             case QUERY:\n             case QUERY_ALL:\n             case QUERY_MORE:\n"}}, {"oid": "db20609d0241b3164d87ac22f243a807867c68b0", "url": "https://github.com/apache/camel/commit/db20609d0241b3164d87ac22f243a807867c68b0", "message": "Add Composite Batch support on Salesforce component", "committedDate": "2020-11-27T16:10:41Z", "type": "forcePushed"}, {"oid": "7e93b3695eaf1aa310962328247000bddf4fc06f", "url": "https://github.com/apache/camel/commit/7e93b3695eaf1aa310962328247000bddf4fc06f", "message": "Add update composite sobjects support on Salesforce component", "committedDate": "2020-11-28T05:53:44Z", "type": "forcePushed"}, {"oid": "2fcea11925c80da6efade70925f3856477542116", "url": "https://github.com/apache/camel/commit/2fcea11925c80da6efade70925f3856477542116", "message": "Add update composite sobjects support on Salesforce component", "committedDate": "2020-11-29T06:12:05Z", "type": "forcePushed"}, {"oid": "8add9a2c0e752dab722316df501fb6789382f400", "url": "https://github.com/apache/camel/commit/8add9a2c0e752dab722316df501fb6789382f400", "message": "Add update composite sobjects support on Salesforce component", "committedDate": "2020-11-30T08:13:07Z", "type": "forcePushed"}, {"oid": "74d0d6f9445fb43da794021c13bdc7386d8574c7", "url": "https://github.com/apache/camel/commit/74d0d6f9445fb43da794021c13bdc7386d8574c7", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-04T06:23:25Z", "type": "forcePushed"}, {"oid": "42a9b80beb664435ea385142b61699eccfde8bdf", "url": "https://github.com/apache/camel/commit/42a9b80beb664435ea385142b61699eccfde8bdf", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-07T06:15:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ4MTcwMA==", "url": "https://github.com/apache/camel/pull/4514#discussion_r538481700", "bodyText": "Remove system out, or change into a debug LOG", "author": "davsclaus", "createdAt": "2020-12-08T15:12:49Z", "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/client/DefaultCompositeApiClient.java", "diffHunk": "@@ -93,6 +93,35 @@ public DefaultCompositeApiClient(final SalesforceEndpointConfig configuration, f\n         xStreamCompositeTree.alias(\"SObjectTreeResponse\", SObjectTreeResponse.class);\n     }\n \n+    public void submitCompositeRaw(\n+            final InputStream raw, final Map<String, List<String>> headers,\n+            final ResponseCallback<InputStream> callback,\n+            final String sObjectName, final String extId, String compositeMethod)\n+            throws SalesforceException {\n+        checkCompositeFormat(format, SObjectComposite.REQUIRED_PAYLOAD_FORMAT);\n+\n+        final String url = String.format(\"%s%s/%s/%s/%s\", versionUrl(), \"composite\", \"sobjects\", sObjectName, extId);\n+\n+        System.out.println(\"URL: \" + url);", "originalCommit": "42a9b80beb664435ea385142b61699eccfde8bdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzODMwOA==", "url": "https://github.com/apache/camel/pull/4514#discussion_r539038308", "bodyText": "+1 (was debugging)", "author": "jbonofre", "createdAt": "2020-12-09T06:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ4MTcwMA=="}], "type": "inlineReview", "revised_code": {"commit": "fe096b2a9ddbbf1bad7d0bf91255715dd0d60948", "chunk": "diff --git a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/client/DefaultCompositeApiClient.java b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/client/DefaultCompositeApiClient.java\nindex 05c3c71f161..530f0ecf062 100644\n--- a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/client/DefaultCompositeApiClient.java\n+++ b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/client/DefaultCompositeApiClient.java\n\n@@ -102,8 +102,6 @@ public class DefaultCompositeApiClient extends AbstractClientBase implements Com\n \n         final String url = String.format(\"%s%s/%s/%s/%s\", versionUrl(), \"composite\", \"sobjects\", sObjectName, extId);\n \n-        System.out.println(\"URL: \" + url);\n-\n         Request request;\n         if (compositeMethod != null) {\n             request = createRequest(compositeMethod, url, headers);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ4NDY0Mw==", "url": "https://github.com/apache/camel/pull/4514#discussion_r538484643", "bodyText": "Can this be used both on consumer or producer? If not then add label to mark it as consumer or producer only.", "author": "davsclaus", "createdAt": "2020-12-08T15:15:32Z", "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceEndpointConfig.java", "diffHunk": "@@ -126,6 +127,8 @@\n     @UriParam\n     private String apexMethod;\n     @UriParam\n+    private String compositeMethod;", "originalCommit": "42a9b80beb664435ea385142b61699eccfde8bdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzODc4Mw==", "url": "https://github.com/apache/camel/pull/4514#discussion_r539038783", "bodyText": "Like apexMethod it's consumer only for now. Let me improve this (we should update apexMethod as well but it's another PR).", "author": "jbonofre", "createdAt": "2020-12-09T06:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ4NDY0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "962a40229022d86a1087aa1402bbd4c167541e5b", "chunk": "diff --git a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceEndpointConfig.java b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceEndpointConfig.java\nindex 46fc64bf62d..49603f2a54f 100644\n--- a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceEndpointConfig.java\n+++ b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceEndpointConfig.java\n\n@@ -126,9 +126,9 @@ public class SalesforceEndpointConfig implements Cloneable {\n     private String sObjectSearch;\n     @UriParam\n     private String apexMethod;\n-    @UriParam\n+    @UriParam(label = \"producer\")\n     private String compositeMethod;\n-    @UriParam\n+    @UriParam(label = \"producer\")\n     private String apexUrl;\n     @UriParam\n     private Map<String, Object> apexQueryParams;\n"}}, {"oid": "fe096b2a9ddbbf1bad7d0bf91255715dd0d60948", "url": "https://github.com/apache/camel/commit/fe096b2a9ddbbf1bad7d0bf91255715dd0d60948", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-09T13:33:13Z", "type": "forcePushed"}, {"oid": "1c451e5cebabbb8203f086f31963c4e4088d0905", "url": "https://github.com/apache/camel/commit/1c451e5cebabbb8203f086f31963c4e4088d0905", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-09T14:22:12Z", "type": "forcePushed"}, {"oid": "962a40229022d86a1087aa1402bbd4c167541e5b", "url": "https://github.com/apache/camel/commit/962a40229022d86a1087aa1402bbd4c167541e5b", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-09T14:43:07Z", "type": "forcePushed"}, {"oid": "22162395419fa2e43c7e4d9455ba755a461818b0", "url": "https://github.com/apache/camel/commit/22162395419fa2e43c7e4d9455ba755a461818b0", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-09T14:44:57Z", "type": "commit"}, {"oid": "22162395419fa2e43c7e4d9455ba755a461818b0", "url": "https://github.com/apache/camel/commit/22162395419fa2e43c7e4d9455ba755a461818b0", "message": "[CAMEL-15757] Add rawPayload support on camel-salesforce composite", "committedDate": "2020-12-09T14:44:57Z", "type": "forcePushed"}]}