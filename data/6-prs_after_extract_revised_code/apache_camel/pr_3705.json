{"pr_number": 3705, "pr_title": "CAMEL-14833 camel-tika: enhance TikaProducer to be easoly extensible", "pr_createdAt": "2020-04-02T11:16:26Z", "pr_url": "https://github.com/apache/camel/pull/3705", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0MzYxOA==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402243618", "bodyText": "I just realized that setProperties should be done on the endpoint not on the configuration in order to avoid reflection, is that correct @oscerd ?", "author": "omarsmak", "createdAt": "2020-04-02T11:32:15Z", "path": "components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaComponent.java", "diffHunk": "@@ -38,6 +38,10 @@ protected Endpoint createEndpoint(String uri, String remaining, Map<String, Obje\n             tikaConfiguration.setTikaConfig(config);\r\n         }\r\n         tikaConfiguration.setOperation(new URI(uri).getHost());\r", "originalCommit": "225528a48bd20af13a258c831e75848f408d16c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0NDUyMA==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402244520", "bodyText": "Yes, we missed that one, I guess @davsclaus", "author": "oscerd", "createdAt": "2020-04-02T11:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0MzYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0NjUyNg==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402246526", "bodyText": "Yes see the other components how its done", "author": "davsclaus", "createdAt": "2020-04-02T11:38:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0MzYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4OTM2OQ==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402289369", "bodyText": "@omarsmak I've changed call of setProperties to invoked on endpoint (other components do it that way), is it correct now?", "author": "JiriOndrusek", "createdAt": "2020-04-02T12:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0MzYxOA=="}], "type": "inlineReview", "revised_code": {"commit": "72147d76e96908c2cd3e9992c1518c294a31ee65", "chunk": "diff --git a/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaComponent.java b/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaComponent.java\nindex 87a99413a50..d4492d6b8d2 100644\n--- a/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaComponent.java\n+++ b/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaComponent.java\n\n@@ -32,16 +32,18 @@ public class TikaComponent extends DefaultComponent {\n     @Override\n     protected Endpoint createEndpoint(String uri, String remaining, Map<String, Object> parameters) throws Exception {\n         TikaConfiguration tikaConfiguration = new TikaConfiguration();\n-        setProperties(tikaConfiguration, parameters);\n+\n         TikaConfig config = resolveAndRemoveReferenceParameter(parameters, TIKA_CONFIG, TikaConfig.class);\n         if (config != null) {\n             tikaConfiguration.setTikaConfig(config);\n         }\n         tikaConfiguration.setOperation(new URI(uri).getHost());\n-        return createEndpoint(uri, tikaConfiguration);\n+        TikaEndpoint endpoint = createEndpoint(uri, tikaConfiguration);\n+        setProperties(endpoint, parameters);\n+        return endpoint;\n     }\n \n-    protected Endpoint createEndpoint(String uri, TikaConfiguration tikaConfiguration) {\n+    protected TikaEndpoint createEndpoint(String uri, TikaConfiguration tikaConfiguration) {\n         return new TikaEndpoint(uri, this, tikaConfiguration);\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2OTQ3Mw==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402269473", "bodyText": "It seams to be a related to IDE, but looks like we don't need this for all fields.", "author": "dmvolod", "createdAt": "2020-04-02T12:21:20Z", "path": "components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java", "diffHunk": "@@ -59,12 +59,24 @@\n     private final String encoding;\r\n \r\n     public TikaProducer(TikaEndpoint endpoint) {\r\n+        this(endpoint, true, null);\r\n+    }\r\n+\r\n+    public TikaProducer(TikaEndpoint endpoint, Parser parser) {\r\n+        this(endpoint, parser == null, parser);\r\n+    }\r\n+\r\n+    private TikaProducer(TikaEndpoint endpoint, boolean autodetectParser, Parser parser) {\r\n         super(endpoint);\r\n         this.tikaConfiguration = endpoint.getTikaConfiguration();\r\n         this.encoding = this.tikaConfiguration.getTikaParseOutputEncoding();\r\n         TikaConfig config = this.tikaConfiguration.getTikaConfig();\r\n-        this.parser = new AutoDetectParser(config);\r\n         this.detector = config.getDetector();\r", "originalCommit": "225528a48bd20af13a258c831e75848f408d16c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5MjYzOQ==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402292639", "bodyText": "@dmvolod  yes, 'this.' prefixes are not required. From my point of view it helps to orientate in the code, developer immediately know, that these fields are on 'this' instance. It also helps in future, if someone adds a new parameter with the same name, it could prevent issue with initialization of the bad property.\nBut I have no problem with removal of 'this' on all fields (I haven't changed that) should I remove it?", "author": "JiriOndrusek", "createdAt": "2020-04-02T12:59:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2OTQ3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "bf52a18f9308f6a648dfa8f79831bbe1756aead4", "chunk": "diff --git a/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java b/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java\nindex b58f80c03d9..09177dee9a5 100644\n--- a/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java\n+++ b/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java\n\n@@ -59,20 +59,16 @@ public class TikaProducer extends DefaultProducer {\n     private final String encoding;\n \n     public TikaProducer(TikaEndpoint endpoint) {\n-        this(endpoint, true, null);\n+        this(endpoint,  null);\n     }\n \n     public TikaProducer(TikaEndpoint endpoint, Parser parser) {\n-        this(endpoint, parser == null, parser);\n-    }\n-\n-    private TikaProducer(TikaEndpoint endpoint, boolean autodetectParser, Parser parser) {\n         super(endpoint);\n         this.tikaConfiguration = endpoint.getTikaConfiguration();\n         this.encoding = this.tikaConfiguration.getTikaParseOutputEncoding();\n         TikaConfig config = this.tikaConfiguration.getTikaConfig();\n         this.detector = config.getDetector();\n-        if (autodetectParser) {\n+        if (parser == null) {\n             this.parser = new AutoDetectParser(this.tikaConfiguration.getTikaConfig());\n         } else {\n             this.parser = parser;\n"}}, {"oid": "72147d76e96908c2cd3e9992c1518c294a31ee65", "url": "https://github.com/apache/camel/commit/72147d76e96908c2cd3e9992c1518c294a31ee65", "message": "CAMEL-14833 camel-tika: enhance TikaProducer to use different tika parser instead of AutodetectParse", "committedDate": "2020-04-02T12:52:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjQ0MQ==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402306441", "bodyText": "I think you can replace autodetectParser with parser == null and eliminate the three-args constructor.", "author": "ppalaga", "createdAt": "2020-04-02T13:20:36Z", "path": "components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java", "diffHunk": "@@ -59,12 +59,24 @@\n     private final String encoding;\r\n \r\n     public TikaProducer(TikaEndpoint endpoint) {\r\n+        this(endpoint, true, null);\r\n+    }\r\n+\r\n+    public TikaProducer(TikaEndpoint endpoint, Parser parser) {\r\n+        this(endpoint, parser == null, parser);\r\n+    }\r\n+\r\n+    private TikaProducer(TikaEndpoint endpoint, boolean autodetectParser, Parser parser) {\r\n         super(endpoint);\r\n         this.tikaConfiguration = endpoint.getTikaConfiguration();\r\n         this.encoding = this.tikaConfiguration.getTikaParseOutputEncoding();\r\n         TikaConfig config = this.tikaConfiguration.getTikaConfig();\r\n-        this.parser = new AutoDetectParser(config);\r\n         this.detector = config.getDetector();\r\n+        if (autodetectParser) {\r", "originalCommit": "72147d76e96908c2cd3e9992c1518c294a31ee65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMDU0Ng==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402310546", "bodyText": "@ppalaga Unfortunately I can not do that, it will cause conflict with existing public constructor (https://github.com/apache/camel/pull/3705/files#diff-1383e03de9c8ef89d7546ab133b8801cR65). The only reason of having 3 args constructor is to keep property 'this.parser' final.", "author": "JiriOndrusek", "createdAt": "2020-04-02T13:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMTg3Mg==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402311872", "bodyText": "I'll missed a small detail, I'll fix it in that way", "author": "JiriOndrusek", "createdAt": "2020-04-02T13:28:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxNTM4NQ==", "url": "https://github.com/apache/camel/pull/3705#discussion_r402315385", "bodyText": "@ppalaga thanks for pointing this out. (I've over-combined so easy thing). It's changed now.", "author": "JiriOndrusek", "createdAt": "2020-04-02T13:32:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjQ0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "bf52a18f9308f6a648dfa8f79831bbe1756aead4", "chunk": "diff --git a/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java b/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java\nindex b58f80c03d9..09177dee9a5 100644\n--- a/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java\n+++ b/components/camel-tika/src/main/java/org/apache/camel/component/tika/TikaProducer.java\n\n@@ -59,20 +59,16 @@ public class TikaProducer extends DefaultProducer {\n     private final String encoding;\n \n     public TikaProducer(TikaEndpoint endpoint) {\n-        this(endpoint, true, null);\n+        this(endpoint,  null);\n     }\n \n     public TikaProducer(TikaEndpoint endpoint, Parser parser) {\n-        this(endpoint, parser == null, parser);\n-    }\n-\n-    private TikaProducer(TikaEndpoint endpoint, boolean autodetectParser, Parser parser) {\n         super(endpoint);\n         this.tikaConfiguration = endpoint.getTikaConfiguration();\n         this.encoding = this.tikaConfiguration.getTikaParseOutputEncoding();\n         TikaConfig config = this.tikaConfiguration.getTikaConfig();\n         this.detector = config.getDetector();\n-        if (autodetectParser) {\n+        if (parser == null) {\n             this.parser = new AutoDetectParser(this.tikaConfiguration.getTikaConfig());\n         } else {\n             this.parser = parser;\n"}}, {"oid": "bf52a18f9308f6a648dfa8f79831bbe1756aead4", "url": "https://github.com/apache/camel/commit/bf52a18f9308f6a648dfa8f79831bbe1756aead4", "message": "CAMEL-14833 camel-tika: enhance TikaProducer to use different tika parser instead of AutodetectParse", "committedDate": "2020-04-02T13:30:31Z", "type": "commit"}, {"oid": "bf52a18f9308f6a648dfa8f79831bbe1756aead4", "url": "https://github.com/apache/camel/commit/bf52a18f9308f6a648dfa8f79831bbe1756aead4", "message": "CAMEL-14833 camel-tika: enhance TikaProducer to use different tika parser instead of AutodetectParse", "committedDate": "2020-04-02T13:30:31Z", "type": "forcePushed"}]}