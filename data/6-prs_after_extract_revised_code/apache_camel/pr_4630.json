{"pr_number": 4630, "pr_title": "CAMEL-15866: salesforce: Support new SOSL search result", "pr_createdAt": "2020-11-19T03:57:03Z", "pr_url": "https://github.com/apache/camel/pull/4630", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwODA4OQ==", "url": "https://github.com/apache/camel/pull/4630#discussion_r526608089", "bodyText": "Please add license", "author": "oscerd", "createdAt": "2020-11-19T05:45:08Z", "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/api/dto/SearchResult2.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.apache.camel.component.salesforce.api.dto;", "originalCommit": "470c5a0cef14095ade83c4a8c3bdecd26e676e95", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "44f3b7036467183af8163d411672819d4bb5e1f5", "chunk": "diff --git a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/api/dto/SearchResult2.java b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/api/dto/SearchResult2.java\nindex 1146973012e..3513ff312c9 100644\n--- a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/api/dto/SearchResult2.java\n+++ b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/api/dto/SearchResult2.java\n\n@@ -1,3 +1,19 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n package org.apache.camel.component.salesforce.api.dto;\n \n import java.util.List;\n"}}, {"oid": "44f3b7036467183af8163d411672819d4bb5e1f5", "url": "https://github.com/apache/camel/commit/44f3b7036467183af8163d411672819d4bb5e1f5", "message": "CAMEL-15866: salesforce: Support new SOSL search result", "committedDate": "2020-11-19T14:03:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA==", "url": "https://github.com/apache/camel/pull/4630#discussion_r526985194", "bodyText": "can we somewhat move the version 37.0 number into a constant?", "author": "omarsmak", "createdAt": "2020-11-19T15:39:03Z", "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java", "diffHunk": "@@ -100,7 +101,11 @@ protected void processRequest(Exchange exchange) throws SalesforceException {\n \n             case SEARCH:\n                 // handle known response type\n-                exchange.setProperty(RESPONSE_TYPE, TypeReferences.SEARCH_RESULT_TYPE);\n+                if (Double.parseDouble(endpoint.getConfiguration().getApiVersion()) >= 37.0) {", "originalCommit": "44f3b7036467183af8163d411672819d4bb5e1f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5NDI4Mg==", "url": "https://github.com/apache/camel/pull/4630#discussion_r526994282", "bodyText": "I considered that, but couldn't think of a good name. There's no concept that symbolizes any given version. Open to suggestions.", "author": "jeremyross", "createdAt": "2020-11-19T15:50:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwOTQ1OA==", "url": "https://github.com/apache/camel/pull/4630#discussion_r527009458", "bodyText": "True, another option is, we can create a common function in the AbstractRestProcessor that sets response type property for Json and XML, e.g:\nprotected void setSearchResponseType(Object fallbackType) {\nif (Double.parseDouble(endpoint.getConfiguration().getApiVersion()) >= 37.0) {\n       exchange.setProperty(RESPONSE_TYPE, SearchResult2.class);\n} else {\n       exchange.setProperty(RESPONSE_TYPE, fallbackType);\n     }\n}\n\nAnd then called either setSearchResponseType(TypeReferences.SEARCH_RESULT_TYPE) or setSearchResponseType(SearchResults.class). WDYT?", "author": "omarsmak", "createdAt": "2020-11-19T16:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyODE2MQ==", "url": "https://github.com/apache/camel/pull/4630#discussion_r527028161", "bodyText": "Hmm. JsonRestProcessor sets the RESPONSE_TYPE property, whereas XmlRestProcessor sets the RESPONSE_CLASS property. And for  < 37.0, the type is different. I'm struggling to find enough in common to extract.", "author": "jeremyross", "createdAt": "2020-11-19T16:34:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzNjI5Mw==", "url": "https://github.com/apache/camel/pull/4630#discussion_r527036293", "bodyText": "But I'm glad you asked this, because I now realize that JsonRestProcessor should be using RESPONSE_CLASS for SearchResult2.", "author": "jeremyross", "createdAt": "2020-11-19T16:45:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzNzI0Mg==", "url": "https://github.com/apache/camel/pull/4630#discussion_r527037242", "bodyText": "ah sorry didn't realize that, you are right, only the version need to be extracted. Anyway, if you can't find a some meaningful naming, is also fine like this as long not much of duplications happening, just wanted to avoid the magic number ;)", "author": "omarsmak", "createdAt": "2020-11-19T16:46:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0MDI2NQ==", "url": "https://github.com/apache/camel/pull/4630#discussion_r527040265", "bodyText": "I know, it bothers me too. But I think public static final String API_VERSION_37_0 = \"37.0\"; would bother me more. It brings nothing to the party, ya know?", "author": "jeremyross", "createdAt": "2020-11-19T16:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0MTk0OQ==", "url": "https://github.com/apache/camel/pull/4630#discussion_r527041949", "bodyText": "yeah I know, is fine then", "author": "omarsmak", "createdAt": "2020-11-19T16:52:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4NTE5NA=="}], "type": "inlineReview", "revised_code": {"commit": "da05b9346284540eb18587413c141adff23586cf", "chunk": "diff --git a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java\nindex ec2f60defd7..c3cdec80671 100644\n--- a/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java\n+++ b/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/processor/JsonRestProcessor.java\n\n@@ -102,7 +102,7 @@ public class JsonRestProcessor extends AbstractRestProcessor {\n             case SEARCH:\n                 // handle known response type\n                 if (Double.parseDouble(endpoint.getConfiguration().getApiVersion()) >= 37.0) {\n-                    exchange.setProperty(RESPONSE_TYPE, SearchResult2.class);\n+                    exchange.setProperty(RESPONSE_CLASS, SearchResult2.class);\n                 } else {\n                     exchange.setProperty(RESPONSE_TYPE, TypeReferences.SEARCH_RESULT_TYPE);\n                 }\n"}}, {"oid": "da05b9346284540eb18587413c141adff23586cf", "url": "https://github.com/apache/camel/commit/da05b9346284540eb18587413c141adff23586cf", "message": "CAMEL-15866: salesforce: Support new SOSL search result", "committedDate": "2020-11-19T16:48:17Z", "type": "commit"}, {"oid": "da05b9346284540eb18587413c141adff23586cf", "url": "https://github.com/apache/camel/commit/da05b9346284540eb18587413c141adff23586cf", "message": "CAMEL-15866: salesforce: Support new SOSL search result", "committedDate": "2020-11-19T16:48:17Z", "type": "forcePushed"}]}