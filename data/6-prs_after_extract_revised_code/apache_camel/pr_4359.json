{"pr_number": 4359, "pr_title": "CAMEL-15626: Use StringBuilder instead of StringBuffer", "pr_createdAt": "2020-10-04T16:28:50Z", "pr_url": "https://github.com/apache/camel/pull/4359", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2NTg1MA==", "url": "https://github.com/apache/camel/pull/4359#discussion_r499265850", "bodyText": "StringBuffer is here intentionally because it is mutable and ensures locks. As aggregate method can be called in many threads in parallel, you need to ensure locking in different way (synchronized block, ReentrantLock, ...) before changing this to StringBuilder, otherwise the output will be corrupted.", "author": "bedlaj", "createdAt": "2020-10-04T16:50:26Z", "path": "core/camel-base/src/main/java/org/apache/camel/processor/aggregate/StringAggregationStrategy.java", "diffHunk": "@@ -63,12 +63,12 @@ public StringAggregationStrategy pick(Expression expression) {\n      */\n     @Override\n     public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {\n-        StringBuffer result; // Aggregate in StringBuffer instead of StringBuilder, to make it thread safe", "originalCommit": "cd791ce84716d5fb505bcc98b9b7d7036ac7e334", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2NzQ4NA==", "url": "https://github.com/apache/camel/pull/4359#discussion_r499267484", "bodyText": "Ok, so maybe it's just simpler to keep StringBuffer... I removed the changes on that file. Thanks", "author": "mcserra", "createdAt": "2020-10-04T17:08:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2NTg1MA=="}], "type": "inlineReview", "revised_code": {"commit": "ac7a71c372f6665207247265b63bb2e2c66d6cd8", "chunk": "diff --git a/core/camel-base/src/main/java/org/apache/camel/processor/aggregate/StringAggregationStrategy.java b/core/camel-base/src/main/java/org/apache/camel/processor/aggregate/StringAggregationStrategy.java\nindex 624d64acade..20173b068a9 100644\n--- a/core/camel-base/src/main/java/org/apache/camel/processor/aggregate/StringAggregationStrategy.java\n+++ b/core/camel-base/src/main/java/org/apache/camel/processor/aggregate/StringAggregationStrategy.java\n\n@@ -63,12 +63,12 @@ public class StringAggregationStrategy implements AggregationStrategy {\n      */\n     @Override\n     public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {\n-        StringBuilder result;\n+        StringBuffer result; // Aggregate in StringBuffer instead of StringBuilder, to make it thread safe\n         StringBuilder value = new StringBuilder();\n         if (oldExchange == null) {\n-            result = getStringBuilder(newExchange); // do not prepend delimiter for first invocation\n+            result = getStringBuffer(newExchange); // do not prepend delimiter for first invocation\n         } else {\n-            result = getStringBuilder(oldExchange);\n+            result = getStringBuffer(oldExchange);\n             value.append(delimiter);\n         }\n \n"}}, {"oid": "ac7a71c372f6665207247265b63bb2e2c66d6cd8", "url": "https://github.com/apache/camel/commit/ac7a71c372f6665207247265b63bb2e2c66d6cd8", "message": "CAMEL-15626: Use StringBuilder instead of StringBuffer\n\nSigned-off-by: Miguel Serra <serramiguel1@gmail.com>", "committedDate": "2020-10-04T17:06:48Z", "type": "commit"}, {"oid": "ac7a71c372f6665207247265b63bb2e2c66d6cd8", "url": "https://github.com/apache/camel/commit/ac7a71c372f6665207247265b63bb2e2c66d6cd8", "message": "CAMEL-15626: Use StringBuilder instead of StringBuffer\n\nSigned-off-by: Miguel Serra <serramiguel1@gmail.com>", "committedDate": "2020-10-04T17:06:48Z", "type": "forcePushed"}]}