{"pr_number": 518, "pr_title": "Change order that is used to connect to peers (DNM, seeds, dns seeders)", "pr_createdAt": "2020-10-01T14:45:25Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/518", "timeline": [{"oid": "50eaa04538929040a8f5aa0307160e731cd95a91", "url": "https://github.com/dashevo/dash-wallet/commit/50eaa04538929040a8f5aa0307160e731cd95a91", "message": "Change order that is used to connect to peers (DNM, seeds, dns seeders)", "committedDate": "2020-10-01T14:17:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3Njg0MQ==", "url": "https://github.com/dashevo/dash-wallet/pull/518#discussion_r498576841", "bodyText": "Since 16 is used twice, it could be stored in a variable to ensure consistent usage through the code.", "author": "sambarboza", "createdAt": "2020-10-02T00:48:25Z", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -518,34 +518,36 @@ private void check() {\n                         }\n \n                         if (!connectTrustedPeerOnly) {\n+                            // First use the masternode list that is included\n                             try {\n-                                peers.addAll(\n-                                        Arrays.asList(normalPeerDiscovery.getPeers(services, timeoutValue, timeoutUnit)));\n+                                SimplifiedMasternodeList mnlist = org.bitcoinj.core.Context.get().masternodeListManager.getListAtChainTip();\n+                                MasternodePeerDiscovery discovery = new MasternodePeerDiscovery(mnlist);\n+                                peers.addAll(Arrays.asList(discovery.getPeers(services, timeoutValue, timeoutUnit)));\n                             } catch (PeerDiscoveryException x) {\n-                                //swallow and continue with another method of connection.\n-                                log.info(\"DNS peer discovery failed: \"+ x.getMessage());\n-                                if(x.getCause() != null)\n-                                    log.info(  \"cause:  \" + x.getCause().getMessage());\n+                                //swallow and continue with another method of connection\n+                                log.info(\"DMN List peer discovery failed: \"+ x.getMessage());\n                             }\n-                            if(peers.size() < 10) {\n-                                log.info(\"DNS peer discovery returned less than 10 nodes.  Adding DMN peers to the list to increase connections\");\n-                                try {\n-                                    SimplifiedMasternodeList mnlist = org.bitcoinj.core.Context.get().masternodeListManager.getListAtChainTip();\n-                                    MasternodePeerDiscovery discovery = new MasternodePeerDiscovery(mnlist);\n-                                    peers.addAll(Arrays.asList(discovery.getPeers(services, timeoutValue, timeoutUnit)));\n-                                } catch (PeerDiscoveryException x) {\n-                                    //swallow and continue with another method of connection\n-                                    log.info(\"DMN List peer discovery failed: \"+ x.getMessage());\n \n+                            if(peers.size() < 16) {", "originalCommit": "50eaa04538929040a8f5aa0307160e731cd95a91", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4ODQ0OA==", "url": "https://github.com/dashevo/dash-wallet/pull/518#discussion_r498588448", "bodyText": "Good Call.", "author": "HashEngineering", "createdAt": "2020-10-02T01:52:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4OTMzMA==", "url": "https://github.com/dashevo/dash-wallet/pull/518#discussion_r498589330", "bodyText": "Fixed here:  12d121d", "author": "HashEngineering", "createdAt": "2020-10-02T01:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3Njg0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "12d121db2d55fb6ba109ca5f6b81bf0de8355a0d", "chunk": "diff --git a/wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java b/wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java\nindex e8a721816..df93e2602 100644\n--- a/wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java\n+++ b/wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java\n\n@@ -528,7 +528,7 @@ public class BlockchainServiceImpl extends LifecycleService implements Blockchai\n                                 log.info(\"DMN List peer discovery failed: \"+ x.getMessage());\n                             }\n \n-                            if(peers.size() < 16) {\n+                            if(peers.size() < MINIMUM_PEER_COUNT) {\n                                 if (Constants.NETWORK_PARAMETERS.getAddrSeeds() != null) {\n                                     log.info(\"DNM peer discovery returned less than 16 nodes.  Adding seed peers to the list to increase connections\");\n                                     peers.addAll(Arrays.asList(seedPeerDiscovery.getPeers(services, timeoutValue, timeoutUnit)));\n"}}, {"oid": "12d121db2d55fb6ba109ca5f6b81bf0de8355a0d", "url": "https://github.com/dashevo/dash-wallet/commit/12d121db2d55fb6ba109ca5f6b81bf0de8355a0d", "message": "Use constant for minimum peer count", "committedDate": "2020-10-02T01:53:54Z", "type": "commit"}]}