{"pr_number": 500, "pr_title": "NMA-595: Save backup file without PIN", "pr_createdAt": "2020-09-01T16:14:59Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/500", "timeline": [{"oid": "e29bd6d47273515d4e728e6b4c0a4c4a74d5436f", "url": "https://github.com/dashevo/dash-wallet/commit/e29bd6d47273515d4e728e6b4c0a4c4a74d5436f", "message": "BackupWalletDialogFragment: Save backup file without PIN", "committedDate": "2020-09-01T16:10:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk4NDM1MA==", "url": "https://github.com/dashevo/dash-wallet/pull/500#discussion_r481984350", "bodyText": "This could (or rather should) be moved to BackupWalletDialogFragment.onCreate(...) as a one-time operation.", "author": "tomasz-ludek", "createdAt": "2020-09-02T11:02:59Z", "path": "wallet/src/de/schildbach/wallet/ui/BackupWalletDialogFragment.java", "diffHunk": "@@ -232,7 +248,39 @@ private void updateView() {\n         positiveButton.setEnabled(hasPassword && hasPasswordAgain);\n     }\n \n-    private void backupWallet(final String password) {\n+    private void backupWallet(final String backupPassword) {\n+        try {\n+            final Protos.Wallet walletProto = new WalletProtobufSerializer().walletToProto(wallet);\n+\n+            SecurityGuard securityGuard = new SecurityGuard();\n+            if (wallet.isEncrypted()) {\n+                String walletPassword = securityGuard.retrievePassword();\n+                backgroundThread = new HandlerThread(\"backgroundThread\", Process.THREAD_PRIORITY_BACKGROUND);\n+                backgroundThread.start();\n+                backgroundHandler = new Handler(backgroundThread.getLooper());", "originalCommit": "e29bd6d47273515d4e728e6b4c0a4c4a74d5436f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4NTUzNA==", "url": "https://github.com/dashevo/dash-wallet/pull/500#discussion_r483085534", "bodyText": "fixed here:  e03147e", "author": "HashEngineering", "createdAt": "2020-09-03T15:56:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk4NDM1MA=="}], "type": "inlineReview", "revised_code": {"commit": "e03147e597783a6ba624e5c53b9d6b44be3e4c0e", "chunk": "diff --git a/wallet/src/de/schildbach/wallet/ui/BackupWalletDialogFragment.java b/wallet/src/de/schildbach/wallet/ui/BackupWalletDialogFragment.java\nindex cf40afb33..4fae9cab0 100644\n--- a/wallet/src/de/schildbach/wallet/ui/BackupWalletDialogFragment.java\n+++ b/wallet/src/de/schildbach/wallet/ui/BackupWalletDialogFragment.java\n\n@@ -255,9 +258,6 @@ public class BackupWalletDialogFragment extends DialogFragment {\n             SecurityGuard securityGuard = new SecurityGuard();\n             if (wallet.isEncrypted()) {\n                 String walletPassword = securityGuard.retrievePassword();\n-                backgroundThread = new HandlerThread(\"backgroundThread\", Process.THREAD_PRIORITY_BACKGROUND);\n-                backgroundThread.start();\n-                backgroundHandler = new Handler(backgroundThread.getLooper());\n                 final Wallet decryptedWallet = new WalletProtobufSerializer().readWallet(Constants.NETWORK_PARAMETERS, null, walletProto);\n                 new DeriveKeyTask(backgroundHandler, application.scryptIterationsTarget()) {\n                     @Override\n"}}, {"oid": "e03147e597783a6ba624e5c53b9d6b44be3e4c0e", "url": "https://github.com/dashevo/dash-wallet/commit/e03147e597783a6ba624e5c53b9d6b44be3e4c0e", "message": "BackupWalletDialogFragment: Move init background stuff to onCreateDialog", "committedDate": "2020-09-02T14:48:20Z", "type": "commit"}]}