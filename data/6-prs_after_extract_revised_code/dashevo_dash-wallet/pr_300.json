{"pr_number": 300, "pr_title": "Redesign: Fix View Recovery Phrase Flow and other security related flows [NMA-299]", "pr_createdAt": "2020-01-10T00:08:36Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/300", "timeline": [{"oid": "e94f9970d6831f5f08525933cac34d20b1e4515b", "url": "https://github.com/dashevo/dash-wallet/commit/e94f9970d6831f5f08525933cac34d20b1e4515b", "message": "First Attempt", "committedDate": "2020-01-08T06:45:46Z", "type": "commit"}, {"oid": "5516658aabe13222984c309dfa031e518b031ecb", "url": "https://github.com/dashevo/dash-wallet/commit/5516658aabe13222984c309dfa031e518b031ecb", "message": "Open up CheckPinDialog and its view model classes to be extended", "committedDate": "2020-01-09T05:21:59Z", "type": "commit"}, {"oid": "d7c98dde802356ef7ae9467137e023fb2c2136d6", "url": "https://github.com/dashevo/dash-wallet/commit/d7c98dde802356ef7ae9467137e023fb2c2136d6", "message": "Add DecryptSeedWithPinDialog and its view model classes", "committedDate": "2020-01-09T05:28:06Z", "type": "commit"}, {"oid": "c79c99e5f6af695a9cf0c051c281ebead6a6e851", "url": "https://github.com/dashevo/dash-wallet/commit/c79c99e5f6af695a9cf0c051c281ebead6a6e851", "message": "Add ViewSeedActivity (view recovery phrase)", "committedDate": "2020-01-09T06:02:05Z", "type": "commit"}, {"oid": "55e6b946a08b299c433707e6d0975c0d31423d01", "url": "https://github.com/dashevo/dash-wallet/commit/55e6b946a08b299c433707e6d0975c0d31423d01", "message": "Connect Security -> View Recovery Phrase to the new flow", "committedDate": "2020-01-09T06:04:08Z", "type": "commit"}, {"oid": "82d599e93069ea3c5155efc57437d76e49bbaf98", "url": "https://github.com/dashevo/dash-wallet/commit/82d599e93069ea3c5155efc57437d76e49bbaf98", "message": "Undo changes to VerifySeedActivity since ViewSeedActivity will be used", "committedDate": "2020-01-09T06:06:36Z", "type": "commit"}, {"oid": "86279682c92f55eda4166ecdd91bfa57c0b503e5", "url": "https://github.com/dashevo/dash-wallet/commit/86279682c92f55eda4166ecdd91bfa57c0b503e5", "message": "Use new DecryptSeedWithPinDialog to start Secure Now flow", "committedDate": "2020-01-09T06:08:54Z", "type": "commit"}, {"oid": "d43568333b4ffee1008525a3e399b2bfca8f4118", "url": "https://github.com/dashevo/dash-wallet/commit/d43568333b4ffee1008525a3e399b2bfca8f4118", "message": "Allow for the fingerprint to be used to decrypt a seed\n\nopen up a few more items in CheckPinDialog as protected", "committedDate": "2020-01-09T23:05:38Z", "type": "commit"}, {"oid": "17347c4a2752aa80fe2814f60465736e9f971bc7", "url": "https://github.com/dashevo/dash-wallet/commit/17347c4a2752aa80fe2814f60465736e9f971bc7", "message": "Fix Backup Wallet to File on first time\n\nIf the app is newly installed, the Back up Wallet to File command\nwill ask for the permissions and then require the user to press the\nBackup Wallet to File button again.", "committedDate": "2020-01-09T23:22:03Z", "type": "commit"}, {"oid": "f90c720bc62a4b9f634a32f85c712540a15de5ee", "url": "https://github.com/dashevo/dash-wallet/commit/f90c720bc62a4b9f634a32f85c712540a15de5ee", "message": "Put the advanced security setting being a CheckPinDialog", "committedDate": "2020-01-09T23:23:06Z", "type": "commit"}, {"oid": "e07da0de94210d12ff7a7aa8a3d7026dfca99b10", "url": "https://github.com/dashevo/dash-wallet/commit/e07da0de94210d12ff7a7aa8a3d7026dfca99b10", "message": "Correct grammar: Backup vs Back Up", "committedDate": "2020-01-09T23:59:27Z", "type": "commit"}, {"oid": "e56eb24c3d4d3a235c7d1fa78213554127d72cb6", "url": "https://github.com/dashevo/dash-wallet/commit/e56eb24c3d4d3a235c7d1fa78213554127d72cb6", "message": "Remove unused variable", "committedDate": "2020-01-10T01:00:13Z", "type": "commit"}, {"oid": "c252f3fd4e99de0e3348177fb214b6ec0fd474e7", "url": "https://github.com/dashevo/dash-wallet/commit/c252f3fd4e99de0e3348177fb214b6ec0fd474e7", "message": "Require PIN only for security menu items", "committedDate": "2020-01-10T13:26:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQzNjI3MQ==", "url": "https://github.com/dashevo/dash-wallet/pull/300#discussion_r366436271", "bodyText": "You can add the @JvmStatic annotation to createIntent(context: Context, seed: Array<String>) method definition in VerifySeedActivity class in order to be able to simply call VerifySeedActivity.createIntent(this, seedArray) without Companion.", "author": "tomasz-ludek", "createdAt": "2020-01-14T16:21:48Z", "path": "wallet/src/de/schildbach/wallet/ui/WalletActivity.java", "diffHunk": "@@ -529,7 +531,31 @@ public void handleRestoreWallet() {\n     }\n \n     public void handleBackupWalletToSeed() {\n-        BackupWalletToSeedDialogFragment.show(getSupportFragmentManager());\n+        handleVerifySeed();\n+    }\n+\n+    private void handleVerifySeed() {\n+        final int AUTH_REQUEST_CODE_VIEW_RECOVERYPHRASE = 1;\n+        DecryptSeedSharedModel decryptSeedSharedModel = ViewModelProviders.of(this).get(DecryptSeedSharedModel.class);\n+        decryptSeedSharedModel.getOnDecryptSeedCallback().observe(this, new Observer<Pair<Integer, DeterministicSeed>>() {\n+\n+            @Override\n+            public void onChanged(Pair<Integer, DeterministicSeed> data) {\n+                switch (data.getFirst()) {\n+                    case AUTH_REQUEST_CODE_VIEW_RECOVERYPHRASE:\n+                        startVerifySeedActivity(data.getSecond());\n+                        break;\n+                }\n+            }\n+        });\n+        DecryptSeedWithPinDialog.show(this, AUTH_REQUEST_CODE_VIEW_RECOVERYPHRASE);\n+    }\n+\n+    private void startVerifySeedActivity(DeterministicSeed seed) {\n+        List<String> mnemonicCode = seed.getMnemonicCode();\n+        String [] seedArray = mnemonicCode.toArray(new String[0]);\n+        Intent intent = VerifySeedActivity.Companion.createIntent(this, seedArray);", "originalCommit": "c252f3fd4e99de0e3348177fb214b6ec0fd474e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ0NjIxMw==", "url": "https://github.com/dashevo/dash-wallet/pull/300#discussion_r366446213", "bodyText": "Thank you for this idea.", "author": "HashEngineering", "createdAt": "2020-01-14T16:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQzNjI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MTcyMA==", "url": "https://github.com/dashevo/dash-wallet/pull/300#discussion_r366461720", "bodyText": "82fc9d1", "author": "HashEngineering", "createdAt": "2020-01-14T17:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQzNjI3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "82fc9d131051506372c3c9f69ac6bb890066e896", "chunk": "diff --git a/wallet/src/de/schildbach/wallet/ui/WalletActivity.java b/wallet/src/de/schildbach/wallet/ui/WalletActivity.java\nindex 7acf25c90..4c35fd842 100644\n--- a/wallet/src/de/schildbach/wallet/ui/WalletActivity.java\n+++ b/wallet/src/de/schildbach/wallet/ui/WalletActivity.java\n\n@@ -554,7 +554,7 @@ public final class WalletActivity extends AbstractBindServiceActivity\n     private void startVerifySeedActivity(DeterministicSeed seed) {\n         List<String> mnemonicCode = seed.getMnemonicCode();\n         String [] seedArray = mnemonicCode.toArray(new String[0]);\n-        Intent intent = VerifySeedActivity.Companion.createIntent(this, seedArray);\n+        Intent intent = VerifySeedActivity.createIntent(this, seedArray);\n         startActivity(intent);\n     }\n \n"}}, {"oid": "e556361cfcd7154f9350d4f80be30a668393726b", "url": "https://github.com/dashevo/dash-wallet/commit/e556361cfcd7154f9350d4f80be30a668393726b", "message": "Simplify string concat", "committedDate": "2020-01-14T16:58:56Z", "type": "commit"}, {"oid": "82fc9d131051506372c3c9f69ac6bb890066e896", "url": "https://github.com/dashevo/dash-wallet/commit/82fc9d131051506372c3c9f69ac6bb890066e896", "message": "Make createIntent static", "committedDate": "2020-01-14T16:59:36Z", "type": "commit"}, {"oid": "be532926bb667e8d4b425ba9f5b1375c7f808232", "url": "https://github.com/dashevo/dash-wallet/commit/be532926bb667e8d4b425ba9f5b1375c7f808232", "message": "Refactor CheckPinDialog to eliminate need to duplicate some methods in child classes", "committedDate": "2020-01-14T17:01:30Z", "type": "commit"}, {"oid": "ba00bab0a19e860001eacdef0e0e55eafc87e869", "url": "https://github.com/dashevo/dash-wallet/commit/ba00bab0a19e860001eacdef0e0e55eafc87e869", "message": "Modify initSharedModel() to take a FragmentActivity parameter", "committedDate": "2020-01-14T17:42:59Z", "type": "commit"}]}