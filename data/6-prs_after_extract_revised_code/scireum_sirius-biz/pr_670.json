{"pr_number": 670, "pr_title": "Provides a helper to conveniently check permissions on an entity with\u2026", "pr_createdAt": "2020-01-23T15:24:27Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/670", "timeline": [{"oid": "97c417504e1b352e96210ac24b821307ae97c6a2", "url": "https://github.com/scireum/sirius-biz/commit/97c417504e1b352e96210ac24b821307ae97c6a2", "message": "Provides a helper to conveniently check permissions on an entity without relying on a UserManager or the like to transform them.\n\nIn some cases we only have the database entity at hands and need to reason about granted permissions. We still want to\nutilize the profiles and other facilities to conveniently work with permissions. This is now provided by getEffectivePermissions\nand hasPermission.", "committedDate": "2020-01-23T15:22:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE5ODYzNw==", "url": "https://github.com/scireum/sirius-biz/pull/670#discussion_r370198637", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * will most probably way more efficient.\n          \n          \n            \n                 * will most probably be way more efficient.", "author": "sabieber", "createdAt": "2020-01-23T15:48:11Z", "path": "src/main/java/sirius/biz/model/PermissionData.java", "diffHunk": "@@ -82,6 +89,43 @@ public StringList getPermissions() {\n         return permissions;\n     }\n \n+    /**\n+     * Provides a helper to determine the effective set of permissions based on {@link #getPermissions()} and\n+     * {@link Permissions#copyAndApplyProfiles(Collection)}.\n+     * <p>\n+     * Note that the result of applying all profiles is cached within this entity and will not reflect\n+     * any changes to {@link #getPermissions()}.\n+     *\n+     * @return the effective set of permissions\n+     */\n+    public Set<String> getEffectivePermissions() {\n+        if (effectivePermissions == null) {\n+            effectivePermissions = Permissions.copyAndApplyProfiles(getPermissions().data());\n+        }\n+\n+        return Collections.unmodifiableSet(effectivePermissions);\n+    }\n+\n+    /**\n+     * Checks if the requested permission expression is satisfied by the permissions granted in\n+     * {@link #getPermissions()}.\n+     * <p>\n+     * Note that this uses {@link #getEffectivePermissions()} which applies all profiles to the granted permissions,\n+     * which will be cached in this entity and will not reflect changes to {@link #getPermissions()}.\n+     * <p>\n+     * Also note that this is a helper method for rare cases, a call to\n+     * {@link sirius.web.security.UserInfo#hasPermission(String)} should always be preferred (if appropriate) as this\n+     * will most probably way more efficient.", "originalCommit": "97c417504e1b352e96210ac24b821307ae97c6a2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2386b5c1446f8b2824b5d48f249146fef60f61d1", "chunk": "diff --git a/src/main/java/sirius/biz/model/PermissionData.java b/src/main/java/sirius/biz/model/PermissionData.java\nindex 55d87c52..51fdff7e 100644\n--- a/src/main/java/sirius/biz/model/PermissionData.java\n+++ b/src/main/java/sirius/biz/model/PermissionData.java\n\n@@ -115,7 +115,7 @@ public class PermissionData extends Composite {\n      * <p>\n      * Also note that this is a helper method for rare cases, a call to\n      * {@link sirius.web.security.UserInfo#hasPermission(String)} should always be preferred (if appropriate) as this\n-     * will most probably way more efficient.\n+     * will most probably be way more efficient.\n      *\n      * @param permissionToCheck the permission expression to check as parsed by\n      *                          {@link Permissions#hasPermission(String, Predicate)}\n"}}, {"oid": "2386b5c1446f8b2824b5d48f249146fef60f61d1", "url": "https://github.com/scireum/sirius-biz/commit/2386b5c1446f8b2824b5d48f249146fef60f61d1", "message": "Update src/main/java/sirius/biz/model/PermissionData.java\n\nCo-Authored-By: Sascha Bieberstein <sabieber@users.noreply.github.com>", "committedDate": "2020-01-23T16:13:16Z", "type": "commit"}]}