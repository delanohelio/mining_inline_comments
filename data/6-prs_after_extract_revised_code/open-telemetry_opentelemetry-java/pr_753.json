{"pr_number": 753, "pr_title": "Optimize SpanBuilderSdk link memory", "pr_createdAt": "2020-01-14T00:08:01Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/753", "timeline": [{"oid": "d6f3487dc3736585c65cdff2052bb8431eaa122a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d6f3487dc3736585c65cdff2052bb8431eaa122a", "message": "ignore links beyond the limit, rather than waiting until the end to truncate on span creation.", "committedDate": "2020-01-14T22:21:18Z", "type": "commit"}, {"oid": "cf86f36641954ea6c3aaf7626e914f9b8e4b2929", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/cf86f36641954ea6c3aaf7626e914f9b8e4b2929", "message": "update for changes from upstream", "committedDate": "2020-01-14T22:49:38Z", "type": "commit"}, {"oid": "cf86f36641954ea6c3aaf7626e914f9b8e4b2929", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/cf86f36641954ea6c3aaf7626e914f9b8e4b2929", "message": "update for changes from upstream", "committedDate": "2020-01-14T22:49:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwODcxMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367508710", "bodyText": "It is better to drop the earliest in general.", "author": "bogdandrutu", "createdAt": "2020-01-16T16:10:27Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -127,10 +128,18 @@\n   @Override\n   public Span.Builder addLink(Link link) {\n     Utils.checkNotNull(link, \"link\");\n+    totalNumberOfLinksAdded++;\n+    // don't bother doing anything with any links beyond the max.", "originalCommit": "cf86f36641954ea6c3aaf7626e914f9b8e4b2929", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUyNzk2NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367527964", "bodyText": "Can you explain why? Are later links somehow better than earlier ones? What's the business rationale here? [the code is much more efficient if we can just drop the later ones]", "author": "jkwatson", "createdAt": "2020-01-16T16:42:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwODcxMA=="}], "type": "inlineReview", "revised_code": {"commit": "5f208b80ade5ffbb855160b6221cbb78a3c3f54c", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\nindex 44e6b544b..224e59792 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n\n@@ -130,7 +130,6 @@ class SpanBuilderSdk implements Span.Builder {\n     Utils.checkNotNull(link, \"link\");\n     totalNumberOfLinksAdded++;\n     // don't bother doing anything with any links beyond the max.\n-    // todo: generate a metric for dropped links\n     if (links.size() == traceConfig.getMaxNumberOfLinks()) {\n       return this;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTE2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367509165", "bodyText": "I think this makes more sense to be an issue for all dropped things (attributes, links, events).", "author": "bogdandrutu", "createdAt": "2020-01-16T16:11:11Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -127,10 +128,18 @@\n   @Override\n   public Span.Builder addLink(Link link) {\n     Utils.checkNotNull(link, \"link\");\n+    totalNumberOfLinksAdded++;\n+    // don't bother doing anything with any links beyond the max.\n+    // todo: generate a metric for dropped links", "originalCommit": "cf86f36641954ea6c3aaf7626e914f9b8e4b2929", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUyODAzOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367528039", "bodyText": "definitely", "author": "jkwatson", "createdAt": "2020-01-16T16:42:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU1MzE0MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367553140", "bodyText": "so suggestion is to remove the todo and create an issue to discuss and make a decision on what to do with the dropped things.", "author": "bogdandrutu", "createdAt": "2020-01-16T17:30:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU1NDgyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367554829", "bodyText": "ok, will do.", "author": "jkwatson", "createdAt": "2020-01-16T17:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk5ODMxNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367998315", "bodyText": "#766", "author": "jkwatson", "createdAt": "2020-01-17T15:38:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk5ODgxMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/753#discussion_r367998811", "bodyText": "todo removed.", "author": "jkwatson", "createdAt": "2020-01-17T15:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTE2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "5f208b80ade5ffbb855160b6221cbb78a3c3f54c", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\nindex 44e6b544b..224e59792 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n\n@@ -130,7 +130,6 @@ class SpanBuilderSdk implements Span.Builder {\n     Utils.checkNotNull(link, \"link\");\n     totalNumberOfLinksAdded++;\n     // don't bother doing anything with any links beyond the max.\n-    // todo: generate a metric for dropped links\n     if (links.size() == traceConfig.getMaxNumberOfLinks()) {\n       return this;\n     }\n"}}, {"oid": "5f208b80ade5ffbb855160b6221cbb78a3c3f54c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5f208b80ade5ffbb855160b6221cbb78a3c3f54c", "message": "remove the todo; replaced with https://github.com/open-telemetry/opentelemetry-java/issues/766", "committedDate": "2020-01-17T15:38:54Z", "type": "commit"}]}