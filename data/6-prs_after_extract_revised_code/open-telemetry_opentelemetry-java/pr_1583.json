{"pr_number": 1583, "pr_title": "Add helpers to CompletableResultCode to wait for a result.", "pr_createdAt": "2020-08-25T08:17:44Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1583", "timeline": [{"oid": "e32266abe90a925bea808924f60d73af62d0e9ac", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e32266abe90a925bea808924f60d73af62d0e9ac", "message": "Add helpers to CompletableResultCode to wait for a result.", "committedDate": "2020-08-25T08:15:58Z", "type": "commit"}, {"oid": "8aa29e5bef15e6d100562367d90e69214033a40f", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/8aa29e5bef15e6d100562367d90e69214033a40f", "message": "Flaky?", "committedDate": "2020-08-25T09:21:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU3OTYyOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1583#discussion_r476579628", "bodyText": "could we replace this block with if (isDone()) return this; ?", "author": "jkwatson", "createdAt": "2020-08-25T16:28:33Z", "path": "sdk/common/src/main/java/io/opentelemetry/sdk/common/export/CompletableResultCode.java", "diffHunk": "@@ -107,4 +109,42 @@ public CompletableResultCode whenComplete(Runnable action) {\n     }\n     return this;\n   }\n+\n+  /** Returns whether this {@link CompletableResultCode} has completed. */\n+  public boolean isDone() {\n+    synchronized (lock) {\n+      return succeeded != null;\n+    }\n+  }\n+\n+  /**\n+   * Waits for the specified amount of time for this {@link CompletableResultCode} to complete. If\n+   * it times out or is interrupted, the {@link CompletableResultCode} is failed.\n+   *\n+   * @return this {@link CompletableResultCode}\n+   */\n+  public CompletableResultCode join(long timeout, TimeUnit unit) {\n+    synchronized (lock) {\n+      if (succeeded != null) {\n+        return this;\n+      }\n+    }", "originalCommit": "8aa29e5bef15e6d100562367d90e69214033a40f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzAxNzM2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1583#discussion_r477017365", "bodyText": "Nice, thanks", "author": "anuraaga", "createdAt": "2020-08-26T03:52:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU3OTYyOA=="}], "type": "inlineReview", "revised_code": {"commit": "92ef90eb90fda74e3aef2950e62ac668c6fb34bb", "chunk": "diff --git a/sdk/common/src/main/java/io/opentelemetry/sdk/common/export/CompletableResultCode.java b/sdk/common/src/main/java/io/opentelemetry/sdk/common/export/CompletableResultCode.java\nindex 50141d8f9..f516566c2 100644\n--- a/sdk/common/src/main/java/io/opentelemetry/sdk/common/export/CompletableResultCode.java\n+++ b/sdk/common/src/main/java/io/opentelemetry/sdk/common/export/CompletableResultCode.java\n\n@@ -124,10 +124,8 @@ public class CompletableResultCode {\n    * @return this {@link CompletableResultCode}\n    */\n   public CompletableResultCode join(long timeout, TimeUnit unit) {\n-    synchronized (lock) {\n-      if (succeeded != null) {\n-        return this;\n-      }\n+    if (isDone()) {\n+      return this;\n     }\n     final CountDownLatch latch = new CountDownLatch(1);\n     whenComplete(\n"}}, {"oid": "92ef90eb90fda74e3aef2950e62ac668c6fb34bb", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/92ef90eb90fda74e3aef2950e62ac668c6fb34bb", "message": "Cleanup", "committedDate": "2020-08-26T03:51:59Z", "type": "commit"}]}