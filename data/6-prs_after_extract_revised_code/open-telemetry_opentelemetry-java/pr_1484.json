{"pr_number": 1484, "pr_title": "Add new configuration option to limit the size of string attribute values", "pr_createdAt": "2020-07-30T10:30:01Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484", "timeline": [{"oid": "99de8ea96b1e4cc64dfb2b000b16ac4bf8c1adbb", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/99de8ea96b1e4cc64dfb2b000b16ac4bf8c1adbb", "message": "Add new configuration option to limit the size of string attribute values", "committedDate": "2020-07-30T10:27:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjkyNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462906927", "bodyText": "Add comment about 0 here too or SDK may handle it incorrectly", "author": "anuraaga", "createdAt": "2020-07-30T10:36:43Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java", "diffHunk": "@@ -144,6 +149,13 @@ public static TraceConfig getDefault() {\n    */\n   public abstract int getMaxNumberOfAttributesPerLink();\n \n+  /**\n+   * Returns the global default max length of string attribute value in characters.\n+   *\n+   * @return the global default max length of string attribute value in characters.", "originalCommit": "99de8ea96b1e4cc64dfb2b000b16ac4bf8c1adbb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\nindex c80da554f..df4096192 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\n\n@@ -150,7 +150,8 @@ public abstract class TraceConfig {\n   public abstract int getMaxNumberOfAttributesPerLink();\n \n   /**\n-   * Returns the global default max length of string attribute value in characters.\n+   * Returns the global default max length of string attribute value in characters. Zero means\n+   * unlimited.\n    *\n    * @return the global default max length of string attribute value in characters.\n    */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNzk4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462907981", "bodyText": "Looks like null check is duplicated with private method", "author": "anuraaga", "createdAt": "2020-07-30T10:38:59Z", "path": "api/src/main/java/io/opentelemetry/internal/StringUtils.java", "diffHunk": "@@ -57,5 +59,53 @@ public static boolean isValidMetricName(String metricName) {\n     return metricName.matches(pattern);\n   }\n \n+  /**\n+   * If given attribute is of type STRING and has more characters than given {@code limit} then\n+   * return new AttributeValue with string truncated to {@code limit} characters.\n+   *\n+   * <p>If given attribute is of type STRING_ARRAY and non-empty then return new AttributeValue with\n+   * every element truncated to {@code limit} characters.\n+   *\n+   * <p>Otherwise return given {@code value}\n+   *\n+   * @throws IllegalArgumentException if limit is zero or negative\n+   */\n+  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n+    Utils.checkArgument(limit > 0, \"attribute value limit cannot be %d\", limit);\n+\n+    if (value == null\n+        || (value.getType() != AttributeValue.Type.STRING\n+            && value.getType() != AttributeValue.Type.STRING_ARRAY)) {\n+      return value;\n+    }\n+\n+    if (value.getType() == AttributeValue.Type.STRING_ARRAY) {\n+      List<String> strings = value.getStringArrayValue();\n+      if (strings.isEmpty()) {\n+        return value;\n+      }\n+\n+      String[] newStrings = new String[strings.size()];\n+      for (int i = 0; i < strings.size(); i++) {\n+        String string = strings.get(i);\n+        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);", "originalCommit": "99de8ea96b1e4cc64dfb2b000b16ac4bf8c1adbb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "chunk": "diff --git a/api/src/main/java/io/opentelemetry/internal/StringUtils.java b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\nindex ace694400..ed28eedf9 100644\n--- a/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n+++ b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n\n@@ -88,19 +89,21 @@ public final class StringUtils {\n       String[] newStrings = new String[strings.size()];\n       for (int i = 0; i < strings.size(); i++) {\n         String string = strings.get(i);\n-        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);\n+        newStrings[i] = cutIfNeeded(string, limit);\n       }\n \n       return AttributeValue.arrayAttributeValue(newStrings);\n     }\n \n     String string = value.getStringValue();\n-    return string.length() <= limit\n+    // Don't allocate new AttributeValue if not needed\n+    return (string == null || string.length() <= limit)\n         ? value\n         : AttributeValue.stringAttributeValue(string.substring(0, limit));\n   }\n \n-  private static String cutIfNeeded(String s, int limit) {\n+  @Nullable\n+  private static String cutIfNeeded(@Nullable String s, int limit) {\n     if (s == null || s.length() <= limit) {\n       return s;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwODEwMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462908103", "bodyText": "Can we add @Nullable?", "author": "anuraaga", "createdAt": "2020-07-30T10:39:13Z", "path": "api/src/main/java/io/opentelemetry/internal/StringUtils.java", "diffHunk": "@@ -57,5 +59,53 @@ public static boolean isValidMetricName(String metricName) {\n     return metricName.matches(pattern);\n   }\n \n+  /**\n+   * If given attribute is of type STRING and has more characters than given {@code limit} then\n+   * return new AttributeValue with string truncated to {@code limit} characters.\n+   *\n+   * <p>If given attribute is of type STRING_ARRAY and non-empty then return new AttributeValue with\n+   * every element truncated to {@code limit} characters.\n+   *\n+   * <p>Otherwise return given {@code value}\n+   *\n+   * @throws IllegalArgumentException if limit is zero or negative\n+   */\n+  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n+    Utils.checkArgument(limit > 0, \"attribute value limit cannot be %d\", limit);\n+\n+    if (value == null\n+        || (value.getType() != AttributeValue.Type.STRING\n+            && value.getType() != AttributeValue.Type.STRING_ARRAY)) {\n+      return value;\n+    }\n+\n+    if (value.getType() == AttributeValue.Type.STRING_ARRAY) {\n+      List<String> strings = value.getStringArrayValue();\n+      if (strings.isEmpty()) {\n+        return value;\n+      }\n+\n+      String[] newStrings = new String[strings.size()];\n+      for (int i = 0; i < strings.size(); i++) {\n+        String string = strings.get(i);\n+        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);\n+      }\n+\n+      return AttributeValue.arrayAttributeValue(newStrings);\n+    }\n+\n+    String string = value.getStringValue();\n+    return string.length() <= limit\n+        ? value\n+        : AttributeValue.stringAttributeValue(string.substring(0, limit));\n+  }\n+\n+  private static String cutIfNeeded(String s, int limit) {", "originalCommit": "99de8ea96b1e4cc64dfb2b000b16ac4bf8c1adbb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "chunk": "diff --git a/api/src/main/java/io/opentelemetry/internal/StringUtils.java b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\nindex ace694400..ed28eedf9 100644\n--- a/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n+++ b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n\n@@ -88,19 +89,21 @@ public final class StringUtils {\n       String[] newStrings = new String[strings.size()];\n       for (int i = 0; i < strings.size(); i++) {\n         String string = strings.get(i);\n-        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);\n+        newStrings[i] = cutIfNeeded(string, limit);\n       }\n \n       return AttributeValue.arrayAttributeValue(newStrings);\n     }\n \n     String string = value.getStringValue();\n-    return string.length() <= limit\n+    // Don't allocate new AttributeValue if not needed\n+    return (string == null || string.length() <= limit)\n         ? value\n         : AttributeValue.stringAttributeValue(string.substring(0, limit));\n   }\n \n-  private static String cutIfNeeded(String s, int limit) {\n+  @Nullable\n+  private static String cutIfNeeded(@Nullable String s, int limit) {\n     if (s == null || s.length() <= limit) {\n       return s;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwOTE1Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462909152", "bodyText": "Believe it's possible for string to be null. Guess you can just use cutIfNeeded here too.", "author": "anuraaga", "createdAt": "2020-07-30T10:41:21Z", "path": "api/src/main/java/io/opentelemetry/internal/StringUtils.java", "diffHunk": "@@ -57,5 +59,53 @@ public static boolean isValidMetricName(String metricName) {\n     return metricName.matches(pattern);\n   }\n \n+  /**\n+   * If given attribute is of type STRING and has more characters than given {@code limit} then\n+   * return new AttributeValue with string truncated to {@code limit} characters.\n+   *\n+   * <p>If given attribute is of type STRING_ARRAY and non-empty then return new AttributeValue with\n+   * every element truncated to {@code limit} characters.\n+   *\n+   * <p>Otherwise return given {@code value}\n+   *\n+   * @throws IllegalArgumentException if limit is zero or negative\n+   */\n+  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n+    Utils.checkArgument(limit > 0, \"attribute value limit cannot be %d\", limit);\n+\n+    if (value == null\n+        || (value.getType() != AttributeValue.Type.STRING\n+            && value.getType() != AttributeValue.Type.STRING_ARRAY)) {\n+      return value;\n+    }\n+\n+    if (value.getType() == AttributeValue.Type.STRING_ARRAY) {\n+      List<String> strings = value.getStringArrayValue();\n+      if (strings.isEmpty()) {\n+        return value;\n+      }\n+\n+      String[] newStrings = new String[strings.size()];\n+      for (int i = 0; i < strings.size(); i++) {\n+        String string = strings.get(i);\n+        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);\n+      }\n+\n+      return AttributeValue.arrayAttributeValue(newStrings);\n+    }\n+\n+    String string = value.getStringValue();", "originalCommit": "99de8ea96b1e4cc64dfb2b000b16ac4bf8c1adbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxNzQyMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462917422", "bodyText": "I wanted to avoid allocating new AttributeValue unless needed...", "author": "iNikem", "createdAt": "2020-07-30T10:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwOTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxOTYwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462919608", "bodyText": "Well, actually it cannot. null value will not even reach this method. But I will add an if anyway", "author": "iNikem", "createdAt": "2020-07-30T11:03:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwOTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzNzM2Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462937362", "bodyText": "Thanks, yeah didn't notice the reallocation of AttributeValue aspect. As far as null goes, I only thought of it from seeing the null check in this PR\nhttps://github.com/open-telemetry/opentelemetry-java/pull/1437/files", "author": "anuraaga", "createdAt": "2020-07-30T11:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwOTE1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "chunk": "diff --git a/api/src/main/java/io/opentelemetry/internal/StringUtils.java b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\nindex ace694400..ed28eedf9 100644\n--- a/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n+++ b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n\n@@ -88,19 +89,21 @@ public final class StringUtils {\n       String[] newStrings = new String[strings.size()];\n       for (int i = 0; i < strings.size(); i++) {\n         String string = strings.get(i);\n-        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);\n+        newStrings[i] = cutIfNeeded(string, limit);\n       }\n \n       return AttributeValue.arrayAttributeValue(newStrings);\n     }\n \n     String string = value.getStringValue();\n-    return string.length() <= limit\n+    // Don't allocate new AttributeValue if not needed\n+    return (string == null || string.length() <= limit)\n         ? value\n         : AttributeValue.stringAttributeValue(string.substring(0, limit));\n   }\n \n-  private static String cutIfNeeded(String s, int limit) {\n+  @Nullable\n+  private static String cutIfNeeded(@Nullable String s, int limit) {\n     if (s == null || s.length() <= limit) {\n       return s;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzNzYzNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r462937636", "bodyText": "Ah sorry should have mentioned both return value and parameter are @Nullable", "author": "anuraaga", "createdAt": "2020-07-30T11:41:57Z", "path": "api/src/main/java/io/opentelemetry/internal/StringUtils.java", "diffHunk": "@@ -88,18 +89,20 @@ public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n       String[] newStrings = new String[strings.size()];\n       for (int i = 0; i < strings.size(); i++) {\n         String string = strings.get(i);\n-        newStrings[i] = string == null ? null : cutIfNeeded(string, limit);\n+        newStrings[i] = cutIfNeeded(string, limit);\n       }\n \n       return AttributeValue.arrayAttributeValue(newStrings);\n     }\n \n     String string = value.getStringValue();\n-    return string.length() <= limit\n+    // Don't allocate new AttributeValue if not needed\n+    return (string == null || string.length() <= limit)\n         ? value\n         : AttributeValue.stringAttributeValue(string.substring(0, limit));\n   }\n \n+  @Nullable\n   private static String cutIfNeeded(String s, int limit) {", "originalCommit": "c99697044d158ca1440b860aa9f13066c6425e0d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "chunk": "diff --git a/api/src/main/java/io/opentelemetry/internal/StringUtils.java b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\nindex aae059cde..ed28eedf9 100644\n--- a/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n+++ b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n\n@@ -103,7 +103,7 @@ public final class StringUtils {\n   }\n \n   @Nullable\n-  private static String cutIfNeeded(String s, int limit) {\n+  private static String cutIfNeeded(@Nullable String s, int limit) {\n     if (s == null || s.length() <= limit) {\n       return s;\n     }\n"}}, {"oid": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/606600aeb4a8ae90fef457cec4d71ab037910fcf", "message": "Polish", "committedDate": "2020-07-30T11:47:22Z", "type": "commit"}, {"oid": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/606600aeb4a8ae90fef457cec4d71ab037910fcf", "message": "Polish", "committedDate": "2020-07-30T11:47:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5NzEyNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463197127", "bodyText": "how about truncateToSize ?", "author": "jkwatson", "createdAt": "2020-07-30T18:41:03Z", "path": "api/src/main/java/io/opentelemetry/internal/StringUtils.java", "diffHunk": "@@ -57,5 +60,55 @@ public static boolean isValidMetricName(String metricName) {\n     return metricName.matches(pattern);\n   }\n \n+  /**\n+   * If given attribute is of type STRING and has more characters than given {@code limit} then\n+   * return new AttributeValue with string truncated to {@code limit} characters.\n+   *\n+   * <p>If given attribute is of type STRING_ARRAY and non-empty then return new AttributeValue with\n+   * every element truncated to {@code limit} characters.\n+   *\n+   * <p>Otherwise return given {@code value}\n+   *\n+   * @throws IllegalArgumentException if limit is zero or negative\n+   */\n+  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {", "originalCommit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9b39ce8c97bac684d6cfd4019db066883b91d21d", "chunk": "diff --git a/api/src/main/java/io/opentelemetry/internal/StringUtils.java b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\nindex ed28eedf9..b1c9dcedc 100644\n--- a/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n+++ b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n\n@@ -71,8 +71,8 @@ public final class StringUtils {\n    *\n    * @throws IllegalArgumentException if limit is zero or negative\n    */\n-  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n-    Utils.checkArgument(limit > 0, \"attribute value limit cannot be %d\", limit);\n+  public static AttributeValue truncateToSize(AttributeValue value, int limit) {\n+    Utils.checkArgument(limit > 0, \"attribute value limit must be positive, got %d\", limit);\n \n     if (value == null\n         || (value.getType() != AttributeValue.Type.STRING\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5NzQwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463197408", "bodyText": "recommend including why it failed, not just that the value is invalid. maybe \"attribute value limit must be positive\"", "author": "jkwatson", "createdAt": "2020-07-30T18:41:37Z", "path": "api/src/main/java/io/opentelemetry/internal/StringUtils.java", "diffHunk": "@@ -57,5 +60,55 @@ public static boolean isValidMetricName(String metricName) {\n     return metricName.matches(pattern);\n   }\n \n+  /**\n+   * If given attribute is of type STRING and has more characters than given {@code limit} then\n+   * return new AttributeValue with string truncated to {@code limit} characters.\n+   *\n+   * <p>If given attribute is of type STRING_ARRAY and non-empty then return new AttributeValue with\n+   * every element truncated to {@code limit} characters.\n+   *\n+   * <p>Otherwise return given {@code value}\n+   *\n+   * @throws IllegalArgumentException if limit is zero or negative\n+   */\n+  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n+    Utils.checkArgument(limit > 0, \"attribute value limit cannot be %d\", limit);", "originalCommit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9b39ce8c97bac684d6cfd4019db066883b91d21d", "chunk": "diff --git a/api/src/main/java/io/opentelemetry/internal/StringUtils.java b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\nindex ed28eedf9..b1c9dcedc 100644\n--- a/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n+++ b/api/src/main/java/io/opentelemetry/internal/StringUtils.java\n\n@@ -71,8 +71,8 @@ public final class StringUtils {\n    *\n    * @throws IllegalArgumentException if limit is zero or negative\n    */\n-  public static AttributeValue cutIfNeeded(AttributeValue value, int limit) {\n-    Utils.checkArgument(limit > 0, \"attribute value limit cannot be %d\", limit);\n+  public static AttributeValue truncateToSize(AttributeValue value, int limit) {\n+    Utils.checkArgument(limit > 0, \"attribute value limit must be positive, got %d\", limit);\n \n     if (value == null\n         || (value.getType() != AttributeValue.Type.STRING\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5ODg5MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463198890", "bodyText": "would probably pluralize this getMaxLengthOfAttributeValues()", "author": "jkwatson", "createdAt": "2020-07-30T18:44:09Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java", "diffHunk": "@@ -144,6 +149,14 @@ public static TraceConfig getDefault() {\n    */\n   public abstract int getMaxNumberOfAttributesPerLink();\n \n+  /**\n+   * Returns the global default max length of string attribute value in characters. Zero means\n+   * unlimited.\n+   *\n+   * @return the global default max length of string attribute value in characters.\n+   */\n+  public abstract int getMaxLengthOfAttributeValue();", "originalCommit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9b39ce8c97bac684d6cfd4019db066883b91d21d", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\nindex df4096192..01a340694 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\n\n@@ -155,7 +155,7 @@ public abstract class TraceConfig {\n    *\n    * @return the global default max length of string attribute value in characters.\n    */\n-  public abstract int getMaxLengthOfAttributeValue();\n+  public abstract int getMaxLengthOfAttributeValues();\n \n   /**\n    * Returns a new {@link Builder}.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463199468", "bodyText": "Is zero a good default? shouldn't it be MAX_INT?", "author": "jkwatson", "createdAt": "2020-07-30T18:45:11Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java", "diffHunk": "@@ -89,6 +93,7 @@\n   private static final int DEFAULT_SPAN_MAX_NUM_LINKS = 32;\n   private static final int DEFAULT_SPAN_MAX_NUM_ATTRIBUTES_PER_EVENT = 32;\n   private static final int DEFAULT_SPAN_MAX_NUM_ATTRIBUTES_PER_LINK = 32;\n+  private static final int DEFAULT_KEY_SPAN_ATTRIBUTE_MAX_VALUE_LENGTH = 0;", "originalCommit": "606600aeb4a8ae90fef457cec4d71ab037910fcf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTgzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463199832", "bodyText": "even better, make the default be a null Integer and get rid of this magic number.", "author": "jkwatson", "createdAt": "2020-07-30T18:45:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNDE1Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463424156", "bodyText": "All other methods here return int. Do you want for this one to return Integer?\nWith default value being MAX_INT the code will look like if(traceConfig.getMaxLengthOfAttributeValues() < Integer.MAX_INT) truncate(), which is strange for me.", "author": "iNikem", "createdAt": "2020-07-31T06:14:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQzOTYzOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463439638", "bodyText": "I also agree that 0 is strange as a default value. I would set it to a more common magic number, e.g. 255.", "author": "thisthat", "createdAt": "2020-07-31T07:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY1OTU1MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463659550", "bodyText": "How about if(traceConfig.getMaxLengthOfAttributeValues() != TraceConfig.DEFAULT_MAX_ATTRIBUTE_LENGTH) ? I think that reads great, makes it clear, and doesn't use '0' as a magic number.", "author": "jkwatson", "createdAt": "2020-07-31T14:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY2MDQ0Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463660446", "bodyText": "Also, why is the word 'KEY' in this constant name?", "author": "jkwatson", "createdAt": "2020-07-31T14:55:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY2NTg5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463665892", "bodyText": "Oi, KEY is certainly wrong, will fix.\nDo you propose to have TraceConfig.DEFAULT_MAX_ATTRIBUTE_LENGTH constant but let it have null as a value or Integer.MAX_VALUE?", "author": "iNikem", "createdAt": "2020-07-31T15:05:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNzM0Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463727343", "bodyText": "I think I prefer MAX_VALUE, to the nullable, but I don't feel super strongly about it.", "author": "jkwatson", "createdAt": "2020-07-31T17:05:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNDE3NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463734174", "bodyText": "Wait, that does not make sense. Currently I attempt to truncate values if configured value differs from \"unlimited\" which is signalled by 0. Your proposal says \"let's try to truncate if configured value is not default\". But what if we change default to, say, 2M? if(traceConfig.getMaxLengthOfAttributeValues() != TraceConfig.DEFAULT_MAX_ATTRIBUTE_LENGTH) will not work anymore. Compare with default is wrong, default may change. We have to compare with \"unlimited\", however we denote that. And I like traceConfig.getMaxLengthOfAttributeValues() > 0 more than traceConfig.getMaxLengthOfAttributeValues() > Integer.MAX_INT.", "author": "iNikem", "createdAt": "2020-07-31T17:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0MDI5OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463740299", "bodyText": "I'd be happier with -1, rather than 0. 0 is actually a valid length, and -1 clearly is not. And, I'd rather have a constant defined for the \"unset\" value, rather than just hardcode the magic number in two places.", "author": "jkwatson", "createdAt": "2020-07-31T17:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0NjcyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463746723", "bodyText": "@jkwatson  PTAL", "author": "iNikem", "createdAt": "2020-07-31T17:47:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0OTM4NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1484#discussion_r463749385", "bodyText": "\ud83d\udc4d I like -1 for unlimited, I think that's reasonably conventional", "author": "trask", "createdAt": "2020-07-31T17:53:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTQ2OA=="}], "type": "inlineReview", "revised_code": {"commit": "007868ae9721582c641856688cb0366e2e71f5b3", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\nindex df4096192..942e01cfa 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java\n\n@@ -93,7 +93,9 @@ public abstract class TraceConfig {\n   private static final int DEFAULT_SPAN_MAX_NUM_LINKS = 32;\n   private static final int DEFAULT_SPAN_MAX_NUM_ATTRIBUTES_PER_EVENT = 32;\n   private static final int DEFAULT_SPAN_MAX_NUM_ATTRIBUTES_PER_LINK = 32;\n-  private static final int DEFAULT_KEY_SPAN_ATTRIBUTE_MAX_VALUE_LENGTH = 0;\n+\n+  private static final int UNLIMITED_ATTRIBUTE_LENGTH = -1;\n+  private static final int DEFAULT_MAX_ATTRIBUTE_LENGTH = UNLIMITED_ATTRIBUTE_LENGTH;\n \n   /**\n    * Returns the default {@code TraceConfig}.\n"}}, {"oid": "9b39ce8c97bac684d6cfd4019db066883b91d21d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9b39ce8c97bac684d6cfd4019db066883b91d21d", "message": "Polish", "committedDate": "2020-07-31T08:56:28Z", "type": "commit"}, {"oid": "007868ae9721582c641856688cb0366e2e71f5b3", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/007868ae9721582c641856688cb0366e2e71f5b3", "message": "Polish", "committedDate": "2020-07-31T17:47:08Z", "type": "commit"}, {"oid": "88a1391d4c6bf703054c3fc624c8936b2188dd56", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/88a1391d4c6bf703054c3fc624c8936b2188dd56", "message": "Polish", "committedDate": "2020-07-31T18:01:46Z", "type": "commit"}, {"oid": "3a917bdd39af9d2c82b043bfce765eb2f702fe8c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/3a917bdd39af9d2c82b043bfce765eb2f702fe8c", "message": "Merge remote-tracking branch 'upstream/master' into cut-attributes", "committedDate": "2020-07-31T18:53:49Z", "type": "commit"}, {"oid": "9f8f4740efa7ad48feabd3d96e4f057439911ac3", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9f8f4740efa7ad48feabd3d96e4f057439911ac3", "message": "Add benchmark.", "committedDate": "2020-08-02T14:31:30Z", "type": "commit"}, {"oid": "e1b8dcaae626d6d7a25ec6f3e8ebc8376b103021", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e1b8dcaae626d6d7a25ec6f3e8ebc8376b103021", "message": "Format", "committedDate": "2020-08-02T14:50:57Z", "type": "commit"}, {"oid": "2bb2ee55c245ea960d4aa6e2867f2ecbc65b4b5c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/2bb2ee55c245ea960d4aa6e2867f2ecbc65b4b5c", "message": "Format", "committedDate": "2020-08-02T17:09:12Z", "type": "commit"}]}