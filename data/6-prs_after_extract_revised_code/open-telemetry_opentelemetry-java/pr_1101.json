{"pr_number": 1101, "pr_title": "A simple stress-test for the TracerSdk.", "pr_createdAt": "2020-04-10T21:15:35Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1101", "timeline": [{"oid": "b76fca7f0ae1bb23413eab7d4f3ae87702512946", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b76fca7f0ae1bb23413eab7d4f3ae87702512946", "message": "A simple stress-test for the TracerSdk.", "committedDate": "2020-04-10T21:14:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5ODU4Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1101#discussion_r406998586", "bodyText": "I would add the batchsp as well and count the num spans in the exporter. Since it is most likely that batchsp will be almost everywhere.", "author": "bogdandrutu", "createdAt": "2020-04-11T01:15:58Z", "path": "sdk/src/test/java/io/opentelemetry/sdk/trace/TracerSdkTest.java", "diffHunk": "@@ -106,4 +110,78 @@ public void propagatesInstrumentationLibraryInfoToSpan() {\n     ReadableSpan readableSpan = (ReadableSpan) tracer.spanBuilder(\"spanName\").startSpan();\n     assertThat(readableSpan.getInstrumentationLibraryInfo()).isEqualTo(instrumentationLibraryInfo);\n   }\n+\n+  @Test\n+  public void stressTest() {\n+    CountingSpanProcessor spanProcessor = new CountingSpanProcessor();\n+    TracerSdkProvider tracerSdkProvider = TracerSdkProvider.builder().build();\n+    tracerSdkProvider.addSpanProcessor(spanProcessor);", "originalCommit": "b76fca7f0ae1bb23413eab7d4f3ae87702512946", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyMjgwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1101#discussion_r407122800", "bodyText": "yep. easy to add; i'll make it happen", "author": "jkwatson", "createdAt": "2020-04-11T23:31:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5ODU4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NjkxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1101#discussion_r407246912", "bodyText": "done, as an additional stress test.", "author": "jkwatson", "createdAt": "2020-04-12T20:13:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5ODU4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "519bcf41d9743dd37ed12c5a17e67ce5a3ca08b0", "chunk": "diff --git a/sdk/src/test/java/io/opentelemetry/sdk/trace/TracerSdkTest.java b/sdk/src/test/java/io/opentelemetry/sdk/trace/TracerSdkTest.java\nindex c1aaa8a17..8e5c1ec45 100644\n--- a/sdk/src/test/java/io/opentelemetry/sdk/trace/TracerSdkTest.java\n+++ b/sdk/src/test/java/io/opentelemetry/sdk/trace/TracerSdkTest.java\n\n@@ -132,6 +136,27 @@ public class TracerSdkTest {\n     assertThat(spanProcessor.numberOfSpansStarted.get()).isEqualTo(8_000);\n   }\n \n+  @Test\n+  public void stressTest_withBatchSpanProcessor() {\n+    CountingSpanExporter countingSpanExporter = new CountingSpanExporter();\n+    SpanProcessor spanProcessor = BatchSpansProcessor.newBuilder(countingSpanExporter).build();\n+    TracerSdkProvider tracerSdkProvider = TracerSdkProvider.builder().build();\n+    tracerSdkProvider.addSpanProcessor(spanProcessor);\n+    TracerSdk tracer =\n+        tracerSdkProvider.get(INSTRUMENTATION_LIBRARY_NAME, INSTRUMENTATION_LIBRARY_VERSION);\n+\n+    StressTestRunner.Builder stressTestBuilder =\n+        StressTestRunner.builder().setTracer(tracer).setSpanProcessor(spanProcessor);\n+\n+    for (int i = 0; i < 4; i++) {\n+      stressTestBuilder.addOperation(\n+          StressTestRunner.Operation.create(2_000, 1, new SimpleSpanOperation(tracer)));\n+    }\n+\n+    stressTestBuilder.build().run();\n+    assertThat(countingSpanExporter.numberOfSpansExported.get()).isEqualTo(8_000);\n+  }\n+\n   private static class CountingSpanProcessor implements SpanProcessor {\n     private final AtomicLong numberOfSpansStarted = new AtomicLong();\n     private final AtomicLong numberOfSpansFinished = new AtomicLong();\n"}}, {"oid": "519bcf41d9743dd37ed12c5a17e67ce5a3ca08b0", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/519bcf41d9743dd37ed12c5a17e67ce5a3ca08b0", "message": "Add a stress-test that includes the batch span processor.", "committedDate": "2020-04-12T20:13:09Z", "type": "commit"}]}