{"pr_number": 771, "pr_title": "Ignore null or blank string-valued span attributes.", "pr_createdAt": "2020-01-17T20:00:25Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/771", "timeline": [{"oid": "ffb1fb4af4ae08b7d988df6eab22967d5afdd187", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ffb1fb4af4ae08b7d988df6eab22967d5afdd187", "message": "Ignore null or blank string-valued span attributes.", "committedDate": "2020-01-17T19:58:29Z", "type": "commit"}, {"oid": "71b9b77da949061995cb35e24fd90b3f05fcc903", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/71b9b77da949061995cb35e24fd90b3f05fcc903", "message": "also ignore null & blank strings on active span attributes.", "committedDate": "2020-01-17T21:10:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1MjcxNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368152717", "bodyText": "Do we want to count this as dropped or we simply ignore?", "author": "bogdandrutu", "createdAt": "2020-01-17T21:56:12Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -137,6 +138,9 @@\n \n   @Override\n   public Span.Builder setAttribute(String key, String value) {\n+    if (StringUtils.isNullOrBlank(value)) {", "originalCommit": "71b9b77da949061995cb35e24fd90b3f05fcc903", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1MzI4Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368153282", "bodyText": "it's definitely a different kind of \"dropping\" than the \"too many attributes\" kind. I think ignoring it is fine..it's not really an attribute at all without a value.", "author": "jkwatson", "createdAt": "2020-01-17T21:58:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1MjcxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTUxNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368155516", "bodyText": "Fine with this for the moment, may be unexpected for users especially for empty.", "author": "bogdandrutu", "createdAt": "2020-01-17T22:05:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1MjcxNw=="}], "type": "inlineReview", "revised_code": {"commit": "0e77fcb292510ff2ea9979757e2e3a9c0735e56d", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\nindex e3d41c847..080829b11 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n\n@@ -138,9 +139,6 @@ class SpanBuilderSdk implements Span.Builder {\n \n   @Override\n   public Span.Builder setAttribute(String key, String value) {\n-    if (StringUtils.isNullOrBlank(value)) {\n-      return this;\n-    }\n     return setAttribute(key, AttributeValue.stringAttributeValue(value));\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTM3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368155376", "bodyText": "What is the behavior for AttributeValue.stringAttributeValue(value) in case a null string is passed?", "author": "bogdandrutu", "createdAt": "2020-01-17T22:04:33Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -137,6 +138,9 @@\n \n   @Override\n   public Span.Builder setAttribute(String key, String value) {\n+    if (StringUtils.isNullOrBlank(value)) {\n+      return this;\n+    }\n     return setAttribute(key, AttributeValue.stringAttributeValue(value));", "originalCommit": "71b9b77da949061995cb35e24fd90b3f05fcc903", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NzM2OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368157368", "bodyText": "that remains the same. If you're trying to create an AttributeValue with a null, you'll get the usual NPE.", "author": "jkwatson", "createdAt": "2020-01-17T22:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1ODI2Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368158266", "bodyText": "k", "author": "bogdandrutu", "createdAt": "2020-01-17T22:14:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1ODQ3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368158476", "bodyText": "I think this is unexpected result and inconsistent, maybe we should try to see how we can offer the same behavior.", "author": "bogdandrutu", "createdAt": "2020-01-17T22:14:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1OTk0NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368159945", "bodyText": "that's a fair comment. I think we can do this by allowing null/empty in the AttributeValue, and then ignoring when we try to add. I'll change this PR to do it that way.", "author": "jkwatson", "createdAt": "2020-01-17T22:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2MzE0MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/771#discussion_r368163140", "bodyText": "ok, changed", "author": "jkwatson", "createdAt": "2020-01-17T22:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NTM3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "0e77fcb292510ff2ea9979757e2e3a9c0735e56d", "chunk": "diff --git a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\nindex e3d41c847..080829b11 100644\n--- a/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n+++ b/sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java\n\n@@ -138,9 +139,6 @@ class SpanBuilderSdk implements Span.Builder {\n \n   @Override\n   public Span.Builder setAttribute(String key, String value) {\n-    if (StringUtils.isNullOrBlank(value)) {\n-      return this;\n-    }\n     return setAttribute(key, AttributeValue.stringAttributeValue(value));\n   }\n \n"}}, {"oid": "0e77fcb292510ff2ea9979757e2e3a9c0735e56d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/0e77fcb292510ff2ea9979757e2e3a9c0735e56d", "message": "change to ignore at the AttributeValue level, rather than above", "committedDate": "2020-01-17T22:30:09Z", "type": "commit"}]}