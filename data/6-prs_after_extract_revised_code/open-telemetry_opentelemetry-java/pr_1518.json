{"pr_number": 1518, "pr_title": "fix splitting metadata key-value substring with more than one '=' sign", "pr_createdAt": "2020-08-07T05:16:21Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1518", "timeline": [{"oid": "a27192fc66bd1bb0d7dc9bf207b3efb559386a63", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a27192fc66bd1bb0d7dc9bf207b3efb559386a63", "message": "fix splitting metadata key-value substring with more than one '=' sign\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-08-07T05:15:47Z", "type": "commit"}, {"oid": "7aa6fb4b7e267b99185fe332ab92f356211ed5d2", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7aa6fb4b7e267b99185fe332ab92f356211ed5d2", "message": "add testing of metadata key-value pair with more than one '=' sign\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-08-07T05:28:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgzMDM3Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1518#discussion_r466830377", "bodyText": "Should we also add trimResults omitEmptyStrings? These are HTTP headers so at least keys cannot have spaces or be empty. I'm less sure about trimming the values or the key only, but I think usually a trailing space on a value will be a bug not a feature.", "author": "anuraaga", "createdAt": "2020-08-07T05:35:03Z", "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -291,7 +291,7 @@ protected Builder fromConfigMap(\n       String metadataValue = getStringProperty(KEY_METADATA, configMap);\n       if (metadataValue != null) {\n         for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n-          final List<String> keyValue = Splitter.on('=').splitToList(keyValueString);\n+          final List<String> keyValue = Splitter.on('=').limit(2).splitToList(keyValueString);", "originalCommit": "7aa6fb4b7e267b99185fe332ab92f356211ed5d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg0MTQxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1518#discussion_r466841412", "bodyText": "added", "author": "malafeev", "createdAt": "2020-08-07T06:13:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgzMDM3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "18076692b2da4a4f228e9a5ade0c36761190677a", "chunk": "diff --git a/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java b/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java\nindex 27e257082..307134124 100644\n--- a/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java\n+++ b/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java\n\n@@ -291,7 +291,8 @@ public final class OtlpGrpcSpanExporter implements SpanExporter {\n       String metadataValue = getStringProperty(KEY_METADATA, configMap);\n       if (metadataValue != null) {\n         for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n-          final List<String> keyValue = Splitter.on('=').limit(2).splitToList(keyValueString);\n+          final List<String> keyValue = Splitter.on('=').limit(2).trimResults().omitEmptyStrings()\n+              .splitToList(keyValueString);\n           if (keyValue.size() == 2) {\n             addHeader(keyValue.get(0), keyValue.get(1));\n           }\n"}}, {"oid": "18076692b2da4a4f228e9a5ade0c36761190677a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/18076692b2da4a4f228e9a5ade0c36761190677a", "message": "add trimResults() and omitEmptyStrings()\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-08-07T06:13:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg0MTc5Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1518#discussion_r466841796", "bodyText": "Thanks! If you can add two more test cases, one with trimmed results and one with empty strings, that'd be great.", "author": "anuraaga", "createdAt": "2020-08-07T06:14:41Z", "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -291,7 +291,8 @@ protected Builder fromConfigMap(\n       String metadataValue = getStringProperty(KEY_METADATA, configMap);\n       if (metadataValue != null) {\n         for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n-          final List<String> keyValue = Splitter.on('=').splitToList(keyValueString);\n+          final List<String> keyValue = Splitter.on('=').limit(2).trimResults().omitEmptyStrings()", "originalCommit": "18076692b2da4a4f228e9a5ade0c36761190677a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg0Mzk5Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1518#discussion_r466843997", "bodyText": "added", "author": "malafeev", "createdAt": "2020-08-07T06:21:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg0MTc5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "aa1ba32cbd8769899aaf3a3def89167a38b36abb", "chunk": "diff --git a/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java b/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java\nindex 307134124..8719461a6 100644\n--- a/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java\n+++ b/exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java\n\n@@ -291,8 +291,12 @@ public final class OtlpGrpcSpanExporter implements SpanExporter {\n       String metadataValue = getStringProperty(KEY_METADATA, configMap);\n       if (metadataValue != null) {\n         for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n-          final List<String> keyValue = Splitter.on('=').limit(2).trimResults().omitEmptyStrings()\n-              .splitToList(keyValueString);\n+          final List<String> keyValue =\n+              Splitter.on('=')\n+                  .limit(2)\n+                  .trimResults()\n+                  .omitEmptyStrings()\n+                  .splitToList(keyValueString);\n           if (keyValue.size() == 2) {\n             addHeader(keyValue.get(0), keyValue.get(1));\n           }\n"}}, {"oid": "aa1ba32cbd8769899aaf3a3def89167a38b36abb", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/aa1ba32cbd8769899aaf3a3def89167a38b36abb", "message": "reformat and add more test cases\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-08-07T06:20:41Z", "type": "commit"}]}