{"pr_number": 1835, "pr_title": "Fix non-null carrier not working in extract.", "pr_createdAt": "2020-10-19T14:39:32Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1835", "timeline": [{"oid": "f0628dae1c17fede6c4409917803727144b70051", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f0628dae1c17fede6c4409917803727144b70051", "message": "Fix non-null carrier not working in extract.", "committedDate": "2020-10-19T14:38:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgwOTkxOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1835#discussion_r507809918", "bodyText": "This should probably fixed -- either remove the check and let an NPE occur \"naturally\" or use Objects.requireNonNull. Or we could change all propagators to do something like here (best with logging though).\nIn any case, this should be a follow-up.", "author": "Oberon00", "createdAt": "2020-10-19T14:42:38Z", "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/OtTracerPropagator.java", "diffHunk": "@@ -64,8 +65,9 @@ public static OtTracerPropagator getInstance() {\n   }\n \n   @Override\n-  public <C> Context extract(Context context, C carrier, Getter<C> getter) {\n+  public <C> Context extract(Context context, @Nullable C carrier, Getter<C> getter) {\n     if (context == null || getter == null) {\n+      // TODO Other propagators throw exceptions here", "originalCommit": "f0628dae1c17fede6c4409917803727144b70051", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgxMTEzNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1835#discussion_r507811134", "bodyText": "This test here demonstrates one case where a null carrier might be sensibly used.", "author": "Oberon00", "createdAt": "2020-10-19T14:44:12Z", "path": "api/src/test/java/io/opentelemetry/trace/propagation/HttpTraceContextTest.java", "diffHunk": "@@ -166,6 +166,18 @@ void extract_SampledContext() {\n                 TRACE_ID_BASE16, SPAN_ID_BASE16, SAMPLED_TRACE_OPTIONS, TRACE_STATE_DEFAULT));\n   }\n \n+  @Test\n+  void extract_NullCarrier() {\n+    Map<String, String> carrier = new LinkedHashMap<>();\n+    carrier.put(TRACE_PARENT, TRACEPARENT_HEADER_SAMPLED);\n+    assertThat(\n+            getSpanContext(\n+                httpTraceContext.extract(Context.current(), null, (c, k) -> carrier.get(k))))", "originalCommit": "f0628dae1c17fede6c4409917803727144b70051", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgyNDkzMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1835#discussion_r507824931", "bodyText": "*sensibly is relative here but at least it demonstrates how checking for null could be surprising", "author": "Oberon00", "createdAt": "2020-10-19T15:01:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgxMTEzNA=="}], "type": "inlineReview", "revised_code": null}]}