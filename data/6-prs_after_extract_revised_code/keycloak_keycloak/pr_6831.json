{"pr_number": 6831, "pr_title": "KEYCLOAK-12979 Fix group-attribute parsing", "pr_createdAt": "2020-02-25T07:44:28Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6831", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0MTI4NA==", "url": "https://github.com/keycloak/keycloak/pull/6831#discussion_r384341284", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Pattern pattern = Pattern.compile(attribute + \"(.*)\");\n          \n          \n            \n                    Pattern pattern = Pattern.compile(Pattern.quote(attribute) + \"\\\\s*(.*)\");", "author": "hmlnarik", "createdAt": "2020-02-26T08:41:09Z", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java", "diffHunk": "@@ -1161,17 +1163,14 @@ public void testRelayStateEncoding() throws Exception {\n     }\n \n     private static List<String> parseCommaSeparatedAttributes(String body, String attribute) {\n-        int start = body.indexOf(attribute) + attribute.length();\n-        if (start == -1) {\n-            return Collections.emptyList();\n-        }\n-        int end = body.indexOf(System.getProperty(\"line.separator\"), start);\n-        if (end == -1) {\n-            end = body.length();\n+        Pattern pattern = Pattern.compile(attribute + \"(.*)\");", "originalCommit": "18430ec318bab90b746c2cc678cfa8fbc96b22f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM4NTA0OA==", "url": "https://github.com/keycloak/keycloak/pull/6831#discussion_r384385048", "bodyText": "@hmlnarik Done.", "author": "mhajas", "createdAt": "2020-02-26T09:56:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0MTI4NA=="}], "type": "inlineReview", "revised_code": {"commit": "3cbb91bbd5cb5327cea7c1feef61441ef795bcde", "chunk": "diff --git a/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java b/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java\nindex c065ced2be..364f976437 100644\n--- a/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java\n+++ b/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java\n\n@@ -1162,15 +1162,15 @@ public class SAMLServletAdapterTest extends AbstractSAMLServletAdapterTest {\n         Assert.assertThat(pageSource, not(containsString(\"SAML response: null\")));\n     }\n \n-    private static List<String> parseCommaSeparatedAttributes(String body, String attribute) {\n-        Pattern pattern = Pattern.compile(attribute + \"(.*)\");\n+    private static String[] parseCommaSeparatedAttributes(String body, String attribute) {\n+        Pattern pattern = Pattern.compile(Pattern.quote(attribute) + \":\\\\s*(.*)\");\n         Matcher matcher = pattern.matcher(body);\n \n         if (matcher.find()) {\n-            return Arrays.asList(matcher.group(1).split(\",\"));\n+            return matcher.group(1).split(\",\");\n         }\n \n-        return Collections.emptyList();\n+        return new String[0];\n     }\n \n     @Test\n"}}, {"oid": "3cbb91bbd5cb5327cea7c1feef61441ef795bcde", "url": "https://github.com/keycloak/keycloak/commit/3cbb91bbd5cb5327cea7c1feef61441ef795bcde", "message": "KEYCLOAK-12979 Fix group-attribute parsing", "committedDate": "2020-02-26T09:06:36Z", "type": "commit"}, {"oid": "3cbb91bbd5cb5327cea7c1feef61441ef795bcde", "url": "https://github.com/keycloak/keycloak/commit/3cbb91bbd5cb5327cea7c1feef61441ef795bcde", "message": "KEYCLOAK-12979 Fix group-attribute parsing", "committedDate": "2020-02-26T09:06:36Z", "type": "forcePushed"}]}