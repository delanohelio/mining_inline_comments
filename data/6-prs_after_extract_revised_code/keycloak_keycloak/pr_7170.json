{"pr_number": 7170, "pr_title": "KEYCLOAK-11683 Reduce unnecessary load on work cache", "pr_createdAt": "2020-06-15T14:25:26Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7170", "timeline": [{"oid": "37b9c718e4366999be9e6ef15ca79494f0fea441", "url": "https://github.com/keycloak/keycloak/commit/37b9c718e4366999be9e6ef15ca79494f0fea441", "message": "KEYCLOAK-11683 Reduce unnecessary load on work cache", "committedDate": "2020-06-15T14:23:05Z", "type": "commit"}, {"oid": "daf6b694320e2f0089bfb0fd1ae90a37a8cd0da6", "url": "https://github.com/keycloak/keycloak/commit/daf6b694320e2f0089bfb0fd1ae90a37a8cd0da6", "message": "Reversed equals() check to prevent NPE if current value is null.", "committedDate": "2020-06-17T10:32:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTQwOQ==", "url": "https://github.com/keycloak/keycloak/pull/7170#discussion_r442095409", "bodyText": "I'm slightly worried about using the 0 index here. Are we sure, this is always going to be 0?", "author": "slaskawi", "createdAt": "2020-06-18T09:30:22Z", "path": "services/src/main/java/org/keycloak/broker/saml/mappers/UserAttributeMapper.java", "diffHunk": "@@ -151,6 +152,12 @@ private void setIfNotEmpty(Consumer<String> consumer, List<String> values) {\n         }\n     }\n \n+    private void setIfNotEmptyAndDifferent(Consumer<String> consumer, Supplier<String> currentValueSupplier, List<String> values) {\n+        if (values != null && !values.isEmpty() && !values.get(0).equals(currentValueSupplier.get())) {\n+            consumer.accept(values.get(0));", "originalCommit": "daf6b694320e2f0089bfb0fd1ae90a37a8cd0da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5OTI3Nw==", "url": "https://github.com/keycloak/keycloak/pull/7170#discussion_r442099277", "bodyText": ".get(0) - that is how setIfNotEmpty() was already implemented.\nWe also have checks - values != null && !values.isEmpty() that guarantee that collection is not empty.\nSecondly, \"get(0)\" element is guaranteed to be non-null because \"values\" come from findAttributeValuesInContext() method which has \".filter(Objects::nonNull)\"", "author": "ovshevchuk", "createdAt": "2020-06-18T09:37:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTQwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEyNTUyNA==", "url": "https://github.com/keycloak/keycloak/pull/7170#discussion_r442125524", "bodyText": "Fair enough, let me approve.", "author": "slaskawi", "createdAt": "2020-06-18T10:24:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTQwOQ=="}], "type": "inlineReview", "revised_code": null}]}