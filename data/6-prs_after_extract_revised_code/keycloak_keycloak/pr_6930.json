{"pr_number": 6930, "pr_title": "KEYCLOAK-13445 Modify SigningInTest for changes in credential type", "pr_createdAt": "2020-03-25T09:32:54Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6930", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxNzgxNA==", "url": "https://github.com/keycloak/keycloak/pull/6930#discussion_r398517814", "bodyText": "Please rename this method:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public boolean isNotSetUpLinkVisible() {\n          \n          \n            \n                    public boolean isNotSetUpLabelVisible() {\n          \n      \n    \n    \n  \n\nIt's actually a label (or just a text, to be precise), not a link. ;)", "author": "vmuzikar", "createdAt": "2020-03-26T12:01:02Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/SigningInPage.java", "diffHunk": "@@ -124,6 +125,24 @@ public boolean isSetUpLinkVisible() {\n             }\n         }\n \n+        public boolean isNotSetUpLinkVisible() {", "originalCommit": "0f255eee6fe059844640afde4ddbf0eddf4c054d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/SigningInPage.java b/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/SigningInPage.java\nindex 848ce0b109..201eb820fb 100644\n--- a/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/SigningInPage.java\n+++ b/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/SigningInPage.java\n\n@@ -125,7 +125,7 @@ public class SigningInPage extends AbstractLoggedInPage {\n             }\n         }\n \n-        public boolean isNotSetUpLinkVisible() {\n+        public boolean isNotSetUpLabelVisible() {\n             try {\n                 return getItemElement(NOT_SET_UP).isDisplayed();\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2OTYxOA==", "url": "https://github.com/keycloak/keycloak/pull/6930#discussion_r398569618", "bodyText": "Before this, we need to disable given required action and also add an assert to check that the setup link is not visible. We could also check the user credential count didn't change after that. Something like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertFalse(\"Not set up link is visible\", otpCredentialType.isNotSetUpLinkVisible());\n          \n          \n            \n                    assertTrue(\"Title is not visible\", otpCredentialType.isTitleVisible());\n          \n          \n            \n                    assertTrue(\"Set up link is not visible\", otpCredentialType.isSetUpLinkVisible());\n          \n          \n            \n            \n          \n          \n            \n                    RequiredActionProviderRepresentation requiredAction = new RequiredActionProviderRepresentation();\n          \n          \n            \n                    requiredAction.setEnabled(false);\n          \n          \n            \n                    testRealmResource().flows().updateRequiredAction(CONFIGURE_TOTP.name(), requiredAction);\n          \n          \n            \n            \n          \n          \n            \n                    assertFalse(\"Set up link is visible\", otpCredentialType.isSetUpLinkVisible());\n          \n          \n            \n                    assertFalse(\"Not set up link is visible\", otpCredentialType.isNotSetUpLinkVisible());\n          \n          \n            \n                    assertTrue(\"Title is not visible\", otpCredentialType.isTitleVisible());\n          \n          \n            \n                    assertEquals(2, otpCredentialType.getUserCredentialsCount());", "author": "vmuzikar", "createdAt": "2020-03-26T13:26:42Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java", "diffHunk": "@@ -240,6 +240,9 @@ public void otpTest() {\n         assertEquals(2, otpCredentialType.getUserCredentialsCount());\n         assertUserCredential(label2, true, otp2);\n \n+        assertFalse(\"Not set up link is visible\", otpCredentialType.isNotSetUpLinkVisible());\n+        assertTrue(\"Title is not visible\", otpCredentialType.isTitleVisible());", "originalCommit": "0f255eee6fe059844640afde4ddbf0eddf4c054d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java b/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\nindex 4b589f5e91..1869d1a24a 100644\n--- a/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\n+++ b/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\n\n@@ -240,8 +242,17 @@ public class SigningInTest extends BaseAccountPageTest {\n         assertEquals(2, otpCredentialType.getUserCredentialsCount());\n         assertUserCredential(label2, true, otp2);\n \n-        assertFalse(\"Not set up link is visible\", otpCredentialType.isNotSetUpLinkVisible());\n-        assertTrue(\"Title is not visible\", otpCredentialType.isTitleVisible());\n+        assertTrue(\"Set up link is not visible\", otpCredentialType.isSetUpLinkVisible());\n+        RequiredActionProviderRepresentation requiredAction = new RequiredActionProviderRepresentation();\n+        requiredAction.setEnabled(false);\n+        testRealmResource().flows().updateRequiredAction(CONFIGURE_TOTP.name(), requiredAction);\n+\n+        refreshPageAndWaitForLoad();\n+\n+        assertFalse(\"Set up link for \\\"otp\\\" is visible\", otpCredentialType.isSetUpLinkVisible());\n+        assertFalse(\"Not set up link for \\\"otp\\\" is visible\", otpCredentialType.isNotSetUpLabelVisible());\n+        assertTrue(\"Title for \\\"otp\\\" is not visible\", otpCredentialType.isTitleVisible());\n+        assertEquals(2, otpCredentialType.getUserCredentialsCount());\n \n         testRemoveCredential(otp1);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU3MDEwNw==", "url": "https://github.com/keycloak/keycloak/pull/6930#discussion_r398570107", "bodyText": "Same as above in otpTest.", "author": "vmuzikar", "createdAt": "2020-03-26T13:27:28Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java", "diffHunk": "@@ -286,6 +289,9 @@ private void testWebAuthn(boolean passwordless) {\n         assertEquals(2, credentialType.getUserCredentialsCount());\n         assertUserCredential(label2, true, webAuthn2);\n \n+        assertFalse(\"Not set up link is visible\", credentialType.isNotSetUpLinkVisible());\n+        assertTrue(\"Title is visible\", credentialType.isTitleVisible());", "originalCommit": "0f255eee6fe059844640afde4ddbf0eddf4c054d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java b/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\nindex 4b589f5e91..1869d1a24a 100644\n--- a/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\n+++ b/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\n\n@@ -289,8 +306,16 @@ public class SigningInTest extends BaseAccountPageTest {\n         assertEquals(2, credentialType.getUserCredentialsCount());\n         assertUserCredential(label2, true, webAuthn2);\n \n-        assertFalse(\"Not set up link is visible\", credentialType.isNotSetUpLinkVisible());\n-        assertTrue(\"Title is visible\", credentialType.isTitleVisible());\n+        RequiredActionProviderRepresentation requiredAction = new RequiredActionProviderRepresentation();\n+        requiredAction.setEnabled(false);\n+        testRealmResource().flows().updateRequiredAction(providerId, requiredAction);\n+\n+        refreshPageAndWaitForLoad();\n+\n+        assertFalse(\"Set up link for \\\"\" + credentialType.getType() + \"\\\" is visible\", credentialType.isSetUpLinkVisible());\n+        assertFalse(\"Not set up link for \\\"\" + credentialType.getType() + \"\\\" is visible\", credentialType.isNotSetUpLabelVisible());\n+        assertTrue(\"Title for \\\"\" + credentialType.getType() + \"\\\" is not visible\", credentialType.isTitleVisible());\n+        assertEquals(2, credentialType.getUserCredentialsCount());\n \n         testRemoveCredential(webAuthn1);\n     }\n"}}, {"oid": "b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "url": "https://github.com/keycloak/keycloak/commit/b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "message": "KEYCLOAK-13445 Modify SigningInTest for changes in credential type", "committedDate": "2020-03-27T10:03:16Z", "type": "commit"}, {"oid": "b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "url": "https://github.com/keycloak/keycloak/commit/b5723f741b8faa8adf0b088ae9fc96a97d5a9ba1", "message": "KEYCLOAK-13445 Modify SigningInTest for changes in credential type", "committedDate": "2020-03-27T10:03:16Z", "type": "forcePushed"}]}