{"pr_number": 6659, "pr_title": "[KEYCLOAK-12426] Add username to the login form + ability to reset login", "pr_createdAt": "2020-01-15T11:44:03Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6659", "timeline": [{"oid": "54e0098d574ebd5b9357d04400b3c62c15dc5c2c", "url": "https://github.com/keycloak/keycloak/commit/54e0098d574ebd5b9357d04400b3c62c15dc5c2c", "message": "[KEYCLOAK-12426] Add username to the login form + ability to reset login", "committedDate": "2020-01-15T19:07:29Z", "type": "forcePushed"}, {"oid": "6cbdc2394f0851c5c6aac54c6d049d6d04a12d3a", "url": "https://github.com/keycloak/keycloak/commit/6cbdc2394f0851c5c6aac54c6d049d6d04a12d3a", "message": "[KEYCLOAK-12426] Add username to the login form + ability to reset login", "committedDate": "2020-01-15T19:56:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzMyMjc0NA==", "url": "https://github.com/keycloak/keycloak/pull/6659#discussion_r367322744", "bodyText": "I am not sure why we need this?\nI agree that SelectAuthenticatorPage will need to be rewritten once KEYCLOAK-12469 is resolved, however the selecting authentication mechanism should already work in latest master as well - after selecting the mechanism in the combobox, there is some JS call triggered that should automatically redirect you to the page with the selected authentication mechanism. If it doesn't work, it might be a regression of this PR or it may have some other cause...\nI think we should fix the tests even when this Assume is removed. In general, using Assume is quite dangerous as it makes certain tests in-fact disabled, so I will rather not use it at all on places like this...", "author": "mposolda", "createdAt": "2020-01-16T09:50:33Z", "path": "testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/SelectAuthenticatorPage.java", "diffHunk": "@@ -35,16 +35,16 @@ public String getSelectedLoginMethod() {\n                 .stream()\n                 .filter(webElement -> webElement.getAttribute(\"selected\") != null)\n                 .findFirst()\n-                .orElseThrow(() -> {\n-\n-                    return new AssertionError(\"Selected login method not found\");\n-\n-                })\n+                .orElseThrow(() -> new AssertionError(\"Selected login method not found\"))\n                 .getText();\n     }\n \n \n+    // TODO After the select tiles (buttons) will be added to master branch, this method must be rewritten. There is only plain select,\n+    //  which doesn't redirect to page with required login method. Each test, which uses this method, is ready to work with\n+    //  select tiles. The select tiles should be added to master branch after resolving KEYCLOAK-12469.\n     public void selectLoginMethod(String loginMethod) {\n+        Assume.assumeTrue(\"This test is WiP, so it must be remade after adding a certain feature.\",false);", "originalCommit": "6cbdc2394f0851c5c6aac54c6d049d6d04a12d3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0NzgxMw==", "url": "https://github.com/keycloak/keycloak/pull/6659#discussion_r367347813", "bodyText": "@mposolda Each test, which uses the selectLoginMethod, will fail. Because afterwards, the test presume the page is redirected to selected authenticator page, but it's not. So, I've kept the tests there and only \"skip\" the tests, in order to keep functionality to the latest version of selectLoginMethod. I tried to fix the tests, but I didn't figure out how to manually redirect to the authenticator.\nIs there any way, how to do that?\nI'll try to explore the redirecting more deeply. Thanks!", "author": "mabartos", "createdAt": "2020-01-16T10:42:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzMyMjc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQzODI3Mg==", "url": "https://github.com/keycloak/keycloak/pull/6659#discussion_r367438272", "bodyText": "I'm sorry. I've caused the problem. \"Assume\" block is removed. The problem was with the nested header tag in template.ftl.", "author": "mabartos", "createdAt": "2020-01-16T14:12:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzMyMjc0NA=="}], "type": "inlineReview", "revised_code": {"commit": "9d898d2cfe20e20e371777659abd2ddd4104909b", "chunk": "diff --git a/testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/SelectAuthenticatorPage.java b/testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/SelectAuthenticatorPage.java\nindex 347329818f..656e4af24b 100644\n--- a/testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/SelectAuthenticatorPage.java\n+++ b/testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/SelectAuthenticatorPage.java\n\n@@ -35,16 +35,16 @@ public class SelectAuthenticatorPage extends LanguageComboboxAwarePage {\n                 .stream()\n                 .filter(webElement -> webElement.getAttribute(\"selected\") != null)\n                 .findFirst()\n-                .orElseThrow(() -> new AssertionError(\"Selected login method not found\"))\n+                .orElseThrow(() -> {\n+\n+                    return new AssertionError(\"Selected login method not found\");\n+\n+                })\n                 .getText();\n     }\n \n \n-    // TODO After the select tiles (buttons) will be added to master branch, this method must be rewritten. There is only plain select,\n-    //  which doesn't redirect to page with required login method. Each test, which uses this method, is ready to work with\n-    //  select tiles. The select tiles should be added to master branch after resolving KEYCLOAK-12469.\n     public void selectLoginMethod(String loginMethod) {\n-        Assume.assumeTrue(\"This test is WiP, so it must be remade after adding a certain feature.\",false);\n         new Select(authenticatorsSelect).selectByVisibleText(loginMethod);\n     }\n \n"}}, {"oid": "9d898d2cfe20e20e371777659abd2ddd4104909b", "url": "https://github.com/keycloak/keycloak/commit/9d898d2cfe20e20e371777659abd2ddd4104909b", "message": "KEYCLOAK-12426 Add username to the login form + ability to reset login - NOT DESIGN YET", "committedDate": "2020-01-16T14:09:51Z", "type": "commit"}, {"oid": "3cd72e603965f8568d1b939fe7e3ac7f43c6328b", "url": "https://github.com/keycloak/keycloak/commit/3cd72e603965f8568d1b939fe7e3ac7f43c6328b", "message": "[KEYCLOAK-12426] Add username to the login form + ability to reset login", "committedDate": "2020-01-16T14:09:51Z", "type": "commit"}, {"oid": "3cd72e603965f8568d1b939fe7e3ac7f43c6328b", "url": "https://github.com/keycloak/keycloak/commit/3cd72e603965f8568d1b939fe7e3ac7f43c6328b", "message": "[KEYCLOAK-12426] Add username to the login form + ability to reset login", "committedDate": "2020-01-16T14:09:51Z", "type": "forcePushed"}]}