{"pr_number": 6658, "pr_title": "KEYCLOAK-12125 Introduce SameSite attribute in cookies", "pr_createdAt": "2020-01-15T10:04:31Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6658", "timeline": [{"oid": "16302ca08fa20eeb2f739907db306196b0156fd2", "url": "https://github.com/keycloak/keycloak/commit/16302ca08fa20eeb2f739907db306196b0156fd2", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>", "committedDate": "2020-01-16T12:48:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQzODA2Ng==", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367438066", "bodyText": "If we only support NONE at the moment, I'd rather to make it a constant and not advertise LAX or STRICT in the code.", "author": "abstractj", "createdAt": "2020-01-16T14:12:22Z", "path": "common/src/main/java/org/keycloak/common/util/ServerCookie.java", "diffHunk": "@@ -32,6 +32,22 @@\n     private static final String tspecials = \",; \";\n     private static final String tspecials2 = \"()<>@,;:\\\\\\\"/[]?={} \\t\";\n \n+    public enum SameSiteAttributeValue {\n+        NONE(\"None\"), // we currently support only SameSite=None; this might change in the future\n+        STRICT(\"Strict\"),", "originalCommit": "16302ca08fa20eeb2f739907db306196b0156fd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0MTAyNg==", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367441026", "bodyText": "@abstractj Done. (We actually had only the NONE value there at some point during the development. ;))", "author": "vmuzikar", "createdAt": "2020-01-16T14:18:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQzODA2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "492c5c1348102ce04bd6ee83ec22e261bf629893", "chunk": "diff --git a/common/src/main/java/org/keycloak/common/util/ServerCookie.java b/common/src/main/java/org/keycloak/common/util/ServerCookie.java\nindex 8df1322a1a..be3850cf0b 100755\n--- a/common/src/main/java/org/keycloak/common/util/ServerCookie.java\n+++ b/common/src/main/java/org/keycloak/common/util/ServerCookie.java\n\n@@ -33,9 +33,7 @@ public class ServerCookie implements Serializable {\n     private static final String tspecials2 = \"()<>@,;:\\\\\\\"/[]?={} \\t\";\n \n     public enum SameSiteAttributeValue {\n-        NONE(\"None\"), // we currently support only SameSite=None; this might change in the future\n-        STRICT(\"Strict\"),\n-        LAX(\"Lax\");\n+        NONE(\"None\"); // we currently support only SameSite=None; this might change in the future\n \n         private final String specValue;\n         SameSiteAttributeValue(String specValue) {\n"}}, {"oid": "492c5c1348102ce04bd6ee83ec22e261bf629893", "url": "https://github.com/keycloak/keycloak/commit/492c5c1348102ce04bd6ee83ec22e261bf629893", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>", "committedDate": "2020-01-16T14:16:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NTkyNg==", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367445926", "bodyText": "A minor nitpick, but StringBuilder is faster than StringBuffer, plus it seems that's our preferred choice into the codebase.", "author": "abstractj", "createdAt": "2020-01-16T14:26:41Z", "path": "common/src/main/java/org/keycloak/common/util/ServerCookie.java", "diffHunk": "@@ -173,7 +187,8 @@ public static void appendCookieValue(StringBuffer headerBuf,\n                                          String comment,\n                                          int maxAge,\n                                          boolean isSecure,\n-                                         boolean httpOnly) {\n+                                         boolean httpOnly,\n+                                         SameSiteAttributeValue sameSite) {\n         StringBuffer buf = new StringBuffer();", "originalCommit": "492c5c1348102ce04bd6ee83ec22e261bf629893", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0Njk3Ng==", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367446976", "bodyText": "@abstractj It was like this before, I wanted to change as little things as possible so I haven't touched this. Do you want me to switch it for StringBuilder?", "author": "vmuzikar", "createdAt": "2020-01-16T14:28:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NTkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ2MDI2Nw==", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367460267", "bodyText": "@vmuzikar I overlooked this. That's not a deal breaker, we can leave it as is.", "author": "abstractj", "createdAt": "2020-01-16T14:51:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NTkyNg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789", "url": "https://github.com/keycloak/keycloak/commit/6b658283da86f5f1cf53b555fca649ade2b9a789", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>", "committedDate": "2020-01-16T15:15:03Z", "type": "commit"}, {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789", "url": "https://github.com/keycloak/keycloak/commit/6b658283da86f5f1cf53b555fca649ade2b9a789", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>", "committedDate": "2020-01-16T15:15:03Z", "type": "forcePushed"}]}