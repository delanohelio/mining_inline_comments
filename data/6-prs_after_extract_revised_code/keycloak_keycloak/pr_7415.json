{"pr_number": 7415, "pr_title": "KEYCLOAK-3365 Configure required actions for LDAP in READ_ONLY mode", "pr_createdAt": "2020-09-11T15:03:30Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7415", "timeline": [{"oid": "8439f73cdff9c8068c4b9de092bc46be61513412", "url": "https://github.com/keycloak/keycloak/commit/8439f73cdff9c8068c4b9de092bc46be61513412", "message": "KEYCLOAK-3365 Configure required actions for LDAP in READ_ONLY mode", "committedDate": "2020-10-12T16:55:58Z", "type": "commit"}, {"oid": "c40b82dee08237351e7f2d595c88406806d9eb0e", "url": "https://github.com/keycloak/keycloak/commit/c40b82dee08237351e7f2d595c88406806d9eb0e", "message": "KEYCLOAK-3365 Add test case", "committedDate": "2020-10-13T20:29:30Z", "type": "commit"}, {"oid": "c40b82dee08237351e7f2d595c88406806d9eb0e", "url": "https://github.com/keycloak/keycloak/commit/c40b82dee08237351e7f2d595c88406806d9eb0e", "message": "KEYCLOAK-3365 Add test case", "committedDate": "2020-10-13T20:29:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ0MDcxMg==", "url": "https://github.com/keycloak/keycloak/pull/7415#discussion_r504440712", "bodyText": "Do you please have a chance to update this test a bit and test that requiredAction add/remove works? As I believe that is the main reason why you created this PR. I mean something similar to this:\n        UserResource user = ApiUtil.findUserByUsernameId(testRealm(), \"johnkeycloak\");\n        UserRepresentation userRepresentation = user.toRepresentation();\n        user.setRequiredActions(Collections.singletonList(UserModel.RequiredAction.CONFIGURE_TOTP.toString());\n        user.update(userRepresentation);\n\n        // Check and revert required action\n        userRepresentation = user.toRepresentation();\n        Assert.assertEquals(user.toRepresentation().getRequiredActions().getSize(), 1);\n        Assert.assertEquals(user.toRepresentation().getRequiredActions().get(0), UserModel.RequiredAction.CONFIGURE_TOTP.toString());\n        user.setRequiredActions(Collections.emptyList());\n        user.update(userRepresentation);", "author": "mposolda", "createdAt": "2020-10-14T06:51:01Z", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/ldap/LDAPReadOnlyTest.java", "diffHunk": "@@ -125,6 +127,23 @@ public void testReadOnlyWithTOTPEnabled() {\n         user.removeCredential(totpCredentialId);\n     }\n \n+    // KEYCLOAK-3365\n+    @Test\n+    public void testReadOnlyUserDoesNotThrowIfUnchanged() {\n+        UserResource user = ApiUtil.findUserByUsernameId(testRealm(), \"johnkeycloak\");", "originalCommit": "c40b82dee08237351e7f2d595c88406806d9eb0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU3NzY2MQ==", "url": "https://github.com/keycloak/keycloak/pull/7415#discussion_r504577661", "bodyText": "Good point! Done.", "author": "sventorben", "createdAt": "2020-10-14T10:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ0MDcxMg=="}], "type": "inlineReview", "revised_code": {"commit": "b6e1befc34472514750cff73586db8c107e3e186", "chunk": "diff --git a/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/ldap/LDAPReadOnlyTest.java b/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/ldap/LDAPReadOnlyTest.java\nindex bb2eec3067..af8a90f22c 100644\n--- a/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/ldap/LDAPReadOnlyTest.java\n+++ b/testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/ldap/LDAPReadOnlyTest.java\n\n@@ -132,6 +134,17 @@ public class LDAPReadOnlyTest extends AbstractLDAPTest  {\n     public void testReadOnlyUserDoesNotThrowIfUnchanged() {\n         UserResource user = ApiUtil.findUserByUsernameId(testRealm(), \"johnkeycloak\");\n         UserRepresentation userRepresentation = user.toRepresentation();\n+        userRepresentation.setRequiredActions(Collections.singletonList(UserModel.RequiredAction.CONFIGURE_TOTP.toString()));\n+        user.update(userRepresentation);\n+\n+        // assert\n+        user = ApiUtil.findUserByUsernameId(testRealm(), \"johnkeycloak\");\n+        userRepresentation = user.toRepresentation();\n+        Assert.assertEquals(userRepresentation.getRequiredActions().size(), 1);\n+        Assert.assertEquals(userRepresentation.getRequiredActions().get(0), UserModel.RequiredAction.CONFIGURE_TOTP.toString());\n+\n+        // reset\n+        userRepresentation.setRequiredActions(Collections.emptyList());\n         user.update(userRepresentation);\n     }\n \n"}}, {"oid": "b6e1befc34472514750cff73586db8c107e3e186", "url": "https://github.com/keycloak/keycloak/commit/b6e1befc34472514750cff73586db8c107e3e186", "message": "KEYCLOAK-3365 Extend test case", "committedDate": "2020-10-14T10:41:20Z", "type": "commit"}]}