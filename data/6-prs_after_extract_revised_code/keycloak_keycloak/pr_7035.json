{"pr_number": 7035, "pr_title": "[KEYCLOAK-14046] Include groups in user creation via Admin Console", "pr_createdAt": "2020-05-03T12:14:22Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7035", "timeline": [{"oid": "d59844d55982b82bca9c0c3744aad100caf189c6", "url": "https://github.com/keycloak/keycloak/commit/d59844d55982b82bca9c0c3744aad100caf189c6", "message": "Added UI integration tests", "committedDate": "2020-08-27T17:07:50Z", "type": "forcePushed"}, {"oid": "118f9a766c5e5ddf536043c7914c4aff5182e9fe", "url": "https://github.com/keycloak/keycloak/commit/118f9a766c5e5ddf536043c7914c4aff5182e9fe", "message": "Flatten nested groups in user creation groups searchbox", "committedDate": "2020-09-22T11:46:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY4NjczMQ==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r492686731", "bodyText": "Strictly speaking, a user test shouldn't also test creating of groups. A better approach would be to just use the REST API to create the group. But since you already implemented that, let's leave it as is. :)", "author": "vmuzikar", "createdAt": "2020-09-22T12:18:50Z", "path": "testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java", "diffHunk": "@@ -99,4 +112,31 @@ public void disabledUser() {\n         // TODO try to log in\n     }\n \n+    @Test\n+    public void createUserWithGroups() {\n+        GroupRepresentation newGroup = new GroupRepresentation();\n+        newGroup.setName(\"mygroup\");\n+\n+        // navigate to Groups creation page\n+        groupsPage.navigateTo();\n+        assertCurrentUrlEquals(groupsPage);\n+        groupsPage.table().addGroup();\n+        assertCurrentUrlStartsWith(createGroupPage);\n+\n+        // create the group\n+        createGroupPage.form().setValues(newGroup);\n+        createGroupPage.form().save();\n+        assertAlertSuccess();", "originalCommit": "118f9a766c5e5ddf536043c7914c4aff5182e9fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2e1a6ed60663e60551d9a1f8a54c9ff463e1ad9f", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java b/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java\nindex 700ae64927..d228527e3f 100644\n--- a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java\n+++ b/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java\n\n@@ -112,31 +99,4 @@ public class UserAttributesTest extends AbstractUserTest {\n         // TODO try to log in\n     }\n \n-    @Test\n-    public void createUserWithGroups() {\n-        GroupRepresentation newGroup = new GroupRepresentation();\n-        newGroup.setName(\"mygroup\");\n-\n-        // navigate to Groups creation page\n-        groupsPage.navigateTo();\n-        assertCurrentUrlEquals(groupsPage);\n-        groupsPage.table().addGroup();\n-        assertCurrentUrlStartsWith(createGroupPage);\n-\n-        // create the group\n-        createGroupPage.form().setValues(newGroup);\n-        createGroupPage.form().save();\n-        assertAlertSuccess();\n-\n-        // navigate to Users creation page\n-        usersPage.navigateTo();\n-        RealmRepresentation representation = testRealmResource().toRepresentation();\n-        representation.setRegistrationEmailAsUsername(true);\n-        testRealmResource().update(representation);\n-        newTestRealmUser.setEmail(\"test-with-groups@keycloak.org\");\n-        newTestRealmUser.setGroups(Arrays.asList(\"mygroup\"));\n-        createUser(newTestRealmUser);\n-        assertAlertSuccess();\n-    }\n-\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxNzcyOQ==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r492717729", "bodyText": "Even though this is out of scope of this PR, thanks for adding it. It's a shame we didn't have UI tests for groups. :(", "author": "vmuzikar", "createdAt": "2020-09-22T13:07:13Z", "path": "testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/AbstractGroupTest.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package org.keycloak.testsuite.console.groups;\n+\n+import org.jboss.arquillian.graphene.page.Page;\n+import org.junit.Before;\n+import org.keycloak.admin.client.resource.GroupResource;\n+import org.keycloak.admin.client.resource.GroupsResource;\n+import org.keycloak.representations.idm.GroupRepresentation;\n+import org.keycloak.testsuite.console.AbstractConsoleTest;\n+import org.keycloak.testsuite.console.page.groups.CreateGroup;\n+import org.keycloak.testsuite.console.page.groups.Groups;\n+\n+import static org.keycloak.testsuite.util.URLAssert.assertCurrentUrlEquals;\n+import static org.keycloak.testsuite.util.URLAssert.assertCurrentUrlStartsWith;\n+\n+/**\n+ *\n+ * @author clementcur\n+ */\n+public abstract class AbstractGroupTest extends AbstractConsoleTest {", "originalCommit": "118f9a766c5e5ddf536043c7914c4aff5182e9fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2e1a6ed60663e60551d9a1f8a54c9ff463e1ad9f", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/AbstractGroupTest.java b/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/AbstractGroupTest.java\ndeleted file mode 100644\nindex 291261751e..0000000000\n--- a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/AbstractGroupTest.java\n+++ /dev/null\n\n@@ -1,40 +0,0 @@\n-package org.keycloak.testsuite.console.groups;\n-\n-import org.jboss.arquillian.graphene.page.Page;\n-import org.junit.Before;\n-import org.keycloak.admin.client.resource.GroupResource;\n-import org.keycloak.admin.client.resource.GroupsResource;\n-import org.keycloak.representations.idm.GroupRepresentation;\n-import org.keycloak.testsuite.console.AbstractConsoleTest;\n-import org.keycloak.testsuite.console.page.groups.CreateGroup;\n-import org.keycloak.testsuite.console.page.groups.Groups;\n-\n-import static org.keycloak.testsuite.util.URLAssert.assertCurrentUrlEquals;\n-import static org.keycloak.testsuite.util.URLAssert.assertCurrentUrlStartsWith;\n-\n-/**\n- *\n- * @author clementcur\n- */\n-public abstract class AbstractGroupTest extends AbstractConsoleTest {\n-\n-    @Page\n-    protected Groups groupsPage;\n-    @Page\n-    protected CreateGroup createGroupPage;\n-\n-    protected GroupRepresentation newTestRealmGroup;\n-    \n-    @Before\n-    public void beforeGroupTest() {\n-        newTestRealmGroup = new GroupRepresentation();\n-    }\n-\n-    public void createGroup(GroupRepresentation group) {\n-        assertCurrentUrlEquals(groupsPage);\n-        groupsPage.table().addGroup();\n-        assertCurrentUrlStartsWith(createGroupPage);\n-        createGroupPage.form().setValues(group);\n-        createGroupPage.form().save();\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNDQwMQ==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r492724401", "bodyText": "I'm getting some compilation errors here. The tests need to be passing with Java 8 (which is used by our CI).", "author": "vmuzikar", "createdAt": "2020-09-22T13:16:43Z", "path": "testsuite/integration-arquillian/tests/other/console/src/main/java/org/keycloak/testsuite/console/page/users/UserAttributesForm.java", "diffHunk": "@@ -121,8 +126,40 @@ public void setValues(UserRepresentation user) {\n         setLastName(user.getLastName());\n         if (user.isEnabled() != null) setEnabled(user.isEnabled());\n         if (user.isEmailVerified() != null) setEmailVerified(user.isEmailVerified());\n+        if (user.getGroups() != null && user.getGroups().length > 0) setGroups(new HashSet<String>(user.getGroups()));\n         if (user.getRequiredActions() != null) setRequiredActions(new HashSet<>(user.getRequiredActions()));\n     }\n \n     // TODO Contact Information section\n+\n+    public class GroupSelect extends MultipleStringSelect2 {", "originalCommit": "118f9a766c5e5ddf536043c7914c4aff5182e9fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg5NjQ1NA==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r494896454", "bodyText": "fixed in latest commit", "author": "clementcur", "createdAt": "2020-09-25T10:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNDQwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "22e3fe382312a755d8e75f5248dfb4a8014d0237", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/console/src/main/java/org/keycloak/testsuite/console/page/users/UserAttributesForm.java b/testsuite/integration-arquillian/tests/other/console/src/main/java/org/keycloak/testsuite/console/page/users/UserAttributesForm.java\nindex 81a0eb2011..d92e63a296 100644\n--- a/testsuite/integration-arquillian/tests/other/console/src/main/java/org/keycloak/testsuite/console/page/users/UserAttributesForm.java\n+++ b/testsuite/integration-arquillian/tests/other/console/src/main/java/org/keycloak/testsuite/console/page/users/UserAttributesForm.java\n\n@@ -126,7 +132,7 @@ public class UserAttributesForm extends Form {\n         setLastName(user.getLastName());\n         if (user.isEnabled() != null) setEnabled(user.isEnabled());\n         if (user.isEmailVerified() != null) setEmailVerified(user.isEmailVerified());\n-        if (user.getGroups() != null && user.getGroups().length > 0) setGroups(new HashSet<String>(user.getGroups()));\n+        if (user.getGroups() != null && user.getGroups().size() > 0) setGroups(new HashSet<String>(user.getGroups()));\n         if (user.getRequiredActions() != null) setRequiredActions(new HashSet<>(user.getRequiredActions()));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzM0MA==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r492727340", "bodyText": "This test seem to be failing. Needs to be passing with FF and Chrome.", "author": "vmuzikar", "createdAt": "2020-09-22T13:20:53Z", "path": "testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/GroupTest.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * JBoss, Home of Professional Open Source\n+ *\n+ * Copyright 2013 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.keycloak.testsuite.console.groups;\n+\n+import org.jboss.arquillian.graphene.page.Page;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.keycloak.representations.idm.GroupRepresentation;\n+import org.keycloak.testsuite.console.page.groups.CreateGroup;\n+\n+import static org.junit.Assert.*;\n+\n+/**\n+ *\n+ * @author clementcur\n+ */\n+public class GroupTest extends AbstractGroupTest {\n+\n+    @Page\n+    private CreateGroup createGroupPage;\n+\n+    @Before\n+    public void beforeCreateGroupTest() {\n+        groupsPage.navigateTo();\n+    }\n+\n+    @Test\n+    public void createAGroup() {", "originalCommit": "118f9a766c5e5ddf536043c7914c4aff5182e9fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg5NjUxNg==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r494896516", "bodyText": "fixed in latest commit", "author": "clementcur", "createdAt": "2020-09-25T10:27:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzM0MA=="}], "type": "inlineReview", "revised_code": {"commit": "2e1a6ed60663e60551d9a1f8a54c9ff463e1ad9f", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/GroupTest.java b/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/GroupTest.java\ndeleted file mode 100644\nindex cf0a45d72c..0000000000\n--- a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/groups/GroupTest.java\n+++ /dev/null\n\n@@ -1,48 +0,0 @@\n-/*\n- * JBoss, Home of Professional Open Source\n- *\n- * Copyright 2013 Red Hat, Inc. and/or its affiliates.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package org.keycloak.testsuite.console.groups;\n-\n-import org.jboss.arquillian.graphene.page.Page;\n-import org.junit.Before;\n-import org.junit.Test;\n-import org.keycloak.representations.idm.GroupRepresentation;\n-import org.keycloak.testsuite.console.page.groups.CreateGroup;\n-\n-import static org.junit.Assert.*;\n-\n-/**\n- *\n- * @author clementcur\n- */\n-public class GroupTest extends AbstractGroupTest {\n-\n-    @Page\n-    private CreateGroup createGroupPage;\n-\n-    @Before\n-    public void beforeCreateGroupTest() {\n-        groupsPage.navigateTo();\n-    }\n-\n-    @Test\n-    public void createAGroup() {\n-        newTestRealmGroup.setName(\"mygroup\");\n-        createGroup(newTestRealmGroup);\n-        assertAlertSuccess();\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzU5NA==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r492727594", "bodyText": "This test seem to be failing. Needs to be passing with FF and Chrome.", "author": "vmuzikar", "createdAt": "2020-09-22T13:21:14Z", "path": "testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java", "diffHunk": "@@ -99,4 +112,31 @@ public void disabledUser() {\n         // TODO try to log in\n     }\n \n+    @Test\n+    public void createUserWithGroups() {", "originalCommit": "118f9a766c5e5ddf536043c7914c4aff5182e9fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg5NjU5MA==", "url": "https://github.com/keycloak/keycloak/pull/7035#discussion_r494896590", "bodyText": "fixed in latest commit", "author": "clementcur", "createdAt": "2020-09-25T10:27:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzU5NA=="}], "type": "inlineReview", "revised_code": {"commit": "2e1a6ed60663e60551d9a1f8a54c9ff463e1ad9f", "chunk": "diff --git a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java b/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java\nindex 700ae64927..d228527e3f 100644\n--- a/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java\n+++ b/testsuite/integration-arquillian/tests/other/console/src/test/java/org/keycloak/testsuite/console/users/UserAttributesTest.java\n\n@@ -112,31 +99,4 @@ public class UserAttributesTest extends AbstractUserTest {\n         // TODO try to log in\n     }\n \n-    @Test\n-    public void createUserWithGroups() {\n-        GroupRepresentation newGroup = new GroupRepresentation();\n-        newGroup.setName(\"mygroup\");\n-\n-        // navigate to Groups creation page\n-        groupsPage.navigateTo();\n-        assertCurrentUrlEquals(groupsPage);\n-        groupsPage.table().addGroup();\n-        assertCurrentUrlStartsWith(createGroupPage);\n-\n-        // create the group\n-        createGroupPage.form().setValues(newGroup);\n-        createGroupPage.form().save();\n-        assertAlertSuccess();\n-\n-        // navigate to Users creation page\n-        usersPage.navigateTo();\n-        RealmRepresentation representation = testRealmResource().toRepresentation();\n-        representation.setRegistrationEmailAsUsername(true);\n-        testRealmResource().update(representation);\n-        newTestRealmUser.setEmail(\"test-with-groups@keycloak.org\");\n-        newTestRealmUser.setGroups(Arrays.asList(\"mygroup\"));\n-        createUser(newTestRealmUser);\n-        assertAlertSuccess();\n-    }\n-\n }\n"}}, {"oid": "22e3fe382312a755d8e75f5248dfb4a8014d0237", "url": "https://github.com/keycloak/keycloak/commit/22e3fe382312a755d8e75f5248dfb4a8014d0237", "message": "Fixed UI tests", "committedDate": "2020-10-28T16:52:31Z", "type": "forcePushed"}, {"oid": "2e1a6ed60663e60551d9a1f8a54c9ff463e1ad9f", "url": "https://github.com/keycloak/keycloak/commit/2e1a6ed60663e60551d9a1f8a54c9ff463e1ad9f", "message": "[KEYCLOAK-14046] Include groups in user creation via Admin Console\n\nSince the POST /users API now supports providing groups membership, here is the UI\npart!\n\n- Added a field in the user creation UI to specify groups the newly created user\nwill be joining\n- Added associated messages in english language", "committedDate": "2020-12-18T15:02:01Z", "type": "commit"}, {"oid": "e9135cb9956edf1de4249052526af601ac47bcff", "url": "https://github.com/keycloak/keycloak/commit/e9135cb9956edf1de4249052526af601ac47bcff", "message": "Added UI integration tests", "committedDate": "2020-12-18T15:02:02Z", "type": "commit"}, {"oid": "046321d980ae4009dfbd1612357236ae026de8bd", "url": "https://github.com/keycloak/keycloak/commit/046321d980ae4009dfbd1612357236ae026de8bd", "message": "Fixed UI tests", "committedDate": "2020-12-18T15:02:03Z", "type": "commit"}, {"oid": "f667c59306ed39cbf76b2fb994abe299a0626f1d", "url": "https://github.com/keycloak/keycloak/commit/f667c59306ed39cbf76b2fb994abe299a0626f1d", "message": "Flatten nested groups in user creation groups searchbox", "committedDate": "2020-12-18T15:02:03Z", "type": "commit"}, {"oid": "08e799aa127689329f43f5f689abc65077fedcc9", "url": "https://github.com/keycloak/keycloak/commit/08e799aa127689329f43f5f689abc65077fedcc9", "message": "Filtering out searched groups", "committedDate": "2020-12-18T15:02:03Z", "type": "commit"}, {"oid": "839a2b3bae3fd74dc887ba2e4705b053a612d5ba", "url": "https://github.com/keycloak/keycloak/commit/839a2b3bae3fd74dc887ba2e4705b053a612d5ba", "message": "Removed unused injection", "committedDate": "2020-12-18T15:02:03Z", "type": "commit"}, {"oid": "d0a93726882a35f76024dcdaeff9ef67f9081eff", "url": "https://github.com/keycloak/keycloak/commit/d0a93726882a35f76024dcdaeff9ef67f9081eff", "message": "Fixed UI tests", "committedDate": "2020-12-18T15:02:04Z", "type": "commit"}, {"oid": "d0a93726882a35f76024dcdaeff9ef67f9081eff", "url": "https://github.com/keycloak/keycloak/commit/d0a93726882a35f76024dcdaeff9ef67f9081eff", "message": "Fixed UI tests", "committedDate": "2020-12-18T15:02:04Z", "type": "forcePushed"}]}