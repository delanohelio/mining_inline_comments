{"pr_number": 4260, "pr_title": "WFCORE-5037 - Handle maps of complex objects in JMX Facade", "pr_createdAt": "2020-07-08T09:35:05Z", "pr_url": "https://github.com/wildfly/wildfly-core/pull/4260", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIzNzYyMA==", "url": "https://github.com/wildfly/wildfly-core/pull/4260#discussion_r457237620", "bodyText": "As we discussed during the meeting, I don't think that method belong to the AttributeDefinition API. You mentioned that we can achieve the same by doing an instanceof check for the ObjectMapAttributeDefinition in https://github.com/wildfly/wildfly-core/pull/4260/files#diff-738bea9b01b7d11ea0c7968b4390eeccR299.", "author": "jmesnil", "createdAt": "2020-07-20T09:54:49Z", "path": "controller/src/main/java/org/jboss/as/controller/AttributeDefinition.java", "diffHunk": "@@ -1295,6 +1295,14 @@ public ModelNode getUndefinedMetricValue() {\n         return undefinedMetricValue;\n     }\n \n+    /**\n+     * @deprecated internal use only\n+     */\n+    @Deprecated\n+    public boolean isNestedMap() {", "originalCommit": "c679d681161978a42ca43e57bfa2dd26e8b8fd41", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9221edcf49a493749f5ddb94b9b21f3ad83db63b", "chunk": "diff --git a/controller/src/main/java/org/jboss/as/controller/AttributeDefinition.java b/controller/src/main/java/org/jboss/as/controller/AttributeDefinition.java\nindex 900c645412..aad6a1f1b0 100644\n--- a/controller/src/main/java/org/jboss/as/controller/AttributeDefinition.java\n+++ b/controller/src/main/java/org/jboss/as/controller/AttributeDefinition.java\n\n@@ -1295,14 +1295,6 @@ public abstract class AttributeDefinition {\n         return undefinedMetricValue;\n     }\n \n-    /**\n-     * @deprecated internal use only\n-     */\n-    @Deprecated\n-    public boolean isNestedMap() {\n-        return false;\n-    }\n-\n     /**\n      * Simple {@code Comparable} that encapsulates the name of an attribute and any attribute group,\n      * ordering first one group (null group first) and then one attribute name.\n"}}, {"oid": "9221edcf49a493749f5ddb94b9b21f3ad83db63b", "url": "https://github.com/wildfly/wildfly-core/commit/9221edcf49a493749f5ddb94b9b21f3ad83db63b", "message": "[WFCORE-5037] Pass in the AttributeDefinition where possible to the JMX TypeConverters\n\nNote that for the main work we still use the descriptor. This fix is\nmainly to make it possible to check which kind of Object with complex\nvalues we have.\n\nObjectTypeAttributeDefinition and ObjectMapAttributeDefinition both\nreturn the same r-r-d output for attributes but are different. The first\none has defined key/value pairs where the keys are all known. e.g. the\nfollowing would be an allowed value:\n{\"my-attr\" => {\"one\" => 100L}}\n\nObjectMapAttributeDefinition on the other hand is a map of unknown keys\ncontaining those entries, e.g. the following would be an allowed value:\n{\"my-attr\" => {\"a\" => {\"one\" => 100L}}}\n\nIn both cases the r-r-d output for the attribute would look like:\n\n    \"description\" => \"description\",\n    \"attributes\" => {\"my-attr\" => {\n        \"type\" => OBJECT,\n        \"description\" => \"map-of-maps\",\n        \"expressions-allowed\" => false,\n        \"required\" => false,\n        \"nillable\" => true,\n        \"value-type\" => {\"one\" => {\n            \"type\" => LONG,\n            \"description\" => \"map-of-maps.one\",\n            \"expressions-allowed\" => false,\n            \"required\" => true,\n            \"nillable\" => false\n        }},\n        \"access-type\" => \"metric\",\n        \"storage\" => \"runtime\"\n    }},\n    ....\n\nSo there is no way for JMX yet to know which of the two cases we have.\nPassing in the AttributeDefinition is an attempt at figuring that out.", "committedDate": "2020-07-27T08:30:51Z", "type": "commit"}, {"oid": "710e9a9f72ef2ce950d03a32a9f6e7a7026e0958", "url": "https://github.com/wildfly/wildfly-core/commit/710e9a9f72ef2ce950d03a32a9f6e7a7026e0958", "message": "[WFCORE-5037] Tighten access a bit", "committedDate": "2020-07-27T08:33:48Z", "type": "commit"}, {"oid": "c615ce0002648399e711299c9aee406bd6ca3bce", "url": "https://github.com/wildfly/wildfly-core/commit/c615ce0002648399e711299c9aee406bd6ca3bce", "message": "[WFCORE-5037] Get JMX conversion working for maps of complex types", "committedDate": "2020-07-27T08:34:59Z", "type": "commit"}, {"oid": "c615ce0002648399e711299c9aee406bd6ca3bce", "url": "https://github.com/wildfly/wildfly-core/commit/c615ce0002648399e711299c9aee406bd6ca3bce", "message": "[WFCORE-5037] Get JMX conversion working for maps of complex types", "committedDate": "2020-07-27T08:34:59Z", "type": "forcePushed"}]}