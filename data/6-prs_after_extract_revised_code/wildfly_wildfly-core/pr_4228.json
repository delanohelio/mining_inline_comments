{"pr_number": 4228, "pr_title": "[WFCORE-4995] Bump management API version to 14.0.0", "pr_createdAt": "2020-06-09T08:44:34Z", "pr_url": "https://github.com/wildfly/wildfly-core/pull/4228", "timeline": [{"oid": "b7028b7175b122e1db497beccc6b34ac1c49915c", "url": "https://github.com/wildfly/wildfly-core/commit/b7028b7175b122e1db497beccc6b34ac1c49915c", "message": "[WFCORE-4995] Bump management API version to 14.0.0\n\nand `urn:jboss:domain:14.0` for the XSD\n\nJIRA: https://issues.redhat.com/browse/WFCORE-4995\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-06-09T08:58:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzNDkzOQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4228#discussion_r437334939", "bodyText": "writeAccessControl can also be removed since this file will be used for read only.\nhttps://github.com/wildfly/wildfly-core/pull/4228/files#diff-3a186e12b2e248de03d22e9991e1d13cR686", "author": "yersan", "createdAt": "2020-06-09T11:24:57Z", "path": "host-controller/src/main/java/org/jboss/as/host/controller/parsing/DomainXml_13.java", "diffHunk": "@@ -694,106 +602,6 @@ private void initializeRolloutPlans(ModelNode address, List<ModelNode> list) {\n         list.add(addOp);\n     }\n ", "originalCommit": "b7028b7175b122e1db497beccc6b34ac1c49915c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzOTYzNQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4228#discussion_r437339635", "bodyText": "I would also expect the following methods removed from this file:\nwriteNativeManagementProtocol https://github.com/wildfly/wildfly-core/pull/4228/files#diff-ae4aaafa96590692ce977218d56e3326R1448\nwriteHttpManagementProtocol https://github.com/wildfly/wildfly-core/pull/4228/files#diff-ae4aaafa96590692ce977218d56e3326R1467\nwriteAuditLog https://github.com/wildfly/wildfly-core/pull/4228/files#diff-ae4aaafa96590692ce977218d56e3326R1514", "author": "yersan", "createdAt": "2020-06-09T11:34:49Z", "path": "host-controller/src/main/java/org/jboss/as/host/controller/parsing/HostXml_13.java", "diffHunk": "@@ -1512,174 +1399,6 @@ private void parseSocketBindingGroup(final XMLExtendedStreamReader reader, final\n         }\n     }\n \n-    private void writeDomainController(final XMLExtendedStreamWriter writer, final ModelNode modelNode, ModelNode ignoredResources,\n-                                       ModelNode discoveryOptions) throws XMLStreamException {\n-        writer.writeStartElement(Element.DOMAIN_CONTROLLER.getLocalName());\n-        if (modelNode.hasDefined(LOCAL)) {\n-            if (discoveryOptions != null) {\n-                writer.writeStartElement(Element.LOCAL.getLocalName());\n-                writeDiscoveryOptions(writer, discoveryOptions);\n-                writer.writeEndElement();\n-            } else {\n-                writer.writeEmptyElement(Element.LOCAL.getLocalName());\n-            }\n-        } else if (modelNode.hasDefined(REMOTE)) {\n-            writer.writeStartElement(Element.REMOTE.getLocalName());\n-            final ModelNode remote = modelNode.get(REMOTE);\n-            RemoteDomainControllerAddHandler.PROTOCOL.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.HOST.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.PORT.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.AUTHENTICATION_CONTEXT.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.SECURITY_REALM.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.USERNAME.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.IGNORE_UNUSED_CONFIG.marshallAsAttribute(remote, writer);\n-            RemoteDomainControllerAddHandler.ADMIN_ONLY_POLICY.marshallAsAttribute(remote, writer);\n-\n-            if (ignoredResources != null) {\n-                writeIgnoredResources(writer, ignoredResources);\n-            }\n-            if (discoveryOptions != null) {\n-                writeDiscoveryOptions(writer, discoveryOptions);\n-            }\n-            writer.writeEndElement();\n-        }\n-        writer.writeEndElement();\n-    }\n-\n-    private void writeIgnoredResources(XMLExtendedStreamWriter writer, ModelNode ignoredTypes) throws XMLStreamException {\n-        for (String ignoredName : ignoredTypes.keys()) {\n-\n-            ModelNode ignored = ignoredTypes.get(ignoredName);\n-\n-            ModelNode names = ignored.hasDefined(NAMES) ? ignored.get(NAMES) : null;\n-            boolean hasNames = names != null && names.asInt() > 0;\n-            if (hasNames) {\n-                writer.writeStartElement(Element.IGNORED_RESOURCE.getLocalName());\n-            } else {\n-                writer.writeEmptyElement(Element.IGNORED_RESOURCE.getLocalName());\n-            }\n-\n-            writer.writeAttribute(Attribute.TYPE.getLocalName(), ignoredName);\n-            IgnoredDomainTypeResourceDefinition.WILDCARD.marshallAsAttribute(ignored, writer);\n-\n-            if (hasNames) {\n-                for (ModelNode name : names.asList()) {\n-                    writer.writeEmptyElement(Element.INSTANCE.getLocalName());\n-                    writer.writeAttribute(Attribute.NAME.getLocalName(), name.asString());\n-                }\n-                writer.writeEndElement();\n-            }\n-        }\n-    }\n-\n-    private void writeDiscoveryOptions(XMLExtendedStreamWriter writer, ModelNode discoveryOptions) throws XMLStreamException {\n-        writer.writeStartElement(Element.DISCOVERY_OPTIONS.getLocalName());\n-        for (Property property : discoveryOptions.asPropertyList()) {\n-            final String type = property.getName().equals(STATIC_DISCOVERY) ? STATIC_DISCOVERY : DISCOVERY_OPTION;\n-            final Element element = Element.forName(type);\n-            final String optionName = property.getValue().get(ModelDescriptionConstants.NAME).asString();\n-\n-            switch (element) {\n-                case STATIC_DISCOVERY: {\n-                    final ModelNode staticDiscoveryOption = property.getValue();\n-                    writer.writeStartElement(element.getLocalName());\n-                    WriteUtils.writeAttribute(writer, Attribute.NAME, optionName);\n-                    StaticDiscoveryResourceDefinition.PROTOCOL.marshallAsAttribute(staticDiscoveryOption, writer);\n-                    StaticDiscoveryResourceDefinition.HOST.marshallAsAttribute(staticDiscoveryOption, writer);\n-                    StaticDiscoveryResourceDefinition.PORT.marshallAsAttribute(staticDiscoveryOption, writer);\n-                    writer.writeEndElement();\n-                    break;\n-                }\n-                case DISCOVERY_OPTION: {\n-                    final ModelNode discoveryOption = property.getValue();\n-                    writer.writeStartElement(element.getLocalName());\n-                    WriteUtils.writeAttribute(writer, Attribute.NAME, optionName);\n-                    DiscoveryOptionResourceDefinition.CODE.marshallAsAttribute(discoveryOption, writer);\n-                    DiscoveryOptionResourceDefinition.MODULE.marshallAsAttribute(discoveryOption, writer);\n-                    if (discoveryOption.hasDefined(PROPERTIES)) {\n-                        writeDiscoveryOptionProperties(writer, discoveryOption.get(PROPERTIES));\n-                    }\n-                    writer.writeEndElement();\n-                    break;\n-                }\n-                default:\n-                    throw new RuntimeException(ControllerLogger.ROOT_LOGGER.unknownChildType(element.getLocalName()));\n-            }\n-        }\n-        writer.writeEndElement();\n-    }\n-\n-    private void writeDiscoveryOptionProperties(XMLExtendedStreamWriter writer, ModelNode discoveryOptionProperties) throws XMLStreamException {\n-        for (String property : discoveryOptionProperties.keys()) {\n-            writer.writeStartElement(Element.PROPERTY.getLocalName());\n-            WriteUtils.writeAttribute(writer, Attribute.NAME, property);\n-            WriteUtils.writeAttribute(writer, Attribute.VALUE, discoveryOptionProperties.get(property).asString());\n-            writer.writeEndElement();\n-        }\n-    }\n-\n-    private void writeServers(final XMLExtendedStreamWriter writer, final ModelNode modelNode) throws XMLStreamException {\n-\n-        for (String serverName : modelNode.keys()) {\n-            final ModelNode server = modelNode.get(serverName);\n-\n-            writer.writeStartElement(Element.SERVER.getLocalName());\n-\n-            WriteUtils.writeAttribute(writer, Attribute.NAME, serverName);\n-            ServerConfigResourceDefinition.GROUP.marshallAsAttribute(server, writer);\n-            ServerConfigResourceDefinition.AUTO_START.marshallAsAttribute(server, writer);\n-            ServerConfigResourceDefinition.UPDATE_AUTO_START_WITH_SERVER_STATUS.marshallAsAttribute(server, writer);\n-            if (server.hasDefined(PATH)) {\n-                writePaths(writer, server.get(PATH), false);\n-            }\n-            if (server.hasDefined(SYSTEM_PROPERTY)) {\n-                writeProperties(writer, server.get(SYSTEM_PROPERTY), Element.SYSTEM_PROPERTIES, false);\n-            }\n-            if (server.hasDefined(INTERFACE)) {\n-                writeInterfaces(writer, server.get(INTERFACE));\n-            }\n-            if (server.hasDefined(JVM)) {\n-                for (final Property jvm : server.get(JVM).asPropertyList()) {\n-                    JvmXml.writeJVMElement(writer, jvm.getName(), jvm.getValue());\n-                    break; // TODO just write the first !?\n-                }\n-            }\n-            if (server.hasDefined(SOCKET_BINDING_GROUP) || server.hasDefined(SOCKET_BINDING_PORT_OFFSET) || server.hasDefined(SOCKET_BINDING_DEFAULT_INTERFACE)) {\n-                writer.writeStartElement(Element.SOCKET_BINDINGS.getLocalName());\n-                ServerConfigResourceDefinition.SOCKET_BINDING_GROUP.marshallAsAttribute(server, writer);\n-                ServerConfigResourceDefinition.SOCKET_BINDING_PORT_OFFSET.marshallAsAttribute(server, writer);\n-                ServerConfigResourceDefinition.SOCKET_BINDING_DEFAULT_INTERFACE.marshallAsAttribute(server, writer);\n-                writer.writeEndElement();\n-            }\n-            if (server.hasDefined(SSL, LOOPBACK)) {\n-                ModelNode ssl = server.get(SSL, LOOPBACK);\n-                writer.writeStartElement(Element.SSL.getLocalName());\n-                SslLoopbackResourceDefinition.SSL_PROTOCOCOL.marshallAsAttribute(ssl, writer);\n-                SslLoopbackResourceDefinition.TRUST_MANAGER_ALGORITHM.marshallAsAttribute(ssl, writer);\n-                SslLoopbackResourceDefinition.TRUSTSTORE_TYPE.marshallAsAttribute(ssl, writer);\n-                SslLoopbackResourceDefinition.TRUSTSTORE_PATH.marshallAsAttribute(ssl, writer);\n-                SslLoopbackResourceDefinition.TRUSTSTORE_PASSWORD.marshallAsAttribute(ssl, writer);\n-                writer.writeEndElement();\n-            }\n-\n-            writer.writeEndElement();\n-        }\n-    }\n-\n-    private void writeHostProfile(final XMLExtendedStreamWriter writer, final ModelMarshallingContext context)\n-            throws XMLStreamException {\n-\n-        final ModelNode profileNode = context.getModelNode();\n-        // In case there are no subsystems defined\n-        if (!profileNode.hasDefined(SUBSYSTEM)) {\n-            return;\n-        }\n-\n-        writer.writeStartElement(Element.PROFILE.getLocalName());\n-        writeSubsystems(profileNode, writer, context);\n-        writer.writeEndElement();\n-    }\n-\n     /*", "originalCommit": "b7028b7175b122e1db497beccc6b34ac1c49915c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTUzMg==", "url": "https://github.com/wildfly/wildfly-core/pull/4228#discussion_r437455532", "bodyText": "fixed", "author": "jmesnil", "createdAt": "2020-06-09T14:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzOTYzNQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MjMzMQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4228#discussion_r437342331", "bodyText": "There are still write methods in this file, however it is supposed to be a read-only parser, see all the write* method names.", "author": "yersan", "createdAt": "2020-06-09T11:39:52Z", "path": "server/src/main/java/org/jboss/as/server/parsing/StandaloneXml_13.java", "diffHunk": "@@ -717,120 +701,6 @@ private void setServerName(final ModelNode address, final List<ModelNode> operat\n         }\n     }\n \n-    void writeContent(final XMLExtendedStreamWriter writer, final ModelMarshallingContext context)", "originalCommit": "b7028b7175b122e1db497beccc6b34ac1c49915c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTYyNw==", "url": "https://github.com/wildfly/wildfly-core/pull/4228#discussion_r437455627", "bodyText": "fixed", "author": "jmesnil", "createdAt": "2020-06-09T14:13:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MjMzMQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "30534462ba061eb07e5857d31c26ac30968418de", "url": "https://github.com/wildfly/wildfly-core/commit/30534462ba061eb07e5857d31c26ac30968418de", "message": "[WFCORE-4995] Bump management API version to 14.0.0\n\nand `urn:jboss:domain:14.0` for the XSD\n\nJIRA: https://issues.redhat.com/browse/WFCORE-4995\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-06-09T14:11:36Z", "type": "commit"}, {"oid": "30534462ba061eb07e5857d31c26ac30968418de", "url": "https://github.com/wildfly/wildfly-core/commit/30534462ba061eb07e5857d31c26ac30968418de", "message": "[WFCORE-4995] Bump management API version to 14.0.0\n\nand `urn:jboss:domain:14.0` for the XSD\n\nJIRA: https://issues.redhat.com/browse/WFCORE-4995\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-06-09T14:11:36Z", "type": "forcePushed"}]}