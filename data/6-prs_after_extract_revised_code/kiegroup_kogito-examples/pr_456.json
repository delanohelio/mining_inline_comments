{"pr_number": 456, "pr_title": "PLANNER-2145: Remove workaround in flight example solver manager", "pr_createdAt": "2020-11-13T16:27:59Z", "pr_url": "https://github.com/kiegroup/kogito-examples/pull/456", "timeline": [{"oid": "ae1c8acf9cbc51d6251c91ca56999334ba18b7a5", "url": "https://github.com/kiegroup/kogito-examples/commit/ae1c8acf9cbc51d6251c91ca56999334ba18b7a5", "message": "PLANNER-2145: Remove workaround in flight example solver manager\n\nAlso fixed errors that were introduced from changes to the tasks\napi.", "committedDate": "2020-11-13T16:27:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYwNDk3MQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/456#discussion_r529604971", "bodyText": "If an error occurs, does the user somehow get told in the UI that it did? (and kind of of error it was?)\nOr does the error get swept under the carpet?", "author": "ge0ffrey", "createdAt": "2020-11-24T14:52:50Z", "path": "process-optaplanner-quarkus/src/main/java/org/kie/kogito/examples/service/FlightSeatingSolveService.java", "diffHunk": "@@ -39,23 +36,17 @@\n     Process<?> process;\n \n     public void assignSeats(String id, Flight problem) {\n-        SolverJob<Flight, String> solverJob = solverManager.solveAndListen(id, (problemId) -> problem, (bestSolution) -> {\n-            process.instances().findById(id).ifPresent(pi -> {\n-                pi.send(Sig.of(\"newSolution\", bestSolution));\n-            });\n-        });\n-\n-        // TODO: Workaround for https://issues.redhat.com/browse/PLANNER-1868\n-        // Wait for solving to finish in new thread (so we don't block the return)\n-        new Thread(() -> {\n-            try {\n-                Flight finalBestSolution = solverJob.getFinalBestSolution();\n-                process.instances().findById(id).ifPresent(pi -> {\n-                    pi.send(Sig.of(\"solvingTerminated\", finalBestSolution));\n-                });\n-            } catch (InterruptedException | ExecutionException e) {\n-                e.printStackTrace();\n-            }\n-        }).start();\n+        solverManager.solveAndListen(id, (problemId) -> problem, bestSolution -> {\n+                                         process.instances().findById(id).ifPresent(pi -> {\n+                                             pi.send(Sig.of(\"newSolution\", bestSolution));\n+                                         });\n+                                     }, finalBestSolution -> {\n+                                         process.instances().findById(id).ifPresent(pi -> {\n+                                             pi.send(Sig.of(\"solvingTerminated\", finalBestSolution));\n+                                         });\n+                                     },\n+                                     (message, exception) -> {\n+                                         process.instances().findById(id).ifPresent(ProcessInstance::abort);", "originalCommit": "ae1c8acf9cbc51d6251c91ca56999334ba18b7a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYxMTUzNA==", "url": "https://github.com/kiegroup/kogito-examples/pull/456#discussion_r529611534", "bodyText": "In this case, we would need to save the exception somewhere as this exception will happen AFTER the REST call returns (so even if we did throw it, the REST call have no way of knowing). The flight will disappear from the UI. So we would need to poll a new REST endpoint for errors.", "author": "Christopher-Chianelli", "createdAt": "2020-11-24T15:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYwNDk3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYxMzYyMw==", "url": "https://github.com/kiegroup/kogito-examples/pull/456#discussion_r529613623", "bodyText": "(for errors thrown during REST call invocation, those are shown in the UI already; for an error that occurs in this place, no exception is shown in the UI as it isn't thrown + it requires a new REST endpoint to work (or does Kogito generate an process aborted REST endpoint?)", "author": "Christopher-Chianelli", "createdAt": "2020-11-24T15:03:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYwNDk3MQ=="}], "type": "inlineReview", "revised_code": null}]}