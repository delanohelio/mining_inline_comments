{"pr_number": 818, "pr_title": "feat(ChangeLogs): Revision history of Document", "pr_createdAt": "2020-04-01T10:28:59Z", "pr_url": "https://github.com/eclipse/sw360/pull/818", "timeline": [{"oid": "ee0e134ca6f0d0620db6742a9d75b7ee52b2efa7", "url": "https://github.com/eclipse/sw360/commit/ee0e134ca6f0d0620db6742a9d75b7ee52b2efa7", "message": "feat(ChangeLogs): Revision history of Document\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-04-07T06:12:20Z", "type": "forcePushed"}, {"oid": "83f8454939dbcc9978a6c12b5afad475c5e658c2", "url": "https://github.com/eclipse/sw360/commit/83f8454939dbcc9978a6c12b5afad475c5e658c2", "message": "feat(ChangeLogs): Revision history of Document\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-04-14T07:28:18Z", "type": "forcePushed"}, {"oid": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "url": "https://github.com/eclipse/sw360/commit/2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "message": "feat(ChangeLogs): Revision history of Document\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-04-23T10:18:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc0Mjg0NQ==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r416742845", "bodyText": "unused import", "author": "smrutis1", "createdAt": "2020-04-28T16:13:15Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright Siemens AG, 2017. Part of the SW360 Portal Project.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.sw360.datahandler.db;\n+\n+import static org.eclipse.sw360.datahandler.common.SW360Assert.assertNotNull;\n+\n+import java.net.MalformedURLException;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.function.Supplier;\n+\n+import org.apache.log4j.Logger;\n+import org.apache.thrift.TException;", "originalCommit": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "93a43f98c8826b50e0b1e458721022d2df14e55d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\nindex 81e421ed..195f5d95 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\n\n@@ -18,7 +18,6 @@ import java.util.List;\n import java.util.function.Supplier;\n \n import org.apache.log4j.Logger;\n-import org.apache.thrift.TException;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n import org.eclipse.sw360.datahandler.thrift.SW360Exception;\n import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgwNTkzNQ==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r416805935", "bodyText": "May be, this can be improved a bit.\nCollections.sort(changeLogsByDocId, Comparator.comparing(ChangeLogs::getChangeTimestamp).reversed());\nchangeLogsByDocId = changeLogsByDocId.stream().map(cl -> cl.setChangeTimestamp(cl.getChangeTimestamp().split(\" \")[0])).collect(Collectors.toList());", "author": "smrutis1", "createdAt": "2020-04-28T17:46:41Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright Siemens AG, 2017. Part of the SW360 Portal Project.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.sw360.datahandler.db;\n+\n+import static org.eclipse.sw360.datahandler.common.SW360Assert.assertNotNull;\n+\n+import java.net.MalformedURLException;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.function.Supplier;\n+\n+import org.apache.log4j.Logger;\n+import org.apache.thrift.TException;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n+import org.eclipse.sw360.datahandler.thrift.SW360Exception;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n+import org.eclipse.sw360.datahandler.thrift.users.User;\n+import org.ektorp.http.HttpClient;\n+\n+/**\n+ * Class for accessing the CouchDB database for Change logs objects\n+ *\n+ * @author: jaideep.palit@siemens.com\n+ */\n+public class ChangeLogsDatabaseHandler {\n+    private final DatabaseConnector db;\n+    private final ChangeLogsRepository changeLogsRepository;\n+\n+    private static final Logger log = Logger.getLogger(ChangeLogsDatabaseHandler.class);\n+\n+    public ChangeLogsDatabaseHandler(Supplier<HttpClient> httpClient, String dbName) throws MalformedURLException {\n+        db = new DatabaseConnector(httpClient, dbName);\n+        changeLogsRepository = new ChangeLogsRepository(db);\n+    }\n+\n+    public List<ChangeLogs> getChangeLogsByDocumentId(User user, String docId) {\n+        List<ChangeLogs> changeLogsByDocId = changeLogsRepository.getChangeLogsByDocId(docId);\n+        changeLogsByDocId.addAll(changeLogsRepository.getChangeLogsByParentDocId(docId));\n+\n+        Comparator<ChangeLogs> comparatorByTimeStamp = (cl1, cl2) -> cl2.getChangeTimestamp()", "originalCommit": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "93a43f98c8826b50e0b1e458721022d2df14e55d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\nindex 81e421ed..195f5d95 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\n\n@@ -18,7 +18,6 @@ import java.util.List;\n import java.util.function.Supplier;\n \n import org.apache.log4j.Logger;\n-import org.apache.thrift.TException;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n import org.eclipse.sw360.datahandler.thrift.SW360Exception;\n import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgwODI3NQ==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r416808275", "bodyText": "Kindly add brief comment at method level mentioning the changes, please try to move this method to database handlers or DatabseHandlerUtil.", "author": "smrutis1", "createdAt": "2020-04-28T17:50:33Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright Siemens AG, 2017. Part of the SW360 Portal Project.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.sw360.datahandler.db;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.apache.thrift.TBase;\n+import org.eclipse.sw360.datahandler.common.DatabaseSettings;\n+import org.eclipse.sw360.datahandler.couchdb.AttachmentConnector;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseRepository;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.Operation;\n+import org.ektorp.support.View;\n+\n+/**\n+ * CRUD access for the ChangeLogs class\n+ *\n+ * @author jaideep.palit@siemens.com\n+ */\n+@View(name = \"all\", map = \"function(doc) { if (doc.type == 'changeLogs') emit(doc._id, doc) }\")\n+public class ChangeLogsRepository extends DatabaseRepository<ChangeLogs> {\n+\n+    private static final String BY_DOCUMENT_ID =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.documentId, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_PARENT_DOCUMENT_ID =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.parentDocId, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_USER_EDITED =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.userEdited, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_TIMESTAMP =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.changeTimestamp, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+\n+    public ChangeLogsRepository(DatabaseConnector db) {\n+        super(ChangeLogs.class, db);\n+        initStandardDesignDocument();\n+    }\n+\n+    @View(name = \"byDocumentId\", map = BY_DOCUMENT_ID)\n+    public List<ChangeLogs> getChangeLogsByDocId(String docId) {\n+        return queryView(\"byDocumentId\", docId).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byParentDocumentId\", map = BY_PARENT_DOCUMENT_ID)\n+    public List<ChangeLogs> getChangeLogsByParentDocId(String docId) {\n+        return queryView(\"byParentDocumentId\", docId).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byUserEdited\", map = BY_USER_EDITED)\n+    public List<ChangeLogs> getChangeLogsByUserEdited(String userEdited) {\n+        return queryView(\"byUserEdited\", userEdited).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byTimestamp\", map = BY_TIMESTAMP)\n+    public List<ChangeLogs> getChangeLogsByTimestamp(String timestamp) {\n+        return queryView(\"byTimestamp\", timestamp).stream().collect(Collectors.toList());\n+    }\n+\n+    public <T extends TBase> void addChangeLogs(T newDocVersion, T oldDocVersion, String userEdited,", "originalCommit": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "93a43f98c8826b50e0b1e458721022d2df14e55d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\nindex 6ce72736..b61d9bb0 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\n\n@@ -12,13 +12,9 @@ package org.eclipse.sw360.datahandler.db;\n import java.util.List;\n import java.util.stream.Collectors;\n \n-import org.apache.thrift.TBase;\n-import org.eclipse.sw360.datahandler.common.DatabaseSettings;\n-import org.eclipse.sw360.datahandler.couchdb.AttachmentConnector;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseRepository;\n import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n-import org.eclipse.sw360.datahandler.thrift.changelogs.Operation;\n import org.ektorp.support.View;\n \n /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA0OTgyNg==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r417049826", "bodyText": "Please consider extracting it into a method.", "author": "smrutis1", "createdAt": "2020-04-29T03:40:22Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright Siemens AG, 2017. Part of the SW360 Portal Project.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.sw360.datahandler.db;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.apache.thrift.TBase;\n+import org.eclipse.sw360.datahandler.common.DatabaseSettings;\n+import org.eclipse.sw360.datahandler.couchdb.AttachmentConnector;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseRepository;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.Operation;\n+import org.ektorp.support.View;\n+\n+/**\n+ * CRUD access for the ChangeLogs class\n+ *\n+ * @author jaideep.palit@siemens.com\n+ */\n+@View(name = \"all\", map = \"function(doc) { if (doc.type == 'changeLogs') emit(doc._id, doc) }\")\n+public class ChangeLogsRepository extends DatabaseRepository<ChangeLogs> {\n+\n+    private static final String BY_DOCUMENT_ID =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.documentId, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_PARENT_DOCUMENT_ID =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.parentDocId, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_USER_EDITED =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.userEdited, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_TIMESTAMP =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.changeTimestamp, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+\n+    public ChangeLogsRepository(DatabaseConnector db) {\n+        super(ChangeLogs.class, db);\n+        initStandardDesignDocument();\n+    }\n+\n+    @View(name = \"byDocumentId\", map = BY_DOCUMENT_ID)\n+    public List<ChangeLogs> getChangeLogsByDocId(String docId) {\n+        return queryView(\"byDocumentId\", docId).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byParentDocumentId\", map = BY_PARENT_DOCUMENT_ID)\n+    public List<ChangeLogs> getChangeLogsByParentDocId(String docId) {\n+        return queryView(\"byParentDocumentId\", docId).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byUserEdited\", map = BY_USER_EDITED)\n+    public List<ChangeLogs> getChangeLogsByUserEdited(String userEdited) {\n+        return queryView(\"byUserEdited\", userEdited).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byTimestamp\", map = BY_TIMESTAMP)\n+    public List<ChangeLogs> getChangeLogsByTimestamp(String timestamp) {\n+        return queryView(\"byTimestamp\", timestamp).stream().collect(Collectors.toList());\n+    }\n+\n+    public <T extends TBase> void addChangeLogs(T newDocVersion, T oldDocVersion, String userEdited,\n+            Operation operation, AttachmentConnector attachmentConnector, List<ChangeLogs> referenceDocLogList,\n+            String parentDocId, Operation parentOperation) {\n+        if (DatabaseSettings.COUCH_DB_DATABASE.contains(\"test\")\n+                || DatabaseSettings.COUCH_DB_ATTACHMENTS.contains(\"test\")) {\n+            return;\n+        }\n+\n+        Runnable changeLogRunnable = () -> {\n+            try {", "originalCommit": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "93a43f98c8826b50e0b1e458721022d2df14e55d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\nindex 6ce72736..b61d9bb0 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\n\n@@ -12,13 +12,9 @@ package org.eclipse.sw360.datahandler.db;\n import java.util.List;\n import java.util.stream.Collectors;\n \n-import org.apache.thrift.TBase;\n-import org.eclipse.sw360.datahandler.common.DatabaseSettings;\n-import org.eclipse.sw360.datahandler.couchdb.AttachmentConnector;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseRepository;\n import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n-import org.eclipse.sw360.datahandler.thrift.changelogs.Operation;\n import org.ektorp.support.View;\n \n /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA1MDE1OQ==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r417050159", "bodyText": "May be this can be written as.\nCollections.sort(changeLogsByDocId, Comparator.comparing(ChangeLogs::getChangeTimestamp()).reversed());\nchangeLogsByDocId = changeLogsByDocId.stream().map(cl -> cl.setChangeTimestamp(cl.getChangeTimestamp().split(\" \")[0])).collect(Collectors.toList());", "author": "smrutis1", "createdAt": "2020-04-29T03:41:51Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright Siemens AG, 2017. Part of the SW360 Portal Project.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.sw360.datahandler.db;\n+\n+import static org.eclipse.sw360.datahandler.common.SW360Assert.assertNotNull;\n+\n+import java.net.MalformedURLException;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.function.Supplier;\n+\n+import org.apache.log4j.Logger;\n+import org.apache.thrift.TException;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n+import org.eclipse.sw360.datahandler.thrift.SW360Exception;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n+import org.eclipse.sw360.datahandler.thrift.users.User;\n+import org.ektorp.http.HttpClient;\n+\n+/**\n+ * Class for accessing the CouchDB database for Change logs objects\n+ *\n+ * @author: jaideep.palit@siemens.com\n+ */\n+public class ChangeLogsDatabaseHandler {\n+    private final DatabaseConnector db;\n+    private final ChangeLogsRepository changeLogsRepository;\n+\n+    private static final Logger log = Logger.getLogger(ChangeLogsDatabaseHandler.class);\n+\n+    public ChangeLogsDatabaseHandler(Supplier<HttpClient> httpClient, String dbName) throws MalformedURLException {\n+        db = new DatabaseConnector(httpClient, dbName);\n+        changeLogsRepository = new ChangeLogsRepository(db);\n+    }\n+\n+    public List<ChangeLogs> getChangeLogsByDocumentId(User user, String docId) {\n+        List<ChangeLogs> changeLogsByDocId = changeLogsRepository.getChangeLogsByDocId(docId);\n+        changeLogsByDocId.addAll(changeLogsRepository.getChangeLogsByParentDocId(docId));\n+\n+        Comparator<ChangeLogs> comparatorByTimeStamp = (cl1, cl2) -> cl2.getChangeTimestamp()", "originalCommit": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIyOTYwNg==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r417229606", "bodyText": "Used Comparator.comparing as suggested\nTo trim timestamp , using foreach instead of map->collect since it can be done in single operation.", "author": "JaideepPalit", "createdAt": "2020-04-29T10:57:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA1MDE1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "93a43f98c8826b50e0b1e458721022d2df14e55d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\nindex 81e421ed..195f5d95 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsDatabaseHandler.java\n\n@@ -18,7 +18,6 @@ import java.util.List;\n import java.util.function.Supplier;\n \n import org.apache.log4j.Logger;\n-import org.apache.thrift.TException;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n import org.eclipse.sw360.datahandler.thrift.SW360Exception;\n import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA1MDgzOA==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r417050838", "bodyText": "Kindly consider adding some method level comments. And if it can be moved to database handlers or DatabaseHandlerUtil instead of repository.", "author": "smrutis1", "createdAt": "2020-04-29T03:45:29Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright Siemens AG, 2017. Part of the SW360 Portal Project.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.sw360.datahandler.db;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.apache.thrift.TBase;\n+import org.eclipse.sw360.datahandler.common.DatabaseSettings;\n+import org.eclipse.sw360.datahandler.couchdb.AttachmentConnector;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n+import org.eclipse.sw360.datahandler.couchdb.DatabaseRepository;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n+import org.eclipse.sw360.datahandler.thrift.changelogs.Operation;\n+import org.ektorp.support.View;\n+\n+/**\n+ * CRUD access for the ChangeLogs class\n+ *\n+ * @author jaideep.palit@siemens.com\n+ */\n+@View(name = \"all\", map = \"function(doc) { if (doc.type == 'changeLogs') emit(doc._id, doc) }\")\n+public class ChangeLogsRepository extends DatabaseRepository<ChangeLogs> {\n+\n+    private static final String BY_DOCUMENT_ID =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.documentId, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_PARENT_DOCUMENT_ID =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.parentDocId, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_USER_EDITED =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.userEdited, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+    private static final String BY_TIMESTAMP =\n+            \"function(doc) {\" +\n+                    \"  if (doc.type == 'changeLogs') {\" +\n+                    \"    emit(doc.changeTimestamp, doc);\" +\n+                    \"  }\" +\n+                    \"}\";\n+\n+    public ChangeLogsRepository(DatabaseConnector db) {\n+        super(ChangeLogs.class, db);\n+        initStandardDesignDocument();\n+    }\n+\n+    @View(name = \"byDocumentId\", map = BY_DOCUMENT_ID)\n+    public List<ChangeLogs> getChangeLogsByDocId(String docId) {\n+        return queryView(\"byDocumentId\", docId).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byParentDocumentId\", map = BY_PARENT_DOCUMENT_ID)\n+    public List<ChangeLogs> getChangeLogsByParentDocId(String docId) {\n+        return queryView(\"byParentDocumentId\", docId).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byUserEdited\", map = BY_USER_EDITED)\n+    public List<ChangeLogs> getChangeLogsByUserEdited(String userEdited) {\n+        return queryView(\"byUserEdited\", userEdited).stream().collect(Collectors.toList());\n+    }\n+\n+    @View(name = \"byTimestamp\", map = BY_TIMESTAMP)\n+    public List<ChangeLogs> getChangeLogsByTimestamp(String timestamp) {\n+        return queryView(\"byTimestamp\", timestamp).stream().collect(Collectors.toList());\n+    }\n+\n+    public <T extends TBase> void addChangeLogs(T newDocVersion, T oldDocVersion, String userEdited,", "originalCommit": "2266c7ac694f2b9dc3489d3689e1a4a20f6fa31e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIyNzY2Nw==", "url": "https://github.com/eclipse/sw360/pull/818#discussion_r417227667", "bodyText": "Change done", "author": "JaideepPalit", "createdAt": "2020-04-29T10:53:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA1MDgzOA=="}], "type": "inlineReview", "revised_code": {"commit": "93a43f98c8826b50e0b1e458721022d2df14e55d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\nindex 6ce72736..b61d9bb0 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ChangeLogsRepository.java\n\n@@ -12,13 +12,9 @@ package org.eclipse.sw360.datahandler.db;\n import java.util.List;\n import java.util.stream.Collectors;\n \n-import org.apache.thrift.TBase;\n-import org.eclipse.sw360.datahandler.common.DatabaseSettings;\n-import org.eclipse.sw360.datahandler.couchdb.AttachmentConnector;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseConnector;\n import org.eclipse.sw360.datahandler.couchdb.DatabaseRepository;\n import org.eclipse.sw360.datahandler.thrift.changelogs.ChangeLogs;\n-import org.eclipse.sw360.datahandler.thrift.changelogs.Operation;\n import org.ektorp.support.View;\n \n /**\n"}}, {"oid": "93a43f98c8826b50e0b1e458721022d2df14e55d", "url": "https://github.com/eclipse/sw360/commit/93a43f98c8826b50e0b1e458721022d2df14e55d", "message": "feat(ChangeLogs): Revision history of Document\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-04-29T10:50:24Z", "type": "forcePushed"}, {"oid": "04b57fd1951df5f1d41ceb42a341e8e166c812a7", "url": "https://github.com/eclipse/sw360/commit/04b57fd1951df5f1d41ceb42a341e8e166c812a7", "message": "feat(ChangeLogs): Revision history of Document\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-06T12:12:55Z", "type": "commit"}, {"oid": "04b57fd1951df5f1d41ceb42a341e8e166c812a7", "url": "https://github.com/eclipse/sw360/commit/04b57fd1951df5f1d41ceb42a341e8e166c812a7", "message": "feat(ChangeLogs): Revision history of Document\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-06T12:12:55Z", "type": "forcePushed"}]}