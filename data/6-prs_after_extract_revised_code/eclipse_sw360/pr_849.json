{"pr_number": 849, "pr_title": "fix(mergeComponent): Prevent multiple releases with same name and version for a component, which may occur during merge component.", "pr_createdAt": "2020-05-12T05:01:34Z", "pr_url": "https://github.com/eclipse/sw360/pull/849", "timeline": [{"oid": "79f5c9d4d67396f35c597f0908c6885362e24a07", "url": "https://github.com/eclipse/sw360/commit/79f5c9d4d67396f35c597f0908c6885362e24a07", "message": "fix(mergeComponent): Prevent multiple releases with same name and version for a component, which may occur during merge component.\n\n  * Provided suffix[_conflict (id)] for releases of src component with same version as of target component's releases\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-11T13:34:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc3OTU2Mw==", "url": "https://github.com/eclipse/sw360/pull/849#discussion_r427779563", "bodyText": "If possible, consider using StringBuilder for concatenation.", "author": "akapti", "createdAt": "2020-05-20T06:53:14Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -804,14 +806,24 @@ private void transferReleases(Set<String> releaseIds, Component mergeTarget, Com\n         releaseIds.forEach(mergeTarget::addToReleaseIds);\n     }\n \n-    private void updateReleasesAfterMerge(Set<String> releaseIds, Component mergeSelection, Component mergeTarget, User sessionUser) throws SW360Exception {\n+    private void updateReleasesAfterMerge(Set<String> targetComponentReleaseIds, Set<String> srcComponentReleaseIds,\n+            Component mergeSelection, Component mergeTarget, User sessionUser) throws SW360Exception {\n         // Change release name if appropriate\n-        List<Release> releases = getReleasesForClearingStateSummary(releaseIds);\n+        List<Release> targetComponentReleases = getReleasesForClearingStateSummary(targetComponentReleaseIds);\n+        List<Release> srcComponentReleases = getReleasesForClearingStateSummary(srcComponentReleaseIds);\n+        Set<String> targetComponentReleaseVersions = targetComponentReleases.stream().map(Release::getVersion)\n+                .collect(Collectors.toSet());\n+        Set<Release> releases = Stream.concat(targetComponentReleases.stream(), srcComponentReleases.stream())\n+                .collect(Collectors.toSet());\n+\n         List<Release> releasesToUpdate = releases.stream()\n             .filter( r -> {\n                 return !(r.getComponentId().equals(mergeTarget.getId()) && r.getName().equals(mergeSelection.getName()));\n             }).map(r -> {\n                 Release releaseBefore = r.deepCopy();\n+                if (srcComponentReleases.contains(r) && targetComponentReleaseVersions.contains(r.getVersion())) {\n+                        r.setVersion(r.getVersion() + \"_conflict (\" + r.getId() + \")\");", "originalCommit": "79f5c9d4d67396f35c597f0908c6885362e24a07", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}