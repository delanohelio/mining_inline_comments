{"pr_number": 1045, "pr_title": "feat(projectEdit): Project creators and moderators can edit few fields in a closed project", "pr_createdAt": "2020-11-17T08:24:06Z", "pr_url": "https://github.com/eclipse/sw360/pull/1045", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAzMjE1NA==", "url": "https://github.com/eclipse/sw360/pull/1045#discussion_r526032154", "bodyText": "Can we re-use this method by moving to some commonly accessible class?", "author": "akapti", "createdAt": "2020-11-18T11:59:30Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -616,12 +616,19 @@ private boolean duplicateAttachmentExist(Project project) {\n \n     private boolean updateProjectAllowed(Project project, User user) {\n         if (project.clearingState != null && project.clearingState.equals(ProjectClearingState.CLOSED)\n-                && !PermissionUtils.isUserAtLeast(UserGroup.SW360_ADMIN, user)) {\n+                && !PermissionUtils.isUserAtLeast(UserGroup.SW360_ADMIN, user) && !isModeratorOrCreator(project, user)) {\n             return false;\n         }\n         return true;\n     }\n \n+    private boolean isModeratorOrCreator(Project project, User user) {", "originalCommit": "3d6a9298bcf4f8eb3db793816e8945620b16e767", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY3ODYzMg==", "url": "https://github.com/eclipse/sw360/pull/1045#discussion_r526678632", "bodyText": "Moved it to SW360Utils", "author": "smrutis1", "createdAt": "2020-11-19T08:34:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAzMjE1NA=="}], "type": "inlineReview", "revised_code": {"commit": "178f98066c2d6eb01b06674be00e0f974cdebb47", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\nindex 18127d18..28bfd79e 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\n\n@@ -616,19 +616,12 @@ public class ProjectDatabaseHandler extends AttachmentAwareDatabaseHandler {\n \n     private boolean updateProjectAllowed(Project project, User user) {\n         if (project.clearingState != null && project.clearingState.equals(ProjectClearingState.CLOSED)\n-                && !PermissionUtils.isUserAtLeast(UserGroup.SW360_ADMIN, user) && !isModeratorOrCreator(project, user)) {\n+                && !PermissionUtils.isUserAtLeast(UserGroup.SW360_ADMIN, user) && !SW360Utils.isModeratorOrCreatorOrSecurityResponsible(project, user)) {\n             return false;\n         }\n         return true;\n     }\n \n-    private boolean isModeratorOrCreator(Project project, User user) {\n-        Set<String> moderators = project.getModerators();\n-        String creator = project.getCreatedBy();\n-        moderators.add(creator);\n-        return moderators.contains(user.getEmail());\n-    }\n-\n     private ObligationList deleteObligationsOfUnlinkedReleases(Project updated) {\n         ObligationList obligation = obligationRepository.get(updated.getLinkedObligationId());\n         Set<String> updatedLinkedReleaseIds = nullToEmptyMap(updated.getReleaseIdToUsage()).keySet();\n"}}, {"oid": "178f98066c2d6eb01b06674be00e0f974cdebb47", "url": "https://github.com/eclipse/sw360/commit/178f98066c2d6eb01b06674be00e0f974cdebb47", "message": "feat(projectEdit): Project creators, moderators and security responsibles can edit few fields in a closed project\n\nSigned-off-by: Smruti Prakash Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-11-19T08:07:31Z", "type": "forcePushed"}, {"oid": "a6cf31a312fd0e8a2368dd870ec09dbba900ad65", "url": "https://github.com/eclipse/sw360/commit/a6cf31a312fd0e8a2368dd870ec09dbba900ad65", "message": "feat(projectEdit): Project creators and moderators can edit few fields in a closed project\n\nSigned-off-by: Smruti Prakash Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-11-19T08:33:09Z", "type": "commit"}, {"oid": "a6cf31a312fd0e8a2368dd870ec09dbba900ad65", "url": "https://github.com/eclipse/sw360/commit/a6cf31a312fd0e8a2368dd870ec09dbba900ad65", "message": "feat(projectEdit): Project creators and moderators can edit few fields in a closed project\n\nSigned-off-by: Smruti Prakash Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-11-19T08:33:09Z", "type": "forcePushed"}]}