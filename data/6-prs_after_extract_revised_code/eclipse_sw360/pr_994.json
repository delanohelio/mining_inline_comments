{"pr_number": 994, "pr_title": "fix(UserSearch): Fixed search user functionality", "pr_createdAt": "2020-09-23T11:26:58Z", "pr_url": "https://github.com/eclipse/sw360/pull/994", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0NDEwMg==", "url": "https://github.com/eclipse/sw360/pull/994#discussion_r494744102", "bodyText": "I believe stale parameter is used in line no. 168 as well for every database, in case it failing without it. May be no need to specifically handle it only for User DB. here?", "author": "smrutis1", "createdAt": "2020-09-25T04:43:59Z", "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java", "diffHunk": "@@ -149,18 +149,33 @@ private LuceneResult callLuceneDirectly(LuceneSearchView function, String queryS\n         if (resultLimit > 0) {\n             queryURI.param(\"limit\", resultLimit);\n         }\n+        if (dbNameForLuceneSearch.equals(DatabaseSettings.COUCH_DB_USERS)) {", "originalCommit": "93a053810cb6a969854e74a9d8956b542bf77486", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3Mzc1MQ==", "url": "https://github.com/eclipse/sw360/pull/994#discussion_r494773751", "bodyText": "Changes done.", "author": "JaideepPalit", "createdAt": "2020-09-25T06:28:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0NDEwMg=="}], "type": "inlineReview", "revised_code": {"commit": "2f9a6879031341707cb8d578125e97798e47bbd6", "chunk": "diff --git a/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java b/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java\nindex 34fa3743..1e7afaae 100644\n--- a/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java\n+++ b/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java\n\n@@ -149,9 +149,6 @@ public class LuceneAwareDatabaseConnector extends LuceneAwareCouchDbConnector {\n         if (resultLimit > 0) {\n             queryURI.param(\"limit\", resultLimit);\n         }\n-        if (dbNameForLuceneSearch.equals(DatabaseSettings.COUCH_DB_USERS)) {\n-            queryURI.param(\"stale\", \"ok\");\n-        }\n         queryURI.param(\"q\", queryString.toString());\n         URL luceneResourceUrl = new URL(DatabaseSettings.COUCH_DB_LUCENE_URL + queryURI.toString());\n         ObjectMapper objectMapper = new EktorpLuceneObjectMapperFactory().createObjectMapper();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0NTIzNg==", "url": "https://github.com/eclipse/sw360/pull/994#discussion_r494745236", "bodyText": "Indentation may be like } else {. same in line number 175", "author": "smrutis1", "createdAt": "2020-09-25T04:48:51Z", "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java", "diffHunk": "@@ -149,18 +149,33 @@ private LuceneResult callLuceneDirectly(LuceneSearchView function, String queryS\n         if (resultLimit > 0) {\n             queryURI.param(\"limit\", resultLimit);\n         }\n+        if (dbNameForLuceneSearch.equals(DatabaseSettings.COUCH_DB_USERS)) {\n+            queryURI.param(\"stale\", \"ok\");\n+        }\n         queryURI.param(\"q\", queryString.toString());\n         URL luceneResourceUrl = new URL(DatabaseSettings.COUCH_DB_LUCENE_URL + queryURI.toString());\n+        ObjectMapper objectMapper = new EktorpLuceneObjectMapperFactory().createObjectMapper();\n         HttpURLConnection connection = null;\n         try {\n-            connection = (HttpURLConnection) luceneResourceUrl.openConnection();\n-            connection.setRequestMethod(\"GET\");\n-            connection.connect();\n+            connection = makeLuceneRequest(luceneResourceUrl);\n             int responseCode = connection.getResponseCode();\n             if (responseCode == 200) {\n-                ObjectMapper objectMapper = new EktorpLuceneObjectMapperFactory().createObjectMapper();\n                 return objectMapper.readValue(connection.getInputStream(), LuceneResult.class);\n             }\n+            else {", "originalCommit": "93a053810cb6a969854e74a9d8956b542bf77486", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3Mzg1OA==", "url": "https://github.com/eclipse/sw360/pull/994#discussion_r494773858", "bodyText": "Changes done.", "author": "JaideepPalit", "createdAt": "2020-09-25T06:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0NTIzNg=="}], "type": "inlineReview", "revised_code": {"commit": "2f9a6879031341707cb8d578125e97798e47bbd6", "chunk": "diff --git a/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java b/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java\nindex 34fa3743..1e7afaae 100644\n--- a/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java\n+++ b/libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java\n\n@@ -149,9 +149,6 @@ public class LuceneAwareDatabaseConnector extends LuceneAwareCouchDbConnector {\n         if (resultLimit > 0) {\n             queryURI.param(\"limit\", resultLimit);\n         }\n-        if (dbNameForLuceneSearch.equals(DatabaseSettings.COUCH_DB_USERS)) {\n-            queryURI.param(\"stale\", \"ok\");\n-        }\n         queryURI.param(\"q\", queryString.toString());\n         URL luceneResourceUrl = new URL(DatabaseSettings.COUCH_DB_LUCENE_URL + queryURI.toString());\n         ObjectMapper objectMapper = new EktorpLuceneObjectMapperFactory().createObjectMapper();\n"}}, {"oid": "2f9a6879031341707cb8d578125e97798e47bbd6", "url": "https://github.com/eclipse/sw360/commit/2f9a6879031341707cb8d578125e97798e47bbd6", "message": "fix(UserSearch): Fixed search user functionality\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-09-25T06:26:26Z", "type": "commit"}, {"oid": "2f9a6879031341707cb8d578125e97798e47bbd6", "url": "https://github.com/eclipse/sw360/commit/2f9a6879031341707cb8d578125e97798e47bbd6", "message": "fix(UserSearch): Fixed search user functionality\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-09-25T06:26:26Z", "type": "forcePushed"}]}