{"pr_number": 776, "pr_title": "feat(rest): validate the dependent document ids in the payload before updating it in the DB", "pr_createdAt": "2020-02-12T13:53:20Z", "pr_url": "https://github.com/eclipse/sw360/pull/776", "timeline": [{"oid": "cc0354e4ff9325558771249bac493d0606de9ebf", "url": "https://github.com/eclipse/sw360/commit/cc0354e4ff9325558771249bac493d0606de9ebf", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-14T05:09:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2NzUzNg==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r379267536", "bodyText": "Please create a method and reuse in Create projects.", "author": "JaideepPalit", "createdAt": "2020-02-14T06:24:30Z", "path": "rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/project/Sw360ProjectService.java", "diffHunk": "@@ -135,19 +146,34 @@ public Project createProject(Project project, User sw360User) throws TException\n             return project;\n         } else if (documentRequestSummary.getRequestStatus() == AddDocumentRequestStatus.DUPLICATE) {\n             throw new DataIntegrityViolationException(\"sw360 project with name '\" + project.getName() + \"' already exists.\");\n+        } else if (documentRequestSummary.getRequestStatus() == AddDocumentRequestStatus.INVALID_INPUT) {\n+            throw new HttpMessageNotReadableException(\"Dependent document Id/ids not valid.\");\n         }\n         return null;\n     }\n \n     public RequestStatus updateProject(Project project, User sw360User) throws TException {\n         ProjectService.Iface sw360ProjectClient = getThriftProjectClient();\n-        String cyclicLinkedProjectPath = sw360ProjectClient.getCyclicLinkedProjectPath(project, sw360User);\n+        String cyclicLinkedProjectPath = null;\n+        try {\n+            cyclicLinkedProjectPath = sw360ProjectClient.getCyclicLinkedProjectPath(project, sw360User);\n+        } catch (SW360Exception sw360Exp) {\n+            if (sw360Exp.getErrorCode() == 404) {\n+                throw new HttpMessageNotReadableException(\"Dependent document Id/ids not valid.\");\n+            } else if (sw360Exp.getErrorCode() == 403) {\n+                throw new AccessDeniedException(\"Error fetching project. Either Project or its Linked Projects are not accessible\");\n+            } else {\n+                throw sw360Exp;\n+            }\n+        }", "originalCommit": "cc0354e4ff9325558771249bac493d0606de9ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab666aea2442bbb95bcbd0136f7612f2528f910", "chunk": "diff --git a/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/project/Sw360ProjectService.java b/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/project/Sw360ProjectService.java\nindex 1606ed4a..1fcb0a1c 100644\n--- a/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/project/Sw360ProjectService.java\n+++ b/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/project/Sw360ProjectService.java\n\n@@ -124,21 +124,7 @@ public class Sw360ProjectService implements AwareOfRestServices<Project> {\n \n     public Project createProject(Project project, User sw360User) throws TException {\n         ProjectService.Iface sw360ProjectClient = getThriftProjectClient();\n-        String cyclicLinkedProjectPath = null;\n-        try {\n-            cyclicLinkedProjectPath = sw360ProjectClient.getCyclicLinkedProjectPath(project, sw360User);\n-        } catch (SW360Exception sw360Exp) {\n-            if (sw360Exp.getErrorCode() == 404) {\n-                throw new HttpMessageNotReadableException(\"Dependent document Id/ids not valid.\");\n-            } else if (sw360Exp.getErrorCode() == 403) {\n-                throw new AccessDeniedException(\"Error fetching project. Either Project or its Linked Projects are not accessible\");\n-            } else {\n-                throw sw360Exp;\n-            }\n-        }\n-        if (!isNullEmptyOrWhitespace(cyclicLinkedProjectPath)) {\n-            throw new HttpMessageNotReadableException(\"Cyclic linked Project : \" + cyclicLinkedProjectPath);\n-        }\n+        rch.checkForCyclicOrInvalidDependencies(sw360ProjectClient, project, sw360User);\n         AddDocumentRequestSummary documentRequestSummary = sw360ProjectClient.addProject(project, sw360User);\n         if (documentRequestSummary.getRequestStatus() == AddDocumentRequestStatus.SUCCESS) {\n             project.setId(documentRequestSummary.getId());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2ODMyMg==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r379268322", "bodyText": "Please create a method and reuse in Create Release.", "author": "JaideepPalit", "createdAt": "2020-02-14T06:27:53Z", "path": "rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/release/Sw360ReleaseService.java", "diffHunk": "@@ -92,19 +107,34 @@ public Release createRelease(Release release, User sw360User) throws TException\n             return release;\n         } else if (documentRequestSummary.getRequestStatus() == AddDocumentRequestStatus.DUPLICATE) {\n             throw new DataIntegrityViolationException(\"sw360 release with name '\" + release.getName() + \"' already exists.\");\n+        } else if (documentRequestSummary.getRequestStatus() == AddDocumentRequestStatus.INVALID_INPUT) {\n+            throw new HttpMessageNotReadableException(\"Dependent document Id/ids not valid.\");\n         }\n         return null;\n     }\n \n     public RequestStatus updateRelease(Release release, User sw360User) throws TException {\n         ComponentService.Iface sw360ComponentClient = getThriftComponentClient();\n-        String cyclicLinkedReleasePath = sw360ComponentClient.getCyclicLinkedReleasePath(release, sw360User);\n+        String cyclicLinkedReleasePath = null;\n+        try {\n+            cyclicLinkedReleasePath = sw360ComponentClient.getCyclicLinkedReleasePath(release, sw360User);\n+        } catch (SW360Exception sw360Exp) {\n+            if (sw360Exp.getErrorCode() == 404) {\n+                throw new HttpMessageNotReadableException(\"Dependent document Id/ids not valid.\");\n+            } else if (sw360Exp.getErrorCode() == 403) {\n+                throw new AccessDeniedException(\"Error fetching project. Either Project or its Linked Projects are not accessible\");\n+            } else {\n+                throw sw360Exp;\n+            }\n+        }", "originalCommit": "cc0354e4ff9325558771249bac493d0606de9ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab666aea2442bbb95bcbd0136f7612f2528f910", "chunk": "diff --git a/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/release/Sw360ReleaseService.java b/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/release/Sw360ReleaseService.java\nindex 04742295..dac161b9 100644\n--- a/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/release/Sw360ReleaseService.java\n+++ b/rest/resource-server/src/main/java/org/eclipse/sw360/rest/resourceserver/release/Sw360ReleaseService.java\n\n@@ -83,24 +83,7 @@ public class Sw360ReleaseService implements AwareOfRestServices<Release> {\n \n     public Release createRelease(Release release, User sw360User) throws TException {\n         ComponentService.Iface sw360ComponentClient = getThriftComponentClient();\n-\n-        String cyclicLinkedReleasePath = null;\n-        try {\n-            cyclicLinkedReleasePath = sw360ComponentClient.getCyclicLinkedReleasePath(release, sw360User);\n-        } catch (SW360Exception sw360Exp) {\n-            if (sw360Exp.getErrorCode() == 404) {\n-                throw new HttpMessageNotReadableException(\"Dependent document Id/ids not valid.\");\n-            } else if (sw360Exp.getErrorCode() == 403) {\n-                throw new AccessDeniedException(\"Error fetching project. Either Project or its Linked Projects are not accessible\");\n-            } else {\n-                throw sw360Exp;\n-            }\n-        }\n-\n-        if (!isNullEmptyOrWhitespace(cyclicLinkedReleasePath)) {\n-            throw new HttpMessageNotReadableException(\"Cyclic linked Release : \" + cyclicLinkedReleasePath);\n-        }\n-\n+        rch.checkForCyclicOrInvalidDependencies(sw360ComponentClient, release, sw360User);\n         AddDocumentRequestSummary documentRequestSummary = sw360ComponentClient.addRelease(release, sw360User);\n         if (documentRequestSummary.getRequestStatus() == AddDocumentRequestStatus.SUCCESS) {\n             release.setId(documentRequestSummary.getId());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI3NTU3OA==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r379275578", "bodyText": "Please create common logic to validate Set of Ids and place in parent class AttachementAwareDatabaseHandler So that it can be reused.\nSimilarly for fields containing only IDs - String\nMaybe something like below code.\npublic static <T, R extends DatabaseRepository> boolean isAllIdInSetExists(Set<String> setOfIds, R repository) {\n        long nonExistingIdCount = 0;\n        if (setOfIds != null) {\n            nonExistingIdCount = setOfIds.stream().filter(id -> CommonUtils.isNotNullEmptyOrWhitespace(id))\n                    .filter(id -> {\n                        T obj = (T) repository.get(id);\n                        return Objects.isNull(obj);\n                    }).count();\n        }\n\n        if (nonExistingIdCount > 0)\n            return false;\n\n        return true;\n    }", "author": "JaideepPalit", "createdAt": "2020-02-14T06:59:05Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -452,6 +464,55 @@ public RequestStatus updateComponent(Component component, User user) throws SW36\n \n     }\n \n+    private boolean isDependenciesExistInComponent(Component component) {\n+        if (component.isSetReleaseIds()) {\n+            Set<String> releaseIds = component.getReleaseIds();\n+            for (String releaseId : releaseIds) {\n+                Release release = releaseRepository.get(releaseId);\n+                if (release == null) {\n+                    return false;\n+                }\n+            }\n+        }\n+\n+        if (component.isSetDefaultVendorId() && !component.getDefaultVendorId().isEmpty()) {\n+            Vendor defaultVendor = vendorRepository.get(component.getDefaultVendorId());\n+            if (defaultVendor == null) {\n+                return false;\n+            }\n+        }\n+        return true;\n+    }\n+\n+    private boolean isDependenciesExistsInRelease(Release release) {\n+        if (release.isSetComponentId()) {\n+            String componentId = release.getComponentId();\n+            Component component = componentRepository.get(componentId);\n+            if (component == null) {\n+                return false;\n+            }\n+        }\n+\n+        if (release.isSetReleaseIdToRelationship()) {\n+            Set<String> releaseIds = release.getReleaseIdToRelationship().keySet();\n+            for (String releaseId : releaseIds) {\n+                release = releaseRepository.get(releaseId);\n+                if (release == null) {\n+                    return false;\n+                }\n+            }\n+        }\n+\n+        if (release.isSetVendorId()) {\n+            String vendorId = release.getVendorId();\n+            Vendor vendor = vendorRepository.get(vendorId);\n+            if (vendor == null) {\n+                return false;\n+            }\n+        }\n+        return true;\n+    }\n+", "originalCommit": "cc0354e4ff9325558771249bac493d0606de9ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab666aea2442bbb95bcbd0136f7612f2528f910", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java\nindex 4902c2cf..628b25a3 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java\n\n@@ -467,19 +467,11 @@ public class ComponentDatabaseHandler extends AttachmentAwareDatabaseHandler {\n     private boolean isDependenciesExistInComponent(Component component) {\n         if (component.isSetReleaseIds()) {\n             Set<String> releaseIds = component.getReleaseIds();\n-            for (String releaseId : releaseIds) {\n-                Release release = releaseRepository.get(releaseId);\n-                if (release == null) {\n-                    return false;\n-                }\n-            }\n+            return DatabaseHandlerUtil.isAllIdInSetExists(releaseIds, releaseRepository);\n         }\n \n-        if (component.isSetDefaultVendorId() && !component.getDefaultVendorId().isEmpty()) {\n-            Vendor defaultVendor = vendorRepository.get(component.getDefaultVendorId());\n-            if (defaultVendor == null) {\n-                return false;\n-            }\n+        if (component.isSetDefaultVendorId()) {\n+            return DatabaseHandlerUtil.isAllIdInSetExists(Sets.newHashSet(component.getDefaultVendorId()), vendorRepository);\n         }\n         return true;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI4ODY4Ng==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r379288686", "bodyText": "Please also validate if linked project is accessible to user.", "author": "JaideepPalit", "createdAt": "2020-02-14T07:46:50Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -261,6 +272,36 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private boolean isDependenciesExists(Project project) {\n+        if (project.isSetReleaseIdToUsage()) {\n+            Set<String> releaseIds = project.getReleaseIdToUsage().keySet();\n+            for (String releaseId : releaseIds) {\n+                Release release = releaseRepository.get(releaseId);\n+                if (release == null) {\n+                    return false;\n+                }\n+            }\n+        }\n+\n+        if (project.isSetLinkedProjects()) {\n+            Set<String> projectIds = project.getLinkedProjects().keySet();\n+            for (String projectId : projectIds) {\n+                Project linkedProject = repository.get(projectId);", "originalCommit": "cc0354e4ff9325558771249bac493d0606de9ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab666aea2442bbb95bcbd0136f7612f2528f910", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\nindex d67a17a4..bbd4c3bf 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\n\n@@ -275,29 +275,17 @@ public class ProjectDatabaseHandler extends AttachmentAwareDatabaseHandler {\n     private boolean isDependenciesExists(Project project) {\n         if (project.isSetReleaseIdToUsage()) {\n             Set<String> releaseIds = project.getReleaseIdToUsage().keySet();\n-            for (String releaseId : releaseIds) {\n-                Release release = releaseRepository.get(releaseId);\n-                if (release == null) {\n-                    return false;\n-                }\n-            }\n+            return DatabaseHandlerUtil.isAllIdInSetExists(releaseIds, releaseRepository);\n         }\n \n         if (project.isSetLinkedProjects()) {\n             Set<String> projectIds = project.getLinkedProjects().keySet();\n-            for (String projectId : projectIds) {\n-                Project linkedProject = repository.get(projectId);\n-                if (linkedProject == null) {\n-                    return false;\n-                }\n-            }\n+            return DatabaseHandlerUtil.isAllIdInSetExists(projectIds, repository);\n         }\n \n         if (project.isSetLinkedObligationId()) {\n             String obligationId = project.getLinkedObligationId();\n-            if (obligationRepository.get(obligationId) == null) {\n-                return false;\n-            }\n+            return DatabaseHandlerUtil.isAllIdInSetExists(Sets.newHashSet(obligationId), obligationRepository);\n         }\n         return true;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDIzOA==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r379294238", "bodyText": "Please add validation for main license Id. For Release also.", "author": "JaideepPalit", "createdAt": "2020-02-14T08:05:13Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -452,6 +464,55 @@ public RequestStatus updateComponent(Component component, User user) throws SW36\n \n     }\n \n+    private boolean isDependenciesExistInComponent(Component component) {\n+        if (component.isSetReleaseIds()) {\n+            Set<String> releaseIds = component.getReleaseIds();\n+            for (String releaseId : releaseIds) {\n+                Release release = releaseRepository.get(releaseId);\n+                if (release == null) {\n+                    return false;\n+                }\n+            }\n+        }\n+\n+        if (component.isSetDefaultVendorId() && !component.getDefaultVendorId().isEmpty()) {\n+            Vendor defaultVendor = vendorRepository.get(component.getDefaultVendorId());\n+            if (defaultVendor == null) {\n+                return false;\n+            }\n+        }", "originalCommit": "cc0354e4ff9325558771249bac493d0606de9ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab666aea2442bbb95bcbd0136f7612f2528f910", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java\nindex 4902c2cf..628b25a3 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java\n\n@@ -467,19 +467,11 @@ public class ComponentDatabaseHandler extends AttachmentAwareDatabaseHandler {\n     private boolean isDependenciesExistInComponent(Component component) {\n         if (component.isSetReleaseIds()) {\n             Set<String> releaseIds = component.getReleaseIds();\n-            for (String releaseId : releaseIds) {\n-                Release release = releaseRepository.get(releaseId);\n-                if (release == null) {\n-                    return false;\n-                }\n-            }\n+            return DatabaseHandlerUtil.isAllIdInSetExists(releaseIds, releaseRepository);\n         }\n \n-        if (component.isSetDefaultVendorId() && !component.getDefaultVendorId().isEmpty()) {\n-            Vendor defaultVendor = vendorRepository.get(component.getDefaultVendorId());\n-            if (defaultVendor == null) {\n-                return false;\n-            }\n+        if (component.isSetDefaultVendorId()) {\n+            return DatabaseHandlerUtil.isAllIdInSetExists(Sets.newHashSet(component.getDefaultVendorId()), vendorRepository);\n         }\n         return true;\n     }\n"}}, {"oid": "0ab666aea2442bbb95bcbd0136f7612f2528f910", "url": "https://github.com/eclipse/sw360/commit/0ab666aea2442bbb95bcbd0136f7612f2528f910", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-17T10:02:23Z", "type": "forcePushed"}, {"oid": "ca6ba50aee3cc2111253568c26d8520724e8b348", "url": "https://github.com/eclipse/sw360/commit/ca6ba50aee3cc2111253568c26d8520724e8b348", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-17T14:30:52Z", "type": "forcePushed"}, {"oid": "295c3d5f5de877525df84c7822fffc544c854d90", "url": "https://github.com/eclipse/sw360/commit/295c3d5f5de877525df84c7822fffc544c854d90", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-17T14:37:58Z", "type": "forcePushed"}, {"oid": "85f0ad7f89648cd3eb256b8d5f228a517f106d97", "url": "https://github.com/eclipse/sw360/commit/85f0ad7f89648cd3eb256b8d5f228a517f106d97", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-18T08:14:42Z", "type": "forcePushed"}, {"oid": "c623edc76c1054c24fb451147ed238383f2023f6", "url": "https://github.com/eclipse/sw360/commit/c623edc76c1054c24fb451147ed238383f2023f6", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-18T08:28:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc5MTgwMA==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r381791800", "bodyText": "Maybe it would be good to stop validation once any doc id is not found and throw error message.\nSame for validate Component and Release\nIf possible we can check is Linked Projects are Visible to user using PermissionUtils.makePermission(project, user).isActionAllowed(RequestedAction.READ)", "author": "JaideepPalit", "createdAt": "2020-02-20T06:13:44Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -261,6 +272,25 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private boolean isDependenciesExists(Project project) {\n+        boolean validReleaseIds = true, validLinkedProjectIds = true, validObligationId = true;\n+        if (project.isSetReleaseIdToUsage()) {\n+            Set<String> releaseIds = project.getReleaseIdToUsage().keySet();\n+            validReleaseIds = DatabaseHandlerUtil.isAllIdInSetExists(releaseIds, releaseRepository);\n+        }\n+\n+        if (project.isSetLinkedProjects()) {\n+            Set<String> projectIds = project.getLinkedProjects().keySet();\n+            validLinkedProjectIds =  DatabaseHandlerUtil.isAllIdInSetExists(projectIds, repository);\n+        }\n+\n+        if (project.isSetLinkedObligationId()) {", "originalCommit": "c623edc76c1054c24fb451147ed238383f2023f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTgzMzAxNQ==", "url": "https://github.com/eclipse/sw360/pull/776#discussion_r381833015", "bodyText": "Done", "author": "smrutis1", "createdAt": "2020-02-20T07:55:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc5MTgwMA=="}], "type": "inlineReview", "revised_code": {"commit": "fd0d6454e4f4fec312db711b5124eb55ca15338d", "chunk": "diff --git a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\nindex 817703f3..a118c83f 100644\n--- a/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\n+++ b/backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java\n\n@@ -272,23 +286,39 @@ public class ProjectDatabaseHandler extends AttachmentAwareDatabaseHandler {\n         }\n     }\n \n-    private boolean isDependenciesExists(Project project) {\n-        boolean validReleaseIds = true, validLinkedProjectIds = true, validObligationId = true;\n+    private boolean isDependenciesExists(Project project, User user) {\n+        boolean isValidDependentIds = true;\n         if (project.isSetReleaseIdToUsage()) {\n             Set<String> releaseIds = project.getReleaseIdToUsage().keySet();\n-            validReleaseIds = DatabaseHandlerUtil.isAllIdInSetExists(releaseIds, releaseRepository);\n+            isValidDependentIds = DatabaseHandlerUtil.isAllIdInSetExists(releaseIds, releaseRepository);\n         }\n \n-        if (project.isSetLinkedProjects()) {\n+        if (isValidDependentIds && project.isSetLinkedProjects()) {\n             Set<String> projectIds = project.getLinkedProjects().keySet();\n-            validLinkedProjectIds =  DatabaseHandlerUtil.isAllIdInSetExists(projectIds, repository);\n+            isValidDependentIds =  DatabaseHandlerUtil.isAllIdInSetExists(projectIds, repository) && verifyLinkedProjectsAreAccessible(projectIds, user);\n         }\n \n-        if (project.isSetLinkedObligationId()) {\n+        if (isValidDependentIds && project.isSetLinkedObligationId()) {\n             String obligationId = project.getLinkedObligationId();\n-            validObligationId = DatabaseHandlerUtil.isAllIdInSetExists(Sets.newHashSet(obligationId), obligationRepository);\n+            isValidDependentIds = DatabaseHandlerUtil.isAllIdInSetExists(Sets.newHashSet(obligationId), obligationRepository);\n         }\n-        return validReleaseIds && validLinkedProjectIds && validObligationId;\n+        return isValidDependentIds;\n+    }\n+\n+    private boolean verifyLinkedProjectsAreAccessible(Set<String> linkedProjectIds, User user) {\n+        long nonAccessibleProjectIdsCount = 0;\n+        if (linkedProjectIds != null) {\n+            nonAccessibleProjectIdsCount = linkedProjectIds.stream().filter(id -> {\n+                Project project = repository.get(id);\n+                return !PermissionUtils.makePermission(project, user).isActionAllowed(RequestedAction.READ);\n+            }).count();\n+        }\n+\n+        if (nonAccessibleProjectIdsCount > 0)\n+            return false;\n+\n+        return true;\n+\n     }\n \n     public ProjectObligation getLinkedObligations(String obligationId, User user) throws TException {\n"}}, {"oid": "fd0d6454e4f4fec312db711b5124eb55ca15338d", "url": "https://github.com/eclipse/sw360/commit/fd0d6454e4f4fec312db711b5124eb55ca15338d", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-20T07:46:30Z", "type": "forcePushed"}, {"oid": "28463bd1912b3caa3f45b8965f4af80e3727152c", "url": "https://github.com/eclipse/sw360/commit/28463bd1912b3caa3f45b8965f4af80e3727152c", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-20T08:49:00Z", "type": "forcePushed"}, {"oid": "712ba79a6a5edd8c6e563d406a7e9dfe991dfb50", "url": "https://github.com/eclipse/sw360/commit/712ba79a6a5edd8c6e563d406a7e9dfe991dfb50", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-20T11:28:42Z", "type": "commit"}, {"oid": "712ba79a6a5edd8c6e563d406a7e9dfe991dfb50", "url": "https://github.com/eclipse/sw360/commit/712ba79a6a5edd8c6e563d406a7e9dfe991dfb50", "message": "feat(rest): validate the linked document ids in the payload before updating it in the DB\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-02-20T11:28:42Z", "type": "forcePushed"}]}