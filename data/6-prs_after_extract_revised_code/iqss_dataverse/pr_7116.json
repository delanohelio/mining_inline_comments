{"pr_number": 7116, "pr_title": "global update of doi:mdcbaseurlstring and doi.baseurlstringnext", "pr_createdAt": "2020-07-22T19:44:01Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7116", "timeline": [{"oid": "185044640a846946ff551c6ba8c6ad5d654190af", "url": "https://github.com/IQSS/dataverse/commit/185044640a846946ff551c6ba8c6ad5d654190af", "message": "global update of doi:mdcbaseurlstring and doi.baseurlstringnext\n\nto doi.dataciterestapiurlstring", "committedDate": "2020-07-22T19:32:46Z", "type": "commit"}, {"oid": "946080f3e22f700cb9e71d2df5e1a25d23afc275", "url": "https://github.com/IQSS/dataverse/commit/946080f3e22f700cb9e71d2df5e1a25d23afc275", "message": "rename release note file so I update at release time", "committedDate": "2020-07-23T13:59:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA3MjM0NA==", "url": "https://github.com/IQSS/dataverse/pull/7116#discussion_r468072344", "bodyText": "So this API endpoint only supports DataCite?", "author": "sekmiller", "createdAt": "2020-08-10T17:44:23Z", "path": "src/main/java/edu/harvard/iq/dataverse/api/Pids.java", "diffHunk": "@@ -45,7 +45,7 @@ public Response getPid(@QueryParam(\"persistentId\") String persistentId) {\n         } catch (WrappedResponse ex) {\n             return error(Response.Status.FORBIDDEN, BundleUtil.getStringFromBundle(\"api.errors.invalidApiToken\"));\n         }\n-        String baseUrl = System.getProperty(\"doi.baseurlstringnext\");\n+        String baseUrl = systemConfig.getDataCiteRestApiUrlString();", "originalCommit": "946080f3e22f700cb9e71d2df5e1a25d23afc275", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5ODM0Mg==", "url": "https://github.com/IQSS/dataverse/pull/7116#discussion_r468098342", "bodyText": "Good catch. Yes, and I think the docs say that. However, the other places that were DataCite-specific had been resolved in earlier PRs that were merged into dev. I just resolved the conflicts in this PR and you can see DoiDataCiteServiceBean now gets the new URL via the SystemConfig method and the DeletePIDCommand is no longer DataCite specific.", "author": "qqmyers", "createdAt": "2020-08-10T18:31:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA3MjM0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExNzE2Ng==", "url": "https://github.com/IQSS/dataverse/pull/7116#discussion_r468117166", "bodyText": "Great. Will pass to QA.", "author": "sekmiller", "createdAt": "2020-08-10T19:06:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA3MjM0NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA3ODk4OQ==", "url": "https://github.com/IQSS/dataverse/pull/7116#discussion_r468078989", "bodyText": "Again, surprised that this command only supports DataCite, but it was like this previously.", "author": "sekmiller", "createdAt": "2020-08-10T17:55:48Z", "path": "src/main/java/edu/harvard/iq/dataverse/engine/command/impl/DeletePidCommand.java", "diffHunk": "@@ -47,7 +47,7 @@ protected void executeImpl(CommandContext ctxt) throws CommandException {\n         GlobalIdServiceBean idServiceBean = GlobalIdServiceBean.getBean(protocol, ctxt);\n         try {\n             // idServiceBean.deleteIdentifier(dataset); // didn't work\n-            String baseUrl = System.getProperty(\"doi.baseurlstringnext\");\n+            String baseUrl = ctxt.systemConfig().getDataCiteRestApiUrlString();", "originalCommit": "946080f3e22f700cb9e71d2df5e1a25d23afc275", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e20a52fd5e0c3498df9e2a023f86417f079acdfb", "chunk": "diff --git a/src/main/java/edu/harvard/iq/dataverse/engine/command/impl/DeletePidCommand.java b/src/main/java/edu/harvard/iq/dataverse/engine/command/impl/DeletePidCommand.java\nindex 937f7efa2..841c84793 100644\n--- a/src/main/java/edu/harvard/iq/dataverse/engine/command/impl/DeletePidCommand.java\n+++ b/src/main/java/edu/harvard/iq/dataverse/engine/command/impl/DeletePidCommand.java\n\n@@ -46,22 +46,17 @@ public class DeletePidCommand extends AbstractVoidCommand {\n         String protocol = ctxt.settings().getValueForKey(SettingsServiceBean.Key.Protocol, nonNullDefaultIfKeyNotFound);\n         GlobalIdServiceBean idServiceBean = GlobalIdServiceBean.getBean(protocol, ctxt);\n         try {\n-            // idServiceBean.deleteIdentifier(dataset); // didn't work\n-            String baseUrl = ctxt.systemConfig().getDataCiteRestApiUrlString();\n-            String username = System.getProperty(\"doi.username\");\n-            String password = System.getProperty(\"doi.password\");\n-            int result = PidUtil.deleteDoi(dataset.getGlobalId().asString(), baseUrl, username, password);\n-            if (result == 204) {\n-                // Success! Clear the create time, etc.\n-                dataset.setGlobalIdCreateTime(null);\n-                dataset.setIdentifierRegistered(false);\n-                ctxt.datasets().merge(dataset);\n-            } else {\n-                String message = BundleUtil.getStringFromBundle(\"pids.commands.deletePid.failureExpected\", Arrays.asList(dataset.getId().toString(), Integer.toString(result)));\n-                throw new IllegalCommandException(message, this);\n-            }\n-        } catch (IOException ex) {\n-            String message = BundleUtil.getStringFromBundle(\"pids.commands.deletePid.failureOther\", Arrays.asList(dataset.getId().toString(), ex.getLocalizedMessage()));\n+            idServiceBean.deleteIdentifier(dataset); \n+            // Success! Clear the create time, etc.\n+            dataset.setGlobalIdCreateTime(null);\n+            dataset.setIdentifierRegistered(false);\n+            ctxt.datasets().merge(dataset);\n+        } catch (HTTPException hex) {\n+        \tString message = BundleUtil.getStringFromBundle(\"pids.deletePid.failureExpected\", Arrays.asList(dataset.getGlobalId().asString(), Integer.toString(hex.getStatusCode())));\n+            logger.info(message);\n+            throw new IllegalCommandException(message, this);\n+        } catch (Exception ex) {\n+        \tString message = BundleUtil.getStringFromBundle(\"pids.deletePid.failureOther\", Arrays.asList(dataset.getGlobalId().asString(), ex.getLocalizedMessage()));\n             logger.info(message);\n             throw new IllegalCommandException(message, this);\n         }\n"}}, {"oid": "e20a52fd5e0c3498df9e2a023f86417f079acdfb", "url": "https://github.com/IQSS/dataverse/commit/e20a52fd5e0c3498df9e2a023f86417f079acdfb", "message": "Merge remote-tracking branch 'IQSS/develop' into IQSS/7113\n\n-consolidate_datacite_jvm_options\n\nConflicts:\n\tsrc/main/java/edu/harvard/iq/dataverse/DOIDataCiteServiceBean.java\n\tsrc/main/java/edu/harvard/iq/dataverse/engine/command/impl/DeletePidCommand.java", "committedDate": "2020-08-10T18:19:09Z", "type": "commit"}, {"oid": "990c6597a915563b6eb4e9617a371f587a75b4d5", "url": "https://github.com/IQSS/dataverse/commit/990c6597a915563b6eb4e9617a371f587a75b4d5", "message": "Merge remote-tracking branch 'origin/IQSS/7113-consolidate_datacite_jvm_options' into IQSS/7113-consolidate_datacite_jvm_options", "committedDate": "2020-08-10T18:25:30Z", "type": "commit"}]}