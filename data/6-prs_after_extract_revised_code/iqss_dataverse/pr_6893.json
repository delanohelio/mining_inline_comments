{"pr_number": 6893, "pr_title": "6574 filenames", "pr_createdAt": "2020-05-04T14:52:38Z", "pr_url": "https://github.com/IQSS/dataverse/pull/6893", "timeline": [{"oid": "41ab1c41ab14f9f057ba8168644205552361be4c", "url": "https://github.com/IQSS/dataverse/commit/41ab1c41ab14f9f057ba8168644205552361be4c", "message": "prevent filename conflicts via file metadata API #6574", "committedDate": "2020-04-29T20:16:32Z", "type": "commit"}, {"oid": "15d18dd527497c38705e353ccf056f9f2be8342e", "url": "https://github.com/IQSS/dataverse/commit/15d18dd527497c38705e353ccf056f9f2be8342e", "message": "add test: files not renamed in diff dirs on upload #6574", "committedDate": "2020-04-29T21:10:36Z", "type": "commit"}, {"oid": "c3e92758dc5293eec385c831b9f823c36a286d07", "url": "https://github.com/IQSS/dataverse/commit/c3e92758dc5293eec385c831b9f823c36a286d07", "message": "centralize duplicate file check with related methods #6574", "committedDate": "2020-04-30T18:28:06Z", "type": "commit"}, {"oid": "35d07a4466d6120698aa4d567ad1801602ea8f11", "url": "https://github.com/IQSS/dataverse/commit/35d07a4466d6120698aa4d567ad1801602ea8f11", "message": "prevent filename duplicates from \"edit metadata for files\" page #6574", "committedDate": "2020-05-01T21:07:38Z", "type": "commit"}, {"oid": "6ef84f80e65ecc6ab0fac51ad8a4eba45804a2d4", "url": "https://github.com/IQSS/dataverse/commit/6ef84f80e65ecc6ab0fac51ad8a4eba45804a2d4", "message": "Merge branch 'develop' into 6574-filenames #6574", "committedDate": "2020-05-04T14:43:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MjI5Nw==", "url": "https://github.com/IQSS/dataverse/pull/6893#discussion_r420782297", "bodyText": "would it be possible to combine this with findDuplicateFilenames so that the UI and api are using the same method? You're passing in the filemetadata list from the dataset version which is the param for findDuplicateFilenames", "author": "sekmiller", "createdAt": "2020-05-06T13:18:19Z", "path": "src/main/java/edu/harvard/iq/dataverse/ingest/IngestUtil.java", "diffHunk": "@@ -100,6 +101,80 @@ public static String duplicateFilenameCheck(FileMetadata fileMetadata, Set<Strin\n         return fileName;\n     }\n \n+    /**\n+     * Given a new proposed label or directoryLabel for a file, check against\n+     * existing files if a duplicate directoryLabel/label combination would be\n+     * created.\n+     *\n+     * @param label The new label (filename) that is being proposed. Can be\n+     * null.\n+     * @param directoryLabel The new directoryLabel (file path) that is being\n+     * proposed. Can be null.\n+     * @param fileMetadatas The list fileMetadatas to be compared against,\n+     * probably from a draft.\n+     * @param dataFile The file that is being updated with a new name or path.\n+     * @return true if there is a conflict, false otherwise.\n+     */\n+    public static boolean conflictsWithExistingFilenames(String label, String directoryLabel, List<FileMetadata> fileMetadatas, DataFile dataFile) {\n+        List<String> filePathsAndNames = new ArrayList<>();\n+        for (FileMetadata fileMetadata : fileMetadatas) {", "originalCommit": "6ef84f80e65ecc6ab0fac51ad8a4eba45804a2d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg3MDM0MQ==", "url": "https://github.com/IQSS/dataverse/pull/6893#discussion_r420870341", "bodyText": "@sekmiller good idea. Fixed in 8d6a5c8.", "author": "pdurbin", "createdAt": "2020-05-06T15:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MjI5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "8d6a5c8e6718f9989a1cd0216b026439b8064b32", "chunk": "diff --git a/src/main/java/edu/harvard/iq/dataverse/ingest/IngestUtil.java b/src/main/java/edu/harvard/iq/dataverse/ingest/IngestUtil.java\nindex 8251a3207..910d34e7b 100644\n--- a/src/main/java/edu/harvard/iq/dataverse/ingest/IngestUtil.java\n+++ b/src/main/java/edu/harvard/iq/dataverse/ingest/IngestUtil.java\n\n@@ -116,14 +116,7 @@ public class IngestUtil {\n      * @return true if there is a conflict, false otherwise.\n      */\n     public static boolean conflictsWithExistingFilenames(String label, String directoryLabel, List<FileMetadata> fileMetadatas, DataFile dataFile) {\n-        List<String> filePathsAndNames = new ArrayList<>();\n-        for (FileMetadata fileMetadata : fileMetadatas) {\n-            String path = \"\";\n-            if (fileMetadata.getDirectoryLabel() != null) {\n-                path = fileMetadata.getDirectoryLabel() + \"/\";\n-            }\n-            filePathsAndNames.add(path + fileMetadata.getLabel());\n-        }\n+        List<String> filePathsAndNames = getPathsAndFileNames(fileMetadatas);\n         if (label != null || directoryLabel != null) {\n             String path = \"\";\n             if (directoryLabel != null) {\n"}}, {"oid": "8d6a5c8e6718f9989a1cd0216b026439b8064b32", "url": "https://github.com/IQSS/dataverse/commit/8d6a5c8e6718f9989a1cd0216b026439b8064b32", "message": "consolidate duplicate code #6574", "committedDate": "2020-05-06T15:06:39Z", "type": "commit"}, {"oid": "dc77ac19ff2795e9a377fe37e38fe290bfa924b1", "url": "https://github.com/IQSS/dataverse/commit/dc77ac19ff2795e9a377fe37e38fe290bfa924b1", "message": "include new DuplicateFilesIT in API test suite #6574", "committedDate": "2020-05-06T15:08:22Z", "type": "commit"}, {"oid": "e79280bfb667d7f0ea215ca4f465d1f692ccf2f4", "url": "https://github.com/IQSS/dataverse/commit/e79280bfb667d7f0ea215ca4f465d1f692ccf2f4", "message": "Merge branch 'develop' into 6574-filenames #6574", "committedDate": "2020-05-06T15:09:23Z", "type": "commit"}]}