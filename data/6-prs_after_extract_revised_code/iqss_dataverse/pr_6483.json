{"pr_number": 6483, "pr_title": "#6345 add comma to display format for geographic coverage", "pr_createdAt": "2020-01-03T16:05:04Z", "pr_url": "https://github.com/IQSS/dataverse/pull/6483", "timeline": [{"oid": "75d71d471d0caa87cb32235ade744bca158281b7", "url": "https://github.com/IQSS/dataverse/commit/75d71d471d0caa87cb32235ade744bca158281b7", "message": "#6345 add comma to display format for geographic coverage", "committedDate": "2020-01-03T15:57:40Z", "type": "commit"}, {"oid": "36235d446ccf24814d25ecc4ef7cbda59d17f1c2", "url": "https://github.com/IQSS/dataverse/commit/36235d446ccf24814d25ecc4ef7cbda59d17f1c2", "message": "#6345 strip off comma from last geo metadata entry", "committedDate": "2020-01-06T16:03:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM4NjgyMQ==", "url": "https://github.com/IQSS/dataverse/pull/6483#discussion_r363386821", "bodyText": "We should remove this debug line.", "author": "pdurbin", "createdAt": "2020-01-06T17:04:30Z", "path": "src/main/java/edu/harvard/iq/dataverse/DatasetFieldCompoundValue.java", "diffHunk": "@@ -148,19 +150,51 @@ public DatasetFieldCompoundValue copy(DatasetField parent) {\n                 if (!childDatasetField.getDatasetFieldType().isSanitizeHtml() && childDatasetField.getDatasetFieldType().isEscapeOutputText()){\n                     sanitizedValue = MarkupChecker.stripAllTags(sanitizedValue);\n                 }\n+                //if a series of child values is comma delimited we want to strip off the final entry's comma\n+                if (format.equals(\"#VALUE, \")) fixTrailingComma = true;\n+                \n                 // replace the special values in the format (note: we replace #VALUE last since we don't\n                 // want any issues if the value itself has #NAME in it)\n+\n                 String displayValue = format\n                         .replace(\"#NAME\", childDatasetField.getDatasetFieldType().getTitle())\n                         //todo: this should be handled in more generic way for any other text that can then be internationalized\n                         // if we need to use replaceAll for regexp, then make sure to use: java.util.regex.Matcher.quoteReplacement(<target string>)\n                         .replace(\"#EMAIL\", BundleUtil.getStringFromBundle(\"dataset.email.hiddenMessage\"))\n                         .replace(\"#VALUE\",  sanitizedValue );\n-\n+                            if(childDatasetField.getDatasetFieldType().getName().equals(\"country\")){\n+                                    System.out.print(displayValue);", "originalCommit": "36235d446ccf24814d25ecc4ef7cbda59d17f1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ0MzQ1Mg==", "url": "https://github.com/IQSS/dataverse/pull/6483#discussion_r363443452", "bodyText": "debug code has been removed. The geospatial.tsv file has been updated and the flyway script sql removed.", "author": "sekmiller", "createdAt": "2020-01-06T19:23:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM4NjgyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "c85abf54312ff814cac1af149363a8b8f3faeffe", "chunk": "diff --git a/src/main/java/edu/harvard/iq/dataverse/DatasetFieldCompoundValue.java b/src/main/java/edu/harvard/iq/dataverse/DatasetFieldCompoundValue.java\nindex 4e374b7fb..221922ea0 100644\n--- a/src/main/java/edu/harvard/iq/dataverse/DatasetFieldCompoundValue.java\n+++ b/src/main/java/edu/harvard/iq/dataverse/DatasetFieldCompoundValue.java\n\n@@ -162,9 +162,6 @@ public class DatasetFieldCompoundValue implements Serializable {\n                         // if we need to use replaceAll for regexp, then make sure to use: java.util.regex.Matcher.quoteReplacement(<target string>)\n                         .replace(\"#EMAIL\", BundleUtil.getStringFromBundle(\"dataset.email.hiddenMessage\"))\n                         .replace(\"#VALUE\",  sanitizedValue );\n-                            if(childDatasetField.getDatasetFieldType().getName().equals(\"country\")){\n-                                    System.out.print(displayValue);\n-                            }\n                 fieldMap.put(childDatasetField,displayValue);\n             }\n         }\n"}}, {"oid": "c85abf54312ff814cac1af149363a8b8f3faeffe", "url": "https://github.com/IQSS/dataverse/commit/c85abf54312ff814cac1af149363a8b8f3faeffe", "message": "#6345 update tsv remove debug code", "committedDate": "2020-01-06T19:18:48Z", "type": "commit"}, {"oid": "b538d10d64e842351877f2e4c58cff77a726d123", "url": "https://github.com/IQSS/dataverse/commit/b538d10d64e842351877f2e4c58cff77a726d123", "message": "#6345 start 4.19 release notes", "committedDate": "2020-01-06T19:46:09Z", "type": "commit"}]}