{"pr_number": 7025, "pr_title": "Public ORCID login is available.", "pr_createdAt": "2020-06-26T13:12:07Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7025", "timeline": [{"oid": "c10b516d4b77f8169e35f1d27d8f95b7e8935b35", "url": "https://github.com/IQSS/dataverse/commit/c10b516d4b77f8169e35f1d27d8f95b7e8935b35", "message": "Public ORCID login is available.", "committedDate": "2020-06-26T12:44:37Z", "type": "commit"}, {"oid": "55c2c8918c384404c1dec008d6c60d03e71897de", "url": "https://github.com/IQSS/dataverse/commit/55c2c8918c384404c1dec008d6c60d03e71897de", "message": "Fix for NPE in test.", "committedDate": "2020-06-29T08:33:08Z", "type": "commit"}, {"oid": "8da201b42a5e61e15a8835b2b5d82c6f06c27fbc", "url": "https://github.com/IQSS/dataverse/commit/8da201b42a5e61e15a8835b2b5d82c6f06c27fbc", "message": "Oauth documentation is extended with ORCID public API option.", "committedDate": "2020-06-29T09:10:21Z", "type": "commit"}, {"oid": "9d7c843e4c9b667d0c51a19796af319b9e37d4ac", "url": "https://github.com/IQSS/dataverse/commit/9d7c843e4c9b667d0c51a19796af319b9e37d4ac", "message": "remove cost, link to ORCID APIs public, member #7025", "committedDate": "2020-06-29T15:10:43Z", "type": "commit"}, {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de", "url": "https://github.com/IQSS/dataverse/commit/0bcd8711d07e82df96f5ca692ce7de463bd139de", "message": "Merge pull request #1 from IQSS/7025-orcid-docs\n\nremove cost, link to ORCID APIs public, member #7025", "committedDate": "2020-06-30T07:34:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY1MA==", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r448616650", "bodyText": "One could argue that this can be done more compact with only one if and without an extra variable allocation.\nE. g. like\nif(userEndpoint != null && userEndpoint.startsWith(\"https://pub\")) {\n    this.scope = Arrays.asList(\"/authenticate\");\n} else {\n    this.scope = Arrays.asList(\"/read-limited\");\n}\nOr you leave it to the code optimizer of the JVM... \ud83d\ude09", "author": "poikilotherm", "createdAt": "2020-07-01T21:07:31Z", "path": "src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java", "diffHunk": "@@ -55,7 +55,12 @@\n     public static final String PROVIDER_ID_SANDBOX = \"orcid-sandbox\";\n     \n     public OrcidOAuth2AP(String clientId, String clientSecret, String userEndpoint) {\n-        scope = Arrays.asList(\"/read-limited\");\n+\n+        String s = null;\n+        if(userEndpoint != null){\n+            s = userEndpoint.startsWith(\"https://pub\") ? \"/authenticate\" : \"/read-limited\";\n+        }\n+        scope = Arrays.asList(s);", "originalCommit": "0bcd8711d07e82df96f5ca692ce7de463bd139de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1ODU4OQ==", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r449058589", "bodyText": "I'm fine with letting the JVM optimize it. \ud83d\ude04", "author": "pdurbin", "createdAt": "2020-07-02T14:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY1MA=="}], "type": "inlineReview", "revised_code": {"commit": "5a98e64d54b6afce65085ee27fe3de8e4446246f", "chunk": "diff --git a/src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java b/src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java\nindex 99534a84b..02177ee00 100644\n--- a/src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java\n+++ b/src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java\n\n@@ -55,12 +55,13 @@ public class OrcidOAuth2AP extends AbstractOAuth2AuthenticationProvider {\n     public static final String PROVIDER_ID_SANDBOX = \"orcid-sandbox\";\n     \n     public OrcidOAuth2AP(String clientId, String clientSecret, String userEndpoint) {\n-\n-        String s = null;\n-        if(userEndpoint != null){\n-            s = userEndpoint.startsWith(\"https://pub\") ? \"/authenticate\" : \"/read-limited\";\n+    \n+        if(userEndpoint != null && userEndpoint.startsWith(\"https://pub\")) {\n+            this.scope = Arrays.asList(\"/authenticate\");\n+        } else {\n+            this.scope = Arrays.asList(\"/read-limited\");\n         }\n-        scope = Arrays.asList(s);\n+        \n         this.clientId = clientId;\n         this.clientSecret = clientSecret;\n         this.baseUserEndpoint = userEndpoint;\n"}}, {"oid": "80630675213d65ecb73d0bac88f3cb076013e916", "url": "https://github.com/IQSS/dataverse/commit/80630675213d65ecb73d0bac88f3cb076013e916", "message": "Merge branch 'develop' into orcid-public-api", "committedDate": "2020-07-08T09:33:21Z", "type": "commit"}, {"oid": "5a98e64d54b6afce65085ee27fe3de8e4446246f", "url": "https://github.com/IQSS/dataverse/commit/5a98e64d54b6afce65085ee27fe3de8e4446246f", "message": "Refactor userEndpoint checks for Public ORCID scope. #7025", "committedDate": "2020-07-08T09:33:46Z", "type": "commit"}, {"oid": "9475838583c127584ca81a49643a4a3d16910bf8", "url": "https://github.com/IQSS/dataverse/commit/9475838583c127584ca81a49643a4a3d16910bf8", "message": "Convert ORCID OAuth2 provider test from JUnit4 to JUnit5. #7025", "committedDate": "2020-07-08T09:33:52Z", "type": "commit"}, {"oid": "d588210a497503ed0a715be04bef677bcb960f47", "url": "https://github.com/IQSS/dataverse/commit/d588210a497503ed0a715be04bef677bcb960f47", "message": "Add test case for public ORCID API endpoint to result in scope /authenticate. #7025", "committedDate": "2020-07-08T09:33:59Z", "type": "commit"}, {"oid": "298bfab79fd4201838fda87b07cf233e4b57b8c6", "url": "https://github.com/IQSS/dataverse/commit/298bfab79fd4201838fda87b07cf233e4b57b8c6", "message": "Merge pull request #2 from poikilotherm/7025-orcid-public\n\n7025 orcid public", "committedDate": "2020-07-10T10:23:04Z", "type": "commit"}]}