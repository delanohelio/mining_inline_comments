{"pr_number": 7308, "pr_title": "Increase s3 scaling", "pr_createdAt": "2020-10-07T14:02:18Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7308", "timeline": [{"oid": "c7738ec3f6080b5c31b2b92f7896ba9a3dde8e47", "url": "https://github.com/IQSS/dataverse/commit/c7738ec3f6080b5c31b2b92f7896ba9a3dde8e47", "message": "up the pool size, don't repeatedly check that bucket exists", "committedDate": "2020-10-07T14:00:50Z", "type": "commit"}, {"oid": "1fda2b5441cb46dfe0ec4872b80591b0efa878d9", "url": "https://github.com/IQSS/dataverse/commit/1fda2b5441cb46dfe0ec4872b80591b0efa878d9", "message": "configurable pool size with 256 default", "committedDate": "2020-10-07T15:38:10Z", "type": "commit"}, {"oid": "0cbf2371885b2ba4e4db40adbd003d8ab5d57124", "url": "https://github.com/IQSS/dataverse/commit/0cbf2371885b2ba4e4db40adbd003d8ab5d57124", "message": "doc update", "committedDate": "2020-10-07T16:15:17Z", "type": "commit"}, {"oid": "d6c39c49a025b787bd72a1680c7b5122acf39d7a", "url": "https://github.com/IQSS/dataverse/commit/d6c39c49a025b787bd72a1680c7b5122acf39d7a", "message": "add release note for new JVM option", "committedDate": "2020-10-07T16:22:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1NzIyNA==", "url": "https://github.com/IQSS/dataverse/pull/7308#discussion_r501157224", "bodyText": "this can be simplified a little:\npublic static Integer getInteger(String nm, int val) where val is the default (so no null check needed)", "author": "scolapasta", "createdAt": "2020-10-07T16:41:01Z", "path": "src/main/java/edu/harvard/iq/dataverse/dataaccess/S3AccessIO.java", "diffHunk": "@@ -1043,6 +1043,14 @@ private static AmazonS3 getClient(String driverId) {\n     \t\t// get a standard client, using the standard way of configuration the credentials, etc.\n     \t\tAmazonS3ClientBuilder s3CB = AmazonS3ClientBuilder.standard();\n \n+    \t\tClientConfiguration cc = new ClientConfiguration();\n+    \t\tInteger poolSize = Integer.getInteger(\"dataverse.files.\" + driverId + \".connection-pool-size\");", "originalCommit": "d6c39c49a025b787bd72a1680c7b5122acf39d7a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd5172e1b18622cc62deb4bceac183718b9aaa29", "chunk": "diff --git a/src/main/java/edu/harvard/iq/dataverse/dataaccess/S3AccessIO.java b/src/main/java/edu/harvard/iq/dataverse/dataaccess/S3AccessIO.java\nindex a7c256192..5de59524a 100644\n--- a/src/main/java/edu/harvard/iq/dataverse/dataaccess/S3AccessIO.java\n+++ b/src/main/java/edu/harvard/iq/dataverse/dataaccess/S3AccessIO.java\n\n@@ -1044,10 +1044,7 @@ public class S3AccessIO<T extends DvObject> extends StorageIO<T> {\n     \t\tAmazonS3ClientBuilder s3CB = AmazonS3ClientBuilder.standard();\n \n     \t\tClientConfiguration cc = new ClientConfiguration();\n-    \t\tInteger poolSize = Integer.getInteger(\"dataverse.files.\" + driverId + \".connection-pool-size\");\n-    \t\tif(poolSize==null) {\n-    \t\t    poolSize = 256;\n-    \t\t}\n+    \t\tInteger poolSize = Integer.getInteger(\"dataverse.files.\" + driverId + \".connection-pool-size\", 256);\n     \t\tcc.setMaxConnections(poolSize);\n     \t\ts3CB.setClientConfiguration(cc);\n     \t\t\n"}}, {"oid": "fd5172e1b18622cc62deb4bceac183718b9aaa29", "url": "https://github.com/IQSS/dataverse/commit/fd5172e1b18622cc62deb4bceac183718b9aaa29", "message": "simplify per review", "committedDate": "2020-10-07T16:50:52Z", "type": "commit"}]}