{"pr_number": 2367, "pr_title": "Add clear buttons to all questions with radio buttons", "pr_createdAt": "2020-10-05T11:24:22Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2367", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM3NDkxNw==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r502374917", "bodyText": "Few design suggestions here -\n\nThis should move to ClearableWidget so that we localize the logic related to clear button in ClearableWidget\nAn alternative approach to this would be to define a method showClearButton in ClearableWidget and only add the button if it evals to true. This way we avoid adding the clear button at all for widgets implementing ClearableWidget but not wanting to show the button.\nA even better approach would be to use composition instead of Inheritance here for ClearableWidget especially since not all subclasses of ClearableWidget ends up showing Clear button in this design.", "author": "shubham1g5", "createdAt": "2020-10-09T11:53:09Z", "path": "app/src/org/commcare/views/widgets/LabelWidget.java", "diffHunk": "@@ -168,6 +177,14 @@ public LabelWidget(Context context, FormEntryPrompt prompt) {\n         addView(questionLayout);\n     }\n \n+    /**\n+     * LabelWidget is used for both ListWidget and ListMultiWidget, and we don't show the clear\n+     * button in ListMultiWidget. So this method allows removal of clear button.\n+     */\n+    public void removeClearButton() {", "originalCommit": "f1d1bb3a1446c1a1427900be79998f7f8f19c909", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkyMDk5MQ==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r502920991", "bodyText": "Gotcha, Composition sounds better than inheritance.", "author": "ShivamPokhriyal", "createdAt": "2020-10-11T14:14:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM3NDkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5MDA0OQ==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r503790049", "bodyText": "I have a question here, this removeClearButton method is required because LabelWidget is used in combination with ListWidget and ListMultiWidget and we want the clear button only in 1 combination(with ListWidget).\nSo whatever suggestion I end up using with, I still need this method here I guess.", "author": "ShivamPokhriyal", "createdAt": "2020-10-13T09:07:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM3NDkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5OTk0OQ==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r503799949", "bodyText": "You can inverse the check by introducing another method like shouldShowClearButton and have the ClearableWidget like -\nif(shouldShowClearButton()){\n// add clear button\n}\n\nThe difference is just that we are doing a check while adding the clear button instead of adding and then removing the clear button", "author": "shubham1g5", "createdAt": "2020-10-13T09:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM3NDkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwMjA1OA==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r503802058", "bodyText": "Ok, I'll offline regarding this.", "author": "ShivamPokhriyal", "createdAt": "2020-10-13T09:25:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM3NDkxNw=="}], "type": "inlineReview", "revised_code": {"commit": "35053029264770a9438b8af554f14388b1c972bf", "chunk": "diff --git a/app/src/org/commcare/views/widgets/LabelWidget.java b/app/src/org/commcare/views/widgets/LabelWidget.java\nindex e4b875c61..8236f1d72 100644\n--- a/app/src/org/commcare/views/widgets/LabelWidget.java\n+++ b/app/src/org/commcare/views/widgets/LabelWidget.java\n\n@@ -177,14 +176,6 @@ public class LabelWidget extends ClearableWidget {\n         addView(questionLayout);\n     }\n \n-    /**\n-     * LabelWidget is used for both ListWidget and ListMultiWidget, and we don't show the clear\n-     * button in ListMultiWidget. So this method allows removal of clear button.\n-     */\n-    public void removeClearButton() {\n-        clearButton.setVisibility(GONE);\n-    }\n-\n     @Override\n     public void clearAnswer() {\n         // Do nothing, no answers to clear\n"}}, {"oid": "35053029264770a9438b8af554f14388b1c972bf", "url": "https://github.com/dimagi/commcare-android/commit/35053029264770a9438b8af554f14388b1c972bf", "message": "Add clear buttons to all questions with radio buttos", "committedDate": "2020-10-19T04:57:34Z", "type": "commit"}, {"oid": "9e3fce46735944d297303394c25725841f55f7cf", "url": "https://github.com/dimagi/commcare-android/commit/9e3fce46735944d297303394c25725841f55f7cf", "message": "Remove clear button when multi-select list is used", "committedDate": "2020-10-19T04:57:34Z", "type": "commit"}, {"oid": "03c6b503be5f754edc21ebdea79fc726a1f7ef3d", "url": "https://github.com/dimagi/commcare-android/commit/03c6b503be5f754edc21ebdea79fc726a1f7ef3d", "message": "PR suggestion", "committedDate": "2020-10-19T04:57:34Z", "type": "commit"}, {"oid": "205f4bb15881cee85c4d79bd18ca8700982e32a3", "url": "https://github.com/dimagi/commcare-android/commit/205f4bb15881cee85c4d79bd18ca8700982e32a3", "message": "Remove clear button from list widget", "committedDate": "2020-10-19T04:57:34Z", "type": "commit"}, {"oid": "205f4bb15881cee85c4d79bd18ca8700982e32a3", "url": "https://github.com/dimagi/commcare-android/commit/205f4bb15881cee85c4d79bd18ca8700982e32a3", "message": "Remove clear button from list widget", "committedDate": "2020-10-19T04:57:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYyMTAzOQ==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r512621039", "bodyText": "@ShivamPokhriyal The way we are using it now, it makes more sense for this to be simply a static utilitiy method rather than a member of the Widget Classes. Thoughts ?", "author": "shubham1g5", "createdAt": "2020-10-27T11:42:40Z", "path": "app/src/org/commcare/views/widgets/ClearableWidget.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package org.commcare.views.widgets;\n+\n+import android.content.Context;\n+import android.view.LayoutInflater;\n+import android.widget.Button;\n+\n+import org.commcare.dalvik.R;\n+import org.javarosa.form.api.FormEntryPrompt;\n+\n+/**\n+ * A utility for all the widgets that want to show a clear button.\n+ * This class will provide the code for creation of clearButton using {@link ClearableWidget#setupClearButton(Context, String)}.\n+ * Subclasses will need to add the button to the view by themselves.\n+ *\n+ * See {@link SelectOneWidget} for example.\n+ * @author $|-|!\u02c5@M\n+ */\n+public abstract class ClearableWidget extends QuestionWidget {\n+\n+    protected Button clearButton;\n+\n+    public ClearableWidget(Context context, FormEntryPrompt p) {\n+        super(context, p);\n+    }\n+\n+    public ClearableWidget(Context context, FormEntryPrompt p, boolean inCompactGroup) {\n+        super(context, p, inCompactGroup);\n+    }\n+\n+    protected void setupClearButton(Context context, String text, int visibility) {", "originalCommit": "205f4bb15881cee85c4d79bd18ca8700982e32a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYyODM5OQ==", "url": "https://github.com/dimagi/commcare-android/pull/2367#discussion_r512628399", "bodyText": "Yeah, I'm not really sure if this subclassing is doing any good here, since the actual addition is happening inside the view only.", "author": "ShivamPokhriyal", "createdAt": "2020-10-27T11:50:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYyMTAzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "d9f5d5c81973484a9ade3e65021cd07c9bfc5b32", "chunk": "diff --git a/app/src/org/commcare/views/widgets/ClearableWidget.java b/app/src/org/commcare/views/widgets/ClearableWidget.java\ndeleted file mode 100644\nindex 1712e014e..000000000\n--- a/app/src/org/commcare/views/widgets/ClearableWidget.java\n+++ /dev/null\n\n@@ -1,39 +0,0 @@\n-package org.commcare.views.widgets;\n-\n-import android.content.Context;\n-import android.view.LayoutInflater;\n-import android.widget.Button;\n-\n-import org.commcare.dalvik.R;\n-import org.javarosa.form.api.FormEntryPrompt;\n-\n-/**\n- * A utility for all the widgets that want to show a clear button.\n- * This class will provide the code for creation of clearButton using {@link ClearableWidget#setupClearButton(Context, String)}.\n- * Subclasses will need to add the button to the view by themselves.\n- *\n- * See {@link SelectOneWidget} for example.\n- * @author $|-|!\u02c5@M\n- */\n-public abstract class ClearableWidget extends QuestionWidget {\n-\n-    protected Button clearButton;\n-\n-    public ClearableWidget(Context context, FormEntryPrompt p) {\n-        super(context, p);\n-    }\n-\n-    public ClearableWidget(Context context, FormEntryPrompt p, boolean inCompactGroup) {\n-        super(context, p, inCompactGroup);\n-    }\n-\n-    protected void setupClearButton(Context context, String text, int visibility) {\n-        clearButton = (Button) LayoutInflater.from(context).inflate(R.layout.blue_outlined_button, this, false);\n-        clearButton.setText(text);\n-        clearButton.setVisibility(visibility);\n-        clearButton.setOnClickListener(view -> {\n-            clearAnswer();\n-            widgetEntryChanged();\n-        });\n-    }\n-}\n"}}, {"oid": "d9f5d5c81973484a9ade3e65021cd07c9bfc5b32", "url": "https://github.com/dimagi/commcare-android/commit/d9f5d5c81973484a9ade3e65021cd07c9bfc5b32", "message": "Set clear button using static utility", "committedDate": "2020-10-28T07:06:54Z", "type": "commit"}, {"oid": "946163a4049a4629aa6d13278035cfeef3ca010c", "url": "https://github.com/dimagi/commcare-android/commit/946163a4049a4629aa6d13278035cfeef3ca010c", "message": "Merge branch 'master' into add-clear-button", "committedDate": "2020-10-28T08:16:56Z", "type": "commit"}]}