{"pr_number": 1515, "pr_title": "change JSONObject type and rename \"event\" to \"events\"", "pr_createdAt": "2020-12-15T10:34:19Z", "pr_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzMDE0OQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543230149", "bodyText": "Lets add a constant for this", "author": "mefarazath", "createdAt": "2020-12-15T10:35:55Z", "path": "components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java", "diffHunk": "@@ -161,15 +161,15 @@ private JWTClaimsSet buildJwtToken(OIDCSessionState sessionState, String tenantD\n         long currentTimeInMillis = Calendar.getInstance().getTimeInMillis();\n         Date iat = new Date(currentTimeInMillis);\n         String sid = getSidClaim(sessionState);\n-        JSONObject event = new JSONObject().put(\"http://schemas.openidnet/event/backchannel-logout\",\n+        JSONObject event = new JSONObject().appendField(\"http://schemas.openidnet/event/backchannel-logout\",", "originalCommit": "47f189d30b428cd26bfe07b64421168927ce50f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MDMzMQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543250331", "bodyText": "Fixed in - 09e790c, 667595f", "author": "ThaminduR", "createdAt": "2020-12-15T11:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzMDE0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "02726ff43ec62d4704b470154ede78b62864df87", "chunk": "diff --git a/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java b/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\nindex 8767a00ff..653da7c00 100644\n--- a/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\n+++ b/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\n\n@@ -161,7 +162,7 @@ public class DefaultLogoutTokenBuilder implements LogoutTokenBuilder {\n         long currentTimeInMillis = Calendar.getInstance().getTimeInMillis();\n         Date iat = new Date(currentTimeInMillis);\n         String sid = getSidClaim(sessionState);\n-        JSONObject event = new JSONObject().appendField(\"http://schemas.openidnet/event/backchannel-logout\",\n+        JSONObject event = new JSONObject().appendField(BACKCHANNEL_LOGOUT_EVENT,\n                 new JSONObject());\n \n         JWTClaimsSet.Builder jwtClaimsSetBuilder = new JWTClaimsSet.Builder();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzMTExMQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543231111", "bodyText": "@piraveena was the previous behaviour wrong according the spec?", "author": "mefarazath", "createdAt": "2020-12-15T10:37:18Z", "path": "components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java", "diffHunk": "@@ -161,15 +161,15 @@ private JWTClaimsSet buildJwtToken(OIDCSessionState sessionState, String tenantD\n         long currentTimeInMillis = Calendar.getInstance().getTimeInMillis();\n         Date iat = new Date(currentTimeInMillis);\n         String sid = getSidClaim(sessionState);\n-        JSONObject event = new JSONObject().put(\"http://schemas.openidnet/event/backchannel-logout\",\n+        JSONObject event = new JSONObject().appendField(\"http://schemas.openidnet/event/backchannel-logout\",\n                 new JSONObject());\n \n         JWTClaimsSet.Builder jwtClaimsSetBuilder = new JWTClaimsSet.Builder();\n         jwtClaimsSetBuilder.subject(sub);\n         jwtClaimsSetBuilder.issuer(iss);\n         jwtClaimsSetBuilder.audience(audience);\n         jwtClaimsSetBuilder.claim(\"jti\", jti);\n-        jwtClaimsSetBuilder.claim(\"event\", event);\n+        jwtClaimsSetBuilder.claim(\"events\", event);", "originalCommit": "47f189d30b428cd26bfe07b64421168927ce50f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzMzQxNw==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543233417", "bodyText": "previously we had it as event. But spec says it should be events", "author": "piraveena", "createdAt": "2020-12-15T10:40:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzMTExMQ=="}], "type": "inlineReview", "revised_code": {"commit": "02726ff43ec62d4704b470154ede78b62864df87", "chunk": "diff --git a/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java b/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\nindex 8767a00ff..653da7c00 100644\n--- a/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\n+++ b/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\n\n@@ -161,7 +162,7 @@ public class DefaultLogoutTokenBuilder implements LogoutTokenBuilder {\n         long currentTimeInMillis = Calendar.getInstance().getTimeInMillis();\n         Date iat = new Date(currentTimeInMillis);\n         String sid = getSidClaim(sessionState);\n-        JSONObject event = new JSONObject().appendField(\"http://schemas.openidnet/event/backchannel-logout\",\n+        JSONObject event = new JSONObject().appendField(BACKCHANNEL_LOGOUT_EVENT,\n                 new JSONObject());\n \n         JWTClaimsSet.Builder jwtClaimsSetBuilder = new JWTClaimsSet.Builder();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MDQ3Ng==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543250476", "bodyText": "change it to private", "author": "piraveena", "createdAt": "2020-12-15T11:06:04Z", "path": "components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java", "diffHunk": "@@ -72,6 +72,7 @@\n     private static final String OPENID_IDP_ENTITY_ID = \"IdPEntityId\";\n     private static final String ERROR_GET_RESIDENT_IDP =\n             \"Error while getting Resident Identity Provider of '%s' tenant.\";\n+    public static final String BACKCHANNEL_LOGOUT_EVENT = \"http://schemas.openidnet/event/backchannel-logout\";", "originalCommit": "09e790c015d97acdf73780ab3a4af4e027c70a78", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MTg3NQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543251875", "bodyText": "Fixed in - 1850ef6", "author": "ThaminduR", "createdAt": "2020-12-15T11:08:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MDQ3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "02726ff43ec62d4704b470154ede78b62864df87", "chunk": "diff --git a/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java b/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\nindex ea0187ef8..653da7c00 100644\n--- a/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\n+++ b/components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java\n\n@@ -72,7 +72,7 @@ public class DefaultLogoutTokenBuilder implements LogoutTokenBuilder {\n     private static final String OPENID_IDP_ENTITY_ID = \"IdPEntityId\";\n     private static final String ERROR_GET_RESIDENT_IDP =\n             \"Error while getting Resident Identity Provider of '%s' tenant.\";\n-    public static final String BACKCHANNEL_LOGOUT_EVENT = \"http://schemas.openidnet/event/backchannel-logout\";\n+    private static final String BACKCHANNEL_LOGOUT_EVENT = \"http://schemas.openidnet/event/backchannel-logout\";\n \n     public DefaultLogoutTokenBuilder() throws IdentityOAuth2Exception {\n \n"}}, {"oid": "02726ff43ec62d4704b470154ede78b62864df87", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/02726ff43ec62d4704b470154ede78b62864df87", "message": "Change JSONObject type, Rename \"event\" claim to \"events\"", "committedDate": "2020-12-15T12:39:49Z", "type": "commit"}, {"oid": "02726ff43ec62d4704b470154ede78b62864df87", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/02726ff43ec62d4704b470154ede78b62864df87", "message": "Change JSONObject type, Rename \"event\" claim to \"events\"", "committedDate": "2020-12-15T12:39:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyMDg0NA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543620844", "bodyText": "Won't we need this same constant during logout token validation?", "author": "mefarazath", "createdAt": "2020-12-15T19:20:00Z", "path": "components/org.wso2.carbon.identity.oidc.session/src/main/java/org/wso2/carbon/identity/oidc/session/backchannellogout/DefaultLogoutTokenBuilder.java", "diffHunk": "@@ -72,6 +72,7 @@\n     private static final String OPENID_IDP_ENTITY_ID = \"IdPEntityId\";\n     private static final String ERROR_GET_RESIDENT_IDP =\n             \"Error while getting Resident Identity Provider of '%s' tenant.\";\n+    private static final String BACKCHANNEL_LOGOUT_EVENT = \"http://schemas.openidnet/event/backchannel-logout\";", "originalCommit": "02726ff43ec62d4704b470154ede78b62864df87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzg5NTU2NQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r543895565", "bodyText": "we need. But it should go in the outbound component.", "author": "piraveena", "createdAt": "2020-12-16T03:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyMDg0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDAwNjQ3Mg==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1515#discussion_r544006472", "bodyText": "Cool. Then we are good", "author": "mefarazath", "createdAt": "2020-12-16T06:07:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyMDg0NA=="}], "type": "inlineReview", "revised_code": null}]}