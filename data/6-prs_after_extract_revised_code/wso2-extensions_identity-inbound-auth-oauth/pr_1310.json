{"pr_number": 1310, "pr_title": "Fix device flow queries for MySQL", "pr_createdAt": "2020-02-03T22:25:31Z", "pr_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1310", "timeline": [{"oid": "4dc1fe75054753271ec565e0934a9bd82c41ad29", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/4dc1fe75054753271ec565e0934a9bd82c41ad29", "message": "Fix device flow queries for MySQL\n\nAdding an alias to the derived table as it's mandatory in MySQL for every derived table.", "committedDate": "2020-02-03T22:23:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzMTU3OA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1310#discussion_r374431578", "bodyText": "AS keyword is not supported in some places in Oracle DB. This seems to be such a place.", "author": "madurangasiriwardena", "createdAt": "2020-02-04T01:23:51Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/device/dao/SQLQueries.java", "diffHunk": "@@ -46,7 +46,7 @@ private SQLQueries() {\n \n         public static final String GET_CONSUMER_KEY_FOR_DEVICE_CODE = \"SELECT CONSUMER_KEY FROM (SELECT * \" +\n                 \"FROM IDN_OAUTH_CONSUMER_APPS INNER JOIN IDN_OAUTH2_DEVICE_FLOW ON IDN_OAUTH_CONSUMER_APPS.ID = \" +\n-                \"IDN_OAUTH2_DEVICE_FLOW.CONSUMER_KEY_ID) WHERE DEVICE_CODE = ?\";\n+                \"IDN_OAUTH2_DEVICE_FLOW.CONSUMER_KEY_ID) AS CONSUMER_APPS_WITH_DEVICE_FLOW WHERE DEVICE_CODE = ?\";", "originalCommit": "4dc1fe75054753271ec565e0934a9bd82c41ad29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MTgwOA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1310#discussion_r374451808", "bodyText": "Yes, we don't want to put AS keyword in front of derived table CONSUMER_APPS_WITH_DEVICE_FLOW. AS keyword is not a mandatory keyword in SQL queries. it's an optional we can skip because DBs like Oracles doesn't support AS keyword.\n               \"IDN_OAUTH2_DEVICE_FLOW.CONSUMER_KEY_ID) CONSUMER_APPS_WITH_DEVICE_FLOW WHERE DEVICE_CODE = ?\"; this will be fine\nyou can refer to   GET_IDN_OIDC_SCOPES_CLAIMS query..", "author": "sarubi", "createdAt": "2020-02-04T02:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzMTU3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ5OTY0MA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1310#discussion_r374499640", "bodyText": "@madurangasiriwardena @sarubi Thank guys! You probably saved me from an additional testing round. Please find the needful fix in 5596967.", "author": "tharindu-bandara", "createdAt": "2020-02-04T06:52:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzMTU3OA=="}], "type": "inlineReview", "revised_code": {"commit": "5596967e09377e503dad4f94e0b674f221be4a85", "chunk": "diff --git a/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/device/dao/SQLQueries.java b/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/device/dao/SQLQueries.java\nindex 15f36bc39..b8e4346a5 100644\n--- a/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/device/dao/SQLQueries.java\n+++ b/components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/device/dao/SQLQueries.java\n\n@@ -46,7 +46,7 @@ public class SQLQueries {\n \n         public static final String GET_CONSUMER_KEY_FOR_DEVICE_CODE = \"SELECT CONSUMER_KEY FROM (SELECT * \" +\n                 \"FROM IDN_OAUTH_CONSUMER_APPS INNER JOIN IDN_OAUTH2_DEVICE_FLOW ON IDN_OAUTH_CONSUMER_APPS.ID = \" +\n-                \"IDN_OAUTH2_DEVICE_FLOW.CONSUMER_KEY_ID) AS CONSUMER_APPS_WITH_DEVICE_FLOW WHERE DEVICE_CODE = ?\";\n+                \"IDN_OAUTH2_DEVICE_FLOW.CONSUMER_KEY_ID) CONSUMER_APPS_WITH_DEVICE_FLOW WHERE DEVICE_CODE = ?\";\n \n         public static final String GET_AUTHENTICATION_STATUS = \"SELECT IDN_OAUTH2_DEVICE_FLOW.STATUS, \" +\n                 \"IDN_OAUTH2_DEVICE_FLOW.LAST_POLL_TIME, IDN_OAUTH2_DEVICE_FLOW.POLL_TIME, \" +\n"}}, {"oid": "5596967e09377e503dad4f94e0b674f221be4a85", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/5596967e09377e503dad4f94e0b674f221be4a85", "message": "Remove optional 'AS' keyword to support Oracle DB", "committedDate": "2020-02-04T06:50:55Z", "type": "commit"}]}