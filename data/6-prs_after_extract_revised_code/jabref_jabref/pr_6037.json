{"pr_number": 6037, "pr_title": "Implement Emacs key bindings", "pr_createdAt": "2020-02-27T17:38:50Z", "pr_url": "https://github.com/JabRef/jabref/pull/6037", "timeline": [{"oid": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "url": "https://github.com/JabRef/jabref/commit/1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "message": "[feat] Implement Emacs key bindings\n\nEmacs style key bindings are re-added to JabRef through the preferences\nmenu. The supported key bindings have feature parity with the previous\nimplementation in JabRef v<4, and additionally support any class that\nextends TextInputControl. In practice, this means that the new\nimplementation supports both TextFields and TextAreas by default. Some\nfunctionality may still be missing\n\nCo-authored-by: Felix Luthman <34520175+felixlut@users.noreply.github.com>\nCo-authored-by: Tommy Samuelsson <Zodbigt@users.noreply.github.com>\nCo-authored-by: muachilin <32566798+muachilin@users.noreply.github.com>\nCo-authored-by: Kristoffer Gunnarsson <kristoffergunnarsson47@gmail.com>", "committedDate": "2020-02-27T17:30:02Z", "type": "commit"}, {"oid": "6f12069dc5483afb7e1b441280ca550fd5dd4a49", "url": "https://github.com/JabRef/jabref/commit/6f12069dc5483afb7e1b441280ca550fd5dd4a49", "message": "Merge branch 'master' into emacs", "committedDate": "2020-02-27T17:40:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MDczMw==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385270733", "bodyText": "Either you use the lamdba with keyBindinding.ifPresent(keybinding->...) or you extract the keyBinding.get() to a variable in the first if and reuse that. Less code duplication.\nAnd second, you are comparing enum values, they can be compared with == no need for equals\nAnd here is an explanation why: https://stackoverflow.com/a/2937561", "author": "Siedlerchr", "createdAt": "2020-02-27T17:48:47Z", "path": "src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java", "diffHunk": "@@ -0,0 +1,103 @@\n+package org.jabref.gui.keyboard;\n+\n+import java.util.Optional;\n+\n+import javafx.scene.Scene;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.KeyEvent;\n+\n+import org.jabref.Globals;\n+import org.jabref.logic.util.strings.EmacsStringManipulator;\n+import org.jabref.model.util.ResultingEmacsState;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+public class EmacsKeyBindings {\n+\n+    public static void executeEmacs(Scene scene, KeyEvent event) {\n+        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+        if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n+            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n+            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n+            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n+            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+\n+            KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n+            TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n+            Optional<KeyBinding> keyBinding = keyBindingRepository.mapToKeyBinding(event);\n+            if (keyBinding.isPresent()) {", "originalCommit": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\nindex 26f569cb7..3569f8488 100755\n--- a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n+++ b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n\n@@ -6,20 +6,20 @@ import javafx.scene.Scene;\n import javafx.scene.control.TextInputControl;\n import javafx.scene.input.KeyEvent;\n \n-import org.jabref.Globals;\n+import org.jabref.gui.Globals;\n import org.jabref.logic.util.strings.EmacsStringManipulator;\n import org.jabref.model.util.ResultingEmacsState;\n-import org.jabref.preferences.JabRefPreferences;\n+import org.jabref.preferences.PreferencesService;\n \n public class EmacsKeyBindings {\n \n-    public static void executeEmacs(Scene scene, KeyEvent event) {\n-        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+    public static void executeEmacs(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n+        boolean EmacsFlag = preferencesService.getEmacsKeyPreferences().useEmacsKeyBindings();\n         if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n-            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n-            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n-            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n-            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+            boolean CAFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCA();\n+            boolean CFFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCF();\n+            boolean CNFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCN();\n+            boolean AUFlag = preferencesService.getEmacsKeyPreferences().shouldRebindAU();\n \n             KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n             TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MTkyOA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385271928", "bodyText": "As you are using the \\\\w regex here multiple times it makes sense to compile it and use Pattern.compile(...) with a matcher then.", "author": "Siedlerchr", "createdAt": "2020-02-27T17:50:54Z", "path": "src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java", "diffHunk": "@@ -0,0 +1,178 @@\n+package org.jabref.logic.util.strings;\n+import org.jabref.model.util.ResultingEmacsState;\n+\n+public class EmacsStringManipulator {\n+    private enum LetterCase {\n+        UPPER,\n+        LOWER,\n+        CAPITALIZED\n+    }\n+\n+    private enum Direction {\n+        NEXT, PREVIOUS\n+    }\n+\n+    private static ResultingEmacsState setNextWordsCase(String text, int pos, LetterCase targetCase) {\n+        StringBuilder res = new StringBuilder();\n+\n+        boolean firstLetter = true;\n+        int i = pos;\n+        boolean firstLoop = true;\n+        StringBuilder newWordBuilder = new StringBuilder();\n+        for (; i < text.length(); i++) {\n+            // Swallow whitespace\n+            while (firstLoop && i < text.length() && !String.valueOf(text.charAt(i)).matches(\"\\\\w\")) {", "originalCommit": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88c16b61e7baf5d40ea9163eec6677c02b71f6cc", "chunk": "diff --git a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\nindex 4f2c72a97..2dec6823b 100644\n--- a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n+++ b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n\n@@ -67,7 +67,7 @@ public class EmacsStringManipulator {\n      * @param pos The index to start from.\n      * @param text The text to manipulate.\n      * @param dir The direction to search.\n-     * @return The resulting text.\n+     * @return The resulting text and caret position.\n      */\n     public static ResultingEmacsState deleteUntilWordBoundary(int pos, String text, Direction dir) {\n         StringBuilder res = new StringBuilder();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MjYzNw==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385272637", "bodyText": "Is there a good reason why you made all those methods static?\nStatic methods are usually hard to test", "author": "Siedlerchr", "createdAt": "2020-02-27T17:52:13Z", "path": "src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java", "diffHunk": "@@ -0,0 +1,178 @@\n+package org.jabref.logic.util.strings;\n+import org.jabref.model.util.ResultingEmacsState;\n+\n+public class EmacsStringManipulator {\n+    private enum LetterCase {\n+        UPPER,\n+        LOWER,\n+        CAPITALIZED\n+    }\n+\n+    private enum Direction {\n+        NEXT, PREVIOUS\n+    }\n+\n+    private static ResultingEmacsState setNextWordsCase(String text, int pos, LetterCase targetCase) {\n+        StringBuilder res = new StringBuilder();\n+\n+        boolean firstLetter = true;\n+        int i = pos;\n+        boolean firstLoop = true;\n+        StringBuilder newWordBuilder = new StringBuilder();\n+        for (; i < text.length(); i++) {\n+            // Swallow whitespace\n+            while (firstLoop && i < text.length() && !String.valueOf(text.charAt(i)).matches(\"\\\\w\")) {\n+                newWordBuilder.append(text.charAt(i));\n+                i++;\n+            }\n+            if (i >= text.length()) {\n+                break;\n+            }\n+            if (firstLoop) {\n+                firstLoop = false;\n+            }\n+            char currentChar = text.charAt(i);\n+            if (String.valueOf(currentChar).matches(\"\\\\w\")) {\n+                switch (targetCase) {\n+                    case UPPER:\n+                        newWordBuilder.append(Character.toUpperCase(currentChar));\n+                        break;\n+                    case LOWER:\n+                        newWordBuilder.append(Character.toLowerCase(currentChar));\n+                        break;\n+                    case CAPITALIZED:\n+                        if (firstLetter) {\n+                            newWordBuilder.append(Character.toUpperCase(currentChar));\n+                            firstLetter = false;\n+                        } else {\n+                            newWordBuilder.append(Character.toLowerCase(currentChar));\n+                        }\n+                        break;\n+                }\n+            } else {\n+                // We have reached the word boundary.\n+                break;\n+            }\n+        }\n+        res.append(text, 0, pos);\n+        res.append(newWordBuilder);\n+        res.append(text, i, text.length());\n+\n+        return new ResultingEmacsState(i, res.toString());\n+    }\n+\n+    /**\n+     * Delete all characters in a string from the given position to the next word boundary.\n+     *\n+     * @param pos The index to start from.\n+     * @param text The text to manipulate.\n+     * @param dir The direction to search.\n+     * @return The resulting text.\n+     */\n+    public static ResultingEmacsState deleteUntilWordBoundary(int pos, String text, Direction dir) {\n+        StringBuilder res = new StringBuilder();\n+        int offset;\n+        int wordBreak;\n+        switch (dir) {\n+            case NEXT:\n+                res.append(text, 0, pos);\n+                offset = 1;\n+                wordBreak = text.length();\n+                break;\n+            case PREVIOUS:\n+                res.append(text, pos, text.length());\n+                offset = -1;\n+                wordBreak = 0;\n+                break;\n+            default:\n+                throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n+        }\n+\n+        for (int i = pos; i < text.length() && i >= 0; i += offset) {\n+            if (i == pos) {\n+                // Swallow whitespace until we hit a word character or newline.\n+                while (i < text.length()\n+                        && i >= 0\n+                        && !String.valueOf(text.charAt(i)).matches(\"\\\\w|[\\\\r\\\\n]\")) {\n+                    i += offset;\n+                }\n+            }\n+            if (!(i < text.length() && i >= 0) || !String.valueOf(text.charAt(i)).matches(\"\\\\w\")) {\n+                wordBreak = i;\n+                break;\n+            }\n+        }\n+        int caretPosition;\n+        if (dir == Direction.NEXT) {\n+            res.append(text, wordBreak, text.length());\n+            // Since we deleted forward, we're in the right place already.\n+            caretPosition = pos;\n+\n+        } else {\n+            // Since we deleted backwards, we need to move the caret appropriately.\n+            // We need to protect against having stepped beyond the string during the while-loop.\n+            if (wordBreak != -1) {\n+                res.append(text, 0, wordBreak);\n+                caretPosition = wordBreak;\n+            } else {\n+                caretPosition = 0;\n+            }\n+        }\n+        return new ResultingEmacsState(caretPosition, res.toString());\n+    }\n+\n+    /**\n+     * Capitalize the next word on the right side of the cursor.\n+     *\n+     * @param pos the position of the cursor\n+     * @param text String to analyze\n+     * @return String the result text\n+     */\n+    public static ResultingEmacsState capitalize(int pos, String text) {", "originalCommit": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88c16b61e7baf5d40ea9163eec6677c02b71f6cc", "chunk": "diff --git a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\nindex 4f2c72a97..2dec6823b 100644\n--- a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n+++ b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n\n@@ -67,7 +67,7 @@ public class EmacsStringManipulator {\n      * @param pos The index to start from.\n      * @param text The text to manipulate.\n      * @param dir The direction to search.\n-     * @return The resulting text.\n+     * @return The resulting text and caret position.\n      */\n     public static ResultingEmacsState deleteUntilWordBoundary(int pos, String text, Direction dir) {\n         StringBuilder res = new StringBuilder();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MzAwMQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385273001", "bodyText": "Too many empty lines here. Checkstyle will complain. No more than one empty line", "author": "Siedlerchr", "createdAt": "2020-02-27T17:52:51Z", "path": "src/main/java/org/jabref/model/util/ResultingEmacsState.java", "diffHunk": "@@ -0,0 +1,12 @@\n+package org.jabref.model.util;\n+\n+public class ResultingEmacsState {\n+    public final int caretPos;\n+    public final String text;\n+\n+", "originalCommit": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88c16b61e7baf5d40ea9163eec6677c02b71f6cc", "chunk": "diff --git a/src/main/java/org/jabref/model/util/ResultingEmacsState.java b/src/main/java/org/jabref/model/util/ResultingEmacsState.java\nindex b65acf6d2..842a9b218 100644\n--- a/src/main/java/org/jabref/model/util/ResultingEmacsState.java\n+++ b/src/main/java/org/jabref/model/util/ResultingEmacsState.java\n\n@@ -4,7 +4,6 @@ public class ResultingEmacsState {\n     public final int caretPos;\n     public final String text;\n \n-\n     public ResultingEmacsState(int pos, String text) {\n         this.caretPos = pos;\n         this.text = text;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3NDg4NQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385274885", "bodyText": "As mentionend earlier, I see no reason why this methods are static", "author": "Siedlerchr", "createdAt": "2020-02-27T17:56:25Z", "path": "src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java", "diffHunk": "@@ -0,0 +1,178 @@\n+package org.jabref.logic.util.strings;\n+import org.jabref.model.util.ResultingEmacsState;\n+\n+public class EmacsStringManipulator {\n+    private enum LetterCase {\n+        UPPER,\n+        LOWER,\n+        CAPITALIZED\n+    }\n+\n+    private enum Direction {\n+        NEXT, PREVIOUS\n+    }\n+\n+    private static ResultingEmacsState setNextWordsCase(String text, int pos, LetterCase targetCase) {", "originalCommit": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88c16b61e7baf5d40ea9163eec6677c02b71f6cc", "chunk": "diff --git a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\nindex 4f2c72a97..2dec6823b 100644\n--- a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n+++ b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n\n@@ -67,7 +67,7 @@ public class EmacsStringManipulator {\n      * @param pos The index to start from.\n      * @param text The text to manipulate.\n      * @param dir The direction to search.\n-     * @return The resulting text.\n+     * @return The resulting text and caret position.\n      */\n     public static ResultingEmacsState deleteUntilWordBoundary(int pos, String text, Direction dir) {\n         StringBuilder res = new StringBuilder();\n"}}, {"oid": "88c16b61e7baf5d40ea9163eec6677c02b71f6cc", "url": "https://github.com/JabRef/jabref/commit/88c16b61e7baf5d40ea9163eec6677c02b71f6cc", "message": "Rename localized strings and fix checkstyle error", "committedDate": "2020-02-27T20:01:25Z", "type": "commit"}, {"oid": "0c2f4b23fc9d42f3228923c330378e106da3462e", "url": "https://github.com/JabRef/jabref/commit/0c2f4b23fc9d42f3228923c330378e106da3462e", "message": "Merge branch 'emacs' of github.com:stevensdavid/jabref into emacs", "committedDate": "2020-02-27T20:02:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1Mzk5OQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385353999", "bodyText": "Please add a space after //", "author": "koppor", "createdAt": "2020-02-27T20:29:07Z", "path": "src/main/java/org/jabref/JabRefGUI.java", "diffHunk": "@@ -87,6 +89,12 @@ private void openWindow(Stage mainStage) {\n         root.getChildren().add(JabRefGUI.mainFrame);\n \n         Scene scene = new Scene(root, 800, 800);\n+\n+        //Handle Emacs key bindings", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/JabRefGUI.java b/src/main/java/org/jabref/gui/JabRefGUI.java\nsimilarity index 84%\nrename from src/main/java/org/jabref/JabRefGUI.java\nrename to src/main/java/org/jabref/gui/JabRefGUI.java\nindex ef193ead3..35c2f315e 100644\n--- a/src/main/java/org/jabref/JabRefGUI.java\n+++ b/src/main/java/org/jabref/gui/JabRefGUI.java\n\n@@ -89,13 +87,13 @@ public class JabRefGUI {\n         root.getChildren().add(JabRefGUI.mainFrame);\n \n         Scene scene = new Scene(root, 800, 800);\n+        Globals.prefs.getTheme().installCss(scene);\n \n-        //Handle Emacs key bindings\n+        // Handle Emacs key bindings\n         scene.addEventFilter(KeyEvent.KEY_PRESSED, event -> {\n-            EmacsKeyBindings.executeEmacs(scene, event);\n+            EmacsKeyBindings.executeEmacs(scene, event, Globals.prefs);\n         });\n \n-        Globals.getThemeLoader().installCss(scene, Globals.prefs);\n         mainStage.setTitle(JabRefFrame.FRAME_TITLE);\n         mainStage.getIcons().addAll(IconTheme.getLogoSetFX());\n         mainStage.setScene(scene);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1NDE2MQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385354161", "bodyText": "Please start all variables with lower case names. Also applies to CAFlag -- maybe rename it to flagCA.", "author": "koppor", "createdAt": "2020-02-27T20:29:31Z", "path": "src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java", "diffHunk": "@@ -0,0 +1,103 @@\n+package org.jabref.gui.keyboard;\n+\n+import java.util.Optional;\n+\n+import javafx.scene.Scene;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.KeyEvent;\n+\n+import org.jabref.Globals;\n+import org.jabref.logic.util.strings.EmacsStringManipulator;\n+import org.jabref.model.util.ResultingEmacsState;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+public class EmacsKeyBindings {\n+\n+    public static void executeEmacs(Scene scene, KeyEvent event) {\n+        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\nindex 26f569cb7..3569f8488 100755\n--- a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n+++ b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n\n@@ -6,20 +6,20 @@ import javafx.scene.Scene;\n import javafx.scene.control.TextInputControl;\n import javafx.scene.input.KeyEvent;\n \n-import org.jabref.Globals;\n+import org.jabref.gui.Globals;\n import org.jabref.logic.util.strings.EmacsStringManipulator;\n import org.jabref.model.util.ResultingEmacsState;\n-import org.jabref.preferences.JabRefPreferences;\n+import org.jabref.preferences.PreferencesService;\n \n public class EmacsKeyBindings {\n \n-    public static void executeEmacs(Scene scene, KeyEvent event) {\n-        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+    public static void executeEmacs(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n+        boolean EmacsFlag = preferencesService.getEmacsKeyPreferences().useEmacsKeyBindings();\n         if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n-            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n-            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n-            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n-            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+            boolean CAFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCA();\n+            boolean CFFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCF();\n+            boolean CNFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCN();\n+            boolean AUFlag = preferencesService.getEmacsKeyPreferences().shouldRebindAU();\n \n             KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n             TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1NjA0Mg==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385356042", "bodyText": "What is the reason for asking for Alt+U? Is that a special JabRef functionality?\nThe reason for the Rebind check boxes is for users with mixed Emacs and Windows shortcuts. And I never remember me typing Alt+U as shortcut (but Ctrl+A for seledct-all very often - also Ctrl+F for \"Find\")", "author": "koppor", "createdAt": "2020-02-27T20:33:34Z", "path": "src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java", "diffHunk": "@@ -0,0 +1,103 @@\n+package org.jabref.gui.keyboard;\n+\n+import java.util.Optional;\n+\n+import javafx.scene.Scene;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.KeyEvent;\n+\n+import org.jabref.Globals;\n+import org.jabref.logic.util.strings.EmacsStringManipulator;\n+import org.jabref.model.util.ResultingEmacsState;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+public class EmacsKeyBindings {\n+\n+    public static void executeEmacs(Scene scene, KeyEvent event) {\n+        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+        if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n+            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n+            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n+            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n+            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\nindex 26f569cb7..3569f8488 100755\n--- a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n+++ b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n\n@@ -6,20 +6,20 @@ import javafx.scene.Scene;\n import javafx.scene.control.TextInputControl;\n import javafx.scene.input.KeyEvent;\n \n-import org.jabref.Globals;\n+import org.jabref.gui.Globals;\n import org.jabref.logic.util.strings.EmacsStringManipulator;\n import org.jabref.model.util.ResultingEmacsState;\n-import org.jabref.preferences.JabRefPreferences;\n+import org.jabref.preferences.PreferencesService;\n \n public class EmacsKeyBindings {\n \n-    public static void executeEmacs(Scene scene, KeyEvent event) {\n-        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+    public static void executeEmacs(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n+        boolean EmacsFlag = preferencesService.getEmacsKeyPreferences().useEmacsKeyBindings();\n         if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n-            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n-            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n-            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n-            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+            boolean CAFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCA();\n+            boolean CFFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCF();\n+            boolean CNFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCN();\n+            boolean AUFlag = preferencesService.getEmacsKeyPreferences().shouldRebindAU();\n \n             KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n             TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1NjU3Nw==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385356577", "bodyText": "Please do\n} else  if ...", "author": "koppor", "createdAt": "2020-02-27T20:34:49Z", "path": "src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java", "diffHunk": "@@ -0,0 +1,103 @@\n+package org.jabref.gui.keyboard;\n+\n+import java.util.Optional;\n+\n+import javafx.scene.Scene;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.KeyEvent;\n+\n+import org.jabref.Globals;\n+import org.jabref.logic.util.strings.EmacsStringManipulator;\n+import org.jabref.model.util.ResultingEmacsState;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+public class EmacsKeyBindings {\n+\n+    public static void executeEmacs(Scene scene, KeyEvent event) {\n+        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+        if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n+            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n+            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n+            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n+            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+\n+            KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n+            TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n+            Optional<KeyBinding> keyBinding = keyBindingRepository.mapToKeyBinding(event);\n+            if (keyBinding.isPresent()) {\n+                if (keyBinding.get().equals(KeyBinding.EMACS_DELETE)) {\n+                    focusedTextField.deletePreviousChar();\n+                    event.consume();\n+                } else if (keyBinding.get().equals(KeyBinding.EMACS_BACKWARD)) {\n+                    focusedTextField.backward();\n+                    event.consume();\n+                } else if (CFFlag && keyBinding.get().equals(KeyBinding.EMACS_FORWARD)) {\n+                    focusedTextField.forward();\n+                    event.consume();\n+                } else if (CAFlag && keyBinding.get().equals(KeyBinding.EMACS_BEGINNING)) {\n+                    focusedTextField.home();\n+                    event.consume();\n+                } else if (keyBinding.get().equals(KeyBinding.EMACS_END)) {\n+                    focusedTextField.end();\n+                    event.consume();\n+                } else if (keyBinding.get().equals(KeyBinding.EMACS_BEGINNING_DOC)) {\n+                    focusedTextField.home();\n+                    event.consume();\n+                } else if (keyBinding.get().equals(KeyBinding.EMACS_END_DOC)) {\n+                    focusedTextField.end();\n+                    event.consume();\n+                } else if (keyBinding.get().equals(KeyBinding.EMACS_UP)) {\n+                    focusedTextField.home();\n+                    event.consume();\n+                } else if (CNFlag && keyBinding.get().equals(KeyBinding.EMACS_DOWN)) {\n+                    focusedTextField.end();\n+                    event.consume();\n+                } else if (keyBinding.get().equals(KeyBinding.EMACS_CAPITALIZE)) {\n+                    int pos = focusedTextField.getCaretPosition();\n+                    String text = focusedTextField.getText(0, focusedTextField.getText().length());\n+                    ResultingEmacsState res = EmacsStringManipulator.capitalize(pos, text);\n+                    focusedTextField.setText(res.text);\n+                    focusedTextField.positionCaret(res.caretPos);\n+                    event.consume();\n+                }\n+                else if (keyBinding.get().equals(KeyBinding.EMACS_LOWERCASE)) {", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\nindex 26f569cb7..3569f8488 100755\n--- a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n+++ b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n\n@@ -6,20 +6,20 @@ import javafx.scene.Scene;\n import javafx.scene.control.TextInputControl;\n import javafx.scene.input.KeyEvent;\n \n-import org.jabref.Globals;\n+import org.jabref.gui.Globals;\n import org.jabref.logic.util.strings.EmacsStringManipulator;\n import org.jabref.model.util.ResultingEmacsState;\n-import org.jabref.preferences.JabRefPreferences;\n+import org.jabref.preferences.PreferencesService;\n \n public class EmacsKeyBindings {\n \n-    public static void executeEmacs(Scene scene, KeyEvent event) {\n-        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+    public static void executeEmacs(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n+        boolean EmacsFlag = preferencesService.getEmacsKeyPreferences().useEmacsKeyBindings();\n         if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n-            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n-            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n-            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n-            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+            boolean CAFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCA();\n+            boolean CFFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCF();\n+            boolean CNFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCN();\n+            boolean AUFlag = preferencesService.getEmacsKeyPreferences().shouldRebindAU();\n \n             KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n             TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1NzEzNQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385357135", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                EMACS_KILLLINE(\"Emacs remove line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EDIT),\n          \n          \n            \n                EMACS_KILLLINE(\"Emacs remove all characters caret to end of line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EDIT),", "author": "koppor", "createdAt": "2020-02-27T20:36:14Z", "path": "src/main/java/org/jabref/gui/keyboard/KeyBinding.java", "diffHunk": "@@ -3,6 +3,21 @@\n import org.jabref.logic.l10n.Localization;\n \n public enum KeyBinding {\n+    EMACS_DELETE(\"Emacs delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EDIT),\n+    EMACS_BACKWARD(\"Emacs move caret left\", Localization.lang(\"Move caret left\"), \"ctrl+B\", KeyBindingCategory.EDIT),\n+    EMACS_FORWARD(\"Emacs move caret right\", Localization.lang(\"Move caret right\"), \"ctrl+F\", KeyBindingCategory.EDIT),\n+    EMACS_BEGINNING(\"Emacs move caret to beginning of line\", Localization.lang(\"Move caret to beginning of line\"), \"ctrl+A\", KeyBindingCategory.EDIT),\n+    EMACS_END(\"Emacs move caret to  of line\", Localization.lang(\"Move caret to end of line\"), \"ctrl+E\", KeyBindingCategory.EDIT),\n+    EMACS_BEGINNING_DOC(\"Emacs move caret to beginning of text\", Localization.lang(\"Move the caret to the beginning of text\"), \"alt+LESS\", KeyBindingCategory.EDIT),\n+    EMACS_END_DOC(\"Emacs move caret to end of text\", Localization.lang(\"Move the caret to the end of text\"), \"alt+shift+LESS\", KeyBindingCategory.EDIT),\n+    EMACS_UP(\"Emacs move caret up\", Localization.lang(\"Move the caret up\"), \"ctrl+P\", KeyBindingCategory.EDIT),\n+    EMACS_DOWN(\"Emacs move caret down\", Localization.lang(\"Move the caret down\"), \"ctrl+N\", KeyBindingCategory.EDIT),\n+    EMACS_CAPITALIZE(\"Emacs capitalize word\", Localization.lang(\"Capitalize current word\"), \"alt+C\", KeyBindingCategory.EDIT),\n+    EMACS_LOWERCASE(\"Emacs lowercase word\", Localization.lang(\"Make current word lowercase\"), \"alt+L\", KeyBindingCategory.EDIT),\n+    EMACS_UPPERCASE(\"Emacs uppercase word\", Localization.lang(\"Make current word uppercase\"), \"alt+U\", KeyBindingCategory.EDIT),\n+    EMACS_KILLLINE(\"Emacs remove line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EDIT),", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NDU4Mg==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385794582", "bodyText": "I would prefer as the constant name to separate the words by an underscore: EMACS_KILL_LINE because:\na) Java Naming Conventions ( https://www.oracle.com/technetwork/java/codeconventions-135099.html )\nb) Three L after each other hurts my eyes. \ud83d\ude04", "author": "calixtus", "createdAt": "2020-02-28T16:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1NzEzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\nindex 2b815a262..1c64f4f68 100644\n--- a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n+++ b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n\n@@ -20,7 +20,7 @@ public enum KeyBinding {\n     EMACS_BACKWARDKILLWORD(\"Emacs remove word backwards\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDIT),\n \n     ABBREVIATE(\"Abbreviate\", Localization.lang(\"Abbreviate journal names\"), \"ctrl+alt+A\", KeyBindingCategory.TOOLS),\n-    AUTOGENERATE_BIBTEX_KEYS(\"Autogenerate BibTeX keys\", Localization.lang(\"Autogenerate BibTeX keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n+    AUTOGENERATE_CITATION_KEYS(\"Autogenerate citation keys\", Localization.lang(\"Autogenerate citation keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n     ACCEPT(\"Accept\", Localization.lang(\"Accept\"), \"ctrl+ENTER\", KeyBindingCategory.EDIT),\n     AUTOMATICALLY_LINK_FILES(\"Automatically link files\", Localization.lang(\"Automatically set file links\"), \"F7\", KeyBindingCategory.QUALITY),\n     CHECK_INTEGRITY(\"Check integrity\", Localization.lang(\"Check integrity\"), \"ctrl+F8\", KeyBindingCategory.QUALITY),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1Nzc0Ng==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385357746", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                EMACS_KILLWORD(\"Emacs remove word forwards\", Localization.lang(\"Remove current word forwards\"), \"alt+D\", KeyBindingCategory.EDIT),\n          \n          \n            \n                EMACS_KILLWORD(\"Emacs remove characters until next word\", Localization.lang(\"Remove characters until next word\"), \"alt+D\", KeyBindingCategory.EDIT),", "author": "koppor", "createdAt": "2020-02-27T20:37:41Z", "path": "src/main/java/org/jabref/gui/keyboard/KeyBinding.java", "diffHunk": "@@ -3,6 +3,21 @@\n import org.jabref.logic.l10n.Localization;\n \n public enum KeyBinding {\n+    EMACS_DELETE(\"Emacs delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EDIT),\n+    EMACS_BACKWARD(\"Emacs move caret left\", Localization.lang(\"Move caret left\"), \"ctrl+B\", KeyBindingCategory.EDIT),\n+    EMACS_FORWARD(\"Emacs move caret right\", Localization.lang(\"Move caret right\"), \"ctrl+F\", KeyBindingCategory.EDIT),\n+    EMACS_BEGINNING(\"Emacs move caret to beginning of line\", Localization.lang(\"Move caret to beginning of line\"), \"ctrl+A\", KeyBindingCategory.EDIT),\n+    EMACS_END(\"Emacs move caret to  of line\", Localization.lang(\"Move caret to end of line\"), \"ctrl+E\", KeyBindingCategory.EDIT),\n+    EMACS_BEGINNING_DOC(\"Emacs move caret to beginning of text\", Localization.lang(\"Move the caret to the beginning of text\"), \"alt+LESS\", KeyBindingCategory.EDIT),\n+    EMACS_END_DOC(\"Emacs move caret to end of text\", Localization.lang(\"Move the caret to the end of text\"), \"alt+shift+LESS\", KeyBindingCategory.EDIT),\n+    EMACS_UP(\"Emacs move caret up\", Localization.lang(\"Move the caret up\"), \"ctrl+P\", KeyBindingCategory.EDIT),\n+    EMACS_DOWN(\"Emacs move caret down\", Localization.lang(\"Move the caret down\"), \"ctrl+N\", KeyBindingCategory.EDIT),\n+    EMACS_CAPITALIZE(\"Emacs capitalize word\", Localization.lang(\"Capitalize current word\"), \"alt+C\", KeyBindingCategory.EDIT),\n+    EMACS_LOWERCASE(\"Emacs lowercase word\", Localization.lang(\"Make current word lowercase\"), \"alt+L\", KeyBindingCategory.EDIT),\n+    EMACS_UPPERCASE(\"Emacs uppercase word\", Localization.lang(\"Make current word uppercase\"), \"alt+U\", KeyBindingCategory.EDIT),\n+    EMACS_KILLLINE(\"Emacs remove line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EDIT),\n+    EMACS_KILLWORD(\"Emacs remove word forwards\", Localization.lang(\"Remove current word forwards\"), \"alt+D\", KeyBindingCategory.EDIT),", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\nindex 2b815a262..1c64f4f68 100644\n--- a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n+++ b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n\n@@ -20,7 +20,7 @@ public enum KeyBinding {\n     EMACS_BACKWARDKILLWORD(\"Emacs remove word backwards\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDIT),\n \n     ABBREVIATE(\"Abbreviate\", Localization.lang(\"Abbreviate journal names\"), \"ctrl+alt+A\", KeyBindingCategory.TOOLS),\n-    AUTOGENERATE_BIBTEX_KEYS(\"Autogenerate BibTeX keys\", Localization.lang(\"Autogenerate BibTeX keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n+    AUTOGENERATE_CITATION_KEYS(\"Autogenerate citation keys\", Localization.lang(\"Autogenerate citation keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n     ACCEPT(\"Accept\", Localization.lang(\"Accept\"), \"ctrl+ENTER\", KeyBindingCategory.EDIT),\n     AUTOMATICALLY_LINK_FILES(\"Automatically link files\", Localization.lang(\"Automatically set file links\"), \"F7\", KeyBindingCategory.QUALITY),\n     CHECK_INTEGRITY(\"Check integrity\", Localization.lang(\"Check integrity\"), \"ctrl+F8\", KeyBindingCategory.QUALITY),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1ODAyMA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385358020", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                EMACS_BACKWARDKILLWORD(\"Emacs remove word backwards\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDIT),\n          \n          \n            \n                EMACS_BACKWARDKILLWORD(\"Emacs remove characters until previous word\", Localization.lang(\"Remove characters until previous word\"), \"alt+DELETE\", KeyBindingCategory.EDIT),", "author": "koppor", "createdAt": "2020-02-27T20:38:16Z", "path": "src/main/java/org/jabref/gui/keyboard/KeyBinding.java", "diffHunk": "@@ -3,6 +3,21 @@\n import org.jabref.logic.l10n.Localization;\n \n public enum KeyBinding {\n+    EMACS_DELETE(\"Emacs delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EDIT),\n+    EMACS_BACKWARD(\"Emacs move caret left\", Localization.lang(\"Move caret left\"), \"ctrl+B\", KeyBindingCategory.EDIT),\n+    EMACS_FORWARD(\"Emacs move caret right\", Localization.lang(\"Move caret right\"), \"ctrl+F\", KeyBindingCategory.EDIT),\n+    EMACS_BEGINNING(\"Emacs move caret to beginning of line\", Localization.lang(\"Move caret to beginning of line\"), \"ctrl+A\", KeyBindingCategory.EDIT),\n+    EMACS_END(\"Emacs move caret to  of line\", Localization.lang(\"Move caret to end of line\"), \"ctrl+E\", KeyBindingCategory.EDIT),\n+    EMACS_BEGINNING_DOC(\"Emacs move caret to beginning of text\", Localization.lang(\"Move the caret to the beginning of text\"), \"alt+LESS\", KeyBindingCategory.EDIT),\n+    EMACS_END_DOC(\"Emacs move caret to end of text\", Localization.lang(\"Move the caret to the end of text\"), \"alt+shift+LESS\", KeyBindingCategory.EDIT),\n+    EMACS_UP(\"Emacs move caret up\", Localization.lang(\"Move the caret up\"), \"ctrl+P\", KeyBindingCategory.EDIT),\n+    EMACS_DOWN(\"Emacs move caret down\", Localization.lang(\"Move the caret down\"), \"ctrl+N\", KeyBindingCategory.EDIT),\n+    EMACS_CAPITALIZE(\"Emacs capitalize word\", Localization.lang(\"Capitalize current word\"), \"alt+C\", KeyBindingCategory.EDIT),\n+    EMACS_LOWERCASE(\"Emacs lowercase word\", Localization.lang(\"Make current word lowercase\"), \"alt+L\", KeyBindingCategory.EDIT),\n+    EMACS_UPPERCASE(\"Emacs uppercase word\", Localization.lang(\"Make current word uppercase\"), \"alt+U\", KeyBindingCategory.EDIT),\n+    EMACS_KILLLINE(\"Emacs remove line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EDIT),\n+    EMACS_KILLWORD(\"Emacs remove word forwards\", Localization.lang(\"Remove current word forwards\"), \"alt+D\", KeyBindingCategory.EDIT),\n+    EMACS_BACKWARDKILLWORD(\"Emacs remove word backwards\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDIT),", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\nindex 2b815a262..1c64f4f68 100644\n--- a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n+++ b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n\n@@ -20,7 +20,7 @@ public enum KeyBinding {\n     EMACS_BACKWARDKILLWORD(\"Emacs remove word backwards\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDIT),\n \n     ABBREVIATE(\"Abbreviate\", Localization.lang(\"Abbreviate journal names\"), \"ctrl+alt+A\", KeyBindingCategory.TOOLS),\n-    AUTOGENERATE_BIBTEX_KEYS(\"Autogenerate BibTeX keys\", Localization.lang(\"Autogenerate BibTeX keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n+    AUTOGENERATE_CITATION_KEYS(\"Autogenerate citation keys\", Localization.lang(\"Autogenerate citation keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n     ACCEPT(\"Accept\", Localization.lang(\"Accept\"), \"ctrl+ENTER\", KeyBindingCategory.EDIT),\n     AUTOMATICALLY_LINK_FILES(\"Automatically link files\", Localization.lang(\"Automatically set file links\"), \"F7\", KeyBindingCategory.QUALITY),\n     CHECK_INTEGRITY(\"Check integrity\", Localization.lang(\"Check integrity\"), \"ctrl+F8\", KeyBindingCategory.QUALITY),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1OTEyNA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385359124", "bodyText": "You can just set firstLoop to false here", "author": "koppor", "createdAt": "2020-02-27T20:40:50Z", "path": "src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java", "diffHunk": "@@ -0,0 +1,178 @@\n+package org.jabref.logic.util.strings;\n+import org.jabref.model.util.ResultingEmacsState;\n+\n+public class EmacsStringManipulator {\n+    private enum LetterCase {\n+        UPPER,\n+        LOWER,\n+        CAPITALIZED\n+    }\n+\n+    private enum Direction {\n+        NEXT, PREVIOUS\n+    }\n+\n+    private static ResultingEmacsState setNextWordsCase(String text, int pos, LetterCase targetCase) {\n+        StringBuilder res = new StringBuilder();\n+\n+        boolean firstLetter = true;\n+        int i = pos;\n+        boolean firstLoop = true;\n+        StringBuilder newWordBuilder = new StringBuilder();\n+        for (; i < text.length(); i++) {\n+            // Swallow whitespace\n+            while (firstLoop && i < text.length() && !String.valueOf(text.charAt(i)).matches(\"\\\\w\")) {\n+                newWordBuilder.append(text.charAt(i));\n+                i++;\n+            }\n+            if (i >= text.length()) {\n+                break;\n+            }\n+            if (firstLoop) {", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\nindex 2dec6823b..45a97e82a 100644\n--- a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n+++ b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n\n@@ -74,18 +74,17 @@ public class EmacsStringManipulator {\n         int offset;\n         int wordBreak;\n         switch (dir) {\n-            case NEXT:\n+            case NEXT -> {\n                 res.append(text, 0, pos);\n                 offset = 1;\n                 wordBreak = text.length();\n-                break;\n-            case PREVIOUS:\n+            }\n+            case PREVIOUS -> {\n                 res.append(text, pos, text.length());\n                 offset = -1;\n                 wordBreak = 0;\n-                break;\n-            default:\n-                throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n+            }\n+            default -> throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n         }\n \n         for (int i = pos; i < text.length() && i >= 0; i += offset) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2MTM3MA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385361370", "bodyText": "I searched the code for LOCALE for toUpperCase, because of https://haacked.com/archive/2012/07/05/turkish-i-problem-and-why-you-should-care.aspx/. I know that JabRef isn't doing it quite right.\nCould you please rewrite your code to\n\nExtract the string where the case needs to be changed\nUse org.jabref.logic.bst.BibtexCaseChanger#changeCase.\n\nReason: code-reuse and we are in a BibTeX setting which needs special treatment.", "author": "koppor", "createdAt": "2020-02-27T20:45:41Z", "path": "src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java", "diffHunk": "@@ -0,0 +1,178 @@\n+package org.jabref.logic.util.strings;\n+import org.jabref.model.util.ResultingEmacsState;\n+\n+public class EmacsStringManipulator {\n+    private enum LetterCase {\n+        UPPER,\n+        LOWER,\n+        CAPITALIZED\n+    }\n+\n+    private enum Direction {\n+        NEXT, PREVIOUS\n+    }\n+\n+    private static ResultingEmacsState setNextWordsCase(String text, int pos, LetterCase targetCase) {\n+        StringBuilder res = new StringBuilder();\n+\n+        boolean firstLetter = true;\n+        int i = pos;\n+        boolean firstLoop = true;\n+        StringBuilder newWordBuilder = new StringBuilder();\n+        for (; i < text.length(); i++) {\n+            // Swallow whitespace\n+            while (firstLoop && i < text.length() && !String.valueOf(text.charAt(i)).matches(\"\\\\w\")) {\n+                newWordBuilder.append(text.charAt(i));\n+                i++;\n+            }\n+            if (i >= text.length()) {\n+                break;\n+            }\n+            if (firstLoop) {\n+                firstLoop = false;\n+            }\n+            char currentChar = text.charAt(i);\n+            if (String.valueOf(currentChar).matches(\"\\\\w\")) {\n+                switch (targetCase) {\n+                    case UPPER:\n+                        newWordBuilder.append(Character.toUpperCase(currentChar));", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ1OTY3OQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r510459679", "bodyText": "JavaDoc in BibtexCaseChanger says:\n// the following would have to be done if the functionality of CaseChangers would be included here\n// However, we decided against it and will probably do the other way round: https://github.com/JabRef/jabref/pull/215#issuecomment-146981624\n\nSo I understand that BibtexCaseChangers are somewhat deprecated... Therefor I will use CaseChangeFormatters (also because the BibtexCaseChanger does not support simple capitalization :-o \ud83d\ude09", "author": "calixtus", "createdAt": "2020-10-22T21:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2MTM3MA=="}], "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\nindex 2dec6823b..45a97e82a 100644\n--- a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n+++ b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n\n@@ -74,18 +74,17 @@ public class EmacsStringManipulator {\n         int offset;\n         int wordBreak;\n         switch (dir) {\n-            case NEXT:\n+            case NEXT -> {\n                 res.append(text, 0, pos);\n                 offset = 1;\n                 wordBreak = text.length();\n-                break;\n-            case PREVIOUS:\n+            }\n+            case PREVIOUS -> {\n                 res.append(text, pos, text.length());\n                 offset = -1;\n                 wordBreak = 0;\n-                break;\n-            default:\n-                throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n+            }\n+            default -> throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n         }\n \n         for (int i = pos; i < text.length() && i >= 0; i += offset) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2MTY3OA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385361678", "bodyText": "I think, this is obsolete and org.jabref.logic.bst.BibtexCaseChanger.FORMAT_MODE can be used. See below for a longer explanation.", "author": "koppor", "createdAt": "2020-02-27T20:46:20Z", "path": "src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java", "diffHunk": "@@ -0,0 +1,178 @@\n+package org.jabref.logic.util.strings;\n+import org.jabref.model.util.ResultingEmacsState;\n+\n+public class EmacsStringManipulator {\n+    private enum LetterCase {", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\nindex 2dec6823b..45a97e82a 100644\n--- a/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n+++ b/src/main/java/org/jabref/logic/util/strings/EmacsStringManipulator.java\n\n@@ -74,18 +74,17 @@ public class EmacsStringManipulator {\n         int offset;\n         int wordBreak;\n         switch (dir) {\n-            case NEXT:\n+            case NEXT -> {\n                 res.append(text, 0, pos);\n                 offset = 1;\n                 wordBreak = text.length();\n-                break;\n-            case PREVIOUS:\n+            }\n+            case PREVIOUS -> {\n                 res.append(text, pos, text.length());\n                 offset = -1;\n                 wordBreak = 0;\n-                break;\n-            default:\n-                throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n+            }\n+            default -> throw new AssertionError(\"Missing case in switch deleteUntilWordBoundary\");\n         }\n \n         for (int i = pos; i < text.length() && i >= 0; i += offset) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2NzQzMQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385367431", "bodyText": "Please add a new category KeyBindingCategory.EMACS. Otherwise, it will confuse users, because the keybindings in the normal menu make the impression that they are always enabled (which they are not)", "author": "koppor", "createdAt": "2020-02-27T20:58:21Z", "path": "src/main/java/org/jabref/gui/keyboard/KeyBinding.java", "diffHunk": "@@ -3,6 +3,21 @@\n import org.jabref.logic.l10n.Localization;\n \n public enum KeyBinding {\n+    EMACS_DELETE(\"Emacs delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EDIT),", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\nindex 2b815a262..1c64f4f68 100644\n--- a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n+++ b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n\n@@ -20,7 +20,7 @@ public enum KeyBinding {\n     EMACS_BACKWARDKILLWORD(\"Emacs remove word backwards\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDIT),\n \n     ABBREVIATE(\"Abbreviate\", Localization.lang(\"Abbreviate journal names\"), \"ctrl+alt+A\", KeyBindingCategory.TOOLS),\n-    AUTOGENERATE_BIBTEX_KEYS(\"Autogenerate BibTeX keys\", Localization.lang(\"Autogenerate BibTeX keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n+    AUTOGENERATE_CITATION_KEYS(\"Autogenerate citation keys\", Localization.lang(\"Autogenerate citation keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n     ACCEPT(\"Accept\", Localization.lang(\"Accept\"), \"ctrl+ENTER\", KeyBindingCategory.EDIT),\n     AUTOMATICALLY_LINK_FILES(\"Automatically link files\", Localization.lang(\"Automatically set file links\"), \"F7\", KeyBindingCategory.QUALITY),\n     CHECK_INTEGRITY(\"Check integrity\", Localization.lang(\"Check integrity\"), \"ctrl+F8\", KeyBindingCategory.QUALITY),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MTkwOQ==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r385561909", "bodyText": "Can event.consume() be extracted below the if construct?", "author": "calixtus", "createdAt": "2020-02-28T08:23:20Z", "path": "src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java", "diffHunk": "@@ -0,0 +1,103 @@\n+package org.jabref.gui.keyboard;\n+\n+import java.util.Optional;\n+\n+import javafx.scene.Scene;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.KeyEvent;\n+\n+import org.jabref.Globals;\n+import org.jabref.logic.util.strings.EmacsStringManipulator;\n+import org.jabref.model.util.ResultingEmacsState;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+public class EmacsKeyBindings {\n+\n+    public static void executeEmacs(Scene scene, KeyEvent event) {\n+        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+        if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n+            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n+            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n+            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n+            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+\n+            KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n+            TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n+            Optional<KeyBinding> keyBinding = keyBindingRepository.mapToKeyBinding(event);\n+            if (keyBinding.isPresent()) {\n+                if (keyBinding.get().equals(KeyBinding.EMACS_DELETE)) {\n+                    focusedTextField.deletePreviousChar();\n+                    event.consume();", "originalCommit": "0c2f4b23fc9d42f3228923c330378e106da3462e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b7ce3284db98df2f116040711d8b13203b2e511", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\nindex 26f569cb7..3569f8488 100755\n--- a/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n+++ b/src/main/java/org/jabref/gui/keyboard/EmacsKeyBindings.java\n\n@@ -6,20 +6,20 @@ import javafx.scene.Scene;\n import javafx.scene.control.TextInputControl;\n import javafx.scene.input.KeyEvent;\n \n-import org.jabref.Globals;\n+import org.jabref.gui.Globals;\n import org.jabref.logic.util.strings.EmacsStringManipulator;\n import org.jabref.model.util.ResultingEmacsState;\n-import org.jabref.preferences.JabRefPreferences;\n+import org.jabref.preferences.PreferencesService;\n \n public class EmacsKeyBindings {\n \n-    public static void executeEmacs(Scene scene, KeyEvent event) {\n-        boolean EmacsFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS);\n+    public static void executeEmacs(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n+        boolean EmacsFlag = preferencesService.getEmacsKeyPreferences().useEmacsKeyBindings();\n         if (EmacsFlag && scene.focusOwnerProperty().get() instanceof TextInputControl) {\n-            boolean CAFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CA);\n-            boolean CFFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CF);\n-            boolean CNFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_CN);\n-            boolean AUFlag = Globals.prefs.getBoolean(JabRefPreferences.EDITOR_EMACS_KEYBINDINGS_REBIND_AU);\n+            boolean CAFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCA();\n+            boolean CFFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCF();\n+            boolean CNFlag = preferencesService.getEmacsKeyPreferences().shouldRebindCN();\n+            boolean AUFlag = preferencesService.getEmacsKeyPreferences().shouldRebindAU();\n \n             KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n             TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n"}}, {"oid": "6b7ce3284db98df2f116040711d8b13203b2e511", "url": "https://github.com/JabRef/jabref/commit/6b7ce3284db98df2f116040711d8b13203b2e511", "message": "Merge conflicts solved", "committedDate": "2020-10-20T22:33:37Z", "type": "commit"}, {"oid": "aad47bf1429b2ca274504bd79c3fe1c227b78dce", "url": "https://github.com/JabRef/jabref/commit/aad47bf1429b2ca274504bd79c3fe1c227b78dce", "message": "Integrated some suggestions", "committedDate": "2020-10-20T23:13:23Z", "type": "commit"}, {"oid": "5b9498c1ad8349d34f804cb23be652fcb0749502", "url": "https://github.com/JabRef/jabref/commit/5b9498c1ad8349d34f804cb23be652fcb0749502", "message": "Introduced KeyBindingCategory Emacs", "committedDate": "2020-10-21T18:59:29Z", "type": "commit"}, {"oid": "1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "url": "https://github.com/JabRef/jabref/commit/1d68c6e161b27c982ebcc2e4a346eb8b383ac071", "message": "[feat] Implement Emacs key bindings\n\nEmacs style key bindings are re-added to JabRef through the preferences\nmenu. The supported key bindings have feature parity with the previous\nimplementation in JabRef v<4, and additionally support any class that\nextends TextInputControl. In practice, this means that the new\nimplementation supports both TextFields and TextAreas by default. Some\nfunctionality may still be missing\n\nCo-authored-by: Felix Luthman <34520175+felixlut@users.noreply.github.com>\nCo-authored-by: Tommy Samuelsson <Zodbigt@users.noreply.github.com>\nCo-authored-by: muachilin <32566798+muachilin@users.noreply.github.com>\nCo-authored-by: Kristoffer Gunnarsson <kristoffergunnarsson47@gmail.com>", "committedDate": "2020-02-27T17:30:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk2MTUxMg==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r509961512", "bodyText": "I thought about this again, and still think it would make sense to add these keybindings as normal keybindings, setting them to \"normal\" defaults: e.g. WORD_FORWARD to Ctrl + right, others like CAPITALIZE to empty. Then people can customize to whatever they want, e.g. emacs or vi or ...\nThis would also hugely simplify the code as these keybindings would be treated as normal bindings.", "author": "tobiasdiez", "createdAt": "2020-10-22T08:07:56Z", "path": "src/main/java/org/jabref/gui/keyboard/KeyBinding.java", "diffHunk": "@@ -3,6 +3,23 @@\n import org.jabref.logic.l10n.Localization;\n \n public enum KeyBinding {\n+    EMACS_DELETE(\"Emacs delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EMACS),\n+    EMACS_BACKWARD(\"Emacs move caret left\", Localization.lang(\"Move caret left\"), \"ctrl+B\", KeyBindingCategory.EMACS),\n+    EMACS_FORWARD(\"Emacs move caret right\", Localization.lang(\"Move caret right\"), \"ctrl+F\", KeyBindingCategory.EMACS),\n+    EMACS_WORD_BACKWARD(\"Emacs move caret to previous word\", Localization.lang(\"Move caret to previous word\"), \"alt+B\", KeyBindingCategory.EMACS),\n+    EMACS_WORD_FORWARD(\"Emacs move caret to next word\", Localization.lang(\"Move caret to next word\"), \"alt+B\", KeyBindingCategory.EMACS),\n+    EMACS_BEGINNING(\"Emacs move caret to beginning of line\", Localization.lang(\"Move caret to beginning of line\"), \"ctrl+A\", KeyBindingCategory.EMACS),", "originalCommit": "5b9498c1ad8349d34f804cb23be652fcb0749502", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3NTgzOA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r509975838", "bodyText": "Yes, I started working myself slowly through all the comments. I think I agree with you, a generic keybinding solution really does make sense.", "author": "calixtus", "createdAt": "2020-10-22T08:29:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk2MTUxMg=="}], "type": "inlineReview", "revised_code": {"commit": "f0468b23986044525251938be58ce63e557fc60b", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\nindex 5973b4df4..b17f0bc40 100644\n--- a/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n+++ b/src/main/java/org/jabref/gui/keyboard/KeyBinding.java\n\n@@ -3,23 +3,24 @@ package org.jabref.gui.keyboard;\n import org.jabref.logic.l10n.Localization;\n \n public enum KeyBinding {\n-    EMACS_DELETE(\"Emacs delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EMACS),\n-    EMACS_BACKWARD(\"Emacs move caret left\", Localization.lang(\"Move caret left\"), \"ctrl+B\", KeyBindingCategory.EMACS),\n-    EMACS_FORWARD(\"Emacs move caret right\", Localization.lang(\"Move caret right\"), \"ctrl+F\", KeyBindingCategory.EMACS),\n-    EMACS_WORD_BACKWARD(\"Emacs move caret to previous word\", Localization.lang(\"Move caret to previous word\"), \"alt+B\", KeyBindingCategory.EMACS),\n-    EMACS_WORD_FORWARD(\"Emacs move caret to next word\", Localization.lang(\"Move caret to next word\"), \"alt+B\", KeyBindingCategory.EMACS),\n-    EMACS_BEGINNING(\"Emacs move caret to beginning of line\", Localization.lang(\"Move caret to beginning of line\"), \"ctrl+A\", KeyBindingCategory.EMACS),\n-    EMACS_END(\"Emacs move caret to  of line\", Localization.lang(\"Move caret to end of line\"), \"ctrl+E\", KeyBindingCategory.EMACS),\n-    EMACS_BEGINNING_DOC(\"Emacs move caret to beginning of text\", Localization.lang(\"Move the caret to the beginning of text\"), \"alt+LESS\", KeyBindingCategory.EMACS),\n-    EMACS_END_DOC(\"Emacs move caret to end of text\", Localization.lang(\"Move the caret to the end of text\"), \"alt+shift+LESS\", KeyBindingCategory.EMACS),\n-    EMACS_UP(\"Emacs move caret up\", Localization.lang(\"Move the caret up\"), \"ctrl+P\", KeyBindingCategory.EMACS),\n-    EMACS_DOWN(\"Emacs move caret down\", Localization.lang(\"Move the caret down\"), \"ctrl+N\", KeyBindingCategory.EMACS),\n-    EMACS_CAPITALIZE(\"Emacs capitalize word\", Localization.lang(\"Capitalize current word\"), \"alt+C\", KeyBindingCategory.EMACS),\n-    EMACS_LOWERCASE(\"Emacs lowercase word\", Localization.lang(\"Make current word lowercase\"), \"alt+L\", KeyBindingCategory.EMACS),\n-    EMACS_UPPERCASE(\"Emacs uppercase word\", Localization.lang(\"Make current word uppercase\"), \"alt+U\", KeyBindingCategory.EMACS),\n-    EMACS_KILL_LINE(\"Emacs remove all characters caret to end of line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EMACS),\n-    EMACS_KILL_WORD(\"Emacs remove characters until next word\", Localization.lang(\"Remove characters until next word\"), \"alt+D\", KeyBindingCategory.EMACS),\n-    EMACS_KILL_WORD_BACKWARD(\"Emacs characters until previous word\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EMACS),\n+    EDITOR_DELETE(\"Delete\", Localization.lang(\"Delete text\"), \"ctrl+D\", KeyBindingCategory.EDITOR),\n+    // DELETE BACKWARDS = Rubout\n+    EDITOR_BACKWARD(\"Move caret left\", Localization.lang(\"Move caret left\"), \"ctrl+B\", KeyBindingCategory.EDITOR),\n+    EDITOR_FORWARD(\"Move caret right\", Localization.lang(\"Move caret right\"), \"ctrl+F\", KeyBindingCategory.EDITOR),\n+    EDITOR_WORD_BACKWARD(\"Move caret to previous word\", Localization.lang(\"Move caret to previous word\"), \"alt+B\", KeyBindingCategory.EDITOR),\n+    EDITOR_WORD_FORWARD(\"Move caret to next word\", Localization.lang(\"Move caret to next word\"), \"alt+F\", KeyBindingCategory.EDITOR),\n+    EDITOR_BEGINNING(\"Move caret to beginning of line\", Localization.lang(\"Move caret to beginning of line\"), \"ctrl+A\", KeyBindingCategory.EDITOR),\n+    EDITOR_END(\"Move caret to  of line\", Localization.lang(\"Move caret to end of line\"), \"ctrl+E\", KeyBindingCategory.EDITOR),\n+    EDITOR_BEGINNING_DOC(\"Move caret to beginning of text\", Localization.lang(\"Move the caret to the beginning of text\"), \"alt+LESS\", KeyBindingCategory.EDITOR),\n+    EDITOR_END_DOC(\"Move caret to end of text\", Localization.lang(\"Move the caret to the end of text\"), \"alt+shift+LESS\", KeyBindingCategory.EDITOR),\n+    EDITOR_UP(\"Move caret up\", Localization.lang(\"Move the caret up\"), \"ctrl+P\", KeyBindingCategory.EDITOR),\n+    EDITOR_DOWN(\"Move caret down\", Localization.lang(\"Move the caret down\"), \"ctrl+N\", KeyBindingCategory.EDITOR),\n+    EDITOR_CAPITALIZE(\"Capitalize word\", Localization.lang(\"Capitalize current word\"), \"alt+C\", KeyBindingCategory.EDITOR),\n+    EDITOR_LOWERCASE(\"Lowercase word\", Localization.lang(\"Make current word lowercase\"), \"alt+L\", KeyBindingCategory.EDITOR),\n+    EDITOR_UPPERCASE(\"Uppercase word\", Localization.lang(\"Make current word uppercase\"), \"alt+U\", KeyBindingCategory.EDITOR),\n+    EDITOR_KILL_LINE(\"Remove all characters caret to end of line\", Localization.lang(\"Remove line after caret\"), \"ctrl+K\", KeyBindingCategory.EDITOR),\n+    EDITOR_KILL_WORD(\"Remove characters until next word\", Localization.lang(\"Remove characters until next word\"), \"alt+D\", KeyBindingCategory.EDITOR),\n+    EDITOR_KILL_WORD_BACKWARD(\"Characters until previous word\", Localization.lang(\"Remove the current word backwards\"), \"alt+DELETE\", KeyBindingCategory.EDITOR),\n \n     ABBREVIATE(\"Abbreviate\", Localization.lang(\"Abbreviate journal names\"), \"ctrl+alt+A\", KeyBindingCategory.TOOLS),\n     AUTOGENERATE_CITATION_KEYS(\"Autogenerate citation keys\", Localization.lang(\"Autogenerate citation keys\"), \"ctrl+G\", KeyBindingCategory.QUALITY),\n"}}, {"oid": "b3fbfe951da8fe1d6c791c68d8622712a2e14c7f", "url": "https://github.com/JabRef/jabref/commit/b3fbfe951da8fe1d6c791c68d8622712a2e14c7f", "message": "Integrated some more remarks", "committedDate": "2020-10-22T16:55:40Z", "type": "commit"}, {"oid": "f0468b23986044525251938be58ce63e557fc60b", "url": "https://github.com/JabRef/jabref/commit/f0468b23986044525251938be58ce63e557fc60b", "message": "Integrated again some more remarks", "committedDate": "2020-10-22T22:51:03Z", "type": "commit"}, {"oid": "4b0a3eb98cfb4d76f9a41f32ba471ce688360aa7", "url": "https://github.com/JabRef/jabref/commit/4b0a3eb98cfb4d76f9a41f32ba471ce688360aa7", "message": "Removed some artifacts", "committedDate": "2020-10-22T22:57:29Z", "type": "commit"}, {"oid": "cdfb2e414a0668b3e4018dff96f15ecfd6364cc2", "url": "https://github.com/JabRef/jabref/commit/cdfb2e414a0668b3e4018dff96f15ecfd6364cc2", "message": "Merge remote-tracking branch 'upstream/master' into emacs", "committedDate": "2020-11-02T21:45:25Z", "type": "commit"}, {"oid": "df1889e893354d78afdc553c9dc031698d658f8b", "url": "https://github.com/JabRef/jabref/commit/df1889e893354d78afdc553c9dc031698d658f8b", "message": "First attempt to fix backwardKillWord", "committedDate": "2020-11-04T20:33:14Z", "type": "commit"}, {"oid": "bf20143d479a483d87b24ed3ded333e5e43d33c9", "url": "https://github.com/JabRef/jabref/commit/bf20143d479a483d87b24ed3ded333e5e43d33c9", "message": "Fixed all StringManipulatorTests", "committedDate": "2020-11-04T21:19:49Z", "type": "commit"}, {"oid": "83a384837dc0b311fe263c550419ac0c9b486814", "url": "https://github.com/JabRef/jabref/commit/83a384837dc0b311fe263c550419ac0c9b486814", "message": "Added ParameterizedTests", "committedDate": "2020-11-04T21:36:19Z", "type": "commit"}, {"oid": "09338561e5a54ee241f4526881f9a02fbd7322be", "url": "https://github.com/JabRef/jabref/commit/09338561e5a54ee241f4526881f9a02fbd7322be", "message": "Refactor setWordCase", "committedDate": "2020-11-04T22:52:16Z", "type": "commit"}, {"oid": "ffcaeb6ceb48d772137b1263a53e8542a71f0984", "url": "https://github.com/JabRef/jabref/commit/ffcaeb6ceb48d772137b1263a53e8542a71f0984", "message": "Removed artifacts and made cleanups", "committedDate": "2020-11-05T15:01:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyMDE0Mw==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r518120143", "bodyText": "In all other cases you use ==.\nWhy not refactor to a switch case?", "author": "Siedlerchr", "createdAt": "2020-11-05T15:04:49Z", "path": "src/main/java/org/jabref/gui/keyboard/EditorKeyBindings.java", "diffHunk": "@@ -0,0 +1,100 @@\n+package org.jabref.gui.keyboard;\n+\n+import java.util.Optional;\n+\n+import javafx.scene.Scene;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.KeyEvent;\n+\n+import org.jabref.gui.Globals;\n+import org.jabref.logic.util.strings.StringManipulator;\n+import org.jabref.model.util.ResultingStringState;\n+import org.jabref.preferences.PreferencesService;\n+\n+public class EditorKeyBindings {\n+\n+    public static void call(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n+        if (scene.focusOwnerProperty().get() instanceof TextInputControl) {\n+\n+            KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n+            TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n+            Optional<KeyBinding> keyBinding = keyBindingRepository.mapToKeyBinding(event);\n+            keyBinding.ifPresent(binding -> {\n+                if (binding.equals(KeyBinding.EDITOR_DELETE)) {", "originalCommit": "ffcaeb6ceb48d772137b1263a53e8542a71f0984", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzNzU1Mg==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r518137552", "bodyText": "I did not yet work on that, had some trouble refactoring and fixing the logic part of this PR which had some defects. But thanks for the note. Next i going to take a look into getting this to work with CodeAreaa and then include a button to fill in presets (like bash keybindings).", "author": "calixtus", "createdAt": "2020-11-05T15:28:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyMDE0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE1Mjc0NA==", "url": "https://github.com/JabRef/jabref/pull/6037#discussion_r518152744", "bodyText": "Good luck, for codeArea you might want to check out this_ https://github.com/FXMisc/RichTextFX/wiki/How-to-Override-the-Default-Behavior", "author": "Siedlerchr", "createdAt": "2020-11-05T15:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyMDE0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "eb6fc8ce2766721fccb28aba4e6301c75fe34648", "chunk": "diff --git a/src/main/java/org/jabref/gui/keyboard/EditorKeyBindings.java b/src/main/java/org/jabref/gui/keyboard/EditorKeyBindings.java\ndeleted file mode 100644\nindex 9be658964..000000000\n--- a/src/main/java/org/jabref/gui/keyboard/EditorKeyBindings.java\n+++ /dev/null\n\n@@ -1,100 +0,0 @@\n-package org.jabref.gui.keyboard;\n-\n-import java.util.Optional;\n-\n-import javafx.scene.Scene;\n-import javafx.scene.control.TextInputControl;\n-import javafx.scene.input.KeyEvent;\n-\n-import org.jabref.gui.Globals;\n-import org.jabref.logic.util.strings.StringManipulator;\n-import org.jabref.model.util.ResultingStringState;\n-import org.jabref.preferences.PreferencesService;\n-\n-public class EditorKeyBindings {\n-\n-    public static void call(Scene scene, KeyEvent event, PreferencesService preferencesService) {\n-        if (scene.focusOwnerProperty().get() instanceof TextInputControl) {\n-\n-            KeyBindingRepository keyBindingRepository = Globals.getKeyPrefs();\n-            TextInputControl focusedTextField = (TextInputControl) scene.focusOwnerProperty().get();\n-            Optional<KeyBinding> keyBinding = keyBindingRepository.mapToKeyBinding(event);\n-            keyBinding.ifPresent(binding -> {\n-                if (binding.equals(KeyBinding.EDITOR_DELETE)) {\n-                    focusedTextField.deleteNextChar();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_BACKWARD) {\n-                    focusedTextField.backward();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_FORWARD) {\n-                    focusedTextField.forward();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_WORD_BACKWARD) {\n-                    focusedTextField.previousWord();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_WORD_FORWARD) {\n-                    focusedTextField.nextWord();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_BEGINNING) {\n-                    focusedTextField.home();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_END) {\n-                    focusedTextField.end();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_BEGINNING_DOC) {\n-                    focusedTextField.home();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_END_DOC) {\n-                    focusedTextField.end();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_UP) {\n-                    focusedTextField.home();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_DOWN) {\n-                    focusedTextField.end();\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_CAPITALIZE) {\n-                    int pos = focusedTextField.getCaretPosition();\n-                    String text = focusedTextField.getText(0, focusedTextField.getText().length());\n-                    ResultingStringState res = StringManipulator.capitalize(pos, text);\n-                    focusedTextField.setText(res.text);\n-                    focusedTextField.positionCaret(res.caretPosition);\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_LOWERCASE) {\n-                    int pos = focusedTextField.getCaretPosition();\n-                    String text = focusedTextField.getText(0, focusedTextField.getText().length());\n-                    ResultingStringState res = StringManipulator.lowercase(pos, text);\n-                    focusedTextField.setText(res.text);\n-                    focusedTextField.positionCaret(res.caretPosition);\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_UPPERCASE) {\n-                    int pos = focusedTextField.getCaretPosition();\n-                    String text = focusedTextField.getText(0, focusedTextField.getText().length());\n-                    ResultingStringState res = StringManipulator.uppercase(pos, text);\n-                    focusedTextField.setText(res.text);\n-                    focusedTextField.positionCaret(res.caretPosition);\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_KILL_LINE) {\n-                    int pos = focusedTextField.getCaretPosition();\n-                    focusedTextField.setText(focusedTextField.getText(0, pos));\n-                    focusedTextField.positionCaret(pos);\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_KILL_WORD) {\n-                    int pos = focusedTextField.getCaretPosition();\n-                    String text = focusedTextField.getText(0, focusedTextField.getText().length());\n-                    ResultingStringState res = StringManipulator.killWord(pos, text);\n-                    focusedTextField.setText(res.text);\n-                    focusedTextField.positionCaret(res.caretPosition);\n-                    event.consume();\n-                } else if (binding == KeyBinding.EDITOR_KILL_WORD_BACKWARD) {\n-                    int pos = focusedTextField.getCaretPosition();\n-                    String text = focusedTextField.getText(0, focusedTextField.getText().length());\n-                    ResultingStringState res = StringManipulator.backwardKillWord(pos, text);\n-                    focusedTextField.setText(res.text);\n-                    focusedTextField.positionCaret(res.caretPosition);\n-                    event.consume();\n-                }\n-            });\n-        }\n-    }\n-}\n"}}, {"oid": "eb6fc8ce2766721fccb28aba4e6301c75fe34648", "url": "https://github.com/JabRef/jabref/commit/eb6fc8ce2766721fccb28aba4e6301c75fe34648", "message": "Added CodeAreaKeyBindings", "committedDate": "2020-11-05T19:27:09Z", "type": "commit"}, {"oid": "a9384e02be6dbf86c314205b63ac28f42482d9b6", "url": "https://github.com/JabRef/jabref/commit/a9384e02be6dbf86c314205b63ac28f42482d9b6", "message": "Added KeyBindingPreset", "committedDate": "2020-11-05T21:38:53Z", "type": "commit"}, {"oid": "0d3a9d091f4763620d76d21642efb7c76aa884f3", "url": "https://github.com/JabRef/jabref/commit/0d3a9d091f4763620d76d21642efb7c76aa884f3", "message": "Changed preset combobox to menubutton", "committedDate": "2020-11-06T14:05:18Z", "type": "commit"}, {"oid": "0c59a82f35fec85408ac85450424e7ef42d8e7b1", "url": "https://github.com/JabRef/jabref/commit/0c59a82f35fec85408ac85450424e7ef42d8e7b1", "message": "l10n and CHANGELOG.md", "committedDate": "2020-11-06T19:33:50Z", "type": "commit"}]}