{"pr_number": 6637, "pr_title": "Fixes issue where Unix crashes when inotify is full", "pr_createdAt": "2020-06-23T23:19:06Z", "pr_url": "https://github.com/JabRef/jabref/pull/6637", "timeline": [{"oid": "151da625e24289df1f7e73bd9724ed12841197fb", "url": "https://github.com/JabRef/jabref/commit/151da625e24289df1f7e73bd9724ed12841197fb", "message": "Workaround for Issue 6073\nPreviously, the program was crashing for Unix users when inotify had reached its max file limit. Since the only way to fix this seems to be to close applications or to edit privileged system files, the proposed solution is to notify the user of the issue and give them the option of continuing usage of the application. fixes #6073", "committedDate": "2020-06-23T23:05:04Z", "type": "commit"}, {"oid": "63dabffe4ef99a715c60429e2c676c780f406042", "url": "https://github.com/JabRef/jabref/commit/63dabffe4ef99a715c60429e2c676c780f406042", "message": "Workaround for Issue 6073\nPreviously, the program was crashing for Unix users when inotify had reached its max file limit. Since the only way to fix this seems to be to close applications or to edit privileged system files, the proposed solution is to notify the user of the issue and give them the option of continuing usage of the application. fixes #6073", "committedDate": "2020-06-23T23:10:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMTg4Mw==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r445301883", "bodyText": "Please use Localization.lang. See https://devdocs.jabref.org/getting-into-the-code/code-howtos#using-localization-correctly.", "author": "koppor", "createdAt": "2020-06-25T04:37:04Z", "path": "src/main/java/org/jabref/JabRefGUI.java", "diffHunk": "@@ -104,6 +104,13 @@ private void openWindow(Stage mainStage) {\n             }\n         });\n         Platform.runLater(this::openDatabases);\n+\n+        if(!(Globals.getFileUpdateMonitor().isActive())) {\n+            this.getMainFrame().getDialogService()\n+                    .showErrorDialogAndWait(\"Unable to monitor file changes. Please close files \" +", "originalCommit": "63dabffe4ef99a715c60429e2c676c780f406042", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5NjM1Mw==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r445896353", "bodyText": "JabRef/user-documentation#286", "author": null, "createdAt": "2020-06-25T23:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMTg4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6a2baf4538d5f7e5bc7a34b156d13470a8cd9f87", "chunk": "diff --git a/src/main/java/org/jabref/JabRefGUI.java b/src/main/java/org/jabref/JabRefGUI.java\nindex 53094899b..6fc914c6c 100644\n--- a/src/main/java/org/jabref/JabRefGUI.java\n+++ b/src/main/java/org/jabref/JabRefGUI.java\n\n@@ -105,7 +105,7 @@ public class JabRefGUI {\n         });\n         Platform.runLater(this::openDatabases);\n \n-        if(!(Globals.getFileUpdateMonitor().isActive())) {\n+        if (!(Globals.getFileUpdateMonitor().isActive())) {\n             this.getMainFrame().getDialogService()\n                     .showErrorDialogAndWait(\"Unable to monitor file changes. Please close files \" +\n                             \"and processes and restart. You may encounter errors if you continue \" +\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQxOA==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r445302418", "bodyText": "I think, it's OK to store the exception (for future work).", "author": "koppor", "createdAt": "2020-06-25T04:39:31Z", "path": "src/main/java/org/jabref/gui/util/DefaultFileUpdateMonitor.java", "diffHunk": "@@ -29,11 +31,14 @@\n \n     private final Multimap<Path, FileUpdateListener> listeners = ArrayListMultimap.create(20, 4);\n     private WatchService watcher;\n+    private Optional<JabRefException> filesystemMonitorFailure;", "originalCommit": "63dabffe4ef99a715c60429e2c676c780f406042", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg1NTI3Mw==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r445855273", "bodyText": "What do you mean? I am not sure what the code change is that you are requesting.", "author": null, "createdAt": "2020-06-25T21:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5MTA3Nw==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r446091077", "bodyText": "This was more a comment to a second reviewer.", "author": "koppor", "createdAt": "2020-06-26T10:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4NjMwNQ==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r446486305", "bodyText": "JabRef/user-documentation#286", "author": null, "createdAt": "2020-06-27T05:10:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQxOA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6a2baf4538d5f7e5bc7a34b156d13470a8cd9f87", "url": "https://github.com/JabRef/jabref/commit/6a2baf4538d5f7e5bc7a34b156d13470a8cd9f87", "message": "Style fix.\nStyle edits according to JabRef preferences.", "committedDate": "2020-06-25T18:43:22Z", "type": "commit"}, {"oid": "a548eb9e2f65449a13843b224bf18d28a35d5593", "url": "https://github.com/JabRef/jabref/commit/a548eb9e2f65449a13843b224bf18d28a35d5593", "message": "Localization instead of raw string.", "committedDate": "2020-06-25T18:49:39Z", "type": "commit"}, {"oid": "53ae78f88aae49c2112dcc16f70207e78ca55585", "url": "https://github.com/JabRef/jabref/commit/53ae78f88aae49c2112dcc16f70207e78ca55585", "message": "Style fix #2.", "committedDate": "2020-06-25T21:06:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5MjUyNw==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r446092527", "bodyText": "The exception was removed here, but not in the interface. I think, it should also be removed here (and the JavaDoc be adapted).\nWith the current implementation, it does not throw an exception if the file does not exist.", "author": "koppor", "createdAt": "2020-06-26T10:06:25Z", "path": "src/main/java/org/jabref/model/util/DummyFileUpdateMonitor.java", "diffHunk": "@@ -9,12 +8,17 @@\n  */\n public class DummyFileUpdateMonitor implements FileUpdateMonitor {\n     @Override\n-    public void addListenerForFile(Path file, FileUpdateListener listener) throws IOException {\n+    public void addListenerForFile(Path file, FileUpdateListener listener) {", "originalCommit": "53ae78f88aae49c2112dcc16f70207e78ca55585", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5MzQ5NQ==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r446093495", "bodyText": "I think, this has to go in one line so that the localization consistency check works. --> We have all keys in Localiazation_en.properties and a check checking all .java files whether the key set in the property file matches the language keys used in the code.", "author": "koppor", "createdAt": "2020-06-26T10:08:34Z", "path": "src/main/java/org/jabref/JabRefGUI.java", "diffHunk": "@@ -104,6 +104,13 @@ private void openWindow(Stage mainStage) {\n             }\n         });\n         Platform.runLater(this::openDatabases);\n+\n+        if (!(Globals.getFileUpdateMonitor().isActive())) {\n+            this.getMainFrame().getDialogService()\n+                    .showErrorDialogAndWait(Localization.lang(\"Unable to monitor file changes. Please close files \" +", "originalCommit": "53ae78f88aae49c2112dcc16f70207e78ca55585", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5NjM4MQ==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r446096381", "bodyText": "Just run LocalizationConsistencyTest under l10n", "author": "Siedlerchr", "createdAt": "2020-06-26T10:14:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5MzQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQxNzIwNA==", "url": "https://github.com/JabRef/jabref/pull/6637#discussion_r448417204", "bodyText": "I added this to Localization_en.properties and LocalizationConsistencyTest passes all 49 checks.", "author": null, "createdAt": "2020-07-01T14:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5MzQ5NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ec1b2bb72ac9c6fae1e7d7d6b583b794d18b00e4", "url": "https://github.com/JabRef/jabref/commit/ec1b2bb72ac9c6fae1e7d7d6b583b794d18b00e4", "message": "Localization addition.\n\nAdded #6073 error message to localizaiton file.", "committedDate": "2020-07-01T14:42:57Z", "type": "commit"}, {"oid": "2b14b4d8865cf370aaa66e7a636148f25dc2663a", "url": "https://github.com/JabRef/jabref/commit/2b14b4d8865cf370aaa66e7a636148f25dc2663a", "message": "Minor stylistic update", "committedDate": "2020-07-01T18:51:06Z", "type": "commit"}]}