{"pr_number": 6842, "pr_title": "Add error dialog \"Problem finding files\"", "pr_createdAt": "2020-09-02T11:16:21Z", "pr_url": "https://github.com/JabRef/jabref/pull/6842", "timeline": [{"oid": "d4bd5941d791e30fa07e2e9234cbe6e3dad17793", "url": "https://github.com/JabRef/jabref/commit/d4bd5941d791e30fa07e2e9234cbe6e3dad17793", "message": "#5890 added Error Dialog\n\nAutoSetFileLinksUtil:\n-> imported JabRefDialogService and Localization\n->showErrorDialogAndWait(...)\n\nI am currently having trouble writing a test", "committedDate": "2020-09-02T10:53:29Z", "type": "commit"}, {"oid": "5d77abb04b5f289c5c8e826a5b75afd3c3245417", "url": "https://github.com/JabRef/jabref/commit/5d77abb04b5f289c5c8e826a5b75afd3c3245417", "message": "Merge branch 'master' into fix-issue-5890", "committedDate": "2020-09-02T11:24:48Z", "type": "commit"}, {"oid": "f8a3175657aa473db22a66e536fa1a9d49f1bfd8", "url": "https://github.com/JabRef/jabref/commit/f8a3175657aa473db22a66e536fa1a9d49f1bfd8", "message": "Fix errorDialog AutoSetFileLinks\n\nFixed mistake in first commit.\n\n.lists all exceptions\n.notifies user of error via DialogService", "committedDate": "2020-09-03T11:04:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwMjg2OQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r482902869", "bodyText": "I would propose to move this into the succeeded methoid here :\n\n  \n    \n      jabref/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n    \n    \n        Lines 60 to 68\n      in\n      5ab494e\n    \n    \n    \n    \n\n        \n          \n           Task<List<BibEntry>> linkFilesTask = new Task<>() { \n        \n\n        \n          \n            \n        \n\n        \n          \n               @Override \n        \n\n        \n          \n               protected List<BibEntry> call() { \n        \n\n        \n          \n                   return util.linkAssociatedFiles(entries, nc); \n        \n\n        \n          \n               } \n        \n\n        \n          \n            \n        \n\n        \n          \n               @Override \n        \n\n        \n          \n               protected void succeeded() {", "author": "Siedlerchr", "createdAt": "2020-09-03T11:21:06Z", "path": "src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java", "diffHunk": "@@ -48,16 +52,24 @@ private AutoSetFileLinksUtil(List<Path> directories, AutoLinkPreferences autoLin\n \n     public List<BibEntry> linkAssociatedFiles(List<BibEntry> entries, NamedCompound ce) {\n         List<BibEntry> changedEntries = new ArrayList<>();\n+\n+        List<IOException> fileExceptions = new ArrayList<>(); //change\n         for (BibEntry entry : entries) {\n \n             List<LinkedFile> linkedFiles = new ArrayList<>();\n             try {\n                 linkedFiles = findAssociatedNotLinkedFiles(entry);\n             } catch (IOException e) {\n+                fileExceptions.add(e); //change\n                 LOGGER.error(\"Problem finding files\", e);\n+\n             }\n \n             if (ce != null) {\n+                if (!fileExceptions.isEmpty()) { // is this where it goes? find out!", "originalCommit": "f8a3175657aa473db22a66e536fa1a9d49f1bfd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUyMTYwMg==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r483521602", "bodyText": "Oh ok, thank you. Can I ask you a few questions about the succeeded() method?\nAs far as I understood, it notifies the user when it has set the file links, i.e. when the returned List of linkAssociatedFiles(...) is not empty. In the other case Finished automatically setting external links. No files found.  I haven't quite understood yet, how this else case is different from what I am trying to accomplish.", "author": "IfIWantedTo", "createdAt": "2020-09-04T10:07:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwMjg2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0NzIwOQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r495247209", "bodyText": "Sorry for the delay in answering. The succeeded method is called whenever the task is finished normally and doesn't get interrupted.\nIt either says files found or no files found, but it doesn't tell the user if there was an error (exception) which prevented  finding the files.\nSo one addtional else case (your changes) is to notify the users that there have been X exceptions with the hint\ne.g. There were x files with an exception. See log for details", "author": "Siedlerchr", "createdAt": "2020-09-25T21:32:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwMjg2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "d8d70d2d054bce726f548b4d16e0657a7d16851b", "chunk": "diff --git a/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java b/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\nindex 7a30877234..1f4253b5a7 100644\n--- a/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\n+++ b/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\n\n@@ -52,8 +51,8 @@ public class AutoSetFileLinksUtil {\n \n     public List<BibEntry> linkAssociatedFiles(List<BibEntry> entries, NamedCompound ce) {\n         List<BibEntry> changedEntries = new ArrayList<>();\n-\n-        List<IOException> fileExceptions = new ArrayList<>(); //change\n+        fileExceptions.clear(); //change\n+        //change\n         for (BibEntry entry : entries) {\n \n             List<LinkedFile> linkedFiles = new ArrayList<>();\n"}}, {"oid": "d8d70d2d054bce726f548b4d16e0657a7d16851b", "url": "https://github.com/JabRef/jabref/commit/d8d70d2d054bce726f548b4d16e0657a7d16851b", "message": "Fix notifying in AutoSetFileLinksAction\n\n- add  returnFileExceptions() in AutoSetFileLinksUtil\n- add if ( 'there are exceptions' ) -> notify user in AutoSetFileLinkAction (placement still unclear, might be changed later)", "committedDate": "2020-09-04T10:13:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1NDQwMg==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r496454402", "bodyText": "You need to add another else case when the exceptions are not empty:\nProblem finding files.  Errors occured See log for details", "author": "Siedlerchr", "createdAt": "2020-09-29T06:47:00Z", "path": "src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java", "diffHunk": "@@ -66,14 +66,19 @@ public void execute() {\n \n             @Override\n             protected void succeeded() {\n-                if (!getValue().isEmpty()) {\n-                    if (nc.hasEdits()) {\n-                        nc.end();\n-                        undoManager.addEdit(nc);\n+                if (util.returnFileExceptions().isEmpty()) { //change\n+                    if (!getValue().isEmpty()) {\n+                        if (nc.hasEdits()) {\n+                            nc.end();\n+                            undoManager.addEdit(nc);\n+                        }\n+                        dialogService.notify(Localization.lang(\"Finished automatically setting external links.\"));\n+                    } else {\n+                        dialogService.notify(Localization.lang(\"Finished automatically setting external links.\") + \" \" + Localization.lang(\"No files found.\"));\n                     }\n-                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\"));\n                 } else {\n-                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\") + \" \" + Localization.lang(\"No files found.\"));\n+\n+                    dialogService.notify(Localization.lang(\"Problem finding files\")); //change", "originalCommit": "d8d70d2d054bce726f548b4d16e0657a7d16851b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1NjE0NQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r496456145", "bodyText": "And when no exception and getValue is empty => No files found", "author": "Siedlerchr", "createdAt": "2020-09-29T06:50:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1NDQwMg=="}], "type": "inlineReview", "revised_code": {"commit": "fac9c37c1b98b5aed279a4a161c036c7743435e8", "chunk": "diff --git a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\nindex f4d59e03dd..1008c1624d 100644\n--- a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n+++ b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n\n@@ -43,43 +42,53 @@ public class AutoLinkFilesAction extends SimpleCommand {\n \n         this.executable.bind(needsDatabase(this.stateManager).and(needsEntriesSelected(stateManager)));\n         this.statusMessage.bind(BindingsHelper.ifThenElse(executable, \"\", Localization.lang(\"This operation requires one or more entries to be selected.\")));\n-\n     }\n \n     @Override\n     public void execute() {\n-        BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n-        List<BibEntry> entries = stateManager.getSelectedEntries();\n-\n-        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n-        AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n+        final BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        final List<BibEntry> entries = stateManager.getSelectedEntries();\n+        final AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n                 database,\n                 preferences.getFilePreferences(),\n                 preferences.getAutoLinkPreferences(),\n                 ExternalFileTypes.getInstance());\n-        Task<List<BibEntry>> linkFilesTask = new Task<>() {\n+        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n+\n+        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {\n+            dialogService.notify(Localization.lang(\"The selected entries do not have any file links attached.\"));\n+            return;\n+        }\n \n+        Task<AutoSetFileLinksUtil.LinkFilesResult> linkFilesTask = new Task<>() {\n             @Override\n-            protected List<BibEntry> call() {\n+            protected AutoSetFileLinksUtil.LinkFilesResult call() {\n                 return util.linkAssociatedFiles(entries, nc);\n             }\n \n             @Override\n             protected void succeeded() {\n-                if (util.returnFileExceptions().isEmpty()) { //change\n-                    if (!getValue().isEmpty()) {\n-                        if (nc.hasEdits()) {\n-                            nc.end();\n-                            undoManager.addEdit(nc);\n-                        }\n-                        dialogService.notify(Localization.lang(\"Finished automatically setting external links.\"));\n-                    } else {\n-                        dialogService.notify(Localization.lang(\"Finished automatically setting external links.\") + \" \" + Localization.lang(\"No files found.\"));\n-                    }\n-                } else {\n-\n-                    dialogService.notify(Localization.lang(\"Problem finding files\")); //change\n+                AutoSetFileLinksUtil.LinkFilesResult result = getValue();\n+\n+                if (!result.getFileExceptions().isEmpty()) {\n+                    dialogService.notify(Localization.lang(\"Problem finding files. See error log for details.\"));\n+                    return;\n                 }\n+\n+                if (result.getBibEntries().isEmpty()) {\n+                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\")\n+                            + \" \" + Localization.lang(\"No files found.\"));\n+                    return;\n+                }\n+\n+                if (nc.hasEdits()) {\n+                    nc.end();\n+                    undoManager.addEdit(nc);\n+                }\n+\n+                dialogService.notify(Localization.lang(\n+                        \"Finished automatically setting external links. Changed %0 entries.\",\n+                        String.valueOf(result.getBibEntries().size())));\n             }\n         };\n \n"}}, {"oid": "90ab47808d153ab838fdbf46d1a21e30d273cb24", "url": "https://github.com/JabRef/jabref/commit/90ab47808d153ab838fdbf46d1a21e30d273cb24", "message": "Fixed checkstyle error in AutoSetFileLinksUtilTest", "committedDate": "2020-09-29T06:47:26Z", "type": "commit"}, {"oid": "ee5e7cf85576d4ced8b98c938dbc77a8da3c006e", "url": "https://github.com/JabRef/jabref/commit/ee5e7cf85576d4ced8b98c938dbc77a8da3c006e", "message": "Fixed import order in JabRefFrame", "committedDate": "2020-09-29T06:49:54Z", "type": "commit"}, {"oid": "355f6ff3debb8a811cea1423eaaf855f4df3c9b2", "url": "https://github.com/JabRef/jabref/commit/355f6ff3debb8a811cea1423eaaf855f4df3c9b2", "message": "Update JabRefFrame.java", "committedDate": "2020-09-29T06:50:20Z", "type": "commit"}, {"oid": "e765f264a4206f5ca861aebc6df0c297b9cdb7ca", "url": "https://github.com/JabRef/jabref/commit/e765f264a4206f5ca861aebc6df0c297b9cdb7ca", "message": "Merge branch 'fix-issue-5890' of https://github.com/IfIWantedTo/jabref into IfIWantedTo-fix-issue-5890", "committedDate": "2020-12-12T17:55:01Z", "type": "commit"}, {"oid": "dbedcde7835663000b06444ab5f02407ad0c5caa", "url": "https://github.com/JabRef/jabref/commit/dbedcde7835663000b06444ab5f02407ad0c5caa", "message": "Merge remote-tracking branch 'upstream/master' into IfIWantedTo-fix-issue-5890", "committedDate": "2020-12-12T17:55:45Z", "type": "commit"}, {"oid": "445ca394b1900dce02c1a18a8365b16c585f5eb6", "url": "https://github.com/JabRef/jabref/commit/445ca394b1900dce02c1a18a8365b16c585f5eb6", "message": "Merge remote-tracking branch 'upstream/master' into IfIWantedTo-fix-issue-5890", "committedDate": "2020-12-15T15:58:57Z", "type": "commit"}, {"oid": "fac9c37c1b98b5aed279a4a161c036c7743435e8", "url": "https://github.com/JabRef/jabref/commit/fac9c37c1b98b5aed279a4a161c036c7743435e8", "message": "Refactored to fail fast", "committedDate": "2020-12-15T23:00:21Z", "type": "commit"}, {"oid": "c351314ae60722a858447fa0c81e554eb99df801", "url": "https://github.com/JabRef/jabref/commit/c351314ae60722a858447fa0c81e554eb99df801", "message": "Update JabRef_en.properties", "committedDate": "2020-12-15T23:21:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5NzIyNQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r544597225", "bodyText": "entries.stream().anyMatch(entry -> !entries.getFiles().isEmpty()) is probably easier to understand.", "author": "tobiasdiez", "createdAt": "2020-12-16T20:21:35Z", "path": "src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java", "diffHunk": "@@ -34,47 +33,62 @@\n     private final UndoManager undoManager;\n     private final TaskExecutor taskExecutor;\n \n-    public AutoLinkFilesAction(JabRefFrame frame, PreferencesService preferences, StateManager stateManager, UndoManager undoManager, TaskExecutor taskExecutor) {\n-        this.dialogService = frame.getDialogService();\n+    public AutoLinkFilesAction(DialogService dialogService, PreferencesService preferences, StateManager stateManager, UndoManager undoManager, TaskExecutor taskExecutor) {\n+        this.dialogService = dialogService;\n         this.preferences = preferences;\n         this.stateManager = stateManager;\n         this.undoManager = undoManager;\n         this.taskExecutor = taskExecutor;\n \n         this.executable.bind(needsDatabase(this.stateManager).and(needsEntriesSelected(stateManager)));\n         this.statusMessage.bind(BindingsHelper.ifThenElse(executable, \"\", Localization.lang(\"This operation requires one or more entries to be selected.\")));\n-\n     }\n \n     @Override\n     public void execute() {\n-        BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n-        List<BibEntry> entries = stateManager.getSelectedEntries();\n-\n-        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n-        AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n+        final BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        final List<BibEntry> entries = stateManager.getSelectedEntries();\n+        final AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n                 database,\n                 preferences.getFilePreferences(),\n                 preferences.getAutoLinkPreferences(),\n                 ExternalFileTypes.getInstance());\n-        Task<List<BibEntry>> linkFilesTask = new Task<>() {\n+        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n+\n+        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {", "originalCommit": "c351314ae60722a858447fa0c81e554eb99df801", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5ODkxNQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r544598915", "bodyText": "But why is this check added in the first place? The autolinkfiles feature tries to find and link new files, so I don't understand why the entry already needs to have a file linked?", "author": "tobiasdiez", "createdAt": "2020-12-16T20:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5NzIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwODYwMg==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r545408602", "bodyText": "As I understand this feature, this calls AutoLinkFilesLinkUtil::findAssociatedNotLinkedFiles to check for broken file links. But those are also represented by a LinkedFile. So this feature tries to repair the links.", "author": "calixtus", "createdAt": "2020-12-17T21:15:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5NzIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTczMzEyOQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r545733129", "bodyText": "It looks for files on disk that are matched by the citation key (= \"associated\", probably a bad name), but which are not yet have this file in the file field (= \"linked\"). \n  \n    \n      jabref/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\n    \n    \n        Lines 88 to 92\n      in\n      a13f307\n    \n    \n    \n    \n\n        \n          \n           List<Path> result = fileFinder.findAssociatedFiles(entry, directories, extensions); \n        \n\n        \n          \n            \n        \n\n        \n          \n           // Collect the found files that are not yet linked \n        \n\n        \n          \n           for (Path foundFile : result) { \n        \n\n        \n          \n               boolean fileAlreadyLinked = entry.getFiles().stream() \n        \n    \n  \n\n\nSo it's not about existing links that no longer point to a valid file (I think we have an integrity check for this though).", "author": "tobiasdiez", "createdAt": "2020-12-18T10:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5NzIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc4MzQ2Ng==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r545783466", "bodyText": "Oh ok. I totally misunderstood this. Sorry. I'll change that.", "author": "calixtus", "createdAt": "2020-12-18T11:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5NzIyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "36d8140fcd00c6591fc1f89b4ae1eab8d08bd485", "chunk": "diff --git a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\nindex 1008c1624d..6c51f8889d 100644\n--- a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n+++ b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n\n@@ -55,11 +55,6 @@ public class AutoLinkFilesAction extends SimpleCommand {\n                 ExternalFileTypes.getInstance());\n         final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n \n-        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {\n-            dialogService.notify(Localization.lang(\"The selected entries do not have any file links attached.\"));\n-            return;\n-        }\n-\n         Task<AutoSetFileLinksUtil.LinkFilesResult> linkFilesTask = new Task<>() {\n             @Override\n             protected AutoSetFileLinksUtil.LinkFilesResult call() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5OTYzOQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r544599639", "bodyText": "maybe rename to getChangedEntries ?", "author": "tobiasdiez", "createdAt": "2020-12-16T20:25:43Z", "path": "src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java", "diffHunk": "@@ -31,10 +31,31 @@\n \n public class AutoSetFileLinksUtil {\n \n+    public static class LinkFilesResult {\n+        private final List<BibEntry> changedEntries = new ArrayList<>();\n+        private final List<IOException> fileExceptions = new ArrayList<>();\n+\n+        protected void addBibEntry(BibEntry bibEntry) {\n+            changedEntries.add(bibEntry);\n+        }\n+\n+        protected void addFileException(IOException exception) {\n+            fileExceptions.add(exception);\n+        }\n+\n+        public List<BibEntry> getBibEntries() {", "originalCommit": "c351314ae60722a858447fa0c81e554eb99df801", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "36d8140fcd00c6591fc1f89b4ae1eab8d08bd485", "chunk": "diff --git a/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java b/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\nindex 51bd443f5b..e783ee0aed 100644\n--- a/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\n+++ b/src/main/java/org/jabref/gui/externalfiles/AutoSetFileLinksUtil.java\n\n@@ -43,7 +43,7 @@ public class AutoSetFileLinksUtil {\n             fileExceptions.add(exception);\n         }\n \n-        public List<BibEntry> getBibEntries() {\n+        public List<BibEntry> getChangedEntries() {\n             return changedEntries;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYwMDMyMw==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r544600323", "bodyText": "I think this should be a normal dialog. I would reserve notify for \"everything went well\"-messages.", "author": "tobiasdiez", "createdAt": "2020-12-16T20:26:52Z", "path": "src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java", "diffHunk": "@@ -34,47 +33,62 @@\n     private final UndoManager undoManager;\n     private final TaskExecutor taskExecutor;\n \n-    public AutoLinkFilesAction(JabRefFrame frame, PreferencesService preferences, StateManager stateManager, UndoManager undoManager, TaskExecutor taskExecutor) {\n-        this.dialogService = frame.getDialogService();\n+    public AutoLinkFilesAction(DialogService dialogService, PreferencesService preferences, StateManager stateManager, UndoManager undoManager, TaskExecutor taskExecutor) {\n+        this.dialogService = dialogService;\n         this.preferences = preferences;\n         this.stateManager = stateManager;\n         this.undoManager = undoManager;\n         this.taskExecutor = taskExecutor;\n \n         this.executable.bind(needsDatabase(this.stateManager).and(needsEntriesSelected(stateManager)));\n         this.statusMessage.bind(BindingsHelper.ifThenElse(executable, \"\", Localization.lang(\"This operation requires one or more entries to be selected.\")));\n-\n     }\n \n     @Override\n     public void execute() {\n-        BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n-        List<BibEntry> entries = stateManager.getSelectedEntries();\n-\n-        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n-        AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n+        final BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        final List<BibEntry> entries = stateManager.getSelectedEntries();\n+        final AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n                 database,\n                 preferences.getFilePreferences(),\n                 preferences.getAutoLinkPreferences(),\n                 ExternalFileTypes.getInstance());\n-        Task<List<BibEntry>> linkFilesTask = new Task<>() {\n+        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n+\n+        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {\n+            dialogService.notify(Localization.lang(\"The selected entries do not have any file links attached.\"));\n+            return;\n+        }\n \n+        Task<AutoSetFileLinksUtil.LinkFilesResult> linkFilesTask = new Task<>() {\n             @Override\n-            protected List<BibEntry> call() {\n+            protected AutoSetFileLinksUtil.LinkFilesResult call() {\n                 return util.linkAssociatedFiles(entries, nc);\n             }\n \n             @Override\n             protected void succeeded() {\n-                if (!getValue().isEmpty()) {\n-                    if (nc.hasEdits()) {\n-                        nc.end();\n-                        undoManager.addEdit(nc);\n-                    }\n-                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\"));\n-                } else {\n-                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\") + \" \" + Localization.lang(\"No files found.\"));\n+                AutoSetFileLinksUtil.LinkFilesResult result = getValue();\n+\n+                if (!result.getFileExceptions().isEmpty()) {\n+                    dialogService.notify(Localization.lang(\"Problem finding files. See error log for details.\"));", "originalCommit": "c351314ae60722a858447fa0c81e554eb99df801", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "36d8140fcd00c6591fc1f89b4ae1eab8d08bd485", "chunk": "diff --git a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\nindex 1008c1624d..6c51f8889d 100644\n--- a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n+++ b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n\n@@ -55,11 +55,6 @@ public class AutoLinkFilesAction extends SimpleCommand {\n                 ExternalFileTypes.getInstance());\n         final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n \n-        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {\n-            dialogService.notify(Localization.lang(\"The selected entries do not have any file links attached.\"));\n-            return;\n-        }\n-\n         Task<AutoSetFileLinksUtil.LinkFilesResult> linkFilesTask = new Task<>() {\n             @Override\n             protected AutoSetFileLinksUtil.LinkFilesResult call() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYwMDk5OQ==", "url": "https://github.com/JabRef/jabref/pull/6842#discussion_r544600999", "bodyText": "Reuse Localization.lang(\"Finished automatically setting external links.\") from above by splitting the Localization.lang(...) here.", "author": "tobiasdiez", "createdAt": "2020-12-16T20:28:04Z", "path": "src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java", "diffHunk": "@@ -34,47 +33,62 @@\n     private final UndoManager undoManager;\n     private final TaskExecutor taskExecutor;\n \n-    public AutoLinkFilesAction(JabRefFrame frame, PreferencesService preferences, StateManager stateManager, UndoManager undoManager, TaskExecutor taskExecutor) {\n-        this.dialogService = frame.getDialogService();\n+    public AutoLinkFilesAction(DialogService dialogService, PreferencesService preferences, StateManager stateManager, UndoManager undoManager, TaskExecutor taskExecutor) {\n+        this.dialogService = dialogService;\n         this.preferences = preferences;\n         this.stateManager = stateManager;\n         this.undoManager = undoManager;\n         this.taskExecutor = taskExecutor;\n \n         this.executable.bind(needsDatabase(this.stateManager).and(needsEntriesSelected(stateManager)));\n         this.statusMessage.bind(BindingsHelper.ifThenElse(executable, \"\", Localization.lang(\"This operation requires one or more entries to be selected.\")));\n-\n     }\n \n     @Override\n     public void execute() {\n-        BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n-        List<BibEntry> entries = stateManager.getSelectedEntries();\n-\n-        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n-        AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n+        final BibDatabaseContext database = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        final List<BibEntry> entries = stateManager.getSelectedEntries();\n+        final AutoSetFileLinksUtil util = new AutoSetFileLinksUtil(\n                 database,\n                 preferences.getFilePreferences(),\n                 preferences.getAutoLinkPreferences(),\n                 ExternalFileTypes.getInstance());\n-        Task<List<BibEntry>> linkFilesTask = new Task<>() {\n+        final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n+\n+        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {\n+            dialogService.notify(Localization.lang(\"The selected entries do not have any file links attached.\"));\n+            return;\n+        }\n \n+        Task<AutoSetFileLinksUtil.LinkFilesResult> linkFilesTask = new Task<>() {\n             @Override\n-            protected List<BibEntry> call() {\n+            protected AutoSetFileLinksUtil.LinkFilesResult call() {\n                 return util.linkAssociatedFiles(entries, nc);\n             }\n \n             @Override\n             protected void succeeded() {\n-                if (!getValue().isEmpty()) {\n-                    if (nc.hasEdits()) {\n-                        nc.end();\n-                        undoManager.addEdit(nc);\n-                    }\n-                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\"));\n-                } else {\n-                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\") + \" \" + Localization.lang(\"No files found.\"));\n+                AutoSetFileLinksUtil.LinkFilesResult result = getValue();\n+\n+                if (!result.getFileExceptions().isEmpty()) {\n+                    dialogService.notify(Localization.lang(\"Problem finding files. See error log for details.\"));\n+                    return;\n                 }\n+\n+                if (result.getBibEntries().isEmpty()) {\n+                    dialogService.notify(Localization.lang(\"Finished automatically setting external links.\")\n+                            + \" \" + Localization.lang(\"No files found.\"));\n+                    return;\n+                }\n+\n+                if (nc.hasEdits()) {\n+                    nc.end();\n+                    undoManager.addEdit(nc);\n+                }\n+\n+                dialogService.notify(Localization.lang(\n+                        \"Finished automatically setting external links. Changed %0 entries.\",", "originalCommit": "c351314ae60722a858447fa0c81e554eb99df801", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "36d8140fcd00c6591fc1f89b4ae1eab8d08bd485", "chunk": "diff --git a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\nindex 1008c1624d..6c51f8889d 100644\n--- a/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n+++ b/src/main/java/org/jabref/gui/externalfiles/AutoLinkFilesAction.java\n\n@@ -55,11 +55,6 @@ public class AutoLinkFilesAction extends SimpleCommand {\n                 ExternalFileTypes.getInstance());\n         final NamedCompound nc = new NamedCompound(Localization.lang(\"Automatically set file links\"));\n \n-        if (entries.stream().mapToInt(entry -> entry.getFiles().size()).sum() == 0) {\n-            dialogService.notify(Localization.lang(\"The selected entries do not have any file links attached.\"));\n-            return;\n-        }\n-\n         Task<AutoSetFileLinksUtil.LinkFilesResult> linkFilesTask = new Task<>() {\n             @Override\n             protected AutoSetFileLinksUtil.LinkFilesResult call() {\n"}}, {"oid": "36d8140fcd00c6591fc1f89b4ae1eab8d08bd485", "url": "https://github.com/JabRef/jabref/commit/36d8140fcd00c6591fc1f89b4ae1eab8d08bd485", "message": "Included remarks", "committedDate": "2020-12-18T13:43:06Z", "type": "commit"}, {"oid": "fc07f289b2d7370d1fcab43f554a4354ebfb8955", "url": "https://github.com/JabRef/jabref/commit/fc07f289b2d7370d1fcab43f554a4354ebfb8955", "message": "Merge remote-tracking branch 'IfIWantedTo/fix-issue-5890' into IfIWantedTo-fix-issue-5890", "committedDate": "2020-12-18T13:47:25Z", "type": "commit"}, {"oid": "12fefda8b78bdf58af00c0765a9a70e12bd6049f", "url": "https://github.com/JabRef/jabref/commit/12fefda8b78bdf58af00c0765a9a70e12bd6049f", "message": "Merge error", "committedDate": "2020-12-18T13:50:50Z", "type": "commit"}]}