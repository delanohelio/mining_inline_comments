{"pr_number": 6402, "pr_title": "Fix action helper when no library is open", "pr_createdAt": "2020-05-03T14:13:03Z", "pr_url": "https://github.com/JabRef/jabref/pull/6402", "timeline": [{"oid": "4e480793b8e6cc1437d70b6f34b4f409164a6a73", "url": "https://github.com/JabRef/jabref/commit/4e480793b8e6cc1437d70b6f34b4f409164a6a73", "message": "Fix action helper when no library is open", "committedDate": "2020-05-03T14:10:45Z", "type": "commit"}, {"oid": "70e8077ed62f07998018e654b1ced460fb44e595", "url": "https://github.com/JabRef/jabref/commit/70e8077ed62f07998018e654b1ced460fb44e595", "message": "Merge remote-tracking branch 'upstream/master' into fixactionHelperEmptyLib\n\n* upstream/master: (23 commits)\n  Make wrap fields also visible in entry editor (#6315)\n  Add launcher to fix extension import in snap (#6439)\n  add concise message when SaveException happen (#6444)\n  Squashed 'src/main/resources/csl-locales/' changes from 79845b087b..cbb45961b8\n  Squashed 'src/main/resources/csl-styles/' changes from 906cd6d43d..270cd3209b\n  Addition to the early pull #6438 (#6441)\n  Fix the bug #6421 (#6438)\n  Cleanup dead code (#6436)\n  Fixed entry duplication on file download (#6437)\n  Add workaround for buildSrc issue (#6433)\n  Remove dash from illegal characters. (#6300)\n  Docs: For developers: New architectural decision added to list (#6397)\n  Added a download checkbox to the import dialog (#6381)\n  Bump jaxb-xjc from 2.3.2 to 2.3.3 (#6410)\n  Bump flexmark-ext-gfm-strikethrough from 0.61.20 to 0.61.24 (#6413)\n  Bump byte-buddy-parent from 1.10.9 to 1.10.10 (#6408)\n  Bump flexmark-ext-gfm-tasklist from 0.61.20 to 0.61.24 (#6412)\n  Bump org.beryx.jlink from 2.17.8 to 2.18.0 (#6411)\n  Bump tika-core from 1.24 to 1.24.1 (#6409)\n  Bump flexmark from 0.61.20 to 0.61.24 (#6416)\n  ...", "committedDate": "2020-05-08T18:49:12Z", "type": "commit"}, {"oid": "a3eff0c49c0c63c626f2a6a324b4459000fc7fca", "url": "https://github.com/JabRef/jabref/commit/a3eff0c49c0c63c626f2a6a324b4459000fc7fca", "message": "Refactor", "committedDate": "2020-05-08T19:06:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyMTMxNg==", "url": "https://github.com/JabRef/jabref/pull/6402#discussion_r422521316", "bodyText": "I think this does not update the status if a file is added to the currently selected entry. For this, the isAnyFieldSetForSelectedEntry method uses flatMap instead of map.", "author": "tobiasdiez", "createdAt": "2020-05-09T17:11:23Z", "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "diffHunk": "@@ -50,18 +50,23 @@ public static BooleanExpression isAnyFieldSetForSelectedEntry(List<Field> fields\n     }\n \n     public static BooleanExpression isFilePresentForSelectedEntry(StateManager stateManager, PreferencesService preferencesService) {\n-        return Bindings.createBooleanBinding(() -> {\n-                    List<LinkedFile> files = stateManager.getSelectedEntries().get(0).getFiles();\n-                    if ((files.size() > 0) && stateManager.getActiveDatabase().isPresent()) {\n-                        Optional<Path> filename = FileHelper.find(\n-                                stateManager.getActiveDatabase().get(),\n-                                files.get(0).getLink(),\n-                                preferencesService.getFilePreferences());\n-                        return filename.isPresent();\n-                    } else {\n-                        return false;\n-                    }\n-                }, stateManager.getSelectedEntries(),\n-                stateManager.getSelectedEntries().get(0).getFieldBinding(StandardField.FILE));\n+\n+        ObservableList<BibEntry> selectedEntries = stateManager.getSelectedEntries();\n+        MonadicObservableValue<Boolean> fileIsPresent = EasyBind.monadic(Bindings.valueAt(selectedEntries, 0)).map(entry -> {\n+            List<LinkedFile> files = entry.getFiles();", "originalCommit": "a3eff0c49c0c63c626f2a6a324b4459000fc7fca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTk1Mg==", "url": "https://github.com/JabRef/jabref/pull/6402#discussion_r422525952", "bodyText": "I just tested it, it works as well when I add or remove a file to an entry both the context menu and the View menu get updated with the correct status", "author": "Siedlerchr", "createdAt": "2020-05-09T17:55:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyMTMxNg=="}], "type": "inlineReview", "revised_code": null}]}