{"pr_number": 7036, "pr_title": "Added error msg when isbn entry was not found", "pr_createdAt": "2020-10-22T13:01:49Z", "pr_url": "https://github.com/JabRef/jabref/pull/7036", "timeline": [{"oid": "f31a2d3abb14697427438e6b25944fd842884efd", "url": "https://github.com/JabRef/jabref/commit/f31a2d3abb14697427438e6b25944fd842884efd", "message": "add error msg when isbn entry not found", "committedDate": "2020-10-22T12:56:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MTA4NA==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510261084", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        LOGGER.error(\"ISBN \" + identifier + \" not found at ottobib\");\n          \n          \n            \n                        LOGGER.error(\"ISBN { } not found at ottobib\", identifier);\n          \n      \n    \n    \n  \n\nThis is the recommended way", "author": "Siedlerchr", "createdAt": "2020-10-22T15:36:28Z", "path": "src/main/java/org/jabref/logic/importer/fetcher/IsbnViaOttoBibFetcher.java", "diffHunk": "@@ -58,6 +58,13 @@ public URL getUrlForIdentifier(String identifier) throws URISyntaxException, Mal\n             throw new FetcherException(\"Could not \", e);\n         }\n         Element textArea = html.select(\"textarea\").first();\n+\n+        // inspect the \"no results\" error message (if there is one)\n+        Element potentialErrorMessageDiv = html.select(\"div#flash-notice.notice.add-bottom\").first();\n+        if (potentialErrorMessageDiv.hasText() && potentialErrorMessageDiv.text().contains(\"No Results\")) {\n+            LOGGER.error(\"ISBN \" + identifier + \" not found at ottobib\");", "originalCommit": "f31a2d3abb14697427438e6b25944fd842884efd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "06ff6968d94eea78f6f406be657effe103c275b1", "chunk": "diff --git a/src/main/java/org/jabref/logic/importer/fetcher/IsbnViaOttoBibFetcher.java b/src/main/java/org/jabref/logic/importer/fetcher/IsbnViaOttoBibFetcher.java\nindex a44de470c..30e6f8513 100644\n--- a/src/main/java/org/jabref/logic/importer/fetcher/IsbnViaOttoBibFetcher.java\n+++ b/src/main/java/org/jabref/logic/importer/fetcher/IsbnViaOttoBibFetcher.java\n\n@@ -60,9 +60,9 @@ public class IsbnViaOttoBibFetcher extends AbstractIsbnFetcher {\n         Element textArea = html.select(\"textarea\").first();\n \n         // inspect the \"no results\" error message (if there is one)\n-        Element potentialErrorMessageDiv = html.select(\"div#flash-notice.notice.add-bottom\").first();\n-        if (potentialErrorMessageDiv.hasText() && potentialErrorMessageDiv.text().contains(\"No Results\")) {\n-            LOGGER.error(\"ISBN \" + identifier + \" not found at ottobib\");\n+        Optional<Element> potentialErrorMessageDiv = Optional.ofNullable((html.select(\"div#flash-notice.notice.add-bottom\").first()));\n+        if (potentialErrorMessageDiv.isPresent() && potentialErrorMessageDiv.get().text().contains(\"No Results\")) {\n+            LOGGER.error(\"ISBN {} not found at ottobib\", identifier);\n         }\n \n         Optional<BibEntry> entry = Optional.empty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NTM1NQ==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510265355", "bodyText": "This is not the right place. You cannot put GUI code into logic/model classes.\nSee https://devdocs.jabref.org/getting-into-the-code/high-level-documentation\nThe right place to check if the results are empty would be here: Than you have it generic as well for all kind of fetchers\n\n  \n    \n      jabref/src/main/java/org/jabref/gui/EntryTypeViewModel.java\n    \n    \n         Line 147\n      in\n      7f4c36c\n    \n    \n    \n    \n\n        \n          \n           Optional<BibEntry> result = fetcherWorker.getValue();", "author": "Siedlerchr", "createdAt": "2020-10-22T15:42:14Z", "path": "src/main/java/org/jabref/logic/importer/fetcher/IsbnFetcher.java", "diffHunk": "@@ -59,6 +62,13 @@ public String getName() {\n             bibEntry = isbnViaOttoBibFetcher.performSearchById(identifier);\n         }\n \n+        // nothing found at ebook.de and ottobib\n+        if (!bibEntry.isPresent()) {\n+            FXDialog noEntryFoundDialog = new FXDialog(AlertType.ERROR);", "originalCommit": "f31a2d3abb14697427438e6b25944fd842884efd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMwMjk0OQ==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510302949", "bodyText": "oops, my mistake. I'll fix it later today. I have another question about the ottobib fetcher though, should getting no results throw an exception? Ottobib seems like a special case since supplying an ISBN that leads to no entry doesn't give a 404 but instead leads to a special page with an error message.", "author": "tmrd993", "createdAt": "2020-10-22T16:35:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NTM1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMDIzMA==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510310230", "bodyText": "I thought about throwing a fetcher exception as well. But on the other hand we have optional for those cases.\nSo I would not throw an exception.\n@tobiasdiez", "author": "Siedlerchr", "createdAt": "2020-10-22T16:46:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NTM1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMzgyOA==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510313828", "bodyText": "Thanks for your work so far.\nExceptions are only for exceptional program states. An unkown ISBN is a possible case in Ottobib. Thats probably why Ottobib does not show 404, but a page saying: unkown ISBN.\nSee: https://github.com/HugoMatilla/Effective-JAVA-Summary#57-use-exceptions-only-for-exceptional-conditions", "author": "calixtus", "createdAt": "2020-10-22T16:52:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NTM1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "06ff6968d94eea78f6f406be657effe103c275b1", "chunk": "diff --git a/src/main/java/org/jabref/logic/importer/fetcher/IsbnFetcher.java b/src/main/java/org/jabref/logic/importer/fetcher/IsbnFetcher.java\nindex 43a930023..626ae6a1e 100644\n--- a/src/main/java/org/jabref/logic/importer/fetcher/IsbnFetcher.java\n+++ b/src/main/java/org/jabref/logic/importer/fetcher/IsbnFetcher.java\n\n@@ -62,13 +59,6 @@ public class IsbnFetcher implements EntryBasedFetcher, IdBasedFetcher {\n             bibEntry = isbnViaOttoBibFetcher.performSearchById(identifier);\n         }\n \n-        // nothing found at ebook.de and ottobib\n-        if (!bibEntry.isPresent()) {\n-            FXDialog noEntryFoundDialog = new FXDialog(AlertType.ERROR);\n-            noEntryFoundDialog.setContentText(\"No entry found for ISBN: \" + identifier + \".\");\n-            noEntryFoundDialog.show();\n-        }\n-\n         return bibEntry;\n     }\n \n"}}, {"oid": "06ff6968d94eea78f6f406be657effe103c275b1", "url": "https://github.com/JabRef/jabref/commit/06ff6968d94eea78f6f406be657effe103c275b1", "message": "move error dialog to EntryTypeViewModel, add changelog entry", "committedDate": "2020-10-22T19:50:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxODM2OQ==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510418369", "bodyText": "Can I leave this error message or should it be unique?", "author": "tmrd993", "createdAt": "2020-10-22T19:53:27Z", "path": "src/main/java/org/jabref/gui/EntryTypeViewModel.java", "diffHunk": "@@ -176,6 +176,10 @@ public void runFetcherWorker() {\n                 searchSuccesfulProperty.set(true);\n             } else if (StringUtil.isBlank(idText.getValue())) {\n                 dialogService.showWarningDialogAndWait(Localization.lang(\"Empty search ID\"), Localization.lang(\"The given search ID was empty.\"));\n+            } else if (result.isEmpty()) {\n+                String fetcher = selectedItemProperty().getValue().getName();\n+                String searchId = idText.getValue();\n+                dialogService.showErrorDialogAndWait(Localization.lang(\"Fetcher '%0' did not find an entry for id '%1'.\", fetcher, searchId));", "originalCommit": "06ff6968d94eea78f6f406be657effe103c275b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ1OTI1NQ==", "url": "https://github.com/JabRef/jabref/pull/7036#discussion_r510459255", "bodyText": "Yes, looks good so far", "author": "Siedlerchr", "createdAt": "2020-10-22T21:10:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxODM2OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a951fa012ff1096df1c75dba2848ed870e09f59a", "url": "https://github.com/JabRef/jabref/commit/a951fa012ff1096df1c75dba2848ed870e09f59a", "message": "Update CHANGELOG.md\n\nCo-authored-by: Christoph <siedlerkiller@gmail.com>", "committedDate": "2020-10-22T23:02:47Z", "type": "commit"}]}