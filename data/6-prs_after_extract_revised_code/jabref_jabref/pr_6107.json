{"pr_number": 6107, "pr_title": "Complete refactor of LibraryProperties to mvvm", "pr_createdAt": "2020-03-12T19:01:42Z", "pr_url": "https://github.com/JabRef/jabref/pull/6107", "timeline": [{"oid": "456c05676f545c4c29c3ab58dcc929103a3c9549", "url": "https://github.com/JabRef/jabref/commit/456c05676f545c4c29c3ab58dcc929103a3c9549", "message": "Reordered packages, removed CustomJFXPanel.java", "committedDate": "2020-03-10T16:36:24Z", "type": "commit"}, {"oid": "7eced7f90e25a8de43684d946b2bb78bf82b5e00", "url": "https://github.com/JabRef/jabref/commit/7eced7f90e25a8de43684d946b2bb78bf82b5e00", "message": "Refactored FieldFormatterCleanupsPanel to mvvm-pattern", "committedDate": "2020-03-11T00:17:41Z", "type": "commit"}, {"oid": "2fececfcdfbf0365f72f070f9d242b5ee8f9ec2c", "url": "https://github.com/JabRef/jabref/commit/2fececfcdfbf0365f72f070f9d242b5ee8f9ec2c", "message": "Added new FieldFormatterCleanupsPanel to CleanupPresetPanel, removed old FieldFormatterCleanupsPanel", "committedDate": "2020-03-11T00:40:03Z", "type": "commit"}, {"oid": "f4a367026c676bee2652a8a457c5b97b8f5b7b5a", "url": "https://github.com/JabRef/jabref/commit/f4a367026c676bee2652a8a457c5b97b8f5b7b5a", "message": "Refactored LibraryPropertiesAction", "committedDate": "2020-03-11T23:36:35Z", "type": "commit"}, {"oid": "068ba2b0de6f81bc4bed77714ba7d30e89a8f9a4", "url": "https://github.com/JabRef/jabref/commit/068ba2b0de6f81bc4bed77714ba7d30e89a8f9a4", "message": "Fixes instance creation of LibraryPropertiesAction", "committedDate": "2020-03-12T18:53:03Z", "type": "commit"}, {"oid": "96d18745b20c4c2d4c0971fd11d890a32bd4c932", "url": "https://github.com/JabRef/jabref/commit/96d18745b20c4c2d4c0971fd11d890a32bd4c932", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls", "committedDate": "2020-03-12T19:04:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNDUzNg==", "url": "https://github.com/JabRef/jabref/pull/6107#discussion_r391834536", "bodyText": "Pass state manager as Parameter, it can be injected into the view", "author": "Siedlerchr", "createdAt": "2020-03-12T19:09:38Z", "path": "src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanelViewModel.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.jabref.gui.commonfxcontrols;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.scene.control.SelectionModel;\n+\n+import org.jabref.Globals;\n+import org.jabref.gui.util.NoSelectionModel;\n+import org.jabref.logic.cleanup.Cleanups;\n+import org.jabref.model.cleanup.FieldFormatterCleanup;\n+import org.jabref.model.cleanup.Formatter;\n+import org.jabref.model.entry.field.Field;\n+import org.jabref.model.entry.field.FieldFactory;\n+\n+public class FieldFormatterCleanupsPanelViewModel {\n+\n+    private final BooleanProperty cleanupsDisableProperty = new SimpleBooleanProperty();\n+    private final ListProperty<FieldFormatterCleanup> cleanupsListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n+    private final ObjectProperty<SelectionModel<FieldFormatterCleanup>> selectedCleanupProperty = new SimpleObjectProperty<>(new NoSelectionModel<>());\n+    private final ListProperty<Field> availableFieldsProperty = new SimpleListProperty<>(FXCollections.observableArrayList(FieldFactory.getCommonFields()));\n+    private final ObjectProperty<Field> selectedFieldProperty = new SimpleObjectProperty<>();\n+    private final ListProperty<Formatter> availableFormattersProperty = new SimpleListProperty<>(FXCollections.observableArrayList(Cleanups.getBuiltInFormatters()));\n+    private final ObjectProperty<Formatter> selectedFormatterProperty = new SimpleObjectProperty<>();\n+\n+    public FieldFormatterCleanupsPanelViewModel() {\n+    }\n+\n+    public void resetToRecommended() {\n+        Globals.stateManager.getActiveDatabase().ifPresent(databaseContext -> {", "originalCommit": "96d18745b20c4c2d4c0971fd11d890a32bd4c932", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg0MTgxMw==", "url": "https://github.com/JabRef/jabref/pull/6107#discussion_r391841813", "bodyText": "Overlooked that, thanks.", "author": "calixtus", "createdAt": "2020-03-12T19:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNDUzNg=="}], "type": "inlineReview", "revised_code": {"commit": "078e1c90937725f88b2a120ac8dba7803ddf8bdb", "chunk": "diff --git a/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanelViewModel.java b/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanelViewModel.java\nindex 86705892e2..fc1032039e 100644\n--- a/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanelViewModel.java\n+++ b/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanelViewModel.java\n\n@@ -1,5 +1,7 @@\n package org.jabref.gui.commonfxcontrols;\n \n+import java.util.Objects;\n+\n import javafx.beans.property.BooleanProperty;\n import javafx.beans.property.ListProperty;\n import javafx.beans.property.ObjectProperty;\n"}}, {"oid": "078e1c90937725f88b2a120ac8dba7803ddf8bdb", "url": "https://github.com/JabRef/jabref/commit/078e1c90937725f88b2a120ac8dba7803ddf8bdb", "message": "Added injection of StateManager", "committedDate": "2020-03-12T20:50:15Z", "type": "commit"}, {"oid": "a61ecae8331ad8aa84d2d3f9ce37101ae45acccb", "url": "https://github.com/JabRef/jabref/commit/a61ecae8331ad8aa84d2d3f9ce37101ae45acccb", "message": "Refactored LibraryPropertiesDialogViewModel to save metadata from properties", "committedDate": "2020-03-12T23:11:05Z", "type": "commit"}, {"oid": "8ad1c739a2edc206576b506d52b797671a88d10e", "url": "https://github.com/JabRef/jabref/commit/8ad1c739a2edc206576b506d52b797671a88d10e", "message": "Refactored ExportSortingTab to mvvm-pattern", "committedDate": "2020-03-12T23:48:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODk1Mw==", "url": "https://github.com/JabRef/jabref/pull/6107#discussion_r392508953", "bodyText": "I think it should work if you pass the stateManager as ctor parameter instead of using the injection", "author": "Siedlerchr", "createdAt": "2020-03-13T22:12:02Z", "path": "src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanel.java", "diffHunk": "@@ -0,0 +1,139 @@\n+package org.jabref.gui.commonfxcontrols;\n+\n+import javax.inject.Inject;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.ReadOnlyObjectWrapper;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.SelectionMode;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.VBox;\n+\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.util.FieldsUtil;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.cleanup.FieldFormatterCleanup;\n+import org.jabref.model.cleanup.Formatter;\n+import org.jabref.model.entry.field.Field;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class FieldFormatterCleanupsPanel extends VBox {\n+\n+    @FXML private CheckBox cleanupsEnabled;\n+    @FXML private TableView<FieldFormatterCleanup> cleanupsList;\n+    @FXML private TableColumn<FieldFormatterCleanup, Field> fieldColumn;\n+    @FXML private TableColumn<FieldFormatterCleanup, Formatter> formatterColumn;\n+    @FXML private TableColumn<FieldFormatterCleanup, Field> actionsColumn;\n+    @FXML private ComboBox<Field> addableFields;\n+    @FXML private ComboBox<Formatter> addableFormatters;\n+\n+    @Inject private StateManager stateManager;", "originalCommit": "8ad1c739a2edc206576b506d52b797671a88d10e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2OTI2NQ==", "url": "https://github.com/JabRef/jabref/pull/6107#discussion_r392569265", "bodyText": "The FieldFormatterCleanupsPanel is instantiated by the fxml file. I could theoretically pass an argument here using the @NamedArg-annotation. But passing a StateManager seems to me not possible that way. So the alternative would be to hardcode this in the view.", "author": "calixtus", "createdAt": "2020-03-14T08:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODk1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "a65dda05f93c19a34bc3b14cbd61fa2e2fc2f666", "chunk": "diff --git a/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanel.java b/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanel.java\nindex 865c118f23..5f6e1e064b 100644\n--- a/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanel.java\n+++ b/src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanel.java\n\n@@ -1,7 +1,5 @@\n package org.jabref.gui.commonfxcontrols;\n \n-import javax.inject.Inject;\n-\n import javafx.beans.property.BooleanProperty;\n import javafx.beans.property.ListProperty;\n import javafx.beans.property.ReadOnlyObjectWrapper;\n"}}, {"oid": "a65dda05f93c19a34bc3b14cbd61fa2e2fc2f666", "url": "https://github.com/JabRef/jabref/commit/a65dda05f93c19a34bc3b14cbd61fa2e2fc2f666", "message": "l10n and changed failing injection with Globals", "committedDate": "2020-03-16T00:11:36Z", "type": "commit"}, {"oid": "e36200b11992fc4228512791d791c99dcda2887c", "url": "https://github.com/JabRef/jabref/commit/e36200b11992fc4228512791d791c99dcda2887c", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls", "committedDate": "2020-03-16T00:20:58Z", "type": "commit"}, {"oid": "f2b0e303b9a31bf932daa68aa68bc596a82490d8", "url": "https://github.com/JabRef/jabref/commit/f2b0e303b9a31bf932daa68aa68bc596a82490d8", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties", "committedDate": "2020-03-19T06:46:30Z", "type": "commit"}, {"oid": "8e8f3a42fa81af39674eec46e566f12fcca0e72e", "url": "https://github.com/JabRef/jabref/commit/8e8f3a42fa81af39674eec46e566f12fcca0e72e", "message": "l10n", "committedDate": "2020-03-19T06:52:51Z", "type": "commit"}, {"oid": "8ffc56a3059b8457e62cdc6246126c91f93deb92", "url": "https://github.com/JabRef/jabref/commit/8ffc56a3059b8457e62cdc6246126c91f93deb92", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties", "committedDate": "2020-03-20T14:26:29Z", "type": "commit"}, {"oid": "94f931c0b6b3ec6efdd7f8270489f35b8ad0db8f", "url": "https://github.com/JabRef/jabref/commit/94f931c0b6b3ec6efdd7f8270489f35b8ad0db8f", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls", "committedDate": "2020-03-21T19:03:14Z", "type": "commit"}]}