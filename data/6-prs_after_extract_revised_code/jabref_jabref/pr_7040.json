{"pr_number": 7040, "pr_title": "Fix Shared Database Tests", "pr_createdAt": "2020-10-25T16:52:55Z", "pr_url": "https://github.com/JabRef/jabref/pull/7040", "timeline": [{"oid": "18805b1429759a306948a5206394cfb212e50aae", "url": "https://github.com/JabRef/jabref/commit/18805b1429759a306948a5206394cfb212e50aae", "message": "Fix Shared Database Tests\n\nFix FieldChangeEvent Delta computation", "committedDate": "2020-10-25T16:49:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMTE1Ng==", "url": "https://github.com/JabRef/jabref/pull/7040#discussion_r511831156", "bodyText": "why not newValue.length() == oldValue.length() ?", "author": "tobiasdiez", "createdAt": "2020-10-26T09:44:04Z", "path": "src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java", "diffHunk": "@@ -61,10 +61,12 @@ public FieldChangedEvent(FieldChange fieldChange) {\n     private int computeDelta(String oldValue, String newValue) {\n         if (oldValue == newValue) {\n             return 0;\n-        } else if (oldValue == null && newValue != null) {\n+        } else if ((oldValue == null) && (newValue != null)) {\n             return newValue.length();\n-        } else if (newValue == null && oldValue != null) {\n+        } else if ((newValue == null) && (oldValue != null)) {\n             return oldValue.length();\n+        } else if ((Math.abs(newValue.length() - oldValue.length()) == 0) && !oldValue.equals(newValue)) {", "originalCommit": "18805b1429759a306948a5206394cfb212e50aae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MTg0Mg==", "url": "https://github.com/JabRef/jabref/pull/7040#discussion_r511841842", "bodyText": "Yeah, that makes sense", "author": "Siedlerchr", "createdAt": "2020-10-26T10:01:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMTE1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "7b704e2d95699ee5f454c9ec76d5aa376099209d", "chunk": "diff --git a/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java b/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java\nindex a6b59f238..9eb6d1f53 100644\n--- a/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java\n+++ b/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java\n\n@@ -65,7 +65,7 @@ public class FieldChangedEvent extends EntryChangedEvent {\n             return newValue.length();\n         } else if ((newValue == null) && (oldValue != null)) {\n             return oldValue.length();\n-        } else if ((Math.abs(newValue.length() - oldValue.length()) == 0) && !oldValue.equals(newValue)) {\n+        } else if ((oldValue.length() == newValue.length()) && !oldValue.equals(newValue)) {\n             return newValue.length();\n         } else {\n             return Math.abs(newValue.length() - oldValue.length());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMjY5NA==", "url": "https://github.com/JabRef/jabref/pull/7040#discussion_r511832694", "bodyText": "How is the delta value used? Maybe we need to calculate the actual difference between the strings here? I.e. the delta of aaaa and aabb is 2 and not 4", "author": "tobiasdiez", "createdAt": "2020-10-26T09:46:36Z", "path": "src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java", "diffHunk": "@@ -61,10 +61,12 @@ public FieldChangedEvent(FieldChange fieldChange) {\n     private int computeDelta(String oldValue, String newValue) {\n         if (oldValue == newValue) {\n             return 0;\n-        } else if (oldValue == null && newValue != null) {\n+        } else if ((oldValue == null) && (newValue != null)) {\n             return newValue.length();\n-        } else if (newValue == null && oldValue != null) {\n+        } else if ((newValue == null) && (oldValue != null)) {\n             return oldValue.length();\n+        } else if ((Math.abs(newValue.length() - oldValue.length()) == 0) && !oldValue.equals(newValue)) {\n+            return newValue.length();", "originalCommit": "18805b1429759a306948a5206394cfb212e50aae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE4NDIzOA==", "url": "https://github.com/JabRef/jabref/pull/7040#discussion_r512184238", "bodyText": "@tobiasdiez  The delta value is only used here to check if it's >1, so we can use any value >0\n\n  \n    \n      jabref/src/main/java/org/jabref/logic/util/CoarseChangeFilter.java\n    \n    \n        Lines 49 to 51\n      in\n      a0ca875\n    \n    \n    \n    \n\n        \n          \n           boolean isMajorChange = fieldChange.getDelta() > 1; \n        \n\n        \n          \n            \n        \n\n        \n          \n           fieldChange.setFilteredOut(!(isEditChanged || isMajorChange));", "author": "Siedlerchr", "createdAt": "2020-10-26T18:35:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1MDY5Nw==", "url": "https://github.com/JabRef/jabref/pull/7040#discussion_r512250697", "bodyText": "Ok, thanks for looking this up. Then I would propose to replace delta by isMajorChange.", "author": "tobiasdiez", "createdAt": "2020-10-26T20:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMjY5NA=="}], "type": "inlineReview", "revised_code": {"commit": "7b704e2d95699ee5f454c9ec76d5aa376099209d", "chunk": "diff --git a/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java b/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java\nindex a6b59f238..9eb6d1f53 100644\n--- a/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java\n+++ b/src/main/java/org/jabref/model/entry/event/FieldChangedEvent.java\n\n@@ -65,7 +65,7 @@ public class FieldChangedEvent extends EntryChangedEvent {\n             return newValue.length();\n         } else if ((newValue == null) && (oldValue != null)) {\n             return oldValue.length();\n-        } else if ((Math.abs(newValue.length() - oldValue.length()) == 0) && !oldValue.equals(newValue)) {\n+        } else if ((oldValue.length() == newValue.length()) && !oldValue.equals(newValue)) {\n             return newValue.length();\n         } else {\n             return Math.abs(newValue.length() - oldValue.length());\n"}}, {"oid": "7b704e2d95699ee5f454c9ec76d5aa376099209d", "url": "https://github.com/JabRef/jabref/commit/7b704e2d95699ee5f454c9ec76d5aa376099209d", "message": "Use length directly foir comparision", "committedDate": "2020-10-26T18:44:29Z", "type": "commit"}, {"oid": "0c4d410c05a9f7130d89c78071892d7eb544026c", "url": "https://github.com/JabRef/jabref/commit/0c4d410c05a9f7130d89c78071892d7eb544026c", "message": "Merge remote-tracking branch 'upstream/master' into sharedbtest\n\n* upstream/master:\n  Bump mockito-core from 3.5.13 to 3.5.15 (#7044)\n  Bump styfle/cancel-workflow-action from 0.5.0 to 0.6.0 (#7047)", "committedDate": "2020-10-28T07:30:19Z", "type": "commit"}, {"oid": "1b15ed5b37b4967d0bae2534105c1c1cb7461027", "url": "https://github.com/JabRef/jabref/commit/1b15ed5b37b4967d0bae2534105c1c1cb7461027", "message": "Merge remote-tracking branch 'upstream/master' into sharedbtest\n\n* upstream/master:\n  Fix 4040 link\n  Bump java-diff-utils from 4.8 to 4.9 (#7061)\n  Bump bcprov-jdk15on from 1.66 to 1.67 (#7063)\n  Bump checkstyle from 8.36.2 to 8.37 (#7064)\n  Bump mockito-core from 3.5.15 to 3.6.0 (#7067)\n  Bump controlsfx from 11.0.2 to 11.0.3 (#7066)\n  Squashed 'src/main/resources/csl-styles/' changes from 5297abd6fc..5c376b838b\n  add short date formatter (#7039)\n  Add awt native open commands (#7037)\n  Add online-link detection to FileFieldParser (#7043)", "committedDate": "2020-11-03T08:04:27Z", "type": "commit"}, {"oid": "83fc123c56a7ef8ded0b58e797e35608a10475f3", "url": "https://github.com/JabRef/jabref/commit/83fc123c56a7ef8ded0b58e797e35608a10475f3", "message": "Merge remote-tracking branch 'upstream/master' into sharedbtest\n\n* upstream/master:\n  Bump unirest-java from 3.11.02 to 3.11.03 (#7060)\n  Bump xmlunit-matchers from 2.7.0 to 2.8.0 (#7062)\n  Bump xmlunit-core from 2.7.0 to 2.8.0 (#7065)", "committedDate": "2020-11-03T15:57:18Z", "type": "commit"}, {"oid": "27674f358953bac903d9d77a749d67e1e1f1a1bd", "url": "https://github.com/JabRef/jabref/commit/27674f358953bac903d9d77a749d67e1e1f1a1bd", "message": "upgrade postgres to 13\nrename delta to majorCharacterChange", "committedDate": "2020-11-03T17:30:15Z", "type": "commit"}, {"oid": "bac9ff9d9f763c56bcf2b3550fe9438c9227633e", "url": "https://github.com/JabRef/jabref/commit/bac9ff9d9f763c56bcf2b3550fe9438c9227633e", "message": "revert unrelated change", "committedDate": "2020-11-03T18:01:13Z", "type": "commit"}]}