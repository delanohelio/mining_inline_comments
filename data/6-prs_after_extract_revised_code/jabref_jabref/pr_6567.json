{"pr_number": 6567, "pr_title": "Fix exception for unlinked files", "pr_createdAt": "2020-05-31T09:33:53Z", "pr_url": "https://github.com/JabRef/jabref/pull/6567", "timeline": [{"oid": "dc672c6488cfeae62572a033ea88e7f5b296f2c6", "url": "https://github.com/JabRef/jabref/commit/dc672c6488cfeae62572a033ea88e7f5b296f2c6", "message": "check if metadata has start and end tag", "committedDate": "2020-05-31T09:11:53Z", "type": "commit"}, {"oid": "9f9a55cb337662186d911e6ec6d3e9de36c31a70", "url": "https://github.com/JabRef/jabref/commit/9f9a55cb337662186d911e6ec6d3e9de36c31a70", "message": "iterate to get all selected leaf nodes", "committedDate": "2020-05-31T09:14:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNTE0Mw==", "url": "https://github.com/JabRef/jabref/pull/6567#discussion_r432935143", "bodyText": "It returns an empty list, not an optional. Please adjust thar javadoc comment\nOtherwise looks good", "author": "Siedlerchr", "createdAt": "2020-05-31T11:02:58Z", "path": "src/main/java/org/jabref/logic/xmp/XmpUtilReader.java", "diffHunk": "@@ -104,7 +104,7 @@ private XmpUtilReader() {\n      * <p/>\n      *\n      *\n-     * @return empty Optional if no metadata has been found\n+     * @return empty Optional if no metadata has been found, or cannot properly find start or end tag in metadata", "originalCommit": "9f9a55cb337662186d911e6ec6d3e9de36c31a70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNzU3Nw==", "url": "https://github.com/JabRef/jabref/pull/6567#discussion_r432937577", "bodyText": "Got it", "author": "ZhouSky", "createdAt": "2020-05-31T11:33:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNTE0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b18b3fab8ab8e39696dc832b94ec96e3d9078698", "chunk": "diff --git a/src/main/java/org/jabref/logic/xmp/XmpUtilReader.java b/src/main/java/org/jabref/logic/xmp/XmpUtilReader.java\nindex c44edb67b..f58d5fda4 100644\n--- a/src/main/java/org/jabref/logic/xmp/XmpUtilReader.java\n+++ b/src/main/java/org/jabref/logic/xmp/XmpUtilReader.java\n\n@@ -104,7 +104,7 @@ public class XmpUtilReader {\n      * <p/>\n      *\n      *\n-     * @return empty Optional if no metadata has been found, or cannot properly find start or end tag in metadata\n+     * @return empty List if no metadata has been found, or cannot properly find start or end tag in metadata\n      */\n     private static List<XMPMetadata> getXmpMetadata(PDDocument document) throws IOException {\n         PDDocumentCatalog catalog = document.getDocumentCatalog();\n"}}, {"oid": "b18b3fab8ab8e39696dc832b94ec96e3d9078698", "url": "https://github.com/JabRef/jabref/commit/b18b3fab8ab8e39696dc832b94ec96e3d9078698", "message": "Correct return description in javadoc", "committedDate": "2020-05-31T11:30:15Z", "type": "commit"}, {"oid": "2291a76032c572970c924e4ffcd96a6e903c5193", "url": "https://github.com/JabRef/jabref/commit/2291a76032c572970c924e4ffcd96a6e903c5193", "message": "Add test for getXmpMetadata with no description", "committedDate": "2020-06-02T16:16:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAyMTc0MQ==", "url": "https://github.com/JabRef/jabref/pull/6567#discussion_r434021741", "bodyText": "You don't need reflection, the method getMetadata is implicitly caleld, you you can simple do this two lines:\n   List<BibEntry> entries = XmpUtilReader.readXmp(Path.of(XmpUtilShared.class.getResource(\"no_description_metadata.pdf\").toURI()), xmpPreferences);\n        assertEquals(Collections.emptyList(), entries);", "author": "Siedlerchr", "createdAt": "2020-06-02T16:42:54Z", "path": "src/test/java/org/jabref/logic/xmp/XmpUtilReaderTest.java", "diffHunk": "@@ -109,4 +112,16 @@ void testReadPDMetadata() throws IOException, URISyntaxException, ParseException\n \n         assertEquals(entryFromBibFile.get(), entries.get(0));\n     }\n+\n+    /**\n+     * Tests an pdf file with metadata which has no description section.\n+     */\n+    @Test\n+    void testGetXmpMetadataWithNoDescription() throws IOException, URISyntaxException, NoSuchMethodException, InvocationTargetException, IllegalAccessException {\n+        Method method = XmpUtilReader.class.getDeclaredMethod(\"getXmpMetadata\", PDDocument.class);", "originalCommit": "2291a76032c572970c924e4ffcd96a6e903c5193", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAzNDQzNA==", "url": "https://github.com/JabRef/jabref/pull/6567#discussion_r434034434", "bodyText": "Got it. Thanks.", "author": "ZhouSky", "createdAt": "2020-06-02T17:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAyMTc0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "a78ffa56ea0c3b4e0f6cd14d4968486937648ae5", "chunk": "diff --git a/src/test/java/org/jabref/logic/xmp/XmpUtilReaderTest.java b/src/test/java/org/jabref/logic/xmp/XmpUtilReaderTest.java\nindex 124d08703..c30f8702d 100644\n--- a/src/test/java/org/jabref/logic/xmp/XmpUtilReaderTest.java\n+++ b/src/test/java/org/jabref/logic/xmp/XmpUtilReaderTest.java\n\n@@ -117,11 +114,8 @@ class XmpUtilReaderTest {\n      * Tests an pdf file with metadata which has no description section.\n      */\n     @Test\n-    void testGetXmpMetadataWithNoDescription() throws IOException, URISyntaxException, NoSuchMethodException, InvocationTargetException, IllegalAccessException {\n-        Method method = XmpUtilReader.class.getDeclaredMethod(\"getXmpMetadata\", PDDocument.class);\n-        method.setAccessible(true);\n-        List<XMPMetadata> entries = (List<XMPMetadata>) method.invoke(XmpUtilReader.class, PDDocument.load(XmpUtilShared.class.getResource(\"no_description_metadata.pdf\").openStream()));\n-        method.setAccessible(false);\n+    void testReadNoDescriptionMetadata() throws IOException, URISyntaxException {\n+        List<BibEntry> entries = XmpUtilReader.readXmp(Path.of(XmpUtilShared.class.getResource(\"no_description_metadata.pdf\").toURI()), xmpPreferences);\n         assertEquals(Collections.emptyList(), entries);\n     }\n }\n"}}, {"oid": "a78ffa56ea0c3b4e0f6cd14d4968486937648ae5", "url": "https://github.com/JabRef/jabref/commit/a78ffa56ea0c3b4e0f6cd14d4968486937648ae5", "message": "Make test concise", "committedDate": "2020-06-02T16:58:42Z", "type": "commit"}]}