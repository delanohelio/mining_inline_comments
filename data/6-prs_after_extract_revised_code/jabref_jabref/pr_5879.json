{"pr_number": 5879, "pr_title": "Fixes making paths of linked files relative (web urls will not be touched anymore)", "pr_createdAt": "2020-01-27T19:28:00Z", "pr_url": "https://github.com/JabRef/jabref/pull/5879", "timeline": [{"oid": "8ad6f233e647a0d6d246ce044c6760fe8ab73818", "url": "https://github.com/JabRef/jabref/commit/8ad6f233e647a0d6d246ce044c6760fe8ab73818", "message": "Fixes #5861\nDescription:\n- Cleanup entries: \"Make paths of linked files relative (if possible)\" broke web URLs and resulted in various other issues subsequently. This PR fixes this issue.\nIt has been tested for local files and web urls.", "committedDate": "2020-01-27T18:57:02Z", "type": "commit"}, {"oid": "f033dbfbba9d04165577493b2ad0ac9aaca30e37", "url": "https://github.com/JabRef/jabref/commit/f033dbfbba9d04165577493b2ad0ac9aaca30e37", "message": "changelog updated", "committedDate": "2020-01-28T10:38:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkxMjkwMQ==", "url": "https://github.com/JabRef/jabref/pull/5879#discussion_r371912901", "bodyText": "The class LinkedFile already contains a method that does this job:\n\n  \n    \n      jabref/src/main/java/org/jabref/model/entry/LinkedFile.java\n    \n    \n        Lines 162 to 164\n      in\n      8520833\n    \n    \n    \n    \n\n        \n          \n           public boolean isOnlineLink() { \n        \n\n        \n          \n               return isOnlineLink(link.get()); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nCan you please use it. I would also suggest to add the normalization trim().toLowerCase() there, which I find a nice addition.", "author": "tobiasdiez", "createdAt": "2020-01-28T16:28:47Z", "path": "src/main/java/org/jabref/logic/cleanup/RelativePathsCleanup.java", "diffHunk": "@@ -57,4 +64,21 @@ public RelativePathsCleanup(BibDatabaseContext databaseContext, FilePreferences\n         return Collections.emptyList();\n     }\n \n+    /**\n+     * Checks, if the given file path is a well-formed web url\n+     *\n+     * @param filePath file path to check\n+     * @return <code>true</code>, if the given file path is a web url, <code>false</code> otherwise\n+     */\n+    private static boolean isWebUrl(String filePath)", "originalCommit": "f033dbfbba9d04165577493b2ad0ac9aaca30e37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkyNDY0Mw==", "url": "https://github.com/JabRef/jabref/pull/5879#discussion_r371924643", "bodyText": "Concerning isOnlineLink(): I would recommend removing \"toCheck.contains(\"www.\")\", because a path to a local file might contain this pattern coincidentally. What do you say?", "author": "systemoperator", "createdAt": "2020-01-28T16:47:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkxMjkwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "4adfdc5b0833e2f3a4a131d0c3ec11087d208bd8", "chunk": "diff --git a/src/main/java/org/jabref/logic/cleanup/RelativePathsCleanup.java b/src/main/java/org/jabref/logic/cleanup/RelativePathsCleanup.java\nindex 007787ef3..1bbecb2f4 100644\n--- a/src/main/java/org/jabref/logic/cleanup/RelativePathsCleanup.java\n+++ b/src/main/java/org/jabref/logic/cleanup/RelativePathsCleanup.java\n\n@@ -63,22 +63,4 @@ public class RelativePathsCleanup implements CleanupJob {\n \n         return Collections.emptyList();\n     }\n-\n-    /**\n-     * Checks, if the given file path is a well-formed web url\n-     *\n-     * @param filePath file path to check\n-     * @return <code>true</code>, if the given file path is a web url, <code>false</code> otherwise\n-     */\n-    private static boolean isWebUrl(String filePath)\n-    {\n-        if (filePath == null) {\n-            return false;\n-        }\n-        String normalizedFilePath = filePath.trim().toLowerCase();\n-        if (normalizedFilePath.startsWith(\"http://\") || normalizedFilePath.startsWith(\"https://\")) { // INFO: can be extended, if needed\n-            return true;\n-        }\n-        return false;\n-    }\n }\n"}}, {"oid": "4adfdc5b0833e2f3a4a131d0c3ec11087d208bd8", "url": "https://github.com/JabRef/jabref/commit/4adfdc5b0833e2f3a4a131d0c3ec11087d208bd8", "message": "refactoring: use existing method isOnlineLink() for checking whether a file link is an online link; improving isOnlineLink()", "committedDate": "2020-01-28T21:13:13Z", "type": "commit"}]}