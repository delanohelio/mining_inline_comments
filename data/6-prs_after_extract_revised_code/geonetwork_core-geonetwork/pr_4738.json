{"pr_number": 4738, "pr_title": "Fixed bug with history link to the metadata.", "pr_createdAt": "2020-06-04T22:04:44Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/4738", "timeline": [{"oid": "429fe5b29bb9e3c51b735d155da862810573ee38", "url": "https://github.com/geonetwork/core-geonetwork/commit/429fe5b29bb9e3c51b735d155da862810573ee38", "message": "Fixed bug with where the history link to the metadata was not working because it was linking using the id instead of the uuid\nThis fix also add metadata uuid to the status api results.", "committedDate": "2020-06-04T22:02:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc2OTE3NQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4738#discussion_r435769175", "bodyText": "I would\n@Autowired\nIMetadataUtils metadataUtils;\nString uuid = metadataUtils.getMetadataUuid(Integer.toString(s.getId().getMetadataId()));\nto keep it similar to what is done in other places?", "author": "fxprunayre", "createdAt": "2020-06-05T08:29:40Z", "path": "services/src/main/java/org/fao/geonet/api/records/MetadataWorkflowApi.java", "diffHunk": "@@ -473,6 +474,17 @@ public MetadataStatus convertParameter(int id, MetadataStatusParameter parameter\n             }\n             status.setTitle(title);\n \n+            String uuid = uuids.get(s.getId().getMetadataId());\n+            if (uuid == null) {\n+                try {\n+                    // Collect metadata uuid. For now we use Lucene\n+                    uuid = LuceneSearcher.getMetadataFromIndexById(language, s.getId().getMetadataId() + \"\", \"_uuid\");", "originalCommit": "429fe5b29bb9e3c51b735d155da862810573ee38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4ODk4OQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4738#discussion_r435788989", "bodyText": "Indeed.", "author": "josegar74", "createdAt": "2020-06-05T09:04:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc2OTE3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "8133ee6581c99e168489c4140cf30af3f449a83e", "chunk": "diff --git a/services/src/main/java/org/fao/geonet/api/records/MetadataWorkflowApi.java b/services/src/main/java/org/fao/geonet/api/records/MetadataWorkflowApi.java\nindex 916d7b1930..63fc1b9a50 100644\n--- a/services/src/main/java/org/fao/geonet/api/records/MetadataWorkflowApi.java\n+++ b/services/src/main/java/org/fao/geonet/api/records/MetadataWorkflowApi.java\n\n@@ -477,8 +481,8 @@ public class MetadataWorkflowApi {\n             String uuid = uuids.get(s.getId().getMetadataId());\n             if (uuid == null) {\n                 try {\n-                    // Collect metadata uuid. For now we use Lucene\n-                    uuid = LuceneSearcher.getMetadataFromIndexById(language, s.getId().getMetadataId() + \"\", \"_uuid\");\n+                    // Collect metadata uuid.\n+                    uuid=metadataUtils.getMetadataUuid(Integer.toString(s.getId().getMetadataId()));\n                     uuids.put(s.getId().getMetadataId(), uuid);\n                 } catch (Exception e1) {\n                 }\n"}}, {"oid": "8133ee6581c99e168489c4140cf30af3f449a83e", "url": "https://github.com/geonetwork/core-geonetwork/commit/8133ee6581c99e168489c4140cf30af3f449a83e", "message": "Update UUID retrieval to use metadataUtils", "committedDate": "2020-06-09T11:39:30Z", "type": "commit"}]}