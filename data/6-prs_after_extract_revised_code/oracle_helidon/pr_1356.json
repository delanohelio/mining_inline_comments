{"pr_number": 1356, "pr_title": "New media support API.", "pr_createdAt": "2020-02-06T04:51:00Z", "pr_url": "https://github.com/oracle/helidon/pull/1356", "timeline": [{"oid": "80609edf07cee577ca230ef6204bccf3f21b35d5", "url": "https://github.com/oracle/helidon/commit/80609edf07cee577ca230ef6204bccf3f21b35d5", "message": "More cleanups:\n - make constructor of HashParameters protected, add factory methods\n - minimize changes (i.e remove changes that are not critical and directly related to this PR)\n - change the static get() methods to create()", "committedDate": "2020-02-07T01:21:58Z", "type": "forcePushed"}, {"oid": "86cba68bc6443c8c814e0c33e65d73df08b305e6", "url": "https://github.com/oracle/helidon/commit/86cba68bc6443c8c814e0c33e65d73df08b305e6", "message": "New media support API.", "committedDate": "2020-02-07T02:47:02Z", "type": "commit"}, {"oid": "d0059eeed3a193b80ea7506b993f521024febbbf", "url": "https://github.com/oracle/helidon/commit/d0059eeed3a193b80ea7506b993f521024febbbf", "message": "fix a javadoc error and a spotbugs error", "committedDate": "2020-02-07T02:47:02Z", "type": "commit"}, {"oid": "42e89c6a7a4371ac834d639fe925865067c9665b", "url": "https://github.com/oracle/helidon/commit/42e89c6a7a4371ac834d639fe925865067c9665b", "message": "fix more spotbugs errors", "committedDate": "2020-02-07T02:47:02Z", "type": "commit"}, {"oid": "a0daafd91f7efdb50e50b08fe5ed5b7e33fc9220", "url": "https://github.com/oracle/helidon/commit/a0daafd91f7efdb50e50b08fe5ed5b7e33fc9220", "message": "exclude spotbugs error", "committedDate": "2020-02-07T02:47:02Z", "type": "commit"}, {"oid": "64da0a2e8f65eb5c75a7344b28bfae62fc00ae5c", "url": "https://github.com/oracle/helidon/commit/64da0a2e8f65eb5c75a7344b28bfae62fc00ae5c", "message": "More cleanups:\n - make constructor of HashParameters protected, add factory methods\n - minimize changes (i.e remove changes that are not critical and directly related to this PR)\n - change the static get() methods to create()", "committedDate": "2020-02-07T02:47:02Z", "type": "commit"}, {"oid": "64da0a2e8f65eb5c75a7344b28bfae62fc00ae5c", "url": "https://github.com/oracle/helidon/commit/64da0a2e8f65eb5c75a7344b28bfae62fc00ae5c", "message": "More cleanups:\n - make constructor of HashParameters protected, add factory methods\n - minimize changes (i.e remove changes that are not critical and directly related to this PR)\n - change the static get() methods to create()", "committedDate": "2020-02-07T02:47:02Z", "type": "forcePushed"}, {"oid": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "url": "https://github.com/oracle/helidon/commit/80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "message": "fix copyright errors", "committedDate": "2020-02-07T04:04:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQxNDk0OQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r376414949", "bodyText": "These exception check can be done more elegantly by\nassertThrows(ExecutionException.class, () -> readJsonArray(\"{ \\\"p\\\" : \\\"val\\\" }\"));", "author": "Verdent", "createdAt": "2020-02-07T14:22:50Z", "path": "media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2017, 2020 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.media.jsonp.common;\n+\n+import io.helidon.common.GenericType;\n+\n+import javax.json.JsonArray;\n+import javax.json.JsonException;\n+import javax.json.JsonObject;\n+\n+import io.helidon.common.http.DataChunk;\n+import io.helidon.media.common.MessageBodyReaderContext;\n+import io.helidon.common.reactive.Single;\n+import java.util.concurrent.ExecutionException;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.instanceOf;\n+import static org.hamcrest.CoreMatchers.notNullValue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * The JsonContentReaderTest.\n+ */\n+public class JsonpReaderTest {\n+\n+    private final static MessageBodyReaderContext CONTEXT = MessageBodyReaderContext.create();\n+\n+    private final static JsonpBodyReader READER = JsonProcessing.create().newReader();\n+\n+    @Test\n+    public void simpleJsonObject() throws Exception {\n+        JsonObject jsonObject = readJsonObject(\"{ \\\"p\\\" : \\\"val\\\" }\");\n+        assertThat(jsonObject, is(notNullValue()));\n+        assertThat(jsonObject.getJsonString(\"p\").getString(), is(equalTo(\"val\")));\n+    }\n+\n+    @Test\n+    public void incompatibleTypes() throws Exception {\n+        try {\n+            readJsonArray(\"{ \\\"p\\\" : \\\"val\\\" }\");\n+            fail(\"Should have thrown an exception\");\n+        } catch (ExecutionException ex) {\n+            assertThat(ex.getCause(), is(instanceOf(JsonException.class)));\n+        }", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NzM3NQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377077375", "bodyText": "+1", "author": "tomas-langer", "createdAt": "2020-02-10T13:58:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQxNDk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMxMDM5NQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377310395", "bodyText": "I've made the change, but note that means giving up on checking the exception cause.", "author": "romain-grecourt", "createdAt": "2020-02-10T20:54:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQxNDk0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java b/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java\nindex 8ddb12273..4c75e8940 100644\n--- a/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java\n+++ b/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java\n\n@@ -19,7 +19,6 @@ package io.helidon.media.jsonp.common;\n import io.helidon.common.GenericType;\n \n import javax.json.JsonArray;\n-import javax.json.JsonException;\n import javax.json.JsonObject;\n \n import io.helidon.common.http.DataChunk;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNjI0OQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r376426249", "bodyText": "I think this is some leftover which can be removed.", "author": "Verdent", "createdAt": "2020-02-07T14:43:49Z", "path": "webserver/webserver/src/main/java/io/helidon/webserver/HashResponseHeaders.java", "diffHunk": "@@ -38,6 +38,7 @@\n import java.util.stream.Collectors;\n \n import io.helidon.common.http.AlreadyCompletedException;\n+import io.helidon.common.http.HashParameters;", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMwODA2Ng==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377308066", "bodyText": "This class extends HashParameters, since I've refactored it out of the webserver package, it only shows as import for this change.", "author": "romain-grecourt", "createdAt": "2020-02-10T20:49:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNjI0OQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNzY0MQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r376427641", "bodyText": "Should not be io.helidon.common.http.ContextualRegistry an import instead of having it written like this?", "author": "Verdent", "createdAt": "2020-02-07T14:46:19Z", "path": "webserver/webserver/src/main/java/io/helidon/webserver/NettyWebServer.java", "diffHunk": "@@ -100,12 +103,13 @@\n         // the contextual registry needs to be created as a different type is expected. Once we remove ContextualRegistry\n         // we can simply use the one from config\n         Context context = config.context();\n-        if (context instanceof ContextualRegistry) {\n-            this.contextualRegistry = (ContextualRegistry) context;\n+        if (context instanceof io.helidon.common.http.ContextualRegistry) {\n+            this.contextualRegistry = (io.helidon.common.http.ContextualRegistry) context;\n         } else {\n-            this.contextualRegistry = ContextualRegistry.create(config.context());\n+            this.contextualRegistry = io.helidon.common.http.ContextualRegistry.create(config.context());", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI3MDM4NQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377270385", "bodyText": "This is the only way to avoid deprecated compiler warning.", "author": "romain-grecourt", "createdAt": "2020-02-10T19:30:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNzY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0MjIyOQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377742229", "bodyText": "We need to remove ContextualRegistry before 2.0 is released anyway, so no problem", "author": "tomas-langer", "createdAt": "2020-02-11T16:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNzY0MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTA4Mg==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377069082", "bodyText": "The All rights reserved. should be removed. Not sure why the copyright plugin ignores this", "author": "tomas-langer", "createdAt": "2020-02-10T13:43:24Z", "path": "common/common/src/main/java/io/helidon/common/GenericType.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2018, 2019 Oracle and/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2020 Oracle and/or its affiliates. All rights reserved.", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI2OTM0Ng==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377269346", "bodyText": "I've only updated the year in these copyright changes, can we do that change in a separate PR ?", "author": "romain-grecourt", "createdAt": "2020-02-10T19:28:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMxMDY0OQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377310649", "bodyText": "Marking this as resolved since I think we should solve this issue for all of Helidon not just for this PR.", "author": "romain-grecourt", "createdAt": "2020-02-10T20:54:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTA4Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTkxNw==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377069917", "bodyText": "This seems to be just reformatted. Please do not reformat existing code unless necessary or an issue - e.g. the line 73 is OK, lines 69-70 not.", "author": "tomas-langer", "createdAt": "2020-02-10T13:44:54Z", "path": "common/common/src/main/java/io/helidon/common/GenericType.java", "diffHunk": "@@ -66,22 +66,43 @@\n     private final Class<?> rawType;\n \n     /**\n-     * Constructs a new generic type, using the provided generic type information and\n-     * deriving the class.\n+     * Constructs a new generic type, using the provided generic type\n+     * information and deriving the class.\n      *\n      * @param genericType the generic type\n-     * @param <N>         generic type of the returned GenericType\n+     * @param <N> generic type of the returned GenericType\n      * @return new type wrapping the provided type", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI3MDA4Mg==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377270082", "bodyText": "Roger that, I've tried to avoid these as much as possible ; but sometimes I can't help it :p", "author": "romain-grecourt", "createdAt": "2020-02-10T19:30:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTkxNw=="}], "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/common/src/main/java/io/helidon/common/GenericType.java b/common/common/src/main/java/io/helidon/common/GenericType.java\nindex bb22249ff..876fd1193 100644\n--- a/common/common/src/main/java/io/helidon/common/GenericType.java\n+++ b/common/common/src/main/java/io/helidon/common/GenericType.java\n\n@@ -66,18 +66,19 @@ public class GenericType<T> implements Type {\n     private final Class<?> rawType;\n \n     /**\n-     * Constructs a new generic type, using the provided generic type\n-     * information and deriving the class.\n+     * Constructs a new generic type, using the provided generic type information and\n+     * deriving the class.\n      *\n      * @param genericType the generic type\n      * @param <N> generic type of the returned GenericType\n      * @return new type wrapping the provided type\n-     * @throws IllegalArgumentException if genericType is {@code null} or not an\n-     * instance of {@code Class} or {@link ParameterizedType} whose raw type is\n-     * an instance of {@code Class}.\n+     * @throws IllegalArgumentException if genericType is {@code null} or not an instance of\n+     *                                  {@code Class} or {@link ParameterizedType} whose raw\n+     *                                  type is an instance of {@code Class}.\n      */\n     public static <N> GenericType<N> create(Type genericType) throws IllegalArgumentException {\n         Objects.requireNonNull(genericType);\n+\n         return new GenericType<>(genericType, GenericTypeUtil.rawClass(genericType));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MDU3Nw==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377070577", "bodyText": "The line breaks were intentional. Do not reformat code...", "author": "tomas-langer", "createdAt": "2020-02-10T13:46:10Z", "path": "common/common/src/main/java/io/helidon/common/GenericType.java", "diffHunk": "@@ -164,11 +185,9 @@ public boolean equals(Object obj) {\n         if (this == obj) {\n             return true;\n         }", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTE3MA==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071170", "bodyText": "The javadoc is wrong. You cannot return \"this instance\" as this is a static method", "author": "tomas-langer", "createdAt": "2020-02-10T13:47:06Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -54,16 +54,21 @@ protected CharMatcher() {\n     /**\n      * Determines whether a character is ASCII, meaning that its code point is less than 128.\n      *\n-     * @since 19.0 (since 1.0 as constant {@code ASCII})\n+     * @return this CharMatcher instance", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -54,7 +54,7 @@ public abstract class CharMatcher {\n     /**\n      * Determines whether a character is ASCII, meaning that its code point is less than 128.\n      *\n-     * @return this CharMatcher instance\n+     * @return a CharMatcher instance that matches ASCII characters\n      */\n     public static CharMatcher ascii() {\n         return Ascii.INSTANCE;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTQ4Mw==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071483", "bodyText": "javadoc for return is not correct", "author": "tomas-langer", "createdAt": "2020-02-10T13:47:40Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -54,16 +54,21 @@ protected CharMatcher() {\n     /**\n      * Determines whether a character is ASCII, meaning that its code point is less than 128.\n      *\n-     * @since 19.0 (since 1.0 as constant {@code ASCII})\n+     * @return this CharMatcher instance\n      */\n     public static CharMatcher ascii() {\n         return Ascii.INSTANCE;\n     }\n \n     /**\n-     * Returns a {@code char} matcher that matches any character except the one specified.\n+     * Returns a {@code char} matcher that matches any character except the one\n+     * specified.\n      *\n-     * <p>To negate another {@code CharMatcher}, use {@link #negate()}.\n+     * <p>\n+     * To negate another {@code CharMatcher}, use {@link #negate()}.\n+     *\n+     * @param match the character that should not match\n+     * @return CharMatcher", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -54,7 +54,7 @@ public abstract class CharMatcher {\n     /**\n      * Determines whether a character is ASCII, meaning that its code point is less than 128.\n      *\n-     * @return this CharMatcher instance\n+     * @return a CharMatcher instance that matches ASCII characters\n      */\n     public static CharMatcher ascii() {\n         return Ascii.INSTANCE;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTUxMQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071511", "bodyText": "javadoc for return is not correct", "author": "tomas-langer", "createdAt": "2020-02-10T13:47:43Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -72,7 +77,7 @@ public static CharMatcher isNot(final char match) {\n     /**\n      * Matches any character.\n      *\n-     * @since 19.0 (since 1.0 as constant {@code ANY})\n+     * @return CharMatcher", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -77,16 +78,16 @@ public abstract class CharMatcher {\n     /**\n      * Matches any character.\n      *\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches any character\n      */\n     public static CharMatcher any() {\n         return Any.INSTANCE;\n     }\n \n     /**\n-     * Matches no characters.\n+     * Matches no character.\n      *\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches no character\n      */\n     public static CharMatcher none() {\n         return None.INSTANCE;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTU3MA==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071570", "bodyText": "javadoc for return is not correct", "author": "tomas-langer", "createdAt": "2020-02-10T13:47:50Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -81,7 +86,7 @@ public static CharMatcher any() {\n     /**\n      * Matches no characters.\n      *\n-     * @since 19.0 (since 1.0 as constant {@code NONE})\n+     * @return CharMatcher", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -77,16 +78,16 @@ public abstract class CharMatcher {\n     /**\n      * Matches any character.\n      *\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches any character\n      */\n     public static CharMatcher any() {\n         return Any.INSTANCE;\n     }\n \n     /**\n-     * Matches no characters.\n+     * Matches no character.\n      *\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches no character\n      */\n     public static CharMatcher none() {\n         return None.INSTANCE;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTY2NQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071665", "bodyText": "javadoc for return is not correct", "author": "tomas-langer", "createdAt": "2020-02-10T13:47:58Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -91,14 +96,16 @@ public static CharMatcher none() {\n      * Determines whether a character is an ISO control character as specified by\n      * {@link Character#isISOControl(char)}.\n      *\n-     * @since 19.0 (since 1.0 as constant {@code JAVA_ISO_CONTROL})\n+     * @return CharMatcher", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -96,7 +97,7 @@ public abstract class CharMatcher {\n      * Determines whether a character is an ISO control character as specified by\n      * {@link Character#isISOControl(char)}.\n      *\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches ISO control character\n      */\n     public static CharMatcher javaIsoControl() {\n         return JavaIsoControl.INSTANCE;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTc2Nw==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071767", "bodyText": "javadoc for return is not correct", "author": "tomas-langer", "createdAt": "2020-02-10T13:48:09Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -91,14 +96,16 @@ public static CharMatcher none() {\n      * Determines whether a character is an ISO control character as specified by\n      * {@link Character#isISOControl(char)}.\n      *\n-     * @since 19.0 (since 1.0 as constant {@code JAVA_ISO_CONTROL})\n+     * @return CharMatcher\n      */\n     public static CharMatcher javaIsoControl() {\n         return JavaIsoControl.INSTANCE;\n     }\n \n     /**\n      * Returns a {@code char} matcher that matches only one specified character.\n+     * @param match the character that should match\n+     * @return CharMatcher", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -96,7 +97,7 @@ public abstract class CharMatcher {\n      * Determines whether a character is an ISO control character as specified by\n      * {@link Character#isISOControl(char)}.\n      *\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches ISO control character\n      */\n     public static CharMatcher javaIsoControl() {\n         return JavaIsoControl.INSTANCE;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTgyMQ==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377071821", "bodyText": "javadoc for return is not correct (please fix for all methods)", "author": "tomas-langer", "createdAt": "2020-02-10T13:48:14Z", "path": "common/http/src/main/java/io/helidon/common/http/CharMatcher.java", "diffHunk": "@@ -111,6 +118,8 @@ public static CharMatcher is(final char match) {\n     /**\n      * Returns a {@code char} matcher that matches any character not present in the given character\n      * sequence.\n+     * @param sequence all the characters that should not be matched\n+     * @return CharMatcher", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\nindex 461463f90..cf9bf1353 100644\n--- a/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n+++ b/common/http/src/main/java/io/helidon/common/http/CharMatcher.java\n\n@@ -119,7 +120,7 @@ public abstract class CharMatcher {\n      * Returns a {@code char} matcher that matches any character not present in the given character\n      * sequence.\n      * @param sequence all the characters that should not be matched\n-     * @return CharMatcher\n+     * @return a CharMatcher that matches any character not present in the given sequence\n      */\n     public static CharMatcher noneOf(CharSequence sequence) {\n         return anyOf(sequence).negate();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MjQ5NA==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377072494", "bodyText": "As this is a backward incompatible version - should we keep Content in and remove it in 3.0, or just remove it immediately?", "author": "tomas-langer", "createdAt": "2020-02-10T13:49:26Z", "path": "common/http/src/main/java/io/helidon/common/http/Content.java", "diffHunk": "@@ -40,7 +40,9 @@\n  * It is possible to register function to convert publisher to {@link CompletionStage} of a single entity using\n  * {@link #registerReader(Class, Reader)} or {@link #registerReader(Predicate, Reader)} methods. It\n  * is then possible to use {@link #as(Class)} method to obtain such entity.\n+ * @deprecated use {@code io.helidon.media.common.MessageBodyReadableContent} instead\n  */\n+@Deprecated", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI3MTIzNA==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377271234", "bodyText": "That's a very good question. I did the work initially for 1.x, now that we are at 2.x we should rethink this. Let's track this item in a separate issue.", "author": "romain-grecourt", "createdAt": "2020-02-10T19:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MjQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5NzA2Mg==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377297062", "bodyText": "E.g., I'd like to remove the old Reader / Writer  interfaces with all the corresponding registerReader / registerWriter method and instead use the new .context() methods.\nThe .content() method remains, so that keeps some kind of compatibility, also I'm positive that there is not much code declaring variables of type Content ; so we should feel OK in removing the Content interface.", "author": "romain-grecourt", "createdAt": "2020-02-10T20:25:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MjQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMyNjE5Ng==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377326196", "bodyText": "I've created #1375", "author": "romain-grecourt", "createdAt": "2020-02-10T21:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MjQ5NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3Mzk3Mg==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377073972", "bodyText": "As this is now a public class, an explanation of what concatenation means in this context would be good. I have no idea.", "author": "tomas-langer", "createdAt": "2020-02-10T13:52:16Z", "path": "common/http/src/main/java/io/helidon/common/http/HashParameters.java", "diffHunk": "@@ -110,7 +137,7 @@ public static HashParameters concat(Parameters... parameters) {\n     /**\n      * Creates new instance of {@link HashParameters} as a concatenation of provided parameters.\n      *\n-     * @param parameters parameters to concat.\n+     * @param parameters parameters to concatenate.\n      * @return a concatenation, never {@code null}.\n      */\n     public static HashParameters concat(Iterable<Parameters> parameters) {", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI3MTQ5Mw==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377271493", "bodyText": "Ok will do.", "author": "romain-grecourt", "createdAt": "2020-02-10T19:32:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3Mzk3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/HashParameters.java b/common/http/src/main/java/io/helidon/common/http/HashParameters.java\nindex e89799650..fcde9f3a3 100644\n--- a/common/http/src/main/java/io/helidon/common/http/HashParameters.java\n+++ b/common/http/src/main/java/io/helidon/common/http/HashParameters.java\n\n@@ -136,9 +137,11 @@ public class HashParameters implements Parameters {\n \n     /**\n      * Creates new instance of {@link HashParameters} as a concatenation of provided parameters.\n+     * Values for keys found across the provided parameters are \"concatenated\" into a {@link List} entry for their respective key\n+     * in the created {@link HashParameters} instance.\n      *\n      * @param parameters parameters to concatenate.\n-     * @return a concatenation, never {@code null}.\n+     * @return a new instance of {@link HashParameters} that represents the concatenation of the provided parameters.\n      */\n     public static HashParameters concat(Iterable<Parameters> parameters) {\n         ArrayList<Map<String, List<String>>> prms = new ArrayList<>();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NTUzMA==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377075530", "bodyText": "Our APIs should neither expect nor return null. Please refactor the method and usage to only invoke if not null", "author": "tomas-langer", "createdAt": "2020-02-10T13:55:04Z", "path": "common/http/src/main/java/io/helidon/common/http/Utils.java", "diffHunk": "@@ -80,6 +80,22 @@ private Utils() {\n         return result;\n     }\n \n+    /**\n+     * Unwrap from double-quotes - if exists.\n+     *\n+     * @param str string to unwrap.\n+     * @return unwrapped string.\n+     */\n+    public static String unwrap(String str) {", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI3MjYwNw==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377272607", "bodyText": "I've moved that method from an existing place, I take the blame since I'm making it \"public\" ; will make the change.", "author": "romain-grecourt", "createdAt": "2020-02-10T19:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NTUzMA=="}], "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/common/http/src/main/java/io/helidon/common/http/Utils.java b/common/http/src/main/java/io/helidon/common/http/Utils.java\nindex bb9086617..cc6b1bedc 100644\n--- a/common/http/src/main/java/io/helidon/common/http/Utils.java\n+++ b/common/http/src/main/java/io/helidon/common/http/Utils.java\n\n@@ -87,9 +87,6 @@ public final class Utils {\n      * @return unwrapped string.\n      */\n     public static String unwrap(String str) {\n-        if (str == null) {\n-            return null;\n-        }\n         if (str.length() >= 2 && '\"' == str.charAt(0) && '\"' == str.charAt(str.length() - 1)) {\n             return str.substring(1, str.length() - 1);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NzUyNg==", "url": "https://github.com/oracle/helidon/pull/1356#discussion_r377077526", "bodyText": "use assertThrows", "author": "tomas-langer", "createdAt": "2020-02-10T13:58:25Z", "path": "media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2017, 2020 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.media.jsonp.common;\n+\n+import io.helidon.common.GenericType;\n+\n+import javax.json.JsonArray;\n+import javax.json.JsonException;\n+import javax.json.JsonObject;\n+\n+import io.helidon.common.http.DataChunk;\n+import io.helidon.media.common.MessageBodyReaderContext;\n+import io.helidon.common.reactive.Single;\n+import java.util.concurrent.ExecutionException;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.instanceOf;\n+import static org.hamcrest.CoreMatchers.notNullValue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * The JsonContentReaderTest.\n+ */\n+public class JsonpReaderTest {\n+\n+    private final static MessageBodyReaderContext CONTEXT = MessageBodyReaderContext.create();\n+\n+    private final static JsonpBodyReader READER = JsonProcessing.create().newReader();\n+\n+    @Test\n+    public void simpleJsonObject() throws Exception {\n+        JsonObject jsonObject = readJsonObject(\"{ \\\"p\\\" : \\\"val\\\" }\");\n+        assertThat(jsonObject, is(notNullValue()));\n+        assertThat(jsonObject.getJsonString(\"p\").getString(), is(equalTo(\"val\")));\n+    }\n+\n+    @Test\n+    public void incompatibleTypes() throws Exception {\n+        try {\n+            readJsonArray(\"{ \\\"p\\\" : \\\"val\\\" }\");\n+            fail(\"Should have thrown an exception\");\n+        } catch (ExecutionException ex) {\n+            assertThat(ex.getCause(), is(instanceOf(JsonException.class)));\n+        }\n+    }\n+\n+    @Test\n+    public void simpleJsonArray() throws Exception {\n+        JsonArray array = readJsonArray(\"[ \\\"val\\\" ]\");\n+        assertThat(array, is(notNullValue()));\n+        assertThat(array.getString(0), is(equalTo(\"val\")));\n+    }\n+\n+    @Test\n+    public void invalidJson() throws Exception {\n+        try {\n+            readJsonObject(\"{ \\\"p\\\" : \\\"val\\\" \");", "originalCommit": "80ff0625ef55e4607cce1e08bd1dbabf77ca05b4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "chunk": "diff --git a/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java b/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java\nindex 8ddb12273..4c75e8940 100644\n--- a/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java\n+++ b/media/jsonp/common/src/test/java/io/helidon/media/jsonp/common/JsonpReaderTest.java\n\n@@ -19,7 +19,6 @@ package io.helidon.media.jsonp.common;\n import io.helidon.common.GenericType;\n \n import javax.json.JsonArray;\n-import javax.json.JsonException;\n import javax.json.JsonObject;\n \n import io.helidon.common.http.DataChunk;\n"}}, {"oid": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "url": "https://github.com/oracle/helidon/commit/627ed2e3bc3c004772bb2fc74da641a24da68cf4", "message": "incorporate review feedback", "committedDate": "2020-02-10T20:55:53Z", "type": "commit"}, {"oid": "627ed2e3bc3c004772bb2fc74da641a24da68cf4", "url": "https://github.com/oracle/helidon/commit/627ed2e3bc3c004772bb2fc74da641a24da68cf4", "message": "incorporate review feedback", "committedDate": "2020-02-10T20:55:53Z", "type": "forcePushed"}]}