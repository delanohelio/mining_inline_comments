{"pr_number": 578, "pr_title": "Prepared statement created by SqlConnection#prepare should not be cached ", "pr_createdAt": "2020-04-10T12:51:06Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/578", "timeline": [{"oid": "db57778b85943165ce9ba61dc04fe3ed1ff3ae08", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/db57778b85943165ce9ba61dc04fe3ed1ff3ae08", "message": "non one-shot preparedQuery should not be cached\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-04-10T12:32:57Z", "type": "commit"}, {"oid": "5ca29be8b1b286c92ae211d37a7ccd18bfecf49f", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/5ca29be8b1b286c92ae211d37a7ccd18bfecf49f", "message": "update documentation and examples\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-04-10T12:47:36Z", "type": "commit"}, {"oid": "e42d269d4d7b96dfd70c1a62ac229cce5141b4e5", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/e42d269d4d7b96dfd70c1a62ac229cce5141b4e5", "message": "update the db2 examples as well\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-04-10T12:56:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyMTg3MA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/578#discussion_r406821870", "bodyText": "I think this should not be public because it is not needed by back-ends, this is an package protected internal data that is relevant only to the API and SocketConnectionBase, also the name should be more explicit like shared or cacheable that will tell whether it the prepared statement result can be shared or not.", "author": "vietj", "createdAt": "2020-04-10T15:58:09Z", "path": "vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/command/PrepareStatementCommand.java", "diffHunk": "@@ -22,18 +22,25 @@\n public class PrepareStatementCommand extends CommandBase<PreparedStatement> {\n \n   private final String sql;\n-  public long statement; // 0 means unamed statement otherwise CString\n+  private final boolean auto;\n \n-  public PrepareStatementCommand(String sql) {\n+  public PrepareStatementCommand(String sql, boolean auto) {\n     this.sql = sql;\n+    this.auto = auto;\n   }\n \n   public String sql() {\n     return sql;\n   }\n \n-  public long statement() {\n-    return statement;\n+  /**\n+   * Indicate whether this command is scheduled from {@link io.vertx.sqlclient.SqlClient#preparedQuery(String) one-shot preparedQuery} or {@link io.vertx.sqlclient.SqlConnection#prepare(String)}.\n+   * This flag will tell if lifecycle of the statement will be controlled by the client or not.\n+   *\n+   * @return true if the command is a one-shot prepared query.\n+   */\n+  public boolean auto() {", "originalCommit": "e42d269d4d7b96dfd70c1a62ac229cce5141b4e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk4NTQ5Mw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/578#discussion_r406985493", "bodyText": "the rename is updated in 9408a3b, changing the public access modifier will not be possible because they're in different packages.", "author": "BillyYccc", "createdAt": "2020-04-10T23:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyMTg3MA=="}], "type": "inlineReview", "revised_code": {"commit": "9408a3b5b127a37cc74af466c55ce26d1d07ad89", "chunk": "diff --git a/vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/command/PrepareStatementCommand.java b/vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/command/PrepareStatementCommand.java\nindex 4e8ef066..9b56844b 100644\n--- a/vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/command/PrepareStatementCommand.java\n+++ b/vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/command/PrepareStatementCommand.java\n\n@@ -22,11 +22,11 @@ import io.vertx.sqlclient.impl.PreparedStatement;\n public class PrepareStatementCommand extends CommandBase<PreparedStatement> {\n \n   private final String sql;\n-  private final boolean auto;\n+  private final boolean cacheable;\n \n-  public PrepareStatementCommand(String sql, boolean auto) {\n+  public PrepareStatementCommand(String sql, boolean cacheable) {\n     this.sql = sql;\n-    this.auto = auto;\n+    this.cacheable = cacheable;\n   }\n \n   public String sql() {\n"}}, {"oid": "9408a3b5b127a37cc74af466c55ce26d1d07ad89", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9408a3b5b127a37cc74af466c55ce26d1d07ad89", "message": "rename auto to cacheable\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-04-10T23:43:11Z", "type": "commit"}, {"oid": "304dfe0f1b1bc313f3b5b9f0c08ef9d23c7e4f7a", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/304dfe0f1b1bc313f3b5b9f0c08ef9d23c7e4f7a", "message": "add a test for postgres statement close\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-04-17T14:38:43Z", "type": "commit"}]}