{"pr_number": 678, "pr_title": "Add error message and test for sqlcode -601", "pr_createdAt": "2020-06-05T20:34:38Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/678", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIxNDk2Ng==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/678#discussion_r436214966", "bodyText": "In Windows, this test (line 275) seems to fail because of the trailing single quote ' (at least removing it made the test pass).\nOn the Mac, this test passed fine without modification.", "author": "gjwatts", "createdAt": "2020-06-06T00:26:22Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java", "diffHunk": "@@ -261,6 +261,24 @@ public void testInsertIntoGeneratedAlwaysColumn(TestContext ctx) {\n           }));\n       }));\n     }\n+    \n+    @Test\n+    public void testDuplicateObject(TestContext ctx) {\n+      DB2Connection.connect(vertx, options, ctx.asyncAssertSuccess(conn -> {\n+        conn.query(\"CREATE TABLE Fortune (\\n\" + \n+            \"  id       integer       NOT NULL GENERATED AS IDENTITY (START WITH 1, INCREMENT BY 1),\\n\" + \n+            \"  message  varchar(2048),\\n\" + \n+            \"  PRIMARY KEY  (id)\\n\" + \n+            \")\").execute(ctx.asyncAssertFailure(err -> {\n+            ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+            DB2Exception ex = (DB2Exception) err;\n+            assertContains(ctx, ex.getMessage(), \"The object with the name '\");", "originalCommit": "75e6501f03fc8df0b96aff66418d3489fc2b5108", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f7459a8d01714ecb2336df72f59b7a399aea3317", "chunk": "diff --git a/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java b/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java\nindex 37cd0c60..78b23f40 100644\n--- a/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java\n+++ b/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java\n\n@@ -273,7 +273,7 @@ public class DB2ErrorMessageTest extends DB2TestBase {\n             ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n             DB2Exception ex = (DB2Exception) err;\n             assertContains(ctx, ex.getMessage(), \"The object with the name '\");\n-            assertContains(ctx, ex.getMessage(), \"Fortune'\");\n+            assertContains(ctx, ex.getMessage(), \"FORTUNE'\");\n             assertContains(ctx, ex.getMessage(), \"of type 'TABLE' already exists\");\n             ctx.assertEquals(SqlCode.OBJECT_ALREADY_EXISTS, ex.getErrorCode());\n           }));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIxNjQ2NQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/678#discussion_r436216465", "bodyText": "On both Windows and Mac, this test (line 276) failed for me because of the mixed case of the word Fortune.  In the error message that comes back, it shows the table name as being all uppercase FORTUNE.  Changing the test case to look for the word FORTUNE allowed the test to pass.  Strangely enough, this test succeeds in both Windows and Mac when leaving the trailing single quote at the end of FORTUNE' (which seems to cause problems in the previous test).", "author": "gjwatts", "createdAt": "2020-06-06T00:37:06Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java", "diffHunk": "@@ -261,6 +261,24 @@ public void testInsertIntoGeneratedAlwaysColumn(TestContext ctx) {\n           }));\n       }));\n     }\n+    \n+    @Test\n+    public void testDuplicateObject(TestContext ctx) {\n+      DB2Connection.connect(vertx, options, ctx.asyncAssertSuccess(conn -> {\n+        conn.query(\"CREATE TABLE Fortune (\\n\" + \n+            \"  id       integer       NOT NULL GENERATED AS IDENTITY (START WITH 1, INCREMENT BY 1),\\n\" + \n+            \"  message  varchar(2048),\\n\" + \n+            \"  PRIMARY KEY  (id)\\n\" + \n+            \")\").execute(ctx.asyncAssertFailure(err -> {\n+            ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+            DB2Exception ex = (DB2Exception) err;\n+            assertContains(ctx, ex.getMessage(), \"The object with the name '\");\n+            assertContains(ctx, ex.getMessage(), \"Fortune'\");", "originalCommit": "75e6501f03fc8df0b96aff66418d3489fc2b5108", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ0MTg0NA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/678#discussion_r436441844", "bodyText": "Good catch, didn't have time to run this test locally before I opened the PR. Got it fixed now and CI is green", "author": "aguibert", "createdAt": "2020-06-08T03:32:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIxNjQ2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "f7459a8d01714ecb2336df72f59b7a399aea3317", "chunk": "diff --git a/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java b/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java\nindex 37cd0c60..78b23f40 100644\n--- a/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java\n+++ b/vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java\n\n@@ -273,7 +273,7 @@ public class DB2ErrorMessageTest extends DB2TestBase {\n             ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n             DB2Exception ex = (DB2Exception) err;\n             assertContains(ctx, ex.getMessage(), \"The object with the name '\");\n-            assertContains(ctx, ex.getMessage(), \"Fortune'\");\n+            assertContains(ctx, ex.getMessage(), \"FORTUNE'\");\n             assertContains(ctx, ex.getMessage(), \"of type 'TABLE' already exists\");\n             ctx.assertEquals(SqlCode.OBJECT_ALREADY_EXISTS, ex.getErrorCode());\n           }));\n"}}, {"oid": "f7459a8d01714ecb2336df72f59b7a399aea3317", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/f7459a8d01714ecb2336df72f59b7a399aea3317", "message": "Add error message and test for sqlcode -601", "committedDate": "2020-06-08T03:24:24Z", "type": "commit"}, {"oid": "f7459a8d01714ecb2336df72f59b7a399aea3317", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/f7459a8d01714ecb2336df72f59b7a399aea3317", "message": "Add error message and test for sqlcode -601", "committedDate": "2020-06-08T03:24:24Z", "type": "forcePushed"}]}