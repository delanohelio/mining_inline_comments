{"pr_number": 228, "pr_title": "Add existsQuery method implementation to KNNVectorFieldType", "pr_createdAt": "2020-09-16T22:08:46Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/228", "timeline": [{"oid": "39dc08de843d15427eb1a5e74d6b3d0dc74a62e7", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/39dc08de843d15427eb1a5e74d6b3d0dc74a62e7", "message": "add existsQuery to KNNVectorFieldType", "committedDate": "2020-09-16T22:05:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4NDg1Mg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/228#discussion_r489784852", "bodyText": "How about we declare 2 different knn fields(k1, k2) in the mappings with below scenario\nHave 1 document with both the k1,k2.\nHave 3 docs with only k1\nHave 2 docs with only k2\nHave 1 doc with neither k1 nor k2\nWith exists query for k1, assert hits=4\nWith exists query for k2, assert hits=3", "author": "vamshin", "createdAt": "2020-09-16T22:17:21Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNESIT.java", "diffHunk": "@@ -325,4 +329,36 @@ public void testInvalidQueryHnswAlgoParams() {\n                 createKnnIndexMapping(FIELD_NAME, 2)));\n         assertThat(ex.getMessage(), containsString(\"Failed to parse value [-1] for setting [index.knn.algo_param.ef_search]\"));\n     }\n+\n+    public void testExistsQuery() throws IOException {", "originalCommit": "39dc08de843d15427eb1a5e74d6b3d0dc74a62e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgxMTk5Mg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/228#discussion_r489811992", "bodyText": "Makes sense. Updated the test cases.", "author": "jmazanec15", "createdAt": "2020-09-16T23:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4NDg1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "635dac92be20ac02df1fbbafe3c61de1536d3e76", "chunk": "diff --git a/src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNESIT.java b/src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNESIT.java\nindex b8741e0..819fcfb 100644\n--- a/src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNESIT.java\n+++ b/src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNESIT.java\n\n@@ -331,12 +332,25 @@ public class KNNESIT extends KNNRestTestCase {\n     }\n \n     public void testExistsQuery() throws IOException {\n-        createKnnIndex(INDEX_NAME, createKnnIndexMapping(FIELD_NAME, 2));\n+        String field1 = \"field1\";\n+        String field2 = \"field2\";\n+        createKnnIndex(INDEX_NAME, createKnnIndexMapping(Arrays.asList(field1, field2), Arrays.asList(2, 2)));\n+\n+        Float[] vector = {6.0f, 7.0f};\n+        addKnnDoc(INDEX_NAME, \"1\", Arrays.asList(field1, field2), Arrays.asList(vector, vector));\n+\n+        addKnnDoc(INDEX_NAME, \"2\", field1, vector);\n+        addKnnDoc(INDEX_NAME, \"3\", field1, vector);\n+        addKnnDoc(INDEX_NAME, \"4\", field1, vector);\n+\n+        addKnnDoc(INDEX_NAME, \"5\", field2, vector);\n+        addKnnDoc(INDEX_NAME, \"6\", field2, vector);\n+\n \n         // Create document that does not have k-NN vector field\n         Request request = new Request(\n                 \"POST\",\n-                \"/\" + INDEX_NAME + \"/_doc/1?refresh=true\"\n+                \"/\" + INDEX_NAME + \"/_doc/7?refresh=true\"\n         );\n \n         XContentBuilder builder = XContentFactory.jsonBuilder().startObject()\n"}}, {"oid": "3e4542fcd93e0237c0dd0705fd1b31046121d892", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/3e4542fcd93e0237c0dd0705fd1b31046121d892", "message": "remove if statement for existsQuery", "committedDate": "2020-09-16T23:39:27Z", "type": "commit"}, {"oid": "635dac92be20ac02df1fbbafe3c61de1536d3e76", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/635dac92be20ac02df1fbbafe3c61de1536d3e76", "message": "update existsQuery test case", "committedDate": "2020-09-16T23:39:47Z", "type": "commit"}]}