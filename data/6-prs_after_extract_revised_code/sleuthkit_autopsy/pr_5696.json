{"pr_number": 5696, "pr_title": "6082: Create Email & Phone correlation attribute instances only for a\u2026", "pr_createdAt": "2020-03-10T21:53:06Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5696", "timeline": [{"oid": "bd3a79a5980acdd34885f52ca478351e00048522", "url": "https://github.com/sleuthkit/autopsy/commit/bd3a79a5980acdd34885f52ca478351e00048522", "message": "6082: Create Email & Phone correlation attribute instances only for actual accounts created in CaseDB", "committedDate": "2020-03-10T21:39:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMwODA3OQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5696#discussion_r391308079", "bodyText": "It seems like this normalization should be retained in a method to be called by makeCorrAttrFromAcctArtifact when it process a TSK_ACCOUNT artifact for a phone account.", "author": "rcordovano", "createdAt": "2020-03-11T22:33:01Z", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/CorrelationAttributeUtil.java", "diffHunk": "@@ -169,58 +158,6 @@ private static BlackboardArtifact getCorrAttrSourceArtifact(BlackboardArtifact a\n         return sourceArtifact;\n     }\n \n-    /**\n-     * Makes a correlation attribute instance from a phone number attribute of an\n-     * artifact.\n-     *\n-     * @param artifact An artifact with a phone number attribute.\n-     *\n-     * @return The correlation instance artifact or null, if the phone number is\n-     *         not a valid correlation attribute.\n-     *\n-     * @throws TskCoreException     If there is an error querying the case\n-     *                              database.\n-     * @throws CentralRepoException If there is an error querying the central\n-     *                              repository.\n-     */\n-    private static CorrelationAttributeInstance makeCorrAttrFromArtifactPhoneAttr(BlackboardArtifact artifact) throws TskCoreException, CentralRepoException {\n-        CorrelationAttributeInstance corrAttr = null;\n-\n-        /*\n-         * Extract the phone number from the artifact attribute.\n-         */\n-        String value = null;\n-        if (null != artifact.getAttribute(new BlackboardAttribute.Type(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER))) {\n-            value = artifact.getAttribute(new BlackboardAttribute.Type(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER)).getValueString();\n-        } else if (null != artifact.getAttribute(new BlackboardAttribute.Type(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER_FROM))) {\n-            value = artifact.getAttribute(new BlackboardAttribute.Type(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER_FROM)).getValueString();\n-        } else if (null != artifact.getAttribute(new BlackboardAttribute.Type(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER_TO))) {\n-            value = artifact.getAttribute(new BlackboardAttribute.Type(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER_TO)).getValueString();\n-        }\n-\n-        /*\n-         * Normalize the phone number.\n-         */\n-        if (value != null) {\n-            String newValue = value.replaceAll(\"\\\\D\", \"\");\n-            if (value.startsWith(\"+\")) {\n-                newValue = \"+\" + newValue;\n-            }\n-            value = newValue;\n-\n-            /*\n-             * Validate the phone number. Three to five digit phone numbers may\n-             * be valid, but they are too short to use as correlation\n-             * attributes.\n-             */\n-            if (value.length() > 5) {\n-                corrAttr = makeCorrAttr(artifact, CentralRepository.getInstance().getCorrelationTypeById(CorrelationAttributeInstance.PHONE_TYPE_ID), value);\n-            }\n-        }", "originalCommit": "bd3a79a5980acdd34885f52ca478351e00048522", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwMDgwOA==", "url": "https://github.com/sleuthkit/autopsy/pull/5696#discussion_r391600808", "bodyText": "The CommunicationsManager is already doing the same normalization on phone numbers before creating accounts. Do we really want to repeat that?\nW.r.t the length check, my thought was that since we are now only creating these attributes for actual phone numbers which have been retrieved from call logs or messages, and not from Keyword searches, the odds of getting short false positives are much less.  On the other hand, we may be dropping on the floor real short codes such as 411/611/911.\nI can certainly put it all back in if you prefer that.", "author": "raman-bt", "createdAt": "2020-03-12T12:55:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMwODA3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3MDYzMg==", "url": "https://github.com/sleuthkit/autopsy/pull/5696#discussion_r391670632", "bodyText": "I f we have it covered elsewhere, no worries.", "author": "rcordovano", "createdAt": "2020-03-12T14:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMwODA3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3Mjk4Mw==", "url": "https://github.com/sleuthkit/autopsy/pull/5696#discussion_r392772983", "bodyText": "Just to chime in here, there is no length check in the CommManager. Also, keyword searches were calling makeCorrAttrFromArtifactAttr(), not this function. I'm not sure if any of this matters. It seems important to know if 911 was called, but maybe everyone in the CR has called 911 so the original comment stands. In any case, the code is still picking up the phone numbers that appear in CONTACT, MESSAGE, and CALLOG artifacts, so I'm going to approve.", "author": "dannysmyda", "createdAt": "2020-03-16T04:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMwODA3OQ=="}], "type": "inlineReview", "revised_code": null}]}