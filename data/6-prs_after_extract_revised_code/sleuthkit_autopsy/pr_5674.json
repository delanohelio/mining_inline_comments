{"pr_number": 5674, "pr_title": "6100: Suppress creation of Persona tables.", "pr_createdAt": "2020-03-04T15:50:55Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5674", "timeline": [{"oid": "720980422a031f646281778bb706ef90beee310f", "url": "https://github.com/sleuthkit/autopsy/commit/720980422a031f646281778bb706ef90beee310f", "message": "6100: Suppress creation of Persona tables.", "committedDate": "2020-03-04T15:30:42Z", "type": "commit"}, {"oid": "294aa6c7730e8ca32fac93119127377f0841f376", "url": "https://github.com/sleuthkit/autopsy/commit/294aa6c7730e8ca32fac93119127377f0841f376", "message": "Ensure default content gets populated in Accounts related tables.", "committedDate": "2020-03-04T19:44:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjU5MA==", "url": "https://github.com/sleuthkit/autopsy/pull/5674#discussion_r388412590", "bodyText": "Can this method just return a SQLException and use a try-with-resources block? Recalling what has been said about exception swallowing with try-catch-finally blocks, I believe try-with-resources handles that case for you automatically. Here are the notes from the JLS https://docs.oracle.com/javase/specs/jls/se8/html/jls-14.html#jls-14.20.3.1. Subtle, but the use of addSuppressed() is interesting. Read about it here: https://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#addSuppressed(java.lang.Throwable). It looks like it was designed specifically to fill this gap.", "author": "dannysmyda", "createdAt": "2020-03-05T16:33:14Z", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepoFactory.java", "diffHunk": "@@ -779,6 +766,43 @@ static String getCreatePersonaAccountsTableStatement(CentralRepoPlatforms select\n     }\n \n     \n+     /**\n+      * Inserts the default content in accounts related tables.\n+      * \n+      * @param conn Database connection to use.\n+      * \n+      * @return True if success, false otherwise.\n+      */\n+    private boolean insertDefaultAccountsTablesContent(Connection conn) {", "originalCommit": "294aa6c7730e8ca32fac93119127377f0841f376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjkxNw==", "url": "https://github.com/sleuthkit/autopsy/pull/5674#discussion_r388412917", "bodyText": "I believe suppressed messages make their way into the logged trace, but I could be wrong.", "author": "dannysmyda", "createdAt": "2020-03-05T16:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxNzU3Mg==", "url": "https://github.com/sleuthkit/autopsy/pull/5674#discussion_r388417572", "bodyText": "If this method is too much trouble to change due to intricate design using the return flag, then its ok.", "author": "dannysmyda", "createdAt": "2020-03-05T16:40:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1NzMzMg==", "url": "https://github.com/sleuthkit/autopsy/pull/5674#discussion_r388457332", "bodyText": "@dannysmyda: do you mean \"just throw a SQLException\"?\nI can certainly use try-with-resource in the method to manage the resources, but at this time Id prefer to not change the return value type.  I think the way this and other similar methods are used, is currently expecting a boolean return value.\nAnd this is going to get used in the upgrade path as well, and may further have some conflicts with changes Greg is making.", "author": "raman-bt", "createdAt": "2020-03-05T17:46:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4Nzg0NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5674#discussion_r388487845", "bodyText": "Ok no worries. At first, I wasn't sure if the extended try-with-resources block you just wrote was equivalent to your previous code, but it is according to https://docs.oracle.com/javase/specs/jls/se8/html/jls-14.html#jls-14.20.3.2. Suppression will happen, and then the SQLException we actually care about will be caught in the block you define :).", "author": "dannysmyda", "createdAt": "2020-03-05T18:43:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjU5MA=="}], "type": "inlineReview", "revised_code": {"commit": "98941ab783b7043bc57328f94e1758fe2f056b80", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepoFactory.java b/Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepoFactory.java\nindex 09f103a038..66227ea366 100644\n--- a/Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepoFactory.java\n+++ b/Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepoFactory.java\n\n@@ -774,10 +774,8 @@ static String getCreatePersonaAccountsTableStatement(CentralRepoPlatforms select\n       * @return True if success, false otherwise.\n       */\n     private boolean insertDefaultAccountsTablesContent(Connection conn) {\n-          Statement stmt = null;\n-        try {\n-            stmt = conn.createStatement();\n-             \n+       \n+        try (Statement stmt = conn.createStatement()) {\n             // Populate the account_types table\n             for (Account.Type type : Account.Type.PREDEFINED_ACCOUNT_TYPES) {\n                 int correlationTypeId = getCorrelationTypeIdForAccountType(conn, type);\n"}}, {"oid": "98941ab783b7043bc57328f94e1758fe2f056b80", "url": "https://github.com/sleuthkit/autopsy/commit/98941ab783b7043bc57328f94e1758fe2f056b80", "message": "Use try-with-resources for resource management.", "committedDate": "2020-03-05T18:21:52Z", "type": "commit"}]}