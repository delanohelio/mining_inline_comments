{"pr_number": 5865, "pr_title": "1442 image gallery tag changes", "pr_createdAt": "2020-04-30T22:26:46Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5865", "timeline": [{"oid": "b6775e21bb79456ae9542568e9ebf758751b08a5", "url": "https://github.com/sleuthkit/autopsy/commit/b6775e21bb79456ae9542568e9ebf758751b08a5", "message": "inital stash of code", "committedDate": "2020-04-24T17:18:08Z", "type": "commit"}, {"oid": "0395cecfab6ac336984ec863c875839b218e8ed3", "url": "https://github.com/sleuthkit/autopsy/commit/0395cecfab6ac336984ec863c875839b218e8ed3", "message": "Merge branch '1440-1441-add-tag-set-support' into 1442-image-gallery-tag-changes", "committedDate": "2020-04-27T17:29:45Z", "type": "commit"}, {"oid": "3392dacfef80e715169f16445806f002eaa8bbac", "url": "https://github.com/sleuthkit/autopsy/commit/3392dacfef80e715169f16445806f002eaa8bbac", "message": "Merge branch '1440-1441-add-tag-set-support' into 1442-image-gallery-tag-changes", "committedDate": "2020-04-27T18:47:50Z", "type": "commit"}, {"oid": "125884f809bc0559553a17e510eccc269fb422e2", "url": "https://github.com/sleuthkit/autopsy/commit/125884f809bc0559553a17e510eccc269fb422e2", "message": "Functional IG using TagSet and TagName", "committedDate": "2020-04-30T22:10:26Z", "type": "commit"}, {"oid": "cea79d292e8a215c1cf8a983e543ed8e96797141", "url": "https://github.com/sleuthkit/autopsy/commit/cea79d292e8a215c1cf8a983e543ed8e96797141", "message": "Merge branch 'develop' into 1442-image-gallery-tag-changes", "committedDate": "2020-04-30T22:12:00Z", "type": "commit"}, {"oid": "78123064848111cd41765f52662761bb466073a1", "url": "https://github.com/sleuthkit/autopsy/commit/78123064848111cd41765f52662761bb466073a1", "message": "Fixed codacy warnings", "committedDate": "2020-05-01T14:00:59Z", "type": "commit"}, {"oid": "187359127ad023f0f4b888180c2e6ce246f5e847", "url": "https://github.com/sleuthkit/autopsy/commit/187359127ad023f0f4b888180c2e6ce246f5e847", "message": "Supressed cast warnings", "committedDate": "2020-05-01T14:16:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYxMTY3MA==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r419611670", "bodyText": "These method overloads were just added, right, so this is not a public API change?\nIt would be a good idea to update the param doc as well.", "author": "rcordovano", "createdAt": "2020-05-04T17:43:15Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/Case.java", "diffHunk": "@@ -1628,10 +1628,10 @@ public void notifyBlackBoardArtifactTagAdded(BlackboardArtifactTag newTag) {\n      * This should not be called from the event dispatch thread (EDT)\n      *\n      * @param newTag     new BlackboardArtifactTag added\n-     * @param removedTag The BlackboardArtifactTag that was removed.\n+     * @param removedTagList The BlackboardArtifactTag that was removed.\n      */\n-    public void notifyBlackBoardArtifactTagAdded(BlackboardArtifactTag newTag, BlackboardArtifactTag removedTag) {\n-        eventPublisher.publish(new BlackBoardArtifactTagAddedEvent(newTag, removedTag));\n+    public void notifyBlackBoardArtifactTagAdded(BlackboardArtifactTag newTag, List<BlackboardArtifactTag> removedTagList) {\n+        eventPublisher.publish(new BlackBoardArtifactTagAddedEvent(newTag, removedTagList));", "originalCommit": "187359127ad023f0f4b888180c2e6ce246f5e847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3MDc5NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420170795", "bodyText": "Yes, they are newly added in the previous PR.  Doc will be updated.", "author": "kellykelly3", "createdAt": "2020-05-05T14:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYxMTY3MA=="}], "type": "inlineReview", "revised_code": {"commit": "d977fb6f77fb4a1db24b2b004a38a377051ce988", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/Case.java b/Core/src/org/sleuthkit/autopsy/casemodule/Case.java\nindex 43c9c463f8..47fff7320f 100644\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/Case.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/Case.java\n\n@@ -1627,8 +1628,9 @@ public void notifyBlackBoardArtifactTagAdded(BlackboardArtifactTag newTag) {\n      *\n      * This should not be called from the event dispatch thread (EDT)\n      *\n-     * @param newTag     new BlackboardArtifactTag added\n-     * @param removedTagList The BlackboardArtifactTag that was removed.\n+     * @param newTag            The added ContentTag.\n+     * @param removedTagList    List of ContentTags that were removed as a result \n+     *                          of the addition of newTag.\n      */\n     public void notifyBlackBoardArtifactTagAdded(BlackboardArtifactTag newTag, List<BlackboardArtifactTag> removedTagList) {\n         eventPublisher.publish(new BlackBoardArtifactTagAddedEvent(newTag, removedTagList));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDM2Mg==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r419710362", "bodyText": "If you do an instanceof, you won't need to suppress the warning.", "author": "rcordovano", "createdAt": "2020-05-04T20:32:55Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/events/ContentTagAddedEvent.java", "diffHunk": "@@ -50,7 +53,43 @@ public ContentTagAddedEvent(ContentTag newTag, ContentTag deletedTag) {\n      * @throws NoCurrentCaseException\n      * @throws TskCoreException\n      */\n+    @Override\n     ContentTag getTagByID() throws NoCurrentCaseException, TskCoreException {\n         return Case.getCurrentCaseThrows().getServices().getTagsManager().getContentTagByTagID(getTagID());\n     }\n+    \n+    /**\n+     * Returns the list of tags that were removed as a result of the addition \n+     * of the ContentTag.\n+     * \n+     * @return A list of removed tags or null if no tags were removed.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    public List<DeletedContentTagInfo> getRemovedTags() {\n+        Object oldValue = this.getOldValue();", "originalCommit": "187359127ad023f0f4b888180c2e6ce246f5e847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4Njc4Mg==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420186782", "bodyText": "An instanceof is not enough. I even tried first an instancof List then getting the first item and checking that it is a DeletedContentTagInfo and the warning still appears.\nhttps://stackoverflow.com/questions/10108122/how-to-instanceof-listmytype", "author": "kellykelly3", "createdAt": "2020-05-05T15:12:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDM2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4MTM4Mg==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420281382", "bodyText": "Bummer. Let's bite the bullet then and treat ourselves to a dedicated field, instead of using the super class oldValue field. Then we can override getOldValue and we can also provide a properly typed method to return the List. This is the alternate implementation strategy that I mentioned earlier - it appears we can use it here to avoid the warning suppression.", "author": "rcordovano", "createdAt": "2020-05-05T17:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDM2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "686c49b2833dedf749baa99cc0a6a96616fe6386", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/events/ContentTagAddedEvent.java b/Core/src/org/sleuthkit/autopsy/casemodule/events/ContentTagAddedEvent.java\nindex 513fef55f3..10a80c772e 100644\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/events/ContentTagAddedEvent.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/events/ContentTagAddedEvent.java\n\n@@ -58,23 +57,6 @@ ContentTag getTagByID() throws NoCurrentCaseException, TskCoreException {\n         return Case.getCurrentCaseThrows().getServices().getTagsManager().getContentTagByTagID(getTagID());\n     }\n     \n-    /**\n-     * Returns the list of tags that were removed as a result of the addition \n-     * of the ContentTag.\n-     * \n-     * @return A list of removed tags or null if no tags were removed.\n-     */\n-    @SuppressWarnings(\"unchecked\")\n-    public List<DeletedContentTagInfo> getRemovedTags() {\n-        Object oldValue = this.getOldValue();\n-        if (oldValue != null) {\n-            return (List<DeletedContentTagInfo>)oldValue;\n-        } else {\n-            return null;\n-        }\n-    }\n-\n-    \n     /**\n      * Create a list of DeletedContentTagInfo objects from a list of ContentTags.\n      * \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDY2Nw==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r419710667", "bodyText": "If you do an instanceof, you won't need to suppress the warning.", "author": "rcordovano", "createdAt": "2020-05-04T20:33:29Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/events/BlackBoardArtifactTagAddedEvent.java", "diffHunk": "@@ -54,4 +57,37 @@ public BlackBoardArtifactTagAddedEvent(BlackboardArtifactTag newTag, BlackboardA\n     BlackboardArtifactTag getTagByID() throws NoCurrentCaseException, TskCoreException {\n         return Case.getCurrentCaseThrows().getServices().getTagsManager().getBlackboardArtifactTagByTagID(getTagID());\n     }\n+    \n+    /**\n+     * Returns a list of tags removed as a result of the addition of the tag.\n+     * \n+     * @return A List of DeletedBlackboardArtifactTagInfo or null if no tags were removed.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    public List<DeletedBlackboardArtifactTagInfo> getRemovedTags() {", "originalCommit": "187359127ad023f0f4b888180c2e6ce246f5e847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NjgyOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420186829", "bodyText": "See above comment.", "author": "kellykelly3", "createdAt": "2020-05-05T15:12:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4MTU0NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420281545", "bodyText": "See above response.", "author": "rcordovano", "createdAt": "2020-05-05T17:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDY2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "686c49b2833dedf749baa99cc0a6a96616fe6386", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/events/BlackBoardArtifactTagAddedEvent.java b/Core/src/org/sleuthkit/autopsy/casemodule/events/BlackBoardArtifactTagAddedEvent.java\nindex 5e75a3105b..e9793a51b0 100644\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/events/BlackBoardArtifactTagAddedEvent.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/events/BlackBoardArtifactTagAddedEvent.java\n\n@@ -59,29 +58,16 @@ BlackboardArtifactTag getTagByID() throws NoCurrentCaseException, TskCoreExcepti\n     }\n     \n     /**\n-     * Returns a list of tags removed as a result of the addition of the tag.\n-     * \n-     * @return A List of DeletedBlackboardArtifactTagInfo or null if no tags were removed.\n-     */\n-    @SuppressWarnings(\"unchecked\")\n-    public List<DeletedBlackboardArtifactTagInfo> getRemovedTags() {\n-        Object oldValue = this.getOldValue();\n-        if (oldValue != null) {\n-            return (List<DeletedBlackboardArtifactTagInfo>)oldValue;\n-        } else {\n-            return null;\n-        }\n-    }\n-    \n-    /**\n-     * Create a list of DeletedContentTagInfo objects from a list of ContentTags.\n-     * \n+     * Create a list of DeletedContentTagInfo objects from a list of\n+     * BlackboardArtifactTags.\n+     *\n      * @param deletedTagList List of deleted ContentTags.\n-     * \n-     * @return List of DeletedContentTagInfo objects or empty list if deletedTagList was empty or null.\n+     *\n+     * @return List of DeletedContentTagInfo objects or empty list if\n+     *         deletedTagList was empty or null.\n      */\n-    private static List<DeletedTagInfo<BlackboardArtifactTag>> getDeletedInfo(List<BlackboardArtifactTag> deletedTagList) {\n-        List<DeletedTagInfo<BlackboardArtifactTag>> deletedInfoList = new ArrayList<>();\n+    private static List<DeletedBlackboardArtifactTagInfo> getDeletedInfo(List<BlackboardArtifactTag> deletedTagList) {\n+        List<DeletedBlackboardArtifactTagInfo> deletedInfoList = new ArrayList<>();\n         if (deletedTagList != null) {\n             for (BlackboardArtifactTag tag : deletedTagList) {\n                 deletedInfoList.add(new DeletedBlackboardArtifactTagInfo(tag));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxOTM0NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r419719345", "bodyText": "We should not have code going to the DrawableDB to get an ImageGalleryController reference. I recently went through some trouble to make sure that all (I think) ImageGalleryController references were handed out to the classes that needed them via their constructors using a reference obtained from a call to ImageGalleryController.getController that keeps a mapping of cases to controllers (it's not an elegant solution to the bugs we were experiencing from holding on to references to old controllers, but it got the job done).\nIt looks like this method is unused, so we can just delete it.", "author": "rcordovano", "createdAt": "2020-05-04T20:49:44Z", "path": "ImageGallery/src/org/sleuthkit/autopsy/imagegallery/datamodel/DrawableDB.java", "diffHunk": "@@ -477,14 +477,23 @@ public static DrawableDB getDrawableDB(ImageGalleryController controller) throws\n         }\n \n         try {\n-            return new DrawableDB(dbPath, controller);\n+            return new DrawableDB(dbPath, controller, standardCategories);\n         } catch (IOException ex) {\n             throw new TskCoreException(\"Failed to create drawables database directory\", ex); //NON-NLS\n         } catch (SQLException ex) {\n             throw new TskCoreException(\"Failed to create/open the drawables database\", ex); //NON-NLS\n         }\n     }\n \n+    /**\n+     * Return the DrawableDBs handle to the ImageGalleryController.\n+     *\n+     * @return Controller instance.\n+     */\n+    public ImageGalleryController getImageGalleryController() {\n+        return controller;\n+    }\n+", "originalCommit": "187359127ad023f0f4b888180c2e6ce246f5e847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIyMzAyMg==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420223022", "bodyText": "This was a left behind from trying to get things to work.  It has been removed.", "author": "kellykelly3", "createdAt": "2020-05-05T16:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxOTM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3OTU0NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5865#discussion_r420279545", "bodyText": "Thanks!", "author": "rcordovano", "createdAt": "2020-05-05T17:23:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxOTM0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "d977fb6f77fb4a1db24b2b004a38a377051ce988", "chunk": "diff --git a/ImageGallery/src/org/sleuthkit/autopsy/imagegallery/datamodel/DrawableDB.java b/ImageGallery/src/org/sleuthkit/autopsy/imagegallery/datamodel/DrawableDB.java\nindex 9e91b09983..3aa39bd2fd 100644\n--- a/ImageGallery/src/org/sleuthkit/autopsy/imagegallery/datamodel/DrawableDB.java\n+++ b/ImageGallery/src/org/sleuthkit/autopsy/imagegallery/datamodel/DrawableDB.java\n\n@@ -484,16 +484,7 @@ public static DrawableDB getDrawableDB(ImageGalleryController controller, TagSet\n             throw new TskCoreException(\"Failed to create/open the drawables database\", ex); //NON-NLS\n         }\n     }\n-\n-    /**\n-     * Return the DrawableDBs handle to the ImageGalleryController.\n-     *\n-     * @return Controller instance.\n-     */\n-    public ImageGalleryController getImageGalleryController() {\n-        return controller;\n-    }\n-\n+    \n     /**\n      * Checks if the specified table exists in Drawable DB\n      *\n"}}, {"oid": "d977fb6f77fb4a1db24b2b004a38a377051ce988", "url": "https://github.com/sleuthkit/autopsy/commit/d977fb6f77fb4a1db24b2b004a38a377051ce988", "message": "Changes based on review comments", "committedDate": "2020-05-05T16:03:00Z", "type": "commit"}, {"oid": "686c49b2833dedf749baa99cc0a6a96616fe6386", "url": "https://github.com/sleuthkit/autopsy/commit/686c49b2833dedf749baa99cc0a6a96616fe6386", "message": "Modified TagAddEvent", "committedDate": "2020-05-05T18:28:48Z", "type": "commit"}, {"oid": "0f5da1685b04f0061cd68efd8342d9eca502fe73", "url": "https://github.com/sleuthkit/autopsy/commit/0f5da1685b04f0061cd68efd8342d9eca502fe73", "message": "Changed HTML_COLOR method name", "committedDate": "2020-05-05T19:11:16Z", "type": "commit"}]}