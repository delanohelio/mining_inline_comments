{"pr_number": 5840, "pr_title": "1440& 1441 add tag set support", "pr_createdAt": "2020-04-21T00:05:28Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5840", "timeline": [{"oid": "4475a3dd0a707b0d3bdd923c856e66595cbeeeaf", "url": "https://github.com/sleuthkit/autopsy/commit/4475a3dd0a707b0d3bdd923c856e66595cbeeeaf", "message": "inital save", "committedDate": "2020-04-09T18:38:35Z", "type": "commit"}, {"oid": "58386f1b91ee41a54a7cc4fd17320af692dd6c01", "url": "https://github.com/sleuthkit/autopsy/commit/58386f1b91ee41a54a7cc4fd17320af692dd6c01", "message": "Merge branch 'develop' into 1439-base-category-tags", "committedDate": "2020-04-20T17:52:58Z", "type": "commit"}, {"oid": "dbaaa7efaeec9eec076537b5116bb8d4c3a56c68", "url": "https://github.com/sleuthkit/autopsy/commit/dbaaa7efaeec9eec076537b5116bb8d4c3a56c68", "message": "First pass of TagSEt support", "committedDate": "2020-04-21T00:04:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4NTY5MQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412185691", "bodyText": "TAG_SETTINGS_NAME_VERSION -> TAG_SETTINGS_VERSION", "author": "rcordovano", "createdAt": "2020-04-21T13:30:20Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -46,20 +48,43 @@\n     private static final Logger LOGGER = Logger.getLogger(TagNameDefinition.class.getName());\n     @NbBundle.Messages({\"TagNameDefinition.predefTagNames.bookmark.text=Bookmark\",\n         \"TagNameDefinition.predefTagNames.followUp.text=Follow Up\",\n-        \"TagNameDefinition.predefTagNames.notableItem.text=Notable Item\"})\n+        \"TagNameDefinition.predefTagNames.notableItem.text=Notable Item\",\n+        \"Category.one=CAT-1: Child Exploitation (Illegal)\",\n+        \"Category.two=CAT-2: Child Exploitation (Non-Illegal/Age Difficult)\",\n+        \"Category.three=CAT-3: CGI/Animation (Child Exploitive)\",\n+        \"Category.four=CAT-4: Exemplar/Comparison (Internal Use Only)\",\n+        \"Category.five=CAT-5: Non-pertinent\",\n+        \"Category.zero=CAT-0: Uncategorized\"})\n+\n     private static final String TAGS_SETTINGS_NAME = \"Tags\"; //NON-NLS\n-    private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS    \n+    private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS \n+    private static final String TAG_NAMES_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n+    private static final String TAG_SETTINGS_NAME_VERSION = \"1\";", "originalCommit": "dbaaa7efaeec9eec076537b5116bb8d4c3a56c68", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ca23c913e170813d6024b8fde93ae1fdec43951d", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\nindex b86735a565..c943205c3d 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n\n@@ -58,31 +60,27 @@\n \n     private static final String TAGS_SETTINGS_NAME = \"Tags\"; //NON-NLS\n     private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS \n-    private static final String TAG_NAMES_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n-    private static final String TAG_SETTINGS_NAME_VERSION = \"1\";\n+    private static final String TAG_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n+    private static final String TAG_SETTINGS_VERSION = \"1\";\n \n     private final String displayName;\n     private final String description;\n     private final TagName.HTML_COLOR color;\n     private final TskData.FileKnown knownStatus;\n \n-    static final Map<String, TagNameDefinition> STANDARD_TAGS = new HashMap<>();\n-    static final Map<String, TagNameDefinition> PROJECT_VIC_DEFAULT_TAGS = new HashMap<>();\n-    private static final List<String> STANDARD_TAG_NAMES = new ArrayList<>();\n+    private static final Map<String, TagNameDefinition> STANDARD_TAGS_DEFINITIONS = new HashMap<>();\n+    private static final Map<String, TagNameDefinition> PROJECT_VIC_TAG_DEFINITIONS = new HashMap<>();\n \n     static {\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_followUp_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_followUp_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_followUp_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_followUp_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n \n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_one(), new TagNameDefinition(Bundle.Category_one(), \"\", TagName.HTML_COLOR.RED, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_two(), new TagNameDefinition(Bundle.Category_two(), \"\", TagName.HTML_COLOR.LIME, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_three(), new TagNameDefinition(Bundle.Category_three(), \"\", TagName.HTML_COLOR.YELLOW, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_four(), new TagNameDefinition(Bundle.Category_four(), \"\", TagName.HTML_COLOR.PURPLE, TskData.FileKnown.UNKNOWN));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_five(), new TagNameDefinition(Bundle.Category_five(), \"\", TagName.HTML_COLOR.SILVER, TskData.FileKnown.UNKNOWN));\n-\n-        STANDARD_TAG_NAMES.addAll(STANDARD_TAGS.keySet());\n-        STANDARD_TAG_NAMES.addAll(PROJECT_VIC_DEFAULT_TAGS.keySet());\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_one(), new TagNameDefinition(Bundle.Category_one(), \"\", TagName.HTML_COLOR.RED, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_two(), new TagNameDefinition(Bundle.Category_two(), \"\", TagName.HTML_COLOR.LIME, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_three(), new TagNameDefinition(Bundle.Category_three(), \"\", TagName.HTML_COLOR.YELLOW, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_four(), new TagNameDefinition(Bundle.Category_four(), \"\", TagName.HTML_COLOR.PURPLE, TskData.FileKnown.UNKNOWN));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_five(), new TagNameDefinition(Bundle.Category_five(), \"\", TagName.HTML_COLOR.SILVER, TskData.FileKnown.UNKNOWN));\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4NjIwMQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412186201", "bodyText": "TAG_NAMES_SETTING_VERSION_KEY -> TAG_SETTING_VERSION_KEY", "author": "rcordovano", "createdAt": "2020-04-21T13:30:59Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -46,20 +48,43 @@\n     private static final Logger LOGGER = Logger.getLogger(TagNameDefinition.class.getName());\n     @NbBundle.Messages({\"TagNameDefinition.predefTagNames.bookmark.text=Bookmark\",\n         \"TagNameDefinition.predefTagNames.followUp.text=Follow Up\",\n-        \"TagNameDefinition.predefTagNames.notableItem.text=Notable Item\"})\n+        \"TagNameDefinition.predefTagNames.notableItem.text=Notable Item\",\n+        \"Category.one=CAT-1: Child Exploitation (Illegal)\",\n+        \"Category.two=CAT-2: Child Exploitation (Non-Illegal/Age Difficult)\",\n+        \"Category.three=CAT-3: CGI/Animation (Child Exploitive)\",\n+        \"Category.four=CAT-4: Exemplar/Comparison (Internal Use Only)\",\n+        \"Category.five=CAT-5: Non-pertinent\",\n+        \"Category.zero=CAT-0: Uncategorized\"})\n+\n     private static final String TAGS_SETTINGS_NAME = \"Tags\"; //NON-NLS\n-    private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS    \n+    private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS \n+    private static final String TAG_NAMES_SETTING_VERSION_KEY = \"CustomTagNameVersion\";", "originalCommit": "dbaaa7efaeec9eec076537b5116bb8d4c3a56c68", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ca23c913e170813d6024b8fde93ae1fdec43951d", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\nindex b86735a565..c943205c3d 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n\n@@ -58,31 +60,27 @@\n \n     private static final String TAGS_SETTINGS_NAME = \"Tags\"; //NON-NLS\n     private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS \n-    private static final String TAG_NAMES_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n-    private static final String TAG_SETTINGS_NAME_VERSION = \"1\";\n+    private static final String TAG_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n+    private static final String TAG_SETTINGS_VERSION = \"1\";\n \n     private final String displayName;\n     private final String description;\n     private final TagName.HTML_COLOR color;\n     private final TskData.FileKnown knownStatus;\n \n-    static final Map<String, TagNameDefinition> STANDARD_TAGS = new HashMap<>();\n-    static final Map<String, TagNameDefinition> PROJECT_VIC_DEFAULT_TAGS = new HashMap<>();\n-    private static final List<String> STANDARD_TAG_NAMES = new ArrayList<>();\n+    private static final Map<String, TagNameDefinition> STANDARD_TAGS_DEFINITIONS = new HashMap<>();\n+    private static final Map<String, TagNameDefinition> PROJECT_VIC_TAG_DEFINITIONS = new HashMap<>();\n \n     static {\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_followUp_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_followUp_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_followUp_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_followUp_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n \n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_one(), new TagNameDefinition(Bundle.Category_one(), \"\", TagName.HTML_COLOR.RED, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_two(), new TagNameDefinition(Bundle.Category_two(), \"\", TagName.HTML_COLOR.LIME, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_three(), new TagNameDefinition(Bundle.Category_three(), \"\", TagName.HTML_COLOR.YELLOW, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_four(), new TagNameDefinition(Bundle.Category_four(), \"\", TagName.HTML_COLOR.PURPLE, TskData.FileKnown.UNKNOWN));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_five(), new TagNameDefinition(Bundle.Category_five(), \"\", TagName.HTML_COLOR.SILVER, TskData.FileKnown.UNKNOWN));\n-\n-        STANDARD_TAG_NAMES.addAll(STANDARD_TAGS.keySet());\n-        STANDARD_TAG_NAMES.addAll(PROJECT_VIC_DEFAULT_TAGS.keySet());\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_one(), new TagNameDefinition(Bundle.Category_one(), \"\", TagName.HTML_COLOR.RED, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_two(), new TagNameDefinition(Bundle.Category_two(), \"\", TagName.HTML_COLOR.LIME, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_three(), new TagNameDefinition(Bundle.Category_three(), \"\", TagName.HTML_COLOR.YELLOW, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_four(), new TagNameDefinition(Bundle.Category_four(), \"\", TagName.HTML_COLOR.PURPLE, TskData.FileKnown.UNKNOWN));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_five(), new TagNameDefinition(Bundle.Category_five(), \"\", TagName.HTML_COLOR.SILVER, TskData.FileKnown.UNKNOWN));\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5NDEzOA==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412194138", "bodyText": "Let's add package private getters for these collections and make the fields private. Perhaps add _DEFS suffixes to the variable names for clarity.", "author": "rcordovano", "createdAt": "2020-04-21T13:40:59Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -46,20 +48,43 @@\n     private static final Logger LOGGER = Logger.getLogger(TagNameDefinition.class.getName());\n     @NbBundle.Messages({\"TagNameDefinition.predefTagNames.bookmark.text=Bookmark\",\n         \"TagNameDefinition.predefTagNames.followUp.text=Follow Up\",\n-        \"TagNameDefinition.predefTagNames.notableItem.text=Notable Item\"})\n+        \"TagNameDefinition.predefTagNames.notableItem.text=Notable Item\",\n+        \"Category.one=CAT-1: Child Exploitation (Illegal)\",\n+        \"Category.two=CAT-2: Child Exploitation (Non-Illegal/Age Difficult)\",\n+        \"Category.three=CAT-3: CGI/Animation (Child Exploitive)\",\n+        \"Category.four=CAT-4: Exemplar/Comparison (Internal Use Only)\",\n+        \"Category.five=CAT-5: Non-pertinent\",\n+        \"Category.zero=CAT-0: Uncategorized\"})\n+\n     private static final String TAGS_SETTINGS_NAME = \"Tags\"; //NON-NLS\n-    private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS    \n+    private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS \n+    private static final String TAG_NAMES_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n+    private static final String TAG_SETTINGS_NAME_VERSION = \"1\";\n \n-    private static final List<String> STANDARD_NOTABLE_TAG_DISPLAY_NAMES = Arrays.asList(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), DhsImageCategory.ONE.getDisplayName(), DhsImageCategory.TWO.getDisplayName(), DhsImageCategory.THREE.getDisplayName());  // NON-NLS\n-    private static final List<String> STANDARD_TAG_DISPLAY_NAMES = Arrays.asList(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), Bundle.TagNameDefinition_predefTagNames_followUp_text(),\n-            Bundle.TagNameDefinition_predefTagNames_notableItem_text(), DhsImageCategory.ONE.getDisplayName(),\n-            DhsImageCategory.TWO.getDisplayName(), DhsImageCategory.THREE.getDisplayName(),\n-            DhsImageCategory.FOUR.getDisplayName(), DhsImageCategory.FIVE.getDisplayName(), DhsImageCategory.ZERO.getDisplayName());\n     private final String displayName;\n     private final String description;\n     private final TagName.HTML_COLOR color;\n     private final TskData.FileKnown knownStatus;\n \n+    static final Map<String, TagNameDefinition> STANDARD_TAGS = new HashMap<>();\n+    static final Map<String, TagNameDefinition> PROJECT_VIC_DEFAULT_TAGS = new HashMap<>();", "originalCommit": "dbaaa7efaeec9eec076537b5116bb8d4c3a56c68", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ca23c913e170813d6024b8fde93ae1fdec43951d", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\nindex b86735a565..c943205c3d 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n\n@@ -58,31 +60,27 @@\n \n     private static final String TAGS_SETTINGS_NAME = \"Tags\"; //NON-NLS\n     private static final String TAG_NAMES_SETTING_KEY = \"TagNames\"; //NON-NLS \n-    private static final String TAG_NAMES_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n-    private static final String TAG_SETTINGS_NAME_VERSION = \"1\";\n+    private static final String TAG_SETTING_VERSION_KEY = \"CustomTagNameVersion\";\n+    private static final String TAG_SETTINGS_VERSION = \"1\";\n \n     private final String displayName;\n     private final String description;\n     private final TagName.HTML_COLOR color;\n     private final TskData.FileKnown knownStatus;\n \n-    static final Map<String, TagNameDefinition> STANDARD_TAGS = new HashMap<>();\n-    static final Map<String, TagNameDefinition> PROJECT_VIC_DEFAULT_TAGS = new HashMap<>();\n-    private static final List<String> STANDARD_TAG_NAMES = new ArrayList<>();\n+    private static final Map<String, TagNameDefinition> STANDARD_TAGS_DEFINITIONS = new HashMap<>();\n+    private static final Map<String, TagNameDefinition> PROJECT_VIC_TAG_DEFINITIONS = new HashMap<>();\n \n     static {\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_followUp_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_followUp_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n-        STANDARD_TAGS.put(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_bookmark_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_followUp_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_followUp_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+        STANDARD_TAGS_DEFINITIONS.put(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), new TagNameDefinition(Bundle.TagNameDefinition_predefTagNames_notableItem_text(), \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n \n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_one(), new TagNameDefinition(Bundle.Category_one(), \"\", TagName.HTML_COLOR.RED, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_two(), new TagNameDefinition(Bundle.Category_two(), \"\", TagName.HTML_COLOR.LIME, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_three(), new TagNameDefinition(Bundle.Category_three(), \"\", TagName.HTML_COLOR.YELLOW, TskData.FileKnown.BAD));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_four(), new TagNameDefinition(Bundle.Category_four(), \"\", TagName.HTML_COLOR.PURPLE, TskData.FileKnown.UNKNOWN));\n-        PROJECT_VIC_DEFAULT_TAGS.put(Bundle.Category_five(), new TagNameDefinition(Bundle.Category_five(), \"\", TagName.HTML_COLOR.SILVER, TskData.FileKnown.UNKNOWN));\n-\n-        STANDARD_TAG_NAMES.addAll(STANDARD_TAGS.keySet());\n-        STANDARD_TAG_NAMES.addAll(PROJECT_VIC_DEFAULT_TAGS.keySet());\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_one(), new TagNameDefinition(Bundle.Category_one(), \"\", TagName.HTML_COLOR.RED, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_two(), new TagNameDefinition(Bundle.Category_two(), \"\", TagName.HTML_COLOR.LIME, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_three(), new TagNameDefinition(Bundle.Category_three(), \"\", TagName.HTML_COLOR.YELLOW, TskData.FileKnown.BAD));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_four(), new TagNameDefinition(Bundle.Category_four(), \"\", TagName.HTML_COLOR.PURPLE, TskData.FileKnown.UNKNOWN));\n+        PROJECT_VIC_TAG_DEFINITIONS.put(Bundle.Category_five(), new TagNameDefinition(Bundle.Category_five(), \"\", TagName.HTML_COLOR.SILVER, TskData.FileKnown.UNKNOWN));\n     }\n \n     /**\n"}}, {"oid": "ca23c913e170813d6024b8fde93ae1fdec43951d", "url": "https://github.com/sleuthkit/autopsy/commit/ca23c913e170813d6024b8fde93ae1fdec43951d", "message": "codacy and code review updates", "committedDate": "2020-04-21T19:21:54Z", "type": "commit"}, {"oid": "8409bee5b0fd95bb2646529bab5e47f30ea5520a", "url": "https://github.com/sleuthkit/autopsy/commit/8409bee5b0fd95bb2646529bab5e47f30ea5520a", "message": "Removed unused imports", "committedDate": "2020-04-21T20:13:07Z", "type": "commit"}, {"oid": "98151b1de8791fe3aeb64981a2aa035087fcbb19", "url": "https://github.com/sleuthkit/autopsy/commit/98151b1de8791fe3aeb64981a2aa035087fcbb19", "message": "Updated format in TagNameDefinition", "committedDate": "2020-04-21T21:13:35Z", "type": "commit"}, {"oid": "d34b1038abf586d140d6c1d88985ad6053839ed3", "url": "https://github.com/sleuthkit/autopsy/commit/d34b1038abf586d140d6c1d88985ad6053839ed3", "message": "Update with more review changes", "committedDate": "2020-04-22T19:13:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUxNzE5OQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412517199", "bodyText": "I think we still need a check here to make sure the user is not trying to make a tag definition with a tag name already used by the one of the standard tag definitions.", "author": "rcordovano", "createdAt": "2020-04-21T21:52:31Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDialog.java", "diffHunk": "@@ -140,7 +140,7 @@ private void doButtonAction(boolean okPressed) {\n                 return;\n             }\n             //if a tag name contains illegal characters and is not the name of one of the standard tags\n-            if (TagsManager.containsIllegalCharacters(newTagDisplayName) && !TagNameDefinition.getStandardTagNames().contains(newTagDisplayName)) {\n+            if (TagsManager.containsIllegalCharacters(newTagDisplayName)) {", "originalCommit": "98151b1de8791fe3aeb64981a2aa035087fcbb19", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "33ef944becf4214684b68d67202236e51268bc49", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDialog.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDialog.java\nindex 5b2bb75da5..79207aaaaa 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDialog.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDialog.java\n\n@@ -140,7 +140,7 @@ private void doButtonAction(boolean okPressed) {\n                 return;\n             }\n             //if a tag name contains illegal characters and is not the name of one of the standard tags\n-            if (TagsManager.containsIllegalCharacters(newTagDisplayName)) {\n+            if (TagsManager.containsIllegalCharacters(newTagDisplayName) && !TagNameDefinition.getStandardTagNames().contains(newTagDisplayName)) {\n                 JOptionPane.showMessageDialog(this,\n                         NbBundle.getMessage(TagNameDialog.class, \"TagNameDialog.JOptionPane.tagDescriptionIllegalCharacters.message\"),\n                         NbBundle.getMessage(TagNameDialog.class, \"TagNameDialog.JOptionPane.tagDescriptionIllegalCharacters.title\"),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUxODA2Mw==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412518063", "bodyText": "By removing this altogether are we now allowing deletion of tags when ingest is running where we were not permitting this before?", "author": "rcordovano", "createdAt": "2020-04-21T21:54:14Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagOptionsPanel.java", "diffHunk": "@@ -446,8 +446,6 @@ private void updatePanel() {\n         boolean isSelected = tagNamesList.getSelectedIndex() != -1;\n         boolean enableEdit = !ingestIsRunning && isSelected;\n         editTagNameButton.setEnabled(enableEdit);\n-        boolean enableDelete = enableEdit && !TagNameDefinition.getStandardTagNames().contains(tagNamesList.getSelectedValue().getDisplayName());\n-        deleteTagNameButton.setEnabled(enableDelete);", "originalCommit": "98151b1de8791fe3aeb64981a2aa035087fcbb19", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "33ef944becf4214684b68d67202236e51268bc49", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagOptionsPanel.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagOptionsPanel.java\nindex 0e5ebeb4ea..2ef9869adc 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagOptionsPanel.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagOptionsPanel.java\n\n@@ -446,6 +446,7 @@ private void updatePanel() {\n         boolean isSelected = tagNamesList.getSelectedIndex() != -1;\n         boolean enableEdit = !ingestIsRunning && isSelected;\n         editTagNameButton.setEnabled(enableEdit);\n+        deleteTagNameButton.setEnabled(enableEdit);\n         if (isSelected) {\n             descriptionTextArea.setText(tagNamesList.getSelectedValue().getDescription());\n             if (tagNamesList.getSelectedValue().getKnownStatus() == TskData.FileKnown.BAD) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUxOTA2MA==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412519060", "bodyText": "In TagNameDefinition, we have the default Project VIC tag set name as a localizable string, where it is just hard-coded here.", "author": "rcordovano", "createdAt": "2020-04-21T21:56:03Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java", "diffHunk": "@@ -168,6 +171,28 @@ public static String getNotableTagLabel() {\n      */\n     TagsManager(SleuthkitCase caseDb) {\n         this.caseDb = caseDb;\n+\n+        // Add standard tags and  the Project VIC default tag set and tags.\n+        TaggingManager taggingMgr = caseDb.getTaggingManager();\n+        try {\n+            List<TagSet> setList = taggingMgr.getTagSets();\n+            if (setList.isEmpty()) {\n+                //Assume new case and add Project VIC tags.\n+                TagSet set = taggingMgr.addTagSet(\"Project VIC (United States)\");", "originalCommit": "98151b1de8791fe3aeb64981a2aa035087fcbb19", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "33ef944becf4214684b68d67202236e51268bc49", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java\nindex 786c76ec7b..d03adff91c 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java\n\n@@ -178,12 +180,12 @@ public static String getNotableTagLabel() {\n             List<TagSet> setList = taggingMgr.getTagSets();\n             if (setList.isEmpty()) {\n                 //Assume new case and add Project VIC tags.\n-                TagSet set = taggingMgr.addTagSet(\"Project VIC (United States)\");\n-\n+               \n+                List<TagName> tagNameList = new ArrayList<>();\n                 for (TagNameDefinition def : TagNameDefinition.getProjectVICDefaultDefinitions()) {\n-                    TagName tagName = caseDb.addOrUpdateTagName(def.getDisplayName(), def.getDescription(), def.getColor(), def.getKnownStatus());\n-                    taggingMgr.addTagNameToTagSet(set, tagName);\n+                    tagNameList.add( caseDb.addOrUpdateTagName(def.getDisplayName(), def.getDescription(), def.getColor(), def.getKnownStatus()));\n                 }\n+                taggingMgr.addTagSet(DEFAULT_TAG_SET_NAME, tagNameList);\n \n                 for (TagNameDefinition def : TagNameDefinition.getStandardTagNameDefinitions()) {\n                     caseDb.addOrUpdateTagName(def.getDisplayName(), def.getDescription(), def.getColor(), def.getKnownStatus());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMDQ3Nw==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412520477", "bodyText": "We only want to fire one tag added event, with the added tag as the newValue and the list of deleted tags as the oldValue. Other wise we will trigger multiple GUI refreshes, etc.", "author": "rcordovano", "createdAt": "2020-04-21T21:58:47Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java", "diffHunk": "@@ -449,14 +475,19 @@ public ContentTag addContentTag(Content content, TagName tagName, String comment\n      *                          database.\n      */\n     public ContentTag addContentTag(Content content, TagName tagName, String comment, long beginByteOffset, long endByteOffset) throws TskCoreException {\n-        ContentTag tag;\n-        tag = caseDb.addContentTag(content, tagName, comment, beginByteOffset, endByteOffset);\n+        TaggingManager.ContentTagChange tagChange = caseDb.getTaggingManager().addContentTag(content, tagName, comment, beginByteOffset, endByteOffset);\n         try {\n-            Case.getCurrentCaseThrows().notifyContentTagAdded(tag);\n+            Case currentCase = Case.getCurrentCaseThrows();\n+\n+            for (ContentTag tag : tagChange.getRemovedTags()) {\n+                currentCase.notifyContentTagDeleted(tag);\n+            }", "originalCommit": "98151b1de8791fe3aeb64981a2aa035087fcbb19", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d34b1038abf586d140d6c1d88985ad6053839ed3", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java\nindex 786c76ec7b..728ddf594a 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagsManager.java\n\n@@ -479,11 +479,8 @@ public ContentTag addContentTag(Content content, TagName tagName, String comment\n         try {\n             Case currentCase = Case.getCurrentCaseThrows();\n \n-            for (ContentTag tag : tagChange.getRemovedTags()) {\n-                currentCase.notifyContentTagDeleted(tag);\n-            }\n+            currentCase.notifyContentTagAdded(tagChange.getAddedTag(), tagChange.getRemovedTags().isEmpty() ? null : tagChange.getRemovedTags().get(0));\n \n-            currentCase.notifyContentTagAdded(tagChange.getAddedTag());\n         } catch (NoCurrentCaseException ex) {\n             throw new TskCoreException(\"Added a tag to a closed case\", ex);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzNzUwMw==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r412537503", "bodyText": "See comment on this method in Jira.", "author": "rcordovano", "createdAt": "2020-04-21T22:34:27Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -194,94 +227,101 @@ TagName saveToCase(SleuthkitCase caseDb) {\n      * Gets tag name definitions from the tag settings file as well as the\n      * default tag name definitions.\n      *\n+     * The currently custom tags properties are stored in one string property\n+     * value separated by ;. The properties of an individual tag are comma\n+     * separated in the format of:\n+     * tag_name,tag_description,tag_color,known_status\n+     *\n+     * In prior versions of autopsy the known_status was stored in the central\n+     * repository, therefore the properties file only had three values.\n+     *\n      * @return A set of tag name definition objects.\n      */\n     static synchronized Set<TagNameDefinition> getTagNameDefinitions() {\n         Set<TagNameDefinition> tagNames = new LinkedHashSet<>();\n-        //modifiable copy of default tags list for us to keep track of which default tags have already been created\n-        Set<String> standardTags = new LinkedHashSet<>(STANDARD_TAG_DISPLAY_NAMES);\n-        String setting = ModuleSettings.getConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY);\n-        if (null != setting && !setting.isEmpty()) {\n-            List<String> tagNameTuples = Arrays.asList(setting.split(\";\"));\n+        String customTagsList = ModuleSettings.getConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY);\n+        if (null != customTagsList && !customTagsList.isEmpty()) {\n+            List<String> customTagDefinitions = Arrays.asList(customTagsList.split(\";\"));\n             int numberOfAttributes = 0;\n-            if (tagNameTuples.size() > 0) {\n-                // Determine if Tags.properties file needs to be upgraded\n-                numberOfAttributes = tagNameTuples.get(0).split(\",\").length;\n+            List<TagNameDefinition> tagDefinitions = new ArrayList<>();\n+            if (!customTagDefinitions.isEmpty()) {\n+                // Use the first entry in the list to figure out if there are 3 \n+                // or four tag attributes in the file.\n+                numberOfAttributes = customTagDefinitions.get(0).split(\",\").length;\n             }\n             if (numberOfAttributes == 3) {\n-                // Upgrade Tags.Properties with the settings in Central Repository Settings if necessary\n-                tagNames.addAll(upgradeTagPropertiesFile(tagNameTuples, standardTags));\n+                // Get the known status from the Central Repository\n+                String crTagKnownProp = ModuleSettings.getConfigSetting(\"CentralRepository\", \"db.badTags\"); // NON-NLS\n+                List<String> knownTagNameList = new ArrayList<>();\n+                if (crTagKnownProp != null && !crTagKnownProp.isEmpty()) {\n+                    knownTagNameList.addAll(Arrays.asList(crTagKnownProp.split(\",\")));\n+                }\n+\n+                tagDefinitions = buildTagNameDefinitions(customTagDefinitions, knownTagNameList);\n             } else if (numberOfAttributes == 4) {\n-                // if the Tags.Properties file is up to date parse it\n-                tagNames.addAll(readCurrentTagPropertiesFile(tagNameTuples, standardTags));\n+                tagDefinitions = buildTagNameDefinitions(customTagDefinitions);\n             }\n-        }\n-        //create standard tags which should always exist which were not already created for whatever reason, such as upgrade\n-        for (String standardTagName : standardTags) {\n-            if (STANDARD_NOTABLE_TAG_DISPLAY_NAMES.contains(standardTagName)) {\n-                tagNames.add(new TagNameDefinition(standardTagName, \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.BAD));\n-            } else {\n-                tagNames.add(new TagNameDefinition(standardTagName, \"\", TagName.HTML_COLOR.NONE, TskData.FileKnown.UNKNOWN));\n+\n+            // Remove the standard and project vic tags.\n+            List<String> standardTagNames = getStandardTagNames();\n+            for (TagNameDefinition def : tagDefinitions) {\n+                if (!standardTagNames.contains(def.getDisplayName())) {\n+                    tagNames.add(def);\n+                }", "originalCommit": "98151b1de8791fe3aeb64981a2aa035087fcbb19", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d34b1038abf586d140d6c1d88985ad6053839ed3", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\nindex c3e800b61f..ee54d7bf51 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n\n@@ -238,90 +240,30 @@ TagName saveToCase(SleuthkitCase caseDb) {\n      * @return A set of tag name definition objects.\n      */\n     static synchronized Set<TagNameDefinition> getTagNameDefinitions() {\n-        Set<TagNameDefinition> tagNames = new LinkedHashSet<>();\n-        String customTagsList = ModuleSettings.getConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY);\n-        if (null != customTagsList && !customTagsList.isEmpty()) {\n-            List<String> customTagDefinitions = Arrays.asList(customTagsList.split(\";\"));\n-            int numberOfAttributes = 0;\n-            List<TagNameDefinition> tagDefinitions = new ArrayList<>();\n-            if (!customTagDefinitions.isEmpty()) {\n-                // Use the first entry in the list to figure out if there are 3 \n-                // or four tag attributes in the file.\n-                numberOfAttributes = customTagDefinitions.get(0).split(\",\").length;\n-            }\n-            if (numberOfAttributes == 3) {\n-                // Get the known status from the Central Repository\n-                String crTagKnownProp = ModuleSettings.getConfigSetting(\"CentralRepository\", \"db.badTags\"); // NON-NLS\n-                List<String> knownTagNameList = new ArrayList<>();\n-                if (crTagKnownProp != null && !crTagKnownProp.isEmpty()) {\n-                    knownTagNameList.addAll(Arrays.asList(crTagKnownProp.split(\",\")));\n-                }\n-\n-                tagDefinitions = buildTagNameDefinitions(customTagDefinitions, knownTagNameList);\n-            } else if (numberOfAttributes == 4) {\n-                tagDefinitions = buildTagNameDefinitions(customTagDefinitions);\n-            }\n-\n-            // Remove the standard and project vic tags.\n-            List<String> standardTagNames = getStandardTagNames();\n-            for (TagNameDefinition def : tagDefinitions) {\n-                if (!standardTagNames.contains(def.getDisplayName())) {\n-                    tagNames.add(def);\n-                }\n-            }\n+        if (needsVersionUpdate()) {\n+            updateTagDefinitions();\n         }\n-        return tagNames;\n-    }\n \n-    /**\n-     * Returns a list of TagNameDefinitons created by merging the tag data from\n-     * the properties file and the known status information from the central\n-     * repository.\n-     *\n-     * @param tagProperties          List of description strings.\n-     * @param centralRepoNotableTags List of known tag names.\n-     *\n-     * @return A list of TagNameDefinitions.\n-     */\n-    private static List<TagNameDefinition> buildTagNameDefinitions(List<String> tagProperties, List<String> centralRepoNotableTags) {\n-        List<TagNameDefinition> tagNameDefinitions = new ArrayList<>();\n-\n-        for (String propertyString : tagProperties) {\n-            // Split the property into attributes\n-            String[] attributes = propertyString.split(\",\"); //get the attributes\n-            String tagName = attributes[0];\n-            TskData.FileKnown knownStatus = TskData.FileKnown.UNKNOWN;\n+        String tagsProperty = ModuleSettings.getConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY);\n+        if (tagsProperty == null || tagsProperty.isEmpty()) {\n+            return new HashSet<>();\n+        }\n \n-            if (centralRepoNotableTags.contains(tagName)) {\n-                knownStatus = TskData.FileKnown.BAD;\n-            }\n+        List<String> individualTags = Arrays.asList(tagsProperty.split(\";\"));\n \n-            tagNameDefinitions.add(new TagNameDefinition(tagName, attributes[1],\n-                    TagName.HTML_COLOR.valueOf(attributes[2]), knownStatus));\n+        if (individualTags == null || individualTags.isEmpty()) {\n+            return new HashSet<>();\n         }\n \n-        return tagNameDefinitions;\n-    }\n+        Set<TagNameDefinition> definitions = new HashSet<>();\n+        for (String tagProps : individualTags) {\n+            String[] attributes = tagProps.split(\",\");\n \n-    /**\n-     * Read the Tags.properties file to get the TagNameDefinitions that are\n-     * preserved across cases.\n-     *\n-     * @param tagProperties           List of description strings.\n-     *\n-     * @param standardTagsToBeCreated the list of standard tags which have yet\n-     *                                to be created\n-     *\n-     * @return tagNames a list of TagNameDefinitions\n-     */\n-    private static List<TagNameDefinition> buildTagNameDefinitions(List<String> tagProperties) {\n-        List<TagNameDefinition> tagNameDefinitions = new ArrayList<>();\n-        for (String tagNameTuple : tagProperties) {\n-            String[] tagNameAttributes = tagNameTuple.split(\",\"); //get the attributes\n-            tagNameDefinitions.add(new TagNameDefinition(tagNameAttributes[0], tagNameAttributes[1],\n-                    TagName.HTML_COLOR.valueOf(tagNameAttributes[2]), TskData.FileKnown.valueOf(tagNameAttributes[3])));\n+            definitions.add(new TagNameDefinition(attributes[0], attributes[1],\n+                    TagName.HTML_COLOR.valueOf(attributes[2]), TskData.FileKnown.valueOf(attributes[3])));\n         }\n-        return tagNameDefinitions;\n+\n+        return definitions;\n     }\n \n     /**\n"}}, {"oid": "33ef944becf4214684b68d67202236e51268bc49", "url": "https://github.com/sleuthkit/autopsy/commit/33ef944becf4214684b68d67202236e51268bc49", "message": "More review changes", "committedDate": "2020-04-24T19:27:09Z", "type": "commit"}, {"oid": "3eb244d4d36000a9611d92ddea68a3ae078b38b0", "url": "https://github.com/sleuthkit/autopsy/commit/3eb244d4d36000a9611d92ddea68a3ae078b38b0", "message": "Picked up properties file changes", "committedDate": "2020-04-25T16:20:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxMzA2Nw==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r415913067", "bodyText": "It would be better to not hand out a reference to the internal data structure. The TagName objects are immutable, but the  collections are not.", "author": "rcordovano", "createdAt": "2020-04-27T15:29:31Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -76,8 +98,20 @@\n         this.knownStatus = status;\n     }\n \n+    static Collection<TagNameDefinition> getStandardTagNameDefinitions() {\n+        return STANDARD_TAGS_DEFINITIONS.values();\n+    }\n+\n+    static Collection<TagNameDefinition> getProjectVICDefaultDefinitions() {\n+        return PROJECT_VIC_TAG_DEFINITIONS.values();\n+    }", "originalCommit": "33ef944becf4214684b68d67202236e51268bc49", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c7c0bdbc07b56825562ca154da53a55665c8650f", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\nindex c6ba53ac47..2e70d407a0 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n\n@@ -98,12 +99,12 @@\n         this.knownStatus = status;\n     }\n \n-    static Collection<TagNameDefinition> getStandardTagNameDefinitions() {\n-        return STANDARD_TAGS_DEFINITIONS.values();\n+    static Collection<TagNameDefinition> getProjectVICDefaultDefinitions() {\n+        return Collections.unmodifiableCollection(PROJECT_VIC_TAG_DEFINITIONS.values());\n     }\n \n-    static Collection<TagNameDefinition> getProjectVICDefaultDefinitions() {\n-        return PROJECT_VIC_TAG_DEFINITIONS.values();\n+    static Collection<TagNameDefinition> getStandardTagNameDefinitions() {\n+        return Collections.unmodifiableCollection(STANDARD_TAGS_DEFINITIONS.values());\n     }\n \n     static List<String> getStandardTagNames() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxNDc0NA==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r415914744", "bodyText": "Nice additions to the commenting!", "author": "rcordovano", "createdAt": "2020-04-27T15:31:27Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -194,94 +228,41 @@ TagName saveToCase(SleuthkitCase caseDb) {\n      * Gets tag name definitions from the tag settings file as well as the\n      * default tag name definitions.\n      *\n+     * The currently custom tags properties are stored in one string property\n+     * value separated by ;. The properties of an individual tag are comma\n+     * separated in the format of:\n+     * tag_name,tag_description,tag_color,known_status\n+     *\n+     * In prior versions of autopsy the known_status was stored in the central\n+     * repository, therefore the properties file only had three values.\n+     *", "originalCommit": "33ef944becf4214684b68d67202236e51268bc49", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxNTg3Mw==", "url": "https://github.com/sleuthkit/autopsy/pull/5840#discussion_r415915873", "bodyText": "Base => Based", "author": "rcordovano", "createdAt": "2020-04-27T15:32:47Z", "path": "Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java", "diffHunk": "@@ -303,7 +284,113 @@ static synchronized void setTagNameDefinitions(Set<TagNameDefinition> tagNames)\n                 LOGGER.log(Level.SEVERE, \"Exception while getting open case.\", ex);\n             }\n         }\n+\n+        ModuleSettings.setConfigSetting(TAGS_SETTINGS_NAME, TAG_SETTING_VERSION_KEY, Integer.toString(TAG_SETTINGS_VERSION));\n         ModuleSettings.setConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY, setting.toString());\n     }\n \n+    /**\n+     * Updates the Tag Definition file to the current format.\n+     */\n+    private static void updateTagDefinitions() {\n+        Integer version = getPropertyFileVersion();\n+        List<TagNameDefinition> definitions = new ArrayList<>();\n+\n+        if (version == null) {\n+            String tagsProperty = ModuleSettings.getConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY);\n+            if (tagsProperty == null || tagsProperty.isEmpty()) {\n+                return;\n+            }\n+\n+            List<String> individualTags = Arrays.asList(tagsProperty.split(\";\"));\n+\n+            if (individualTags == null || individualTags.isEmpty()) {\n+                return;\n+            }\n+\n+            List<String> notableTagList = null;\n+            for (String tagProps : individualTags) {\n+                String[] attributes = tagProps.split(\",\");\n+                TskData.FileKnown fileKnown = TskData.FileKnown.UNKNOWN;\n+                if (attributes.length == 3) {\n+                    // If notableTagList is null load it from the CR.\n+                    if (notableTagList == null) {\n+                        notableTagList = getCRNotableList();\n+                    } else {\n+                        if (notableTagList.contains(attributes[0])) {\n+                            fileKnown = TskData.FileKnown.BAD;\n+                        }\n+                    }\n+                } else {\n+                    fileKnown = TskData.FileKnown.valueOf(attributes[3]);\n+                }\n+\n+                definitions.add(new TagNameDefinition(attributes[0], attributes[1],\n+                        TagName.HTML_COLOR.valueOf(attributes[2]), fileKnown));\n+            }\n+        } \n+        \n+        if (definitions.isEmpty()) {\n+            return;\n+        }\n+\n+        // Remove the standard and Project VIC tags from the list\n+        List<String> tagStrings = new ArrayList<>();\n+        List<String> standardTags = getStandardTagNames();\n+        for (TagNameDefinition def : definitions) {\n+            if (!standardTags.contains(def.getDisplayName())) {\n+                tagStrings.add(def.toSettingsFormat());\n+            }\n+        }\n+\n+        // Write out the version and the new tag list.\n+        ModuleSettings.setConfigSetting(TAGS_SETTINGS_NAME, TAG_SETTING_VERSION_KEY, Integer.toString(TAG_SETTINGS_VERSION));\n+        ModuleSettings.setConfigSetting(TAGS_SETTINGS_NAME, TAG_NAMES_SETTING_KEY, String.join(\";\", tagStrings));\n+    }\n+    \n+    /**\n+     * Returns a list notable tag names from the CR bagTag list.\n+     * \n+     * @return A list of tag names, or empty list if none were found.\n+     */\n+    private static  List<String> getCRNotableList() {\n+        String notableTagsProp = ModuleSettings.getConfigSetting(\"CentralRepository\", \"db.badTags\"); // NON-NLS\n+        if (notableTagsProp != null && !notableTagsProp.isEmpty()) {\n+            return Arrays.asList(notableTagsProp.split(\",\"));\n+        }\n+\n+        return new ArrayList<>();\n+    }\n+\n+    /**\n+     * Base on the version in the Tags property file, returns whether or not the", "originalCommit": "33ef944becf4214684b68d67202236e51268bc49", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c7c0bdbc07b56825562ca154da53a55665c8650f", "chunk": "diff --git a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\nindex c6ba53ac47..2e70d407a0 100755\n--- a/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n+++ b/Core/src/org/sleuthkit/autopsy/casemodule/services/TagNameDefinition.java\n\n@@ -328,8 +329,8 @@ private static void updateTagDefinitions() {\n                 definitions.add(new TagNameDefinition(attributes[0], attributes[1],\n                         TagName.HTML_COLOR.valueOf(attributes[2]), fileKnown));\n             }\n-        } \n-        \n+        }\n+\n         if (definitions.isEmpty()) {\n             return;\n         }\n"}}, {"oid": "c7c0bdbc07b56825562ca154da53a55665c8650f", "url": "https://github.com/sleuthkit/autopsy/commit/c7c0bdbc07b56825562ca154da53a55665c8650f", "message": "Few small review changes", "committedDate": "2020-04-27T17:27:16Z", "type": "commit"}, {"oid": "625afb2b3c9bb032b9110bf1986a6813ee9faa30", "url": "https://github.com/sleuthkit/autopsy/commit/625afb2b3c9bb032b9110bf1986a6813ee9faa30", "message": "Merge branch 'develop' into 1440-1441-add-tag-set-support", "committedDate": "2020-04-27T18:10:14Z", "type": "commit"}]}