{"pr_number": 2780, "pr_title": "Upgrade to the ORCID v3 API", "pr_createdAt": "2020-06-16T09:43:00Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2780", "timeline": [{"oid": "ec348a63f156d213035a95ee3e662e925309e5c0", "url": "https://github.com/DSpace/DSpace/commit/ec348a63f156d213035a95ee3e662e925309e5c0", "message": "Update ORCID to V3", "committedDate": "2020-06-16T09:35:48Z", "type": "commit"}, {"oid": "2ffde8ec2cc2cc4780f51d0b6d342a0babab59aa", "url": "https://github.com/DSpace/DSpace/commit/2ffde8ec2cc2cc4780f51d0b6d342a0babab59aa", "message": "Minor cleanup", "committedDate": "2020-06-16T09:35:48Z", "type": "commit"}, {"oid": "d77c505a668f0997d6f2c334058cd87be15761f3", "url": "https://github.com/DSpace/DSpace/commit/d77c505a668f0997d6f2c334058cd87be15761f3", "message": "added ITs for ORCID", "committedDate": "2020-06-16T14:27:27Z", "type": "commit"}, {"oid": "e2f79861e3e4e1a64464fa54db5fab7918843636", "url": "https://github.com/DSpace/DSpace/commit/e2f79861e3e4e1a64464fa54db5fab7918843636", "message": "Fix wrong name", "committedDate": "2020-06-16T15:14:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1MjA3MQ==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r443652071", "bodyText": "I'd like to see a second Integration Test that runs against a sample (static) response from ORCID (which we can enable to run always in Travis CI).  Otherwise, we only have this disabled end-to-end test, which wouldn't allow us to continually validate that our code works with the ORCID API.", "author": "tdonohue", "createdAt": "2020-06-22T15:40:52Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/OrcidExternalSourcesIT.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static com.jayway.jsonpath.matchers.JsonPathMatchers.hasJsonPath;\n+import static org.hamcrest.Matchers.is;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.services.ConfigurationService;\n+import org.hamcrest.Matchers;\n+import org.junit.Assume;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+/**\n+ * This test suite includes end to end test to verify the integration with ORCID as an External Source.\n+ * The test run only if the orcid.clientid property is configured.\n+ * \n+ * @author Mykhaylo Boychuk (4Science.it)\n+ *\n+ */\n+public class OrcidExternalSourcesIT extends AbstractControllerIntegrationTest {", "originalCommit": "e2f79861e3e4e1a64464fa54db5fab7918843636", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1NjQ1Ng==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r518856456", "bodyText": "It looks like previous feedback was resolved by adding some static XML test output and adding a few *MockitoTest() methods to this same class.\n@abollini : Could you update the JavaDocs at the top of this class to note that it does static testing by default (using the *MockitoTest() methods below), but will do full end-to-end testing (of the real API) when you set orcid.clientid", "author": "tdonohue", "createdAt": "2020-11-06T16:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1MjA3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "2ae8f0e9fafc1a9a56a69cc03de2d9c0c5c16b16", "chunk": "diff --git a/dspace-server-webapp/src/test/java/org/dspace/app/rest/OrcidExternalSourcesIT.java b/dspace-server-webapp/src/test/java/org/dspace/app/rest/OrcidExternalSourcesIT.java\nindex 84dab997c..5173eba83 100644\n--- a/dspace-server-webapp/src/test/java/org/dspace/app/rest/OrcidExternalSourcesIT.java\n+++ b/dspace-server-webapp/src/test/java/org/dspace/app/rest/OrcidExternalSourcesIT.java\n\n@@ -9,17 +9,30 @@ package org.dspace.app.rest;\n \n import static com.jayway.jsonpath.matchers.JsonPathMatchers.hasJsonPath;\n import static org.hamcrest.Matchers.is;\n+import static org.mockito.Mockito.when;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n \n+import com.amazonaws.util.StringInputStream;\n import org.apache.commons.lang3.StringUtils;\n+import org.apache.http.ProtocolVersion;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.entity.BasicHttpEntity;\n+import org.apache.http.message.BasicHttpResponse;\n import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.external.OrcidRestConnector;\n+import org.dspace.external.provider.impl.OrcidV3AuthorDataProvider;\n+import org.dspace.external.provider.orcid.xml.XMLtoBio;\n import org.dspace.services.ConfigurationService;\n import org.hamcrest.Matchers;\n import org.junit.Assume;\n-import org.junit.Before;\n import org.junit.Test;\n+import org.mockito.ArgumentMatchers;\n+import org.mockito.Mockito;\n+import org.orcid.jaxb.model.record_v3.NameType;\n+import org.orcid.jaxb.model.record_v3.NameType.FamilyName;\n+import org.orcid.jaxb.model.record_v3.Person;\n import org.springframework.beans.factory.annotation.Autowired;\n \n /**\n"}}, {"oid": "fe41f58c512a09ee28912128029a6f0887834c4b", "url": "https://github.com/DSpace/DSpace/commit/fe41f58c512a09ee28912128029a6f0887834c4b", "message": "Merge branch 'main' into D4CRIS-952-orcidV3-merge", "committedDate": "2020-09-23T14:57:14Z", "type": "commit"}, {"oid": "50efbd29bb0c33f3d937aa8be1e4c74e122f5811", "url": "https://github.com/DSpace/DSpace/commit/50efbd29bb0c33f3d937aa8be1e4c74e122f5811", "message": "added dependensy to use official artifact of orcid", "committedDate": "2020-09-23T15:52:59Z", "type": "commit"}, {"oid": "2ae8f0e9fafc1a9a56a69cc03de2d9c0c5c16b16", "url": "https://github.com/DSpace/DSpace/commit/2ae8f0e9fafc1a9a56a69cc03de2d9c0c5c16b16", "message": "added mockito test to prove functionality of OrcidExternalSources", "committedDate": "2020-09-24T16:55:37Z", "type": "commit"}, {"oid": "007c8f035d179dc5eecb0040d9bbc867dc10b676", "url": "https://github.com/DSpace/DSpace/commit/007c8f035d179dc5eecb0040d9bbc867dc10b676", "message": "added missing bean", "committedDate": "2020-09-25T08:45:31Z", "type": "commit"}, {"oid": "ba4d1c20f1dc4ccd2aa1bcce8cf640eea0cfce0c", "url": "https://github.com/DSpace/DSpace/commit/ba4d1c20f1dc4ccd2aa1bcce8cf640eea0cfce0c", "message": "fix test", "committedDate": "2020-09-25T08:47:25Z", "type": "commit"}, {"oid": "3a47781193881956e263de8b9032605955b30deb", "url": "https://github.com/DSpace/DSpace/commit/3a47781193881956e263de8b9032605955b30deb", "message": "added pooling http cliente connection manager to send to ORCID", "committedDate": "2020-09-28T08:30:32Z", "type": "commit"}, {"oid": "850d93546ab625fbba5b54ce269dae3d4dd927c7", "url": "https://github.com/DSpace/DSpace/commit/850d93546ab625fbba5b54ce269dae3d4dd927c7", "message": "update test and OrcidRestConnector", "committedDate": "2020-09-28T16:33:58Z", "type": "commit"}, {"oid": "e6000f6e5e913540235a0756e424d1c84319e78e", "url": "https://github.com/DSpace/DSpace/commit/e6000f6e5e913540235a0756e424d1c84319e78e", "message": "Merge branch 'main' of https://github.com/DSpace/DSpace into D4CRIS-952-orcidV3", "committedDate": "2020-11-05T14:49:41Z", "type": "commit"}, {"oid": "a8aab9d88b23449c690e3f89e14f5362e5c7b5e4", "url": "https://github.com/DSpace/DSpace/commit/a8aab9d88b23449c690e3f89e14f5362e5c7b5e4", "message": "Improve ORCID testing via mock response", "committedDate": "2020-11-05T21:10:29Z", "type": "commit"}, {"oid": "9d938a62829b8fff89348d6d3d117d316a9b0fc7", "url": "https://github.com/DSpace/DSpace/commit/9d938a62829b8fff89348d6d3d117d316a9b0fc7", "message": "Switch to the official orcid model maven artifact", "committedDate": "2020-11-05T21:13:02Z", "type": "commit"}, {"oid": "9d52f012706a7ae4bc22eb6e64bc668f64a64bc0", "url": "https://github.com/DSpace/DSpace/commit/9d52f012706a7ae4bc22eb6e64bc668f64a64bc0", "message": "Solve dependencies convergence issues", "committedDate": "2020-11-05T21:49:59Z", "type": "commit"}, {"oid": "e2e13ebd069d24b09975bdf9d6f1966858524c00", "url": "https://github.com/DSpace/DSpace/commit/e2e13ebd069d24b09975bdf9d6f1966858524c00", "message": "Remove unnecessary changes and add more javadoc", "committedDate": "2020-11-11T11:27:51Z", "type": "commit"}]}