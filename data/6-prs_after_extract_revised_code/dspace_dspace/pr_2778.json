{"pr_number": 2778, "pr_title": "Pre authorize annotations for subresources", "pr_createdAt": "2020-06-10T10:40:45Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2778", "timeline": [{"oid": "ee120b415f8de2a478ebea50e0795a7352d6ba10", "url": "https://github.com/DSpace/DSpace/commit/ee120b415f8de2a478ebea50e0795a7352d6ba10", "message": "[Task 71143] initial implementation of the preauthorize annotations in the converterservice", "committedDate": "2020-05-27T08:41:28Z", "type": "commit"}, {"oid": "e068abb87fe2f23f63571c335686edb859ca9c28", "url": "https://github.com/DSpace/DSpace/commit/e068abb87fe2f23f63571c335686edb859ca9c28", "message": "undo unnecessary changes", "committedDate": "2020-05-27T08:43:31Z", "type": "commit"}, {"oid": "6c0ee98fa616ea63af7aa68f6a500f7ef25be780", "url": "https://github.com/DSpace/DSpace/commit/6c0ee98fa616ea63af7aa68f6a500f7ef25be780", "message": "SPEL parsing of the preAuthorize annotation in converterService work", "committedDate": "2020-06-02T12:56:00Z", "type": "commit"}, {"oid": "397a156186f33333e83e16bebb3b3940761fe5e7", "url": "https://github.com/DSpace/DSpace/commit/397a156186f33333e83e16bebb3b3940761fe5e7", "message": "[Task 71143] Intermediate work on PreAuthorize annotation parsing", "committedDate": "2020-06-05T11:56:39Z", "type": "commit"}, {"oid": "49d40598f0e2ca26f3683128852887c970ee8046", "url": "https://github.com/DSpace/DSpace/commit/49d40598f0e2ca26f3683128852887c970ee8046", "message": "[Task 71143] implemented the PreAuthorize check in ConverterService for the findOne of a BaseObjectRest when the toRest method is called", "committedDate": "2020-06-08T11:04:59Z", "type": "commit"}, {"oid": "7be092813903c4e59f27109fd6702e5d281a1966", "url": "https://github.com/DSpace/DSpace/commit/7be092813903c4e59f27109fd6702e5d281a1966", "message": "[Task 71143] fixed checkstyle", "committedDate": "2020-06-08T13:12:40Z", "type": "commit"}, {"oid": "4a40b8d1028aaa37f712fd53243696650a99763b", "url": "https://github.com/DSpace/DSpace/commit/4a40b8d1028aaa37f712fd53243696650a99763b", "message": "[Task 71308] applied feedback to the PreAuthorize parsing in converterService feature", "committedDate": "2020-06-09T07:25:06Z", "type": "commit"}, {"oid": "faef05258a60e04bfcdaed9d8e81a0ec266b4a29", "url": "https://github.com/DSpace/DSpace/commit/faef05258a60e04bfcdaed9d8e81a0ec266b4a29", "message": "[Task 71335] removed unneeded PermissionEvaluatorPlugins and changed PreAuthorize annotations where necessary", "committedDate": "2020-06-10T09:51:44Z", "type": "commit"}, {"oid": "56629fd34e82b9a29ada8b65a7b1a41557b99f7f", "url": "https://github.com/DSpace/DSpace/commit/56629fd34e82b9a29ada8b65a7b1a41557b99f7f", "message": "[Task 71335] removed wrongly added preAuthorize on bitstreamFormatRestRepository#findAll", "committedDate": "2020-06-10T09:53:24Z", "type": "commit"}, {"oid": "5f44fe11f7da5885f7f6f285fac23fd3a5c2605e", "url": "https://github.com/DSpace/DSpace/commit/5f44fe11f7da5885f7f6f285fac23fd3a5c2605e", "message": "Undo findall preauthorize annotation change on AuthorizationFeatureRestRepository", "committedDate": "2020-06-10T11:50:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0ODYzMQ==", "url": "https://github.com/DSpace/DSpace/pull/2778#discussion_r442248631", "bodyText": "this should be possible now\nsee https://github.com/DSpace/DSpace/pull/2778/files#diff-311a7e07c257d9c869f4de1347f5f761R51", "author": "abollini", "createdAt": "2020-06-18T14:00:16Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/AuthorizationRestRepositoryIT.java", "diffHunk": "@@ -804,6 +805,11 @@ public void findByObjectInternalServerErrorTest() throws Exception {\n      * \n      * @throws Exception\n      */\n+    // This test currently doesn't work as expected since the AuthorizationFeatureRestRepository#findOne method\n+    // is only exposed to admins. Currently we're performing checks on the individual REST objects with its findOne\n+    // Permission constraints, which is ADMIN in this case. Seeing as we're trying to retrieve it with a normal\n+    // EPerson token in the second test, this will fail.\n+    @Ignore", "originalCommit": "5f44fe11f7da5885f7f6f285fac23fd3a5c2605e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NDEyNg==", "url": "https://github.com/DSpace/DSpace/pull/2778#discussion_r442344126", "bodyText": "Removing the @Ignore does indeed work now", "author": "benbosman", "createdAt": "2020-06-18T16:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0ODYzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "8172dd5fb0688ef2539af96b5a470b6187a4f937", "chunk": "diff --git a/dspace-server-webapp/src/test/java/org/dspace/app/rest/AuthorizationRestRepositoryIT.java b/dspace-server-webapp/src/test/java/org/dspace/app/rest/AuthorizationRestRepositoryIT.java\nindex 22188a36a..7092bb62d 100644\n--- a/dspace-server-webapp/src/test/java/org/dspace/app/rest/AuthorizationRestRepositoryIT.java\n+++ b/dspace-server-webapp/src/test/java/org/dspace/app/rest/AuthorizationRestRepositoryIT.java\n\n@@ -805,11 +805,6 @@ public class AuthorizationRestRepositoryIT extends AbstractControllerIntegration\n      * \n      * @throws Exception\n      */\n-    // This test currently doesn't work as expected since the AuthorizationFeatureRestRepository#findOne method\n-    // is only exposed to admins. Currently we're performing checks on the individual REST objects with its findOne\n-    // Permission constraints, which is ADMIN in this case. Seeing as we're trying to retrieve it with a normal\n-    // EPerson token in the second test, this will fail.\n-    @Ignore\n     public void findByObjectAndFeatureTest() throws Exception {\n         context.turnOffAuthorisationSystem();\n         Community com = CommunityBuilder.createCommunity(context).withName(\"A test community\").build();\n"}}, {"oid": "8172dd5fb0688ef2539af96b5a470b6187a4f937", "url": "https://github.com/DSpace/DSpace/commit/8172dd5fb0688ef2539af96b5a470b6187a4f937", "message": "Re-enable findByObjectAndFeatureTest\n\nThe findByObjectAndFeatureTest can be used again thanks to https://github.com/DSpace/DSpace/pull/2778/files#diff-311a7e07c257d9c869f4de1347f5f761R51", "committedDate": "2020-06-18T15:05:31Z", "type": "commit"}, {"oid": "559001cf431a987ee03563c392003195f141baf8", "url": "https://github.com/DSpace/DSpace/commit/559001cf431a987ee03563c392003195f141baf8", "message": "Removing unused import", "committedDate": "2020-06-18T15:16:56Z", "type": "commit"}]}