{"pr_number": 2979, "pr_title": "Submission bugfix for file upload mandatory", "pr_createdAt": "2020-09-21T14:51:11Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2979", "timeline": [{"oid": "88e073d8f2deaa23ad2155aa916fe6c40d8ae43c", "url": "https://github.com/DSpace/DSpace/commit/88e073d8f2deaa23ad2155aa916fe6c40d8ae43c", "message": "bugfix to verify whether a file is mandatory", "committedDate": "2020-09-21T10:13:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMTI4Mg==", "url": "https://github.com/DSpace/DSpace/pull/2979#discussion_r496901282", "bodyText": "@benbosman : While this is a one line change, it looks slightly odd to me, as the previous line is an if statement looking for the \"key\" to match.\nDoes this method need further refactoring?  It almost seems like previously we had to loop through the keys in the uploadConfigurationService to locate the one that matched with UploadValidation.getName().   Now, it looks like the loop has no purpose, as we're just calling get(config.getId()) to grab the UploadConfiguration that we want directly.\nAm I misunderstanding this tiny change?  It almost seems like we can remove this for loop entirely.", "author": "tdonohue", "createdAt": "2020-09-29T17:06:09Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/submit/step/validation/UploadValidation.java", "diffHunk": "@@ -43,7 +43,7 @@\n \n         for (String key : uploadConfigurationService.getMap().keySet()) {\n             if (getName().equals(key)) {\n-                UploadConfiguration uploadConfig = uploadConfigurationService.getMap().get(key);\n+                UploadConfiguration uploadConfig = uploadConfigurationService.getMap().get(config.getId());", "originalCommit": "88e073d8f2deaa23ad2155aa916fe6c40d8ae43c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM1NjcyMA==", "url": "https://github.com/DSpace/DSpace/pull/2979#discussion_r498356720", "bodyText": "You're right, no need to find a match on this key, so I've removed the loop\nI also re-tested, and didn't see any problems", "author": "benbosman", "createdAt": "2020-10-01T16:01:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMTI4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8f824c0642073d96ae6c3907361c9f040bd0db5d", "chunk": "diff --git a/dspace-server-webapp/src/main/java/org/dspace/app/rest/submit/step/validation/UploadValidation.java b/dspace-server-webapp/src/main/java/org/dspace/app/rest/submit/step/validation/UploadValidation.java\nindex 6ecfac40e..0c896db9a 100644\n--- a/dspace-server-webapp/src/main/java/org/dspace/app/rest/submit/step/validation/UploadValidation.java\n+++ b/dspace-server-webapp/src/main/java/org/dspace/app/rest/submit/step/validation/UploadValidation.java\n\n@@ -41,15 +41,11 @@ public class UploadValidation extends AbstractValidation {\n                                     SubmissionStepConfig config) throws DCInputsReaderException, SQLException {\n         //TODO MANAGE METADATA\n \n-        for (String key : uploadConfigurationService.getMap().keySet()) {\n-            if (getName().equals(key)) {\n-                UploadConfiguration uploadConfig = uploadConfigurationService.getMap().get(config.getId());\n-                if (uploadConfig.isRequired() && !itemService.hasUploadedFiles(obj.getItem())) {\n-                    addError(ERROR_VALIDATION_FILEREQUIRED,\n-                             \"/\" + WorkspaceItemRestRepository.OPERATION_PATH_SECTIONS + \"/\"\n-                                 + config.getId());\n-                }\n-            }\n+        UploadConfiguration uploadConfig = uploadConfigurationService.getMap().get(config.getId());\n+        if (uploadConfig.isRequired() && !itemService.hasUploadedFiles(obj.getItem())) {\n+            addError(ERROR_VALIDATION_FILEREQUIRED,\n+                     \"/\" + WorkspaceItemRestRepository.OPERATION_PATH_SECTIONS + \"/\"\n+                         + config.getId());\n         }\n         return getErrors();\n     }\n"}}, {"oid": "8f824c0642073d96ae6c3907361c9f040bd0db5d", "url": "https://github.com/DSpace/DSpace/commit/8f824c0642073d96ae6c3907361c9f040bd0db5d", "message": "for loop is not applicable", "committedDate": "2020-10-01T14:17:26Z", "type": "commit"}]}