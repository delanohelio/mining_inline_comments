{"pr_number": 3002, "pr_title": "Support itemService.getMetadata with virtual md field", "pr_createdAt": "2020-10-14T11:40:07Z", "pr_url": "https://github.com/DSpace/DSpace/pull/3002", "timeline": [{"oid": "1a818b304c11fe0bc8e499096f0a6311497202f1", "url": "https://github.com/DSpace/DSpace/commit/1a818b304c11fe0bc8e499096f0a6311497202f1", "message": "72348: Test getMetadata implicit virtual metadata", "committedDate": "2020-08-05T13:12:19Z", "type": "commit"}, {"oid": "0f069cc14c978fef6a0916915ffda39aca1c8751", "url": "https://github.com/DSpace/DSpace/commit/0f069cc14c978fef6a0916915ffda39aca1c8751", "message": "72348: Fixes so getMetadata returns implicit virtual metadata", "committedDate": "2020-08-05T13:16:54Z", "type": "commit"}, {"oid": "7677bd92e185bbd5016c0bb68df2d0bd70b08a5c", "url": "https://github.com/DSpace/DSpace/commit/7677bd92e185bbd5016c0bb68df2d0bd70b08a5c", "message": "checkstyle", "committedDate": "2020-08-05T14:03:59Z", "type": "commit"}, {"oid": "894ec569f1fb5c3bdef8efcec1d525590904f1e7", "url": "https://github.com/DSpace/DSpace/commit/894ec569f1fb5c3bdef8efcec1d525590904f1e7", "message": "Merge remote-tracking branch 'community/main' into w2p-72348_Support-itemService-getMetadata-with-virtual-md", "committedDate": "2020-10-14T10:53:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc2MTI2Nw==", "url": "https://github.com/DSpace/DSpace/pull/3002#discussion_r513761267", "bodyText": "Can we update this test method to use Builder classes?  Currently, it does not appear to be cleaning up after itself.", "author": "tdonohue", "createdAt": "2020-10-28T21:08:03Z", "path": "dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java", "diffHunk": "@@ -496,6 +497,123 @@ public void testGetNextLeftPlace() throws Exception {\n         assertThat(relationshipService.findNextLeftPlaceByLeftItem(context, leftItem), equalTo(2));\n \n \n+    }\n \n+    @Test\n+    public void testGetVirtualMetadata() throws SQLException, AuthorizeException {", "originalCommit": "894ec569f1fb5c3bdef8efcec1d525590904f1e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8e2e564b6dd89bb565e91e50d13a45de6938e82e", "chunk": "diff --git a/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java b/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java\nindex aefbfb99c..94463d5dd 100644\n--- a/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java\n+++ b/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java\n\n@@ -482,16 +460,15 @@ public class RelationshipMetadataServiceTest extends AbstractUnitTest {\n         assertThat(relationshipService.findNextLeftPlaceByLeftItem(context, leftItem), equalTo(1));\n \n         context.turnOffAuthorisationSystem();\n-        Community community = communityService.create(null, context);\n-\n-        Collection col = collectionService.create(context, community);\n-        WorkspaceItem is = workspaceItemService.create(context, col, false);\n-        Item secondAuthor = installItemService.installItem(context, is);\n-        itemService.addMetadata(context, secondAuthor, \"relationship\", \"type\", null, null, \"Author\");\n-        itemService.addMetadata(context, secondAuthor, \"person\", \"familyName\", null, null, \"familyName\");\n-        itemService.addMetadata(context, secondAuthor, \"person\", \"givenName\", null, null, \"firstName\");\n-        relationshipService.create(context, leftItem, secondAuthor,\n-                                   isAuthorOfPublicationRelationshipType, 0, 0);\n+        Community community = CommunityBuilder.createCommunity(context).build();\n+        Collection col = CollectionBuilder.createCollection(context, community).build();\n+\n+        Item secondAuthor = ItemBuilder.createItem(context, col).withRelationshipType(\"Author\")\n+                                       .withPersonIdentifierFirstName(\"firstName\")\n+                                       .withPersonIdentifierLastName(\"familyName\").build();\n+\n+        RelationshipBuilder.createRelationshipBuilder(context, leftItem, secondAuthor,\n+            isAuthorOfPublicationRelationshipType).build();\n         context.restoreAuthSystemState();\n \n         assertThat(relationshipService.findNextLeftPlaceByLeftItem(context, leftItem), equalTo(2));\n"}}, {"oid": "8e2e564b6dd89bb565e91e50d13a45de6938e82e", "url": "https://github.com/DSpace/DSpace/commit/8e2e564b6dd89bb565e91e50d13a45de6938e82e", "message": "74685: Refactor RelationshipMetadataServiceTest to use Builders", "committedDate": "2020-11-20T13:52:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4Mzg3Mw==", "url": "https://github.com/DSpace/DSpace/pull/3002#discussion_r527783873", "bodyText": "This file should now be renamed RelationshipMetadataServiceIT since it's been switched to an Integration Test instead of a Unit Test.", "author": "tdonohue", "createdAt": "2020-11-20T15:51:43Z", "path": "dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java", "diffHunk": "@@ -29,17 +33,13 @@\n import org.dspace.content.service.RelationshipService;\n import org.dspace.content.service.RelationshipTypeService;\n import org.dspace.content.service.WorkspaceItemService;\n-import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n \n-public class RelationshipMetadataServiceTest extends AbstractUnitTest {\n-\n-    private static final Logger log = org.apache.logging.log4j.LogManager\n-        .getLogger(RelationshipMetadataServiceTest.class);\n+public class RelationshipMetadataServiceTest extends AbstractIntegrationTestWithDatabase {", "originalCommit": "8e2e564b6dd89bb565e91e50d13a45de6938e82e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5654dc36685c00af0f809b2e8f50d3dd8bdb2aa8", "chunk": "diff --git a/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java b/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceIT.java\nsimilarity index 99%\nrename from dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java\nrename to dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceIT.java\nindex 94463d5dd..a29166ae0 100644\n--- a/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java\n+++ b/dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceIT.java\n\n@@ -36,7 +36,7 @@ import org.dspace.content.service.WorkspaceItemService;\n import org.junit.Before;\n import org.junit.Test;\n \n-public class RelationshipMetadataServiceTest extends AbstractIntegrationTestWithDatabase {\n+public class RelationshipMetadataServiceIT extends AbstractIntegrationTestWithDatabase {\n \n     protected RelationshipMetadataService relationshipMetadataService = ContentServiceFactory\n         .getInstance().getRelationshipMetadataService();\n"}}, {"oid": "5654dc36685c00af0f809b2e8f50d3dd8bdb2aa8", "url": "https://github.com/DSpace/DSpace/commit/5654dc36685c00af0f809b2e8f50d3dd8bdb2aa8", "message": "Rename after refactor RelationshipMetadataServiceTest => RelationshipMetadataServiceIT since it now inherits from AbstractIT class", "committedDate": "2020-11-24T18:15:25Z", "type": "commit"}]}