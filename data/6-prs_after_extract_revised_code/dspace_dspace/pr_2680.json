{"pr_number": 2680, "pr_title": "Read only versioning endpoints", "pr_createdAt": "2020-02-19T08:22:36Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2680", "timeline": [{"oid": "0d95937c9b4ac95e154db79923b22d13cd024855", "url": "https://github.com/DSpace/DSpace/commit/0d95937c9b4ac95e154db79923b22d13cd024855", "message": "intermediate", "committedDate": "2020-02-13T14:41:43Z", "type": "commit"}, {"oid": "f853db306b49e49f593c5417112e73c63481ab92", "url": "https://github.com/DSpace/DSpace/commit/f853db306b49e49f593c5417112e73c63481ab92", "message": "[Task 68732] implemented Versioning and added tests", "committedDate": "2020-02-14T13:05:01Z", "type": "commit"}, {"oid": "ee280019b934d094a1423ca171b5b290fc13961a", "url": "https://github.com/DSpace/DSpace/commit/ee280019b934d094a1423ca171b5b290fc13961a", "message": "Applied feedback to the versions functionality", "committedDate": "2020-02-17T08:38:58Z", "type": "commit"}, {"oid": "97b69a15823fe4e2accc7140e6260a9d27e4de10", "url": "https://github.com/DSpace/DSpace/commit/97b69a15823fe4e2accc7140e6260a9d27e4de10", "message": "Merge remote-tracking branch 'dspace/master' into w2p-68732_list-version-history\n\nConflicts:\n\tdspace-server-webapp/src/main/java/org/dspace/app/rest/model/ItemRest.java", "committedDate": "2020-02-17T12:33:49Z", "type": "commit"}, {"oid": "d069889fc322840e02b87815fe68aa69a5cdc070", "url": "https://github.com/DSpace/DSpace/commit/d069889fc322840e02b87815fe68aa69a5cdc070", "message": "Fixes to versioning functionality after master merge", "committedDate": "2020-02-17T12:34:12Z", "type": "commit"}, {"oid": "284507dd07212cd2d36a5f996b1a72b869daaa78", "url": "https://github.com/DSpace/DSpace/commit/284507dd07212cd2d36a5f996b1a72b869daaa78", "message": "[Task 68810] added tests to the versioning ITs", "committedDate": "2020-02-18T10:42:19Z", "type": "commit"}, {"oid": "268640398501549bc68b35243f3345c32760e6de", "url": "https://github.com/DSpace/DSpace/commit/268640398501549bc68b35243f3345c32760e6de", "message": "[Task 68810] added search by ItemUUID to workspace and workflowitem endpoints as well as added tests for them", "committedDate": "2020-02-18T14:59:36Z", "type": "commit"}, {"oid": "5a96aab8721797d65f1a9f4c408707673571d4e9", "url": "https://github.com/DSpace/DSpace/commit/5a96aab8721797d65f1a9f4c408707673571d4e9", "message": "[Task 68857] added javadoc to the Version functionality classes", "committedDate": "2020-02-19T10:06:36Z", "type": "commit"}, {"oid": "0829cf5b518b646608c0a6632420f57adf3388c7", "url": "https://github.com/DSpace/DSpace/commit/0829cf5b518b646608c0a6632420f57adf3388c7", "message": "Merge remote-tracking branch 'dspace/master' into w2p-68732_list-version-history", "committedDate": "2020-03-03T12:17:00Z", "type": "commit"}, {"oid": "767274b98bf065f4864cb3865013b3cac4d2925c", "url": "https://github.com/DSpace/DSpace/commit/767274b98bf065f4864cb3865013b3cac4d2925c", "message": "[Task 69271] fixes after master merge", "committedDate": "2020-03-03T13:26:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc4NDQ1Mw==", "url": "https://github.com/DSpace/DSpace/pull/2680#discussion_r389784453", "bodyText": "I'm a little confused by this method & this Controller.  Why is it necessary when you've also created an EPersionVersionLinkRepository class which appears to do this same thing as this method?  Please double check this class is needed, and if no, please remove it.", "author": "tdonohue", "createdAt": "2020-03-09T15:54:11Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/VersionRestController.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import java.sql.SQLException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.dspace.app.rest.converter.ConverterService;\n+import org.dspace.app.rest.model.hateoas.EPersonResource;\n+import org.dspace.app.rest.utils.ContextUtil;\n+import org.dspace.app.rest.utils.Utils;\n+import org.dspace.core.Context;\n+import org.dspace.eperson.EPerson;\n+import org.dspace.versioning.Version;\n+import org.dspace.versioning.service.VersioningService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.data.web.PagedResourcesAssembler;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestMethod;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+/**\n+ * This controller handles calls for the Version endpoint with a specific ID\n+ */\n+@RestController\n+@RequestMapping(\"/api/versioning/versions/{id}\")\n+public class VersionRestController {\n+\n+    @Autowired\n+    private VersioningService versioningService;\n+\n+    @Autowired\n+    private ConverterService converterService;\n+\n+    @Autowired\n+    private Utils utils;\n+\n+    /**\n+     * This method will retrieve a Version object based on the given ID paramater and t'll fetch the EPerson from that\n+     * Version object and created a Resource from it and return this EPersonResource\n+     * @param id            The ID of the Version to be used\n+     * @param response      The current response\n+     * @param request       The current request\n+     * @param pageable      The pageable if present\n+     * @param assembler     The assembler\n+     * @return              The EPersonResource object constructed from the EPerson that was attached to the Version\n+     *                      object which was found through the given ID\n+     * @throws SQLException If something goes wrong\n+     */\n+    @RequestMapping(value = \"/eperson\", method = RequestMethod.GET)\n+    public EPersonResource retrieve(@PathVariable Integer id,", "originalCommit": "767274b98bf065f4864cb3865013b3cac4d2925c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d072654ae6a1e32e18e0ece91678c6f94200e78a", "chunk": "diff --git a/dspace-server-webapp/src/main/java/org/dspace/app/rest/VersionRestController.java b/dspace-server-webapp/src/main/java/org/dspace/app/rest/VersionRestController.java\nindex 5cd70f359..842cb28e0 100644\n--- a/dspace-server-webapp/src/main/java/org/dspace/app/rest/VersionRestController.java\n+++ b/dspace-server-webapp/src/main/java/org/dspace/app/rest/VersionRestController.java\n\n@@ -15,14 +15,17 @@ import org.dspace.app.rest.converter.ConverterService;\n import org.dspace.app.rest.model.hateoas.EPersonResource;\n import org.dspace.app.rest.utils.ContextUtil;\n import org.dspace.app.rest.utils.Utils;\n+import org.dspace.authorize.service.AuthorizeService;\n import org.dspace.core.Context;\n import org.dspace.eperson.EPerson;\n+import org.dspace.services.factory.DSpaceServicesFactory;\n import org.dspace.versioning.Version;\n import org.dspace.versioning.service.VersioningService;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.data.domain.Pageable;\n import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n import org.springframework.data.web.PagedResourcesAssembler;\n+import org.springframework.security.access.AccessDeniedException;\n import org.springframework.web.bind.annotation.PathVariable;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RequestMethod;\n"}}, {"oid": "c98bd13129d4124a30f6a0b4edc21eca7d44eaca", "url": "https://github.com/DSpace/DSpace/commit/c98bd13129d4124a30f6a0b4edc21eca7d44eaca", "message": "Merge remote-tracking branch 'dspace/master' into w2p-68732_list-version-history\n\nConflicts:\n\tdspace-server-webapp/src/test/java/org/dspace/app/rest/WorkflowItemRestRepositoryIT.java\n\tdspace-server-webapp/src/test/java/org/dspace/app/rest/WorkspaceItemRestRepositoryIT.java", "committedDate": "2020-03-12T12:44:21Z", "type": "commit"}, {"oid": "d072654ae6a1e32e18e0ece91678c6f94200e78a", "url": "https://github.com/DSpace/DSpace/commit/d072654ae6a1e32e18e0ece91678c6f94200e78a", "message": "[Task 69638] made the controller check the property, added tests, added extra check on the resource link addition", "committedDate": "2020-03-12T15:19:23Z", "type": "commit"}, {"oid": "32d48ecff72e280f493d4e7c9b05435741cd7f36", "url": "https://github.com/DSpace/DSpace/commit/32d48ecff72e280f493d4e7c9b05435741cd7f36", "message": "[Task 69638] removed the VersionController, made it into the LinkRepository plus added framework to disallow linksto be created", "committedDate": "2020-03-13T12:38:51Z", "type": "commit"}, {"oid": "b19c4022acf74143845d51ba78be528f71d3e415", "url": "https://github.com/DSpace/DSpace/commit/b19c4022acf74143845d51ba78be528f71d3e415", "message": "Javadocs", "committedDate": "2020-03-13T12:43:54Z", "type": "commit"}, {"oid": "a73e4cbd378d49a41eb92761087daac054da1686", "url": "https://github.com/DSpace/DSpace/commit/a73e4cbd378d49a41eb92761087daac054da1686", "message": "[Task 69916] submitter name exposure change", "committedDate": "2020-03-20T08:44:56Z", "type": "commit"}, {"oid": "1d4781a772867c78c55848c158dbc9edeb4b8a52", "url": "https://github.com/DSpace/DSpace/commit/1d4781a772867c78c55848c158dbc9edeb4b8a52", "message": "Merge remote-tracking branch 'dspace/master' into w2p-68732_list-version-history\n\nConflicts:\n\tdspace-server-webapp/src/main/java/org/dspace/app/rest/repository/WorkflowItemRestRepository.java\n\tdspace-server-webapp/src/main/java/org/dspace/app/rest/repository/WorkspaceItemRestRepository.java", "committedDate": "2020-03-20T09:59:55Z", "type": "commit"}, {"oid": "541a9d7ce4d7d47019bd24e5723b0c163e2ef298", "url": "https://github.com/DSpace/DSpace/commit/541a9d7ce4d7d47019bd24e5723b0c163e2ef298", "message": "checkstyle fixes", "committedDate": "2020-03-20T10:00:07Z", "type": "commit"}]}