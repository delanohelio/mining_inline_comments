{"pr_number": 2727, "pr_title": " Administer Workflow (Abort WorkflowItem, Delete WorkflowItem)", "pr_createdAt": "2020-03-31T14:54:28Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2727", "timeline": [{"oid": "cc471c4f50fd8191bb803c52e2a18c4ee218c9f5", "url": "https://github.com/DSpace/DSpace/commit/cc471c4f50fd8191bb803c52e2a18c4ee218c9f5", "message": "Add the SolrServiceWorkspaceWorkflowRestrictionPlugin and the workflowAdmin bean\n\nThis moves some workspace and workflow specific code from SolrServiceImpl to\nthe new SolrServiceWorkspaceWorkflowRestrictionPlugin. This also updates the\nSolrServiceResourceRestrictionPlugin to restrict those records based on read\nrights as well.", "committedDate": "2020-03-18T14:54:49Z", "type": "commit"}, {"oid": "224d252f1ab440aa0bd2c8625d6df63363af3238", "url": "https://github.com/DSpace/DSpace/commit/224d252f1ab440aa0bd2c8625d6df63363af3238", "message": "Add comments to discovery.xml config and move constants to plugin class", "committedDate": "2020-03-25T13:13:03Z", "type": "commit"}, {"oid": "63bacbde32da384dd8d74adecfc0d318126f14cf", "url": "https://github.com/DSpace/DSpace/commit/63bacbde32da384dd8d74adecfc0d318126f14cf", "message": "Add an integration test for the workflowAdmin configuration", "committedDate": "2020-03-26T08:52:06Z", "type": "commit"}, {"oid": "db1ce66b9aeab4ca0ad423c35196c253322c108e", "url": "https://github.com/DSpace/DSpace/commit/db1ce66b9aeab4ca0ad423c35196c253322c108e", "message": "Add license to new java file", "committedDate": "2020-03-31T09:20:32Z", "type": "commit"}, {"oid": "40fd23aee9779a7b9176b75d09fcbd94827356bc", "url": "https://github.com/DSpace/DSpace/commit/40fd23aee9779a7b9176b75d09fcbd94827356bc", "message": "Update imports", "committedDate": "2020-03-31T11:33:45Z", "type": "commit"}, {"oid": "102a2e8d6acc895ab887acf9420630fd5fcd868d", "url": "https://github.com/DSpace/DSpace/commit/102a2e8d6acc895ab887acf9420630fd5fcd868d", "message": "Merge remote-tracking branch 'upstream/master' into workflow-item-read-rights", "committedDate": "2020-04-01T09:53:46Z", "type": "commit"}, {"oid": "eff40c4f8213bbd5f92b8a51fc42dd65846232a4", "url": "https://github.com/DSpace/DSpace/commit/eff40c4f8213bbd5f92b8a51fc42dd65846232a4", "message": "Update javadoc", "committedDate": "2020-04-01T10:40:04Z", "type": "commit"}, {"oid": "03427d1cddc080618215946713048d9e8ac8b3d8", "url": "https://github.com/DSpace/DSpace/commit/03427d1cddc080618215946713048d9e8ac8b3d8", "message": "Update javadoc", "committedDate": "2020-04-01T13:35:36Z", "type": "commit"}, {"oid": "af523ea822d5b7b140a99753cdb804f385a5b42e", "url": "https://github.com/DSpace/DSpace/commit/af523ea822d5b7b140a99753cdb804f385a5b42e", "message": "Rearrange imports", "committedDate": "2020-04-02T07:19:37Z", "type": "commit"}, {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9", "url": "https://github.com/DSpace/DSpace/commit/3dc413c366787ebbaa82bdd0fb13e3853b63e5d9", "message": "Make a separate bean for workflowAdmin and clarify the comments in the ITs", "committedDate": "2020-04-02T12:29:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwMjY3NQ==", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r409102675", "bodyText": "Not necessarily required of this PR, but this big if/else if seems like something we should refactor at some point.  It implies to me that IndexableInProgressSubmission, IndexablePoolTask and IndexableClaimedTask should all implement an interface that has a getDSO() (or getRelatedDSO()) method.   That would make this easier to extend in the future.", "author": "tdonohue", "createdAt": "2020-04-15T20:06:40Z", "path": "dspace-api/src/main/java/org/dspace/discovery/SolrServiceResourceRestrictionPlugin.java", "diffHunk": "@@ -61,8 +66,21 @@\n \n     @Override\n     public void additionalIndex(Context context, IndexableObject idxObj, SolrInputDocument document) {\n+        DSpaceObject dso = null;\n         if (idxObj instanceof IndexableDSpaceObject) {\n-            DSpaceObject dso = ((IndexableDSpaceObject) idxObj).getIndexedObject();\n+            dso = ((IndexableDSpaceObject) idxObj).getIndexedObject();\n+        } else if (idxObj instanceof IndexableInProgressSubmission) {\n+            final InProgressSubmission inProgressSubmission\n+                    = ((IndexableInProgressSubmission) idxObj).getIndexedObject();\n+            dso = inProgressSubmission.getItem();\n+        } else if (idxObj instanceof IndexablePoolTask) {\n+            final PoolTask poolTask = ((IndexablePoolTask) idxObj).getIndexedObject();\n+            dso = poolTask.getWorkflowItem().getItem();\n+        } else if (idxObj instanceof IndexableClaimedTask) {\n+            final ClaimedTask claimedTask = ((IndexableClaimedTask) idxObj).getIndexedObject();\n+            dso = claimedTask.getWorkflowItem().getItem();", "originalCommit": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg2MjYwMw==", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r412862603", "bodyText": "I agree\nWe didn't want to change the discovery indexable objects in this PR, but it would definitely improve the functionality here, and can perhaps be used in the future in other locations where the item of any workflow object should be retrieved", "author": "benbosman", "createdAt": "2020-04-22T10:26:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwMjY3NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwMzEyOQ==", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r409103129", "bodyText": "Could we add quick JavaDocs to this method while we are updating it?", "author": "tdonohue", "createdAt": "2020-04-15T20:07:35Z", "path": "dspace-api/src/main/java/org/dspace/discovery/SolrServiceSearchPlugin.java", "diffHunk": "@@ -19,5 +19,6 @@\n  */\n public interface SolrServiceSearchPlugin {\n \n-    public void additionalSearchParameters(Context context, DiscoverQuery discoveryQuery, SolrQuery solrQuery);\n+    public void additionalSearchParameters(Context context, DiscoverQuery discoveryQuery, SolrQuery solrQuery)", "originalCommit": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg2Njk3OA==", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r412866978", "bodyText": "It's not specific to this PR, but we can add JavaDocs", "author": "benbosman", "createdAt": "2020-04-22T10:33:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwMzEyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "bf54ae6af0f63e00056bd5573144762f7ce5c1b7", "chunk": "diff --git a/dspace-api/src/main/java/org/dspace/discovery/SolrServiceSearchPlugin.java b/dspace-api/src/main/java/org/dspace/discovery/SolrServiceSearchPlugin.java\nindex d9259ce80..d7994fc7a 100644\n--- a/dspace-api/src/main/java/org/dspace/discovery/SolrServiceSearchPlugin.java\n+++ b/dspace-api/src/main/java/org/dspace/discovery/SolrServiceSearchPlugin.java\n\n@@ -19,6 +19,14 @@ import org.dspace.core.Context;\n  */\n public interface SolrServiceSearchPlugin {\n \n+    /**\n+     * Edits the solr query before it is sent to solr by adding additional parameters to it.\n+     *\n+     * @param context The DSpace Context object.\n+     * @param discoveryQuery The discovery query object on which the solr query is based.\n+     * @param solrQuery The query that will be sent to solr and which may be edited by this plugin.\n+     * @throws SearchServiceException Any checked exception that might happen in this plugin\n+     */\n     public void additionalSearchParameters(Context context, DiscoverQuery discoveryQuery, SolrQuery solrQuery)\n             throws SearchServiceException;\n }\n"}}, {"oid": "3263d7f137aa27376306d906eae4cdbe5c7969ca", "url": "https://github.com/DSpace/DSpace/commit/3263d7f137aa27376306d906eae4cdbe5c7969ca", "message": "Return workflow items for the workflowAdmin configuration", "committedDate": "2020-04-17T08:24:03Z", "type": "commit"}, {"oid": "bf54ae6af0f63e00056bd5573144762f7ce5c1b7", "url": "https://github.com/DSpace/DSpace/commit/bf54ae6af0f63e00056bd5573144762f7ce5c1b7", "message": "Add JavaDocs", "committedDate": "2020-04-28T09:47:03Z", "type": "commit"}]}