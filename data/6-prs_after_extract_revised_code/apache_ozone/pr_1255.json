{"pr_number": 1255, "pr_title": "HDDS-4021. Organize Recon DBs into a 'DBDefinition'.", "pr_createdAt": "2020-07-24T21:14:51Z", "pr_url": "https://github.com/apache/ozone/pull/1255", "timeline": [{"oid": "47612b2f5b51900d7094628632b3d31eb6480d4a", "url": "https://github.com/apache/ozone/commit/47612b2f5b51900d7094628632b3d31eb6480d4a", "message": "HDDS-4021. Organize Recon DBs into a 'DBDefinition'.", "committedDate": "2020-07-24T21:13:31Z", "type": "commit"}, {"oid": "803bd69db16a12e3de602d8086c016c986245448", "url": "https://github.com/apache/ozone/commit/803bd69db16a12e3de602d8086c016c986245448", "message": "Fix compilation issue.", "committedDate": "2020-07-24T21:51:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0ODEyMg==", "url": "https://github.com/apache/ozone/pull/1255#discussion_r462948122", "bodyText": "NIT: as I am an oldschool command line user, I would prefer to use --with-keys instead of camel case", "author": "elek", "createdAt": "2020-07-30T12:05:06Z", "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBScanner.java", "diffHunk": "@@ -44,28 +44,46 @@\n             description = \"Table name\")\n   private String tableName;\n \n+  @CommandLine.Option(names = {\"--withKey\"},", "originalCommit": "803bd69db16a12e3de602d8086c016c986245448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1MTY2NQ==", "url": "https://github.com/apache/ozone/pull/1255#discussion_r463151665", "bodyText": "Sure, will do.", "author": "avijayanhwx", "createdAt": "2020-07-30T17:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0ODEyMg=="}], "type": "inlineReview", "revised_code": {"commit": "16ea452459883086de1df5a392f147b387fa58ca", "chunk": "diff --git a/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBScanner.java b/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBScanner.java\nindex 532368032c..5da64e04ad 100644\n--- a/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBScanner.java\n+++ b/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBScanner.java\n\n@@ -44,16 +44,12 @@\n             description = \"Table name\")\n   private String tableName;\n \n-  @CommandLine.Option(names = {\"--withKey\"},\n+  @CommandLine.Option(names = {\"--with-keys\"},\n       description = \"List Key -> Value instead of just Value.\",\n       defaultValue = \"false\",\n       showDefaultValue = CommandLine.Help.Visibility.ALWAYS)\n   private boolean withKey;\n \n-  @CommandLine.Option(names = {\"--type\"},\n-      description = \"Type name. (Pass in 'recon' for a Recon managed DB)\")\n-  private String dbType;\n-\n   @CommandLine.ParentCommand\n   private RDBParser parent;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0OTU4Ng==", "url": "https://github.com/apache/ozone/pull/1255#discussion_r462949586", "bodyText": "I am not sure if we need type here. I think this can be simplified as:\n public static DBDefinition getDefinition(String dbName, String type){\n    if (dbMap.containsKey(dbName)){\n      return dbMap.get(dbName);\n  }\n    if (dbName.equals(RECON_SCM_DB_NAME)) {\n      return new ReconSCMDBDefinition();\n    } else if (dbName.startsWith(RECON_CONTAINER_KEY_DB)) {\n      return new ReconDBDefinition(dbName);\n    } else if (dbName.startsWith(RECON_OM_SNAPSHOT_DB)) {\n      return new OMDBDefinition();\n    }\n    return null;\n  }\nSeems to be a good logic which just works.\nOr actually RECON_SCM_DB_NAME also can be added to the map, so you don't need the firts condition", "author": "elek", "createdAt": "2020-07-30T12:08:18Z", "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBDefinitionFactory.java", "diffHunk": "@@ -40,10 +46,24 @@ private DBDefinitionFactory() {\n     dbMap.put(new OMDBDefinition().getName(), new OMDBDefinition());\n   }\n \n-  public static DBDefinition getDefinition(String dbName){\n+  public static DBDefinition getDefinition(String dbName, String type){", "originalCommit": "803bd69db16a12e3de602d8086c016c986245448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1MTUyMA==", "url": "https://github.com/apache/ozone/pull/1255#discussion_r463151520", "bodyText": "You are right. At the start of writing this API, I was convinced I need a 'type' parameter. At the end of my patch, that was no longer true :) Forgot to remove this assumption. I will fix it.", "author": "avijayanhwx", "createdAt": "2020-07-30T17:19:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0OTU4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "16ea452459883086de1df5a392f147b387fa58ca", "chunk": "diff --git a/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBDefinitionFactory.java b/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBDefinitionFactory.java\nindex 5d03b18803..d9d0d704d8 100644\n--- a/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBDefinitionFactory.java\n+++ b/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/debug/DBDefinitionFactory.java\n\n@@ -42,24 +42,22 @@ private DBDefinitionFactory() {\n \n   static {\n     dbMap = new HashMap<>();\n-    dbMap.put(new SCMDBDefinition().getName(), new SCMDBDefinition());\n-    dbMap.put(new OMDBDefinition().getName(), new OMDBDefinition());\n+    Arrays.asList(\n+      new SCMDBDefinition(),\n+      new OMDBDefinition(),\n+      new ReconSCMDBDefinition()\n+    ).forEach(dbDefinition -> dbMap.put(dbDefinition.getName(), dbDefinition));\n   }\n \n-  public static DBDefinition getDefinition(String dbName, String type){\n+  public static DBDefinition getDefinition(String dbName){\n     if (dbMap.containsKey(dbName)){\n       return dbMap.get(dbName);\n     }\n-    if (type != null && type.equals(\"recon\")) {\n-      return getReconDBDefinition(dbName);\n-    }\n-    return null;\n+    return getReconDBDefinition(dbName);\n   }\n \n   private static DBDefinition getReconDBDefinition(String dbName){\n-    if (dbName.equals(RECON_SCM_DB_NAME)) {\n-      return new ReconSCMDBDefinition();\n-    } else if (dbName.startsWith(RECON_CONTAINER_KEY_DB)) {\n+    if (dbName.startsWith(RECON_CONTAINER_KEY_DB)) {\n       return new ReconDBDefinition(dbName);\n     } else if (dbName.startsWith(RECON_OM_SNAPSHOT_DB)) {\n       return new OMDBDefinition();\n"}}, {"oid": "16ea452459883086de1df5a392f147b387fa58ca", "url": "https://github.com/apache/ozone/commit/16ea452459883086de1df5a392f147b387fa58ca", "message": "Address review comments.", "committedDate": "2020-07-30T22:10:13Z", "type": "commit"}, {"oid": "39dba090fd3cf85bf029d0ac61ec080161227618", "url": "https://github.com/apache/ozone/commit/39dba090fd3cf85bf029d0ac61ec080161227618", "message": "Merge remote-tracking branch 'upstream/master' into HDDS-4021-master", "committedDate": "2020-07-31T03:24:43Z", "type": "commit"}, {"oid": "f2c7c20116b43799ff33dbb5fb79db1181f15a48", "url": "https://github.com/apache/ozone/commit/f2c7c20116b43799ff33dbb5fb79db1181f15a48", "message": "retrigger build with empty commit", "committedDate": "2020-07-31T15:30:53Z", "type": "commit"}]}