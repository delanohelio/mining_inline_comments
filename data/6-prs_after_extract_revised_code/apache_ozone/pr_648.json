{"pr_number": 648, "pr_title": "HDDS-3117. Recon throws InterruptedException while getting new snapshot from OM.", "pr_createdAt": "2020-03-06T19:41:32Z", "pr_url": "https://github.com/apache/ozone/pull/648", "timeline": [{"oid": "63f40a262b40c5869e5319bdb98853dd832cfb20", "url": "https://github.com/apache/ozone/commit/63f40a262b40c5869e5319bdb98853dd832cfb20", "message": "HDDS-3117. Recon throws InterruptedException while getting new snapshot from OM.", "committedDate": "2020-03-06T19:35:25Z", "type": "commit"}, {"oid": "e61d80078c81884a3ab74e304a024c4b182fcffe", "url": "https://github.com/apache/ozone/commit/e61d80078c81884a3ab74e304a024c4b182fcffe", "message": "HDDS-3117. Fix test failures.", "committedDate": "2020-03-06T23:46:09Z", "type": "commit"}, {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b", "url": "https://github.com/apache/ozone/commit/565508a0ae86cf4a9ff461c41c212b7bef38c63b", "message": "Merge remote-tracking branch 'upstream/master' into HDDS-3117-master", "committedDate": "2020-03-06T23:51:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk5MzQwMA==", "url": "https://github.com/apache/ozone/pull/648#discussion_r389993400", "bodyText": "Shouldn't interrupt() be kept for InterruptedException and avoided only for the rest?", "author": "adoroszlai", "createdAt": "2020-03-09T22:20:26Z", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java", "diffHunk": "@@ -350,8 +357,7 @@ public void syncDataFromOM() {\n         // Pass on DB update events to tasks that are listening.\n         reconTaskController.consumeOMEvents(new OMUpdateEventBatch(\n             omdbUpdatesHandler.getEvents()), omMetadataManager);\n-      } catch (IOException | InterruptedException | RocksDBException e) {\n-        Thread.currentThread().interrupt();", "originalCommit": "565508a0ae86cf4a9ff461c41c212b7bef38c63b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a77d5dfb8bd241e01b672e4347f4f0b6ca0baa9", "chunk": "diff --git a/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java b/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java\nindex dd59693784..7df706fe5e 100644\n--- a/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java\n+++ b/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java\n\n@@ -357,6 +357,8 @@ public void syncDataFromOM() {\n         // Pass on DB update events to tasks that are listening.\n         reconTaskController.consumeOMEvents(new OMUpdateEventBatch(\n             omdbUpdatesHandler.getEvents()), omMetadataManager);\n+      } catch (InterruptedException intEx) {\n+        Thread.currentThread().interrupt();\n       } catch (Exception e) {\n         LOG.warn(\"Unable to get and apply delta updates from OM.\", e);\n         fullSnapshot = true;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk5MzYwMA==", "url": "https://github.com/apache/ozone/pull/648#discussion_r389993600", "bodyText": "I think this can be kept for the InterruptedException case.", "author": "adoroszlai", "createdAt": "2020-03-09T22:20:58Z", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java", "diffHunk": "@@ -374,9 +380,8 @@ public void syncDataFromOM() {\n           LOG.info(\"Calling reprocess on Recon tasks.\");\n           reconTaskController.reInitializeTasks(omMetadataManager);\n         }\n-      } catch (IOException | InterruptedException e) {\n-        Thread.currentThread().interrupt();", "originalCommit": "565508a0ae86cf4a9ff461c41c212b7bef38c63b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a77d5dfb8bd241e01b672e4347f4f0b6ca0baa9", "chunk": "diff --git a/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java b/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java\nindex dd59693784..7df706fe5e 100644\n--- a/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java\n+++ b/hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java\n\n@@ -380,6 +382,8 @@ public void syncDataFromOM() {\n           LOG.info(\"Calling reprocess on Recon tasks.\");\n           reconTaskController.reInitializeTasks(omMetadataManager);\n         }\n+      } catch (InterruptedException intEx) {\n+        Thread.currentThread().interrupt();\n       } catch (Exception e) {\n         LOG.error(\"Unable to update Recon's metadata with new OM DB. \", e);\n       }\n"}}, {"oid": "9a77d5dfb8bd241e01b672e4347f4f0b6ca0baa9", "url": "https://github.com/apache/ozone/commit/9a77d5dfb8bd241e01b672e4347f4f0b6ca0baa9", "message": "HDDS-3117. Fix review comments.", "committedDate": "2020-03-10T18:32:12Z", "type": "commit"}, {"oid": "b4aba2fa107fe1a5a853c9904a30859806e8060f", "url": "https://github.com/apache/ozone/commit/b4aba2fa107fe1a5a853c9904a30859806e8060f", "message": "Test fix for acceptance test failure.", "committedDate": "2020-03-10T19:58:56Z", "type": "commit"}, {"oid": "266020db89085a21735ab2a94e2eeb93d9c61ed7", "url": "https://github.com/apache/ozone/commit/266020db89085a21735ab2a94e2eeb93d9c61ed7", "message": "Acceptance test fix.", "committedDate": "2020-03-11T04:56:51Z", "type": "commit"}, {"oid": "e12d4ae23b334a54f6b8b7a0248a74e2951f7cbc", "url": "https://github.com/apache/ozone/commit/e12d4ae23b334a54f6b8b7a0248a74e2951f7cbc", "message": "trigger new CI check", "committedDate": "2020-03-11T12:52:55Z", "type": "commit"}, {"oid": "6220daf5c04935b3ed6b17e105f805eeb0264c9f", "url": "https://github.com/apache/ozone/commit/6220daf5c04935b3ed6b17e105f805eeb0264c9f", "message": "Merge remote-tracking branch 'upstream/master' into HDDS-3117-master", "committedDate": "2020-03-11T18:14:38Z", "type": "commit"}]}