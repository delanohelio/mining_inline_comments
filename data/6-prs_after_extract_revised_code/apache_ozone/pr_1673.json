{"pr_number": 1673, "pr_title": "HDDS-4559. Avoid using hard coding uft-8 charset", "pr_createdAt": "2020-12-08T02:12:36Z", "pr_url": "https://github.com/apache/ozone/pull/1673", "timeline": [{"oid": "8853834de6a8a0f8c99aae8ac6402a7c3aa980e7", "url": "https://github.com/apache/ozone/commit/8853834de6a8a0f8c99aae8ac6402a7c3aa980e7", "message": "HDDS-4559. Avoid using hard coding uft-8 charset", "committedDate": "2020-12-08T02:41:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4MzY0NA==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538083644", "bodyText": "Both usages of GDPR_CHARSET are in calls to methods where both String and Charset versions exist, so we can make this change:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static final String GDPR_CHARSET = StandardCharsets.UTF_8.name();\n          \n          \n            \n              public static final Charset GDPR_CHARSET = StandardCharsets.UTF_8;\n          \n      \n    \n    \n  \n\nSince it is only used in GDPRSymmetricKey, I would also consider inlining this constant.  I don't think we need to define it globally.", "author": "adoroszlai", "createdAt": "2020-12-08T07:02:10Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConsts.java", "diffHunk": "@@ -351,7 +352,7 @@ private OzoneConsts() {\n   public static final String GDPR_FLAG = \"gdprEnabled\";\n   public static final String GDPR_ALGORITHM_NAME = \"AES\";\n   public static final int GDPR_DEFAULT_RANDOM_SECRET_LENGTH = 16;\n-  public static final String GDPR_CHARSET = \"UTF-8\";\n+  public static final String GDPR_CHARSET = StandardCharsets.UTF_8.name();", "originalCommit": "87bc56de0838ae178bb506dddc163782baa10e2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEyNDQ2Nw==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538124467", "bodyText": "I think keep GDPR_CHARSET here is better, because define constants about GDPR here.", "author": "lamberken", "createdAt": "2020-12-08T08:14:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4MzY0NA=="}], "type": "inlineReview", "revised_code": {"commit": "fa807234bf8ae2623c4525a0e1751c34d48db082", "chunk": "diff --git a/hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConsts.java b/hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConsts.java\nindex 729ad96a3..07e28155e 100644\n--- a/hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConsts.java\n+++ b/hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConsts.java\n\n@@ -352,7 +353,7 @@ private OzoneConsts() {\n   public static final String GDPR_FLAG = \"gdprEnabled\";\n   public static final String GDPR_ALGORITHM_NAME = \"AES\";\n   public static final int GDPR_DEFAULT_RANDOM_SECRET_LENGTH = 16;\n-  public static final String GDPR_CHARSET = StandardCharsets.UTF_8.name();\n+  public static final Charset GDPR_CHARSET = StandardCharsets.UTF_8;\n   public static final String GDPR_LENGTH = \"length\";\n   public static final String GDPR_SECRET = \"secret\";\n   public static final String GDPR_ALGORITHM = \"algorithm\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4OTUwNQ==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538089505", "bodyText": "This is used in two kinds of calls:\n\nRandomStringUtils.random: its chars parameter is not intended for charsets, rather the set of characters to use.  Eg. for \"UTF-8\" it will generate strings like \"--8F8T8U8T\".  Since we don't need this special kind of random string, this usage can be simply removed.\nIOUtils.toInputStream: can accept Charset, too.\n\nAfter removing the first kind of usage, we can convert this constant to Charset.  (I would also inline it, ie. simply use UTF_8.)", "author": "adoroszlai", "createdAt": "2020-12-08T07:15:07Z", "path": "hadoop-hdds/framework/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/client/TestDefaultCertificateClient.java", "diffHunk": "@@ -75,7 +76,7 @@\n   private Path dnMetaDirPath;\n   private SecurityConfig omSecurityConfig;\n   private SecurityConfig dnSecurityConfig;\n-  private final static String UTF = \"UTF-8\";\n+  private final static String UTF = StandardCharsets.UTF_8.name();", "originalCommit": "87bc56de0838ae178bb506dddc163782baa10e2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEyMTMxNQ==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538121315", "bodyText": "done", "author": "lamberken", "createdAt": "2020-12-08T08:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4OTUwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "fa807234bf8ae2623c4525a0e1751c34d48db082", "chunk": "diff --git a/hadoop-hdds/framework/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/client/TestDefaultCertificateClient.java b/hadoop-hdds/framework/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/client/TestDefaultCertificateClient.java\nindex 7bdcf6241..d84135917 100644\n--- a/hadoop-hdds/framework/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/client/TestDefaultCertificateClient.java\n+++ b/hadoop-hdds/framework/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/client/TestDefaultCertificateClient.java\n\n@@ -76,7 +76,6 @@\n   private Path dnMetaDirPath;\n   private SecurityConfig omSecurityConfig;\n   private SecurityConfig dnSecurityConfig;\n-  private final static String UTF = StandardCharsets.UTF_8.name();\n   private final static String DN_COMPONENT = DNCertificateClient.COMPONENT_NAME;\n   private final static String OM_COMPONENT = OMCertificateClient.COMPONENT_NAME;\n   private KeyCodec omKeyCodec;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA5MTM3Nw==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538091377", "bodyText": "Nit: this constant can be replaced with import static java.nio.charset.StandardCharsets.UTF_8;.", "author": "adoroszlai", "createdAt": "2020-12-08T07:18:43Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/security/AWSV4AuthValidator.java", "diffHunk": "@@ -42,7 +42,7 @@\n   private final static Logger LOG =\n       LoggerFactory.getLogger(AWSV4AuthValidator.class);\n   private static final String HMAC_SHA256_ALGORITHM = \"HmacSHA256\";\n-  private static final Charset UTF_8 = Charset.forName(\"utf-8\");\n+  private static final Charset UTF_8 = StandardCharsets.UTF_8;", "originalCommit": "87bc56de0838ae178bb506dddc163782baa10e2d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fa807234bf8ae2623c4525a0e1751c34d48db082", "chunk": "diff --git a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/security/AWSV4AuthValidator.java b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/security/AWSV4AuthValidator.java\nindex 77c8d2a4f..0a0e94767 100644\n--- a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/security/AWSV4AuthValidator.java\n+++ b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/security/AWSV4AuthValidator.java\n\n@@ -42,14 +41,13 @@\n   private final static Logger LOG =\n       LoggerFactory.getLogger(AWSV4AuthValidator.class);\n   private static final String HMAC_SHA256_ALGORITHM = \"HmacSHA256\";\n-  private static final Charset UTF_8 = StandardCharsets.UTF_8;\n \n   private AWSV4AuthValidator() {\n   }\n \n   private static String urlDecode(String str) {\n     try {\n-      return URLDecoder.decode(str, UTF_8.name());\n+      return URLDecoder.decode(str, StandardCharsets.UTF_8.name());\n     } catch (UnsupportedEncodingException e) {\n       throw new RuntimeException(e);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA5NTc4NQ==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538095785", "bodyText": "Nit: usages of this constant can be replaced with the one from StandardCharsets.", "author": "adoroszlai", "createdAt": "2020-12-08T07:27:45Z", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/SignatureProcessor.java", "diffHunk": "@@ -32,7 +33,7 @@\n   String X_AMAZ_DATE = \"X-Amz-Date\";\n   String CONTENT_MD5 = \"content-md5\";\n   String AUTHORIZATION_HEADER = \"Authorization\";\n-  Charset UTF_8 = Charset.forName(\"utf-8\");\n+  Charset UTF_8 = StandardCharsets.UTF_8;", "originalCommit": "87bc56de0838ae178bb506dddc163782baa10e2d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fa807234bf8ae2623c4525a0e1751c34d48db082", "chunk": "diff --git a/hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/SignatureProcessor.java b/hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/SignatureProcessor.java\nindex 971865bc5..5e2e3fb20 100644\n--- a/hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/SignatureProcessor.java\n+++ b/hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/SignatureProcessor.java\n\n@@ -33,7 +31,6 @@\n   String X_AMAZ_DATE = \"X-Amz-Date\";\n   String CONTENT_MD5 = \"content-md5\";\n   String AUTHORIZATION_HEADER = \"Authorization\";\n-  Charset UTF_8 = StandardCharsets.UTF_8;\n   String X_AMZ_CONTENT_SHA256 = \"X-Amz-Content-SHA256\";\n   String HOST = \"host\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA5NjM4MA==", "url": "https://github.com/apache/ozone/pull/1673#discussion_r538096380", "bodyText": "encoding is unused, can be removed.", "author": "adoroszlai", "createdAt": "2020-12-08T07:28:50Z", "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/scm/cli/SQLCLI.java", "diffHunk": "@@ -72,7 +73,7 @@\n \n   private Options options;\n   private BasicParser parser;\n-  private final Charset encoding = Charset.forName(\"UTF-8\");\n+  private final Charset encoding = StandardCharsets.UTF_8;", "originalCommit": "87bc56de0838ae178bb506dddc163782baa10e2d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fa807234bf8ae2623c4525a0e1751c34d48db082", "chunk": "diff --git a/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/scm/cli/SQLCLI.java b/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/scm/cli/SQLCLI.java\nindex 98d7a7b03..71039f4ac 100644\n--- a/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/scm/cli/SQLCLI.java\n+++ b/hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/scm/cli/SQLCLI.java\n\n@@ -73,7 +71,6 @@\n \n   private Options options;\n   private BasicParser parser;\n-  private final Charset encoding = StandardCharsets.UTF_8;\n   private final OzoneConfiguration conf;\n \n   // for container.db\n"}}, {"oid": "fa807234bf8ae2623c4525a0e1751c34d48db082", "url": "https://github.com/apache/ozone/commit/fa807234bf8ae2623c4525a0e1751c34d48db082", "message": "improve updates", "committedDate": "2020-12-09T01:23:38Z", "type": "commit"}]}