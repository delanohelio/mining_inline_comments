{"pr_number": 813, "pr_title": "HDDS-3309. Add TimedOutTestsListener to surefire and add timeout to integration tests", "pr_createdAt": "2020-04-13T02:07:49Z", "pr_url": "https://github.com/apache/ozone/pull/813", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEzODA2Nw==", "url": "https://github.com/apache/ozone/pull/813#discussion_r410138067", "bodyText": "Unused import.", "author": "adoroszlai", "createdAt": "2020-04-17T10:33:03Z", "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/test/TimedOutTestsListener.java", "diffHunk": "@@ -31,6 +31,7 @@\n \n import org.apache.hadoop.util.StringUtils;\n \n+import org.junit.runner.Description;", "originalCommit": "6e67832d3fbd9b38e5b57daf7c1f4b6e8c9dabf3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3cbd5e0a373359f0a5d3ef42f061192f4ddf46ea", "chunk": "diff --git a/hadoop-hdds/common/src/test/java/org/apache/hadoop/test/TimedOutTestsListener.java b/hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/TimedOutTestsListener.java\nsimilarity index 91%\nrename from hadoop-hdds/common/src/test/java/org/apache/hadoop/test/TimedOutTestsListener.java\nrename to hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/TimedOutTestsListener.java\nindex 4c99266c38..f111f7ddd6 100644\n--- a/hadoop-hdds/common/src/test/java/org/apache/hadoop/test/TimedOutTestsListener.java\n+++ b/hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/TimedOutTestsListener.java\n\n@@ -27,28 +29,29 @@\n import java.text.DateFormat;\n import java.text.SimpleDateFormat;\n import java.util.Date;\n+import java.util.Locale;\n import java.util.Map;\n \n-import org.apache.hadoop.util.StringUtils;\n-\n-import org.junit.runner.Description;\n import org.junit.runner.notification.Failure;\n import org.junit.runner.notification.RunListener;\n \n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n /**\n  * JUnit run listener which prints full thread dump into System.err\n  * in case a test is failed due to timeout.\n  */\n public class TimedOutTestsListener extends RunListener {\n \n-  static final String TEST_TIMED_OUT_PREFIX = \"test timed out after\";\n+  private static final String TEST_TIMED_OUT_PREFIX = \"test timed out after\";\n \n   private static final String INDENT = \"    \";\n \n   private final PrintWriter output;\n   \n   public TimedOutTestsListener() {\n-    this.output = new PrintWriter(System.err);\n+    this(new PrintWriter(new BufferedWriter(new OutputStreamWriter(\n+        System.err, UTF_8))));\n   }\n   \n   public TimedOutTestsListener(PrintWriter output) {\n"}}, {"oid": "3cbd5e0a373359f0a5d3ef42f061192f4ddf46ea", "url": "https://github.com/apache/ozone/commit/3cbd5e0a373359f0a5d3ef42f061192f4ddf46ea", "message": "Revert \"Add TimedOutTestsListener to hdds and ozone pom.\"\n\nThis reverts commit 8dbbde83e1485ffe0ece2b40e822fdf17c466638.", "committedDate": "2020-05-16T14:31:27Z", "type": "forcePushed"}, {"oid": "b84b9a47a3a931eb50c748cbdba74a26125a2c06", "url": "https://github.com/apache/ozone/commit/b84b9a47a3a931eb50c748cbdba74a26125a2c06", "message": "Restore timeouts that already exists pre-patch.", "committedDate": "2020-05-18T16:12:22Z", "type": "forcePushed"}, {"oid": "c98c98161b62ea91a53d0259f651041c3c6ab8b6", "url": "https://github.com/apache/ozone/commit/c98c98161b62ea91a53d0259f651041c3c6ab8b6", "message": "Add TimedOutTestsListener to hdds and ozone pom.", "committedDate": "2020-05-18T16:28:22Z", "type": "commit"}, {"oid": "2e9bae2f8636974c5c0e11a4a3e04d9cbfbb2288", "url": "https://github.com/apache/ozone/commit/2e9bae2f8636974c5c0e11a4a3e04d9cbfbb2288", "message": "Add TimedOutTestsListener to root pom maven-surefire-plugin.", "committedDate": "2020-05-18T16:28:22Z", "type": "commit"}, {"oid": "ac471f58ff1601fe51d3953e165c3b48600f24d5", "url": "https://github.com/apache/ozone/commit/ac471f58ff1601fe51d3953e165c3b48600f24d5", "message": "Revert \"Add TimedOutTestsListener to hdds and ozone pom.\"\n\nThis reverts commit 8dbbde83e1485ffe0ece2b40e822fdf17c466638.", "committedDate": "2020-05-18T16:28:22Z", "type": "commit"}, {"oid": "f6c66c00ad135798702228f84f547da9777d22ef", "url": "https://github.com/apache/ozone/commit/f6c66c00ad135798702228f84f547da9777d22ef", "message": "All timeouts to all integration tests.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "105d02080c42abf356f948d9ad9c57bd570f3864", "url": "https://github.com/apache/ozone/commit/105d02080c42abf356f948d9ad9c57bd570f3864", "message": "Exclude change from ignored freon tests.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "7b3e642d976453d2f350da21b8a4023be759c55f", "url": "https://github.com/apache/ozone/commit/7b3e642d976453d2f350da21b8a4023be759c55f", "message": "Exclude change from all ignored test classes.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "60c8c79fc93d452109e93baaeba8510e6f7e622a", "url": "https://github.com/apache/ozone/commit/60c8c79fc93d452109e93baaeba8510e6f7e622a", "message": "Fix checkstyle.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "d6555667c605e53a235825726756f08e43789081", "url": "https://github.com/apache/ozone/commit/d6555667c605e53a235825726756f08e43789081", "message": "Restore timeouts that already exists pre-patch.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "2b2870a973e9b56240e09a13e952134ff11c3505", "url": "https://github.com/apache/ozone/commit/2b2870a973e9b56240e09a13e952134ff11c3505", "message": "Fix weird checkstyle problem in TestKeyInputStream.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "274c3c651930204a1daebb06fb10f98828ab5f15", "url": "https://github.com/apache/ozone/commit/274c3c651930204a1daebb06fb10f98828ab5f15", "message": "Remove timeout in TestKeyInputStream because #931 added it already.", "committedDate": "2020-05-18T16:28:23Z", "type": "commit"}, {"oid": "274c3c651930204a1daebb06fb10f98828ab5f15", "url": "https://github.com/apache/ozone/commit/274c3c651930204a1daebb06fb10f98828ab5f15", "message": "Remove timeout in TestKeyInputStream because #931 added it already.", "committedDate": "2020-05-18T16:28:23Z", "type": "forcePushed"}, {"oid": "4c5c918edcc25bd68bf7f0ed8d7fc2770b3702f8", "url": "https://github.com/apache/ozone/commit/4c5c918edcc25bd68bf7f0ed8d7fc2770b3702f8", "message": "Remove whitespace.", "committedDate": "2020-05-22T20:11:25Z", "type": "commit"}, {"oid": "b37422cb4d8e9f42742bdc0374e639f4a76fd97a", "url": "https://github.com/apache/ozone/commit/b37422cb4d8e9f42742bdc0374e639f4a76fd97a", "message": "Remove change from more ignored tests.", "committedDate": "2020-05-22T20:20:03Z", "type": "commit"}, {"oid": "2d570692fee79807257af66777130fb6a6c02467", "url": "https://github.com/apache/ozone/commit/2d570692fee79807257af66777130fb6a6c02467", "message": "trigger new CI check", "committedDate": "2020-05-27T10:25:42Z", "type": "commit"}, {"oid": "614c372b9358d4738862c1e4b4735299d798cc74", "url": "https://github.com/apache/ozone/commit/614c372b9358d4738862c1e4b4735299d798cc74", "message": "Merge remote-tracking branch 'origin/master' into HEAD", "committedDate": "2020-05-28T09:26:57Z", "type": "commit"}, {"oid": "843f1d894ccfae78a717bd5f5f1faa2cf782d4bc", "url": "https://github.com/apache/ozone/commit/843f1d894ccfae78a717bd5f5f1faa2cf782d4bc", "message": "retrigger build with empty commit", "committedDate": "2020-05-28T09:27:02Z", "type": "commit"}]}