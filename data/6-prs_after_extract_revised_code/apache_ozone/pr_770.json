{"pr_number": 770, "pr_title": "HDDS-3178. Add unit tests for OMGetDelegationToken Request and Response", "pr_createdAt": "2020-04-03T21:26:05Z", "pr_url": "https://github.com/apache/ozone/pull/770", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3MTg0Mg==", "url": "https://github.com/apache/ozone/pull/770#discussion_r413271842", "bodyText": "Do we need to set the secretManager again? OzoneManager.getDelegationTokenMgr is going to return the same object again.", "author": "hanishakoneru", "createdAt": "2020-04-22T19:44:43Z", "path": "hadoop-ozone/ozone-manager/src/test/java/org/apache/hadoop/ozone/om/request/security/TestOMGetDelegationTokenRequest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.ozone.om.request.security;\n+\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Optional;\n+import java.util.UUID;\n+import org.apache.hadoop.ozone.om.response.OMClientResponse;\n+import org.apache.hadoop.ozone.security.OzoneDelegationTokenSecretManager;\n+import org.apache.hadoop.ozone.security.OzoneTokenIdentifier;\n+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.Type;\n+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.Status;\n+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos\n+    .OMRequest;\n+import static org.apache.hadoop.ozone.security.OzoneTokenIdentifier.KIND_NAME;\n+import org.apache.hadoop.security.token.Token;\n+import org.apache.hadoop.security.proto.SecurityProtos.GetDelegationTokenRequestProto;\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.apache.hadoop.io.Text;\n+import org.mockito.Mockito;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyLong;\n+import static org.mockito.Mockito.when;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+/**\n+ * The class tests OMGetDelegationTokenRequest.\n+ */\n+public class TestOMGetDelegationTokenRequest extends\n+    TestOMDelegationTokenRequest {\n+\n+  private OzoneDelegationTokenSecretManager secretManager;\n+  private OzoneTokenIdentifier identifier;\n+  private Token<OzoneTokenIdentifier> token;\n+  private Text tester;\n+  private OMRequest originalRequest;\n+  private OMRequest modifiedRequest;\n+  private OMGetDelegationTokenRequest omGetDelegationTokenRequest;\n+  final private String checkResponse = \"\";\n+\n+  @Before\n+  public void setupGetDelegationToken() {\n+    secretManager = Mockito.mock(OzoneDelegationTokenSecretManager.class);\n+    when(ozoneManager.getDelegationTokenMgr()).thenReturn(secretManager);\n+    secretManager = ozoneManager.getDelegationTokenMgr();", "originalCommit": "aa498ddb06539a18d54f65f35d73f532de83f48f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc3NTc5Nw==", "url": "https://github.com/apache/ozone/pull/770#discussion_r417775797", "bodyText": "Thank you @hanishakoneru for the review.\nYes, we don't need secretManager here.\nUpdated.", "author": "cxorm", "createdAt": "2020-04-30T06:09:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3MTg0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f7b5341da109a05504813844264e2bceae059c36", "chunk": "diff --git a/hadoop-ozone/ozone-manager/src/test/java/org/apache/hadoop/ozone/om/request/security/TestOMGetDelegationTokenRequest.java b/hadoop-ozone/ozone-manager/src/test/java/org/apache/hadoop/ozone/om/request/security/TestOMGetDelegationTokenRequest.java\nindex 4211dfdae..df0fcb9fd 100644\n--- a/hadoop-ozone/ozone-manager/src/test/java/org/apache/hadoop/ozone/om/request/security/TestOMGetDelegationTokenRequest.java\n+++ b/hadoop-ozone/ozone-manager/src/test/java/org/apache/hadoop/ozone/om/request/security/TestOMGetDelegationTokenRequest.java\n\n@@ -20,7 +20,7 @@\n \n import java.io.IOException;\n import java.nio.charset.StandardCharsets;\n-import java.util.Optional;\n+import com.google.common.base.Optional;\n import java.util.UUID;\n import org.apache.hadoop.ozone.om.response.OMClientResponse;\n import org.apache.hadoop.ozone.security.OzoneDelegationTokenSecretManager;\n"}}, {"oid": "816fceb9dc12a75fb480bcf56682578890f5180d", "url": "https://github.com/apache/ozone/commit/816fceb9dc12a75fb480bcf56682578890f5180d", "message": "use interface ConfigurationSource", "committedDate": "2020-04-29T10:06:15Z", "type": "forcePushed"}, {"oid": "f7b5341da109a05504813844264e2bceae059c36", "url": "https://github.com/apache/ozone/commit/f7b5341da109a05504813844264e2bceae059c36", "message": "fix test", "committedDate": "2020-04-30T06:07:24Z", "type": "forcePushed"}, {"oid": "b6ee64653e338969312d4c7da52f16e1f1e4ab43", "url": "https://github.com/apache/ozone/commit/b6ee64653e338969312d4c7da52f16e1f1e4ab43", "message": "Add unit tests for OMGetDelegationToken Request and Response", "committedDate": "2020-04-30T20:25:26Z", "type": "commit"}, {"oid": "e1e0da7682bdcb769b68c2b6c8d991b65691919c", "url": "https://github.com/apache/ozone/commit/e1e0da7682bdcb769b68c2b6c8d991b65691919c", "message": "use interface ConfigurationSource", "committedDate": "2020-04-30T20:25:26Z", "type": "commit"}, {"oid": "6648e07693196b658b8c8809e1a5f37b6489c11f", "url": "https://github.com/apache/ozone/commit/6648e07693196b658b8c8809e1a5f37b6489c11f", "message": "fix test", "committedDate": "2020-04-30T20:25:26Z", "type": "commit"}, {"oid": "6648e07693196b658b8c8809e1a5f37b6489c11f", "url": "https://github.com/apache/ozone/commit/6648e07693196b658b8c8809e1a5f37b6489c11f", "message": "fix test", "committedDate": "2020-04-30T20:25:26Z", "type": "forcePushed"}]}