{"pr_number": 976, "pr_title": "HDDS-3672. Ozone fs failed to list intermediate directory.", "pr_createdAt": "2020-05-28T07:12:54Z", "pr_url": "https://github.com/apache/ozone/pull/976", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY2OTIzOA==", "url": "https://github.com/apache/ozone/pull/976#discussion_r431669238", "bodyText": "Thanks @ChenSammi for the analysis and the changes.\nIt looks like the \"current time\" change is not related to this, please let me know your thoughts.", "author": "rakeshadr", "createdAt": "2020-05-28T08:30:59Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/HddsUtils.java", "diffHunk": "@@ -465,11 +464,11 @@ public static ObjectName registerWithJmxProperties(\n   }\n \n   /**\n-   * Get the current UTC time in milliseconds.\n-   * @return the current UTC time in milliseconds.\n+   * Get the current time in milliseconds.\n+   * @return the current time in milliseconds.\n    */\n-  public static long getUtcTime() {\n-    return Calendar.getInstance(UTC_ZONE).getTimeInMillis();\n+  public static long getTime() {\n+    return System.currentTimeMillis();", "originalCommit": "7c0c60632c03b2fa6ef971402b6cca4efadfd98f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIzNjk0MQ==", "url": "https://github.com/apache/ozone/pull/976#discussion_r432236941", "bodyText": "It's part of another PR.  Will upload a clean patch.", "author": "ChenSammi", "createdAt": "2020-05-29T03:31:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY2OTIzOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MDQ1Ng==", "url": "https://github.com/apache/ozone/pull/976#discussion_r431670456", "bodyText": "It looks to me an opportunity to add a unit test, can we? Thanks!", "author": "rakeshadr", "createdAt": "2020-05-28T08:33:03Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyManagerImpl.java", "diffHunk": "@@ -2037,11 +2037,11 @@ private void listStatusFindKeyInTableCache(\n                 // if entry is a directory\n                 if (!deletedKeySet.contains(entryInDb)) {\n                   if (!entryKeyName.equals(immediateChild)) {\n-                    OmKeyInfo fakeDirEntry = new OmKeyInfo.Builder()\n-                        .setVolumeName(omKeyInfo.getVolumeName())\n-                        .setBucketName(omKeyInfo.getBucketName())\n-                        .setKeyName(immediateChild)\n-                        .build();\n+                    OmKeyInfo fakeDirEntry = createDirectoryKey(", "originalCommit": "7c0c60632c03b2fa6ef971402b6cca4efadfd98f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIzODI1MQ==", "url": "https://github.com/apache/ozone/pull/976#discussion_r432238251", "bodyText": "I find an easy way to reproduce the issue.  Use \"key put\" to upload an object with a path like object name, for example \"object-dir/object-name\", then use \"fs -ls\" to list the bucket.", "author": "ChenSammi", "createdAt": "2020-05-29T03:37:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MDQ1Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "873a7eb0aaf6f0259b71592a10720ebd4a140a25", "url": "https://github.com/apache/ozone/commit/873a7eb0aaf6f0259b71592a10720ebd4a140a25", "message": "HDDS-3672. Ozone fs failed to list intermiedate directory.", "committedDate": "2020-05-29T07:32:14Z", "type": "forcePushed"}, {"oid": "790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "url": "https://github.com/apache/ozone/commit/790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "message": "HDDS-3672. Ozone fs failed to list intermediate directory.", "committedDate": "2020-05-29T12:48:05Z", "type": "commit"}, {"oid": "790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "url": "https://github.com/apache/ozone/commit/790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "message": "HDDS-3672. Ozone fs failed to list intermediate directory.", "committedDate": "2020-05-29T12:48:05Z", "type": "forcePushed"}, {"oid": "608dff5fc6f46aa76447d66168d15a2911cca657", "url": "https://github.com/apache/ozone/commit/608dff5fc6f46aa76447d66168d15a2911cca657", "message": "Improve UT", "committedDate": "2020-06-01T06:31:37Z", "type": "commit"}]}