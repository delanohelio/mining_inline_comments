{"pr_number": 1034, "pr_title": "HDDS-3749. Improve OM performance with 3.7% by avoid stream.collect", "pr_createdAt": "2020-06-08T07:21:40Z", "pr_url": "https://github.com/apache/ozone/pull/1034", "timeline": [{"oid": "be8be6e2c150e5af4052c0c423e9e7a6a8a761cc", "url": "https://github.com/apache/ozone/commit/be8be6e2c150e5af4052c0c423e9e7a6a8a761cc", "message": "HDDS-3749. Improve OM performance with 3% by avoid stream.collect", "committedDate": "2020-06-08T07:29:07Z", "type": "forcePushed"}, {"oid": "be8be6e2c150e5af4052c0c423e9e7a6a8a761cc", "url": "https://github.com/apache/ozone/commit/be8be6e2c150e5af4052c0c423e9e7a6a8a761cc", "message": "HDDS-3749. Improve OM performance with 3% by avoid stream.collect", "committedDate": "2020-06-08T07:29:07Z", "type": "commit"}, {"oid": "d6cf7b12420c38bbb64f587e087fc55b8853196d", "url": "https://github.com/apache/ozone/commit/d6cf7b12420c38bbb64f587e087fc55b8853196d", "message": "triger ci", "committedDate": "2020-06-08T08:37:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI5MDI3Nw==", "url": "https://github.com/apache/ozone/pull/1034#discussion_r437290277", "bodyText": "We don't need the temporary variable memberList.\nIt can be replaced with\nfor (DatanodeDetailsProto member : pipeline.getMembersList())", "author": "nandakumar131", "createdAt": "2020-06-09T09:59:06Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/pipeline/Pipeline.java", "diffHunk": "@@ -289,14 +290,20 @@ public boolean isEmpty() {\n   public static Pipeline getFromProtobuf(HddsProtos.Pipeline pipeline)\n       throws UnknownPipelineStateException {\n     Preconditions.checkNotNull(pipeline, \"Pipeline is null\");\n+\n+    List<DatanodeDetails> nodes = new ArrayList<>();\n+    List<DatanodeDetailsProto> membersList = pipeline.getMembersList();\n+    for (DatanodeDetailsProto member : membersList) {", "originalCommit": "d6cf7b12420c38bbb64f587e087fc55b8853196d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99d4971a827f5c533058e05fbe534c42a6852448", "chunk": "diff --git a/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/pipeline/Pipeline.java b/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/pipeline/Pipeline.java\nindex f6b8b8c9d..65e8700e9 100644\n--- a/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/pipeline/Pipeline.java\n+++ b/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/pipeline/Pipeline.java\n\n@@ -292,8 +292,7 @@ public static Pipeline getFromProtobuf(HddsProtos.Pipeline pipeline)\n     Preconditions.checkNotNull(pipeline, \"Pipeline is null\");\n \n     List<DatanodeDetails> nodes = new ArrayList<>();\n-    List<DatanodeDetailsProto> membersList = pipeline.getMembersList();\n-    for (DatanodeDetailsProto member : membersList) {\n+    for (DatanodeDetailsProto member : pipeline.getMembersList()) {\n       nodes.add(DatanodeDetails.getFromProtoBuf(member));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI5MTA0NA==", "url": "https://github.com/apache/ozone/pull/1034#discussion_r437291044", "bodyText": "Temporary variable keyLocationLists can be removed.", "author": "nandakumar131", "createdAt": "2020-06-09T10:00:23Z", "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java", "diffHunk": "@@ -411,13 +415,19 @@ public static OmKeyInfo getFromProtobuf(KeyInfo keyInfo) {\n     if (keyInfo == null) {\n       return null;\n     }\n+\n+    List<OmKeyLocationInfoGroup> omKeyLocationInfos = new ArrayList<>();\n+    List<KeyLocationList> keyLocationLists = keyInfo.getKeyLocationListList();\n+    for (KeyLocationList keyLocationList : keyLocationLists) {", "originalCommit": "d6cf7b12420c38bbb64f587e087fc55b8853196d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99d4971a827f5c533058e05fbe534c42a6852448", "chunk": "diff --git a/hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java b/hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java\nindex 79a3dd61e..783089ec1 100644\n--- a/hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java\n+++ b/hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java\n\n@@ -417,8 +417,7 @@ public static OmKeyInfo getFromProtobuf(KeyInfo keyInfo) {\n     }\n \n     List<OmKeyLocationInfoGroup> omKeyLocationInfos = new ArrayList<>();\n-    List<KeyLocationList> keyLocationLists = keyInfo.getKeyLocationListList();\n-    for (KeyLocationList keyLocationList : keyLocationLists) {\n+    for (KeyLocationList keyLocationList : keyInfo.getKeyLocationListList()) {\n       omKeyLocationInfos.add(\n           OmKeyLocationInfoGroup.getFromProtobuf(keyLocationList));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI5MTMyMA==", "url": "https://github.com/apache/ozone/pull/1034#discussion_r437291320", "bodyText": "The temporary variable keyLocations  can be removed.", "author": "nandakumar131", "createdAt": "2020-06-09T10:00:50Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMKeyCommitRequest.java", "diffHunk": "@@ -132,10 +134,13 @@ public OMClientResponse validateAndUpdateCache(OzoneManager ozoneManager,\n           keyName, IAccessAuthorizer.ACLType.WRITE,\n           commitKeyRequest.getClientID());\n \n-      List<OmKeyLocationInfo> locationInfoList = commitKeyArgs\n-          .getKeyLocationsList().stream()\n-          .map(OmKeyLocationInfo::getFromProtobuf)\n-          .collect(Collectors.toList());\n+      List<OmKeyLocationInfo> locationInfoList = new ArrayList<>();\n+      List<KeyLocation> keyLocations = commitKeyArgs\n+          .getKeyLocationsList();\n+\n+      for (KeyLocation keyLocation : keyLocations) {", "originalCommit": "d6cf7b12420c38bbb64f587e087fc55b8853196d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99d4971a827f5c533058e05fbe534c42a6852448", "chunk": "diff --git a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMKeyCommitRequest.java b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMKeyCommitRequest.java\nindex fbff1fd43..63467b7ca 100644\n--- a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMKeyCommitRequest.java\n+++ b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMKeyCommitRequest.java\n\n@@ -135,10 +135,7 @@ public OMClientResponse validateAndUpdateCache(OzoneManager ozoneManager,\n           commitKeyRequest.getClientID());\n \n       List<OmKeyLocationInfo> locationInfoList = new ArrayList<>();\n-      List<KeyLocation> keyLocations = commitKeyArgs\n-          .getKeyLocationsList();\n-\n-      for (KeyLocation keyLocation : keyLocations) {\n+      for (KeyLocation keyLocation : commitKeyArgs.getKeyLocationsList()) {\n         locationInfoList.add(OmKeyLocationInfo.getFromProtobuf(keyLocation));\n       }\n \n"}}, {"oid": "99d4971a827f5c533058e05fbe534c42a6852448", "url": "https://github.com/apache/ozone/commit/99d4971a827f5c533058e05fbe534c42a6852448", "message": "fix code review", "committedDate": "2020-06-10T01:49:10Z", "type": "forcePushed"}, {"oid": "99d4971a827f5c533058e05fbe534c42a6852448", "url": "https://github.com/apache/ozone/commit/99d4971a827f5c533058e05fbe534c42a6852448", "message": "fix code review", "committedDate": "2020-06-10T01:49:10Z", "type": "commit"}]}