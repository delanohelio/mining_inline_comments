{"pr_number": 1415, "pr_title": "HDDS-4232. Use single thread for KeyDeletingService.", "pr_createdAt": "2020-09-10T11:22:29Z", "pr_url": "https://github.com/apache/ozone/pull/1415", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwMjAyNg==", "url": "https://github.com/apache/ozone/pull/1415#discussion_r486502026", "bodyText": "why not just change 2 to 1?", "author": "amaliujia", "createdAt": "2020-09-10T17:09:21Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyDeletingService.java", "diffHunk": "@@ -66,9 +66,6 @@\n   private static final Logger LOG =\n       LoggerFactory.getLogger(KeyDeletingService.class);\n \n-  // The thread pool size for key deleting service.\n-  private final static int KEY_DELETING_CORE_POOL_SIZE = 2;", "originalCommit": "e8f7b6ccf9be09edbe07d64755499336c74ffb2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwNTc5OA==", "url": "https://github.com/apache/ozone/pull/1415#discussion_r486905798", "bodyText": "Addressed it in latest commit.", "author": "lokeshj1703", "createdAt": "2020-09-11T09:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE4NTg0MQ==", "url": "https://github.com/apache/ozone/pull/1415#discussion_r487185841", "bodyText": "Thanks!", "author": "amaliujia", "createdAt": "2020-09-11T17:25:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwMjAyNg=="}], "type": "inlineReview", "revised_code": {"commit": "c140c3823cbb45f9c3bb8a7d36c7af050ce0d4cd", "chunk": "diff --git a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyDeletingService.java b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyDeletingService.java\nindex 0351bcc7a..5e466b098 100644\n--- a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyDeletingService.java\n+++ b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyDeletingService.java\n\n@@ -66,6 +66,11 @@\n   private static final Logger LOG =\n       LoggerFactory.getLogger(KeyDeletingService.class);\n \n+  // Use only a single thread for KeyDeletion. Multiple threads would read\n+  // from the same table and can send deletion requests for same key multiple\n+  // times.\n+  private final static int KEY_DELETING_CORE_POOL_SIZE = 1;\n+\n   private final OzoneManager ozoneManager;\n   private final ScmBlockLocationProtocol scmClient;\n   private final KeyManager manager;\n"}}, {"oid": "28d93f967dc86a1dbbb2488b3d450cba95acfdff", "url": "https://github.com/apache/ozone/commit/28d93f967dc86a1dbbb2488b3d450cba95acfdff", "message": "HDDS-4232. Use single thread for KeyDeletingService and OpenKeyCleanupService.", "committedDate": "2020-09-29T09:10:01Z", "type": "commit"}, {"oid": "c140c3823cbb45f9c3bb8a7d36c7af050ce0d4cd", "url": "https://github.com/apache/ozone/commit/c140c3823cbb45f9c3bb8a7d36c7af050ce0d4cd", "message": "Address review comments", "committedDate": "2020-09-29T09:10:04Z", "type": "commit"}, {"oid": "c140c3823cbb45f9c3bb8a7d36c7af050ce0d4cd", "url": "https://github.com/apache/ozone/commit/c140c3823cbb45f9c3bb8a7d36c7af050ce0d4cd", "message": "Address review comments", "committedDate": "2020-09-29T09:10:04Z", "type": "forcePushed"}]}