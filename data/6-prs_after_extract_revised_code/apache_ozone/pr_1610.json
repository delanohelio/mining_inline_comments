{"pr_number": 1610, "pr_title": "HDDS-4473. Reduce number of sortDatanodes RPC calls", "pr_createdAt": "2020-11-23T18:13:58Z", "pr_url": "https://github.com/apache/ozone/pull/1610", "timeline": [{"oid": "7a855e70268904f7e5c8cb61f206359c23f54165", "url": "https://github.com/apache/ozone/commit/7a855e70268904f7e5c8cb61f206359c23f54165", "message": "HDDS-4473. Reduce number of sortDatanodes RPC calls", "committedDate": "2020-11-19T09:37:02Z", "type": "commit"}, {"oid": "1272b064c355d3116c1937971ba428e185e2b4f5", "url": "https://github.com/apache/ozone/commit/1272b064c355d3116c1937971ba428e185e2b4f5", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4473", "committedDate": "2020-11-30T18:44:02Z", "type": "commit"}, {"oid": "cfd96934d13d53d987fa4097b549254b3a6244e3", "url": "https://github.com/apache/ozone/commit/cfd96934d13d53d987fa4097b549254b3a6244e3", "message": "Use node ID set as key for sorted pipeline cache", "committedDate": "2020-11-30T19:18:04Z", "type": "commit"}, {"oid": "457acb6974d48c780346ae4e857f2f7c2220029c", "url": "https://github.com/apache/ozone/commit/457acb6974d48c780346ae4e857f2f7c2220029c", "message": "fix checkstyle", "committedDate": "2020-11-30T21:52:48Z", "type": "commit"}, {"oid": "102a57a9b7cd1b70d3e32ca93367398a33ec0592", "url": "https://github.com/apache/ozone/commit/102a57a9b7cd1b70d3e32ca93367398a33ec0592", "message": "trigger new CI check", "committedDate": "2020-12-01T07:51:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMxMDY4Nw==", "url": "https://github.com/apache/ozone/pull/1610#discussion_r533310687", "bodyText": "Do you think it would be better to return a Set directly in toNodeUuid(...), rather than return a list and then create a set from it? Its a tiny optimisation but I don't think we really need the intermediate list - its just used in the log message later and we can probably just use \"nodes\" rather than nodeList in the log as it was before.", "author": "sodonnel", "createdAt": "2020-12-01T10:43:48Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyManagerImpl.java", "diffHunk": "@@ -2322,21 +2322,22 @@ void sortDatanodes(String clientMachine, OmKeyInfo... keyInfos) {\n         }\n         for (OmKeyLocationInfo k : key.getLocationList()) {\n           Pipeline pipeline = k.getPipeline();\n-          PipelineID pipelineId = pipeline.getId();\n-          List<DatanodeDetails> sortedNodes = sortedPipelines.get(pipelineId);\n+          List<DatanodeDetails> nodes = pipeline.getNodes();\n+          List<String> uuidList = toNodeUuid(nodes);\n+          Set<String> uuidSet = new HashSet<>(uuidList);", "originalCommit": "cfd96934d13d53d987fa4097b549254b3a6244e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyMzgwOA==", "url": "https://github.com/apache/ozone/pull/1610#discussion_r533323808", "bodyText": "I tried that first.  The problem is we'd need to return a sorted set (for setting up reproducible expectations in unit tests), which somewhat goes against the goal of optimization.", "author": "adoroszlai", "createdAt": "2020-12-01T11:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMxMDY4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzMzU4Ng==", "url": "https://github.com/apache/ozone/pull/1610#discussion_r533333586", "bodyText": "OK - thanks for the explanation. We can keep it how it is then.", "author": "sodonnel", "createdAt": "2020-12-01T11:21:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMxMDY4Nw=="}], "type": "inlineReview", "revised_code": null}]}