{"pr_number": 718, "pr_title": "HDDS-3224. Enforce volume and bucket name rule at create time.", "pr_createdAt": "2020-03-24T21:16:23Z", "pr_url": "https://github.com/apache/ozone/pull/718", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4MjA4OQ==", "url": "https://github.com/apache/ozone/pull/718#discussion_r397482089", "bodyText": "For write requests, this code is no more used.\nThese changes need to be done in OMBucketcreateRequest#preExecute and OMVolumeCreateRequest#preExecute and the same thing needs to be done in S3BucketCreateRequest", "author": "bharatviswa504", "createdAt": "2020-03-24T21:48:10Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java", "diffHunk": "@@ -1894,10 +1896,12 @@ private void checkAdmin() throws OMException {\n   @Override\n   public void createBucket(OmBucketInfo bucketInfo) throws IOException {\n     try {\n-      if(isAclEnabled) {\n+      if (isAclEnabled) {\n         checkAcls(ResourceType.VOLUME, StoreType.OZONE, ACLType.CREATE,\n             bucketInfo.getVolumeName(), bucketInfo.getBucketName(), null);\n       }\n+      HddsClientUtils.verifyResourceName(bucketInfo.getVolumeName(),", "originalCommit": "7ec191001e7e9f45320ef25d29a4b7bf60b0a581", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4NDM5MA==", "url": "https://github.com/apache/ozone/pull/718#discussion_r397484390", "bodyText": "And if illegal, verifyResourceName throws IllegalArgumentException, here we need to catch this, and return proper error code to the client here.", "author": "bharatviswa504", "createdAt": "2020-03-24T21:53:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4MjA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYxMzM2NQ==", "url": "https://github.com/apache/ozone/pull/718#discussion_r397613365", "bodyText": "Added the checks at suggested sites.", "author": "swagle", "createdAt": "2020-03-25T05:13:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4MjA4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "70764f3e490284fd83fc52bf2c3ffed37cfe8ff3", "chunk": "diff --git a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java\nindex 34e3a925c..0c036bc74 100644\n--- a/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java\n+++ b/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java\n\n@@ -1896,12 +1894,10 @@ private void checkAdmin() throws OMException {\n   @Override\n   public void createBucket(OmBucketInfo bucketInfo) throws IOException {\n     try {\n-      if (isAclEnabled) {\n+      if(isAclEnabled) {\n         checkAcls(ResourceType.VOLUME, StoreType.OZONE, ACLType.CREATE,\n             bucketInfo.getVolumeName(), bucketInfo.getBucketName(), null);\n       }\n-      HddsClientUtils.verifyResourceName(bucketInfo.getVolumeName(),\n-          bucketInfo.getBucketName());\n       metrics.incNumBucketCreates();\n       bucketManager.createBucket(bucketInfo);\n       AUDIT.logWriteSuccess(buildAuditMessageForSuccess(OMAction.CREATE_BUCKET,\n"}}, {"oid": "70764f3e490284fd83fc52bf2c3ffed37cfe8ff3", "url": "https://github.com/apache/ozone/commit/70764f3e490284fd83fc52bf2c3ffed37cfe8ff3", "message": "Checkstyle fix.", "committedDate": "2020-03-30T22:55:48Z", "type": "forcePushed"}, {"oid": "40fb5328be711e07df287e991848b158b8e95eec", "url": "https://github.com/apache/ozone/commit/40fb5328be711e07df287e991848b158b8e95eec", "message": "HDDS-3224. Enforce volume and bucket name rule at create time.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "b0ef030c2a83866d6b725a3573c582e225f489b4", "url": "https://github.com/apache/ozone/commit/b0ef030c2a83866d6b725a3573c582e225f489b4", "message": "Addressed review, comments, still kept original changes since code path is reachable.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "7e0dd29e8c99495c1eae5eb1c992af321d1fa7bc", "url": "https://github.com/apache/ozone/commit/7e0dd29e8c99495c1eae5eb1c992af321d1fa7bc", "message": "Addressed review comments.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "6b76587ffcc644b11f8054d9d3c250ab69248bfc", "url": "https://github.com/apache/ozone/commit/6b76587ffcc644b11f8054d9d3c250ab69248bfc", "message": "Checkstyle fixes.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "dbaa634b73b4175649818e3f95f99d6d0db7b404", "url": "https://github.com/apache/ozone/commit/dbaa634b73b4175649818e3f95f99d6d0db7b404", "message": "Changes missed to S3BucketCreateRequest.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "b43350364e778c3d5f7e07f20dcf7c374260c596", "url": "https://github.com/apache/ozone/commit/b43350364e778c3d5f7e07f20dcf7c374260c596", "message": "Checkstyle fix.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "fd56dd8710e91f70d0256106286e6397c1de2d30", "url": "https://github.com/apache/ozone/commit/fd56dd8710e91f70d0256106286e6397c1de2d30", "message": "Robot test chnages to fix volume name.", "committedDate": "2020-04-01T06:30:23Z", "type": "commit"}, {"oid": "fd56dd8710e91f70d0256106286e6397c1de2d30", "url": "https://github.com/apache/ozone/commit/fd56dd8710e91f70d0256106286e6397c1de2d30", "message": "Robot test chnages to fix volume name.", "committedDate": "2020-04-01T06:30:23Z", "type": "forcePushed"}, {"oid": "9c8e841c63e4f89041ba2494138b74de3215708f", "url": "https://github.com/apache/ozone/commit/9c8e841c63e4f89041ba2494138b74de3215708f", "message": "Change to url in config.", "committedDate": "2020-04-01T18:45:07Z", "type": "commit"}, {"oid": "17d8a68df484c552ebcb039221f1a9b36f80be60", "url": "https://github.com/apache/ozone/commit/17d8a68df484c552ebcb039221f1a9b36f80be60", "message": "Addressed review comment.", "committedDate": "2020-04-01T18:47:01Z", "type": "commit"}, {"oid": "cdc11077ff4790f0a81488e3d6c2552245143f84", "url": "https://github.com/apache/ozone/commit/cdc11077ff4790f0a81488e3d6c2552245143f84", "message": "Merge remote-tracking branch 'origin/master' into HEAD", "committedDate": "2020-04-03T14:40:28Z", "type": "commit"}, {"oid": "43a3caa0f5bd7bf4e1caa6abbb651cd99e13110f", "url": "https://github.com/apache/ozone/commit/43a3caa0f5bd7bf4e1caa6abbb651cd99e13110f", "message": "retrigger build with empty commit", "committedDate": "2020-04-03T14:40:30Z", "type": "commit"}]}