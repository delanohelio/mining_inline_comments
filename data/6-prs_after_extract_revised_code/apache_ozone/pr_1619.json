{"pr_number": 1619, "pr_title": "HDDS-4503. Provide info on block size via FileSystem", "pr_createdAt": "2020-11-24T12:46:12Z", "pr_url": "https://github.com/apache/ozone/pull/1619", "timeline": [{"oid": "98a0226cfece3d5aba290a0f922c270c59371119", "url": "https://github.com/apache/ozone/commit/98a0226cfece3d5aba290a0f922c270c59371119", "message": "HDDS-4503. Provide info on block size via FileSystem", "committedDate": "2020-11-24T09:24:30Z", "type": "commit"}, {"oid": "4f3bc3400be51a84d176a6802706b8affb575381", "url": "https://github.com/apache/ozone/commit/4f3bc3400be51a84d176a6802706b8affb575381", "message": "trigger new CI check", "committedDate": "2020-11-24T10:43:16Z", "type": "commit"}, {"oid": "2d5a3715fce203de51621d2d2588daf4e6584e04", "url": "https://github.com/apache/ozone/commit/2d5a3715fce203de51621d2d2588daf4e6584e04", "message": "trigger new CI check", "committedDate": "2020-11-24T11:41:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYyMDI1Mg==", "url": "https://github.com/apache/ozone/pull/1619#discussion_r529620252", "bodyText": "Is this block size used by client while writing? In create and createNonRecursive it tends to ignore the specified block size.\nSo, if it isn't correct, Isn't it same as not implementing it? FileSystem will anyway return some value, that can be tweaked as well by fs.local.block.size", "author": "ayushtkn", "createdAt": "2020-11-24T15:12:03Z", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicRootedOzoneFileSystem.java", "diffHunk": "@@ -723,6 +726,12 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n     return mkdir(f);\n   }\n \n+  @Override\n+  public long getDefaultBlockSize() {\n+    return (long) getConf().getStorageSize(\n+        OZONE_SCM_BLOCK_SIZE, OZONE_SCM_BLOCK_SIZE_DEFAULT, StorageUnit.BYTES);", "originalCommit": "2d5a3715fce203de51621d2d2588daf4e6584e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc1ODMwNw==", "url": "https://github.com/apache/ozone/pull/1619#discussion_r529758307", "bodyText": "In create and createNonRecursive it tends to ignore the specified block size.\n\nOzone also ignores it and uses uniform block size on server side (configurable via this OZONE_SCM_BLOCK_SIZE property).\n\ncan be tweaked as well by fs.local.block.size\n\nYou are right, we could achieve the same result by forcing this config to the same value as SCM block size.  I think it's simpler and cleaner to override the method than to keep the config in sync.", "author": "adoroszlai", "createdAt": "2020-11-24T17:36:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYyMDI1Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f1d723b85adee356d7175edb78fdf9e0ce8a3f0f", "url": "https://github.com/apache/ozone/commit/f1d723b85adee356d7175edb78fdf9e0ce8a3f0f", "message": "trigger new CI check", "committedDate": "2020-11-24T17:40:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg3OTYxOA==", "url": "https://github.com/apache/ozone/pull/1619#discussion_r529879618", "bodyText": "What if the client who wrote the block and the client who is querying have a different configuration?", "author": "arp7", "createdAt": "2020-11-24T21:10:18Z", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -698,6 +701,12 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n     return mkdir(f);\n   }\n \n+  @Override\n+  public long getDefaultBlockSize() {\n+    return (long) getConf().getStorageSize(\n+        OZONE_SCM_BLOCK_SIZE, OZONE_SCM_BLOCK_SIZE_DEFAULT, StorageUnit.BYTES);", "originalCommit": "f1d723b85adee356d7175edb78fdf9e0ce8a3f0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDEzNDgxOA==", "url": "https://github.com/apache/ozone/pull/1619#discussion_r530134818", "bodyText": "This is intended to be used by the client that creates the file.  Once the file is closed, the actual block size can be queried via getBlockSize(Path).  Currently getDefaultBlockSize() returns 32MB, regardless of SCM config:\nhttps://github.com/apache/hadoop/blob/a6df05bf5e24d04852a35b096c44e79f843f4776/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java#L2521-L2522", "author": "adoroszlai", "createdAt": "2020-11-25T06:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg3OTYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NzYwMg==", "url": "https://github.com/apache/ozone/pull/1619#discussion_r541547602", "bodyText": "Thanks @arp7 for taking a look.  Does the above answer your question, or would you like further clarification?", "author": "adoroszlai", "createdAt": "2020-12-12T10:14:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg3OTYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTY0ODg5Nw==", "url": "https://github.com/apache/ozone/pull/1619#discussion_r541648897", "bodyText": "Yes, thanks. Sorry i missed responding.", "author": "arp7", "createdAt": "2020-12-12T16:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg3OTYxOA=="}], "type": "inlineReview", "revised_code": null}]}