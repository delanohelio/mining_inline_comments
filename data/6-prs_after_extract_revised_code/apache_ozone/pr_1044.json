{"pr_number": 1044, "pr_title": "HDDS-3743. Avoid NetUtils#normalize when get DatanodeDetails from proto", "pr_createdAt": "2020-06-09T13:53:56Z", "pr_url": "https://github.com/apache/ozone/pull/1044", "timeline": [{"oid": "fc153266ff92c796d4e75a7ef6323a2c0e72f90c", "url": "https://github.com/apache/ozone/commit/fc153266ff92c796d4e75a7ef6323a2c0e72f90c", "message": "HDDS-3743. Avoid NetUtils.normalize when get DatanodeDetails from proto", "committedDate": "2020-06-09T13:51:19Z", "type": "commit"}, {"oid": "255453b98362b584620447ce16ff582b44f55a94", "url": "https://github.com/apache/ozone/commit/255453b98362b584620447ce16ff582b44f55a94", "message": "triger ci", "committedDate": "2020-06-10T02:37:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0OTAyMw==", "url": "https://github.com/apache/ozone/pull/1044#discussion_r439149023", "bodyText": "Can we simplified the logic without any matcher by using apache common StringUtils?\nreturn len == 1 ? path : StringUtils.removeEnd(path, \"/\");", "author": "xiaoyuyao", "createdAt": "2020-06-12T00:44:46Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/net/NetUtils.java", "diffHunk": "@@ -59,9 +64,12 @@ public static String normalize(String path) {\n               + NetConstants.PATH_SEPARATOR_STR + \": \" + path);\n     }\n \n+    if (len == 1 || path.charAt(len - 1) != NetConstants.PATH_SEPARATOR) {", "originalCommit": "255453b98362b584620447ce16ff582b44f55a94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1MTU5NQ==", "url": "https://github.com/apache/ozone/pull/1044#discussion_r439151595", "bodyText": "@xiaoyuyao Thanks for review. But the result of  StringUtils.removeEnd(\"/a/b/c//\", \"/\") is \"/a/b/c/\" instead of \"/a/b/c\". I'm not sure whether we should consider the path end with multiple \"/\".", "author": "runzhiwang", "createdAt": "2020-06-12T00:54:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0OTAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4OTE0OQ==", "url": "https://github.com/apache/ozone/pull/1044#discussion_r439589149", "bodyText": "You are correct. The node to location mapping is provided by script or mapping file configured and parsed by implementation of DNSToSwitchMapping. The script should usually normalize the path already. Otherwise,\nthe mapping can't  be used consistently for the topology class to determine node locations.\nE.g., multiple slash: \"///\" => \"\"\nmultiple slash in the middle \"/a//b/c/\" => \"/a//b/c\" which is not equal to \"/a/b/c\", etc.", "author": "xiaoyuyao", "createdAt": "2020-06-12T18:50:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0OTAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxMjk1NA==", "url": "https://github.com/apache/ozone/pull/1044#discussion_r439812954", "bodyText": "@xiaoyuyao Thanks for review. Updated.", "author": "runzhiwang", "createdAt": "2020-06-14T10:07:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0OTAyMw=="}], "type": "inlineReview", "revised_code": {"commit": "19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "chunk": "diff --git a/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/net/NetUtils.java b/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/net/NetUtils.java\nindex 043bf0612..69bfed96f 100644\n--- a/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/net/NetUtils.java\n+++ b/hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/net/NetUtils.java\n\n@@ -64,12 +65,9 @@ public static String normalize(String path) {\n               + NetConstants.PATH_SEPARATOR_STR + \": \" + path);\n     }\n \n-    if (len == 1 || path.charAt(len - 1) != NetConstants.PATH_SEPARATOR) {\n-      return path;\n-    }\n-\n     // Remove any trailing NetConstants.PATH_SEPARATOR\n-    return TRAILING_PATH_SEPARATOR.matcher(path).replaceAll(\"\");\n+    return len == 1 ? path : StringUtils.removeEnd(path,\n+        NetConstants.PATH_SEPARATOR_STR);\n   }\n \n   /**\n"}}, {"oid": "19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "url": "https://github.com/apache/ozone/commit/19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "message": "fix code review", "committedDate": "2020-06-14T06:41:19Z", "type": "forcePushed"}, {"oid": "19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "url": "https://github.com/apache/ozone/commit/19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "message": "fix code review", "committedDate": "2020-06-14T06:41:19Z", "type": "commit"}]}