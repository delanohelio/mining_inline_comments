{"pr_number": 1623, "pr_title": "HDDS-4508. Add total container count to SCMContainerMetrics", "pr_createdAt": "2020-11-25T06:51:57Z", "pr_url": "https://github.com/apache/ozone/pull/1623", "timeline": [{"oid": "cf2de4410e0c2437516a8c65faadf702ccc51e4e", "url": "https://github.com/apache/ozone/commit/cf2de4410e0c2437516a8c65faadf702ccc51e4e", "message": "HDDS-4508. Add total container count to SCMContainerMetrics", "committedDate": "2020-11-25T06:49:05Z", "type": "commit"}, {"oid": "383b0e419d22d00f89e57ac7d07e40e901785648", "url": "https://github.com/apache/ozone/commit/383b0e419d22d00f89e57ac7d07e40e901785648", "message": "Trigger new CI check", "committedDate": "2020-11-25T07:04:06Z", "type": "commit"}, {"oid": "9a68ce5bf6ac31426f116768bada86bbd633ab19", "url": "https://github.com/apache/ozone/commit/9a68ce5bf6ac31426f116768bada86bbd633ab19", "message": "Modify format", "committedDate": "2020-11-25T07:27:56Z", "type": "commit"}, {"oid": "34a75c17fc3a27316975b9b0f4aa689ef2e224ad", "url": "https://github.com/apache/ozone/commit/34a75c17fc3a27316975b9b0f4aa689ef2e224ad", "message": "Modify format", "committedDate": "2020-11-25T07:31:06Z", "type": "commit"}, {"oid": "a38c4f1214fca463b03b1eb62ed4cc7b22bc39a1", "url": "https://github.com/apache/ozone/commit/a38c4f1214fca463b03b1eb62ed4cc7b22bc39a1", "message": "Modify format", "committedDate": "2020-11-26T01:53:59Z", "type": "commit"}, {"oid": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c", "url": "https://github.com/apache/ozone/commit/0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c", "message": "Trigger new CI check", "committedDate": "2020-11-26T03:06:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NDcwMA==", "url": "https://github.com/apache/ozone/pull/1623#discussion_r541544700", "bodyText": "This does not seem to be required, as total is a calculated value.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    put(HddsProtos.LifeCycleState.TOTAL.toString(), 27);", "author": "adoroszlai", "createdAt": "2020-12-12T09:55:47Z", "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java", "diffHunk": "@@ -50,6 +50,7 @@ public void testSCMContainerMetrics() {\n         put(HddsProtos.LifeCycleState.CLOSED.toString(), 5);\n         put(HddsProtos.LifeCycleState.DELETING.toString(), 6);\n         put(HddsProtos.LifeCycleState.DELETED.toString(), 7);\n+        put(HddsProtos.LifeCycleState.TOTAL.toString(), 27);", "originalCommit": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "00ce444266c8cf9bcfb092255f1e9299a41139f3", "chunk": "diff --git a/hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java b/hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java\nindex ab385a40d..2a2bcbaa6 100644\n--- a/hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java\n+++ b/hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java\n\n@@ -50,7 +50,6 @@ public void testSCMContainerMetrics() {\n         put(HddsProtos.LifeCycleState.CLOSED.toString(), 5);\n         put(HddsProtos.LifeCycleState.DELETING.toString(), 6);\n         put(HddsProtos.LifeCycleState.DELETED.toString(), 7);\n-        put(HddsProtos.LifeCycleState.TOTAL.toString(), 27);\n       }};\n \n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NTY3NQ==", "url": "https://github.com/apache/ozone/pull/1623#discussion_r541545675", "bodyText": "Nit: Can this be converted to a loop over all states summing individual values?  That way if a new state is introduced, no further change in counting totals will be required.", "author": "adoroszlai", "createdAt": "2020-12-12T10:01:52Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java", "diffHunk": "@@ -84,6 +84,14 @@ public void getMetrics(MetricsCollector collector, boolean all) {\n             stateCount.get(DELETING.toString()))\n         .addGauge(Interns.info(\"DeletedContainers\",\n             \"Number of containers in deleted state\"),\n+            stateCount.get(DELETED.toString()))\n+        .addGauge(Interns.info(\"TotalContainers\",\n+            \"Number of all containers\"),\n+          stateCount.get(OPEN.toString())+\n+            stateCount.get(CLOSING.toString())+\n+            stateCount.get(QUASI_CLOSED.toString())+\n+            stateCount.get(CLOSED.toString())+\n+            stateCount.get(DELETING.toString())+", "originalCommit": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk3NjUyNA==", "url": "https://github.com/apache/ozone/pull/1623#discussion_r543976524", "bodyText": "Thanks @adoroszlai  for the suggestion,I tried to modify it.", "author": "sky76093016", "createdAt": "2020-12-16T05:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NTY3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "00ce444266c8cf9bcfb092255f1e9299a41139f3", "chunk": "diff --git a/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java b/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java\nindex 14adb6f9a..bc8c6019e 100644\n--- a/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java\n+++ b/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java\n\n@@ -87,11 +93,6 @@ public void getMetrics(MetricsCollector collector, boolean all) {\n             stateCount.get(DELETED.toString()))\n         .addGauge(Interns.info(\"TotalContainers\",\n             \"Number of all containers\"),\n-          stateCount.get(OPEN.toString())+\n-            stateCount.get(CLOSING.toString())+\n-            stateCount.get(QUASI_CLOSED.toString())+\n-            stateCount.get(CLOSED.toString())+\n-            stateCount.get(DELETING.toString())+\n-            stateCount.get(DELETED.toString()));\n+            TotalContainers);\n   }\n }\n"}}, {"oid": "00ce444266c8cf9bcfb092255f1e9299a41139f3", "url": "https://github.com/apache/ozone/commit/00ce444266c8cf9bcfb092255f1e9299a41139f3", "message": "Modify the total method", "committedDate": "2020-12-16T05:26:15Z", "type": "commit"}, {"oid": "d91af7ff3c4da126549c27dfb488777b1e39263d", "url": "https://github.com/apache/ozone/commit/d91af7ff3c4da126549c27dfb488777b1e39263d", "message": "Checkstyle", "committedDate": "2020-12-16T06:57:05Z", "type": "commit"}]}