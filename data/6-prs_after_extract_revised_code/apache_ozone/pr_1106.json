{"pr_number": 1106, "pr_title": "HDDS-2413. Set configuration variables from annotated java objects", "pr_createdAt": "2020-06-22T14:37:07Z", "pr_url": "https://github.com/apache/ozone/pull/1106", "timeline": [{"oid": "f630533881d70f89c279d7ea47a1e1dda8a96f1b", "url": "https://github.com/apache/ozone/commit/f630533881d70f89c279d7ea47a1e1dda8a96f1b", "message": "HDDS-2413. Set configuration variables from annotated java objects", "committedDate": "2020-06-22T10:48:43Z", "type": "commit"}, {"oid": "2f6d9f36e22f006d0fc7e25f0e84cae4a81eb5ed", "url": "https://github.com/apache/ozone/commit/2f6d9f36e22f006d0fc7e25f0e84cae4a81eb5ed", "message": "trigger new CI check", "committedDate": "2020-06-22T13:12:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMDc4Ng==", "url": "https://github.com/apache/ozone/pull/1106#discussion_r447520786", "bodyText": "I really don't like the approach when the current port number (after using :0) is added to the configuration. It's easier if the configuration is immutable after loading.\nI understand that the immutable is not possible with this injection and I accept that it's necessary.\nOne possible approach is to introduce two interfaces: ConfigSource (read-only) and ConfigDestination (write only). OzoneConfiguration can implement both. But there could be a specific ConfigSource (eg. EnvironmentVariableConfigSource) which would be read only.\nBut I am fine with committing this patch as is, but interested about opinion.\nAlso: it seems to be useful for testing to introduce an OzoneConfiguration.fromAnnotatedObject() method.", "author": "elek", "createdAt": "2020-06-30T08:50:44Z", "path": "hadoop-hdds/config/src/main/java/org/apache/hadoop/hdds/conf/ConfigurationSource.java", "diffHunk": "@@ -37,9 +39,6 @@\n \n   char[] getPassword(String key) throws IOException;\n \n-  @Deprecated", "originalCommit": "2f6d9f36e22f006d0fc7e25f0e84cae4a81eb5ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0NTAwMQ==", "url": "https://github.com/apache/ozone/pull/1106#discussion_r448345001", "bodyText": "One possible approach is to introduce two interfaces: ConfigSource (read-only) and ConfigDestination (write only). OzoneConfiguration can implement both.\n\nThanks @elek for the suggestion.  I was considering this, but needed this nudge to implement it.", "author": "adoroszlai", "createdAt": "2020-07-01T12:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMDc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ5MDk3NQ==", "url": "https://github.com/apache/ozone/pull/1106#discussion_r448490975", "bodyText": "I was considering this, but needed this nudge to implement it.\n\nOh, I see why. It makes the patch bigger because we use this dirty hack to store the port in the config.", "author": "elek", "createdAt": "2020-07-01T16:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMDc4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b2efa0884b1e1bcce0880f0188a765fc52e13bb0", "chunk": "diff --git a/hadoop-hdds/config/src/main/java/org/apache/hadoop/hdds/conf/ConfigurationSource.java b/hadoop-hdds/config/src/main/java/org/apache/hadoop/hdds/conf/ConfigurationSource.java\nindex e0ce20bb1..9f4d87964 100644\n--- a/hadoop-hdds/config/src/main/java/org/apache/hadoop/hdds/conf/ConfigurationSource.java\n+++ b/hadoop-hdds/config/src/main/java/org/apache/hadoop/hdds/conf/ConfigurationSource.java\n\n@@ -39,8 +37,6 @@\n \n   char[] getPassword(String key) throws IOException;\n \n-  void set(String key, String value);\n-\n   default String get(String key, String defaultValue) {\n     String value = get(key);\n     return value != null ? value : defaultValue;\n"}}, {"oid": "b2efa0884b1e1bcce0880f0188a765fc52e13bb0", "url": "https://github.com/apache/ozone/commit/b2efa0884b1e1bcce0880f0188a765fc52e13bb0", "message": "HDDS-2413. Extract ConfigurationTarget interface", "committedDate": "2020-07-01T09:31:37Z", "type": "commit"}, {"oid": "10b19019303c88699c45f20dad93e8bb6aaa8e27", "url": "https://github.com/apache/ozone/commit/10b19019303c88699c45f20dad93e8bb6aaa8e27", "message": "HDDS-2413. Helper method for config object creation", "committedDate": "2020-07-01T09:31:37Z", "type": "commit"}, {"oid": "12511c42a48a2bd85e055dd460cb770617377d93", "url": "https://github.com/apache/ozone/commit/12511c42a48a2bd85e055dd460cb770617377d93", "message": "HDDS-2413. Remove useless config object creation", "committedDate": "2020-07-01T09:31:37Z", "type": "commit"}, {"oid": "32f5fddebb98b18b51a52a1e41f58a215f08f1b0", "url": "https://github.com/apache/ozone/commit/32f5fddebb98b18b51a52a1e41f58a215f08f1b0", "message": "HDDS-2413. Use type-safe DatanodeRatisServerConfig for test settings", "committedDate": "2020-07-01T09:31:37Z", "type": "commit"}, {"oid": "a5a259bb2ad2d96c0a99d0b3b366959c3f711594", "url": "https://github.com/apache/ozone/commit/a5a259bb2ad2d96c0a99d0b3b366959c3f711594", "message": "HDDS-2413. Use type-safe ReconSqlDbConfig in tests", "committedDate": "2020-07-01T09:53:21Z", "type": "commit"}, {"oid": "250f35858facef53aedd38d169484f9e4f659a6e", "url": "https://github.com/apache/ozone/commit/250f35858facef53aedd38d169484f9e4f659a6e", "message": "HDDS-2413. Get rid of unnecessary OzoneConfiguration.of", "committedDate": "2020-07-01T11:21:26Z", "type": "commit"}, {"oid": "573868d385caaa1ddbfe5703204a784ba01ae747", "url": "https://github.com/apache/ozone/commit/573868d385caaa1ddbfe5703204a784ba01ae747", "message": "HDDS-2413. Use type-safe RocksDBConfiguration in tests", "committedDate": "2020-07-01T11:21:26Z", "type": "commit"}, {"oid": "ee3d1f7fd8b73986d538b90b901e2246ddeea08e", "url": "https://github.com/apache/ozone/commit/ee3d1f7fd8b73986d538b90b901e2246ddeea08e", "message": "HDDS-2413. Use type-safe ReplicationManagerConfiguration in tests", "committedDate": "2020-07-01T11:21:26Z", "type": "commit"}, {"oid": "badac1d03e834cf64d2b55e9e1d8df804aeb7bb0", "url": "https://github.com/apache/ozone/commit/badac1d03e834cf64d2b55e9e1d8df804aeb7bb0", "message": "HDDS-2413. Use type-safe ReconTaskConfig in tests", "committedDate": "2020-07-01T11:21:26Z", "type": "commit"}, {"oid": "0c9c5a6b7393e7b8442489d69789f5098a888fad", "url": "https://github.com/apache/ozone/commit/0c9c5a6b7393e7b8442489d69789f5098a888fad", "message": "Merge remote-tracking branch 'origin/master' into HDDS-2413", "committedDate": "2020-07-01T11:49:05Z", "type": "commit"}, {"oid": "8b997f2fec2b26745e0dc07cf34227a4246dbf94", "url": "https://github.com/apache/ozone/commit/8b997f2fec2b26745e0dc07cf34227a4246dbf94", "message": "Merge remote-tracking branch 'origin/master' into HDDS-2413", "committedDate": "2020-07-01T12:49:19Z", "type": "commit"}, {"oid": "809a1e28665a8b0d92b481fb09811178f84d4a3b", "url": "https://github.com/apache/ozone/commit/809a1e28665a8b0d92b481fb09811178f84d4a3b", "message": "HDDS-2413. One more instance of DatanodeRatisServerConfig", "committedDate": "2020-07-01T12:53:51Z", "type": "commit"}]}