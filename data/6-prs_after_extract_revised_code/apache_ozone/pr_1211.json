{"pr_number": 1211, "pr_title": "HDDS-3969. Add validName check for FileSystem requests", "pr_createdAt": "2020-07-16T23:04:17Z", "pr_url": "https://github.com/apache/ozone/pull/1211", "timeline": [{"oid": "3500bd84b503988b98663714ddb7bb841fdd6d9f", "url": "https://github.com/apache/ozone/commit/3500bd84b503988b98663714ddb7bb841fdd6d9f", "message": "HDDS-3969. Add validName check for FileSystem requests", "committedDate": "2020-07-16T23:02:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIwNjI5Mg==", "url": "https://github.com/apache/ozone/pull/1211#discussion_r456206292", "bodyText": "Can we just do this here, instead of toUri().getPath() again?\n   LOG.trace(\"path for key:{} is:{}\", key, path); return key.substring(1);", "author": "avijayanhwx", "createdAt": "2020-07-17T04:04:22Z", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -721,7 +723,13 @@ public String pathToKey(Path path) {\n       path = new Path(workingDir, path);\n     }\n     // removing leading '/' char\n-    String key = path.toUri().getPath().substring(1);\n+    String key = path.toUri().getPath();\n+\n+    if (OzoneFSUtils.isValidName(key)) {\n+      key = path.toUri().getPath().substring(1);", "originalCommit": "3500bd84b503988b98663714ddb7bb841fdd6d9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIxMDQ3NQ==", "url": "https://github.com/apache/ozone/pull/1211#discussion_r456210475", "bodyText": "Done.", "author": "bharatviswa504", "createdAt": "2020-07-17T04:23:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIwNjI5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "56ff7ef73fa971150a5b0e37f4f03fc32051b868", "chunk": "diff --git a/hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java b/hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java\nindex 39f3e93129..d4a1d4a8d5 100644\n--- a/hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java\n+++ b/hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java\n\n@@ -726,12 +726,12 @@ public String pathToKey(Path path) {\n     String key = path.toUri().getPath();\n \n     if (OzoneFSUtils.isValidName(key)) {\n-      key = path.toUri().getPath().substring(1);\n+      key = path.toUri().getPath();\n     } else {\n       throw new InvalidPathException(\"Invalid path Name\" + key);\n     }\n     LOG.trace(\"path for key:{} is:{}\", key, path);\n-    return key;\n+    return key.substring(1);\n   }\n \n   /**\n"}}, {"oid": "56ff7ef73fa971150a5b0e37f4f03fc32051b868", "url": "https://github.com/apache/ozone/commit/56ff7ef73fa971150a5b0e37f4f03fc32051b868", "message": "checkstyle and review comments", "committedDate": "2020-07-17T04:23:13Z", "type": "commit"}]}