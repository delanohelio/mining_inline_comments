{"pr_number": 3882, "pr_title": "Allow enchants on fireworks/charges/potions/banners", "pr_createdAt": "2020-12-28T16:29:27Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3882", "timeline": [{"oid": "c5b836283354ac1348e831744301a4a3aeae5243", "url": "https://github.com/EssentialsX/Essentials/commit/c5b836283354ac1348e831744301a4a3aeae5243", "message": "Enchant potions and fireworks too", "committedDate": "2020-12-28T16:05:36Z", "type": "commit"}, {"oid": "0e327df20ec37e7fe35ec0d6aea6b5d33a76b77b", "url": "https://github.com/EssentialsX/Essentials/commit/0e327df20ec37e7fe35ec0d6aea6b5d33a76b77b", "message": "Skip meta if enchantment is found", "committedDate": "2020-12-30T08:21:37Z", "type": "commit"}, {"oid": "0886de6d15ba0ede5b7c4913e6f773472a8997e5", "url": "https://github.com/EssentialsX/Essentials/commit/0886de6d15ba0ede5b7c4913e6f773472a8997e5", "message": "Fix power check\n\nI have to stop coding at night", "committedDate": "2021-01-01T10:00:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDYzMTI4NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3882#discussion_r554631284", "bodyText": "Why the check for power? It isn't required in the firework meta", "author": "JRoy", "createdAt": "2021-01-10T22:19:58Z", "path": "Essentials/src/main/java/com/earth2me/essentials/MetaItemStack.java", "diffHunk": "@@ -226,28 +226,25 @@ public void addStringMeta(final CommandSource sender, final boolean allowUnsafe,\n             final BookMeta meta = (BookMeta) stack.getItemMeta();\n             meta.setTitle(title);\n             stack.setItemMeta(meta);\n-        } else if (split.length > 1 && split[0].equalsIgnoreCase(\"power\") && MaterialUtil.isFirework(stack.getType()) && hasMetaPermission(sender, \"firework-power\", false, true, ess)) {\n-            final int power = NumberUtil.isInt(split[1]) ? Integer.parseInt(split[1]) : 0;\n-            final FireworkMeta meta = (FireworkMeta) stack.getItemMeta();\n-            meta.setPower(power > 3 ? 4 : power);\n-            stack.setItemMeta(meta);\n         } else if (split.length > 1 && split[0].equalsIgnoreCase(\"itemflags\") && hasMetaPermission(sender, \"itemflags\", false, true, ess)) {\n             addItemFlags(string);\n         } else if (MaterialUtil.isFirework(stack.getType())) {\n-            //WARNING - Meta for fireworks will be ignored after this point.\n-            addFireworkMeta(sender, false, string, ess);\n+            if (split[0].equalsIgnoreCase(\"power\") || !parseEnchantmentStrings(sender, allowUnsafe, split, ess)) {", "originalCommit": "0886de6d15ba0ede5b7c4913e6f773472a8997e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTIyMTEzNQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3882#discussion_r555221135", "bodyText": "Moved lines 229-233 to addFireworkMeta method, so it is required now", "author": "imDaniX", "createdAt": "2021-01-11T17:33:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDYzMTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMwMTUxOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3882#discussion_r555301518", "bodyText": "It shouldn't be though? We don't need the full meta to create a valid firework", "author": "JRoy", "createdAt": "2021-01-11T19:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDYzMTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM1NTM2Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3882#discussion_r555355366", "bodyText": "This change does not affect the creation of fireworks, but rather makes it more consistent - this is the only action that belongs to fireworks meta, but isn't included in the method.\nI might be just stupid, but I really see no reason for it not to be there", "author": "imDaniX", "createdAt": "2021-01-11T21:36:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDYzMTI4NA=="}], "type": "inlineReview", "revised_code": {"commit": "248f5915fd81510f8ad0374bbbadef33c72970ce", "chunk": "diff --git a/Essentials/src/main/java/com/earth2me/essentials/MetaItemStack.java b/Essentials/src/main/java/com/earth2me/essentials/MetaItemStack.java\nindex 73b194c00..4bce62cf9 100644\n--- a/Essentials/src/main/java/com/earth2me/essentials/MetaItemStack.java\n+++ b/Essentials/src/main/java/com/earth2me/essentials/MetaItemStack.java\n\n@@ -226,10 +226,15 @@ public class MetaItemStack {\n             final BookMeta meta = (BookMeta) stack.getItemMeta();\n             meta.setTitle(title);\n             stack.setItemMeta(meta);\n+        } else if (split.length > 1 && split[0].equalsIgnoreCase(\"power\") && MaterialUtil.isFirework(stack.getType()) && hasMetaPermission(sender, \"firework-power\", false, true, ess)) {\n+            final int power = NumberUtil.isInt(split[1]) ? Integer.parseInt(split[1]) : 0;\n+            final FireworkMeta meta = (FireworkMeta) stack.getItemMeta();\n+            meta.setPower(power > 3 ? 4 : power);\n+            stack.setItemMeta(meta);\n         } else if (split.length > 1 && split[0].equalsIgnoreCase(\"itemflags\") && hasMetaPermission(sender, \"itemflags\", false, true, ess)) {\n             addItemFlags(string);\n         } else if (MaterialUtil.isFirework(stack.getType())) {\n-            if (split[0].equalsIgnoreCase(\"power\") || !parseEnchantmentStrings(sender, allowUnsafe, split, ess)) {\n+            if (!parseEnchantmentStrings(sender, allowUnsafe, split, ess)) {\n                 //WARNING - Meta for fireworks will be ignored after this point.\n                 addFireworkMeta(sender, false, string, ess);\n             }\n"}}, {"oid": "248f5915fd81510f8ad0374bbbadef33c72970ce", "url": "https://github.com/EssentialsX/Essentials/commit/248f5915fd81510f8ad0374bbbadef33c72970ce", "message": "Revert moving power meta into addFireworkMeta method", "committedDate": "2021-01-19T20:12:06Z", "type": "commit"}, {"oid": "a91ba70207beeefe0d47ffd441767e3b7a572abd", "url": "https://github.com/EssentialsX/Essentials/commit/a91ba70207beeefe0d47ffd441767e3b7a572abd", "message": "Merge '2.x' into fix-enchantments", "committedDate": "2021-01-19T20:52:15Z", "type": "commit"}, {"oid": "94aa01bad8e1886b70c620e8a78a9f9c2818c63e", "url": "https://github.com/EssentialsX/Essentials/commit/94aa01bad8e1886b70c620e8a78a9f9c2818c63e", "message": "Merge branch '2.x' into fix-enchantments", "committedDate": "2021-06-11T15:09:08Z", "type": "commit"}]}