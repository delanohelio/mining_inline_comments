{"pr_number": 3616, "pr_title": "Fix miscellaneous command permission bugs", "pr_createdAt": "2020-08-22T17:56:41Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3616", "timeline": [{"oid": "f76e6c165ebd8547825d89c47d426483afe3c67a", "url": "https://github.com/EssentialsX/Essentials/commit/f76e6c165ebd8547825d89c47d426483afe3c67a", "message": "Fix #3612", "committedDate": "2020-08-22T17:46:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNTc3NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3616#discussion_r475115774", "bodyText": "Merging these loops almost certainly result in incorrect behavior, as the command will be able to fail while also being able to partially update the requested worlds, and then also not providing feedback to the user for what worlds were changed.", "author": "pop4959", "createdAt": "2020-08-22T18:08:28Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandtime.java", "diffHunk": "@@ -64,14 +64,16 @@ public void run(final Server server, final CommandSource sender, final String co\n \n         // Start updating world times, we have what we need\n         User user = ess.getUser(sender.getPlayer());\n+        if (!user.isAuthorized(\"essentials.time.set\")) {\n+            throw new Exception(tl(\"timeSetPermission\"));\n+        }\n+\n+        final StringJoiner joiner = new StringJoiner(\",\");\n         for (World world : worlds) {\n             if (!canUpdateWorld(user, world)) {\n                 throw new Exception(tl(\"timeSetWorldPermission\", user.getWorld().getName()));\n             }\n-        }\n \n-        final StringJoiner joiner = new StringJoiner(\",\");\n-        for (World world : worlds) {", "originalCommit": "9e9a8118af347eb9085c495ad0475c196560f12e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNTg3Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3616#discussion_r475115877", "bodyText": "that explains why i didn't do it, lemme fix", "author": "JRoy", "createdAt": "2020-08-22T18:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNTc3NA=="}], "type": "inlineReview", "revised_code": {"commit": "a7371968467fb99588450ad02c3a35236962f4fc", "chunk": "diff --git a/Essentials/src/com/earth2me/essentials/commands/Commandtime.java b/Essentials/src/com/earth2me/essentials/commands/Commandtime.java\nindex 8ea755385..6ad87415d 100644\n--- a/Essentials/src/com/earth2me/essentials/commands/Commandtime.java\n+++ b/Essentials/src/com/earth2me/essentials/commands/Commandtime.java\n\n@@ -68,12 +68,14 @@ public class Commandtime extends EssentialsCommand {\n             throw new Exception(tl(\"timeSetPermission\"));\n         }\n \n-        final StringJoiner joiner = new StringJoiner(\",\");\n         for (World world : worlds) {\n             if (!canUpdateWorld(user, world)) {\n                 throw new Exception(tl(\"timeSetWorldPermission\", user.getWorld().getName()));\n             }\n+        }\n \n+        final StringJoiner joiner = new StringJoiner(\",\");\n+        for (World world : worlds) {\n             long time = world.getTime();\n             if (!add) {\n                 time -= time % 24000;\n"}}, {"oid": "a7371968467fb99588450ad02c3a35236962f4fc", "url": "https://github.com/EssentialsX/Essentials/commit/a7371968467fb99588450ad02c3a35236962f4fc", "message": "Fix #3613", "committedDate": "2020-08-22T18:10:58Z", "type": "commit"}, {"oid": "a7371968467fb99588450ad02c3a35236962f4fc", "url": "https://github.com/EssentialsX/Essentials/commit/a7371968467fb99588450ad02c3a35236962f4fc", "message": "Fix #3613", "committedDate": "2020-08-22T18:10:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNjE5NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3616#discussion_r475116194", "bodyText": "This is only used in /list; we could probably just move this to Commandlist.", "author": "mdcfe", "createdAt": "2020-08-22T18:13:30Z", "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsCommand.java", "diffHunk": "@@ -285,9 +285,9 @@ private static boolean canInteractWith(User interactor, User interactee) {\n     /**\n      * Returns a list of all online groups.\n      */\n-    protected List<String> getGroups() {\n+    protected List<String> getGroups(CommandSource interactor) {", "originalCommit": "a7371968467fb99588450ad02c3a35236962f4fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNjQ4Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3616#discussion_r475116482", "bodyText": "cool and good", "author": "JRoy", "createdAt": "2020-08-22T18:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNjE5NA=="}], "type": "inlineReview", "revised_code": {"commit": "5472cac7b74cc6c85a51ae858aa79a77c0b0b563", "chunk": "diff --git a/Essentials/src/com/earth2me/essentials/commands/EssentialsCommand.java b/Essentials/src/com/earth2me/essentials/commands/EssentialsCommand.java\nindex 49f9beb17..c2c950f96 100644\n--- a/Essentials/src/com/earth2me/essentials/commands/EssentialsCommand.java\n+++ b/Essentials/src/com/earth2me/essentials/commands/EssentialsCommand.java\n\n@@ -282,14 +280,6 @@ public abstract class EssentialsCommand implements IEssentialsCommand {\n         return players;\n     }\n \n-    /**\n-     * Returns a list of all online groups.\n-     */\n-    protected List<String> getGroups(CommandSource interactor) {\n-        // TODO: A better way to do this\n-        return new ArrayList<>(PlayerList.getPlayerLists(ess, interactor.getUser(ess), true).keySet());\n-    }\n-\n     /**\n      * Gets a list of tab-completable items that start with the given name.\n      * Due to the number of items, this may not return the entire list.\n"}}, {"oid": "5472cac7b74cc6c85a51ae858aa79a77c0b0b563", "url": "https://github.com/EssentialsX/Essentials/commit/5472cac7b74cc6c85a51ae858aa79a77c0b0b563", "message": "Move getGroups from EssentialsCommand to Commandlist", "committedDate": "2020-08-22T18:16:29Z", "type": "commit"}]}