{"pr_number": 3715, "pr_title": "Fix /clear <player> <item> not clearing offhand", "pr_createdAt": "2020-10-08T07:48:24Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3715", "timeline": [{"oid": "1811f12430e69bc2503f6e7b25e357084f4fe152", "url": "https://github.com/EssentialsX/Essentials/commit/1811f12430e69bc2503f6e7b25e357084f4fe152", "message": "Fixed /clear command in the second hand for additional parameters :p", "committedDate": "2020-10-08T07:27:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxNzc5Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r501517792", "bodyText": "This if will always return true, therefore making no need for it", "author": "l1ttleO", "createdAt": "2020-10-08T07:53:47Z", "path": "Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java", "diffHunk": "@@ -267,4 +263,22 @@ public static void setItemInOffHand(final Player p, final ItemStack item) {\n             }\n         }\n     }\n+\n+    public static int clearItemInOffHand(final Player p, final ItemStack item) {\n+        if (hasMainHandSupport == null || hasMainHandSupport) {", "originalCommit": "1811f12430e69bc2503f6e7b25e357084f4fe152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fa430f704e850a900cd51baae16f384c758e80c1", "chunk": "diff --git a/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java b/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\nindex 8eaadffbd..05fe03e7e 100644\n--- a/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\n+++ b/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\n\n@@ -265,20 +269,14 @@ public final class InventoryWorkaround {\n     }\n \n     public static int clearItemInOffHand(final Player p, final ItemStack item) {\n-        if (hasMainHandSupport == null || hasMainHandSupport) {\n-            try {\n-                int removedAmount = 0;\n-                if (p.getInventory().getItemInOffHand().getType().equals(item.getType())) {\n-                    removedAmount = p.getInventory().getItemInOffHand().getAmount();\n-                    p.getInventory().setItemInOffHand(null);\n-                }\n-                hasMainHandSupport = true;\n-                return removedAmount;\n-            } catch (final Throwable e) {\n-                hasMainHandSupport = false;\n-                return 0;\n+        if (hasMainHandSupport) {\n+            int removedAmount = 0;\n+            if (p.getInventory().getItemInOffHand().getType().equals(item.getType())) {\n+                removedAmount = p.getInventory().getItemInOffHand().getAmount();\n+                p.getInventory().setItemInOffHand(null);\n             }\n+            hasMainHandSupport = true;\n+            return removedAmount;\n         }\n-        return 0;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxODYzOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r501518638", "bodyText": "Don't make changes that aren't associated with your PR", "author": "l1ttleO", "createdAt": "2020-10-08T07:55:11Z", "path": "Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java", "diffHunk": "@@ -12,10 +12,6 @@\n import java.util.HashMap;\n import java.util.Map;\n \n-/*\n- * This class can be removed when https://github.com/Bukkit/CraftBukkit/pull/193 is accepted to CraftBukkit\n- */\n-", "originalCommit": "1811f12430e69bc2503f6e7b25e357084f4fe152", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fa430f704e850a900cd51baae16f384c758e80c1", "chunk": "diff --git a/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java b/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\nindex 8eaadffbd..05fe03e7e 100644\n--- a/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\n+++ b/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\n\n@@ -12,6 +12,10 @@ import java.util.Arrays;\n import java.util.HashMap;\n import java.util.Map;\n \n+/*\n+ * This class can be removed when https://github.com/Bukkit/CraftBukkit/pull/193 is accepted to CraftBukkit\n+ */\n+\n public final class InventoryWorkaround {\n     /*\n     Spigot 1.9, for whatever reason, decided to merge the armor and main player inventories without providing a way\n"}}, {"oid": "fa430f704e850a900cd51baae16f384c758e80c1", "url": "https://github.com/EssentialsX/Essentials/commit/fa430f704e850a900cd51baae16f384c758e80c1", "message": "Fixed the if always returning true. Added back the message in InventoryWorkaround.", "committedDate": "2020-10-08T08:18:49Z", "type": "commit"}, {"oid": "d071ea7081eaf117287b25b5bddb6d07731ea8ea", "url": "https://github.com/EssentialsX/Essentials/commit/d071ea7081eaf117287b25b5bddb6d07731ea8ea", "message": "Forgot to add the return statement. Added it.", "committedDate": "2020-10-08T08:23:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2ODg4Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r501868886", "bodyText": "This is redundant?", "author": "mdcfe", "createdAt": "2020-10-08T16:53:10Z", "path": "Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java", "diffHunk": "@@ -267,4 +267,17 @@ public static void setItemInOffHand(final Player p, final ItemStack item) {\n             }\n         }\n     }\n+\n+    public static int clearItemInOffHand(final Player p, final ItemStack item) {\n+        if (hasMainHandSupport) {\n+            int removedAmount = 0;\n+            if (p.getInventory().getItemInOffHand().getType().equals(item.getType())) {\n+                removedAmount = p.getInventory().getItemInOffHand().getAmount();\n+                p.getInventory().setItemInOffHand(null);\n+            }\n+            hasMainHandSupport = true;", "originalCommit": "d071ea7081eaf117287b25b5bddb6d07731ea8ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA3NDMwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r502074300", "bodyText": "Forgot to remove that when I removed hasMainHandSupport == null. Will fix.", "author": "Kenichycmd", "createdAt": "2020-10-08T23:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2ODg4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "3b220f0d5f60c0f924f9fe0630087105282f6132", "chunk": "diff --git a/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java b/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\nindex cf2950ab1..2abe5e24d 100644\n--- a/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\n+++ b/Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java\n\n@@ -269,14 +269,19 @@ public final class InventoryWorkaround {\n     }\n \n     public static int clearItemInOffHand(final Player p, final ItemStack item) {\n-        if (hasMainHandSupport) {\n-            int removedAmount = 0;\n-            if (p.getInventory().getItemInOffHand().getType().equals(item.getType())) {\n-                removedAmount = p.getInventory().getItemInOffHand().getAmount();\n-                p.getInventory().setItemInOffHand(null);\n+        // This should be added because if `/clear` itself is not initilized it will return an Error: null.\n+        if (hasMainHandSupport == null || hasMainHandSupport) {\n+            try {\n+                int removedAmount = 0;\n+                if (p.getInventory().getItemInOffHand().getType().equals(item.getType())) {\n+                    removedAmount = p.getInventory().getItemInOffHand().getAmount();\n+                    p.getInventory().setItemInOffHand(null);\n+                }\n+                hasMainHandSupport = true;\n+                return removedAmount;\n+            } catch (final Throwable e) {\n+                hasMainHandSupport = false;\n             }\n-            hasMainHandSupport = true;\n-            return removedAmount;\n         }\n         return 0;\n     }\n"}}, {"oid": "3b220f0d5f60c0f924f9fe0630087105282f6132", "url": "https://github.com/EssentialsX/Essentials/commit/3b220f0d5f60c0f924f9fe0630087105282f6132", "message": "Added a config for the offhand slot + bug fixes.", "committedDate": "2020-10-10T00:35:08Z", "type": "commit"}, {"oid": "25492cf87c2c4f93263c05442aa76272fee6c992", "url": "https://github.com/EssentialsX/Essentials/commit/25492cf87c2c4f93263c05442aa76272fee6c992", "message": "Fixed config error and also added a notice to clear-offhand-slot.", "committedDate": "2020-10-13T06:21:34Z", "type": "commit"}, {"oid": "bb4e8159145b6b168bd0f4ca51450acc9f17ac58", "url": "https://github.com/EssentialsX/Essentials/commit/bb4e8159145b6b168bd0f4ca51450acc9f17ac58", "message": "Removed Config for the Clear Command.", "committedDate": "2020-10-13T08:11:17Z", "type": "commit"}, {"oid": "7852ee6b12b6163179ddf76586ea4cb510a3322c", "url": "https://github.com/EssentialsX/Essentials/commit/7852ee6b12b6163179ddf76586ea4cb510a3322c", "message": "Undo unnecessary formatting change", "committedDate": "2020-11-09T16:41:16Z", "type": "commit"}]}