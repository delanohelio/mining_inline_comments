{"pr_number": 8759, "pr_title": "SAK-42266 lessons > add open date to assignment links which are not yet open", "pr_createdAt": "2020-10-30T15:56:03Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8759", "timeline": [{"oid": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c", "url": "https://github.com/sakaiproject/sakai/commit/ee1c82d7f24f54cd145ff768ff969d72a4f6265c", "message": "SAK-42266 lessons > add open date to assignment links which are not yet open", "committedDate": "2020-10-30T15:54:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIwMzY4MA==", "url": "https://github.com/sakaiproject/sakai/pull/8759#discussion_r515203680", "bodyText": "Perhaps there's a better way to do this in Lessons code? I'm not sure. I found this comment and code earlier in the file:\n\t\t    // assignments won't let us get the entity if we're not in the group, so set up permissions before other tests\n\t\t\tif (usable && i.isPrerequisite()) {\n\t\t\t    simplePageBean.checkItemPermissions(i, true);\n\t\t\t}\n\nHowever if I call this method in the location here, nothing changes and I still get a permission exception in AssignmentEntity when trying to resolve the entity to access the open date.", "author": "bjones86", "createdAt": "2020-10-30T15:57:26Z", "path": "lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ShowPageProducer.java", "diffHunk": "@@ -4004,7 +4006,19 @@ protected static boolean makeLink(UIContainer container, String ID, SimplePageIt\n \n \t\tif (fake) {\n \t\t\tID = ID + \"-fake\";\n-\t\t\tUIOutput link = UIOutput.make(container, ID, i.getName());\n+\t\t\tString linkText = i.getName();\n+\t\t\tif (i.getType() == SimplePageItem.ASSIGNMENT) {\n+\t\t\t\tSecurityAdvisor yesMan = (String arg0, String arg1, String agr2) -> SecurityAdvisor.SecurityAdvice.ALLOWED;\n+\t\t\t\tsecurityService.pushAdvisor(yesMan);\n+\t\t\t\ttry {\n+\t\t\t\t\tAssignmentEntity assignment = (AssignmentEntity) assignmentEntity.getEntity(i.getSakaiId(), simplePageBean);\n+\t\t\t\t\tlinkText += \" \" + messageLocator.getMessage(\"simplepage.assignment.open_date\", new Object[] {assignment.getOpenDate()});\n+\t\t\t\t} catch (Exception ex) {}\n+\t\t\t\tfinally {\n+\t\t\t\t\tsecurityService.popAdvisor(yesMan);\n+\t\t\t\t}\n+\t\t\t}", "originalCommit": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}