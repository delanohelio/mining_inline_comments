{"pr_number": 7772, "pr_title": "SAK-43008 round consistently using BigDecimal", "pr_createdAt": "2020-01-15T15:49:25Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/7772", "timeline": [{"oid": "9ac834f027e193fd11c88132d026bfc8d8f842a4", "url": "https://github.com/sakaiproject/sakai/commit/9ac834f027e193fd11c88132d026bfc8d8f842a4", "message": "SAK-43008 round consistently using BigDecimal", "committedDate": "2020-01-15T15:48:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk2NjAzOA==", "url": "https://github.com/sakaiproject/sakai/pull/7772#discussion_r366966038", "bodyText": "Doesn't look like dfParse is used any more.", "author": "adrianfish", "createdAt": "2020-01-15T16:12:17Z", "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java", "diffHunk": "@@ -183,14 +190,14 @@ public static String formatGradeForDisplay(final String grade) {\n \t\ttry {\n \t\t\tfinal DecimalFormat dfParse = (DecimalFormat) NumberFormat.getInstance(Locale.ROOT);", "originalCommit": "9ac834f027e193fd11c88132d026bfc8d8f842a4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "10657b8f486b72094b78d9760e49901cf16dd9c5", "chunk": "diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java\nindex d0d47b6b78..1214790035 100644\n--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java\n+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java\n\n@@ -188,8 +188,6 @@ public class FormatHelper {\n \n \t\tString s;\n \t\ttry {\n-\t\t\tfinal DecimalFormat dfParse = (DecimalFormat) NumberFormat.getInstance(Locale.ROOT);\n-\t\t\tdfParse.setParseBigDecimal(true);\n \t\t\tfinal BigDecimal d = convertStringToBigDecimal(grade, 2);\n \n \t\t\tfinal DecimalFormat dfFormat = (DecimalFormat) NumberFormat.getInstance(rl.getLocale());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk2NjM4Mg==", "url": "https://github.com/sakaiproject/sakai/pull/7772#discussion_r366966382", "bodyText": "I'd up this to a warn", "author": "adrianfish", "createdAt": "2020-01-15T16:12:54Z", "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java", "diffHunk": "@@ -183,14 +190,14 @@ public static String formatGradeForDisplay(final String grade) {\n \t\ttry {\n \t\t\tfinal DecimalFormat dfParse = (DecimalFormat) NumberFormat.getInstance(Locale.ROOT);\n \t\t\tdfParse.setParseBigDecimal(true);\n-\t\t\tfinal BigDecimal d = (BigDecimal) dfParse.parse(grade);\n+\t\t\tfinal BigDecimal d = convertStringToBigDecimal(grade, 2);\n \n \t\t\tfinal DecimalFormat dfFormat = (DecimalFormat) NumberFormat.getInstance(rl.getLocale());\n \t\t\tdfFormat.setMinimumFractionDigits(0);\n \t\t\tdfFormat.setMaximumFractionDigits(2);\n \t\t\tdfFormat.setGroupingUsed(true);\n \t\t\ts = dfFormat.format(d);\n-\t\t} catch (final NumberFormatException | ParseException e) {\n+\t\t} catch (final NumberFormatException e) {\n \t\t\tlog.debug(\"Bad format, returning original string: {}\", grade);", "originalCommit": "9ac834f027e193fd11c88132d026bfc8d8f842a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA0OTE3Nw==", "url": "https://github.com/sakaiproject/sakai/pull/7772#discussion_r367049177", "bodyText": "Thanks changes made", "author": "ottenhoff", "createdAt": "2020-01-15T18:56:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk2NjM4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "10657b8f486b72094b78d9760e49901cf16dd9c5", "chunk": "diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java\nindex d0d47b6b78..1214790035 100644\n--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java\n+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java\n\n@@ -188,8 +188,6 @@ public class FormatHelper {\n \n \t\tString s;\n \t\ttry {\n-\t\t\tfinal DecimalFormat dfParse = (DecimalFormat) NumberFormat.getInstance(Locale.ROOT);\n-\t\t\tdfParse.setParseBigDecimal(true);\n \t\t\tfinal BigDecimal d = convertStringToBigDecimal(grade, 2);\n \n \t\t\tfinal DecimalFormat dfFormat = (DecimalFormat) NumberFormat.getInstance(rl.getLocale());\n"}}, {"oid": "10657b8f486b72094b78d9760e49901cf16dd9c5", "url": "https://github.com/sakaiproject/sakai/commit/10657b8f486b72094b78d9760e49901cf16dd9c5", "message": "SAK-43008 Adrian suggestions", "committedDate": "2020-01-15T18:56:14Z", "type": "commit"}]}