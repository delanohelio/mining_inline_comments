{"pr_number": 7875, "pr_title": "SAK-43118 Remove timezone from signup meeting dates.", "pr_createdAt": "2020-02-11T13:13:49Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/7875", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377653845", "bodyText": "a custom format doesn't seem right to me...... why doesn't the DateFormat above work?", "author": "ottenhoff", "createdAt": "2020-02-11T14:05:59Z", "path": "signup/tool/src/java/org/sakaiproject/signup/tool/jsf/UserLocale.java", "diffHunk": "@@ -34,39 +39,49 @@\n  * @author Peter Liu\n  */\n \n+@Slf4j\n public class UserLocale {\n \n \tprivate ResourceLoader rb = new ResourceLoader(\"messages\");\n-\tprivate SakaiFacade sakaiFacade;\n+\n+\t@Getter @Setter private SakaiFacade sakaiFacade;\n \n \tpublic String getLocale() {\n \t\treturn (String) this.rb.getLocale().toString();\n \t}\n-\n-\tpublic SakaiFacade getSakaiFacade() {\n-\t\treturn sakaiFacade;\n-\t}\n-\n-\tpublic void setSakaiFacade(SakaiFacade sakaiFacade) {\n-\t\tthis.sakaiFacade = sakaiFacade;\n-\t}\n \t\n \t/**\n \t * Get the date format from the locale\n \t * @return\n \t */\n \tpublic String getDateFormat() {\n-\t\tDateFormat df = DateFormat.getDateInstance(DateFormat.SHORT, (new ResourceLoader()).getLocale());\n-\t\treturn ((SimpleDateFormat)df).toPattern();\n+\n+\t\tLocale locale = new ResourceLoader().getLocale();\n+\t\tDateFormat df = DateFormat.getDateInstance(DateFormat.SHORT, locale);\n+\t\ttry {\n+\t\t\treturn ((SimpleDateFormat)df).toPattern();\n+\t\t} catch (ClassCastException cce) {\n+\t\t\tlog.warn(\"Failed to cast DateFormat into SimpleDateFormat for locale {}\", locale.toString());\n+\t\t\treturn new SimpleDateFormat().toPattern();\n+\t\t}\n \t}\n \n \t/**\n-\t * Get the date format from the locale with short timezone at end\n+\t * Get the date format from the locale\n \t * @return String representing a SimpleDateFormat for use with JSF convertDateTime\n \t */\n \tpublic String getFullDateTimeFormat() {\n-\t\tDateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG, this.rb.getLocale());\n-\t\treturn ((SimpleDateFormat)df).toPattern();\n+\n+\t\tLocale locale = this.rb.getLocale();\n+\t\tDateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.SHORT, locale);\n+\t\ttry {\n+\t\t\tSimpleDateFormat sdf = (SimpleDateFormat) df;\n+\t\t\tsdf.applyLocalizedPattern(\"MMMM d, yyyy h:mm a\");", "originalCommit": "338a04fef82489784cee170fef5ba6215e3375e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1ODk1NA==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377658954", "bodyText": "It ships the default full format, with timezone. And you can't merge pattern changes.", "author": "adrianfish", "createdAt": "2020-02-11T14:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1OTc4Ng==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377659786", "bodyText": "If you look at the docs for DateFormat, it explains that if you want to change the default, you have to cast to a SimpleDateFormat and customise.", "author": "adrianfish", "createdAt": "2020-02-11T14:16:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY2MDQ3MA==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377660470", "bodyText": "You can tune DateFormat to a degree, by using SHORT, MEDIUM, LONG etc, but that's all.", "author": "adrianfish", "createdAt": "2020-02-11T14:17:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY2NTg1Ng==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377665856", "bodyText": "Still just seems more preferable to use a pre-defined format. For example, in your format, \"a\" means am/pm, right?\nSo let's just use MEDIUM instead of LONG to avoid timezone", "author": "ottenhoff", "createdAt": "2020-02-11T14:26:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc4MjMyNw==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377782327", "bodyText": "Then you lose am pm", "author": "adrianfish", "createdAt": "2020-02-11T17:23:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc4MjY4Mw==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377782683", "bodyText": "I thought you'd be able to merge formats, like, just merge am pm into MEDIUM", "author": "adrianfish", "createdAt": "2020-02-11T17:23:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc4NDEwNw==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r377784107", "bodyText": "Sweden doesn't want am/pm. They want 24 hr time", "author": "ottenhoff", "createdAt": "2020-02-11T17:25:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE2MDYzNg==", "url": "https://github.com/sakaiproject/sakai/pull/7875#discussion_r378160636", "bodyText": "SHORT was actually the one to go for, for the time component. I've tested in Swedish, and PST, and this PR fixes that bunch of Signup timezone tickets.", "author": "adrianfish", "createdAt": "2020-02-12T10:23:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1Mzg0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "812e7af3ff7a03ad96355ac130746527e1c86493", "chunk": "diff --git a/signup/tool/src/java/org/sakaiproject/signup/tool/jsf/UserLocale.java b/signup/tool/src/java/org/sakaiproject/signup/tool/jsf/UserLocale.java\nindex 60aa306fa0..f38cd1521b 100644\n--- a/signup/tool/src/java/org/sakaiproject/signup/tool/jsf/UserLocale.java\n+++ b/signup/tool/src/java/org/sakaiproject/signup/tool/jsf/UserLocale.java\n\n@@ -75,9 +74,7 @@ public class UserLocale {\n \t\tLocale locale = this.rb.getLocale();\n \t\tDateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.SHORT, locale);\n \t\ttry {\n-\t\t\tSimpleDateFormat sdf = (SimpleDateFormat) df;\n-\t\t\tsdf.applyLocalizedPattern(\"MMMM d, yyyy h:mm a\");\n-\t\t\treturn sdf.toPattern();\n+\t\t\treturn ((SimpleDateFormat) df).toPattern();\n \t\t} catch (ClassCastException cce) {\n \t\t\tlog.warn(\"Failed to cast DateFormat into SimpleDateFormat for locale {}\", locale.toString());\n \t\t\treturn new SimpleDateFormat().toPattern();\n"}}, {"oid": "812e7af3ff7a03ad96355ac130746527e1c86493", "url": "https://github.com/sakaiproject/sakai/commit/812e7af3ff7a03ad96355ac130746527e1c86493", "message": "SAK-43118 Remove timezone from signup meeting dates.\n\nhttps://jira.sakaiproject.org/browse/SAK-43118", "committedDate": "2020-02-12T10:20:53Z", "type": "commit"}, {"oid": "812e7af3ff7a03ad96355ac130746527e1c86493", "url": "https://github.com/sakaiproject/sakai/commit/812e7af3ff7a03ad96355ac130746527e1c86493", "message": "SAK-43118 Remove timezone from signup meeting dates.\n\nhttps://jira.sakaiproject.org/browse/SAK-43118", "committedDate": "2020-02-12T10:20:53Z", "type": "forcePushed"}]}