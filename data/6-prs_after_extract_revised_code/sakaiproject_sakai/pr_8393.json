{"pr_number": 8393, "pr_title": "SAK-43936 - Gradebook: no points validation when editing a Gradebook \u2026", "pr_createdAt": "2020-07-26T20:15:39Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8393", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg5NjIyOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8393#discussion_r460896229", "bodyText": "can you return the validatedName from your helper function instead? is that cleaner?", "author": "ottenhoff", "createdAt": "2020-07-27T13:39:27Z", "path": "edu-services/gradebook-service/impl/src/java/org/sakaiproject/component/gradebook/GradebookServiceHibernateImpl.java", "diffHunk": "@@ -614,29 +614,27 @@ public Object doInHibernate(final Session session) throws HibernateException {\n \n \t}\n \n+\n \t@Override\n \tpublic Long addAssignment(final String gradebookUid, final org.sakaiproject.service.gradebook.shared.Assignment assignmentDefinition) {\n \t\tif (!getAuthz().isUserAbleToEditAssessments(gradebookUid)) {\n \t\t\tlog.error(\"AUTHORIZATION FAILURE: User {} in gradebook {} attempted to add an assignment\", getUserUid(), gradebookUid);\n \t\t\tthrow new GradebookSecurityException();\n \t\t}\n \n-\t\t// Ensure that points is > zero.\n-\t\tfinal Double points = assignmentDefinition.getPoints();\n-\t\tif ((points == null) || (points <= 0)) {\n-\t\t\tthrow new AssignmentHasIllegalPointsException(\"Points must be > 0\");\n-\t\t}\n+\t\tGradebookHelper.validateAssignmentNameAndPoints(assignmentDefinition);\n \n \t\tfinal Gradebook gradebook = getGradebook(gradebookUid);\n+\t\tfinal String validatedName = StringUtils.trimToNull(assignmentDefinition.getName());", "originalCommit": "0678c69b4d6206a97ada9e11bc883b0debde9ac2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMwMjY2Mg==", "url": "https://github.com/sakaiproject/sakai/pull/8393#discussion_r468302662", "bodyText": "I rewrote both of these methods to return the validatedName based on this suggestion. Eliminated about 20 lines of code.", "author": "jonespm", "createdAt": "2020-08-11T03:17:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg5NjIyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "bd2bf30921a4c686a2abedf57dfae4d85a5f8033", "chunk": "diff --git a/edu-services/gradebook-service/impl/src/java/org/sakaiproject/component/gradebook/GradebookServiceHibernateImpl.java b/edu-services/gradebook-service/impl/src/java/org/sakaiproject/component/gradebook/GradebookServiceHibernateImpl.java\nindex 5b0c819282..2e39ea1f60 100644\n--- a/edu-services/gradebook-service/impl/src/java/org/sakaiproject/component/gradebook/GradebookServiceHibernateImpl.java\n+++ b/edu-services/gradebook-service/impl/src/java/org/sakaiproject/component/gradebook/GradebookServiceHibernateImpl.java\n\n@@ -622,10 +622,9 @@ public class GradebookServiceHibernateImpl extends BaseHibernateManager implemen\n \t\t\tthrow new GradebookSecurityException();\n \t\t}\n \n-\t\tGradebookHelper.validateAssignmentNameAndPoints(assignmentDefinition);\n+\t\tfinal String validatedName = GradebookHelper.validateAssignmentNameAndPoints(assignmentDefinition);\n \n \t\tfinal Gradebook gradebook = getGradebook(gradebookUid);\n-\t\tfinal String validatedName = StringUtils.trimToNull(assignmentDefinition.getName());\n \n \t\t// if attaching to category\n \t\tif (assignmentDefinition.getCategoryId() != null) {\n"}}, {"oid": "470668827caca1be16c4159f26ef0b7d55b2ddf7", "url": "https://github.com/sakaiproject/sakai/commit/470668827caca1be16c4159f26ef0b7d55b2ddf7", "message": "SAK-43936 - Gradebook: no points validation when editing a Gradebook Item", "committedDate": "2020-08-11T01:31:41Z", "type": "commit"}, {"oid": "470668827caca1be16c4159f26ef0b7d55b2ddf7", "url": "https://github.com/sakaiproject/sakai/commit/470668827caca1be16c4159f26ef0b7d55b2ddf7", "message": "SAK-43936 - Gradebook: no points validation when editing a Gradebook Item", "committedDate": "2020-08-11T01:31:41Z", "type": "forcePushed"}, {"oid": "bd2bf30921a4c686a2abedf57dfae4d85a5f8033", "url": "https://github.com/sakaiproject/sakai/commit/bd2bf30921a4c686a2abedf57dfae4d85a5f8033", "message": "Some simplifactions based on comments from @ottenhoff\n\nReturn the validated name if valid, otherwise an exception.", "committedDate": "2020-08-11T02:24:19Z", "type": "commit"}, {"oid": "200501ed822e113f66df23278ee3b0eeada2f37c", "url": "https://github.com/sakaiproject/sakai/commit/200501ed822e113f66df23278ee3b0eeada2f37c", "message": "tabs", "committedDate": "2020-08-11T13:40:05Z", "type": "commit"}, {"oid": "dff7244c611716d867d1204a9c60cbc67c785a9f", "url": "https://github.com/sakaiproject/sakai/commit/dff7244c611716d867d1204a9c60cbc67c785a9f", "message": "tab", "committedDate": "2020-08-11T13:40:56Z", "type": "commit"}]}