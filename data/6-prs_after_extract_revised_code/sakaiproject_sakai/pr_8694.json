{"pr_number": 8694, "pr_title": "SAK-44466 Ensure we get a non null locale from preferences", "pr_createdAt": "2020-10-15T14:50:15Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8694", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505609283", "bodyText": "Should this be using the agent?", "author": "ern", "createdAt": "2020-10-15T14:54:26Z", "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/DeliveryActionListener.java", "diffHunk": "@@ -138,8 +140,8 @@ public void processAction(ActionEvent ae) throws\n       // 1. get managed bean\n       DeliveryBean delivery = (DeliveryBean) ContextUtil.lookupBean(\"delivery\");\n \n-      delivery.setLocale(preferencesService.getLocale(AgentFacade.getAgentString()));\n-      \n+      delivery.setLocale(preferencesService.getLocale(userDirectoryService.getCurrentUser().getId()));", "originalCommit": "6c2daaba1d4beb209d004084fa22622ad2d73cd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxMDcxNw==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505610717", "bodyText": "Why? The locale is brand new in the bean, and it's used to render stuff in the user's language. Shouldn't that be okay?", "author": "adrianfish", "createdAt": "2020-10-15T14:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxMTI1MA==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505611250", "bodyText": "because the rest of the logic in that method is using it!", "author": "ern", "createdAt": "2020-10-15T14:56:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxNDgyNw==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505614827", "bodyText": "I used agent in the first place, just because it was there already.", "author": "adrianfish", "createdAt": "2020-10-15T15:00:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYyMDYxMA==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505620610", "bodyText": "I suppose it could. I'll try it out now.", "author": "adrianfish", "createdAt": "2020-10-15T15:07:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYyMTg0Mg==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505621842", "bodyText": "I switched them because I was testing if an instructor didn't have an agent string, like a student. That was it.", "author": "adrianfish", "createdAt": "2020-10-15T15:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzMjg0Mw==", "url": "https://github.com/sakaiproject/sakai/pull/8694#discussion_r505632843", "bodyText": "Sorted.", "author": "adrianfish", "createdAt": "2020-10-15T15:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwOTI4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "09625b113fe2d28eda6194faf1d32304b0f922a1", "chunk": "diff --git a/samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/DeliveryActionListener.java b/samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/DeliveryActionListener.java\nindex c52e37f961..89a8f6f145 100755\n--- a/samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/DeliveryActionListener.java\n+++ b/samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/DeliveryActionListener.java\n\n@@ -140,8 +138,8 @@ public class DeliveryActionListener\n       // 1. get managed bean\n       DeliveryBean delivery = (DeliveryBean) ContextUtil.lookupBean(\"delivery\");\n \n-      delivery.setLocale(preferencesService.getLocale(userDirectoryService.getCurrentUser().getId()));\n- \n+      delivery.setLocale(preferencesService.getLocale(AgentFacade.getAgentString()));\n+\n       // set publishedId, note that id can be changed by isPreviewingMode()\n       String id = getPublishedAssessmentId(delivery);\n       String agent = getAgentString();\n"}}, {"oid": "09625b113fe2d28eda6194faf1d32304b0f922a1", "url": "https://github.com/sakaiproject/sakai/commit/09625b113fe2d28eda6194faf1d32304b0f922a1", "message": "SAK-44466 Ensure we get a non null locale from preferences\n\nhttps://jira.sakaiproject.org/browse/SAK-44466", "committedDate": "2020-10-15T15:19:20Z", "type": "forcePushed"}, {"oid": "86fa07e608f2f64f26639ed9c44547b52be80971", "url": "https://github.com/sakaiproject/sakai/commit/86fa07e608f2f64f26639ed9c44547b52be80971", "message": "SAK-44466 Ensure we get a non null locale from preferences\n\nhttps://jira.sakaiproject.org/browse/SAK-44466", "committedDate": "2020-10-15T15:28:33Z", "type": "commit"}, {"oid": "86fa07e608f2f64f26639ed9c44547b52be80971", "url": "https://github.com/sakaiproject/sakai/commit/86fa07e608f2f64f26639ed9c44547b52be80971", "message": "SAK-44466 Ensure we get a non null locale from preferences\n\nhttps://jira.sakaiproject.org/browse/SAK-44466", "committedDate": "2020-10-15T15:28:33Z", "type": "forcePushed"}]}