{"pr_number": 8169, "pr_title": "SAK-43580 - Site Info > Manage Groups > Create Group > no longer able\u2026", "pr_createdAt": "2020-04-21T18:54:09Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8169", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzNzgxOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8169#discussion_r412437819", "bodyText": "The use of Optional.get() can produce a NoSuchElementException so it's best not to use this and use other variants of Optional, see https://www.baeldung.com/java-optional", "author": "ern", "createdAt": "2020-04-21T19:37:45Z", "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/GroupController.java", "diffHunk": "@@ -290,8 +307,17 @@ public String saveGroup(@ModelAttribute GroupForm groupForm, Model model) {\n                         addedGroupMemberList.add(member.getUserId());\n                     }\n                 }\n-            // If the selected member is not a role, add it as individual member.\n+            } else if (sectionList.stream().anyMatch(s -> selectedGroupMember.equals(s.getTitle()))) {\n+                // If the selected member is a section, add all the members of this section to the group\n+                selectedProviderIdList.add(selectedGroupMember);\n+                Optional<Group> sectionOptional = sectionList.stream().filter(s -> selectedGroupMember.equals(s.getTitle())).findAny();\n+                Group section = sectionOptional.get();", "originalCommit": "639b54beb26303579fe5ab2be564522f819a7a43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ0MDA4NQ==", "url": "https://github.com/sakaiproject/sakai/pull/8169#discussion_r412440085", "bodyText": "I know but there is an IF statement before that checks that", "author": "mpellicer", "createdAt": "2020-04-21T19:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzNzgxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ2MDUyOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8169#discussion_r412460529", "bodyText": "see ifPresent or isPresent no need to call it twice", "author": "ern", "createdAt": "2020-04-21T20:14:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzNzgxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcyNDAzOA==", "url": "https://github.com/sakaiproject/sakai/pull/8169#discussion_r412724038", "bodyText": "good, replaced the logic using orElse", "author": "mpellicer", "createdAt": "2020-04-22T07:05:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzNzgxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "24e1cd2407038a523e99e940b60c8d5be8306d8a", "chunk": "diff --git a/site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/GroupController.java b/site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/GroupController.java\nindex 714c37bdd9..43a913d060 100644\n--- a/site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/GroupController.java\n+++ b/site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/GroupController.java\n\n@@ -310,11 +310,12 @@ public class GroupController {\n             } else if (sectionList.stream().anyMatch(s -> selectedGroupMember.equals(s.getTitle()))) {\n                 // If the selected member is a section, add all the members of this section to the group\n                 selectedProviderIdList.add(selectedGroupMember);\n-                Optional<Group> sectionOptional = sectionList.stream().filter(s -> selectedGroupMember.equals(s.getTitle())).findAny();\n-                Group section = sectionOptional.get();\n-                for (Member member : section.getMembers()) {\n-                    group.addMember(member.getUserId(), member.getRole().getId(), member.isActive(), false);\n-                    addedGroupMemberList.add(member.getUserId());\n+                Group section = sectionList.stream().filter(s -> selectedGroupMember.equals(s.getTitle())).findAny().orElse(null);\n+                if (section != null) {\n+                    for (Member member : section.getMembers()) {\n+                        group.addMember(member.getUserId(), member.getRole().getId(), member.isActive(), false);\n+                        addedGroupMemberList.add(member.getUserId());\n+                    }\n                 }\n             } else {\n                 // If the selected member is not a role, add it as individual member.                \n"}}, {"oid": "24e1cd2407038a523e99e940b60c8d5be8306d8a", "url": "https://github.com/sakaiproject/sakai/commit/24e1cd2407038a523e99e940b60c8d5be8306d8a", "message": "SAK-43580 - Site Info > Manage Groups > Create Group > no longer able to assign rosters", "committedDate": "2020-04-22T06:49:20Z", "type": "commit"}, {"oid": "24e1cd2407038a523e99e940b60c8d5be8306d8a", "url": "https://github.com/sakaiproject/sakai/commit/24e1cd2407038a523e99e940b60c8d5be8306d8a", "message": "SAK-43580 - Site Info > Manage Groups > Create Group > no longer able to assign rosters", "committedDate": "2020-04-22T06:49:20Z", "type": "forcePushed"}]}