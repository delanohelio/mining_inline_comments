{"pr_number": 8271, "pr_title": "SAK-43741: ORACLE - DB blocked by a lot of Update lesson_builder_items calls", "pr_createdAt": "2020-06-05T06:01:23Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8271", "timeline": [{"oid": "4b2641bcb6fb12208eb573466b319afd760fbb51", "url": "https://github.com/sakaiproject/sakai/commit/4b2641bcb6fb12208eb573466b319afd760fbb51", "message": "SAK-43741: ORACLE - DB blocked by a lot of Update lesson_builder_items calls", "committedDate": "2020-06-05T06:00:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyNzk0NQ==", "url": "https://github.com/sakaiproject/sakai/pull/8271#discussion_r437527945", "bodyText": "put this on the same line or use braces", "author": "ern", "createdAt": "2020-06-09T15:37:19Z", "path": "lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java", "diffHunk": "@@ -189,7 +189,10 @@ public void fillComponents(UIContainer tofill, ViewParameters params, ComponentC\n \t\t\t\t\t    UIOutput.make(row, \"text-snippet\", messageLocator.getMessage(\"simplepage.resources-snippet\"));\n \t\t\t\t    }\n \t\t\t\t    else {\n-\t\t\t\t\t    String text = FormattedText.convertFormattedTextToPlaintext(i.getHtml());\n+\t\t\t\t\t    String text = i.getHtml();\n+\t\t\t\t\t    if (text == null)\n+\t\t\t\t\t\t    text = \"\";", "originalCommit": "4b2641bcb6fb12208eb573466b319afd760fbb51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxNTA3NA==", "url": "https://github.com/sakaiproject/sakai/pull/8271#discussion_r437915074", "bodyText": "Done", "author": "jesusmmp", "createdAt": "2020-06-10T07:30:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyNzk0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "69e50da16131be94af221fc557a0bd382e2a3612", "chunk": "diff --git a/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java b/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java\nindex 1fb5a83ae9..23a0d0eed5 100644\n--- a/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java\n+++ b/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java\n\n@@ -190,8 +190,9 @@ public class ReorderProducer implements ViewComponentProducer, NavigationCaseRep\n \t\t\t\t    }\n \t\t\t\t    else {\n \t\t\t\t\t    String text = i.getHtml();\n-\t\t\t\t\t    if (text == null)\n+\t\t\t\t\t    if (text == null) {\n \t\t\t\t\t\t    text = \"\";\n+\t\t\t\t\t    }\n \t\t\t\t\t    text = FormattedText.convertFormattedTextToPlaintext(text);\n \t\t\t\t\t    if (text.length() > 100)\n \t\t\t\t\t\t    text = text.substring(0, 100);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyODY5Mw==", "url": "https://github.com/sakaiproject/sakai/pull/8271#discussion_r437528693", "bodyText": "Add some braces here?", "author": "adrianfish", "createdAt": "2020-06-09T15:38:20Z", "path": "lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java", "diffHunk": "@@ -189,7 +189,10 @@ public void fillComponents(UIContainer tofill, ViewParameters params, ComponentC\n \t\t\t\t\t    UIOutput.make(row, \"text-snippet\", messageLocator.getMessage(\"simplepage.resources-snippet\"));\n \t\t\t\t    }\n \t\t\t\t    else {\n-\t\t\t\t\t    String text = FormattedText.convertFormattedTextToPlaintext(i.getHtml());\n+\t\t\t\t\t    String text = i.getHtml();\n+\t\t\t\t\t    if (text == null)\n+\t\t\t\t\t\t    text = \"\";", "originalCommit": "4b2641bcb6fb12208eb573466b319afd760fbb51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxNTE1Mg==", "url": "https://github.com/sakaiproject/sakai/pull/8271#discussion_r437915152", "bodyText": "Done", "author": "jesusmmp", "createdAt": "2020-06-10T07:30:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyODY5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "69e50da16131be94af221fc557a0bd382e2a3612", "chunk": "diff --git a/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java b/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java\nindex 1fb5a83ae9..23a0d0eed5 100644\n--- a/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java\n+++ b/lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ReorderProducer.java\n\n@@ -190,8 +190,9 @@ public class ReorderProducer implements ViewComponentProducer, NavigationCaseRep\n \t\t\t\t    }\n \t\t\t\t    else {\n \t\t\t\t\t    String text = i.getHtml();\n-\t\t\t\t\t    if (text == null)\n+\t\t\t\t\t    if (text == null) {\n \t\t\t\t\t\t    text = \"\";\n+\t\t\t\t\t    }\n \t\t\t\t\t    text = FormattedText.convertFormattedTextToPlaintext(text);\n \t\t\t\t\t    if (text.length() > 100)\n \t\t\t\t\t\t    text = text.substring(0, 100);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyOTMyOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8271#discussion_r437529329", "bodyText": "Stretch this out a bit? s == null ? 0 : s.length(). It's clearer, I think.", "author": "adrianfish", "createdAt": "2020-06-09T15:39:21Z", "path": "lessonbuilder/hbm/src/java/org/sakaiproject/lessonbuildertool/SimplePageItemImpl.java", "diffHunk": "@@ -179,9 +179,7 @@ public SimplePageItemImpl(long pageId, int sequence, int type, String sakaiId, S\n     // are too long. The main case this will happen is if we generate a name, which we do for URLs\n     // and uploaded files.\n \tprivate String maxlength(String s, int maxlen) {\n-\t    if (s == null)\n-\t\ts = \"\";  // oracle turns \"\" into null\n-\t    int len = s.length();\n+\t    int len = s==null?0:s.length();", "originalCommit": "4b2641bcb6fb12208eb573466b319afd760fbb51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxNTIzOA==", "url": "https://github.com/sakaiproject/sakai/pull/8271#discussion_r437915238", "bodyText": "Done", "author": "jesusmmp", "createdAt": "2020-06-10T07:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyOTMyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "69e50da16131be94af221fc557a0bd382e2a3612", "chunk": "diff --git a/lessonbuilder/hbm/src/java/org/sakaiproject/lessonbuildertool/SimplePageItemImpl.java b/lessonbuilder/hbm/src/java/org/sakaiproject/lessonbuildertool/SimplePageItemImpl.java\nindex 80f3fabdcc..aa3a73dccd 100644\n--- a/lessonbuilder/hbm/src/java/org/sakaiproject/lessonbuildertool/SimplePageItemImpl.java\n+++ b/lessonbuilder/hbm/src/java/org/sakaiproject/lessonbuildertool/SimplePageItemImpl.java\n\n@@ -179,7 +179,7 @@ public class SimplePageItemImpl implements SimplePageItem  {\n     // are too long. The main case this will happen is if we generate a name, which we do for URLs\n     // and uploaded files.\n \tprivate String maxlength(String s, int maxlen) {\n-\t    int len = s==null?0:s.length();\n+\t    int len = s == null ? 0 : s.length();\n \t    if (s == null || len <= maxlen)\n \t\treturn s;\n \t    int toremove = len - maxlen;\n"}}, {"oid": "69e50da16131be94af221fc557a0bd382e2a3612", "url": "https://github.com/sakaiproject/sakai/commit/69e50da16131be94af221fc557a0bd382e2a3612", "message": "SAK-43741: ORACLE - DB blocked by a lot of Update lesson_builder_items calls", "committedDate": "2020-06-10T07:29:18Z", "type": "commit"}]}