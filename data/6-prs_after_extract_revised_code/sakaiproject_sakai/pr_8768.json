{"pr_number": 8768, "pr_title": "SAK-44598 allow promotion of users to provided despite role matching", "pr_createdAt": "2020-11-02T22:21:22Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8768", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQwODc1MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8768#discussion_r516408751", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\tString targetRole = (String) target.get(userEid);\n          \n      \n    \n    \n  \n\nlooks like targetRole is no longer needed?", "author": "ern", "createdAt": "2020-11-03T03:20:51Z", "path": "kernel/kernel-impl/src/main/java/org/sakaiproject/authz/impl/DbAuthzGroupService.java", "diffHunk": "@@ -2916,8 +2916,6 @@ protected void refreshAuthzGroupInternal(BaseAuthzGroup realm)\n \t\t\t\t\t\tString userEid = userDirectoryService().getUserEid(userId);\n \t\t\t\t\t\tString targetRole = (String) target.get(userEid);", "originalCommit": "0d2193c9a1ade74963ff847c774c4d70cda11f91", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "53b08a96bea2aea2be56494b9fe5df808fa07dfc", "chunk": "diff --git a/kernel/kernel-impl/src/main/java/org/sakaiproject/authz/impl/DbAuthzGroupService.java b/kernel/kernel-impl/src/main/java/org/sakaiproject/authz/impl/DbAuthzGroupService.java\nindex e6b9ea5882..433ed0cda3 100644\n--- a/kernel/kernel-impl/src/main/java/org/sakaiproject/authz/impl/DbAuthzGroupService.java\n+++ b/kernel/kernel-impl/src/main/java/org/sakaiproject/authz/impl/DbAuthzGroupService.java\n\n@@ -2916,6 +2941,8 @@ public abstract class DbAuthzGroupService extends BaseAuthzGroupService implemen\n \t\t\t\t\t\tString userEid = userDirectoryService().getUserEid(userId);\n \t\t\t\t\t\tString targetRole = (String) target.get(userEid);\n \n+\t\t\t\t\t\tif (promoteUsersToProvidedRole || role.equals(targetRole))\n+\t\t\t\t\t\t{\n \t\t\t\t\t\t\t// remove from non-provided and add as provided\n \t\t\t\t\t\t\ttoDelete.add(userId);\n \n"}}, {"oid": "53b08a96bea2aea2be56494b9fe5df808fa07dfc", "url": "https://github.com/sakaiproject/sakai/commit/53b08a96bea2aea2be56494b9fe5df808fa07dfc", "message": "SAK-44598 new property to always move users to their provided role", "committedDate": "2020-11-03T17:48:15Z", "type": "commit"}, {"oid": "53b08a96bea2aea2be56494b9fe5df808fa07dfc", "url": "https://github.com/sakaiproject/sakai/commit/53b08a96bea2aea2be56494b9fe5df808fa07dfc", "message": "SAK-44598 new property to always move users to their provided role", "committedDate": "2020-11-03T17:48:15Z", "type": "forcePushed"}, {"oid": "e238d0ff4358aee7d7eabe5db46e6b8be56e2b27", "url": "https://github.com/sakaiproject/sakai/commit/e238d0ff4358aee7d7eabe5db46e6b8be56e2b27", "message": "one more", "committedDate": "2020-11-03T17:52:20Z", "type": "commit"}]}