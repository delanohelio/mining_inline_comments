{"pr_number": 8769, "pr_title": "SAK-44486 Forums - email notification is sent to users who didn't participate in conversation", "pr_createdAt": "2020-11-03T01:02:00Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8769", "timeline": [{"oid": "df42a5b8d0a92406af72dbe1c2f08bae546f92da", "url": "https://github.com/sakaiproject/sakai/commit/df42a5b8d0a92406af72dbe1c2f08bae546f92da", "message": "SAK-44486 Forums - email notification is sent to users who didn't participate in conversation", "committedDate": "2020-11-03T00:59:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkzMjg2Mw==", "url": "https://github.com/sakaiproject/sakai/pull/8769#discussion_r532932863", "bodyText": "Use the newer log pattern please!", "author": "ern", "createdAt": "2020-11-30T22:03:16Z", "path": "msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java", "diffHunk": "@@ -7375,13 +7376,16 @@ public void  sendEmailNotification(Message reply, DiscussionMessageBean currthre\n \t\twhile (iter.hasNext()){\n \t\t\tDiscussionMessageBean decoMessage = (DiscussionMessageBean) iter.next();\n \t\t\tString threadauthor = decoMessage.getMessage().getCreatedBy();\n-\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n-\t\t\t// only add level 1 users , since we've already got level2 users. \n-\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n-\t\t\t\tif (log.isDebugEnabled()){\n-\t\t\t\t\tlog.debug(\"The author: \" + threadauthor + \" wants to be notified\");\n+\t\t\t// don't include the reply author\n+\t\t\tif (!threadauthor.equals(reply.getCreatedBy())) {\n+\t\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n+\t\t\t\t// only add level 1 users , since we've already got level2 users.\n+\t\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n+\t\t\t\t\tif (log.isDebugEnabled()){", "originalCommit": "df42a5b8d0a92406af72dbe1c2f08bae546f92da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMTI1NQ==", "url": "https://github.com/sakaiproject/sakai/pull/8769#discussion_r533001255", "bodyText": "done", "author": "austin48", "createdAt": "2020-12-01T00:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkzMjg2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6b47b856013d17f51b827f4639a5c13e6040615a", "chunk": "diff --git a/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java b/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java\nindex fe3d3b176d..492eec2ea4 100644\n--- a/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java\n+++ b/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java\n\n@@ -7382,7 +7382,7 @@ public class DiscussionForumTool {\n \t\t\t\t// only add level 1 users , since we've already got level2 users.\n \t\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n \t\t\t\t\tif (log.isDebugEnabled()){\n-\t\t\t\t\t\tlog.debug(\"The author: \" + threadauthor + \" wants to be notified\");\n+\t\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n \t\t\t\t\t}\n \t\t\t\t\tuserlist.add(threadauthor);\n \t\t\t\t}\n"}}, {"oid": "6b47b856013d17f51b827f4639a5c13e6040615a", "url": "https://github.com/sakaiproject/sakai/commit/6b47b856013d17f51b827f4639a5c13e6040615a", "message": "SAK-44486 Forums - email notification is sent to users who didn't participate in conversation\n\nuse newer logging pattern", "committedDate": "2020-12-01T00:51:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU2ODQwNA==", "url": "https://github.com/sakaiproject/sakai/pull/8769#discussion_r534568404", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tif (log.isDebugEnabled()){\n          \n          \n            \n            \t\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n          \n          \n            \n            \t\t\t\t\t}\n          \n          \n            \n            \t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);", "author": "ern", "createdAt": "2020-12-03T00:10:13Z", "path": "msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java", "diffHunk": "@@ -7375,13 +7376,16 @@ public void  sendEmailNotification(Message reply, DiscussionMessageBean currthre\n \t\twhile (iter.hasNext()){\n \t\t\tDiscussionMessageBean decoMessage = (DiscussionMessageBean) iter.next();\n \t\t\tString threadauthor = decoMessage.getMessage().getCreatedBy();\n-\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n-\t\t\t// only add level 1 users , since we've already got level2 users. \n-\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n-\t\t\t\tif (log.isDebugEnabled()){\n-\t\t\t\t\tlog.debug(\"The author: \" + threadauthor + \" wants to be notified\");\n+\t\t\t// don't include the reply author\n+\t\t\tif (!threadauthor.equals(reply.getCreatedBy())) {\n+\t\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n+\t\t\t\t// only add level 1 users , since we've already got level2 users.\n+\t\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n+\t\t\t\t\tif (log.isDebugEnabled()){\n+\t\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n+\t\t\t\t\t}", "originalCommit": "6b47b856013d17f51b827f4639a5c13e6040615a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ed3ff9aba694fc8b0a701d56d4345959ba0b117e", "chunk": "diff --git a/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java b/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java\nindex 492eec2ea4..c50a3ebc92 100644\n--- a/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java\n+++ b/msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java\n\n@@ -7381,9 +7381,7 @@ public class DiscussionForumTool {\n \t\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n \t\t\t\t// only add level 1 users , since we've already got level2 users.\n \t\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n-\t\t\t\t\tif (log.isDebugEnabled()){\n-\t\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n-\t\t\t\t\t}\n+\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n \t\t\t\t\tuserlist.add(threadauthor);\n \t\t\t\t}\n \t\t\t}\n"}}, {"oid": "ed3ff9aba694fc8b0a701d56d4345959ba0b117e", "url": "https://github.com/sakaiproject/sakai/commit/ed3ff9aba694fc8b0a701d56d4345959ba0b117e", "message": "Update log pattern", "committedDate": "2020-12-03T00:10:46Z", "type": "commit"}]}