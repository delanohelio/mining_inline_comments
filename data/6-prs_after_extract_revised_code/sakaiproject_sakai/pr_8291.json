{"pr_number": 8291, "pr_title": "SAK-43759 when in admin site, retrieve all roles instead of just the \"admin\" role", "pr_createdAt": "2020-06-12T21:01:52Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8291", "timeline": [{"oid": "9cfb0d4960acd3e6ed557773ea051982fd392d97", "url": "https://github.com/sakaiproject/sakai/commit/9cfb0d4960acd3e6ed557773ea051982fd392d97", "message": "SAK-43759 when in admin site, retrieve all roles instead of just the \"admin\" role", "committedDate": "2020-06-12T21:01:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczOTcxOA==", "url": "https://github.com/sakaiproject/sakai/pull/8291#discussion_r439739718", "bodyText": "exclude admin my workspace as well \"~admin\"?", "author": "ern", "createdAt": "2020-06-13T13:33:39Z", "path": "sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java", "diffHunk": "@@ -1194,7 +1202,7 @@ private boolean validReportParameters() {\n \n \t\t// check WHO\n \t\tif(getReportParams().getWho().equals(ReportManager.WHO_ROLE)){\n-\t\t\tif(site.getUsersHasRole(getReportParams().getWhoRoleId()).isEmpty())\n+\t\t\tif(!siteId.equals(\"!admin\") && site.getUsersHasRole(getReportParams().getWhoRoleId()).isEmpty())", "originalCommit": "9cfb0d4960acd3e6ed557773ea051982fd392d97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE2MDM4MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8291#discussion_r441160381", "bodyText": "agreed", "author": "ottenhoff", "createdAt": "2020-06-16T21:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczOTcxOA=="}], "type": "inlineReview", "revised_code": {"commit": "6055e600aae9f428e16e374fbe9342909e4a57cc", "chunk": "diff --git a/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java b/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java\nindex 94dd9af44d..ba746bb17c 100644\n--- a/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java\n+++ b/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java\n\n@@ -1202,7 +1202,7 @@ public class ReportsEditPage extends BasePage {\n \n \t\t// check WHO\n \t\tif(getReportParams().getWho().equals(ReportManager.WHO_ROLE)){\n-\t\t\tif(!siteId.equals(\"!admin\") && site.getUsersHasRole(getReportParams().getWhoRoleId()).isEmpty())\n+\t\t\tif(!siteId.equals(\"!admin\") && !siteId.equals(\"~admin\") && site.getUsersHasRole(getReportParams().getWhoRoleId()).isEmpty())\n \t\t\t\terror((String) new ResourceModel(\"report_err_emptyrole\").getObject());\t\n \t\t}else if(getReportParams().getWho().equals(ReportManager.WHO_GROUPS)){\n \t\t\tif(getReportParams().getWhoGroupId() == null || getReportParams().getWhoGroupId().equals(\"\"))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczOTc3MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8291#discussion_r439739771", "bodyText": "Also add \"~admin\" my workspace?", "author": "ern", "createdAt": "2020-06-13T13:34:42Z", "path": "sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java", "diffHunk": "@@ -1119,16 +1119,24 @@ public IModel getModel(Object value) {\n \t}\n \t\n \tprivate List<String> getRoles() {\n+\t\tSet<String> siteIdWithRoles = new HashSet<>(Arrays.asList(siteId));\n+\n+\t\tif (\"!admin\".equals(siteId)) {", "originalCommit": "9cfb0d4960acd3e6ed557773ea051982fd392d97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE2MDMyMw==", "url": "https://github.com/sakaiproject/sakai/pull/8291#discussion_r441160323", "bodyText": "agree", "author": "ottenhoff", "createdAt": "2020-06-16T21:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczOTc3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "6055e600aae9f428e16e374fbe9342909e4a57cc", "chunk": "diff --git a/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java b/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java\nindex 94dd9af44d..ba746bb17c 100644\n--- a/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java\n+++ b/sitestats/sitestats-tool/src/java/org/sakaiproject/sitestats/tool/wicket/pages/ReportsEditPage.java\n\n@@ -1121,7 +1121,7 @@ public class ReportsEditPage extends BasePage {\n \tprivate List<String> getRoles() {\n \t\tSet<String> siteIdWithRoles = new HashSet<>(Arrays.asList(siteId));\n \n-\t\tif (\"!admin\".equals(siteId)) {\n+\t\tif (\"!admin\".equals(siteId) || \"~admin\".equals(siteId)) {\n \t\t\tsiteIdWithRoles.add(\"!site.template\");\n \t\t\tsiteIdWithRoles.add(\"!site.user\");\n \t\t\tLocator.getFacade().getSiteService().getSiteTypes().stream().map(s -> \"!site.template.\" + s).forEach(siteIdWithRoles::add);\n"}}, {"oid": "6055e600aae9f428e16e374fbe9342909e4a57cc", "url": "https://github.com/sakaiproject/sakai/commit/6055e600aae9f428e16e374fbe9342909e4a57cc", "message": "add ~admin per @ern", "committedDate": "2020-06-16T21:45:21Z", "type": "commit"}]}