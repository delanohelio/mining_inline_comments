{"pr_number": 8167, "pr_title": "Do not prematurely evict config repo validation errors from `ServerHealthState`", "pr_createdAt": "2020-05-21T21:42:08Z", "pr_url": "https://github.com/gocd/gocd/pull/8167", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkzMzUyNg==", "url": "https://github.com/gocd/gocd/pull/8167#discussion_r428933526", "bodyText": "This is the main change here, among all the method/class rename noise.", "author": "marques-work", "createdAt": "2020-05-21T21:45:06Z", "path": "server/src/main/java/com/thoughtworks/go/config/GoConfigRepoConfigDataSource.java", "diffHunk": "@@ -164,7 +165,8 @@ post event about completed (successful or not) parsing\n \n                 newPart.setOrigins(new RepoConfigOrigin(repoConfig, modification.getRevision()));\n                 this.configReposMaterialParseResultManager.parseSuccess(fingerprint, modification, newPart);\n-                serverHealthService.removeByScope(scope);\n+\n+                // it is the responsibility of the success listeners to clear the ServerHealthState", "originalCommit": "479a88423fc442e933156a294e14a48f95e1d05f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "c189e942ae4c1ba474e693f44abd71a59f324abe", "url": "https://github.com/gocd/gocd/commit/c189e942ae4c1ba474e693f44abd71a59f324abe", "message": "Stop optimistically removing config repo merge/validation errors from ServerHealthState\n\nThe errors in ServerHealthState should only be removed when a) the\npartial is marked as valid and b) when destroying a configrepo config.\n\nThis commit has a lot of noise from renaming classes and methods, but is\nlogically very short -- effictively a one line change.\n\nThe heart of this fix is removing the line `serverHealthService.removeByScope(...)`\nfrom `GoConfigRepoConfigDataSource#onCheckoutComplete()`.\n`CachedGoPartials#markAsValid()` already removes the error from `ServerHealthState`.\n\nThis should fix the regression failures around ConfigRepo validations.", "committedDate": "2020-05-21T22:32:37Z", "type": "commit"}, {"oid": "c189e942ae4c1ba474e693f44abd71a59f324abe", "url": "https://github.com/gocd/gocd/commit/c189e942ae4c1ba474e693f44abd71a59f324abe", "message": "Stop optimistically removing config repo merge/validation errors from ServerHealthState\n\nThe errors in ServerHealthState should only be removed when a) the\npartial is marked as valid and b) when destroying a configrepo config.\n\nThis commit has a lot of noise from renaming classes and methods, but is\nlogically very short -- effictively a one line change.\n\nThe heart of this fix is removing the line `serverHealthService.removeByScope(...)`\nfrom `GoConfigRepoConfigDataSource#onCheckoutComplete()`.\n`CachedGoPartials#markAsValid()` already removes the error from `ServerHealthState`.\n\nThis should fix the regression failures around ConfigRepo validations.", "committedDate": "2020-05-21T22:32:37Z", "type": "forcePushed"}]}