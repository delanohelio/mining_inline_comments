{"pr_number": 7670, "pr_title": "Introduce API endpoint for retrieving parameters of a template", "pr_createdAt": "2020-01-29T03:59:45Z", "pr_url": "https://github.com/gocd/gocd/pull/7670", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMzOTAxOQ==", "url": "https://github.com/gocd/gocd/pull/7670#discussion_r373339019", "bodyText": "Here, we're checking for the ETag generated based on the entire template config, whereas, this API is only for the template parameters.\nImagine there is a change in the template config, but the template parameters hasn't changed. Where, the API would respond 412 even if there is no change in the response of the API.\n\nHere are the options we've:\n\nCompute ETag only for template parameters.\nNo ETag for this API?? we always send 200?\nKeep the implementation as is (i.e. rely on entire template config for etag).\n\n@kritika-singh3 @ketan @arvindsv @maheshp @bdpiparva -- Thoughts??", "author": "GaneshSPatil", "createdAt": "2020-01-31T06:59:04Z", "path": "api/api-template-config-v7/src/main/java/com/thoughtworks/go/apiv7/admin/templateconfig/TemplateConfigControllerV7.java", "diffHunk": "@@ -170,6 +173,16 @@ public String show(Request req, Response res) throws IOException {\n         }\n     }\n \n+    public String showParameters(Request req, Response res) throws IOException {\n+        PipelineTemplateConfig templateConfig = fetchEntityFromConfig(req.params(\"template_name\"));\n+        if (isGetOrHeadRequestFresh(req, templateConfig)) {", "originalCommit": "ce9e17e0261f052edf728934c2afc96b89680d2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0Njc5MA==", "url": "https://github.com/gocd/gocd/pull/7670#discussion_r373346790", "bodyText": "IMO, Etag should be generated based on the payload or entity being serialised. Generating based on entire config does not make sense.", "author": "bdpiprava", "createdAt": "2020-01-31T07:32:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMzOTAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM1MzE0OA==", "url": "https://github.com/gocd/gocd/pull/7670#discussion_r373353148", "bodyText": "I was of the opinion that the parameters don't exist out of template. They can change with any change in the template config.\nScenarios I considered:\n\nParameters being added/removed.\nThe place where the parameters are utilized being changed.\n\nSo, decided to do a Etag check on the whole config. If anything, I would like to go with Option 2 as we are fetching the entire template config either way.", "author": "kritika-singh3", "createdAt": "2020-01-31T07:56:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMzOTAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM3MTY1Mw==", "url": "https://github.com/gocd/gocd/pull/7670#discussion_r373371653", "bodyText": "@kritika-singh3 - Agreed, that parameters does not exist outside of  template config or can't be updated directly though API. I am leaning towards option 1 as the value of parameters can remain same when other parts of the template config is changed which defeats the purpose of having etag.", "author": "bdpiprava", "createdAt": "2020-01-31T08:53:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMzOTAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkzODY5MQ==", "url": "https://github.com/gocd/gocd/pull/7670#discussion_r373938691", "bodyText": "@GaneshSPatil @bdpiparva I have updated the API to calculate eTag only for the parameters and using the same to send either 304 or 200\nPR: #7696", "author": "kritika-singh3", "createdAt": "2020-02-03T06:30:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMzOTAxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "9c22c99bb06e45a7df05e824f355db0d9861dfc0", "chunk": "diff --git a/api/api-template-config-v7/src/main/java/com/thoughtworks/go/apiv7/admin/templateconfig/TemplateConfigControllerV7.java b/api/api-template-config-v7/src/main/java/com/thoughtworks/go/apiv7/admin/templateconfig/TemplateConfigControllerV7.java\nindex d5aa8a7abb..475ffa3ad9 100644\n--- a/api/api-template-config-v7/src/main/java/com/thoughtworks/go/apiv7/admin/templateconfig/TemplateConfigControllerV7.java\n+++ b/api/api-template-config-v7/src/main/java/com/thoughtworks/go/apiv7/admin/templateconfig/TemplateConfigControllerV7.java\n\n@@ -173,16 +170,6 @@ public class TemplateConfigControllerV7 extends ApiController implements SparkSp\n         }\n     }\n \n-    public String showParameters(Request req, Response res) throws IOException {\n-        PipelineTemplateConfig templateConfig = fetchEntityFromConfig(req.params(\"template_name\"));\n-        if (isGetOrHeadRequestFresh(req, templateConfig)) {\n-            return notModified(res);\n-        } else {\n-            setEtagHeader(templateConfig, res);\n-            return writerForTopLevelObject(req, res, writer -> ParametersRepresenter.toJSON(writer, templateConfig.name().toString(), templateConfig.referredParams()));\n-        }\n-    }\n-\n     private boolean isRenameAttempt(PipelineTemplateConfig existingTemplateConfig, PipelineTemplateConfig templateConfigFromRequest) {\n         return !existingTemplateConfig.name().equals(templateConfigFromRequest.name());\n     }\n"}}, {"oid": "9c22c99bb06e45a7df05e824f355db0d9861dfc0", "url": "https://github.com/gocd/gocd/commit/9c22c99bb06e45a7df05e824f355db0d9861dfc0", "message": "Bumping up template config api to v7", "committedDate": "2020-02-03T06:09:41Z", "type": "commit"}, {"oid": "7e65148546b1a52a93bdf2c4aabb19b5958b27d4", "url": "https://github.com/gocd/gocd/commit/7e65148546b1a52a93bdf2c4aabb19b5958b27d4", "message": "Introduce API to return parameters for a given template", "committedDate": "2020-02-03T06:29:18Z", "type": "commit"}, {"oid": "7e65148546b1a52a93bdf2c4aabb19b5958b27d4", "url": "https://github.com/gocd/gocd/commit/7e65148546b1a52a93bdf2c4aabb19b5958b27d4", "message": "Introduce API to return parameters for a given template", "committedDate": "2020-02-03T06:29:18Z", "type": "forcePushed"}]}