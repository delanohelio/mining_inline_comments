{"pr_number": 7707, "pr_title": "Issue #7534: fix NPE in MissingDeprecatedCheck", "pr_createdAt": "2020-02-29T18:58:18Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7707", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNzA3NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r386107074", "bodyText": "If this is now a hardcoded list that never changes, then please move it to a static final field.", "author": "rnveach", "createdAt": "2020-03-01T13:11:29Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java", "diffHunk": "@@ -176,14 +180,19 @@ private static DetailAST getParent(DetailAST commentBlock) {\n             result = commentBlock.getNextSibling();\n         }\n \n+        final List<Integer> typesArrayList = new ArrayList<>(Arrays.asList(", "originalCommit": "15dd939a0299657989f3d75168a3e62adeb5a1f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MTg5NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r386691895", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-03-02T22:33:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNzA3NA=="}], "type": "inlineReview", "revised_code": {"commit": "50e1c374f520f2044e30d2d2a3cf8c6f33104a66", "chunk": "diff --git a/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java b/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\nindex 109ebe929..474cda9d3 100644\n--- a/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\n+++ b/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\n\n@@ -180,14 +186,9 @@ public final class MissingDeprecatedCheck extends AbstractJavadocCheck {\n             result = commentBlock.getNextSibling();\n         }\n \n-        final List<Integer> typesArrayList = new ArrayList<>(Arrays.asList(\n-                TokenTypes.TYPE, TokenTypes.MODIFIERS, TokenTypes.ANNOTATION,\n-                TokenTypes.ANNOTATIONS, TokenTypes.ARRAY_DECLARATOR,\n-                TokenTypes.TYPE_PARAMETERS, TokenTypes.DOT));\n-\n         while (true) {\n             final int type = result.getType();\n-            if (typesArrayList.contains(type)) {\n+            if (TYPES_ARRAY_LIST.contains(type)) {\n                 result = result.getParent();\n             }\n             else if (type == TokenTypes.SINGLE_LINE_COMMENT) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNzMyNA==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r386107324", "bodyText": "Please also add a UT with issue but where it will produce a violation to show check functionality still works in this situation, if there is not one already.", "author": "rnveach", "createdAt": "2020-03-01T13:15:03Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheckTest.java", "diffHunk": "@@ -168,4 +168,13 @@ public void testPackageInfo() throws Exception {\n         verify(checkConfig, getPath(\"package-info.java\"), expected);\n     }\n \n+    @Test\n+    public void testPackageInfoBelowComment() throws Exception {\n+        final DefaultConfiguration checkConfig = createModuleConfig(MissingDeprecatedCheck.class);\n+\n+        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;", "originalCommit": "15dd939a0299657989f3d75168a3e62adeb5a1f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5OTkwOA==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r386599908", "bodyText": "The file I am passing to verify does have two violations, but they are from SummaryJavadoc.  Should I add some code to trigger violations from MissingDeprecatedCheck, i.e. annotation/messages.properties?", "author": "nmancus1", "createdAt": "2020-03-02T19:24:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNzMyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwMzc2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r386603766", "bodyText": "Should I add some code to trigger violations from MissingDeprecatedCheck\n\nYes, this is what I am looking for. This test is only for MissingDeprecatedCheck so all examples should focus around it. This is what is being reported to us in issue. Your change looks good from just reading source, but I wanted to make sure it doesn't impact logic to produce a violation.", "author": "rnveach", "createdAt": "2020-03-02T19:31:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNzMyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5NDgxOA==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r386694818", "bodyText": "Please let me know if there's any other checks I should add, it didn't seem like any others would apply to packages in MissingDeprecatedCheck.\nEdit: I should add a check for annotation.package.location shouldn't I?", "author": "nmancus1", "createdAt": "2020-03-02T22:40:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNzMyNA=="}], "type": "inlineReview", "revised_code": {"commit": "50e1c374f520f2044e30d2d2a3cf8c6f33104a66", "chunk": "diff --git a/src/test/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheckTest.java b/src/test/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheckTest.java\nindex 1b743653e..247479693 100644\n--- a/src/test/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheckTest.java\n+++ b/src/test/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheckTest.java\n\n@@ -172,7 +172,12 @@ public class MissingDeprecatedCheckTest extends AbstractModuleTestSupport {\n     public void testPackageInfoBelowComment() throws Exception {\n         final DefaultConfiguration checkConfig = createModuleConfig(MissingDeprecatedCheck.class);\n \n-        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;\n+        final String[] expected = {\n+                \"16: \" + getCheckMessage(MSG_KEY_JAVADOC_DUPLICATE_TAG, \"@deprecated\"),\n+                \"18: \" + getCheckMessage(MSG_KEY_ANNOTATION_MISSING_DEPRECATED),\n+                \"23: \" + getCheckMessage(MSG_KEY_ANNOTATION_MISSING_DEPRECATED),\n+                \"37: \" + getCheckMessage(MSG_KEY_JAVADOC_DUPLICATE_TAG, \"@deprecated\")\n+        };\n \n         verify(checkConfig, getPath(\"InputMissingDeprecatedComment.java\"), expected);\n     }\n"}}, {"oid": "50e1c374f520f2044e30d2d2a3cf8c6f33104a66", "url": "https://github.com/checkstyle/checkstyle/commit/50e1c374f520f2044e30d2d2a3cf8c6f33104a66", "message": "Issue #7534: fix NPE in MissingDeprecatedCheck", "committedDate": "2020-03-02T20:48:50Z", "type": "forcePushed"}, {"oid": "905ce32bffdc74a25f00e98f1bd1c2fe1b95e0d0", "url": "https://github.com/checkstyle/checkstyle/commit/905ce32bffdc74a25f00e98f1bd1c2fe1b95e0d0", "message": "Issue #7534: fix NPE in MissingDeprecatedCheck", "committedDate": "2020-03-02T22:32:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyMzUyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r387323526", "bodyText": "please use Set collection for quicker search.", "author": "romani", "createdAt": "2020-03-03T22:07:16Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java", "diffHunk": "@@ -116,6 +120,12 @@\n     /** Fully-qualified {@link Deprecated Deprecated} annotation name. */\n     private static final String FQ_DEPRECATED = \"java.lang.\" + DEPRECATED;\n \n+    /** List of token types to find parent of. */\n+    private static final List<Integer> TYPES_ARRAY_LIST = new ArrayList<>(Arrays.asList(", "originalCommit": "905ce32bffdc74a25f00e98f1bd1c2fe1b95e0d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc1MDM2Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r387750362", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-03-04T15:40:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyMzUyNg=="}], "type": "inlineReview", "revised_code": {"commit": "5251980ec5a8aca914380cbd84438e64c7e12139", "chunk": "diff --git a/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java b/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\nindex f2334379d..0d7ae4158 100644\n--- a/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\n+++ b/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\n\n@@ -121,7 +121,7 @@ public final class MissingDeprecatedCheck extends AbstractJavadocCheck {\n     private static final String FQ_DEPRECATED = \"java.lang.\" + DEPRECATED;\n \n     /** List of token types to find parent of. */\n-    private static final List<Integer> TYPES_ARRAY_LIST = new ArrayList<>(Arrays.asList(\n+    private static final Set<Integer> TYPES_HASH_SET = new HashSet<>(Arrays.asList(\n             TokenTypes.TYPE, TokenTypes.MODIFIERS, TokenTypes.ANNOTATION,\n             TokenTypes.ANNOTATIONS, TokenTypes.ARRAY_DECLARATOR,\n             TokenTypes.TYPE_PARAMETERS, TokenTypes.DOT));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyNDI4Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r387324282", "bodyText": "I might miss something, this update is just code refactoring, and not related to functional fix. If so , please move to searate comit of the same PR, commit with prefix \"minor\".", "author": "romani", "createdAt": "2020-03-03T22:08:52Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java", "diffHunk": "@@ -178,12 +188,12 @@ private static DetailAST getParent(DetailAST commentBlock) {\n \n         while (true) {\n             final int type = result.getType();\n-            if (type == TokenTypes.TYPE || type == TokenTypes.MODIFIERS\n-                    || type == TokenTypes.ANNOTATION || type == TokenTypes.ANNOTATIONS\n-                    || type == TokenTypes.ARRAY_DECLARATOR || type == TokenTypes.TYPE_PARAMETERS\n-                    || type == TokenTypes.DOT) {\n+            if (TYPES_ARRAY_LIST.contains(type)) {", "originalCommit": "905ce32bffdc74a25f00e98f1bd1c2fe1b95e0d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyOTgyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r387329826", "bodyText": "This was done to reduce cyclomatic complexity (11) reported by mvn clean verify.", "author": "nmancus1", "createdAt": "2020-03-03T22:20:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyNDI4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY1NTIwNA==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r387655204", "bodyText": "So it is unrelated to functional fix and fortunately not mixed with other update, please move it to separate commit with message minor: reduce cyclomatic complexity before next update", "author": "romani", "createdAt": "2020-03-04T13:10:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyNDI4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc1MDE0OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7707#discussion_r387750149", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-03-04T15:40:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyNDI4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "5251980ec5a8aca914380cbd84438e64c7e12139", "chunk": "diff --git a/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java b/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\nindex f2334379d..0d7ae4158 100644\n--- a/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\n+++ b/src/main/java/com/puppycrawl/tools/checkstyle/checks/annotation/MissingDeprecatedCheck.java\n\n@@ -188,7 +188,7 @@ public final class MissingDeprecatedCheck extends AbstractJavadocCheck {\n \n         while (true) {\n             final int type = result.getType();\n-            if (TYPES_ARRAY_LIST.contains(type)) {\n+            if (TYPES_HASH_SET.contains(type)) {\n                 result = result.getParent();\n             }\n             else if (type == TokenTypes.SINGLE_LINE_COMMENT) {\n"}}, {"oid": "5251980ec5a8aca914380cbd84438e64c7e12139", "url": "https://github.com/checkstyle/checkstyle/commit/5251980ec5a8aca914380cbd84438e64c7e12139", "message": "Issue #7534: fix NPE in MissingDeprecatedCheck", "committedDate": "2020-03-04T18:11:00Z", "type": "forcePushed"}, {"oid": "0446b9cad22a215b69eacc3739abcc0edd325ad1", "url": "https://github.com/checkstyle/checkstyle/commit/0446b9cad22a215b69eacc3739abcc0edd325ad1", "message": "Issue #7534: fix NPE in MissingDeprecatedCheck", "committedDate": "2020-03-05T04:02:13Z", "type": "forcePushed"}, {"oid": "e7c23e15205ae5eaedd99eff4565a99c4f662ad9", "url": "https://github.com/checkstyle/checkstyle/commit/e7c23e15205ae5eaedd99eff4565a99c4f662ad9", "message": "minor: reduce cyclomatic complexity before next update", "committedDate": "2020-03-05T04:02:13Z", "type": "commit"}, {"oid": "0446b9cad22a215b69eacc3739abcc0edd325ad1", "url": "https://github.com/checkstyle/checkstyle/commit/0446b9cad22a215b69eacc3739abcc0edd325ad1", "message": "Issue #7534: fix NPE in MissingDeprecatedCheck", "committedDate": "2020-03-05T04:02:13Z", "type": "commit"}]}