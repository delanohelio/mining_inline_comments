{"pr_number": 7836, "pr_title": "Issue #7764: Update AbstractChecks to log DetailAST - UncommentedMain", "pr_createdAt": "2020-03-12T08:16:23Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7836", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg3MDU1NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r391870555", "bodyText": "maybe this test could have a more descriptive name?", "author": "esilkensen", "createdAt": "2020-03-12T20:15:13Z", "path": "src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package org.checkstyle.suppressionxpathfilter;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.puppycrawl.tools.checkstyle.DefaultConfiguration;\n+import com.puppycrawl.tools.checkstyle.checks.UncommentedMainCheck;\n+\n+public class XpathRegressionUncommentedMainTest extends AbstractXpathTestSupport {\n+\n+    private final Class<UncommentedMainCheck> clazz =\n+            UncommentedMainCheck.class;\n+\n+    @Override\n+    protected String getCheckName() {\n+        return clazz.getSimpleName();\n+    }\n+\n+    @Test\n+    public void testOne() throws Exception {", "originalCommit": "594333d0734f46867bcbd5d92ce2ee55169af651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI1MzQ0OA==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392253448", "bodyText": "we did not find any good names for them, that why it is like this in all Xpath tests.\n@esilkensen , do you have suggestions ?", "author": "romani", "createdAt": "2020-03-13T14:14:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg3MDU1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI2NDk1Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392264956", "bodyText": "Ah, this sounds good to me then - I didn\u2019t realize it was the same in all other tests too.", "author": "esilkensen", "createdAt": "2020-03-13T14:33:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg3MDU1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MzM0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392593343", "bodyText": "it does not mean it is good in all others :) , we just do not know better alternatives.\nreason of this tests is not to validate Xpath correctness and make sure it works in general, that is why names are so general. If in future we will run into problems of xpath for particular Check then we will create test like testOnInnerClasswithAnnotationAndXxxxxx.", "author": "romani", "createdAt": "2020-03-14T14:42:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg3MDU1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "33203234c3dbcd085e854f2b83e27f88809a1d4e", "chunk": "diff --git a/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java b/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java\nindex b14ec2435..fe2fb62b1 100644\n--- a/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java\n+++ b/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java\n\n@@ -63,4 +63,33 @@ public class XpathRegressionUncommentedMainTest extends AbstractXpathTestSupport\n         runVerifications(moduleConfig, fileToProcess, expectedViolation,\n                 expectedXpathQueries);\n     }\n+\n+    @Test\n+    public void testTwo() throws Exception {\n+        final File fileToProcess =\n+                new File(getPath(\"SuppressionXpathRegressionUncommentedMainTwo.java\"));\n+\n+        final DefaultConfiguration moduleConfig =\n+                createModuleConfig(UncommentedMainCheck.class);\n+\n+        final String[] expectedViolation = {\n+            \"5:9: \" + getCheckMessage(UncommentedMainCheck.class,\n+                        UncommentedMainCheck.MSG_KEY),\n+        };\n+\n+        final List<String> expectedXpathQueries = Arrays.asList(\n+                \"/CLASS_DEF[./IDENT[@text='SuppressionXpathRegressionUncommentedMainTwo']]\"\n+                        + \"/OBJBLOCK/CLASS_DEF[./IDENT[@text='Launcher']\"\n+                        + \"]/OBJBLOCK/METHOD_DEF[./IDENT[@text='main']]\",\n+                \"/CLASS_DEF[./IDENT[@text='SuppressionXpathRegressionUncommentedMainTwo']]\"\n+                        + \"/OBJBLOCK/CLASS_DEF[./IDENT[@text='Launcher']]\"\n+                        + \"/OBJBLOCK/METHOD_DEF[./IDENT[@text='main']]/MODIFIERS\",\n+                \"/CLASS_DEF[./IDENT[@text='SuppressionXpathRegressionUncommentedMainTwo']]\"\n+                        + \"/OBJBLOCK/CLASS_DEF[./IDENT[@text='Launcher']]\"\n+                        + \"/OBJBLOCK/METHOD_DEF[./IDENT[@text='main']]/MODIFIERS/LITERAL_PUBLIC\"\n+        );\n+\n+        runVerifications(moduleConfig, fileToProcess, expectedViolation,\n+                expectedXpathQueries);\n+    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI1Mzg0OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392253849", "bodyText": "@AmrDeveloper , please add one more test, we need at least two tests.", "author": "romani", "createdAt": "2020-03-13T14:15:28Z", "path": "src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package org.checkstyle.suppressionxpathfilter;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.puppycrawl.tools.checkstyle.DefaultConfiguration;\n+import com.puppycrawl.tools.checkstyle.checks.UncommentedMainCheck;\n+\n+public class XpathRegressionUncommentedMainTest extends AbstractXpathTestSupport {\n+\n+    private final Class<UncommentedMainCheck> clazz =\n+            UncommentedMainCheck.class;\n+\n+    @Override\n+    protected String getCheckName() {\n+        return clazz.getSimpleName();\n+    }\n+\n+    @Test\n+    public void testOne() throws Exception {", "originalCommit": "594333d0734f46867bcbd5d92ce2ee55169af651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUzNjMyOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392536329", "bodyText": "@romani Done but CI not passed again !", "author": "AmrDeveloper", "createdAt": "2020-03-14T00:23:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI1Mzg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU0MTQ5MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392541491", "bodyText": "I don\u2019t think the pitest failure is transient/flaky, but I tried looking at how to resolve it yesterday and didn\u2019t find the answer...\nA common approach could be to take the line of code and the mutation that is surviving and construct a test that fails when that mutation is present, but the confusing thing here is pitest lists two identical mutations for the same line with one surviving, so I\u2019m not sure what the report is telling us.", "author": "esilkensen", "createdAt": "2020-03-14T00:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI1Mzg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MjE4MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7836#discussion_r392592181", "bodyText": "but CI not passed again !\n\nit is even better, at least behavior is stable. It is sad that it blocks your PR. Looks like we run into pitest bug, so we need to find a workaround....", "author": "romani", "createdAt": "2020-03-14T14:25:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI1Mzg0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "33203234c3dbcd085e854f2b83e27f88809a1d4e", "chunk": "diff --git a/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java b/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java\nindex b14ec2435..fe2fb62b1 100644\n--- a/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java\n+++ b/src/it/java/org/checkstyle/suppressionxpathfilter/XpathRegressionUncommentedMainTest.java\n\n@@ -63,4 +63,33 @@ public class XpathRegressionUncommentedMainTest extends AbstractXpathTestSupport\n         runVerifications(moduleConfig, fileToProcess, expectedViolation,\n                 expectedXpathQueries);\n     }\n+\n+    @Test\n+    public void testTwo() throws Exception {\n+        final File fileToProcess =\n+                new File(getPath(\"SuppressionXpathRegressionUncommentedMainTwo.java\"));\n+\n+        final DefaultConfiguration moduleConfig =\n+                createModuleConfig(UncommentedMainCheck.class);\n+\n+        final String[] expectedViolation = {\n+            \"5:9: \" + getCheckMessage(UncommentedMainCheck.class,\n+                        UncommentedMainCheck.MSG_KEY),\n+        };\n+\n+        final List<String> expectedXpathQueries = Arrays.asList(\n+                \"/CLASS_DEF[./IDENT[@text='SuppressionXpathRegressionUncommentedMainTwo']]\"\n+                        + \"/OBJBLOCK/CLASS_DEF[./IDENT[@text='Launcher']\"\n+                        + \"]/OBJBLOCK/METHOD_DEF[./IDENT[@text='main']]\",\n+                \"/CLASS_DEF[./IDENT[@text='SuppressionXpathRegressionUncommentedMainTwo']]\"\n+                        + \"/OBJBLOCK/CLASS_DEF[./IDENT[@text='Launcher']]\"\n+                        + \"/OBJBLOCK/METHOD_DEF[./IDENT[@text='main']]/MODIFIERS\",\n+                \"/CLASS_DEF[./IDENT[@text='SuppressionXpathRegressionUncommentedMainTwo']]\"\n+                        + \"/OBJBLOCK/CLASS_DEF[./IDENT[@text='Launcher']]\"\n+                        + \"/OBJBLOCK/METHOD_DEF[./IDENT[@text='main']]/MODIFIERS/LITERAL_PUBLIC\"\n+        );\n+\n+        runVerifications(moduleConfig, fileToProcess, expectedViolation,\n+                expectedXpathQueries);\n+    }\n }\n"}}, {"oid": "33203234c3dbcd085e854f2b83e27f88809a1d4e", "url": "https://github.com/checkstyle/checkstyle/commit/33203234c3dbcd085e854f2b83e27f88809a1d4e", "message": "Issue #7764: Update AbstractChecks to log DetailAST - UncommentedMain", "committedDate": "2020-03-13T20:51:14Z", "type": "forcePushed"}, {"oid": "b82320d7997770b9c7eef22ed29528f94e7e8a49", "url": "https://github.com/checkstyle/checkstyle/commit/b82320d7997770b9c7eef22ed29528f94e7e8a49", "message": "Issue #7764: Update AbstractChecks to log DetailAST - UncommentedMain", "committedDate": "2020-03-14T19:28:49Z", "type": "forcePushed"}, {"oid": "9c4bf1194c91e65cb0ba027f90000507fdc42a73", "url": "https://github.com/checkstyle/checkstyle/commit/9c4bf1194c91e65cb0ba027f90000507fdc42a73", "message": "Issue #7764: Update AbstractChecks to log DetailAST - UncommentedMain", "committedDate": "2020-03-18T15:52:17Z", "type": "commit"}, {"oid": "9c4bf1194c91e65cb0ba027f90000507fdc42a73", "url": "https://github.com/checkstyle/checkstyle/commit/9c4bf1194c91e65cb0ba027f90000507fdc42a73", "message": "Issue #7764: Update AbstractChecks to log DetailAST - UncommentedMain", "committedDate": "2020-03-18T15:52:17Z", "type": "forcePushed"}]}