{"pr_number": 9129, "pr_title": "Mark sonar violation 'Regular expressions should not overflow the stack' as false positive over AvoidEscapedUnicodeCharactersCheck", "pr_createdAt": "2020-12-25T18:44:50Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/9129", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r548901866", "bodyText": "Isn't \\\\\\\\b mean we are looking for the text string \\{binary character}?\nWon't putting this directly into [] mean we change the search from the above to looking for the text string \\ or the {binary character} and not the combination of the 2?\nImagine if this was just \\\\n. It is looking for the text string \\n not the line control.", "author": "rnveach", "createdAt": "2020-12-25T18:52:24Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java", "diffHunk": "@@ -179,15 +179,7 @@\n \n     /** Regular expression for all escaped chars. */\n     private static final Pattern ALL_ESCAPED_CHARS = Pattern.compile(\"^((\\\\\\\\u)[a-fA-F0-9]{4}\"\n-            + \"|\\\"\"\n-            + \"|'\"\n-            + \"|\\\\\\\\\"\n-            + \"|\\\\\\\\b\"\n-            + \"|\\\\\\\\f\"\n-            + \"|\\\\\\\\n\"\n-            + \"|\\\\\\\\r\"\n-            + \"|\\\\\\\\t\"\n-            + \")+$\");\n+            + \"|[\\\"'\\\\\\\\\\\\\\\\b\\\\\\\\f\\\\\\\\n\\\\\\\\r\\\\\\\\t])+$\");", "originalCommit": "66b275e80148c7327a09db6fc1c99c22f97e5bef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMjA0Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r548902047", "bodyText": "We should have a test case to cover this.", "author": "rnveach", "createdAt": "2020-12-25T18:55:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAxMjYzMw==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r549012633", "bodyText": "I do not understand what is \\b at all .\nit was added at 39f40e5 without any specific reason.", "author": "romani", "createdAt": "2020-12-26T17:20:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAxNTI1MA==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r549015250", "bodyText": "ok it is \\b | Insert a backspace in the text at this point.\nhttps://docs.oracle.com/javase/tutorial/java/data/characters.html", "author": "romani", "createdAt": "2020-12-26T17:53:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAxNTY5Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r549015696", "bodyText": "@rnveach , I do not see problem here\n$ javac Test.java \n$ cat Test.java \npublic class Test {\n  String value = \"\\u03bc\\b\"; // ok\n}\n\n$ cat config.xml \n<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"http://www.puppycrawl.com/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\n    <module name=\"TreeWalker\">\n      <module name=\"AvoidEscapedUnicodeCharacters\">\n        <property name=\"allowIfAllCharactersEscaped\" value=\"true\"/>\n      </module>\n\n    </module>\n</module>\n\n$ java -jar checkstyle-8.38-all.jar -c config.xml Test.java\nStarting audit...\nAudit done.\n\n$ cat config.xml \n<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"http://www.puppycrawl.com/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\n    <module name=\"TreeWalker\">\n      <module name=\"AvoidEscapedUnicodeCharacters\">\n      </module>\n\n    </module>\n</module>\n\n$ java -jar checkstyle-8.38-all.jar -c config.xml Test.java\nStarting audit...\n[ERROR] /var/tmp/Test.java:2:18: Unicode escape(s) usage should be avoided. [AvoidEscapedUnicodeCharacters]\nAudit done.\nCheckstyle ends with 1 errors.", "author": "romani", "createdAt": "2020-12-26T17:58:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAyMDY3MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r549020671", "bodyText": "Master:\n$ cat TestClass.java\npublic class Test {\n  String value = \"b\\u03bc\"; // ok\n}\n\n$ cat TestConfig.xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\n    <module name=\"TreeWalker\">\n      <module name=\"AvoidEscapedUnicodeCharacters\">\n<property name=\"allowIfAllCharactersEscaped\" value=\"true\" />\n      </module>\n\n    </module>\n</module>\n\n$ java -jar checkstyle-8.38-all.jar -c TestConfig.xml TestClass.java\nStarting audit...\n[ERROR] TestClass.java:2:18: Unicode escape(s) usage should be avoided. [AvoidEscapedUnicodeCharacters]\nAudit done.\nCheckstyle ends with 1 errors.\n\nPR:\n$ cat TestClass.java\npublic class Test {\n  String value = \"b\\u03bc\"; // ok\n}\n\n$ cat TestConfig.xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\n    <module name=\"TreeWalker\">\n      <module name=\"AvoidEscapedUnicodeCharacters\">\n<property name=\"allowIfAllCharactersEscaped\" value=\"true\" />\n      </module>\n\n    </module>\n</module>\n\n$ java -jar checkstyle-checkstyle-pr-sonarregexpstackoverflow2-2020-12-26-all.jar -c TestConfig.xml TestClass.java\nStarting audit...\nAudit done.\n\nShort Answer: You can't use []s here.", "author": "rnveach", "createdAt": "2020-12-26T19:00:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA0MjkxMA==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r549042910", "bodyText": "thanks a lot!\nUTs are extended to cover this case.\nI will mark Sonar issue as false positive after merge, for some reason it showing different violation now.", "author": "romani", "createdAt": "2020-12-26T23:37:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMTg2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "f6b22c7414df12234fcfb83080bf1b908a3cc740", "chunk": "diff --git a/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java b/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java\nindex f7a043ceb..3e7d8b8ef 100644\n--- a/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java\n+++ b/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java\n\n@@ -177,7 +177,10 @@ public class AvoidEscapedUnicodeCharactersCheck\n             + \"|[fF]{3}[9a-bA-B]\"\n             + \"|[fF][eE][fF]{2})\");\n \n-    /** Regular expression for all escaped chars. */\n+    /** Regular expression for all escaped chars.\n+     * See \"EscapeSequence\" at\n+     * https://docs.oracle.com/javase/specs/jls/se8/html/jls-3.html#jls-3.10.6\n+     */\n     private static final Pattern ALL_ESCAPED_CHARS = Pattern.compile(\"^((\\\\\\\\u)[a-fA-F0-9]{4}\"\n             + \"|[\\\"'\\\\\\\\\\\\\\\\b\\\\\\\\f\\\\\\\\n\\\\\\\\r\\\\\\\\t])+$\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMjMwMA==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r548902300", "bodyText": "not related to this issue but related to this check: JEP 368 adds a new escape to java: \\s.", "author": "pbludov", "createdAt": "2020-12-25T18:57:32Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java", "diffHunk": "@@ -179,15 +179,7 @@\n \n     /** Regular expression for all escaped chars. */\n     private static final Pattern ALL_ESCAPED_CHARS = Pattern.compile(\"^((\\\\\\\\u)[a-fA-F0-9]{4}\"\n-            + \"|\\\"\"\n-            + \"|'\"\n-            + \"|\\\\\\\\\"\n-            + \"|\\\\\\\\b\"\n-            + \"|\\\\\\\\f\"\n-            + \"|\\\\\\\\n\"\n-            + \"|\\\\\\\\r\"\n-            + \"|\\\\\\\\t\"", "originalCommit": "66b275e80148c7327a09db6fc1c99c22f97e5bef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkzNjIyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r548936226", "bodyText": "@pbludov , bingo ! .... we missed it in grammar support.\n#9132", "author": "romani", "createdAt": "2020-12-26T03:07:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMjMwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkzNzAxNA==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r548937014", "bodyText": "I postponing fix for Check till #9133", "author": "romani", "createdAt": "2020-12-26T03:19:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMjMwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk0NTk3MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/9129#discussion_r548945971", "bodyText": "#9134", "author": "nmancus1", "createdAt": "2020-12-26T05:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwMjMwMA=="}], "type": "inlineReview", "revised_code": {"commit": "f6b22c7414df12234fcfb83080bf1b908a3cc740", "chunk": "diff --git a/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java b/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java\nindex f7a043ceb..3e7d8b8ef 100644\n--- a/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java\n+++ b/src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java\n\n@@ -177,7 +177,10 @@ public class AvoidEscapedUnicodeCharactersCheck\n             + \"|[fF]{3}[9a-bA-B]\"\n             + \"|[fF][eE][fF]{2})\");\n \n-    /** Regular expression for all escaped chars. */\n+    /** Regular expression for all escaped chars.\n+     * See \"EscapeSequence\" at\n+     * https://docs.oracle.com/javase/specs/jls/se8/html/jls-3.html#jls-3.10.6\n+     */\n     private static final Pattern ALL_ESCAPED_CHARS = Pattern.compile(\"^((\\\\\\\\u)[a-fA-F0-9]{4}\"\n             + \"|[\\\"'\\\\\\\\\\\\\\\\b\\\\\\\\f\\\\\\\\n\\\\\\\\r\\\\\\\\t])+$\");\n \n"}}, {"oid": "f6b22c7414df12234fcfb83080bf1b908a3cc740", "url": "https://github.com/checkstyle/checkstyle/commit/f6b22c7414df12234fcfb83080bf1b908a3cc740", "message": "minor: resolve sonar violation 'Regular expressions should not overflow the stack'", "committedDate": "2020-12-26T18:09:08Z", "type": "forcePushed"}, {"oid": "f4921b7a857f5bf991d79aa4ff837552f9560d5a", "url": "https://github.com/checkstyle/checkstyle/commit/f4921b7a857f5bf991d79aa4ff837552f9560d5a", "message": "minor: resolve sonar violation 'Regular expressions should not overflow the stack'", "committedDate": "2020-12-26T19:12:08Z", "type": "forcePushed"}, {"oid": "bebd1face23489cb0e21b442e18ecce212774cb2", "url": "https://github.com/checkstyle/checkstyle/commit/bebd1face23489cb0e21b442e18ecce212774cb2", "message": "Pull #9129: suppress sonar violation 'Regular expressions should not overflow the stack'; add more UTs to prove false positive", "committedDate": "2020-12-26T23:35:51Z", "type": "commit"}, {"oid": "bebd1face23489cb0e21b442e18ecce212774cb2", "url": "https://github.com/checkstyle/checkstyle/commit/bebd1face23489cb0e21b442e18ecce212774cb2", "message": "Pull #9129: suppress sonar violation 'Regular expressions should not overflow the stack'; add more UTs to prove false positive", "committedDate": "2020-12-26T23:35:51Z", "type": "forcePushed"}]}