{"pr_number": 1236, "pr_title": "Updated to use junit 5 parameterization", "pr_createdAt": "2020-01-23T20:11:44Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1236", "timeline": [{"oid": "1970467ce8c5bc3c789b6340a5136542fba24cc7", "url": "https://github.com/microsoft/mssql-jdbc/commit/1970467ce8c5bc3c789b6340a5136542fba24cc7", "message": "updated to use junit 5", "committedDate": "2020-01-23T19:59:12Z", "type": "commit"}, {"oid": "bd4781c1c9572e31657194aac4c4ede8702b383d", "url": "https://github.com/microsoft/mssql-jdbc/commit/bd4781c1c9572e31657194aac4c4ede8702b383d", "message": "Merge remote-tracking branch 'upstream/dev' into aetestfix", "committedDate": "2020-01-23T19:59:18Z", "type": "commit"}, {"oid": "765eba262e66db58f4130bb4b796cb46d443cc25", "url": "https://github.com/microsoft/mssql-jdbc/commit/765eba262e66db58f4130bb4b796cb46d443cc25", "message": "null check", "committedDate": "2020-01-23T21:32:41Z", "type": "commit"}, {"oid": "709e01efb20747219324614d7cd90ab24825b271", "url": "https://github.com/microsoft/mssql-jdbc/commit/709e01efb20747219324614d7cd90ab24825b271", "message": "fixed typo", "committedDate": "2020-01-23T23:33:39Z", "type": "commit"}, {"oid": "f552b119d67641073e892df6d0d134f0cde9baf4", "url": "https://github.com/microsoft/mssql-jdbc/commit/f552b119d67641073e892df6d0d134f0cde9baf4", "message": "added connection string to error msg", "committedDate": "2020-01-27T21:43:44Z", "type": "commit"}, {"oid": "c56726e5994a8757de6892002ce350057dc2180c", "url": "https://github.com/microsoft/mssql-jdbc/commit/c56726e5994a8757de6892002ce350057dc2180c", "message": "Merge remote-tracking branch 'upstream/dev' into aetestfix", "committedDate": "2020-01-28T19:52:29Z", "type": "commit"}, {"oid": "f9572a3185c15545d51fd11a3102491c09b53ab0", "url": "https://github.com/microsoft/mssql-jdbc/commit/f9572a3185c15545d51fd11a3102491c09b53ab0", "message": "add reqExternalSetup back to XA", "committedDate": "2020-01-28T23:43:47Z", "type": "commit"}, {"oid": "5053086e1170a867585da93fbaa8ba05c4a86f2f", "url": "https://github.com/microsoft/mssql-jdbc/commit/5053086e1170a867585da93fbaa8ba05c4a86f2f", "message": "updated fail error string to only include enclave properties", "committedDate": "2020-01-30T00:14:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcwNzc0Ng==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1236#discussion_r372707746", "bodyText": "whats the localhost check for?", "author": "ulvii", "createdAt": "2020-01-30T00:40:18Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -169,33 +147,71 @@ public AESetup(String serverName, String url, String protocol) throws Exception\n             \"PlainDecimal decimal(30)\", \"PlainNumeric numeric(30)\"};\n \n     /**\n-     * Create connection, statement and generate path of resource file\n+     * This provides the arguments (serverName, enclaveAttestationUrl, enclaveAttestationProtocol) for the parameterized\n+     * tests using MethodSource parameters\n      * \n+     * @return\n      * @throws Exception\n      */\n-    @BeforeAll\n-    public static void setupAE() throws Exception {\n+    public static String[][] enclaveParams() throws Exception {\n+        setup();\n+\n+        String[][] param = new String[AbstractTest.enclaveServer.length][3];\n+\n+        for (int i = 0; i < enclaveServer.length; i++) {\n+            param[i][0] = enclaveServer[i];\n+            param[i][1] = null != enclaveAttestationUrl ? enclaveAttestationUrl[i] : null;\n+            param[i][2] = null != enclaveAttestationProtocol ? enclaveAttestationProtocol[i] : null;\n+        }\n+\n+        return param;\n+    }\n+\n+    /**\n+     * Get the AE connection string\n+     * \n+     * @param serverName\n+     * @param url\n+     * @param protocol\n+     */\n+    void setAEConnectionString(String serverName, String url, String protocol) {\n         // skip CI unix tests with localhost servers\n         if (!connectionString.substring(Constants.JDBC_PREFIX.length()).split(Constants.SEMI_COLON)[0]\n-                .contains(\"localhost\") && null != enclaveServer) {\n+                .contains(\"localhost\") && null != serverName) {", "originalCommit": "5053086e1170a867585da93fbaa8ba05c4a86f2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e305a098c90939e8091478470c097209911e2164", "chunk": "diff --git a/src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java b/src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java\nindex f52723e8..fcc63253 100644\n--- a/src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java\n+++ b/src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java\n\n@@ -175,14 +176,12 @@ public class AESetup extends AbstractTest {\n      * @param protocol\n      */\n     void setAEConnectionString(String serverName, String url, String protocol) {\n-        // skip CI unix tests with localhost servers\n-        if (!connectionString.substring(Constants.JDBC_PREFIX.length()).split(Constants.SEMI_COLON)[0]\n-                .contains(\"localhost\") && null != serverName) {\n+        // AEv2 is not supported on Linux servers\n+        if (!isSqlLinux() && null != serverName) {\n             enclaveProperties = \"serverName=\" + serverName + \";\" + Constants.ENCLAVE_ATTESTATIONURL + \"=\" + url + \";\"\n                     + Constants.ENCLAVE_ATTESTATIONPROTOCOL + \"=\" + protocol;\n             AETestConnectionString = connectionString + \";sendTimeAsDateTime=false\" + \";columnEncryptionSetting=enabled\"\n                     + \";\" + enclaveProperties;\n-\n         } else {\n             AETestConnectionString = connectionString + \";sendTimeAsDateTime=false\"\n                     + \";columnEncryptionSetting=enabled\";\n"}}, {"oid": "e305a098c90939e8091478470c097209911e2164", "url": "https://github.com/microsoft/mssql-jdbc/commit/e305a098c90939e8091478470c097209911e2164", "message": "added check for sql linux", "committedDate": "2020-01-30T01:30:21Z", "type": "commit"}, {"oid": "92489bb8cf94c947eb078b34aa996f71dde29159", "url": "https://github.com/microsoft/mssql-jdbc/commit/92489bb8cf94c947eb078b34aa996f71dde29159", "message": "updated linux check to be compat for all servers", "committedDate": "2020-01-30T01:46:46Z", "type": "commit"}, {"oid": "74397d5315ecefd0fc5dbe84d7013058c75d15b2", "url": "https://github.com/microsoft/mssql-jdbc/commit/74397d5315ecefd0fc5dbe84d7013058c75d15b2", "message": "add progress for multiple servers", "committedDate": "2020-01-30T20:47:42Z", "type": "commit"}, {"oid": "59b73cff0458c771af4e39b3d856a4b310cc19c1", "url": "https://github.com/microsoft/mssql-jdbc/commit/59b73cff0458c771af4e39b3d856a4b310cc19c1", "message": "Merge remote-tracking branch 'upstream/dev' into aetestfix", "committedDate": "2020-01-31T00:18:44Z", "type": "commit"}]}