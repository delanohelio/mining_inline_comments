{"pr_number": 1421, "pr_title": "Fix | Fix bulkcopy failing when inserting non-unicode multibyte String", "pr_createdAt": "2020-09-02T21:17:11Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1421", "timeline": [{"oid": "775516e9b32294c1dfe4e91a8288b01f54dc7930", "url": "https://github.com/microsoft/mssql-jdbc/commit/775516e9b32294c1dfe4e91a8288b01f54dc7930", "message": "1414 fix", "committedDate": "2020-09-02T21:14:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNjU3Mg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1421#discussion_r485136572", "bodyText": "Need to read from the table here to make sure the data is inserted correctly.", "author": "ulvii", "createdAt": "2020-09-08T19:07:15Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/bulkCopy/BulkCopyRowSetTest.java", "diffHunk": "@@ -71,18 +73,44 @@ public void testBulkCopyFloatRowSet() throws SQLException {\n         }\r\n     }\r\n \r\n+    @Test\r\n+    public void testBulkCopyJapaneseCollation() throws SQLException {\r\n+        try (Connection con = getConnection(); Statement stmt = connection.createStatement();\r\n+                SQLServerBulkCopy bulkCopy = new SQLServerBulkCopy(con);) {\r\n+            RowSetFactory rsf = RowSetProvider.newFactory();\r\n+            CachedRowSet crs = rsf.createCachedRowSet();\r\n+            RowSetMetaData rsmd = new RowSetMetaDataImpl();\r\n+            rsmd.setColumnCount(1);\r\n+            rsmd.setColumnName(1, \"c1\");\r\n+            rsmd.setColumnType(1, java.sql.Types.VARCHAR);\r\n+            rsmd.setTableName(1, tableName2);\r\n+\r\n+            crs.setMetaData(rsmd);\r\n+            crs.moveToInsertRow();\r\n+            crs.updateString(\"c1\", \"\u3042\u3042\");\r\n+            crs.insertRow();\r\n+            crs.moveToCurrentRow();\r\n+\r\n+            bulkCopy.setDestinationTableName(tableName2);\r\n+            bulkCopy.writeToServer(crs);\r", "originalCommit": "775516e9b32294c1dfe4e91a8288b01f54dc7930", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE0MTgzOQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1421#discussion_r485141839", "bodyText": "Thanks, updated.", "author": "peterbae", "createdAt": "2020-09-08T19:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNjU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "dfd68c23924c8da3ec73a6fe288490236ee341e9", "chunk": "diff --git a/src/test/java/com/microsoft/sqlserver/jdbc/bulkCopy/BulkCopyRowSetTest.java b/src/test/java/com/microsoft/sqlserver/jdbc/bulkCopy/BulkCopyRowSetTest.java\nindex 47291f51..cfb77105 100644\n--- a/src/test/java/com/microsoft/sqlserver/jdbc/bulkCopy/BulkCopyRowSetTest.java\n+++ b/src/test/java/com/microsoft/sqlserver/jdbc/bulkCopy/BulkCopyRowSetTest.java\n\n@@ -80,6 +80,7 @@ public class BulkCopyRowSetTest extends AbstractTest {\n             RowSetFactory rsf = RowSetProvider.newFactory();\n             CachedRowSet crs = rsf.createCachedRowSet();\n             RowSetMetaData rsmd = new RowSetMetaDataImpl();\n+            String unicodeData =  \"\u3042\u3042\";\n             rsmd.setColumnCount(1);\n             rsmd.setColumnName(1, \"c1\");\n             rsmd.setColumnType(1, java.sql.Types.VARCHAR);\n"}}, {"oid": "dfd68c23924c8da3ec73a6fe288490236ee341e9", "url": "https://github.com/microsoft/mssql-jdbc/commit/dfd68c23924c8da3ec73a6fe288490236ee341e9", "message": "update test", "committedDate": "2020-09-08T19:17:36Z", "type": "commit"}, {"oid": "713739453ed34ac473a7cbd4e338bb0bdba54add", "url": "https://github.com/microsoft/mssql-jdbc/commit/713739453ed34ac473a7cbd4e338bb0bdba54add", "message": "test against DW", "committedDate": "2020-09-08T21:15:50Z", "type": "commit"}]}