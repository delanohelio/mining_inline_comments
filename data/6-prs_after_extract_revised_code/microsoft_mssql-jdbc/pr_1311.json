{"pr_number": 1311, "pr_title": "Append server name from connection string to error message", "pr_createdAt": "2020-04-14T05:50:16Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1311", "timeline": [{"oid": "c97b863c95385bdcd1afc897ef39cbebaf495578", "url": "https://github.com/microsoft/mssql-jdbc/commit/c97b863c95385bdcd1afc897ef39cbebaf495578", "message": "Fix AEv2 tests exclude for reqExternalSetup and cleanup (#1247)", "committedDate": "2020-02-05T19:03:48Z", "type": "commit"}, {"oid": "54b5a194e5d46552419c86e0d1f8c800f42d3de8", "url": "https://github.com/microsoft/mssql-jdbc/commit/54b5a194e5d46552419c86e0d1f8c800f42d3de8", "message": "Fix | Add null check for getObject() with LocalTime and LocalDate (#1250)", "committedDate": "2020-02-08T00:19:05Z", "type": "commit"}, {"oid": "672b7d67caae75250c53f82a760e8d3880e62a37", "url": "https://github.com/microsoft/mssql-jdbc/commit/672b7d67caae75250c53f82a760e8d3880e62a37", "message": "added all AKV tests to use reqExternalSetup tag so they will be skipped by default (#1254)\n\n* skip AKV test properly\r\n\r\n* removed enclave properties string to failed errors as enclave tests could be skipped", "committedDate": "2020-02-10T19:04:22Z", "type": "commit"}, {"oid": "3c3331b7b0ff1b27b1e80271bf9ffdc6aae7be79", "url": "https://github.com/microsoft/mssql-jdbc/commit/3c3331b7b0ff1b27b1e80271bf9ffdc6aae7be79", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-25T06:21:47Z", "type": "commit"}, {"oid": "e2c5640370daa89c0d8c1559b5791e99656f78c8", "url": "https://github.com/microsoft/mssql-jdbc/commit/e2c5640370daa89c0d8c1559b5791e99656f78c8", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-26T06:10:08Z", "type": "commit"}, {"oid": "aad696640378b75f3cb8cb24cc2fa299358db9ac", "url": "https://github.com/microsoft/mssql-jdbc/commit/aad696640378b75f3cb8cb24cc2fa299358db9ac", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-28T03:18:02Z", "type": "commit"}, {"oid": "92bf04c2787c3b2a704f641f50cb4a83193f1d6d", "url": "https://github.com/microsoft/mssql-jdbc/commit/92bf04c2787c3b2a704f641f50cb4a83193f1d6d", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-31T01:58:20Z", "type": "commit"}, {"oid": "3ba5ab72008501e23f43dbcbcc333775320ddafa", "url": "https://github.com/microsoft/mssql-jdbc/commit/3ba5ab72008501e23f43dbcbcc333775320ddafa", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-04T05:47:37Z", "type": "commit"}, {"oid": "d20823deffea162b2b17b079cc291f91269558aa", "url": "https://github.com/microsoft/mssql-jdbc/commit/d20823deffea162b2b17b079cc291f91269558aa", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-07T00:45:05Z", "type": "commit"}, {"oid": "6dfe7dec7ab1355e68de12d3c2f75d168e62c300", "url": "https://github.com/microsoft/mssql-jdbc/commit/6dfe7dec7ab1355e68de12d3c2f75d168e62c300", "message": "append servername to error", "committedDate": "2020-04-14T05:46:33Z", "type": "commit"}, {"oid": "d8101e2df78f8f049c9d3951634b187c4fdb3f06", "url": "https://github.com/microsoft/mssql-jdbc/commit/d8101e2df78f8f049c9d3951634b187c4fdb3f06", "message": "updated redirected server msg", "committedDate": "2020-04-14T22:48:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUyMjYwMQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1311#discussion_r408522601", "bodyText": "do null check on serverName", "author": "peterbae", "createdAt": "2020-04-15T01:06:51Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java", "diffHunk": "@@ -163,6 +163,25 @@ SharedTimer getSharedTimer() throws SQLServerException {\n         return this.sharedTimer;\n     }\n \n+    /**\n+     * Get the server name string including redirected server if applicable\n+     * \n+     * @param serverName\n+     * @return\n+     */\n+    String getServerNameString(String serverName) {\n+        String serverNameFromConnectionStr = activeConnectionProperties\n+                .getProperty(SQLServerDriverStringProperty.SERVER_NAME.toString());\n+        if (serverName.equals(serverNameFromConnectionStr)) {", "originalCommit": "d8101e2df78f8f049c9d3951634b187c4fdb3f06", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f8b87f9f28e392c980e5b756d498181c1df6f63d", "chunk": "diff --git a/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java b/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java\nindex 7b3eae08..a5047eb9 100644\n--- a/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java\n+++ b/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java\n\n@@ -172,7 +172,7 @@ public class SQLServerConnection implements ISQLServerConnection, java.io.Serial\n     String getServerNameString(String serverName) {\n         String serverNameFromConnectionStr = activeConnectionProperties\n                 .getProperty(SQLServerDriverStringProperty.SERVER_NAME.toString());\n-        if (serverName.equals(serverNameFromConnectionStr)) {\n+        if (null == serverName || serverName.equals(serverNameFromConnectionStr)) {\n             return serverName;\n         }\n \n"}}, {"oid": "f8b87f9f28e392c980e5b756d498181c1df6f63d", "url": "https://github.com/microsoft/mssql-jdbc/commit/f8b87f9f28e392c980e5b756d498181c1df6f63d", "message": "null check", "committedDate": "2020-04-15T07:14:51Z", "type": "commit"}, {"oid": "660fe0246d3264b2fb62648e90948359c28b94e4", "url": "https://github.com/microsoft/mssql-jdbc/commit/660fe0246d3264b2fb62648e90948359c28b94e4", "message": "added test and check for redirected", "committedDate": "2020-04-22T21:17:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyMzI1Mg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1311#discussion_r414123252", "bodyText": "This line needs to be after if statement.", "author": "ulvii", "createdAt": "2020-04-23T21:05:16Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java", "diffHunk": "@@ -163,6 +163,25 @@ SharedTimer getSharedTimer() throws SQLServerException {\n         return this.sharedTimer;\n     }\n \n+    /**\n+     * Get the server name string including redirected server if applicable\n+     * \n+     * @param serverName\n+     * @return\n+     */\n+    String getServerNameString(String serverName) {\n+        String serverNameFromConnectionStr = activeConnectionProperties", "originalCommit": "660fe0246d3264b2fb62648e90948359c28b94e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2MjE3OQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1311#discussion_r416162179", "bodyText": "this is not resolved", "author": "ulvii", "createdAt": "2020-04-27T21:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyMzI1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "a66cf2a4bc735c992cc056b969791bd1aa84a1f0", "chunk": "diff --git a/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java b/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java\nindex 82cf6293..4f8c7647 100644\n--- a/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java\n+++ b/src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java\n\n@@ -172,7 +172,7 @@ public class SQLServerConnection implements ISQLServerConnection, java.io.Serial\n     String getServerNameString(String serverName) {\n         String serverNameFromConnectionStr = activeConnectionProperties\n                 .getProperty(SQLServerDriverStringProperty.SERVER_NAME.toString());\n-        if (null == serverName || !isRoutedInCurrentAttempt) {\n+        if (null == serverName || !isRoutedInCurrentAttempt || serverName.equals(serverNameFromConnectionStr)) {\n             return serverName;\n         }\n \n"}}, {"oid": "a66cf2a4bc735c992cc056b969791bd1aa84a1f0", "url": "https://github.com/microsoft/mssql-jdbc/commit/a66cf2a4bc735c992cc056b969791bd1aa84a1f0", "message": "added check if redirected server is same as in connection string", "committedDate": "2020-04-23T22:08:04Z", "type": "commit"}, {"oid": "fa0eb914ca11bc3e668d00fcbc0e32724e356a35", "url": "https://github.com/microsoft/mssql-jdbc/commit/fa0eb914ca11bc3e668d00fcbc0e32724e356a35", "message": "removed check for isRoutedInCurrentAttempt", "committedDate": "2020-04-24T18:48:50Z", "type": "commit"}, {"oid": "96f6fe6849599ee23d05832c06a9908818531ad5", "url": "https://github.com/microsoft/mssql-jdbc/commit/96f6fe6849599ee23d05832c06a9908818531ad5", "message": "Merge remote-tracking branch 'upstream/dev' into servername", "committedDate": "2020-04-27T23:33:49Z", "type": "commit"}]}