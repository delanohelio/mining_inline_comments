{"pr_number": 1322, "pr_title": "Check tls protocol version and throw warning", "pr_createdAt": "2020-04-28T17:57:11Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1322", "timeline": [{"oid": "672370e6f64620131b11524f4d60169620af3b5e", "url": "https://github.com/microsoft/mssql-jdbc/commit/672370e6f64620131b11524f4d60169620af3b5e", "message": "Check protocol version and throw warning", "committedDate": "2020-04-28T17:56:12Z", "type": "commit"}, {"oid": "a7e0647f2b919a77de6dfca08d17c38261054d68", "url": "https://github.com/microsoft/mssql-jdbc/commit/a7e0647f2b919a77de6dfca08d17c38261054d68", "message": "Remove unused import", "committedDate": "2020-04-28T17:57:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgxOTk3Nw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r416819977", "bodyText": "There is already SSLProtocol enum in the driver", "author": "ulvii", "createdAt": "2020-04-28T18:09:00Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -1593,6 +1594,9 @@ private void validateServerNameInCertificate(X509Certificate cert) throws Certif\n         SSL_HANDHSAKE_COMPLETE\n     }\n \n+    static final String TLS_1 = \"TLSv1\";", "originalCommit": "672370e6f64620131b11524f4d60169620af3b5e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "chunk": "diff --git a/src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java b/src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java\nindex e5a1dc83..9804184a 100644\n--- a/src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java\n+++ b/src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java\n\n@@ -1594,9 +1593,6 @@ final class TDSChannel implements Serializable {\n         SSL_HANDHSAKE_COMPLETE\n     }\n \n-    static final String TLS_1 = \"TLSv1\";\n-    static final String TLS_1_1 = \"TLSv1.1\";\n-\n     /**\n      * Enables SSL Handshake.\n      * \n"}}, {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "url": "https://github.com/microsoft/mssql-jdbc/commit/a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "message": "Remove existing static strings", "committedDate": "2020-04-28T22:30:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA4NDgyNg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r417084826", "bodyText": "add to SQLServerResource?", "author": "lilgreenbird", "createdAt": "2020-04-29T06:06:13Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -1826,6 +1826,16 @@ else if (con.getTrustManagerClass() != null) {\n             // SSL is now enabled; switch over the channel socket\n             channelSocket = sslSocket;\n \n+            // Check the TLS version\n+            String tlsProtocol = sslSocket.getSession().getProtocol();\n+            if (SSLProtocol.TLS_V10.toString().equalsIgnoreCase(tlsProtocol)\n+                    || SSLProtocol.TLS_V11.toString().equalsIgnoreCase(tlsProtocol)) {\n+                String warningMsg = tlsProtocol\n+                        + \" was negotiated. Please update server and client to use TLSv1.2 at minimum.\";", "originalCommit": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzNDgzMQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r417634831", "bodyText": "Not an error message.", "author": "rene-ye", "createdAt": "2020-04-29T21:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA4NDgyNg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA4NTg0NQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r417085845", "bodyText": "I think it might be better to put add a isMinTLS() (or something) method in SQLServerDriver? That way when a new version comes out it can be changed in 1 place only.", "author": "lilgreenbird", "createdAt": "2020-04-29T06:09:19Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -1826,6 +1826,16 @@ else if (con.getTrustManagerClass() != null) {\n             // SSL is now enabled; switch over the channel socket\n             channelSocket = sslSocket;\n \n+            // Check the TLS version\n+            String tlsProtocol = sslSocket.getSession().getProtocol();\n+            if (SSLProtocol.TLS_V10.toString().equalsIgnoreCase(tlsProtocol)\n+                    || SSLProtocol.TLS_V11.toString().equalsIgnoreCase(tlsProtocol)) {", "originalCommit": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzNDcwMg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r417634702", "bodyText": "this is the only place we check tls version.", "author": "rene-ye", "createdAt": "2020-04-29T21:52:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA4NTg0NQ=="}], "type": "inlineReview", "revised_code": null}]}