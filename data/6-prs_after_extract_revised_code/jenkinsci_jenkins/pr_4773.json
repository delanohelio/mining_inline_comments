{"pr_number": 4773, "pr_title": "JENKINS-62572: Extend Downloadable API slightly", "pr_createdAt": "2020-06-05T17:15:12Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4773", "timeline": [{"oid": "565c91d21970f51822ef0c1de18b120217246275", "url": "https://github.com/jenkinsci/jenkins/commit/565c91d21970f51822ef0c1de18b120217246275", "message": "JENKINS-62572: Extend Downloadable API slightly\n\nThis mainly adds:\n- a static Downloadable.idFor(Class) method, which returns the ID to\n  use for a given class\n  - existing code using a class now uses this method to do the mapping\n    to an ID value\n- an overload of the static Downloadable.get() method taking a Class\n  - applies idFor() and forwards to the existing String-based get()\n\nIt also adds a bit more JavaDoc to existing methods, and adds a few\n@NonNull annotations.", "committedDate": "2020-06-05T16:59:43Z", "type": "commit"}, {"oid": "712a9c4ee100b213c48f54658f1ed788dfb5c79b", "url": "https://github.com/jenkinsci/jenkins/commit/712a9c4ee100b213c48f54658f1ed788dfb5c79b", "message": "Use TODO, not FIXME, for @since.", "committedDate": "2020-06-06T20:41:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyODQyMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4773#discussion_r442928422", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     */\n          \n          \n            \n                     */\n          \n          \n            \n                     @CheckForNull", "author": "oleg-nenashev", "createdAt": "2020-06-19T16:11:41Z", "path": "core/src/main/java/hudson/model/DownloadService.java", "diffHunk": "@@ -410,8 +450,21 @@ public JSONObject reduce(List<JSONObject> jsonList) {\n             return ExtensionList.lookup(Downloadable.class);\n         }\n \n+        /**\n+         * Returns the {@link Downloadable} that has an ID associated with the specified class.\n+         *\n+         * @param clazz The class to use to determine the downloadable's ID.\n+         *\n+         * @since TODO\n+         */\n+        public static Downloadable get(@NonNull Class<?> clazz) {\n+            return Downloadable.get(Downloadable.idFor(clazz));\n+        }\n+\n         /**\n          * Returns the {@link Downloadable} that has the given ID.\n+         *\n+         * @param id The ID to look for.\n          */", "originalCommit": "712a9c4ee100b213c48f54658f1ed788dfb5c79b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88fe0c733ca7113e2976c04adb664dcac4d049f6", "chunk": "diff --git a/core/src/main/java/hudson/model/DownloadService.java b/core/src/main/java/hudson/model/DownloadService.java\nindex b38c28f1c0..4d33bee4b8 100644\n--- a/core/src/main/java/hudson/model/DownloadService.java\n+++ b/core/src/main/java/hudson/model/DownloadService.java\n\n@@ -446,6 +449,7 @@ public class DownloadService {\n         /**\n          * Returns all the registered {@link Downloadable}s.\n          */\n+        @NonNull\n         public static ExtensionList<Downloadable> all() {\n             return ExtensionList.lookup(Downloadable.class);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyODg3MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4773#discussion_r442928870", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public static Downloadable get(@NonNull Class<?> clazz) {\n          \n          \n            \n                    @CheckForNull\n          \n          \n            \n                    public static Downloadable get(@NonNull Class<?> clazz) {", "author": "oleg-nenashev", "createdAt": "2020-06-19T16:12:42Z", "path": "core/src/main/java/hudson/model/DownloadService.java", "diffHunk": "@@ -410,8 +450,21 @@ public JSONObject reduce(List<JSONObject> jsonList) {\n             return ExtensionList.lookup(Downloadable.class);\n         }\n \n+        /**\n+         * Returns the {@link Downloadable} that has an ID associated with the specified class.\n+         *\n+         * @param clazz The class to use to determine the downloadable's ID.\n+         *\n+         * @since TODO\n+         */\n+        public static Downloadable get(@NonNull Class<?> clazz) {", "originalCommit": "712a9c4ee100b213c48f54658f1ed788dfb5c79b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "88fe0c733ca7113e2976c04adb664dcac4d049f6", "chunk": "diff --git a/core/src/main/java/hudson/model/DownloadService.java b/core/src/main/java/hudson/model/DownloadService.java\nindex b38c28f1c0..4d33bee4b8 100644\n--- a/core/src/main/java/hudson/model/DownloadService.java\n+++ b/core/src/main/java/hudson/model/DownloadService.java\n\n@@ -446,6 +449,7 @@ public class DownloadService {\n         /**\n          * Returns all the registered {@link Downloadable}s.\n          */\n+        @NonNull\n         public static ExtensionList<Downloadable> all() {\n             return ExtensionList.lookup(Downloadable.class);\n         }\n"}}, {"oid": "88fe0c733ca7113e2976c04adb664dcac4d049f6", "url": "https://github.com/jenkinsci/jenkins/commit/88fe0c733ca7113e2976c04adb664dcac4d049f6", "message": "Add nullability annotations.", "committedDate": "2020-06-19T18:25:36Z", "type": "commit"}, {"oid": "84c94c5ff5433ef91abd521e9125367ea5436c43", "url": "https://github.com/jenkinsci/jenkins/commit/84c94c5ff5433ef91abd521e9125367ea5436c43", "message": "Merge branch 'master' into JENKINS-62572", "committedDate": "2020-06-19T18:27:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzNzIxMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4773#discussion_r445137212", "bodyText": "This seems to lack an explanation of the ways this can go wrong. I don't think ID associated with the specified class to someone unfamiliar with internals will make sense without more context.\nAlso e.g. {@see #idFor(Class)} could help.", "author": "daniel-beck", "createdAt": "2020-06-24T19:58:32Z", "path": "core/src/main/java/hudson/model/DownloadService.java", "diffHunk": "@@ -406,13 +449,29 @@ public JSONObject reduce(List<JSONObject> jsonList) {\n         /**\n          * Returns all the registered {@link Downloadable}s.\n          */\n+        @NonNull\n         public static ExtensionList<Downloadable> all() {\n             return ExtensionList.lookup(Downloadable.class);\n         }\n \n+        /**\n+         * Returns the {@link Downloadable} that has an ID associated with the specified class.", "originalCommit": "84c94c5ff5433ef91abd521e9125367ea5436c43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE4ODg4Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/4773#discussion_r445188882", "bodyText": "Fair. I added a link to idFor from the JavaDoc of the relevant constructors too.", "author": "Zastai", "createdAt": "2020-06-24T21:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzNzIxMg=="}], "type": "inlineReview", "revised_code": {"commit": "a9d65652a543c265390b8d842c52ceda40360802", "chunk": "diff --git a/core/src/main/java/hudson/model/DownloadService.java b/core/src/main/java/hudson/model/DownloadService.java\nindex 4d33bee4b8..dc4f256b5e 100644\n--- a/core/src/main/java/hudson/model/DownloadService.java\n+++ b/core/src/main/java/hudson/model/DownloadService.java\n\n@@ -455,7 +455,8 @@ public class DownloadService {\n         }\n \n         /**\n-         * Returns the {@link Downloadable} that has an ID associated with the specified class.\n+         * Returns the {@link Downloadable} that has an ID associated with the specified class (as computed via\n+         * {@link #idFor(Class)}).\n          *\n          * @param clazz The class to use to determine the downloadable's ID.\n          *\n"}}, {"oid": "a9d65652a543c265390b8d842c52ceda40360802", "url": "https://github.com/jenkinsci/jenkins/commit/a9d65652a543c265390b8d842c52ceda40360802", "message": "Improve JavaDoc.\n\nNow the methods (constructors + get()) that generate an ID based on a\nclass, explicitly state that they use idFor() for that.", "committedDate": "2020-06-24T21:42:28Z", "type": "commit"}]}