{"pr_number": 4497, "pr_title": "Improve performance when loading tied jobs", "pr_createdAt": "2020-02-14T02:35:00Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4497", "timeline": [{"oid": "19be5e2862c912332719354290a08eb4f2e7f158", "url": "https://github.com/jenkinsci/jenkins/commit/19be5e2862c912332719354290a08eb4f2e7f158", "message": "Optimize getTiedJobs()\n\nSigned-off-by: Raihaan Shouhell <raihaan.shouhell@autodesk.com>", "committedDate": "2020-02-14T02:26:55Z", "type": "commit"}, {"oid": "b9b02650026ad155adc028788bbeb33c07603f0b", "url": "https://github.com/jenkinsci/jenkins/commit/b9b02650026ad155adc028788bbeb33c07603f0b", "message": "Fix test\n\nSigned-off-by: Raihaan Shouhell <raihaan.shouhell@autodesk.com>", "committedDate": "2020-02-14T06:30:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMyODA2Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4497#discussion_r379328067", "bodyText": "I don't think it improves performance that much, but you could stream the result from allItems() and collect it into a list, avoiding the for loop.", "author": "varyvol", "createdAt": "2020-02-14T09:29:34Z", "path": "core/src/main/java/hudson/model/Label.java", "diffHunk": "@@ -389,9 +389,8 @@ private String toString(Collection<? extends ModelObject> model) {\n     @Exported\n     public List<AbstractProject> getTiedJobs() {\n         List<AbstractProject> r = new ArrayList<>();\n-        for (AbstractProject<?,?> p : Jenkins.get().allItems(AbstractProject.class)) {\n-            if(p instanceof TopLevelItem && this.equals(p.getAssignedLabel()))\n-                r.add(p);\n+        for (AbstractProject<?,?> p : Jenkins.get().allItems(AbstractProject.class, i -> i instanceof TopLevelItem && this.equals(i.getAssignedLabel()))) {", "originalCommit": "b9b02650026ad155adc028788bbeb33c07603f0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk3MjM3Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/4497#discussion_r379972372", "bodyText": "Rewrote this bit to use streams", "author": "res0nance", "createdAt": "2020-02-17T03:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMyODA2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "60b3ef12607ed9e1b5b8830a095d34e53d482ec0", "chunk": "diff --git a/core/src/main/java/hudson/model/Label.java b/core/src/main/java/hudson/model/Label.java\nindex 93749a5a24..f9ce39340d 100644\n--- a/core/src/main/java/hudson/model/Label.java\n+++ b/core/src/main/java/hudson/model/Label.java\n\n@@ -388,12 +390,10 @@ public abstract class Label extends Actionable implements Comparable<Label>, Mod\n      */\n     @Exported\n     public List<AbstractProject> getTiedJobs() {\n-        List<AbstractProject> r = new ArrayList<>();\n-        for (AbstractProject<?,?> p : Jenkins.get().allItems(AbstractProject.class, i -> i instanceof TopLevelItem && this.equals(i.getAssignedLabel()))) {\n-            r.add(p);\n-        }\n-        r.sort(Items.BY_FULL_NAME);\n-        return r;\n+        return StreamSupport.stream(Jenkins.get().allItems(AbstractProject.class,\n+                i -> i instanceof TopLevelItem && this.equals(i.getAssignedLabel())).spliterator(),\n+                true)\n+                .sorted(Items.BY_FULL_NAME).collect(Collectors.toList());\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkyMTY5Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4497#discussion_r379921693", "bodyText": "IIRC it reverts the recent change by @LinuxSuRen", "author": "oleg-nenashev", "createdAt": "2020-02-16T18:04:41Z", "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -778,15 +778,15 @@ public String getUrl() {\n     @Exported\n     public Set<LabelAtom> getAssignedLabels() {\n         Node node = getNode();\n-        return (node != null) ? node.getAssignedLabels() : Collections.EMPTY_SET;\n+        return (node != null) ? node.getAssignedLabels() : Collections.emptySet();", "originalCommit": "b9b02650026ad155adc028788bbeb33c07603f0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk1NjY2Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/4497#discussion_r379956662", "bodyText": "Is that so? According to github's blame it seems that this hasn't been changed in 5 years. I changed this as I was in this bit of code and it was warning on my IDE", "author": "res0nance", "createdAt": "2020-02-17T01:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkyMTY5Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "60b3ef12607ed9e1b5b8830a095d34e53d482ec0", "url": "https://github.com/jenkinsci/jenkins/commit/60b3ef12607ed9e1b5b8830a095d34e53d482ec0", "message": "Use Streams", "committedDate": "2020-02-17T03:27:39Z", "type": "commit"}]}