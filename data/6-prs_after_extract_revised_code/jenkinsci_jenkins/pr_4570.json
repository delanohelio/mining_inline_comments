{"pr_number": 4570, "pr_title": "[JENKINS-61457] Allow Jenkins.MANAGE to configure UsageStatistics", "pr_createdAt": "2020-03-12T17:16:48Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4570", "timeline": [{"oid": "c159a692afaddac7409005fd5d18f1321ecdbc22", "url": "https://github.com/jenkinsci/jenkins/commit/c159a692afaddac7409005fd5d18f1321ecdbc22", "message": "[JENKINS-61457] Allow Jenkins.MANAGE to configure UsageStatistics", "committedDate": "2020-03-12T17:08:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk2NDY3NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4570#discussion_r391964675", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(\"Can set UsageStadistics\", j.jenkins.isUsageStatisticsCollected(), not(previousValue));\n          \n          \n            \n                    assertThat(\"Can set UsageStatistics\", j.jenkins.isUsageStatisticsCollected(), not(previousValue));", "author": "daniel-beck", "createdAt": "2020-03-12T23:57:04Z", "path": "test/src/test/java/jenkins/model/JenkinsManagePermissionTest.java", "diffHunk": "@@ -179,6 +178,21 @@ public void globalConfigAllowedWithManagePermission() throws Exception {\n                 updated.getWebResponse(), hasResponseCode(HttpURLConnection.HTTP_OK));\n     }\n \n+    @Issue(\"JENKINS-61457\")\n+    @Test\n+    public void managePermissionCanChangeUsageStatistics() throws Exception {\n+        j.jenkins.setSecurityRealm(j.createDummySecurityRealm());\n+        j.jenkins.setAuthorizationStrategy(new MockAuthorizationStrategy()\n+                                                   .grant(Jenkins.MANAGE, Jenkins.READ).everywhere().toEveryone());\n+\n+        boolean previousValue = j.jenkins.isUsageStatisticsCollected();\n+        HtmlForm form = j.createWebClient().goTo(\"configure\").getFormByName(\"config\");\n+        form.getInputByName(\"_.usageStatisticsCollected\").setChecked(!previousValue);\n+        j.submit(form);\n+\n+        assertThat(\"Can set UsageStadistics\", j.jenkins.isUsageStatisticsCollected(), not(previousValue));", "originalCommit": "c159a692afaddac7409005fd5d18f1321ecdbc22", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8d5fca952eabc6f16a93816c2e1529fd3ae65775", "chunk": "diff --git a/test/src/test/java/jenkins/model/JenkinsManagePermissionTest.java b/test/src/test/java/jenkins/model/JenkinsManagePermissionTest.java\nindex 86c3f41832..02a98e9b8f 100644\n--- a/test/src/test/java/jenkins/model/JenkinsManagePermissionTest.java\n+++ b/test/src/test/java/jenkins/model/JenkinsManagePermissionTest.java\n\n@@ -190,7 +190,7 @@ public class JenkinsManagePermissionTest {\n         form.getInputByName(\"_.usageStatisticsCollected\").setChecked(!previousValue);\n         j.submit(form);\n \n-        assertThat(\"Can set UsageStadistics\", j.jenkins.isUsageStatisticsCollected(), not(previousValue));\n+        assertThat(\"Can set UsageStatistics\", j.jenkins.isUsageStatisticsCollected(), not(previousValue));\n     }\n \n     private String getShell() {\n"}}, {"oid": "8d5fca952eabc6f16a93816c2e1529fd3ae65775", "url": "https://github.com/jenkinsci/jenkins/commit/8d5fca952eabc6f16a93816c2e1529fd3ae65775", "message": "[JENKINS-61457] Fix typo in JenkinsManagePermissionTest\n\nCo-Authored-By: Daniel Beck <1831569+daniel-beck@users.noreply.github.com>", "committedDate": "2020-03-13T09:56:45Z", "type": "commit"}]}