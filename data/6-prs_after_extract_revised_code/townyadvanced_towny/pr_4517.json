{"pr_number": 4517, "pr_title": "Api/generic toggle events", "pr_createdAt": "2020-12-02T23:31:12Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4517", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg1Mjk0MA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4517#discussion_r536852940", "bodyText": "Replace with @param sender {@link CommandSender} running the command.", "author": "TheFlagCourier", "createdAt": "2020-12-05T18:41:36Z", "path": "src/com/palmergames/bukkit/towny/event/town/toggle/TownPreToggleEvent.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package com.palmergames.bukkit.towny.event.town.toggle;\r\n+\r\n+import org.bukkit.Bukkit;\r\n+import org.bukkit.command.CommandSender;\r\n+import org.bukkit.entity.Player;\r\n+import org.bukkit.event.Cancellable;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.jetbrains.annotations.Nullable;\r\n+\r\n+import com.palmergames.bukkit.towny.TownyUniverse;\r\n+import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\r\n+import com.palmergames.bukkit.towny.object.Resident;\r\n+import com.palmergames.bukkit.towny.object.Town;\r\n+import com.palmergames.bukkit.towny.object.Translation;\r\n+\r\n+public abstract class TownPreToggleEvent extends Event implements Cancellable {\r\n+\r\n+\tprivate static final HandlerList handlers = new HandlerList();\r\n+\tprivate Player player = null;\r\n+\tprivate final Town town;\r\n+\tprivate final CommandSender sender;\r\n+\tprivate final boolean isAdminAction;\r\n+\tprivate boolean isCancelled = false;\r\n+\tprivate String cancellationMsg = Translation.of(\"msg_err_command_disable\");\r\n+\t\r\n+\t/**\r\n+\t * A generic cancellable event thrown when a player uses the /town toggle {args} command.\r\n+\t * \r\n+\t * @param player Player who has run the command.\r", "originalCommit": "bc074310f55d5e2d8f411fbb860389a11bb8be48", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "91d264bc250fe7cc380a5ceb759c9427273bbf9f", "chunk": "diff --git a/src/com/palmergames/bukkit/towny/event/town/toggle/TownPreToggleEvent.java b/src/com/palmergames/bukkit/towny/event/town/toggle/TownPreToggleEvent.java\ndeleted file mode 100644\nindex c00b20c81..000000000\n--- a/src/com/palmergames/bukkit/towny/event/town/toggle/TownPreToggleEvent.java\n+++ /dev/null\n\n@@ -1,97 +0,0 @@\n-package com.palmergames.bukkit.towny.event.town.toggle;\n-\n-import org.bukkit.Bukkit;\n-import org.bukkit.command.CommandSender;\n-import org.bukkit.entity.Player;\n-import org.bukkit.event.Cancellable;\n-import org.bukkit.event.Event;\n-import org.bukkit.event.HandlerList;\n-import org.jetbrains.annotations.Nullable;\n-\n-import com.palmergames.bukkit.towny.TownyUniverse;\n-import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\n-import com.palmergames.bukkit.towny.object.Resident;\n-import com.palmergames.bukkit.towny.object.Town;\n-import com.palmergames.bukkit.towny.object.Translation;\n-\n-public abstract class TownPreToggleEvent extends Event implements Cancellable {\n-\n-\tprivate static final HandlerList handlers = new HandlerList();\n-\tprivate Player player = null;\n-\tprivate final Town town;\n-\tprivate final CommandSender sender;\n-\tprivate final boolean isAdminAction;\n-\tprivate boolean isCancelled = false;\n-\tprivate String cancellationMsg = Translation.of(\"msg_err_command_disable\");\n-\t\n-\t/**\n-\t * A generic cancellable event thrown when a player uses the /town toggle {args} command.\n-\t * \n-\t * @param player Player who has run the command.\n-\t * @param town Town which will have something cancelled.\n-\t * @param admin Whether this was executed by an admin.\n-\t */\n-\tpublic TownPreToggleEvent(CommandSender sender, Town town, boolean admin) {\n-\t\tsuper(!Bukkit.getServer().isPrimaryThread());\n-\t\tthis.sender = sender;\n-\t\tif (sender instanceof Player)\n-\t\t\tthis.player = (Player) sender;\n-\t\tthis.town = town;\n-\t\tthis.isAdminAction = admin;\n-\t}\n-\n-\t@Override\n-\tpublic HandlerList getHandlers() {\n-\t\treturn handlers;\n-\t}\n-\n-\tpublic static HandlerList getHandlerList() {\n-\t\treturn handlers;\n-\t}\n-\n-\t@Override\n-\tpublic boolean isCancelled() {\n-\t\treturn isCancelled;\n-\t}\n-\n-\t@Override\n-\tpublic void setCancelled(boolean cancel) {\n-\t\tthis.isCancelled = cancel;\n-\t}\n-\n-\t@Nullable\n-\tpublic Resident getResident() {\n-\t\ttry {\n-\t\t\treturn TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n-\t\t} catch (NotRegisteredException ignored) {}\n-\t\treturn null;\n-\t}\n-\t\n-\t@Nullable\n-\tpublic Player getPlayer() {\n-\t\treturn player;\n-\t}\n-\n-\tpublic Town getTown() {\n-\t\treturn town;\n-\t}\n-\t\n-\tpublic CommandSender getSender() {\n-\t\treturn sender;\n-\t}\n-\n-\tpublic String getCancellationMsg() {\n-\t\treturn cancellationMsg;\n-\t}\n-\n-\tpublic void setCancellationMsg(String cancellationMsg) {\n-\t\tthis.cancellationMsg = cancellationMsg;\n-\t}\n-\n-\t/**\n-\t * @return true if this toggling is because of an admin or console.\n-\t */\n-\tpublic boolean isAdminAction() {\n-\t\treturn isAdminAction;\n-\t}\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg1Mzk2Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/4517#discussion_r536853963", "bodyText": "Same as before, replace with reference to sender instead of player", "author": "TheFlagCourier", "createdAt": "2020-12-05T18:43:03Z", "path": "src/com/palmergames/bukkit/towny/event/town/toggle/TownToggleEvent.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package com.palmergames.bukkit.towny.event.town.toggle;\r\n+\r\n+import org.bukkit.Bukkit;\r\n+import org.bukkit.command.CommandSender;\r\n+import org.bukkit.entity.Player;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.jetbrains.annotations.Nullable;\r\n+\r\n+import com.palmergames.bukkit.towny.TownyUniverse;\r\n+import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\r\n+import com.palmergames.bukkit.towny.object.Resident;\r\n+import com.palmergames.bukkit.towny.object.Town;\r\n+\r\n+public abstract class TownToggleEvent extends Event {\r\n+\r\n+\tprivate static final HandlerList handlers = new HandlerList();\r\n+\tprivate Player player = null;\r\n+\tprivate final Town town;\r\n+\tprivate final CommandSender sender;\r\n+\tprivate final boolean isAdminAction;\r\n+\t\r\n+\t/**\r\n+\t * A generic cancellable event thrown when a player uses the /town toggle {args} command.\r\n+\t * \r\n+\t * @param player Player who has run the command.\r", "originalCommit": "bc074310f55d5e2d8f411fbb860389a11bb8be48", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "91d264bc250fe7cc380a5ceb759c9427273bbf9f", "chunk": "diff --git a/src/com/palmergames/bukkit/towny/event/town/toggle/TownToggleEvent.java b/src/com/palmergames/bukkit/towny/event/town/toggle/TownToggleEvent.java\ndeleted file mode 100644\nindex 34411e13e..000000000\n--- a/src/com/palmergames/bukkit/towny/event/town/toggle/TownToggleEvent.java\n+++ /dev/null\n\n@@ -1,76 +0,0 @@\n-package com.palmergames.bukkit.towny.event.town.toggle;\n-\n-import org.bukkit.Bukkit;\n-import org.bukkit.command.CommandSender;\n-import org.bukkit.entity.Player;\n-import org.bukkit.event.Event;\n-import org.bukkit.event.HandlerList;\n-import org.jetbrains.annotations.Nullable;\n-\n-import com.palmergames.bukkit.towny.TownyUniverse;\n-import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\n-import com.palmergames.bukkit.towny.object.Resident;\n-import com.palmergames.bukkit.towny.object.Town;\n-\n-public abstract class TownToggleEvent extends Event {\n-\n-\tprivate static final HandlerList handlers = new HandlerList();\n-\tprivate Player player = null;\n-\tprivate final Town town;\n-\tprivate final CommandSender sender;\n-\tprivate final boolean isAdminAction;\n-\t\n-\t/**\n-\t * A generic cancellable event thrown when a player uses the /town toggle {args} command.\n-\t * \n-\t * @param player Player who has run the command.\n-\t * @param town Town which will have something cancelled.\n-\t * @param admin Whether this was executed by an admin.\n-\t */\n-\tpublic TownToggleEvent(CommandSender sender, Town town, boolean admin) {\n-\t\tsuper(!Bukkit.getServer().isPrimaryThread());\n-\t\tthis.sender = sender;\n-\t\tif (sender instanceof Player)\n-\t\t\tthis.player = (Player) sender;\n-\t\tthis.town = town;\n-\t\tthis.isAdminAction = admin;\n-\t}\n-\n-\t@Override\n-\tpublic HandlerList getHandlers() {\n-\t\treturn handlers;\n-\t}\n-\n-\tpublic static HandlerList getHandlerList() {\n-\t\treturn handlers;\n-\t}\n-\n-\t@Nullable\n-\tpublic Resident getResident() {\n-\t\ttry {\n-\t\t\treturn TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n-\t\t} catch (NotRegisteredException ignored) {}\n-\t\treturn null;\n-\t}\n-\t\n-\t@Nullable\n-\tpublic Player getPlayer() {\n-\t\treturn player;\n-\t}\n-\n-\tpublic CommandSender getSender() {\n-\t\treturn sender;\n-\t}\n-\t\n-\tpublic Town getTown() {\n-\t\treturn town;\n-\t}\n-\n-\t/**\n-\t * @return true if this toggling is because of an admin or console.\n-\t */\n-\tpublic boolean isAdminAction() {\n-\t\treturn isAdminAction;\n-\t}\n-\t\n-}\n"}}, {"oid": "91d264bc250fe7cc380a5ceb759c9427273bbf9f", "url": "https://github.com/TownyAdvanced/Towny/commit/91d264bc250fe7cc380a5ceb759c9427273bbf9f", "message": "Initial setup of new events.\n\n- Currently throws an NPE on startup, but I have other things to do atm.", "committedDate": "2020-12-06T13:47:02Z", "type": "commit"}, {"oid": "4f85a75821f3267c35cdb454bc7cc0f56053b0ec", "url": "https://github.com/TownyAdvanced/Towny/commit/4f85a75821f3267c35cdb454bc7cc0f56053b0ec", "message": "Typo", "committedDate": "2020-12-06T13:47:02Z", "type": "commit"}, {"oid": "a1b038b1b2e5f93916b148a42e686a2adc60fb7c", "url": "https://github.com/TownyAdvanced/Towny/commit/a1b038b1b2e5f93916b148a42e686a2adc60fb7c", "message": "Adds NationGenericToggleEvent and TownGenericToggleEvents\n\n- Fixes missing \"static\" on two other recent events.", "committedDate": "2020-12-06T13:47:32Z", "type": "commit"}, {"oid": "c207f741467b2c6270e0bbd1bfe58832a693bf7e", "url": "https://github.com/TownyAdvanced/Towny/commit/c207f741467b2c6270e0bbd1bfe58832a693bf7e", "message": "Big change over to using abstract toggle and pretoggle events for towns\nand nations, as well as an preEvent and event for each toggle command.", "committedDate": "2020-12-06T13:48:05Z", "type": "commit"}, {"oid": "a38741cbb4606c547efda6d7a08ebc15714a87cf", "url": "https://github.com/TownyAdvanced/Towny/commit/a38741cbb4606c547efda6d7a08ebc15714a87cf", "message": "Redo using CommandSender instead of Player, include boolean indicating\nit is an admin action.", "committedDate": "2020-12-06T13:48:05Z", "type": "commit"}, {"oid": "42074e1c6ac8f3ed81997075151e57e0d9250619", "url": "https://github.com/TownyAdvanced/Towny/commit/42074e1c6ac8f3ed81997075151e57e0d9250619", "message": "Lets just redo it again then shall we.\n\n- Scraps multiple events for one cancellable event per-toggle.\n- These events fire after all other Towny-side decisions are made on\nwhether the action is allowed by the sender.\n- Adds bonus TownToggleCustomEvent & NationToggleCustomEvent which is\nfired when a subcommand we dont recognize is used.\n  - Defaults to cancelled but is fired to allow another plugin to be\nable to see the args used in order to simulate their having a proper /t\ntoggle command.\n- Switches help menus over to using the newer HelpMenu object.\n- General commenting.\n- Fix the new javadocs.", "committedDate": "2020-12-06T13:49:23Z", "type": "commit"}, {"oid": "5fdc05f732cf8e1f133779194368ff06d32ec03d", "url": "https://github.com/TownyAdvanced/Towny/commit/5fdc05f732cf8e1f133779194368ff06d32ec03d", "message": "Clean up toggling pvp tests.", "committedDate": "2020-12-06T13:49:23Z", "type": "commit"}, {"oid": "826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "url": "https://github.com/TownyAdvanced/Towny/commit/826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "message": "Change togglecustomevents to toggleunknownevents & rebase.", "committedDate": "2020-12-06T13:51:22Z", "type": "commit"}, {"oid": "826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "url": "https://github.com/TownyAdvanced/Towny/commit/826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "message": "Change togglecustomevents to toggleunknownevents & rebase.", "committedDate": "2020-12-06T13:51:22Z", "type": "forcePushed"}]}