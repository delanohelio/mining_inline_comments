{"pr_number": 4442, "pr_title": "Added config node  GTOWN_SETTINGS_OUTLAW_TELEPORT_WORLD - sets world \u2026", "pr_createdAt": "2020-11-15T02:31:59Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4442", "timeline": [{"oid": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a", "url": "https://github.com/TownyAdvanced/Towny/commit/31eabf0118bf7a8f20f31173ae1eaf52afaba89a", "message": "Added config node  GTOWN_SETTINGS_OUTLAW_TELEPORT_WORLD - sets world where outlaws will be teleported if the other options fail.\nCheck if players have townyadmin perms before teleporting them away from a town they are admin in.\nOptionally teleport outlaws to the global_town_settings.outlaw_teleport_world spawn rather than the world the town is in.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>", "committedDate": "2020-11-15T02:22:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTIyNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r523771225", "bodyText": "I would move the isAdmin() test up to be in front of line 788. If this is an admin we need to bail out earlier.", "author": "LlmDl", "createdAt": "2020-11-15T15:08:26Z", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -790,7 +792,7 @@ public void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredEx\n \t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n \t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\", outlaw.getFormattedName()));\n \t\t\t}\n-\t\t\tif (TownySettings.canOutlawsEnterTowns()) {\n+\t\t\tif (TownySettings.canOutlawsEnterTowns() || TownyUniverse.getInstance().getPermissionSource().isTownyAdmin(event.getPlayer())) {", "originalCommit": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0OTEyMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r524849120", "bodyText": "I had it here intentionally so that admins/others with the perm to bypass (which I just added) will still be warned that they are outlawed in case they are also players, but... we likely don't want admins announce if the server is announcing outlaws, so I'm adding the generic admin check on line 791 as well.", "author": "Momshroom", "createdAt": "2020-11-17T02:44:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTIyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "8551a831d3ddf08dc6d29bc97809fc7742783137", "chunk": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex f126a1fd..e3ca4957 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n\n@@ -792,7 +792,8 @@ public class TownyPlayerListener implements Listener {\n \t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n \t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\", outlaw.getFormattedName()));\n \t\t\t}\n-\t\t\tif (TownySettings.canOutlawsEnterTowns() || TownyUniverse.getInstance().getPermissionSource().isTownyAdmin(event.getPlayer())) {\n+\t\t\t// If outlaws can enter towns OR the outlaw has towny.outlaw.tpbypass perm, player is warned but not teleported.\n+\t\t\tif (TownySettings.canOutlawsEnterTowns() || TownyUniverse.getInstance().getPermissionSource().has(outlaw.getPlayer(), PermissionNodes.TOWNY_OUTLAW_TPBYPASS.getNode())) {\n \t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n \t\t\t} else {\n \t\t\t\tif (TownySettings.getOutlawTeleportWarmup() > 0) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTI3MA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r523771270", "bodyText": "Whitespacing change, please revert.", "author": "LlmDl", "createdAt": "2020-11-15T15:08:48Z", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -585,6 +586,7 @@ public void onPlayerMove(PlayerMoveEvent event) {\n \t\tLocation from;\n \t\tPlayerCache cache = plugin.getCache(player);\n \t\tResident resident = null;\n+", "originalCommit": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0Mjg2MQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r524842861", "bodyText": "fixing... not even sure how that happened.", "author": "Momshroom", "createdAt": "2020-11-17T02:23:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTI3MA=="}], "type": "inlineReview", "revised_code": {"commit": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "chunk": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex f126a1fd..1ce6f4c4 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n\n@@ -586,7 +586,6 @@ public class TownyPlayerListener implements Listener {\n \t\tLocation from;\n \t\tPlayerCache cache = plugin.getCache(player);\n \t\tResident resident = null;\n-\n \t\ttry {\n \t\t\tresident = townyUniverse.getDataSource().getResident(player.getName());\n \t\t} catch (NotRegisteredException ignored) {\n"}}, {"oid": "8551a831d3ddf08dc6d29bc97809fc7742783137", "url": "https://github.com/TownyAdvanced/Towny/commit/8551a831d3ddf08dc6d29bc97809fc7742783137", "message": "Added new permission node: towny.outlaw.tpbypass as a child of towny.admin\nChanged the onOutlawEnterTown method to check for this  perm rather than just the generic townyadmin perm so that mods could be given just this perm.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>", "committedDate": "2020-11-17T02:10:27Z", "type": "commit"}, {"oid": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "url": "https://github.com/TownyAdvanced/Towny/commit/6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "message": "Adding a generic townyadmin perm check in line 791 so admins are not announced on servers that announce outlaws in towns.\nFixed whitespace addition as requested.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>", "committedDate": "2020-11-17T02:50:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNTAzNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525115035", "bodyText": "Replace this with TOWNY_ADMIN_OUTLAW_TELEPORT_BYPASS(\"towny.admin.outlaw.teleportbypass\"), added to line 10, below the admin nation zone node.", "author": "LlmDl", "createdAt": "2020-11-17T12:25:41Z", "path": "src/com/palmergames/bukkit/towny/permissions/PermissionNodes.java", "diffHunk": "@@ -378,6 +378,7 @@\n \tTOWNY_CHAT_SPY(\"towny.chat.spy\"),\r\n \t\r\n \tTOWNY_OUTLAW_JAILER(\"towny.outlaw.jailer\"),\r\n+\tTOWNY_OUTLAW_TPBYPASS(\"towny.outlaw.tpbypass\"),\r", "originalCommit": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMwMDg1Ng==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525300856", "bodyText": "Done, but with teleport_bypass to be consistent with nation_zone.", "author": "Momshroom", "createdAt": "2020-11-17T16:29:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNTAzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "20fb94bb006469b7fefef55814054c83b419abb2", "chunk": "diff --git a/src/com/palmergames/bukkit/towny/permissions/PermissionNodes.java b/src/com/palmergames/bukkit/towny/permissions/PermissionNodes.java\nindex a8000dbf..14598e05 100644\n--- a/src/com/palmergames/bukkit/towny/permissions/PermissionNodes.java\n+++ b/src/com/palmergames/bukkit/towny/permissions/PermissionNodes.java\n\n@@ -378,7 +378,6 @@ public enum PermissionNodes {\n \tTOWNY_CHAT_SPY(\"towny.chat.spy\"),\n \t\n \tTOWNY_OUTLAW_JAILER(\"towny.outlaw.jailer\"),\n-\tTOWNY_OUTLAW_TPBYPASS(\"towny.outlaw.tpbypass\"),\n \tTOWNY_BYPASS_DEATH_COSTS(\"towny.bypass_death_costs\"),\n \n \t// Info nodes\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNTY4NA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525115684", "bodyText": "This isTownyAdmin() test should happen earlier, before the outlaw variable is declared.\nAdd a //comment mentioning that this is to keep towns from knowing an admin might be spying on them.", "author": "LlmDl", "createdAt": "2020-11-17T12:26:52Z", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -787,10 +788,11 @@ public void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredEx\n \t\tTown town = event.getEnteredtown();\n \t\t\n \t\tif (town.hasOutlaw(outlaw)) {\n-\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw() && !TownyUniverse.getInstance().getPermissionSource().isTownyAdmin(event.getPlayer())) {", "originalCommit": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMwMDk2OA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525300968", "bodyText": "Done", "author": "Momshroom", "createdAt": "2020-11-17T16:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNTY4NA=="}], "type": "inlineReview", "revised_code": {"commit": "20fb94bb006469b7fefef55814054c83b419abb2", "chunk": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 1ce6f4c4..2a6c8862 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n\n@@ -788,11 +788,12 @@ public class TownyPlayerListener implements Listener {\n \t\tTown town = event.getEnteredtown();\n \t\t\n \t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t// Admins are omitted so towns won't be informed an admin might be spying on them.\n \t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw() && !TownyUniverse.getInstance().getPermissionSource().isTownyAdmin(event.getPlayer())) {\n \t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\", outlaw.getFormattedName()));\n \t\t\t}\n \t\t\t// If outlaws can enter towns OR the outlaw has towny.outlaw.tpbypass perm, player is warned but not teleported.\n-\t\t\tif (TownySettings.canOutlawsEnterTowns() || TownyUniverse.getInstance().getPermissionSource().has(outlaw.getPlayer(), PermissionNodes.TOWNY_OUTLAW_TPBYPASS.getNode())) {\n+\t\t\tif (TownySettings.canOutlawsEnterTowns() || TownyUniverse.getInstance().getPermissionSource().has(outlaw.getPlayer(), PermissionNodes.TOWNY_ADMIN_OUTLAW_TELEPORT_BYPASS.getNode())) {\n \t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n \t\t\t} else {\n \t\t\t\tif (TownySettings.getOutlawTeleportWarmup() > 0) {\n"}}, {"oid": "20fb94bb006469b7fefef55814054c83b419abb2", "url": "https://github.com/TownyAdvanced/Towny/commit/20fb94bb006469b7fefef55814054c83b419abb2", "message": "Making requested changes:\nChanged permission node name to towny.admin.teleport_bypass,\nChanged checked node to TOWNY_ADMIN_OUTLAW_TELEPORT_BYPASS\nAdded requested comment in TownyPlayerListener and changed to use new node name.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>", "committedDate": "2020-11-17T16:27:48Z", "type": "commit"}, {"oid": "6cf0a77b6cf4e7f1ea7975ea4c4e477ad036d01e", "url": "https://github.com/TownyAdvanced/Towny/commit/6cf0a77b6cf4e7f1ea7975ea4c4e477ad036d01e", "message": "Making requested change:\nFixed comment referencing the old permission node.\nAlso, fixed permission node name in non-child node section of plugin.yml\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>", "committedDate": "2020-11-17T19:13:42Z", "type": "commit"}]}