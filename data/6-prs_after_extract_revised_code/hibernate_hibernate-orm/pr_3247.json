{"pr_number": 3247, "pr_title": "HHH-13870 - Extract task action in Gradle plugin to fix up-to-date check", "pr_createdAt": "2020-02-19T15:51:05Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3247", "timeline": [{"oid": "a6193e53c561bd8ffc423099b2bccc7615bb52fb", "url": "https://github.com/hibernate/hibernate-orm/commit/a6193e53c561bd8ffc423099b2bccc7615bb52fb", "message": "HHH-13870 - Extract task action in Gradle plugin to fix up-to-date checks\n\nLambdas are not allowed and cause the compile task to be always out of date", "committedDate": "2020-02-19T15:18:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MTEyOQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3247#discussion_r381391129", "bodyText": "I would suggest adding some comment explaining why lambda is not a viable solution (including the gradle bug link) so we can avoid confusion and raise awareness of when the lambda can be reverted back.", "author": "NathanQingyangXu", "createdAt": "2020-02-19T16:31:03Z", "path": "tooling/hibernate-gradle-plugin/src/main/groovy/org/hibernate/orm/tooling/gradle/HibernatePlugin.java", "diffHunk": "@@ -43,10 +44,29 @@ private void applyEnhancement(final Project project, final HibernateExtension hi\n \n \t\t\tfinal Task compileTask = project.getTasks().findByName( sourceSet.getCompileJavaTaskName() );\n \t\t\tassert compileTask != null;\n-\t\t\tcompileTask.doLast(\n-\t\t\t\t\ttask -> EnhancementHelper.enhance( sourceSet, hibernateExtension.enhance, project )\n-\t\t\t);\n+\t\t\tcompileTask.doLast(new EnhancerAction( sourceSet, hibernateExtension, project ));", "originalCommit": "a6193e53c561bd8ffc423099b2bccc7615bb52fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQwMjQyNg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3247#discussion_r381402426", "bodyText": "Added a comment", "author": "dreis2211", "createdAt": "2020-02-19T16:47:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MTEyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "7ae59b47064024f4f22795233d679aecbdb12c70", "chunk": "diff --git a/tooling/hibernate-gradle-plugin/src/main/groovy/org/hibernate/orm/tooling/gradle/HibernatePlugin.java b/tooling/hibernate-gradle-plugin/src/main/groovy/org/hibernate/orm/tooling/gradle/HibernatePlugin.java\nindex 36ea046728..d35037fc40 100644\n--- a/tooling/hibernate-gradle-plugin/src/main/groovy/org/hibernate/orm/tooling/gradle/HibernatePlugin.java\n+++ b/tooling/hibernate-gradle-plugin/src/main/groovy/org/hibernate/orm/tooling/gradle/HibernatePlugin.java\n\n@@ -48,6 +48,12 @@ public class HibernatePlugin implements Plugin<Project> {\n \t\t}\n \t}\n \n+\t/**\n+\t * Gradle doesn't allow lambdas in doLast or doFirst configurations and causing up-to-date checks\n+\t * to fail. Extracting the lambda to an inner class works around this issue.\n+\t *\n+\t * @link https://github.com/gradle/gradle/issues/5510\n+\t */\n \tprivate static class EnhancerAction implements Action<Task> {\n \n \t\tprivate final SourceSet sourceSet;\n"}}, {"oid": "7ae59b47064024f4f22795233d679aecbdb12c70", "url": "https://github.com/hibernate/hibernate-orm/commit/7ae59b47064024f4f22795233d679aecbdb12c70", "message": "HHH-13870 - Add explaining comment", "committedDate": "2020-02-19T16:47:05Z", "type": "commit"}]}