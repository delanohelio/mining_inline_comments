{"pr_number": 303, "pr_title": "[issue #302] fix rbac bug", "pr_createdAt": "2020-12-01T08:11:07Z", "pr_url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303", "timeline": [{"oid": "4c5823ed8ad42d8a642b4a8117de57b4046e1508", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/4c5823ed8ad42d8a642b4a8117de57b4046e1508", "message": "[issue #302] fix rbac bug", "committedDate": "2020-12-01T07:54:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE0NjM0Mw==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303#discussion_r533146343", "bodyText": "\u6570\u5b57\u90fd\u5b9a\u4e49\u4e0b\u5e38\u91cf\u5427", "author": "tianxiaoliang", "createdAt": "2020-12-01T08:18:57Z", "path": "spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/DefaultHttpTransport.java", "diffHunk": "@@ -69,18 +72,26 @@\n \n   private HttpClient httpClient;\n \n+  private ServiceCombRBACProperties serviceCombRBACProperties;\n+\n+  private List<String> urlList;\n+\n+  private final TaskScheduler scheduler = new ConcurrentTaskScheduler(Executors.newSingleThreadScheduledExecutor());\n+\n   public void setRBACToken(ServiceCombRBACProperties serviceCombRBACProperties,\n       String urls) {\n     if (serviceCombRBACProperties == null ||\n         StringUtils.isEmpty(serviceCombRBACProperties.getName()) ||\n         StringUtils.isEmpty(serviceCombRBACProperties.getPassword())) {\n       return;\n     }\n-    List<String> urlList = URLUtil.dealMultiUrl(urls);\n-    getToken(serviceCombRBACProperties, urlList);\n+    this.urlList = URLUtil.dealMultiUrl(urls);\n+    this.serviceCombRBACProperties = serviceCombRBACProperties;\n+    // 30min token expire  /\n+    scheduler.scheduleWithFixedDelay(this::refreshToken, 28 * 60 * 1000);", "originalCommit": "4c5823ed8ad42d8a642b4a8117de57b4046e1508", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE4MjU3MQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303#discussion_r533182571", "bodyText": "done", "author": "GuoYL123", "createdAt": "2020-12-01T09:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE0NjM0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "f0aa512d91445c5fbae91c5241a70d0ca0d77be5", "chunk": "diff --git a/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/DefaultHttpTransport.java b/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/DefaultHttpTransport.java\nindex 18a3ba8..0e7e0d3 100644\n--- a/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/DefaultHttpTransport.java\n+++ b/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/DefaultHttpTransport.java\n\n@@ -78,6 +78,8 @@ public class DefaultHttpTransport implements HttpTransport {\n \n   private final TaskScheduler scheduler = new ConcurrentTaskScheduler(Executors.newSingleThreadScheduledExecutor());\n \n+  private static final int REFRESH_TOKEN_TIME = 28 * 60 * 1000;\n+\n   public void setRBACToken(ServiceCombRBACProperties serviceCombRBACProperties,\n       String urls) {\n     if (serviceCombRBACProperties == null ||\n"}}, {"oid": "f0aa512d91445c5fbae91c5241a70d0ca0d77be5", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/f0aa512d91445c5fbae91c5241a70d0ca0d77be5", "message": "[issue #297] modify as comment", "committedDate": "2020-12-01T08:31:36Z", "type": "commit"}]}