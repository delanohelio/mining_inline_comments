{"pr_number": 158, "pr_title": "add exponential backoff algorithm", "pr_createdAt": "2020-04-02T13:26:34Z", "pr_url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/158", "timeline": [{"oid": "b581b7534b3eb1e96b923f2790d9a6b33c16ce15", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/b581b7534b3eb1e96b923f2790d9a6b33c16ce15", "message": "add exponential backoff algorithm", "committedDate": "2020-04-02T13:19:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTY2Mw==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/158#discussion_r402679663", "bodyText": "\u8fd9\u4e2a\u4fee\u6539\u4e0d\u592a\u597d\uff0c URLConfig \u662f\u8bfb\u53d6\u914d\u7f6e\u7684\uff0c\u4e0d\u5e94\u5f53\u5728\u8fd9\u91cc\u6267\u884c backoff \u7b97\u6cd5\u3002 \u5efa\u8bae\u91cd\u65b0\u8003\u8651\u5728\u54ea\u513f\u5b9e\u73b0\u3002 \u53e6\u5916\uff0c backoff \u4e0d\u80fd\u6bcf\u6b21\u90fd\u662f 2*\uff0c \u9632\u6b62\u6062\u590d\u8fc7\u6162\u3002 \u53ef\u4ee5\u53c2\u8003 java-chassis \u5728\u4e0b\u4e2a\u5fc3\u8df3\u5468\u671f\u6267\u884c\uff0c\u4ee5\u53ef\u4ee5\u56fa\u5b9a\u5f53\u65f6\u95f4\u5927\u4e8e1\u5206\u949f\u7684\u65f6\u5019\uff0c\u7b49\u5f851\u5206\u949f\u3002", "author": "liubao68", "createdAt": "2020-04-03T00:59:54Z", "path": "spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/URLConfig.java", "diffHunk": "@@ -92,8 +94,23 @@ public synchronized void toggle() {\n     if (resolveUrlSize > 0) {\n       afterDnsResolveIndex = afterDnsResolveIndex + 1 < urlList.size() ? afterDnsResolveIndex + 1\n           : urlList.size() - resolveUrlSize;\n+      if (afterDnsResolveIndex == 0) {\n+        backOff();\n+      }", "originalCommit": "b581b7534b3eb1e96b923f2790d9a6b33c16ce15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcwNjAxOQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/158#discussion_r402706019", "bodyText": "URLConfig \u662f\u7ba1\u7406address\u5217\u8868\u7684\uff0c\u9000\u907f\u7684\u65f6\u673a\u548ctoggle\u7684\u65f6\u673a\u76f8\u4f3c\uff0c\u90fd\u662f\u8bf7\u6c42\u5931\u8d25\uff0c\u611f\u89c9\u5c01\u88c5\u5728\u8fd9\u91cc\u4e5f\u6bd4\u8f83\u5408\u9002", "author": "GuoYL123", "createdAt": "2020-04-03T02:44:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk2MjQ3Mg==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/158#discussion_r402962472", "bodyText": "\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u6240\u6709\u63a5\u53e3\u5931\u8d25\u91cd\u8bd5\u4e5f\u8981\u6267\u884c\u4e86\uff1f", "author": "liubao68", "createdAt": "2020-04-03T12:15:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ4ODcwMA==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/158#discussion_r404488700", "bodyText": "\u53ea\u6709\u8c03\u7528toggle\u65b9\u6cd5\u7684\u5730\u65b9\u662f\u5931\u8d25\u91cd\u8bd5\u7684\uff0c\u6ca1\u6709\u5931\u8d25\u91cd\u8bd5\u7684\u63a5\u53e3\u662f\u4e0d\u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5\u7684\u3002\u5e76\u4e0d\u662f\u6240\u6709\u7684\u63a5\u53e3\u90fd\u8c03\u7528toggle\uff0c\u6240\u4ee5\u5e76\u4e0d\u4f1a\u5bfc\u81f4\u8be5\u95ee\u9898\u3002", "author": "GuoYL123", "createdAt": "2020-04-07T01:46:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTY2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "aaa337271a7c36298da39493af272f8216021227", "chunk": "diff --git a/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/URLConfig.java b/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/URLConfig.java\nindex 31f6c2f..68c01c7 100644\n--- a/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/URLConfig.java\n+++ b/spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/URLConfig.java\n\n@@ -111,6 +113,12 @@ public class URLConfig {\n   }\n \n   public void backOff() {\n+    if (MAX_DELAY_TIME == retryDelayTime) {\n+      return;\n+    }\n     retryDelayTime *= 2;\n+    if (MAX_DELAY_TIME <= retryDelayTime) {\n+      retryDelayTime = MAX_DELAY_TIME;\n+    }\n   }\n }\n"}}, {"oid": "aaa337271a7c36298da39493af272f8216021227", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/aaa337271a7c36298da39493af272f8216021227", "message": "modify as comment", "committedDate": "2020-04-03T02:28:41Z", "type": "commit"}]}