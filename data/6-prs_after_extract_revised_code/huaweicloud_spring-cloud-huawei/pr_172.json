{"pr_number": 172, "pr_title": "add server center watch by websocket", "pr_createdAt": "2020-04-13T08:54:41Z", "pr_url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/172", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc5OTU2OA==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/172#discussion_r407799568", "bodyText": "\u4e0d\u4f7f\u7528\u7684\u4ee3\u7801\u5220\u9664", "author": "liubao68", "createdAt": "2020-04-14T00:42:35Z", "path": "spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/ServiceCombRibbonClientConfiguration.java", "diffHunk": "@@ -41,4 +43,15 @@\n     serverList.initWithNiwsConfig(config);\n     return serverList;\n   }\n+\n+//  @Bean\n+//  public ServerEndpointExporter serverEndpointExporter() {", "originalCommit": "5218558324d9eaec1d3d6e210da64a6b257d19cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6dd333a4ea1cbe1ef8129cf39fa61fab1571cabc", "chunk": "diff --git a/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/ServiceCombRibbonClientConfiguration.java b/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/ServiceCombRibbonClientConfiguration.java\nindex bfbe637..8f9e21e 100644\n--- a/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/ServiceCombRibbonClientConfiguration.java\n+++ b/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/ServiceCombRibbonClientConfiguration.java\n\n@@ -43,15 +41,4 @@ public class ServiceCombRibbonClientConfiguration {\n     serverList.initWithNiwsConfig(config);\n     return serverList;\n   }\n-\n-//  @Bean\n-//  public ServerEndpointExporter serverEndpointExporter() {\n-//    return new ServerEndpointExporter();\n-//  }\n-\n-  @Bean\n-  public ServiceCombServiceListener serviceCombServiceListener(\n-      DynamicServerListLoadBalancer loadBalancer) {\n-    return new ServiceCombServiceListener(loadBalancer);\n-  }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc5OTk1NA==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/172#discussion_r407799954", "bodyText": "\u65e0\u7528\u7684\u4ee3\u7801\u5220\u9664", "author": "liubao68", "createdAt": "2020-04-14T00:43:55Z", "path": "spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/WebSocketConfig.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.huaweicloud.servicecomb.discovery.ribbon;\n+\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;\n+import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n+\n+/**\n+ * @Author GuoYl123\n+ * @Date 2020/4/13\n+ **/\n+//@Configuration\n+//@EnableWebSocketMessageBroker\n+public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {", "originalCommit": "5218558324d9eaec1d3d6e210da64a6b257d19cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6dd333a4ea1cbe1ef8129cf39fa61fab1571cabc", "chunk": "diff --git a/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/WebSocketConfig.java b/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/WebSocketConfig.java\ndeleted file mode 100644\nindex e85a80c..0000000\n--- a/spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/ribbon/WebSocketConfig.java\n+++ /dev/null\n\n@@ -1,15 +0,0 @@\n-package com.huaweicloud.servicecomb.discovery.ribbon;\n-\n-import org.springframework.context.annotation.Configuration;\n-import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;\n-import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n-\n-/**\n- * @Author GuoYl123\n- * @Date 2020/4/13\n- **/\n-//@Configuration\n-//@EnableWebSocketMessageBroker\n-public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {\n-\n-}\n"}}, {"oid": "6dd333a4ea1cbe1ef8129cf39fa61fab1571cabc", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/6dd333a4ea1cbe1ef8129cf39fa61fab1571cabc", "message": "add server center watch", "committedDate": "2020-04-18T09:50:33Z", "type": "commit"}, {"oid": "6dd333a4ea1cbe1ef8129cf39fa61fab1571cabc", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/6dd333a4ea1cbe1ef8129cf39fa61fab1571cabc", "message": "add server center watch", "committedDate": "2020-04-18T09:50:33Z", "type": "forcePushed"}, {"oid": "c3796cb144e3054faf9e3b502ade21a9443eab8b", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/c3796cb144e3054faf9e3b502ade21a9443eab8b", "message": "Merge remote-tracking branch 'remotes/upstream/master' into websocket\n\n# Conflicts:\n#\tspring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/URLConfig.java", "committedDate": "2020-04-18T10:13:11Z", "type": "commit"}, {"oid": "83925243be61705b9a3f3e8e42680f62ae759b1c", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/83925243be61705b9a3f3e8e42680f62ae759b1c", "message": "add config control watch", "committedDate": "2020-04-18T10:23:16Z", "type": "commit"}, {"oid": "cfcab034cd283289dc933dc4f0174b72dd3f90da", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/cfcab034cd283289dc933dc4f0174b72dd3f90da", "message": "Merge remote-tracking branch 'remotes/upstream/master' into websocket", "committedDate": "2020-04-18T10:42:13Z", "type": "commit"}, {"oid": "f9b3c8b7b0e10b2570fad71595af24036d8bd15e", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/f9b3c8b7b0e10b2570fad71595af24036d8bd15e", "message": "when watch is true don't check empty list", "committedDate": "2020-04-18T11:04:04Z", "type": "commit"}, {"oid": "5b1f87bd8c0c1642e509d9e128156a7598b647cf", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/5b1f87bd8c0c1642e509d9e128156a7598b647cf", "message": "fix ut", "committedDate": "2020-04-20T01:00:23Z", "type": "commit"}, {"oid": "6c4a79df2c4d8f2c313c8ae56529909380b0e013", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/6c4a79df2c4d8f2c313c8ae56529909380b0e013", "message": "refactory", "committedDate": "2020-04-20T07:25:53Z", "type": "commit"}, {"oid": "5eec8905edb9a27faea052b236dd5c0f79c763dd", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/5eec8905edb9a27faea052b236dd5c0f79c763dd", "message": "if list is empty, maybe the service center is restarted , check before clear", "committedDate": "2020-04-20T07:50:46Z", "type": "commit"}, {"oid": "b1818a6ee33400a2cef1c2957e24b974f482408c", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/b1818a6ee33400a2cef1c2957e24b974f482408c", "message": "optimization", "committedDate": "2020-04-20T08:49:31Z", "type": "commit"}, {"oid": "80b3ae12d147257fa65de84b4b0010d4f2b2e77a", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/80b3ae12d147257fa65de84b4b0010d4f2b2e77a", "message": "fix ut", "committedDate": "2020-04-21T07:39:34Z", "type": "commit"}, {"oid": "80b3ae12d147257fa65de84b4b0010d4f2b2e77a", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/80b3ae12d147257fa65de84b4b0010d4f2b2e77a", "message": "fix ut", "committedDate": "2020-04-21T07:39:34Z", "type": "forcePushed"}, {"oid": "2dee378386cdfe9c2a1d55dc3be57124d3ee9a1c", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/2dee378386cdfe9c2a1d55dc3be57124d3ee9a1c", "message": "optimization", "committedDate": "2020-04-22T02:01:34Z", "type": "commit"}, {"oid": "2dee378386cdfe9c2a1d55dc3be57124d3ee9a1c", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/2dee378386cdfe9c2a1d55dc3be57124d3ee9a1c", "message": "optimization", "committedDate": "2020-04-22T02:01:34Z", "type": "forcePushed"}]}