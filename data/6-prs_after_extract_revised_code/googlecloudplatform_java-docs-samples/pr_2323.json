{"pr_number": 2323, "pr_title": "feat: add QueryOptions to Spanner samples", "pr_createdAt": "2020-03-05T15:00:27Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2323", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTQyNA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2323#discussion_r392639424", "bodyText": "I think here we want to set it to a version that's not the default so changing it to \"1\" would be ideal.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            db, QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())\n          \n          \n            \n                            db, QueryOptions.newBuilder().setOptimizerVersion(\"1\").build())", "author": "skuruppu", "createdAt": "2020-03-15T04:04:04Z", "path": "spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java", "diffHunk": "@@ -1433,6 +1434,45 @@ static void queryWithTimestampParameter(DatabaseClient dbClient) {\n   }\n   // [END spanner_query_with_timestamp_parameter]\n \n+  // [START spanner_create_client_with_query_options]\n+  static void clientWithQueryOptions(DatabaseId db) {\n+    SpannerOptions options =\n+        SpannerOptions.newBuilder()\n+            .setDefaultQueryOptions(\n+                db, QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())", "originalCommit": "6e418e698c7010d16a5b03e77fd93ed040520def", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY0OTg3NQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2323#discussion_r392649875", "bodyText": "Done.", "author": "olavloite", "createdAt": "2020-03-15T07:49:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTQyNA=="}], "type": "inlineReview", "revised_code": {"commit": "6be69794ce43eb5e60742d40bfa516f0c9f45ab3", "chunk": "diff --git a/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java b/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java\nindex a143a1374..50ab77550 100644\n--- a/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java\n+++ b/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java\n\n@@ -1439,7 +1439,7 @@ public class SpannerSample {\n     SpannerOptions options =\n         SpannerOptions.newBuilder()\n             .setDefaultQueryOptions(\n-                db, QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())\n+                db, QueryOptions.newBuilder().setOptimizerVersion(\"1\").build())\n             .build();\n     Spanner spanner = options.getService();\n     DatabaseClient dbClient = spanner.getDatabaseClient(db);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTQzNA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2323#discussion_r392639434", "bodyText": "Same here, I think it's useful to show how to set the version to something other than the default.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                .withQueryOptions(QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())\n          \n          \n            \n                                .withQueryOptions(QueryOptions.newBuilder().setOptimizerVersion(\"1\").build())", "author": "skuruppu", "createdAt": "2020-03-15T04:04:51Z", "path": "spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java", "diffHunk": "@@ -1433,6 +1434,45 @@ static void queryWithTimestampParameter(DatabaseClient dbClient) {\n   }\n   // [END spanner_query_with_timestamp_parameter]\n \n+  // [START spanner_create_client_with_query_options]\n+  static void clientWithQueryOptions(DatabaseId db) {\n+    SpannerOptions options =\n+        SpannerOptions.newBuilder()\n+            .setDefaultQueryOptions(\n+                db, QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())\n+            .build();\n+    Spanner spanner = options.getService();\n+    DatabaseClient dbClient = spanner.getDatabaseClient(db);\n+    try (ResultSet resultSet =\n+        dbClient\n+            .singleUse()\n+            .executeQuery(Statement.of(\"SELECT SingerId, AlbumId, AlbumTitle FROM Albums\"))) {\n+      while (resultSet.next()) {\n+        System.out.printf(\n+            \"%d %d %s\\n\", resultSet.getLong(0), resultSet.getLong(1), resultSet.getString(2));\n+      }\n+    }\n+  }\n+  // [END spanner_create_client_with_query_options]\n+\n+  // [START spanner_query_with_query_options]\n+  static void queryWithQueryOptions(DatabaseClient dbClient) {\n+    try (ResultSet resultSet =\n+        dbClient\n+            .singleUse()\n+            .executeQuery(\n+                Statement\n+                    .newBuilder(\"SELECT SingerId, AlbumId, AlbumTitle FROM Albums\")\n+                    .withQueryOptions(QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())", "originalCommit": "6e418e698c7010d16a5b03e77fd93ed040520def", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY0OTg4MQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2323#discussion_r392649881", "bodyText": "Done.", "author": "olavloite", "createdAt": "2020-03-15T07:49:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTQzNA=="}], "type": "inlineReview", "revised_code": {"commit": "6be69794ce43eb5e60742d40bfa516f0c9f45ab3", "chunk": "diff --git a/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java b/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java\nindex a143a1374..50ab77550 100644\n--- a/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java\n+++ b/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java\n\n@@ -1439,7 +1439,7 @@ public class SpannerSample {\n     SpannerOptions options =\n         SpannerOptions.newBuilder()\n             .setDefaultQueryOptions(\n-                db, QueryOptions.newBuilder().setOptimizerVersion(\"latest\").build())\n+                db, QueryOptions.newBuilder().setOptimizerVersion(\"1\").build())\n             .build();\n     Spanner spanner = options.getService();\n     DatabaseClient dbClient = spanner.getDatabaseClient(db);\n"}}, {"oid": "6be69794ce43eb5e60742d40bfa516f0c9f45ab3", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/6be69794ce43eb5e60742d40bfa516f0c9f45ab3", "message": "fix: review comments + dependencies", "committedDate": "2020-03-17T13:41:40Z", "type": "forcePushed"}, {"oid": "a98e99a7c6454cdedd17fca00cda6b1a44234888", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a98e99a7c6454cdedd17fca00cda6b1a44234888", "message": "fix: review comments + dependencies", "committedDate": "2020-03-19T08:25:45Z", "type": "forcePushed"}, {"oid": "8defc9c0b585a8dc7ba3bd1c68e08a81c182e86a", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8defc9c0b585a8dc7ba3bd1c68e08a81c182e86a", "message": "feat: add QueryOptions to Spanner samples", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "706b5dc841b13b9b690f5e61d18278796c81543e", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/706b5dc841b13b9b690f5e61d18278796c81543e", "message": "fix: review comments + dependencies", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "611dae9efc74981d896c239a1aeffdbda05426a4", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/611dae9efc74981d896c239a1aeffdbda05426a4", "message": "chore(deps): update dependency io.ktor:ktor-bom to v1.3.2 (#2382)\n\nCo-authored-by: Averi Kitsch <akitsch@google.com>", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "a4412b7ae45ae08a0762fee4a835fb108371930d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a4412b7ae45ae08a0762fee4a835fb108371930d", "message": "Correct path to task queues sample. (#2444)", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "29294d0a76fa5e88d57cdd43e4df349e45187188", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/29294d0a76fa5e88d57cdd43e4df349e45187188", "message": "chore(deps): update dependency com.amazonaws:aws-java-sdk-s3 to v1.11.748 (#2446)\n\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [com.amazonaws:aws-java-sdk-s3](https://aws.amazon.com/sdkforjava) | patch | `1.11.747` -> `1.11.748` |\n\n---\n\n### Renovate configuration\n\n:date: **Schedule**: At any time (no schedule defined).\n\n:vertical_traffic_light: **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n:recycle: **Rebasing**: Never, or you tick the rebase/retry checkbox.\n\n:no_bell: **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR has been generated by [WhiteSource Renovate](https://renovate.whitesourcesoftware.com). View repository job log [here](https://app.renovatebot.com/dashboard#GoogleCloudPlatform/java-docs-samples).", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "4f55144e1f6d6bdd33e012a9c189511453ab1f7f", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4f55144e1f6d6bdd33e012a9c189511453ab1f7f", "message": "Correct error message for unset GOOGLE_CLOUD_PROJECT. (#2448)", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "df9e9cc3029958c0fcec14bbad7b556a7198897a", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/df9e9cc3029958c0fcec14bbad7b556a7198897a", "message": "chore(deps): update dependency com.google.apis:google-api-services-storagetransfer to v1-rev20200316-1.30.9", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "9352d2c61d1e0dffb69b850f430ef4b170f7a472", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/9352d2c61d1e0dffb69b850f430ef4b170f7a472", "message": "deps: upgrade to spanner 1.52", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "7464e858bde9ba7e839d354ac6af08086f43c4dd", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7464e858bde9ba7e839d354ac6af08086f43c4dd", "message": "Maven GAE plugin config updates (#2442)\n\n* Maven config updates\r\n\r\n* lint\r\n\r\n* lint\r\n\r\n* lint", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "29f3c4d48d1079a78e06503acf4bdd6487be48fb", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/29f3c4d48d1079a78e06503acf4bdd6487be48fb", "message": "Update Maven config GAE 11 (#2441)", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "4ae9e6cb9f25e1afe046117b651e2b44a36d6e93", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4ae9e6cb9f25e1afe046117b651e2b44a36d6e93", "message": "chore(deps): update dependency com.google.cloud:google-cloud-spanner to v1.52.0 (#2452)\n\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [com.google.cloud:google-cloud-spanner](https://togithub.com/googleapis/java-spanner) | minor | `1.51.0` -> `1.52.0` |\n\n---\n\n### Release Notes\n\n<details>\n<summary>googleapis/java-spanner</summary>\n\n### [`v1.52.0`](https://togithub.com/googleapis/java-spanner/blob/master/CHANGELOG.md#&#8203;1520httpswwwgithubcomgoogleapisjava-spannercomparev1510v1520-2020-03-20)\n\n[Compare Source](https://togithub.com/googleapis/java-spanner/compare/v1.51.0...v1.52.0)\n\n##### Features\n\n-   add backup support ([#&#8203;100](https://www.github.com/googleapis/java-spanner/issues/100)) ([ed3874a](https://www.github.com/googleapis/java-spanner/commit/ed3874afcf55fe7381354e03dab3a3b97d7eb520))\n-   add Backups protos and APIs ([#&#8203;97](https://www.github.com/googleapis/java-spanner/issues/97)) ([5643c22](https://www.github.com/googleapis/java-spanner/commit/5643c22a4531dac75b9fac5b128eb714a27920a0))\n\n##### Bug Fixes\n\n-   add client id to metrics to avoid collisions ([#&#8203;117](https://www.github.com/googleapis/java-spanner/issues/117)) ([338e136](https://www.github.com/googleapis/java-spanner/commit/338e136508edc6745f9371e8a5d66638021bc8d7)), closes [#&#8203;106](https://www.github.com/googleapis/java-spanner/issues/106)\n-   ignore added interface methods for generated code ([#&#8203;101](https://www.github.com/googleapis/java-spanner/issues/101)) ([402cfa1](https://www.github.com/googleapis/java-spanner/commit/402cfa1e1e2994f7bb1b783cf823021b54fb175e)), closes [#&#8203;99](https://www.github.com/googleapis/java-spanner/issues/99)\n-   use grpc 1.27.2 to prevent version conflicts ([#&#8203;105](https://www.github.com/googleapis/java-spanner/issues/105)) ([37b7c88](https://www.github.com/googleapis/java-spanner/commit/37b7c8859e5f35d85bd14ef72662614fd185c020))\n\n##### Dependencies\n\n-   update core dependencies ([#&#8203;94](https://www.github.com/googleapis/java-spanner/issues/94)) ([f3ca4c9](https://www.github.com/googleapis/java-spanner/commit/f3ca4c99c3d54f64c5eda11e4a4c076140fdbc6a))\n-   update opencensus.version to v0.26.0 ([#&#8203;116](https://www.github.com/googleapis/java-spanner/issues/116)) ([1b8db0b](https://www.github.com/googleapis/java-spanner/commit/1b8db0b407429e02bb1e4c9af839afeed21dac5d))\n\n</details>\n\n---\n\n### Renovate configuration\n\n:date: **Schedule**: At any time (no schedule defined).\n\n:vertical_traffic_light: **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n:recycle: **Rebasing**: Never, or you tick the rebase/retry checkbox.\n\n:no_bell: **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR has been generated by [WhiteSource Renovate](https://renovate.whitesourcesoftware.com). View repository job log [here](https://app.renovatebot.com/dashboard#GoogleCloudPlatform/java-docs-samples).", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "93f282f63a60db09b48d113db4d38576fa18f529", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/93f282f63a60db09b48d113db4d38576fa18f529", "message": "chore(deps): update dependency com.google.cloud:google-cloud-bigquery to v1.109.0", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "7098d528cfbc37d35f3e59c5bd75355923da8c8b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7098d528cfbc37d35f3e59c5bd75355923da8c8b", "message": "chore(deps): update appengine packages to v1.9.79 (#2453)\n\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| com.google.appengine:appengine-api-1.0-sdk | patch | `1.9.78` -> `1.9.79` |\n| com.google.appengine:appengine-tools-sdk | patch | `1.9.78` -> `1.9.79` |\n| com.google.appengine:appengine-api-stubs | patch | `1.9.78` -> `1.9.79` |\n| com.google.appengine:appengine-testing | patch | `1.9.78` -> `1.9.79` |\n| com.google.appengine:appengine-remote-api | patch | `1.9.78` -> `1.9.79` |\n\n---\n\n### Renovate configuration\n\n:date: **Schedule**: At any time (no schedule defined).\n\n:vertical_traffic_light: **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n:recycle: **Rebasing**: Never, or you tick the rebase/retry checkbox.\n\n:no_bell: **Ignore**: Close this PR and you won't be reminded about these updates again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR has been generated by [WhiteSource Renovate](https://renovate.whitesourcesoftware.com). View repository job log [here](https://app.renovatebot.com/dashboard#GoogleCloudPlatform/java-docs-samples).", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "3b9e37b393a1201e83ccd73775c6a4d37c480ee0", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/3b9e37b393a1201e83ccd73775c6a4d37c480ee0", "message": "chore(deps): update dependency com.amazonaws:aws-java-sdk-s3 to v1.11.749", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "f482c4d3dda1d0c7736773b8c11ada923157471c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/f482c4d3dda1d0c7736773b8c11ada923157471c", "message": "Fix Flaky DLP tests (#2447)\n\n* modified tests to cancel job\r\n\r\n* added delay to tests\r\n\r\n* added comment", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "e3ee897a3cd1a85d7b6684b41e8c88d29f57c0cd", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/e3ee897a3cd1a85d7b6684b41e8c88d29f57c0cd", "message": "GCF: Add Slack sample + clean up imports (#2394)\n\n* Add Slack sample + clean up imports\r\n\r\n* Address comments\r\n\r\n* Remove excess gcloudignore + actually disable tests\r\n\r\n* Simplify tests + run them on Kokoro. ALSO bugfix unused shellchecks.\r\n\r\n* Remove extra file\r\n\r\n* HACK: resolve surefire issue via file presence\r\n\r\n* HACK take 2: use a different filepath\r\n\r\n* HACK take 3: use env var not used by local Cloud Build\r\n\r\n* Remove gitignore now that config.json isnt used\r\n\r\n* DBG: print defined env vars\r\n\r\n* DBG take 2\r\n\r\n* DBG take 3\r\n\r\n* DBG take 4\r\n\r\n* DBG take 5\r\n\r\n* DBG take 6\r\n\r\n* DBG take 7\r\n\r\n* Fix tests...?\r\n\r\n* Revert dbg commits + fix tests", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "c29d87915637463c38aa048e426349bde4dc5087", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c29d87915637463c38aa048e426349bde4dc5087", "message": "functions/logging: add stdout/stderr + ignored logs severity note (#2422)\n\n~@vinod-at-google @labtopia IIRC the lack of log severity info is a known issue. (If it's not, let me know so I can hold off on merging this PR.)~", "committedDate": "2020-03-22T17:28:07Z", "type": "commit"}, {"oid": "c29d87915637463c38aa048e426349bde4dc5087", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c29d87915637463c38aa048e426349bde4dc5087", "message": "functions/logging: add stdout/stderr + ignored logs severity note (#2422)\n\n~@vinod-at-google @labtopia IIRC the lack of log severity info is a known issue. (If it's not, let me know so I can hold off on merging this PR.)~", "committedDate": "2020-03-22T17:28:07Z", "type": "forcePushed"}, {"oid": "9696181d17d051aa35771819cd6fdd015cdaf794", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/9696181d17d051aa35771819cd6fdd015cdaf794", "message": "Merge branch 'master' into spanner-query-options", "committedDate": "2020-03-24T02:07:44Z", "type": "commit"}, {"oid": "4e60e83ca5e84ddd584b28b3431bc20f88722e1d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4e60e83ca5e84ddd584b28b3431bc20f88722e1d", "message": "Merge branch 'master' into spanner-query-options", "committedDate": "2020-03-24T23:16:09Z", "type": "commit"}, {"oid": "236a83cd06498f1aaf039eb03c68872ef3a8b0b7", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/236a83cd06498f1aaf039eb03c68872ef3a8b0b7", "message": "Merge branch 'master' into spanner-query-options", "committedDate": "2020-03-25T00:07:17Z", "type": "commit"}]}