{"pr_number": 1939, "pr_title": "translate: add v3 samples for translate text with model", "pr_createdAt": "2020-01-09T18:26:24Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/1939", "timeline": [{"oid": "b2031bc4129bf48103bbfae79bc009278341b6bc", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b2031bc4129bf48103bbfae79bc009278341b6bc", "message": "translate: add v3 samples for translate text with model", "committedDate": "2020-01-09T18:25:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5ODM5OA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/1939#discussion_r366498398", "bodyText": "nit: I think some comments for on each section might add value. Something like // Configure the source of the file from a GCS bucket, // Configure the output file in a GCS bucket, etc.", "author": "kurtisvg", "createdAt": "2020-01-14T18:23:06Z", "path": "translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.translate;\n+\n+// [START translate_v3_batch_translate_text_with_model]\n+import com.google.api.gax.longrunning.OperationFuture;\n+import com.google.cloud.translate.v3.BatchTranslateMetadata;\n+import com.google.cloud.translate.v3.BatchTranslateResponse;\n+import com.google.cloud.translate.v3.BatchTranslateTextRequest;\n+import com.google.cloud.translate.v3.GcsDestination;\n+import com.google.cloud.translate.v3.GcsSource;\n+import com.google.cloud.translate.v3.InputConfig;\n+import com.google.cloud.translate.v3.LocationName;\n+import com.google.cloud.translate.v3.OutputConfig;\n+import com.google.cloud.translate.v3.TranslationServiceClient;\n+\n+import java.io.IOException;\n+import java.util.concurrent.ExecutionException;\n+\n+public class BatchTranslateTextWithModel {\n+\n+  public static void batchTranslateTextWithModel()\n+      throws InterruptedException, ExecutionException, IOException {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"YOUR-PROJECT-ID\";\n+    // Supported Languages: https://cloud.google.com/translate/docs/languages\n+    String sourceLanguage = \"your-source-language\";\n+    String targetLanguage = \"your-target-language\";\n+    String inputUri = \"gs://your-gcs-bucket/path/to/input/file.txt\";\n+    String outputUri = \"gs://your-gcs-bucket/path/to/results/\";\n+    String modelId = \"YOUR-MODEL-ID\";\n+    batchTranslateTextWithModel(\n+        projectId, sourceLanguage, targetLanguage, inputUri, outputUri, modelId);\n+  }\n+\n+  // Batch translate text using AutoML Translation model\n+  public static void batchTranslateTextWithModel(\n+      String projectId,\n+      String sourceLanguage,\n+      String targetLanguage,\n+      String inputUri,\n+      String outputUri,\n+      String modelId)\n+      throws IOException, ExecutionException, InterruptedException {\n+\n+    // Initialize client that will be used to send requests. This client only needs to be created\n+    // once, and can be reused for multiple requests. After completing all of your requests, call\n+    // the \"close\" method on the client to safely clean up any remaining background resources.\n+    try (TranslationServiceClient client = TranslationServiceClient.create()) {\n+      // Supported Locations: `global`, [glossary location], or [model location]\n+      // Glossaries must be hosted in `us-central1`\n+      // Custom Models must use the same location as your model. (us-central1)\n+      String location = \"us-central1\";\n+      LocationName parent = LocationName.of(projectId, location);\n+\n+      GcsSource gcsSource = GcsSource.newBuilder().setInputUri(inputUri).build();", "originalCommit": "b2031bc4129bf48103bbfae79bc009278341b6bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "638afd4522234d094ff7e19133aa6ae11b717435", "chunk": "diff --git a/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java b/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java\nindex 14b2fcce6..bbf2aff42 100644\n--- a/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java\n+++ b/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java\n\n@@ -67,19 +67,23 @@ public class BatchTranslateTextWithModel {\n       String location = \"us-central1\";\n       LocationName parent = LocationName.of(projectId, location);\n \n+      // Configure the source of the file from a GCS bucket\n       GcsSource gcsSource = GcsSource.newBuilder().setInputUri(inputUri).build();\n       // Supported Mime Types: https://cloud.google.com/translate/docs/supported-formats\n       InputConfig inputConfig =\n           InputConfig.newBuilder().setGcsSource(gcsSource).setMimeType(\"text/plain\").build();\n \n+      // Configure where to store the output in a GCS bucket\n       GcsDestination gcsDestination =\n           GcsDestination.newBuilder().setOutputUriPrefix(outputUri).build();\n       OutputConfig outputConfig =\n           OutputConfig.newBuilder().setGcsDestination(gcsDestination).build();\n \n+      // Configure the model used in the request\n       String modelPath =\n           String.format(\"projects/%s/locations/%s/models/%s\", projectId, location, modelId);\n \n+      // Build the request that will be sent to the API\n       BatchTranslateTextRequest request =\n           BatchTranslateTextRequest.newBuilder()\n               .setParent(parent.toString())\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5ODkzOA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/1939#discussion_r366498938", "bodyText": "nit: A comment here clarifying that this will send the request to the server to start the job asynchronously would also be useful.", "author": "kurtisvg", "createdAt": "2020-01-14T18:24:07Z", "path": "translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.translate;\n+\n+// [START translate_v3_batch_translate_text_with_model]\n+import com.google.api.gax.longrunning.OperationFuture;\n+import com.google.cloud.translate.v3.BatchTranslateMetadata;\n+import com.google.cloud.translate.v3.BatchTranslateResponse;\n+import com.google.cloud.translate.v3.BatchTranslateTextRequest;\n+import com.google.cloud.translate.v3.GcsDestination;\n+import com.google.cloud.translate.v3.GcsSource;\n+import com.google.cloud.translate.v3.InputConfig;\n+import com.google.cloud.translate.v3.LocationName;\n+import com.google.cloud.translate.v3.OutputConfig;\n+import com.google.cloud.translate.v3.TranslationServiceClient;\n+\n+import java.io.IOException;\n+import java.util.concurrent.ExecutionException;\n+\n+public class BatchTranslateTextWithModel {\n+\n+  public static void batchTranslateTextWithModel()\n+      throws InterruptedException, ExecutionException, IOException {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"YOUR-PROJECT-ID\";\n+    // Supported Languages: https://cloud.google.com/translate/docs/languages\n+    String sourceLanguage = \"your-source-language\";\n+    String targetLanguage = \"your-target-language\";\n+    String inputUri = \"gs://your-gcs-bucket/path/to/input/file.txt\";\n+    String outputUri = \"gs://your-gcs-bucket/path/to/results/\";\n+    String modelId = \"YOUR-MODEL-ID\";\n+    batchTranslateTextWithModel(\n+        projectId, sourceLanguage, targetLanguage, inputUri, outputUri, modelId);\n+  }\n+\n+  // Batch translate text using AutoML Translation model\n+  public static void batchTranslateTextWithModel(\n+      String projectId,\n+      String sourceLanguage,\n+      String targetLanguage,\n+      String inputUri,\n+      String outputUri,\n+      String modelId)\n+      throws IOException, ExecutionException, InterruptedException {\n+\n+    // Initialize client that will be used to send requests. This client only needs to be created\n+    // once, and can be reused for multiple requests. After completing all of your requests, call\n+    // the \"close\" method on the client to safely clean up any remaining background resources.\n+    try (TranslationServiceClient client = TranslationServiceClient.create()) {\n+      // Supported Locations: `global`, [glossary location], or [model location]\n+      // Glossaries must be hosted in `us-central1`\n+      // Custom Models must use the same location as your model. (us-central1)\n+      String location = \"us-central1\";\n+      LocationName parent = LocationName.of(projectId, location);\n+\n+      GcsSource gcsSource = GcsSource.newBuilder().setInputUri(inputUri).build();\n+      // Supported Mime Types: https://cloud.google.com/translate/docs/supported-formats\n+      InputConfig inputConfig =\n+          InputConfig.newBuilder().setGcsSource(gcsSource).setMimeType(\"text/plain\").build();\n+\n+      GcsDestination gcsDestination =\n+          GcsDestination.newBuilder().setOutputUriPrefix(outputUri).build();\n+      OutputConfig outputConfig =\n+          OutputConfig.newBuilder().setGcsDestination(gcsDestination).build();\n+\n+      String modelPath =\n+          String.format(\"projects/%s/locations/%s/models/%s\", projectId, location, modelId);\n+\n+      BatchTranslateTextRequest request =\n+          BatchTranslateTextRequest.newBuilder()\n+              .setParent(parent.toString())\n+              .setSourceLanguageCode(sourceLanguage)\n+              .addTargetLanguageCodes(targetLanguage)\n+              .addInputConfigs(inputConfig)\n+              .setOutputConfig(outputConfig)\n+              .putModels(targetLanguage, modelPath)\n+              .build();\n+\n+      OperationFuture<BatchTranslateResponse, BatchTranslateMetadata> future =", "originalCommit": "b2031bc4129bf48103bbfae79bc009278341b6bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "638afd4522234d094ff7e19133aa6ae11b717435", "chunk": "diff --git a/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java b/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java\nindex 14b2fcce6..bbf2aff42 100644\n--- a/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java\n+++ b/translate/cloud-client/src/main/java/com/example/translate/BatchTranslateTextWithModel.java\n\n@@ -67,19 +67,23 @@ public class BatchTranslateTextWithModel {\n       String location = \"us-central1\";\n       LocationName parent = LocationName.of(projectId, location);\n \n+      // Configure the source of the file from a GCS bucket\n       GcsSource gcsSource = GcsSource.newBuilder().setInputUri(inputUri).build();\n       // Supported Mime Types: https://cloud.google.com/translate/docs/supported-formats\n       InputConfig inputConfig =\n           InputConfig.newBuilder().setGcsSource(gcsSource).setMimeType(\"text/plain\").build();\n \n+      // Configure where to store the output in a GCS bucket\n       GcsDestination gcsDestination =\n           GcsDestination.newBuilder().setOutputUriPrefix(outputUri).build();\n       OutputConfig outputConfig =\n           OutputConfig.newBuilder().setGcsDestination(gcsDestination).build();\n \n+      // Configure the model used in the request\n       String modelPath =\n           String.format(\"projects/%s/locations/%s/models/%s\", projectId, location, modelId);\n \n+      // Build the request that will be sent to the API\n       BatchTranslateTextRequest request =\n           BatchTranslateTextRequest.newBuilder()\n               .setParent(parent.toString())\n"}}, {"oid": "c7afdb82835772065e75886e696ec273d0afe28d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c7afdb82835772065e75886e696ec273d0afe28d", "message": "Merge branch 'master' into translate-text-model", "committedDate": "2020-01-14T18:59:07Z", "type": "commit"}, {"oid": "638afd4522234d094ff7e19133aa6ae11b717435", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/638afd4522234d094ff7e19133aa6ae11b717435", "message": "Add clarifying comments that explain chunks of the code", "committedDate": "2020-01-14T20:10:44Z", "type": "commit"}, {"oid": "89bb7b5b5f5337d39ba9a1a0e4c4da4e980a908e", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/89bb7b5b5f5337d39ba9a1a0e4c4da4e980a908e", "message": "Merge branch 'master' into translate-text-model", "committedDate": "2020-01-14T20:29:21Z", "type": "commit"}, {"oid": "8d030e705a492a4c6543f4ae4212c051946c84dd", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8d030e705a492a4c6543f4ae4212c051946c84dd", "message": "Merge branch 'master' into translate-text-model", "committedDate": "2020-01-14T20:44:57Z", "type": "commit"}]}