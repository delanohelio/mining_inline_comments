{"pr_number": 4127, "pr_title": "chore: added UIID to prevent concurrency error", "pr_createdAt": "2020-11-02T19:01:56Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4127", "timeline": [{"oid": "12a64df629517f121fd0ea41bd3be3e5eb5c6bce", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/12a64df629517f121fd0ea41bd3be3e5eb5c6bce", "message": "chore: added UIID to prevent concurrency error", "committedDate": "2020-11-02T19:01:14Z", "type": "commit"}, {"oid": "2d6b13aea90c70a3928040c653e9cc572c89abb7", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/2d6b13aea90c70a3928040c653e9cc572c89abb7", "message": "fixed lint", "committedDate": "2020-11-02T19:05:23Z", "type": "commit"}, {"oid": "d4143bade53ea3797aaff5b22ca9cedc830604e2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d4143bade53ea3797aaff5b22ca9cedc830604e2", "message": "reverted registry ID", "committedDate": "2020-11-02T19:21:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMDUyNw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4127#discussion_r516230527", "bodyText": "If two or more of these started at the same time, there could be duplicates.  Would that be ok?  If not, you should also add a UUID here.", "author": "lesv", "createdAt": "2020-11-02T20:18:25Z", "path": "iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java", "diffHunk": "@@ -52,10 +53,16 @@\n   private static final String CLOUD_REGION = \"us-central1\";\n   private static final String ES_PATH = \"resources/ec_public.pem\";\n   private static final String PROJECT_ID = System.getenv(\"GOOGLE_CLOUD_PROJECT\");\n-  private static final String REGISTRY_ID = \"java-reg-\" + (System.currentTimeMillis() / 100L);\n+  private static final String REGISTRY_ID =\n+      \"java-reg-\"\n+          + (System.currentTimeMillis() / 100L);", "originalCommit": "d4143bade53ea3797aaff5b22ca9cedc830604e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMjAwMQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4127#discussion_r516232001", "bodyText": "there is clearRegistries function that deletes the registries based on created Date (from oldest to new ones).", "author": "munkhuushmgl", "createdAt": "2020-11-02T20:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMDUyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzNzkxOQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4127#discussion_r516237919", "bodyText": "You might be better off using java-reg-UUID-TimeMillis.", "author": "lesv", "createdAt": "2020-11-02T20:33:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMDUyNw=="}], "type": "inlineReview", "revised_code": {"commit": "8a90c37a81fa0dba03808e406021b9ddd5b9e31b", "chunk": "diff --git a/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java b/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java\nindex b0f671ccd..0f0a17fd1 100644\n--- a/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java\n+++ b/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java\n\n@@ -60,9 +60,7 @@ public class ManagerIT {\n   private static final String PKCS_PATH = \"resources/rsa_private_pkcs8\";\n   private static final String TOPIC_ID =\n       \"java-pst-\"\n-          + (System.currentTimeMillis() / 100L)\n-          + \"-\"\n-          + UUID.randomUUID().toString().substring(0, 10);\n+          + UUID.randomUUID().toString().substring(0, 20);\n   private static final String MEMBER = \"group:dpebot@google.com\";\n   private static final String ROLE = \"roles/viewer\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMTEwMA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4127#discussion_r516231100", "bodyText": "Seems like overkill to have currentTimeMillis + uuid, why not just UUID()?", "author": "lesv", "createdAt": "2020-11-02T20:19:35Z", "path": "iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java", "diffHunk": "@@ -52,10 +53,16 @@\n   private static final String CLOUD_REGION = \"us-central1\";\n   private static final String ES_PATH = \"resources/ec_public.pem\";\n   private static final String PROJECT_ID = System.getenv(\"GOOGLE_CLOUD_PROJECT\");\n-  private static final String REGISTRY_ID = \"java-reg-\" + (System.currentTimeMillis() / 100L);\n+  private static final String REGISTRY_ID =\n+      \"java-reg-\"\n+          + (System.currentTimeMillis() / 100L);\n   private static final String RSA_PATH = \"resources/rsa_cert.pem\";\n   private static final String PKCS_PATH = \"resources/rsa_private_pkcs8\";\n-  private static final String TOPIC_ID = \"java-pst-\" + (System.currentTimeMillis() / 100L);\n+  private static final String TOPIC_ID =\n+      \"java-pst-\"\n+          + (System.currentTimeMillis() / 100L)\n+          + \"-\"\n+          + UUID.randomUUID().toString().substring(0, 10);", "originalCommit": "d4143bade53ea3797aaff5b22ca9cedc830604e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMjU4MQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4127#discussion_r516232581", "bodyText": "Hmm, I do not know why it was done this way, but I will just replace with just UUID()", "author": "munkhuushmgl", "createdAt": "2020-11-02T20:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMTEwMA=="}], "type": "inlineReview", "revised_code": {"commit": "8a90c37a81fa0dba03808e406021b9ddd5b9e31b", "chunk": "diff --git a/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java b/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java\nindex b0f671ccd..0f0a17fd1 100644\n--- a/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java\n+++ b/iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java\n\n@@ -60,9 +60,7 @@ public class ManagerIT {\n   private static final String PKCS_PATH = \"resources/rsa_private_pkcs8\";\n   private static final String TOPIC_ID =\n       \"java-pst-\"\n-          + (System.currentTimeMillis() / 100L)\n-          + \"-\"\n-          + UUID.randomUUID().toString().substring(0, 10);\n+          + UUID.randomUUID().toString().substring(0, 20);\n   private static final String MEMBER = \"group:dpebot@google.com\";\n   private static final String ROLE = \"roles/viewer\";\n \n"}}, {"oid": "8a90c37a81fa0dba03808e406021b9ddd5b9e31b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8a90c37a81fa0dba03808e406021b9ddd5b9e31b", "message": "replaced with single UUID instead nested ones", "committedDate": "2020-11-02T20:24:07Z", "type": "commit"}, {"oid": "530603721552b68549fc609f41385e34ec486c9c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/530603721552b68549fc609f41385e34ec486c9c", "message": "replaced registry millis with UUID +  millis", "committedDate": "2020-11-02T21:07:05Z", "type": "commit"}, {"oid": "d67ad8cd1cd823b11a60e4406e7ad2607b0e9ea6", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d67ad8cd1cd823b11a60e4406e7ad2607b0e9ea6", "message": "fixed erros", "committedDate": "2020-11-02T23:21:16Z", "type": "commit"}]}