{"pr_number": 3593, "pr_title": "samples: fixed flaky test by increasing timeout on client settings", "pr_createdAt": "2020-08-21T22:28:42Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3593", "timeline": [{"oid": "25400e47d2a4331daabdc46f0e32e2538f9a3dee", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/25400e47d2a4331daabdc46f0e32e2538f9a3dee", "message": "samples: fixed flaky test by increasing timeout on client settings", "committedDate": "2020-08-21T22:27:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5NzgyMA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3593#discussion_r474997820", "bodyText": "Wow this looks wrong. Using the output of a builder twice.\n@kurtisvg @averikitsch @chingor13 PTAL\nI'm going to approve, but this just feels confusing, recursive and weird. Does the builder get reset after a .build()", "author": "lesv", "createdAt": "2020-08-21T22:36:18Z", "path": "automl/beta/src/main/java/com/example/automl/ListDatasets.java", "diffHunk": "@@ -38,7 +40,20 @@ static void listDatasets(String projectId) throws IOException {\n     // Initialize client that will be used to send requests. This client only needs to be created\n     // once, and can be reused for multiple requests. After completing all of your requests, call\n     // the \"close\" method on the client to safely clean up any remaining background resources.\n-    try (AutoMlClient client = AutoMlClient.create()) {\n+    AutoMlSettings.Builder autoMlSettingsBuilder = AutoMlSettings.newBuilder();\n+\n+    autoMlSettingsBuilder\n+        .listDatasetsSettings()\n+        .setRetrySettings(\n+            autoMlSettingsBuilder\n+                .listDatasetsSettings()\n+                .getRetrySettings()\n+                .toBuilder()\n+                .setTotalTimeout(Duration.ofSeconds(15))\n+                .build());\n+    AutoMlSettings autoMlSettings = autoMlSettingsBuilder.build();", "originalCommit": "25400e47d2a4331daabdc46f0e32e2538f9a3dee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5ODU3Mg==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3593#discussion_r474998572", "bodyText": "AutoML Beta samples have become flaky before BOM update. I think we should increase default timeout values on client library.", "author": "munkhuushmgl", "createdAt": "2020-08-21T22:39:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5OTQzMA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3593#discussion_r474999430", "bodyText": "Mike - the issue isn't the need, I'm totally happy w/ that. It's using the same builder twice in a recursive manor that I'm questioning.  What you are doing is probably ok, I'm just asking for another opinion.", "author": "lesv", "createdAt": "2020-08-21T22:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTAwMDIyMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3593#discussion_r475000223", "bodyText": "I would agree that this looks wrong, but this is the example in the docs https://googleapis.dev/java/google-cloud-automl/latest/com/google/cloud/automl/v1beta1/AutoMlSettings.html", "author": "averikitsch", "createdAt": "2020-08-21T22:46:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTAwMDU2NQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3593#discussion_r475000565", "bodyText": "The common on L40 is probably better being right next to L56.\nI agree with Les that it look funky, but it is how it's described in the javadocs so probably an issue to raise with the library. (Although according to this you don't need to call the .build()).", "author": "kurtisvg", "createdAt": "2020-08-21T22:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5NzgyMA=="}], "type": "inlineReview", "revised_code": null}]}