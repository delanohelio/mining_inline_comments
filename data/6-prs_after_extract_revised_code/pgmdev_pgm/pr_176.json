{"pr_number": 176, "pr_title": "Implement custom sidebar messages, resolves Electroid#157", "pr_createdAt": "2020-01-02T16:52:58Z", "pr_url": "https://github.com/PGMDev/PGM/pull/176", "timeline": [{"oid": "7ae8bf5561e2f5ef36e7d9dab66e0ff5e1e516b0", "url": "https://github.com/PGMDev/PGM/commit/7ae8bf5561e2f5ef36e7d9dab66e0ff5e1e516b0", "message": "Implement custom sidebar messages, resolves Electroid#157\n\nSigned-off-by: Meeples10 <8867705+Meeples10@users.noreply.github.com>", "committedDate": "2020-01-02T16:51:11Z", "type": "commit"}, {"oid": "922936e4afc8da27b46e43f766060d8f5d46240d", "url": "https://github.com/PGMDev/PGM/commit/922936e4afc8da27b46e43f766060d8f5d46240d", "message": "Add final newline to config.yml\n\nSigned-off-by: Meeples10 <8867705+Meeples10@users.noreply.github.com>", "committedDate": "2020-01-02T16:59:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU1NjE0NQ==", "url": "https://github.com/PGMDev/PGM/pull/176#discussion_r362556145", "bodyText": "Would maybe be easier to have message-top and message-bottom, with the ability to leave either of them blank?\nThat way you convert 3 settings into 2 (remove enabled & atTop, keep message-top and message-bottom), it gives more flexibility for people trying to configure it, and it's (maybe?) easier to code the condition.", "author": "Pablete1234", "createdAt": "2020-01-02T17:22:47Z", "path": "src/main/java/tc/oc/pgm/Config.java", "diffHunk": "@@ -384,4 +384,19 @@ public int getDestroyMatchDelay() {\n       return destroyMatchDelay;\n     }\n   }\n+\n+  public static class SidebarMessage {\n+    public static boolean enabled() {\n+      return getConfiguration().getBoolean(\"sidebar-message.enabled\", false);\n+    }\n+\n+    public static String format() {\n+      return ChatColor.translateAlternateColorCodes(\n+          '&', getConfiguration().getString(\"sidebar-message.text\"));\n+    }\n+\n+    public static boolean atTop() {\n+      return getConfiguration().getBoolean(\"sidebar-message.top\", false);\n+    }", "originalCommit": "922936e4afc8da27b46e43f766060d8f5d46240d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "98246c32928f7490406181d41dd0c4a0d7004323", "chunk": "diff --git a/src/main/java/tc/oc/pgm/Config.java b/src/main/java/tc/oc/pgm/Config.java\nindex d0926c6a..9d3605ab 100644\n--- a/src/main/java/tc/oc/pgm/Config.java\n+++ b/src/main/java/tc/oc/pgm/Config.java\n\n@@ -386,17 +386,26 @@ public class Config {\n   }\n \n   public static class SidebarMessage {\n-    public static boolean enabled() {\n-      return getConfiguration().getBoolean(\"sidebar-message.enabled\", false);\n+    public static boolean bottomEnabled() {\n+      return getConfiguration().getString(\"sidebar-message.message-bottom\", \"\").length() > 0;\n     }\n \n-    public static String format() {\n+    public static boolean topEnabled() {\n+      return getConfiguration().getString(\"sidebar-message.message-top\", \"\").length() > 0;\n+    }\n+\n+    public static String formatBottom() {\n+      return ChatColor.translateAlternateColorCodes(\n+          '&', getConfiguration().getString(\"sidebar-message.message-bottom\"));\n+    }\n+\n+    public static String formatTop() {\n       return ChatColor.translateAlternateColorCodes(\n-          '&', getConfiguration().getString(\"sidebar-message.text\"));\n+          '&', getConfiguration().getString(\"sidebar-message.message-top\"));\n     }\n \n-    public static boolean atTop() {\n-      return getConfiguration().getBoolean(\"sidebar-message.top\", false);\n+    public static boolean overwriteExisting() {\n+      return getConfiguration().getBoolean(\"sidebar-message.overwrite-existing\", false);\n     }\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU1NjQwMw==", "url": "https://github.com/PGMDev/PGM/pull/176#discussion_r362556403", "bodyText": "Can we have a player setting to disable scoreboard messages?", "author": "Pablete1234", "createdAt": "2020-01-02T17:23:31Z", "path": "src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java", "diffHunk": "@@ -463,6 +463,17 @@ public int compare(Goal a, Goal b) {\n           }\n         }\n       }\n+      if (Config.SidebarMessage.enabled()) {\n+        if (Config.SidebarMessage.atTop()) {\n+          rows.add(0, Config.SidebarMessage.format());\n+        } else {\n+          if (rows.size() >= MAX_ROWS) {\n+            rows.set(MAX_ROWS - 1, Config.SidebarMessage.format());\n+          } else {\n+            rows.add(Config.SidebarMessage.format());\n+          }\n+        }\n+      }", "originalCommit": "922936e4afc8da27b46e43f766060d8f5d46240d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYxNDUwNQ==", "url": "https://github.com/PGMDev/PGM/pull/176#discussion_r362614505", "bodyText": "This wouldn't be possible with the way sidebars are currently rendered. The sidebar doesn't know which player is viewing it, only the player's team.", "author": "Meeples10", "createdAt": "2020-01-02T20:16:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU1NjQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYxNjgzNg==", "url": "https://github.com/PGMDev/PGM/pull/176#discussion_r362616836", "bodyText": "Don't add the setting then lol ;p\n98246c3#diff-f08f8cdb20626aaae1393d6a6ea2a79fR13-R16", "author": "TheMolkaPL", "createdAt": "2020-01-02T20:23:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU1NjQwMw=="}], "type": "inlineReview", "revised_code": {"commit": "98246c32928f7490406181d41dd0c4a0d7004323", "chunk": "diff --git a/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java b/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java\nindex 5443ba63..9b05041d 100644\n--- a/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java\n+++ b/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java\n\n@@ -463,14 +463,19 @@ public class SidebarMatchModule extends MatchModule implements Listener {\n           }\n         }\n       }\n-      if (Config.SidebarMessage.enabled()) {\n-        if (Config.SidebarMessage.atTop()) {\n-          rows.add(0, Config.SidebarMessage.format());\n-        } else {\n-          if (rows.size() >= MAX_ROWS) {\n-            rows.set(MAX_ROWS - 1, Config.SidebarMessage.format());\n-          } else {\n-            rows.add(Config.SidebarMessage.format());\n+\n+      if (viewingParty != null) {\n+        if (Config.SidebarMessage.topEnabled()) {\n+          if (rows.size() < MAX_ROWS || Config.SidebarMessage.overwriteExisting()) {\n+            rows.add(0, Config.SidebarMessage.formatTop());\n+          }\n+        }\n+\n+        if (Config.SidebarMessage.bottomEnabled()) {\n+          if (rows.size() < MAX_ROWS) {\n+            rows.add(Config.SidebarMessage.formatBottom());\n+          } else if (Config.SidebarMessage.overwriteExisting()) {\n+            rows.set(MAX_ROWS - 1, Config.SidebarMessage.formatBottom());\n           }\n         }\n       }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU3OTg1Mg==", "url": "https://github.com/PGMDev/PGM/pull/176#discussion_r362579852", "bodyText": "I think there should a setting overwrite-existing default to false. If they scoreboard is full already, we can lose important information about the objectives/match.", "author": "TheMolkaPL", "createdAt": "2020-01-02T18:35:59Z", "path": "src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java", "diffHunk": "@@ -463,6 +463,17 @@ public int compare(Goal a, Goal b) {\n           }\n         }\n       }\n+      if (Config.SidebarMessage.enabled()) {\n+        if (Config.SidebarMessage.atTop()) {\n+          rows.add(0, Config.SidebarMessage.format());\n+        } else {\n+          if (rows.size() >= MAX_ROWS) {\n+            rows.set(MAX_ROWS - 1, Config.SidebarMessage.format());\n+          } else {\n+            rows.add(Config.SidebarMessage.format());\n+          }\n+        }\n+      }", "originalCommit": "922936e4afc8da27b46e43f766060d8f5d46240d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "98246c32928f7490406181d41dd0c4a0d7004323", "chunk": "diff --git a/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java b/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java\nindex 5443ba63..9b05041d 100644\n--- a/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java\n+++ b/src/main/java/tc/oc/pgm/scoreboard/SidebarMatchModule.java\n\n@@ -463,14 +463,19 @@ public class SidebarMatchModule extends MatchModule implements Listener {\n           }\n         }\n       }\n-      if (Config.SidebarMessage.enabled()) {\n-        if (Config.SidebarMessage.atTop()) {\n-          rows.add(0, Config.SidebarMessage.format());\n-        } else {\n-          if (rows.size() >= MAX_ROWS) {\n-            rows.set(MAX_ROWS - 1, Config.SidebarMessage.format());\n-          } else {\n-            rows.add(Config.SidebarMessage.format());\n+\n+      if (viewingParty != null) {\n+        if (Config.SidebarMessage.topEnabled()) {\n+          if (rows.size() < MAX_ROWS || Config.SidebarMessage.overwriteExisting()) {\n+            rows.add(0, Config.SidebarMessage.formatTop());\n+          }\n+        }\n+\n+        if (Config.SidebarMessage.bottomEnabled()) {\n+          if (rows.size() < MAX_ROWS) {\n+            rows.add(Config.SidebarMessage.formatBottom());\n+          } else if (Config.SidebarMessage.overwriteExisting()) {\n+            rows.set(MAX_ROWS - 1, Config.SidebarMessage.formatBottom());\n           }\n         }\n       }\n"}}, {"oid": "98246c32928f7490406181d41dd0c4a0d7004323", "url": "https://github.com/PGMDev/PGM/commit/98246c32928f7490406181d41dd0c4a0d7004323", "message": "Implement custom sidebar messages, resolves Electroid#157\n\nSigned-off-by: Meeples10 <8867705+Meeples10@users.noreply.github.com>", "committedDate": "2020-01-02T20:19:47Z", "type": "commit"}, {"oid": "e1f9e39817df524787dfef2e91cdd38dfde834ab", "url": "https://github.com/PGMDev/PGM/commit/e1f9e39817df524787dfef2e91cdd38dfde834ab", "message": "Remove unused settings\n\nSigned-off-by: Meeples10 <8867705+Meeples10@users.noreply.github.com>", "committedDate": "2020-01-02T20:41:33Z", "type": "commit"}, {"oid": "9701b4f872b73e5961a3d79553961e2154920ab5", "url": "https://github.com/PGMDev/PGM/commit/9701b4f872b73e5961a3d79553961e2154920ab5", "message": "Change config key names\n\nSigned-off-by: Meeples10 <8867705+Meeples10@users.noreply.github.com>", "committedDate": "2020-01-04T22:12:11Z", "type": "commit"}, {"oid": "0a91fb75be958d03e122064d4b649b4e2ebc3fc6", "url": "https://github.com/PGMDev/PGM/commit/0a91fb75be958d03e122064d4b649b4e2ebc3fc6", "message": "Merge branch 'master' into sidebar-messages", "committedDate": "2020-01-05T11:50:08Z", "type": "commit"}]}