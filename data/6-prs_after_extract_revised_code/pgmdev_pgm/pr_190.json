{"pr_number": 190, "pr_title": "Player may disable receiving /msg", "pr_createdAt": "2020-01-04T19:12:07Z", "pr_url": "https://github.com/PGMDev/PGM/pull/190", "timeline": [{"oid": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6", "url": "https://github.com/PGMDev/PGM/commit/a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6", "message": "Player may disable receiving /msg\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-04T19:10:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjQxOQ==", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363056419", "bodyText": "I'm unsure what blockedNoPermissions message exactly is, but it shouldn't be a no perms, but rather a \"player doesn't want DMS\"", "author": "Pablete1234", "createdAt": "2020-01-04T21:35:24Z", "path": "src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java", "diffHunk": "@@ -102,6 +103,22 @@ public void sendAdmin(Match match, MatchPlayer sender, @Nullable @Text String me\n       desc = \"Send a direct message to a player\",\n       usage = \"[player] [message]\")\n   public void sendDirect(Match match, MatchPlayer sender, Player receiver, @Text String message) {\n+    MatchPlayer matchReceiver = manager.getPlayer(receiver);\n+    if (matchReceiver != null) {\n+      SettingValue option = matchReceiver.getSettings().getValue(SettingKey.PM);\n+\n+      switch (option) {\n+        case PM_OFF:\n+          if (!sender.getBukkit().hasPermission(Permissions.STAFF)) {\n+            String name = receiver.getDisplayName(sender.getBukkit()) + ChatColor.RED;\n+            Component component =\n+                new PersonalizedTranslatable(\"command.message.blockedNoPermissions\", name);", "originalCommit": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NzE4OQ==", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363057189", "bodyText": "It was already in the strings.\nhttps://github.com/Electroid/PGM/blob/1a604f129d510489aa9ec0a398a31b3c787c139d/src/main/i18n/templates/strings.properties#L818", "author": "TheMolkaPL", "createdAt": "2020-01-04T21:53:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjQxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "chunk": "diff --git a/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java b/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java\nindex 56fd637c..b9da1698 100644\n--- a/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java\n+++ b/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java\n\n@@ -107,15 +107,13 @@ public class ChatDispatcher implements Listener {\n     if (matchReceiver != null) {\n       SettingValue option = matchReceiver.getSettings().getValue(SettingKey.PM);\n \n-      switch (option) {\n-        case PM_OFF:\n-          if (!sender.getBukkit().hasPermission(Permissions.STAFF)) {\n-            String name = receiver.getDisplayName(sender.getBukkit()) + ChatColor.RED;\n-            Component component =\n-                new PersonalizedTranslatable(\"command.message.blockedNoPermissions\", name);\n-            sender.sendMessage(new PersonalizedText(component, ChatColor.RED));\n-            return;\n-          }\n+      if (option.equals(SettingValue.PM_OFF)\n+          && !sender.getBukkit().hasPermission(Permissions.STAFF)) {\n+        String name = receiver.getDisplayName(sender.getBukkit()) + ChatColor.RED;\n+        Component component =\n+            new PersonalizedTranslatable(\"command.message.blockedNoPermissions\", name);\n+        sender.sendMessage(new PersonalizedText(component, ChatColor.RED));\n+        return;\n       }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjU1OQ==", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363056559", "bodyText": "A switch-case for 1 option, feels pretty redundant\nif (option == PM_OFF && !sender.getBukkit().hasPermission(Permissions.STAFF)) {\n  // send deny\n  return;\n}", "author": "Pablete1234", "createdAt": "2020-01-04T21:38:40Z", "path": "src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java", "diffHunk": "@@ -102,6 +103,22 @@ public void sendAdmin(Match match, MatchPlayer sender, @Nullable @Text String me\n       desc = \"Send a direct message to a player\",\n       usage = \"[player] [message]\")\n   public void sendDirect(Match match, MatchPlayer sender, Player receiver, @Text String message) {\n+    MatchPlayer matchReceiver = manager.getPlayer(receiver);\n+    if (matchReceiver != null) {\n+      SettingValue option = matchReceiver.getSettings().getValue(SettingKey.PM);\n+\n+      switch (option) {\n+        case PM_OFF:\n+          if (!sender.getBukkit().hasPermission(Permissions.STAFF)) {", "originalCommit": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NzE5Ng==", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363057196", "bodyText": "Yeah, I'll change that.", "author": "TheMolkaPL", "createdAt": "2020-01-04T21:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjU1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "chunk": "diff --git a/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java b/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java\nindex 56fd637c..b9da1698 100644\n--- a/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java\n+++ b/src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java\n\n@@ -107,15 +107,13 @@ public class ChatDispatcher implements Listener {\n     if (matchReceiver != null) {\n       SettingValue option = matchReceiver.getSettings().getValue(SettingKey.PM);\n \n-      switch (option) {\n-        case PM_OFF:\n-          if (!sender.getBukkit().hasPermission(Permissions.STAFF)) {\n-            String name = receiver.getDisplayName(sender.getBukkit()) + ChatColor.RED;\n-            Component component =\n-                new PersonalizedTranslatable(\"command.message.blockedNoPermissions\", name);\n-            sender.sendMessage(new PersonalizedText(component, ChatColor.RED));\n-            return;\n-          }\n+      if (option.equals(SettingValue.PM_OFF)\n+          && !sender.getBukkit().hasPermission(Permissions.STAFF)) {\n+        String name = receiver.getDisplayName(sender.getBukkit()) + ChatColor.RED;\n+        Component component =\n+            new PersonalizedTranslatable(\"command.message.blockedNoPermissions\", name);\n+        sender.sendMessage(new PersonalizedText(component, ChatColor.RED));\n+        return;\n       }\n     }\n \n"}}, {"oid": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "url": "https://github.com/PGMDev/PGM/commit/6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "message": "Simplify setting check\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-04T22:01:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1ODI1Mw==", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363058253", "bodyText": "PM -> MESSAGE. message and dm", "author": "Electroid", "createdAt": "2020-01-04T22:24:08Z", "path": "src/main/java/tc/oc/pgm/api/setting/SettingKey.java", "diffHunk": "@@ -17,7 +17,8 @@\n   CHAT(\"chat\", CHAT_TEAM, CHAT_GLOBAL, CHAT_ADMIN), // Changes the default chat channel\n   DEATH(\n       Arrays.asList(\"death\", \"dms\"), DEATH_ALL, DEATH_OWN), // Changes which death messages are seen\n-  PICKER(\"picker\", PICKER_AUTO, PICKER_ON, PICKER_OFF); // Changes when the picker is displayed\n+  PICKER(\"picker\", PICKER_AUTO, PICKER_ON, PICKER_OFF), // Changes when the picker is displayed\n+  PM(Arrays.asList(\"pm\", \"dm\", \"msg\"), PM_ON, PM_OFF); // Changes if private messages are accepted", "originalCommit": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b47a24a17a39dd77b6ec05025cd7e20bda8bea1", "chunk": "diff --git a/src/main/java/tc/oc/pgm/api/setting/SettingKey.java b/src/main/java/tc/oc/pgm/api/setting/SettingKey.java\nindex 5d42676c..7f7c3c80 100644\n--- a/src/main/java/tc/oc/pgm/api/setting/SettingKey.java\n+++ b/src/main/java/tc/oc/pgm/api/setting/SettingKey.java\n\n@@ -18,7 +18,7 @@ public enum SettingKey {\n   DEATH(\n       Arrays.asList(\"death\", \"dms\"), DEATH_ALL, DEATH_OWN), // Changes which death messages are seen\n   PICKER(\"picker\", PICKER_AUTO, PICKER_ON, PICKER_OFF), // Changes when the picker is displayed\n-  PM(Arrays.asList(\"pm\", \"dm\", \"msg\"), PM_ON, PM_OFF); // Changes if private messages are accepted\n+  MESSAGE(Arrays.asList(\"message\", \"dm\"), MESSAGE_ON, MESSAGE_OFF); // Changes if direct messages are accepted\n \n   private final List<String> aliases;\n   private final SettingValue[] values;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1ODI3Nw==", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363058277", "bodyText": "private -> direct", "author": "Electroid", "createdAt": "2020-01-04T22:24:20Z", "path": "src/main/java/tc/oc/pgm/api/setting/SettingValue.java", "diffHunk": "@@ -21,7 +21,9 @@\n   DEATH_ALL(\"death\", \"all\"), // Send all death messages, highlight your own\n   PICKER_AUTO(\"picker\", \"auto\"), // Display after cycle, or with permissions.\n   PICKER_ON(\"picker\", \"on\"), // Display the picker GUI always\n-  PICKER_OFF(\"picker\", \"off\"); // Never display the picker GUI\n+  PICKER_OFF(\"picker\", \"off\"), // Never display the picker GUI\n+  PM_ON(\"pm\", \"on\"), // Always accept private messages", "originalCommit": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b47a24a17a39dd77b6ec05025cd7e20bda8bea1", "chunk": "diff --git a/src/main/java/tc/oc/pgm/api/setting/SettingValue.java b/src/main/java/tc/oc/pgm/api/setting/SettingValue.java\nindex 48cc98ad..6e222d9d 100644\n--- a/src/main/java/tc/oc/pgm/api/setting/SettingValue.java\n+++ b/src/main/java/tc/oc/pgm/api/setting/SettingValue.java\n\n@@ -22,8 +22,8 @@ public enum SettingValue {\n   PICKER_AUTO(\"picker\", \"auto\"), // Display after cycle, or with permissions.\n   PICKER_ON(\"picker\", \"on\"), // Display the picker GUI always\n   PICKER_OFF(\"picker\", \"off\"), // Never display the picker GUI\n-  PM_ON(\"pm\", \"on\"), // Always accept private messages\n-  PM_OFF(\"pm\", \"off\"); // Never accept private messages\n+  MESSAGE_ON(\"message\", \"on\"), // Always accept direct messages\n+  MESSAGE_OFF(\"message\", \"off\"); // Never accept direct messages\n \n   private final String key;\n   private final String name;\n"}}, {"oid": "5b47a24a17a39dd77b6ec05025cd7e20bda8bea1", "url": "https://github.com/PGMDev/PGM/commit/5b47a24a17a39dd77b6ec05025cd7e20bda8bea1", "message": "Rename PM to MESSAGE\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-04T22:28:25Z", "type": "commit"}, {"oid": "74f116304a819fe75bf300ad96991c21b8d80ebb", "url": "https://github.com/PGMDev/PGM/commit/74f116304a819fe75bf300ad96991c21b8d80ebb", "message": "Fix formatting\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-04T22:31:55Z", "type": "commit"}, {"oid": "617968a9032a0a0a404e1837382d30ca6fc54158", "url": "https://github.com/PGMDev/PGM/commit/617968a9032a0a0a404e1837382d30ca6fc54158", "message": "Merge branch 'master' into toggle-msg", "committedDate": "2020-01-05T08:23:09Z", "type": "commit"}, {"oid": "072c40993cae91d3093309e2779f6b765b0d5911", "url": "https://github.com/PGMDev/PGM/commit/072c40993cae91d3093309e2779f6b765b0d5911", "message": "Merge branch 'master' into toggle-msg", "committedDate": "2020-01-05T11:58:23Z", "type": "commit"}, {"oid": "00a9ae0ab120a3bc934711e2641a135204cb3b5a", "url": "https://github.com/PGMDev/PGM/commit/00a9ae0ab120a3bc934711e2641a135204cb3b5a", "message": "Merge branch 'master' into toggle-msg", "committedDate": "2020-01-05T12:01:09Z", "type": "commit"}]}