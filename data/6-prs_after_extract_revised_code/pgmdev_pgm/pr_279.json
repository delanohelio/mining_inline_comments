{"pr_number": 279, "pr_title": "Map Vote Enhancement: Announce the winning map", "pr_createdAt": "2020-01-30T07:37:38Z", "pr_url": "https://github.com/PGMDev/PGM/pull/279", "timeline": [{"oid": "4c6d358c8d1fecab59019dab4c080c7dfd569fff", "url": "https://github.com/PGMDev/PGM/commit/4c6d358c8d1fecab59019dab4c080c7dfd569fff", "message": "Announce map poll winner\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-01-30T07:13:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2NDQ4NQ==", "url": "https://github.com/PGMDev/PGM/pull/279#discussion_r373064485", "bodyText": "I would just merge this method & the sendMessage method, wich is already done per-player, just rename sendMessage to announceMapWinner with the player & picked map as params, and integrate this logic there, it's only called when the map has actually ended.\nYou could also make it so the picked map name is underlined or bolded in the chat msg", "author": "Pablete1234", "createdAt": "2020-01-30T16:45:08Z", "path": "src/main/java/tc/oc/pgm/rotation/MapPoll.java", "diffHunk": "@@ -225,4 +228,32 @@ private void updateScores() {\n     if (voters == 0) return;\n     votes.forEach((m, v) -> mapScores.put(m, Math.max(v.size() / voters, Double.MIN_VALUE)));\n   }\n+\n+  private void announceMapWinner(Match match, MapInfo winner) {", "originalCommit": "4c6d358c8d1fecab59019dab4c080c7dfd569fff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MDA2Mg==", "url": "https://github.com/PGMDev/PGM/pull/279#discussion_r373260062", "bodyText": "Awesome,\nI was initially unsure whether it would be more appropriate to make this separate, however I will merge this into the sendMessage method. Thanks!\nI\u2019ll also make the formatting changes suggested \ud83d\udc4d", "author": "applenick", "createdAt": "2020-01-31T00:10:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2NDQ4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "58b9e14011717150943756f857e8d469e921a33e", "chunk": "diff --git a/src/main/java/tc/oc/pgm/rotation/MapPoll.java b/src/main/java/tc/oc/pgm/rotation/MapPoll.java\nindex c47cf0cc..2736e371 100644\n--- a/src/main/java/tc/oc/pgm/rotation/MapPoll.java\n+++ b/src/main/java/tc/oc/pgm/rotation/MapPoll.java\n\n@@ -228,32 +241,4 @@ public class MapPoll {\n     if (voters == 0) return;\n     votes.forEach((m, v) -> mapScores.put(m, Math.max(v.size() / voters, Double.MIN_VALUE)));\n   }\n-\n-  private void announceMapWinner(Match match, MapInfo winner) {\n-    Component mapName = new PersonalizedText(winner.getName()).bold(true).color(ChatColor.GREEN);\n-    Component mapSelect =\n-        new PersonalizedTranslatable(\"poll.winner.subTitle\")\n-            .getPersonalizedText()\n-            .bold(true)\n-            .color(ChatColor.GOLD);\n-    Component hotBar = new PersonalizedText(mapName, new PersonalizedText(\" \"), mapSelect);\n-\n-    match\n-        .getPlayers()\n-        .forEach(\n-            player -> {\n-              switch (player.getSettings().getValue(SettingKey.VOTE_WINNER)) {\n-                case ANNOUNCE_HOTBAR:\n-                  player.sendHotbarMessage(hotBar);\n-                  break;\n-                case ANNOUNCE_TITLE:\n-                  player.showTitle(mapName, mapSelect, 20, 20, 20);\n-                  break;\n-                default:\n-                  // Don't send anything to players who have this turned off\n-                  // TODO Maybe?: Perhaps send a chat message here instead of nothing\n-                  break;\n-              }\n-            });\n-  }\n }\n"}}, {"oid": "58b9e14011717150943756f857e8d469e921a33e", "url": "https://github.com/PGMDev/PGM/commit/58b9e14011717150943756f857e8d469e921a33e", "message": "Adjust titles, remove setting, new map name styling\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-02-01T19:25:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNDMwMQ==", "url": "https://github.com/PGMDev/PGM/pull/279#discussion_r373814301", "bodyText": "Why not just append a .underlined(winner) (or bold)?", "author": "Pablete1234", "createdAt": "2020-02-02T02:24:51Z", "path": "src/main/java/tc/oc/pgm/rotation/MapPoll.java", "diffHunk": "@@ -116,7 +129,9 @@ private Component getMapChatComponent(MatchPlayer viewer, MapInfo map) {\n         new PersonalizedText(\" \").bold(!voted), // Fix 1px symbol diff\n         new PersonalizedText(\"\" + countVotes(votes.get(map)), ChatColor.YELLOW),\n         new PersonalizedText(\"] \"),\n-        map.getStyledName(NameStyle.FANCY));\n+        map.getStyledMapName(\n+            winner ? MapNameStyle.HIGHLIGHT_WITH_AUTHORS : MapNameStyle.COLOR_WITH_AUTHORS,\n+            winner ? ChatColor.GREEN : ChatColor.GOLD));", "originalCommit": "58b9e14011717150943756f857e8d469e921a33e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNDU0Nw==", "url": "https://github.com/PGMDev/PGM/pull/279#discussion_r373814547", "bodyText": "Originally I tried just modifying the map name using the method you suggested, however what I found was since the author list is included they are bolded/underlined as well. I feel that having just the map name highlighted is better visually. Also adjusting the color makes it more prominent too.", "author": "applenick", "createdAt": "2020-02-02T02:33:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNDMwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "1719f878356629324b00f0648f8910732ee0da18", "chunk": "diff --git a/src/main/java/tc/oc/pgm/rotation/MapPoll.java b/src/main/java/tc/oc/pgm/rotation/MapPoll.java\nindex 2736e371..176bb2f9 100644\n--- a/src/main/java/tc/oc/pgm/rotation/MapPoll.java\n+++ b/src/main/java/tc/oc/pgm/rotation/MapPoll.java\n\n@@ -130,8 +127,7 @@ public class MapPoll {\n         new PersonalizedText(\"\" + countVotes(votes.get(map)), ChatColor.YELLOW),\n         new PersonalizedText(\"] \"),\n         map.getStyledMapName(\n-            winner ? MapNameStyle.HIGHLIGHT_WITH_AUTHORS : MapNameStyle.COLOR_WITH_AUTHORS,\n-            winner ? ChatColor.GREEN : ChatColor.GOLD));\n+            winner ? MapNameStyle.HIGHLIGHT_WITH_AUTHORS : MapNameStyle.COLOR_WITH_AUTHORS));\n   }\n \n   public void sendBook(MatchPlayer viewer) {\n"}}, {"oid": "cd4681751774ae0b129b45a32a6adc7246f0be6f", "url": "https://github.com/PGMDev/PGM/commit/cd4681751774ae0b129b45a32a6adc7246f0be6f", "message": "Remove other text from title\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-02-02T07:36:29Z", "type": "commit"}, {"oid": "1719f878356629324b00f0648f8910732ee0da18", "url": "https://github.com/PGMDev/PGM/commit/1719f878356629324b00f0648f8910732ee0da18", "message": "Replace color adjustment with underline\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-02-02T16:39:20Z", "type": "commit"}, {"oid": "ffaf7ef6db19848ef84008558d5999ad98d7d473", "url": "https://github.com/PGMDev/PGM/commit/ffaf7ef6db19848ef84008558d5999ad98d7d473", "message": "Update title to use consistent map color\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-02-02T17:46:40Z", "type": "commit"}, {"oid": "8b6769f27bd98d83254a384002a4a4b37ffeab5e", "url": "https://github.com/PGMDev/PGM/commit/8b6769f27bd98d83254a384002a4a4b37ffeab5e", "message": "Merge branch 'master' into mapvote-announce-winner", "committedDate": "2020-02-02T20:33:22Z", "type": "commit"}]}