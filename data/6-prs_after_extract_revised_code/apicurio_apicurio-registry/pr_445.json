{"pr_number": 445, "pr_title": "Add initial support for versions search in all storage variants", "pr_createdAt": "2020-05-12T11:35:45Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/445", "timeline": [{"oid": "c1c549686f53ee858bacf83e92d69b6ba59bb08b", "url": "https://github.com/Apicurio/apicurio-registry/commit/c1c549686f53ee858bacf83e92d69b6ba59bb08b", "message": "Add initial support for versions search in all storage variants", "committedDate": "2020-05-12T12:30:17Z", "type": "commit"}, {"oid": "c1c549686f53ee858bacf83e92d69b6ba59bb08b", "url": "https://github.com/Apicurio/apicurio-registry/commit/c1c549686f53ee858bacf83e92d69b6ba59bb08b", "message": "Add initial support for versions search in all storage variants", "committedDate": "2020-05-12T12:30:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc2NzU1OQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/445#discussion_r423767559", "bodyText": "Perhaps rather set these defaults in REST, so you don't have to do it for every storage.\nAnd let the storage have primitives.", "author": "alesj", "createdAt": "2020-05-12T14:13:55Z", "path": "storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java", "diffHunk": "@@ -546,6 +543,33 @@ public void deleteArtifactRule(String artifactId, RuleType rule) throws Artifact\n         }\n     }\n \n+    @Override\n+    public VersionSearchResults searchVersions(String artifactId, Integer offset, Integer limit) {\n+\n+        if (offset == null) {", "originalCommit": "c1c549686f53ee858bacf83e92d69b6ba59bb08b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc2OTMwMQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/445#discussion_r423769301", "bodyText": "Right, I'll change it for the searchArtifacts operation as well.", "author": "carlesarnal", "createdAt": "2020-05-12T14:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc2NzU1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "24d6c0ee541792317b797196175e4ef762367735", "chunk": "diff --git a/storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java b/storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java\nindex f2587d40..34717080 100644\n--- a/storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java\n+++ b/storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java\n\n@@ -546,16 +546,10 @@ public class StreamsRegistryStorage implements RegistryStorage {\n     @Override\n     public VersionSearchResults searchVersions(String artifactId, Integer offset, Integer limit) {\n \n-        if (offset == null) {\n-            offset = 0;\n-        }\n-        if (limit == null) {\n-            limit = 10;\n-        }\n-\n         final VersionSearchResults versionSearchResults = new VersionSearchResults();\n         final LongAdder itemsCount = new LongAdder();\n \n+\n         final List<SearchedVersion> versions = getArtifactVersions(artifactId).stream()\n                 .peek(version -> itemsCount.increment())\n                 .sorted(Long::compareTo)\n"}}, {"oid": "10f14de081cdd7a3e35311008edb3821ca8bc4a2", "url": "https://github.com/Apicurio/apicurio-registry/commit/10f14de081cdd7a3e35311008edb3821ca8bc4a2", "message": "Merge branch 'master' into versions-search-operation-support-444", "committedDate": "2020-05-12T15:03:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgwOTcyMg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/445#discussion_r423809722", "bodyText": "I think to add to the suggestion @alesj made - this signature can use int instead of Integer and require the caller to provide non-null values.", "author": "EricWittmann", "createdAt": "2020-05-12T15:06:29Z", "path": "app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java", "diffHunk": "@@ -240,6 +241,15 @@ default boolean isAlive() {\n      */\n     public SortedSet<Long> getArtifactVersions(String artifactId) throws ArtifactNotFoundException, RegistryStorageException;\n \n+    /**\n+     * Fetch the versions of the given artifact\n+     * @return the artifact versions, limited\n+     * @param artifactId the artifact used to fetch versions\n+     * @param limit the result size limit\n+     * @param offset the number of versions to skip\n+     */\n+    public VersionSearchResults searchVersions(String artifactId, Integer offset, Integer limit);", "originalCommit": "c1c549686f53ee858bacf83e92d69b6ba59bb08b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e053ed7b99250d3f0629b0e25d1bb184bf08e9e", "chunk": "diff --git a/app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java b/app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java\nindex 1d1065f1..d0684480 100644\n--- a/app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java\n+++ b/app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java\n\n@@ -248,7 +248,7 @@ public interface RegistryStorage {\n      * @param limit the result size limit\n      * @param offset the number of versions to skip\n      */\n-    public VersionSearchResults searchVersions(String artifactId, Integer offset, Integer limit);\n+    public VersionSearchResults searchVersions(String artifactId, int offset, int limit);\n \n     /**\n      * Gets the most recent version of the content of the artifact with the given global ID.\n"}}, {"oid": "24d6c0ee541792317b797196175e4ef762367735", "url": "https://github.com/Apicurio/apicurio-registry/commit/24d6c0ee541792317b797196175e4ef762367735", "message": "Fix search issues and made some improvements", "committedDate": "2020-05-12T15:34:00Z", "type": "commit"}, {"oid": "0b46cd48ee8b158513ace5c917d0f66b8d4539e6", "url": "https://github.com/Apicurio/apicurio-registry/commit/0b46cd48ee8b158513ace5c917d0f66b8d4539e6", "message": "Merge branch 'versions-search-operation-support-444' of https://github.com/carlesarnal/apicurio-registry into versions-search-operation-support-444", "committedDate": "2020-05-12T15:34:45Z", "type": "commit"}, {"oid": "1e053ed7b99250d3f0629b0e25d1bb184bf08e9e", "url": "https://github.com/Apicurio/apicurio-registry/commit/1e053ed7b99250d3f0629b0e25d1bb184bf08e9e", "message": "Change versions search params from Integer to primitive values", "committedDate": "2020-05-12T15:41:02Z", "type": "commit"}]}