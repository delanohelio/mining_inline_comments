{"pr_number": 797, "pr_title": "Allow APIs to return metadata and state of artifacts in DISABLED state", "pr_createdAt": "2020-08-28T12:54:03Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/797", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMDAxMA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/797#discussion_r480120010", "bodyText": "I'm not 100% sure about this.  There's no concept of \"state\" in the ccompat API, right?  And the entire schema is available (obviously) from the schema property of the result.  It seems like maybe this should return a 404?", "author": "EricWittmann", "createdAt": "2020-08-31T13:12:20Z", "path": "app/src/test/java/io/apicurio/registry/ConfluentCompatApiTest.java", "diffHunk": "@@ -218,14 +218,25 @@ public void testDisabledStateCheck() throws Exception {\n            .then()\n                .statusCode(204);\n         \n-        // GET - shouldn't return as the state has been changed to DISABLED\n+        // GET - object should return when the state has been changed to DISABLED\n         TestUtils.retry(() -> {\n             given()\n                 .when()\n                     .contentType(ContentTypes.COMPAT_SCHEMA_REGISTRY_STABLE_LATEST)\n                     .get(\"/ccompat/subjects/{subject}/versions/{version}\", SUBJECT, \"latest\")\n                 .then()\n-                    .statusCode(400);\n+                    .statusCode(200)\n+                    .body(\"schema\", equalTo(SCHEMA_SIMPLE));\n+        });", "originalCommit": "69d11bfc604def99687d7acc84da8ee9c453c379", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0OTY3Ng==", "url": "https://github.com/Apicurio/apicurio-registry/pull/797#discussion_r481149676", "bodyText": "I wasn't sure about that either. You're right that the ccompat API doesn't have state, so I have updated to return a 404 when users GET a disabled artifact on the /ccompat/subjects/{subject}/versions/{version} endpoint.", "author": "ajborley", "createdAt": "2020-09-01T13:46:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMDAxMA=="}], "type": "inlineReview", "revised_code": {"commit": "c74f28e72e00daca9b9ffb0491b3b3e9c0ca75e9", "chunk": "diff --git a/app/src/test/java/io/apicurio/registry/ConfluentCompatApiTest.java b/app/src/test/java/io/apicurio/registry/ConfluentCompatApiTest.java\nindex 6a0fa93c..60524bb2 100644\n--- a/app/src/test/java/io/apicurio/registry/ConfluentCompatApiTest.java\n+++ b/app/src/test/java/io/apicurio/registry/ConfluentCompatApiTest.java\n\n@@ -218,15 +218,14 @@ public class ConfluentCompatApiTest extends AbstractResourceTestBase {\n            .then()\n                .statusCode(204);\n         \n-        // GET - object should return when the state has been changed to DISABLED\n+        // GET - shouldn't return as the state has been changed to DISABLED\n         TestUtils.retry(() -> {\n             given()\n                 .when()\n                     .contentType(ContentTypes.COMPAT_SCHEMA_REGISTRY_STABLE_LATEST)\n                     .get(\"/ccompat/subjects/{subject}/versions/{version}\", SUBJECT, \"latest\")\n                 .then()\n-                    .statusCode(200)\n-                    .body(\"schema\", equalTo(SCHEMA_SIMPLE));\n+                    .statusCode(404);\n         });\n \n         // GET schema only - shouldn't return as the state has been changed to DISABLED\n"}}, {"oid": "159240fd691e6e5e2818b276aa95641320ef648c", "url": "https://github.com/Apicurio/apicurio-registry/commit/159240fd691e6e5e2818b276aa95641320ef648c", "message": "Allow APIs to return metadata and state of artifacts in DISABLED state\n\n- This commit updates the list of active states to include DISABLED,\nmeaning that API calls for artifacts that have been set to the DISABLED\nstate no longer return 404 responses on the /meta and /state\nendpoints.\n- It also updates the following endpoints to return 404 when the\nartifact is in DISABLED state, so that behaviour remains the same for\nthe endpoints that return only the artifact content.\n  - `GET /api/artifacts/{artifactid}`\n  - `GET /api/artifacts/{artifactid}/versions/{version}`\n  - `GET /api/ids/{globalid`\n  - `GET /api/ccompat/subjects/{subjectid}/versions/{version}/schema`\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-09-01T13:42:46Z", "type": "commit"}, {"oid": "c74f28e72e00daca9b9ffb0491b3b3e9c0ca75e9", "url": "https://github.com/Apicurio/apicurio-registry/commit/c74f28e72e00daca9b9ffb0491b3b3e9c0ca75e9", "message": "Return 404 for disabled artifacts in ccompat API and add search tests\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-09-01T13:42:46Z", "type": "forcePushed"}, {"oid": "325cb2c0391e4bb8075dfd6b75689727f76724e0", "url": "https://github.com/Apicurio/apicurio-registry/commit/325cb2c0391e4bb8075dfd6b75689727f76724e0", "message": "Return 404 for disabled artifacts in ccompat API and add search tests\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-09-01T13:50:58Z", "type": "forcePushed"}, {"oid": "591cd47b56ea79256f74bdece015644ed95b56e8", "url": "https://github.com/Apicurio/apicurio-registry/commit/591cd47b56ea79256f74bdece015644ed95b56e8", "message": "Return 404 for disabled artifacts in ccompat API and add search tests\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-09-01T13:52:18Z", "type": "commit"}, {"oid": "591cd47b56ea79256f74bdece015644ed95b56e8", "url": "https://github.com/Apicurio/apicurio-registry/commit/591cd47b56ea79256f74bdece015644ed95b56e8", "message": "Return 404 for disabled artifacts in ccompat API and add search tests\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-09-01T13:52:18Z", "type": "forcePushed"}]}