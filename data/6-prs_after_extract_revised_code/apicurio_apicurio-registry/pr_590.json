{"pr_number": 590, "pr_title": "Add version createdon metadata 453", "pr_createdAt": "2020-06-03T10:34:05Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/590", "timeline": [{"oid": "ecbb3379a2960ab34e3ca0b98bbe5f8aa41356bf", "url": "https://github.com/Apicurio/apicurio-registry/commit/ecbb3379a2960ab34e3ca0b98bbe5f8aa41356bf", "message": "Add createdOn version metadata for map based storages", "committedDate": "2020-06-03T09:37:04Z", "type": "commit"}, {"oid": "9930fe89e5398de0c24d7ac8e6b7c544f128e3d7", "url": "https://github.com/Apicurio/apicurio-registry/commit/9930fe89e5398de0c24d7ac8e6b7c544f128e3d7", "message": "Add createdOn for streams and jpa storages", "committedDate": "2020-06-03T10:33:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ3ODczMw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/590#discussion_r434478733", "bodyText": "I don't think this is useful meta-data to put on a version.  The artifact has a logical modifiedOn ... but similar to the createdOn value for an artifact, the modifiedOn for an artifact should be the createdOn value of the artifact's most recent version.", "author": "EricWittmann", "createdAt": "2020-06-03T10:50:20Z", "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "diffHunk": "@@ -199,8 +200,6 @@ protected ArtifactMetaDataDto createOrUpdateArtifact(String artifactId, Artifact\n         contents.put(MetaDataKeys.CREATED_ON, currentTimeMillis);\n         contents.put(MetaDataKeys.MODIFIED_ON, currentTimeMillis);", "originalCommit": "9930fe89e5398de0c24d7ac8e6b7c544f128e3d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ4NjYzNA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/590#discussion_r434486634", "bodyText": "I can fix it, but nothing has changed regarding the modifiedOn metadata here.", "author": "carlesarnal", "createdAt": "2020-06-03T11:05:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ3ODczMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ5MzQwNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/590#discussion_r434493407", "bodyText": "Doesn't this duplicate the logic in the storage?  It seems like the storage is doing this same work (and I think the storage is where we would want to do this work).", "author": "EricWittmann", "createdAt": "2020-06-03T11:20:14Z", "path": "app/src/main/java/io/apicurio/registry/rest/ArtifactsResourceImpl.java", "diffHunk": "@@ -451,6 +453,12 @@ public void deleteArtifactRule(RuleType rule, String artifactId) {\n     @Override\n     public ArtifactMetaData getArtifactMetaData(String artifactId) {\n         ArtifactMetaDataDto dto = storage.getArtifactMetaData(artifactId);\n+\n+        if (dto.getVersion() != ARTIFACT_FIRST_VERSION) {\n+            //Fetch the createdOn value from the first version of the artifact\n+            ArtifactVersionMetaDataDto artifactVersionMetaData = storage.getArtifactVersionMetaData(artifactId, ARTIFACT_FIRST_VERSION);\n+            dto.setCreatedOn(artifactVersionMetaData.getCreatedOn());\n+        }", "originalCommit": "9930fe89e5398de0c24d7ac8e6b7c544f128e3d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ5NTE5Nw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/590#discussion_r434495197", "bodyText": "Yes, this is part of a previous approach and is something that needs to be removed. Sorry for that.", "author": "carlesarnal", "createdAt": "2020-06-03T11:24:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ5MzQwNw=="}], "type": "inlineReview", "revised_code": {"commit": "691af070a9aec9fc6630679393f97423d4e6a1eb", "chunk": "diff --git a/app/src/main/java/io/apicurio/registry/rest/ArtifactsResourceImpl.java b/app/src/main/java/io/apicurio/registry/rest/ArtifactsResourceImpl.java\nindex f1b32e69..c5ad84c7 100644\n--- a/app/src/main/java/io/apicurio/registry/rest/ArtifactsResourceImpl.java\n+++ b/app/src/main/java/io/apicurio/registry/rest/ArtifactsResourceImpl.java\n\n@@ -453,12 +451,6 @@ public class ArtifactsResourceImpl implements ArtifactsResource, Headers {\n     @Override\n     public ArtifactMetaData getArtifactMetaData(String artifactId) {\n         ArtifactMetaDataDto dto = storage.getArtifactMetaData(artifactId);\n-\n-        if (dto.getVersion() != ARTIFACT_FIRST_VERSION) {\n-            //Fetch the createdOn value from the first version of the artifact\n-            ArtifactVersionMetaDataDto artifactVersionMetaData = storage.getArtifactVersionMetaData(artifactId, ARTIFACT_FIRST_VERSION);\n-            dto.setCreatedOn(artifactVersionMetaData.getCreatedOn());\n-        }\n         return DtoUtil.dtoToMetaData(artifactId, dto.getType(), dto);\n     }\n \n"}}, {"oid": "691af070a9aec9fc6630679393f97423d4e6a1eb", "url": "https://github.com/Apicurio/apicurio-registry/commit/691af070a9aec9fc6630679393f97423d4e6a1eb", "message": "Remove previous approach for the get artifact metadata", "committedDate": "2020-06-03T11:36:31Z", "type": "commit"}]}