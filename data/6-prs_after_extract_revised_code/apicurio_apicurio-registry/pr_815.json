{"pr_number": 815, "pr_title": "Remove jaxrs classes from client", "pr_createdAt": "2020-09-09T10:23:23Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/815", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg2ODgyMg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/815#discussion_r485868822", "bodyText": "I was thinking maybe byte[] or InputStream or ContentHandle here.  Is there something that the okhttp3 class gives us that's better than just plain data?", "author": "EricWittmann", "createdAt": "2020-09-09T19:39:05Z", "path": "rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClient.java", "diffHunk": "@@ -34,7 +34,7 @@\n     ArtifactMetaData createArtifact(ArtifactType xRegistryArtifactType, String xRegistryArtifactId, IfExistsType ifExists, InputStream data);\n \n \n-    Response getLatestArtifact(String artifactId);\n+    ResponseBody getLatestArtifact(String artifactId);", "originalCommit": "a0955198fc59541d4755221c8c51817bb50ee1be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExOTY4Ng==", "url": "https://github.com/Apicurio/apicurio-registry/pull/815#discussion_r486119686", "bodyText": "You can get the InputStream from the ResponseBody class and also the content length and type.", "author": "carlesarnal", "createdAt": "2020-09-10T07:21:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg2ODgyMg=="}], "type": "inlineReview", "revised_code": {"commit": "d87152617488e37d498160593d80aabbd79f6b3e", "chunk": "diff --git a/rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClient.java b/rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClient.java\nindex 744e0f5e..f42290a5 100644\n--- a/rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClient.java\n+++ b/rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClient.java\n\n@@ -34,7 +33,7 @@ public interface RegistryRestClient {\n     ArtifactMetaData createArtifact(ArtifactType xRegistryArtifactType, String xRegistryArtifactId, IfExistsType ifExists, InputStream data);\n \n \n-    ResponseBody getLatestArtifact(String artifactId);\n+    InputStream getLatestArtifact(String artifactId);\n \n \n     ArtifactMetaData updateArtifact(String artifactId, ArtifactType xRegistryArtifactType, InputStream data);\n"}}, {"oid": "2e12e6390b07e81bdfe00da10bcc4f82f13809a5", "url": "https://github.com/Apicurio/apicurio-registry/commit/2e12e6390b07e81bdfe00da10bcc4f82f13809a5", "message": "Remove jaxrs classes from client", "committedDate": "2020-09-10T07:38:07Z", "type": "commit"}, {"oid": "2e12e6390b07e81bdfe00da10bcc4f82f13809a5", "url": "https://github.com/Apicurio/apicurio-registry/commit/2e12e6390b07e81bdfe00da10bcc4f82f13809a5", "message": "Remove jaxrs classes from client", "committedDate": "2020-09-10T07:38:07Z", "type": "forcePushed"}, {"oid": "d87152617488e37d498160593d80aabbd79f6b3e", "url": "https://github.com/Apicurio/apicurio-registry/commit/d87152617488e37d498160593d80aabbd79f6b3e", "message": "Switch from response body to input stream", "committedDate": "2020-09-10T08:52:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5NTMwOA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/815#discussion_r486295308", "bodyText": "Can you confirm that Files.copy() closes the stream?", "author": "EricWittmann", "createdAt": "2020-09-10T12:27:58Z", "path": "utils/maven-plugin/src/main/java/io/apicurio/registry/maven/DownloadRegistryMojo.java", "diffHunk": "@@ -117,17 +116,13 @@ protected void executeInternal() throws MojoExecutionException {\n \n             try {\n                 Integer version = versions.get(id);\n-                Response response = (version != null) ?\n-                                    getClient().getArtifactVersion(version, id) :\n-                                    getClient().getLatestArtifact(id);\n-                try (InputStream stream = response.readEntity(InputStream.class)) {\n-                    if (replaceExisting) {\n-                        Files.copy(stream, outputFile.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-                    } else {\n-                        Files.copy(stream, outputFile.toPath());\n-                    }\n-                } finally {\n-                    response.close();\n+                InputStream stream = (version != null) ?\n+                        getClient().getArtifactVersion(version, id) :\n+                        getClient().getLatestArtifact(id);\n+                if (replaceExisting) {\n+                    Files.copy(stream, outputFile.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+                } else {\n+                    Files.copy(stream, outputFile.toPath());", "originalCommit": "d87152617488e37d498160593d80aabbd79f6b3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5OTEyNg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/815#discussion_r486299126", "bodyText": "Good catch, no, it does not close the stream.", "author": "carlesarnal", "createdAt": "2020-09-10T12:34:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5NTMwOA=="}], "type": "inlineReview", "revised_code": {"commit": "8208e127b7d00bc9f0a1afe6bd1a328782f0a7f9", "chunk": "diff --git a/utils/maven-plugin/src/main/java/io/apicurio/registry/maven/DownloadRegistryMojo.java b/utils/maven-plugin/src/main/java/io/apicurio/registry/maven/DownloadRegistryMojo.java\nindex c43d6404..8240d46c 100644\n--- a/utils/maven-plugin/src/main/java/io/apicurio/registry/maven/DownloadRegistryMojo.java\n+++ b/utils/maven-plugin/src/main/java/io/apicurio/registry/maven/DownloadRegistryMojo.java\n\n@@ -114,11 +114,10 @@ public class DownloadRegistryMojo extends AbstractRegistryMojo {\n \n             getLog().info(String.format(\"Downloading artifact for id [%s] to %s.\", id, outputFile));\n \n-            try {\n-                Integer version = versions.get(id);\n-                InputStream stream = (version != null) ?\n-                        getClient().getArtifactVersion(version, id) :\n-                        getClient().getLatestArtifact(id);\n+            Integer version = versions.get(id);\n+            try (InputStream stream = (version != null) ?\n+                    getClient().getArtifactVersion(version, id) :\n+                    getClient().getLatestArtifact(id)) {\n                 if (replaceExisting) {\n                     Files.copy(stream, outputFile.toPath(), StandardCopyOption.REPLACE_EXISTING);\n                 } else {\n"}}, {"oid": "8208e127b7d00bc9f0a1afe6bd1a328782f0a7f9", "url": "https://github.com/Apicurio/apicurio-registry/commit/8208e127b7d00bc9f0a1afe6bd1a328782f0a7f9", "message": "Add try with resources", "committedDate": "2020-09-10T14:35:40Z", "type": "commit"}, {"oid": "fe8f536518f2481354fdea2ea0d1bad1849d0473", "url": "https://github.com/Apicurio/apicurio-registry/commit/fe8f536518f2481354fdea2ea0d1bad1849d0473", "message": "Merge branch 'master' into remove-jaxrs-classes-client-702", "committedDate": "2020-09-10T15:07:53Z", "type": "commit"}]}