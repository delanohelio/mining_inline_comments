{"pr_number": 612, "pr_title": "upgrade kafka-connect to 2.4.1 in compile-time dependency while ensur\u2026", "pr_createdAt": "2020-06-10T07:43:02Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/612", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc3MTAyNA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/612#discussion_r438771024", "bodyText": "2020", "author": "alesj", "createdAt": "2020-06-11T13:13:24Z", "path": "search/connector/src/main/java/io/apicurio/registry/connector/Compatibility.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2019 Red Hat", "originalCommit": "aad69e8c8e044c04f0ba630ce3dc6a6effa5aad4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a9cb6cc18308e520eea0f34ad7651901d7382168", "chunk": "diff --git a/search/connector/src/main/java/io/apicurio/registry/connector/Compatibility.java b/search/connector/src/main/java/io/apicurio/registry/connector/Compatibility.java\nindex c12bda48..cd34ea13 100644\n--- a/search/connector/src/main/java/io/apicurio/registry/connector/Compatibility.java\n+++ b/search/connector/src/main/java/io/apicurio/registry/connector/Compatibility.java\n\n@@ -44,26 +44,24 @@ class Compatibility {\n \n     static {\n         try {\n-            // for 2.3, 2.4\n+            // for 2.3, 2.4 - ConnectorClientConfigOverridePolicy is available\n             CLS_CONNECTOR_CLIENT_CONFIG_OVERRIDE_POLICY = Class.forName(\"org.apache.kafka.connect.connector.policy.ConnectorClientConfigOverridePolicy\", true, Compatibility.class.getClassLoader());\n         } catch (Throwable t) {\n-            // for 2.2\n+            // for 2.2 - not available\n             CLS_CONNECTOR_CLIENT_CONFIG_OVERRIDE_POLICY = null;\n         }\n         try {\n-            // for 2.2, 2.3\n-            Class<?> clz = Class.forName(\"org.apache.kafka.connect.runtime.Worker\", true, Compatibility.class.getClassLoader());\n-            CTR_WORKER_22 = clz.getConstructor(String.class, Time.class, Plugins.class, WorkerConfig.class, OffsetBackingStore.class);\n+            // for 2.2, 2.3 - get the consturctor from the old Worker\n+            CTR_WORKER_22 = Worker.class.getConstructor(String.class, Time.class, Plugins.class, WorkerConfig.class, OffsetBackingStore.class);\n         } catch (Throwable t) {\n-            // for 2.4\n+            // for 2.4 - use the current constructor\n             CTR_WORKER_22 = null;\n         }\n         try {\n-            // for 2.2, 2.3\n-            Class<?> clz = Class.forName(\"org.apache.kafka.connect.runtime.distributed.DistributedHerder\", true, Compatibility.class.getClassLoader());\n-            CTR_DISTRIBUTED_HERDER_22 = clz.getConstructor(DistributedConfig.class, Time.class, Worker.class, String.class, StatusBackingStore.class, ConfigBackingStore.class, String.class);\n+            // for 2.2, 2.3 - get the constructor from the old DistributedHerder\n+            CTR_DISTRIBUTED_HERDER_22 = DistributedHerder.class.getConstructor(DistributedConfig.class, Time.class, Worker.class, String.class, StatusBackingStore.class, ConfigBackingStore.class, String.class);\n         } catch (Throwable t) {\n-            // for 2.4\n+            // for 2.4 - use the current constructor\n             CTR_DISTRIBUTED_HERDER_22 = null;\n         }\n     }\n"}}, {"oid": "a6f81f03bee11dac4b8e2c183400f80206a8eb35", "url": "https://github.com/Apicurio/apicurio-registry/commit/a6f81f03bee11dac4b8e2c183400f80206a8eb35", "message": "upgrade kafka-connect to 2.4.1 in compile-time dependency while ensuring runtime compatibility with kafka-connect 2.2.x, 2.3.x", "committedDate": "2020-06-13T08:38:38Z", "type": "forcePushed"}, {"oid": "12d94b88850fe8edaca8bc3d2ff8b55fea06d239", "url": "https://github.com/Apicurio/apicurio-registry/commit/12d94b88850fe8edaca8bc3d2ff8b55fea06d239", "message": "upgrade kafka-connect to 2.4.1 in compile-time dependency while ensuring runtime compatibility with kafka-connect 2.2.x, 2.3.x", "committedDate": "2020-06-13T08:39:47Z", "type": "forcePushed"}, {"oid": "b65a191a690aab92143a2cf453bce75b0de81e75", "url": "https://github.com/Apicurio/apicurio-registry/commit/b65a191a690aab92143a2cf453bce75b0de81e75", "message": "upgrade kafka-connect to 2.4.1 in compile-time dependency while ensuring runtime compatibility with kafka-connect 2.2.x, 2.3.x", "committedDate": "2020-06-13T08:56:26Z", "type": "forcePushed"}, {"oid": "a9cb6cc18308e520eea0f34ad7651901d7382168", "url": "https://github.com/Apicurio/apicurio-registry/commit/a9cb6cc18308e520eea0f34ad7651901d7382168", "message": "upgrade kafka-connect to 2.4.1 in compile-time dependency while ensuring runtime compatibility with kafka-connect 2.2.x, 2.3.x", "committedDate": "2020-06-13T16:41:27Z", "type": "commit"}, {"oid": "a9cb6cc18308e520eea0f34ad7651901d7382168", "url": "https://github.com/Apicurio/apicurio-registry/commit/a9cb6cc18308e520eea0f34ad7651901d7382168", "message": "upgrade kafka-connect to 2.4.1 in compile-time dependency while ensuring runtime compatibility with kafka-connect 2.2.x, 2.3.x", "committedDate": "2020-06-13T16:41:27Z", "type": "forcePushed"}, {"oid": "6df34f773a8c8bc592f19cddb760819434981b93", "url": "https://github.com/Apicurio/apicurio-registry/commit/6df34f773a8c8bc592f19cddb760819434981b93", "message": "Merge branch 'master' into ay-kafka24", "committedDate": "2020-06-15T14:30:31Z", "type": "commit"}, {"oid": "8c9ec4efd90741b82e0b2f17f4486c603e3c6d68", "url": "https://github.com/Apicurio/apicurio-registry/commit/8c9ec4efd90741b82e0b2f17f4486c603e3c6d68", "message": "Update Compatibility.java", "committedDate": "2020-06-15T15:01:27Z", "type": "commit"}]}