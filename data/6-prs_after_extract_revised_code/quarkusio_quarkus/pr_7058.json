{"pr_number": 7058, "pr_title": "Turn a class annotated with @Startup but no scope into a bean", "pr_createdAt": "2020-02-07T08:12:00Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7058", "timeline": [{"oid": "206041b818a3a464842ff73732cb15328cd79bd9", "url": "https://github.com/quarkusio/quarkus/commit/206041b818a3a464842ff73732cb15328cd79bd9", "message": "Turn a class annotated with @Startup but no scope into a bean\n\n- add @ApplicationScope automatically\n- resolves #7048", "committedDate": "2020-02-07T08:07:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM0MDA4MA==", "url": "https://github.com/quarkusio/quarkus/pull/7058#discussion_r376340080", "bodyText": "I know it's somewhat far-fetched but should we care about non-built in scopes? Users can have custom ones, or there is Transactional one already present. Both cases will pass this check and try to add yet another scope on the bean (which should later on blow up).", "author": "manovotn", "createdAt": "2020-02-07T11:16:41Z", "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/StartupBuildSteps.java", "diffHunk": "@@ -45,6 +49,31 @@\n     static final MethodDescriptor CONTEXTUAL_DESTROY = MethodDescriptor.ofMethod(Contextual.class,\n             \"destroy\", void.class, Object.class, CreationalContext.class);\n \n+    private static final Logger LOGGER = Logger.getLogger(StartupBuildSteps.class);\n+\n+    @BuildStep\n+    AnnotationsTransformerBuildItem annotationTransformer() {\n+        return new AnnotationsTransformerBuildItem(new AnnotationsTransformer() {\n+\n+            @Override\n+            public boolean appliesTo(org.jboss.jandex.AnnotationTarget.Kind kind) {\n+                return kind == org.jboss.jandex.AnnotationTarget.Kind.CLASS;\n+            }\n+\n+            @Override\n+            public void transform(TransformationContext context) {\n+                if (context.isClass() && !BuiltinScope.isDeclaredOn(context.getTarget().asClass())) {", "originalCommit": "206041b818a3a464842ff73732cb15328cd79bd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM4MjE5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7058#discussion_r376382195", "bodyText": "That's a good point. Although in this case I doubt that a @Startup bean would be annotated with @Transactional or a custom scope. Let's create a separate issue to handle this corretly. WDYT?", "author": "mkouba", "createdAt": "2020-02-07T13:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM0MDA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQwMTk1OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7058#discussion_r376401959", "bodyText": "Hm, the problem is that annotation transformers are registered before the final set of scopes is known...", "author": "mkouba", "createdAt": "2020-02-07T13:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM0MDA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQwNjc0NA==", "url": "https://github.com/quarkusio/quarkus/pull/7058#discussion_r376406744", "bodyText": "I've created #7076", "author": "mkouba", "createdAt": "2020-02-07T14:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM0MDA4MA=="}], "type": "inlineReview", "revised_code": null}]}