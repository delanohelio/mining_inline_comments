{"pr_number": 10316, "pr_title": " Devmode .env: fall back to mklink /H on Windows", "pr_createdAt": "2020-06-26T22:17:43Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10316", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4MTIzMw==", "url": "https://github.com/quarkusio/quarkus/pull/10316#discussion_r446481233", "bodyText": "Put inside a try-finally block and call process.destroy() just in case", "author": "gastaldi", "createdAt": "2020-06-27T04:04:12Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/dev/DevModeMain.java", "diffHunk": "@@ -176,6 +192,20 @@ private void silentDeleteFile(Path path) {\n         }\n     }\n \n+    private void makeHardLinkWindowsFallback(Path link, Path dotEnvPath) throws IOException, InterruptedException {\n+        Process process = new ProcessBuilder(\"cmd.exe\", \"/C\", \"mklink\", \"/H\", link.toString(), dotEnvPath.toString())\n+                .redirectOutput(new File(\"NUL\"))\n+                .redirectError(ProcessBuilder.Redirect.PIPE)\n+                .start();\n+        ByteArrayOutputStream errStream = new ByteArrayOutputStream();\n+        ProcessUtil.streamErrorTo(new PrintStream(errStream), process);\n+        int exitValue = process.waitFor();", "originalCommit": "24767e901f0d9d8e3a8ae1707a55d8078c540920", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNzQ1MQ==", "url": "https://github.com/quarkusio/quarkus/pull/10316#discussion_r446527451", "bodyText": "Done. I wrapped everything after start(), just in case.", "author": "famod", "createdAt": "2020-06-27T13:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4MTIzMw=="}], "type": "inlineReview", "revised_code": {"commit": "484dac9c7a150b3a36cdb012e544bac10f00f910", "chunk": "diff --git a/core/deployment/src/main/java/io/quarkus/deployment/dev/DevModeMain.java b/core/deployment/src/main/java/io/quarkus/deployment/dev/DevModeMain.java\nindex 5a4b386d2b..a5deda3c6e 100644\n--- a/core/deployment/src/main/java/io/quarkus/deployment/dev/DevModeMain.java\n+++ b/core/deployment/src/main/java/io/quarkus/deployment/dev/DevModeMain.java\n\n@@ -197,12 +197,16 @@ public class DevModeMain implements Closeable {\n                 .redirectOutput(new File(\"NUL\"))\n                 .redirectError(ProcessBuilder.Redirect.PIPE)\n                 .start();\n-        ByteArrayOutputStream errStream = new ByteArrayOutputStream();\n-        ProcessUtil.streamErrorTo(new PrintStream(errStream), process);\n-        int exitValue = process.waitFor();\n-        if (exitValue > 0) {\n-            throw new IOException(\n-                    \"mklink /H execution failed with exit code \" + exitValue + \": \" + new String(errStream.toByteArray()));\n+        try {\n+            ByteArrayOutputStream errStream = new ByteArrayOutputStream();\n+            ProcessUtil.streamErrorTo(new PrintStream(errStream), process);\n+            int exitValue = process.waitFor();\n+            if (exitValue > 0) {\n+                throw new IOException(\n+                        \"mklink /H execution failed with exit code \" + exitValue + \": \" + new String(errStream.toByteArray()));\n+            }\n+        } finally {\n+            process.destroy();\n         }\n     }\n \n"}}, {"oid": "484dac9c7a150b3a36cdb012e544bac10f00f910", "url": "https://github.com/quarkusio/quarkus/commit/484dac9c7a150b3a36cdb012e544bac10f00f910", "message": "Devmode .env: fall back to mklink /H on Windows", "committedDate": "2020-06-27T13:35:02Z", "type": "commit"}, {"oid": "e4401a0d7484ce973fb611629359568660ae503e", "url": "https://github.com/quarkusio/quarkus/commit/e4401a0d7484ce973fb611629359568660ae503e", "message": "core-deployment: use commons SystemUtils.IS_OS_WINDOWS and _LINUX", "committedDate": "2020-06-27T13:35:04Z", "type": "commit"}]}