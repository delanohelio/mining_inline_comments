{"pr_number": 8199, "pr_title": "Added ability for custom manifest entries in MANIFEST.MF", "pr_createdAt": "2020-03-26T15:12:28Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8199", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNzI5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r398907292", "bodyText": "Configuration of the Mojo is really legacy at this point so there isn't much point in adding more. All Quarkus configuration is now done via the Quarkus Config System (of which ManifestConfig which you have already changed is a part)", "author": "geoand", "createdAt": "2020-03-26T21:35:39Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java", "diffHunk": "@@ -117,6 +121,31 @@\n     @Parameter(property = \"ignoredEntries\")\n     private String[] ignoredEntries;\n \n+    /**\n+     * Custom entries into the Manifest can be configured like:\n+     * <code><pre>\n+     * &#x3C;configuration&#x3E;\n+     *   &#x3C;manifestSections&#x3E;\n+     *     &#x3C;manifestSection&#x3E;\n+     *       &#x3C;name&#x3E;Custom Entries&#x3C;/name&#x3E;\n+     *       &#x3C;manifestEntries&#x3E;\n+     *          &#x3C;manifestEntry&#x3E;\n+     *             &#x3C;entryKey&#x3E;Entry_Key1&#x3C;/entryKey&#x3E;\n+     *             &#x3C;entryValue&#x3E;Entry Value 1&#x3C;/entryValue&#x3E;\n+     *          &#x3C;/manifestEntry&#x3E;\n+     *          &#x3C;manifestEntry&#x3E;\n+     *             &#x3C;entryKey&#x3E;Entry_Key2&#x3C;/entryKey&#x3E;\n+     *             &#x3C;entryValue&#x3E;Entry Value 2&#x3C;/entryValue&#x3E;\n+     *          &#x3C;/manifestEntry&#x3E;\n+     *       &#x3C;/manifestEntries&#x3E;\n+     *     &#x3C;/manifestSection&#x3E;\n+     *   &#x3C;/manifestSections&#x3E;\n+     * &#x3C;/configuration&#x3E;\n+     * </pre></code>\n+     */\n+    @Parameter(property = \"manifestSections\")\n+    private List<ManifestSection> manifestSections;", "originalCommit": "6acbbb107170f1eefeb674ad6ebd7aa8d9c4b02c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f0f72c85095bd1101924deb69b64ae6d02accfaa", "chunk": "diff --git a/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java b/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java\nindex b32dda94a0..908fac515b 100644\n--- a/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java\n+++ b/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java\n\n@@ -121,31 +117,6 @@ public class BuildMojo extends AbstractMojo {\n     @Parameter(property = \"ignoredEntries\")\n     private String[] ignoredEntries;\n \n-    /**\n-     * Custom entries into the Manifest can be configured like:\n-     * <code><pre>\n-     * &#x3C;configuration&#x3E;\n-     *   &#x3C;manifestSections&#x3E;\n-     *     &#x3C;manifestSection&#x3E;\n-     *       &#x3C;name&#x3E;Custom Entries&#x3C;/name&#x3E;\n-     *       &#x3C;manifestEntries&#x3E;\n-     *          &#x3C;manifestEntry&#x3E;\n-     *             &#x3C;entryKey&#x3E;Entry_Key1&#x3C;/entryKey&#x3E;\n-     *             &#x3C;entryValue&#x3E;Entry Value 1&#x3C;/entryValue&#x3E;\n-     *          &#x3C;/manifestEntry&#x3E;\n-     *          &#x3C;manifestEntry&#x3E;\n-     *             &#x3C;entryKey&#x3E;Entry_Key2&#x3C;/entryKey&#x3E;\n-     *             &#x3C;entryValue&#x3E;Entry Value 2&#x3C;/entryValue&#x3E;\n-     *          &#x3C;/manifestEntry&#x3E;\n-     *       &#x3C;/manifestEntries&#x3E;\n-     *     &#x3C;/manifestSection&#x3E;\n-     *   &#x3C;/manifestSections&#x3E;\n-     * &#x3C;/configuration&#x3E;\n-     * </pre></code>\n-     */\n-    @Parameter(property = \"manifestSections\")\n-    private List<ManifestSection> manifestSections;\n-\n     /** Skip the execution of this mojo */\n     @Parameter(defaultValue = \"false\", property = \"quarkus.build.skip\")\n     private boolean skip = false;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNTQxMA==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r399235410", "bodyText": "@geoand As we will just be using the property, should I simplify these separators to just \":\" and \"=\"?", "author": "aaron-rogers82", "createdAt": "2020-03-27T12:40:52Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -116,6 +116,9 @@\n     private static final OpenOption[] DEFAULT_OPEN_OPTIONS = { TRUNCATE_EXISTING, WRITE, CREATE };\n     private static final BiPredicate<Path, BasicFileAttributes> IS_JSON_FILE_PREDICATE = new IsJsonFilePredicate();\n \n+    private static final String MANIFEST_SECTION_SEPARATOR = \"::\";\n+    private static final String MANIFEST_ENTRY_KV_SEPARATOR = \"\\\\=\\\\|\\\\|\\\\=\";", "originalCommit": "6acbbb107170f1eefeb674ad6ebd7aa8d9c4b02c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNjAzNA==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r399236034", "bodyText": "Yeah, that makes sense", "author": "geoand", "createdAt": "2020-03-27T12:42:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNTQxMA=="}], "type": "inlineReview", "revised_code": {"commit": "f0f72c85095bd1101924deb69b64ae6d02accfaa", "chunk": "diff --git a/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java b/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java\nindex 741c0fd56d..9c072a27bf 100644\n--- a/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java\n+++ b/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java\n\n@@ -116,9 +116,6 @@ public class JarResultBuildStep {\n     private static final OpenOption[] DEFAULT_OPEN_OPTIONS = { TRUNCATE_EXISTING, WRITE, CREATE };\n     private static final BiPredicate<Path, BasicFileAttributes> IS_JSON_FILE_PREDICATE = new IsJsonFilePredicate();\n \n-    private static final String MANIFEST_SECTION_SEPARATOR = \"::\";\n-    private static final String MANIFEST_ENTRY_KV_SEPARATOR = \"\\\\=\\\\|\\\\|\\\\=\";\n-\n     @BuildStep\n     OutputTargetBuildItem outputTarget(BuildSystemTargetBuildItem bst, PackageConfig packageConfig) {\n         String name = packageConfig.outputName.isPresent() ? packageConfig.outputName.get() : bst.getBaseName();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE4ODc5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400188797", "bodyText": "@aloubyansky @stuartwdouglas are you OK with this format?", "author": "geoand", "createdAt": "2020-03-30T13:26:26Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/ManifestConfig.java", "diffHunk": "@@ -12,4 +15,11 @@\n     @ConfigItem(defaultValue = \"true\")\n     public boolean addImplementationEntries;\n \n+    /**\n+     * Custom manifest sections to be added to the MANIFEST.MF file.\n+     * An example of the user defined property:\n+     * quarkus.package.manifest.manifest-sections={Section Name}:{Key1}={Value1},{Section Name}:{Key2}={Value2}", "originalCommit": "1ae7dd2217d46284c7ad69166843528fae7832ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3ODEwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400578105", "bodyText": "I think this should be represented as a Map, rather than a fully de-typed format.", "author": "stuartwdouglas", "createdAt": "2020-03-31T00:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE4ODc5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "f0f72c85095bd1101924deb69b64ae6d02accfaa", "chunk": "diff --git a/core/deployment/src/main/java/io/quarkus/deployment/pkg/ManifestConfig.java b/core/deployment/src/main/java/io/quarkus/deployment/pkg/ManifestConfig.java\nindex 7a4974e1f2..db1f2723ad 100644\n--- a/core/deployment/src/main/java/io/quarkus/deployment/pkg/ManifestConfig.java\n+++ b/core/deployment/src/main/java/io/quarkus/deployment/pkg/ManifestConfig.java\n\n@@ -18,8 +17,9 @@ public class ManifestConfig {\n     /**\n      * Custom manifest sections to be added to the MANIFEST.MF file.\n      * An example of the user defined property:\n-     * quarkus.package.manifest.manifest-sections={Section Name}:{Key1}={Value1},{Section Name}:{Key2}={Value2}\n+     * quarkus.package.manifest.manifest-sections.{Section-Name}.{Entry-Key1}={Value1}\n+     * quarkus.package.manifest.manifest-sections.{Section-Name}.{Entry-Key2}={Value2}\n      */\n     @ConfigItem()\n-    public Optional<List<String>> manifestSections;\n+    public Map<String, Map<String, String>> manifestSections;\n }\n"}}, {"oid": "f0f72c85095bd1101924deb69b64ae6d02accfaa", "url": "https://github.com/quarkusio/quarkus/commit/f0f72c85095bd1101924deb69b64ae6d02accfaa", "message": "Added ability for custom manifest sections entries to be added to manifest.mf", "committedDate": "2020-03-31T18:22:25Z", "type": "commit"}]}