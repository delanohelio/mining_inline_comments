{"pr_number": 12309, "pr_title": "Remove reference to metrics classes in deployment", "pr_createdAt": "2020-09-23T21:51:35Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12309", "timeline": [{"oid": "8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed", "url": "https://github.com/quarkusio/quarkus/commit/8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed", "message": "Remove reference to metrics classes in deployment", "committedDate": "2020-09-23T21:49:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1ODk2MA==", "url": "https://github.com/quarkusio/quarkus/pull/12309#discussion_r494058960", "bodyText": "If it uses micrometer, how are the metrics reported?", "author": "cescoffier", "createdAt": "2020-09-24T06:06:16Z", "path": "extensions/smallrye-reactive-messaging/deployment/src/main/java/io/quarkus/smallrye/reactivemessaging/deployment/SmallRyeReactiveMessagingProcessor.java", "diffHunk": "@@ -282,11 +282,14 @@ private void createEmitter(BuildProducer<EmitterBuildItem> emitters, InjectionPo\n \n     @BuildStep\n     public void enableMetrics(BuildProducer<AnnotationsTransformerBuildItem> transformers,\n-            Capabilities capabilities, ReactiveMessagingConfiguration configuration) {\n-        boolean isMetricEnabled = capabilities.isPresent(Capability.METRICS) && configuration.metricsEnabled;\n-        if (!isMetricEnabled) {\n-            LOGGER.debug(\"Metric is disabled - vetoing the MetricDecorator\");\n-            // We veto the Metric Decorator\n+            Optional<MetricsCapabilityBuildItem> metricsCapability,\n+            ReactiveMessagingConfiguration configuration) {\n+        boolean isMetricEnabled = metricsCapability.isPresent() && configuration.metricsEnabled;\n+        boolean useMicrometer = isMetricEnabled && metricsCapability.get().metricsSupported(MetricsFactory.MICROMETER);\n+        if (!isMetricEnabled || useMicrometer) {", "originalCommit": "8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI3NjU5MA==", "url": "https://github.com/quarkusio/quarkus/pull/12309#discussion_r494276590", "bodyText": "They aren't (yet). I was going to have another conversation with you about what metrics should be emitted w/ micrometer. (The metrics in this Decorator are only expected if MP Metrics is present, and I am not sure they're useful enough to preserve?)", "author": "ebullient", "createdAt": "2020-09-24T12:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1ODk2MA=="}], "type": "inlineReview", "revised_code": null}]}