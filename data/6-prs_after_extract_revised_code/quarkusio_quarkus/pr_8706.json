{"pr_number": 8706, "pr_title": "Add gradle wrapper into platform-descriptor", "pr_createdAt": "2020-04-20T15:15:39Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8706", "timeline": [{"oid": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "url": "https://github.com/quarkusio/quarkus/commit/71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "message": "Add gradle wrapper into platform-descriptor", "committedDate": "2020-04-21T08:21:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA0NjcxOA==", "url": "https://github.com/quarkusio/quarkus/pull/8706#discussion_r412046718", "bodyText": "Shouldn't we just drop the part where we try to use a local Gradle? I think copying things is better.", "author": "gsmet", "createdAt": "2020-04-21T09:58:40Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java", "diffHunk": "@@ -248,7 +253,10 @@ private void createGradleWrapper(File projectDirectory, Properties props) {\n                 getLog().warn(\"Unable to install the Gradle wrapper (./gradlew) in project. See log for details.\");\n             }\n \n-        } catch (InterruptedException | IOException e) {\n+        } catch (IOException e) {\n+            getLog().warn(\"Unable to install the Gradle wrapper with gradle. Gradle wrapper is going to be copy.\");\n+            copyGradleWrapperFiles(platform, writer);", "originalCommit": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "80b00577e919fc0db08ad1cbea34e5d7325e458f", "chunk": "diff --git a/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java b/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java\nindex a6bfdbc03e..a379eb1c4b 100644\n--- a/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java\n+++ b/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java\n\n@@ -238,34 +237,8 @@ public class CreateProjectMojo extends AbstractMojo {\n         }\n     }\n \n-    private void createGradleWrapper(File projectDirectory, Properties props, QuarkusPlatformDescriptor platform,\n+    private void createGradleWrapper(QuarkusPlatformDescriptor platform,\n             ProjectWriter writer) {\n-        try {\n-            String gradleName = IS_WINDOWS ? \"gradle.bat\" : \"gradle\";\n-            ProcessBuilder pb = new ProcessBuilder(gradleName, \"wrapper\",\n-                    \"--gradle-version=\" + ToolsUtils.getGradleWrapperVersion(props)).directory(projectDirectory)\n-                            .inheritIO();\n-            Process x = pb.start();\n-\n-            x.waitFor();\n-\n-            if (x.exitValue() != 0) {\n-                getLog().warn(\"Unable to install the Gradle wrapper (./gradlew) in project. See log for details.\");\n-            }\n-\n-        } catch (IOException e) {\n-            getLog().warn(\"Unable to install the Gradle wrapper with gradle. Gradle wrapper is going to be copy.\");\n-            copyGradleWrapperFiles(platform, writer);\n-        } catch (InterruptedException e) {\n-            // no reason to fail if the wrapper could not be created\n-            getLog().error(\n-                    \"Unable to install the Gradle wrapper (./gradlew) in the project. You need to have gradle installed to generate the wrapper files.\",\n-                    e);\n-        }\n-\n-    }\n-\n-    private void copyGradleWrapperFiles(QuarkusPlatformDescriptor platform, ProjectWriter writer) {\n         try {\n             writer.mkdirs(\"gradle/wrapper\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA0Njg2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8706#discussion_r412046867", "bodyText": "We don't want to lose the exception.", "author": "gsmet", "createdAt": "2020-04-21T09:58:52Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java", "diffHunk": "@@ -257,6 +265,28 @@ private void createGradleWrapper(File projectDirectory, Properties props) {\n \n     }\n \n+    private void copyGradleWrapperFiles(QuarkusPlatformDescriptor platform, ProjectWriter writer) {\n+        try {\n+            writer.mkdirs(\"gradle/wrapper\");\n+\n+            for (String filename : CreateUtils.GRADLE_WRAPPER_FILES) {\n+                byte[] fileContent = platform.loadResource(Paths.get(CreateUtils.GRADLE_WRAPPER_PATH, filename).toString(),\n+                        is -> {\n+                            byte[] buffer = new byte[is.available()];\n+                            is.read(buffer);\n+                            return buffer;\n+                        });\n+                final Path destination = writer.getProjectFolder().toPath().resolve(filename);\n+                Files.write(destination, fileContent);\n+            }\n+\n+            new File(writer.getProjectFolder(), \"gradlew\").setExecutable(true);\n+            new File(writer.getProjectFolder(), \"gradlew.bat\").setExecutable(true);\n+        } catch (IOException e) {\n+            getLog().error(\"Unable to copy Gradle wrapper from platform descriptor\");", "originalCommit": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "80b00577e919fc0db08ad1cbea34e5d7325e458f", "chunk": "diff --git a/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java b/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java\nindex a6bfdbc03e..a379eb1c4b 100644\n--- a/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java\n+++ b/devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java\n\n@@ -238,34 +237,8 @@ public class CreateProjectMojo extends AbstractMojo {\n         }\n     }\n \n-    private void createGradleWrapper(File projectDirectory, Properties props, QuarkusPlatformDescriptor platform,\n+    private void createGradleWrapper(QuarkusPlatformDescriptor platform,\n             ProjectWriter writer) {\n-        try {\n-            String gradleName = IS_WINDOWS ? \"gradle.bat\" : \"gradle\";\n-            ProcessBuilder pb = new ProcessBuilder(gradleName, \"wrapper\",\n-                    \"--gradle-version=\" + ToolsUtils.getGradleWrapperVersion(props)).directory(projectDirectory)\n-                            .inheritIO();\n-            Process x = pb.start();\n-\n-            x.waitFor();\n-\n-            if (x.exitValue() != 0) {\n-                getLog().warn(\"Unable to install the Gradle wrapper (./gradlew) in project. See log for details.\");\n-            }\n-\n-        } catch (IOException e) {\n-            getLog().warn(\"Unable to install the Gradle wrapper with gradle. Gradle wrapper is going to be copy.\");\n-            copyGradleWrapperFiles(platform, writer);\n-        } catch (InterruptedException e) {\n-            // no reason to fail if the wrapper could not be created\n-            getLog().error(\n-                    \"Unable to install the Gradle wrapper (./gradlew) in the project. You need to have gradle installed to generate the wrapper files.\",\n-                    e);\n-        }\n-\n-    }\n-\n-    private void copyGradleWrapperFiles(QuarkusPlatformDescriptor platform, ProjectWriter writer) {\n         try {\n             writer.mkdirs(\"gradle/wrapper\");\n \n"}}, {"oid": "80b00577e919fc0db08ad1cbea34e5d7325e458f", "url": "https://github.com/quarkusio/quarkus/commit/80b00577e919fc0db08ad1cbea34e5d7325e458f", "message": "Add gradle wrapper into platform-descriptor", "committedDate": "2020-04-21T13:36:36Z", "type": "forcePushed"}, {"oid": "ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "url": "https://github.com/quarkusio/quarkus/commit/ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "message": "Add gradle wrapper into platform-descriptor", "committedDate": "2020-04-21T13:54:25Z", "type": "commit"}, {"oid": "ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "url": "https://github.com/quarkusio/quarkus/commit/ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "message": "Add gradle wrapper into platform-descriptor", "committedDate": "2020-04-21T13:54:25Z", "type": "forcePushed"}]}