{"pr_number": 7630, "pr_title": "Show useful warning message when @ConfigProperty used in JAX-RS Provider", "pr_createdAt": "2020-03-06T09:05:26Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7630", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NzQwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/7630#discussion_r388787409", "bodyText": "javax.enterprise.inject.Instance is also legal... and it extends Provider ;-).", "author": "mkouba", "createdAt": "2020-03-06T09:11:24Z", "path": "extensions/resteasy-common/deployment/src/main/java/io/quarkus/resteasy/common/deployment/ResteasyCommonProcessor.java", "diffHunk": "@@ -187,6 +191,29 @@ JaxrsProvidersToRegisterBuildItem setupProviders(BuildProducer<ReflectiveClassBu\n         return new JaxrsProvidersToRegisterBuildItem(providersToRegister, contributedProviders, useBuiltinProviders);\n     }\n \n+    private void checkProperConfigAccessInProvider(AnnotationInstance instance) {\n+        List<AnnotationInstance> configPropertyInstances = instance.target().asClass().annotations()\n+                .get(ResteasyDotNames.CONFIG_PROPERTY);\n+        if (configPropertyInstances == null) {\n+            return;\n+        }\n+        for (AnnotationInstance configPropertyInstance : configPropertyInstances) {\n+            if (configPropertyInstance.target().kind() != AnnotationTarget.Kind.FIELD) {\n+                continue;\n+            }\n+            FieldInfo field = configPropertyInstance.target().asField();\n+            Type fieldType = field.type();\n+            if (ResteasyDotNames.CDI_PROVIDER.equals(fieldType.name())) {", "originalCommit": "75eed1df654b3560f1cbd2ea944efa8ff1655b89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4OTQ0MA==", "url": "https://github.com/quarkusio/quarkus/pull/7630#discussion_r388789440", "bodyText": "Actually I think we should just propose Instance since the name doesn't class with the JAX-RS Provider. WDYT?", "author": "geoand", "createdAt": "2020-03-06T09:15:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NzQwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc5MDg3Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7630#discussion_r388790873", "bodyText": "Fixed", "author": "geoand", "createdAt": "2020-03-06T09:19:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NzQwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "f4ae1d623c9e03bd6c24c870dee2d603da30ec99", "chunk": "diff --git a/extensions/resteasy-common/deployment/src/main/java/io/quarkus/resteasy/common/deployment/ResteasyCommonProcessor.java b/extensions/resteasy-common/deployment/src/main/java/io/quarkus/resteasy/common/deployment/ResteasyCommonProcessor.java\nindex 0bcb0769ee..4e826751ac 100644\n--- a/extensions/resteasy-common/deployment/src/main/java/io/quarkus/resteasy/common/deployment/ResteasyCommonProcessor.java\n+++ b/extensions/resteasy-common/deployment/src/main/java/io/quarkus/resteasy/common/deployment/ResteasyCommonProcessor.java\n\n@@ -203,13 +203,13 @@ public class ResteasyCommonProcessor {\n             }\n             FieldInfo field = configPropertyInstance.target().asField();\n             Type fieldType = field.type();\n-            if (ResteasyDotNames.CDI_PROVIDER.equals(fieldType.name())) {\n+            if (ResteasyDotNames.CDI_INSTANCE.equals(fieldType.name())) {\n                 continue;\n             }\n             LOGGER.warn(\n                     \"Directly injecting a @\" + ResteasyDotNames.CONFIG_PROPERTY.withoutPackagePrefix()\n                             + \" into a JAX-RS provider may lead to unexpected results. To ensure proper results, please change the type of the field to \"\n-                            + ParameterizedType.create(ResteasyDotNames.CDI_PROVIDER, new Type[] { fieldType }, null)\n+                            + ParameterizedType.create(ResteasyDotNames.CDI_INSTANCE, new Type[] { fieldType }, null)\n                             + \". Offending field is '\" + field.name() + \"' of class '\" + field.declaringClass() + \"'\");\n         }\n     }\n"}}, {"oid": "f4ae1d623c9e03bd6c24c870dee2d603da30ec99", "url": "https://github.com/quarkusio/quarkus/commit/f4ae1d623c9e03bd6c24c870dee2d603da30ec99", "message": "Show useful warning message when @ConfigProperty used in JAX-RS Provider", "committedDate": "2020-03-06T09:18:52Z", "type": "commit"}, {"oid": "f4ae1d623c9e03bd6c24c870dee2d603da30ec99", "url": "https://github.com/quarkusio/quarkus/commit/f4ae1d623c9e03bd6c24c870dee2d603da30ec99", "message": "Show useful warning message when @ConfigProperty used in JAX-RS Provider", "committedDate": "2020-03-06T09:18:52Z", "type": "forcePushed"}]}