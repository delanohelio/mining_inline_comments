{"pr_number": 11159, "pr_title": "Ensure quarkusBuild Gradle task works properly with fast-jar", "pr_createdAt": "2020-08-03T11:41:40Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11159", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2Njg4OA==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464366888", "bodyText": "It's not a problem if only one of the two is created when running the goal?", "author": "gsmet", "createdAt": "2020-08-03T11:56:54Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java", "diffHunk": "@@ -78,13 +78,18 @@ public FileCollection getClasspath() {\n     }\n \n     @OutputFile\n-    public File getOutputDir() {\n+    public File runnerJar() {\n         return new File(getProject().getBuildDir(), extension().finalName() + \"-runner.jar\");\n     }\n \n+    @OutputFile\n+    public File fastJar() {\n+        return new File(getProject().getBuildDir(), \"quarkus-app\");", "originalCommit": "94b7cac3e96359cec93ba392369ad747c2c9b2f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2NzM5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464367393", "bodyText": "I had the same question myself, so I ran multiple tests and didn't see any problem.\nOf course this will need to vetted by our Gradle experts :)", "author": "geoand", "createdAt": "2020-08-03T11:58:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2Njg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2OTI5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464369293", "bodyText": "Actually I had the same thought too, there are tests checking, if this is ok, we could also declare the native build result.", "author": "glefloch", "createdAt": "2020-08-03T12:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2Njg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2OTg3Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464369873", "bodyText": "@glefloch yeah, that's a good idea for a follow up", "author": "geoand", "createdAt": "2020-08-03T12:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2Njg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNDQ2MA==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464624460", "bodyText": "Oh this should be @OutputDirectory then.\nAnd reading the documentation, it should works as expected:\nThis will cause the task to be considered out-of-date when the directory path or task output to that directory has been modified since the task was last run.\n\nMissing directory should not be a problem.", "author": "glefloch", "createdAt": "2020-08-03T19:43:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2Njg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNjY4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464626682", "bodyText": "Oh nice, I didn't know of that annotation", "author": "geoand", "createdAt": "2020-08-03T19:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2Njg4OA=="}], "type": "inlineReview", "revised_code": {"commit": "0d771c1e1862d94e2999f1cb32842d89f843b67d", "chunk": "diff --git a/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java b/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java\nindex 2eb3cdb510..1beb2493a7 100644\n--- a/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java\n+++ b/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java\n\n@@ -78,12 +78,12 @@ public class QuarkusBuild extends QuarkusTask {\n     }\n \n     @OutputFile\n-    public File runnerJar() {\n+    public File getRunnerJar() {\n         return new File(getProject().getBuildDir(), extension().finalName() + \"-runner.jar\");\n     }\n \n     @OutputFile\n-    public File fastJar() {\n+    public File getFastJar() {\n         return new File(getProject().getBuildDir(), \"quarkus-app\");\n     }\n \n"}}, {"oid": "0d771c1e1862d94e2999f1cb32842d89f843b67d", "url": "https://github.com/quarkusio/quarkus/commit/0d771c1e1862d94e2999f1cb32842d89f843b67d", "message": "Ensure quarkusBuild Gradle task works properly with fast-jar\n\nWhen building a fast-jar, the typical runner jar is not created\nso we need to make Gradle aware of this new output\n\nFixes: #11157", "committedDate": "2020-08-03T13:12:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxMTM2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464611366", "bodyText": "Sorry my ignorance, but isn't a `\u00b7jar' extension missing here?", "author": "gastaldi", "createdAt": "2020-08-03T19:15:28Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java", "diffHunk": "@@ -78,13 +78,18 @@ public FileCollection getClasspath() {\n     }\n \n     @OutputFile\n-    public File getOutputDir() {\n+    public File getRunnerJar() {\n         return new File(getProject().getBuildDir(), extension().finalName() + \"-runner.jar\");\n     }\n \n+    @OutputFile\n+    public File getFastJar() {\n+        return new File(getProject().getBuildDir(), \"quarkus-app\");", "originalCommit": "0d771c1e1862d94e2999f1cb32842d89f843b67d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxMzQ2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464613467", "bodyText": "This is just the directory where all the fast-jar output goes", "author": "geoand", "createdAt": "2020-08-03T19:19:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxMTM2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNTA3NA==", "url": "https://github.com/quarkusio/quarkus/pull/11159#discussion_r464625074", "bodyText": "This should be @OutputDirectory then.\nBTW, reading the documentation, a missing directory should not be a problem.", "author": "glefloch", "createdAt": "2020-08-03T19:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxMTM2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "85a091b94402cd5aff27cfe72d530d878b1bbca6", "chunk": "diff --git a/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java b/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java\nindex 1beb2493a7..91a65ced2f 100644\n--- a/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java\n+++ b/devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusBuild.java\n\n@@ -82,7 +83,7 @@ public class QuarkusBuild extends QuarkusTask {\n         return new File(getProject().getBuildDir(), extension().finalName() + \"-runner.jar\");\n     }\n \n-    @OutputFile\n+    @OutputDirectory\n     public File getFastJar() {\n         return new File(getProject().getBuildDir(), \"quarkus-app\");\n     }\n"}}, {"oid": "85a091b94402cd5aff27cfe72d530d878b1bbca6", "url": "https://github.com/quarkusio/quarkus/commit/85a091b94402cd5aff27cfe72d530d878b1bbca6", "message": "Ensure quarkusBuild Gradle task works properly with fast-jar\n\nWhen building a fast-jar, the typical runner jar is not created\nso we need to make Gradle aware of this new output\n\nFixes: #11157", "committedDate": "2020-08-03T19:52:54Z", "type": "commit"}, {"oid": "85a091b94402cd5aff27cfe72d530d878b1bbca6", "url": "https://github.com/quarkusio/quarkus/commit/85a091b94402cd5aff27cfe72d530d878b1bbca6", "message": "Ensure quarkusBuild Gradle task works properly with fast-jar\n\nWhen building a fast-jar, the typical runner jar is not created\nso we need to make Gradle aware of this new output\n\nFixes: #11157", "committedDate": "2020-08-03T19:52:54Z", "type": "forcePushed"}]}