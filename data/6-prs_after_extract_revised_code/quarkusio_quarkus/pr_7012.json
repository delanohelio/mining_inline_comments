{"pr_number": 7012, "pr_title": "Check to see if injection point is same as current thread local value", "pr_createdAt": "2020-02-05T16:27:40Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7012", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM5MzE2OA==", "url": "https://github.com/quarkusio/quarkus/pull/7012#discussion_r375393168", "bodyText": "You could move that one outside of the else and call InjectionPointProvider.CURRENT.get() only once in all cases. Or do I miss something?", "author": "gsmet", "createdAt": "2020-02-05T17:16:05Z", "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InjectionPointProvider.java", "diffHunk": "@@ -25,9 +25,13 @@ public InjectionPoint get(CreationalContext<InjectionPoint> creationalContext) {\n      */\n     static InjectionPoint set(InjectionPoint injectionPoint) {\n         if (injectionPoint != null) {\n-            InjectionPoint prev = InjectionPointProvider.CURRENT.get();\n-            InjectionPointProvider.CURRENT.set(injectionPoint);\n-            return prev;\n+            if (injectionPoint.equals(InjectionPointProvider.CURRENT.get())) {\n+                return injectionPoint;\n+            } else {\n+                InjectionPoint prev = InjectionPointProvider.CURRENT.get();", "originalCommit": "edb3f8f73c9e9b1afc6b5b52a0b4762fc39b7eb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM5NzM0OA==", "url": "https://github.com/quarkusio/quarkus/pull/7012#discussion_r375397348", "bodyText": "Good point, I will update the PR", "author": "johnaohara", "createdAt": "2020-02-05T17:23:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM5MzE2OA=="}], "type": "inlineReview", "revised_code": {"commit": "4a776bafe8c60240b62bab0d2790bdfcbf32f382", "chunk": "diff --git a/independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InjectionPointProvider.java b/independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InjectionPointProvider.java\nindex bae2c91933..235cc41207 100644\n--- a/independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InjectionPointProvider.java\n+++ b/independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InjectionPointProvider.java\n\n@@ -25,10 +25,10 @@ public class InjectionPointProvider implements InjectableReferenceProvider<Injec\n      */\n     static InjectionPoint set(InjectionPoint injectionPoint) {\n         if (injectionPoint != null) {\n-            if (injectionPoint.equals(InjectionPointProvider.CURRENT.get())) {\n+            InjectionPoint prev = InjectionPointProvider.CURRENT.get();\n+            if (injectionPoint.equals(prev)) {\n                 return injectionPoint;\n             } else {\n-                InjectionPoint prev = InjectionPointProvider.CURRENT.get();\n                 InjectionPointProvider.CURRENT.set(injectionPoint);\n                 return prev;\n             }\n"}}, {"oid": "4a776bafe8c60240b62bab0d2790bdfcbf32f382", "url": "https://github.com/quarkusio/quarkus/commit/4a776bafe8c60240b62bab0d2790bdfcbf32f382", "message": "Check to see if injection point is same as current thread local value", "committedDate": "2020-02-05T17:25:07Z", "type": "commit"}, {"oid": "4a776bafe8c60240b62bab0d2790bdfcbf32f382", "url": "https://github.com/quarkusio/quarkus/commit/4a776bafe8c60240b62bab0d2790bdfcbf32f382", "message": "Check to see if injection point is same as current thread local value", "committedDate": "2020-02-05T17:25:07Z", "type": "forcePushed"}]}