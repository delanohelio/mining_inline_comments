{"pr_number": 11306, "pr_title": "Introduce QuarkusPlatformDescriptor.getMetadata", "pr_createdAt": "2020-08-10T15:57:50Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11306", "timeline": [{"oid": "2a250785155e878fe5642268565f2a287543abd7", "url": "https://github.com/quarkusio/quarkus/commit/2a250785155e878fe5642268565f2a287543abd7", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T15:59:23Z", "type": "forcePushed"}, {"oid": "04c65cebb669727897b17f68b7e1fb9adc3e7ea4", "url": "https://github.com/quarkusio/quarkus/commit/04c65cebb669727897b17f68b7e1fb9adc3e7ea4", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T16:00:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMDI3Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468030273", "bodyText": "master appears to be platforms.get(0)?\nThis does not look consistent with how other pieces (extensions, managed deps) are merged, i.e. in other places what appears first wins while here the last platform overrides the previous one, including the master.", "author": "aloubyansky", "createdAt": "2020-08-10T16:29:45Z", "path": "independent-projects/tools/platform-descriptor-api/src/main/java/io/quarkus/platform/descriptor/CombinedQuarkusPlatformDescriptor.java", "diffHunk": "@@ -79,6 +82,16 @@ public String getQuarkusVersion() {\n         return master.getQuarkusVersion();\n     }\n \n+    @Override\n+    public Map<String, Object> getMetadata() {\n+        Map<String, Object> metadata = new LinkedHashMap<>();\n+        metadata.putAll(master.getMetadata());\n+        for (QuarkusPlatformDescriptor platform : platforms) {\n+            metadata.putAll(platform.getMetadata());", "originalCommit": "04c65cebb669727897b17f68b7e1fb9adc3e7ea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMDQ5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468030495", "bodyText": "Otherwise, it looks good to me.", "author": "aloubyansky", "createdAt": "2020-08-10T16:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMDI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA1MDk3OA==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468050978", "bodyText": "I reversed the put operations, see if that makes sense", "author": "gastaldi", "createdAt": "2020-08-10T17:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMDI3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "26146c05d19b4e7d68c67ac4719bbb2453c76062", "chunk": "diff --git a/independent-projects/tools/platform-descriptor-api/src/main/java/io/quarkus/platform/descriptor/CombinedQuarkusPlatformDescriptor.java b/independent-projects/tools/platform-descriptor-api/src/main/java/io/quarkus/platform/descriptor/CombinedQuarkusPlatformDescriptor.java\nindex d8f46c3f8f..2d23142347 100644\n--- a/independent-projects/tools/platform-descriptor-api/src/main/java/io/quarkus/platform/descriptor/CombinedQuarkusPlatformDescriptor.java\n+++ b/independent-projects/tools/platform-descriptor-api/src/main/java/io/quarkus/platform/descriptor/CombinedQuarkusPlatformDescriptor.java\n\n@@ -85,9 +85,8 @@ public class CombinedQuarkusPlatformDescriptor implements QuarkusPlatformDescrip\n     @Override\n     public Map<String, Object> getMetadata() {\n         Map<String, Object> metadata = new LinkedHashMap<>();\n-        metadata.putAll(master.getMetadata());\n-        for (QuarkusPlatformDescriptor platform : platforms) {\n-            metadata.putAll(platform.getMetadata());\n+        for (int i = platforms.size() - 1; i >= 0; i--) {\n+            metadata.putAll(platforms.get(i).getMetadata());\n         }\n         return master.getMetadata();\n     }\n"}}, {"oid": "26146c05d19b4e7d68c67ac4719bbb2453c76062", "url": "https://github.com/quarkusio/quarkus/commit/26146c05d19b4e7d68c67ac4719bbb2453c76062", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T17:00:38Z", "type": "forcePushed"}, {"oid": "f7eed7d3ab192b0eaebc605eb2f84bc137a5b704", "url": "https://github.com/quarkusio/quarkus/commit/f7eed7d3ab192b0eaebc605eb2f84bc137a5b704", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T17:01:34Z", "type": "forcePushed"}, {"oid": "8810ae930d05bd7acb4dbdeae3896ecb9e542ccd", "url": "https://github.com/quarkusio/quarkus/commit/8810ae930d05bd7acb4dbdeae3896ecb9e542ccd", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T17:02:47Z", "type": "forcePushed"}, {"oid": "7dae67c381481fc6669188b540d74440509aa718", "url": "https://github.com/quarkusio/quarkus/commit/7dae67c381481fc6669188b540d74440509aa718", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T17:07:29Z", "type": "forcePushed"}, {"oid": "52023fc3716b483617bd9d69ad971fe1910fab8f", "url": "https://github.com/quarkusio/quarkus/commit/52023fc3716b483617bd9d69ad971fe1910fab8f", "message": "Introduce QuarkusPlatformDescriptor.getMetadata", "committedDate": "2020-08-10T17:09:29Z", "type": "commit"}, {"oid": "b9398e6a6e997c4dce49a21ce349e832ec3cd449", "url": "https://github.com/quarkusio/quarkus/commit/b9398e6a6e997c4dce49a21ce349e832ec3cd449", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-10T17:09:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ0Njg5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468446893", "bodyText": "As the plan is to backport it, I would prefer we don't change this behavior and only do it in a follow-up PR for 1.8.", "author": "gsmet", "createdAt": "2020-08-11T09:26:02Z", "path": "devtools/platform-descriptor-json/src/main/java/io/quarkus/platform/descriptor/loader/json/impl/QuarkusJsonPlatformDescriptorLoaderImpl.java", "diffHunk": "@@ -20,7 +21,7 @@ public QuarkusJsonPlatformDescriptor load(final QuarkusJsonPlatformDescriptorLoa\n                     try {\n                         ObjectMapper mapper = new ObjectMapper()\n                                 .enable(JsonParser.Feature.ALLOW_COMMENTS)\n-                                .enable(JsonParser.Feature.ALLOW_NUMERIC_LEADING_ZEROS)", "originalCommit": "b9398e6a6e997c4dce49a21ce349e832ec3cd449", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ2ODE5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468468191", "bodyText": "yeah, I would leave that change out to reduce change. Not that i even know why we ever would have a file with leading zeros ;)", "author": "maxandersen", "createdAt": "2020-08-11T10:03:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ0Njg5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ3ODAzMw==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468478033", "bodyText": "Sure. FYI that property is deprecated for a long time now and should be removed in future Jackson versions", "author": "gastaldi", "createdAt": "2020-08-11T10:22:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ0Njg5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5Mzc2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/11306#discussion_r468493769", "bodyText": "I have no objection trying to remove it in 1.8.", "author": "gsmet", "createdAt": "2020-08-11T10:53:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ0Njg5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "aac805a6f9c136de0174ea619991a3193f1f61ec", "chunk": "diff --git a/devtools/platform-descriptor-json/src/main/java/io/quarkus/platform/descriptor/loader/json/impl/QuarkusJsonPlatformDescriptorLoaderImpl.java b/devtools/platform-descriptor-json/src/main/java/io/quarkus/platform/descriptor/loader/json/impl/QuarkusJsonPlatformDescriptorLoaderImpl.java\nindex 772273e977..2c7eba3894 100644\n--- a/devtools/platform-descriptor-json/src/main/java/io/quarkus/platform/descriptor/loader/json/impl/QuarkusJsonPlatformDescriptorLoaderImpl.java\n+++ b/devtools/platform-descriptor-json/src/main/java/io/quarkus/platform/descriptor/loader/json/impl/QuarkusJsonPlatformDescriptorLoaderImpl.java\n\n@@ -21,6 +21,7 @@ public class QuarkusJsonPlatformDescriptorLoaderImpl\n                     try {\n                         ObjectMapper mapper = new ObjectMapper()\n                                 .enable(JsonParser.Feature.ALLOW_COMMENTS)\n+                                .enable(JsonParser.Feature.ALLOW_NUMERIC_LEADING_ZEROS)\n                                 .configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false)\n                                 .setPropertyNamingStrategy(PropertyNamingStrategy.KEBAB_CASE);\n                         return mapper.readValue(is, QuarkusJsonPlatformDescriptor.class);\n"}}, {"oid": "aac805a6f9c136de0174ea619991a3193f1f61ec", "url": "https://github.com/quarkusio/quarkus/commit/aac805a6f9c136de0174ea619991a3193f1f61ec", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-11T10:49:35Z", "type": "commit"}, {"oid": "aac805a6f9c136de0174ea619991a3193f1f61ec", "url": "https://github.com/quarkusio/quarkus/commit/aac805a6f9c136de0174ea619991a3193f1f61ec", "message": "Make platform parsing lenient\n\nThis helps when future changes to the platform JSON are needed", "committedDate": "2020-08-11T10:49:35Z", "type": "forcePushed"}]}