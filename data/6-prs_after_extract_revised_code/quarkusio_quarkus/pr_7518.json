{"pr_number": 7518, "pr_title": "Support OIDC client_secret_post client authentication", "pr_createdAt": "2020-03-02T18:26:54Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7518", "timeline": [{"oid": "d4c3a063385f7683b2a4a29a82d79b3fa95a7c5b", "url": "https://github.com/quarkusio/quarkus/commit/d4c3a063385f7683b2a4a29a82d79b3fa95a7c5b", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-02T18:29:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4MjU2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7518#discussion_r386582566", "bodyText": "I'm not sure about having this as a credential type. For me, credentials types as jwt, secret, mtls, etc. Which are related to the method that will be used to authenticate the client.\nWhat if you have quarkus.oidc.credentials.secret.method instead ? Where secret would become a config object ?", "author": "pedroigor", "createdAt": "2020-03-02T18:53:05Z", "path": "extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcTenantConfig.java", "diffHunk": "@@ -171,6 +171,20 @@ public void setTenantId(String tenantId) {\n     @ConfigGroup\n     public static class Credentials {\n \n+        public static enum Type {", "originalCommit": "d4c3a063385f7683b2a4a29a82d79b3fa95a7c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxODE5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/7518#discussion_r386718191", "bodyText": "Hi @pedroigor This looks a bit complex ? In the simple case the user would have to do quarkus.oidc.credentials.secret.value=secret ?\nI agree quarkus.oidc.credentials.secret should've ideally been part of some other object like client authentication, but it is already there now, so I thought we could avoid another migration problem and qualify how that secret should be used, with this Type covering client_secret_basic, client_secret_post and easily client_secret_jwt.\nWhen we will need to support private_key_jwt or mtls, then we'd have some new convention/holder for those and can just doc that secret property is ignored unless it is client_secret_basic, client_secret_post and easily client_secret_jwt.\nPerhaps I can rename Type to Method and doc that this Method identifies how the credentials like 'secret' (or private_key or cert in the future) are used.\nWould it be a reasonable compromise ?\nThanks", "author": "sberyozkin", "createdAt": "2020-03-02T23:42:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4MjU2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk0NDQyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/7518#discussion_r386944429", "bodyText": "@pedroigor To summarize, adding an extra credentials.method property will let us support 3 out of 4 client authentication methods defined in the OIDC core as they are all built around the use of the client secret, all without introducing a migration requirement.\nTo support 2 more methods (private key for signing the jwt, mtls) we can either do a breaking configuration change and have a configuration object per every auth method or 3 at least (1 for client secret related, 1 for private key, 1 for mtls), or add a Map of Maps to credentials and say the key must match the Method enum value, something like that, but we should probably deal with it later :-)", "author": "sberyozkin", "createdAt": "2020-03-03T10:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4MjU2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b4b3294a5711aca620da5d4039d7cfe3a28fee11", "chunk": "diff --git a/extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcTenantConfig.java b/extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcTenantConfig.java\nindex da0d03b4e3..0d80503e9d 100644\n--- a/extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcTenantConfig.java\n+++ b/extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcTenantConfig.java\n\n@@ -171,19 +171,20 @@ public class OidcTenantConfig {\n     @ConfigGroup\n     public static class Credentials {\n \n-        public static enum Type {\n+        public static enum Method {\n             BASIC,\n             POST\n         }\n \n         /**\n-         * Client authentication type.\n+         * Client authentication method which controls how the client id and a credential\n+         * such as a client secret must be be used to authenticate the client.\n          *\n          * @see <a href=\n          *      \"https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication\">https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication</a>\n          */\n         @ConfigItem(defaultValue = \"BASIC\")\n-        Type type;\n+        Method method;\n \n         /**\n          * The client secret\n"}}, {"oid": "b4b3294a5711aca620da5d4039d7cfe3a28fee11", "url": "https://github.com/quarkusio/quarkus/commit/b4b3294a5711aca620da5d4039d7cfe3a28fee11", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-03T11:35:09Z", "type": "forcePushed"}, {"oid": "92f14e2f672371198dfa9a906bd563584b075ab9", "url": "https://github.com/quarkusio/quarkus/commit/92f14e2f672371198dfa9a906bd563584b075ab9", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-03T11:43:29Z", "type": "forcePushed"}, {"oid": "bbec4194ec49ccf887ba012dc71d97342810acbc", "url": "https://github.com/quarkusio/quarkus/commit/bbec4194ec49ccf887ba012dc71d97342810acbc", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-08T12:58:42Z", "type": "forcePushed"}, {"oid": "9168c8fb7b8d3faf25146d7d5a2ee0043bd95586", "url": "https://github.com/quarkusio/quarkus/commit/9168c8fb7b8d3faf25146d7d5a2ee0043bd95586", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-08T13:03:48Z", "type": "forcePushed"}, {"oid": "50fd4ccf9c141c3a667dec2be22dd7094e9e8dad", "url": "https://github.com/quarkusio/quarkus/commit/50fd4ccf9c141c3a667dec2be22dd7094e9e8dad", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-08T18:21:41Z", "type": "commit"}, {"oid": "50fd4ccf9c141c3a667dec2be22dd7094e9e8dad", "url": "https://github.com/quarkusio/quarkus/commit/50fd4ccf9c141c3a667dec2be22dd7094e9e8dad", "message": "Support OIDC client_secret_post client authentication", "committedDate": "2020-03-08T18:21:41Z", "type": "forcePushed"}]}