{"pr_number": 10679, "pr_title": "Qute message bundles - add @MessageParam", "pr_createdAt": "2020-07-13T12:43:10Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10679", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczNzYzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/10679#discussion_r453737635", "bodyText": "I think there's a %s missing here or the method has one too many parameters.", "author": "gsmet", "createdAt": "2020-07-13T15:33:10Z", "path": "extensions/qute/deployment/src/main/java/io/quarkus/qute/deployment/MessageBundleProcessor.java", "diffHunk": "@@ -552,7 +560,8 @@ private String generateImplementation(ClassInfo defaultBundleInterface, String d\n \n             if (messageAnnotation == null) {\n                 throw new MessageBundleException(\n-                        \"A message bundle interface method must be annotated with @Message: \" + method);\n+                        String.format(\"A message bundle interface method must be annotated with @Message on %s: \",", "originalCommit": "d5f78c6b092b12809141e8c105d0626bb86a8755", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI5ODQ0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10679#discussion_r454298442", "bodyText": "Good catch!", "author": "mkouba", "createdAt": "2020-07-14T11:48:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczNzYzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "c57d0c09613c34f365057927cb8f3cc4fcff81b5", "chunk": "diff --git a/extensions/qute/deployment/src/main/java/io/quarkus/qute/deployment/MessageBundleProcessor.java b/extensions/qute/deployment/src/main/java/io/quarkus/qute/deployment/MessageBundleProcessor.java\nindex 7b9d213f00..e3458df33a 100644\n--- a/extensions/qute/deployment/src/main/java/io/quarkus/qute/deployment/MessageBundleProcessor.java\n+++ b/extensions/qute/deployment/src/main/java/io/quarkus/qute/deployment/MessageBundleProcessor.java\n\n@@ -560,8 +560,8 @@ public class MessageBundleProcessor {\n \n             if (messageAnnotation == null) {\n                 throw new MessageBundleException(\n-                        String.format(\"A message bundle interface method must be annotated with @Message on %s: \",\n-                                bundleInterface, method));\n+                        \"A message bundle interface method must be annotated with @Message: \" +\n+                                bundleInterface.name() + \"#\" + method.name());\n             }\n \n             String key = getKey(method, messageAnnotation, defaultKeyValue);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczODE5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/10679#discussion_r453738193", "bodyText": "Should the -parameters recommendation come first?", "author": "gsmet", "createdAt": "2020-07-13T15:33:57Z", "path": "extensions/qute/deployment/src/main/java/io/quarkus/qute/deployment/MessageBundleProcessor.java", "diffHunk": "@@ -618,6 +623,27 @@ private String generateImplementation(ClassInfo defaultBundleInterface, String d\n         return generatedName.replace('/', '.');\n     }\n \n+    private String getParameterName(MethodInfo method, int position) {\n+        String name = method.parameterName(position);\n+        AnnotationInstance paramAnnotation = Annotations\n+                .find(Annotations.getParameterAnnotations(method.annotations()).stream()\n+                        .filter(a -> a.target().asMethodParameter().position() == position).collect(Collectors.toList()),\n+                        MESSAGE_PARAM);\n+        if (paramAnnotation != null) {\n+            AnnotationValue paramAnnotationValue = paramAnnotation.value();\n+            if (paramAnnotationValue != null && !paramAnnotationValue.asString().equals(Message.ELEMENT_NAME)) {\n+                name = paramAnnotationValue.asString();\n+            }\n+        }\n+        if (name == null) {\n+            throw new MessageBundleException(\"Unable to determine the name of the parameter at position \" + position\n+                    + \" in method \"\n+                    + method.declaringClass().name() + \"#\" + method.name()\n+                    + \"() - compile the class with debug info enabled (-g) or parameter names recorded (-parameters), or use @MessageParam to specify the value\");", "originalCommit": "d5f78c6b092b12809141e8c105d0626bb86a8755", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMwMDk3Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10679#discussion_r454300972", "bodyText": "Well, it depends. From jandex POV it does not matter. Also maven compiler does -g by default so I don't expect this message to be logged very often.", "author": "mkouba", "createdAt": "2020-07-14T11:53:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczODE5Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c57d0c09613c34f365057927cb8f3cc4fcff81b5", "url": "https://github.com/quarkusio/quarkus/commit/c57d0c09613c34f365057927cb8f3cc4fcff81b5", "message": "Qute message bundles - add @MessageParam\n\n- to bind an explicit name for a message bundle method parameter", "committedDate": "2020-07-14T11:55:39Z", "type": "commit"}, {"oid": "c57d0c09613c34f365057927cb8f3cc4fcff81b5", "url": "https://github.com/quarkusio/quarkus/commit/c57d0c09613c34f365057927cb8f3cc4fcff81b5", "message": "Qute message bundles - add @MessageParam\n\n- to bind an explicit name for a message bundle method parameter", "committedDate": "2020-07-14T11:55:39Z", "type": "forcePushed"}]}