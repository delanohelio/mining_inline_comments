{"pr_number": 9940, "pr_title": "Make the HTTP protocol version value, printed in access logs, conform to the Common Log Format", "pr_createdAt": "2020-06-11T07:36:40Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9940", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyMzE1MA==", "url": "https://github.com/quarkusio/quarkus/pull/9940#discussion_r438623150", "bodyText": "Should we have something like \"-\" as the default value? Because there's a good chance we will forget updating this code when they introduce 2.1 :).", "author": "gsmet", "createdAt": "2020-06-11T08:24:26Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java", "diffHunk": "@@ -23,8 +23,20 @@ public String readAttribute(final RoutingContext exchange) {\n                 .append(exchange.request().method())\n                 .append(' ')\n                 .append(exchange.request().uri());\n-        sb.append(' ')\n-                .append(exchange.request().version());\n+        sb.append(' ');\n+        String httpVersion = null;", "originalCommit": "c020b38aa6fc260e6effbab70391e7f2536b3ccc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyODYxNQ==", "url": "https://github.com/quarkusio/quarkus/pull/9940#discussion_r438628615", "bodyText": "You are right, I think that's better than having the literal \"null\" printed out. I'll update this PR.", "author": "jaikiran", "createdAt": "2020-06-11T08:34:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyMzE1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYzMTA3Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9940#discussion_r438631072", "bodyText": "Done. Updated the PR to use - as the default instead of null", "author": "jaikiran", "createdAt": "2020-06-11T08:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyMzE1MA=="}], "type": "inlineReview", "revised_code": {"commit": "96d882e66f05f3e41d7c2b59cb22adae9715fac9", "chunk": "diff --git a/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java b/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java\nindex b95c15ea4c..5485e70f61 100644\n--- a/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java\n+++ b/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java\n\n@@ -24,7 +24,7 @@ public class RequestLineAttribute implements ExchangeAttribute {\n                 .append(' ')\n                 .append(exchange.request().uri());\n         sb.append(' ');\n-        String httpVersion = null;\n+        String httpVersion = \"-\";\n         switch (exchange.request().version()) {\n             case HTTP_1_0:\n                 httpVersion = \"HTTP/1.0\";\n"}}, {"oid": "96d882e66f05f3e41d7c2b59cb22adae9715fac9", "url": "https://github.com/quarkusio/quarkus/commit/96d882e66f05f3e41d7c2b59cb22adae9715fac9", "message": "Make the HTTP protocol version value, printed in access logs, conform to the Common Log Format", "committedDate": "2020-06-11T08:37:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxNjAwNA==", "url": "https://github.com/quarkusio/quarkus/pull/9940#discussion_r438716004", "bodyText": "Wondering if a more future proof option would be to transform the enum name into the version.\nSomething like enumName.replace(\"HTTP_\", \"HTTP/\").replace(\"_\", \".\"). WDYT? Note this is pseudo code, probably best to replace all the remaining _ with dots. And maybe we should only do it if it starts with HTTP_ to be on the safe side.", "author": "gsmet", "createdAt": "2020-06-11T11:24:15Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java", "diffHunk": "@@ -23,8 +23,20 @@ public String readAttribute(final RoutingContext exchange) {\n                 .append(exchange.request().method())\n                 .append(' ')\n                 .append(exchange.request().uri());\n-        sb.append(' ')\n-                .append(exchange.request().version());\n+        sb.append(' ');\n+        String httpVersion = \"-\";\n+        switch (exchange.request().version()) {\n+            case HTTP_1_0:\n+                httpVersion = \"HTTP/1.0\";\n+                break;\n+            case HTTP_1_1:\n+                httpVersion = \"HTTP/1.1\";\n+                break;\n+            case HTTP_2:\n+                httpVersion = \"HTTP/2\";\n+                break;\n+        }", "originalCommit": "96d882e66f05f3e41d7c2b59cb22adae9715fac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxMjIyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9940#discussion_r438812221", "bodyText": "Hello @gsmet,\nI've updated the PR to include this suggestion. It's a best effort code to try and infer the HTTP version from the enum value. Essentially we are relying on whoever adds a new enum constant to follow the existing name convention in that enum. I didn't add too much and too complicated logic here since if this does end up reporting a \"wrong\" value in the log file, fixing it will be a simple change (to add the new case statement).\nLet me know if this is good enough.", "author": "jaikiran", "createdAt": "2020-06-11T14:04:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxNjAwNA=="}], "type": "inlineReview", "revised_code": {"commit": "fadb094872aa07bc13a967967c244c457d9d7a6e", "chunk": "diff --git a/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java b/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java\nindex 5485e70f61..4bed400215 100644\n--- a/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java\n+++ b/extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/attribute/RequestLineAttribute.java\n\n@@ -35,6 +35,13 @@ public class RequestLineAttribute implements ExchangeAttribute {\n             case HTTP_2:\n                 httpVersion = \"HTTP/2\";\n                 break;\n+            default:\n+                // best effort to try and infer the HTTP version from\n+                // any \"unknown\" enum value\n+                httpVersion = exchange.request().version().name()\n+                        .replace(\"HTTP_\", \"HTTP/\")\n+                        .replace(\"_\", \".\");\n+                break;\n         }\n         sb.append(httpVersion);\n         return sb.toString();\n"}}, {"oid": "fadb094872aa07bc13a967967c244c457d9d7a6e", "url": "https://github.com/quarkusio/quarkus/commit/fadb094872aa07bc13a967967c244c457d9d7a6e", "message": "Make the HTTP protocol version value, printed in access logs, conform to the Common Log Format", "committedDate": "2020-06-11T14:00:54Z", "type": "commit"}, {"oid": "fadb094872aa07bc13a967967c244c457d9d7a6e", "url": "https://github.com/quarkusio/quarkus/commit/fadb094872aa07bc13a967967c244c457d9d7a6e", "message": "Make the HTTP protocol version value, printed in access logs, conform to the Common Log Format", "committedDate": "2020-06-11T14:00:54Z", "type": "forcePushed"}]}