{"pr_number": 10344, "pr_title": "[#10295] Allow using the informer interface, and trace down all types", "pr_createdAt": "2020-06-29T14:43:21Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10344", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ2MDU2OA==", "url": "https://github.com/quarkusio/quarkus/pull/10344#discussion_r447460568", "bodyText": "I think that we'll need a better name for this, it's a little too generic IMHO", "author": "geoand", "createdAt": "2020-06-30T07:13:49Z", "path": "extensions/kubernetes-client/deployment/src/main/java/io/quarkus/kubernetes/client/deployment/KubernetesClientProcessor.java", "diffHunk": "@@ -23,12 +30,25 @@\n import io.quarkus.jackson.deployment.IgnoreJsonDeserializeClassBuildItem;\n import io.quarkus.kubernetes.client.runtime.KubernetesClientProducer;\n import io.quarkus.kubernetes.spi.KubernetesRoleBuildItem;\n+import io.quarkus.runtime.annotations.RegisterForReflection;\n \n public class KubernetesClientProcessor {\n \n     private static final DotName WATCHER = DotName.createSimple(\"io.fabric8.kubernetes.client.Watcher\");\n+    private static final DotName RESOURCE_EVENT_HANDLER = DotName\n+            .createSimple(\"io.fabric8.kubernetes.client.informers.ResourceEventHandler\");\n     private static final DotName KUBERNETES_RESOURCE = DotName\n             .createSimple(\"io.fabric8.kubernetes.api.model.KubernetesResource\");\n+    private static final DotName KUBERNETES_RESOURCE_LIST = DotName\n+            .createSimple(\"io.fabric8.kubernetes.api.model.KubernetesResourceList\");\n+    private static final Set<String> EXCLUDED_CLASSES;", "originalCommit": "16ef3cac0b687b55aa1f8c72d8272e224914f244", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYwMjY0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10344#discussion_r447602642", "bodyText": "Sure, do you have suggestions?", "author": "ctron", "createdAt": "2020-06-30T11:11:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ2MDU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYwNTYzOA==", "url": "https://github.com/quarkusio/quarkus/pull/10344#discussion_r447605638", "bodyText": "Maybe EXCLUDED_WATCH_CLASSES?", "author": "geoand", "createdAt": "2020-06-30T11:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ2MDU2OA=="}], "type": "inlineReview", "revised_code": {"commit": "567d9cfcb550a48aeca274a618e6e94d847c2e09", "chunk": "diff --git a/extensions/kubernetes-client/deployment/src/main/java/io/quarkus/kubernetes/client/deployment/KubernetesClientProcessor.java b/extensions/kubernetes-client/deployment/src/main/java/io/quarkus/kubernetes/client/deployment/KubernetesClientProcessor.java\nindex 061c28908c..b004defffb 100644\n--- a/extensions/kubernetes-client/deployment/src/main/java/io/quarkus/kubernetes/client/deployment/KubernetesClientProcessor.java\n+++ b/extensions/kubernetes-client/deployment/src/main/java/io/quarkus/kubernetes/client/deployment/KubernetesClientProcessor.java\n\n@@ -26,11 +22,11 @@ import io.quarkus.deployment.builditem.CombinedIndexBuildItem;\n import io.quarkus.deployment.builditem.ExtensionSslNativeSupportBuildItem;\n import io.quarkus.deployment.builditem.FeatureBuildItem;\n import io.quarkus.deployment.builditem.nativeimage.ReflectiveClassBuildItem;\n+import io.quarkus.deployment.builditem.nativeimage.ReflectiveHierarchyBuildItem;\n import io.quarkus.deployment.util.JandexUtil;\n import io.quarkus.jackson.deployment.IgnoreJsonDeserializeClassBuildItem;\n import io.quarkus.kubernetes.client.runtime.KubernetesClientProducer;\n import io.quarkus.kubernetes.spi.KubernetesRoleBuildItem;\n-import io.quarkus.runtime.annotations.RegisterForReflection;\n \n public class KubernetesClientProcessor {\n \n"}}, {"oid": "567d9cfcb550a48aeca274a618e6e94d847c2e09", "url": "https://github.com/quarkusio/quarkus/commit/567d9cfcb550a48aeca274a618e6e94d847c2e09", "message": "[#10295] Allow using the informer interface, and track down all types\n\nThis change also evaluates implementations of `ResourceEventHandler`,\nwhich is the corresponding interface for the informer. This allows to\nuse watchers or informers the same way.\n\nAlso it traverses through the type information, adding all required\ntypes to the list of types enabling reflection. If only the direct class\nis added, deserialization will fail, unless all the references classes\nare manually annotated with @RegisterForReflection.\n\nSigned-off-by: Jens Reimann <jreimann@redhat.com>", "committedDate": "2020-07-01T07:47:41Z", "type": "commit"}, {"oid": "567d9cfcb550a48aeca274a618e6e94d847c2e09", "url": "https://github.com/quarkusio/quarkus/commit/567d9cfcb550a48aeca274a618e6e94d847c2e09", "message": "[#10295] Allow using the informer interface, and track down all types\n\nThis change also evaluates implementations of `ResourceEventHandler`,\nwhich is the corresponding interface for the informer. This allows to\nuse watchers or informers the same way.\n\nAlso it traverses through the type information, adding all required\ntypes to the list of types enabling reflection. If only the direct class\nis added, deserialization will fail, unless all the references classes\nare manually annotated with @RegisterForReflection.\n\nSigned-off-by: Jens Reimann <jreimann@redhat.com>", "committedDate": "2020-07-01T07:47:41Z", "type": "forcePushed"}]}