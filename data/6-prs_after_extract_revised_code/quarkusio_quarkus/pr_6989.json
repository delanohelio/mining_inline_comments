{"pr_number": 6989, "pr_title": "ArC - improve automatic registration for reflection", "pr_createdAt": "2020-02-04T11:58:52Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/6989", "timeline": [{"oid": "90fde871ec719ad62f88fa34d09863d79c624197", "url": "https://github.com/quarkusio/quarkus/commit/90fde871ec719ad62f88fa34d09863d79c624197", "message": "ArC - improve automatic registration for reflection\n\n- previously we did not register constructor for reflection when an @AroundConstruct interceptor was used\n- resolves #6898", "committedDate": "2020-02-04T15:06:31Z", "type": "commit"}, {"oid": "90fde871ec719ad62f88fa34d09863d79c624197", "url": "https://github.com/quarkusio/quarkus/commit/90fde871ec719ad62f88fa34d09863d79c624197", "message": "ArC - improve automatic registration for reflection\n\n- previously we did not register constructor for reflection when an @AroundConstruct interceptor was used\n- resolves #6898", "committedDate": "2020-02-04T15:06:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375063461", "bodyText": "Shouldn't we add an assertion in io.quarkus.it.main.MetricsTestCase or somewhere to make sure the gauge really gets registered?", "author": "jmartisk", "createdAt": "2020-02-05T05:18:39Z", "path": "integration-tests/main/src/main/java/io/quarkus/it/metrics/DummyGauge.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package io.quarkus.it.metrics;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Observes;\n+import javax.interceptor.AroundConstruct;\n+\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.annotation.Gauge;\n+\n+import io.quarkus.runtime.StartupEvent;\n+\n+/**\n+ * The purpose of this bean is to test that ArC automatically registers the constructor for reflection if an\n+ * {@link AroundConstruct} interceptors is used. We use a dedicated bean to make sure the class is not registered by another\n+ * extension, ie. by resteasy in case of JAX-RS resource.\n+ * \n+ * See https://github.com/quarkusio/quarkus/issues/6898\n+ */\n+@ApplicationScoped\n+public class DummyGauge {", "originalCommit": "90fde871ec719ad62f88fa34d09863d79c624197", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA5NDA1OA==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375094058", "bodyText": "Hm, we should. But we will have to add @RegisterForReflection too, due to #6993. @jmartisk would you care to add this assertion to my PR? ;-)", "author": "mkouba", "createdAt": "2020-02-05T07:27:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwMzg2NA==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375103864", "bodyText": "Oh, I thought the changes in this PR mean we don't need that annotation anymore. Ok.\nHow do I add something to your PR? I don't think I have permissions for that.", "author": "jmartisk", "createdAt": "2020-02-05T07:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNjYzNg==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375106636", "bodyText": "Nope, this PR merely fixes the problem in ArC where we did not register the constructor for reflection if @AroundConstruct was used...", "author": "mkouba", "createdAt": "2020-02-05T08:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNzAyMA==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375107020", "bodyText": "@jmartisk as a member of the project you can push changes to any PR.", "author": "geoand", "createdAt": "2020-02-05T08:06:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyMTE2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375121167", "bodyText": "But how? Which remote repo and branch should I push to? It won't allow me to push into Martin's fork.\nPer https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/committing-changes-to-a-pull-request-branch-created-from-a-fork it seems it could work if I had push access to Quarkus repo, which I don't", "author": "jmartisk", "createdAt": "2020-02-05T08:42:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyNTkzNg==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375125936", "bodyText": "I am pretty sure you and I have the same push access and pushing to a PR works for me.\nThis is what I do:\n\nAdd a git remote for the user's fork (using ssh, not https as the protocol) - for example foo\nCheck out the PR in a branch, say pull/1234\nMake changes and commit\nPush like so: git push foo pull/1234:name-of-branch-in-users-fork", "author": "geoand", "createdAt": "2020-02-05T08:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyOTU5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375129595", "bodyText": "Well, that's what I did and receive this on push\nERROR: Permission to mkouba/quarkus.git denied to jmartisk.\n\nThe document explicitly says that I can do this if the PR is opened against a repository where I have push access to - that's probably the issue. I have triage permission, but not push.\nAnyway I pushed it to my own branch jmartisk@7025a98 so I guess you guys can cherry-pick it", "author": "jmartisk", "createdAt": "2020-02-05T09:00:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzMDY0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/6989#discussion_r375130642", "bodyText": "Ok, will do. Apparently you don't have the permissions. Thanks!", "author": "mkouba", "createdAt": "2020-02-05T09:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "226f6dbd3592c1962110d94f3786166985a7e36c", "chunk": "diff --git a/integration-tests/main/src/main/java/io/quarkus/it/metrics/DummyGauge.java b/integration-tests/main/src/main/java/io/quarkus/it/metrics/DummyGauge.java\nindex 76d2f90cba..523e646346 100644\n--- a/integration-tests/main/src/main/java/io/quarkus/it/metrics/DummyGauge.java\n+++ b/integration-tests/main/src/main/java/io/quarkus/it/metrics/DummyGauge.java\n\n@@ -8,6 +8,7 @@ import org.eclipse.microprofile.metrics.MetricUnits;\n import org.eclipse.microprofile.metrics.annotation.Gauge;\n \n import io.quarkus.runtime.StartupEvent;\n+import io.quarkus.runtime.annotations.RegisterForReflection;\n \n /**\n  * The purpose of this bean is to test that ArC automatically registers the constructor for reflection if an\n"}}, {"oid": "226f6dbd3592c1962110d94f3786166985a7e36c", "url": "https://github.com/quarkusio/quarkus/commit/226f6dbd3592c1962110d94f3786166985a7e36c", "message": "Finish test for DummyGauge", "committedDate": "2020-02-05T09:06:19Z", "type": "commit"}]}