{"pr_number": 6611, "pr_title": "QuarkusUnitTest - detect usage of non-static fields and fail correctly", "pr_createdAt": "2020-01-17T13:26:03Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/6611", "timeline": [{"oid": "ecb4620fff6f807a525d3f68c7b15bd71d5e98c5", "url": "https://github.com/quarkusio/quarkus/commit/ecb4620fff6f807a525d3f68c7b15bd71d5e98c5", "message": "QuarkusUnitTest - detect usage of non-static fields and fail correctly\n\n- if a non-static field is used the test app is not started\n- also update docs", "committedDate": "2020-01-17T13:25:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367937523", "bodyText": "Does this need to be done for each test method? Wouldn't it make sense to do it in beforeAll?", "author": "geoand", "createdAt": "2020-01-17T13:36:11Z", "path": "test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java", "diffHunk": "@@ -381,6 +386,20 @@ public void afterEach(ExtensionContext context) throws Exception {\n \n     @Override\n     public void beforeEach(ExtensionContext context) throws Exception {", "originalCommit": "ecb4620fff6f807a525d3f68c7b15bd71d5e98c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzODIyMw==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367938223", "bodyText": "beforeAll is not executed at all when a non-static field is used... that's the whole point of the issue ;-)", "author": "mkouba", "createdAt": "2020-01-17T13:37:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk0MjUzMA==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367942530", "bodyText": "OK, thanks", "author": "geoand", "createdAt": "2020-01-17T13:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk0Mjg2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367942866", "bodyText": "Although I would have hoped there would be a more useful lifecycle method. Perhaps where the test class is constructed?", "author": "geoand", "createdAt": "2020-01-17T13:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk0MzI4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367943286", "bodyText": "TestInstanceFactory.createTestInstance() is not executed either.", "author": "mkouba", "createdAt": "2020-01-17T13:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk0MzgwNA==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367943804", "bodyText": "I rest my case then :)", "author": "geoand", "createdAt": "2020-01-17T13:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk0NDMyNw==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367944327", "bodyText": "I like how @geoand asks the exact same questions I did xD\nBTW this bit documents what is/isn't invoked if the registration is non-static https://junit.org/junit5/docs/current/user-guide/#extensions-registration-programmatic-instance-fields", "author": "manovotn", "createdAt": "2020-01-17T13:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk0NzYyMA==", "url": "https://github.com/quarkusio/quarkus/pull/6611#discussion_r367947620", "bodyText": "Great reference, thanks @manovotn !", "author": "geoand", "createdAt": "2020-01-17T13:58:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNzUyMw=="}], "type": "inlineReview", "revised_code": {"commit": "dead62b6c12f479528e925d7252e2171389b6643", "chunk": "diff --git a/test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java b/test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java\nindex e3a0019524..a2f8981776 100644\n--- a/test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java\n+++ b/test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java\n\n@@ -381,11 +381,19 @@ public class QuarkusUnitTest\n \n     @Override\n     public void afterEach(ExtensionContext context) throws Exception {\n+        if (assertException != null) {\n+            // Build failed as expected - test methods are not invoked\n+            return;\n+        }\n         restAssuredURLManager.clearURL();\n     }\n \n     @Override\n     public void beforeEach(ExtensionContext context) throws Exception {\n+        if (assertException != null) {\n+            // Build failed as expected - test methods are not invoked\n+            return;\n+        }\n         if (!started) {\n             Optional<Class<?>> testClass = context.getTestClass();\n             if (testClass.isPresent()) {\n"}}, {"oid": "dead62b6c12f479528e925d7252e2171389b6643", "url": "https://github.com/quarkusio/quarkus/commit/dead62b6c12f479528e925d7252e2171389b6643", "message": "QuarkusUnitTest - don't call before/afterEach if build fails as expected", "committedDate": "2020-01-20T08:46:30Z", "type": "commit"}]}