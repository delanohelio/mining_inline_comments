{"pr_number": 11568, "pr_title": "Don't create default mongo clients when not needed and fix @MongoClientName qualifier", "pr_createdAt": "2020-08-24T13:41:36Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11568", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3MzkwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11568#discussion_r476273909", "bodyText": "A wise man said to me, don't use dots in config item names.\nAlso I don't see why force-default-clients would be a bad name.", "author": "gsmet", "createdAt": "2020-08-25T08:32:35Z", "path": "extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientBuildTimeConfig.java", "diffHunk": "@@ -17,4 +17,10 @@\n      */\n     @ConfigItem(name = \"metrics.enabled\")\n     public boolean metricsEnabled;\n+\n+    /**\n+     * If set to true, the default clients will always be created even if there are no injection points that use them\n+     */\n+    @ConfigItem(name = \"default-clients.force\")", "originalCommit": "e96c4d52845a1aa0d0c3ec4a960f9ea13f09ca13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NTczOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11568#discussion_r476275739", "bodyText": "Basically, the reason for no dots is that it doesn't work. I got hit by this in the Hibernate ORM config. No errors but it fails if you try to define the value in the application.properties.\nIf you really want a dot, use a group.", "author": "gsmet", "createdAt": "2020-08-25T08:35:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3MzkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3OTAzMQ==", "url": "https://github.com/quarkusio/quarkus/pull/11568#discussion_r476279031", "bodyText": "Understood, I'll change it", "author": "geoand", "createdAt": "2020-08-25T08:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3MzkwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "96a019d8cbc9ffb6d60c8ca0119e4e1d93321e62", "chunk": "diff --git a/extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientBuildTimeConfig.java b/extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientBuildTimeConfig.java\nindex 8bba45d8ef..31844f5367 100644\n--- a/extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientBuildTimeConfig.java\n+++ b/extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientBuildTimeConfig.java\n\n@@ -21,6 +21,6 @@ public class MongoClientBuildTimeConfig {\n     /**\n      * If set to true, the default clients will always be created even if there are no injection points that use them\n      */\n-    @ConfigItem(name = \"default-clients.force\")\n+    @ConfigItem(name = \"default-clients-force\")\n     public boolean forceDefaultClients;\n }\n"}}, {"oid": "96a019d8cbc9ffb6d60c8ca0119e4e1d93321e62", "url": "https://github.com/quarkusio/quarkus/commit/96a019d8cbc9ffb6d60c8ca0119e4e1d93321e62", "message": "Properly handle @MongoClientName qualifier\n\nFixes: #11491", "committedDate": "2020-08-25T08:42:40Z", "type": "forcePushed"}, {"oid": "036d27fe9037f30f4d4ad004d770b6cafdd18a2c", "url": "https://github.com/quarkusio/quarkus/commit/036d27fe9037f30f4d4ad004d770b6cafdd18a2c", "message": "Don't create default mongo clients when not needed\n\nRelates to: #11491", "committedDate": "2020-08-25T08:46:48Z", "type": "commit"}, {"oid": "17d4840735915e772b94e607755e2acdfe99eea4", "url": "https://github.com/quarkusio/quarkus/commit/17d4840735915e772b94e607755e2acdfe99eea4", "message": "Properly handle @MongoClientName qualifier\n\nFixes: #11491", "committedDate": "2020-08-25T08:46:48Z", "type": "commit"}, {"oid": "17d4840735915e772b94e607755e2acdfe99eea4", "url": "https://github.com/quarkusio/quarkus/commit/17d4840735915e772b94e607755e2acdfe99eea4", "message": "Properly handle @MongoClientName qualifier\n\nFixes: #11491", "committedDate": "2020-08-25T08:46:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMyNzIxOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11568#discussion_r478327219", "bodyText": "If it didn't work before, please let's move this annotation to the API package i.e. no runtime.. It's user API.\nAlso we will probably need to update the doc and quickstart if it's mentioned.", "author": "gsmet", "createdAt": "2020-08-27T10:49:00Z", "path": "extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientProcessor.java", "diffHunk": "@@ -52,12 +54,9 @@\n import io.quarkus.smallrye.health.deployment.spi.HealthBuildItem;\n \n public class MongoClientProcessor {\n-    private static final DotName MONGOCLIENT_ANNOTATION = DotName.createSimple(MongoClientName.class.getName());\n-\n-    @BuildStep\n-    BeanDefiningAnnotationBuildItem registerConnectionBean() {\n-        return new BeanDefiningAnnotationBuildItem(MONGOCLIENT_ANNOTATION);\n-    }\n+    private static final DotName MONGO_CLIENT_ANNOTATION = DotName.createSimple(MongoClientName.class.getName());", "originalCommit": "17d4840735915e772b94e607755e2acdfe99eea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM0NjQwNg==", "url": "https://github.com/quarkusio/quarkus/pull/11568#discussion_r478346406", "bodyText": "Agreed to do this in a follow up", "author": "geoand", "createdAt": "2020-08-27T11:29:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMyNzIxOQ=="}], "type": "inlineReview", "revised_code": null}]}