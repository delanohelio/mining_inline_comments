{"pr_number": 7714, "pr_title": "Allow @QuarkusTest to use constructor injection", "pr_createdAt": "2020-03-09T20:50:58Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7714", "timeline": [{"oid": "6d8df7bd2283b256166638fea183aa78463fa0f4", "url": "https://github.com/quarkusio/quarkus/commit/6d8df7bd2283b256166638fea183aa78463fa0f4", "message": "Allow @QuarkusTest to use constructor injection", "committedDate": "2020-03-09T20:53:58Z", "type": "forcePushed"}, {"oid": "5db16806919cab29a6eccde636faf063bfcfa4e4", "url": "https://github.com/quarkusio/quarkus/commit/5db16806919cab29a6eccde636faf063bfcfa4e4", "message": "Allow @QuarkusTest to use constructor injection", "committedDate": "2020-03-09T21:05:26Z", "type": "forcePushed"}, {"oid": "e6d66f773aeb5a010048216068ca1afea79620bc", "url": "https://github.com/quarkusio/quarkus/commit/e6d66f773aeb5a010048216068ca1afea79620bc", "message": "Allow @QuarkusTest to use constructor injection", "committedDate": "2020-03-09T21:07:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk3NTIyMA==", "url": "https://github.com/quarkusio/quarkus/pull/7714#discussion_r389975220", "bodyText": "I would wrap the exception with this, not log it, so it shows up in the test failures.", "author": "stuartwdouglas", "createdAt": "2020-03-09T21:35:42Z", "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -231,9 +235,15 @@ public void interceptBeforeAllMethod(Invocation<Void> invocation, ReflectiveInvo\n         }\n         T result;\n         ClassLoader old = Thread.currentThread().getContextClassLoader();\n+        Class<?> requiredTestClass = extensionContext.getRequiredTestClass();\n         try {\n-            Thread.currentThread().setContextClassLoader(extensionContext.getRequiredTestClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(requiredTestClass.getClassLoader());\n             result = invocation.proceed();\n+        } catch (NullPointerException e) {\n+            System.err.println(\n+                    \"When using constructor injection in a test, the only legal operation is to assign the constructor values to fields. Offending class is \"", "originalCommit": "e6d66f773aeb5a010048216068ca1afea79620bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk3NjM5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7714#discussion_r389976397", "bodyText": "Fixed. Thanks for the suggestion, it looks much much better in the logs!", "author": "geoand", "createdAt": "2020-03-09T21:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk3NTIyMA=="}], "type": "inlineReview", "revised_code": {"commit": "e9ea42385e538befbffd988c13960b0507097459", "chunk": "diff --git a/test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java b/test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java\nindex 0a64c8e246..bb07a4c9e4 100644\n--- a/test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java\n+++ b/test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java\n\n@@ -240,10 +240,10 @@ public class QuarkusTestExtension\n             Thread.currentThread().setContextClassLoader(requiredTestClass.getClassLoader());\n             result = invocation.proceed();\n         } catch (NullPointerException e) {\n-            System.err.println(\n+            throw new RuntimeException(\n                     \"When using constructor injection in a test, the only legal operation is to assign the constructor values to fields. Offending class is \"\n-                            + requiredTestClass);\n-            throw e;\n+                            + requiredTestClass,\n+                    e);\n         } finally {\n             Thread.currentThread().setContextClassLoader(old);\n         }\n"}}, {"oid": "e9ea42385e538befbffd988c13960b0507097459", "url": "https://github.com/quarkusio/quarkus/commit/e9ea42385e538befbffd988c13960b0507097459", "message": "Allow @QuarkusTest to use constructor injection", "committedDate": "2020-03-09T21:37:52Z", "type": "forcePushed"}, {"oid": "86263634fa7917a6ab0e1f86b5b91d1485710d22", "url": "https://github.com/quarkusio/quarkus/commit/86263634fa7917a6ab0e1f86b5b91d1485710d22", "message": "Allow @QuarkusTest to use constructor injection", "committedDate": "2020-03-10T07:29:40Z", "type": "commit"}, {"oid": "86263634fa7917a6ab0e1f86b5b91d1485710d22", "url": "https://github.com/quarkusio/quarkus/commit/86263634fa7917a6ab0e1f86b5b91d1485710d22", "message": "Allow @QuarkusTest to use constructor injection", "committedDate": "2020-03-10T07:29:40Z", "type": "forcePushed"}]}