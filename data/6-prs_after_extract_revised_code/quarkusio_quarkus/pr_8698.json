{"pr_number": 8698, "pr_title": "Introduce configuration for the Hibernate Validator extension", "pr_createdAt": "2020-04-20T13:08:19Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8698", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM2OTA3NA==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r411369074", "bodyText": "nitpick: Maybe we could use new StringAsset(...) since application-fail-fast.properties contain only one configuration property?  Same for the other added props files.", "author": "machi1990", "createdAt": "2020-04-20T13:17:56Z", "path": "extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/FailFastTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package io.quarkus.hibernate.validator.test;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import javax.inject.Inject;\n+import javax.validation.ConstraintViolation;\n+import javax.validation.Valid;\n+import javax.validation.Validator;\n+import javax.validation.constraints.Email;\n+import javax.validation.constraints.Max;\n+import javax.validation.constraints.Min;\n+import javax.validation.constraints.NotNull;\n+import javax.validation.constraints.Pattern;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class FailFastTest {\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest test = new QuarkusUnitTest().setArchiveProducer(() -> ShrinkWrap\n+            .create(JavaArchive.class)\n+            .addClasses(A.class, B.class)\n+            .addAsResource(\"application-fail-fast.properties\", \"application.properties\"));", "originalCommit": "a76bd875c715282cb4728d28b262dd9c09cf10f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEwNjg4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412106882", "bodyText": "Right. I force-pushed an update.", "author": "gsmet", "createdAt": "2020-04-21T11:36:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM2OTA3NA=="}], "type": "inlineReview", "revised_code": {"commit": "53558ab004edf6a7958ddde20ec1ec95e9120981", "chunk": "diff --git a/extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/FailFastTest.java b/extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/FailFastTest.java\nindex 609cd9d51b..b9ee9e1161 100644\n--- a/extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/FailFastTest.java\n+++ b/extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/FailFastTest.java\n\n@@ -16,6 +16,7 @@ import javax.validation.constraints.NotNull;\n import javax.validation.constraints.Pattern;\n \n import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n import org.jboss.shrinkwrap.api.spec.JavaArchive;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.RegisterExtension;\n"}}, {"oid": "53558ab004edf6a7958ddde20ec1ec95e9120981", "url": "https://github.com/quarkusio/quarkus/commit/53558ab004edf6a7958ddde20ec1ec95e9120981", "message": "Introduce configuration for the Hibernate Validator extension", "committedDate": "2020-04-21T11:35:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412397346", "bodyText": "Oh man... I don't like this pattern at all, it should be disallowed really :). But there is no way I'm going to hold up the PR on a personal opinion :)", "author": "geoand", "createdAt": "2020-04-21T18:35:22Z", "path": "extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/HibernateValidatorProcessor.java", "diffHunk": "@@ -90,6 +91,8 @@\n \n     private LocalesBuildTimeConfig localesBuildTimeConfig;\n \n+    private HibernateValidatorBuildTimeConfig hibernateValidatorBuildTimeConfig;", "originalCommit": "53558ab004edf6a7958ddde20ec1ec95e9120981", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMjcyMw==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412402723", "bodyText": "Well, what do you suggest? Because it's how we always did things.\nNote that I cannot use a producer because I want the ValidatorFactory to be produced at static init and there's no way to force that right now.", "author": "gsmet", "createdAt": "2020-04-21T18:43:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwNTAyMg==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412405022", "bodyText": "I meant that ideally these arguments should be method arguments of the build step, not fields, which is just weird.\nBut it's not a problem obviously \ud83d\ude09", "author": "geoand", "createdAt": "2020-04-21T18:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwNTgwNw==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412405807", "bodyText": "An alternative could be to make hibernateValidatorBuildTimeConfig  as method parameter. Where it is used only.", "author": "machi1990", "createdAt": "2020-04-21T18:48:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwNjk0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412406947", "bodyText": "Ah yes, well, I chose consistency but sure I can change it.", "author": "gsmet", "createdAt": "2020-04-21T18:49:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwODU3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412408575", "bodyText": "No need to change it now. Some other time, but it on a Christmas list \ud83d\ude09", "author": "geoand", "createdAt": "2020-04-21T18:52:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ5NDMwMw==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412494303", "bodyText": "Done.", "author": "gsmet", "createdAt": "2020-04-21T21:11:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NzM0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "f0cab2ad6b2b2a6af1988f6b4c11994aa559d89e", "chunk": "diff --git a/extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/HibernateValidatorProcessor.java b/extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/HibernateValidatorProcessor.java\nindex 5174ccc162..5e1014339a 100644\n--- a/extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/HibernateValidatorProcessor.java\n+++ b/extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/HibernateValidatorProcessor.java\n\n@@ -89,10 +89,6 @@ class HibernateValidatorProcessor {\n \n     private static final Pattern BUILT_IN_CONSTRAINT_REPEATABLE_CONTAINER_PATTERN = Pattern.compile(\"\\\\$List$\");\n \n-    private LocalesBuildTimeConfig localesBuildTimeConfig;\n-\n-    private HibernateValidatorBuildTimeConfig hibernateValidatorBuildTimeConfig;\n-\n     @BuildStep\n     HotDeploymentWatchedFileBuildItem configFile() {\n         return new HotDeploymentWatchedFileBuildItem(META_INF_VALIDATION_XML);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5OTk4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412399981", "bodyText": "I don't know what this does, but I absolutely trust that you do", "author": "geoand", "createdAt": "2020-04-21T18:39:24Z", "path": "extensions/hibernate-validator/runtime/src/main/java/io/quarkus/hibernate/validator/runtime/HibernateValidatorBuildTimeConfig.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package io.quarkus.hibernate.validator.runtime;\n+\n+import io.quarkus.runtime.annotations.ConfigDocSection;\n+import io.quarkus.runtime.annotations.ConfigGroup;\n+import io.quarkus.runtime.annotations.ConfigItem;\n+import io.quarkus.runtime.annotations.ConfigPhase;\n+import io.quarkus.runtime.annotations.ConfigRoot;\n+\n+@ConfigRoot(phase = ConfigPhase.BUILD_AND_RUN_TIME_FIXED)\n+public class HibernateValidatorBuildTimeConfig {\n+\n+    /**\n+     * Enable the fail fast mode. When fail fast is enabled the validation\n+     * will stop on the first constraint violation detected.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean failFast;\n+\n+    /**\n+     * Method validation.\n+     */\n+    @ConfigDocSection", "originalCommit": "53558ab004edf6a7958ddde20ec1ec95e9120981", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMjk3NA==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412402974", "bodyText": "It adds a nice section in the doc table :).", "author": "gsmet", "createdAt": "2020-04-21T18:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5OTk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMzk2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412403967", "bodyText": "It creates an asciidoc section like this one https://quarkus.io/guides/datasource#quarkus-datasource_quarkus.datasource.named-data-sources whose code is https://github.com/quarkusio/quarkus/blob/master/extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSourcesJdbcRuntimeConfig.java#L22", "author": "machi1990", "createdAt": "2020-04-21T18:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5OTk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwNDk5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412404992", "bodyText": "Of course @gsmet beats me to it ;-)", "author": "machi1990", "createdAt": "2020-04-21T18:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5OTk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwNTMzMg==", "url": "https://github.com/quarkusio/quarkus/pull/8698#discussion_r412405332", "bodyText": "More than I wanted to know \ud83d\ude43", "author": "geoand", "createdAt": "2020-04-21T18:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5OTk4MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f7565c0cd50bb91028410c6037f85784d54b731b", "url": "https://github.com/quarkusio/quarkus/commit/f7565c0cd50bb91028410c6037f85784d54b731b", "message": "Introduce configuration for the Hibernate Validator extension", "committedDate": "2020-04-21T19:06:36Z", "type": "commit"}, {"oid": "f0cab2ad6b2b2a6af1988f6b4c11994aa559d89e", "url": "https://github.com/quarkusio/quarkus/commit/f0cab2ad6b2b2a6af1988f6b4c11994aa559d89e", "message": "Make config method parameters instead of fields", "committedDate": "2020-04-21T19:06:36Z", "type": "commit"}, {"oid": "f0cab2ad6b2b2a6af1988f6b4c11994aa559d89e", "url": "https://github.com/quarkusio/quarkus/commit/f0cab2ad6b2b2a6af1988f6b4c11994aa559d89e", "message": "Make config method parameters instead of fields", "committedDate": "2020-04-21T19:06:36Z", "type": "forcePushed"}]}