{"pr_number": 9472, "pr_title": "Make ArC intercept default methods", "pr_createdAt": "2020-05-20T01:34:38Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9472", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxNjg1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9472#discussion_r427816857", "bodyText": "OK, my bad, I didn't know interceptors also applied to superclass methods, otherwise I'd have suggested to handle interface default methods too. Great move.", "author": "FroMage", "createdAt": "2020-05-20T08:04:43Z", "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java", "diffHunk": "@@ -186,6 +186,13 @@ public MethodVisitor visitMethod(int access, String name, String descriptor, Str\n                         classLevelBindings, bytecodeTransformerConsumer, transformUnproxyableClasses));", "originalCommit": "8045b4a75d783fad86df8f269dcdf9f398d89d4b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "46554a03f243048e0bbbe4c091b284ea0609fe9c", "chunk": "diff --git a/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java b/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java\nindex 44eeaa8cae..dc64a319e5 100644\n--- a/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java\n+++ b/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java\n\n@@ -189,8 +191,9 @@ final class Methods {\n         for (DotName i : classInfo.interfaceNames()) {\n             ClassInfo interfaceInfo = getClassByName(beanDeployment.getIndex(), i);\n             if (interfaceInfo != null) {\n-                finalMethodsFoundAndNotChanged.addAll(addInterceptedMethodCandidates(beanDeployment, interfaceInfo, candidates,\n-                        classLevelBindings, bytecodeTransformerConsumer, transformUnproxyableClasses));\n+                //interfaces can't have final methods\n+                addInterceptedMethodCandidates(beanDeployment, interfaceInfo, candidates,\n+                        classLevelBindings, bytecodeTransformerConsumer, transformUnproxyableClasses);\n             }\n         }\n         return finalMethodsFoundAndNotChanged;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkwMTE5OQ==", "url": "https://github.com/quarkusio/quarkus/pull/9472#discussion_r427901199", "bodyText": "Interface methods cannot be final.\nIt should be enough to call addInterceptedMethodCandidates() here.", "author": "manovotn", "createdAt": "2020-05-20T10:21:31Z", "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java", "diffHunk": "@@ -186,6 +186,13 @@ public MethodVisitor visitMethod(int access, String name, String descriptor, Str\n                         classLevelBindings, bytecodeTransformerConsumer, transformUnproxyableClasses));\n             }\n         }\n+        for (DotName i : classInfo.interfaceNames()) {\n+            ClassInfo interfaceInfo = getClassByName(beanDeployment.getIndex(), i);\n+            if (interfaceInfo != null) {\n+                finalMethodsFoundAndNotChanged.addAll(addInterceptedMethodCandidates(beanDeployment, interfaceInfo, candidates,", "originalCommit": "8045b4a75d783fad86df8f269dcdf9f398d89d4b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "46554a03f243048e0bbbe4c091b284ea0609fe9c", "chunk": "diff --git a/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java b/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java\nindex 44eeaa8cae..dc64a319e5 100644\n--- a/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java\n+++ b/independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/Methods.java\n\n@@ -189,8 +191,9 @@ final class Methods {\n         for (DotName i : classInfo.interfaceNames()) {\n             ClassInfo interfaceInfo = getClassByName(beanDeployment.getIndex(), i);\n             if (interfaceInfo != null) {\n-                finalMethodsFoundAndNotChanged.addAll(addInterceptedMethodCandidates(beanDeployment, interfaceInfo, candidates,\n-                        classLevelBindings, bytecodeTransformerConsumer, transformUnproxyableClasses));\n+                //interfaces can't have final methods\n+                addInterceptedMethodCandidates(beanDeployment, interfaceInfo, candidates,\n+                        classLevelBindings, bytecodeTransformerConsumer, transformUnproxyableClasses);\n             }\n         }\n         return finalMethodsFoundAndNotChanged;\n"}}, {"oid": "46554a03f243048e0bbbe4c091b284ea0609fe9c", "url": "https://github.com/quarkusio/quarkus/commit/46554a03f243048e0bbbe4c091b284ea0609fe9c", "message": "Make ArC intercept default methods\n\nFixes #7188", "committedDate": "2020-05-21T01:11:45Z", "type": "forcePushed"}, {"oid": "d2321964a08e3cfd8583767d590be842e4679b61", "url": "https://github.com/quarkusio/quarkus/commit/d2321964a08e3cfd8583767d590be842e4679b61", "message": "Make ArC intercept default methods\n\nFixes #7188", "committedDate": "2020-05-21T01:21:29Z", "type": "commit"}, {"oid": "d2321964a08e3cfd8583767d590be842e4679b61", "url": "https://github.com/quarkusio/quarkus/commit/d2321964a08e3cfd8583767d590be842e4679b61", "message": "Make ArC intercept default methods\n\nFixes #7188", "committedDate": "2020-05-21T01:21:29Z", "type": "forcePushed"}]}