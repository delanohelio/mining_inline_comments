{"pr_number": 8690, "pr_title": "Security: avoid ClassInfo in Sets", "pr_createdAt": "2020-04-20T09:45:26Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8690", "timeline": [{"oid": "c244f307209c614331edde37d3bf0b24b5e00fb3", "url": "https://github.com/quarkusio/quarkus/commit/c244f307209c614331edde37d3bf0b24b5e00fb3", "message": "Security: avoid ClassInfo in Sets", "committedDate": "2020-04-20T09:44:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI5NTI4Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8690#discussion_r411295287", "bodyText": "I don't think it's worth changing it for this PR but please, in the future, when using a for loop is simpler than using a lambda, let's do the former.\nUsing lambdas in build time code is allowed but maybe let's only use them when they bring something to the plate?", "author": "gsmet", "createdAt": "2020-04-20T11:16:16Z", "path": "extensions/security/deployment/src/main/java/io/quarkus/security/deployment/SecurityProcessor.java", "diffHunk": "@@ -140,9 +140,13 @@ void gatherSecurityChecks(BuildProducer<BeanRegistrarBuildItem> beanRegistrars,\n             List<AdditionalSecurityCheckBuildItem> additionalSecurityChecks, SecurityBuildTimeConfig config) {\n         classPredicate.produce(new ApplicationClassPredicateBuildItem(new SecurityCheckStorage.AppPredicate()));\n \n-        Set<ClassInfo> additionalSecured = new HashSet<>();\n+        final Map<DotName, ClassInfo> additionalSecured = new HashMap<>();\n         for (AdditionalSecuredClassesBuildIem securedClasses : additionalSecuredClasses) {\n-            additionalSecured.addAll(securedClasses.additionalSecuredClasses);\n+            securedClasses.additionalSecuredClasses.forEach(c -> {\n+                if (!additionalSecured.containsKey(c.name())) {\n+                    additionalSecured.put(c.name(), c);\n+                }\n+            });", "originalCommit": "c244f307209c614331edde37d3bf0b24b5e00fb3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI5NjI3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/8690#discussion_r411296276", "bodyText": "You could have used values() here.", "author": "gsmet", "createdAt": "2020-04-20T11:18:03Z", "path": "extensions/security/deployment/src/main/java/io/quarkus/security/deployment/SecurityProcessor.java", "diffHunk": "@@ -225,8 +229,8 @@ private ResultHandle paramTypes(MethodCreator ctor, List<Type> parameters) {\n          * Handle additional secured classes by adding the denyAll check to all public non-static methods\n          * that don't have security annotations\n          */\n-        for (ClassInfo additionalSecureClassInfo : additionalSecuredClasses) {\n-            for (MethodInfo methodInfo : additionalSecureClassInfo.methods()) {\n+        for (Map.Entry<DotName, ClassInfo> additionalSecureClassInfo : additionalSecuredClasses.entrySet()) {\n+            for (MethodInfo methodInfo : additionalSecureClassInfo.getValue().methods()) {", "originalCommit": "c244f307209c614331edde37d3bf0b24b5e00fb3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}