{"pr_number": 11660, "pr_title": "Fix some ClassLoader leaks from the BuildMojo", "pr_createdAt": "2020-08-27T07:51:30Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11660", "timeline": [{"oid": "94a06497d5ddd2358a65edaad2cc2bcd235214a9", "url": "https://github.com/quarkusio/quarkus/commit/94a06497d5ddd2358a65edaad2cc2bcd235214a9", "message": "Fix some ClassLoader leaks from the BuildMojo\n\nHopefully this will fix some of the CI issues", "committedDate": "2020-08-27T07:56:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MDM4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11660#discussion_r478240385", "bodyText": "This doesn't seem to do be used anywhere", "author": "geoand", "createdAt": "2020-08-27T08:17:43Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java", "diffHunk": "@@ -133,9 +133,10 @@ public BuildMojo() {\n         MojoLogger.logSupplier = this::getLog;\n     }\n \n+    boolean pause = true;", "originalCommit": "94a06497d5ddd2358a65edaad2cc2bcd235214a9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d51302b3ec0d1f279783b551a53bcd2245ae1b73", "chunk": "diff --git a/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java b/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java\nindex dab4bc372a..8379a99f74 100644\n--- a/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java\n+++ b/devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java\n\n@@ -133,8 +133,6 @@ public class BuildMojo extends AbstractMojo {\n         MojoLogger.logSupplier = this::getLog;\n     }\n \n-    boolean pause = true;\n-\n     @Override\n     public void execute() throws MojoExecutionException {\n         if (skip) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MDg5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11660#discussion_r478240897", "bodyText": "Is there any chance of this causing unexpected behavior?", "author": "geoand", "createdAt": "2020-08-27T08:18:34Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java", "diffHunk": "@@ -201,6 +202,7 @@ public void execute() throws MojoExecutionException {\n             QuarkusBootstrap.Builder builder = QuarkusBootstrap.builder()\n                     .setAppArtifact(appArtifact)\n                     .setMavenArtifactResolver(resolver)\n+                    .setIsolateDeployment(true)", "originalCommit": "94a06497d5ddd2358a65edaad2cc2bcd235214a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1NDUxOA==", "url": "https://github.com/quarkusio/quarkus/pull/11660#discussion_r478254518", "bodyText": "I think the current failures are because close is being called twice, which means it attempts to define the driver remover twice", "author": "stuartwdouglas", "createdAt": "2020-08-27T08:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MDg5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1NzAzMg==", "url": "https://github.com/quarkusio/quarkus/pull/11660#discussion_r478257032", "bodyText": "OK, let's see what CI says", "author": "geoand", "createdAt": "2020-08-27T08:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MDg5Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1MDQ5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11660#discussion_r478250497", "bodyText": "There are two of these classes. Is it supposed to be one for the runtime and one for the deployment CL?", "author": "aloubyansky", "createdAt": "2020-08-27T08:34:49Z", "path": "independent-projects/bootstrap/core/src/main/java/io/quarkus/bootstrap/classloading/DriverRemover.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package io.quarkus.bootstrap.classloading;\n+\n+import java.sql.Driver;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.util.Enumeration;\n+import org.jboss.logging.Logger;\n+\n+public class DriverRemover implements Runnable {", "originalCommit": "94a06497d5ddd2358a65edaad2cc2bcd235214a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1NDIxNw==", "url": "https://github.com/quarkusio/quarkus/pull/11660#discussion_r478254217", "bodyText": "oops, must have copied instead of moved", "author": "stuartwdouglas", "createdAt": "2020-08-27T08:40:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1MDQ5Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "d51302b3ec0d1f279783b551a53bcd2245ae1b73", "url": "https://github.com/quarkusio/quarkus/commit/d51302b3ec0d1f279783b551a53bcd2245ae1b73", "message": "Fix some ClassLoader leaks from the BuildMojo\n\nHopefully this will fix some of the CI issues", "committedDate": "2020-08-27T08:41:39Z", "type": "forcePushed"}, {"oid": "f94606e839efb83a2e2de54aa204dda2695c8d46", "url": "https://github.com/quarkusio/quarkus/commit/f94606e839efb83a2e2de54aa204dda2695c8d46", "message": "Fix some ClassLoader leaks from the BuildMojo\n\nHopefully this will fix some of the CI issues", "committedDate": "2020-08-27T23:54:34Z", "type": "forcePushed"}, {"oid": "adb11e118f337c7938ab5207847acc1f5bbf18d3", "url": "https://github.com/quarkusio/quarkus/commit/adb11e118f337c7938ab5207847acc1f5bbf18d3", "message": "Limit the amount of memory surefire can use\n\nBy default surefile will take up to 1/4 of system\nmemory, however in memory constrained environments\nthis can be too much. 1024m should be plenty to run\nthe tests, and prevents surefire from allocating more\nthan it needs.", "committedDate": "2020-08-28T01:56:45Z", "type": "forcePushed"}, {"oid": "39e32b647097841e3d4b83ca570da092736d90a2", "url": "https://github.com/quarkusio/quarkus/commit/39e32b647097841e3d4b83ca570da092736d90a2", "message": "Fix ClassLoader leak in the docs build\n\nAlso raise the metaspace limit, there is a bit of\ntrial and error here to find out what works.", "committedDate": "2020-08-28T03:04:52Z", "type": "forcePushed"}, {"oid": "448cf8cb5ed6332eb9073ff973879b03c94942a3", "url": "https://github.com/quarkusio/quarkus/commit/448cf8cb5ed6332eb9073ff973879b03c94942a3", "message": "Fix some ClassLoader leaks from the BuildMojo\n\nHopefully this will fix some of the CI issues", "committedDate": "2020-08-28T06:08:54Z", "type": "commit"}, {"oid": "b6bbf0c36ec708e3c329cdb64fad937c9dee90ee", "url": "https://github.com/quarkusio/quarkus/commit/b6bbf0c36ec708e3c329cdb64fad937c9dee90ee", "message": "Limit maven metaspace during the build\n\nThis ensures it will clean up old ClassLoaders,\ninstead of just allocating more memory.", "committedDate": "2020-08-28T06:08:54Z", "type": "commit"}, {"oid": "ce60f44af09d0942bb6e1a1d3b9f7ad08b8b253a", "url": "https://github.com/quarkusio/quarkus/commit/ce60f44af09d0942bb6e1a1d3b9f7ad08b8b253a", "message": "Fix ClassLoader leak in the docs build\n\nAlso raise the metaspace limit, there is a bit of\ntrial and error here to find out what works.", "committedDate": "2020-08-28T06:08:54Z", "type": "commit"}, {"oid": "ce60f44af09d0942bb6e1a1d3b9f7ad08b8b253a", "url": "https://github.com/quarkusio/quarkus/commit/ce60f44af09d0942bb6e1a1d3b9f7ad08b8b253a", "message": "Fix ClassLoader leak in the docs build\n\nAlso raise the metaspace limit, there is a bit of\ntrial and error here to find out what works.", "committedDate": "2020-08-28T06:08:54Z", "type": "forcePushed"}]}