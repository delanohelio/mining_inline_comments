{"pr_number": 13669, "pr_title": "Auto-detect container runtime", "pr_createdAt": "2020-12-03T15:12:08Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13669", "timeline": [{"oid": "4dd39030b5d37c629cf4461faaf8fe031516002e", "url": "https://github.com/quarkusio/quarkus/commit/4dd39030b5d37c629cf4461faaf8fe031516002e", "message": "Auto-detect container runtime\n\nThis ensures that podman is selected if available in the environment and if it was not specified in the build configuration", "committedDate": "2020-12-03T15:13:47Z", "type": "forcePushed"}, {"oid": "5f32dcd534ae5fafdb4e50cb41fdcda702957219", "url": "https://github.com/quarkusio/quarkus/commit/5f32dcd534ae5fafdb4e50cb41fdcda702957219", "message": "Auto-detect container runtime\n\nThis checks that the podman or docker is chosen based on the environment", "committedDate": "2020-12-03T15:33:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM3MDc5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13669#discussion_r535370793", "bodyText": "Consider this wording instead?\nUsing container engine %s to run the native image builder, ....", "author": "jerboaa", "createdAt": "2020-12-03T16:09:53Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java", "diffHunk": "@@ -343,23 +344,25 @@ public NativeImageBuildItem build(NativeConfig nativeConfig, NativeImageSourceJa\n     public static List<String> setupContainerBuild(NativeConfig nativeConfig,\n             Optional<ProcessInheritIODisabled> processInheritIODisabled, Path outputDir) {\n         List<String> nativeImage;\n-        String containerRuntime = nativeConfig.containerRuntime.orElse(\"docker\");\n+        final ContainerRuntime containerRuntime = nativeConfig.containerRuntime\n+                .orElseGet(NativeImageBuildStep::detectContainerRuntime);\n+        log.infof(\"Using %s to build the native image\", containerRuntime.getExecutableName());", "originalCommit": "5f32dcd534ae5fafdb4e50cb41fdcda702957219", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM5OTQ0MA==", "url": "https://github.com/quarkusio/quarkus/pull/13669#discussion_r535399440", "bodyText": "Thanks, I reworded a bit differently from your suggestion. I prefer to avoid using \"container engine\" since the existing parameter is named \"container runtime\"", "author": "gastaldi", "createdAt": "2020-12-03T16:45:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM3MDc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzNTY2OA==", "url": "https://github.com/quarkusio/quarkus/pull/13669#discussion_r535435668", "bodyText": "Fine with me.", "author": "jerboaa", "createdAt": "2020-12-03T17:27:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM3MDc5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "0997ebfe531a41b92d33367116b003d6f7116a25", "chunk": "diff --git a/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java b/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java\nindex 530b85e5d8..95254d5fbc 100644\n--- a/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java\n+++ b/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java\n\n@@ -346,7 +346,7 @@ public class NativeImageBuildStep {\n         List<String> nativeImage;\n         final ContainerRuntime containerRuntime = nativeConfig.containerRuntime\n                 .orElseGet(NativeImageBuildStep::detectContainerRuntime);\n-        log.infof(\"Using %s to build the native image\", containerRuntime.getExecutableName());\n+        log.infof(\"Using %s to run the native image builder\", containerRuntime.getExecutableName());\n         // E.g. \"/usr/bin/docker run -v {{PROJECT_DIR}}:/project --rm quarkus/graalvm-native-image\"\n         nativeImage = new ArrayList<>();\n \n"}}, {"oid": "0997ebfe531a41b92d33367116b003d6f7116a25", "url": "https://github.com/quarkusio/quarkus/commit/0997ebfe531a41b92d33367116b003d6f7116a25", "message": "Auto-detect container runtime\n\nThis checks that the podman or docker is chosen based on the environment", "committedDate": "2020-12-03T16:44:20Z", "type": "commit"}, {"oid": "0997ebfe531a41b92d33367116b003d6f7116a25", "url": "https://github.com/quarkusio/quarkus/commit/0997ebfe531a41b92d33367116b003d6f7116a25", "message": "Auto-detect container runtime\n\nThis checks that the podman or docker is chosen based on the environment", "committedDate": "2020-12-03T16:44:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0NDA4MA==", "url": "https://github.com/quarkusio/quarkus/pull/13669#discussion_r536044080", "bodyText": "The comment implies that podman is preferred over docker but the code does the opposite.", "author": "zakkak", "createdAt": "2020-12-04T11:50:46Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java", "diffHunk": "@@ -394,6 +397,51 @@ public NativeImageBuildItem build(NativeConfig nativeConfig, NativeImageSourceJa\n         return nativeImage;\n     }\n \n+    /**\n+     * @return {@link ContainerRuntime#PODMAN} if the podman executable exists in the environment or if the docker executable", "originalCommit": "0997ebfe531a41b92d33367116b003d6f7116a25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1ODA1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13669#discussion_r536058053", "bodyText": "Yeah, that was the initial behavior, but I changed later on and forgot to update the Javadoc \ud83d\ude1b", "author": "gastaldi", "createdAt": "2020-12-04T12:16:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0NDA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1ODExNA==", "url": "https://github.com/quarkusio/quarkus/pull/13669#discussion_r536058114", "bodyText": "#13699 fixes this", "author": "zakkak", "createdAt": "2020-12-04T12:16:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0NDA4MA=="}], "type": "inlineReview", "revised_code": null}]}