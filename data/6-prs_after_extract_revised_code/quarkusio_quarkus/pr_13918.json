{"pr_number": 13918, "pr_title": "Add GenericType to the signature of ServerMessageBodyWriter methods", "pr_createdAt": "2020-12-16T11:23:19Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13918", "timeline": [{"oid": "434404b9f6fced7e4d17757922c44c16e9ac1310", "url": "https://github.com/quarkusio/quarkus/commit/434404b9f6fced7e4d17757922c44c16e9ac1310", "message": "Add GenericType to the signature of ServerMessageBodyWriter methods\n\nThis is done in a way that doesn't make us look up the types using generics\n\nThe instigator for this was that Qson needs this generic type", "committedDate": "2020-12-16T11:23:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI4ODA0NA==", "url": "https://github.com/quarkusio/quarkus/pull/13918#discussion_r544288044", "bodyText": "Perhaps currentClass.typeParameters() can be extracted to a local variable here", "author": "gastaldi", "createdAt": "2020-12-16T13:14:45Z", "path": "independent-projects/resteasy-reactive/common/processor/src/main/java/org/jboss/resteasy/reactive/common/processor/EndpointIndexer.java", "diffHunk": "@@ -609,29 +618,40 @@ protected static String toClassName(Type indexType, ClassInfo currentClass, Clas\n                 if (typeVariable.bounds().isEmpty()) {\n                     return Object.class.getName();\n                 }\n-                int pos = -1;\n-                for (int i = 0; i < currentClass.typeParameters().size(); ++i) {\n-                    if (currentClass.typeParameters().get(i).identifier().equals(typeVariable.identifier())) {\n-                        pos = i;\n-                        break;\n-                    }\n-                }\n-                if (pos != -1) {\n-                    List<Type> params = JandexUtil.resolveTypeParameters(actualEndpointClass.name(), currentClass.name(),\n-                            indexView);\n \n-                    Type resolved = params.get(pos);\n-                    if (resolved.kind() != Type.Kind.TYPE_VARIABLE\n-                            || !resolved.asTypeVariable().identifier().equals(typeVariable.identifier())) {\n-                        return toClassName(resolved, currentClass, actualEndpointClass, indexView);\n-                    }\n-                }\n-                return toClassName(typeVariable.bounds().get(0), currentClass, actualEndpointClass, indexView);\n+                return toClassName(resolveTypeVariable(typeVariable, currentClass, actualEndpointClass, indexView),\n+                        currentClass, actualEndpointClass, indexView);\n             default:\n                 throw new RuntimeException(\"Unknown parameter type \" + indexType);\n         }\n     }\n \n+    private static Type resolveTypeVariable(TypeVariable typeVariable, ClassInfo currentClass, ClassInfo actualEndpointClass,\n+            IndexView indexView) {\n+        if (typeVariable.bounds().isEmpty()) {\n+            return Type.create(DotName.createSimple(Object.class.getName()), Kind.CLASS);\n+        }\n+        int pos = -1;\n+        for (int i = 0; i < currentClass.typeParameters().size(); ++i) {", "originalCommit": "2e3836b28cfba69703ad41b7a963c3a48cc1b8f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI5MTQ5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/13918#discussion_r544291495", "bodyText": "Done", "author": "geoand", "createdAt": "2020-12-16T13:19:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI4ODA0NA=="}], "type": "inlineReview", "revised_code": {"commit": "02f36ded060d2578847098677f0ee42472491db1", "chunk": "diff --git a/independent-projects/resteasy-reactive/common/processor/src/main/java/org/jboss/resteasy/reactive/common/processor/EndpointIndexer.java b/independent-projects/resteasy-reactive/common/processor/src/main/java/org/jboss/resteasy/reactive/common/processor/EndpointIndexer.java\nindex 1605a9f9bf..afea810bf2 100644\n--- a/independent-projects/resteasy-reactive/common/processor/src/main/java/org/jboss/resteasy/reactive/common/processor/EndpointIndexer.java\n+++ b/independent-projects/resteasy-reactive/common/processor/src/main/java/org/jboss/resteasy/reactive/common/processor/EndpointIndexer.java\n\n@@ -632,8 +632,9 @@ public abstract class EndpointIndexer<T extends EndpointIndexer<T, PARAM, METHOD\n             return Type.create(DotName.createSimple(Object.class.getName()), Kind.CLASS);\n         }\n         int pos = -1;\n-        for (int i = 0; i < currentClass.typeParameters().size(); ++i) {\n-            if (currentClass.typeParameters().get(i).identifier().equals(typeVariable.identifier())) {\n+        List<TypeVariable> typeVariables = currentClass.typeParameters();\n+        for (int i = 0; i < typeVariables.size(); ++i) {\n+            if (typeVariables.get(i).identifier().equals(typeVariable.identifier())) {\n                 pos = i;\n                 break;\n             }\n"}}, {"oid": "02f36ded060d2578847098677f0ee42472491db1", "url": "https://github.com/quarkusio/quarkus/commit/02f36ded060d2578847098677f0ee42472491db1", "message": "Resolve type variable if it's used as a return type\n\nThis was encountered when trying to run of the Qson tests against RESTEasy Reactive", "committedDate": "2020-12-16T13:19:17Z", "type": "forcePushed"}, {"oid": "e0991068251a44e37fcef7cc0da6ce01b05698d8", "url": "https://github.com/quarkusio/quarkus/commit/e0991068251a44e37fcef7cc0da6ce01b05698d8", "message": "Resolve type variable if it \u03b9s used as a return type in RESTEasy Reactive\n\nThis was encountered when trying to run of the Qson tests against RESTEasy Reactive", "committedDate": "2020-12-16T14:05:34Z", "type": "commit"}, {"oid": "e0991068251a44e37fcef7cc0da6ce01b05698d8", "url": "https://github.com/quarkusio/quarkus/commit/e0991068251a44e37fcef7cc0da6ce01b05698d8", "message": "Resolve type variable if it \u03b9s used as a return type in RESTEasy Reactive\n\nThis was encountered when trying to run of the Qson tests against RESTEasy Reactive", "committedDate": "2020-12-16T14:05:34Z", "type": "forcePushed"}]}