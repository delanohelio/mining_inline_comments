{"pr_number": 10575, "pr_title": "Qute - fix incorrect behavior of Evaluator in loop sections", "pr_createdAt": "2020-07-08T14:14:00Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10575", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE3MTM1NA==", "url": "https://github.com/quarkusio/quarkus/pull/10575#discussion_r452171354", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n                @Test\n          \n          \n            \n                void testScopeEach() {\n          \n          \n            \n                    final HashMap<String, Object> dep1 = new HashMap<>();\n          \n          \n            \n                    dep1.put(\"version\", \"1.0\");\n          \n          \n            \n                    final HashMap<String, Object> data = new HashMap<>();\n          \n          \n            \n                    data.put(\"dependencies\", Arrays.asList(dep1, new HashMap<>()));\n          \n          \n            \n                    data.put(\"version\", \"hellllllo\");\n          \n          \n            \n                    final String result = Engine.builder().addDefaults().build()\n          \n          \n            \n                            .parse(\"{#each dependencies}{#if it.version}<version>{it.version}</version>{/if}{/each}\")\n          \n          \n            \n                            .render(data);\n          \n          \n            \n                    assertFalse(result.contains(\"hellllllo\"), result);\n          \n          \n            \n                }", "author": "ia3andy", "createdAt": "2020-07-09T12:12:26Z", "path": "independent-projects/qute/core/src/test/java/io/quarkus/qute/LoopSectionTest.java", "diffHunk": "@@ -147,4 +148,17 @@ public void testNoniterable() {\n         }\n     }\n \n+    @Test\n+    void testScope() {\n+        final HashMap<String, Object> dep1 = new HashMap<>();\n+        dep1.put(\"version\", \"1.0\");\n+        final HashMap<String, Object> data = new HashMap<>();\n+        data.put(\"dependencies\", Arrays.asList(dep1, new HashMap<>()));\n+        data.put(\"version\", \"hellllllo\");\n+        final String result = Engine.builder().addDefaults().build()\n+                .parse(\"{#for dep in dependencies}{#if dep.version}<version>{dep.version}</version>{/if}{/for}\")\n+                .render(data);\n+        assertFalse(result.contains(\"hellllllo\"), result);\n+    }\n+", "originalCommit": "8df6ef3c72b06a1017fae8a62dcac63fa40c264c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIxMzUzOQ==", "url": "https://github.com/quarkusio/quarkus/pull/10575#discussion_r452213539", "bodyText": "Oh and maybe we should also test that {version} works in another test?", "author": "ia3andy", "createdAt": "2020-07-09T13:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE3MTM1NA=="}], "type": "inlineReview", "revised_code": {"commit": "abe9923cb811d8d32bef20ebacbb216992d36df6", "chunk": "diff --git a/independent-projects/qute/core/src/test/java/io/quarkus/qute/LoopSectionTest.java b/independent-projects/qute/core/src/test/java/io/quarkus/qute/LoopSectionTest.java\nindex d519dc28a2..e07ce14898 100644\n--- a/independent-projects/qute/core/src/test/java/io/quarkus/qute/LoopSectionTest.java\n+++ b/independent-projects/qute/core/src/test/java/io/quarkus/qute/LoopSectionTest.java\n\n@@ -155,10 +155,19 @@ public class LoopSectionTest {\n         final HashMap<String, Object> data = new HashMap<>();\n         data.put(\"dependencies\", Arrays.asList(dep1, new HashMap<>()));\n         data.put(\"version\", \"hellllllo\");\n-        final String result = Engine.builder().addDefaults().build()\n-                .parse(\"{#for dep in dependencies}{#if dep.version}<version>{dep.version}</version>{/if}{/for}\")\n+        Engine engine = Engine.builder().addDefaults().build();\n+        String result = engine.parse(\"{#for dep in dependencies}{#if dep.version}<version>{dep.version}</version>{/if}{/for}\")\n                 .render(data);\n         assertFalse(result.contains(\"hellllllo\"), result);\n+        result = engine.parse(\"{#for dep in dependencies}{#if dep.version}<version>{version}</version>{/if}{/for}\")\n+                .render(data);\n+        assertTrue(result.contains(\"hellllllo\"), result);\n+        result = engine.parse(\"{#each dependencies}{#if it.version}<version>{it.version}</version>{/if}{/each}\")\n+                .render(data);\n+        assertFalse(result.contains(\"hellllllo\"), result);\n+        result = engine.parse(\"{#each dependencies}{#if it.version}<version>{version}</version>{/if}{/each}\")\n+                .render(data);\n+        assertTrue(result.contains(\"hellllllo\"), result);\n     }\n \n }\n"}}, {"oid": "abe9923cb811d8d32bef20ebacbb216992d36df6", "url": "https://github.com/quarkusio/quarkus/commit/abe9923cb811d8d32bef20ebacbb216992d36df6", "message": "Qute - fix incorrect behavior of Evaluator in loop sections\n\n- only try the parent context/outer scope for the first part of an\nexpression\n- resolves #10572", "committedDate": "2020-07-10T08:15:10Z", "type": "commit"}, {"oid": "abe9923cb811d8d32bef20ebacbb216992d36df6", "url": "https://github.com/quarkusio/quarkus/commit/abe9923cb811d8d32bef20ebacbb216992d36df6", "message": "Qute - fix incorrect behavior of Evaluator in loop sections\n\n- only try the parent context/outer scope for the first part of an\nexpression\n- resolves #10572", "committedDate": "2020-07-10T08:15:10Z", "type": "forcePushed"}]}