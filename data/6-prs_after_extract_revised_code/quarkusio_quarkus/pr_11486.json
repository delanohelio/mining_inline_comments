{"pr_number": 11486, "pr_title": "QuarkusSecurityTestExtension fails to read class annotation", "pr_createdAt": "2020-08-20T03:47:15Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11486", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU3MTYxMw==", "url": "https://github.com/quarkusio/quarkus/pull/11486#discussion_r473571613", "bodyText": "Is this while loop missing an assignment to testSecurity? In other words, should that testSecurity = original.getAnnotation(TestSecurity.class) be moved into the while loop?", "author": "jaikiran", "createdAt": "2020-08-20T03:51:41Z", "path": "test-framework/security/src/main/java/io/quarkus/test/security/QuarkusSecurityTestExtension.java", "diffHunk": "@@ -37,7 +36,10 @@ public void beforeEach(QuarkusTestMethodContext context) {\n                     }).toArray(Class<?>[]::new));\n             TestSecurity testSecurity = method.getAnnotation(TestSecurity.class);\n             if (testSecurity == null) {\n-                testSecurity = test.getAnnotation(TestSecurity.class);\n+                testSecurity = original.getAnnotation(TestSecurity.class);\n+                while (testSecurity == null && original != Object.class) {\n+                    original = original.getSuperclass();\n+                }", "originalCommit": "12c9c28cf4cb2d59106c8d66ea31a7653c748f60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU3MTc5NA==", "url": "https://github.com/quarkusio/quarkus/pull/11486#discussion_r473571794", "bodyText": "Ah, oops. It still fixes it in this specific case as it is checking the original, however this was supposed to make it work for superclasses as well.", "author": "stuartwdouglas", "createdAt": "2020-08-20T03:52:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU3MTYxMw=="}], "type": "inlineReview", "revised_code": {"commit": "7047e95ed9327a1edce5a7e02d35da1ad0cf9465", "chunk": "diff --git a/test-framework/security/src/main/java/io/quarkus/test/security/QuarkusSecurityTestExtension.java b/test-framework/security/src/main/java/io/quarkus/test/security/QuarkusSecurityTestExtension.java\nindex a4de838523..5a1420d323 100644\n--- a/test-framework/security/src/main/java/io/quarkus/test/security/QuarkusSecurityTestExtension.java\n+++ b/test-framework/security/src/main/java/io/quarkus/test/security/QuarkusSecurityTestExtension.java\n\n@@ -39,6 +39,7 @@ public class QuarkusSecurityTestExtension implements QuarkusTestBeforeEachCallba\n                 testSecurity = original.getAnnotation(TestSecurity.class);\n                 while (testSecurity == null && original != Object.class) {\n                     original = original.getSuperclass();\n+                    testSecurity = original.getAnnotation(TestSecurity.class);\n                 }\n             }\n             if (testSecurity == null) {\n"}}, {"oid": "7047e95ed9327a1edce5a7e02d35da1ad0cf9465", "url": "https://github.com/quarkusio/quarkus/commit/7047e95ed9327a1edce5a7e02d35da1ad0cf9465", "message": "QuarkusSecurityTestExtension fails to read class annotation\n\nFixes #11465", "committedDate": "2020-08-20T03:53:51Z", "type": "commit"}, {"oid": "7047e95ed9327a1edce5a7e02d35da1ad0cf9465", "url": "https://github.com/quarkusio/quarkus/commit/7047e95ed9327a1edce5a7e02d35da1ad0cf9465", "message": "QuarkusSecurityTestExtension fails to read class annotation\n\nFixes #11465", "committedDate": "2020-08-20T03:53:51Z", "type": "forcePushed"}]}