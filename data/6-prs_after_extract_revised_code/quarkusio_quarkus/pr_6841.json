{"pr_number": 6841, "pr_title": "Fix issue getting config from fork join pool", "pr_createdAt": "2020-01-29T00:32:22Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/6841", "timeline": [{"oid": "f804d5ca85298cd7847587a18f5b381515072742", "url": "https://github.com/quarkusio/quarkus/commit/f804d5ca85298cd7847587a18f5b381515072742", "message": "Fix issue getting config from fork join pool", "committedDate": "2020-01-29T02:20:43Z", "type": "forcePushed"}, {"oid": "56c1e11d5651dcdc3d6cd2084f300bd66215ab48", "url": "https://github.com/quarkusio/quarkus/commit/56c1e11d5651dcdc3d6cd2084f300bd66215ab48", "message": "Fix issue getting config from fork join pool", "committedDate": "2020-01-29T05:19:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI0MjE5NA==", "url": "https://github.com/quarkusio/quarkus/pull/6841#discussion_r372242194", "bodyText": "I wonder if we should be catching the ISE here", "author": "geoand", "createdAt": "2020-01-29T08:21:27Z", "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/QuarkusConfigFactory.java", "diffHunk": "@@ -34,6 +36,17 @@ public SmallRyeConfig getConfigFor(final SmallRyeConfigProviderResolver configPr\n     }\n \n     public static void setConfig(SmallRyeConfig config) {\n+        //This is a hack, but there is not a great deal that can be done about it\n+        //it is possible that when running in test/dev mode some code will be run with the system TCCL\n+        //e.g. when using the fork join pool\n+        //if this happens any use of config will fail, as the system class loader will resolve the\n+        //wrong instance of the config classes\n+        if (QuarkusConfigFactory.config != null) {\n+            ConfigProviderResolver.instance().releaseConfig(QuarkusConfigFactory.config);", "originalCommit": "56c1e11d5651dcdc3d6cd2084f300bd66215ab48", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b5cbc2b0c66ab608cf76d6e5ac6d4e571f895096", "chunk": "diff --git a/core/runtime/src/main/java/io/quarkus/runtime/configuration/QuarkusConfigFactory.java b/core/runtime/src/main/java/io/quarkus/runtime/configuration/QuarkusConfigFactory.java\nindex e5dc7b1039..250c842101 100644\n--- a/core/runtime/src/main/java/io/quarkus/runtime/configuration/QuarkusConfigFactory.java\n+++ b/core/runtime/src/main/java/io/quarkus/runtime/configuration/QuarkusConfigFactory.java\n\n@@ -36,17 +34,6 @@ public final class QuarkusConfigFactory extends SmallRyeConfigFactory {\n     }\n \n     public static void setConfig(SmallRyeConfig config) {\n-        //This is a hack, but there is not a great deal that can be done about it\n-        //it is possible that when running in test/dev mode some code will be run with the system TCCL\n-        //e.g. when using the fork join pool\n-        //if this happens any use of config will fail, as the system class loader will resolve the\n-        //wrong instance of the config classes\n-        if (QuarkusConfigFactory.config != null) {\n-            ConfigProviderResolver.instance().releaseConfig(QuarkusConfigFactory.config);\n-        }\n-        if (config != null) {\n-            ConfigProviderResolver.instance().registerConfig(config, ClassLoader.getSystemClassLoader());\n-        }\n         QuarkusConfigFactory.config = config;\n     }\n }\n"}}, {"oid": "42f4b20b347cc55f9f4717d5cd870f7a0018ff11", "url": "https://github.com/quarkusio/quarkus/commit/42f4b20b347cc55f9f4717d5cd870f7a0018ff11", "message": "Fix issue getting config from fork join pool", "committedDate": "2020-02-10T05:47:42Z", "type": "forcePushed"}, {"oid": "b5cbc2b0c66ab608cf76d6e5ac6d4e571f895096", "url": "https://github.com/quarkusio/quarkus/commit/b5cbc2b0c66ab608cf76d6e5ac6d4e571f895096", "message": "Shutdown all resources on close", "committedDate": "2020-02-11T02:44:42Z", "type": "commit"}, {"oid": "b2bfc3bf3779423e207a1524e07154df2f421e78", "url": "https://github.com/quarkusio/quarkus/commit/b2bfc3bf3779423e207a1524e07154df2f421e78", "message": "Fix issue getting config from fork join pool", "committedDate": "2020-02-11T02:51:32Z", "type": "commit"}, {"oid": "b2bfc3bf3779423e207a1524e07154df2f421e78", "url": "https://github.com/quarkusio/quarkus/commit/b2bfc3bf3779423e207a1524e07154df2f421e78", "message": "Fix issue getting config from fork join pool", "committedDate": "2020-02-11T02:51:32Z", "type": "forcePushed"}]}