{"pr_number": 13610, "pr_title": "Fix lambda no arg error", "pr_createdAt": "2020-12-01T22:25:17Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13610", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc2NTQzNA==", "url": "https://github.com/quarkusio/quarkus/pull/13610#discussion_r533765434", "bodyText": "Maybe we could add overload with timeout?", "author": "matejvasek", "createdAt": "2020-12-01T22:31:02Z", "path": "integration-tests/funqy-amazon-lambda/src/test/java/io/quarkus/funqy/test/NoArgFunTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package io.quarkus.funqy.test;\n+\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Timer;\n+import java.util.TimerTask;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import io.quarkus.amazon.lambda.test.LambdaClient;\n+import io.quarkus.test.junit.QuarkusTest;\n+\n+@QuarkusTest\n+@ExtendWith(UseNoArgFunExtension.class)\n+public class NoArgFunTest {\n+\n+    @Test\n+    public void testNoArgFun() {\n+        Thread mainTestThread = Thread.currentThread();\n+        Timer timer = new Timer(true);\n+        timer.schedule(new TimerTask() {\n+            @Override\n+            public void run() {\n+                mainTestThread.interrupt();\n+            }\n+        }, 10_000);\n+\n+        try {\n+            LambdaClient.invoke(String.class, null);", "originalCommit": "400b77441c2c7f899ee17375a77c54b7195dbbef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3NzU2OA==", "url": "https://github.com/quarkusio/quarkus/pull/13610#discussion_r533877568", "bodyText": "+1", "author": "patriot1burke", "createdAt": "2020-12-02T03:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc2NTQzNA=="}], "type": "inlineReview", "revised_code": {"commit": "cabf8d91e2e8bc120d6370712d99a31dde25693b", "chunk": "diff --git a/integration-tests/funqy-amazon-lambda/src/test/java/io/quarkus/funqy/test/NoArgFunTest.java b/integration-tests/funqy-amazon-lambda/src/test/java/io/quarkus/funqy/test/NoArgFunTest.java\nindex 5d0412b2ac..1fb94529c8 100644\n--- a/integration-tests/funqy-amazon-lambda/src/test/java/io/quarkus/funqy/test/NoArgFunTest.java\n+++ b/integration-tests/funqy-amazon-lambda/src/test/java/io/quarkus/funqy/test/NoArgFunTest.java\n\n@@ -1,9 +1,6 @@\n package io.quarkus.funqy.test;\n \n-import static org.junit.jupiter.api.Assertions.fail;\n-\n-import java.util.Timer;\n-import java.util.TimerTask;\n+import java.time.Duration;\n \n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA1MzI1OA==", "url": "https://github.com/quarkusio/quarkus/pull/13610#discussion_r534053258", "bodyText": "Please use curly braces.", "author": "gsmet", "createdAt": "2020-12-02T10:20:42Z", "path": "extensions/amazon-lambda/common-runtime/src/main/java/io/quarkus/amazon/lambda/runtime/AbstractLambdaPollLoop.java", "diffHunk": "@@ -74,8 +74,10 @@ public void run() {\n                                     }\n                                 } else {\n                                     Object input = null;\n-                                    if (running.get() && getInputReader() != null) {\n-                                        input = getInputReader().readValue(requestConnection.getInputStream());\n+                                    if (running.get()) {\n+                                        ObjectReader inputReader = getInputReader();\n+                                        if (inputReader != null)", "originalCommit": "400b77441c2c7f899ee17375a77c54b7195dbbef", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "09e645f56a320dc04f2b1019103199ca571cd6db", "chunk": "diff --git a/extensions/amazon-lambda/common-runtime/src/main/java/io/quarkus/amazon/lambda/runtime/AbstractLambdaPollLoop.java b/extensions/amazon-lambda/common-runtime/src/main/java/io/quarkus/amazon/lambda/runtime/AbstractLambdaPollLoop.java\nindex 3cf3c69583..b63b62e324 100644\n--- a/extensions/amazon-lambda/common-runtime/src/main/java/io/quarkus/amazon/lambda/runtime/AbstractLambdaPollLoop.java\n+++ b/extensions/amazon-lambda/common-runtime/src/main/java/io/quarkus/amazon/lambda/runtime/AbstractLambdaPollLoop.java\n\n@@ -76,8 +76,9 @@ public abstract class AbstractLambdaPollLoop {\n                                     Object input = null;\n                                     if (running.get()) {\n                                         ObjectReader inputReader = getInputReader();\n-                                        if (inputReader != null)\n+                                        if (inputReader != null) {\n                                             input = inputReader.readValue(requestConnection.getInputStream());\n+                                        }\n                                         Object output = processRequest(input, createContext(requestConnection));\n                                         postResponse(url, output);\n                                     }\n"}}, {"oid": "cabf8d91e2e8bc120d6370712d99a31dde25693b", "url": "https://github.com/quarkusio/quarkus/commit/cabf8d91e2e8bc120d6370712d99a31dde25693b", "message": "Fix lambda no arg error\n\nSigned-off-by: Matej Vasek <mvasek@redhat.com>", "committedDate": "2020-12-02T19:34:02Z", "type": "forcePushed"}, {"oid": "09e645f56a320dc04f2b1019103199ca571cd6db", "url": "https://github.com/quarkusio/quarkus/commit/09e645f56a320dc04f2b1019103199ca571cd6db", "message": "Fix lambda no arg error\n\nSigned-off-by: Matej Vasek <mvasek@redhat.com>", "committedDate": "2020-12-02T19:49:19Z", "type": "forcePushed"}, {"oid": "c90bd8c11d8c2b8d1b7388099902d15b02a9cddf", "url": "https://github.com/quarkusio/quarkus/commit/c90bd8c11d8c2b8d1b7388099902d15b02a9cddf", "message": "Fix lambda no arg error\n\nSigned-off-by: Matej Vasek <mvasek@redhat.com>", "committedDate": "2021-03-09T17:16:39Z", "type": "commit"}, {"oid": "c90bd8c11d8c2b8d1b7388099902d15b02a9cddf", "url": "https://github.com/quarkusio/quarkus/commit/c90bd8c11d8c2b8d1b7388099902d15b02a9cddf", "message": "Fix lambda no arg error\n\nSigned-off-by: Matej Vasek <mvasek@redhat.com>", "committedDate": "2021-03-09T17:16:39Z", "type": "forcePushed"}]}