{"pr_number": 7498, "pr_title": "Add logging of hibernate orm bind params", "pr_createdAt": "2020-02-29T19:56:48Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7498", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2MjQwNw==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r386062407", "bodyText": "Shouldn't this be defaultValue=false?", "author": "machi1990", "createdAt": "2020-02-29T23:15:57Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -279,10 +279,19 @@ public boolean isAnyPropertySet() {\n         /**\n          * Show SQL logs and format them nicely.\n          * <p>\n+         * true logs sql statements\n+         * extended logs sql statements and bind parameter values\n+         * <p>\n          * Setting it to true is obviously not recommended in production.\n          */\n-        @ConfigItem(defaultValue = \"false\")\n-        public boolean sql;\n+        @ConfigItem(defaultValueDocumentation = \"false\")", "originalCommit": "0267ff4124b69c3dbcab4c8600d02983bd3e8edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA4NjgxNA==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r386086814", "bodyText": "defaultValue=false would also work here, but would require a more in depth check in the isAnyPropertySet() method (line 303)", "author": "Postremus", "createdAt": "2020-03-01T08:13:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2MjQwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNjE2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r386106169", "bodyText": "I wouldn't do it this way. It would be better to create a separate parameter for this than to have properties which are boolean plus some other thing.", "author": "dmlloyd", "createdAt": "2020-03-01T12:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2MjQwNw=="}], "type": "inlineReview", "revised_code": {"commit": "30c90a9f7edb278d477b2b4f96e2ad17cc468950", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\nindex 31691b9ade..97cef720a5 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\n\n@@ -279,19 +279,18 @@ public class HibernateOrmConfig {\n         /**\n          * Show SQL logs and format them nicely.\n          * <p>\n-         * true logs sql statements\n-         * extended logs sql statements and bind parameter values\n-         * <p>\n          * Setting it to true is obviously not recommended in production.\n          */\n-        @ConfigItem(defaultValueDocumentation = \"false\")\n-        public Optional<HibernateOrmConfigLogSqlValue> sql;\n+        @ConfigItem(defaultValue = \"false\")\n+        public boolean sql;\n \n-        public enum HibernateOrmConfigLogSqlValue {\n-            FALSE,\n-            TRUE,\n-            EXTENDED;\n-        }\n+        /**\n+         * Logs SQL bind parameter.\n+         * <p>\n+         * Setting it to true is obviously not recommended in production.\n+         */\n+        @ConfigItem(defaultValue = \"false\")\n+        public boolean bindParam;\n \n         /**\n          * Whether JDBC warnings should be collected and logged.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5MDYyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r386090629", "bodyText": "Please don't rely on the ordinal, it's prone to errors in case someone re-orders the enum constants down the road. I think simply checking for the two enum constants is good enough; or, if you'd want something more generic, add methods to the enum such as boolean logsSql() (returning true for TRUE and EXTENDED) and boolean logsParameters().", "author": "gunnarmorling", "createdAt": "2020-03-01T09:11:31Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -642,9 +644,14 @@ private void handleHibernateORMWithNoPersistenceXml(\n                                 fetchSize.toString()));\n \n                 // Logging\n-                if (hibernateConfig.log.sql) {\n-                    desc.getProperties().setProperty(AvailableSettings.SHOW_SQL, \"true\");\n-                    desc.getProperties().setProperty(AvailableSettings.FORMAT_SQL, \"true\");\n+                if (hibernateConfig.log.sql.isPresent()) {\n+                    HibernateOrmConfig.HibernateOrmConfigLog.HibernateOrmConfigLogSqlValue value = hibernateConfig.log.sql\n+                            .get();\n+                    if (value.ordinal() >= HibernateOrmConfig.HibernateOrmConfigLog.HibernateOrmConfigLogSqlValue.TRUE", "originalCommit": "0267ff4124b69c3dbcab4c8600d02983bd3e8edd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "30c90a9f7edb278d477b2b4f96e2ad17cc468950", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java\nindex 2d3ae51e35..4d5b79cfbb 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java\n\n@@ -644,14 +644,9 @@ public final class HibernateOrmProcessor {\n                                 fetchSize.toString()));\n \n                 // Logging\n-                if (hibernateConfig.log.sql.isPresent()) {\n-                    HibernateOrmConfig.HibernateOrmConfigLog.HibernateOrmConfigLogSqlValue value = hibernateConfig.log.sql\n-                            .get();\n-                    if (value.ordinal() >= HibernateOrmConfig.HibernateOrmConfigLog.HibernateOrmConfigLogSqlValue.TRUE\n-                            .ordinal()) {\n-                        desc.getProperties().setProperty(AvailableSettings.SHOW_SQL, \"true\");\n-                        desc.getProperties().setProperty(AvailableSettings.FORMAT_SQL, \"true\");\n-                    }\n+                if (hibernateConfig.log.sql) {\n+                    desc.getProperties().setProperty(AvailableSettings.SHOW_SQL, \"true\");\n+                    desc.getProperties().setProperty(AvailableSettings.FORMAT_SQL, \"true\");\n                 }\n \n                 if (hibernateConfig.log.jdbcWarnings.isPresent()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5MDY5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r386090695", "bodyText": "Why is it optional, if there is a default value?", "author": "gunnarmorling", "createdAt": "2020-03-01T09:12:31Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -279,10 +279,19 @@ public boolean isAnyPropertySet() {\n         /**\n          * Show SQL logs and format them nicely.\n          * <p>\n+         * true logs sql statements\n+         * extended logs sql statements and bind parameter values\n+         * <p>\n          * Setting it to true is obviously not recommended in production.\n          */\n-        @ConfigItem(defaultValue = \"false\")\n-        public boolean sql;\n+        @ConfigItem(defaultValueDocumentation = \"false\")\n+        public Optional<HibernateOrmConfigLogSqlValue> sql;", "originalCommit": "0267ff4124b69c3dbcab4c8600d02983bd3e8edd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "30c90a9f7edb278d477b2b4f96e2ad17cc468950", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\nindex 31691b9ade..97cef720a5 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\n\n@@ -279,19 +279,18 @@ public class HibernateOrmConfig {\n         /**\n          * Show SQL logs and format them nicely.\n          * <p>\n-         * true logs sql statements\n-         * extended logs sql statements and bind parameter values\n-         * <p>\n          * Setting it to true is obviously not recommended in production.\n          */\n-        @ConfigItem(defaultValueDocumentation = \"false\")\n-        public Optional<HibernateOrmConfigLogSqlValue> sql;\n+        @ConfigItem(defaultValue = \"false\")\n+        public boolean sql;\n \n-        public enum HibernateOrmConfigLogSqlValue {\n-            FALSE,\n-            TRUE,\n-            EXTENDED;\n-        }\n+        /**\n+         * Logs SQL bind parameter.\n+         * <p>\n+         * Setting it to true is obviously not recommended in production.\n+         */\n+        @ConfigItem(defaultValue = \"false\")\n+        public boolean bindParam;\n \n         /**\n          * Whether JDBC warnings should be collected and logged.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNjE5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r386106195", "bodyText": "Yeah definitely not.", "author": "dmlloyd", "createdAt": "2020-03-01T12:59:16Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -279,10 +279,19 @@ public boolean isAnyPropertySet() {\n         /**\n          * Show SQL logs and format them nicely.\n          * <p>\n+         * true logs sql statements\n+         * extended logs sql statements and bind parameter values\n+         * <p>\n          * Setting it to true is obviously not recommended in production.\n          */\n-        @ConfigItem(defaultValue = \"false\")\n-        public boolean sql;\n+        @ConfigItem(defaultValueDocumentation = \"false\")\n+        public Optional<HibernateOrmConfigLogSqlValue> sql;\n+\n+        public enum HibernateOrmConfigLogSqlValue {\n+            FALSE,\n+            TRUE,\n+            EXTENDED;", "originalCommit": "0267ff4124b69c3dbcab4c8600d02983bd3e8edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEzODM3OA==", "url": "https://github.com/quarkusio/quarkus/pull/7498#discussion_r389138378", "bodyText": "Done", "author": "Postremus", "createdAt": "2020-03-06T20:53:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEwNjE5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "30c90a9f7edb278d477b2b4f96e2ad17cc468950", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\nindex 31691b9ade..97cef720a5 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java\n\n@@ -279,19 +279,18 @@ public class HibernateOrmConfig {\n         /**\n          * Show SQL logs and format them nicely.\n          * <p>\n-         * true logs sql statements\n-         * extended logs sql statements and bind parameter values\n-         * <p>\n          * Setting it to true is obviously not recommended in production.\n          */\n-        @ConfigItem(defaultValueDocumentation = \"false\")\n-        public Optional<HibernateOrmConfigLogSqlValue> sql;\n+        @ConfigItem(defaultValue = \"false\")\n+        public boolean sql;\n \n-        public enum HibernateOrmConfigLogSqlValue {\n-            FALSE,\n-            TRUE,\n-            EXTENDED;\n-        }\n+        /**\n+         * Logs SQL bind parameter.\n+         * <p>\n+         * Setting it to true is obviously not recommended in production.\n+         */\n+        @ConfigItem(defaultValue = \"false\")\n+        public boolean bindParam;\n \n         /**\n          * Whether JDBC warnings should be collected and logged.\n"}}, {"oid": "30c90a9f7edb278d477b2b4f96e2ad17cc468950", "url": "https://github.com/quarkusio/quarkus/commit/30c90a9f7edb278d477b2b4f96e2ad17cc468950", "message": "Add logging of hibernate orm bind params\n\"quarkus.hibernate-orm.log.bindparam\" added for logging of bind parameters", "committedDate": "2020-03-06T20:52:02Z", "type": "commit"}, {"oid": "30c90a9f7edb278d477b2b4f96e2ad17cc468950", "url": "https://github.com/quarkusio/quarkus/commit/30c90a9f7edb278d477b2b4f96e2ad17cc468950", "message": "Add logging of hibernate orm bind params\n\"quarkus.hibernate-orm.log.bindparam\" added for logging of bind parameters", "committedDate": "2020-03-06T20:52:02Z", "type": "forcePushed"}]}