{"pr_number": 13694, "pr_title": "Allow injection of Session/SessionFactory ", "pr_createdAt": "2020-12-04T09:38:18Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13694", "timeline": [{"oid": "7a275e81524e347738b2b2264126ec92fa762615", "url": "https://github.com/quarkusio/quarkus/commit/7a275e81524e347738b2b2264126ec92fa762615", "message": "Dedicated tests for EntityManager injection with a single PU\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-04T08:02:00Z", "type": "commit"}, {"oid": "1aec4e32af10cc90a54db1f104268694a2270043", "url": "https://github.com/quarkusio/quarkus/commit/1aec4e32af10cc90a54db1f104268694a2270043", "message": "Allow injection of Session/SessionFactory\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-04T08:02:06Z", "type": "commit"}, {"oid": "219c4505dba96fdf3e33c53dca3562854a171a6f", "url": "https://github.com/quarkusio/quarkus/commit/219c4505dba96fdf3e33c53dca3562854a171a6f", "message": "Test injection of a Hibernate ORM Session\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-04T08:02:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2NTk3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13694#discussion_r535965976", "bodyText": "ok that's interesting. Didn't expect to be able to combine PersistenceUnit on Session, but it's nice.", "author": "Sanne", "createdAt": "2020-12-04T09:41:17Z", "path": "extensions/hibernate-orm/deployment/src/test/java/io/quarkus/hibernate/orm/multiplepersistenceunits/MultiplePersistenceUnitsCdiSessionTest.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package io.quarkus.hibernate.orm.multiplepersistenceunits;\n+\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import javax.inject.Inject;\n+import javax.transaction.Transactional;\n+\n+import org.hibernate.Session;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.hibernate.orm.PersistenceUnit;\n+import io.quarkus.hibernate.orm.multiplepersistenceunits.model.config.DefaultEntity;\n+import io.quarkus.hibernate.orm.multiplepersistenceunits.model.config.inventory.Plane;\n+import io.quarkus.hibernate.orm.multiplepersistenceunits.model.config.user.User;\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class MultiplePersistenceUnitsCdiSessionTest {\n+\n+    @RegisterExtension\n+    static QuarkusUnitTest runner = new QuarkusUnitTest()\n+            .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class)\n+                    .addClass(DefaultEntity.class)\n+                    .addClass(User.class)\n+                    .addClass(Plane.class)\n+                    .addAsResource(\"application-multiple-persistence-units.properties\", \"application.properties\"));\n+\n+    @Inject\n+    Session defaultSession;\n+\n+    @Inject\n+    @PersistenceUnit(\"users\")\n+    Session usersSession;", "originalCommit": "219c4505dba96fdf3e33c53dca3562854a171a6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk3MDE0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/13694#discussion_r535970145", "bodyText": "This is Quarkus' own PersistenceUnit annotation, io.quarkus.hibernate.orm.PersistenceUnit. With the standard annotations you have to use @PersistenceContext; see MultiplePersistenceUnitsResourceInjectionSessionTest or SinglePersistenceUnitResourceInjectionSessionTest.", "author": "yrodiere", "createdAt": "2020-12-04T09:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2NTk3Ng=="}], "type": "inlineReview", "revised_code": null}]}