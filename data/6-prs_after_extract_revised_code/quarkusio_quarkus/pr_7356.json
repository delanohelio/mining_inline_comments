{"pr_number": 7356, "pr_title": "Create openshift wrapper extension.", "pr_createdAt": "2020-02-22T09:05:31Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7356", "timeline": [{"oid": "1c64f47daef0b977a8d3a2ea9715125b4a4eb723", "url": "https://github.com/quarkusio/quarkus/commit/1c64f47daef0b977a8d3a2ea9715125b4a4eb723", "message": "feat: Create openshift wrapper extension.", "committedDate": "2020-02-22T09:06:52Z", "type": "forcePushed"}, {"oid": "7dd19ad520b9bda0219a2ed8131491b409cf1ab2", "url": "https://github.com/quarkusio/quarkus/commit/7dd19ad520b9bda0219a2ed8131491b409cf1ab2", "message": "feat: Add an openshift wrapper extension.", "committedDate": "2020-02-22T09:10:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk5NTM1MQ==", "url": "https://github.com/quarkusio/quarkus/pull/7356#discussion_r382995351", "bodyText": "how does these three methods interact....feels like it will be nondeterministic on who \"wins\" ?", "author": "maxandersen", "createdAt": "2020-02-23T11:27:23Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -74,6 +75,33 @@\n \n     private static final String OUTPUT_ARTIFACT_FORMAT = \"%s%s.jar\";\n \n+    @BuildStep", "originalCommit": "7dd19ad520b9bda0219a2ed8131491b409cf1ab2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMzMTk5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7356#discussion_r383331993", "bodyText": "There is  not a race here.\nWe just produce build items,  based on the configuration properties that are found.", "author": "iocanel", "createdAt": "2020-02-24T15:27:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk5NTM1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5f620b5b3bd875f397c8bfb87d6543c631778fc8", "chunk": "diff --git a/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java b/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java\nindex 63e1c3eda1..4736232111 100644\n--- a/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java\n+++ b/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java\n\n@@ -66,13 +87,8 @@ import io.quarkus.kubernetes.spi.KubernetesRoleBuildItem;\n class KubernetesProcessor {\n \n     private static final String PROPERTY_PREFIX = \"dekorate.\";\n-    private static final Set<String> ALLOWED_GENERATORS = new HashSet(\n-            Arrays.asList(\"kubernetes\", \"openshift\", \"knative\", \"docker\", \"s2i\"));\n-    private static final Set<String> IMAGE_GENERATORS = new HashSet(Arrays.asList(\"docker\", \"s2i\"));\n-\n     private static final String DOCKER_REGISTRY_PROPERTY = PROPERTY_PREFIX + \"docker.registry\";\n     private static final String APP_GROUP_PROPERTY = \"app.group\";\n-\n     private static final String OUTPUT_ARTIFACT_FORMAT = \"%s%s.jar\";\n \n     @BuildStep\n"}}, {"oid": "5f620b5b3bd875f397c8bfb87d6543c631778fc8", "url": "https://github.com/quarkusio/quarkus/commit/5f620b5b3bd875f397c8bfb87d6543c631778fc8", "message": "feat: Add an openshift wrapper extension.", "committedDate": "2020-02-24T15:25:35Z", "type": "forcePushed"}, {"oid": "e33508038a4a396f1d1d0a149b5ab2921a821a04", "url": "https://github.com/quarkusio/quarkus/commit/e33508038a4a396f1d1d0a149b5ab2921a821a04", "message": "feat: Add an openshift wrapper extension.", "committedDate": "2020-02-24T15:37:13Z", "type": "forcePushed"}, {"oid": "3aec75ea7fa4f803653eb2a87366a98fd6b3dc2c", "url": "https://github.com/quarkusio/quarkus/commit/3aec75ea7fa4f803653eb2a87366a98fd6b3dc2c", "message": "feat: Add an openshift wrapper extension.", "committedDate": "2020-02-24T21:48:30Z", "type": "forcePushed"}, {"oid": "fa0a16671dcb4a35fe27c669db9ad4377461626d", "url": "https://github.com/quarkusio/quarkus/commit/fa0a16671dcb4a35fe27c669db9ad4377461626d", "message": "doc: Add doc for Openshift extension.", "committedDate": "2020-02-25T11:27:12Z", "type": "forcePushed"}, {"oid": "6293e32458a165c6903de6c8df146ad495eb06a9", "url": "https://github.com/quarkusio/quarkus/commit/6293e32458a165c6903de6c8df146ad495eb06a9", "message": "doc: Add doc for Openshift extension.", "committedDate": "2020-02-25T21:04:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMxOTY0OA==", "url": "https://github.com/quarkusio/quarkus/pull/7356#discussion_r384319648", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //Hanlde custom s2i builder images\n          \n          \n            \n                    //Handle custom s2i builder images", "author": "geoand", "createdAt": "2020-02-26T07:49:09Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -374,7 +399,7 @@ private void applyBuildItems(Session session,\n         }\n \n         //Hanlde custom s2i builder images", "originalCommit": "6293e32458a165c6903de6c8df146ad495eb06a9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a5163f9652c0f617754e47884efc306a2acf9c07", "chunk": "diff --git a/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java b/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java\nindex 60261fa54b..f33a37accb 100644\n--- a/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java\n+++ b/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java\n\n@@ -398,8 +398,8 @@ class KubernetesProcessor {\n                     .forEach(r -> session.resources().decorate(new AddRoleBindingResourceDecorator(r.getRole())));\n         }\n \n-        //Hanlde custom s2i builder images\n-        if (deploymentTargets.contains(\"openshift\")) {\n+        //Handle custom s2i builder images\n+        if (deploymentTargets.contains(OPENSHIFT)) {\n             baseImageBuildItem.map(BaseImageInfoBuildItem::getImage).ifPresent(builderImage -> {\n                 S2iBuildConfig s2iBuildConfig = new S2iBuildConfigBuilder().withBuilderImage(builderImage).build();\n                 session.resources().decorate(OPENSHIFT, new AddBuilderImageStreamResourceDecorator(s2iBuildConfig));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMyMDAzNA==", "url": "https://github.com/quarkusio/quarkus/pull/7356#discussion_r384320034", "bodyText": "This doesn't seem to be used", "author": "geoand", "createdAt": "2020-02-26T07:50:15Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesConfigUtil.java", "diffHunk": "@@ -24,13 +25,17 @@\n public class KubernetesConfigUtil {\n \n     private static final String DEKORATE_PREFIX = \"dekorate.\";\n+    private static final String QUARKUS_PREFIX = \"quarkus.\";", "originalCommit": "6293e32458a165c6903de6c8df146ad495eb06a9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a5163f9652c0f617754e47884efc306a2acf9c07", "chunk": "diff --git a/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesConfigUtil.java b/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesConfigUtil.java\nindex a87f3d0445..1a28d56e96 100644\n--- a/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesConfigUtil.java\n+++ b/extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesConfigUtil.java\n\n@@ -25,11 +27,10 @@ import io.dekorate.utils.Strings;\n public class KubernetesConfigUtil {\n \n     private static final String DEKORATE_PREFIX = \"dekorate.\";\n-    private static final String QUARKUS_PREFIX = \"quarkus.\";\n \n     private static final Set<String> ALLOWED_GENERATORS = new HashSet<>(\n-            Arrays.asList(\"kubernetes\", \"openshift\", \"knative\", \"docker\", \"s2i\"));\n-    private static final Set<String> IMAGE_GENERATORS = new HashSet<>(Arrays.asList(\"docker\", \"s2i\"));\n+            Arrays.asList(KUBERNETES, OPENSHIFT, KNATIVE, DOCKER, S2I));\n+    private static final Set<String> IMAGE_GENERATORS = new HashSet<>(Arrays.asList(DOCKER, S2I));\n \n     public static List<String> getDeploymentTargets() {\n         Config config = ConfigProvider.getConfig();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMyMTE1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7356#discussion_r384321156", "bodyText": "Is this correct?", "author": "geoand", "createdAt": "2020-02-26T07:53:31Z", "path": "extensions/kubernetes/openshift/deployment/src/main/java/io/quarkus/openshift/deployment/Constants.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package io.quarkus.openshift.deployment;\n+\n+public class Constants {\n+    static final String OPENSHIFT = \"openshift\";\n+    static final String DEPLOYMENT_CONFIG = \"openshift\";", "originalCommit": "6293e32458a165c6903de6c8df146ad495eb06a9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "a5163f9652c0f617754e47884efc306a2acf9c07", "url": "https://github.com/quarkusio/quarkus/commit/a5163f9652c0f617754e47884efc306a2acf9c07", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-26T08:27:03Z", "type": "forcePushed"}, {"oid": "0947b8daea619da642909046acaaa7aac48833ca", "url": "https://github.com/quarkusio/quarkus/commit/0947b8daea619da642909046acaaa7aac48833ca", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-26T08:42:52Z", "type": "forcePushed"}, {"oid": "59d15c601202c4177fca2ee7308423b2779bd198", "url": "https://github.com/quarkusio/quarkus/commit/59d15c601202c4177fca2ee7308423b2779bd198", "message": "feat: Openshift resources labeled with app/runtime", "committedDate": "2020-02-26T11:18:16Z", "type": "forcePushed"}, {"oid": "e79e775a71d012e3e79a5f40accbd734da880500", "url": "https://github.com/quarkusio/quarkus/commit/e79e775a71d012e3e79a5f40accbd734da880500", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-26T11:26:20Z", "type": "forcePushed"}, {"oid": "623f3f96afb82cd25064d8096f3550fdfed2491b", "url": "https://github.com/quarkusio/quarkus/commit/623f3f96afb82cd25064d8096f3550fdfed2491b", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-27T07:02:40Z", "type": "forcePushed"}, {"oid": "350cc674d2aeedb07237caaf92120e2c3e945a07", "url": "https://github.com/quarkusio/quarkus/commit/350cc674d2aeedb07237caaf92120e2c3e945a07", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-27T07:34:59Z", "type": "forcePushed"}, {"oid": "8f8588fe27b2ede08eb68d651e694f4ea2b98376", "url": "https://github.com/quarkusio/quarkus/commit/8f8588fe27b2ede08eb68d651e694f4ea2b98376", "message": "feat: add an openshift wrapper extension", "committedDate": "2020-02-27T07:37:44Z", "type": "commit"}, {"oid": "08fbafd0790227a6afd572adb2cbe5d8efacc2ea", "url": "https://github.com/quarkusio/quarkus/commit/08fbafd0790227a6afd572adb2cbe5d8efacc2ea", "message": "feat: Openshift resources labeled with app/runtime", "committedDate": "2020-02-27T07:37:47Z", "type": "commit"}, {"oid": "c6bcc8c2d4da5bbcdc68bebfd806461de4feaf39", "url": "https://github.com/quarkusio/quarkus/commit/c6bcc8c2d4da5bbcdc68bebfd806461de4feaf39", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-27T07:37:47Z", "type": "commit"}, {"oid": "c6bcc8c2d4da5bbcdc68bebfd806461de4feaf39", "url": "https://github.com/quarkusio/quarkus/commit/c6bcc8c2d4da5bbcdc68bebfd806461de4feaf39", "message": "doc: Add doc for openshift extension", "committedDate": "2020-02-27T07:37:47Z", "type": "forcePushed"}]}