{"pr_number": 13971, "pr_title": "Support creation of user components through Arc in Hibernate ORM and Hibernate Search", "pr_createdAt": "2020-12-18T15:26:30Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13971", "timeline": [{"oid": "69d88bce956bd6df0d674266c1f6e134853ec2b8", "url": "https://github.com/quarkusio/quarkus/commit/69d88bce956bd6df0d674266c1f6e134853ec2b8", "message": "Support instantiation of JPA AttributeConverters through Arc\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-18T13:57:05Z", "type": "commit"}, {"oid": "58728c42fc96edf2f5e08d057c247886a79c8724", "url": "https://github.com/quarkusio/quarkus/commit/58728c42fc96edf2f5e08d057c247886a79c8724", "message": "Test ORM attribute converters\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-18T13:57:05Z", "type": "commit"}, {"oid": "c8354dbf243b5e868704e968b4654afbe666f79a", "url": "https://github.com/quarkusio/quarkus/commit/c8354dbf243b5e868704e968b4654afbe666f79a", "message": "Support bean references in Hibernate Search config and remove reflection registration\n\nWe don't need to register reflection since these components are created\nduring static init.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-18T14:10:57Z", "type": "commit"}, {"oid": "948c0ddd68969e2e2393f61d115661b0d559b52f", "url": "https://github.com/quarkusio/quarkus/commit/948c0ddd68969e2e2393f61d115661b0d559b52f", "message": "Test various types of bean references in Hibernate Search configuration\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-18T14:10:57Z", "type": "commit"}, {"oid": "eab11d830faddf1612d92d467d9ae11844cab052", "url": "https://github.com/quarkusio/quarkus/commit/eab11d830faddf1612d92d467d9ae11844cab052", "message": "Document bean references for Hibernate Search configuration\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-18T15:23:38Z", "type": "commit"}, {"oid": "67bfcb026da3b2d4beabe96620d9a2bf1516b5bd", "url": "https://github.com/quarkusio/quarkus/commit/67bfcb026da3b2d4beabe96620d9a2bf1516b5bd", "message": "Mark the Hibernate Search extension as stable\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-18T15:25:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY5NzU2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/13971#discussion_r546697561", "bodyText": "Ok, I'm not entirely sure this will be safe enough and if, at some point, we will have to release the beans and then reinitialize them. Let's get this in and we will see if it ends up being an issue.", "author": "gsmet", "createdAt": "2020-12-21T13:12:04Z", "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/cdi/QuarkusManagedBeanRegistry.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package io.quarkus.hibernate.orm.runtime.cdi;\n+\n+import org.hibernate.resource.beans.container.spi.BeanContainer;\n+import org.hibernate.resource.beans.container.spi.ContainedBean;\n+import org.hibernate.resource.beans.internal.FallbackBeanInstanceProducer;\n+import org.hibernate.resource.beans.spi.ManagedBean;\n+import org.hibernate.resource.beans.spi.ManagedBeanRegistry;\n+\n+import io.quarkus.arc.Arc;\n+\n+/**\n+ * A replacement for ManagedBeanRegistryImpl that:\n+ * <ul>\n+ * <li>forces the use of QuarkusManagedBeanRegistry,\n+ * which works with Arc and respects configured scopes when instantiating CDI beans.</li>\n+ * <li>is not stoppable and leaves the release of beans to {@link QuarkusArcBeanContainer},\n+ * so that the bean container and its beans can be reused between static init and runtime init,\n+ * even though we stop Hibernate ORM services after the end of static init.</li>", "originalCommit": "69d88bce956bd6df0d674266c1f6e134853ec2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}