{"pr_number": 11950, "pr_title": "Adding fetch configuration option to hibernate-orm module", "pr_createdAt": "2020-09-07T17:56:01Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11950", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzAyMA==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484557020", "bodyText": "Detail: This Javadoc comment should have Quarkus' @asciidoclet tag, since it uses Asciidoc markup here for the 0 literal. I know this was copy-pasted from my own contribution (sorry about that!).", "author": "knutwannheden", "createdAt": "2020-09-07T20:02:30Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java", "diffHunk": "@@ -381,4 +395,30 @@ public boolean isAnyPropertySet() {\n         @ConfigItem\n         public OptionalLong objectCount;\n     }\n+\n+    @ConfigGroup\n+    public static class HibernateOrmConfigPersistenceUnitFetch {\n+        /**\n+         * The size of the batches used when loading entities and collections.\n+         *\n+         * `-1` means batch loading is disabled. This is the default.\n+         *\n+         * @asciidoclet\n+         */\n+        @ConfigItem(defaultValue = \"-1\")\n+        public int batchFetchSize;\n+\n+        /**\n+         * The maximum depth of outer join fetch tree for single-ended associations (one-to-one, many-to-one).\n+         *\n+         * A `0` disables default outer join fetching.", "originalCommit": "0a2fa83d4aa299e9b3bb7c6a6ae5be14948359bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2NTYwNw==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484565607", "bodyText": "Done.", "author": "mkrzywanski", "createdAt": "2020-09-07T20:57:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTAxMw==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484569013", "bodyText": "Detail: This Javadoc comment should have Quarkus' @asciidoclet tag, since it uses Asciidoc markup here for the 0 literal. I know this was copy-pasted from my own contribution (sorry about that!).\n\nI believe the 0 literal should be handled without the need for the @asciidoclet tag. The tag is to be used in cases where we want the javadoc comments to be written as-is and not parsed ( e.g considered as valid asciidoc input that make use of various asciidoc stylings etc ) e.g \n  \n    \n      quarkus/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n    \n    \n        Lines 38 to 71\n      in\n      499992e\n    \n    \n    \n    \n\n        \n          \n               /** \n        \n\n        \n          \n                * Name of the file containing the SQL statements to execute when Hibernate ORM starts. \n        \n\n        \n          \n                * Its default value differs depending on the Quarkus launch mode: \n        \n\n        \n          \n                * \n        \n\n        \n          \n                * * In dev and test modes, it defaults to `import.sql`. \n        \n\n        \n          \n                *   Simply add an `import.sql` file in the root of your resources directory \n        \n\n        \n          \n                *   and it will be picked up without having to set this property. \n        \n\n        \n          \n                *   Pass `no-file` to force Hibernate ORM to ignore the SQL import file. \n        \n\n        \n          \n                * * In production mode, it defaults to `no-file`. \n        \n\n        \n          \n                *   It means Hibernate ORM won't try to execute any SQL import file by default. \n        \n\n        \n          \n                *   Pass an explicit value to force Hibernate ORM to execute the SQL import file. \n        \n\n        \n          \n                * \n        \n\n        \n          \n                * If you need different SQL statements between dev mode, test (`@QuarkusTest`) and in production, use Quarkus \n        \n\n        \n          \n                * https://quarkus.io/guides/config#configuration-profiles[configuration profiles facility]. \n        \n\n        \n          \n                * \n        \n\n        \n          \n                * [source,property] \n        \n\n        \n          \n                * .application.properties \n        \n\n        \n          \n                * ---- \n        \n\n        \n          \n                * %dev.quarkus.hibernate-orm.sql-load-script = import-dev.sql \n        \n\n        \n          \n                * %test.quarkus.hibernate-orm.sql-load-script = import-test.sql \n        \n\n        \n          \n                * %prod.quarkus.hibernate-orm.sql-load-script = no-file \n        \n\n        \n          \n                * ---- \n        \n\n        \n          \n                * \n        \n\n        \n          \n                * [NOTE] \n        \n\n        \n          \n                * ==== \n        \n\n        \n          \n                * Quarkus supports `.sql` file with SQL statements or comments spread over multiple lines. \n        \n\n        \n          \n                * Each SQL statement must be terminated by a semicolon. \n        \n\n        \n          \n                * ==== \n        \n\n        \n          \n                * \n        \n\n        \n          \n                * @asciidoclet \n        \n\n        \n          \n                */ \n        \n\n        \n          \n               // @formatter:on \n        \n\n        \n          \n               @ConfigItem(defaultValueDocumentation = \"import.sql in DEV, TEST ; no-file otherwise\") \n        \n\n        \n          \n               public Optional<String> sqlLoadScript; \n        \n    \n  \n\n.", "author": "machi1990", "createdAt": "2020-09-07T21:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc5NDY1Mg==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484794652", "bodyText": "Unfortunately I am not that familiar with asciidoc. Do you think I should remove the @asciidoc tags as literals should be parsed without it?", "author": "mkrzywanski", "createdAt": "2020-09-08T09:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxNjI2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484816263", "bodyText": "Yes, removing the @asciidoclet should have no effect. But before editing it, let's wait for @Sanne and @gsmet full functional / configuration review first. This way we'll avoid round trips.", "author": "machi1990", "createdAt": "2020-09-08T10:30:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0MDU2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484840563", "bodyText": "I suppose if @asciidoclet is removed the  `0` should be changed to {@code 0}.", "author": "knutwannheden", "createdAt": "2020-09-08T11:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzAyMA=="}], "type": "inlineReview", "revised_code": {"commit": "82c61e2ae2c8fdc3db70e470a6526c608f4f1df8", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\nindex 8caea2658f..7b5d768ee8 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n\n@@ -406,18 +407,20 @@ public class HibernateOrmConfigPersistenceUnit {\n          * @asciidoclet\n          */\n         @ConfigItem(defaultValue = \"-1\")\n-        public int batchFetchSize;\n+        public int batchSize;\n \n         /**\n          * The maximum depth of outer join fetch tree for single-ended associations (one-to-one, many-to-one).\n          *\n          * A `0` disables default outer join fetching.\n+         * \n+         * @asciidoclet\n          */\n         @ConfigItem\n-        public OptionalInt maxFetchDepth;\n+        public OptionalInt maxDepth;\n \n         public boolean isAnyPropertySet() {\n-            return batchFetchSize > 0 || maxFetchDepth.isPresent();\n+            return batchSize > 0 || maxDepth.isPresent();\n         }\n \n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0MTc4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484841786", "bodyText": "Does this make the property name .fetch.batch-fetch-size? Can we eliminate the redundancy and call it .fetch.batch-size?", "author": "gavinking", "createdAt": "2020-09-08T11:21:30Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java", "diffHunk": "@@ -381,4 +396,32 @@ public boolean isAnyPropertySet() {\n         @ConfigItem\n         public OptionalLong objectCount;\n     }\n+\n+    @ConfigGroup\n+    public static class HibernateOrmConfigPersistenceUnitFetch {\n+        /**\n+         * The size of the batches used when loading entities and collections.\n+         *\n+         * `-1` means batch loading is disabled. This is the default.\n+         *\n+         * @asciidoclet\n+         */\n+        @ConfigItem(defaultValue = \"-1\")\n+        public int batchFetchSize;", "originalCommit": "499992e3b73cedc14a668646fb4966f1b3502701", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0NTU5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484845595", "bodyText": "Yes, new properties' names would be .fetch.batch-fetch-size and .fetch.max-fetch-depth. I am okay with removing the fetch keyword as far as redundancy is concerned. Shall we also do the same for maxFetchDepth so that it is .fetch.max-depth ?", "author": "mkrzywanski", "createdAt": "2020-09-08T11:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0MTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg2NTUyNg==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r484865526", "bodyText": "Right, I mean for both of them.", "author": "gavinking", "createdAt": "2020-09-08T12:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0MTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2Mjk4MA==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r487862980", "bodyText": "@mkrzywanski can you adjust the names and squash everything?\nThanks!", "author": "gsmet", "createdAt": "2020-09-14T12:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0MTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxODUxMA==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r488218510", "bodyText": "@gsmet done.", "author": "mkrzywanski", "createdAt": "2020-09-14T21:03:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg0MTc4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "82c61e2ae2c8fdc3db70e470a6526c608f4f1df8", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\nindex f5e249d8ee..7b5d768ee8 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n\n@@ -407,7 +407,7 @@ public class HibernateOrmConfigPersistenceUnit {\n          * @asciidoclet\n          */\n         @ConfigItem(defaultValue = \"-1\")\n-        public int batchFetchSize;\n+        public int batchSize;\n \n         /**\n          * The maximum depth of outer join fetch tree for single-ended associations (one-to-one, many-to-one).\n"}}, {"oid": "82c61e2ae2c8fdc3db70e470a6526c608f4f1df8", "url": "https://github.com/quarkusio/quarkus/commit/82c61e2ae2c8fdc3db70e470a6526c608f4f1df8", "message": "adding fetch configuration option to hibernate-orm module", "committedDate": "2020-09-14T13:59:25Z", "type": "forcePushed"}, {"oid": "68a1dd2f24449a732555adef69217ce1083b4df7", "url": "https://github.com/quarkusio/quarkus/commit/68a1dd2f24449a732555adef69217ce1083b4df7", "message": "adding fetch configuration option to hibernate-orm module", "committedDate": "2020-09-14T14:52:20Z", "type": "forcePushed"}, {"oid": "6f0e2b740199bd8248d4a45feec3f15777bf6a44", "url": "https://github.com/quarkusio/quarkus/commit/6f0e2b740199bd8248d4a45feec3f15777bf6a44", "message": "adding fetch configuration option to hibernate-orm module", "committedDate": "2020-09-14T18:41:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwOTQyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r491209425", "bodyText": "This shouldn't be there.", "author": "gsmet", "createdAt": "2020-09-18T21:54:55Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java", "diffHunk": "@@ -194,6 +208,7 @@ public boolean isAnyPropertySet() {\n          * JavaDoc].\n          *\n          * [NOTE]\n+         *", "originalCommit": "6f0e2b740199bd8248d4a45feec3f15777bf6a44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIxMDkxNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11950#discussion_r491210915", "bodyText": "I fixed it.", "author": "gsmet", "createdAt": "2020-09-18T21:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwOTQyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "9ea214b03f2f606a319bc32688b7a98821dd2724", "chunk": "diff --git a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\nindex 7b5d768ee8..d091bfc8c1 100644\n--- a/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n+++ b/extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfigPersistenceUnit.java\n\n@@ -208,7 +208,6 @@ public class HibernateOrmConfigPersistenceUnit {\n          * JavaDoc].\n          *\n          * [NOTE]\n-         *\n          * ====\n          * Not all the dialects are supported in GraalVM native executables: we currently provide driver extensions for\n          * PostgreSQL,\n"}}, {"oid": "9ea214b03f2f606a319bc32688b7a98821dd2724", "url": "https://github.com/quarkusio/quarkus/commit/9ea214b03f2f606a319bc32688b7a98821dd2724", "message": "Add fetch configuration options to Hibernate ORM extension", "committedDate": "2020-09-18T21:57:04Z", "type": "commit"}, {"oid": "9ea214b03f2f606a319bc32688b7a98821dd2724", "url": "https://github.com/quarkusio/quarkus/commit/9ea214b03f2f606a319bc32688b7a98821dd2724", "message": "Add fetch configuration options to Hibernate ORM extension", "committedDate": "2020-09-18T21:57:04Z", "type": "forcePushed"}]}