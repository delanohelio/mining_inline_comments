{"pr_number": 9105, "pr_title": "Allow transformation from all archives", "pr_createdAt": "2020-05-06T07:25:14Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9105", "timeline": [{"oid": "4883b984b9743006c12e3022a3ffc562d79c45c3", "url": "https://github.com/quarkusio/quarkus/commit/4883b984b9743006c12e3022a3ffc562d79c45c3", "message": "Allow transformation from all archives\n\nFixes #9050", "committedDate": "2020-05-07T02:40:34Z", "type": "commit"}, {"oid": "4883b984b9743006c12e3022a3ffc562d79c45c3", "url": "https://github.com/quarkusio/quarkus/commit/4883b984b9743006c12e3022a3ffc562d79c45c3", "message": "Allow transformation from all archives\n\nFixes #9050", "committedDate": "2020-05-07T02:40:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIwNzIxNw==", "url": "https://github.com/quarkusio/quarkus/pull/9105#discussion_r421207217", "bodyText": "@aloubyansky we really need to look at how paths are passed into Quarkus bootstrap, at the moment it is super confusing. This is casing problems in the prod mode tests because it is being added from the integration tests pom.xml, so there are two roots. Because the QuarkusClassLoader creation code expects a root to still be a single file they end up missing from the ClassLoader.", "author": "stuartwdouglas", "createdAt": "2020-05-07T02:47:43Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/QuarkusAugmentor.java", "diffHunk": "@@ -131,12 +131,13 @@ public BuildResult run() throws Exception {\n                 rootBuilder.setArchiveLocation(root);\n             } else {\n                 rootBuilder.setArchiveLocation(effectiveModel.getAppArtifact().getPaths().iterator().next());\n+\n+                effectiveModel.getAppArtifact().getPaths().forEach(p -> {", "originalCommit": "4883b984b9743006c12e3022a3ffc562d79c45c3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI5Mjc4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9105#discussion_r421292786", "bodyText": "This reminds me - do we check multiple occurences of a class on the class path?", "author": "mkouba", "createdAt": "2020-05-07T07:24:18Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/steps/ClassTransformingBuildStep.java", "diffHunk": "@@ -66,46 +67,46 @@ TransformedClassesBuildItem handleClassTransformation(List<BytecodeTransformerBu\n             for (Map.Entry<String, List<BiFunction<String, ClassVisitor, ClassVisitor>>> entry : bytecodeTransformers\n                     .entrySet()) {\n                 String className = entry.getKey();\n-                Set<String> constValues = constScanning.get(className);\n-                ApplicationArchive archive = appArchives.containingArchive(entry.getKey());\n-                if (archive != null) {\n+                String classFileName = className.replace(\".\", \"/\") + \".class\";\n+                List<ClassPathElement> archives = cl.getElementsWithResource(classFileName);", "originalCommit": "4883b984b9743006c12e3022a3ffc562d79c45c3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}