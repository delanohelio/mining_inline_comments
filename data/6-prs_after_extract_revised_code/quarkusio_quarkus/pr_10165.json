{"pr_number": 10165, "pr_title": "Warn when a spring-web class is not annotated with @RestController", "pr_createdAt": "2020-06-22T15:43:26Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10165", "timeline": [{"oid": "94d857325d229612a7b6887d7ad9e2f4b02d57ba", "url": "https://github.com/quarkusio/quarkus/commit/94d857325d229612a7b6887d7ad9e2f4b02d57ba", "message": "Warn when a spring-web class is not annotated with @RestController\n\nFixes: #10164", "committedDate": "2020-06-22T15:42:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3ODk3NA==", "url": "https://github.com/quarkusio/quarkus/pull/10165#discussion_r443678974", "bodyText": "Sounds like we should fail the build instead? Thinking how confused would I be if the app started and the endpoints would not be there.", "author": "gastaldi", "createdAt": "2020-06-22T16:22:06Z", "path": "extensions/spring-web/deployment/src/main/java/io/quarkus/spring/web/deployment/SpringWebProcessor.java", "diffHunk": "@@ -190,6 +195,35 @@ public void accept(ResteasyDeployment resteasyDeployment) {\n         reflectiveClass.produce(new ReflectiveClassBuildItem(true, false, false, SpringResourceBuilder.class.getName()));\n     }\n \n+    /**\n+     * Make sure the controllers have the proper annotation and warn if not\n+     */\n+    private void validateControllers(BeanArchiveIndexBuildItem beanArchiveIndexBuildItem) {\n+        Collection<AnnotationInstance> annotations = beanArchiveIndexBuildItem.getIndex().getAnnotations(REQUEST_MAPPING);\n+        Set<DotName> classesWithoutRestController = new HashSet<>();\n+        for (AnnotationInstance annotation : annotations) {\n+            ClassInfo targetClass;\n+            if (annotation.target().kind() == AnnotationTarget.Kind.CLASS) {\n+                targetClass = annotation.target().asClass();\n+            } else if (annotation.target().kind() == AnnotationTarget.Kind.METHOD) {\n+                targetClass = annotation.target().asMethod().declaringClass();\n+            } else {\n+                continue;\n+            }\n+\n+            if (targetClass.classAnnotation(REST_CONTROLLER_ANNOTATION) == null) {\n+                classesWithoutRestController.add(targetClass.name());\n+            }\n+        }\n+\n+        if (!classesWithoutRestController.isEmpty()) {\n+            for (DotName dotName : classesWithoutRestController) {\n+                LOGGER.warn(\"Class '\" + dotName\n+                        + \"' uses '@RequestMapping' but was not annotated with '@RestContoller' and will therefore be ignored.\");", "originalCommit": "94d857325d229612a7b6887d7ad9e2f4b02d57ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY4ODcxNw==", "url": "https://github.com/quarkusio/quarkus/pull/10165#discussion_r443688717", "bodyText": "Yeah, we talked about that with @kameshsampath decided that a warning is best for now", "author": "geoand", "createdAt": "2020-06-22T16:37:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3ODk3NA=="}], "type": "inlineReview", "revised_code": null}]}