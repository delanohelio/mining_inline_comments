{"pr_number": 4960, "pr_title": "[TE] Use upper and lower bounds as predicted for threshold algorithm", "pr_createdAt": "2020-01-06T06:03:24Z", "pr_url": "https://github.com/apache/pinot/pull/4960", "timeline": [{"oid": "9c371b4b2aa3ab7c2cfe4f0c7c131ca467b2dcce", "url": "https://github.com/apache/pinot/commit/9c371b4b2aa3ab7c2cfe4f0c7c131ca467b2dcce", "message": "[TE] Use upper and lower bounds as predicted for threshold algorithm", "committedDate": "2020-01-06T05:59:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ3MzIwNw==", "url": "https://github.com/apache/pinot/pull/4960#discussion_r363473207", "bodyText": "Why we want to change the baseline value?\nIf it is threshold algorithm we should not show upper/lower bounds.\nPlease take a look at this doc: https://docs.google.com/document/d/12bE6e_fIbk3pp0oPCrOHOPFid4NEMguZ-dF3IVjF3xQ/edit", "author": "xiaohui-sun", "createdAt": "2020-01-06T20:41:06Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/components/ThresholdRuleDetector.java", "diffHunk": "@@ -101,15 +100,24 @@ public TimeSeries computePredictedTimeSeries(MetricSlice slice) {\n     InputData data =\n         this.dataFetcher.fetchData(new InputDataSpec().withTimeseriesSlices(Collections.singletonList(slice)));\n     DataFrame df = data.getTimeseries().get(slice);\n-    return TimeSeries.fromDataFrame(constructThresholdBoundaries(df));\n+    return TimeSeries.fromDataFrame(constructBaselineAndBoundaries(df));\n   }\n \n-  private DataFrame constructThresholdBoundaries(DataFrame df) {\n+  /**\n+   * Populate the dataframe with upper/lower boundaries and baseline\n+   */\n+  private DataFrame constructBaselineAndBoundaries(DataFrame df) {\n+    // Set default baseline as the actual value\n+    df.addSeries(COL_VALUE, df.getDoubles(COL_CURRENT));\n     if (!Double.isNaN(this.min)) {\n       df.addSeries(COL_LOWER_BOUND, DoubleSeries.fillValues(df.size(), this.min));\n+      // set baseline value as the lower bound when actual value across below the mark\n+      df.mapInPlace(DoubleSeries.MAX, COL_VALUE, COL_LOWER_BOUND, COL_VALUE);", "originalCommit": "9c371b4b2aa3ab7c2cfe4f0c7c131ca467b2dcce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYyMDgxMA==", "url": "https://github.com/apache/pinot/pull/4960#discussion_r363620810", "bodyText": "Why we want to change the baseline value?\nI updated the description. Pls take a look there. This is addressing user ticket APA-11365. This PR is not proposing any changes to upper/lower bounds.", "author": "akshayrai", "createdAt": "2020-01-07T07:31:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ3MzIwNw=="}], "type": "inlineReview", "revised_code": null}]}