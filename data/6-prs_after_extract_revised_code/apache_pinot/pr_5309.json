{"pr_number": 5309, "pr_title": "Decouple Schema from RecordReader and StreamMessageDecoder", "pr_createdAt": "2020-04-27T20:46:21Z", "pr_url": "https://github.com/apache/pinot/pull/5309", "timeline": [{"oid": "14ffea1dd39d38d18b018c29d62d72b3c12e5065", "url": "https://github.com/apache/pinot/commit/14ffea1dd39d38d18b018c29d62d72b3c12e5065", "message": "Decouple Schema from RecordReader and StreamMessageDecoder\n\nRecordReader and StreamMessageDecoder is the entry point for batch and streaming data ingestion. They are expected to be implemented and plugged to provide customized format support.\nTo make the abstraction more crispy and easier to understand, remove the Schema and replace it with fields to read so that users do not need to worry about extracting fields from the Pinot schema when adding a new format.", "committedDate": "2020-04-27T21:59:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIwODAwMA==", "url": "https://github.com/apache/pinot/pull/5309#discussion_r416208000", "bodyText": "please remove this comment I had added to javadocs of all Decoder implementations regarding not using schema", "author": "npawar", "createdAt": "2020-04-27T23:04:17Z", "path": "pinot-plugins/pinot-stream-ingestion/pinot-kafka-base/src/main/java/org/apache/pinot/plugin/stream/kafka/KafkaJSONMessageDecoder.java", "diffHunk": "@@ -41,12 +40,13 @@\n public class KafkaJSONMessageDecoder implements StreamMessageDecoder<byte[]> {", "originalCommit": "14ffea1dd39d38d18b018c29d62d72b3c12e5065", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e2c1338abc7fcd54ec64244fbc4dd04a83df0b7a", "chunk": "diff --git a/pinot-plugins/pinot-stream-ingestion/pinot-kafka-base/src/main/java/org/apache/pinot/plugin/stream/kafka/KafkaJSONMessageDecoder.java b/pinot-plugins/pinot-stream-ingestion/pinot-kafka-base/src/main/java/org/apache/pinot/plugin/stream/kafka/KafkaJSONMessageDecoder.java\nindex 66e3fa87ae..b7d50438ae 100644\n--- a/pinot-plugins/pinot-stream-ingestion/pinot-kafka-base/src/main/java/org/apache/pinot/plugin/stream/kafka/KafkaJSONMessageDecoder.java\n+++ b/pinot-plugins/pinot-stream-ingestion/pinot-kafka-base/src/main/java/org/apache/pinot/plugin/stream/kafka/KafkaJSONMessageDecoder.java\n\n@@ -34,8 +34,7 @@ import org.slf4j.LoggerFactory;\n \n \n /**\n- * An implementation of StreamMessageDecoder to read JSON records from a stream\n- * NOTE: Do not use schema in the implementation, as schema will be removed from the params\n+ * An implementation of StreamMessageDecoder to read JSON records from a stream.\n  */\n public class KafkaJSONMessageDecoder implements StreamMessageDecoder<byte[]> {\n   private static final Logger LOGGER = LoggerFactory.getLogger(KafkaJSONMessageDecoder.class);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNTIyNg==", "url": "https://github.com/apache/pinot/pull/5309#discussion_r416215226", "bodyText": "Did you leave Schema here for some backward compatibility or you missed this one? Or, because it makes sense to PinotSegmentReader to keep schema?", "author": "snleee", "createdAt": "2020-04-27T23:21:52Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/data/readers/MultiplePinotSegmentRecordReader.java", "diffHunk": "@@ -64,7 +63,7 @@ public MultiplePinotSegmentRecordReader(@Nonnull List<File> indexDirs)\n    * @param schema input schema that is a subset of the segment schema\n    * @param sortOrder a list of column names that represent the sorting order\n    */\n-  public MultiplePinotSegmentRecordReader(@Nonnull List<File> indexDirs, @Nullable Schema schema,\n+  public MultiplePinotSegmentRecordReader(List<File> indexDirs, @Nullable Schema schema,", "originalCommit": "14ffea1dd39d38d18b018c29d62d72b3c12e5065", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyNTQwNw==", "url": "https://github.com/apache/pinot/pull/5309#discussion_r416225407", "bodyText": "I kept the schema for pinot segment backed record readers because the schema is extracted from the file.", "author": "Jackie-Jiang", "createdAt": "2020-04-27T23:47:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNTIyNg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "e2c1338abc7fcd54ec64244fbc4dd04a83df0b7a", "url": "https://github.com/apache/pinot/commit/e2c1338abc7fcd54ec64244fbc4dd04a83df0b7a", "message": "Decouple Schema from RecordReader and StreamMessageDecoder\n\nRecordReader and StreamMessageDecoder is the entry point for batch and streaming data ingestion. They are expected to be implemented and plugged to provide customized format support.\nTo make the abstraction more crispy and easier to understand, remove the Schema and replace it with fields to read so that users do not need to worry about extracting fields from the Pinot schema when adding a new format.", "committedDate": "2020-04-27T23:49:16Z", "type": "commit"}, {"oid": "e2c1338abc7fcd54ec64244fbc4dd04a83df0b7a", "url": "https://github.com/apache/pinot/commit/e2c1338abc7fcd54ec64244fbc4dd04a83df0b7a", "message": "Decouple Schema from RecordReader and StreamMessageDecoder\n\nRecordReader and StreamMessageDecoder is the entry point for batch and streaming data ingestion. They are expected to be implemented and plugged to provide customized format support.\nTo make the abstraction more crispy and easier to understand, remove the Schema and replace it with fields to read so that users do not need to worry about extracting fields from the Pinot schema when adding a new format.", "committedDate": "2020-04-27T23:49:16Z", "type": "forcePushed"}]}