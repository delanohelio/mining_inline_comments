{"pr_number": 5355, "pr_title": "Remove some timeFieldSpec constructors", "pr_createdAt": "2020-05-09T00:31:15Z", "pr_url": "https://github.com/apache/pinot/pull/5355", "timeline": [{"oid": "89521318fb203cc18247218da8798fc7eb3b12b1", "url": "https://github.com/apache/pinot/commit/89521318fb203cc18247218da8798fc7eb3b12b1", "message": "Remove some TimeFieldSpec constructors", "committedDate": "2020-05-11T20:50:04Z", "type": "commit"}, {"oid": "c5ba8d9213d3f09799d04f21a518cd765f750c41", "url": "https://github.com/apache/pinot/commit/c5ba8d9213d3f09799d04f21a518cd765f750c41", "message": "Fix sdf test", "committedDate": "2020-05-11T20:50:04Z", "type": "commit"}, {"oid": "498a60e9ca456e36f5c086de5a368b9d7ecd63c6", "url": "https://github.com/apache/pinot/commit/498a60e9ca456e36f5c086de5a368b9d7ecd63c6", "message": "Fix test schema", "committedDate": "2020-05-11T20:50:04Z", "type": "commit"}, {"oid": "d213c97ddc2ffc9f83cf0d51fcf798636ce63bcf", "url": "https://github.com/apache/pinot/commit/d213c97ddc2ffc9f83cf0d51fcf798636ce63bcf", "message": "Typo in test", "committedDate": "2020-05-11T20:50:04Z", "type": "commit"}, {"oid": "c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "url": "https://github.com/apache/pinot/commit/c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "message": "Remove unnecessary setTime", "committedDate": "2020-05-11T20:50:04Z", "type": "commit"}, {"oid": "c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "url": "https://github.com/apache/pinot/commit/c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "message": "Remove unnecessary setTime", "committedDate": "2020-05-11T20:50:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM0NzE5Ng==", "url": "https://github.com/apache/pinot/pull/5355#discussion_r423347196", "bodyText": "Can you rename these variables?", "author": "Jackie-Jiang", "createdAt": "2020-05-11T22:05:58Z", "path": "pinot-common/src/test/java/org/apache/pinot/common/data/FieldSpecTest.java", "diffHunk": "@@ -132,72 +132,28 @@ public void testFieldSpec() {\n   @Test\n   public void testTimeFieldSpecConstructor() {\n     String incomingName = \"incoming\";\n-    FieldSpec.DataType incomingDataType = LONG;\n     TimeUnit incomingTimeUnit = TimeUnit.HOURS;\n     int incomingTimeUnitSize = 1;\n     TimeGranularitySpec incomingTimeGranularitySpec =\n-        new TimeGranularitySpec(incomingDataType, incomingTimeUnitSize, incomingTimeUnit, incomingName);\n+        new TimeGranularitySpec(LONG, incomingTimeUnitSize, incomingTimeUnit, incomingName);\n     String outgoingName = \"outgoing\";\n-    FieldSpec.DataType outgoingDataType = INT;\n     TimeUnit outgoingTimeUnit = TimeUnit.DAYS;\n     int outgoingTimeUnitSize = 1;\n     TimeGranularitySpec outgoingTimeGranularitySpec =\n-        new TimeGranularitySpec(outgoingDataType, outgoingTimeUnitSize, outgoingTimeUnit, outgoingName);\n+        new TimeGranularitySpec(INT, outgoingTimeUnitSize, outgoingTimeUnit, outgoingName);\n     int defaultNullValue = 17050;\n-\n-    TimeFieldSpec timeFieldSpec1 = new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnit);\n-    TimeFieldSpec timeFieldSpec2 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnit, defaultNullValue);\n-    TimeFieldSpec timeFieldSpec3 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnit, outgoingName, outgoingDataType,\n-            outgoingTimeUnit);\n-    TimeFieldSpec timeFieldSpec4 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnit, outgoingName, outgoingDataType,\n-            outgoingTimeUnit, defaultNullValue);\n-    TimeFieldSpec timeFieldSpec5 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnitSize, incomingTimeUnit);\n-    TimeFieldSpec timeFieldSpec6 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnitSize, incomingTimeUnit, defaultNullValue);\n-    TimeFieldSpec timeFieldSpec7 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnitSize, incomingTimeUnit, outgoingName,\n-            outgoingDataType, outgoingTimeUnitSize, outgoingTimeUnit);\n-    TimeFieldSpec timeFieldSpec8 =\n-        new TimeFieldSpec(incomingName, incomingDataType, incomingTimeUnitSize, incomingTimeUnit, outgoingName,\n-            outgoingDataType, outgoingTimeUnitSize, outgoingTimeUnit, defaultNullValue);\n     TimeFieldSpec timeFieldSpec9 = new TimeFieldSpec(incomingTimeGranularitySpec);", "originalCommit": "c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "370acc266f83787bab6e69e0aebfe302654dc367", "chunk": "diff --git a/pinot-common/src/test/java/org/apache/pinot/common/data/FieldSpecTest.java b/pinot-common/src/test/java/org/apache/pinot/common/data/FieldSpecTest.java\nindex 7499c8e707..b037d6bea9 100644\n--- a/pinot-common/src/test/java/org/apache/pinot/common/data/FieldSpecTest.java\n+++ b/pinot-common/src/test/java/org/apache/pinot/common/data/FieldSpecTest.java\n\n@@ -141,21 +141,12 @@ public class FieldSpecTest {\n     int outgoingTimeUnitSize = 1;\n     TimeGranularitySpec outgoingTimeGranularitySpec =\n         new TimeGranularitySpec(INT, outgoingTimeUnitSize, outgoingTimeUnit, outgoingName);\n-    int defaultNullValue = 17050;\n-    TimeFieldSpec timeFieldSpec9 = new TimeFieldSpec(incomingTimeGranularitySpec);\n-    TimeFieldSpec timeFieldSpec10 = new TimeFieldSpec(incomingTimeGranularitySpec, defaultNullValue);\n-    TimeFieldSpec timeFieldSpec11 = new TimeFieldSpec(incomingTimeGranularitySpec, outgoingTimeGranularitySpec);\n-    TimeFieldSpec timeFieldSpec12 =\n-        new TimeFieldSpec(incomingTimeGranularitySpec, outgoingTimeGranularitySpec, defaultNullValue);\n-\n-    Assert.assertNotEquals(timeFieldSpec10, timeFieldSpec9);\n-    Assert.assertNotEquals(timeFieldSpec12, timeFieldSpec11);\n-\n-    // After adding default null value.\n-    timeFieldSpec9.setDefaultNullValue(defaultNullValue);\n-    timeFieldSpec11.setDefaultNullValue(defaultNullValue);\n-    Assert.assertEquals(timeFieldSpec9, timeFieldSpec10);\n-    Assert.assertEquals(timeFieldSpec11, timeFieldSpec12);\n+    TimeFieldSpec timeFieldSpec1 = new TimeFieldSpec(incomingTimeGranularitySpec);\n+    TimeFieldSpec timeFieldSpec2 = new TimeFieldSpec(incomingTimeGranularitySpec, outgoingTimeGranularitySpec);\n+    Assert.assertNotEquals(timeFieldSpec1, timeFieldSpec2);\n+\n+    timeFieldSpec1.setOutgoingGranularitySpec(outgoingTimeGranularitySpec);\n+    Assert.assertEquals(timeFieldSpec1, timeFieldSpec2);\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1MDEwNg==", "url": "https://github.com/apache/pinot/pull/5355#discussion_r423350106", "bodyText": "We don't allow null for time, so you can remove the APIs with defaultNullValue as well", "author": "Jackie-Jiang", "createdAt": "2020-05-11T22:13:13Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/TimeFieldSpec.java", "diffHunk": "@@ -38,65 +38,6 @@ public TimeFieldSpec() {\n     super();\n   }\n \n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, TimeUnit incomingTimeUnit) {\n-    super(incomingName, incomingDataType, true);\n-    _incomingGranularitySpec = new TimeGranularitySpec(incomingDataType, incomingTimeUnit, incomingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, TimeUnit incomingTimeUnit,\n-      Object defaultNullValue) {\n-    super(incomingName, incomingDataType, true, defaultNullValue);\n-    _incomingGranularitySpec = new TimeGranularitySpec(incomingDataType, incomingTimeUnit, incomingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, TimeUnit incomingTimeUnit, String outgoingName,\n-      DataType outgoingDataType, TimeUnit outgoingTimeUnit) {\n-    super(outgoingName, outgoingDataType, true);\n-    _incomingGranularitySpec = new TimeGranularitySpec(incomingDataType, incomingTimeUnit, incomingName);\n-    _outgoingGranularitySpec = new TimeGranularitySpec(outgoingDataType, outgoingTimeUnit, outgoingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, TimeUnit incomingTimeUnit, String outgoingName,\n-      DataType outgoingDataType, TimeUnit outgoingTimeUnit, Object defaultNullValue) {\n-    super(outgoingName, outgoingDataType, true, defaultNullValue);\n-    _incomingGranularitySpec = new TimeGranularitySpec(incomingDataType, incomingTimeUnit, incomingName);\n-    _outgoingGranularitySpec = new TimeGranularitySpec(outgoingDataType, outgoingTimeUnit, outgoingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, int incomingTimeUnitSize,\n-      TimeUnit incomingTimeUnit) {\n-    super(incomingName, incomingDataType, true);\n-    _incomingGranularitySpec =\n-        new TimeGranularitySpec(incomingDataType, incomingTimeUnitSize, incomingTimeUnit, incomingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, int incomingTimeUnitSize,\n-      TimeUnit incomingTimeUnit, Object defaultNullValue) {\n-    super(incomingName, incomingDataType, true, defaultNullValue);\n-    _incomingGranularitySpec =\n-        new TimeGranularitySpec(incomingDataType, incomingTimeUnitSize, incomingTimeUnit, incomingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, int incomingTimeUnitSize,\n-      TimeUnit incomingTimeUnit, String outgoingName, DataType outgoingDataType, int outgoingTimeUnitSize,\n-      TimeUnit outgoingTimeUnit) {\n-    super(outgoingName, outgoingDataType, true);\n-    _incomingGranularitySpec =\n-        new TimeGranularitySpec(incomingDataType, incomingTimeUnitSize, incomingTimeUnit, incomingName);\n-    _outgoingGranularitySpec =\n-        new TimeGranularitySpec(outgoingDataType, outgoingTimeUnitSize, outgoingTimeUnit, outgoingName);\n-  }\n-\n-  public TimeFieldSpec(String incomingName, DataType incomingDataType, int incomingTimeUnitSize,\n-      TimeUnit incomingTimeUnit, String outgoingName, DataType outgoingDataType, int outgoingTimeUnitSize,\n-      TimeUnit outgoingTimeUnit, Object defaultNullValue) {\n-    super(outgoingName, outgoingDataType, true, defaultNullValue);\n-    _incomingGranularitySpec =\n-        new TimeGranularitySpec(incomingDataType, incomingTimeUnitSize, incomingTimeUnit, incomingName);\n-    _outgoingGranularitySpec =\n-        new TimeGranularitySpec(outgoingDataType, outgoingTimeUnitSize, outgoingTimeUnit, outgoingName);\n-  }\n-\n   public TimeFieldSpec(TimeGranularitySpec incomingGranularitySpec) {", "originalCommit": "c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1Njg3MA==", "url": "https://github.com/apache/pinot/pull/5355#discussion_r423356870", "bodyText": "done", "author": "npawar", "createdAt": "2020-05-11T22:30:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1MDEwNg=="}], "type": "inlineReview", "revised_code": {"commit": "d057f4d2d6a7063eca4db9ef768b49fee17e306a", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/TimeFieldSpec.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/TimeFieldSpec.java\nindex 8e16530fea..297b864727 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/TimeFieldSpec.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/TimeFieldSpec.java\n\n@@ -43,24 +42,12 @@ public final class TimeFieldSpec extends FieldSpec {\n     _incomingGranularitySpec = incomingGranularitySpec;\n   }\n \n-  public TimeFieldSpec(TimeGranularitySpec incomingGranularitySpec, Object defaultNullValue) {\n-    super(incomingGranularitySpec.getName(), incomingGranularitySpec.getDataType(), true, defaultNullValue);\n-    _incomingGranularitySpec = incomingGranularitySpec;\n-  }\n-\n   public TimeFieldSpec(TimeGranularitySpec incomingGranularitySpec, TimeGranularitySpec outgoingGranularitySpec) {\n     super(outgoingGranularitySpec.getName(), outgoingGranularitySpec.getDataType(), true);\n     _incomingGranularitySpec = incomingGranularitySpec;\n     _outgoingGranularitySpec = outgoingGranularitySpec;\n   }\n \n-  public TimeFieldSpec(TimeGranularitySpec incomingGranularitySpec, TimeGranularitySpec outgoingGranularitySpec,\n-      Object defaultNullValue) {\n-    super(outgoingGranularitySpec.getName(), outgoingGranularitySpec.getDataType(), true, defaultNullValue);\n-    _incomingGranularitySpec = incomingGranularitySpec;\n-    _outgoingGranularitySpec = outgoingGranularitySpec;\n-  }\n-\n   @JsonIgnore\n   @Override\n   public FieldType getFieldType() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1MDg4NQ==", "url": "https://github.com/apache/pinot/pull/5355#discussion_r423350885", "bodyText": "Conceptually this should be the incoming name", "author": "Jackie-Jiang", "createdAt": "2020-05-11T22:15:08Z", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/streams/AirlineDataStream.java", "diffHunk": "@@ -125,7 +125,7 @@ public void run() {\n             }\n \n             TimeFieldSpec spec = pinotSchema.getTimeFieldSpec();\n-            String timeColumn = spec.getIncomingTimeColumnName();\n+            String timeColumn = spec.getName();", "originalCommit": "c6a64e1c6e8c4119f299d0d6f206bdb062338a0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1NjkyMQ==", "url": "https://github.com/apache/pinot/pull/5355#discussion_r423356921", "bodyText": "changed", "author": "npawar", "createdAt": "2020-05-11T22:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1MDg4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "370acc266f83787bab6e69e0aebfe302654dc367", "chunk": "diff --git a/pinot-tools/src/main/java/org/apache/pinot/tools/streams/AirlineDataStream.java b/pinot-tools/src/main/java/org/apache/pinot/tools/streams/AirlineDataStream.java\nindex 19c5776fc3..897ca00a92 100644\n--- a/pinot-tools/src/main/java/org/apache/pinot/tools/streams/AirlineDataStream.java\n+++ b/pinot-tools/src/main/java/org/apache/pinot/tools/streams/AirlineDataStream.java\n\n@@ -125,7 +125,7 @@ public class AirlineDataStream {\n             }\n \n             TimeFieldSpec spec = pinotSchema.getTimeFieldSpec();\n-            String timeColumn = spec.getName();\n+            String timeColumn = spec.getIncomingGranularitySpec().getName();\n             message.put(timeColumn, currentTimeValue);\n \n             try {\n"}}, {"oid": "370acc266f83787bab6e69e0aebfe302654dc367", "url": "https://github.com/apache/pinot/commit/370acc266f83787bab6e69e0aebfe302654dc367", "message": "Review suggestions", "committedDate": "2020-05-11T22:26:42Z", "type": "commit"}, {"oid": "d057f4d2d6a7063eca4db9ef768b49fee17e306a", "url": "https://github.com/apache/pinot/commit/d057f4d2d6a7063eca4db9ef768b49fee17e306a", "message": "Review suggestions", "committedDate": "2020-05-11T22:29:37Z", "type": "commit"}]}