{"pr_number": 5864, "pr_title": "Fixing the race condition that segment finished before ControllerLeaderLocator created.", "pr_createdAt": "2020-08-14T09:24:41Z", "pr_url": "https://github.com/apache/pinot/pull/5864", "timeline": [{"oid": "617f76bb326e8f8f4c0c67e835996c378008100c", "url": "https://github.com/apache/pinot/commit/617f76bb326e8f8f4c0c67e835996c378008100c", "message": "Fixing the race condition that segment finished before ControllerLeaderLocator created.", "committedDate": "2020-08-14T09:14:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxNTMxNQ==", "url": "https://github.com/apache/pinot/pull/5864#discussion_r470715315", "bodyText": "ControllerLeaderLocator uses helixManager to get the controller resource status, so you need to have the helix manager connected before any leader locator functionality is invoked. So your use case will not work if the same race condition happens again.", "author": "mcvsubbu", "createdAt": "2020-08-14T16:02:38Z", "path": "pinot-server/src/main/java/org/apache/pinot/server/starter/helix/HelixServerStarter.java", "diffHunk": "@@ -363,6 +363,7 @@ public void start()\n \n     LOGGER.info(\"Initializing server instance and registering state model factory\");\n     Utils.logVersions();\n+    ControllerLeaderLocator.create(_helixManager);", "originalCommit": "617f76bb326e8f8f4c0c67e835996c378008100c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc5MjUzMw==", "url": "https://github.com/apache/pinot/pull/5864#discussion_r470792533", "bodyText": "Here we only hold a reference to helixManager\nsince we set ServerInstance::start as a addPreConnectCallback, then the server will always start after helixManager connected.", "author": "xiangfu0", "createdAt": "2020-08-14T18:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxNTMxNQ=="}], "type": "inlineReview", "revised_code": null}]}