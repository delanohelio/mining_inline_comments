{"pr_number": 6265, "pr_title": "[TE] rest-api - harleyjj/rca - add forecast as baseline option for me\u2026", "pr_createdAt": "2020-11-15T06:27:21Z", "pr_url": "https://github.com/apache/pinot/pull/6265", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwNjE4Ng==", "url": "https://github.com/apache/pinot/pull/6265#discussion_r524606186", "bodyText": "is this one used anywhere? if not I would remove it.", "author": "jihaozh", "createdAt": "2020-11-16T21:29:54Z", "path": "thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java", "diffHunk": "@@ -102,14 +121,29 @@\n   private final TimeSeriesLoader timeSeriesLoader;\n   private final MetricConfigManager metricDAO;\n   private final DatasetConfigManager datasetDAO;\n+  private final EventManager eventDAO;\n+  private final MergedAnomalyResultManager anomalyDAO;\n+  private final EvaluationManager evaluationDAO;\n+  private final DetectionPipelineLoader loader;\n+  private final DataProvider dataProvider;\n \n   public RootCauseMetricResource(ExecutorService executor, AggregationLoader aggregationLoader,\n-      TimeSeriesLoader timeSeriesLoader, MetricConfigManager metricDAO, DatasetConfigManager datasetDAO) {\n+      TimeSeriesLoader timeSeriesLoader, MetricConfigManager metricDAO, DatasetConfigManager datasetDAO,\n+      EventManager eventDAO, MergedAnomalyResultManager anomalyDAO, EvaluationManager evaluationDAO) {\n     this.executor = executor;\n     this.aggregationLoader = aggregationLoader;\n     this.timeSeriesLoader = timeSeriesLoader;\n     this.metricDAO = metricDAO;\n     this.datasetDAO = datasetDAO;\n+    this.eventDAO = eventDAO;\n+    this.anomalyDAO = anomalyDAO;\n+    this.evaluationDAO = evaluationDAO;\n+    this.loader = new DetectionPipelineLoader();", "originalCommit": "2d04c3b666d673a7af6791a286433d9b791e947b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e81fe2d6afdcd362f08da3d9a345077bd0f72bcb", "chunk": "diff --git a/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java b/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java\nindex 6aeeb39298..294a51ccde 100644\n--- a/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java\n+++ b/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java\n\n@@ -121,10 +121,6 @@ public class RootCauseMetricResource {\n   private final TimeSeriesLoader timeSeriesLoader;\n   private final MetricConfigManager metricDAO;\n   private final DatasetConfigManager datasetDAO;\n-  private final EventManager eventDAO;\n-  private final MergedAnomalyResultManager anomalyDAO;\n-  private final EvaluationManager evaluationDAO;\n-  private final DetectionPipelineLoader loader;\n   private final DataProvider dataProvider;\n \n   public RootCauseMetricResource(ExecutorService executor, AggregationLoader aggregationLoader,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYxMjA4Mw==", "url": "https://github.com/apache/pinot/pull/6265#discussion_r524612083", "bodyText": "remove if this isn't used.", "author": "jihaozh", "createdAt": "2020-11-16T21:34:54Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/BaselineParsingUtils.java", "diffHunk": "@@ -31,6 +31,7 @@\n public class BaselineParsingUtils {\n   private static final Pattern PATTERN_NONE = Pattern.compile(\"none\");\n   private static final Pattern PATTERN_PREDICTED = Pattern.compile(\"predicted\");\n+  private static final Pattern PATTERN_FORECAST = Pattern.compile(\"forecast\");", "originalCommit": "2d04c3b666d673a7af6791a286433d9b791e947b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e81fe2d6afdcd362f08da3d9a345077bd0f72bcb", "chunk": "diff --git a/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/BaselineParsingUtils.java b/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/BaselineParsingUtils.java\nindex 3c452e8825..9e031f3897 100644\n--- a/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/BaselineParsingUtils.java\n+++ b/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/BaselineParsingUtils.java\n\n@@ -31,7 +31,6 @@ import org.joda.time.DateTimeZone;\n public class BaselineParsingUtils {\n   private static final Pattern PATTERN_NONE = Pattern.compile(\"none\");\n   private static final Pattern PATTERN_PREDICTED = Pattern.compile(\"predicted\");\n-  private static final Pattern PATTERN_FORECAST = Pattern.compile(\"forecast\");\n   private static final Pattern PATTERN_CURRENT = Pattern.compile(\"current\");\n   private static final Pattern PATTERN_HOUR_OVER_HOUR = Pattern.compile(\"ho([1-9][0-9]*)h\");\n   private static final Pattern PATTERN_DAY_OVER_DAY = Pattern.compile(\"do([1-9][0-9]*)d\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5Mjc4NQ==", "url": "https://github.com/apache/pinot/pull/6265#discussion_r524692785", "bodyText": "consider OFFSET_FORECAST.equals(offset) to avoid NPE", "author": "bryantachen", "createdAt": "2020-11-16T22:39:52Z", "path": "thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java", "diffHunk": "@@ -406,6 +440,30 @@ public double getAggregate(@ApiParam(value = \"metric urn\", required = true) @Que\n \n     TimeGranularity granularity = TimeGranularity.fromString(granularityString);\n     MetricSlice baseSlice = alignSlice(makeSlice(urn, start, end, granularity), timezone);\n+\n+    if(offset.equals(OFFSET_FORECAST)) {", "originalCommit": "2d04c3b666d673a7af6791a286433d9b791e947b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "98d9e9d400d1cbf45a91c9f63873e67646ee8b17", "chunk": "diff --git a/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java b/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java\nindex 6aeeb39298..dd8a4ad106 100644\n--- a/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java\n+++ b/thirdeye/thirdeye-dashboard/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/RootCauseMetricResource.java\n\n@@ -441,7 +433,7 @@ public class RootCauseMetricResource {\n     TimeGranularity granularity = TimeGranularity.fromString(granularityString);\n     MetricSlice baseSlice = alignSlice(makeSlice(urn, start, end, granularity), timezone);\n \n-    if(offset.equals(OFFSET_FORECAST)) {\n+    if(OFFSET_FORECAST.equals(offset)) {\n       String forecastClassName = DetectionRegistry.getInstance().lookup(\"FORECAST\");\n       try {\n         InputDataFetcher dataFetcher = new DefaultInputDataFetcher(dataProvider, -1);\n"}}, {"oid": "e81fe2d6afdcd362f08da3d9a345077bd0f72bcb", "url": "https://github.com/apache/pinot/commit/e81fe2d6afdcd362f08da3d9a345077bd0f72bcb", "message": "[TE] rest-api - harleyjj/rca - add forecast as baseline option for metric/timeseries endpoint", "committedDate": "2020-11-20T07:22:25Z", "type": "forcePushed"}, {"oid": "98d9e9d400d1cbf45a91c9f63873e67646ee8b17", "url": "https://github.com/apache/pinot/commit/98d9e9d400d1cbf45a91c9f63873e67646ee8b17", "message": "[TE] rest-api - harleyjj/rca - add forecast as baseline option for metric/timeseries endpoint", "committedDate": "2020-11-20T07:25:10Z", "type": "forcePushed"}, {"oid": "7f9555c31be68dc5162ae89142ad06037d56a1fd", "url": "https://github.com/apache/pinot/commit/7f9555c31be68dc5162ae89142ad06037d56a1fd", "message": "[TE] rest-api - harleyjj/rca - add forecast as baseline option for metric/timeseries endpoint", "committedDate": "2020-12-01T00:03:39Z", "type": "commit"}, {"oid": "7f9555c31be68dc5162ae89142ad06037d56a1fd", "url": "https://github.com/apache/pinot/commit/7f9555c31be68dc5162ae89142ad06037d56a1fd", "message": "[TE] rest-api - harleyjj/rca - add forecast as baseline option for metric/timeseries endpoint", "committedDate": "2020-12-01T00:03:39Z", "type": "forcePushed"}]}