{"pr_number": 5994, "pr_title": "Add null check while fetching the schema", "pr_createdAt": "2020-09-09T20:17:14Z", "pr_url": "https://github.com/apache/pinot/pull/5994", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg5OTY4MQ==", "url": "https://github.com/apache/pinot/pull/5994#discussion_r485899681", "bodyText": "schema = getSchema(propertyStore, realtimeSchemaNameFromValidationConfig);", "author": "xiangfu0", "createdAt": "2020-09-09T20:22:42Z", "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java", "diffHunk": "@@ -274,14 +274,20 @@ public static Schema getTableSchema(@Nonnull ZkHelixPropertyStore<ZNRecord> prop\n     if (tableType == null || tableType == TableType.REALTIME) {\n       TableConfig realtimeTableConfig = getRealtimeTableConfig(propertyStore, tableName);\n       if (realtimeTableConfig != null) {\n-        schema = getSchema(propertyStore, realtimeTableConfig.getValidationConfig().getSchemaName());\n+        String realtimeSchemaNameFromValidationConfig = realtimeTableConfig.getValidationConfig().getSchemaName();\n+        if (realtimeSchemaNameFromValidationConfig != null) {\n+          schema = getSchema(propertyStore, realtimeTableConfig.getValidationConfig().getSchemaName());", "originalCommit": "b2d96ac840ad9b745ca959504b8e5cf2a3e8d912", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d415d8332e32d6759ad57b40d8a519458c109b6a", "chunk": "diff --git a/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java b/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java\nindex 6fcdcfb9a4..8278777ad2 100644\n--- a/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java\n+++ b/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java\n\n@@ -276,7 +276,7 @@ public class ZKMetadataProvider {\n       if (realtimeTableConfig != null) {\n         String realtimeSchemaNameFromValidationConfig = realtimeTableConfig.getValidationConfig().getSchemaName();\n         if (realtimeSchemaNameFromValidationConfig != null) {\n-          schema = getSchema(propertyStore, realtimeTableConfig.getValidationConfig().getSchemaName());\n+          schema = getSchema(propertyStore, realtimeSchemaNameFromValidationConfig);\n         }\n       }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg5OTc4MQ==", "url": "https://github.com/apache/pinot/pull/5994#discussion_r485899781", "bodyText": "schema = getSchema(propertyStore, offlineSchemaNameFromValidationConfig);", "author": "xiangfu0", "createdAt": "2020-09-09T20:22:55Z", "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java", "diffHunk": "@@ -274,14 +274,20 @@ public static Schema getTableSchema(@Nonnull ZkHelixPropertyStore<ZNRecord> prop\n     if (tableType == null || tableType == TableType.REALTIME) {\n       TableConfig realtimeTableConfig = getRealtimeTableConfig(propertyStore, tableName);\n       if (realtimeTableConfig != null) {\n-        schema = getSchema(propertyStore, realtimeTableConfig.getValidationConfig().getSchemaName());\n+        String realtimeSchemaNameFromValidationConfig = realtimeTableConfig.getValidationConfig().getSchemaName();\n+        if (realtimeSchemaNameFromValidationConfig != null) {\n+          schema = getSchema(propertyStore, realtimeTableConfig.getValidationConfig().getSchemaName());\n+        }\n       }\n     }\n     // Try to fetch offline schema if realtime schema does not exist\n     if (schema == null && (tableType == null || tableType == TableType.OFFLINE)) {\n       TableConfig offlineTableConfig = getOfflineTableConfig(propertyStore, tableName);\n       if (offlineTableConfig != null) {\n-        schema = getSchema(propertyStore, offlineTableConfig.getValidationConfig().getSchemaName());\n+        String offlineSchemaNameFromValidationConfig = offlineTableConfig.getValidationConfig().getSchemaName();\n+        if (offlineSchemaNameFromValidationConfig != null) {\n+          schema = getSchema(propertyStore, offlineTableConfig.getValidationConfig().getSchemaName());", "originalCommit": "b2d96ac840ad9b745ca959504b8e5cf2a3e8d912", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkwMTczOA==", "url": "https://github.com/apache/pinot/pull/5994#discussion_r485901738", "bodyText": "good catch :)", "author": "snleee", "createdAt": "2020-09-09T20:26:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg5OTc4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "d415d8332e32d6759ad57b40d8a519458c109b6a", "chunk": "diff --git a/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java b/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java\nindex 6fcdcfb9a4..8278777ad2 100644\n--- a/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java\n+++ b/pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java\n\n@@ -276,7 +276,7 @@ public class ZKMetadataProvider {\n       if (realtimeTableConfig != null) {\n         String realtimeSchemaNameFromValidationConfig = realtimeTableConfig.getValidationConfig().getSchemaName();\n         if (realtimeSchemaNameFromValidationConfig != null) {\n-          schema = getSchema(propertyStore, realtimeTableConfig.getValidationConfig().getSchemaName());\n+          schema = getSchema(propertyStore, realtimeSchemaNameFromValidationConfig);\n         }\n       }\n     }\n"}}, {"oid": "d415d8332e32d6759ad57b40d8a519458c109b6a", "url": "https://github.com/apache/pinot/commit/d415d8332e32d6759ad57b40d8a519458c109b6a", "message": "Add null check while fetching the schema\n\nWhen call ZKMetadataProvider:getSchema(), input parameter schemaName\nis declared as `Nonnull`; however, it's possible that we pass null value.\nThis pr adds the null check to avoid the such case.", "committedDate": "2020-09-09T20:27:14Z", "type": "commit"}, {"oid": "d415d8332e32d6759ad57b40d8a519458c109b6a", "url": "https://github.com/apache/pinot/commit/d415d8332e32d6759ad57b40d8a519458c109b6a", "message": "Add null check while fetching the schema\n\nWhen call ZKMetadataProvider:getSchema(), input parameter schemaName\nis declared as `Nonnull`; however, it's possible that we pass null value.\nThis pr adds the null check to avoid the such case.", "committedDate": "2020-09-09T20:27:14Z", "type": "forcePushed"}]}