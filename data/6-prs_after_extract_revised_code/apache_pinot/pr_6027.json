{"pr_number": 6027, "pr_title": "Support streaming query in QueryExecutor", "pr_createdAt": "2020-09-17T06:37:24Z", "pr_url": "https://github.com/apache/pinot/pull/6027", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwNDUwOQ==", "url": "https://github.com/apache/pinot/pull/6027#discussion_r490604509", "bodyText": "Shall we have a different QueryExecutor implementation for streaming request rather than change this method in the interface?", "author": "xiangfu0", "createdAt": "2020-09-17T22:50:03Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/query/executor/QueryExecutor.java", "diffHunk": "@@ -54,6 +55,16 @@ void init(PinotConfiguration config, InstanceDataManager instanceDataManager, Se\n \n   /**\n    * Processes the query with the given executor service.\n+   * <ul>\n+   *   <li>\n+   *     For streaming request, the returned DataTable contains only the metadata. The response is streamed back via the\n+   *     observer.\n+   *   </li>\n+   *   <li>\n+   *     For non-streaming request, the returned DataTable contains both data and metadata.\n+   *   </li>\n+   * </ul>\n    */\n-  DataTable processQuery(ServerQueryRequest queryRequest, ExecutorService executorService);\n+  DataTable processQuery(ServerQueryRequest queryRequest, ExecutorService executorService,", "originalCommit": "ba09868dd7dfd29b1a57bf1ded1b278d6896ed94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYxMDAwNg==", "url": "https://github.com/apache/pinot/pull/6027#discussion_r490610006", "bodyText": "I agree. We should consider having a different implementation.", "author": "siddharthteotia", "createdAt": "2020-09-17T23:07:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwNDUwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "0f6023b4495b48c439db472fce716260c6ea4a8e", "chunk": "diff --git a/pinot-core/src/main/java/org/apache/pinot/core/query/executor/QueryExecutor.java b/pinot-core/src/main/java/org/apache/pinot/core/query/executor/QueryExecutor.java\nindex 6c20664339..42140bce31 100644\n--- a/pinot-core/src/main/java/org/apache/pinot/core/query/executor/QueryExecutor.java\n+++ b/pinot-core/src/main/java/org/apache/pinot/core/query/executor/QueryExecutor.java\n\n@@ -54,7 +54,14 @@ public interface QueryExecutor {\n   void shutDown();\n \n   /**\n-   * Processes the query with the given executor service.\n+   * Processes the non-streaming query with the given executor service.\n+   */\n+  default DataTable processQuery(ServerQueryRequest queryRequest, ExecutorService executorService) {\n+    return processQuery(queryRequest, executorService, null);\n+  }\n+\n+  /**\n+   * Processes the query (streaming or non-streaming) with the given executor service.\n    * <ul>\n    *   <li>\n    *     For streaming request, the returned DataTable contains only the metadata. The response is streamed back via the\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYxMDM0MQ==", "url": "https://github.com/apache/pinot/pull/6027#discussion_r490610341", "bodyText": "I think it is possible to have a separate implementation. Gradually over time, this might need more changes and we might find ourselves polluting this method for streaming v/s non-streaming if branches.", "author": "siddharthteotia", "createdAt": "2020-09-17T23:08:17Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/query/executor/ServerQueryExecutorV1Impl.java", "diffHunk": "@@ -94,7 +96,8 @@ public synchronized void shutDown() {\n   }\n \n   @Override\n-  public DataTable processQuery(ServerQueryRequest queryRequest, ExecutorService executorService) {\n+  public DataTable processQuery(ServerQueryRequest queryRequest, ExecutorService executorService,\n+      @Nullable StreamObserver<Server.ServerResponse> responseObserver) {", "originalCommit": "ba09868dd7dfd29b1a57bf1ded1b278d6896ed94", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "0f6023b4495b48c439db472fce716260c6ea4a8e", "url": "https://github.com/apache/pinot/commit/0f6023b4495b48c439db472fce716260c6ea4a8e", "message": "Support streaming query in QueryExecutor", "committedDate": "2020-09-19T00:43:41Z", "type": "commit"}, {"oid": "0f6023b4495b48c439db472fce716260c6ea4a8e", "url": "https://github.com/apache/pinot/commit/0f6023b4495b48c439db472fce716260c6ea4a8e", "message": "Support streaming query in QueryExecutor", "committedDate": "2020-09-19T00:43:41Z", "type": "forcePushed"}]}