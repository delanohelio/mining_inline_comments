{"pr_number": 6102, "pr_title": "Add the primary key reading from the GenericRow", "pr_createdAt": "2020-10-03T05:10:22Z", "pr_url": "https://github.com/apache/pinot/pull/6102", "timeline": [{"oid": "f62b35167679a70e59ec4686db1f88a3a8e6b19c", "url": "https://github.com/apache/pinot/commit/f62b35167679a70e59ec4686db1f88a3a8e6b19c", "message": "Add the primary key reading from the GenericRow", "committedDate": "2020-10-03T05:07:08Z", "type": "commit"}, {"oid": "463b4085efde3dadc7b94ec43475bc6a11de65f4", "url": "https://github.com/apache/pinot/commit/463b4085efde3dadc7b94ec43475bc6a11de65f4", "message": "cleanup", "committedDate": "2020-10-03T05:09:44Z", "type": "commit"}, {"oid": "169b88121b2f8cc542ebbb3622897836bb109615", "url": "https://github.com/apache/pinot/commit/169b88121b2f8cc542ebbb3622897836bb109615", "message": "add license", "committedDate": "2020-10-04T03:27:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTEyNg==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901126", "bodyText": "Cache primaryKeyColumns.size() into a local variable", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:13:01Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java", "diffHunk": "@@ -123,6 +124,14 @@ public void putValue(String fieldName, @Nullable Object value) {\n     _fieldToValueMap.put(fieldName, value);\n   }\n \n+  public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n+    Object[] fields = new Object[primaryKeyColumns.size()];", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\nindex 7a4a384f2b..9f706387c1 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\n\n@@ -125,11 +125,12 @@ public class GenericRow {\n   }\n \n   public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n-    Object[] fields = new Object[primaryKeyColumns.size()];\n-    for (int i = 0; i < primaryKeyColumns.size(); i++) {\n-      fields[i] = getValue(primaryKeyColumns.get(i));\n+    Object[] values = new Object[primaryKeyColumns.size()];\n+    int size = primaryKeyColumns.size();\n+    for (int i = 0; i < size; i++) {\n+      values[i] = getValue(primaryKeyColumns.get(i));\n     }\n-    return new PrimaryKey(fields);\n+    return new PrimaryKey(values);\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTQ5NQ==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901495", "bodyText": "Suggest renaming it to values", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:14:02Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java", "diffHunk": "@@ -123,6 +124,14 @@ public void putValue(String fieldName, @Nullable Object value) {\n     _fieldToValueMap.put(fieldName, value);\n   }\n \n+  public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n+    Object[] fields = new Object[primaryKeyColumns.size()];", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\nindex 7a4a384f2b..9f706387c1 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\n\n@@ -125,11 +125,12 @@ public class GenericRow {\n   }\n \n   public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n-    Object[] fields = new Object[primaryKeyColumns.size()];\n-    for (int i = 0; i < primaryKeyColumns.size(); i++) {\n-      fields[i] = getValue(primaryKeyColumns.get(i));\n+    Object[] values = new Object[primaryKeyColumns.size()];\n+    int size = primaryKeyColumns.size();\n+    for (int i = 0; i < size; i++) {\n+      values[i] = getValue(primaryKeyColumns.get(i));\n     }\n-    return new PrimaryKey(fields);\n+    return new PrimaryKey(values);\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTU2OA==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901568", "bodyText": "Suggest renaming it to _values", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:14:13Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.data.readers;\n+\n+import java.util.Arrays;\n+\n+\n+/**\n+ * The primary key of a record.\n+ */\n+public class PrimaryKey {\n+  private final Object[] _fields;", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\nindex 7a6b2024de..26243063a3 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\n\n@@ -22,17 +22,17 @@ import java.util.Arrays;\n \n \n /**\n- * The primary key of a record.\n+ * The primary key of a record. Note that the value used in the primary key must be single-value.\n  */\n public class PrimaryKey {\n-  private final Object[] _fields;\n+  private final Object[] _values;\n \n   public PrimaryKey(Object[] fields) {\n-    _fields = fields;\n+    _values = fields;\n   }\n \n-  public Object[] getFields() {\n-    return _fields;\n+  public Object[] getValues() {\n+    return _values;\n   }\n \n   @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTk2MA==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901960", "bodyText": "Add some javadoc stating that the values should be SV (MV values won't work for equals and hashcode)", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:15:18Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.data.readers;\n+\n+import java.util.Arrays;\n+\n+\n+/**\n+ * The primary key of a record.", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkyMzc4MA==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499923780", "bodyText": "Yes. Table config shall validate this.", "author": "yupeng9", "createdAt": "2020-10-05T23:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTk2MA=="}], "type": "inlineReview", "revised_code": {"commit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\nindex 7a6b2024de..26243063a3 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\n\n@@ -22,17 +22,17 @@ import java.util.Arrays;\n \n \n /**\n- * The primary key of a record.\n+ * The primary key of a record. Note that the value used in the primary key must be single-value.\n  */\n public class PrimaryKey {\n-  private final Object[] _fields;\n+  private final Object[] _values;\n \n   public PrimaryKey(Object[] fields) {\n-    _fields = fields;\n+    _values = fields;\n   }\n \n-  public Object[] getFields() {\n-    return _fields;\n+  public Object[] getValues() {\n+    return _values;\n   }\n \n   @Override\n"}}, {"oid": "d2ce718388009aa1431d126df8f38b92cf65fab9", "url": "https://github.com/apache/pinot/commit/d2ce718388009aa1431d126df8f38b92cf65fab9", "message": "addressed comments", "committedDate": "2020-10-05T23:29:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzNTc4MQ==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499935781", "bodyText": "(nit)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Object[] values = new Object[primaryKeyColumns.size()];\n          \n          \n            \n                int size = primaryKeyColumns.size();\n          \n          \n            \n                for (int i = 0; i < size; i++) {\n          \n          \n            \n                int numPrimaryKeyColumns = primaryKeyColumns.size();\n          \n          \n            \n                Object[] values = new Object[numPrimaryKeyColumns];\n          \n          \n            \n                for (int i = 0; i < numPrimaryKeyColumns; i++) {", "author": "Jackie-Jiang", "createdAt": "2020-10-06T00:03:14Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java", "diffHunk": "@@ -123,6 +124,15 @@ public void putValue(String fieldName, @Nullable Object value) {\n     _fieldToValueMap.put(fieldName, value);\n   }\n \n+  public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n+    Object[] values = new Object[primaryKeyColumns.size()];\n+    int size = primaryKeyColumns.size();\n+    for (int i = 0; i < size; i++) {", "originalCommit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "457b078cae861a4bfe428e057b03972552497b53", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\nindex 9f706387c1..455ea932af 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java\n\n@@ -125,9 +125,9 @@ public class GenericRow {\n   }\n \n   public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n-    Object[] values = new Object[primaryKeyColumns.size()];\n-    int size = primaryKeyColumns.size();\n-    for (int i = 0; i < size; i++) {\n+    int numPrimaryKeyColumns = primaryKeyColumns.size();\n+    Object[] values = new Object[numPrimaryKeyColumns];\n+    for (int i = 0; i < numPrimaryKeyColumns; i++) {\n       values[i] = getValue(primaryKeyColumns.get(i));\n     }\n     return new PrimaryKey(values);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzNTkwMQ==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499935901", "bodyText": "(nit)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public PrimaryKey(Object[] fields) {\n          \n          \n            \n                _values = fields;\n          \n          \n            \n              public PrimaryKey(Object[] values) {\n          \n          \n            \n                _values = values;", "author": "Jackie-Jiang", "createdAt": "2020-10-06T00:03:41Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.data.readers;\n+\n+import java.util.Arrays;\n+\n+\n+/**\n+ * The primary key of a record. Note that the value used in the primary key must be single-value.\n+ */\n+public class PrimaryKey {\n+  private final Object[] _values;\n+\n+  public PrimaryKey(Object[] fields) {\n+    _values = fields;", "originalCommit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "457b078cae861a4bfe428e057b03972552497b53", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\nindex 26243063a3..c6a2edfc25 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java\n\n@@ -27,8 +27,8 @@ import java.util.Arrays;\n public class PrimaryKey {\n   private final Object[] _values;\n \n-  public PrimaryKey(Object[] fields) {\n-    _values = fields;\n+  public PrimaryKey(Object[] values) {\n+    _values = values;\n   }\n \n   public Object[] getValues() {\n"}}, {"oid": "457b078cae861a4bfe428e057b03972552497b53", "url": "https://github.com/apache/pinot/commit/457b078cae861a4bfe428e057b03972552497b53", "message": "more comments", "committedDate": "2020-10-06T00:18:26Z", "type": "commit"}]}