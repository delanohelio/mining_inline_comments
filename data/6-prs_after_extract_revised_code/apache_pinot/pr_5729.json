{"pr_number": 5729, "pr_title": "Adding support for ingestion job spec as JSON", "pr_createdAt": "2020-07-22T14:32:46Z", "pr_url": "https://github.com/apache/pinot/pull/5729", "timeline": [{"oid": "1a572cd8778827b31215df6c04ace97a1c0ca8b0", "url": "https://github.com/apache/pinot/commit/1a572cd8778827b31215df6c04ace97a1c0ca8b0", "message": "adding support for ingestion job spec as JSON", "committedDate": "2020-07-22T14:30:15Z", "type": "commit"}, {"oid": "f313cd73cb7f9e1e4c9d5a1b997504aaab8c0de7", "url": "https://github.com/apache/pinot/commit/f313cd73cb7f9e1e4c9d5a1b997504aaab8c0de7", "message": "changing output path for test", "committedDate": "2020-07-22T16:07:33Z", "type": "commit"}, {"oid": "608a001b62d91303ca76ec1b21d55500d9e6beb4", "url": "https://github.com/apache/pinot/commit/608a001b62d91303ca76ec1b21d55500d9e6beb4", "message": "removing typo in test file json name", "committedDate": "2020-07-22T16:55:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEzMTQ2NQ==", "url": "https://github.com/apache/pinot/pull/5729#discussion_r459131465", "bodyText": "use propertiesMap", "author": "xiangfu0", "createdAt": "2020-07-22T23:02:14Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/IngestionJobLauncher.java", "diffHunk": "@@ -57,21 +61,33 @@ public static SegmentGenerationJobSpec getSegmentGenerationJobSpec(String jobSpe\n     if (context != null) {\n       propertiesMap.putAll(context);\n     }\n-    String yamlTemplate;\n+    String jobSpecTemplate;\n     try {\n-      yamlTemplate = IOUtils.toString(new BufferedReader(new FileReader(jobSpecFilePath)));\n+      jobSpecTemplate = IOUtils.toString(new BufferedReader(new FileReader(jobSpecFilePath)));\n     } catch (IOException e) {\n       throw new RuntimeException(String.format(\"Unable to read ingestion job spec file [%s].\", jobSpecFilePath), e);\n     }\n-    String yamlStr;\n+    String jobSpecStr;\n     try {\n-      yamlStr = GroovyTemplateUtils.renderTemplate(yamlTemplate, propertiesMap);\n+      jobSpecStr = GroovyTemplateUtils.renderTemplate(jobSpecTemplate, propertiesMap);\n     } catch (Exception e) {\n       throw new RuntimeException(String\n           .format(\"Unable to render templates on ingestion job spec template file - [%s] with propertiesMap - [%s].\",\n               jobSpecFilePath, Arrays.toString(propertiesMap.entrySet().toArray())), e);\n     }\n-    return new Yaml().loadAs(yamlStr, SegmentGenerationJobSpec.class);\n+\n+    String jobSpecFormat = properties.getProperty(JOB_SPEC_FORMAT, YAML);", "originalCommit": "608a001b62d91303ca76ec1b21d55500d9e6beb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0OTg4Mg==", "url": "https://github.com/apache/pinot/pull/5729#discussion_r459649882", "bodyText": "done", "author": "KKcorps", "createdAt": "2020-07-23T18:35:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEzMTQ2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "7c8a973b39daa7ff7d63d149c31a16d57887e227", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/IngestionJobLauncher.java b/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/IngestionJobLauncher.java\nindex bd63dccb1d..9412fc2ef3 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/IngestionJobLauncher.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/IngestionJobLauncher.java\n\n@@ -76,7 +76,7 @@ public class IngestionJobLauncher {\n               jobSpecFilePath, Arrays.toString(propertiesMap.entrySet().toArray())), e);\n     }\n \n-    String jobSpecFormat = properties.getProperty(JOB_SPEC_FORMAT, YAML);\n+    String jobSpecFormat = (String) propertiesMap.getOrDefault(JOB_SPEC_FORMAT, YAML);\n     if (jobSpecFormat.equals(JSON)) {\n       try {\n         return JsonUtils.stringToObject(jobSpecStr, SegmentGenerationJobSpec.class);\n"}}, {"oid": "7c8a973b39daa7ff7d63d149c31a16d57887e227", "url": "https://github.com/apache/pinot/commit/7c8a973b39daa7ff7d63d149c31a16d57887e227", "message": "removing camel case from file name and using propertiesMap instead of properties", "committedDate": "2020-07-23T17:13:31Z", "type": "commit"}, {"oid": "dc0f5f97afb116ce5b0c2f7f89793797a1c0e1d5", "url": "https://github.com/apache/pinot/commit/dc0f5f97afb116ce5b0c2f7f89793797a1c0e1d5", "message": "unit test fix", "committedDate": "2020-07-23T17:40:41Z", "type": "commit"}]}