{"pr_number": 5865, "pr_title": "[TE] anomaly search - hide child anomaly unless queried with anomaly ids", "pr_createdAt": "2020-08-14T17:53:29Z", "pr_url": "https://github.com/apache/pinot/pull/5865", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3OTA0Mw==", "url": "https://github.com/apache/pinot/pull/5865#discussion_r470779043", "bodyText": "Hi Jihao, is there a way for us to test the fix before waiting for the next deployment? This is a bit critical which is impacting all entity monitoring. Let's make sure it works when we deploy.", "author": "cecilynie", "createdAt": "2020-08-14T18:11:47Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java", "diffHunk": "@@ -70,7 +70,11 @@ public AnomalySearcher() {\n    * @return the result\n    */\n   public Map<String, Object> search(AnomalySearchFilter searchFilter, int limit, int offset) {\n-    Predicate predicate = Predicate.EQ(\"child\", false);\n+    Predicate predicate = Predicate.NEQ(\"baseId\", 0);", "originalCommit": "d173efe30472153fe7d65c52c86926a077ea765f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgxMDYzOA==", "url": "https://github.com/apache/pinot/pull/5865#discussion_r470810638", "bodyText": "it will be tested by unit tests and staging before deploy.", "author": "jihaozh", "createdAt": "2020-08-14T18:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3OTA0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "230cef8a24a3b060908e9e0de94942183e958cc6", "chunk": "diff --git a/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java b/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java\nindex 0403a97aaa..5b7a9fad1e 100644\n--- a/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java\n+++ b/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java\n\n@@ -70,6 +70,7 @@ public class AnomalySearcher {\n    * @return the result\n    */\n   public Map<String, Object> search(AnomalySearchFilter searchFilter, int limit, int offset) {\n+    // default dummy predicate, the base id can't be 0\n     Predicate predicate = Predicate.NEQ(\"baseId\", 0);\n     // hide child anomaly unless queried with ids\n     if (searchFilter.getAnomalyIds().isEmpty()) {\n"}}, {"oid": "58469f231d057063b486f37a467250c653fc4b16", "url": "https://github.com/apache/pinot/commit/58469f231d057063b486f37a467250c653fc4b16", "message": "[TE] anomaly search - hide child anomaly unless queried with anomaly ids", "committedDate": "2020-08-14T18:50:37Z", "type": "commit"}, {"oid": "58469f231d057063b486f37a467250c653fc4b16", "url": "https://github.com/apache/pinot/commit/58469f231d057063b486f37a467250c653fc4b16", "message": "[TE] anomaly search - hide child anomaly unless queried with anomaly ids", "committedDate": "2020-08-14T18:50:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE4MDU1Mg==", "url": "https://github.com/apache/pinot/pull/5865#discussion_r471180552", "bodyText": "what's the rational behind querying by baseId? Can you also include it in the code-comment.", "author": "akshayrai", "createdAt": "2020-08-17T00:30:02Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java", "diffHunk": "@@ -70,7 +70,11 @@ public AnomalySearcher() {\n    * @return the result\n    */\n   public Map<String, Object> search(AnomalySearchFilter searchFilter, int limit, int offset) {\n-    Predicate predicate = Predicate.EQ(\"child\", false);\n+    Predicate predicate = Predicate.NEQ(\"baseId\", 0);", "originalCommit": "58469f231d057063b486f37a467250c653fc4b16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY4ODExMQ==", "url": "https://github.com/apache/pinot/pull/5865#discussion_r471688111", "bodyText": "+1", "author": "vincentchenjl", "createdAt": "2020-08-17T18:31:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE4MDU1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1MDgwNQ==", "url": "https://github.com/apache/pinot/pull/5865#discussion_r471750805", "bodyText": "thanks, added the comment", "author": "jihaozh", "createdAt": "2020-08-17T20:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE4MDU1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "230cef8a24a3b060908e9e0de94942183e958cc6", "chunk": "diff --git a/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java b/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java\nindex 0403a97aaa..5b7a9fad1e 100644\n--- a/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java\n+++ b/thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/anomalies/AnomalySearcher.java\n\n@@ -70,6 +70,7 @@ public class AnomalySearcher {\n    * @return the result\n    */\n   public Map<String, Object> search(AnomalySearchFilter searchFilter, int limit, int offset) {\n+    // default dummy predicate, the base id can't be 0\n     Predicate predicate = Predicate.NEQ(\"baseId\", 0);\n     // hide child anomaly unless queried with ids\n     if (searchFilter.getAnomalyIds().isEmpty()) {\n"}}, {"oid": "230cef8a24a3b060908e9e0de94942183e958cc6", "url": "https://github.com/apache/pinot/commit/230cef8a24a3b060908e9e0de94942183e958cc6", "message": "address comments", "committedDate": "2020-08-17T20:14:46Z", "type": "commit"}]}