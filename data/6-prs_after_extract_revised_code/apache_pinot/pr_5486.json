{"pr_number": 5486, "pr_title": "Changed the segment commit protocol to send/receive streamPartitionMs\u2026", "pr_createdAt": "2020-06-02T20:58:02Z", "pr_url": "https://github.com/apache/pinot/pull/5486", "timeline": [{"oid": "7201fa6435b3625cdbf0233bbf8b082e953d41cc", "url": "https://github.com/apache/pinot/commit/7201fa6435b3625cdbf0233bbf8b082e953d41cc", "message": "Changed the segment commit protocol to send/receive streamPartitionMsgOffset\n\nUpdated the segment commit protocol so that new element streamPartitionMsgOffset\nis populated in requests (as request parameters) and in response (as JSON string element)\n\nThe server side has been modified to send the 'streamPartitionMsgOffset' as well as we the\n'offset' parameters to the controller. The controller looks for and prefers streamPartitionMsgOffset\nbut falls back to offset if the streamPartitionMsgOffset is not there.\n\nThe controller side, in the repsonse message, populates both of the elements, and the server on\nthe receiver side does likewise -- preferring streamPartitionMsgOffset.\n\nAll callers into the protocol module have been modified to NOT set the offset field. Instead,\nonly set the streamPartitionMsgOffset field. The 'offset' value will be derived from\nstreamPartitionMsgOffset.\n\nAdded a test to make sure that the controller always generates both elements. Such a test was not\npossible in the server side at this time, so verified manually.\n\nManually ran LLCClusterIntergrationTest by disabling populating `streamPartitionMsgOffset` on the\nserver side (old server/new controller) and on the controller respons side (new server/old controller)\n\nIssue #5359", "committedDate": "2020-06-02T20:47:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxMzA0Mg==", "url": "https://github.com/apache/pinot/pull/5486#discussion_r434713042", "bodyText": "left these lines by mistake?", "author": "npawar", "createdAt": "2020-06-03T16:49:51Z", "path": "pinot-core/src/test/java/org/apache/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java", "diffHunk": "@@ -481,6 +485,11 @@ public void testOnlineTransitionAfterStop()\n     }\n   }\n \n+  @Test", "originalCommit": "7201fa6435b3625cdbf0233bbf8b082e953d41cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4fbd7785a2c37b76346aef689e11b5c5804593b2", "chunk": "diff --git a/pinot-core/src/test/java/org/apache/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java b/pinot-core/src/test/java/org/apache/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java\nindex d87c6be6c1..3e3020a72d 100644\n--- a/pinot-core/src/test/java/org/apache/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java\n+++ b/pinot-core/src/test/java/org/apache/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java\n\n@@ -485,11 +485,6 @@ public class LLRealtimeSegmentDataManagerTest {\n     }\n   }\n \n-  @Test\n-  public void testName() {\n-\n-  }\n-\n   @Test\n   public void testEndCriteriaChecking()\n       throws Exception {\n"}}, {"oid": "4fbd7785a2c37b76346aef689e11b5c5804593b2", "url": "https://github.com/apache/pinot/commit/4fbd7785a2c37b76346aef689e11b5c5804593b2", "message": "Addressed review comments", "committedDate": "2020-06-03T17:16:07Z", "type": "commit"}]}