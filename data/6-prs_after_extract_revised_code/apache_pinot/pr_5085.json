{"pr_number": 5085, "pr_title": "Support text index load for V1 segment format", "pr_createdAt": "2020-02-21T02:15:33Z", "pr_url": "https://github.com/apache/pinot/pull/5085", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM3MjczOQ==", "url": "https://github.com/apache/pinot/pull/5085#discussion_r382372739", "bodyText": "Change this to:\n@Nullable\npublic static File getTextIndexFile(File indexDir, String column) {\n  return findFormatFile(indexDir, column + LuceneTextIndexCreator.LUCENE_TEXT_INDEX_FILE_EXTENSION);\n}", "author": "Jackie-Jiang", "createdAt": "2020-02-21T02:54:31Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/segment/store/SegmentDirectoryPaths.java", "diffHunk": "@@ -78,6 +79,20 @@ public static File findStarTreeFile(@Nonnull File indexDir) {\n     return findFormatFile(indexDir, V1Constants.STAR_TREE_INDEX_FILE);\n   }\n \n+  public static File getTextIndexIndexFile(File indexDir, SegmentVersion segmentVersion, String column) {", "originalCommit": "f7d8407085a474462f69d1d8e8ade780964bbe89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQyMTE3Ng==", "url": "https://github.com/apache/pinot/pull/5085#discussion_r382421176", "bodyText": "Done", "author": "siddharthteotia", "createdAt": "2020-02-21T06:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM3MjczOQ=="}], "type": "inlineReview", "revised_code": {"commit": "bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "chunk": "diff --git a/pinot-core/src/main/java/org/apache/pinot/core/segment/store/SegmentDirectoryPaths.java b/pinot-core/src/main/java/org/apache/pinot/core/segment/store/SegmentDirectoryPaths.java\nindex a8cd95f3a9..75af885718 100644\n--- a/pinot-core/src/main/java/org/apache/pinot/core/segment/store/SegmentDirectoryPaths.java\n+++ b/pinot-core/src/main/java/org/apache/pinot/core/segment/store/SegmentDirectoryPaths.java\n\n@@ -79,18 +79,16 @@ public class SegmentDirectoryPaths {\n     return findFormatFile(indexDir, V1Constants.STAR_TREE_INDEX_FILE);\n   }\n \n-  public static File getTextIndexIndexFile(File indexDir, SegmentVersion segmentVersion, String column) {\n+  /**\n+   * Find text index file in top-level segment index directory\n+   * @param indexDir top-level segment index directory\n+   * @param column text column name\n+   * @return text index directory (if exists in V3, V1 or V2 format), null if index file does not exit\n+   */\n+  @Nullable\n+  public static File findTextIndexIndexFile(File indexDir, String column) {\n     String luceneIndexDirectory = column + LuceneTextIndexCreator.LUCENE_TEXT_INDEX_FILE_EXTENSION;\n-    switch (segmentVersion) {\n-      case v1:\n-      case v2:\n-        return new File(indexDir, luceneIndexDirectory);\n-      case v3:\n-        File v3Dir = segmentDirectoryFor(indexDir, SegmentVersion.v3);\n-        return new File(v3Dir, luceneIndexDirectory);\n-      default:\n-        throw new IllegalStateException(\"Found invalid segment version \" + segmentVersion.name() + \" while trying to get text index file\");\n-    }\n+    return findFormatFile(indexDir, luceneIndexDirectory);\n   }\n \n   /**\n"}}, {"oid": "bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "url": "https://github.com/apache/pinot/commit/bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "message": "Support text index load for V1 segment format", "committedDate": "2020-02-21T06:47:57Z", "type": "commit"}, {"oid": "bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "url": "https://github.com/apache/pinot/commit/bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "message": "Support text index load for V1 segment format", "committedDate": "2020-02-21T06:47:57Z", "type": "forcePushed"}, {"oid": "ab59298a770a6ab09d120abeacd6e85258074fc8", "url": "https://github.com/apache/pinot/commit/ab59298a770a6ab09d120abeacd6e85258074fc8", "message": "Fix formatting", "committedDate": "2020-02-21T06:56:21Z", "type": "commit"}]}