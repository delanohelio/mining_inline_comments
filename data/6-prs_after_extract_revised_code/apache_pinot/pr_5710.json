{"pr_number": 5710, "pr_title": "Cleanup the call to RealtimeSegmentConverter from HLCDataManager", "pr_createdAt": "2020-07-16T18:13:53Z", "pr_url": "https://github.com/apache/pinot/pull/5710", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5ODA5Mg==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r455998092", "bodyText": "Let's remove the extra constructors and just keep one (easier to use).\nThe only usage of them is RealtimeSegmentConverterTest.testNoVirtualColumnsInSchema(), where you can make RealtimeSegmentConverter.getUpdatedSchema() static", "author": "Jackie-Jiang", "createdAt": "2020-07-16T18:45:54Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java", "diffHunk": "@@ -82,14 +83,14 @@ public RealtimeSegmentConverter(MutableSegmentImpl realtimeSegment, String outpu\n       List<String> invertedIndexColumns, List<String> noDictionaryColumns, List<String> varLengthDictionaryColumns,\n       boolean nullHandlingEnabled) {\n     this(realtimeSegment, outputPath, schema, tableName, tableConfig, segmentName, sortedColumn,\n-        invertedIndexColumns, new ArrayList<>(), noDictionaryColumns, varLengthDictionaryColumns, nullHandlingEnabled);\n+        invertedIndexColumns, Collections.emptyList(), noDictionaryColumns, varLengthDictionaryColumns, nullHandlingEnabled);\n   }\n \n   // Used in RealtimeSegmentConverterTest\n   public RealtimeSegmentConverter(MutableSegmentImpl realtimeSegment, String outputPath, Schema schema,", "originalCommit": "dc174beede9fb00b41503c13d521d10d5434ed76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAwOTU3Mg==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r456009572", "bodyText": "done", "author": "siddharthteotia", "createdAt": "2020-07-16T19:06:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5ODA5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "6c2e1956e3ed7f3c62617a845a682a652d66463f", "chunk": "diff --git a/pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java b/pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java\nindex b9f59b9aa5..058f2af47b 100644\n--- a/pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java\n+++ b/pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java\n\n@@ -78,21 +78,6 @@ public class RealtimeSegmentConverter {\n     _textIndexColumns = textIndexColumns;\n   }\n \n-  public RealtimeSegmentConverter(MutableSegmentImpl realtimeSegment, String outputPath, Schema schema,\n-      String tableName, TableConfig tableConfig, String segmentName, String sortedColumn,\n-      List<String> invertedIndexColumns, List<String> noDictionaryColumns, List<String> varLengthDictionaryColumns,\n-      boolean nullHandlingEnabled) {\n-    this(realtimeSegment, outputPath, schema, tableName, tableConfig, segmentName, sortedColumn,\n-        invertedIndexColumns, Collections.emptyList(), noDictionaryColumns, varLengthDictionaryColumns, nullHandlingEnabled);\n-  }\n-\n-  // Used in RealtimeSegmentConverterTest\n-  public RealtimeSegmentConverter(MutableSegmentImpl realtimeSegment, String outputPath, Schema schema,\n-      String tableName, TableConfig tableConfig, String segmentName, String sortedColumn) {\n-    this(realtimeSegment, outputPath, schema, tableName, tableConfig, segmentName, sortedColumn, Collections.emptyList(),\n-        Collections.emptyList(), Collections.emptyList(), Collections.emptyList(), false/*nullHandlingEnabled*/);\n-  }\n-\n   public void build(@Nullable SegmentVersion segmentVersion, ServerMetrics serverMetrics)\n       throws Exception {\n     // lets create a record reader\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5ODU3Mg==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r455998572", "bodyText": "(nit) Remove HLRealtimeSegmentDataManager.this.", "author": "Jackie-Jiang", "createdAt": "2020-07-16T18:46:53Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java", "diffHunk": "@@ -287,8 +287,7 @@ public void run() {\n               new RealtimeSegmentConverter(_realtimeSegment, tempSegmentFolder.getAbsolutePath(), schema,\n                   _tableNameWithType, tableConfig, realtimeSegmentZKMetadata.getSegmentName(), _sortedColumn,\n                   HLRealtimeSegmentDataManager.this._invertedIndexColumns, _noDictionaryColumns,", "originalCommit": "dc174beede9fb00b41503c13d521d10d5434ed76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAwOTY0Ng==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r456009646", "bodyText": "done", "author": "siddharthteotia", "createdAt": "2020-07-16T19:06:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5ODU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "6c2e1956e3ed7f3c62617a845a682a652d66463f", "chunk": "diff --git a/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java b/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java\nindex bed7219bda..7fa51d1457 100644\n--- a/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java\n+++ b/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java\n\n@@ -286,8 +287,8 @@ public class HLRealtimeSegmentDataManager extends RealtimeSegmentDataManager {\n           RealtimeSegmentConverter converter =\n               new RealtimeSegmentConverter(_realtimeSegment, tempSegmentFolder.getAbsolutePath(), schema,\n                   _tableNameWithType, tableConfig, realtimeSegmentZKMetadata.getSegmentName(), _sortedColumn,\n-                  HLRealtimeSegmentDataManager.this._invertedIndexColumns, _noDictionaryColumns,\n-                  _varLengthDictionaryColumns, indexingConfig.isNullHandlingEnabled());\n+                  _invertedIndexColumns, Collections.emptyList(), _noDictionaryColumns, _varLengthDictionaryColumns,\n+                  indexingConfig.isNullHandlingEnabled());\n \n           _segmentLogger.info(\"Trying to build segment\");\n           final long buildStartTime = System.nanoTime();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5OTE0Nw==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r455999147", "bodyText": "We should support text index for HLC", "author": "Jackie-Jiang", "createdAt": "2020-07-16T18:47:55Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java", "diffHunk": "@@ -287,8 +287,7 @@ public void run() {\n               new RealtimeSegmentConverter(_realtimeSegment, tempSegmentFolder.getAbsolutePath(), schema,\n                   _tableNameWithType, tableConfig, realtimeSegmentZKMetadata.getSegmentName(), _sortedColumn,\n                   HLRealtimeSegmentDataManager.this._invertedIndexColumns, _noDictionaryColumns,\n-                  _varLengthDictionaryColumns, null/*StarTreeIndexSpec*/,\n-                  indexingConfig.isNullHandlingEnabled()); // Star tree not supported for HLC.\n+                  _varLengthDictionaryColumns, indexingConfig.isNullHandlingEnabled());", "originalCommit": "dc174beede9fb00b41503c13d521d10d5434ed76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAwNDc3MA==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r456004770", "bodyText": "It is there for LLC already. Will add for HLC as well", "author": "siddharthteotia", "createdAt": "2020-07-16T18:58:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5OTE0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "6c2e1956e3ed7f3c62617a845a682a652d66463f", "chunk": "diff --git a/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java b/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java\nindex bed7219bda..7fa51d1457 100644\n--- a/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java\n+++ b/pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java\n\n@@ -286,8 +287,8 @@ public class HLRealtimeSegmentDataManager extends RealtimeSegmentDataManager {\n           RealtimeSegmentConverter converter =\n               new RealtimeSegmentConverter(_realtimeSegment, tempSegmentFolder.getAbsolutePath(), schema,\n                   _tableNameWithType, tableConfig, realtimeSegmentZKMetadata.getSegmentName(), _sortedColumn,\n-                  HLRealtimeSegmentDataManager.this._invertedIndexColumns, _noDictionaryColumns,\n-                  _varLengthDictionaryColumns, indexingConfig.isNullHandlingEnabled());\n+                  _invertedIndexColumns, Collections.emptyList(), _noDictionaryColumns, _varLengthDictionaryColumns,\n+                  indexingConfig.isNullHandlingEnabled());\n \n           _segmentLogger.info(\"Trying to build segment\");\n           final long buildStartTime = System.nanoTime();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NDg5OA==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r456074898", "bodyText": "Remove the unused table config", "author": "Jackie-Jiang", "createdAt": "2020-07-16T21:00:13Z", "path": "pinot-core/src/test/java/org/apache/pinot/realtime/converter/RealtimeSegmentConverterTest.java", "diffHunk": "@@ -46,11 +46,7 @@ public void testNoVirtualColumnsInSchema() {\n     String segmentName = \"segment1\";", "originalCommit": "7f880b848003aa34f2c9928d1b3951aa1b6c3d92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA4MjI0OA==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r456082248", "bodyText": "done", "author": "siddharthteotia", "createdAt": "2020-07-16T21:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NDg5OA=="}], "type": "inlineReview", "revised_code": {"commit": "6c2e1956e3ed7f3c62617a845a682a652d66463f", "chunk": "diff --git a/pinot-core/src/test/java/org/apache/pinot/realtime/converter/RealtimeSegmentConverterTest.java b/pinot-core/src/test/java/org/apache/pinot/realtime/converter/RealtimeSegmentConverterTest.java\nindex 608ead32dc..71f42fa9ef 100644\n--- a/pinot-core/src/test/java/org/apache/pinot/realtime/converter/RealtimeSegmentConverterTest.java\n+++ b/pinot-core/src/test/java/org/apache/pinot/realtime/converter/RealtimeSegmentConverterTest.java\n\n@@ -41,8 +41,6 @@ public class RealtimeSegmentConverterTest {\n     Schema schema = new Schema.SchemaBuilder().addSingleValueDimension(\"col1\", FieldSpec.DataType.STRING)\n         .addTime(new TimeGranularitySpec(FieldSpec.DataType.LONG, TimeUnit.MILLISECONDS, \"col1\"),\n             new TimeGranularitySpec(FieldSpec.DataType.LONG, TimeUnit.DAYS, \"col2\")).build();\n-    TableConfig tableConfig =\n-        new TableConfigBuilder(TableType.REALTIME).setTableName(\"test\").setTimeColumnName(\"col2\").build();\n     String segmentName = \"segment1\";\n     VirtualColumnProviderFactory.addBuiltInVirtualColumnsToSegmentSchema(schema, segmentName);\n     Assert.assertEquals(schema.getColumnNames().size(), 5);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NTU2Mg==", "url": "https://github.com/apache/pinot/pull/5710#discussion_r456075562", "bodyText": "Are you planning to add text index support for HLC in a separate PR?", "author": "Jackie-Jiang", "createdAt": "2020-07-16T21:01:27Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java", "diffHunk": "@@ -286,9 +287,8 @@ public void run() {\n           RealtimeSegmentConverter converter =\n               new RealtimeSegmentConverter(_realtimeSegment, tempSegmentFolder.getAbsolutePath(), schema,\n                   _tableNameWithType, tableConfig, realtimeSegmentZKMetadata.getSegmentName(), _sortedColumn,\n-                  HLRealtimeSegmentDataManager.this._invertedIndexColumns, _noDictionaryColumns,\n-                  _varLengthDictionaryColumns, null/*StarTreeIndexSpec*/,\n-                  indexingConfig.isNullHandlingEnabled()); // Star tree not supported for HLC.\n+                  _invertedIndexColumns, Collections.emptyList(), _noDictionaryColumns, _varLengthDictionaryColumns,", "originalCommit": "7f880b848003aa34f2c9928d1b3951aa1b6c3d92", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "6c2e1956e3ed7f3c62617a845a682a652d66463f", "url": "https://github.com/apache/pinot/commit/6c2e1956e3ed7f3c62617a845a682a652d66463f", "message": "Cleanup the call to RealtimeSegmentConverter\nfrom HLCSegmentDatamanager", "committedDate": "2020-07-16T21:14:32Z", "type": "commit"}, {"oid": "6c2e1956e3ed7f3c62617a845a682a652d66463f", "url": "https://github.com/apache/pinot/commit/6c2e1956e3ed7f3c62617a845a682a652d66463f", "message": "Cleanup the call to RealtimeSegmentConverter\nfrom HLCSegmentDatamanager", "committedDate": "2020-07-16T21:14:32Z", "type": "forcePushed"}]}