{"pr_number": 6214, "pr_title": "Support running pinot batch ingestion standalone job in a parallel mode", "pr_createdAt": "2020-10-30T04:28:46Z", "pr_url": "https://github.com/apache/pinot/pull/6214", "timeline": [{"oid": "251edf25eae17cdefb7965dde8a66604da460f81", "url": "https://github.com/apache/pinot/commit/251edf25eae17cdefb7965dde8a66604da460f81", "message": "Support running pinot batch ingestion standalone job in a parallel mode", "committedDate": "2020-10-30T05:01:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MjAxNQ==", "url": "https://github.com/apache/pinot/pull/6214#discussion_r515072015", "bodyText": "Nit: It might be confusing for user on why num threads may not match the specified jobParallelism (if numCores is smaller). Perhaps modify the log indicate that.", "author": "mayankshriv", "createdAt": "2020-10-30T12:46:17Z", "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-standalone/src/main/java/org/apache/pinot/plugin/ingestion/batch/standalone/SegmentGenerationJobRunner.java", "diffHunk": "@@ -96,6 +101,9 @@ public void init(SegmentGenerationJobSpec spec) {\n           .generateTableConfigURI(pinotClusterSpec.getControllerURI(), _spec.getTableSpec().getTableName());\n       _spec.getTableSpec().setTableConfigURI(tableConfigURI);\n     }\n+    int numThreads = JobUtils.getNumThreads(_spec.getSegmentCreationJobParallelism());\n+    LOGGER.info(\"Creating an executor service with {} threads.\", numThreads);", "originalCommit": "251edf25eae17cdefb7965dde8a66604da460f81", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "227b0c1754b410401a4e5859fad097450320891d", "chunk": "diff --git a/pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-standalone/src/main/java/org/apache/pinot/plugin/ingestion/batch/standalone/SegmentGenerationJobRunner.java b/pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-standalone/src/main/java/org/apache/pinot/plugin/ingestion/batch/standalone/SegmentGenerationJobRunner.java\nindex b26153b9e5..f60a7e3524 100644\n--- a/pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-standalone/src/main/java/org/apache/pinot/plugin/ingestion/batch/standalone/SegmentGenerationJobRunner.java\n+++ b/pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-standalone/src/main/java/org/apache/pinot/plugin/ingestion/batch/standalone/SegmentGenerationJobRunner.java\n\n@@ -101,8 +101,10 @@ public class SegmentGenerationJobRunner implements IngestionJobRunner {\n           .generateTableConfigURI(pinotClusterSpec.getControllerURI(), _spec.getTableSpec().getTableName());\n       _spec.getTableSpec().setTableConfigURI(tableConfigURI);\n     }\n-    int numThreads = JobUtils.getNumThreads(_spec.getSegmentCreationJobParallelism());\n-    LOGGER.info(\"Creating an executor service with {} threads.\", numThreads);\n+    final int jobParallelism = _spec.getSegmentCreationJobParallelism();\n+    int numThreads = JobUtils.getNumThreads(jobParallelism);\n+    LOGGER.info(\"Creating an executor service with {} threads(Job parallelism: {}, available cores: {}.)\", numThreads,\n+        jobParallelism, Runtime.getRuntime().availableProcessors());\n     _executorService = Executors.newFixedThreadPool(numThreads);\n   }\n \n"}}, {"oid": "227b0c1754b410401a4e5859fad097450320891d", "url": "https://github.com/apache/pinot/commit/227b0c1754b410401a4e5859fad097450320891d", "message": "Support running pinot batch ingestion standalone job in a parallel mode", "committedDate": "2020-10-31T00:29:53Z", "type": "forcePushed"}, {"oid": "adbacc5e1e734b6950dd1cc34acc7de73e63049b", "url": "https://github.com/apache/pinot/commit/adbacc5e1e734b6950dd1cc34acc7de73e63049b", "message": "Support running pinot batch ingestion standalone job in a parallel mode", "committedDate": "2020-10-31T00:57:04Z", "type": "commit"}, {"oid": "adbacc5e1e734b6950dd1cc34acc7de73e63049b", "url": "https://github.com/apache/pinot/commit/adbacc5e1e734b6950dd1cc34acc7de73e63049b", "message": "Support running pinot batch ingestion standalone job in a parallel mode", "committedDate": "2020-10-31T00:57:04Z", "type": "forcePushed"}]}