{"pr_number": 6332, "pr_title": "Simplify batch config and corresponding utils", "pr_createdAt": "2020-12-08T06:42:31Z", "pr_url": "https://github.com/apache/pinot/pull/6332", "timeline": [{"oid": "a1e4652180b85976b2a6cce23f977dfd945b7795", "url": "https://github.com/apache/pinot/commit/a1e4652180b85976b2a6cce23f977dfd945b7795", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-08T08:12:40Z", "type": "forcePushed"}, {"oid": "80e5a0e9008250dcafd02edf340b15dddb69d71d", "url": "https://github.com/apache/pinot/commit/80e5a0e9008250dcafd02edf340b15dddb69d71d", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-08T08:19:51Z", "type": "forcePushed"}, {"oid": "3971d189f7a67fbc9878852680c536f66fa5fa9a", "url": "https://github.com/apache/pinot/commit/3971d189f7a67fbc9878852680c536f66fa5fa9a", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-08T20:39:44Z", "type": "forcePushed"}, {"oid": "b72f0d37227a181caee299412d8ef11fbc1f36f5", "url": "https://github.com/apache/pinot/commit/b72f0d37227a181caee299412d8ef11fbc1f36f5", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-08T20:40:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NzY2Mg==", "url": "https://github.com/apache/pinot/pull/6332#discussion_r540587662", "bodyText": "Curious on why this change?", "author": "mayankshriv", "createdAt": "2020-12-10T23:54:41Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/filesystem/PinotFSFactory.java", "diffHunk": "@@ -38,8 +38,8 @@\n   private PinotFSFactory() {\n   }\n \n+  public static final String LOCAL_PINOT_FS_SCHEME = \"file\";", "originalCommit": "b72f0d37227a181caee299412d8ef11fbc1f36f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY0MTYwMw==", "url": "https://github.com/apache/pinot/pull/6332#discussion_r540641603", "bodyText": "It will be used as default scheme value when we specify the path uri without scheme.", "author": "xiangfu0", "createdAt": "2020-12-11T02:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NzY2Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE3Njc2MQ==", "url": "https://github.com/apache/pinot/pull/6332#discussion_r541176761", "bodyText": "As discussed offline, please relax this requirement of input and output dir, so that user can pass in their own BatchConfig with null input and output for file uploads", "author": "npawar", "createdAt": "2020-12-11T19:10:48Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/BatchConfig.java", "diffHunk": "@@ -28,73 +28,57 @@\n  * Provides all config related to the batch data source, as configured in the table config's ingestion config\n  */\n public class BatchConfig {\n+  private final Map<String, String> _batchConfigMap;\n+\n   private final String _tableNameWithType;\n-  private final String _type;\n   private final String _inputDirURI;\n   private final String _outputDirURI;\n-  private final String _fsClassName;\n-  private final Map<String, String> _fsProps = new HashMap<>();\n+  private final String _inputFsClassName;\n+  private final Map<String, String> _inputFsProps = new HashMap<>();\n+  private final String _outputFsClassName;\n+  private final Map<String, String> _outputFsProps = new HashMap<>();\n   private final FileFormat _inputFormat;\n   private final String _recordReaderClassName;\n   private final String _recordReaderConfigClassName;\n   private final Map<String, String> _recordReaderProps = new HashMap<>();\n \n-  private final Map<String, String> _batchConfigMap = new HashMap<>();\n-\n   public BatchConfig(String tableNameWithType, Map<String, String> batchConfigsMap) {\n-    _tableNameWithType = tableNameWithType;\n-\n-    _type = batchConfigsMap.get(BatchConfigProperties.BATCH_TYPE);\n-    Preconditions.checkState(_type != null, \"Property: %s cannot be null\", BatchConfigProperties.BATCH_TYPE);\n+    _batchConfigMap = batchConfigsMap;\n \n-    String inputDirURIKey = BatchConfigProperties.constructBatchProperty(_type, BatchConfigProperties.INPUT_DIR_URI);\n-    _inputDirURI = batchConfigsMap.get(inputDirURIKey);\n-    Preconditions.checkState(_inputDirURI != null, \"Property: %s cannot be null\", inputDirURIKey);\n+    _tableNameWithType = tableNameWithType;\n \n-    String outputDirURIKey = BatchConfigProperties.constructBatchProperty(_type, BatchConfigProperties.OUTPUT_DIR_URI);\n-    _outputDirURI = batchConfigsMap.get(outputDirURIKey);\n-    Preconditions.checkState(_outputDirURI != null, \"Property: %s cannot be null\", outputDirURIKey);\n+    _inputDirURI = batchConfigsMap.get(BatchConfigProperties.INPUT_DIR_URI);\n+    Preconditions.checkState(_inputDirURI != null, \"Property: %s cannot be null\", BatchConfigProperties.INPUT_DIR_URI);", "originalCommit": "b72f0d37227a181caee299412d8ef11fbc1f36f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTgzNjA1OA==", "url": "https://github.com/apache/pinot/pull/6332#discussion_r541836058", "bodyText": "done", "author": "xiangfu0", "createdAt": "2020-12-13T03:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE3Njc2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "e3660c18d4a7b7c7f19c4b4677a2fefa24061d16", "chunk": "diff --git a/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/BatchConfig.java b/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/BatchConfig.java\nindex eeb4001d8e..780f7111c9 100644\n--- a/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/BatchConfig.java\n+++ b/pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/BatchConfig.java\n\n@@ -44,21 +44,14 @@ public class BatchConfig {\n \n   public BatchConfig(String tableNameWithType, Map<String, String> batchConfigsMap) {\n     _batchConfigMap = batchConfigsMap;\n-\n     _tableNameWithType = tableNameWithType;\n-\n-    _inputDirURI = batchConfigsMap.get(BatchConfigProperties.INPUT_DIR_URI);\n-    Preconditions.checkState(_inputDirURI != null, \"Property: %s cannot be null\", BatchConfigProperties.INPUT_DIR_URI);\n-\n-    _outputDirURI = batchConfigsMap.get(BatchConfigProperties.OUTPUT_DIR_URI);\n-    Preconditions.checkState(_outputDirURI != null, \"Property: %s cannot be null\", BatchConfigProperties.OUTPUT_DIR_URI);\n-\n-    _inputFsClassName = batchConfigsMap.get(BatchConfigProperties.INPUT_FS_CLASS);\n-    _outputFsClassName = batchConfigsMap.get(BatchConfigProperties.OUTPUT_FS_CLASS);\n     String inputFormat = batchConfigsMap.get(BatchConfigProperties.INPUT_FORMAT);\n     Preconditions.checkState(inputFormat != null, \"Property: %s cannot be null\", BatchConfigProperties.INPUT_FORMAT);\n     _inputFormat = FileFormat.valueOf(inputFormat.toUpperCase());\n-\n+    _inputDirURI = batchConfigsMap.get(BatchConfigProperties.INPUT_DIR_URI);\n+    _inputFsClassName = batchConfigsMap.get(BatchConfigProperties.INPUT_FS_CLASS);\n+    _outputDirURI = batchConfigsMap.get(BatchConfigProperties.OUTPUT_DIR_URI);\n+    _outputFsClassName = batchConfigsMap.get(BatchConfigProperties.OUTPUT_FS_CLASS);\n     _recordReaderClassName = batchConfigsMap.get(BatchConfigProperties.RECORD_READER_CLASS);\n     _recordReaderConfigClassName = batchConfigsMap.get(BatchConfigProperties.RECORD_READER_CONFIG_CLASS);\n     for (Map.Entry<String, String> entry : batchConfigsMap.entrySet()) {\n"}}, {"oid": "e3660c18d4a7b7c7f19c4b4677a2fefa24061d16", "url": "https://github.com/apache/pinot/commit/e3660c18d4a7b7c7f19c4b4677a2fefa24061d16", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-12T05:15:52Z", "type": "forcePushed"}, {"oid": "c6b28d840dba677b7dd589af80bf55f7dadf1c6e", "url": "https://github.com/apache/pinot/commit/c6b28d840dba677b7dd589af80bf55f7dadf1c6e", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-13T02:45:23Z", "type": "commit"}, {"oid": "c6b28d840dba677b7dd589af80bf55f7dadf1c6e", "url": "https://github.com/apache/pinot/commit/c6b28d840dba677b7dd589af80bf55f7dadf1c6e", "message": "simplify batch config and corresponding utils", "committedDate": "2020-12-13T02:45:23Z", "type": "forcePushed"}]}