{"pr_number": 208, "pr_title": "Fix #197: Provided  Dockerfile is always skipped in simple Dockerfile mode", "pr_createdAt": "2020-05-21T14:58:35Z", "pr_url": "https://github.com/eclipse/jkube/pull/208", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODcxNTczMw==", "url": "https://github.com/eclipse/jkube/pull/208#discussion_r428715733", "bodyText": "It would be good to split this statement too:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return !containsBuildConfiguration(configs) || Configs.asBoolean(getConfig(Config.add));\n          \n          \n            \n                    if (containsBuildConfiguration(configs)) {\n          \n          \n            \n                        return false;\n          \n          \n            \n                    }        \n          \n          \n            \n                    return Configs.asBoolean(getConfig(Config.add));", "author": "manusa", "createdAt": "2020-05-21T15:09:09Z", "path": "jkube-kit/generator/api/src/main/java/org/eclipse/jkube/generator/api/support/BaseGenerator.java", "diffHunk": "@@ -204,6 +205,9 @@ protected String getAlias() {\n     }\n \n     protected boolean shouldAddImageConfiguration(List<ImageConfiguration> configs) {\n+        if (isSimpleDockerfileMode()) {\n+            return false;\n+        }\n         return !containsBuildConfiguration(configs) || Configs.asBoolean(getConfig(Config.add));", "originalCommit": "24aa029d50f0ba9916e84ed23c6eb5926894a572", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0MjU2Nw==", "url": "https://github.com/eclipse/jkube/pull/208#discussion_r429042567", "bodyText": "Trying to figure out the logic within this statement:\n\nadd: When this set to\u00a0true, then the generator\u00a0adds\u00a0to an existing image configuration. By default this is disabled, so that a generator only kicks in when there are no other image configurations in the build, which are either configured directly for a\u00a0k8s:build\u00a0or already added by a generator which has been run previously.\n\nI think this should translate into this:\n        if (containsBuildConfiguration(configs)) {\n            return Configs.asBoolean(getConfig(Config.add));\n        }        \n        return true;\n\nWhich is more or less what was there and what you did, but the logic is more readable (IMHO)\nI would also change the method name to shouldAddGeneratedImageConfiguration", "author": "manusa", "createdAt": "2020-05-22T04:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODcxNTczMw=="}], "type": "inlineReview"}, {"oid": "fb860e2598b1de6b24ce74f7a541b060c9deb4a3", "url": "https://github.com/eclipse/jkube/commit/fb860e2598b1de6b24ce74f7a541b060c9deb4a3", "message": "Fix #197: Provided  Dockerfile is always skipped in simple Dockerfile mode", "committedDate": "2020-05-21T16:37:52Z", "type": "forcePushed"}, {"oid": "a32319023d658ba8a646bf63dffc08b18944ffe9", "url": "https://github.com/eclipse/jkube/commit/a32319023d658ba8a646bf63dffc08b18944ffe9", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-26T07:13:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzMzEzOQ==", "url": "https://github.com/eclipse/jkube/pull/208#discussion_r430233139", "bodyText": "I think this is related to what we discussed during the stand-up, this example highlights how the contextDir is computed from the actual Dockerfile location.\nExample expects no contextDirto be defined and also Dockerfile to be located under src/main/docker\nhttps://github.com/eclipse/jkube/tree/a32319023d658ba8a646bf63dffc08b18944ffe9/quickstarts/maven/docker-file-provided#contextdir-and-dockerfile", "author": "manusa", "createdAt": "2020-05-26T08:12:42Z", "path": "quickstarts/maven/docker-file-provided/pom.xml", "diffHunk": "@@ -103,7 +103,8 @@\n                                 <image>\n                                     <name>jkube/docker-file-provided</name>\n                                     <build>\n-                                        <dockerFile>subdir/Dockerfile</dockerFile>", "originalCommit": "a32319023d658ba8a646bf63dffc08b18944ffe9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91fa0ffbee8943bea5e2db63a866361dba22ca99", "url": "https://github.com/eclipse/jkube/commit/91fa0ffbee8943bea5e2db63a866361dba22ca99", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-26T12:06:27Z", "type": "forcePushed"}, {"oid": "0320fd381bd12257f086783386e8d241f12fa472", "url": "https://github.com/eclipse/jkube/commit/0320fd381bd12257f086783386e8d241f12fa472", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-28T10:41:28Z", "type": "forcePushed"}, {"oid": "bdac4b3511d1fca7844df5fe3215e5b2e163cbdb", "url": "https://github.com/eclipse/jkube/commit/bdac4b3511d1fca7844df5fe3215e5b2e163cbdb", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-28T10:49:24Z", "type": "forcePushed"}, {"oid": "ad1bee1df48773e14d231c01c62d0ae5df80a7de", "url": "https://github.com/eclipse/jkube/commit/ad1bee1df48773e14d231c01c62d0ae5df80a7de", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-28T12:14:55Z", "type": "forcePushed"}, {"oid": "23e20461f464e01161205b3a9c841d6b6478178b", "url": "https://github.com/eclipse/jkube/commit/23e20461f464e01161205b3a9c841d6b6478178b", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-28T14:17:33Z", "type": "forcePushed"}, {"oid": "cfe229e5e44106143acf9981a0eb483d1f9620a9", "url": "https://github.com/eclipse/jkube/commit/cfe229e5e44106143acf9981a0eb483d1f9620a9", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-05-28T14:52:52Z", "type": "forcePushed"}, {"oid": "3ce4f52429edf6324943ab81b56e83aaceb70445", "url": "https://github.com/eclipse/jkube/commit/3ce4f52429edf6324943ab81b56e83aaceb70445", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-06-02T13:36:52Z", "type": "forcePushed"}, {"oid": "a447a3d38bc054ec9d2e719eb2c42a1333d7e7e2", "url": "https://github.com/eclipse/jkube/commit/a447a3d38bc054ec9d2e719eb2c42a1333d7e7e2", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-06-02T14:03:14Z", "type": "forcePushed"}, {"oid": "ce7d0b4407979917b6d4552b2ac9f97d9e8aed65", "url": "https://github.com/eclipse/jkube/commit/ce7d0b4407979917b6d4552b2ac9f97d9e8aed65", "message": "Fix #197: Provided  Dockerfile is always skipped in simple Dockerfile mode", "committedDate": "2020-06-05T13:55:09Z", "type": "commit"}, {"oid": "d0df47f2d49bbc424dec74425a2ac9829dfbe9bd", "url": "https://github.com/eclipse/jkube/commit/d0df47f2d49bbc424dec74425a2ac9829dfbe9bd", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-06-05T15:45:07Z", "type": "forcePushed"}, {"oid": "64d97ddaf382d97d787e870984785b3a077e3539", "url": "https://github.com/eclipse/jkube/commit/64d97ddaf382d97d787e870984785b3a077e3539", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-06-05T16:54:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYwNDQwNQ==", "url": "https://github.com/eclipse/jkube/pull/208#discussion_r436604405", "bodyText": "This example showcases the use case of a docker file provided with just the contextDir configuration tag. Adding a dockerFile configuration defeats the purpose.\nExample should work just by providing this setting:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                    <contextDir>${project.basedir}</contextDir>\n          \n          \n            \n                                                    <dockerFile>${project.basedir}/src/main/assembly-dockerfile/Dockerfile</dockerFile>\n          \n          \n            \n                                                    <contextDir>${project.basedir}/src/main/assembly-dockerfile</contextDir>", "author": "manusa", "createdAt": "2020-06-08T10:38:47Z", "path": "quickstarts/maven/docker-file-provided/pom.xml", "diffHunk": "@@ -147,6 +147,7 @@\n                                     <name>jkube/context-and-assembly</name>\n                                     <build>\n                                         <contextDir>${project.basedir}</contextDir>\n+                                        <dockerFile>${project.basedir}/src/main/assembly-dockerfile/Dockerfile</dockerFile>", "originalCommit": "64d97ddaf382d97d787e870984785b3a077e3539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYwNTU0NA==", "url": "https://github.com/eclipse/jkube/pull/208#discussion_r436605544", "bodyText": "Maybe the quickstart would be clearer if we provided a COPY statement with a file that exists in the project root directory in order to showcase how the inferred contextdirectory + assembly behaves.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            COPY maven/target/zero-config-dockerfile.jar /tmp/zero-config-dockerfile.jar\n          \n          \n            \n            CMD [\"java\", \"-jar\", \"/tmp/zero-config-dockerfile.jar\"]\n          \n          \n            \n            COPY maven/target/zero-config-dockerfile.jar /tmp/zero-config-dockerfile.jar\n          \n          \n            \n            COPY maven/static-dir-in-project-root/my-file.txt /tmp/my-file.txt\n          \n          \n            \n            CMD [\"java\", \"-jar\", \"/tmp/zero-config-dockerfile.jar\"]", "author": "manusa", "createdAt": "2020-06-08T10:41:01Z", "path": "quickstarts/maven/simple-dockerfile/Dockerfile", "diffHunk": "@@ -0,0 +1,17 @@\n+#\n+# Copyright (c) 2019 Red Hat, Inc.\n+# This program and the accompanying materials are made\n+# available under the terms of the Eclipse Public License 2.0\n+# which is available at:\n+#\n+#     https://www.eclipse.org/legal/epl-2.0/\n+#\n+# SPDX-License-Identifier: EPL-2.0\n+#\n+# Contributors:\n+#   Red Hat, Inc. - initial API and implementation\n+#\n+\n+FROM openjdk:latest\n+COPY maven/target/zero-config-dockerfile.jar /tmp/zero-config-dockerfile.jar\n+CMD [\"java\", \"-jar\", \"/tmp/zero-config-dockerfile.jar\"]", "originalCommit": "64d97ddaf382d97d787e870984785b3a077e3539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7677d0089030dfb7248332c143110c22a802752", "url": "https://github.com/eclipse/jkube/commit/e7677d0089030dfb7248332c143110c22a802752", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-06-09T05:12:46Z", "type": "commit"}, {"oid": "e7677d0089030dfb7248332c143110c22a802752", "url": "https://github.com/eclipse/jkube/commit/e7677d0089030dfb7248332c143110c22a802752", "message": "Send Dockerfile's parent directory as zip archive in case of no Docker contextDir being provided\n\n+ Updated DockerAssemblyManager to handle no contextDir case\n+ Added Simple Dockerfile sample", "committedDate": "2020-06-09T05:12:46Z", "type": "forcePushed"}]}