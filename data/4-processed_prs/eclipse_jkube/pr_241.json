{"pr_number": 241, "pr_title": "refactor: Docker-file-simple quickstart", "pr_createdAt": "2020-06-11T06:13:33Z", "pr_url": "https://github.com/eclipse/jkube/pull/241", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2NjkzMg==", "url": "https://github.com/eclipse/jkube/pull/241#discussion_r438566932", "bodyText": "Should we add additional steps for adding Deployment and Service fragment for port configuration here?", "author": "rohanKanojia", "createdAt": "2020-06-11T06:23:21Z", "path": "quickstarts/maven/docker-file-simple/README.md", "diffHunk": "@@ -0,0 +1,99 @@\n+# Eclipse JKube sample with simple Dockerfile mode\n+\n+You can build your Docker images with just providing one `Dockerfile` in your project root directory and Eclipse JKube\n+will pick it up for docker build. \n+For simple `Dockerfile` mode, your project's current directory is provided as docker context directory for build.\n+If you want to copy some files from your current directory(`target/zero-config-dockerfile.jar` in this case), you need\n+to prefix project directory contents with default assembly name(i.e `maven`). So your `Dockerfile` would look like this:\n+```\n+FROM openjdk:latest\n+COPY maven/target/docker-file-simple.jar /deployments/docker-file-simple.jar\n+COPY maven/static-dir-in-project-root/my-file.txt /tmp/my-file.txt\n+CMD [\"java\", \"-jar\", \"/deployments/docker-file-simple.jar\"]\n+```\n+\n+# Building Docker image\n+```\n+$ mvn k8s:build\n+[INFO] Scanning for projects...\n+[INFO] \n+[INFO] ----------------< org.eclipse.jkube:docker-file-simple >----------------\n+[INFO] Building Eclipse JKube :: Quickstarts :: Maven :: Dockerfile :: Simple 1.0.0-SNAPSHOT\n+[INFO] --------------------------------[ jar ]---------------------------------\n+[INFO] \n+[INFO] --- kubernetes-maven-plugin:1.0.0-SNAPSHOT:build (default-cli) @ docker-file-simple ---\n+[INFO] k8s: Running in Kubernetes mode\n+[INFO] k8s: Building Docker image in Kubernetes mode\n+[INFO] k8s: [jkube/docker-file-simple:latest]: Created docker-build.tar in 261 milliseconds\n+[INFO] k8s: [jkube/docker-file-simple:latest]: Built image sha256:52d46\n+[INFO] ------------------------------------------------------------------------\n+[INFO] BUILD SUCCESS\n+[INFO] ------------------------------------------------------------------------\n+[INFO] Total time:  2.977 s\n+[INFO] Finished at: 2020-06-11T07:59:44+02:00\n+[INFO] ------------------------------------------------------------------------\n+$ docker images | grep docker-file-simple\n+jkube/docker-file-simple                  1.0                         c8df6da232b3        8 seconds ago       516MB\n+```\n+\n+# Generating Kubernetes Manifests and Deploying to Kubernetes\n+```\n+$ mvn k8s:resource k8s:apply\n+[INFO] Scanning for projects...\n+[INFO] \n+[INFO] ----------------< org.eclipse.jkube:docker-file-simple >----------------\n+[INFO] Building Eclipse JKube :: Quickstarts :: Maven :: Dockerfile :: Simple 1.0.0-SNAPSHOT\n+[INFO] --------------------------------[ jar ]---------------------------------\n+[INFO] \n+[INFO] --- kubernetes-maven-plugin:1.0.0-SNAPSHOT:resource (default-cli) @ docker-file-simple ---\n+[INFO] k8s: jkube-controller: Adding a default Deployment\n+[INFO] k8s: jkube-service: Adding a default service 'docker-file-simple' with ports [8080]\n+[INFO] k8s: jkube-healthcheck-spring-boot: Adding readiness probe on port 8080, path='/actuator/health', scheme='HTTP', with initial delay 10 seconds\n+[INFO] k8s: jkube-healthcheck-spring-boot: Adding liveness probe on port 8080, path='/actuator/health', scheme='HTTP', with initial delay 180 seconds\n+[INFO] k8s: jkube-revision-history: Adding revision history limit to 2\n+[INFO] k8s: validating /home/user/00-MN/projects/forks/jkube/quickstarts/maven/docker-file-simple/target/classes/META-INF/jkube/kubernetes/docker-file-simple-deployment.yml resource\n+[INFO] k8s: validating /home/user/00-MN/projects/forks/jkube/quickstarts/maven/docker-file-simple/target/classes/META-INF/jkube/kubernetes/docker-file-simple-service.yml resource\n+[INFO] \n+[INFO] --- kubernetes-maven-plugin:1.0.0-SNAPSHOT:apply (default-cli) @ docker-file-simple ---\n+[INFO] k8s: Using Kubernetes at https://172.17.0.3:8443/ in namespace default with manifest /home/user/00-MN/projects/forks/jkube/quickstarts/maven/docker-file-simple/target/classes/META-INF/jkube/kubernetes.yml \n+[INFO] k8s: Using namespace: default\n+[INFO] k8s: Updating a Service from kubernetes.yml\n+[INFO] k8s: Updated Service: target/jkube/applyJson/default/service-docker-file-simple-1.json\n+[INFO] k8s: Updating Deployment from kubernetes.yml\n+[INFO] k8s: Updated Deployment: target/jkube/applyJson/default/deployment-docker-file-simple-2.json\n+[INFO] k8s: HINT: Use the command `kubectl get pods -w` to watch your pods start up\n+[INFO] ------------------------------------------------------------------------\n+[INFO] BUILD SUCCESS\n+[INFO] ------------------------------------------------------------------------\n+[INFO] Total time:  7.688 s\n+[INFO] Finished at: 2020-06-11T08:01:21+02:00\n+[INFO] ------------------------------------------------------------------------\n+$ kubectl get pods\n+NAME                                      READY   STATUS             RESTARTS   AGE\n+docker-file-simple-686cddc6b9-lvgtv       0/1     Running            0          84s\n+$ kubectl logs pod/zero-config-dockerfile-686cddc6b9-lvgtv", "originalCommit": "afb87640f447274713a39dc06deb51f8446bc135", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2ODQwNg==", "url": "https://github.com/eclipse/jkube/pull/241#discussion_r438568406", "bodyText": "I'm not following\nService config is added in pom.xml configuration (36 & 37), this enabled the generation of service and deployment YAML manifests. Do you mean to describe that in the readme too?", "author": "manusa", "createdAt": "2020-06-11T06:27:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2NjkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3MDExMQ==", "url": "https://github.com/eclipse/jkube/pull/241#discussion_r438570111", "bodyText": "Umm, yeah. Does generated Deployment manifest contains ContainerPort?", "author": "rohanKanojia", "createdAt": "2020-06-11T06:31:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2NjkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NTgxMg==", "url": "https://github.com/eclipse/jkube/pull/241#discussion_r438575812", "bodyText": "Does generated Deployment manifest contains ContainerPort?\n\nNope, Deployment manifest doesn't contain the containerPort entry(ies). This field is purely informational, so as the service is already there and quickstart will work either way as expected, maybe adding this extra configurations can be misleading (we already opened #240 to take care of this > deployment will be 100% compliant once fixed).\n\nUmm, yeah.\n\nI'll add a paragraph with the explanation.", "author": "manusa", "createdAt": "2020-06-11T06:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2NjkzMg=="}], "type": "inlineReview"}, {"oid": "da6b62815f365062fa40859c72ed23fdbd898f96", "url": "https://github.com/eclipse/jkube/commit/da6b62815f365062fa40859c72ed23fdbd898f96", "message": "refactor: Docker-file-simple quickstart\n\n- Removed unnecessary dependencies + tests to speed up build times (quickstarts CI job)\n- Added minimum configuration to expose a service\n- Made application runnable\n- Static file is served from rest endpoint\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-06-11T06:51:28Z", "type": "commit"}, {"oid": "da6b62815f365062fa40859c72ed23fdbd898f96", "url": "https://github.com/eclipse/jkube/commit/da6b62815f365062fa40859c72ed23fdbd898f96", "message": "refactor: Docker-file-simple quickstart\n\n- Removed unnecessary dependencies + tests to speed up build times (quickstarts CI job)\n- Added minimum configuration to expose a service\n- Made application runnable\n- Static file is served from rest endpoint\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-06-11T06:51:28Z", "type": "forcePushed"}]}