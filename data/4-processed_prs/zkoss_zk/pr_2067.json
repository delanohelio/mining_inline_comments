{"pr_number": 2067, "pr_title": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the\u2026", "pr_createdAt": "2020-07-27T10:39:29Z", "pr_url": "https://github.com/zkoss/zk/pull/2067", "timeline": [{"oid": "d19bf4c10e23e0a94ea6b9c684024f58057ee334", "url": "https://github.com/zkoss/zk/commit/d19bf4c10e23e0a94ea6b9c684024f58057ee334", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem", "committedDate": "2020-07-28T07:35:11Z", "type": "forcePushed"}, {"oid": "294de9c12e19b0a4ee61eeffcc6247e9b94a5df6", "url": "https://github.com/zkoss/zk/commit/294de9c12e19b0a4ee61eeffcc6247e9b94a5df6", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem", "committedDate": "2020-07-28T07:54:24Z", "type": "forcePushed"}, {"oid": "e3250d04ee500c6e16fba3b25233209fffe0bf22", "url": "https://github.com/zkoss/zk/commit/e3250d04ee500c6e16fba3b25233209fffe0bf22", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem", "committedDate": "2020-07-28T08:17:15Z", "type": "forcePushed"}, {"oid": "df7fbb448933959a7b2feb682003675ff3d74224", "url": "https://github.com/zkoss/zk/commit/df7fbb448933959a7b2feb682003675ff3d74224", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem\nClose menupopup, regain the focus", "committedDate": "2020-07-28T08:39:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ1OTY1NQ==", "url": "https://github.com/zkoss/zk/pull/2067#discussion_r461459655", "bodyText": "modify _curIndex", "author": "scribetw", "createdAt": "2020-07-28T09:50:20Z", "path": "zul/src/archive/web/js/zul/menu/Menuitem.js", "diffHunk": "@@ -370,8 +372,20 @@ zul.menu.Menuitem = zk.$extends(zul.LabelImageWidget, {\n \t\treturn this.$n('a');\n \t},\n \t_doMouseEnter: function (evt) {\n-\t\tif (zul.menu._nOpen || this.isTopmost())\n+\t\tvar isTopmost = this.isTopmost();\n+\t\tif (zul.menu._nOpen || isTopmost)\n \t\t\tzWatch.fire('onFloatUp', this); //notify all\n+\t\tif (!isTopmost && !this._disabled) {\n+\t\t\tif (this.parent)\n+\t\t\t\tthis.parent.removeActive_();\n+\t\t\tthis.$class._addActive(this);", "originalCommit": "df7fbb448933959a7b2feb682003675ff3d74224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ1OTc4OQ==", "url": "https://github.com/zkoss/zk/pull/2067#discussion_r461459789", "bodyText": "_curIndex = -1", "author": "scribetw", "createdAt": "2020-07-28T09:50:32Z", "path": "zul/src/archive/web/js/zul/menu/Menuitem.js", "diffHunk": "@@ -370,8 +372,20 @@ zul.menu.Menuitem = zk.$extends(zul.LabelImageWidget, {\n \t\treturn this.$n('a');\n \t},\n \t_doMouseEnter: function (evt) {\n-\t\tif (zul.menu._nOpen || this.isTopmost())\n+\t\tvar isTopmost = this.isTopmost();\n+\t\tif (zul.menu._nOpen || isTopmost)\n \t\t\tzWatch.fire('onFloatUp', this); //notify all\n+\t\tif (!isTopmost && !this._disabled) {\n+\t\t\tif (this.parent)\n+\t\t\t\tthis.parent.removeActive_();\n+\t\t\tthis.$class._addActive(this);\n+\t\t}\n+\t},\n+\t_doMouseLeave: function (evt) {\n+\t\tvar isTopmost = this.isTopmost();\n+\t\tif (!isTopmost && !this._disabled) {\n+\t\t\tthis.$class._rmActive(this);", "originalCommit": "df7fbb448933959a7b2feb682003675ff3d74224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2MjEyOA==", "url": "https://github.com/zkoss/zk/pull/2067#discussion_r461462128", "bodyText": "activating the menuitem, regain the focus", "author": "scribetw", "createdAt": "2020-07-28T09:54:39Z", "path": "zul/src/archive/web/js/zul/menu/Menupopup.js", "diffHunk": "@@ -358,16 +354,18 @@ zul.menu.Menupopup = zk.$extends(zul.wgt.Popup, {\n \t\t\t\tvar root = _getRootMenu(this);\n \t\t\t\tif (root && (root = root._getPrevVisibleMenu()))\n \t\t\t\t\t_activateNextMenu(root);\n-\t\t\t\telse // the parent is not menu widget\n+\t\t\t\telse { // the parent is not menu widget\n+\t\t\t\t\tvar ref = this._fakeParent;\n \t\t\t\t\tthis.close();\n-\n+\t\t\t\t\tif (ref) ref.focus();", "originalCommit": "df7fbb448933959a7b2feb682003675ff3d74224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "98c21ba203d05a8d80ddb5094fb452d8d9909b77", "url": "https://github.com/zkoss/zk/commit/98c21ba203d05a8d80ddb5094fb452d8d9909b77", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem\nClose menupopup, regain the focus", "committedDate": "2020-07-29T04:27:04Z", "type": "forcePushed"}, {"oid": "7ee01f981c5bd1c77ab267137fd851d917c83362", "url": "https://github.com/zkoss/zk/commit/7ee01f981c5bd1c77ab267137fd851d917c83362", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem\nClose menupopup, regain the focus", "committedDate": "2020-07-29T06:53:45Z", "type": "commit"}, {"oid": "7ee01f981c5bd1c77ab267137fd851d917c83362", "url": "https://github.com/zkoss/zk/commit/7ee01f981c5bd1c77ab267137fd851d917c83362", "message": "refine ZK-4598: Menupopup mouse hovering on a menu/menuitem moves the active item\nOpen menupopup by keyboard, focus on the first menuitem\nClose menupopup, regain the focus", "committedDate": "2020-07-29T06:53:45Z", "type": "forcePushed"}]}