{"pr_number": 2323, "pr_title": "ZK-4084: New added header is invisible when all headers have fixed width", "pr_createdAt": "2020-12-22T08:38:08Z", "pr_url": "https://github.com/zkoss/zk/pull/2323", "timeline": [{"oid": "d9a9e7af02e3de0837cd0a7bac19045610820921", "url": "https://github.com/zkoss/zk/commit/d9a9e7af02e3de0837cd0a7bac19045610820921", "message": "zk-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-22T08:50:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3NzM1OA==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547177358", "bodyText": "##zats##", "author": "scribetw", "createdAt": "2020-12-22T09:50:25Z", "path": "zktest/src/archive/test2/config.properties", "diffHunk": "@@ -2892,6 +2892,7 @@ B90-ZK-4431.zul=A,E,Multislider\n ##zats##B95-ZK-3318.zul=A,E,sizedByContent,Scrollbar,hflex,Tree\r\n ##zats##B95-ZK-4744.zul=A,E,scrollLeft,resize,flex,borderlayout,doModal\r\n ##ztl##B95-ZK-4741.zul=A,E,Tree,Firefox,scrollTop,focus-a\r\n+##ztl##B95-ZK-4084.zul=A,E,Width,AddChild\r", "originalCommit": "d9a9e7af02e3de0837cd0a7bac19045610820921", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3Nzc1Mg==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547177752", "bodyText": "remove", "author": "scribetw", "createdAt": "2020-12-22T09:51:14Z", "path": "zktest/test/java/org/zkoss/zktest/zats/test2/B95_ZK_4084Test.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/* B95_ZK_4084Test.java\n+\n+\t\tPurpose:\n+\n+\t\tDescription:\n+\n+\t\tHistory:\n+\t\t\t\tTue Dec 22 15:30:35 CST 2020, Created by katherinelin\n+\n+Copyright (C) 2020 Potix Corporation. All Rights Reserved.\n+*/\n+package org.zkoss.zktest.zats.test2;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.zkoss.zktest.zats.WebDriverTestCase;\n+\n+public class B95_ZK_4084Test extends WebDriverTestCase {\n+\t@Test\n+\tpublic void test() {\n+\t\tconnect();\n+\t\tclick(jq(\"@button\").eq(0));\n+\t\twaitResponse();\n+\t\tSystem.out.println(jq(\".z-listheader-sorticon\").eq(2).width());", "originalCommit": "d9a9e7af02e3de0837cd0a7bac19045610820921", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTM1Ng==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547179356", "bodyText": "Assert.assertNotEquals(0, jq(\".z-listheader\").eq(2).width());\nAssert listheader is not 400", "author": "scribetw", "createdAt": "2020-12-22T09:54:26Z", "path": "zktest/test/java/org/zkoss/zktest/zats/test2/B95_ZK_4084Test.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/* B95_ZK_4084Test.java\n+\n+\t\tPurpose:\n+\n+\t\tDescription:\n+\n+\t\tHistory:\n+\t\t\t\tTue Dec 22 15:30:35 CST 2020, Created by katherinelin\n+\n+Copyright (C) 2020 Potix Corporation. All Rights Reserved.\n+*/\n+package org.zkoss.zktest.zats.test2;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.zkoss.zktest.zats.WebDriverTestCase;\n+\n+public class B95_ZK_4084Test extends WebDriverTestCase {\n+\t@Test\n+\tpublic void test() {\n+\t\tconnect();\n+\t\tclick(jq(\"@button\").eq(0));\n+\t\twaitResponse();\n+\t\tSystem.out.println(jq(\".z-listheader-sorticon\").eq(2).width());\n+\t\tAssert.assertTrue(jq(\".z-listheader-sorticon\").eq(2).width() > 0);", "originalCommit": "d9a9e7af02e3de0837cd0a7bac19045610820921", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4MTMxMQ==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547181311", "bodyText": "Assert listheader is 400", "author": "scribetw", "createdAt": "2020-12-22T09:58:10Z", "path": "zktest/test/java/org/zkoss/zktest/zats/test2/B95_ZK_4084Test.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/* B95_ZK_4084Test.java\n+\n+\t\tPurpose:\n+\n+\t\tDescription:\n+\n+\t\tHistory:\n+\t\t\t\tTue Dec 22 15:30:35 CST 2020, Created by katherinelin\n+\n+Copyright (C) 2020 Potix Corporation. All Rights Reserved.\n+*/\n+package org.zkoss.zktest.zats.test2;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.zkoss.zktest.zats.WebDriverTestCase;\n+\n+public class B95_ZK_4084Test extends WebDriverTestCase {\n+\t@Test\n+\tpublic void test() {\n+\t\tconnect();\n+\t\tclick(jq(\"@button\").eq(0));\n+\t\twaitResponse();\n+\t\tSystem.out.println(jq(\".z-listheader-sorticon\").eq(2).width());\n+\t\tAssert.assertTrue(jq(\".z-listheader-sorticon\").eq(2).width() > 0);\n+\t\tclick(jq(\"@button\").eq(1));\n+\t\twaitResponse();\n+\t\tSystem.out.println(jq(\".z-listheader-sorticon\").eq(2).isVisible());\n+\t\tAssert.assertEquals(jq(\".z-listheader-sorticon\").eq(2).width(), 0);", "originalCommit": "d9a9e7af02e3de0837cd0a7bac19045610820921", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bbc7e104cd30240882c78ed4ff433d9c725c8cef", "url": "https://github.com/zkoss/zk/commit/bbc7e104cd30240882c78ed4ff433d9c725c8cef", "message": "zk-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-23T08:02:12Z", "type": "forcePushed"}, {"oid": "309a4dc495c8955658b0c4c40417300a03856a77", "url": "https://github.com/zkoss/zk/commit/309a4dc495c8955658b0c4c40417300a03856a77", "message": "zk-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-23T08:04:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg0ODk1Nw==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547848957", "bodyText": "shouldFix", "author": "scribetw", "createdAt": "2020-12-23T09:23:18Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -800,6 +800,7 @@ zul.mesh.MeshWidget = zk.$extends(zul.Widget, {\n \t\t\tif (this._cssflex && this.isChildrenFlex()) return;\r\n \t\t\tvar empty = true,\r\n \t\t\t\tflex = false,\r\n+\t\t\t\taddHead = false,\r", "originalCommit": "309a4dc495c8955658b0c4c40417300a03856a77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg1OTYwNg==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547859606", "bodyText": "check !frozen && ehead.style.width first", "author": "scribetw", "createdAt": "2020-12-23T09:34:48Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -820,6 +821,9 @@ zul.mesh.MeshWidget = zk.$extends(zul.Widget, {\n \t\t\t\t\tif (w.getLabel() || w.getImage() || w.nChildren) {\r\n \t\t\t\t\t\temptyHeader = false;\r\n \t\t\t\t\t\tempty = false;\r\n+\t\t\t\t\t\tif (w.getWidth() == undefined) {\r\n+\t\t\t\t\t\t\taddHead = true;\r", "originalCommit": "309a4dc495c8955658b0c4c40417300a03856a77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg2MDM1NQ==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r547860355", "bodyText": "return a || b", "author": "scribetw", "createdAt": "2020-12-23T09:35:34Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -843,7 +847,11 @@ zul.mesh.MeshWidget = zk.$extends(zul.Widget, {\n \t\t\t\t\tdelete w._nhflexbak;\r\n \t\t\t\t}\r\n \t\t\t}\r\n-\t\t\treturn old != this.ehead.style.display;\r\n+\t\t\tif (addHead) {\r", "originalCommit": "309a4dc495c8955658b0c4c40417300a03856a77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4688b46d71045f00508a1efc8b4b1212cabfd819", "url": "https://github.com/zkoss/zk/commit/4688b46d71045f00508a1efc8b4b1212cabfd819", "message": "zk-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-24T01:43:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ2OTM4OA==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548469388", "bodyText": "should see 3", "author": "scribetw", "createdAt": "2020-12-24T09:41:13Z", "path": "zktest/src/archive/test2/B95-ZK-4084.zul", "diffHunk": "@@ -0,0 +1,40 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+B95-ZK-4084.zul\n+\n+\t\tPurpose:\n+\n+\t\tDescription:\n+\n+\t\tHistory:\n+\t\t\t\tThu Dec 17 11:01:10 CST 2020, Created by katherinelin\n+\n+Copyright (C) 2020 Potix Corporation. All Rights Reserved.\n+-->\n+<zk>\n+\t<label multiline=\"true\">\n+\t\t1. click the append button, should append the new listheader.", "originalCommit": "4688b46d71045f00508a1efc8b4b1212cabfd819", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ2OTc2NA==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548469764", "bodyText": "assertEquals(400, jq(\".z-listhead\").width());", "author": "scribetw", "createdAt": "2020-12-24T09:42:16Z", "path": "zktest/test/java/org/zkoss/zktest/zats/test2/B95_ZK_4084Test.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/* B95_ZK_4084Test.java\n+\n+\t\tPurpose:\n+\n+\t\tDescription:\n+\n+\t\tHistory:\n+\t\t\t\tTue Dec 22 15:30:35 CST 2020, Created by katherinelin\n+\n+Copyright (C) 2020 Potix Corporation. All Rights Reserved.\n+*/\n+package org.zkoss.zktest.zats.test2;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.zkoss.zktest.zats.WebDriverTestCase;\n+\n+public class B95_ZK_4084Test extends WebDriverTestCase {\n+\t@Test\n+\tpublic void test() {\n+\t\tconnect();\n+\t\tclick(jq(\"@button\").eq(0));\n+\t\twaitResponse();\n+\t\tAssert.assertNotEquals(0, jq(\".z-listheader\").eq(2).width());\n+\t\tAssert.assertNotEquals(400, jq(\".z-listhead\").width());\n+\t\tclick(jq(\"@button\").eq(1));\n+\t\twaitResponse();\n+\t\tAssert.assertEquals(jq(\".z-listhead\").width(), 400);", "originalCommit": "4688b46d71045f00508a1efc8b4b1212cabfd819", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ3MTAxNQ==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548471015", "bodyText": "shouldCheckEmptyWidth = !this.frozen && this.eheadtbl && this.eheadtbl.style.width", "author": "scribetw", "createdAt": "2020-12-24T09:46:11Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -800,6 +800,7 @@ zul.mesh.MeshWidget = zk.$extends(zul.Widget, {\n \t\t\tif (this._cssflex && this.isChildrenFlex()) return;\r\n \t\t\tvar empty = true,\r\n \t\t\t\tflex = false,\r\n+\t\t\t\tshouldFix = false,\r", "originalCommit": "4688b46d71045f00508a1efc8b4b1212cabfd819", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ3MjIzMg==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548472232", "bodyText": "if (shouldCheckEmptyWidth && w.getWidth())", "author": "scribetw", "createdAt": "2020-12-24T09:49:43Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -820,6 +821,9 @@ zul.mesh.MeshWidget = zk.$extends(zul.Widget, {\n \t\t\t\t\tif (w.getLabel() || w.getImage() || w.nChildren) {\r\n \t\t\t\t\t\temptyHeader = false;\r\n \t\t\t\t\t\tempty = false;\r\n+\t\t\t\t\t\tif (!this.frozen && this.eheadtbl.style.width && w.getWidth() == undefined) {\r", "originalCommit": "4688b46d71045f00508a1efc8b4b1212cabfd819", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c7dc8b5dc7a8b63fd7c39a0a1682a2593358ce1a", "url": "https://github.com/zkoss/zk/commit/c7dc8b5dc7a8b63fd7c39a0a1682a2593358ce1a", "message": "zk-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-24T10:10:16Z", "type": "forcePushed"}, {"oid": "3ff596349637ecd479321c12a58c02232f2b4a3c", "url": "https://github.com/zkoss/zk/commit/3ff596349637ecd479321c12a58c02232f2b4a3c", "message": "Merge pull request #2329 from scribetw/refine-4750\n\nSkip ZATS test for wcag tree \"set-size\". (2)", "committedDate": "2020-12-24T06:31:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4ODc5Ng==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548488796", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\twd = _getMinWd(wgt) + (zk(wgt.ebody).hasVScroll() ? jq.scrollbarWidth() : 0) + bdw, // has to call _getMinWd first so wgt._minWd will be available\n          \n          \n            \n            \t\t\t\twd = _getMinWd(wgt) + bdw, // has to call _getMinWd first so wgt._minWd will be available", "author": "scribetw", "createdAt": "2020-12-24T10:43:59Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -225,7 +225,7 @@ it will be useful, but WITHOUT ANY WARRANTY.\n \t\t\tmeshmin = wgt._hflex == 'min';\r\n \t\tif (!wgt.head && (meshmin || sbc)) {\r\n \t\t\tvar bdw = zk(wgt.$n()).padBorderWidth(),\r\n-\t\t\t\twd = _getMinWd(wgt) + bdw, // has to call _getMinWd first so wgt._minWd will be available\r\n+\t\t\t\twd = _getMinWd(wgt) + (zk(wgt.ebody).hasVScroll() ? jq.scrollbarWidth() : 0) + bdw, // has to call _getMinWd first so wgt._minWd will be available\r", "originalCommit": "fffdc0c513d3b1f2b486c7b515ee0eff83acc295", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4OTMyMg==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548489322", "bodyText": "shouldn't be nested", "author": "scribetw", "createdAt": "2020-12-24T10:45:54Z", "path": "zul/src/archive/web/js/zul/mesh/MeshWidget.js", "diffHunk": "@@ -820,6 +822,9 @@ zul.mesh.MeshWidget = zk.$extends(zul.Widget, {\n \t\t\t\t\tif (w.getLabel() || w.getImage() || w.nChildren) {\r\n \t\t\t\t\t\temptyHeader = false;\r\n \t\t\t\t\t\tempty = false;\r\n+\t\t\t\t\t\tif (shouldCheckEmptyWidth && w.getWidth()) {\r", "originalCommit": "fffdc0c513d3b1f2b486c7b515ee0eff83acc295", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4OTQxMQ==", "url": "https://github.com/zkoss/zk/pull/2323#discussion_r548489411", "bodyText": "Need MeshWidget,HeadWidget at least", "author": "scribetw", "createdAt": "2020-12-24T10:46:08Z", "path": "zktest/src/archive/test2/config.properties", "diffHunk": "@@ -2897,6 +2897,7 @@ B90-ZK-4431.zul=A,E,Multislider\n ##zats##B95-ZK-4753.zul=A,E,Navbar,Nav,Navitem,focus,a11y\r\n ##zats##B95-ZK-4732.zul=A,E,Tree,client,ROD,scope\r\n ##zats##B95-ZK-4732-2.zul=A,E,Tree,client,ROD,scope\r\n+##zats##B95-ZK-4084.zul=A,E,Width,AddChild\r", "originalCommit": "fffdc0c513d3b1f2b486c7b515ee0eff83acc295", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce2c0acaffd6e73afff014d4715d95380644246d", "url": "https://github.com/zkoss/zk/commit/ce2c0acaffd6e73afff014d4715d95380644246d", "message": "ZK-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-25T01:59:31Z", "type": "forcePushed"}, {"oid": "110db96ec9ac284b26129f9fd006257b75879cbb", "url": "https://github.com/zkoss/zk/commit/110db96ec9ac284b26129f9fd006257b75879cbb", "message": "ZK-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-25T02:00:44Z", "type": "forcePushed"}, {"oid": "45a108420645a9c9848546de58356b60728cf474", "url": "https://github.com/zkoss/zk/commit/45a108420645a9c9848546de58356b60728cf474", "message": "ZK-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-25T02:58:30Z", "type": "commit"}, {"oid": "45a108420645a9c9848546de58356b60728cf474", "url": "https://github.com/zkoss/zk/commit/45a108420645a9c9848546de58356b60728cf474", "message": "ZK-4084: New added header is invisible when all headers have fixed width", "committedDate": "2020-12-25T02:58:30Z", "type": "forcePushed"}]}