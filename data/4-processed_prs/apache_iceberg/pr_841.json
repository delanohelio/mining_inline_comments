{"pr_number": 841, "pr_title": "Upgrade Hive to 2.3.6 for Iceberg", "pr_createdAt": "2020-03-13T02:51:52Z", "pr_url": "https://github.com/apache/iceberg/pull/841", "timeline": [{"oid": "9f57f0297b9c8d7661dedda5fd69a2290316e18d", "url": "https://github.com/apache/iceberg/commit/9f57f0297b9c8d7661dedda5fd69a2290316e18d", "message": "Upgrade Hive to 2.3.6 for Iceberg", "committedDate": "2020-03-13T02:48:42Z", "type": "commit"}, {"oid": "187a701399ff3f6e7445830965b84c2084a9b952", "url": "https://github.com/apache/iceberg/commit/187a701399ff3f6e7445830965b84c2084a9b952", "message": "Minor changes", "committedDate": "2020-03-13T03:52:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAyMzYwMA==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392023600", "bodyText": "Use reflection to handle the API difference between Hive 1.2.1 and 2.3.6.", "author": "jerryshao", "createdAt": "2020-03-13T04:20:08Z", "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -83,6 +86,18 @@ protected HiveTableOperations(Configuration conf, HiveClientPool metaClients, St\n     this.tableName = table;\n     this.lockAcquireTimeout =\n         conf.getLong(HIVE_ACQUIRE_LOCK_STATE_TIMEOUT_MS, HIVE_ACQUIRE_LOCK_STATE_TIMEOUT_MS_DEFAULT);\n+    try {\n+      this.alterTableMethod = HiveMetaStoreClient.class.getMethod(\"alter_table_with_environmentContext\",\n+          String.class, String.class, Table.class, EnvironmentContext.class);\n+    } catch (NoSuchMethodException e) {\n+      try {\n+        this.alterTableMethod = HiveMetaStoreClient.class.getMethod(\"alter_table\",\n+          String.class, String.class, Table.class, EnvironmentContext.class);\n+      } catch (NoSuchMethodException inner) {\n+        throw new RuntimeMetaException(inner, \"Fail to find method alter_table_with_environmentContext and \" +\n+            \"alter_table with right signature\");\n+      }", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzMzAxMQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392333011", "bodyText": "Can you update this to use the reflection utilities from iceberg-common? Those handle exceptions and use a builder pattern so it's concise and easy to maintain across versions:\n  private static final DynMethods.UnboundMethod ALTER_TABLE = DynMethods\n      .builder(\"alter_table\")\n      .impl(HiveMetaStoreClient.class, \"alter_table_with_environmentContext\",\n          String.class, String.class, Table.class, EnvironmentContext.class)\n      .impl(HiveMetaStoreClient.class, \"alter_table\",\n          String.class, String.class, Table.class, EnvironmentContext.class)\n      .build();", "author": "rdblue", "createdAt": "2020-03-13T16:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAyMzYwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNzQ2MQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392327461", "bodyText": "Since the version of Hive is unlikely to change, can we make this a static field?", "author": "rdblue", "createdAt": "2020-03-13T16:13:35Z", "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -75,6 +77,7 @@\n   private final long lockAcquireTimeout;\n \n   private FileIO fileIO;\n+  private Method alterTableMethod;", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzMzM3NA==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392333374", "bodyText": "If you use DynMethods then you'd call the method like this:\n    try {\n      clients.run(client -> ALTER_TABLE.invoke(client, database, tableName, tbl, envContext));\n    } catch (TException e) {\n      throw new RuntimeMetaException(e, \"Failed to alter table\");\n    } catch (InterruptedException e) {\n      Thread.currentThread().interrupt();\n      throw new RuntimeException(\"Interrupted in call to alterTable\", e);\n    }", "author": "rdblue", "createdAt": "2020-03-13T16:23:36Z", "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -175,7 +190,12 @@ protected void doCommit(TableMetadata base, TableMetadata metadata) {\n           EnvironmentContext envContext = new EnvironmentContext(\n               ImmutableMap.of(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE)\n           );\n-          client.alter_table(database, tableName, tbl, envContext);\n+\n+          try {\n+            alterTableMethod.invoke(client, database, tableName, tbl, envContext);\n+          } catch (Exception e) {\n+            throw new RuntimeMetaException(e, \"Failed to alter table for %s.%s\", database, tableName);\n+          }", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2MzQ2OQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392763469", "bodyText": "With this Iceberg will complain about \"CyclomaticComplexity\" issue, I think it is probably fine to let the existing exceptional handler to handle the exceptions.", "author": "jerryshao", "createdAt": "2020-03-16T03:06:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzMzM3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNDUxMw==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392334513", "bodyText": "Try to avoid catching Exception so that this doesn't swallow unexpected errors.", "author": "rdblue", "createdAt": "2020-03-13T16:25:38Z", "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -175,7 +190,12 @@ protected void doCommit(TableMetadata base, TableMetadata metadata) {\n           EnvironmentContext envContext = new EnvironmentContext(\n               ImmutableMap.of(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE)\n           );\n-          client.alter_table(database, tableName, tbl, envContext);\n+\n+          try {\n+            alterTableMethod.invoke(client, database, tableName, tbl, envContext);\n+          } catch (Exception e) {", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTEwMg==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392335102", "bodyText": "Do we need this HBase dependency? What is tephra used for?", "author": "rdblue", "createdAt": "2020-03-13T16:26:33Z", "path": "versions.lock", "diffHunk": "@@ -1,31 +1,39 @@\n # Run ./gradlew --write-locks to regenerate this file\n-ant:ant:1.6.5 (1 constraints: bb0a41d8)\n-antlr:antlr:2.7.7 (2 constraints: 36167e02)\n+ant:ant:1.6.5 (2 constraints: 2d1539e1)\n aopalliance:aopalliance:1.0 (1 constraints: 170a83ac)\n-asm:asm:3.1 (2 constraints: 4f19c3c6)\n+asm:asm:3.1 (3 constraints: 251fd7ad)\n+asm:asm-commons:3.1 (1 constraints: 9c0f1f7a)\n+asm:asm-tree:3.1 (1 constraints: 2307035c)\n+ch.qos.logback:logback-classic:1.0.9 (3 constraints: d3258a88)\n+ch.qos.logback:logback-core:1.0.9 (4 constraints: dd32435a)\n+co.cask.tephra:tephra-api:0.6.0 (3 constraints: 0828ded1)\n+co.cask.tephra:tephra-core:0.6.0 (2 constraints: 831cd90d)\n+co.cask.tephra:tephra-hbase-compat-1.0:0.6.0 (1 constraints: 370d6920)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2NTAxOQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392765019", "bodyText": "tephra is a \"globally consistent transactions on top of Apache HBase.\", introduced by Hive Metastore, I don't think it is needed, will remove it.", "author": "jerryshao", "createdAt": "2020-03-16T03:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTEwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTY2Mw==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392335663", "bodyText": "This dependency must be excluded because it has a questionable license. The stephenc.findbugs version above is a drop-in replacement.", "author": "rdblue", "createdAt": "2020-03-13T16:27:28Z", "path": "versions.lock", "diffHunk": "@@ -1,31 +1,39 @@\n # Run ./gradlew --write-locks to regenerate this file\n-ant:ant:1.6.5 (1 constraints: bb0a41d8)\n-antlr:antlr:2.7.7 (2 constraints: 36167e02)\n+ant:ant:1.6.5 (2 constraints: 2d1539e1)\n aopalliance:aopalliance:1.0 (1 constraints: 170a83ac)\n-asm:asm:3.1 (2 constraints: 4f19c3c6)\n+asm:asm:3.1 (3 constraints: 251fd7ad)\n+asm:asm-commons:3.1 (1 constraints: 9c0f1f7a)\n+asm:asm-tree:3.1 (1 constraints: 2307035c)\n+ch.qos.logback:logback-classic:1.0.9 (3 constraints: d3258a88)\n+ch.qos.logback:logback-core:1.0.9 (4 constraints: dd32435a)\n+co.cask.tephra:tephra-api:0.6.0 (3 constraints: 0828ded1)\n+co.cask.tephra:tephra-core:0.6.0 (2 constraints: 831cd90d)\n+co.cask.tephra:tephra-hbase-compat-1.0:0.6.0 (1 constraints: 370d6920)\n com.carrotsearch:hppc:0.7.2 (1 constraints: f70cda14)\n com.clearspring.analytics:stream:2.7.0 (1 constraints: 1a0dd136)\n com.esotericsoftware:kryo-shaded:4.0.2 (2 constraints: b71345a6)\n com.esotericsoftware:minlog:1.3.0 (1 constraints: 670e7c4f)\n com.fasterxml.jackson.core:jackson-annotations:2.10.2 (5 constraints: 4155160f)\n com.fasterxml.jackson.core:jackson-core:2.10.2 (6 constraints: bb52b302)\n-com.fasterxml.jackson.core:jackson-databind:2.10.2 (10 constraints: 8a92f4c4)\n+com.fasterxml.jackson.core:jackson-databind:2.10.2 (11 constraints: 7c9eca9a)\n com.fasterxml.jackson.module:jackson-module-paranamer:2.10.2 (1 constraints: 03162c16)\n com.fasterxml.jackson.module:jackson-module-scala_2.11:2.10.2 (1 constraints: 7f0da251)\n com.github.ben-manes.caffeine:caffeine:2.7.0 (1 constraints: 0b050a36)\n+com.github.joshelser:dropwizard-metrics-hadoop-metrics2-reporter:0.1.2 (1 constraints: e90b08f3)\n com.github.luben:zstd-jni:1.3.2-2 (1 constraints: 760d7c51)\n com.github.stephenc.findbugs:findbugs-annotations:1.3.9-1 (1 constraints: 6d05ab40)\n-com.google.code.findbugs:jsr305:3.0.2 (9 constraints: d276cf3c)\n-com.google.code.gson:gson:2.2.4 (1 constraints: 8c0d3f2f)\n+com.google.code.findbugs:jsr305:3.0.2 (11 constraints: 2290ea31)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTcyMg==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392335722", "bodyText": "Is this needed?", "author": "rdblue", "createdAt": "2020-03-13T16:27:36Z", "path": "versions.lock", "diffHunk": "@@ -1,31 +1,39 @@\n # Run ./gradlew --write-locks to regenerate this file\n-ant:ant:1.6.5 (1 constraints: bb0a41d8)\n-antlr:antlr:2.7.7 (2 constraints: 36167e02)\n+ant:ant:1.6.5 (2 constraints: 2d1539e1)\n aopalliance:aopalliance:1.0 (1 constraints: 170a83ac)\n-asm:asm:3.1 (2 constraints: 4f19c3c6)\n+asm:asm:3.1 (3 constraints: 251fd7ad)\n+asm:asm-commons:3.1 (1 constraints: 9c0f1f7a)\n+asm:asm-tree:3.1 (1 constraints: 2307035c)\n+ch.qos.logback:logback-classic:1.0.9 (3 constraints: d3258a88)\n+ch.qos.logback:logback-core:1.0.9 (4 constraints: dd32435a)\n+co.cask.tephra:tephra-api:0.6.0 (3 constraints: 0828ded1)\n+co.cask.tephra:tephra-core:0.6.0 (2 constraints: 831cd90d)\n+co.cask.tephra:tephra-hbase-compat-1.0:0.6.0 (1 constraints: 370d6920)\n com.carrotsearch:hppc:0.7.2 (1 constraints: f70cda14)\n com.clearspring.analytics:stream:2.7.0 (1 constraints: 1a0dd136)\n com.esotericsoftware:kryo-shaded:4.0.2 (2 constraints: b71345a6)\n com.esotericsoftware:minlog:1.3.0 (1 constraints: 670e7c4f)\n com.fasterxml.jackson.core:jackson-annotations:2.10.2 (5 constraints: 4155160f)\n com.fasterxml.jackson.core:jackson-core:2.10.2 (6 constraints: bb52b302)\n-com.fasterxml.jackson.core:jackson-databind:2.10.2 (10 constraints: 8a92f4c4)\n+com.fasterxml.jackson.core:jackson-databind:2.10.2 (11 constraints: 7c9eca9a)\n com.fasterxml.jackson.module:jackson-module-paranamer:2.10.2 (1 constraints: 03162c16)\n com.fasterxml.jackson.module:jackson-module-scala_2.11:2.10.2 (1 constraints: 7f0da251)\n com.github.ben-manes.caffeine:caffeine:2.7.0 (1 constraints: 0b050a36)\n+com.github.joshelser:dropwizard-metrics-hadoop-metrics2-reporter:0.1.2 (1 constraints: e90b08f3)\n com.github.luben:zstd-jni:1.3.2-2 (1 constraints: 760d7c51)\n com.github.stephenc.findbugs:findbugs-annotations:1.3.9-1 (1 constraints: 6d05ab40)\n-com.google.code.findbugs:jsr305:3.0.2 (9 constraints: d276cf3c)\n-com.google.code.gson:gson:2.2.4 (1 constraints: 8c0d3f2f)\n+com.google.code.findbugs:jsr305:3.0.2 (11 constraints: 2290ea31)\n+com.google.code.gson:gson:2.2.4 (5 constraints: 3b40b359)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2NjU0Nw==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392766547", "bodyText": "This above two has been existed, and is depended by several jars, should we remove them all?", "author": "jerryshao", "createdAt": "2020-03-16T03:25:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2Njg3Ng==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392766876", "bodyText": "This is the dependency graph for jsr305\ncom.google.code.findbugs:jsr305:3.0.2\n        com.google.guava:guava -> 3.0.2\n        org.apache.arrow:arrow-memory -> 3.0.2\n        org.apache.hadoop:hadoop-common -> 3.0.0\n        org.apache.hive:hive-serde -> 3.0.0\n        org.apache.spark:spark-core_2.11 -> 1.3.9\n        org.apache.spark:spark-hive_2.11 -> 1.3.9\n        org.apache.spark:spark-network-common_2.11 -> 1.3.9\n        org.apache.spark:spark-unsafe_2.11 -> 1.3.9\n\nThis is for gson.\ncom.google.code.gson:gson:2.2.4\n        org.apache.hadoop:hadoop-common -> 2.2.4\n        org.apache.hive:hive-exec -> 2.2.4", "author": "jerryshao", "createdAt": "2020-03-16T03:27:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwMTc0MQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393801741", "bodyText": "If it was present before, it should be okay.", "author": "rdblue", "createdAt": "2020-03-17T16:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNTcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNjAzOQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392336039", "bodyText": "Can we remove asm? This is another common cause of runtime conflicts.", "author": "rdblue", "createdAt": "2020-03-13T16:28:11Z", "path": "versions.lock", "diffHunk": "@@ -1,31 +1,39 @@\n # Run ./gradlew --write-locks to regenerate this file\n-ant:ant:1.6.5 (1 constraints: bb0a41d8)\n-antlr:antlr:2.7.7 (2 constraints: 36167e02)\n+ant:ant:1.6.5 (2 constraints: 2d1539e1)\n aopalliance:aopalliance:1.0 (1 constraints: 170a83ac)\n-asm:asm:3.1 (2 constraints: 4f19c3c6)\n+asm:asm:3.1 (3 constraints: 251fd7ad)\n+asm:asm-commons:3.1 (1 constraints: 9c0f1f7a)\n+asm:asm-tree:3.1 (1 constraints: 2307035c)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNjYyNg==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392336626", "bodyText": "Is this needed?", "author": "rdblue", "createdAt": "2020-03-13T16:29:14Z", "path": "versions.lock", "diffHunk": "@@ -37,90 +45,98 @@ com.sun.jersey:jersey-json:1.9 (5 constraints: 945f2f90)\n com.sun.jersey:jersey-server:1.9 (4 constraints: ef373c01)\n com.sun.jersey.contribs:jersey-guice:1.9 (4 constraints: 65529ed7)\n com.sun.xml.bind:jaxb-impl:2.2.3-1 (1 constraints: 330c2404)\n+com.tdunning:json:1.8 (1 constraints: 910b72db)\n com.thoughtworks.paranamer:paranamer:2.8 (3 constraints: 742d4cb1)\n com.twitter:chill-java:0.9.3 (2 constraints: a716716f)\n com.twitter:chill_2.11:0.9.3 (2 constraints: 121b92c3)\n-com.twitter:parquet-hadoop-bundle:1.6.0 (3 constraints: 7c262424)\n+com.twitter:parquet-hadoop-bundle:1.6.0 (2 constraints: 061b4d93)\n com.univocity:univocity-parsers:2.7.3 (1 constraints: c40ccb27)\n+com.zaxxer:HikariCP:2.5.1 (1 constraints: 390d7120)\n commons-beanutils:commons-beanutils:1.7.0 (1 constraints: da0e635f)\n commons-beanutils:commons-beanutils-core:1.8.0 (1 constraints: 1d134124)\n-commons-cli:commons-cli:1.2 (8 constraints: 9467c282)\n-commons-codec:commons-codec:1.10 (16 constraints: 42d1423c)\n-commons-collections:commons-collections:3.2.2 (4 constraints: 42476934)\n+commons-cli:commons-cli:1.2 (9 constraints: f874366c)\n+commons-codec:commons-codec:1.10 (17 constraints: a8de3870)\n+commons-collections:commons-collections:3.2.2 (3 constraints: e73a8e36)\n commons-configuration:commons-configuration:1.6 (1 constraints: 2d0d5c14)\n commons-daemon:commons-daemon:1.0.13 (1 constraints: d50c811c)\n commons-dbcp:commons-dbcp:1.4 (3 constraints: 9029e0e4)\n commons-digester:commons-digester:1.8 (1 constraints: bf1228fe)\n-commons-el:commons-el:1.0 (1 constraints: fb077074)\n+commons-el:commons-el:1.0 (2 constraints: ad11e7f0)\n commons-httpclient:commons-httpclient:3.1 (4 constraints: e52cc77f)\n commons-io:commons-io:2.4 (6 constraints: 4a568049)\n-commons-lang:commons-lang:2.6 (19 constraints: 5f0d34d8)\n-commons-logging:commons-logging:1.2 (27 constraints: f2ab390b)\n+commons-lang:commons-lang:2.6 (20 constraints: 401f63f3)\n+commons-logging:commons-logging:1.2 (20 constraints: 424b646e)\n commons-net:commons-net:3.1 (3 constraints: 3d222e61)\n commons-pool:commons-pool:1.6 (4 constraints: e336ab5e)\n dk.brics.automaton:automaton:1.11-8 (1 constraints: 92088a8d)\n hsqldb:hsqldb:1.8.0.10 (1 constraints: f008499f)\n io.airlift:aircompressor:0.15 (1 constraints: 0e0aa4b2)\n-io.dropwizard.metrics:metrics-core:3.1.5 (6 constraints: 865ea0ba)\n+io.dropwizard.metrics:metrics-core:3.1.5 (9 constraints: be90b1ee)\n io.dropwizard.metrics:metrics-graphite:3.1.5 (1 constraints: 1a0dc936)\n-io.dropwizard.metrics:metrics-json:3.1.5 (1 constraints: 1a0dc936)\n-io.dropwizard.metrics:metrics-jvm:3.1.5 (1 constraints: 1a0dc936)\n+io.dropwizard.metrics:metrics-json:3.1.5 (2 constraints: 03195c12)\n+io.dropwizard.metrics:metrics-jvm:3.1.5 (2 constraints: 03195c12)\n io.netty:netty:3.9.9.Final (9 constraints: 9eb0396d)\n io.netty:netty-all:4.1.17.Final (3 constraints: d2312526)\n io.netty:netty-buffer:4.1.27.Final (1 constraints: 4a0fee77)\n-javax.activation:activation:1.1.1 (1 constraints: 140dbb36)\n+it.unimi.dsi:fastutil:6.5.6 (1 constraints: 910b3ce5)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNjkxNQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392336915", "bodyText": "What are these? Are they needed?", "author": "rdblue", "createdAt": "2020-03-13T16:29:46Z", "path": "versions.lock", "diffHunk": "@@ -37,90 +45,98 @@ com.sun.jersey:jersey-json:1.9 (5 constraints: 945f2f90)\n com.sun.jersey:jersey-server:1.9 (4 constraints: ef373c01)\n com.sun.jersey.contribs:jersey-guice:1.9 (4 constraints: 65529ed7)\n com.sun.xml.bind:jaxb-impl:2.2.3-1 (1 constraints: 330c2404)\n+com.tdunning:json:1.8 (1 constraints: 910b72db)\n com.thoughtworks.paranamer:paranamer:2.8 (3 constraints: 742d4cb1)\n com.twitter:chill-java:0.9.3 (2 constraints: a716716f)\n com.twitter:chill_2.11:0.9.3 (2 constraints: 121b92c3)\n-com.twitter:parquet-hadoop-bundle:1.6.0 (3 constraints: 7c262424)\n+com.twitter:parquet-hadoop-bundle:1.6.0 (2 constraints: 061b4d93)\n com.univocity:univocity-parsers:2.7.3 (1 constraints: c40ccb27)\n+com.zaxxer:HikariCP:2.5.1 (1 constraints: 390d7120)\n commons-beanutils:commons-beanutils:1.7.0 (1 constraints: da0e635f)\n commons-beanutils:commons-beanutils-core:1.8.0 (1 constraints: 1d134124)\n-commons-cli:commons-cli:1.2 (8 constraints: 9467c282)\n-commons-codec:commons-codec:1.10 (16 constraints: 42d1423c)\n-commons-collections:commons-collections:3.2.2 (4 constraints: 42476934)\n+commons-cli:commons-cli:1.2 (9 constraints: f874366c)\n+commons-codec:commons-codec:1.10 (17 constraints: a8de3870)\n+commons-collections:commons-collections:3.2.2 (3 constraints: e73a8e36)\n commons-configuration:commons-configuration:1.6 (1 constraints: 2d0d5c14)\n commons-daemon:commons-daemon:1.0.13 (1 constraints: d50c811c)\n commons-dbcp:commons-dbcp:1.4 (3 constraints: 9029e0e4)\n commons-digester:commons-digester:1.8 (1 constraints: bf1228fe)\n-commons-el:commons-el:1.0 (1 constraints: fb077074)\n+commons-el:commons-el:1.0 (2 constraints: ad11e7f0)\n commons-httpclient:commons-httpclient:3.1 (4 constraints: e52cc77f)\n commons-io:commons-io:2.4 (6 constraints: 4a568049)\n-commons-lang:commons-lang:2.6 (19 constraints: 5f0d34d8)\n-commons-logging:commons-logging:1.2 (27 constraints: f2ab390b)\n+commons-lang:commons-lang:2.6 (20 constraints: 401f63f3)\n+commons-logging:commons-logging:1.2 (20 constraints: 424b646e)\n commons-net:commons-net:3.1 (3 constraints: 3d222e61)\n commons-pool:commons-pool:1.6 (4 constraints: e336ab5e)\n dk.brics.automaton:automaton:1.11-8 (1 constraints: 92088a8d)\n hsqldb:hsqldb:1.8.0.10 (1 constraints: f008499f)\n io.airlift:aircompressor:0.15 (1 constraints: 0e0aa4b2)\n-io.dropwizard.metrics:metrics-core:3.1.5 (6 constraints: 865ea0ba)\n+io.dropwizard.metrics:metrics-core:3.1.5 (9 constraints: be90b1ee)\n io.dropwizard.metrics:metrics-graphite:3.1.5 (1 constraints: 1a0dc936)\n-io.dropwizard.metrics:metrics-json:3.1.5 (1 constraints: 1a0dc936)\n-io.dropwizard.metrics:metrics-jvm:3.1.5 (1 constraints: 1a0dc936)\n+io.dropwizard.metrics:metrics-json:3.1.5 (2 constraints: 03195c12)\n+io.dropwizard.metrics:metrics-jvm:3.1.5 (2 constraints: 03195c12)\n io.netty:netty:3.9.9.Final (9 constraints: 9eb0396d)\n io.netty:netty-all:4.1.17.Final (3 constraints: d2312526)\n io.netty:netty-buffer:4.1.27.Final (1 constraints: 4a0fee77)\n-javax.activation:activation:1.1.1 (1 constraints: 140dbb36)\n+it.unimi.dsi:fastutil:6.5.6 (1 constraints: 910b3ce5)\n+javax.activation:activation:1.1.1 (3 constraints: b02331a0)\n javax.annotation:javax.annotation-api:1.3.2 (3 constraints: 55341c48)\n javax.inject:javax.inject:1 (4 constraints: 852d0c1a)\n javax.jdo:jdo-api:3.0.1 (2 constraints: 4c1dcc1a)\n+javax.mail:mail:1.4.1 (1 constraints: fc0fe399)\n javax.servlet:javax.servlet-api:3.1.0 (1 constraints: 150dc436)\n-javax.servlet:servlet-api:2.5 (7 constraints: c87e5aa1)\n+javax.servlet:jsp-api:2.0 (1 constraints: 0b0aa0a7)\n+javax.servlet:servlet-api:2.5 (9 constraints: f991a6d2)\n javax.servlet.jsp:jsp-api:2.1 (1 constraints: 290d5a14)\n javax.transaction:jta:1.1 (1 constraints: 9f07d96b)\n+javax.transaction:transaction-api:1.1 (1 constraints: 0a0b64c9)\n javax.validation:validation-api:1.1.0.Final (1 constraints: 13133130)\n javax.ws.rs:javax.ws.rs-api:2.0.1 (5 constraints: 6e649355)\n javax.xml.bind:jaxb-api:2.2.11 (6 constraints: a069fd48)\n-javolution:javolution:5.5.1 (1 constraints: f00d1a43)\n-jline:jline:2.12 (3 constraints: 98208776)\n-joda-time:joda-time:2.9.9 (4 constraints: c125a2fb)\n-log4j:apache-log4j-extras:1.2.17 (4 constraints: 3f36b1af)\n-log4j:log4j:1.2.17 (12 constraints: 22ab5529)\n+javolution:javolution:5.5.1 (2 constraints: 2b1b2b82)\n+jline:jline:2.12 (3 constraints: 7c21b2cb)\n+joda-time:joda-time:2.9.9 (4 constraints: 2326d336)\n+log4j:apache-log4j-extras:1.2.17 (1 constraints: 200e1d51)\n+log4j:log4j:1.2.17 (8 constraints: e7772b11)\n net.hydromatic:eigenbase-properties:1.1.5 (1 constraints: 5f0daf2c)\n net.java.dev.jets3t:jets3t:0.9.0 (2 constraints: ec152b22)\n net.razorvine:pyrolite:4.13 (1 constraints: eb0cb829)\n net.sf.kosmosfs:kfs:0.3 (1 constraints: fd077074)\n net.sf.opencsv:opencsv:2.3 (2 constraints: a218daa5)\n net.sf.py4j:py4j:0.10.7 (1 constraints: 490d0044)\n org.antlr:ST4:4.0.4 (3 constraints: 5521e4e4)\n-org.antlr:antlr-runtime:3.4 (6 constraints: b84229a1)\n+org.antlr:antlr-runtime:3.5.2 (6 constraints: 7a43035f)\n org.antlr:antlr4-runtime:4.7 (1 constraints: 7a0e125f)\n-org.antlr:stringtemplate:3.2.1 (1 constraints: c10a3bc6)\n-org.apache.ant:ant:1.9.1 (3 constraints: a721ed14)\n+org.apache.ant:ant:1.9.1 (3 constraints: 262660e7)\n org.apache.ant:ant-launcher:1.9.1 (1 constraints: 69082485)\n org.apache.arrow:arrow-format:0.14.1 (1 constraints: 240df421)\n org.apache.arrow:arrow-memory:0.14.1 (1 constraints: 240df421)\n org.apache.arrow:arrow-vector:0.14.1 (2 constraints: 2012a545)\n org.apache.avro:avro:1.9.2 (4 constraints: 3e2e68f4)\n org.apache.avro:avro-ipc:1.8.2 (1 constraints: f90b5bf4)\n org.apache.avro:avro-mapred:1.8.2 (2 constraints: 3a1a4787)\n-org.apache.calcite:calcite-avatica:1.2.0-incubating (4 constraints: a044b922)\n-org.apache.calcite:calcite-core:1.2.0-incubating (2 constraints: bd20f965)\n+org.apache.calcite:calcite-avatica:1.2.0-incubating (3 constraints: 4b35b263)\n+org.apache.calcite:calcite-core:1.2.0-incubating (1 constraints: 68119fdf)\n org.apache.calcite:calcite-linq4j:1.2.0-incubating (1 constraints: ac1147d8)\n-org.apache.commons:commons-compress:1.19 (6 constraints: fa4af584)\n+org.apache.commons:commons-compress:1.19 (6 constraints: 464a0c7f)\n org.apache.commons:commons-crypto:1.0.0 (2 constraints: 3a1e5fbf)\n-org.apache.commons:commons-lang3:3.9 (4 constraints: c52f877f)\n+org.apache.commons:commons-lang3:3.9 (5 constraints: 503b94b4)\n org.apache.commons:commons-math3:3.4.1 (2 constraints: a11af290)\n org.apache.curator:curator-client:2.7.1 (2 constraints: 6a1d2734)\n-org.apache.curator:curator-framework:2.7.1 (4 constraints: 4937d02c)\n+org.apache.curator:curator-framework:2.7.1 (4 constraints: 4d37382d)\n org.apache.curator:curator-recipes:2.7.1 (2 constraints: a61acc91)\n org.apache.derby:derby:10.12.1.1 (3 constraints: 9f2cb182)\n org.apache.directory.api:api-asn1-api:1.0.0-M20 (1 constraints: 3d163b13)\n org.apache.directory.api:api-util:1.0.0-M20 (1 constraints: 3d163b13)\n org.apache.directory.server:apacheds-i18n:2.0.0-M15 (1 constraints: 42164713)\n org.apache.directory.server:apacheds-kerberos-codec:2.0.0-M15 (1 constraints: 8f0d3b45)\n+org.apache.geronimo.specs:geronimo-annotation_1.0_spec:1.1.1 (1 constraints: f90fda99)\n+org.apache.geronimo.specs:geronimo-jaspic_1.0_spec:1.0 (1 constraints: 990f187a)\n+org.apache.geronimo.specs:geronimo-jta_1.1_spec:1.1.1 (1 constraints: f90fda99)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzM1NQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392337355", "bodyText": "This is the wrong version of Parquet. Can we remove this since we only need the metastore components?", "author": "rdblue", "createdAt": "2020-03-13T16:30:31Z", "path": "versions.lock", "diffHunk": "@@ -156,6 +173,7 @@ org.apache.parquet:parquet-common:1.11.0 (2 constraints: 4c1e7785)\n org.apache.parquet:parquet-encoding:1.11.0 (1 constraints: ca0efb64)\n org.apache.parquet:parquet-format-structures:1.11.0 (3 constraints: 6e2bc836)\n org.apache.parquet:parquet-hadoop:1.11.0 (2 constraints: de1ac7b3)\n+org.apache.parquet:parquet-hadoop-bundle:1.8.1 (1 constraints: 7a0bc7e4)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzQzMw==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392337433", "bodyText": "Can we remove twill?", "author": "rdblue", "createdAt": "2020-03-13T16:30:40Z", "path": "versions.lock", "diffHunk": "@@ -170,24 +188,33 @@ org.apache.spark:spark-sketch_2.11:2.4.4 (2 constraints: 981bd4f5)\n org.apache.spark:spark-sql_2.11:2.4.4 (1 constraints: 1e0d0037)\n org.apache.spark:spark-tags_2.11:2.4.4 (8 constraints: 036fa69d)\n org.apache.spark:spark-unsafe_2.11:2.4.4 (2 constraints: f11bc213)\n-org.apache.thrift:libfb303:0.9.3 (3 constraints: 6725fac0)\n-org.apache.thrift:libthrift:0.9.3 (5 constraints: 71415452)\n+org.apache.thrift:libfb303:0.9.3 (3 constraints: 27289d07)\n+org.apache.thrift:libthrift:0.9.3 (7 constraints: c75ac7de)\n+org.apache.twill:twill-api:0.6.0-incubating (2 constraints: e422b4e1)\n+org.apache.twill:twill-common:0.6.0-incubating (4 constraints: 3d467991)\n+org.apache.twill:twill-core:0.6.0-incubating (1 constraints: d70f9d7c)\n+org.apache.twill:twill-discovery-api:0.6.0-incubating (3 constraints: 25345d4c)\n+org.apache.twill:twill-discovery-core:0.6.0-incubating (2 constraints: 332039f9)\n+org.apache.twill:twill-zookeeper:0.6.0-incubating (3 constraints: 94341288)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzg2Ng==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392337866", "bodyText": "These versions don't match the versions that were specified by force in build.gradle.", "author": "rdblue", "createdAt": "2020-03-13T16:31:25Z", "path": "versions.lock", "diffHunk": "@@ -170,24 +188,33 @@ org.apache.spark:spark-sketch_2.11:2.4.4 (2 constraints: 981bd4f5)\n org.apache.spark:spark-sql_2.11:2.4.4 (1 constraints: 1e0d0037)\n org.apache.spark:spark-tags_2.11:2.4.4 (8 constraints: 036fa69d)\n org.apache.spark:spark-unsafe_2.11:2.4.4 (2 constraints: f11bc213)\n-org.apache.thrift:libfb303:0.9.3 (3 constraints: 6725fac0)\n-org.apache.thrift:libthrift:0.9.3 (5 constraints: 71415452)\n+org.apache.thrift:libfb303:0.9.3 (3 constraints: 27289d07)\n+org.apache.thrift:libthrift:0.9.3 (7 constraints: c75ac7de)\n+org.apache.twill:twill-api:0.6.0-incubating (2 constraints: e422b4e1)\n+org.apache.twill:twill-common:0.6.0-incubating (4 constraints: 3d467991)\n+org.apache.twill:twill-core:0.6.0-incubating (1 constraints: d70f9d7c)\n+org.apache.twill:twill-discovery-api:0.6.0-incubating (3 constraints: 25345d4c)\n+org.apache.twill:twill-discovery-core:0.6.0-incubating (2 constraints: 332039f9)\n+org.apache.twill:twill-zookeeper:0.6.0-incubating (3 constraints: 94341288)\n org.apache.xbean:xbean-asm6-shaded:4.8 (2 constraints: 2419a30f)\n org.apache.yetus:audience-annotations:0.11.0 (1 constraints: c40eb364)\n-org.apache.zookeeper:zookeeper:3.4.6 (11 constraints: 18a71f48)\n+org.apache.zookeeper:zookeeper:3.4.6 (12 constraints: 54b50652)\n org.checkerframework:checker-qual:2.8.1 (2 constraints: 1a1a3944)\n org.codehaus.jackson:jackson-core-asl:1.9.13 (11 constraints: 8091cd06)\n org.codehaus.jackson:jackson-jaxrs:1.9.13 (2 constraints: 821bca9d)\n org.codehaus.jackson:jackson-mapper-asl:1.9.13 (11 constraints: e18d325f)\n org.codehaus.jackson:jackson-xc:1.9.13 (2 constraints: 821bca9d)\n-org.codehaus.janino:commons-compiler:3.0.9 (3 constraints: 0a2837cc)\n-org.codehaus.janino:janino:3.0.9 (2 constraints: 3f1c6304)\n+org.codehaus.janino:commons-compiler:3.0.9 (2 constraints: a41a546f)\n+org.codehaus.janino:janino:3.0.9 (1 constraints: d90e817c)\n org.codehaus.jettison:jettison:1.1 (4 constraints: a84e24a9)\n org.codehaus.mojo:animal-sniffer-annotations:1.17 (1 constraints: ed09d8aa)\n-org.datanucleus:datanucleus-api-jdo:3.2.6 (2 constraints: 5a1d241c)\n-org.datanucleus:datanucleus-core:3.2.10 (5 constraints: 4a4401e0)\n-org.datanucleus:datanucleus-rdbms:3.2.9 (2 constraints: 601db41c)\n+org.datanucleus:datanucleus-api-jdo:4.2.4 (2 constraints: 591df91b)\n+org.datanucleus:datanucleus-core:4.1.17 (5 constraints: 584455e8)\n+org.datanucleus:datanucleus-rdbms:4.1.19 (2 constraints: 911dec32)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc1NDYxMw==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392754613", "bodyText": "These versions are introduced by Hive 2.3.6 metastore in iceberg-hive module. The versions forced in iceberg-spark module is introduced transiently by Hive 1.2.1. The problem is that Hive 2.3.6 can only work with datanucleus 4.x, and Hive 1.2.1 (spark) can only work with datanucleus 3.x, that's why I enforced the version to 3.x in spark module.", "author": "jerryshao", "createdAt": "2020-03-16T02:17:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NDE4Ng==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393174186", "bodyText": "Thanks for the clarification. Why do we need to force the versions if we are relying on the version of Hive built into Spark? Shouldn't we just exclude all of Hive and its transitive dependencies?", "author": "rdblue", "createdAt": "2020-03-16T16:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0MjQyMQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393542421", "bodyText": "I'm not sure if I understand your meaning.\nI'm not relying on the Hive version (2.3.6) in iceberg-spark module, instead iceberg-spark module will continue to use Hive (1.2.1-spark2) to run UTs. The datanucleus 4.x jars will only be used in iceberg-hive module. And iceberg-spark module will use the datanucleus 3.x, which is introduced by Hive 1.2.1.\nThe reason why I enforce the 3.x versions in iceberg-spark module is that Hive 1.2.1 can only work with datanucleus 3.x, also I'm not sure if Hive 2.3.6 can work with Spark 2.4.4, so in iceberg-spark module, I don't include the Hive 2.3.6 jars, still use Hive jars bring in by Spark.", "author": "jerryshao", "createdAt": "2020-03-17T09:24:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwMjg1OA==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393802858", "bodyText": "I see, this is because this is for the iceberg-spark module and not iceberg-spark-runtime. I was thinking this was for the runtime, which excludes the dependency. But you're right that we need to run unit tests with these versions because we are pulling in Hive 1.2.1-spark2. Thanks!", "author": "rdblue", "createdAt": "2020-03-17T16:19:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzNzg2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzODAyMQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392338021", "bodyText": "Are these servlet classes needed?", "author": "rdblue", "createdAt": "2020-03-13T16:31:39Z", "path": "versions.lock", "diffHunk": "@@ -170,24 +188,33 @@ org.apache.spark:spark-sketch_2.11:2.4.4 (2 constraints: 981bd4f5)\n org.apache.spark:spark-sql_2.11:2.4.4 (1 constraints: 1e0d0037)\n org.apache.spark:spark-tags_2.11:2.4.4 (8 constraints: 036fa69d)\n org.apache.spark:spark-unsafe_2.11:2.4.4 (2 constraints: f11bc213)\n-org.apache.thrift:libfb303:0.9.3 (3 constraints: 6725fac0)\n-org.apache.thrift:libthrift:0.9.3 (5 constraints: 71415452)\n+org.apache.thrift:libfb303:0.9.3 (3 constraints: 27289d07)\n+org.apache.thrift:libthrift:0.9.3 (7 constraints: c75ac7de)\n+org.apache.twill:twill-api:0.6.0-incubating (2 constraints: e422b4e1)\n+org.apache.twill:twill-common:0.6.0-incubating (4 constraints: 3d467991)\n+org.apache.twill:twill-core:0.6.0-incubating (1 constraints: d70f9d7c)\n+org.apache.twill:twill-discovery-api:0.6.0-incubating (3 constraints: 25345d4c)\n+org.apache.twill:twill-discovery-core:0.6.0-incubating (2 constraints: 332039f9)\n+org.apache.twill:twill-zookeeper:0.6.0-incubating (3 constraints: 94341288)\n org.apache.xbean:xbean-asm6-shaded:4.8 (2 constraints: 2419a30f)\n org.apache.yetus:audience-annotations:0.11.0 (1 constraints: c40eb364)\n-org.apache.zookeeper:zookeeper:3.4.6 (11 constraints: 18a71f48)\n+org.apache.zookeeper:zookeeper:3.4.6 (12 constraints: 54b50652)\n org.checkerframework:checker-qual:2.8.1 (2 constraints: 1a1a3944)\n org.codehaus.jackson:jackson-core-asl:1.9.13 (11 constraints: 8091cd06)\n org.codehaus.jackson:jackson-jaxrs:1.9.13 (2 constraints: 821bca9d)\n org.codehaus.jackson:jackson-mapper-asl:1.9.13 (11 constraints: e18d325f)\n org.codehaus.jackson:jackson-xc:1.9.13 (2 constraints: 821bca9d)\n-org.codehaus.janino:commons-compiler:3.0.9 (3 constraints: 0a2837cc)\n-org.codehaus.janino:janino:3.0.9 (2 constraints: 3f1c6304)\n+org.codehaus.janino:commons-compiler:3.0.9 (2 constraints: a41a546f)\n+org.codehaus.janino:janino:3.0.9 (1 constraints: d90e817c)\n org.codehaus.jettison:jettison:1.1 (4 constraints: a84e24a9)\n org.codehaus.mojo:animal-sniffer-annotations:1.17 (1 constraints: ed09d8aa)\n-org.datanucleus:datanucleus-api-jdo:3.2.6 (2 constraints: 5a1d241c)\n-org.datanucleus:datanucleus-core:3.2.10 (5 constraints: 4a4401e0)\n-org.datanucleus:datanucleus-rdbms:3.2.9 (2 constraints: 601db41c)\n+org.datanucleus:datanucleus-api-jdo:4.2.4 (2 constraints: 591df91b)\n+org.datanucleus:datanucleus-core:4.1.17 (5 constraints: 584455e8)\n+org.datanucleus:datanucleus-rdbms:4.1.19 (2 constraints: 911dec32)\n+org.datanucleus:javax.jdo:3.2.0-m3 (1 constraints: 030ea249)\n org.eclipse.jdt:core:3.1.1 (1 constraints: b40a38d8)\n+org.eclipse.jetty.aggregate:jetty-all:7.6.0.v20120127 (1 constraints: 260ea577)\n+org.eclipse.jetty.orbit:javax.servlet:3.0.0.v201112011016 (1 constraints: dd0e53b1)", "originalCommit": "187a701399ff3f6e7445830965b84c2084a9b952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2NzczMg==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r392767732", "bodyText": "Seems not necessary, they're introduced by hive-common, I will remove them.", "author": "jerryshao", "createdAt": "2020-03-16T03:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzODAyMQ=="}], "type": "inlineReview"}, {"oid": "4b17605d977a6ac197c2fed825778229fa0248dd", "url": "https://github.com/apache/iceberg/commit/4b17605d977a6ac197c2fed825778229fa0248dd", "message": "Refine the code", "committedDate": "2020-03-16T03:55:56Z", "type": "commit"}, {"oid": "136e68393e87f0f8dd31e200c291a0515c9766aa", "url": "https://github.com/apache/iceberg/commit/136e68393e87f0f8dd31e200c291a0515c9766aa", "message": "Refine the code", "committedDate": "2020-03-16T04:27:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NTEyOA==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393175128", "bodyText": "Nit: this line didn't need to change.", "author": "rdblue", "createdAt": "2020-03-16T17:00:46Z", "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -173,9 +181,9 @@ protected void doCommit(TableMetadata base, TableMetadata metadata) {\n       if (base != null) {\n         metaClients.run(client -> {\n           EnvironmentContext envContext = new EnvironmentContext(\n-              ImmutableMap.of(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE)\n-          );\n-          client.alter_table(database, tableName, tbl, envContext);\n+              ImmutableMap.of(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE));", "originalCommit": "136e68393e87f0f8dd31e200c291a0515c9766aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NTg5NQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393175895", "bodyText": "Is this needed?", "author": "rdblue", "createdAt": "2020-03-16T17:01:38Z", "path": "versions.lock", "diffHunk": "@@ -73,44 +75,45 @@ javax.annotation:javax.annotation-api:1.3.2 (3 constraints: 55341c48)\n javax.inject:javax.inject:1 (4 constraints: 852d0c1a)\n javax.jdo:jdo-api:3.0.1 (2 constraints: 4c1dcc1a)\n javax.servlet:javax.servlet-api:3.1.0 (1 constraints: 150dc436)\n-javax.servlet:servlet-api:2.5 (7 constraints: c87e5aa1)\n+javax.servlet:jsp-api:2.0 (1 constraints: 0b0aa0a7)\n+javax.servlet:servlet-api:2.5 (9 constraints: f991a6d2)\n javax.servlet.jsp:jsp-api:2.1 (1 constraints: 290d5a14)\n javax.transaction:jta:1.1 (1 constraints: 9f07d96b)\n+javax.transaction:transaction-api:1.1 (1 constraints: 0a0b64c9)", "originalCommit": "136e68393e87f0f8dd31e200c291a0515c9766aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU1NDcxOQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393554719", "bodyText": "Introduced by datanucleus, seems not necessary, I will remove it.\n\\--- org.datanucleus:javax.jdo:3.2.0-m3\n     \\--- org.apache.hive:hive-metastore:2.3.6", "author": "jerryshao", "createdAt": "2020-03-17T09:45:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NTg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NjExOQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393176119", "bodyText": "Do we know what this is and whether it is needed?", "author": "rdblue", "createdAt": "2020-03-16T17:01:51Z", "path": "versions.lock", "diffHunk": "@@ -37,34 +37,36 @@ com.sun.jersey:jersey-json:1.9 (5 constraints: 945f2f90)\n com.sun.jersey:jersey-server:1.9 (4 constraints: ef373c01)\n com.sun.jersey.contribs:jersey-guice:1.9 (4 constraints: 65529ed7)\n com.sun.xml.bind:jaxb-impl:2.2.3-1 (1 constraints: 330c2404)\n+com.tdunning:json:1.8 (1 constraints: 910b72db)\n com.thoughtworks.paranamer:paranamer:2.8 (3 constraints: 742d4cb1)\n com.twitter:chill-java:0.9.3 (2 constraints: a716716f)\n com.twitter:chill_2.11:0.9.3 (2 constraints: 121b92c3)\n-com.twitter:parquet-hadoop-bundle:1.6.0 (3 constraints: 7c262424)\n+com.twitter:parquet-hadoop-bundle:1.6.0 (2 constraints: 061b4d93)\n com.univocity:univocity-parsers:2.7.3 (1 constraints: c40ccb27)\n+com.zaxxer:HikariCP:2.5.1 (1 constraints: 390d7120)", "originalCommit": "136e68393e87f0f8dd31e200c291a0515c9766aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1MDI2OQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393350269", "bodyText": "Looks like this is a JDBC connection pool. Since we are using the thrift API, we probably don't need it in the Spark runtime module, but it's probably necessary for running tests that use a built-in metastore.", "author": "rdblue", "createdAt": "2020-03-16T22:43:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NjExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU1NjY4MQ==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393556681", "bodyText": "Let me take a try if it still can be worked after removing this dependencies.", "author": "jerryshao", "createdAt": "2020-03-17T09:48:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NjExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYxNDM3NA==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393614374", "bodyText": "Seems not necessary to add, I've already excluded this dependency.", "author": "jerryshao", "createdAt": "2020-03-17T11:34:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NjExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NjQ0MA==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393176440", "bodyText": "Another JSON library! Can you check whether we need it?", "author": "rdblue", "createdAt": "2020-03-16T17:02:13Z", "path": "versions.lock", "diffHunk": "@@ -37,34 +37,36 @@ com.sun.jersey:jersey-json:1.9 (5 constraints: 945f2f90)\n com.sun.jersey:jersey-server:1.9 (4 constraints: ef373c01)\n com.sun.jersey.contribs:jersey-guice:1.9 (4 constraints: 65529ed7)\n com.sun.xml.bind:jaxb-impl:2.2.3-1 (1 constraints: 330c2404)\n+com.tdunning:json:1.8 (1 constraints: 910b72db)", "originalCommit": "136e68393e87f0f8dd31e200c291a0515c9766aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU1NDQ1Mg==", "url": "https://github.com/apache/iceberg/pull/841#discussion_r393554452", "bodyText": "Introduced by hive-common. Seems not necessary, I will remove this.\ncom.tdunning:json:1.8\n\\--- org.apache.hive:hive-common:2.3.6\n     \\--- org.apache.hive:hive-serde:2.3.6\n          \\--- org.apache.hive:hive-metastore:2.3.6", "author": "jerryshao", "createdAt": "2020-03-17T09:45:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NjQ0MA=="}], "type": "inlineReview"}, {"oid": "c12543240ba68a87fb31871341671b1c2749b7e3", "url": "https://github.com/apache/iceberg/commit/c12543240ba68a87fb31871341671b1c2749b7e3", "message": "Exclude more dependencies", "committedDate": "2020-03-17T11:23:17Z", "type": "commit"}]}