{"pr_number": 1490, "pr_title": "Hive read docs", "pr_createdAt": "2020-09-23T10:20:50Z", "pr_url": "https://github.com/apache/iceberg/pull/1490", "timeline": [{"oid": "60d281b68f15c450b89263cb64eb82653a1ba12f", "url": "https://github.com/apache/iceberg/commit/60d281b68f15c450b89263cb64eb82653a1ba12f", "message": "first cut at Hive docs", "committedDate": "2020-09-21T14:38:40Z", "type": "commit"}, {"oid": "4b8084e4eb6403cd372e1f9ef7edf4f2477e3624", "url": "https://github.com/apache/iceberg/commit/4b8084e4eb6403cd372e1f9ef7edf4f2477e3624", "message": "various improvements", "committedDate": "2020-09-23T10:15:38Z", "type": "commit"}, {"oid": "9a418b47ce88221b0b7956f5fbae01c706c067d9", "url": "https://github.com/apache/iceberg/commit/9a418b47ce88221b0b7956f5fbae01c706c067d9", "message": "lower the case", "committedDate": "2020-09-23T10:20:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyMzI4NQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r493423285", "bodyText": "In reality this is Catalog specific. Works with HadoopTables / HadoopCatalog.\nI am not entirely sure, but I think this step could be omitted with HiveCatalog. @marton-bod?", "author": "pvary", "createdAt": "2020-09-23T10:28:18Z", "path": "site/docs/hive.md", "diffHunk": "@@ -0,0 +1,62 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+\n+# Hive\n+\n+## Hive read support\n+Iceberg supports the reading of Iceberg tables from [Hive](https://hive.apache.org) by using a [StorageHandler](https://cwiki.apache.org/confluence/display/Hive/StorageHandlers). \n+\n+### Table creation\n+This section explains the various steps needed in order to overlay a Hive table \"on top of\" an existing Iceberg table.\n+\n+#### Create an Iceberg table\n+The first step is to create an Iceberg table using the Spark/Java/Python API. For the purposes of this documentation we will assume that the table is called `table_a` and that the base location of the table is `s3://some_bucket/some_path/table_a`.", "originalCommit": "9a418b47ce88221b0b7956f5fbae01c706c067d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MTQzMQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494641431", "bodyText": "I agree, it would be great to have a section for Hadoop path-based tables and a section for Hive catalog tables.\nMaybe we should have a section for reading existing Iceberg tables that has two sub-sections: Hadoop tables and Hive tables.", "author": "rdblue", "createdAt": "2020-09-24T22:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyMzI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkyMDQ2NQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494920465", "bodyText": "Yup, makes sense, I've only covered the HadoopTables path here. I'll look into how to add the others.", "author": "massdosage", "createdAt": "2020-09-25T11:18:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyMzI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1NTkyOA==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r497755928", "bodyText": "OK, I've clarified that this document only covers the HadoopTables path. As discussed in the community sync today we agreed it would be better to have some documentation, even if we just cover this path for now, and we'll add in documentation for the Hive/Hadoop Catalog paths later.", "author": "massdosage", "createdAt": "2020-09-30T19:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyMzI4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1MTc5OQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r493451799", "bodyText": "Nit: Consider There is a plan to add this in the future. Soon to me implies that it's being actively worked on and it sounds more correct imo to leave it as \"in the future\" over \"soon\".\nAgain though, just a nit.", "author": "kbendick", "createdAt": "2020-09-23T10:59:55Z", "path": "site/docs/hive.md", "diffHunk": "@@ -0,0 +1,62 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+\n+# Hive\n+\n+## Hive read support\n+Iceberg supports the reading of Iceberg tables from [Hive](https://hive.apache.org) by using a [StorageHandler](https://cwiki.apache.org/confluence/display/Hive/StorageHandlers). \n+\n+### Table creation\n+This section explains the various steps needed in order to overlay a Hive table \"on top of\" an existing Iceberg table.\n+\n+#### Create an Iceberg table\n+The first step is to create an Iceberg table using the Spark/Java/Python API. For the purposes of this documentation we will assume that the table is called `table_a` and that the base location of the table is `s3://some_bucket/some_path/table_a`.\n+\n+#### Add the Iceberg Hive Runtime jar file to the Hive classpath\n+The `HiveIcebergStorageHandler` and supporting classes need to be made available on Hive's classpath. For example, if using Hive 2.x and the Hive shell, this can be achieved by issuing a statement like so:\n+```sql\n+add jar /path/to/iceberg-hive-runtime.jar;\n+```\n+There are many others ways to achieve this including adding the jar file to Hive's auxillary classpath (so it is available by default) - please refer to Hive's documentation for more information.\n+\n+#### Create a Hive table\n+Now overlay a Hive table on top of this Iceberg table by issuing Hive DDL like so:\n+```sql\n+CREATE EXTERNAL TABLE table_a \n+STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler' \n+LOCATION 's3://some_bucket/some_path/table_a';\n+```\n+\n+#### Query the Iceberg table via Hive\n+You should now be able to issue Hive SQL `SELECT` queries using the above table and see the results returned from the underlying Iceberg table. Both the Map Reduce and Tez query execution engines are supported.\n+```sql\n+SELECT * from table_a;\n+```\n+\n+### Features\n+\n+#### Predicate pushdown\n+Pushdown of the Hive SQL `WHERE` clause has been implemented so that these filters are used at the Iceberg TableScan level as well as by the Parquet and ORC Readers.\n+\n+#### Column selection\n+The projection of columns from the HiveSQL `SELECT` clause down to the Iceberg readers to reduce the number of columns read is currently being worked on.\n+\n+### Time travel and system tables\n+Support for accesing Iceberg's time travel feature and other system tables isn't currently supported but there is a plan to add this soon.", "originalCommit": "9a418b47ce88221b0b7956f5fbae01c706c067d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1MzU2OQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r493453569", "bodyText": "Agreed, I'll update that now. No nit is too small to pick! ;)", "author": "massdosage", "createdAt": "2020-09-23T11:02:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1MTc5OQ=="}], "type": "inlineReview"}, {"oid": "431c58a72843d51bd6636c9ef30c3fc21040117d", "url": "https://github.com/apache/iceberg/commit/431c58a72843d51bd6636c9ef30c3fc21040117d", "message": "in the future", "committedDate": "2020-09-23T11:03:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczODQyMA==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r493738420", "bodyText": "Should we update the Hive metastore integration to automatically set up the correct StorageHandler so HMS tables are automatically readable? That seems reasonable for 0.10.0.", "author": "rdblue", "createdAt": "2020-09-23T16:43:37Z", "path": "site/docs/hive.md", "diffHunk": "@@ -0,0 +1,62 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+\n+# Hive\n+\n+## Hive read support\n+Iceberg supports the reading of Iceberg tables from [Hive](https://hive.apache.org) by using a [StorageHandler](https://cwiki.apache.org/confluence/display/Hive/StorageHandlers). \n+\n+### Table creation\n+This section explains the various steps needed in order to overlay a Hive table \"on top of\" an existing Iceberg table.\n+\n+#### Create an Iceberg table", "originalCommit": "431c58a72843d51bd6636c9ef30c3fc21040117d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMyNDkyMA==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494324920", "bodyText": "Created a pull request: #1505", "author": "pvary", "createdAt": "2020-09-24T13:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczODQyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkxOTk4NA==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494919984", "bodyText": "I'll wait to see where the above goes as the results of this will probably need documenting here too - how to set up the hive-site.xml config params etc.", "author": "massdosage", "createdAt": "2020-09-25T11:18:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczODQyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MDYyMQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494640621", "bodyText": "Does this need to be available to the metastore or just the client?", "author": "rdblue", "createdAt": "2020-09-24T22:15:33Z", "path": "site/docs/hive.md", "diffHunk": "@@ -0,0 +1,62 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+\n+# Hive\n+\n+## Hive read support\n+Iceberg supports the reading of Iceberg tables from [Hive](https://hive.apache.org) by using a [StorageHandler](https://cwiki.apache.org/confluence/display/Hive/StorageHandlers). \n+\n+### Table creation\n+This section explains the various steps needed in order to overlay a Hive table \"on top of\" an existing Iceberg table.\n+\n+#### Create an Iceberg table\n+The first step is to create an Iceberg table using the Spark/Java/Python API. For the purposes of this documentation we will assume that the table is called `table_a` and that the base location of the table is `s3://some_bucket/some_path/table_a`.\n+\n+#### Add the Iceberg Hive Runtime jar file to the Hive classpath\n+The `HiveIcebergStorageHandler` and supporting classes need to be made available on Hive's classpath. For example, if using Hive 2.x and the Hive shell, this can be achieved by issuing a statement like so:", "originalCommit": "431c58a72843d51bd6636c9ef30c3fc21040117d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgzODczMg==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494838732", "bodyText": "The client.", "author": "massdosage", "createdAt": "2020-09-25T08:42:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MDYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MTE3OA==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494641178", "bodyText": "Spark and Flink docs use tables at the top of docs to signal what is supported or not and to give status updates. Would it make sense to use one here as well? Then we don't have to find the sections that need to be removed.", "author": "rdblue", "createdAt": "2020-09-24T22:17:06Z", "path": "site/docs/hive.md", "diffHunk": "@@ -0,0 +1,62 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+\n+# Hive\n+\n+## Hive read support\n+Iceberg supports the reading of Iceberg tables from [Hive](https://hive.apache.org) by using a [StorageHandler](https://cwiki.apache.org/confluence/display/Hive/StorageHandlers). \n+\n+### Table creation\n+This section explains the various steps needed in order to overlay a Hive table \"on top of\" an existing Iceberg table.\n+\n+#### Create an Iceberg table\n+The first step is to create an Iceberg table using the Spark/Java/Python API. For the purposes of this documentation we will assume that the table is called `table_a` and that the base location of the table is `s3://some_bucket/some_path/table_a`.\n+\n+#### Add the Iceberg Hive Runtime jar file to the Hive classpath\n+The `HiveIcebergStorageHandler` and supporting classes need to be made available on Hive's classpath. For example, if using Hive 2.x and the Hive shell, this can be achieved by issuing a statement like so:\n+```sql\n+add jar /path/to/iceberg-hive-runtime.jar;\n+```\n+There are many others ways to achieve this including adding the jar file to Hive's auxillary classpath (so it is available by default) - please refer to Hive's documentation for more information.\n+\n+#### Create a Hive table\n+Now overlay a Hive table on top of this Iceberg table by issuing Hive DDL like so:\n+```sql\n+CREATE EXTERNAL TABLE table_a \n+STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler' \n+LOCATION 's3://some_bucket/some_path/table_a';\n+```\n+\n+#### Query the Iceberg table via Hive\n+You should now be able to issue Hive SQL `SELECT` queries using the above table and see the results returned from the underlying Iceberg table. Both the Map Reduce and Tez query execution engines are supported.\n+```sql\n+SELECT * from table_a;\n+```\n+\n+### Features\n+\n+#### Predicate pushdown\n+Pushdown of the Hive SQL `WHERE` clause has been implemented so that these filters are used at the Iceberg TableScan level as well as by the Parquet and ORC Readers.\n+\n+#### Column selection\n+The projection of columns from the HiveSQL `SELECT` clause down to the Iceberg readers to reduce the number of columns read is currently being worked on.\n+\n+### Time travel and system tables\n+Support for accesing Iceberg's time travel feature and other system tables isn't currently supported but there is a plan to add this in the future.", "originalCommit": "431c58a72843d51bd6636c9ef30c3fc21040117d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkyMjU1Ng==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r494922556", "bodyText": "You mean something like this with the Spark versions? Could do, the alternative would be just remove this  section and the one above and below from here entirely and only add them back in when they've been implemented which might actually be simpler. I'm easy either way.", "author": "massdosage", "createdAt": "2020-09-25T11:23:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3NzUzMQ==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r495177531", "bodyText": "Yeah, that's the table I was thinking of. It's easier to look at a table than to find a section of documentation that says something isn't supported. I'm also fine with dropping the sections. We can always add a table later.", "author": "rdblue", "createdAt": "2020-09-25T19:01:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1NjI1Mg==", "url": "https://github.com/apache/iceberg/pull/1490#discussion_r497756252", "bodyText": "I've dropped all those sections for now, will add them back in when the PRs for those features are merged into master.", "author": "massdosage", "createdAt": "2020-09-30T19:41:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MTE3OA=="}], "type": "inlineReview"}, {"oid": "80e7c05d9bcd93f5f058c5655c0b7c3131271dd0", "url": "https://github.com/apache/iceberg/commit/80e7c05d9bcd93f5f058c5655c0b7c3131271dd0", "message": "remove unsupported, clarify hadoop tables", "committedDate": "2020-09-30T19:38:12Z", "type": "commit"}]}