{"pr_number": 1375, "pr_title": "Add expire method to ExpireSnapshotsAction", "pr_createdAt": "2020-08-25T00:11:40Z", "pr_url": "https://github.com/apache/iceberg/pull/1375", "timeline": [{"oid": "6a7194480c6c1d1088d436f1f7ad5843b500be7e", "url": "https://github.com/apache/iceberg/commit/6a7194480c6c1d1088d436f1f7ad5843b500be7e", "message": "Add expire method to ExpireSnapshotsAction.", "committedDate": "2020-08-25T16:39:19Z", "type": "forcePushed"}, {"oid": "05035ce72da8334712613bf8bc893c78dcf80835", "url": "https://github.com/apache/iceberg/commit/05035ce72da8334712613bf8bc893c78dcf80835", "message": "Add expire method to ExpireSnapshotsAction.", "committedDate": "2020-08-25T16:41:03Z", "type": "commit"}, {"oid": "05035ce72da8334712613bf8bc893c78dcf80835", "url": "https://github.com/apache/iceberg/commit/05035ce72da8334712613bf8bc893c78dcf80835", "message": "Add expire method to ExpireSnapshotsAction.", "committedDate": "2020-08-25T16:41:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyOTQ4Ng==", "url": "https://github.com/apache/iceberg/pull/1375#discussion_r476629486", "bodyText": "Should we be synchronizing on expired files? Probably a really unlikely situation to be calling this object in a multi-threaded way or to call expire and execute concurrently ...", "author": "RussellSpitzer", "createdAt": "2020-08-25T17:46:12Z", "path": "spark/src/main/java/org/apache/iceberg/actions/ExpireSnapshotsAction.java", "diffHunk": "@@ -146,32 +147,48 @@ public ExpireSnapshotsAction deleteWith(Consumer<String> newDeleteFunc) {\n     return this;\n   }\n \n-  @Override\n-  public ExpireSnapshotsActionResult execute() {\n-    // Metadata before Expiration\n-    Dataset<Row>  originalFiles = buildValidFileDF(ops.current());\n+  /**\n+   * Expires snapshots and commits the changes to the table, returning a Dataset of files to delete.\n+   * <p>\n+   * This does not delete data files. To delete data files, run {@link #execute()}.\n+   * <p>\n+   * This may be called before or after {@link #execute()} is called to return the expired file list.\n+   *\n+   * @return a Dataset of files that are no longer referenced by the table\n+   */\n+  public Dataset<Row> expire() {\n+    if (expiredFiles == null) {", "originalCommit": "05035ce72da8334712613bf8bc893c78dcf80835", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5MDk0NQ==", "url": "https://github.com/apache/iceberg/pull/1375#discussion_r476690945", "bodyText": "I'd rather not over-complicate it. If there is a future use case for multiple threads we can do it then, but I really doubt it will be needed.", "author": "rdblue", "createdAt": "2020-08-25T19:36:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyOTQ4Ng=="}], "type": "inlineReview"}, {"oid": "8d6ff65e7bef13fc3103537f6add127dc2c2577a", "url": "https://github.com/apache/iceberg/commit/8d6ff65e7bef13fc3103537f6add127dc2c2577a", "message": "Fix checkstyle problem.", "committedDate": "2020-08-25T19:39:35Z", "type": "commit"}, {"oid": "772f46810356ef36bb463158a7aaf1e66f0887c4", "url": "https://github.com/apache/iceberg/commit/772f46810356ef36bb463158a7aaf1e66f0887c4", "message": "Fix test checkstyle problems.", "committedDate": "2020-08-25T20:28:26Z", "type": "commit"}]}