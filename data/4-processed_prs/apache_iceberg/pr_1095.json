{"pr_number": 1095, "pr_title": "Add HadoopCatalog example to create/load tables in the Iceberg User docs", "pr_createdAt": "2020-06-05T03:31:58Z", "pr_url": "https://github.com/apache/iceberg/pull/1095", "timeline": [{"oid": "14730fdb80eccde245b80b50b6175609921ad492", "url": "https://github.com/apache/iceberg/commit/14730fdb80eccde245b80b50b6175609921ad492", "message": "Add HadoopCatalog example to create/load tables in the Iceberg User docs", "committedDate": "2020-06-05T03:25:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNTMxOA==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438325318", "bodyText": "This needs to note the disadvantages of using HadoopCatalog so that users are informed about the problems. Specifically, this can only be used with HDFS. Can you add that to the first sentence, like this?\n\nA Hadoop catalog doesn't need to connect to a Hive MetaStore, but can only be used with HDFS or similar file systems that support atomic rename.", "author": "rdblue", "createdAt": "2020-06-10T18:25:16Z", "path": "site/docs/api-quickstart.md", "diffHunk": "@@ -48,6 +48,36 @@ logsDF.write\n \n The logs [schema](#create-a-schema) and [partition spec](#create-a-partition-spec) are created below.\n \n+### Using a Hadoop catalog\n+\n+The Hadoop catalog doesn't need to connects to a Hive MetaStore. To get a Hadoop catalog see:", "originalCommit": "14730fdb80eccde245b80b50b6175609921ad492", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ4ODcyMw==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438488723", "bodyText": "I think so.", "author": "hzfanxinxin", "createdAt": "2020-06-11T01:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNTMxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjAxNw==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438326017", "bodyText": "This doesn't use the right URI format, schema://authority/path. This URI would use warehouse_path for the HDFS host in the authority section.", "author": "rdblue", "createdAt": "2020-06-10T18:26:30Z", "path": "site/docs/api-quickstart.md", "diffHunk": "@@ -48,6 +48,36 @@ logsDF.write\n \n The logs [schema](#create-a-schema) and [partition spec](#create-a-partition-spec) are created below.\n \n+### Using a Hadoop catalog\n+\n+The Hadoop catalog doesn't need to connects to a Hive MetaStore. To get a Hadoop catalog see:\n+\n+```scala\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.iceberg.hadoop.HadoopCatalog;\n+\n+val conf = new Configuration();\n+val warehousePath = \"hdfs://warehouse_path\";", "originalCommit": "14730fdb80eccde245b80b50b6175609921ad492", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ5MDk3OA==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438490978", "bodyText": "hdfs://warehouse/path, is it ok?", "author": "hzfanxinxin", "createdAt": "2020-06-11T01:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4ODAyNA==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r440488024", "bodyText": "No, then warehouse is the authority section. You should change it to something like hdfs://host:8020/warehouse/path/", "author": "rdblue", "createdAt": "2020-06-15T22:46:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjIwMA==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438326200", "bodyText": "I don't think rename is implemented, is it?", "author": "rdblue", "createdAt": "2020-06-10T18:26:49Z", "path": "site/docs/api-quickstart.md", "diffHunk": "@@ -48,6 +48,36 @@ logsDF.write\n \n The logs [schema](#create-a-schema) and [partition spec](#create-a-partition-spec) are created below.\n \n+### Using a Hadoop catalog\n+\n+The Hadoop catalog doesn't need to connects to a Hive MetaStore. To get a Hadoop catalog see:\n+\n+```scala\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.iceberg.hadoop.HadoopCatalog;\n+\n+val conf = new Configuration();\n+val warehousePath = \"hdfs://warehouse_path\";\n+val catalog = new HadoopCatalog(conf, warehousePath);\n+```\n+\n+Like Hive catalog, Hadoop catalog implements the interface `Catalog`. So it also contains methods for working with tables, like createTable, loadTable, renameTable, and dropTable.", "originalCommit": "14730fdb80eccde245b80b50b6175609921ad492", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ4ODc4Mg==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438488782", "bodyText": "Yes, you are right. So should i remove renameTable?", "author": "hzfanxinxin", "createdAt": "2020-06-11T01:10:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjIwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4ODA3OA==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r440488078", "bodyText": "Yes, please.", "author": "rdblue", "createdAt": "2020-06-15T22:46:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjY1Ng==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438326656", "bodyText": "This is strange because it actually loads the table using HadoopTables and not the HadoopCatalog. The URI passed here must match the one created by the catalog.", "author": "rdblue", "createdAt": "2020-06-10T18:27:37Z", "path": "site/docs/api-quickstart.md", "diffHunk": "@@ -48,6 +48,36 @@ logsDF.write\n \n The logs [schema](#create-a-schema) and [partition spec](#create-a-partition-spec) are created below.\n \n+### Using a Hadoop catalog\n+\n+The Hadoop catalog doesn't need to connects to a Hive MetaStore. To get a Hadoop catalog see:\n+\n+```scala\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.iceberg.hadoop.HadoopCatalog;\n+\n+val conf = new Configuration();\n+val warehousePath = \"hdfs://warehouse_path\";\n+val catalog = new HadoopCatalog(conf, warehousePath);\n+```\n+\n+Like Hive catalog, Hadoop catalog implements the interface `Catalog`. So it also contains methods for working with tables, like createTable, loadTable, renameTable, and dropTable.\n+                                                                                       \n+This example create a table with Hadoop catalog:\n+\n+```scala\n+val name = TableIdentifier.of(\"logging\", \"logs\")\n+val table = catalog.createTable(name, schema, spec)\n+\n+// write into the new logs table with Spark 2.4\n+logsDF.write\n+    .format(\"iceberg\")\n+    .mode(\"append\")\n+    .save(\"hdfs://warehouse_path/logging/logs\")", "originalCommit": "14730fdb80eccde245b80b50b6175609921ad492", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ5Mzg0NQ==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r438493845", "bodyText": "Yes, this is also a problem that bothers me. I look the method findTable in class IcebergSource.java, it just support HadoopTables and HiveCatalog. So i think if we can add a option like .option(\"catalog\",\"HadoopCatalog\") to the DataSourceOptions, and the default value of catalog option is HiveCatalog.  what's your opinion on this?", "author": "hzfanxinxin", "createdAt": "2020-06-11T01:30:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjY1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4ODU4MA==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r440488580", "bodyText": "This seems like something we might want to solve in configuration instead of hard-coding support for HiveCatalog. This problem might go away when we get a better API in Spark 3.", "author": "rdblue", "createdAt": "2020-06-15T22:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyNjY1Ng=="}], "type": "inlineReview"}, {"oid": "6200ebc3b56970eab5cb914b9d509ae921d7afda", "url": "https://github.com/apache/iceberg/commit/6200ebc3b56970eab5cb914b9d509ae921d7afda", "message": "Addressing the comments https://github.com/apache/iceberg/pull/1095", "committedDate": "2020-06-17T07:40:27Z", "type": "commit"}, {"oid": "4f8130778fd4e0eec7e35d45d4549e17a2040417", "url": "https://github.com/apache/iceberg/commit/4f8130778fd4e0eec7e35d45d4549e17a2040417", "message": "Addressing the comments 14730fdb80eccde245b80b50b6175609921ad492", "committedDate": "2020-06-17T07:53:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcyMTU5Mw==", "url": "https://github.com/apache/iceberg/pull/1095#discussion_r441721593", "bodyText": "This location also needs to be fixed to avoid using warehouse_path as the authority section of the URI.", "author": "rdblue", "createdAt": "2020-06-17T17:48:18Z", "path": "site/docs/api-quickstart.md", "diffHunk": "@@ -48,6 +48,36 @@ logsDF.write\n \n The logs [schema](#create-a-schema) and [partition spec](#create-a-partition-spec) are created below.\n \n+### Using a Hadoop catalog\n+\n+A Hadoop catalog doesn't need to connect to a Hive MetaStore, but can only be used with HDFS or similar file systems that support atomic rename. To get a Hadoop catalog see:\n+\n+```scala\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.iceberg.hadoop.HadoopCatalog;\n+\n+val conf = new Configuration();\n+val warehousePath = \"hdfs://host:8020/warehouse_path\";\n+val catalog = new HadoopCatalog(conf, warehousePath);\n+```\n+\n+Like Hive catalog, Hadoop catalog implements the interface `Catalog`. So it also contains methods for working with tables, like createTable, loadTable, and dropTable.\n+                                                                                       \n+This example create a table with Hadoop catalog:\n+\n+```scala\n+val name = TableIdentifier.of(\"logging\", \"logs\")\n+val table = catalog.createTable(name, schema, spec)\n+\n+// write into the new logs table with Spark 2.4\n+logsDF.write\n+    .format(\"iceberg\")\n+    .mode(\"append\")\n+    .save(\"hdfs://warehouse_path/logging/logs\")", "originalCommit": "4f8130778fd4e0eec7e35d45d4549e17a2040417", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0b6d3e1a9de2deffec92cb9e822cacee576237d3", "url": "https://github.com/apache/iceberg/commit/0b6d3e1a9de2deffec92cb9e822cacee576237d3", "message": "Update api-quickstart.md", "committedDate": "2020-06-17T17:53:18Z", "type": "commit"}, {"oid": "1a4859bedcaa3194b8dde464d592211297186888", "url": "https://github.com/apache/iceberg/commit/1a4859bedcaa3194b8dde464d592211297186888", "message": "Update java-api-quickstart.md", "committedDate": "2020-06-17T17:54:24Z", "type": "commit"}]}