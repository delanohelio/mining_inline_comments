{"pr_number": 910, "pr_title": "Update Snapshot and TableMetadata with sequence numbers", "pr_createdAt": "2020-04-09T22:39:32Z", "pr_url": "https://github.com/apache/iceberg/pull/910", "timeline": [{"oid": "3d8e22c7bdd42ebc05a78ad5382d4f5c353c4e63", "url": "https://github.com/apache/iceberg/commit/3d8e22c7bdd42ebc05a78ad5382d4f5c353c4e63", "message": "Update Snapshot and TableMetadata with sequence numbers.", "committedDate": "2020-04-10T00:04:15Z", "type": "commit"}, {"oid": "3d8e22c7bdd42ebc05a78ad5382d4f5c353c4e63", "url": "https://github.com/apache/iceberg/commit/3d8e22c7bdd42ebc05a78ad5382d4f5c353c4e63", "message": "Update Snapshot and TableMetadata with sequence numbers.", "committedDate": "2020-04-10T00:04:15Z", "type": "forcePushed"}, {"oid": "423482a9574c73d12981fbf7143b5265045cd82f", "url": "https://github.com/apache/iceberg/commit/423482a9574c73d12981fbf7143b5265045cd82f", "message": "Update spec.md.", "committedDate": "2020-04-10T00:21:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk0MTM0Ng==", "url": "https://github.com/apache/iceberg/pull/910#discussion_r406941346", "bodyText": "So, v1 writers will only be allowed to write sequence numbers as 0 and we will assume 0 as sequence numbers in metadata entities without an explicit value, correct?", "author": "aokolnychyi", "createdAt": "2020-04-10T20:58:07Z", "path": "core/src/main/java/org/apache/iceberg/TableMetadata.java", "diffHunk": "@@ -197,14 +200,16 @@ public String toString() {\n                 List<MetadataLogEntry> previousFiles) {\n     Preconditions.checkArgument(formatVersion <= SUPPORTED_TABLE_FORMAT_VERSION,\n         \"Unsupported format version: v%s\", formatVersion);\n-    if (formatVersion > 1) {\n-      Preconditions.checkArgument(uuid != null, \"UUID is required in format v%s\", formatVersion);\n-    }\n+    Preconditions.checkArgument(formatVersion == 1 || uuid != null,\n+        \"UUID is required in format v%s\", formatVersion);\n+    Preconditions.checkArgument(formatVersion > 1 || lastSequenceNumber == 0,\n+        \"Sequence number must be 0 in v1: %s\", lastSequenceNumber);", "originalCommit": "423482a9574c73d12981fbf7143b5265045cd82f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1NTY3Nw==", "url": "https://github.com/apache/iceberg/pull/910#discussion_r406955677", "bodyText": "V1 writers should not pass any sequence number other than 0, and it won't get written to the file even though it is compatible. And reading v1 metadata should always fill in the sequence number with 0.", "author": "rdblue", "createdAt": "2020-04-10T21:41:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk0MTM0Ng=="}], "type": "inlineReview"}]}