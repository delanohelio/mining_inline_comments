{"pr_number": 1553, "pr_title": "BaseMetastoreTableOperations shouldn't disable refresh upon NoSuchTab\u2026", "pr_createdAt": "2020-10-06T16:08:00Z", "pr_url": "https://github.com/apache/iceberg/pull/1553", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNDM4Mw==", "url": "https://github.com/apache/iceberg/pull/1553#discussion_r500434383", "bodyText": "Can you add this line back? Removing it will just cause commit conflicts and it isn't needed for the PR.", "author": "rdblue", "createdAt": "2020-10-06T16:27:21Z", "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -88,11 +88,9 @@ public TableMetadata refresh() {\n       if (currentMetadataWasAvailable) {\n         LOG.warn(\"Could not find the table during refresh, setting current metadata to null\", e);\n       }\n-", "originalCommit": "5dcd6c83a69bbc98bacc0bedef0f51edf1de4319", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNjEyMg==", "url": "https://github.com/apache/iceberg/pull/1553#discussion_r500436122", "bodyText": "I think this needs to set shouldRefresh to true. If refresh was called directly, then shouldRefresh may not already be true. But we want it to be true so that this will not return metadata until a successful refresh.", "author": "rdblue", "createdAt": "2020-10-06T16:30:03Z", "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -88,11 +88,9 @@ public TableMetadata refresh() {\n       if (currentMetadataWasAvailable) {\n         LOG.warn(\"Could not find the table during refresh, setting current metadata to null\", e);\n       }\n-\n       currentMetadata = null;\n       currentMetadataLocation = null;\n       version = -1;\n-      shouldRefresh = false;", "originalCommit": "5dcd6c83a69bbc98bacc0bedef0f51edf1de4319", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNzM0NA==", "url": "https://github.com/apache/iceberg/pull/1553#discussion_r500437344", "bodyText": "Also, since current is called in commit, I think we will need to only set this in the case when currentMetadataWasAvailable. That way, creating a table will still work the same way.", "author": "rdblue", "createdAt": "2020-10-06T16:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNjEyMg=="}], "type": "inlineReview"}, {"oid": "76352f8aca59cb762d995994d04c84a57d30bd66", "url": "https://github.com/apache/iceberg/commit/76352f8aca59cb762d995994d04c84a57d30bd66", "message": "BaseMetastoreTableOperations shouldn't disable refresh upon NoSuchTableException. Otherwise it might cause unfriendly NPE for callers that don't check null return value from current() method.", "committedDate": "2020-10-06T17:58:13Z", "type": "commit"}, {"oid": "76352f8aca59cb762d995994d04c84a57d30bd66", "url": "https://github.com/apache/iceberg/commit/76352f8aca59cb762d995994d04c84a57d30bd66", "message": "BaseMetastoreTableOperations shouldn't disable refresh upon NoSuchTableException. Otherwise it might cause unfriendly NPE for callers that don't check null return value from current() method.", "committedDate": "2020-10-06T17:58:13Z", "type": "forcePushed"}]}