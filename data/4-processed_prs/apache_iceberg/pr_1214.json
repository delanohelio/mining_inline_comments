{"pr_number": 1214, "pr_title": "[Python] Minor fixes for tests", "pr_createdAt": "2020-07-18T16:58:32Z", "pr_url": "https://github.com/apache/iceberg/pull/1214", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIzMjY1OA==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457232658", "bodyText": "Is this still needed with the ts_table fixture already parametrized?", "author": "xhochy", "createdAt": "2020-07-20T09:47:51Z", "path": "python/tests/core/test_base_table_scan.py", "diffHunk": "@@ -14,11 +14,12 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-\n from iceberg.api import Schema\n from iceberg.api.types import IntegerType, NestedField\n+import pytest\n \n \n+@pytest.mark.parametrize(\"ts_table\", ['one', 'none'], indirect=True)", "originalCommit": "d10305db1a197a973d9c91b439c56fce795e68d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ1ODEyNA==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457458124", "bodyText": "thanks for that. You are correct! fixed.", "author": "rymurr", "createdAt": "2020-07-20T14:49:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIzMjY1OA=="}], "type": "inlineReview"}, {"oid": "e21321fca1c4c6a477249475753b377126155a80", "url": "https://github.com/apache/iceberg/commit/e21321fca1c4c6a477249475753b377126155a80", "message": "[Python] Minor fixes for tests\n\nIn the course of implementing create table I came across minor issues:\n* rename test fixtures to suppress warnings and prevent pytest from treating them as tests\n* test partition code path & fix incorrect signature when creating metadata\n* handle `file:` as well as `file://` as it seems both schemas are used\n* add mypy annotations in areas where I fixed code\n* fix tox/mypy", "committedDate": "2020-07-20T14:49:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MzAzOQ==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457773039", "bodyText": "Why is PartitionSpecBuilder in quotes?\nNot a problem, I've just not seen that before. Schema isn't in quotes.", "author": "rdblue", "createdAt": "2020-07-21T00:55:41Z", "path": "python/iceberg/api/partition_spec.py", "diffHunk": "@@ -183,7 +183,7 @@ def __repr__(self):\n         return \"\".join(sb)\n \n     @staticmethod\n-    def builder_for(schema):\n+    def builder_for(schema: Schema) -> \"PartitionSpecBuilder\":", "originalCommit": "e21321fca1c4c6a477249475753b377126155a80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg1OTM4Ng==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457859386", "bodyText": "Its because this is above the PartitionSpecBuilder class in the file. So the PartitionSpecBuilder class isn't yet reference-able. One of the small annoyances of mypy. Moving the class to the top of the file or to the a new file would fix it but create a needlessly larger diff\nNote: the same double-quote notation is used for a method in PartitionSpecBuilder which returns a PartitionSpecBuilder for the same reason, this is unfortunately unavoidable (to my knowledge) .", "author": "rymurr", "createdAt": "2020-07-21T06:12:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MzAzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MzYzNg==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457773636", "bodyText": "Nit: this file doesn't need to change and could cause git conflicts.", "author": "rdblue", "createdAt": "2020-07-21T00:57:56Z", "path": "python/tests/core/test_base_table_scan.py", "diffHunk": "@@ -14,7 +14,6 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-", "originalCommit": "e21321fca1c4c6a477249475753b377126155a80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg1OTYyNw==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457859627", "bodyText": "agreed, fixed", "author": "rymurr", "createdAt": "2020-07-21T06:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MzYzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3Mzg3NQ==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457773875", "bodyText": "Are the renames from Mock to Test worth the trouble? Unless this is following a python convention, it seems like this is just going to cause git conflicts.", "author": "rdblue", "createdAt": "2020-07-21T00:58:55Z", "path": "python/tests/api/test_helpers.py", "diffHunk": "@@ -74,7 +74,7 @@ def predicate(self, pred):\n             return None\n \n \n-class TestDataFile(DataFile):\n+class MockDataFile(DataFile):", "originalCommit": "e21321fca1c4c6a477249475753b377126155a80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg2NTQxMw==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457865413", "bodyText": "Up to you really @rdblue. I may be nit picking but I dislike the visual noise in pytest outputs. Master writes 8-10 lines of warnings in yellow and this patch writes one line in green.\nThe rename suppresses warnings like below. Given the way pytest aggressively searches for test patterns I think its convention to only have test in the name if you want pytest to try and test it.\ntests/api/test_helpers.py:77\n  /home/ryan/workspace/iceberg/python/tests/api/test_helpers.py:77: PytestCollectionWarning: cannot collect test class 'TestDataFile' because it has a __init__ constructor (from: tests/api/test_helpers.py)\n    class TestDataFile(DataFile):", "author": "rymurr", "createdAt": "2020-07-21T06:28:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3Mzg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk1MzY1Nw==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r457953657", "bodyText": "It would be preferable to not name them Test\u2026 as this is the standard prefix for classes that actually have tests.", "author": "xhochy", "createdAt": "2020-07-21T09:14:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3Mzg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTI3NA==", "url": "https://github.com/apache/iceberg/pull/1214#discussion_r458219274", "bodyText": "Sounds reasonable to me.", "author": "rdblue", "createdAt": "2020-07-21T16:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3Mzg3NQ=="}], "type": "inlineReview"}, {"oid": "0d19fc6797313c63887c4d6278b26263db9b2fcf", "url": "https://github.com/apache/iceberg/commit/0d19fc6797313c63887c4d6278b26263db9b2fcf", "message": "[Python] Minor fixes for tests\n\nIn the course of implementing create table I came across minor issues:\n* rename test fixtures to suppress warnings and prevent pytest from treating them as tests\n* test partition code path & fix incorrect signature when creating metadata\n* handle `file:` as well as `file://` as it seems both schemas are used\n* add mypy annotations in areas where I fixed code\n* fix tox/mypy", "committedDate": "2020-07-21T06:14:42Z", "type": "commit"}, {"oid": "0d19fc6797313c63887c4d6278b26263db9b2fcf", "url": "https://github.com/apache/iceberg/commit/0d19fc6797313c63887c4d6278b26263db9b2fcf", "message": "[Python] Minor fixes for tests\n\nIn the course of implementing create table I came across minor issues:\n* rename test fixtures to suppress warnings and prevent pytest from treating them as tests\n* test partition code path & fix incorrect signature when creating metadata\n* handle `file:` as well as `file://` as it seems both schemas are used\n* add mypy annotations in areas where I fixed code\n* fix tox/mypy", "committedDate": "2020-07-21T06:14:42Z", "type": "forcePushed"}]}