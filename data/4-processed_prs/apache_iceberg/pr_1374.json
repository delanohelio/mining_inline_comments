{"pr_number": 1374, "pr_title": "Fix FileHandle Leak in BaseDataReader for MetadataFiles", "pr_createdAt": "2020-08-24T23:50:23Z", "pr_url": "https://github.com/apache/iceberg/pull/1374", "timeline": [{"oid": "a94ccbec50c5fade898f9a12522df53341443db4", "url": "https://github.com/apache/iceberg/commit/a94ccbec50c5fade898f9a12522df53341443db4", "message": "Fix FileHandle Leak in BaseDataReader for MetadataFiles\n\nThe core issue here was that previously when using CloseableIterable.filter\nThe iterator generated by the wrapped Iterable would be wrapped by a Guava\nIterator regardless of the wrapped iterators closable status. This means\nCalling Filter on an iterable would result in a CloseableIterable which\ngenerated incorrectly unclosable Iterators.\n\nTo fix this we replace the Guava IterablesFilter operation with the\nFilterIterator class. This properly wraps the underlying closable iterator\nso that when we generate iterators we still get classes that can close\ntheir wrapped implementations.", "committedDate": "2020-08-24T23:49:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3NjYwOA==", "url": "https://github.com/apache/iceberg/pull/1374#discussion_r475976608", "bodyText": "nit: can we import TestableCloseableIterator and fit on one line?", "author": "aokolnychyi", "createdAt": "2020-08-24T23:54:48Z", "path": "api/src/test/java/org/apache/iceberg/io/TestCloseableIterable.java", "diffHunk": "@@ -28,6 +29,36 @@\n \n public class TestCloseableIterable {\n \n+  @Test\n+  public void testFilterManuallyClosable() throws IOException {\n+    TestableCloseableIterable iterable = new TestableCloseableIterable();\n+    TestableCloseableIterable.TestableCloseableIterator iterator =", "originalCommit": "a94ccbec50c5fade898f9a12522df53341443db4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3Njg5MQ==", "url": "https://github.com/apache/iceberg/pull/1374#discussion_r475976891", "bodyText": "Looks like indentation (2 spaces) is off for this file (4 spaces). Can you fix it?", "author": "rdblue", "createdAt": "2020-08-24T23:55:10Z", "path": "api/src/test/java/org/apache/iceberg/io/TestableCloseableIterable.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.iceberg.io;\n+\n+import java.io.IOException;\n+\n+public class TestableCloseableIterable implements  CloseableIterable<Integer>{\n+    private Boolean closed = false;", "originalCommit": "a94ccbec50c5fade898f9a12522df53341443db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3OTY2OA==", "url": "https://github.com/apache/iceberg/pull/1374#discussion_r475979668", "bodyText": "Ah looks like \"run checkstyle on this project\" from IDEA only applies to non test files whoops!", "author": "RussellSpitzer", "createdAt": "2020-08-24T23:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3Njg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3NzgxNw==", "url": "https://github.com/apache/iceberg/pull/1374#discussion_r475977817", "bodyText": "Extra space after implements and no space before {", "author": "aokolnychyi", "createdAt": "2020-08-24T23:56:27Z", "path": "api/src/test/java/org/apache/iceberg/io/TestableCloseableIterable.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.iceberg.io;\n+\n+import java.io.IOException;\n+\n+public class TestableCloseableIterable implements  CloseableIterable<Integer>{", "originalCommit": "a94ccbec50c5fade898f9a12522df53341443db4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1a1fd78bca54f871f3a23872163b14591c8db8fa", "url": "https://github.com/apache/iceberg/commit/1a1fd78bca54f871f3a23872163b14591c8db8fa", "message": "Fix Style Violations", "committedDate": "2020-08-25T00:01:47Z", "type": "commit"}, {"oid": "b14deb734e39cc3d4f16dbcfd95ef21146682b6e", "url": "https://github.com/apache/iceberg/commit/b14deb734e39cc3d4f16dbcfd95ef21146682b6e", "message": "Move FilterIterator", "committedDate": "2020-08-25T04:05:26Z", "type": "commit"}]}