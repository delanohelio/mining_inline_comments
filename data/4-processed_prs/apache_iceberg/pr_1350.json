{"pr_number": 1350, "pr_title": "Update Static Analysis", "pr_createdAt": "2020-08-17T21:57:38Z", "pr_url": "https://github.com/apache/iceberg/pull/1350", "timeline": [{"oid": "ec364e77c0361762257d7c60bb3dfc74d2f496ea", "url": "https://github.com/apache/iceberg/commit/ec364e77c0361762257d7c60bb3dfc74d2f496ea", "message": "Update Static Analysis WIP\n\nWIP", "committedDate": "2020-08-20T16:43:15Z", "type": "commit"}, {"oid": "3bc9cd66d47bcda779d58d4208ab946c0d51576d", "url": "https://github.com/apache/iceberg/commit/3bc9cd66d47bcda779d58d4208ab946c0d51576d", "message": "Fix Style Issues that were Previously False Negatives\n\nRemove check for Constructors on a single line, We do this alot\nFix several methods without braces on their own lines\nFix incorrect indentation in a few files", "committedDate": "2020-08-20T16:43:19Z", "type": "commit"}, {"oid": "3bc9cd66d47bcda779d58d4208ab946c0d51576d", "url": "https://github.com/apache/iceberg/commit/3bc9cd66d47bcda779d58d4208ab946c0d51576d", "message": "Fix Style Issues that were Previously False Negatives\n\nRemove check for Constructors on a single line, We do this alot\nFix several methods without braces on their own lines\nFix incorrect indentation in a few files", "committedDate": "2020-08-20T16:43:19Z", "type": "forcePushed"}, {"oid": "b78acbcfec9e0fa5f41fd3eec2bced304c36e42e", "url": "https://github.com/apache/iceberg/commit/b78acbcfec9e0fa5f41fd3eec2bced304c36e42e", "message": "Fix Optional orElse\n\nOrElse vs OrElseGet", "committedDate": "2020-08-20T21:24:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI4MjYyNA==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474282624", "bodyText": "Because schema is non-final we can't just switch this to a lambda", "author": "RussellSpitzer", "createdAt": "2020-08-20T21:27:57Z", "path": "spark2/src/main/java/org/apache/iceberg/spark/source/Reader.java", "diffHunk": "@@ -143,8 +143,9 @@\n       } catch (IOException ioe) {\n         LOG.warn(\"Failed to get Hadoop Filesystem\", ioe);\n       }\n+      Boolean localityFallback = LOCALITY_WHITELIST_FS.contains(scheme);\n       this.localityPreferred = options.get(\"locality\").map(Boolean::parseBoolean)\n-          .orElse(LOCALITY_WHITELIST_FS.contains(scheme));\n+          .orElse(localityFallback);", "originalCommit": "b78acbcfec9e0fa5f41fd3eec2bced304c36e42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI4Mzg5Ng==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474283896", "bodyText": "I think actually this would actually be fine, but to make the rules happy we would have to reassign Scheme anyway so I figured we may as well just put the result in a local var", "author": "RussellSpitzer", "createdAt": "2020-08-20T21:30:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI4MjYyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MjEyMQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474292121", "bodyText": "We could refactor scheme detection into a method to make scheme effectively final here.", "author": "rdblue", "createdAt": "2020-08-20T21:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI4MjYyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTMxNw==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474291317", "bodyText": "This seems more general than \"allowThrowsTagsForSubclasses\"? Are we sure it does the same thing?", "author": "rdblue", "createdAt": "2020-08-20T21:47:51Z", "path": ".baseline/checkstyle/checkstyle.xml", "diffHunk": "@@ -409,11 +409,9 @@\n         <module name=\"JavadocMethod\"> <!-- Java Style Guide: Where Javadoc is used -->\n             <property name=\"scope\" value=\"public\"/>\n             <property name=\"allowMissingParamTags\" value=\"true\"/>\n-            <property name=\"allowMissingThrowsTags\" value=\"true\"/>\n             <property name=\"allowMissingReturnTag\" value=\"true\"/>\n-            <property name=\"minLineCount\" value=\"99999999\"/>\n             <property name=\"allowedAnnotations\" value=\"Override, Test\"/>\n-            <property name=\"allowThrowsTagsForSubclasses\" value=\"true\"/>\n+            <property name=\"validateThrows\" value=\"false\"/>", "originalCommit": "b78acbcfec9e0fa5f41fd3eec2bced304c36e42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5ODUwMQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474298501", "bodyText": "It's a bit of a complicated story\ncheckstyle/checkstyle#7329\nLong story short, the checks were basically broken in check style so they were removed and are no longer valid configs.  We actually don't need to set \"validateThrows\"  to false either since it is false by default. I just wanted to make sure we were aware that we weren't validating any throw related tags.", "author": "RussellSpitzer", "createdAt": "2020-08-20T22:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474291417", "bodyText": "Do we require the empty line?", "author": "rdblue", "createdAt": "2020-08-20T21:48:08Z", "path": "arrow/src/main/java/org/apache/iceberg/arrow/vectorized/VectorizedArrowReader.java", "diffHunk": "@@ -347,7 +347,9 @@ public String toString() {\n     }\n \n     @Override\n-    public void setBatchSize(int batchSize) {}\n+    public void setBatchSize(int batchSize) {\n+", "originalCommit": "b78acbcfec9e0fa5f41fd3eec2bced304c36e42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MzgxNQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474293815", "bodyText": "Yep, we actually did for the Private Constructors as well but we were ignoring that everywhere so I deleted that check\n        <module name=\"RightCurly\"> <!-- Java Style Guide: Nonempty blocks: K & R style -->\n            <property name=\"option\" value=\"alone\"/>\n            <property name=\"tokens\" value=\"CLASS_DEF, **METHOD_DEF**, CTOR_DEF, LITERAL_FOR, LITERAL_WHILE, STATIC_INIT, INSTANCE_INIT\"/>\n        </module>\n\nBasically Check-style was just broken before (see my comment on this PR) and didn't work correctly on empty blocks.", "author": "RussellSpitzer", "createdAt": "2020-08-20T21:53:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzMzkyMQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474333921", "bodyText": "I don't suppose it's possible to make it okay to have the right curly on the line just after the method definition?", "author": "rdblue", "createdAt": "2020-08-20T23:57:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc1ODczOA==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474758738", "bodyText": "That is allowed, I'll change it", "author": "RussellSpitzer", "createdAt": "2020-08-21T15:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgwMjcxNQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474802715", "bodyText": "Does that allow us to turn it back on for private constructors without too much trouble?", "author": "rdblue", "createdAt": "2020-08-21T16:29:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxOTEwMA==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474819100", "bodyText": "You want to have it on for private constructors and I can change all the references to\nprivate Constructor() {\n}\n\nBecause I can do that no problem", "author": "RussellSpitzer", "createdAt": "2020-08-21T17:02:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgyODA4MQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474828081", "bodyText": "I think that's what we do in most places isn't it? I was hoping that with this update it wouldn't be too many places to change. Probably good to update them to all be standard, right?", "author": "rdblue", "createdAt": "2020-08-21T17:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgyODIzMQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474828231", "bodyText": "But we can do that in a separate PR if you want to keep this one small.", "author": "rdblue", "createdAt": "2020-08-21T17:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTQxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MTcxMQ==", "url": "https://github.com/apache/iceberg/pull/1350#discussion_r474291711", "bodyText": "Nice that it catches these.", "author": "rdblue", "createdAt": "2020-08-20T21:48:51Z", "path": "orc/src/main/java/org/apache/iceberg/orc/ORCSchemaUtil.java", "diffHunk": "@@ -267,7 +267,7 @@ private static TypeDescription buildOrcProjection(Integer fieldId, Type type, bo\n           // e.g. renaming column c -> d and adding new column d\n           String name = Optional.ofNullable(mapping.get(nestedField.fieldId()))\n               .map(OrcField::name)\n-              .orElse(nestedField.name() + \"_r\" + nestedField.fieldId());\n+              .orElseGet(() -> nestedField.name() + \"_r\" + nestedField.fieldId());", "originalCommit": "b78acbcfec9e0fa5f41fd3eec2bced304c36e42e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1aeaf75b65dd68013b34f4a2b8ba503e23c5beba", "url": "https://github.com/apache/iceberg/commit/1aeaf75b65dd68013b34f4a2b8ba503e23c5beba", "message": "Switch to Effectively Local Scheme in Reader", "committedDate": "2020-08-20T22:36:39Z", "type": "commit"}, {"oid": "0f23296c829304f44c1cb999bad689ce17f6fe44", "url": "https://github.com/apache/iceberg/commit/0f23296c829304f44c1cb999bad689ce17f6fe44", "message": "Fix Spacing", "committedDate": "2020-08-21T15:09:51Z", "type": "commit"}, {"oid": "e452662271c1647f056ad13e190ca18fea38fc03", "url": "https://github.com/apache/iceberg/commit/e452662271c1647f056ad13e190ca18fea38fc03", "message": "Fix all Single Line Constructors\n\nWe decided to enforce no single line constructors", "committedDate": "2020-08-21T17:45:15Z", "type": "commit"}, {"oid": "2ec9eadecc4be91195794c898a629fdcb1c779aa", "url": "https://github.com/apache/iceberg/commit/2ec9eadecc4be91195794c898a629fdcb1c779aa", "message": "Fix Comments without Whitespace\n\nUse todoComment rules as a CommentRegex to find comments which lead\nwith a word character. Flags these instances as a mistake.", "committedDate": "2020-08-21T18:47:12Z", "type": "commit"}]}