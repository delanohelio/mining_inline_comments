{"pr_number": 1891, "pr_title": "AWS: documentation page for AWS module", "pr_createdAt": "2020-12-08T18:59:56Z", "pr_url": "https://github.com/apache/iceberg/pull/1891", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzODY5OA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544238698", "bodyText": "Thank you @jackye1995  it looks great, this is more an question. is it also possible to run iceberg with AWS \"Glue Job\"? if we use spark.jars.packages to provide iceberg library.", "author": "ismailsimsek", "createdAt": "2020-12-16T11:55:02Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n+\n+\n+## AWS client configurations\n+\n+Many organizations have customized their way of obtaining AWS credential and region information and configuring details about AWS clients for features like proxy access, retry, etc.\n+Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. \n+Users can set the `client.configurer` property as the class of the custom configurer.\n+\n+For example, a configurer can do something like the following:\n+\n+```java\n+package com.my.team;\n+\n+import software.amazon.awssdk.auth.credentials.ContainerCredentialsProvider;\n+import software.amazon.awssdk.awscore.client.builder.AwsClientBuilder;\n+import software.amazon.awssdk.services.s3.S3ClientBuilder;\n+\n+public class MyCustomClientConfigurer implements AwsClientConfigurer {\n+\n+  @Override\n+  public <T extends AwsClientBuilder & AwsSyncClientBuilder> T configure(T clientBuilder) {\n+    \n+    // set some custom s3 configurations\n+    if (clientBuilder instanceof S3ClientBuilder) {\n+      S3ClientBuilder s3ClientBuilder = (S3ClientBuilder) clientBuilder;\n+      // configure something\n+    }\n+\n+    // set the same credential provider for all clients\n+    clientBuilder.credentialsProvider(ContainerCredentialsProvider.builder().build());\n+  }\n+}\n+```\n+\n+### AssumeRoleConfigurer\n+\n+As a common use case scenario, we provide `AssumeRoleConfigurer` as an example configurer. It has the following catalog properties:\n+\n+* `client.assume-role.arn`: role ARN to assume\n+* `client.assume-role.timeout-sec`: seconds for an assume-role session, after the timeout a new session is automatically fetched by a STS client.\n+* `client.assume-role.external-id`: optional external ID for the role to assume\n+* `client.assume-role.region`: a region for all clients (except the STS client) to use\n+\n+When this configurer is used, a STS client is initialized with default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),\n+and all the other clients (Glue, DynamoDB, S3, etc.) will use the configured assume-role credential and region.\n+\n+## Run Iceberg on AWS", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNzM5OQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r545317399", "bodyText": "I have not tried that yet since I am mostly focused on Athena use case, but let me check if anyone has done that, thanks for bringing up this use case.", "author": "jackye1995", "createdAt": "2020-12-17T18:41:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzODY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwNDczMQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544704731", "bodyText": "Guess this might need to be updated as it seems that we do want to include iceberg-aws now, just without AWS dependencies?", "author": "yyanyy", "createdAt": "2020-12-16T23:46:31Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0Njk3NQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547046975", "bodyText": "Yes", "author": "jackye1995", "createdAt": "2020-12-22T03:28:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwNDczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwNDgzNA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544704834", "bodyText": "since we mention minimum dependency here, should we also mention the minimum list of \"individual AWS client packages\" here or maybe refer to the build file so that people know what packages have to be included if they want to do that?", "author": "yyanyy", "createdAt": "2020-12-16T23:46:45Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0OTczMw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547049733", "bodyText": "Fixed", "author": "jackye1995", "createdAt": "2020-12-22T03:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwNDgzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwODc5Nw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544708797", "bodyText": "For things like setting glue catalog id we probably want to mention the parameter \"gluecatalog.id\"; or overall I think we may want to add a section in the configuration page that include all configurable parameters mentioned in AwsProperties and link to that section in this page, otherwise people won't know how to configure them. And that would serve as a centralized place to read about all configurations. Is it part of the plan/covered by other PRs?", "author": "yyanyy", "createdAt": "2020-12-16T23:56:49Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwOTU4OA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544709588", "bodyText": "Nit: I guess the logic here isn't super clear to me or I misunderstood; it seems like the \"this is because\" part is not explaining why we want to use aws account ID, but rather to explain we can configure region and other stuff when we need to?", "author": "yyanyy", "createdAt": "2020-12-16T23:58:48Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA2NTEyOQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547065129", "bodyText": "I see, please read if the new version is easier to understand.", "author": "jackye1995", "createdAt": "2020-12-22T04:45:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwOTU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwOTg0OQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544709849", "bodyText": "Forgot to update the string to be set?", "author": "yyanyy", "createdAt": "2020-12-16T23:59:27Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcxNjgxNg==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544716816", "bodyText": "From the current code base it seems like we are not defaulting it to anything, is this aws/s3 a default value on AWS SDK or something?", "author": "yyanyy", "createdAt": "2020-12-17T00:17:28Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA2NTIzOQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547065239", "bodyText": "Yes that is the default at service side.", "author": "jackye1995", "createdAt": "2020-12-22T04:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcxNjgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTM5Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544751393", "bodyText": "Minor: did you have to pull down the aws sdk bundle to run sparksql in EMR? IIRC there's already some preinstalled aws libraries on EMR, if that's true we might be able to mention them here to save one step for the users.", "author": "yyanyy", "createdAt": "2020-12-17T01:50:56Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n+\n+\n+## AWS client configurations\n+\n+Many organizations have customized their way of obtaining AWS credential and region information and configuring details about AWS clients for features like proxy access, retry, etc.\n+Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. \n+Users can set the `client.configurer` property as the class of the custom configurer.\n+\n+For example, a configurer can do something like the following:\n+\n+```java\n+package com.my.team;\n+\n+import software.amazon.awssdk.auth.credentials.ContainerCredentialsProvider;\n+import software.amazon.awssdk.awscore.client.builder.AwsClientBuilder;\n+import software.amazon.awssdk.services.s3.S3ClientBuilder;\n+\n+public class MyCustomClientConfigurer implements AwsClientConfigurer {\n+\n+  @Override\n+  public <T extends AwsClientBuilder & AwsSyncClientBuilder> T configure(T clientBuilder) {\n+    \n+    // set some custom s3 configurations\n+    if (clientBuilder instanceof S3ClientBuilder) {\n+      S3ClientBuilder s3ClientBuilder = (S3ClientBuilder) clientBuilder;\n+      // configure something\n+    }\n+\n+    // set the same credential provider for all clients\n+    clientBuilder.credentialsProvider(ContainerCredentialsProvider.builder().build());\n+  }\n+}\n+```\n+\n+### AssumeRoleConfigurer\n+\n+As a common use case scenario, we provide `AssumeRoleConfigurer` as an example configurer. It has the following catalog properties:\n+\n+* `client.assume-role.arn`: role ARN to assume\n+* `client.assume-role.timeout-sec`: seconds for an assume-role session, after the timeout a new session is automatically fetched by a STS client.\n+* `client.assume-role.external-id`: optional external ID for the role to assume\n+* `client.assume-role.region`: a region for all clients (except the STS client) to use\n+\n+When this configurer is used, a STS client is initialized with default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),\n+and all the other clients (Glue, DynamoDB, S3, etc.) will use the configured assume-role credential and region.\n+\n+## Run Iceberg on AWS\n+\n+[Amazon EMR](https://aws.amazon.com/emr/) is the most common platform to run Iceberg on AWS. EMR can provision clusters with [Spark](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark.html) (EMR 6 for Spark 3, EMR 5 for Spark 2),", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA2NTM2NQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547065365", "bodyText": "The v2 library is not bundled in spark.", "author": "jackye1995", "createdAt": "2020-12-22T04:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTM5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MDUxMQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544770511", "bodyText": "I was about to ask the rationalization of S3 FileIO compared to Hadoop filesystem API with S3 support in #1945, but this section covers it. Thanks!\nProbably worth to also mention whether Hadoop FS API with S3 is sufficient to work with, or S3 FileIO is required to avoid consistency glitches. That would help end users to determine whether including aws module is a kind of requirement for dealing with S3 or not.", "author": "HeartSaVioR", "createdAt": "2020-12-17T02:45:29Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA4NTA3NA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547085074", "bodyText": "I have updated strong consistency section for more details, please let me know if it is enough.", "author": "jackye1995", "createdAt": "2020-12-22T06:01:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MDUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4MjI0Mg==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544982242", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Iceberg allows user to write data to S3 through `S3FileIO`.\n          \n          \n            \n            Iceberg allows users to write data to S3 through `S3FileIO`.", "author": "massdosage", "createdAt": "2020-12-17T10:33:41Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4MjU1Ng==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544982556", "bodyText": "Is there a default here? Or is there no default and setting this is required?", "author": "massdosage", "createdAt": "2020-12-17T10:34:14Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NzExOQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547077119", "bodyText": "default to Runtime.getRuntime().availableProcessors(), let me add in the doc", "author": "jackye1995", "createdAt": "2020-12-22T05:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4MjU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4MjgzMA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544982830", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n          \n          \n            \n            * `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, defaults to 32MB\n          \n      \n    \n    \n  \n\nor\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n          \n          \n            \n            * `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default is 32MB", "author": "massdosage", "createdAt": "2020-12-17T10:34:38Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4MzI0OA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544983248", "bodyText": "as above defaults to or default is", "author": "massdosage", "createdAt": "2020-12-17T10:35:13Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4MzM5Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544983393", "bodyText": "as above to/is", "author": "massdosage", "createdAt": "2020-12-17T10:35:24Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NDEyMg==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544984122", "bodyText": "As above for defaults.", "author": "massdosage", "createdAt": "2020-12-17T10:36:33Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NDc2MA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544984760", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n          \n          \n            \n            Iceberg by default uses the Hive storage layout, but can be configured to use a different `ObjectStoreLocationProvider`.", "author": "massdosage", "createdAt": "2020-12-17T10:37:32Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NTMzNA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544985334", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n          \n          \n            \n            For more details, please refer to the [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to see how to enable this feature.", "author": "massdosage", "createdAt": "2020-12-17T10:38:29Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  ", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NTY0Nw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544985647", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n          \n          \n            \n            When creating a new output file using `OutputFile.create()`, a strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.", "author": "massdosage", "createdAt": "2020-12-17T10:38:58Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NjA4Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544986083", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             and is thus recommend for S3 use case over S3A.\n          \n          \n            \n             and is thus recommend for S3 use cases rather than the S3A FileSystem.", "author": "massdosage", "createdAt": "2020-12-17T10:39:37Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NjY5Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544986693", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### Hadoop S3A\n          \n          \n            \n            ### Hadoop S3A FileSystem\n          \n      \n    \n    \n  \n\nI think it's useful to refer to the FileSystem otherwise some people might get confused by the differences between S3, S3A, S3N etc.", "author": "massdosage", "createdAt": "2020-12-17T10:40:30Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4ODU0MQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544988541", "bodyText": "Here you are talking about storing data using s3a:// URLs as opposed to the above discussion about the S3A FileSystem right? This should probably be reworded to be clear about that if that is the case.", "author": "massdosage", "createdAt": "2020-12-17T10:43:16Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA4NDY4Mg==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547084682", "bodyText": "Thank you, I updated the section, please let me know if it is clearer.", "author": "jackye1995", "createdAt": "2020-12-22T06:00:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4ODU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4ODczNQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544988735", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n          \n          \n            \n            1. To store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse`", "author": "massdosage", "createdAt": "2020-12-17T10:43:33Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` ", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4OTE1NQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544989155", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n          \n          \n            \n            2. For `HiveCatalog`, to also store metadata using S3A, specify the Hadoop config property `hive.metastore.warehouse.dir` to be an S3A path.", "author": "massdosage", "createdAt": "2020-12-17T10:44:09Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4OTU4Ng==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544989586", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n          \n          \n            \n            3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version as S3A configuration varies a lot based on the version you use) .", "author": "massdosage", "createdAt": "2020-12-17T10:44:48Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   ", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4OTkxNQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544989915", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. \n          \n          \n            \n            Therefore, we open a configurer interface for Iceberg users to plug in any client configuration in a centralized place.", "author": "massdosage", "createdAt": "2020-12-17T10:45:12Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n+\n+\n+## AWS client configurations\n+\n+Many organizations have customized their way of obtaining AWS credential and region information and configuring details about AWS clients for features like proxy access, retry, etc.\n+Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. ", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk5MDUzMw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544990533", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When this configurer is used, a STS client is initialized with default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),\n          \n          \n            \n            When this configurer is used, a STS client is initialized with a default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),", "author": "massdosage", "createdAt": "2020-12-17T10:46:11Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n+\n+\n+## AWS client configurations\n+\n+Many organizations have customized their way of obtaining AWS credential and region information and configuring details about AWS clients for features like proxy access, retry, etc.\n+Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. \n+Users can set the `client.configurer` property as the class of the custom configurer.\n+\n+For example, a configurer can do something like the following:\n+\n+```java\n+package com.my.team;\n+\n+import software.amazon.awssdk.auth.credentials.ContainerCredentialsProvider;\n+import software.amazon.awssdk.awscore.client.builder.AwsClientBuilder;\n+import software.amazon.awssdk.services.s3.S3ClientBuilder;\n+\n+public class MyCustomClientConfigurer implements AwsClientConfigurer {\n+\n+  @Override\n+  public <T extends AwsClientBuilder & AwsSyncClientBuilder> T configure(T clientBuilder) {\n+    \n+    // set some custom s3 configurations\n+    if (clientBuilder instanceof S3ClientBuilder) {\n+      S3ClientBuilder s3ClientBuilder = (S3ClientBuilder) clientBuilder;\n+      // configure something\n+    }\n+\n+    // set the same credential provider for all clients\n+    clientBuilder.credentialsProvider(ContainerCredentialsProvider.builder().build());\n+  }\n+}\n+```\n+\n+### AssumeRoleConfigurer\n+\n+As a common use case scenario, we provide `AssumeRoleConfigurer` as an example configurer. It has the following catalog properties:\n+\n+* `client.assume-role.arn`: role ARN to assume\n+* `client.assume-role.timeout-sec`: seconds for an assume-role session, after the timeout a new session is automatically fetched by a STS client.\n+* `client.assume-role.external-id`: optional external ID for the role to assume\n+* `client.assume-role.region`: a region for all clients (except the STS client) to use\n+\n+When this configurer is used, a STS client is initialized with default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk5MTI4Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544991283", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [Amazon Kinesis Data Analytics](https://aws.amazon.com/about-aws/whats-new/2019/11/you-can-now-run-fully-managed-apache-flink-applications-with-apache-kafka/) also provdies a way \n          \n          \n            \n            [Amazon Kinesis Data Analytics](https://aws.amazon.com/about-aws/whats-new/2019/11/you-can-now-run-fully-managed-apache-flink-applications-with-apache-kafka/) also provides a way", "author": "massdosage", "createdAt": "2020-12-17T10:47:14Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n+\n+\n+## AWS client configurations\n+\n+Many organizations have customized their way of obtaining AWS credential and region information and configuring details about AWS clients for features like proxy access, retry, etc.\n+Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. \n+Users can set the `client.configurer` property as the class of the custom configurer.\n+\n+For example, a configurer can do something like the following:\n+\n+```java\n+package com.my.team;\n+\n+import software.amazon.awssdk.auth.credentials.ContainerCredentialsProvider;\n+import software.amazon.awssdk.awscore.client.builder.AwsClientBuilder;\n+import software.amazon.awssdk.services.s3.S3ClientBuilder;\n+\n+public class MyCustomClientConfigurer implements AwsClientConfigurer {\n+\n+  @Override\n+  public <T extends AwsClientBuilder & AwsSyncClientBuilder> T configure(T clientBuilder) {\n+    \n+    // set some custom s3 configurations\n+    if (clientBuilder instanceof S3ClientBuilder) {\n+      S3ClientBuilder s3ClientBuilder = (S3ClientBuilder) clientBuilder;\n+      // configure something\n+    }\n+\n+    // set the same credential provider for all clients\n+    clientBuilder.credentialsProvider(ContainerCredentialsProvider.builder().build());\n+  }\n+}\n+```\n+\n+### AssumeRoleConfigurer\n+\n+As a common use case scenario, we provide `AssumeRoleConfigurer` as an example configurer. It has the following catalog properties:\n+\n+* `client.assume-role.arn`: role ARN to assume\n+* `client.assume-role.timeout-sec`: seconds for an assume-role session, after the timeout a new session is automatically fetched by a STS client.\n+* `client.assume-role.external-id`: optional external ID for the role to assume\n+* `client.assume-role.region`: a region for all clients (except the STS client) to use\n+\n+When this configurer is used, a STS client is initialized with default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),\n+and all the other clients (Glue, DynamoDB, S3, etc.) will use the configured assume-role credential and region.\n+\n+## Run Iceberg on AWS\n+\n+[Amazon EMR](https://aws.amazon.com/emr/) is the most common platform to run Iceberg on AWS. EMR can provision clusters with [Spark](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark.html) (EMR 6 for Spark 3, EMR 5 for Spark 2),\n+[Hive](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hive.html), [Flink](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-flink.html),\n+[Presto](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-presto.html) that can run Iceberg.\n+\n+[Amazon Kinesis Data Analytics](https://aws.amazon.com/about-aws/whats-new/2019/11/you-can-now-run-fully-managed-apache-flink-applications-with-apache-kafka/) also provdies a way ", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk5MTUwOA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r544991508", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            to run fully managed Apache Flink application. You can include Iceberg in your application Jar and run it in the platform.\n          \n          \n            \n            to run fully managed Apache Flink applications. You can include Iceberg in your application Jar and run it in the platform.", "author": "massdosage", "createdAt": "2020-12-17T10:47:34Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,212 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The first thing to note is that the `iceberg-aws` module is not bundled with any engine runtime.\n+To use any features described in later sections, you need to include the following packages by yourself:\n+\n+* the [iceberg AWS package](https://mvnrepository.com/artifact/org.apache.iceberg/iceberg-aws)\n+* the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), or individual AWS client packages if you would like to have a minimum dependency footprint. (please note that we use the new AWS v2 SDK instead of v1)\n+\n+For example, in Spark 3, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,org.apache.iceberg:iceberg-aws-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+It is very common for an organization to store all the tables in a single Glue catalog in a single AWS account and run data computation in many different accounts. \n+In this case, you need to specify a Glue catalog ID when initializing `GlueCatalog`.\n+The Glue catalog ID you should use is the AWS account ID.\n+This is because in each AWS account, there is a single Glue catalog in each AWS region,\n+but the region is pre-determined by the Glue web client that is making the call.\n+If you would like to access a Glue catalog in a different region, you should configure you AWS client, see more details in [AWS client configuration](#aws-client-configurations).\n+It is also common to [assume a role](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) when having cross-account access. See [AssumeRoleConfigurer](#assumeroleconfigurer) for how to set up assume role credentials in Iceberg.\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, default to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, default to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows user to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared pool across all output streams)\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, default to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, default to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, default to Java's `java.io.tmpdir` property value\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+* `s3fileio.sse.type`: `none`, `s3`, `kms` or `custom`, default to `none`\n+* `s3fileio.sse.key`: a KMS Key ID or ARN for `kms` type (default to `aws/s3`), or a custom base-64 AES256 symmetric key for `custom` type.\n+* `s3fileio.sse.md5`: if SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity.\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list for detailed access control. \n+User can choose the ACL level by setting the `s3fileio.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switch to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+For more details, please follow [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section to enable this feature.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all GET and LIST operations, and Iceberg is updated to fully leverage this feature.\n+When creating a new output file using `OutputFile.create()`, strong consistency check is used and an `AlreadyExistsException` will be thrown if the file already exists in S3.\n+\n+### Hadoop S3A\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the above sections, the `S3FileIO` adopts latest AWS clients and S3 features for optimzied security and performance,\n+ and is thus recommend for S3 use case over S3A.\n+\n+`S3FileIO` is compatible with legacy URI schemes written by S3A, \n+so any existing tables with `s3a://` or `s3n://` file paths are treated as equivalent `s3://` file paths.    \n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. to store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to store metadata also using S3A, specify Hadoop config `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency, configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, s3a configuration varies a lot based on the version you use)   \n+\n+\n+## AWS client configurations\n+\n+Many organizations have customized their way of obtaining AWS credential and region information and configuring details about AWS clients for features like proxy access, retry, etc.\n+Therefore, we open a configurer interface for Iceberg users to plugin any client configuration in a centralized place. \n+Users can set the `client.configurer` property as the class of the custom configurer.\n+\n+For example, a configurer can do something like the following:\n+\n+```java\n+package com.my.team;\n+\n+import software.amazon.awssdk.auth.credentials.ContainerCredentialsProvider;\n+import software.amazon.awssdk.awscore.client.builder.AwsClientBuilder;\n+import software.amazon.awssdk.services.s3.S3ClientBuilder;\n+\n+public class MyCustomClientConfigurer implements AwsClientConfigurer {\n+\n+  @Override\n+  public <T extends AwsClientBuilder & AwsSyncClientBuilder> T configure(T clientBuilder) {\n+    \n+    // set some custom s3 configurations\n+    if (clientBuilder instanceof S3ClientBuilder) {\n+      S3ClientBuilder s3ClientBuilder = (S3ClientBuilder) clientBuilder;\n+      // configure something\n+    }\n+\n+    // set the same credential provider for all clients\n+    clientBuilder.credentialsProvider(ContainerCredentialsProvider.builder().build());\n+  }\n+}\n+```\n+\n+### AssumeRoleConfigurer\n+\n+As a common use case scenario, we provide `AssumeRoleConfigurer` as an example configurer. It has the following catalog properties:\n+\n+* `client.assume-role.arn`: role ARN to assume\n+* `client.assume-role.timeout-sec`: seconds for an assume-role session, after the timeout a new session is automatically fetched by a STS client.\n+* `client.assume-role.external-id`: optional external ID for the role to assume\n+* `client.assume-role.region`: a region for all clients (except the STS client) to use\n+\n+When this configurer is used, a STS client is initialized with default [credentials chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html) and [region chain](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/region-selection.html),\n+and all the other clients (Glue, DynamoDB, S3, etc.) will use the configured assume-role credential and region.\n+\n+## Run Iceberg on AWS\n+\n+[Amazon EMR](https://aws.amazon.com/emr/) is the most common platform to run Iceberg on AWS. EMR can provision clusters with [Spark](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark.html) (EMR 6 for Spark 3, EMR 5 for Spark 2),\n+[Hive](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hive.html), [Flink](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-flink.html),\n+[Presto](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-presto.html) that can run Iceberg.\n+\n+[Amazon Kinesis Data Analytics](https://aws.amazon.com/about-aws/whats-new/2019/11/you-can-now-run-fully-managed-apache-flink-applications-with-apache-kafka/) also provdies a way \n+to run fully managed Apache Flink application. You can include Iceberg in your application Jar and run it in the platform.", "originalCommit": "2b3b8bc3d8aa06870ca26a5f68d3c59889fab45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "url": "https://github.com/apache/iceberg/commit/99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "message": "update doc based on feedback and latest client config", "committedDate": "2020-12-22T06:04:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1MjQ4Mg==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547552482", "bodyText": "How about \"You will need to provide the AWS v2 SDK because that is what Iceberg depends on.\" Saying \"instead of v1\" makes it sound like you can't use both, so I would omit that as well.", "author": "rdblue", "createdAt": "2020-12-22T23:16:53Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1MjY3OQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547552679", "bodyText": "You may want to call out the part that matters here, that this is adding software.amazon.awssdk:bundle:2.15.40 to the --packages argument.", "author": "rdblue", "createdAt": "2020-12-22T23:17:44Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1Mjk3Ng==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547552976", "bodyText": "Is this true? I thought that only one version of the table was kept and that it pointed to the Iceberg root metadata file. That file contains more than one snapshot.", "author": "rdblue", "createdAt": "2020-12-22T23:18:44Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). ", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzQ5NDAxMQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553494011", "bodyText": "Snapshot is probably a bad word, I will just use table version then.\nBut Glue also stores all historical table versions for each update.", "author": "jackye1995", "createdAt": "2021-01-07T18:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1Mjk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1MzUxMw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547553513", "bodyText": "I would drop references to Iceberg classes here. Most readers are going to care about tables through a SQL or DataFrame interface, not through Iceberg's API. The mapping to Glue database and table names is probably pretty clear.", "author": "rdblue", "createdAt": "2020-12-22T23:20:37Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1MzcwMQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547553701", "bodyText": "I would definitely give a full example of using GlueCatalog here, in addition to linking to Spark and Flink pages.", "author": "rdblue", "createdAt": "2020-12-22T23:21:21Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NzA3Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547557073", "bodyText": "Sorry, there's one above. Maybe just point the reader to it.", "author": "rdblue", "createdAt": "2020-12-22T23:33:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1MzcwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1Mzg0OQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547553849", "bodyText": "What about adding a table of configuration options instead of sections?", "author": "rdblue", "createdAt": "2020-12-22T23:21:53Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzQ5NTQxMA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553495410", "bodyText": "The reason I am doing this is because the explanation is quite long, which makes the table look very messy.", "author": "jackye1995", "createdAt": "2021-01-07T18:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1Mzg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MjYzNw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553672637", "bodyText": "I think it makes sense here, but I would opt for tables in most other places. Part of the appeal is it forces you to be concise.", "author": "rdblue", "createdAt": "2021-01-08T00:35:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1Mzg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NDMwMA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547554300", "bodyText": "I think it would be a bit cleaner if these catalog options were shorter. this could simply be skip-archive in the catalog config. Similarly, the one above could be catalog-id.", "author": "rdblue", "createdAt": "2020-12-22T23:23:24Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+You can specify the Glue catalog ID through `gluecatalog.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client configuration](#aws-client-configurations).\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `gluecatalog.skip-archive` to false.", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY1MDQ1NA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553650454", "bodyText": "This is mostly trying to be consistent with the s3fileio properties by having gluecatalog as the config namespace. We might be able to make all of them shorter, something like glue.id and s3.staging.dir. Any thoughts on this? @danielcweeks", "author": "jackye1995", "createdAt": "2021-01-07T23:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NDMwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NTAyOQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547555029", "bodyText": "What about lock-wait-ms and lock-expire-ms?", "author": "rdblue", "createdAt": "2020-12-22T23:25:48Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+You can specify the Glue catalog ID through `gluecatalog.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client configuration](#aws-client-configurations).\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `gluecatalog.skip-archive` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, defaults to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, defaults to 20 minutes", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjMyOQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547556329", "bodyText": "Great info here, but I think it may be easier to maintain as a table.", "author": "rdblue", "createdAt": "2020-12-22T23:30:13Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\\n+    --conf spark.sql.catalog.my_catalog.gluecatalog.lock.table=myGlueLockTable\n+```\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg `Namespace` is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg `Table` is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+an Iceberg `Snapshot` is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+You can specify the Glue catalog ID through `gluecatalog.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client configuration](#aws-client-configurations).\n+\n+### Skip Archive\n+\n+By default, Glue will store all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `gluecatalog.skip-archive` to false.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for locking Glue tables\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB lock is enabled by default for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+User must specify a table name through catalog property `gluecatalog.lock.table` as the helper DynamoDB lock table to use.\n+It is recommend to use the same DynamoDB table for operations in the same Glue catalog,\n+and use a different table for a different Glue catalog in another account or region.\n+If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [Pay-per-Request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+The lock has the following additional properties:\n+\n+* `gluecatalog.lock.wait-ms`:  max time to wait for lock acquisition, defaults to 3 minutes\n+* `gluecatalog.lock.expire-ms`: max time a table can be locked by a process, defaults to 20 minutes\n+\n+If your use case only consists of single-process low-frequency (e.g. hourly, daily) updates to a table,\n+you can also turn off this locking feature by setting `gluecatalog.lock.enabled` as false.\n+\n+### Warehouse Location\n+\n+By default, Glue uses `S3FileIO` and only allows a warehouse location in S3. \n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO using the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+## S3 FileIO\n+\n+Iceberg allows users to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded in parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations user can tune related to this feature:\n+\n+* `s3fileio.multipart.num-threads`: number of threads to use for uploading parts to S3 (shared across all output streams), defaults to the available number of processors in the system\n+* `s3fileio.multipart.part.size`: the size of a single part for multipart upload requests, defaults to 32MB\n+* `s3fileio.multipart.threshold`: the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload, defaults to 1.5\n+* `s3fileio.staging.dir`: the directory to hold temporary files, defaults to Java's `java.io.tmpdir` property value", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY0OTg5Mw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553649893", "bodyText": "switched to table layout.", "author": "jackye1995", "createdAt": "2021-01-07T23:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NzE2OA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r547557168", "bodyText": "Does the Glue catalog support custom database locations?", "author": "rdblue", "createdAt": "2020-12-22T23:33:39Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,170 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same version as your application.\n+Please note that we use the new AWS v2 SDK instead of v1.\n+You can choose to the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS) if you would like to have a minimum dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my-key-prefix \\", "originalCommit": "99c5fcdf84d111dddd3db70cb67cd8c69e1d2e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzQ5NjA5OA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553496098", "bodyText": "good point, let me add that section", "author": "jackye1995", "createdAt": "2021-01-07T18:08:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NzE2OA=="}], "type": "inlineReview"}, {"oid": "d62af37e484322f7e839a3d4dd4870041809987c", "url": "https://github.com/apache/iceberg/commit/d62af37e484322f7e839a3d4dd4870041809987c", "message": "update doc, add lock config table, reorganize tabs", "committedDate": "2021-01-07T23:23:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MzI3MA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553673270", "bodyText": "Have we released this yet? We would normally make it s3fileio.multipart.part-size-bytes:\n\npart is part of \"part size\" and isn't really part of the hierarchy\nWe prefer to have clear units", "author": "rdblue", "createdAt": "2021-01-08T00:37:31Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,187 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same client version as your application.\n+You will need to provide the AWS v2 SDK because that is what Iceberg depends on.\n+You can choose to use the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS, STS) if you would like to have a minimal dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my/key/prefix \\    \n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.lock.impl=org.apache.iceberg.aws.glue.DynamoLockManager \\\n+    --conf spark.sql.catalog.my_catalog.lock.table=myGlueLockTable\n+```\n+\n+As you can see, In the shell command, we use `--packages` to specify the additional AWS bundle dependency with its version as `2.15.40`.\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg namespace is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg table is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+and every Iceberg table version is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`,\n+just like what is shown in the [runtime packages](#runtime-packages) section above. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+You can specify the Glue catalog ID through `gluecatalog.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client customization](#aws-client-customization).\n+\n+### Skip Archive\n+\n+By default, Glue stores all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `gluecatalog.skip-archive` to true.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for commit locking\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB can be used for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+\n+To enable this feature, use the lock related catalog properties:\n+\n+1. Set `lock.impl` as `org.apache.iceberg.aws.glue.DynamoLockManager`.\n+2. Set `lock.table` as the DynamoDB table name you would like to use. If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [pay-per-request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+\n+Other lock related catalog properties can also be used to adjust locking behaviors such as heartbeat interval.\n+For more details, please refer to [Lock catalog properties](../configuration/#lock-catalog-properties). \n+\n+### Warehouse Location\n+\n+By default, Glue only allows a warehouse location in S3 because of the use of `S3FileIO`.\n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO through the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+### Table Location\n+\n+By default, the root location for a table `my_table` of namespace `my_ns` is at `my-warehouse-location/my-ns.db/my-table`.\n+This root location can be changed at both namespace and table level.\n+\n+To use a different path prefix for all tables under a namespace, use any AWS Glue client SDK you like to update the `locationUri` attribute of the corresponding Glue database.\n+For example, you can update the `locationUri` of `my_ns` to `s3://my-ns-bucket`, \n+then any newly created table will have a default root location under the new prefix.\n+For example, a new table `my_table_2` will have its root location at `s3://my-ns-bucket/my_table_2`.\n+\n+To use a completely different root path for a specific table, set the `location` table property to be the desired root path value.\n+\n+## S3 FileIO\n+\n+Iceberg allows users to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded by parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations that users can tune related to this feature:\n+\n+| Property                          | Default                                            | Description                                            |\n+| --------------------------------- | -------------------------------------------------- | ------------------------------------------------------ |\n+| s3fileio.multipart.num-threads    | the available number of processors in the system   | number of threads to use for uploading parts to S3 (shared across all output streams)  |\n+| s3fileio.multipart.part.size      | 32MB                                               | the size of a single part for multipart upload requests  |", "originalCommit": "d62af37e484322f7e839a3d4dd4870041809987c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MzQzMQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553673431", "bodyText": "Is there anything else under staging, or should this be staging-dir?", "author": "rdblue", "createdAt": "2021-01-08T00:38:14Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,187 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Runtime Packages\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same client version as your application.\n+You will need to provide the AWS v2 SDK because that is what Iceberg depends on.\n+You can choose to use the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS, STS) if you would like to have a minimal dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my/key/prefix \\    \n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.lock.impl=org.apache.iceberg.aws.glue.DynamoLockManager \\\n+    --conf spark.sql.catalog.my_catalog.lock.table=myGlueLockTable\n+```\n+\n+As you can see, In the shell command, we use `--packages` to specify the additional AWS bundle dependency with its version as `2.15.40`.\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg namespace is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg table is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+and every Iceberg table version is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`,\n+just like what is shown in the [runtime packages](#runtime-packages) section above. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+\n+You can specify the Glue catalog ID through `gluecatalog.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client customization](#aws-client-customization).\n+\n+### Skip Archive\n+\n+By default, Glue stores all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `gluecatalog.skip-archive` to true.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for commit locking\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, DynamoDB can be used for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+\n+To enable this feature, use the lock related catalog properties:\n+\n+1. Set `lock.impl` as `org.apache.iceberg.aws.glue.DynamoLockManager`.\n+2. Set `lock.table` as the DynamoDB table name you would like to use. If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [pay-per-request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+\n+Other lock related catalog properties can also be used to adjust locking behaviors such as heartbeat interval.\n+For more details, please refer to [Lock catalog properties](../configuration/#lock-catalog-properties). \n+\n+### Warehouse Location\n+\n+By default, Glue only allows a warehouse location in S3 because of the use of `S3FileIO`.\n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` \n+or any custom FileIO through the mechanism described in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+### Table Location\n+\n+By default, the root location for a table `my_table` of namespace `my_ns` is at `my-warehouse-location/my-ns.db/my-table`.\n+This root location can be changed at both namespace and table level.\n+\n+To use a different path prefix for all tables under a namespace, use any AWS Glue client SDK you like to update the `locationUri` attribute of the corresponding Glue database.\n+For example, you can update the `locationUri` of `my_ns` to `s3://my-ns-bucket`, \n+then any newly created table will have a default root location under the new prefix.\n+For example, a new table `my_table_2` will have its root location at `s3://my-ns-bucket/my_table_2`.\n+\n+To use a completely different root path for a specific table, set the `location` table property to be the desired root path value.\n+\n+## S3 FileIO\n+\n+Iceberg allows users to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this FileIO, and other catalogs can load this FileIO using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded by parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations that users can tune related to this feature:\n+\n+| Property                          | Default                                            | Description                                            |\n+| --------------------------------- | -------------------------------------------------- | ------------------------------------------------------ |\n+| s3fileio.multipart.num-threads    | the available number of processors in the system   | number of threads to use for uploading parts to S3 (shared across all output streams)  |\n+| s3fileio.multipart.part.size      | 32MB                                               | the size of a single part for multipart upload requests  |\n+| s3fileio.multipart.threshold      | 1.5                                                | the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload  |\n+| s3fileio.staging.dir              | `java.io.tmpdir` property value                    | the directory to hold temporary files  |", "originalCommit": "d62af37e484322f7e839a3d4dd4870041809987c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3Njg3MQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553676871", "bodyText": "Looks like there are multiple discussions around the config key names, and these names for s3fileio are not designed by me but Daniel. Let me put up another thread for this discussion before release.", "author": "jackye1995", "createdAt": "2021-01-08T00:50:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MzQzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzcyOTQ3Nw==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553729477", "bodyText": "let's use #2050 for the discussion", "author": "jackye1995", "createdAt": "2021-01-08T04:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MzQzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3Mzc4OA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553673788", "bodyText": "The other implementation class properties are something-impl. Shouldn't this be lock-impl instead to match those? Then the other properties are in the lock namespace.", "author": "rdblue", "createdAt": "2021-01-08T00:39:30Z", "path": "site/docs/configuration.md", "diffHunk": "@@ -35,6 +35,20 @@ The properties can be manually constructed or passed in from a compute engine li\n Spark uses its session properties as catalog properties, see more details in the [Spark configuration](#spark-configuration) section.\n Flink passes in catalog properties through `CREATE CATALOG` statement, see more details in the [Flink](../flink/#creating-catalogs-and-using-catalogs) section.\n \n+### Lock catalog properties\n+\n+Here are the catalog properties related to locking. They are used by some catalog implementations to control the locking behavior during commits.\n+\n+| Property                          | Default            | Description                                            |\n+| --------------------------------- | ------------------ | ------------------------------------------------------ |\n+| lock.impl                         | null               | a custom implementation of the lock manager, the actual interface depends on the catalog used  |", "originalCommit": "d62af37e484322f7e839a3d4dd4870041809987c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3Mzk2MA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553673960", "bodyText": "Isn't the table required if you're using Dynamo? I would not say it is optional, although it is optional if you're not using Dynamo.", "author": "rdblue", "createdAt": "2021-01-08T00:40:11Z", "path": "site/docs/configuration.md", "diffHunk": "@@ -35,6 +35,20 @@ The properties can be manually constructed or passed in from a compute engine li\n Spark uses its session properties as catalog properties, see more details in the [Spark configuration](#spark-configuration) section.\n Flink passes in catalog properties through `CREATE CATALOG` statement, see more details in the [Flink](../flink/#creating-catalogs-and-using-catalogs) section.\n \n+### Lock catalog properties\n+\n+Here are the catalog properties related to locking. They are used by some catalog implementations to control the locking behavior during commits.\n+\n+| Property                          | Default            | Description                                            |\n+| --------------------------------- | ------------------ | ------------------------------------------------------ |\n+| lock.impl                         | null               | a custom implementation of the lock manager, the actual interface depends on the catalog used  |\n+| lock.table                        | null               | an optional auxiliary table for locking                |", "originalCommit": "d62af37e484322f7e839a3d4dd4870041809987c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3NTMxOQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553675319", "bodyText": "Yes, this is not a part of AWS documentation, that is why I say it as optional, I can remove that. I will emphasize it is required in the AWS doc.", "author": "jackye1995", "createdAt": "2021-01-08T00:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3Mzk2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY4NzI1OQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553687259", "bodyText": "Thanks for pointing that out. You're right that it is optional here. Thanks!", "author": "rdblue", "createdAt": "2021-01-08T01:22:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3Mzk2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY4NzM3MA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553687370", "bodyText": "You may also want to link to the Dynamo docs if you haven't already, since that's the only implementation currently available.", "author": "rdblue", "createdAt": "2021-01-08T01:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3Mzk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3NDYwNg==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r553674606", "bodyText": "The Spark page is getting long enough that I need to break it into separate pages. That's why I reorganized. I like having an Integrations tab, though.\nI wonder if we can get rid of forward/back instead. And maybe move \"About\" into the \"Project\" list.", "author": "rdblue", "createdAt": "2021-01-08T00:42:49Z", "path": "site/mkdocs.yml", "diffHunk": "@@ -54,14 +54,16 @@ nav:\n     - Maintenance: maintenance.md\n     - Performance: performance.md\n     - Reliability: reliability.md\n-  - Spark:\n-    - Getting Started: getting-started.md\n+\n+  - Engines:", "originalCommit": "d62af37e484322f7e839a3d4dd4870041809987c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d2f8ef670448ca14108417de22ac584fbd4bdac5", "url": "https://github.com/apache/iceberg/commit/d2f8ef670448ca14108417de22ac584fbd4bdac5", "message": "AWS: documentation page for AWS module", "committedDate": "2021-01-09T00:01:30Z", "type": "commit"}, {"oid": "d2f8ef670448ca14108417de22ac584fbd4bdac5", "url": "https://github.com/apache/iceberg/commit/d2f8ef670448ca14108417de22ac584fbd4bdac5", "message": "AWS: documentation page for AWS module", "committedDate": "2021-01-09T00:01:30Z", "type": "forcePushed"}, {"oid": "530157ffc0890cc54a90d3ba4d65d81bde1eceb7", "url": "https://github.com/apache/iceberg/commit/530157ffc0890cc54a90d3ba4d65d81bde1eceb7", "message": "add deleted lines back", "committedDate": "2021-01-09T00:03:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NTQzOA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r554255438", "bodyText": "How about using a description here rather than a class name, like \"Object store file layout\" or something?", "author": "rdblue", "createdAt": "2021-01-09T00:07:30Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,244 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Enabling AWS Integration\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same client version as your application.\n+You will need to provide the AWS v2 SDK because that is what Iceberg depends on.\n+You can choose to use the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS, STS) if you would like to have a minimal dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the Spark SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my/key/prefix \\    \n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager \\\n+    --conf spark.sql.catalog.my_catalog.lock.table=myGlueLockTable\n+```\n+\n+As you can see, In the shell command, we use `--packages` to specify the additional AWS bundle dependency with its version as `2.15.40`.\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg namespace is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg table is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+and every Iceberg table version is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`,\n+just like what is shown in the [enabling AWS integration](#enabling-aws-integration) section above. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+There is a unique Glue metastore in each AWS account and each AWS region.\n+By default, `GlueCatalog` chooses the Glue metastore to use based on the user's default AWS client credential and region setup.\n+You can specify the Glue catalog ID through `glue.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client customization](#aws-client-customization).\n+\n+### Skip Archive\n+\n+By default, Glue stores all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `glue.skip-archive` to `true`.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for commit locking\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, [DynamoDB](https://aws.amazon.com/dynamodb) can be used for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+\n+This feature requires the following lock related catalog properties:\n+\n+1. Set `lock-impl` as `org.apache.iceberg.aws.glue.DynamoLockManager`.\n+2. Set `lock.table` as the DynamoDB table name you would like to use. If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [pay-per-request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+\n+Other lock related catalog properties can also be used to adjust locking behaviors such as heartbeat interval.\n+For more details, please refer to [Lock catalog properties](../configuration/#lock-catalog-properties). \n+\n+### Warehouse Location\n+\n+Similar to all other catalog implementations, `warehouse` is a required catalog property to determine the root path of the data warehouse in storage.\n+By default, Glue only allows a warehouse location in S3 because of the use of `S3FileIO`.\n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` or any custom FileIO by setting the `io-impl` catalog property.\n+Details about this feature can be found in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+### Table Location\n+\n+By default, the root location for a table `my_table` of namespace `my_ns` is at `my-warehouse-location/my-ns.db/my-table`.\n+This default root location can be changed at both namespace and table level.\n+\n+To use a different path prefix for all tables under a namespace, use AWS console or any AWS Glue client SDK you like to update the `locationUri` attribute of the corresponding Glue database.\n+For example, you can update the `locationUri` of `my_ns` to `s3://my-ns-bucket`, \n+then any newly created table will have a default root location under the new prefix.\n+For instance, a new table `my_table_2` will have its root location at `s3://my-ns-bucket/my_table_2`.\n+\n+To use a completely different root path for a specific table, set the `location` table property to the desired root path value you want.\n+For example, in Spark SQL you can do:\n+\n+```sql\n+CREATE TABLE my_catalog.my_ns.my_table (\n+    id bigint,\n+    data string,\n+    category string)\n+USING iceberg\n+OPTIONS ('location'='s3://my-special-table-bucket')\n+PARTITIONED BY (category);\n+```\n+\n+## S3 FileIO\n+\n+Iceberg allows users to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this `FileIO`, and other catalogs can load this `FileIO` using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded by parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations that users can tune related to this feature:\n+\n+| Property                          | Default                                            | Description                                            |\n+| --------------------------------- | -------------------------------------------------- | ------------------------------------------------------ |\n+| s3.multipart.num-threads          | the available number of processors in the system   | number of threads to use for uploading parts to S3 (shared across all output streams)  |\n+| s3.multipart.part-size-bytes      | 32MB                                               | the size of a single part for multipart upload requests  |\n+| s3.multipart.threshold            | 1.5                                                | the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload  |\n+| s3.staging-dir                    | `java.io.tmpdir` property value                    | the directory to hold temporary files  |\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+| Property                          | Default                                  | Description                                            |\n+| --------------------------------- | ---------------------------------------- | ------------------------------------------------------ |\n+| s3.sse.type                       | `none`                                   | `none`, `s3`, `kms` or `custom`                        |\n+| s3.sse.key                        | `aws/s3` for `kms` type, null otherwise  | A KMS Key ID or ARN for `kms` type, or a custom base-64 AES256 symmetric key for `custom` type.  |\n+| s3.sse.md5                        | null                                     | If SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity. |\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list (ACL) for detailed access control. \n+User can choose the ACL level by setting the `s3.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider", "originalCommit": "530157ffc0890cc54a90d3ba4d65d81bde1eceb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NjA0NA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r554256044", "bodyText": "Yes that's better, let me also remove other class names in titles", "author": "jackye1995", "createdAt": "2021-01-09T00:10:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NTQzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NTgxNQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r554255815", "bodyText": "You can also use the LOCATION DDL clause", "author": "rdblue", "createdAt": "2021-01-09T00:09:07Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,244 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Enabling AWS Integration\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same client version as your application.\n+You will need to provide the AWS v2 SDK because that is what Iceberg depends on.\n+You can choose to use the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS, STS) if you would like to have a minimal dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the Spark SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my/key/prefix \\    \n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager \\\n+    --conf spark.sql.catalog.my_catalog.lock.table=myGlueLockTable\n+```\n+\n+As you can see, In the shell command, we use `--packages` to specify the additional AWS bundle dependency with its version as `2.15.40`.\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg namespace is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg table is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+and every Iceberg table version is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`,\n+just like what is shown in the [enabling AWS integration](#enabling-aws-integration) section above. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+There is a unique Glue metastore in each AWS account and each AWS region.\n+By default, `GlueCatalog` chooses the Glue metastore to use based on the user's default AWS client credential and region setup.\n+You can specify the Glue catalog ID through `glue.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client customization](#aws-client-customization).\n+\n+### Skip Archive\n+\n+By default, Glue stores all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `glue.skip-archive` to `true`.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for commit locking\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, [DynamoDB](https://aws.amazon.com/dynamodb) can be used for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+\n+This feature requires the following lock related catalog properties:\n+\n+1. Set `lock-impl` as `org.apache.iceberg.aws.glue.DynamoLockManager`.\n+2. Set `lock.table` as the DynamoDB table name you would like to use. If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [pay-per-request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+\n+Other lock related catalog properties can also be used to adjust locking behaviors such as heartbeat interval.\n+For more details, please refer to [Lock catalog properties](../configuration/#lock-catalog-properties). \n+\n+### Warehouse Location\n+\n+Similar to all other catalog implementations, `warehouse` is a required catalog property to determine the root path of the data warehouse in storage.\n+By default, Glue only allows a warehouse location in S3 because of the use of `S3FileIO`.\n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` or any custom FileIO by setting the `io-impl` catalog property.\n+Details about this feature can be found in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+### Table Location\n+\n+By default, the root location for a table `my_table` of namespace `my_ns` is at `my-warehouse-location/my-ns.db/my-table`.\n+This default root location can be changed at both namespace and table level.\n+\n+To use a different path prefix for all tables under a namespace, use AWS console or any AWS Glue client SDK you like to update the `locationUri` attribute of the corresponding Glue database.\n+For example, you can update the `locationUri` of `my_ns` to `s3://my-ns-bucket`, \n+then any newly created table will have a default root location under the new prefix.\n+For instance, a new table `my_table_2` will have its root location at `s3://my-ns-bucket/my_table_2`.\n+\n+To use a completely different root path for a specific table, set the `location` table property to the desired root path value you want.\n+For example, in Spark SQL you can do:\n+\n+```sql\n+CREATE TABLE my_catalog.my_ns.my_table (\n+    id bigint,\n+    data string,\n+    category string)\n+USING iceberg\n+OPTIONS ('location'='s3://my-special-table-bucket')", "originalCommit": "530157ffc0890cc54a90d3ba4d65d81bde1eceb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1Nzc3NA==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r554257774", "bodyText": "oh yeah I completely forgot that", "author": "jackye1995", "createdAt": "2021-01-09T00:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NTgxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NjUzNQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r554256535", "bodyText": "Is there a better heading for this as well?", "author": "rdblue", "createdAt": "2021-01-09T00:12:43Z", "path": "site/docs/aws.md", "diffHunk": "@@ -0,0 +1,244 @@\n+<!--\n+ - Licensed to the Apache Software Foundation (ASF) under one or more\n+ - contributor license agreements.  See the NOTICE file distributed with\n+ - this work for additional information regarding copyright ownership.\n+ - The ASF licenses this file to You under the Apache License, Version 2.0\n+ - (the \"License\"); you may not use this file except in compliance with\n+ - the License.  You may obtain a copy of the License at\n+ -\n+ -   http://www.apache.org/licenses/LICENSE-2.0\n+ -\n+ - Unless required by applicable law or agreed to in writing, software\n+ - distributed under the License is distributed on an \"AS IS\" BASIS,\n+ - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ - See the License for the specific language governing permissions and\n+ - limitations under the License.\n+ -->\n+ \n+# Iceberg AWS Integrations\n+\n+Iceberg provides integration with different AWS services through the `iceberg-aws` module. \n+This section describes how to use Iceberg with AWS.\n+\n+## Enabling AWS Integration\n+\n+The `iceberg-aws` module is bundled with Spark and Flink engine runtimes.\n+However, the AWS clients are not bundled so that you can use the same client version as your application.\n+You will need to provide the AWS v2 SDK because that is what Iceberg depends on.\n+You can choose to use the [AWS SDK bundle](https://mvnrepository.com/artifact/software.amazon.awssdk/bundle), \n+or individual AWS client packages (Glue, S3, DynamoDB, KMS, STS) if you would like to have a minimal dependency footprint.\n+\n+For example, to use AWS features with Spark 3 and AWS clients version 2.15.40, you can start the Spark SQL shell with:\n+\n+```sh\n+spark-sql --packages org.apache.iceberg:iceberg-spark3-runtime:0.11.0,software.amazon.awssdk:bundle:2.15.40 \\\n+    --conf spark.sql.catalog.my_catalog=org.apache.iceberg.spark.SparkCatalog \\\n+    --conf spark.sql.catalog.my_catalog.warehouse=s3://my-bucket/my/key/prefix \\    \n+    --conf spark.sql.catalog.my_catalog.catalog-impl=org.apache.iceberg.aws.glue.GlueCatalog \\\n+    --conf spark.sql.catalog.my_catalog.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager \\\n+    --conf spark.sql.catalog.my_catalog.lock.table=myGlueLockTable\n+```\n+\n+As you can see, In the shell command, we use `--packages` to specify the additional AWS bundle dependency with its version as `2.15.40`.\n+\n+## Glue Catalog\n+\n+Iceberg enables the use of [AWS Glue](https://aws.amazon.com/glue) as the `Catalog` implementation.\n+When used, an Iceberg namespace is stored as a [Glue Database](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-databases.html), \n+an Iceberg table is stored as a [Glue Table](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html),\n+and every Iceberg table version is stored as a [Glue TableVersion](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-catalog-tables.html#aws-glue-api-catalog-tables-TableVersion). \n+You can start using Glue catalog by specifying the `catalog-impl` as `org.apache.iceberg.aws.glue.GlueCatalog`,\n+just like what is shown in the [enabling AWS integration](#enabling-aws-integration) section above. \n+More details about loading the catalog can be found in individual engine pages, such as [Spark](../spark/#loading-a-custom-catalog) and [Flink](../flink/#creating-catalogs-and-using-catalogs).\n+\n+### Glue Catalog ID\n+There is a unique Glue metastore in each AWS account and each AWS region.\n+By default, `GlueCatalog` chooses the Glue metastore to use based on the user's default AWS client credential and region setup.\n+You can specify the Glue catalog ID through `glue.id` catalog property to point to a Glue catalog in a different AWS account.\n+The Glue catalog ID is your numeric AWS account ID.\n+If the Glue catalog is in a different region, you should configure you AWS client to point to the correct region, \n+see more details in [AWS client customization](#aws-client-customization).\n+\n+### Skip Archive\n+\n+By default, Glue stores all the table versions created and user can rollback a table to any historical version if needed.\n+However, if you are streaming data to Iceberg, this will easily create a lot of Glue table versions.\n+Therefore, it is recommended to turn off the archive feature in Glue by setting `glue.skip-archive` to `true`.\n+For more details, please read [Glue Quotas](https://docs.aws.amazon.com/general/latest/gr/glue.html) and the [UpdateTable API](https://docs.aws.amazon.com/glue/latest/webapi/API_UpdateTable.html).\n+\n+### DynamoDB for commit locking\n+\n+Glue does not have a strong guarantee over concurrent updates to a table. \n+Although it throws `ConcurrentModificationException` when detecting two processes updating a table at the same time,\n+there is no guarantee that one update would not clobber the other update.\n+Therefore, [DynamoDB](https://aws.amazon.com/dynamodb) can be used for Glue, so that for every commit, \n+`GlueCatalog` first obtains a lock using a helper DynamoDB table and then try to safely modify the Glue table.\n+\n+This feature requires the following lock related catalog properties:\n+\n+1. Set `lock-impl` as `org.apache.iceberg.aws.glue.DynamoLockManager`.\n+2. Set `lock.table` as the DynamoDB table name you would like to use. If the lock table with the given name does not exist in DynamoDB, a new table is created with billing mode set as [pay-per-request](https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing).\n+\n+Other lock related catalog properties can also be used to adjust locking behaviors such as heartbeat interval.\n+For more details, please refer to [Lock catalog properties](../configuration/#lock-catalog-properties). \n+\n+### Warehouse Location\n+\n+Similar to all other catalog implementations, `warehouse` is a required catalog property to determine the root path of the data warehouse in storage.\n+By default, Glue only allows a warehouse location in S3 because of the use of `S3FileIO`.\n+To store data in a different local or cloud store, Glue catalog can switch to use `HadoopFileIO` or any custom FileIO by setting the `io-impl` catalog property.\n+Details about this feature can be found in the [custom FileIO](../custom-catalog/#custom-file-io-implementation) section.\n+\n+### Table Location\n+\n+By default, the root location for a table `my_table` of namespace `my_ns` is at `my-warehouse-location/my-ns.db/my-table`.\n+This default root location can be changed at both namespace and table level.\n+\n+To use a different path prefix for all tables under a namespace, use AWS console or any AWS Glue client SDK you like to update the `locationUri` attribute of the corresponding Glue database.\n+For example, you can update the `locationUri` of `my_ns` to `s3://my-ns-bucket`, \n+then any newly created table will have a default root location under the new prefix.\n+For instance, a new table `my_table_2` will have its root location at `s3://my-ns-bucket/my_table_2`.\n+\n+To use a completely different root path for a specific table, set the `location` table property to the desired root path value you want.\n+For example, in Spark SQL you can do:\n+\n+```sql\n+CREATE TABLE my_catalog.my_ns.my_table (\n+    id bigint,\n+    data string,\n+    category string)\n+USING iceberg\n+OPTIONS ('location'='s3://my-special-table-bucket')\n+PARTITIONED BY (category);\n+```\n+\n+## S3 FileIO\n+\n+Iceberg allows users to write data to S3 through `S3FileIO`.\n+`GlueCatalog` by default uses this `FileIO`, and other catalogs can load this `FileIO` using the `io-impl` catalog property.\n+\n+### Progressive Multipart Upload\n+\n+`S3FileIO` implements a customized progressive multipart upload algorithm to upload data.\n+Data files are uploaded by parts in parallel as soon as each part is ready,\n+and each file part is deleted as soon as its upload process completes.\n+This provides maximized upload speed and minimized local disk usage during uploads.\n+Here are the configurations that users can tune related to this feature:\n+\n+| Property                          | Default                                            | Description                                            |\n+| --------------------------------- | -------------------------------------------------- | ------------------------------------------------------ |\n+| s3.multipart.num-threads          | the available number of processors in the system   | number of threads to use for uploading parts to S3 (shared across all output streams)  |\n+| s3.multipart.part-size-bytes      | 32MB                                               | the size of a single part for multipart upload requests  |\n+| s3.multipart.threshold            | 1.5                                                | the threshold expressed as a factor times the multipart size at which to switch from uploading using a single put object request to uploading using multipart upload  |\n+| s3.staging-dir                    | `java.io.tmpdir` property value                    | the directory to hold temporary files  |\n+\n+### S3 Server Side Encryption\n+\n+`S3FileIO` supports all 3 S3 server side encryption modes:\n+\n+* [SSE-S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html): When you use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3), each object is encrypted with a unique key. As an additional safeguard, it encrypts the key itself with a master key that it regularly rotates. Amazon S3 server-side encryption uses one of the strongest block ciphers available, 256-bit Advanced Encryption Standard (AES-256), to encrypt your data.\n+* [SSE-KMS](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html): Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS) is similar to SSE-S3, but with some additional benefits and charges for using this service. There are separate permissions for the use of a CMK that provides added protection against unauthorized access of your objects in Amazon S3. SSE-KMS also provides you with an audit trail that shows when your CMK was used and by whom. Additionally, you can create and manage customer managed CMKs or use AWS managed CMKs that are unique to you, your service, and your Region.\n+* [SSE-C](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html): With Server-Side Encryption with Customer-Provided Keys (SSE-C), you manage the encryption keys and Amazon S3 manages the encryption, as it writes to disks, and decryption, when you access your objects.\n+\n+To enable server side encryption, use the following configuration properties:\n+\n+| Property                          | Default                                  | Description                                            |\n+| --------------------------------- | ---------------------------------------- | ------------------------------------------------------ |\n+| s3.sse.type                       | `none`                                   | `none`, `s3`, `kms` or `custom`                        |\n+| s3.sse.key                        | `aws/s3` for `kms` type, null otherwise  | A KMS Key ID or ARN for `kms` type, or a custom base-64 AES256 symmetric key for `custom` type.  |\n+| s3.sse.md5                        | null                                     | If SSE type is `custom`, this value must be set as the base-64 MD5 digest of the symmetric key to ensure integrity. |\n+\n+### S3 Access Control List\n+\n+`S3FileIO` supports S3 access control list (ACL) for detailed access control. \n+User can choose the ACL level by setting the `s3.acl` property.\n+For more details, please read [S3 ACL Documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html).\n+\n+### ObjectStoreLocationProvider\n+\n+S3 and many other cloud storage services [throttle requests based on object prefix](https://aws.amazon.com/premiumsupport/knowledge-center/s3-request-limit-avoid-throttling/). \n+This means data stored in a traditional Hive storage layout has bad read and write throughput since data files of the same partition are placed under the same prefix.\n+Iceberg by default uses the Hive storage layout, but can be switched to use a different `ObjectStoreLocationProvider`.\n+In this mode, a hash string is added to the beginning of each file path, so that files are equally distributed across all prefixes in an S3 bucket.\n+This results in minimized throttling and maximized throughput for S3-related IO operations.\n+Here is an example Spark SQL command to create a table with this feature enabled:\n+\n+```sql\n+CREATE TABLE my_catalog.my_ns.my_table (\n+    id bigint,\n+    data string,\n+    category string)\n+USING iceberg\n+OPTIONS (\n+    'write.object-storage.enabled'=true, \n+    'write.object-storage.path'='s3://my-table-data-bucket')\n+PARTITIONED BY (category);\n+```\n+\n+For more details, please refer to the [LocationProvider Configuration](../custom-catalog/#custom-location-provider-implementation) section.  \n+\n+### S3 Strong Consistency\n+\n+In November 2020, S3 announced [strong consistency](https://aws.amazon.com/s3/consistency/) for all read operations, and Iceberg is updated to fully leverage this feature.\n+There is no redundant consistency wait and check which might negatively impact performance during IO operations.\n+\n+### Hadoop S3A FileSystem\n+\n+Before `S3FileIO` was introduced, many Iceberg users choose to use `HadoopFileIO` to write data to S3 through the [S3A FileSystem](https://github.com/apache/hadoop/blob/trunk/hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java).\n+As introduced in the previous sections, `S3FileIO` adopts latest AWS clients and S3 features for optimized security and performance,\n+ and is thus recommend for S3 use cases rather than the S3A FileSystem.\n+\n+`S3FileIO` writes data with `s3://` URI scheme, but it is also compatible with schemes written by the S3A FileSystem.\n+This means for any table manifests containing `s3a://` or `s3n://` file paths, `S3FileIO` is still able to read them.\n+This feature allows people to easily switch from S3A to `S3FileIO`.\n+\n+If for any reason you have to use S3A, here are the instructions:\n+\n+1. To store data using S3A, specify the `warehouse` catalog property to be an S3A path, e.g. `s3a://my-bucket/my-warehouse` \n+2. For `HiveCatalog`, to also store metadata using S3A, specify the Hadoop config property `hive.metastore.warehouse.dir` to be an S3A path.\n+3. Add [hadoop-aws](https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-aws) as a runtime dependency of your compute engine.\n+4. Configure AWS settings based on [hadoop-aws documentation](https://hadoop.apache.org/docs/current/hadoop-aws/tools/hadoop-aws/index.html) (make sure you check the version, S3A configuration varies a lot based on the version you use).   \n+\n+## AWS client customization\n+\n+Many organizations have customized their way of configuring AWS clients with their own credential provider, access proxy, retry strategy, etc.\n+Iceberg allows users to plug in their own implementation of `org.apache.iceberg.aws.AwsClientFactory` by setting the `client.factory` catalog property.\n+\n+### AssumeRoleAwsClientFactory", "originalCommit": "530157ffc0890cc54a90d3ba4d65d81bde1eceb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1ODM5NQ==", "url": "https://github.com/apache/iceberg/pull/1891#discussion_r554258395", "bodyText": "Yes I just updated", "author": "jackye1995", "createdAt": "2021-01-09T00:21:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI1NjUzNQ=="}], "type": "inlineReview"}, {"oid": "ae4654db987a2fa034dcbea33d8dd84147951aee", "url": "https://github.com/apache/iceberg/commit/ae4654db987a2fa034dcbea33d8dd84147951aee", "message": "add location sql, update title names", "committedDate": "2021-01-09T00:19:31Z", "type": "commit"}]}