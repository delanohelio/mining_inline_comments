{"pr_number": 1916, "pr_title": "[#1858] Use ttd as command consumer lifespan", "pr_createdAt": "2020-04-22T04:15:53Z", "pr_url": "https://github.com/eclipse/hono/pull/1916", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk2NjQyNQ==", "url": "https://github.com/eclipse/hono/pull/1916#discussion_r412966425", "bodyText": "I would prefer the use of Duration rather then int, which prevents any confusion around the unit.", "author": "ctron", "createdAt": "2020-04-22T13:08:41Z", "path": "client/src/main/java/org/eclipse/hono/client/ProtocolAdapterCommandConsumerFactory.java", "diffHunk": "@@ -83,6 +85,7 @@ void initialize(CommandTargetMapper commandTargetMapper,\n             String tenantId,\n             String deviceId,\n             Handler<CommandContext> commandHandler,\n+            int lifespanSeconds,", "originalCommit": "27fca7377d904b20bade1ec6c3422965a9a7ac60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY3MzA5NA==", "url": "https://github.com/eclipse/hono/pull/1916#discussion_r413673094", "bodyText": "I've amended the commit, changing the type to Duration (also in the DeviceConnectionInfo, DeviceConnectionClient and DeviceConnectionService interfaces committed earlier).\nI've opted against the usage of Optional (it produces quite some clutter here, IMHO). The way to indicate an infinite lifespan is now using either null or a negative Duration.", "author": "calohmn", "createdAt": "2020-04-23T09:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk2NjQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk2NjUwNQ==", "url": "https://github.com/eclipse/hono/pull/1916#discussion_r412966505", "bodyText": "Same here.", "author": "ctron", "createdAt": "2020-04-22T13:08:48Z", "path": "client/src/main/java/org/eclipse/hono/client/ProtocolAdapterCommandConsumerFactory.java", "diffHunk": "@@ -121,6 +126,7 @@ void initialize(CommandTargetMapper commandTargetMapper,\n             String deviceId,\n             String gatewayId,\n             Handler<CommandContext> commandHandler,\n+            int lifespanSeconds,", "originalCommit": "27fca7377d904b20bade1ec6c3422965a9a7ac60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk2NzU2NA==", "url": "https://github.com/eclipse/hono/pull/1916#discussion_r412967564", "bodyText": "If the parameter is optional, then maybe consider using Optional. Or maybe null when using Duration (see other comments on \"int\").", "author": "ctron", "createdAt": "2020-04-22T13:10:13Z", "path": "adapters/amqp-vertx/src/main/java/org/eclipse/hono/adapter/amqp/impl/VertxBasedAmqpProtocolAdapter.java", "diffHunk": "@@ -864,10 +864,10 @@ private Span newSpan(final String operationName, final Device authenticatedDevic\n         if (authenticatedDevice != null && !authenticatedDevice.getDeviceId().equals(sourceAddress.getResourceId())) {\n             // gateway scenario\n             return getCommandConsumerFactory().createCommandConsumer(sourceAddress.getTenantId(),\n-                    sourceAddress.getResourceId(), authenticatedDevice.getDeviceId(), commandHandler, span.context());\n+                    sourceAddress.getResourceId(), authenticatedDevice.getDeviceId(), commandHandler, -1, span.context());", "originalCommit": "27fca7377d904b20bade1ec6c3422965a9a7ac60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY3MzI4Mg==", "url": "https://github.com/eclipse/hono/pull/1916#discussion_r413673282", "bodyText": "See the other comment.", "author": "calohmn", "createdAt": "2020-04-23T09:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk2NzU2NA=="}], "type": "inlineReview"}, {"oid": "036decd592b80dc161d294c926b5722f2eaf08f4", "url": "https://github.com/eclipse/hono/commit/036decd592b80dc161d294c926b5722f2eaf08f4", "message": "[#1858] Use ttd value as command consumer lifespan.\n\nAlso change the type of the lifespan parameter\nfrom int to Duration in the methods of the\nDeviceConnectionInfo, DeviceConnectionClient and\nDeviceConnectionService interfaces.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-04-23T09:37:34Z", "type": "forcePushed"}, {"oid": "cb317829bcc34bf3ad9ea63d511d79af6e346150", "url": "https://github.com/eclipse/hono/commit/cb317829bcc34bf3ad9ea63d511d79af6e346150", "message": "[#1858] Use ttd value as command consumer lifespan.\n\nAlso change the type of the lifespan parameter\nfrom int to Duration in the methods of the\nDeviceConnectionInfo, DeviceConnectionClient and\nDeviceConnectionService interfaces.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-04-23T10:42:53Z", "type": "commit"}, {"oid": "cb317829bcc34bf3ad9ea63d511d79af6e346150", "url": "https://github.com/eclipse/hono/commit/cb317829bcc34bf3ad9ea63d511d79af6e346150", "message": "[#1858] Use ttd value as command consumer lifespan.\n\nAlso change the type of the lifespan parameter\nfrom int to Duration in the methods of the\nDeviceConnectionInfo, DeviceConnectionClient and\nDeviceConnectionService interfaces.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-04-23T10:42:53Z", "type": "forcePushed"}]}