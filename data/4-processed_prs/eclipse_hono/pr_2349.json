{"pr_number": 2349, "pr_title": "Apply default content type in setPayload()", "pr_createdAt": "2020-12-07T14:51:38Z", "pr_url": "https://github.com/eclipse/hono/pull/2349", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE0NjAyOQ==", "url": "https://github.com/eclipse/hono/pull/2349#discussion_r538146029", "bodyText": "this sounds like the content-type is set despite the fact that the body is null. However, my understanding is that this should happen only if the body is null, right? So, FMPOV this should read\n\n... is set to the \"application/vnd.eclipse-hono-empty-notification\" content-type if the payload is null", "author": "sophokles73", "createdAt": "2020-12-08T08:47:18Z", "path": "core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java", "diffHunk": "@@ -325,6 +341,64 @@ public void testNewMessageUsesGivenTtlValue() {\n         assertThat(message.getTtl()).isEqualTo(timeToLive.toMillis());\n     }\n \n+    /**\n+     * Verifies that the content-type of a newly created event message\n+     * is set to the \"application/vnd.eclipse-hono-empty-notification\" content-type\n+     * even if the payload is {@code null}.", "originalCommit": "63cd8c7339082de9eb8bfd4f0a9ffd6fdd98fa99", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM3ODMzMA==", "url": "https://github.com/eclipse/hono/pull/2349#discussion_r538378330", "bodyText": "this should happen only if the body is null, right?\n\nFrom an overall perspective yes, but this condition is currently not enforced in the MessageHelper methods (there is also no automatic setting of \"application/vnd.eclipse-hono-empty-notification\" if the payload is null).\n(Throwing an IllegalArgumentException for \"eclipse-hono-empty-notification\" with payload != null (or not empty) would be the method doing too much, I think.)\nSo it's more like this content-type gets applied even though the payload is null, because normally the content-type parameter isn't applied if the payload is null. There's only the special case of the \"application/vnd.eclipse-hono-empty-notification\" content type for which this is done.\nAnyway, I've changed the text now to:\n\nVerifies that the \"application/vnd.eclipse-hono-empty-notification\" content-type\ncan be set on a newly created event message with a null payload.", "author": "calohmn", "createdAt": "2020-12-08T13:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE0NjAyOQ=="}], "type": "inlineReview"}, {"oid": "b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "url": "https://github.com/eclipse/hono/commit/b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "message": "Apply default content type in setPayload().\n\nThe \"application/octet-stream\" content type now gets\napplied as default in the setPayload() methods, provided\nthe payload isn't null. The \"payload not null\" condition\nis now also used in the other places where the content\ntype gets set.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-12-08T13:21:12Z", "type": "commit"}, {"oid": "b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "url": "https://github.com/eclipse/hono/commit/b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "message": "Apply default content type in setPayload().\n\nThe \"application/octet-stream\" content type now gets\napplied as default in the setPayload() methods, provided\nthe payload isn't null. The \"payload not null\" condition\nis now also used in the other places where the content\ntype gets set.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-12-08T13:21:12Z", "type": "forcePushed"}]}