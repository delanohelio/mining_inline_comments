{"pr_number": 1818, "pr_title": "[#1272] Add docs for new Device Connection API methods", "pr_createdAt": "2020-03-06T16:40:03Z", "pr_url": "https://github.com/eclipse/hono/pull/1818", "timeline": [{"oid": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "url": "https://github.com/eclipse/hono/commit/5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "message": "[#1272] Add docs for new Device Connection API methods.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-08T21:01:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MTA5NA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389591094", "bodyText": "I do not quite understand what\n\nhas not been updated due to there being no such mapping entry\n\nmeans. The next paragraph describes that a 412 could be returned if the device_id is currently not mapped to the adapter_instance_id from the request. Is this the same case?", "author": "sophokles73", "createdAt": "2020-03-09T11:01:52Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEyMjA1Mg==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390122052", "bodyText": "Yes, I have rephrased the sentence above.", "author": "calohmn", "createdAt": "2020-03-10T06:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MTA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MjQxNg==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389592416", "bodyText": "IMHO we should omit\n\n, possibly using one of the given gateways.\n\nhere because it is unclear where the given gateways come from and it is not important to mention them here in order for the reader to understand the purpose of this operation.", "author": "sophokles73", "createdAt": "2020-03-09T11:05:00Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MjcyOQ==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389592729", "bodyText": "As part of the request message ...?\nIMHO a hint would be useful as to where the client might get the list of gateways that may act on behalf of the given device ...", "author": "sophokles73", "createdAt": "2020-03-09T11:05:50Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.\n+\n+As part of this request, the client is supposed to provide the list of gateways that may act on behalf of the given device. This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MzAwNQ==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389593005", "bodyText": "maybe use numbering if order is important?", "author": "sophokles73", "createdAt": "2020-03-09T11:06:22Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.\n+\n+As part of this request, the client is supposed to provide the list of gateways that may act on behalf of the given device. This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+- If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5NTc0OA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389595748", "bodyText": "FMPOV we should put a JSON array containing the ids into the body of the request message ...\nOtherwise, the location needs to be application-properties ...", "author": "sophokles73", "createdAt": "2020-03-09T11:12:38Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.\n+\n+As part of this request, the client is supposed to provide the list of gateways that may act on behalf of the given device. This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+- If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.\n+- Otherwise, if there is an adapter instance registered for the last known gateway associated with the given device, this adapter instance is returned as the *single* returned list entry. The last known gateway has to be contained in the given list of gateways for this case.\n+- Otherwise, *all* adapter instances associated with any of the given gateway identifiers are returned.\n+\n+That means that for a device communicating via a gateway, the result is reduced to a *single element* list if an adapter instance for the device itself or its last known gateway is found. The adapter instance registered for the device itself is given precedence in order to ensure that a gateway having subscribed to commands for that *particular device* is chosen over a gateway that has subscribed to commands for *all* devices of a tenant.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"get_cmd_handling_adapter_instances.svg\" title=\"Client retrieving the list of command-handling adapter instances for a device\" alt=\"A client sends a request message for retrieving the list of command-handling adapter instances for a device and receives a response containing the information\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to retrieve the command-handling adapter instances for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name           | Mandatory | Location                 | AMQP Type | Description |\n+| :------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*      | yes       | *properties*             | *string*  | MUST be set to `get-cmd-handling-adapter-instances`. |\n+| *gateway_ids*  | yes       | *properties*             | *string*  | A JSON array containing the IDs of the gateways that may act on behalf of the given device. |", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDExMzg5MA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390113890", "bodyText": "Otherwise, the location needs to be application-properties ...\n\nRight, that was a copy/paste error here.\nRegarding using the request message instead: I had this in my initial commit here, but I think putting the operation parameters in the (application-) properties of the request message is more commonly used in our APIs.", "author": "calohmn", "createdAt": "2020-03-10T06:20:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5NTc0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5Njg0NQ==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389596845", "bodyText": "Based on the examples given below, this doesn't seem to necessarily be the device_id that has been passed in with the request message. A hint would be nice that this is indeed the case and why the client would actually care about this ID.", "author": "sophokles73", "createdAt": "2020-03-09T11:15:08Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.\n+\n+As part of this request, the client is supposed to provide the list of gateways that may act on behalf of the given device. This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+- If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.\n+- Otherwise, if there is an adapter instance registered for the last known gateway associated with the given device, this adapter instance is returned as the *single* returned list entry. The last known gateway has to be contained in the given list of gateways for this case.\n+- Otherwise, *all* adapter instances associated with any of the given gateway identifiers are returned.\n+\n+That means that for a device communicating via a gateway, the result is reduced to a *single element* list if an adapter instance for the device itself or its last known gateway is found. The adapter instance registered for the device itself is given precedence in order to ensure that a gateway having subscribed to commands for that *particular device* is chosen over a gateway that has subscribed to commands for *all* devices of a tenant.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"get_cmd_handling_adapter_instances.svg\" title=\"Client retrieving the list of command-handling adapter instances for a device\" alt=\"A client sends a request message for retrieving the list of command-handling adapter instances for a device and receives a response containing the information\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to retrieve the command-handling adapter instances for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name           | Mandatory | Location                 | AMQP Type | Description |\n+| :------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*      | yes       | *properties*             | *string*  | MUST be set to `get-cmd-handling-adapter-instances`. |\n+| *gateway_ids*  | yes       | *properties*             | *string*  | A JSON array containing the IDs of the gateways that may act on behalf of the given device. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *get command-handling adapter instances for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}) as well as the properties shown in the following table:\n+\n+| Name             | Mandatory | Location                 | AMQP Type    | Description |\n+| :--------------- | :-------: | :----------------------- | :----------- | :---------- |\n+| *content-type*   | no        | *properties*             | *string*     | MUST be set to `application/json` if the invocation of the operation was successful and the body of the response message contains payload as described below. |\n+\n+The result of a successful invocation is carried in a single Data section of the response message as a UTF-8 encoded string representation of a single JSON object. It is an error to include payload that is not of this type.\n+\n+The response message JSON object has the following properties:\n+\n+| Name                | Mandatory | JSON Type     | Description |\n+| :------------------ | :-------: | :------------ | :---------- |\n+| *adapter-instances* | *yes*     | *array*       | A non-empty array of JSON objects that represent the command-handling adapter instances along with the device or gateway id. |\n+\n+Each entry in the *adapter-instances* array has the following properties:\n+\n+| Name                  | Mandatory | JSON Type     | Description |\n+| :-------------------- | :-------: | :------------ | :---------- |\n+| *adapter-instance-id* | *yes*     | *string*      | The ID of the protocol adapter instance handling command & control messages for the device given in the *device-id* property. |\n+| *device-id*           | *yes*     | *string*      | The ID of the gateway or device that the protocol adapter instance given by the *adapter-instance-id* is handling command & control messages for. |", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5ODI2Mg==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389598262", "bodyText": "it contains the adapter instances ...", "author": "sophokles73", "createdAt": "2020-03-09T11:18:28Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.\n+\n+As part of this request, the client is supposed to provide the list of gateways that may act on behalf of the given device. This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+- If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.\n+- Otherwise, if there is an adapter instance registered for the last known gateway associated with the given device, this adapter instance is returned as the *single* returned list entry. The last known gateway has to be contained in the given list of gateways for this case.\n+- Otherwise, *all* adapter instances associated with any of the given gateway identifiers are returned.\n+\n+That means that for a device communicating via a gateway, the result is reduced to a *single element* list if an adapter instance for the device itself or its last known gateway is found. The adapter instance registered for the device itself is given precedence in order to ensure that a gateway having subscribed to commands for that *particular device* is chosen over a gateway that has subscribed to commands for *all* devices of a tenant.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"get_cmd_handling_adapter_instances.svg\" title=\"Client retrieving the list of command-handling adapter instances for a device\" alt=\"A client sends a request message for retrieving the list of command-handling adapter instances for a device and receives a response containing the information\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to retrieve the command-handling adapter instances for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name           | Mandatory | Location                 | AMQP Type | Description |\n+| :------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*      | yes       | *properties*             | *string*  | MUST be set to `get-cmd-handling-adapter-instances`. |\n+| *gateway_ids*  | yes       | *properties*             | *string*  | A JSON array containing the IDs of the gateways that may act on behalf of the given device. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *get command-handling adapter instances for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}) as well as the properties shown in the following table:\n+\n+| Name             | Mandatory | Location                 | AMQP Type    | Description |\n+| :--------------- | :-------: | :----------------------- | :----------- | :---------- |\n+| *content-type*   | no        | *properties*             | *string*     | MUST be set to `application/json` if the invocation of the operation was successful and the body of the response message contains payload as described below. |\n+\n+The result of a successful invocation is carried in a single Data section of the response message as a UTF-8 encoded string representation of a single JSON object. It is an error to include payload that is not of this type.\n+\n+The response message JSON object has the following properties:\n+\n+| Name                | Mandatory | JSON Type     | Description |\n+| :------------------ | :-------: | :------------ | :---------- |\n+| *adapter-instances* | *yes*     | *array*       | A non-empty array of JSON objects that represent the command-handling adapter instances along with the device or gateway id. |\n+\n+Each entry in the *adapter-instances* array has the following properties:\n+\n+| Name                  | Mandatory | JSON Type     | Description |\n+| :-------------------- | :-------: | :------------ | :---------- |\n+| *adapter-instance-id* | *yes*     | *string*      | The ID of the protocol adapter instance handling command & control messages for the device given in the *device-id* property. |\n+| *device-id*           | *yes*     | *string*      | The ID of the gateway or device that the protocol adapter instance given by the *adapter-instance-id* is handling command & control messages for. |\n+\n+\n+An example of a response message with a single adapter instance result, returned for example if an adapter instance is registered for the given device:\n+\n+~~~json\n+{\n+  \"adapter-instances\": [\n+    {\n+      \"adapter-instance-id\": \"adapter-1\",\n+      \"device-id\": \"4711\"\n+    }\n+  ]\n+}\n+~~~\n+\n+An example of a response message with multiple contained adapter instances, returned for example if no adapter instance is registered for the given device or its last used gateway, and therefore a list of all adapter instances for the gateways of the device is returned:\n+\n+~~~json\n+{\n+  \"adapter-instances\": [\n+    {\n+      \"adapter-instance-id\": \"adapter-1\",\n+      \"device-id\": \"gw-1\"\n+    },\n+    {\n+      \"adapter-instance-id\": \"adapter-1\",\n+      \"device-id\": \"gw-2\"\n+    }\n+  ]\n+}\n+~~~\n+\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code | Description |\n+| :--- | :---------- |\n+| *200* | OK, the payload contains the gateway ID. |", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5ODYxMA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r389598610", "bodyText": "the table above seems to indicate that this check is actually mandatory for an implementation to perform ...", "author": "sophokles73", "createdAt": "2020-03-09T11:19:12Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,176 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to there being no such mapping entry or due to missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device, possibly using one of the given gateways.\n+\n+As part of this request, the client is supposed to provide the list of gateways that may act on behalf of the given device. This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+- If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.\n+- Otherwise, if there is an adapter instance registered for the last known gateway associated with the given device, this adapter instance is returned as the *single* returned list entry. The last known gateway has to be contained in the given list of gateways for this case.\n+- Otherwise, *all* adapter instances associated with any of the given gateway identifiers are returned.\n+\n+That means that for a device communicating via a gateway, the result is reduced to a *single element* list if an adapter instance for the device itself or its last known gateway is found. The adapter instance registered for the device itself is given precedence in order to ensure that a gateway having subscribed to commands for that *particular device* is chosen over a gateway that has subscribed to commands for *all* devices of a tenant.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"get_cmd_handling_adapter_instances.svg\" title=\"Client retrieving the list of command-handling adapter instances for a device\" alt=\"A client sends a request message for retrieving the list of command-handling adapter instances for a device and receives a response containing the information\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to retrieve the command-handling adapter instances for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name           | Mandatory | Location                 | AMQP Type | Description |\n+| :------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*      | yes       | *properties*             | *string*  | MUST be set to `get-cmd-handling-adapter-instances`. |\n+| *gateway_ids*  | yes       | *properties*             | *string*  | A JSON array containing the IDs of the gateways that may act on behalf of the given device. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *get command-handling adapter instances for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}) as well as the properties shown in the following table:\n+\n+| Name             | Mandatory | Location                 | AMQP Type    | Description |\n+| :--------------- | :-------: | :----------------------- | :----------- | :---------- |\n+| *content-type*   | no        | *properties*             | *string*     | MUST be set to `application/json` if the invocation of the operation was successful and the body of the response message contains payload as described below. |\n+\n+The result of a successful invocation is carried in a single Data section of the response message as a UTF-8 encoded string representation of a single JSON object. It is an error to include payload that is not of this type.\n+\n+The response message JSON object has the following properties:\n+\n+| Name                | Mandatory | JSON Type     | Description |\n+| :------------------ | :-------: | :------------ | :---------- |\n+| *adapter-instances* | *yes*     | *array*       | A non-empty array of JSON objects that represent the command-handling adapter instances along with the device or gateway id. |\n+\n+Each entry in the *adapter-instances* array has the following properties:\n+\n+| Name                  | Mandatory | JSON Type     | Description |\n+| :-------------------- | :-------: | :------------ | :---------- |\n+| *adapter-instance-id* | *yes*     | *string*      | The ID of the protocol adapter instance handling command & control messages for the device given in the *device-id* property. |\n+| *device-id*           | *yes*     | *string*      | The ID of the gateway or device that the protocol adapter instance given by the *adapter-instance-id* is handling command & control messages for. |\n+\n+\n+An example of a response message with a single adapter instance result, returned for example if an adapter instance is registered for the given device:\n+\n+~~~json\n+{\n+  \"adapter-instances\": [\n+    {\n+      \"adapter-instance-id\": \"adapter-1\",\n+      \"device-id\": \"4711\"\n+    }\n+  ]\n+}\n+~~~\n+\n+An example of a response message with multiple contained adapter instances, returned for example if no adapter instance is registered for the given device or its last used gateway, and therefore a list of all adapter instances for the gateways of the device is returned:\n+\n+~~~json\n+{\n+  \"adapter-instances\": [\n+    {\n+      \"adapter-instance-id\": \"adapter-1\",\n+      \"device-id\": \"gw-1\"\n+    },\n+    {\n+      \"adapter-instance-id\": \"adapter-1\",\n+      \"device-id\": \"gw-2\"\n+    }\n+  ]\n+}\n+~~~\n+\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code | Description |\n+| :--- | :---------- |\n+| *200* | OK, the payload contains the gateway ID. |\n+| *400* | Bad Request, the request message does not contain all required information/properties. |\n+| *404* | Not Found, there is no command-handling adapter instance assigned to the device. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.", "originalCommit": "5594d7472b9302b4dc80fc08e71287af3b7ae9ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEyNjQ1MQ==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390126451", "bodyText": "The check mentioned in the table is a different one, actually.\nThe entry in the table makes it mandatory to return a 404 if not command-handling instance is found.\nThe extra hint below states that the implementation may first check if the given tenant actually has the given device. That would make for a more insightful error message if there was the wrong device id being used. However, this is probably a somewhat theoretical case since a client would usually invoke the \"assert device registration\" method shortly before and would get that error there already.", "author": "calohmn", "createdAt": "2020-03-10T07:10:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5ODYxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4NTc5NA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390185794", "bodyText": "I see, then what about starting like\n\nImplementors of this API may also return a 404 status ...", "author": "sophokles73", "createdAt": "2020-03-10T09:28:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5ODYxMA=="}], "type": "inlineReview"}, {"oid": "d8251cf2d037a173a440c14b1739a67cfd6a7e3a", "url": "https://github.com/eclipse/hono/commit/d8251cf2d037a173a440c14b1739a67cfd6a7e3a", "message": "[#1272] Add docs for new Device Connection API methods.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-10T06:53:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE3OTM5Mw==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390179393", "bodyText": "adapter adapter", "author": "sophokles73", "createdAt": "2020-03-10T09:17:21Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,178 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |", "originalCommit": "d8251cf2d037a173a440c14b1739a67cfd6a7e3a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4MTAyOA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390181028", "bodyText": "or because there is no mapping associating the given tenant and device with the given adapter instance\n\nIsn't this exactly the cause that would lead to a 412 being returned as described in the next paragraph?", "author": "sophokles73", "createdAt": "2020-03-10T09:20:20Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,178 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to missing data in the request or because there is no mapping associating the given tenant and device with the given adapter instance. |", "originalCommit": "d8251cf2d037a173a440c14b1739a67cfd6a7e3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI0MjUzMA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390242530", "bodyText": "Yes, I'll rephrase that, putting 404 in the table and adding a hint below that an implementor may also return 412 in the above case instead of 404.\nI don't want to make that distinction mandatory, because in an implementation, underlying method calls like Map.remove(key, value) may not provide that information.", "author": "calohmn", "createdAt": "2020-03-10T11:12:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4MTAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4Mjg4Mg==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390182882", "bodyText": "I still believe that we should rather put complex context into the body instead ...\nWe do this in other cases as well, e.g. https://www.eclipse.org/hono/docs/api/credentials/#get-credentials", "author": "sophokles73", "createdAt": "2020-03-10T09:23:27Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,178 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to missing data in the request or because there is no mapping associating the given tenant and device with the given adapter instance. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device.\n+\n+As part of the request message, the client is supposed to provide the list of gateways that may act on behalf of the given device. The client may get this list via the Device Registration API's [*assert Device Registration*]({{< relref \"/api/device-registration#assert-device-registration\" >}}) operation.\n+\n+This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+1. If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.\n+1. Otherwise, if there is an adapter instance registered for the last known gateway associated with the given device, this adapter instance is returned as the *single* returned list entry. The last known gateway has to be contained in the given list of gateways for this case.\n+1. Otherwise, *all* adapter instances associated with any of the given gateway identifiers are returned.\n+\n+That means that for a device communicating via a gateway, the result is reduced to a *single element* list if an adapter instance for the device itself or its last known gateway is found. The adapter instance registered for the device itself is given precedence in order to ensure that a gateway having subscribed to commands for that *particular device* is chosen over a gateway that has subscribed to commands for *all* devices of a tenant.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"get_cmd_handling_adapter_instances.svg\" title=\"Client retrieving the list of command-handling adapter instances for a device\" alt=\"A client sends a request message for retrieving the list of command-handling adapter instances for a device and receives a response containing the information\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to retrieve the command-handling adapter instances for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name           | Mandatory | Location                 | AMQP Type | Description |\n+| :------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*      | yes       | *properties*             | *string*  | MUST be set to `get-cmd-handling-adapter-instances`. |\n+| *gateway_ids*  | yes       | *application-properties* | *string*  | A JSON array containing the IDs of the gateways that may act on behalf of the given device. |", "originalCommit": "d8251cf2d037a173a440c14b1739a67cfd6a7e3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzMzEzMA==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390233130", "bodyText": "Well, I don't have a strong opinion here, I can change it back to using the request body. That way there are no specially encoded values in the application-properties.", "author": "calohmn", "createdAt": "2020-03-10T10:53:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4Mjg4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4NDE5Nw==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390184197", "bodyText": "wouldn't it be sufficient to just put an array into the response body, i.e. omit the adapter-instances property?", "author": "sophokles73", "createdAt": "2020-03-10T09:25:37Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,178 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance mapping information for the device has been removed. |\n+| *400* | Bad Request, the command-handling adapter adapter instance information has not been updated due to missing data in the request or because there is no mapping associating the given tenant and device with the given adapter instance. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant or that no adapter instance is associated with the device. Furthermore, in case the currently mapped adapter instance doesn't match the given adapter instance id, a *412* status code may be returned. However, performing any of these checks is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Get command-handling protocol adapter instances for device\n+\n+Clients use this command to *get* information about the adapter instances that can handle command & control messages for the given device.\n+\n+As part of the request message, the client is supposed to provide the list of gateways that may act on behalf of the given device. The client may get this list via the Device Registration API's [*assert Device Registration*]({{< relref \"/api/device-registration#assert-device-registration\" >}}) operation.\n+\n+This API doesn't mandate checks on the validity of the given device and the gateway list in order not to introduce a dependency on the *Device Registration API*.\n+\n+The command implementation MUST determine the adapter instances by applying the following rules (in the given order):\n+1. If an adapter instance is associated with the given device, this adapter instance is returned as the *single* returned list entry.\n+1. Otherwise, if there is an adapter instance registered for the last known gateway associated with the given device, this adapter instance is returned as the *single* returned list entry. The last known gateway has to be contained in the given list of gateways for this case.\n+1. Otherwise, *all* adapter instances associated with any of the given gateway identifiers are returned.\n+\n+That means that for a device communicating via a gateway, the result is reduced to a *single element* list if an adapter instance for the device itself or its last known gateway is found. The adapter instance registered for the device itself is given precedence in order to ensure that a gateway having subscribed to commands for that *particular device* is chosen over a gateway that has subscribed to commands for *all* devices of a tenant.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"get_cmd_handling_adapter_instances.svg\" title=\"Client retrieving the list of command-handling adapter instances for a device\" alt=\"A client sends a request message for retrieving the list of command-handling adapter instances for a device and receives a response containing the information\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to retrieve the command-handling adapter instances for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name           | Mandatory | Location                 | AMQP Type | Description |\n+| :------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*      | yes       | *properties*             | *string*  | MUST be set to `get-cmd-handling-adapter-instances`. |\n+| *gateway_ids*  | yes       | *application-properties* | *string*  | A JSON array containing the IDs of the gateways that may act on behalf of the given device. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *get command-handling adapter instances for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}) as well as the properties shown in the following table:\n+\n+| Name             | Mandatory | Location                 | AMQP Type    | Description |\n+| :--------------- | :-------: | :----------------------- | :----------- | :---------- |\n+| *content-type*   | no        | *properties*             | *string*     | MUST be set to `application/json` if the invocation of the operation was successful and the body of the response message contains payload as described below. |\n+\n+The result of a successful invocation is carried in a single Data section of the response message as a UTF-8 encoded string representation of a single JSON object. It is an error to include payload that is not of this type.\n+\n+The response message JSON object has the following properties:\n+\n+| Name                | Mandatory | JSON Type     | Description |\n+| :------------------ | :-------: | :------------ | :---------- |\n+| *adapter-instances* | *yes*     | *array*       | A non-empty array of JSON objects that represent the command-handling adapter instances along with the device or gateway id. |", "originalCommit": "d8251cf2d037a173a440c14b1739a67cfd6a7e3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwNzI1Ng==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390207256", "bodyText": "From a purely API standpoint, yes.\nIntroducing an JsonArray result would mean that there are different result types for the Device Connection API operations. From an implementation perspective, this means there cannot be just one DeviceConnectionResult object used for all methods (extending RequestResponseResult<JsonObject>), but there would have to be another DeviceConnectionArrayResult (extending RequestResponseResult<JsonArray>).\nBut, thinking more about it, it is indeed a bit of a crutch, this extra \"adapter-instances\" field and there probably won't be any other fields, getting added on the same level (like some last-updated field for example; wouldn't make sense there).\nSo, yes, I can change it.", "author": "calohmn", "createdAt": "2020-03-10T10:05:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4NDE5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIyOTI2Mg==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390229262", "bodyText": "I was just wondering. One good reason to keep the JSON obect based result would indeed be to keep it extensible. Maybe we want to add additional properties sometime later? I do see the drawback of having to create another result class so I'll leave it up to you whether you want to change it or not :-)", "author": "sophokles73", "createdAt": "2020-03-10T10:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4NDE5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI0MzU4Mw==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390243583", "bodyText": "Ok, extensibility and a common DeviceConnectionResult - I'll keep it as a JSON object.", "author": "calohmn", "createdAt": "2020-03-10T11:14:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4NDE5Nw=="}], "type": "inlineReview"}, {"oid": "4bedafbb876f6da295d70130feedd4d101fa0c9f", "url": "https://github.com/eclipse/hono/commit/4bedafbb876f6da295d70130feedd4d101fa0c9f", "message": "[#1272] Add docs for new Device Connection API methods.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-10T11:15:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2ODE1Mw==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390268153", "bodyText": "response to a remove command-handling adapter ...", "author": "sophokles73", "createdAt": "2020-03-10T12:07:34Z", "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -107,6 +107,192 @@ Implementors of this API may return a *404* status code in order to indicate tha\n \n For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n \n+## Set command-handling protocol adapter instance for device\n+\n+Clients use this command to *set* the protocol adapter instance that currently handles command & control messages for a given device.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"set_cmd_handling_adapter_instance.svg\" title=\"Client sets the command-handling protocol adapter instance for device\" alt=\"A client sends a request message for setting the adapter instance and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to set the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).\n+\n+The response message's *status* property may contain the following codes:\n+\n+| Code  | Description |\n+| :---- | :---------- |\n+| *204* | OK, the adapter instance for the device has been updated. |\n+| *400* | Bad Request, the command-handling adapter instance has not been updated due to invalid or missing data in the request. |\n+\n+Implementors of this API may return a *404* status code in order to indicate that no device with the given identifier exists for the given tenant. However, performing such a check is optional.\n+\n+For status codes indicating an error (codes in the `400 - 499` range) the message body MAY contain a detailed description of the error that occurred.\n+\n+## Remove command-handling protocol adapter instance for device\n+\n+Clients use this command to *remove* the information, which protocol adapter instance is currently handling command & control messages for the given device. The mapping information is only removed, if the currently associated adapter instance matches the one given in the request.\n+\n+This API doesn't mandate checks on the validity of the given device in order not to introduce a dependency on the *Device Registration API*. However, implementations of this API may choose to perform such checks or impose a restriction on the overall amount of data that can be stored per tenant in order to protect against malicious requests.\n+\n+**Message Flow**\n+\n+\n+{{< figure src=\"remove_cmd_handling_adapter_instance.svg\" title=\"Client removes the command-handling protocol adapter instance information for device\" alt=\"A client sends a request message for removing the adapter instance mapping and receives a response containing a confirmation\" >}}\n+\n+**Request Message Format**\n+\n+The following table provides an overview of the properties a client needs to set on a message to remove the mapping information regarding the command-handling protocol adapter instance for a device in addition to the [Standard Request Properties]({{< relref \"#standard-request-properties\" >}}).\n+\n+| Name                  | Mandatory | Location                 | AMQP Type | Description |\n+| :-------------------- | :-------: | :----------------------- | :-------- | :---------- |\n+| *subject*             | yes       | *properties*             | *string*  | MUST be set to `remove-cmd-handling-adapter-instance`. |\n+| *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance to remove the mapping information for. Only if this adapter instance is currently associated with the device or gateway identified by the *device_id* property, the mapping entry will be removed. |\n+\n+The body of the message SHOULD be empty and will be ignored if it is not.\n+\n+**Response Message Format**\n+\n+A response to a *set command-handling adapter instance for device* request contains the [Standard Response Properties]({{< relref \"#standard-response-properties\" >}}).", "originalCommit": "4bedafbb876f6da295d70130feedd4d101fa0c9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3NzY1OQ==", "url": "https://github.com/eclipse/hono/pull/1818#discussion_r390277659", "bodyText": "Fixed.", "author": "calohmn", "createdAt": "2020-03-10T12:27:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2ODE1Mw=="}], "type": "inlineReview"}, {"oid": "e993414b3472f6b82ea6bd88e6ce68693efe2b20", "url": "https://github.com/eclipse/hono/commit/e993414b3472f6b82ea6bd88e6ce68693efe2b20", "message": "[#1272] Add docs for new Device Connection API methods.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-10T12:26:50Z", "type": "commit"}, {"oid": "e993414b3472f6b82ea6bd88e6ce68693efe2b20", "url": "https://github.com/eclipse/hono/commit/e993414b3472f6b82ea6bd88e6ce68693efe2b20", "message": "[#1272] Add docs for new Device Connection API methods.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-03-10T12:26:50Z", "type": "forcePushed"}]}