{"pr_number": 2297, "pr_title": "[#2267] Do not use Spring autowiring for adapters anymore", "pr_createdAt": "2020-11-13T15:16:22Z", "pr_url": "https://github.com/eclipse/hono/pull/2297", "timeline": [{"oid": "8ec1c72ec0526a23d0e46a6b11850d2473fe0f95", "url": "https://github.com/eclipse/hono/commit/8ec1c72ec0526a23d0e46a6b11850d2473fe0f95", "message": "[#2267] Do not use Spring autowiring for adapters anymore\n\nThe collaborators required by protocol adapters are not injected using\nautowiring anymore. This allows for shifting responsibility of object\ninstantiation/initialization from AbstractProtocolAdapterBase to the\nSpring Boot/Quarkus configuration classes which helps with hiding\nimplementation details from the adapter implementation classes.\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-11-13T15:14:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEyMDU1NQ==", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r523120555", "bodyText": "It seems to me, the content of the adapter() method can be reduced to just:\n        final VertxBasedMqttProtocolAdapter adapter = new VertxBasedMqttProtocolAdapter();\n        setCollaborators(adapter);\n        adapter.setConfig(adapterProperties);\n        adapter.setMetrics(metrics);\n        adapter.setMessageMapping(messageMapping());\n        return adapter;\n\nusing the parent setCollaborators(AbstractProtocolAdapterBase) method.\nSame goes for the corresponding class/method in the hono-adapter-http-vertx-quarkus module.", "author": "calohmn", "createdAt": "2020-11-13T17:44:23Z", "path": "adapters/mqtt-vertx-quarkus/src/main/java/org/eclipse/hono/adapter/mqtt/quarkus/Application.java", "diffHunk": "@@ -83,16 +96,73 @@ void onStop(final @Observes ShutdownEvent ev) {\n \n     private VertxBasedMqttProtocolAdapter adapter() {\n \n+        final DeviceRegistrationClient registrationClient = registrationClient();\n+        final DeviceConnectionClient deviceConnectionClient = deviceConnectionClient();\n+        final CommandTargetMapper commandTargetMapper = commandTargetMapper();\n+\n+        commandTargetMapper.initialize(new CommandTargetMapperContext() {\n+\n+            @Override\n+            public Future<List<String>> getViaGateways(", "originalCommit": "8ec1c72ec0526a23d0e46a6b11850d2473fe0f95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzkzMzIzNQ==", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r523933235", "bodyText": "That's true and that is what I actually wanted to do. Don't know why it ended up this way ...", "author": "sophokles73", "createdAt": "2020-11-16T07:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEyMDU1NQ=="}], "type": "inlineReview"}, {"oid": "65354b3611da2a353cb7fb44ec06f3fdf40c00ef", "url": "https://github.com/eclipse/hono/commit/65354b3611da2a353cb7fb44ec06f3fdf40c00ef", "message": "Incorporate feedback\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-11-16T07:34:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk1OTc4OQ==", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r523959789", "bodyText": "There are still subclasses of AbstractProtocolAdapterBase that use the @Autowired annotation (e.g. VertxBasedMqttProtocolAdapter), I guess it should be removed there as well.", "author": "calohmn", "createdAt": "2020-11-16T08:14:33Z", "path": "service-base/src/main/java/org/eclipse/hono/service/AbstractProtocolAdapterBase.java", "diffHunk": "@@ -55,22 +51,15 @@\n import org.eclipse.hono.service.resourcelimits.ResourceLimitChecks;\n import org.eclipse.hono.service.util.ServiceBaseUtils;\n import org.eclipse.hono.util.Constants;\n-import org.eclipse.hono.util.CredentialsConstants;\n-import org.eclipse.hono.util.DeviceConnectionConstants;\n import org.eclipse.hono.util.EventConstants;\n import org.eclipse.hono.util.Lifecycle;\n import org.eclipse.hono.util.MessageHelper;\n import org.eclipse.hono.util.QoS;\n import org.eclipse.hono.util.RegistrationAssertion;\n-import org.eclipse.hono.util.RegistrationConstants;\n import org.eclipse.hono.util.ResourceIdentifier;\n import org.eclipse.hono.util.Strings;\n-import org.eclipse.hono.util.TelemetryConstants;\n import org.eclipse.hono.util.TelemetryExecutionContext;\n-import org.eclipse.hono.util.TenantConstants;\n import org.eclipse.hono.util.TenantObject;\n-import org.springframework.beans.factory.annotation.Autowired;", "originalCommit": "65354b3611da2a353cb7fb44ec06f3fdf40c00ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwNzM0MA==", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r524007340", "bodyText": "Good point. I will remove those as well ...", "author": "sophokles73", "createdAt": "2020-11-16T09:16:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk1OTc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA1NzQ3Mg==", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r524057472", "bodyText": "I have pushed changes ...", "author": "sophokles73", "createdAt": "2020-11-16T10:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk1OTc4OQ=="}], "type": "inlineReview"}, {"oid": "6f91d270376a327765ad8af8d778d7386173fc96", "url": "https://github.com/eclipse/hono/commit/6f91d270376a327765ad8af8d778d7386173fc96", "message": "Do not use autowiring for injecting metrics implementation\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-11-16T09:59:02Z", "type": "commit"}]}