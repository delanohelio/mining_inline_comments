{"pr_number": 1986, "pr_title": "Use async psk for dtls", "pr_createdAt": "2020-05-28T10:47:47Z", "pr_url": "https://github.com/eclipse/hono/pull/1986", "timeline": [{"oid": "449efa81cc4bd73cdfa3da660bba5aa7ca355699", "url": "https://github.com/eclipse/hono/commit/449efa81cc4bd73cdfa3da660bba5aa7ca355699", "message": "Adapt DefaultDeviceResolver to use AdvancedPskStore.\n\nUse new asynchronous PSK-API of Californium to reduce resource\nconsumption on accessing the remote credentials store.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-05-30T08:13:13Z", "type": "forcePushed"}, {"oid": "9979394c2ce7587b0ed2ef196101e04120d4c1c7", "url": "https://github.com/eclipse/hono/commit/9979394c2ce7587b0ed2ef196101e04120d4c1c7", "message": "Adapt DefaultDeviceResolver to use AdvancedPskStore.\n\nUse new asynchronous PSK-API of Californium to reduce resource\nconsumption on accessing the remote credentials store.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-06-02T07:45:55Z", "type": "forcePushed"}, {"oid": "333feca4c6ee076d1fc2b020ad438027ac55a19d", "url": "https://github.com/eclipse/hono/commit/333feca4c6ee076d1fc2b020ad438027ac55a19d", "message": "Adapt DefaultDeviceResolver to use AdvancedPskStore and\nAdvancedApplicationLevelInfoSupplier.\n\nUse new asynchronous PSK-API of Californium to reduce resource\nconsumption on accessing the remote credentials store.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-06-17T13:06:03Z", "type": "forcePushed"}, {"oid": "3b0d7d5faf7a01743f748def0e7ce10750c31208", "url": "https://github.com/eclipse/hono/commit/3b0d7d5faf7a01743f748def0e7ce10750c31208", "message": "Update Californium to 2.3.0.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-06-24T15:18:01Z", "type": "commit"}, {"oid": "e3ae340201a2843433fc1f84ee4278f0557361bf", "url": "https://github.com/eclipse/hono/commit/e3ae340201a2843433fc1f84ee4278f0557361bf", "message": "Use peers based deduplicator for coap-adapter.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-06-24T15:18:20Z", "type": "commit"}, {"oid": "a6c19f90f57abfbdfb48331b82cd2e9d1012cfad", "url": "https://github.com/eclipse/hono/commit/a6c19f90f57abfbdfb48331b82cd2e9d1012cfad", "message": "Adapt DefaultDeviceResolver to use AdvancedPskStore and\nAdvancedApplicationLevelInfoSupplier.\n\nUse new asynchronous PSK-API of Californium to reduce resource\nconsumption on accessing the remote credentials store.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-06-24T15:18:33Z", "type": "commit"}, {"oid": "a6c19f90f57abfbdfb48331b82cd2e9d1012cfad", "url": "https://github.com/eclipse/hono/commit/a6c19f90f57abfbdfb48331b82cd2e9d1012cfad", "message": "Adapt DefaultDeviceResolver to use AdvancedPskStore and\nAdvancedApplicationLevelInfoSupplier.\n\nUse new asynchronous PSK-API of Californium to reduce resource\nconsumption on accessing the remote credentials store.\n\nSigned-off-by: Achim Kraus <achim.kraus@bosch.io>", "committedDate": "2020-06-24T15:18:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1NzUxNQ==", "url": "https://github.com/eclipse/hono/pull/1986#discussion_r448957515", "bodyText": "which component invokes this method and when?", "author": "sophokles73", "createdAt": "2020-07-02T12:14:37Z", "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/DefaultDeviceResolver.java", "diffHunk": "@@ -240,4 +256,24 @@ private PreSharedKeyDeviceIdentity getHandshakeIdentity(final Span span, final S\n         final String splitRegex = config.isSingleTenant() ? null : config.getIdSplitRegex();\n         return PreSharedKeyDeviceIdentity.create(span, identity, splitRegex);\n     }\n+\n+    @Override\n+    public boolean hasEcdhePskSupported() {\n+        return true;\n+    }\n+\n+    @Override\n+    public PskSecretResult requestPskSecretResult(final ConnectionId cid, final ServerNames serverName,\n+            final PskPublicInformation identity, final String hmacAlgorithm, final SecretKey otherSecret,\n+            final byte[] seed) {\n+\n+        context.runOnContext((v) -> loadCredentialsForDevice(cid, identity));\n+        return null;\n+    }\n+\n+    @Override\n+    public void setResultHandler(final PskSecretResultHandler resultHandler) {", "originalCommit": "a6c19f90f57abfbdfb48331b82cd2e9d1012cfad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk2MTk3OQ==", "url": "https://github.com/eclipse/hono/pull/1986#discussion_r448961979", "bodyText": "The DTLSConnector in initialization.", "author": "boaks", "createdAt": "2020-07-02T12:23:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA3NTEyNA==", "url": "https://github.com/eclipse/hono/pull/1986#discussion_r449075124", "bodyText": "So this is only set once and not for each invocation of requestPskSecretResult, right?", "author": "sophokles73", "createdAt": "2020-07-02T15:15:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA3OTQxMQ==", "url": "https://github.com/eclipse/hono/pull/1986#discussion_r449079411", "bodyText": "yes.", "author": "boaks", "createdAt": "2020-07-02T15:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA4MDIwMg==", "url": "https://github.com/eclipse/hono/pull/1986#discussion_r449080202", "bodyText": "Just to mention:\notherwise I would have included that callback in the call.", "author": "boaks", "createdAt": "2020-07-02T15:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA4MTk4Mg==", "url": "https://github.com/eclipse/hono/pull/1986#discussion_r449081982", "bodyText": "That is the answer I had hoped for/expected ;-)", "author": "sophokles73", "createdAt": "2020-07-02T15:25:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1NzUxNQ=="}], "type": "inlineReview"}]}