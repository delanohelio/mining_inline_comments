{"pr_number": 2323, "pr_title": "[#2029] Fix Command Router AMQP server vert.x context issues", "pr_createdAt": "2020-11-23T17:01:07Z", "pr_url": "https://github.com/eclipse/hono/pull/2323", "timeline": [{"oid": "9ba04b4675c82a233b037286e2a183f6329df6e1", "url": "https://github.com/eclipse/hono/commit/9ba04b4675c82a233b037286e2a183f6329df6e1", "message": "[#2029] Fix issues caused by different vertx contexts being used.\n\nThe CommandRouterServiceImpl is no Verticle anymore, therefore\nthere is no issue anymore with CommandRouterAmqpServer requests\nending up being handled on the wrong vert.x context.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-11-25T10:32:09Z", "type": "commit"}, {"oid": "9ba04b4675c82a233b037286e2a183f6329df6e1", "url": "https://github.com/eclipse/hono/commit/9ba04b4675c82a233b037286e2a183f6329df6e1", "message": "[#2029] Fix issues caused by different vertx contexts being used.\n\nThe CommandRouterServiceImpl is no Verticle anymore, therefore\nthere is no issue anymore with CommandRouterAmqpServer requests\nending up being handled on the wrong vert.x context.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-11-25T10:32:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgzMTU3Ng==", "url": "https://github.com/eclipse/hono/pull/2323#discussion_r530831576", "bodyText": "how about adding this as the default implementation to org.eclipse.hono.service.amqp.AbstractDelegatingRequestResponseEndpoint?\nIt seems to make a lot of sense to register these checks automatically, doesn't it?", "author": "sophokles73", "createdAt": "2020-11-26T07:54:49Z", "path": "services/command-router/src/main/java/org/eclipse/hono/commandrouter/ApplicationConfig.java", "diffHunk": "@@ -172,13 +174,28 @@ public ObjectFactoryCreatingFactoryBean amqpServerFactory() {\n     /**\n      * Creates a new instance of an AMQP 1.0 protocol handler for Hono's <em>Command Router</em> API.\n      *\n-     * @param service The service instance to delegate to.\n      * @return The handler.\n      */\n     @Bean\n     @Scope(\"prototype\")\n-    public AmqpEndpoint commandRouterAmqpEndpoint(final CommandRouterService service) {\n-        return new DelegatingCommandRouterAmqpEndpoint<>(vertx(), service);\n+    public AmqpEndpoint commandRouterAmqpEndpoint() {\n+        final CommandRouterService commandRouterService = commandRouterService();\n+        return new DelegatingCommandRouterAmqpEndpoint<>(vertx(), commandRouterService) {\n+\n+            @Override\n+            public void registerLivenessChecks(final HealthCheckHandler handler) {", "originalCommit": "9ba04b4675c82a233b037286e2a183f6329df6e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg0NDgwMQ==", "url": "https://github.com/eclipse/hono/pull/2323#discussion_r530844801", "bodyText": "I also thought about this. But that would have implications on the hono-service-device-connection module and its usage of the DelegatingDeviceConnectionAmqpEndpoint class, where the given service implementation is already registered with the health check by other means (done in the Application class there).", "author": "calohmn", "createdAt": "2020-11-26T08:20:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgzMTU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg1OTk3Mg==", "url": "https://github.com/eclipse/hono/pull/2323#discussion_r530859972", "bodyText": "I see, then let's keep it like this for the time being ...", "author": "sophokles73", "createdAt": "2020-11-26T08:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgzMTU3Ng=="}], "type": "inlineReview"}]}