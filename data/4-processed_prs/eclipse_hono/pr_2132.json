{"pr_number": 2132, "pr_title": "Update spec. Add missing information.", "pr_createdAt": "2020-08-26T10:40:02Z", "pr_url": "https://github.com/eclipse/hono/pull/2132", "timeline": [{"oid": "784da76f1495070f57019bb6ad00ae91e065dfdd", "url": "https://github.com/eclipse/hono/commit/784da76f1495070f57019bb6ad00ae91e065dfdd", "message": "Update spec. Add missing information.\n\nThis corrects a note, making it more explicit that a tenant must exist\nwhen creating a device. It also lists the error code to report in such\ncases.", "committedDate": "2020-08-26T10:38:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4MzY5Mw==", "url": "https://github.com/eclipse/hono/pull/2132#discussion_r480183693", "bodyText": "AFIK it is:  must no longer  or must not any longer?\nhttps://dictionary.cambridge.org/grammar/british-grammar/no-longer-not-any-longer", "author": "kaniyan", "createdAt": "2020-08-31T14:51:48Z", "path": "site/documentation/content/api/management/device-registry-v1.yaml", "diffHunk": "@@ -270,8 +270,9 @@ paths:\n          summary: Delete tenant\n          description: |\n             Clients use this operation to remove an existing tenant from the registry.\n-            Registry implementations may optionally perform a *cascading* delete of all\n-            the tenant's devices and credentials as well.\n+\n+            When the operation succeeds, the data owned by this tenant (including devices and their\n+            credentials) must not longer be accessible. These entities should be reported as *not found*.", "originalCommit": "5824dfba412e9b579905eb080347d39a2f93186f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4Mzc2Nw==", "url": "https://github.com/eclipse/hono/pull/2132#discussion_r480183767", "bodyText": "AFIK it is:  must no longer  or must not any longer?", "author": "kaniyan", "createdAt": "2020-08-31T14:51:53Z", "path": "site/documentation/content/api/management/device-registry-v1.yaml", "diffHunk": "@@ -494,8 +495,9 @@ paths:\n          summary: Delete an existing device registration\n          description: |\n             Clients use this operation to remove an existing device from the registry.\n-            Registry implementations may optionally perform a *cascading* delete of all\n-            the device's credentials as well.\n+\n+            When the operation succeeds, the data owned by this device (including its credentials)\n+            must not longer be accessible. These entities should be reported as *not found*.", "originalCommit": "5824dfba412e9b579905eb080347d39a2f93186f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMTE0NQ==", "url": "https://github.com/eclipse/hono/pull/2132#discussion_r480201145", "bodyText": "When the operation succeeds, the data owned by this tenant (including devices and their\ncredentials) must not longer be accessible. These entities should be reported as not found.\n\nWith the above comment, I understood that the tenant existence must be checked not only during create device operation but for all device/credentials management (HTTP) operations and device/credentials services (AMQP). Shouldn't we specify the outcome with the corresponding response code (404) under all those operations in the spec?\nIf we are checking for tenant existence even during delete device operation, then it is no more possible to delete the devices of a tenant that has been already deleted. Does it mean, in order to clean up the devices, the tenant need to be registered again? May be we should allow deleting devices even though the tenant doesn't exist. WDYT?", "author": "kaniyan", "createdAt": "2020-08-31T15:19:11Z", "path": "site/documentation/content/api/management/device-registry-v1.yaml", "diffHunk": "@@ -270,8 +270,9 @@ paths:\n          summary: Delete tenant\n          description: |\n             Clients use this operation to remove an existing tenant from the registry.\n-            Registry implementations may optionally perform a *cascading* delete of all\n-            the tenant's devices and credentials as well.\n+\n+            When the operation succeeds, the data owned by this tenant (including devices and their\n+            credentials) must not longer be accessible. These entities should be reported as *not found*.", "originalCommit": "5824dfba412e9b579905eb080347d39a2f93186f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg2OTgzNw==", "url": "https://github.com/eclipse/hono/pull/2132#discussion_r480869837", "bodyText": "How about\n\nWhen the operation succeeds, clients must no longer be able to retrieve nor update the devices (including their credentials) that belong to the deleted tenant. Implementations of this API should respond with a 404 Not Found to any such request.\n\nThis would make it more explicit that we do not want such data to be used any longer but still allow for implementations to support deleting such entities.", "author": "sophokles73", "createdAt": "2020-09-01T06:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMTE0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkyMDMzOQ==", "url": "https://github.com/eclipse/hono/pull/2132#discussion_r480920339", "bodyText": "So aside from the spec: the tenant information should always be used, in order to look up the tenants, and use the tenant id that it provides in TenantKey, because that maybe been rewritten by the backing service to generate unique ID.\nI don't see much reason here to make \"deleting\" a special operation in the public spec. Internally we can handle this differently. We can provide a privileged operation \"clear tenant\". For JDBC this can be handled: a) with a foreign key constraint b) with a separate process executing the \"delete\" operation.\nSo in the case of Kubernetes, the tenant will be deleted using the Kubernetes API, and that will trigger b). Also would the internal tenant ID be the Kubernetes UID, to ensure uniqueness of the tenant.\nI would propose that the MongoDB follows the same strategy. If the MongoDB registry instance is configured for both Tenant + Devices, then you can take an internal shortcut to delete tenant data when the tenant gets deleted. Otherwise there is specialized operation for cleaning tenant data.", "author": "ctron", "createdAt": "2020-09-01T07:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMTE0NQ=="}], "type": "inlineReview"}, {"oid": "99fe1c75049c5342f6d4885c2487837e091c830e", "url": "https://github.com/eclipse/hono/commit/99fe1c75049c5342f6d4885c2487837e091c830e", "message": "Add a note on what happens to data when it gets deleted.", "committedDate": "2020-09-01T07:31:45Z", "type": "commit"}, {"oid": "99fe1c75049c5342f6d4885c2487837e091c830e", "url": "https://github.com/eclipse/hono/commit/99fe1c75049c5342f6d4885c2487837e091c830e", "message": "Add a note on what happens to data when it gets deleted.", "committedDate": "2020-09-01T07:31:45Z", "type": "forcePushed"}]}