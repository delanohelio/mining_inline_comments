{"pr_number": 2122, "pr_title": "[#2112] Add unit tests for search devices operation", "pr_createdAt": "2020-08-19T16:19:25Z", "pr_url": "https://github.com/eclipse/hono/pull/2122", "timeline": [{"oid": "e5bc70024f9177907390bb30bd1d2aeacb500def", "url": "https://github.com/eclipse/hono/commit/e5bc70024f9177907390bb30bd1d2aeacb500def", "message": "[#2112] Add tests for search devices operation\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-08-19T16:17:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1Njc0OQ==", "url": "https://github.com/eclipse/hono/pull/2122#discussion_r473656749", "bodyText": "you should also mention that subclasses need to make sure to remove any fixture in the DB that has been created by individual test cases", "author": "sophokles73", "createdAt": "2020-08-20T06:43:27Z", "path": "services/device-registry-base/src/test/java/org/eclipse/hono/service/management/device/AbstractDeviceManagementSearchDevicesTest.java", "diffHunk": "@@ -0,0 +1,244 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.hono.service.management.device;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.net.HttpURLConnection;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.UUID;\n+\n+import org.eclipse.hono.util.Constants;\n+import org.junit.jupiter.api.Test;\n+\n+import io.opentracing.noop.NoopSpan;\n+import io.vertx.core.Future;\n+import io.vertx.junit5.VertxTestContext;\n+\n+/**\n+ * As suite of tests for verifying implementations of the Device management's \n+ * search devices operation.\n+ * <p>\n+ * Concrete subclasses need to provide the service implementations under test\n+ * by means of implementing the {@link #getDeviceManagementService()} method.", "originalCommit": "e5bc70024f9177907390bb30bd1d2aeacb500def", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1ODM1OA==", "url": "https://github.com/eclipse/hono/pull/2122#discussion_r473658358", "bodyText": "how about using a random value for an ext property in order to make sure that the result set will always be scoped to devices that have this property? This should also safeguard against any side effects that might occur when running test cases concurrently.", "author": "sophokles73", "createdAt": "2020-08-20T06:45:29Z", "path": "services/device-registry-base/src/test/java/org/eclipse/hono/service/management/device/AbstractDeviceManagementSearchDevicesTest.java", "diffHunk": "@@ -0,0 +1,244 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.hono.service.management.device;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.net.HttpURLConnection;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.UUID;\n+\n+import org.eclipse.hono.util.Constants;\n+import org.junit.jupiter.api.Test;\n+\n+import io.opentracing.noop.NoopSpan;\n+import io.vertx.core.Future;\n+import io.vertx.junit5.VertxTestContext;\n+\n+/**\n+ * As suite of tests for verifying implementations of the Device management's \n+ * search devices operation.\n+ * <p>\n+ * Concrete subclasses need to provide the service implementations under test\n+ * by means of implementing the {@link #getDeviceManagementService()} method.\n+ */\n+public abstract class AbstractDeviceManagementSearchDevicesTest {\n+\n+    /**\n+     * The tenant used in tests.\n+     */\n+    protected static final String TENANT = Constants.DEFAULT_TENANT;\n+\n+    /**\n+     * Gets device management service being tested.\n+     *\n+     * @return The device management service\n+     */\n+    public abstract DeviceManagementService getDeviceManagementService();\n+\n+    private String randomDeviceId() {\n+        return UUID.randomUUID().toString();\n+    }\n+\n+    /**\n+     * Verifies that a request to search devices fails with a {@value HttpURLConnection#HTTP_NOT_FOUND}\n+     * when no matching devices are found.\n+     *\n+     * @param ctx The vert.x test context.\n+     */\n+    @Test\n+    public void testSearchDevicesWhenNoDevicesAreFound(final VertxTestContext ctx) {\n+        final int pageSize = 10;\n+        final int pageOffset = 0;\n+        final Filter filter = new Filter(\"/enabled\", false);", "originalCommit": "e5bc70024f9177907390bb30bd1d2aeacb500def", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "18303ef0c83dff88b0c0b695d376b45ccbe91b9e", "url": "https://github.com/eclipse/hono/commit/18303ef0c83dff88b0c0b695d376b45ccbe91b9e", "message": "Changes related to review comments\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-08-20T09:47:45Z", "type": "commit"}]}