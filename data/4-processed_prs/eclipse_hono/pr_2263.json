{"pr_number": 2263, "pr_title": "[#2258] Specify the content-type of a telemetry/event message via MQTT property bag", "pr_createdAt": "2020-10-26T13:10:11Z", "pr_url": "https://github.com/eclipse/hono/pull/2263", "timeline": [{"oid": "11eb21d38838dc479fafe45a2d6f1677cf568dab", "url": "https://github.com/eclipse/hono/commit/11eb21d38838dc479fafe45a2d6f1677cf568dab", "message": "[#2258] Specify the content-type of a telemetry/event message via MQTT property bag\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-10-26T13:13:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1MjE4MQ==", "url": "https://github.com/eclipse/hono/pull/2263#discussion_r511952181", "bodyText": "What if I specify the content type using Content-Type?", "author": "sophokles73", "createdAt": "2020-10-26T13:19:37Z", "path": "adapters/mqtt-vertx-base/src/main/java/org/eclipse/hono/adapter/mqtt/MqttContext.java", "diffHunk": "@@ -110,6 +111,9 @@ public static MqttContext fromPublishPacket(\n                     .ifPresentOrElse(propertyBag -> {\n                         result.topic = ResourceIdentifier.fromString(propertyBag.topicWithoutPropertyBag());\n                         result.propertyBag = propertyBag;\n+                        // sets the content type using the corresponding value from the property bag\n+                        Optional.ofNullable(propertyBag.getProperty(MessageHelper.SYS_PROPERTY_CONTENT_TYPE))", "originalCommit": "11eb21d38838dc479fafe45a2d6f1677cf568dab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk3OTQ5MQ==", "url": "https://github.com/eclipse/hono/pull/2263#discussion_r511979491", "bodyText": "Good point. Field names in HTTP headers  are case-insensitive. I think it makes sense also to treat the property names as case-insensitive in the MQTT property-bag.  WDYT?", "author": "kaniyan", "createdAt": "2020-10-26T13:58:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1MjE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIzNzQ3MA==", "url": "https://github.com/eclipse/hono/pull/2263#discussion_r512237470", "bodyText": "Now I have made it case insensitive and pushed the changes.", "author": "kaniyan", "createdAt": "2020-10-26T20:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1MjE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1MjUzOQ==", "url": "https://github.com/eclipse/hono/pull/2263#discussion_r511952539", "bodyText": "can you please insert an empty line between this paragraph and the next section heading?", "author": "sophokles73", "createdAt": "2020-10-26T13:20:08Z", "path": "site/documentation/content/user-guide/mqtt-adapter.md", "diffHunk": "@@ -97,6 +97,7 @@ This requires that\n \n The protocol adapter checks the configured [message limit] ({{< relref \"/concepts/resource-limits.md\" >}}) before accepting any telemetry messages. If the message limit is exceeded or the incoming telemetry message cannot be processed, the connection to the client is closed.\n \n+The devices can optionally indicate the content type of the payload by setting the *content-type* property explicitly in the `property-bag`. The `property-bag` is an optional collection of properties intended for the receiver of the message. A property bag is only allowed at the very end of a topic. It always starts with a `/?` character, followed by pairs of URL encoded property names and values that are separated by `&`. For example, a property bag containing two properties *seqNo* and *importance* looks like this: `/topic/name/?seqNo=10034&importance=high`.", "originalCommit": "11eb21d38838dc479fafe45a2d6f1677cf568dab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "71d88f21740fd7b7bf0d3f284dd85cc58a6205b4", "url": "https://github.com/eclipse/hono/commit/71d88f21740fd7b7bf0d3f284dd85cc58a6205b4", "message": "[#2258] Specify the content-type of a telemetry/event message via MQTT property bag\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-10-26T19:48:42Z", "type": "commit"}, {"oid": "a17fa1e49acc658fdf9c359a958b356400539334", "url": "https://github.com/eclipse/hono/commit/a17fa1e49acc658fdf9c359a958b356400539334", "message": "Incorporate feedback and minor improvements.\n\n* Treat property names as case insensitive while retrieving the value of a property.\n* Change the return type of the PropertyBag.topicWithoutPropertyBag() to ResourceIdentifier.\n* Insert an empty line between a paragraph and the next section heading in MQTT adapter guide.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-10-26T20:07:19Z", "type": "commit"}, {"oid": "a17fa1e49acc658fdf9c359a958b356400539334", "url": "https://github.com/eclipse/hono/commit/a17fa1e49acc658fdf9c359a958b356400539334", "message": "Incorporate feedback and minor improvements.\n\n* Treat property names as case insensitive while retrieving the value of a property.\n* Change the return type of the PropertyBag.topicWithoutPropertyBag() to ResourceIdentifier.\n* Insert an empty line between a paragraph and the next section heading in MQTT adapter guide.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-10-26T20:07:19Z", "type": "forcePushed"}]}