{"pr_number": 1769, "pr_title": "[#1736] Make the body optional in tenant creation request", "pr_createdAt": "2020-02-12T15:03:48Z", "pr_url": "https://github.com/eclipse/hono/pull/1769", "timeline": [{"oid": "e26c4d9c7c1424f18d3d56eb1919f6390fafe9d7", "url": "https://github.com/eclipse/hono/commit/e26c4d9c7c1424f18d3d56eb1919f6390fafe9d7", "message": "[#1736] Management api : make the body optional in the creation request for a tenant\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-02-13T10:40:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxMDk3OA==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r378810978", "bodyText": "I think this should be false for the case where tenant id is supplied as well", "author": "dejanb", "createdAt": "2020-02-13T11:44:43Z", "path": "site/documentation/content/api/management/device-registry-v1.yaml", "diffHunk": "@@ -86,7 +86,7 @@ paths:\n                application/json:\n                   schema:\n                      $ref: '#/components/schemas/Tenant'\n-            required: true\n+            required: false", "originalCommit": "e26c4d9c7c1424f18d3d56eb1919f6390fafe9d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxMjU2Mg==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r378812562", "bodyText": "Also, we have the same case for the devices endpoint. I would make it consistent between tenants and devices, but keep it required for the credentials. @sophokles73  wdyt?", "author": "dejanb", "createdAt": "2020-02-13T11:48:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxMDk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxOTIxMA==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r378819210", "bodyText": "+1 for keeping it consistent, i.e. do not require a body for devices as well. However, that could go into a separate PR.", "author": "sophokles73", "createdAt": "2020-02-13T12:03:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxMDk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgyMjEzOA==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r378822138", "bodyText": "Sounds good. Let's wrap tenants in this one and tackle devices in the separate one", "author": "dejanb", "createdAt": "2020-02-13T12:10:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxMDk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxMzQyOQ==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r379413429", "bodyText": "@dejanb I have aligned this for when an ID is supplied. I've also updated the devices section to match.\nCreating a device is now as simple as :\ncurl -i -X POST http://localhost:28080/v1/devices/DEFAULT_TENANT", "author": "jbtrystram", "createdAt": "2020-02-14T12:48:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgxMDk3OA=="}], "type": "inlineReview"}, {"oid": "3dc7ad1f2db8655e142bd59c770815620644bdf7", "url": "https://github.com/eclipse/hono/commit/3dc7ad1f2db8655e142bd59c770815620644bdf7", "message": "[#1736] Management api : make the body optional in the creation request for a tenant\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-02-14T12:46:05Z", "type": "forcePushed"}, {"oid": "c5726b62cd34a5629069ebebd7faf66018e27688", "url": "https://github.com/eclipse/hono/commit/c5726b62cd34a5629069ebebd7faf66018e27688", "message": "[#1736] Management api : make the body optional in the creation request for a tenant\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-02-14T12:57:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3MzA5NA==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r379473094", "bodyText": "is there a particular reason why you want to remove this?", "author": "sophokles73", "createdAt": "2020-02-14T14:54:54Z", "path": "service-base/src/main/java/org/eclipse/hono/service/management/tenant/AbstractTenantManagementHttpEndpoint.java", "diffHunk": "@@ -310,11 +310,6 @@ protected final boolean isValidRequestPayload(final JsonObject payload) {\n      *       or the JsonArray contains elements that are not of type {@link JsonObject}.\n      */\n     protected final void addNotPresentFieldsWithDefaultValuesForTenant(final JsonObject checkedPayload) {\n-        if (!checkedPayload.containsKey(RegistryManagementConstants.FIELD_ENABLED)) {\n-            logger.trace(\"adding 'enabled' key to payload\");\n-            checkedPayload.put(RegistryManagementConstants.FIELD_ENABLED, Boolean.TRUE);\n-        }\n-", "originalCommit": "c5726b62cd34a5629069ebebd7faf66018e27688", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2OTU5OA==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r380169598", "bodyText": "Adding the enabled field is already done a few line before, when calling Util.getRequestPayload(JsonObject) which already add the field.", "author": "jbtrystram", "createdAt": "2020-02-17T13:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3MzA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3NDk3NA==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r379474974", "bodyText": "this needs to be indented ...", "author": "sophokles73", "createdAt": "2020-02-14T14:58:15Z", "path": "tests/src/test/java/org/eclipse/hono/tests/registry/TenantHttpIT.java", "diffHunk": "@@ -164,6 +165,38 @@ public void testAddTenantSucceedsForEmptyBody(final VertxTestContext context) {\n         .setHandler(context.completing());\n     }\n \n+    /**\n+     * Verifies that the service successfully create a tenant from a request without a body.\n+     *\n+     * @param context The vert.x test context.\n+     */\n+    @Test\n+    public void testAddTenantSucceedsWithNoRequestBody(final VertxTestContext context) {\n+\n+        registry.addTenant(tenantId)\n+                .setHandler(context.completing());\n+    }\n+\n+    /**\n+     * Verifies that the service successfully create a tenant with a generated tenant ID.\n+     *\n+     * @param context The vert.x test context.\n+     */\n+    @Test\n+    public void testAddTenantSucceedsWithAGeneratedId(final VertxTestContext context) {\n+\n+        registry.addTenant(\"\")\n+                .compose(res -> {\n+                    // compare the changed field only\n+                    context.verify(() -> {\n+                        assertNotNull(res.get(\"location\"));\n+                        // update the global tenantId value for cleanup\n+                        tenantId = res.get(\"location\");\n+                    });\n+        return Future.succeededFuture();", "originalCommit": "c5726b62cd34a5629069ebebd7faf66018e27688", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6fb3b2e7e7575a3364a63bbc1f15bdf265fc95b", "url": "https://github.com/eclipse/hono/commit/a6fb3b2e7e7575a3364a63bbc1f15bdf265fc95b", "message": "[#1736] Management api : make the body optional in the creation request for a tenant\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-02-18T15:10:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2MTg1Nw==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r381861857", "bodyText": "since you also allow to create a device without providing a body, shouldn't we also add a corresponding test case to the suite for the /devices resources?", "author": "sophokles73", "createdAt": "2020-02-20T08:59:02Z", "path": "tests/src/test/java/org/eclipse/hono/tests/registry/TenantHttpIT.java", "diffHunk": "@@ -164,6 +165,38 @@ public void testAddTenantSucceedsForEmptyBody(final VertxTestContext context) {\n         .setHandler(context.completing());\n     }\n \n+    /**\n+     * Verifies that the service successfully create a tenant from a request without a body.\n+     *\n+     * @param context The vert.x test context.\n+     */\n+    @Test\n+    public void testAddTenantSucceedsWithNoRequestBody(final VertxTestContext context) {\n+\n+        registry.addTenant(tenantId)\n+                .setHandler(context.completing());\n+    }\n+\n+    /**\n+     * Verifies that the service successfully create a tenant with a generated tenant ID.\n+     *\n+     * @param context The vert.x test context.\n+     */\n+    @Test\n+    public void testAddTenantSucceedsWithAGeneratedId(final VertxTestContext context) {", "originalCommit": "a6fb3b2e7e7575a3364a63bbc1f15bdf265fc95b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5ODQxMg==", "url": "https://github.com/eclipse/hono/pull/1769#discussion_r381898412", "bodyText": "I added a test", "author": "jbtrystram", "createdAt": "2020-02-20T10:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2MTg1Nw=="}], "type": "inlineReview"}, {"oid": "86fc4e42ebd93551d6a3653317a5828ed417ae2a", "url": "https://github.com/eclipse/hono/commit/86fc4e42ebd93551d6a3653317a5828ed417ae2a", "message": "[#1736] Management api : make the body optional in the creation request for a tenant\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-02-20T10:03:28Z", "type": "commit"}, {"oid": "86fc4e42ebd93551d6a3653317a5828ed417ae2a", "url": "https://github.com/eclipse/hono/commit/86fc4e42ebd93551d6a3653317a5828ed417ae2a", "message": "[#1736] Management api : make the body optional in the creation request for a tenant\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-02-20T10:03:28Z", "type": "forcePushed"}]}