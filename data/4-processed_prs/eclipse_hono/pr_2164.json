{"pr_number": 2164, "pr_title": "[#2134] Make use of the given client context to match credentials in MongoDB registry", "pr_createdAt": "2020-09-08T09:39:32Z", "pr_url": "https://github.com/eclipse/hono/pull/2164", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTc2MA==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r484859760", "bodyText": "if the result is a JsonArray (as the previous line seems to indicate), then we should probably try to find the matching credentials among the elements of that array instead of just matching the first element, right?", "author": "sophokles73", "createdAt": "2020-09-08T11:57:24Z", "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/service/MongoDbBasedCredentialsService.java", "diffHunk": "@@ -382,6 +383,8 @@ private CompositeFuture createIndices() {\n                         .flatMap(ok -> Optional\n                                 .ofNullable(result.getJsonArray(MongoDbDeviceRegistryUtils.FIELD_CREDENTIALS))\n                                 .map(credential -> credential.getJsonObject(0))\n+                                .filter(credential -> DeviceRegistryUtils.matchesWithClientContext(credential,", "originalCommit": "b1120e627848109f7ec3ba8b80cd7c80d323dff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg4NDE0Ng==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r484884146", "bodyText": "AFAIK, at any case there won't be more than one element. The result is obtained by matching tenantId, authId and type. No two records can have same value for those fields.", "author": "kaniyan", "createdAt": "2020-09-08T12:41:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDg2MQ==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485000861", "bodyText": "Yes, that is true for our implementation at hand.", "author": "sophokles73", "createdAt": "2020-09-08T15:15:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTc2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDYyNw==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485000627", "bodyText": "It would be good to describe how the client context is matched against the extension properties as I do not think that this is straight forward.", "author": "sophokles73", "createdAt": "2020-09-08T15:15:15Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/util/DeviceRegistryUtils.java", "diffHunk": "@@ -242,4 +242,39 @@ public static void checkCredential(\n             }\n         }\n     }\n+\n+    /**\n+     * Checks if the properties in the given client context matches with the extension properties of ", "originalCommit": "b1120e627848109f7ec3ba8b80cd7c80d323dff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU4Mjk2Nw==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485582967", "bodyText": "How about describing (how is being matched) in the paragraph next to the description as below?  WDYT?\n    /**\n     * Checks if the properties in the given client context matches with the extension properties of the\n     * given credential.\n     * <p>\n     * The matching properties in the client context and credential extensions are filtered out based \n     * on their property names. If their values are equal then {@code true} is returned. Otherwise {@code false}.", "author": "kaniyan", "createdAt": "2020-09-09T12:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxNDkyOQ==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485614929", "bodyText": "we'll also need to mention the special handling of properties that only exist in the context but not in the extensions ...", "author": "sophokles73", "createdAt": "2020-09-09T13:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY0ODMzMw==", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485648333", "bodyText": "I have also added the above to the JavaDoc.", "author": "kaniyan", "createdAt": "2020-09-09T14:17:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDYyNw=="}], "type": "inlineReview"}, {"oid": "6d2a4b78884d4847ce504b2be8571ae5e1ea8027", "url": "https://github.com/eclipse/hono/commit/6d2a4b78884d4847ce504b2be8571ae5e1ea8027", "message": "[#2134] Support client context matching\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-09-09T14:16:09Z", "type": "commit"}, {"oid": "d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "url": "https://github.com/eclipse/hono/commit/d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "message": "Update JavaDoc on how the client context matching is being done\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-09-09T14:16:09Z", "type": "commit"}, {"oid": "d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "url": "https://github.com/eclipse/hono/commit/d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "message": "Update JavaDoc on how the client context matching is being done\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>", "committedDate": "2020-09-09T14:16:09Z", "type": "forcePushed"}]}