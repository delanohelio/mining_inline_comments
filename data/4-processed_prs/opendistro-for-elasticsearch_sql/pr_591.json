{"pr_number": 591, "pr_title": "Support mathematical functions rand and constants e, pi", "pr_createdAt": "2020-07-17T21:51:10Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591", "timeline": [{"oid": "46f725b24f384133081117650d077fbf17c00755", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/46f725b24f384133081117650d077fbf17c00755", "message": "support e, pi, rand", "committedDate": "2020-07-17T21:30:46Z", "type": "commit"}, {"oid": "9bb1317f49f236284a3f4cc7be1d2bb3539147e2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9bb1317f49f236284a3f4cc7be1d2bb3539147e2", "message": "Merge branch 'develop' into math3\n\n# Conflicts:\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/DSL.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/function/BuiltinFunctionName.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/operator/arthmetic/MathematicalFunction.java\n#\tcore/src/test/java/com/amazon/opendistroforelasticsearch/sql/expression/operator/arthmetic/MathematicalFunctionTest.java\n#\tinteg-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/ppl/MathematicalFunctionIT.java\n#\tinteg-test/src/test/resources/correctness/expressions/functions.txt\n#\tppl/src/main/antlr/OpenDistroPPLLexer.g4\n#\tppl/src/main/antlr/OpenDistroPPLParser.g4\n#\tsql/src/main/antlr/OpenDistroSQLParser.g4", "committedDate": "2020-07-20T17:37:25Z", "type": "commit"}, {"oid": "dbb7df29e2f9b33196405e73790662ad353f11ac", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dbb7df29e2f9b33196405e73790662ad353f11ac", "message": "updated doc", "committedDate": "2020-07-20T19:04:27Z", "type": "commit"}, {"oid": "901aed6d27a1d5b3a3a70d7bd43ba4f2c096ef64", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/901aed6d27a1d5b3a3a70d7bd43ba4f2c096ef64", "message": "update", "committedDate": "2020-07-20T19:38:01Z", "type": "commit"}, {"oid": "075551350f29253263d38fd5071c1e73891743b6", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/075551350f29253263d38fd5071c1e73891743b6", "message": "update", "committedDate": "2020-07-20T20:13:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5NzE4NQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r457697185", "bodyText": "is this not necessary because of functionArgs? in functionCall? And I think it's more appropriate to mark this optional in functionCall for PPL too?", "author": "dai-chen", "createdAt": "2020-07-20T21:17:48Z", "path": "sql/src/main/antlr/OpenDistroSQLParser.g4", "diffHunk": "@@ -166,16 +166,16 @@ scalarFunctionName\n     ;\n \n mathematicalFunctionName\n-    : ABS | CEIL | CEILING | CONV | CRC32 | EXP | FLOOR | LN | LOG | LOG10 | LOG2 | MOD | POW | POWER\n-    | ROUND | SIGN | SQRT | TRUNCATE\n+    : ABS | CEIL | CEILING | CONV | CRC32 | E | EXP | FLOOR | LN | LOG | LOG10 | LOG2 | MOD | PI | POW | POWER\n+    | RAND | ROUND | SIGN | SQRT | TRUNCATE\n     ;\n \n dateTimeFunctionName\n     : DAYOFMONTH\n     ;\n \n functionArgs\n-    : functionArg (COMMA functionArg)*\n+    : (functionArg (COMMA functionArg)*)?", "originalCommit": "075551350f29253263d38fd5071c1e73891743b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MTE1Ng==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458241156", "bodyText": "Yes functions with no argument will return an empty collection as functionArgs in parser. It has also been refracted in PPL.", "author": "chloe-zh", "createdAt": "2020-07-21T16:45:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5NzE4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyOTc2NA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458329764", "bodyText": "I was asking why is this change necessary because:\nfunctionCall\n    : scalarFunctionName LR_BRACKET functionArgs? RR_BRACKET        #scalarFunctionCall\n    ;", "author": "dai-chen", "createdAt": "2020-07-21T19:15:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5NzE4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5ODg0NQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r457698845", "bodyText": "return type is float?", "author": "dai-chen", "createdAt": "2020-07-20T21:21:27Z", "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -616,10 +636,21 @@ RAND\n Description\n -----------\n \n-Specifications: \n+Usage: RAND()/RAND(N) returns a random floating-point value in the range 0 <= value < 1.0. If integer N is specified, the seed is initialized prior to execution. One implication of this behavior is with identical argument N, rand(N) returns the same value each time, and thus produces a repeatable sequence of column values.\n+\n+Argument type: x: STRING, a: INTEGER, b: INTEGER\n \n-1. RAND() -> NUMBER\n-2. RAND(NUMBER T) -> T\n+Return type: STRING", "originalCommit": "075551350f29253263d38fd5071c1e73891743b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MTk2NQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458241965", "bodyText": "Typo, will correct it, thanks!", "author": "chloe-zh", "createdAt": "2020-07-21T16:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5ODg0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwMDUxNg==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r457700516", "bodyText": "what does this mean?", "author": "dai-chen", "createdAt": "2020-07-20T21:24:49Z", "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -616,10 +636,21 @@ RAND\n Description\n -----------\n \n-Specifications: \n+Usage: RAND()/RAND(N) returns a random floating-point value in the range 0 <= value < 1.0. If integer N is specified, the seed is initialized prior to execution. One implication of this behavior is with identical argument N, rand(N) returns the same value each time, and thus produces a repeatable sequence of column values.\n+\n+Argument type: x: STRING, a: INTEGER, b: INTEGER", "originalCommit": "075551350f29253263d38fd5071c1e73891743b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MjM4MQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458242381", "bodyText": "It should be INTEGER", "author": "chloe-zh", "createdAt": "2020-07-21T16:47:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwMDUxNg=="}], "type": "inlineReview"}, {"oid": "e99698b5407b52a68ebddb6d238407ad35e70a18", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e99698b5407b52a68ebddb6d238407ad35e70a18", "message": "update", "committedDate": "2020-07-21T16:47:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzMjAyMA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458332020", "bodyText": "Sorry for last minute comment. Since we haven't added many functions yet, could you check if the column name required to be all upper case (ex. E(), PI()) or not? In MySQL or SQL standard.", "author": "dai-chen", "createdAt": "2020-07-21T19:19:45Z", "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -291,9 +291,19 @@ E\n Description\n -----------\n \n-Specifications: \n+Usage: E() returns the Euler's number\n \n-1. E() -> DOUBLE\n+Return type: DOUBLE\n+\n+Example::\n+\n+    od> SELECT E()\n+    fetched rows / total rows = 1/1\n+    +-------------------+\n+    | e()               |", "originalCommit": "e99698b5407b52a68ebddb6d238407ad35e70a18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM2MTM1MQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458361351", "bodyText": "Good point! Checked it in MySQL, it should be consistent with the input cases", "author": "chloe-zh", "createdAt": "2020-07-21T20:15:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzMjAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM2ODQzMw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458368433", "bodyText": "Thanks for confirming. So the result column name is always lowercase for now? We can fix this separately if change is major.", "author": "dai-chen", "createdAt": "2020-07-21T20:29:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzMjAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4NDM5NA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458384394", "bodyText": "Yes all lowercase for now. I looked into this issue, it might be a major change. Created related issue: #606", "author": "chloe-zh", "createdAt": "2020-07-21T20:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzMjAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4NTMwMQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/591#discussion_r458385301", "bodyText": "Cool. Thanks!", "author": "dai-chen", "createdAt": "2020-07-21T21:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzMjAyMA=="}], "type": "inlineReview"}]}