{"pr_number": 753, "pr_title": "Support ranking window functions", "pr_createdAt": "2020-09-22T20:02:53Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/753", "timeline": [{"oid": "6538ca1ba855ea387ca32cc68332202dd8d4d80f", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6538ca1ba855ea387ca32cc68332202dd8d4d80f", "message": "Build AST and logical window node", "committedDate": "2020-09-01T22:44:08Z", "type": "commit"}, {"oid": "c68fb6f6ca90d41a1881635dbbe00ba9dd152bd7", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c68fb6f6ca90d41a1881635dbbe00ba9dd152bd7", "message": "Build physical plan", "committedDate": "2020-09-01T23:37:22Z", "type": "commit"}, {"oid": "52ce14f50fb90dc320ea8a63824fb74f55d0e38d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/52ce14f50fb90dc320ea8a63824fb74f55d0e38d", "message": "Implement row number", "committedDate": "2020-09-02T00:42:34Z", "type": "commit"}, {"oid": "9711467767d54e5aaad115df7c318003a63b9289", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9711467767d54e5aaad115df7c318003a63b9289", "message": "Add UT for AST builder", "committedDate": "2020-09-18T19:06:02Z", "type": "commit"}, {"oid": "e41faf22736bdd3242b9acacae836eae03de8f69", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e41faf22736bdd3242b9acacae836eae03de8f69", "message": "Add UT for analyzer", "committedDate": "2020-09-18T22:04:39Z", "type": "commit"}, {"oid": "e471ba188629b6a903031246bbb8947ef2828a12", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e471ba188629b6a903031246bbb8947ef2828a12", "message": "Add UT for implementor", "committedDate": "2020-09-18T22:26:58Z", "type": "commit"}, {"oid": "d98db6ca522640a98651ee2f69bb8ecb1f18b0a9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d98db6ca522640a98651ee2f69bb8ecb1f18b0a9", "message": "Pass checkstyle", "committedDate": "2020-09-18T22:29:48Z", "type": "commit"}, {"oid": "045e31c68ef825af3a08e90d30207e4c5bd55db3", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/045e31c68ef825af3a08e90d30207e4c5bd55db3", "message": "Pass jacoco", "committedDate": "2020-09-18T22:35:17Z", "type": "commit"}, {"oid": "c1a1af4594152aa4b02ace75b71bf097c28a7494", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c1a1af4594152aa4b02ace75b71bf097c28a7494", "message": "Refactor window frame", "committedDate": "2020-09-18T23:50:00Z", "type": "commit"}, {"oid": "9609378cb181c68e50e0b56f1bb6da8fa8915ce4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9609378cb181c68e50e0b56f1bb6da8fa8915ce4", "message": "Refactor ranking function base", "committedDate": "2020-09-18T23:59:24Z", "type": "commit"}, {"oid": "972e2f16f10345823e22887df3eb2f83d1d65c03", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/972e2f16f10345823e22887df3eb2f83d1d65c03", "message": "Pass jacoco", "committedDate": "2020-09-19T00:07:48Z", "type": "commit"}, {"oid": "888b8baf14936e5fbb5867802628a8027a1efba3", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/888b8baf14936e5fbb5867802628a8027a1efba3", "message": "Add rank function", "committedDate": "2020-09-19T00:41:48Z", "type": "commit"}, {"oid": "e68842c5f76a3d92c16a93affb95b94a17e8afc4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e68842c5f76a3d92c16a93affb95b94a17e8afc4", "message": "Add dense rank function", "committedDate": "2020-09-19T00:51:33Z", "type": "commit"}, {"oid": "5aaede09bb07671a2003a29bb4f48a44541ef5bc", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5aaede09bb07671a2003a29bb4f48a44541ef5bc", "message": "Add UT for window operator", "committedDate": "2020-09-22T17:01:05Z", "type": "commit"}, {"oid": "b91b09f12946724bbd6c6e7dcda7c9d3c2aa9125", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b91b09f12946724bbd6c6e7dcda7c9d3c2aa9125", "message": "Merge branch 'develop' into window-function-poc", "committedDate": "2020-09-22T18:58:48Z", "type": "commit"}, {"oid": "03f73e0342c9a729731006cb4e23e3198c3b94f1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/03f73e0342c9a729731006cb4e23e3198c3b94f1", "message": "Add explain and UT for window operator", "committedDate": "2020-09-22T20:59:51Z", "type": "commit"}, {"oid": "0ccfd34dd412de4978fde84d9fdd3c7ec1defbca", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0ccfd34dd412de4978fde84d9fdd3c7ec1defbca", "message": "Add doctest", "committedDate": "2020-09-22T23:10:05Z", "type": "commit"}, {"oid": "83ae07500b5a7d2e38e110aefb58eb540cda5692", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/83ae07500b5a7d2e38e110aefb58eb540cda5692", "message": "Support sort desc", "committedDate": "2020-09-22T23:44:46Z", "type": "commit"}, {"oid": "d93eda0a57644b28cd19d7bde8f9fcf33e3f2fee", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d93eda0a57644b28cd19d7bde8f9fcf33e3f2fee", "message": "Add comparison test", "committedDate": "2020-09-22T23:51:49Z", "type": "commit"}, {"oid": "d68411d163865b66b7db2b56748eb9f8aca0ee2c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d68411d163865b66b7db2b56748eb9f8aca0ee2c", "message": "Add comparison test", "committedDate": "2020-09-23T17:11:20Z", "type": "commit"}, {"oid": "32d1e227f7608fb387aaac87bd9ace15cccfba11", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/32d1e227f7608fb387aaac87bd9ace15cccfba11", "message": "Enable memory protection for SQL", "committedDate": "2020-09-23T22:58:29Z", "type": "commit"}, {"oid": "38be399e503b3b20c96166ae9a74ebe134d7e952", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/38be399e503b3b20c96166ae9a74ebe134d7e952", "message": "Merge branch 'develop' into window-function-poc", "committedDate": "2020-09-24T17:03:02Z", "type": "commit"}, {"oid": "fbb3d66163d66c596b7e085a7be3ffb014d55d24", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/fbb3d66163d66c596b7e085a7be3ffb014d55d24", "message": "Optimize window function in project list", "committedDate": "2020-09-24T20:25:21Z", "type": "commit"}, {"oid": "c7221c83199dae9504032b8cf712d8af94b7c332", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c7221c83199dae9504032b8cf712d8af94b7c332", "message": "Update doctest", "committedDate": "2020-09-24T20:46:23Z", "type": "commit"}, {"oid": "a2d8db3055929ae9dcb2c397ba9bb2c7ee109b76", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a2d8db3055929ae9dcb2c397ba9bb2c7ee109b76", "message": "Pass jacoco", "committedDate": "2020-09-24T20:59:55Z", "type": "commit"}, {"oid": "97804b13a2fd9c5b751f194925b19ac0ecd2c512", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/97804b13a2fd9c5b751f194925b19ac0ecd2c512", "message": "Rename default sort option", "committedDate": "2020-09-24T22:24:27Z", "type": "commit"}, {"oid": "0e9e0cfa012322cbef380b72bc751371567cd88a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0e9e0cfa012322cbef380b72bc751371567cd88a", "message": "Set sort count to 0", "committedDate": "2020-09-24T22:32:21Z", "type": "commit"}, {"oid": "ffb3d8e515b81209393cfb5e06cd5b30b6648bc2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ffb3d8e515b81209393cfb5e06cd5b30b6648bc2", "message": "Fix reference replace bug", "committedDate": "2020-09-24T23:37:11Z", "type": "commit"}, {"oid": "986332380c87c78180dae7ca39dfce40c3667cbe", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/986332380c87c78180dae7ca39dfce40c3667cbe", "message": "Add more comparison test", "committedDate": "2020-09-25T00:16:38Z", "type": "commit"}, {"oid": "95020741a283e2d2138a4e9f805e6480030b91a7", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/95020741a283e2d2138a4e9f805e6480030b91a7", "message": "Add more comparison test", "committedDate": "2020-09-25T00:22:37Z", "type": "commit"}, {"oid": "d16ee793cb8fa90ceec14b1863288e9afaa95e1a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d16ee793cb8fa90ceec14b1863288e9afaa95e1a", "message": "Merge branch 'develop' into window-function-poc", "committedDate": "2020-09-29T21:30:07Z", "type": "commit"}, {"oid": "efb30368dd7c0893a87a9c90086f00e0704118d0", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/efb30368dd7c0893a87a9c90086f00e0704118d0", "message": "Prepare PR", "committedDate": "2020-09-30T00:02:46Z", "type": "commit"}, {"oid": "bdcfa03fcbc335a7f0f274238a6bda98e4dfe2bd", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bdcfa03fcbc335a7f0f274238a6bda98e4dfe2bd", "message": "Fix empty order by issue", "committedDate": "2020-09-30T00:39:47Z", "type": "commit"}, {"oid": "da7dc306eabb53a85e610f57bd3a33e01f05bfc2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/da7dc306eabb53a85e610f57bd3a33e01f05bfc2", "message": "Add order by in test queries", "committedDate": "2020-09-30T17:48:20Z", "type": "commit"}, {"oid": "8f08c7de39918765d9250b19cac669091655e4b1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8f08c7de39918765d9250b19cac669091655e4b1", "message": "Add limitation doc", "committedDate": "2020-09-30T18:29:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgzNDQwNA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/753#discussion_r499834404", "bodyText": "How about this?\nFor now, only the field defined in index is allowd, all the other caculated fields (calculated by scalar or aggregated function) is not allowed.", "author": "penghuo", "createdAt": "2020-10-05T19:51:50Z", "path": "docs/user/limitations/limitations.rst", "diffHunk": "@@ -54,6 +54,17 @@ For example, e.g. `SELECT depo.name, avg(empo.age) FROM empo JOIN depo WHERE emp\n Here's a link to the Github issue - [Issue 110](https://github.com/opendistro-for-elasticsearch/sql/issues/110).\n \n \n+Limitations on Window Functions\n+===============================\n+\n+For now it's not allowed to use non-regular fields (calculated by scalar or aggregated function) in window definition. For example, ``avg_flight_time`` is not accessible to the rank window definition as follows::", "originalCommit": "8f08c7de39918765d9250b19cac669091655e4b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyODQ0MQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/753#discussion_r501328441", "bodyText": "Sure, done!", "author": "dai-chen", "createdAt": "2020-10-07T21:46:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgzNDQwNA=="}], "type": "inlineReview"}, {"oid": "dff099c593bde689a0eadc78781996ecb1a18061", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dff099c593bde689a0eadc78781996ecb1a18061", "message": "Merge branch 'develop' into window-function-poc", "committedDate": "2020-10-06T20:39:46Z", "type": "commit"}, {"oid": "af644d7b02f572de79f423a87e3e7a3e662e7d66", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/af644d7b02f572de79f423a87e3e7a3e662e7d66", "message": "Refactor window frame", "committedDate": "2020-10-07T19:16:07Z", "type": "commit"}, {"oid": "6d074e0e0ec069eca45b9aad74be38258e1b1c84", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6d074e0e0ec069eca45b9aad74be38258e1b1c84", "message": "Add javadoc", "committedDate": "2020-10-07T20:48:34Z", "type": "commit"}, {"oid": "23f25f49bd195349ce41807d3af0847d29f603e9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/23f25f49bd195349ce41807d3af0847d29f603e9", "message": "Address comment", "committedDate": "2020-10-07T21:57:33Z", "type": "commit"}, {"oid": "1d1d8eb1f0c326fd71d7f400a7f124515cab69f6", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1d1d8eb1f0c326fd71d7f400a7f124515cab69f6", "message": "Merge branch 'develop' into window-function-poc", "committedDate": "2020-10-09T21:24:46Z", "type": "commit"}]}