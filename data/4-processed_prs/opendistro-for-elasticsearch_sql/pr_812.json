{"pr_number": 812, "pr_title": "Migrate Query Workbench to new Platform ", "pr_createdAt": "2020-11-10T21:09:20Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812", "timeline": [{"oid": "b2a7cbe4c5ba3fdebc6d4ab689b57b3699ba65d1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b2a7cbe4c5ba3fdebc6d4ab689b57b3699ba65d1", "message": "initial commit for new platform- save progress on server migration", "committedDate": "2020-11-09T20:04:38Z", "type": "commit"}, {"oid": "2cab346cd09e890d3a582750d6bb8c7eb638347c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2cab346cd09e890d3a582750d6bb8c7eb638347c", "message": "requests being made now, need to create request body correctly", "committedDate": "2020-11-09T23:12:07Z", "type": "commit"}, {"oid": "5053b32d1fbbe5aaa0bc5c16ff22644119048b63", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5053b32d1fbbe5aaa0bc5c16ff22644119048b63", "message": "saving progress, need to send correct response format to client", "committedDate": "2020-11-09T23:47:31Z", "type": "commit"}, {"oid": "dbe75214168842b32c3e5d43cf6c7ec15dcec6e4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dbe75214168842b32c3e5d43cf6c7ec15dcec6e4", "message": "sql and ppl queries working- csv not", "committedDate": "2020-11-10T01:29:33Z", "type": "commit"}, {"oid": "d4ffdd8b588e2f016e7488d753b6729c7207a3cf", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d4ffdd8b588e2f016e7488d753b6729c7207a3cf", "message": "removed header, added ppl json and ppl csv", "committedDate": "2020-11-10T01:58:58Z", "type": "commit"}, {"oid": "3cd895452a193ceb173e354fa11daaeecacd9943", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3cd895452a193ceb173e354fa11daaeecacd9943", "message": "added all routes for query, removed comments from query.ts", "committedDate": "2020-11-10T02:33:22Z", "type": "commit"}, {"oid": "b43b7b799eafd18229d96abf497723c0fb6ae2f4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b43b7b799eafd18229d96abf497723c0fb6ae2f4", "message": "saving progress, converting translate queries", "committedDate": "2020-11-10T18:01:33Z", "type": "commit"}, {"oid": "2526541e52ce0f1e6f83fbe67048e85b7805147a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2526541e52ce0f1e6f83fbe67048e85b7805147a", "message": "server migration done, css pending before PR", "committedDate": "2020-11-10T19:02:56Z", "type": "commit"}, {"oid": "bbad2626ab9425518e1c370ddde4eb5fee6a9590", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bbad2626ab9425518e1c370ddde4eb5fee6a9590", "message": "fixed sidebar placement name and url", "committedDate": "2020-11-10T19:35:31Z", "type": "commit"}, {"oid": "f0a9f66567da9859fcd42995249cae199422c7a4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f0a9f66567da9859fcd42995249cae199422c7a4", "message": "checking responsive width on dev, saving progress", "committedDate": "2020-11-10T19:48:02Z", "type": "commit"}, {"oid": "ca64d6c31e594779745060b5f031e2f42478ca7c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ca64d6c31e594779745060b5f031e2f42478ca7c", "message": "got rid of horizontal line, deleted old index.js and css file", "committedDate": "2020-11-10T20:48:43Z", "type": "commit"}, {"oid": "e2b16484c0c63036931796c393370cdfb5e13781", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e2b16484c0c63036931796c393370cdfb5e13781", "message": "removed comments and ran through yarn prettier", "committedDate": "2020-11-10T21:05:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNjgzMw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521126833", "bodyText": "Missing license header? and should the id be something like opendistroQueryWorkbench?", "author": "joshuali925", "createdAt": "2020-11-11T05:48:18Z", "path": "workbench/common/index.ts", "diffHunk": "@@ -0,0 +1,2 @@\n+export const PLUGIN_ID = 'workbench';", "originalCommit": "e2b16484c0c63036931796c393370cdfb5e13781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwNzk5Nw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521507997", "bodyText": "Good catch, will change and add header", "author": "davidcui1225", "createdAt": "2020-11-11T17:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNzAyMQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521127021", "bodyText": "if you change PLUGIN_ID in common/index.ts, update this as well", "author": "joshuali925", "createdAt": "2020-11-11T05:49:05Z", "path": "workbench/kibana.json", "diffHunk": "@@ -0,0 +1,8 @@\n+{\n+  \"id\": \"workbench\",", "originalCommit": "e2b16484c0c63036931796c393370cdfb5e13781", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNzU5Ng==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521127596", "bodyText": "httpClient: CoreStart['http']?", "author": "joshuali925", "createdAt": "2020-11-11T05:50:56Z", "path": "workbench/public/components/Main/main.tsx", "diffHunk": "@@ -64,7 +64,7 @@ export type ItemIdToExpandedRowMap = {\n };\n \n interface MainProps {\n-  httpClient: IHttpService;\n+  httpClient: any;", "originalCommit": "e2b16484c0c63036931796c393370cdfb5e13781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwMjEzMg==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521502132", "bodyText": "Good catch, forgot to update this- will change", "author": "davidcui1225", "createdAt": "2020-11-11T17:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNzU5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNzYwOA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521127608", "bodyText": "httpClient: CoreStart['http']?", "author": "joshuali925", "createdAt": "2020-11-11T05:51:00Z", "path": "workbench/public/components/Main/main.tsx", "diffHunk": "@@ -181,8 +181,7 @@ export function getQueryResultsForTable(queryResults: ResponseDetail<string>[]):\n }\n \n export class Main extends React.Component<MainProps, MainState> {\n-  httpClient: IHttpService;\n-  // httpClient: any;\n+  httpClient: any;", "originalCommit": "e2b16484c0c63036931796c393370cdfb5e13781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwMjI0OA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521502248", "bodyText": "Same as above", "author": "davidcui1225", "createdAt": "2020-11-11T17:00:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNzYwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyODAwMw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521128003", "bodyText": "what's this empty function onChange? I don't see it being used in Main, you can try removing it in MainProps", "author": "joshuali925", "createdAt": "2020-11-11T05:52:22Z", "path": "workbench/public/components/app.tsx", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+import React from 'react';\n+import { I18nProvider } from '@kbn/i18n/react';\n+import { BrowserRouter as Router, Route } from 'react-router-dom';\n+\n+import { EuiPage, EuiPageBody } from '@elastic/eui';\n+\n+import { CoreStart } from '../../../../src/core/public';\n+import { NavigationPublicPluginStart } from '../../../../src/plugins/navigation/public';\n+\n+import { Main } from './Main';\n+\n+interface WorkbenchAppDeps {\n+  basename: string;\n+  notifications: CoreStart['notifications'];\n+  http: CoreStart['http'];\n+  navigation: NavigationPublicPluginStart;\n+}\n+\n+const onChange = () => {};\n+\n+export const WorkbenchApp = ({ basename, notifications, http, navigation }: WorkbenchAppDeps) => {\n+  return (\n+    <Router basename={'/' + basename}>\n+      <I18nProvider>\n+        <div>\n+          <EuiPage>\n+            <EuiPageBody>\n+              <Route\n+                path=\"/\"\n+                render={(props) => <Main httpClient={http} {...props} onChange={onChange} />}", "originalCommit": "e2b16484c0c63036931796c393370cdfb5e13781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwMjgwMQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521502801", "bodyText": "onChange is required props for Main but is also defined in Main so I just created the empty onChange to pass into Main", "author": "davidcui1225", "createdAt": "2020-11-11T17:00:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyODAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU3MjEyMA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521572120", "bodyText": "Main uses this.onChange which is defined in Main itself, you can remove the onChange in MainProps (line 68 in Main.tsx) so you don't have to pass in this empty function", "author": "joshuali925", "createdAt": "2020-11-11T18:57:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyODAwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyOTkxNQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521129915", "bodyText": "Question, why do we need global variable? and why do we need to concatenate queries?", "author": "joshuali925", "createdAt": "2020-11-11T05:59:10Z", "path": "workbench/server/services/utils/constants.ts", "diffHunk": "@@ -32,3 +34,12 @@ export const CLUSTER = {\n   SQL: 'opendistro_sql',\n   DATA: 'data',\n };\n+\n+export const convertQueryToString = (query: string | ParsedUrlQuery) => {\n+  let index;\n+  var queryString = \"\";", "originalCommit": "e2b16484c0c63036931796c393370cdfb5e13781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwNjEwOQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521506109", "bodyText": "The request object has changed, and the query is not in an Object with each key containing a single character from the query e.g { {'0': 'S'}, {'1': 'E'}, {'2': 'L'}, ...} so convertQueryToString converts it to a string containing the query", "author": "davidcui1225", "createdAt": "2020-11-11T17:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyOTkxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU3NTk1OA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521575958", "bodyText": "That's a weird problem.. is the use of var necessary? can we use let?", "author": "joshuali925", "createdAt": "2020-11-11T19:04:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyOTkxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU4NzIwNg==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/812#discussion_r521587206", "bodyText": "Yeah the change to the KibanaRequest type made the object change completely. And yes good catch, will change to let", "author": "davidcui1225", "createdAt": "2020-11-11T19:25:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyOTkxNQ=="}], "type": "inlineReview"}, {"oid": "5418ff31aae0e6da0e0922870b1aeb2eea72b289", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5418ff31aae0e6da0e0922870b1aeb2eea72b289", "message": "addressed comments", "committedDate": "2020-11-11T17:34:24Z", "type": "commit"}, {"oid": "ce769ae7a842863b8d85473e491ba06b3abf3b1a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ce769ae7a842863b8d85473e491ba06b3abf3b1a", "message": "addressed more comments", "committedDate": "2020-11-11T19:27:08Z", "type": "commit"}]}