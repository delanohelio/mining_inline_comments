{"pr_number": 627, "pr_title": "ODBC: Fix for data loading failure in Power BI Desktop", "pr_createdAt": "2020-07-28T19:57:37Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627", "timeline": [{"oid": "427bd79a138bc13f53e071c8485d8726aa19d1dd", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/427bd79a138bc13f53e071c8485d8726aa19d1dd", "message": "pbi connector", "committedDate": "2020-07-19T04:01:17Z", "type": "commit"}, {"oid": "401a05360a74b165b372f274e1c01b61a5c06ebd", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/401a05360a74b165b372f274e1c01b61a5c06ebd", "message": "update names", "committedDate": "2020-07-19T04:21:22Z", "type": "commit"}, {"oid": "11856cdce473256a3048d967b447b43197181604", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/11856cdce473256a3048d967b447b43197181604", "message": "- add mez file\n- add docs", "committedDate": "2020-07-20T02:42:45Z", "type": "commit"}, {"oid": "e6932698c592fdc2d74d9d92e9a044bc01b979f6", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e6932698c592fdc2d74d9d92e9a044bc01b979f6", "message": "nit", "committedDate": "2020-07-20T02:46:49Z", "type": "commit"}, {"oid": "4158974559d9fc35e6ea0a610aaf0063ad0397fe", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4158974559d9fc35e6ea0a610aaf0063ad0397fe", "message": "nit", "committedDate": "2020-07-20T02:49:26Z", "type": "commit"}, {"oid": "586793f0d70894c6042fd9177e83c88f24cf4164", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/586793f0d70894c6042fd9177e83c88f24cf4164", "message": "image resize", "committedDate": "2020-07-20T03:13:33Z", "type": "commit"}, {"oid": "9cb48a4fffa2aa88b59917da2961cba7e4849580", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9cb48a4fffa2aa88b59917da2961cba7e4849580", "message": "resize image", "committedDate": "2020-07-20T03:17:21Z", "type": "commit"}, {"oid": "c234b8829b0f5b1864bfe500f2b9053c79c7b12d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c234b8829b0f5b1864bfe500f2b9053c79c7b12d", "message": "remove extra lines", "committedDate": "2020-07-20T03:32:00Z", "type": "commit"}, {"oid": "0d0c0509eea739936f4ee4b81307d0566cb39dad", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0d0c0509eea739936f4ee4b81307d0566cb39dad", "message": "nit", "committedDate": "2020-07-20T03:45:54Z", "type": "commit"}, {"oid": "50d4ccf583d527b263bd8465d29b80f32a9f0a62", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/50d4ccf583d527b263bd8465d29b80f32a9f0a62", "message": "update mez file", "committedDate": "2020-07-20T03:46:55Z", "type": "commit"}, {"oid": "023fb674a86c080f802c32fcd46f11c5bfeadba8", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/023fb674a86c080f802c32fcd46f11c5bfeadba8", "message": "rename connector", "committedDate": "2020-07-21T17:39:34Z", "type": "commit"}, {"oid": "0b857c003716461562dbce6fa10df6090eeaad3d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0b857c003716461562dbce6fa10df6090eeaad3d", "message": "rename mez file", "committedDate": "2020-07-21T17:40:37Z", "type": "commit"}, {"oid": "06ae48656b35034cd62dd826569b08c9b075a3d9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/06ae48656b35034cd62dd826569b08c9b075a3d9", "message": "- add basic & aws auth\n- add unit test\n- add errors\n- enable direct query", "committedDate": "2020-07-23T03:04:10Z", "type": "commit"}, {"oid": "b2ff22274877393d4777bff958616d371ec1de32", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b2ff22274877393d4777bff958616d371ec1de32", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into feature/odbc/pbi\n\n# Conflicts:\n#\tsql-odbc/.gitignore\n#\tsql-odbc/src/PowerBIConnector/OdfeSqlOdbcPBIConnector.mproj\n#\tsql-odbc/src/PowerBIConnector/OdfeSqlOdbcPBIConnector.pq\n#\tsql-odbc/src/PowerBIConnector/OdfeSqlOdbcPBIConnector.query.pq\n#\tsql-odbc/src/PowerBIConnector/bin/Release/OdfeSqlOdbcPBIConnector.mez", "committedDate": "2020-07-23T03:19:22Z", "type": "commit"}, {"oid": "3f6ff5d99d07e525874fde3a9ab6987dbe5bfadf", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3f6ff5d99d07e525874fde3a9ab6987dbe5bfadf", "message": "add connector", "committedDate": "2020-07-23T03:21:15Z", "type": "commit"}, {"oid": "ad73d915d13dce97ea855154d9428e67b09368a9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ad73d915d13dce97ea855154d9428e67b09368a9", "message": "update doc", "committedDate": "2020-07-23T03:41:43Z", "type": "commit"}, {"oid": "91d5cbebad32016daa6445db98ad0fc938a0be65", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/91d5cbebad32016daa6445db98ad0fc938a0be65", "message": "add ssl for auth", "committedDate": "2020-07-23T03:59:03Z", "type": "commit"}, {"oid": "ddc725bd3cfd70d3501ae325871eaab73b669fd3", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ddc725bd3cfd70d3501ae325871eaab73b669fd3", "message": "update docs for errors", "committedDate": "2020-07-23T16:25:05Z", "type": "commit"}, {"oid": "b9463517addc5113cbc8bfc60ca7069b6a9e4b83", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b9463517addc5113cbc8bfc60ca7069b6a9e4b83", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into feature/odbc/pbi", "committedDate": "2020-07-23T20:07:00Z", "type": "commit"}, {"oid": "2bd944c759017fb4c6666d08eae676d1e3a988ea", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2bd944c759017fb4c6666d08eae676d1e3a988ea", "message": "- remove sqlgetinfo & sqlcapabilities values from connector", "committedDate": "2020-07-24T20:09:56Z", "type": "commit"}, {"oid": "ed0afb91caaf7daa2e14c71f9ed8ee636969932b", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ed0afb91caaf7daa2e14c71f9ed8ee636969932b", "message": "adding EncryptedConnectionString", "committedDate": "2020-07-24T21:20:35Z", "type": "commit"}, {"oid": "22dc963da1d58323df93640564c37102816d4aa6", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/22dc963da1d58323df93640564c37102816d4aa6", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into feature/odbc/pbi", "committedDate": "2020-07-28T04:49:07Z", "type": "commit"}, {"oid": "82e9a728bfbb17876121a65e4c46d0018c4d8bc1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/82e9a728bfbb17876121a65e4c46d0018c4d8bc1", "message": "add data type for columns", "committedDate": "2020-07-28T17:45:59Z", "type": "commit"}, {"oid": "5022f1f01577b4d31fe2a8b57c4a4f06e571feb0", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5022f1f01577b4d31fe2a8b57c4a4f06e571feb0", "message": "add alternate column size", "committedDate": "2020-07-28T19:36:07Z", "type": "commit"}, {"oid": "f4c706876421ea82de028bf88e79ea42411e996e", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f4c706876421ea82de028bf88e79ea42411e996e", "message": "reverting changes in catalog test", "committedDate": "2020-07-28T19:40:56Z", "type": "commit"}, {"oid": "a76c382c3ead0ef192ed15ba8c37bb32acd0e843", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a76c382c3ead0ef192ed15ba8c37bb32acd0e843", "message": "nit", "committedDate": "2020-07-28T19:47:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MjcxMA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461842710", "bodyText": "Why is this?", "author": "kylepbit", "createdAt": "2020-07-28T20:01:55Z", "path": "sql-odbc/src/IntegrationTests/ITODBCResults/test_odbc_results.cpp", "diffHunk": "@@ -936,7 +937,9 @@ TEST_F(TestSQLDescribeCol, SingleColumnMetadata) {\n     EXPECT_EQ(single_col, m_column_name);\n     EXPECT_EQ(single_col_name_length, m_column_name_length);\n     EXPECT_EQ(single_col_data_type, m_data_type);\n-    EXPECT_EQ(single_col_column_size, m_column_size);\n+    // Value changes according to pagination setup on server", "originalCommit": "a76c382c3ead0ef192ed15ba8c37bb32acd0e843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg5NTAzNQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461895035", "bodyText": "Not sure why. Created an issue #628 to investigate this further since I got one another value as 23 for server 1.9.0.\nWill revert changes in this PR and handle this separately as it's not a blocker for fixing the data loading issue in Power BI.", "author": "rupal-bq", "createdAt": "2020-07-28T21:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MjcxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MzA3OQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461843079", "bodyText": "Should we just report the extra columns regardless?", "author": "kylepbit", "createdAt": "2020-07-28T20:02:38Z", "path": "sql-odbc/src/odfesqlodbc/es_info.cpp", "diffHunk": "@@ -476,8 +492,28 @@ void SetTableTuples(QResultClass *res, const TableResultSet res_type,\n         // information for its Data Preview window.\n         std::string catalog(\"\");\n         bind_tbl[TABLES_CATALOG_NAME]->UpdateData((void *)catalog.c_str(), 0);\n-        for (size_t i = 0; i < binds.size(); i++)\n-            binds[i]->AssignData(&tuple[i]);\n+\n+        for (size_t i = 0; i < binds.size(); i++) {\n+            // Add tuples for SQLColumns\n+            if (binds.size() > COLUMNS_SQL_DATA_TYPE) {", "originalCommit": "a76c382c3ead0ef192ed15ba8c37bb32acd0e843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg3Mjk3Nw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461872977", "bodyText": "The same method is used while adding tuples for SQLTables as well. SQLTables has only 5 columns whereas SQLColumns has 18.\nSo this check ensures that the data type column is updated for SQLColumns only. If we remove this check then we get Memory Corruption since SQLTables will try to access column which doesn't exist.", "author": "rupal-bq", "createdAt": "2020-07-28T20:55:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MzA3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1NDUwNQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461954505", "bodyText": "Almost wondering if it would be worth it to split some of this logic up, now that we're handling special cases for SQLTables & SQLColumns", "author": "jordanw-bq", "createdAt": "2020-07-28T23:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MzA3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MzA0OQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461983049", "bodyText": "Created issue #630 to revisit the logic of assigning data for SQLTables & SQLColumns", "author": "rupal-bq", "createdAt": "2020-07-29T01:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MzA3OQ=="}], "type": "inlineReview"}, {"oid": "debe0c5bce13bc52a69a6e1e05fdc7faa91d9a19", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/debe0c5bce13bc52a69a6e1e05fdc7faa91d9a19", "message": "revert changes for column size validation", "committedDate": "2020-07-28T21:42:06Z", "type": "commit"}, {"oid": "6add9da5949e1816b5174e13285d3ebb4f204a50", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6add9da5949e1816b5174e13285d3ebb4f204a50", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into feature/odbc/pbi", "committedDate": "2020-07-28T21:50:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxMTgxMg==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461911812", "bodyText": "Can we use SQL type contstants here instead? (eg. SQLWVARCHAR)", "author": "jordanw-bq", "createdAt": "2020-07-28T22:00:11Z", "path": "sql-odbc/src/IntegrationTests/ITODBCCatalog/test_odbc_catalog.cpp", "diffHunk": "@@ -85,6 +85,9 @@ const std::vector< std::string > flights_data_type = {\n     \"float\",   \"keyword\", \"integer\", \"keyword\", \"keyword\", \"keyword\", \"date\",\n     \"keyword\", \"keyword\", \"boolean\", \"float\",   \"keyword\", \"keyword\", \"keyword\",\n     \"keyword\", \"keyword\", \"keyword\", \"keyword\"};\n+const std::vector< short > flights_sql_data_type = {", "originalCommit": "6add9da5949e1816b5174e13285d3ebb4f204a50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4Mjg1Mw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461982853", "bodyText": "added", "author": "rupal-bq", "createdAt": "2020-07-29T01:21:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxMTgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1NDA2Ng==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461954066", "bodyText": "Already included on L22 (might need to expand GH code preview)", "author": "jordanw-bq", "createdAt": "2020-07-28T23:39:04Z", "path": "sql-odbc/src/odfesqlodbc/es_parse_result.cpp", "diffHunk": "@@ -29,6 +29,7 @@\n #pragma clang diagnostic pop\n #endif  // __APPLE__\n #include \"statement.h\"\n+#include \"es_types.h\"", "originalCommit": "6add9da5949e1816b5174e13285d3ebb4f204a50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MzE2NQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/627#discussion_r461983165", "bodyText": "removed", "author": "rupal-bq", "createdAt": "2020-07-29T01:22:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1NDA2Ng=="}], "type": "inlineReview"}, {"oid": "a80eee8edfbff508293818db621eb8dd7c704ad8", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a80eee8edfbff508293818db621eb8dd7c704ad8", "message": "address PR comments", "committedDate": "2020-07-29T01:20:24Z", "type": "commit"}]}