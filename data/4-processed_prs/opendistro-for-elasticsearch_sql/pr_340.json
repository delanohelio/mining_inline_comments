{"pr_number": 340, "pr_title": "Fix the issue in semantic analyzer.", "pr_createdAt": "2020-01-10T18:31:10Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/340", "timeline": [{"oid": "21de61827f4237100bebf11596aa6e4d6e17429d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/21de61827f4237100bebf11596aa6e4d6e17429d", "message": "Fix the issue in sematic analyaer\n1. Change the return Type of the LOG function.\n2. Add the support of CAST function.", "committedDate": "2020-01-10T18:27:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ2Nzk2Ng==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/340#discussion_r365467966", "bodyText": "David's PR reminds me that some type in convertedDataType doesn't have corresponding type in ESDateType, such as DATETIME and INT. Could you verify if it's an issue or not? I guess UNKNOWN is returned in this case. It is fine for type checking but it may be not what you expect.", "author": "dai-chen", "createdAt": "2020-01-10T23:19:12Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/sql/antlr/semantic/visitor/TypeChecker.java", "diffHunk": "@@ -173,6 +173,11 @@ public Type visitNull() {\n         return UNKNOWN;\n     }\n \n+    @Override\n+    public Type visitConvertedType(String text) {\n+        return ESDataType.typeOf(text);", "originalCommit": "21de61827f4237100bebf11596aa6e4d6e17429d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkyMDI4Nw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/340#discussion_r365920287", "bodyText": "Sure, I will add the default type for UNKNOWN use cases when applying the return type.", "author": "penghuo", "createdAt": "2020-01-13T17:07:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ2Nzk2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3OTE2NA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/340#discussion_r365479164", "bodyText": "is there a need for test cases going the other way around (e.g assertEquals(LONG, LOG.construct(singletonList(DOUBLE))) ?", "author": "davidcui1225", "createdAt": "2020-01-11T00:21:02Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/sql/antlr/semantic/types/GenericTypeTest.java", "diffHunk": "@@ -34,17 +35,17 @@\n \n     @Test\n     public void passNumberArgToLogShouldReturnNumber() {\n-        assertEquals(NUMBER, LOG.construct(singletonList(NUMBER)));\n+        assertEquals(DOUBLE, LOG.construct(singletonList(NUMBER)));\n     }\n \n     @Test\n     public void passIntegerArgToLogShouldReturnInteger() {\n-        assertEquals(INTEGER, LOG.construct(singletonList(INTEGER)));\n+        assertEquals(DOUBLE, LOG.construct(singletonList(INTEGER)));\n     }\n \n     @Test\n     public void passLongArgToLogShouldReturnLong() {\n-        assertEquals(LONG, LOG.construct(singletonList(LONG)));\n+        assertEquals(DOUBLE, LOG.construct(singletonList(LONG)));\n     }", "originalCommit": "21de61827f4237100bebf11596aa6e4d6e17429d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkyMzA0OQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/340#discussion_r365923049", "bodyText": "Done. Change the test case name to passLongArgToLogShouldReturnDouble.", "author": "penghuo", "createdAt": "2020-01-13T17:13:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3OTE2NA=="}], "type": "inlineReview"}, {"oid": "3fe1bed4724c2c40954fe14589c09e0f28a6a558", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3fe1bed4724c2c40954fe14589c09e0f28a6a558", "message": "update", "committedDate": "2020-01-13T17:20:57Z", "type": "commit"}]}