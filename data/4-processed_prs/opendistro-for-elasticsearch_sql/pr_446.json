{"pr_number": 446, "pr_title": "[BugFix] mock LocalClusterState settings in QueryPlanner base test class", "pr_createdAt": "2020-04-29T00:38:17Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/446", "timeline": [{"oid": "3bc9af4baba20ea84f573d911adbba043c6f60bc", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3bc9af4baba20ea84f573d911adbba043c6f60bc", "message": "[BugFix] mock LocalClusterState settings in QueryPlanner base class", "committedDate": "2020-04-29T00:06:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMTE4Mg==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/446#discussion_r417011182", "bodyText": "Why are we stubbing getSettings() method - is it being used anywhere?", "author": "abbashus", "createdAt": "2020-04-29T00:53:46Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/sql/unittest/planner/QueryPlannerTest.java", "diffHunk": "@@ -110,6 +114,12 @@ public static void initLogger() {\n     public void init() {\n         MockitoAnnotations.initMocks(this);\n \n+        SqlSettings settings = spy(new SqlSettings());\n+        // Force return empty list to avoid ClusterSettings be invoked which is a final class and hard to mock.\n+        // In this case, default value in Setting will be returned all the time.\n+        doReturn(emptyList()).when(settings).getSettings();", "originalCommit": "3bc9af4baba20ea84f573d911adbba043c6f60bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMjQ2OA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/446#discussion_r417012468", "bodyText": "It's used in setSettings() here. \n  \n    \n      sql/src/main/java/com/amazon/opendistroforelasticsearch/sql/esdomain/LocalClusterState.java\n    \n    \n         Line 125\n      in\n      7c57d72\n    \n    \n    \n    \n\n        \n          \n           for (Setting<?> setting : sqlSettings.getSettings()) {", "author": "zhongnansu", "createdAt": "2020-04-29T00:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMTE4Mg=="}], "type": "inlineReview"}]}