{"pr_number": 373, "pr_title": "UI change for assebmly details and Patternfly/React upgrade", "pr_createdAt": "2020-08-18T20:20:52Z", "pr_url": "https://github.com/redhataccess/pantheon/pull/373", "timeline": [{"oid": "8e0af78b0e22782aa8fc26a6aef110dc752774e5", "url": "https://github.com/redhataccess/pantheon/commit/8e0af78b0e22782aa8fc26a6aef110dc752774e5", "message": "update headers", "committedDate": "2020-08-06T20:02:18Z", "type": "commit"}, {"oid": "ff138302f0a056b0ea40ebd7568a8189925af92b", "url": "https://github.com/redhataccess/pantheon/commit/ff138302f0a056b0ea40ebd7568a8189925af92b", "message": "upgrade patternfly to the latest", "committedDate": "2020-08-11T13:20:27Z", "type": "commit"}, {"oid": "246a8c98f75f5f98a4e91577aff438982edff67c", "url": "https://github.com/redhataccess/pantheon/commit/246a8c98f75f5f98a4e91577aff438982edff67c", "message": "remove datalist", "committedDate": "2020-08-12T13:26:20Z", "type": "commit"}, {"oid": "88e73c111736f65e07962bbf0a1857c0a662052b", "url": "https://github.com/redhataccess/pantheon/commit/88e73c111736f65e07962bbf0a1857c0a662052b", "message": "merge with master", "committedDate": "2020-08-12T21:13:37Z", "type": "commit"}, {"oid": "8f3b9e94514cd07a6800a156007a8df359c78c37", "url": "https://github.com/redhataccess/pantheon/commit/8f3b9e94514cd07a6800a156007a8df359c78c37", "message": "ensure html is rerendered", "committedDate": "2020-08-12T21:16:38Z", "type": "commit"}, {"oid": "f13a8d26e2bbe0047fa0a5775134ad8c9065eeef", "url": "https://github.com/redhataccess/pantheon/commit/f13a8d26e2bbe0047fa0a5775134ad8c9065eeef", "message": "update module display", "committedDate": "2020-08-17T13:46:35Z", "type": "commit"}, {"oid": "3b6da851d6efec4021bf5a6eabf985d3cd484107", "url": "https://github.com/redhataccess/pantheon/commit/3b6da851d6efec4021bf5a6eabf985d3cd484107", "message": "fix nav", "committedDate": "2020-08-17T15:55:15Z", "type": "commit"}, {"oid": "1e8bd7a26f31cac41c9b7a284e2dd53ca042e838", "url": "https://github.com/redhataccess/pantheon/commit/1e8bd7a26f31cac41c9b7a284e2dd53ca042e838", "message": "Merge branch 'master' of github.com:redhataccess/pantheon into CCS-3663-assebmly_details", "committedDate": "2020-08-17T15:55:28Z", "type": "commit"}, {"oid": "f836094d0de215a5f3c2563576bbe725b0733883", "url": "https://github.com/redhataccess/pantheon/commit/f836094d0de215a5f3c2563576bbe725b0733883", "message": "add handlePublishButton logic", "committedDate": "2020-08-17T21:18:59Z", "type": "commit"}, {"oid": "721373b09ae00043caa89e656df611bdbe1654d7", "url": "https://github.com/redhataccess/pantheon/commit/721373b09ae00043caa89e656df611bdbe1654d7", "message": "update tests", "committedDate": "2020-08-18T19:41:44Z", "type": "commit"}, {"oid": "b1d6f4e25ab1de19b851bcda65a15307e11fc2de", "url": "https://github.com/redhataccess/pantheon/commit/b1d6f4e25ab1de19b851bcda65a15307e11fc2de", "message": "remove unused tests", "committedDate": "2020-08-18T19:43:32Z", "type": "commit"}, {"oid": "ceaa98c964535510666dffde7c7c581821be0f11", "url": "https://github.com/redhataccess/pantheon/commit/ceaa98c964535510666dffde7c7c581821be0f11", "message": "fix failed tests after patternfly upgrade", "committedDate": "2020-08-18T19:51:21Z", "type": "commit"}, {"oid": "f717a7a3cb50805fdf8010d99e8b57ebebdf64df", "url": "https://github.com/redhataccess/pantheon/commit/f717a7a3cb50805fdf8010d99e8b57ebebdf64df", "message": "remove unused files", "committedDate": "2020-08-18T19:54:11Z", "type": "commit"}, {"oid": "9d9229868ae8a3fd55b9cdac33080c0169aec647", "url": "https://github.com/redhataccess/pantheon/commit/9d9229868ae8a3fd55b9cdac33080c0169aec647", "message": "fix searchfilter", "committedDate": "2020-08-18T21:04:37Z", "type": "commit"}, {"oid": "d27b6eaea85d25eb9be0c09370ebc4a8853fe45f", "url": "https://github.com/redhataccess/pantheon/commit/d27b6eaea85d25eb9be0c09370ebc4a8853fe45f", "message": "add comments to css", "committedDate": "2020-08-18T21:20:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMjA1Mg==", "url": "https://github.com/redhataccess/pantheon/pull/373#discussion_r473202052", "bodyText": "Tagging this at the bottom, but this entire file looks substantially similar to the assemblyDisplay.tsx file. Can we combine them to reduce duplication?", "author": "benradey", "createdAt": "2020-08-19T17:25:08Z", "path": "pantheon-bundle/frontend/src/app/moduleDisplay.tsx", "diffHunk": "@@ -335,6 +360,31 @@ class ModuleDisplay extends Component<any, any, any> {\n         }\n     }\n \n+    private fetchAttributesFilePath = async (data) => {\n+        await this.getVariantParam()\n+        const path = data.location.pathname.substring(PathPrefixes.MODULE_PATH_PREFIX.length)\n+        // console.log(\"[fetchAttributesFilePath] path =>\", path)\n+        let repo = ''\n+        const group = path.split(\"/\")\n+        repo = group[2]\n+        fetch('/content/repositories/' + repo + '/module_variants/' + this.state.variant + '.harray.json')\n+            .then((response) => {\n+                if (response.ok) {\n+                    return response.json()\n+                } else {\n+                    throw new Error(response.statusText)\n+                }\n+            })\n+            .then(responseJSON => {\n+                if (responseJSON[\"pant:attributesFilePath\"] !== undefined) {\n+                    this.setState({ attributesFilePath: responseJSON[\"pant:attributesFilePath\"] })\n+                }\n+            })\n+            .catch((error) => {\n+                console.log(error)\n+            })\n+    }\n+", "originalCommit": "d27b6eaea85d25eb9be0c09370ebc4a8853fe45f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MzU0OQ==", "url": "https://github.com/redhataccess/pantheon/pull/373#discussion_r473263549", "bodyText": "I agree we can use a shared component for assemblyDisplay and moduleDisplay. I would like it to be a separate ticket.  This is just the initial work of introducing assembly on the UI.", "author": "xdavidson", "createdAt": "2020-08-19T19:18:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMjA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI3NzgzNA==", "url": "https://github.com/redhataccess/pantheon/pull/373#discussion_r473277834", "bodyText": "Ok, we'll agree that this is tech debt and we'll bring in this PR as-is.", "author": "benradey", "createdAt": "2020-08-19T19:46:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMjA1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMzQ0Mg==", "url": "https://github.com/redhataccess/pantheon/pull/373#discussion_r473203442", "bodyText": "It looks like you've commented out this entire file. Was that intentional? Will the commented code be coming back at some point?\nIIRC, versions.tsx is responsible for displaying most of the document details pages. I would guess that you've reworked most of that and that the old tests are now obsolete. If that's true, please remove them rather than commenting them.", "author": "benradey", "createdAt": "2020-08-19T17:27:43Z", "path": "pantheon-bundle/frontend/src/app/versions.test.tsx", "diffHunk": "@@ -304,39 +283,39 @@ describe('Versions tests', () => {\n         expect(state.versionModulePath).toEqual('versionPath')\n     })\n \n-    test('changePublishState click', () => {\n-        const wrapper = mount(<Versions {...props} />)\n-        const instance = wrapper.instance()\n-        wrapper.setState({ 'login': true })\n-        wrapper.setState({\n-            'results': [[{ \"type\": \"draft\", \"icon\": \"BlankImage\", \"path\": \"/modules/test\", \"version\": \"Version 1\", \"publishedState\": 'Not published', \"updatedDate\": \"\", \"firstButtonType\": 'primary', \"secondButtonType\": 'secondary', \"firstButtonText\": 'Publish', \"secondButtonText\": 'Preview', \"isDropdownOpen\": false, \"isArchiveDropDownOpen\": false, \"metadata\": '' }]],\n-        })\n-        const spy = sinon.spy(instance, 'changePublishState')\n-        wrapper.find(Button).at(2).simulate('click')\n-        sinon.assert.called(spy)\n-    })\n-\n-    it('test fetchProducts function', () => {\n-        const wrapper = renderer.create(<Versions {...props} />)\n-        const inst = wrapper.getInstance()\n-        const spy = sinon.spy(inst, 'fetchProducts')\n-        inst.componentDidMount()\n-        sinon.assert.called(spy)\n-    })\n-\n-    it('test fetchVersions function', () => {\n-        const wrapper = renderer.create(<Versions {...props} />)\n-        const inst = wrapper.getInstance()\n-        const spy = sinon.spy(inst, 'fetchVersions')\n-        inst.fetchVersions()\n-        sinon.assert.called(spy)\n-    })\n-\n-    it('test changePublishState function', () => {\n-        const wrapper = renderer.create(<Versions {...props} />)\n-        const inst = wrapper.getInstance()\n-        const spy = sinon.spy(inst, 'changePublishState')\n-        inst.changePublishState(\"ds\")\n-        sinon.assert.called(spy)\n-    })\n+    // test('changePublishState click', () => {\n+    //     const wrapper = mount(<Versions {...props} />)\n+    //     const instance = wrapper.instance()\n+    //     wrapper.setState({ 'login': true })\n+    //     wrapper.setState({\n+    //         'results': [[{ \"type\": \"draft\", \"icon\": \"BlankImage\", \"path\": \"/modules/test\", \"version\": \"Version 1\", \"publishedState\": 'Not published', \"updatedDate\": \"\", \"firstButtonType\": 'primary', \"secondButtonType\": 'secondary', \"firstButtonText\": 'Publish', \"secondButtonText\": 'Preview', \"isDropdownOpen\": false, \"isArchiveDropDownOpen\": false, \"metadata\": '' }]],\n+    //     })\n+    //     const spy = sinon.spy(instance, 'changePublishState')\n+    //     wrapper.find(Button).at(2).simulate('click')\n+    //     sinon.assert.called(spy)\n+    // })\n+\n+    // it('test fetchProducts function', () => {\n+    //     const wrapper = renderer.create(<Versions {...props} />)\n+    //     const inst = wrapper.getInstance()\n+    //     const spy = sinon.spy(inst, 'fetchProducts')\n+    //     inst.componentDidMount()\n+    //     sinon.assert.called(spy)\n+    // })\n+\n+    // it('test fetchVersions function', () => {\n+    //     const wrapper = renderer.create(<Versions {...props} />)\n+    //     const inst = wrapper.getInstance()\n+    //     const spy = sinon.spy(inst, 'fetchVersions')\n+    //     inst.fetchVersions()\n+    //     sinon.assert.called(spy)\n+    // })\n+\n+    // it('test changePublishState function', () => {\n+    //     const wrapper = renderer.create(<Versions {...props} />)\n+    //     const inst = wrapper.getInstance()\n+    //     const spy = sinon.spy(inst, 'changePublishState')\n+    //     inst.changePublishState(\"ds\")\n+    //     sinon.assert.called(spy)\n+    // })", "originalCommit": "d27b6eaea85d25eb9be0c09370ebc4a8853fe45f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MTU0OQ==", "url": "https://github.com/redhataccess/pantheon/pull/373#discussion_r473261549", "bodyText": "versions.test.tsx has been updated.", "author": "xdavidson", "createdAt": "2020-08-19T19:14:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMzQ0Mg=="}], "type": "inlineReview"}, {"oid": "314539c0585de64a05148d3e035844caa06bd9db", "url": "https://github.com/redhataccess/pantheon/commit/314539c0585de64a05148d3e035844caa06bd9db", "message": "fix versions tests", "committedDate": "2020-08-19T19:13:34Z", "type": "commit"}]}