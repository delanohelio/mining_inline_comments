{"pr_number": 253, "pr_title": "Ccs 3469 uploader", "pr_createdAt": "2020-03-17T21:32:19Z", "pr_url": "https://github.com/redhataccess/pantheon/pull/253", "timeline": [{"oid": "3deb7e6e660e5d0dc4e7f62bf80bb87c925a79c4", "url": "https://github.com/redhataccess/pantheon/commit/3deb7e6e660e5d0dc4e7f62bf80bb87c925a79c4", "message": "add new node type pant:bucket", "committedDate": "2020-03-17T19:48:51Z", "type": "commit"}, {"oid": "c137b1e08b91cf75d82d5995e84270df6805d19b", "url": "https://github.com/redhataccess/pantheon/commit/c137b1e08b91cf75d82d5995e84270df6805d19b", "message": "process bucket name", "committedDate": "2020-03-17T21:15:47Z", "type": "commit"}, {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "url": "https://github.com/redhataccess/pantheon/commit/9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "message": "update node type", "committedDate": "2020-03-17T21:29:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2MDA4Ng==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394360086", "bodyText": "Is camel-casing the right standard for yaml files?\nAlso, are you envisioning this as an attributes' file for the whole repository? or just modules? If the latter, I would consider naming this something like moduleAttributesFile", "author": "carlosmunoz", "createdAt": "2020-03-18T13:50:51Z", "path": "uploader/pantheon.py", "diffHunk": "@@ -108,6 +123,7 @@ def _print_response(filetype, path, response_code, reason):\n \n server: http://localhost:8080\n repository: pantheonSampleRepo\n+attributeFile: path/to/attribute.adoc", "originalCommit": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1NDI0Mw==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394454243", "bodyText": "camelCase is the right standard for everything. :)", "author": "benradey", "createdAt": "2020-03-18T15:53:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2MDA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxODc5MQ==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394518791", "bodyText": "kubernetes use camelCase:\nhttps://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/\nansible uses snake_case:\nhttps://github.com/ansible/ansible-examples/blob/master/lamp_simple/site.yml", "author": "xdavidson", "createdAt": "2020-03-18T17:26:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2MDA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyMTg4Mw==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394521883", "bodyText": "@carlosmunoz i'm envisioning it as an attribute fiel for the whole repository.", "author": "xdavidson", "createdAt": "2020-03-18T17:31:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2MDA4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1MzIxNQ==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394453215", "bodyText": "I asked earlier in our QA call but I'll ask here so it's recorded - why is creating this new type necessary?", "author": "benradey", "createdAt": "2020-03-18T15:52:33Z", "path": "pantheon-bundle/src/main/resources/SLING-INF/nodetypes/nodetypes.cnd", "diffHunk": "@@ -57,6 +57,8 @@\n [pant:symlink] > nt:unstructured\n     - sling:resourceType (string) = 'pantheon/symlink' mandatory autocreated\n \n+[pant:bucket] > nt:unstructured, mix:created, mix:lastModified\n+    - sling:resourceType (string) = 'pantheon/bucket' mandatory autocreated", "originalCommit": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyMDE3OA==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394520178", "bodyText": "The node defines with this new type has a special purpose. for instance, it's a repository level node. It may contain a standaloneAttributeFile for the repository.", "author": "xdavidson", "createdAt": "2020-03-18T17:28:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1MzIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1NTIxOQ==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394455219", "bodyText": "Is this part of some doc syntax that I'm not familiar with? Otherwise, it looks like these lines are unnecessary, since you describe the method above.", "author": "benradey", "createdAt": "2020-03-18T15:54:58Z", "path": "uploader/pantheon.py", "diffHunk": "@@ -180,6 +197,9 @@ def process_file(path, filetype):\n \n     Returns:\n     list: It returns a list with value of the API call status_code and reason\n+    :param path:\n+    :param filetype:\n+    :return:", "originalCommit": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyMTQyMA==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394521420", "bodyText": "those were generated by my editor. i will move those", "author": "xdavidson", "createdAt": "2020-03-18T17:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1NTIxOQ=="}], "type": "inlineReview"}, {"oid": "6339c75deaaa0ab389a6c93783fb4426d09beddc", "url": "https://github.com/redhataccess/pantheon/commit/6339c75deaaa0ab389a6c93783fb4426d09beddc", "message": "code clean up", "committedDate": "2020-03-18T17:32:19Z", "type": "commit"}, {"oid": "1535ee64df67ee4870f8c1baf5eb29ebbe1890ee", "url": "https://github.com/redhataccess/pantheon/commit/1535ee64df67ee4870f8c1baf5eb29ebbe1890ee", "message": "remove pant:bucket node definition per team feedback", "committedDate": "2020-03-18T19:02:33Z", "type": "commit"}, {"oid": "1a5798d1d2c606c22769701706d0ed2139e9019d", "url": "https://github.com/redhataccess/pantheon/commit/1a5798d1d2c606c22769701706d0ed2139e9019d", "message": "Use attributeFile to build adoc if it is available.", "committedDate": "2020-03-19T16:26:00Z", "type": "commit"}, {"oid": "2a705471ba46caf76c014e4ac83888af64f304da", "url": "https://github.com/redhataccess/pantheon/commit/2a705471ba46caf76c014e4ac83888af64f304da", "message": "update logic for multi repo", "committedDate": "2020-03-19T17:44:30Z", "type": "commit"}, {"oid": "5212db03ea23e8bb079f25dcdc07264999cad78b", "url": "https://github.com/redhataccess/pantheon/commit/5212db03ea23e8bb079f25dcdc07264999cad78b", "message": "rename attribute property", "committedDate": "2020-03-19T17:45:45Z", "type": "commit"}, {"oid": "02a6cb96ab4cd330cad302505136a0123bc001a0", "url": "https://github.com/redhataccess/pantheon/commit/02a6cb96ab4cd330cad302505136a0123bc001a0", "message": "add logic to handle multi repositories", "committedDate": "2020-03-19T20:37:04Z", "type": "commit"}, {"oid": "f7d83a68b2a1d8c1b8a2b7fb83efcabab33ea9dc", "url": "https://github.com/redhataccess/pantheon/commit/f7d83a68b2a1d8c1b8a2b7fb83efcabab33ea9dc", "message": "Merge branch 'CCS-3469_uploader_multirepo' into CCS-3469_uploader", "committedDate": "2020-03-19T20:37:47Z", "type": "commit"}, {"oid": "e1923bea664e1f7d7e4e39e674f4641732faf76e", "url": "https://github.com/redhataccess/pantheon/commit/e1923bea664e1f7d7e4e39e674f4641732faf76e", "message": "rename pant:bucket to pant:workspace", "committedDate": "2020-03-20T14:39:10Z", "type": "commit"}, {"oid": "729ef78e85e4404818574f45425ad099df182041", "url": "https://github.com/redhataccess/pantheon/commit/729ef78e85e4404818574f45425ad099df182041", "message": "add back primaryType", "committedDate": "2020-03-20T14:55:17Z", "type": "commit"}, {"oid": "5bb3d76c5967db88ee60783c5648f9401e53cfe2", "url": "https://github.com/redhataccess/pantheon/commit/5bb3d76c5967db88ee60783c5648f9401e53cfe2", "message": "Model updated", "committedDate": "2020-03-20T14:58:22Z", "type": "commit"}, {"oid": "b1026dbc3894072d54faff48e9f8a139097c697c", "url": "https://github.com/redhataccess/pantheon/commit/b1026dbc3894072d54faff48e9f8a139097c697c", "message": "Merge branch 'CCS-3469_uploader' into benHacks", "committedDate": "2020-03-20T14:58:57Z", "type": "commit"}, {"oid": "29a5c483282055d23670b69f110ddae62a1e0102", "url": "https://github.com/redhataccess/pantheon/commit/29a5c483282055d23670b69f110ddae62a1e0102", "message": "add referenceable for future needs", "committedDate": "2020-03-20T15:12:31Z", "type": "commit"}, {"oid": "15e88e10312f35a8ea2b35eeba8b2554f8c9590e", "url": "https://github.com/redhataccess/pantheon/commit/15e88e10312f35a8ea2b35eeba8b2554f8c9590e", "message": "rename bucket to workspace", "committedDate": "2020-03-20T15:20:23Z", "type": "commit"}, {"oid": "04abc6b07dd75f1f67e9d10c91757763a0511c56", "url": "https://github.com/redhataccess/pantheon/commit/04abc6b07dd75f1f67e9d10c91757763a0511c56", "message": "Working code, broken test", "committedDate": "2020-03-20T15:28:46Z", "type": "commit"}, {"oid": "ac46f95c3589dc22f6fd9e32b20d99e72b0e4ad7", "url": "https://github.com/redhataccess/pantheon/commit/ac46f95c3589dc22f6fd9e32b20d99e72b0e4ad7", "message": "removed printlns, working tests", "committedDate": "2020-03-20T15:38:21Z", "type": "commit"}, {"oid": "ea648895119934276c047049dbf9bcfbc77a3bb7", "url": "https://github.com/redhataccess/pantheon/commit/ea648895119934276c047049dbf9bcfbc77a3bb7", "message": "Merge pull request #4 from benradey/benHacks\n\nBen hacks", "committedDate": "2020-03-20T15:41:38Z", "type": "commit"}, {"oid": "3643e9de6dedff26720fadb4f1c8601df4483870", "url": "https://github.com/redhataccess/pantheon/commit/3643e9de6dedff26720fadb4f1c8601df4483870", "message": "Add workspace model", "committedDate": "2020-03-20T18:29:32Z", "type": "commit"}, {"oid": "e7e776d5b36004b7fd8ff7e45c2e754c44eae084", "url": "https://github.com/redhataccess/pantheon/commit/e7e776d5b36004b7fd8ff7e45c2e754c44eae084", "message": "use the Workspace.class", "committedDate": "2020-03-23T18:03:22Z", "type": "commit"}, {"oid": "be410a4f6da3c1858e367ef39f114a26ad858e05", "url": "https://github.com/redhataccess/pantheon/commit/be410a4f6da3c1858e367ef39f114a26ad858e05", "message": "Merge pull request #5 from jmarrero/CCS-3468b\n\nUpdates to include Workspace model", "committedDate": "2020-03-23T18:05:13Z", "type": "commit"}, {"oid": "8cc53d5bccce97fc626477cc5b72c746d44ba981", "url": "https://github.com/redhataccess/pantheon/commit/8cc53d5bccce97fc626477cc5b72c746d44ba981", "message": "Tweaks made and tests pass", "committedDate": "2020-03-23T20:52:59Z", "type": "commit"}, {"oid": "14eb808731335b35bbeb43ba50348908473e1c92", "url": "https://github.com/redhataccess/pantheon/commit/14eb808731335b35bbeb43ba50348908473e1c92", "message": "Merge pull request #6 from benradey/modelUsageTweak\n\nTweaks made and tests pass", "committedDate": "2020-03-23T21:04:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NjkxNA==", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r396776914", "bodyText": "Since process_workspace is the method that creates the pant:workspace jcr node, this should run regardless of the presence of any attributeFile.", "author": "benradey", "createdAt": "2020-03-23T21:48:06Z", "path": "uploader/pantheon.py", "diffHunk": "@@ -325,27 +354,58 @@ def processRegexMatches(files, globs, filetype):\n     sys.exit('server ' + server + ' is not reachable')\n \n _info('Using server: ' + server)\n-_info('Using ' + mode + ': ' + repository)\n-print('--------------')\n-\n-moduleGlobs = readYamlGlob(config, 'modules')\n-resourceGlobs = readYamlGlob(config, 'resources')\n-non_resource_files = []\n-logger.debug('moduleGlobs: %s', moduleGlobs)\n-logger.debug('resourceGlobs: %s', resourceGlobs)\n-logger.debug('args.directory: %s', args.directory)\n-\n-# List all files in the directory\n-allFiles = []\n-listdir_recursive(args.directory, allFiles)\n-\n-processRegexMatches(allFiles, resourceGlobs, 'resources')\n-processRegexMatches(allFiles, moduleGlobs, 'modules')\n-\n-leftoverFiles = len(allFiles)\n-if leftoverFiles > 0:\n-    _warn(f'{leftoverFiles} additional files detected but not uploaded. Only files specified in '\n-          + CONFIG_FILE\n-          + ' are handled for upload.')\n+\n+if len(config.keys()) > 0 and 'repositories' in config:\n+    for repo_list in config['repositories']:\n+        repository = resolveOption(args.repository, '', repo_list['name'])\n+        # Enforce a repository being set in the pantheon.yml\n+        if repository == \"\" and mode == 'repository':\n+            sys.exit('repository is not set')\n+\n+        mode = 'sandbox' if args.sandbox else 'repository'\n+        # override repository if sandbox is chosen (sandbox name is the user name)\n+        if args.sandbox:\n+            repository = args.user\n+\n+        if 'attributes' in repo_list:\n+            attributeFile = resolveOption(args.attrFile, '', repo_list['attributes'])\n+        else:\n+            attributeFile = resolveOption(args.attrFile, '', '')\n+\n+        if attributeFile and not os.path.isfile(attributeFile.strip()):\n+            sys.exit('attributes: ' + attributeFile + ' does not exist.')\n+\n+        _info('Using ' + mode + ': ' + repository)\n+        _info('Using attributes: ' + attributeFile)\n+        print('--------------')\n+\n+        if attributeFile:\n+            process_workspace(repository)", "originalCommit": "14eb808731335b35bbeb43ba50348908473e1c92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0f94389abf7f74f1d3f0d4f0e0f02a5ba44226d7", "url": "https://github.com/redhataccess/pantheon/commit/0f94389abf7f74f1d3f0d4f0e0f02a5ba44226d7", "message": "Make sure that the full path to the attrFile is used when building the module.", "committedDate": "2020-03-24T18:15:03Z", "type": "commit"}, {"oid": "f803541cf0a5cd7c34252d53f8006b771f9da553", "url": "https://github.com/redhataccess/pantheon/commit/f803541cf0a5cd7c34252d53f8006b771f9da553", "message": "Merge pull request #7 from jmarrero/CCS-3468c\n\nUse the full path to the attributeFile when building the module.", "committedDate": "2020-03-24T18:17:40Z", "type": "commit"}, {"oid": "7827dbf24e9dd6d15ed8c51b1268b57de26ade58", "url": "https://github.com/redhataccess/pantheon/commit/7827dbf24e9dd6d15ed8c51b1268b57de26ade58", "message": "bug fix around attributes", "committedDate": "2020-03-24T18:31:59Z", "type": "commit"}, {"oid": "439535829e5dcc7c4e34ee06fa00cd1de5aa2016", "url": "https://github.com/redhataccess/pantheon/commit/439535829e5dcc7c4e34ee06fa00cd1de5aa2016", "message": "remove debugging lines", "committedDate": "2020-03-24T18:36:04Z", "type": "commit"}]}