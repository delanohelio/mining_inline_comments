{"pr_number": 10549, "pr_title": "Deprecate the overhead circuit breaker setting", "pr_createdAt": "2020-09-16T14:24:03Z", "pr_url": "https://github.com/crate/crate/pull/10549", "timeline": [{"oid": "34ea50862fc5c3ec7eb4cd310ef46b64f019485e", "url": "https://github.com/crate/crate/commit/34ea50862fc5c3ec7eb4cd310ef46b64f019485e", "message": "Deprecate the overhead circuit breaker setting\n\nThis deprecated the settings and internally removes any usages.\nThe only circuit breaker where the default diverged from 1.0 was the\nquery breaker and the already unused fielddata breaker.\n\nThe usefulness of the setting was questionable. It provided another\nknob to tune the circuit breaker behavior, but it is somewhat redundant\nbecause tuning the limit had more or less the same outcome.\n\n    newUsed * overheadConstant > memoryBytesLimit\n\n    =\n\n    newUsed > memoryBytesLimit / overheadConstant\n\nIt made the implementations more complicated and also made it harder to\nreason about how the memory accounting works. Acting a bit like a smoke\nbomb.\n\nThere were also inconsistencies in its use. In one place it was applied\nto the *delta*, in other cases it was applied to the *total*.", "committedDate": "2020-09-16T15:02:26Z", "type": "forcePushed"}, {"oid": "9f35017ea5f92a59d8d85d54cecdd6d2fba4295b", "url": "https://github.com/crate/crate/commit/9f35017ea5f92a59d8d85d54cecdd6d2fba4295b", "message": "Deprecate the overhead circuit breaker setting\n\nThis deprecated the settings and internally removes any usages.\nThe only circuit breaker where the default diverged from 1.0 was the\nquery breaker and the already unused fielddata breaker.\n\nThe usefulness of the setting was questionable. It provided another\nknob to tune the circuit breaker behavior, but it is somewhat redundant\nbecause tuning the limit had more or less the same outcome.\n\n    newUsed * overheadConstant > memoryBytesLimit\n\n    =\n\n    newUsed > memoryBytesLimit / overheadConstant\n\nIt made the implementations more complicated and also made it harder to\nreason about how the memory accounting works. Acting a bit like a smoke\nbomb.\n\nThere were also inconsistencies in its use. In one place it was applied\nto the *delta*, in other cases it was applied to the *total*.", "committedDate": "2020-09-16T15:26:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNTU1MQ==", "url": "https://github.com/crate/crate/pull/10549#discussion_r489615551", "bodyText": "might be worth putting this in a CAUTION admonition?\n(here and elsewhere)", "author": "norosa", "createdAt": "2020-09-16T17:49:11Z", "path": "docs/config/cluster.rst", "diffHunk": "@@ -992,11 +992,11 @@ keeps working.\n .. _indices.breaker.query.overhead:\n \n **indices.breaker.query.overhead**\n-  | *Default:*   ``1.09``\n+  | *Default:*   ``1.00``\n   | *Runtime:*   ``no``\n \n-  A constant that all data estimations are multiplied with to determine a final\n-  estimation.\n+  This setting is deprecated and changing it has no longer any effect.", "originalCommit": "9f35017ea5f92a59d8d85d54cecdd6d2fba4295b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwNzQ4Ng==", "url": "https://github.com/crate/crate/pull/10549#discussion_r490107486", "bodyText": "maybe also add the @Deprecated annotation?", "author": "seut", "createdAt": "2020-09-17T09:35:18Z", "path": "server/src/main/java/org/elasticsearch/indices/breaker/CircuitBreakerStats.java", "diffHunk": "@@ -32,6 +32,8 @@\n     private final long limit;\n     private final long used;\n     private final long trippedCount;\n+\n+    // kept around for BWC of JMX metrics", "originalCommit": "9f35017ea5f92a59d8d85d54cecdd6d2fba4295b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI3ODU2NQ==", "url": "https://github.com/crate/crate/pull/10549#discussion_r490278565", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              This setting is deprecated and changing it has no longer any effect.\n          \n          \n            \n              .. CAUTION::\n          \n          \n            \n              \n          \n          \n            \n                  This setting is deprecated has no effect.", "author": "norosa", "createdAt": "2020-09-17T14:11:14Z", "path": "docs/config/cluster.rst", "diffHunk": "@@ -992,11 +992,11 @@ keeps working.\n .. _indices.breaker.query.overhead:\n \n **indices.breaker.query.overhead**\n-  | *Default:*   ``1.09``\n+  | *Default:*   ``1.00``\n   | *Runtime:*   ``no``\n \n-  A constant that all data estimations are multiplied with to determine a final\n-  estimation.\n+  This setting is deprecated and changing it has no longer any effect.", "originalCommit": "9f35017ea5f92a59d8d85d54cecdd6d2fba4295b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3983755334baed9dda0007fede27e8f7e876b9c7", "url": "https://github.com/crate/crate/commit/3983755334baed9dda0007fede27e8f7e876b9c7", "message": "Remove name argument from ChildMemoryCircuitBreaker\n\nThe name is also present in the `BreakerSettings`", "committedDate": "2020-09-18T12:20:39Z", "type": "commit"}, {"oid": "cb6aacdc091808036dad5673f14c374caeaf3bc2", "url": "https://github.com/crate/crate/commit/cb6aacdc091808036dad5673f14c374caeaf3bc2", "message": "Deprecate the overhead circuit breaker setting\n\nThis deprecated the settings and internally removes any usages.\nThe only circuit breaker where the default diverged from 1.0 was the\nquery breaker and the already unused fielddata breaker.\n\nThe usefulness of the setting was questionable. It provided another\nknob to tune the circuit breaker behavior, but it is somewhat redundant\nbecause tuning the limit had more or less the same outcome.\n\n    newUsed * overheadConstant > memoryBytesLimit\n\n    =\n\n    newUsed > memoryBytesLimit / overheadConstant\n\nIt made the implementations more complicated and also made it harder to\nreason about how the memory accounting works. Acting a bit like a smoke\nbomb.\n\nThere were also inconsistencies in its use. In one place it was applied\nto the *delta*, in other cases it was applied to the *total*.", "committedDate": "2020-09-18T12:23:30Z", "type": "commit"}, {"oid": "cb6aacdc091808036dad5673f14c374caeaf3bc2", "url": "https://github.com/crate/crate/commit/cb6aacdc091808036dad5673f14c374caeaf3bc2", "message": "Deprecate the overhead circuit breaker setting\n\nThis deprecated the settings and internally removes any usages.\nThe only circuit breaker where the default diverged from 1.0 was the\nquery breaker and the already unused fielddata breaker.\n\nThe usefulness of the setting was questionable. It provided another\nknob to tune the circuit breaker behavior, but it is somewhat redundant\nbecause tuning the limit had more or less the same outcome.\n\n    newUsed * overheadConstant > memoryBytesLimit\n\n    =\n\n    newUsed > memoryBytesLimit / overheadConstant\n\nIt made the implementations more complicated and also made it harder to\nreason about how the memory accounting works. Acting a bit like a smoke\nbomb.\n\nThere were also inconsistencies in its use. In one place it was applied\nto the *delta*, in other cases it was applied to the *total*.", "committedDate": "2020-09-18T12:23:30Z", "type": "forcePushed"}]}