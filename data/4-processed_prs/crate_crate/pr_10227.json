{"pr_number": 10227, "pr_title": "Extend REFRESH statement docs", "pr_createdAt": "2020-07-15T20:03:13Z", "pr_url": "https://github.com/crate/crate/pull/10227", "timeline": [{"oid": "728a2447bff4a8114ab6693f8d9883c268631721", "url": "https://github.com/crate/crate/commit/728a2447bff4a8114ab6693f8d9883c268631721", "message": "Extend REFRESH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups.", "committedDate": "2020-07-15T20:03:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NDExNg==", "url": "https://github.com/crate/crate/pull/10227#discussion_r456394116", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                WHERE pk = 'ID1' OR pk = 'ID2' OR PK = 'ID3'\n          \n          \n            \n                WHERE pk = 'ID1' OR pk = 'ID2' OR pk = 'ID3'\n          \n      \n    \n    \n  \n\nquestion: if pk consists of multiple values, could it also be something like the following?\n    WHERE pk1 = 'ID1' OR pk2 = 'ID2'\n\nthanks to this documentation btw. i was able to give an answer to this on my own: no", "author": "turbo-ele", "createdAt": "2020-07-17T11:52:20Z", "path": "docs/sql/statements/refresh.rst", "diffHunk": "@@ -22,30 +22,80 @@ Synopsis\n Description\n ===========\n \n-The REFRESH TABLE command refreshes one or more tables and all its rows, making\n-all changes made to that table available to all further commands.\n+The REFRESH TABLE command refreshes one or more tables, making all changes made\n+to that table visible to subsequent commands.\n \n-The ``PARTITION`` clause can be used to only refresh specific partitions of a\n-partitioned table. All columns by which a table is partitioned are required.\n+The ``PARTITION`` clause can be used to refresh specific partitions of a\n+partitioned table instead of all partitions. The ``PARTITION`` clause requires\n+all partitioned columns with the values that identify the partition as\n+argument.\n \n In case the ``PARTITION`` clause is omitted all open partitions will be\n refreshed. Closed partitions are not refreshed.\n \n-For performance reasons refreshing all open partitions should be avoided if\n-possible.\n-\n See :ref:`partitioned_tables` for more information on partitioned tables.\n \n-Without issuing this statement there is no guarantee that a change (``UPDATE``,\n-``DELETE``, ``COPY`` or ``INSERT``) will be seen by an immediately following\n-``SELECT`` statement for the row(s) affected by this change. By default a\n-refresh is scheduled periodically.\n \n-Internally a refresh opens a new table reader, which is then used by all\n-subsequent searches on the affected table.\n+For performance reasons, refreshing tables or partitions should be avoided as\n+it is an expensive operation. By default CrateDB periodically refreshes the\n+tables anyway. See :ref:`refresh_data` and :ref:`sql_ref_refresh_interval` for\n+more information about the periodic refreshes.\n+\n+Without an explicit ``REFRESH``, other statements like ``UPDATE``, ``DELETE``\n+or ``SELECT`` won't see data until the periodic refresh happens.\n+\n+An exception to that are statements which can filter on a primary key with an\n+exact match on one or more values. For example, looking up a single document in\n+a table with a single primary key column::\n+\n+    WHERE pk = 'ID1'\n+\n+If the primary key consists of multiple columns it would look like this::\n+\n+    WHERE pk1 = 'ID_PART_1' AND pk2 = 'ID_PART_2'\n+\n+Or if you want to query multiple records::\n+\n+    WHERE pk = 'ID1' OR pk = 'ID2' OR PK = 'ID3'", "originalCommit": "728a2447bff4a8114ab6693f8d9883c268631721", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQxMTA4NQ==", "url": "https://github.com/crate/crate/pull/10227#discussion_r456411085", "bodyText": "As you mentioned - no that won't result in a primary key lookup. Not sure if it's necessary to include counter examples like that - given that the text tells users how to answer questions like that (and you already proofed that it's easy enough to do :) )", "author": "mfussenegger", "createdAt": "2020-07-17T12:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NDExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQwMzA4MA==", "url": "https://github.com/crate/crate/pull/10227#discussion_r456403080", "bodyText": "if i got this right all primary key values have to be addressed, right?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            exact match on one or more values. For example, looking up a single document in\n          \n          \n            \n            exact match on all primary key values. For example, looking up a single document in", "author": "turbo-ele", "createdAt": "2020-07-17T12:13:23Z", "path": "docs/sql/statements/refresh.rst", "diffHunk": "@@ -22,30 +22,80 @@ Synopsis\n Description\n ===========\n \n-The REFRESH TABLE command refreshes one or more tables and all its rows, making\n-all changes made to that table available to all further commands.\n+The REFRESH TABLE command refreshes one or more tables, making all changes made\n+to that table visible to subsequent commands.\n \n-The ``PARTITION`` clause can be used to only refresh specific partitions of a\n-partitioned table. All columns by which a table is partitioned are required.\n+The ``PARTITION`` clause can be used to refresh specific partitions of a\n+partitioned table instead of all partitions. The ``PARTITION`` clause requires\n+all partitioned columns with the values that identify the partition as\n+argument.\n \n In case the ``PARTITION`` clause is omitted all open partitions will be\n refreshed. Closed partitions are not refreshed.\n \n-For performance reasons refreshing all open partitions should be avoided if\n-possible.\n-\n See :ref:`partitioned_tables` for more information on partitioned tables.\n \n-Without issuing this statement there is no guarantee that a change (``UPDATE``,\n-``DELETE``, ``COPY`` or ``INSERT``) will be seen by an immediately following\n-``SELECT`` statement for the row(s) affected by this change. By default a\n-refresh is scheduled periodically.\n \n-Internally a refresh opens a new table reader, which is then used by all\n-subsequent searches on the affected table.\n+For performance reasons, refreshing tables or partitions should be avoided as\n+it is an expensive operation. By default CrateDB periodically refreshes the\n+tables anyway. See :ref:`refresh_data` and :ref:`sql_ref_refresh_interval` for\n+more information about the periodic refreshes.\n+\n+Without an explicit ``REFRESH``, other statements like ``UPDATE``, ``DELETE``\n+or ``SELECT`` won't see data until the periodic refresh happens.\n+\n+An exception to that are statements which can filter on a primary key with an\n+exact match on one or more values. For example, looking up a single document in", "originalCommit": "728a2447bff4a8114ab6693f8d9883c268631721", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQxMDIwNw==", "url": "https://github.com/crate/crate/pull/10227#discussion_r456410207", "bodyText": "It was a bit amgigious. In the context of a single record all primary key values must be present.\nWhat I wanted to say is that you can lookup multiple records - but I think the later example shows that anyhow, so I used your suggestion and tweaked it a bit further", "author": "mfussenegger", "createdAt": "2020-07-17T12:28:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQwMzA4MA=="}], "type": "inlineReview"}, {"oid": "256b13893d7d5ea534006ee910f07f6dd535fac0", "url": "https://github.com/crate/crate/commit/256b13893d7d5ea534006ee910f07f6dd535fac0", "message": "fixup!", "committedDate": "2020-07-17T12:26:38Z", "type": "forcePushed"}, {"oid": "6cdccc8b118434c64afa56965647f94729fc4648", "url": "https://github.com/crate/crate/commit/6cdccc8b118434c64afa56965647f94729fc4648", "message": "Extend REFRESH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups.", "committedDate": "2020-07-17T14:00:25Z", "type": "commit"}, {"oid": "6cdccc8b118434c64afa56965647f94729fc4648", "url": "https://github.com/crate/crate/commit/6cdccc8b118434c64afa56965647f94729fc4648", "message": "Extend REFRESH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups.", "committedDate": "2020-07-17T14:00:25Z", "type": "forcePushed"}, {"oid": "61eea10131f5e0e3f2aee5f439b26bde2604dda4", "url": "https://github.com/crate/crate/commit/61eea10131f5e0e3f2aee5f439b26bde2604dda4", "message": "Merge branch 'master' into j/refresh-docs", "committedDate": "2020-07-17T14:40:54Z", "type": "commit"}]}