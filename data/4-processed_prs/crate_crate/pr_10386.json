{"pr_number": 10386, "pr_title": "Backport ES changes", "pr_createdAt": "2020-08-18T08:27:40Z", "pr_url": "https://github.com/crate/crate/pull/10386", "timeline": [{"oid": "c93afde9d7da019a64752df80a331aefd3854fdf", "url": "https://github.com/crate/crate/commit/c93afde9d7da019a64752df80a331aefd3854fdf", "message": "bp: Remove PRE_60_NODE_CHECKPOINT\n\nhttps://github.com/elastic/elasticsearch/commit/2c8440922f99e1ffc95487d2d3130168898d448b", "committedDate": "2020-08-18T08:27:06Z", "type": "commit"}, {"oid": "677bf8dd916d9c1b7b2ac718bc956db85366242d", "url": "https://github.com/crate/crate/commit/677bf8dd916d9c1b7b2ac718bc956db85366242d", "message": "bp: Avoid loading retention leases while writing them\n\nhttps://github.com/elastic/elasticsearch/commit/1ef00e368b4c25bacd59a2598c60b510044da163", "committedDate": "2020-08-18T08:27:06Z", "type": "commit"}, {"oid": "97871191c4d8588bec3d686cafbb59e3f556c4dd", "url": "https://github.com/crate/crate/commit/97871191c4d8588bec3d686cafbb59e3f556c4dd", "message": "Remove obsolete `isWithinMultiField` check\n\nSee https://github.com/crate/crate/pull/10385/commits/0412817442fd370a2ecd2f4f7d4ca51552dfc494", "committedDate": "2020-08-18T08:27:06Z", "type": "commit"}, {"oid": "5068e3569f54e748c6fa86bba603972f6bdc844a", "url": "https://github.com/crate/crate/commit/5068e3569f54e748c6fa86bba603972f6bdc844a", "message": "bp: Add a merge policy that prunes ID postings for soft-deleted but retained documents\n\nhttps://github.com/elastic/elasticsearch/commit/ae96c16f88f23cb771632672fe42942e6fb12e6a\n\nAlso includes a fix for the test:\n\nhttps://github.com/elastic/elasticsearch/commit/9f4e855ee82c8f4a3cc3bcb4f8f59f834957b2a4", "committedDate": "2020-08-18T08:37:54Z", "type": "commit"}, {"oid": "83d86c74cf2ac878bce8d1722f35ce2dc40f5439", "url": "https://github.com/crate/crate/commit/83d86c74cf2ac878bce8d1722f35ce2dc40f5439", "message": "bp: Improve translog corruption detection\n\nhttps://github.com/elastic/elasticsearch/commit/ca5771c1f4aeb37ff133540927a8c770c46693c3", "committedDate": "2020-08-18T08:38:08Z", "type": "commit"}, {"oid": "83d86c74cf2ac878bce8d1722f35ce2dc40f5439", "url": "https://github.com/crate/crate/commit/83d86c74cf2ac878bce8d1722f35ce2dc40f5439", "message": "bp: Improve translog corruption detection\n\nhttps://github.com/elastic/elasticsearch/commit/ca5771c1f4aeb37ff133540927a8c770c46693c3", "committedDate": "2020-08-18T08:38:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAwODA3MA==", "url": "https://github.com/crate/crate/pull/10386#discussion_r472008070", "bodyText": "We need to wait for 5.0 to remove node.max_local_storage_nodes and this patch depends on that, so it is deferred.", "author": "mfussenegger", "createdAt": "2020-08-18T08:30:12Z", "path": "devs/docs/es-backports.rst", "diffHunk": "@@ -386,19 +386,19 @@ components, so delaying it doesn't make applying other patches more difficult.\n - [ ] ef8f90cc2a5 Also mmap terms index (`.tip`) files for hybridfs (#43150)\n - [ ] 62620f28663 Remove usage of FileSwitchDirectory  (#42937)\n - [ ] 8159fdfcc9a Fix assertion in ReadOnlyEngine (#43010)\n-- [ ] ca5771c1f4a Improve translog corruption detection (#42744)\n-- [ ] ae96c16f88f Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n-- [ ] b6213ffa52d Revert \"Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\"\n-- [ ] 186b52c5738 Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n+- [x] ca5771c1f4a Improve translog corruption detection (#42744)\n+- [x] ae96c16f88f Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n+- [s] b6213ffa52d Revert \"Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\"\n+- [s] 186b52c5738 Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n - [x] 8ffb5a15d22 Fix Infinite Loops in ExceptionsHelper#unwrap (#42716)\n-- [ ] 4dd5be8e3f3 Use reader attributes to control term dict memory useage (#42838)\n-- [ ] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)\n-- [ ] 8e5812c4b32 remove v6.5.x and v6.6.x version constants (#42130)\n-- [ ] 6e39433cd53 Remove \"nodes/0\" folder prefix from data path (#42489)\n-- [ ] f07b90f3c35 Remove support for chained multi-fields. (#42333)\n-- [ ] 4a08b3d1c94 remove 6.4.x version constants (#42127)\n-- [ ] 1ef00e368b4 Avoid loading retention leases while writing them (#42620)\n-- [ ] 2c8440922f9 Remove PRE_60_NODE_CHECKPOINT (#42527)\n+- [s] 4dd5be8e3f3 Use reader attributes to control term dict memory useage (#42838)\n+- [d] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)\n+- [s] 8e5812c4b32 remove v6.5.x and v6.6.x version constants (#42130)\n+- [d] 6e39433cd53 Remove \"nodes/0\" folder prefix from data path (#42489)", "originalCommit": "863167b3c6acbd690b49a278b7579b85c03cea23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAwODI3Mw==", "url": "https://github.com/crate/crate/pull/10386#discussion_r472008273", "bodyText": "Already on Lucene 8.6, where we removed the readerAttributes stuff", "author": "mfussenegger", "createdAt": "2020-08-18T08:30:32Z", "path": "devs/docs/es-backports.rst", "diffHunk": "@@ -386,19 +386,19 @@ components, so delaying it doesn't make applying other patches more difficult.\n - [ ] ef8f90cc2a5 Also mmap terms index (`.tip`) files for hybridfs (#43150)\n - [ ] 62620f28663 Remove usage of FileSwitchDirectory  (#42937)\n - [ ] 8159fdfcc9a Fix assertion in ReadOnlyEngine (#43010)\n-- [ ] ca5771c1f4a Improve translog corruption detection (#42744)\n-- [ ] ae96c16f88f Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n-- [ ] b6213ffa52d Revert \"Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\"\n-- [ ] 186b52c5738 Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n+- [x] ca5771c1f4a Improve translog corruption detection (#42744)\n+- [x] ae96c16f88f Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n+- [s] b6213ffa52d Revert \"Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\"\n+- [s] 186b52c5738 Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n - [x] 8ffb5a15d22 Fix Infinite Loops in ExceptionsHelper#unwrap (#42716)\n-- [ ] 4dd5be8e3f3 Use reader attributes to control term dict memory useage (#42838)\n-- [ ] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)\n-- [ ] 8e5812c4b32 remove v6.5.x and v6.6.x version constants (#42130)\n-- [ ] 6e39433cd53 Remove \"nodes/0\" folder prefix from data path (#42489)\n-- [ ] f07b90f3c35 Remove support for chained multi-fields. (#42333)\n-- [ ] 4a08b3d1c94 remove 6.4.x version constants (#42127)\n-- [ ] 1ef00e368b4 Avoid loading retention leases while writing them (#42620)\n-- [ ] 2c8440922f9 Remove PRE_60_NODE_CHECKPOINT (#42527)\n+- [s] 4dd5be8e3f3 Use reader attributes to control term dict memory useage (#42838)", "originalCommit": "863167b3c6acbd690b49a278b7579b85c03cea23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAwOTYzMg==", "url": "https://github.com/crate/crate/pull/10386#discussion_r472009632", "bodyText": "If I'm not mistaken we need to wait for 5.0 for this, we may have people updating from 3.0 to 4.3 (although not recommended)", "author": "mfussenegger", "createdAt": "2020-08-18T08:32:45Z", "path": "devs/docs/es-backports.rst", "diffHunk": "@@ -386,19 +386,19 @@ components, so delaying it doesn't make applying other patches more difficult.\n - [ ] ef8f90cc2a5 Also mmap terms index (`.tip`) files for hybridfs (#43150)\n - [ ] 62620f28663 Remove usage of FileSwitchDirectory  (#42937)\n - [ ] 8159fdfcc9a Fix assertion in ReadOnlyEngine (#43010)\n-- [ ] ca5771c1f4a Improve translog corruption detection (#42744)\n-- [ ] ae96c16f88f Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n-- [ ] b6213ffa52d Revert \"Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\"\n-- [ ] 186b52c5738 Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n+- [x] ca5771c1f4a Improve translog corruption detection (#42744)\n+- [x] ae96c16f88f Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n+- [s] b6213ffa52d Revert \"Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\"\n+- [s] 186b52c5738 Add a merge policy that prunes ID postings for soft-deleted but retained documents (#40741)\n - [x] 8ffb5a15d22 Fix Infinite Loops in ExceptionsHelper#unwrap (#42716)\n-- [ ] 4dd5be8e3f3 Use reader attributes to control term dict memory useage (#42838)\n-- [ ] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)\n-- [ ] 8e5812c4b32 remove v6.5.x and v6.6.x version constants (#42130)\n-- [ ] 6e39433cd53 Remove \"nodes/0\" folder prefix from data path (#42489)\n-- [ ] f07b90f3c35 Remove support for chained multi-fields. (#42333)\n-- [ ] 4a08b3d1c94 remove 6.4.x version constants (#42127)\n-- [ ] 1ef00e368b4 Avoid loading retention leases while writing them (#42620)\n-- [ ] 2c8440922f9 Remove PRE_60_NODE_CHECKPOINT (#42527)\n+- [s] 4dd5be8e3f3 Use reader attributes to control term dict memory useage (#42838)\n+- [d] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)", "originalCommit": "863167b3c6acbd690b49a278b7579b85c03cea23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}