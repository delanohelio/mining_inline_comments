{"pr_number": 9905, "pr_title": "Use the new func registry for the not and is null predicates.", "pr_createdAt": "2020-04-29T12:47:37Z", "pr_url": "https://github.com/crate/crate/pull/9905", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMwNTAzMg==", "url": "https://github.com/crate/crate/pull/9905#discussion_r417305032", "bodyText": "I extended the PredicateModule from AbstractFunctionModule or there was a reason why it wasn't done like that before?", "author": "kovrus", "createdAt": "2020-04-29T13:16:20Z", "path": "sql/src/main/java/io/crate/expression/predicate/PredicateModule.java", "diffHunk": "@@ -21,34 +21,13 @@\n \n package io.crate.expression.predicate;\n \n-import io.crate.metadata.FunctionIdent;\n+import io.crate.expression.AbstractFunctionModule;\n import io.crate.metadata.FunctionImplementation;\n-import io.crate.metadata.FunctionName;\n-import io.crate.metadata.FunctionResolver;\n-import org.elasticsearch.common.inject.AbstractModule;\n-import org.elasticsearch.common.inject.multibindings.MapBinder;\n \n-public class PredicateModule extends AbstractModule {\n-\n-    private MapBinder<FunctionIdent, FunctionImplementation> functionBinder;\n-    private MapBinder<FunctionName, FunctionResolver> resolverBinder;\n-\n-    public void register(FunctionImplementation impl) {\n-        functionBinder.addBinding(impl.info().ident()).toInstance(impl);\n-    }\n-\n-    public void register(String name, FunctionResolver functionResolver) {\n-        register(new FunctionName(name), functionResolver);\n-    }\n-\n-    public void register(FunctionName qualifiedName, FunctionResolver functionResolver) {\n-        resolverBinder.addBinding(qualifiedName).toInstance(functionResolver);\n-    }\n+public class PredicateModule extends AbstractFunctionModule<FunctionImplementation> {", "originalCommit": "e3432a37bb95d238594cd7bc3e324759eaa0f8e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxMzUxNQ==", "url": "https://github.com/crate/crate/pull/9905#discussion_r417313515", "bodyText": "I don't see any reasons why this was not extended. Maybe just never refactored...", "author": "seut", "createdAt": "2020-04-29T13:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMwNTAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMwNzA2OQ==", "url": "https://github.com/crate/crate/pull/9905#discussion_r417307069", "bodyText": "I had to adjust these tests for the operators as well and I went with an simpler approach. Just use this for functions with signatures:\n    private FunctionInfo functionInfo(Signature signature, DataType dataType) {\n        return functions.getQualified(signature, List.of(dataType, dataType)).info();\n    }", "author": "seut", "createdAt": "2020-04-29T13:19:25Z", "path": "sql/src/test/java/io/crate/analyze/EvaluatingNormalizerTest.java", "diffHunk": "@@ -123,17 +130,25 @@ public void testEvaluationClusterGranularity() {\n         assertThat(query, instanceOf(Function.class));\n     }\n \n-    private FunctionInfo functionInfo(String name, DataType dataType, boolean isPredicate) {\n-        ImmutableList<DataType> dataTypes;\n+    private FunctionInfo functionInfo(String name, DataType<?> dataType, boolean isPredicate) {", "originalCommit": "e3432a37bb95d238594cd7bc3e324759eaa0f8e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d58013a5adff7fa0688bf18aded641f491f92582", "url": "https://github.com/crate/crate/commit/d58013a5adff7fa0688bf18aded641f491f92582", "message": "Use the new func registry for the not and is null predicates.", "committedDate": "2020-04-29T13:24:59Z", "type": "forcePushed"}, {"oid": "1792a40b1769e627b5bafd6ab5b1e241fcda4018", "url": "https://github.com/crate/crate/commit/1792a40b1769e627b5bafd6ab5b1e241fcda4018", "message": "Use the new func registry for the not and is null predicates.", "committedDate": "2020-04-29T13:57:18Z", "type": "commit"}, {"oid": "1792a40b1769e627b5bafd6ab5b1e241fcda4018", "url": "https://github.com/crate/crate/commit/1792a40b1769e627b5bafd6ab5b1e241fcda4018", "message": "Use the new func registry for the not and is null predicates.", "committedDate": "2020-04-29T13:57:18Z", "type": "forcePushed"}]}