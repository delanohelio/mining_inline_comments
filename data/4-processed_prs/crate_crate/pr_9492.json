{"pr_number": 9492, "pr_title": "Expose the merge.scheduler.max_thread_count setting for non-SSD type disks", "pr_createdAt": "2020-01-09T09:05:55Z", "pr_url": "https://github.com/crate/crate/pull/9492", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTAxNA==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364635014", "bodyText": "I think this will be a bit problematic since the value depends on the environment where the test is running on. E.g. on our CI systems it will be lower.\nMaybe we can make the assertion a bit more lenient in that regard or fix the value in the create table statement, so that the tests are deterministic on all environments?", "author": "mfussenegger", "createdAt": "2020-01-09T09:29:42Z", "path": "sql/src/test/java/io/crate/analyze/MetaDataToASTNodeResolverTest.java", "diffHunk": "@@ -96,6 +96,7 @@ public void testBuildCreateTableColumns() throws Exception {\n                      \"   \\\"mapping.total_fields.limit\\\" = 1000,\\n\" +\n                      \"   max_ngram_diff = 1,\\n\" +\n                      \"   max_shingle_diff = 3,\\n\" +\n+                     \"   \\\"merge.scheduler.max_thread_count\\\" = 4,\\n\" +", "originalCommit": "d24fa9e70a7927b47a190b433e98196dbf3e35a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY1NjQ3OQ==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364656479", "bodyText": "Right, I will fix this value.", "author": "asdf2014", "createdAt": "2020-01-09T10:13:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTAxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTMxNg==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364635316", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Defaults to Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))\n          \n          \n            \n            Defaults to ``Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))``", "author": "mfussenegger", "createdAt": "2020-01-09T09:30:15Z", "path": "docs/sql/statements/create-table.rst", "diffHunk": "@@ -648,3 +648,11 @@ the NGramTokenizer or the NGramTokenFilter. The default is 1.\n \n Specifies the maximum difference between min_shingle_size and max_shingle_size\n when using the ShingleTokenFilter. The default is 3.\n+\n+``merge.scheduler.max_thread_count``\n+--------------------\n+\n+The maximum number of threads on a single shard that may be merging at once.\n+Defaults to Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))", "originalCommit": "d24fa9e70a7927b47a190b433e98196dbf3e35a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY1Njc0OA==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364656748", "bodyText": "Indeed, it would be better. Thanks \ud83d\udc4d", "author": "asdf2014", "createdAt": "2020-01-09T10:14:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTMxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTc5Mg==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364635792", "bodyText": "Did you intend for this to be backported to 4.0? Usually this kind of change only goes into a feature release (4.1) - in which case we'd list it somewhere under Changes.", "author": "mfussenegger", "createdAt": "2020-01-09T09:31:11Z", "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -248,6 +248,10 @@ Others\n Fixes\n =====\n \n+- Allow user to control the maximum number of threads on a single shard", "originalCommit": "d24fa9e70a7927b47a190b433e98196dbf3e35a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY1NzY3Mg==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364657672", "bodyText": "Sorry, I will move it under Changes.", "author": "asdf2014", "createdAt": "2020-01-09T10:16:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzODk0Mg==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364638942", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            --------------------\n          \n          \n            \n            ------------------------------------", "author": "kovrus", "createdAt": "2020-01-09T09:37:35Z", "path": "docs/sql/statements/create-table.rst", "diffHunk": "@@ -648,3 +648,11 @@ the NGramTokenizer or the NGramTokenFilter. The default is 1.\n \n Specifies the maximum difference between min_shingle_size and max_shingle_size\n when using the ShingleTokenFilter. The default is 3.\n+\n+``merge.scheduler.max_thread_count``\n+--------------------", "originalCommit": "d24fa9e70a7927b47a190b433e98196dbf3e35a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY1Nzc0Nw==", "url": "https://github.com/crate/crate/pull/9492#discussion_r364657747", "bodyText": "Thanks \ud83d\udc4d", "author": "asdf2014", "createdAt": "2020-01-09T10:16:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzODk0Mg=="}], "type": "inlineReview"}, {"oid": "05801cc2bbe8aea59e4d7dfab0712cba11ebe06c", "url": "https://github.com/crate/crate/commit/05801cc2bbe8aea59e4d7dfab0712cba11ebe06c", "message": "Expose the merge.scheduler.max_thread_count setting for non-SSD type disks", "committedDate": "2020-01-10T10:08:36Z", "type": "commit"}]}