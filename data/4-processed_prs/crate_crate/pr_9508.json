{"pr_number": 9508, "pr_title": "Support pg array value input notation", "pr_createdAt": "2020-01-14T15:14:23Z", "pr_url": "https://github.com/crate/crate/pull/9508", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQwMDg3OA==", "url": "https://github.com/crate/crate/pull/9508#discussion_r366400878", "bodyText": "Made the quoted/non-quoted distinction to be able to handle null without quotes as real null value instead of a null string literal. Not sure if there would be a better way to accomplish this.", "author": "mfussenegger", "createdAt": "2020-01-14T15:23:26Z", "path": "pgwire/src/main/java/io/crate/protocols/postgres/parser/PgArrayASTVisitor.java", "diffHunk": "@@ -50,7 +50,27 @@ public Object visitArray(PgArrayParser.ArrayContext ctx) {\n \n     @Override\n     public Object visitValue(PgArrayParser.ValueContext ctx) {\n-        return convert.apply(processArrayItem(ctx.getText().getBytes(UTF_8)));\n+        PgArrayParser.StringContext stringContext = ctx.string();\n+        if (stringContext == null) {\n+            return convert.apply(processArrayItem(ctx.getText().getBytes(UTF_8)));\n+        }\n+        Object value = visit(stringContext);\n+        if (value == null) {", "originalCommit": "3b507cb302c9891cb14d4c79451c7b56e16c796b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQyNjYwNg==", "url": "https://github.com/crate/crate/pull/9508#discussion_r366426606", "bodyText": "can we drop https://github.com/crate/crate/pull/9508/files#diff-56e21a74f1c628321abf2180bc314273R90-R92 such as we have dedicated rules to match quoted and unquoted strings? otherwise, lgtm", "author": "kovrus", "createdAt": "2020-01-14T16:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQwMDg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQzOTA3OQ==", "url": "https://github.com/crate/crate/pull/9508#discussion_r366439079", "bodyText": "@kovrus pushed a fixup", "author": "mfussenegger", "createdAt": "2020-01-14T16:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQwMDg3OA=="}], "type": "inlineReview"}, {"oid": "709d1960b342edd5205897beca565b29e2d3ab1f", "url": "https://github.com/crate/crate/commit/709d1960b342edd5205897beca565b29e2d3ab1f", "message": "Support pg array value input notation\n\nSee https://www.postgresql.org/docs/current/arrays.html#ARRAYS-INPUT\n\nThe PostgreSQL JDBC client uses some queries which makes use of this\nnotation.", "committedDate": "2020-01-15T08:53:35Z", "type": "commit"}, {"oid": "709d1960b342edd5205897beca565b29e2d3ab1f", "url": "https://github.com/crate/crate/commit/709d1960b342edd5205897beca565b29e2d3ab1f", "message": "Support pg array value input notation\n\nSee https://www.postgresql.org/docs/current/arrays.html#ARRAYS-INPUT\n\nThe PostgreSQL JDBC client uses some queries which makes use of this\nnotation.", "committedDate": "2020-01-15T08:53:35Z", "type": "forcePushed"}]}