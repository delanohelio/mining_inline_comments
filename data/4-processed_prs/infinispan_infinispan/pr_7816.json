{"pr_number": 7816, "pr_title": "[10.1.x] ISPN-11228 Cross-Site Repl Docs", "pr_createdAt": "2020-02-03T19:40:51Z", "pr_url": "https://github.com/infinispan/infinispan/pull/7816", "timeline": [{"oid": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "url": "https://github.com/infinispan/infinispan/commit/63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "message": "ISPN-10835 xsite repl doc updates", "committedDate": "2020-02-05T11:27:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3Nzc5OQ==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375277799", "bodyText": "the -c and -s options aren't valid.", "author": "pruivo", "createdAt": "2020-02-05T14:13:48Z", "path": "cli/cli-client/src/main/resources/help/site.adoc", "diffHunk": "@@ -28,31 +28,34 @@ SYNOPSIS\n OPTIONS\n -------\n *-c, --cache*='CACHE_NAME'::", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3ODk5NA==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375278994", "bodyText": "it doesn't return the status of myCache.\nIt just returns the status of the remote sites (online, offline, etc) configured in (or used by) myCache", "author": "pruivo", "createdAt": "2020-02-05T14:15:59Z", "path": "cli/cli-client/src/main/resources/help/site.adoc", "diffHunk": "@@ -28,31 +28,34 @@ SYNOPSIS\n OPTIONS\n -------\n *-c, --cache*='CACHE_NAME'::\n-Specifies a cache. Defaults to the currently selected cache.\n+Specifies a cache.\n \n *-s, --site*='SITE_NAME'::\n Specifies a site.\n \n \n EXAMPLES\n --------\n-`site status -s SITE_A` +\n-Returns the status for `SITE_A`.\n+`site status --cache=mycache` +\n+Returns the status of the `mycache` cache for all backup locations.", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3OTYwMQ==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375279601", "bodyText": "Same as above but for a particular remote site.\nAnd the status is shown per node. Example:\n{\"pedro-laptop-3-35787\":\"online\"}", "author": "pruivo", "createdAt": "2020-02-05T14:17:07Z", "path": "cli/cli-client/src/main/resources/help/site.adoc", "diffHunk": "@@ -28,31 +28,34 @@ SYNOPSIS\n OPTIONS\n -------\n *-c, --cache*='CACHE_NAME'::\n-Specifies a cache. Defaults to the currently selected cache.\n+Specifies a cache.\n \n *-s, --site*='SITE_NAME'::\n Specifies a site.\n \n \n EXAMPLES\n --------\n-`site status -s SITE_A` +\n-Returns the status for `SITE_A`.\n+`site status --cache=mycache` +\n+Returns the status of the `mycache` cache for all backup locations.\n \n-`site bring-online --cache=mycache --site=SITE_A` +\n-Brings the `mycache` cache online at `SITE_A`.\n+`site status --cache=mycache --site=NYC` +\n+Returns the status of the `mycache` cache in `NYC`.", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI4NDY1Mw==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375284653", "bodyText": "Brings site NYC online for cache myCache", "author": "pruivo", "createdAt": "2020-02-05T14:25:08Z", "path": "cli/cli-client/src/main/resources/help/site.adoc", "diffHunk": "@@ -28,31 +28,34 @@ SYNOPSIS\n OPTIONS\n -------\n *-c, --cache*='CACHE_NAME'::\n-Specifies a cache. Defaults to the currently selected cache.\n+Specifies a cache.\n \n *-s, --site*='SITE_NAME'::\n Specifies a site.\n \n \n EXAMPLES\n --------\n-`site status -s SITE_A` +\n-Returns the status for `SITE_A`.\n+`site status --cache=mycache` +\n+Returns the status of the `mycache` cache for all backup locations.\n \n-`site bring-online --cache=mycache --site=SITE_A` +\n-Brings the `mycache` cache online at `SITE_A`.\n+`site status --cache=mycache --site=NYC` +\n+Returns the status of the `mycache` cache in `NYC`.\n \n-`site take-offline --cache=mycache --site=SITE_B` +\n-Takes the `mycache` cache offline at `SITE_B`.\n+`site bring-online --cache=mycache --site=LON` +\n+Brings the `mycache` cache online at `LON`.", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI4NDc3OQ==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375284779", "bodyText": "Takes site NYC offline for cache myCache", "author": "pruivo", "createdAt": "2020-02-05T14:25:20Z", "path": "cli/cli-client/src/main/resources/help/site.adoc", "diffHunk": "@@ -28,31 +28,34 @@ SYNOPSIS\n OPTIONS\n -------\n *-c, --cache*='CACHE_NAME'::\n-Specifies a cache. Defaults to the currently selected cache.\n+Specifies a cache.\n \n *-s, --site*='SITE_NAME'::\n Specifies a site.\n \n \n EXAMPLES\n --------\n-`site status -s SITE_A` +\n-Returns the status for `SITE_A`.\n+`site status --cache=mycache` +\n+Returns the status of the `mycache` cache for all backup locations.\n \n-`site bring-online --cache=mycache --site=SITE_A` +\n-Brings the `mycache` cache online at `SITE_A`.\n+`site status --cache=mycache --site=NYC` +\n+Returns the status of the `mycache` cache in `NYC`.\n \n-`site take-offline --cache=mycache --site=SITE_B` +\n-Takes the `mycache` cache offline at `SITE_B`.\n+`site bring-online --cache=mycache --site=LON` +\n+Brings the `mycache` cache online at `LON`.\n \n-`site push-site-state --site=SITE_B` +\n-Push the state of all caches to the backup site `SITE_B`.\n+`site take-offline --cache=mycache --site=NYC` +\n+Takes the `mycache` cache offline at `NYC`.", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI5MjIyMA==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375292220", "bodyText": "push-site-status doesn't have  --site anymore.", "author": "pruivo", "createdAt": "2020-02-05T14:36:49Z", "path": "cli/cli-client/src/main/resources/help/site.adoc", "diffHunk": "@@ -28,31 +28,34 @@ SYNOPSIS\n OPTIONS\n -------\n *-c, --cache*='CACHE_NAME'::\n-Specifies a cache. Defaults to the currently selected cache.\n+Specifies a cache.\n \n *-s, --site*='SITE_NAME'::\n Specifies a site.\n \n \n EXAMPLES\n --------\n-`site status -s SITE_A` +\n-Returns the status for `SITE_A`.\n+`site status --cache=mycache` +\n+Returns the status of the `mycache` cache for all backup locations.\n \n-`site bring-online --cache=mycache --site=SITE_A` +\n-Brings the `mycache` cache online at `SITE_A`.\n+`site status --cache=mycache --site=NYC` +\n+Returns the status of the `mycache` cache in `NYC`.\n \n-`site take-offline --cache=mycache --site=SITE_B` +\n-Takes the `mycache` cache offline at `SITE_B`.\n+`site bring-online --cache=mycache --site=LON` +\n+Brings the `mycache` cache online at `LON`.\n \n-`site push-site-state --site=SITE_B` +\n-Push the state of all caches to the backup site `SITE_B`.\n+`site take-offline --cache=mycache --site=NYC` +\n+Takes the `mycache` cache offline at `NYC`.\n \n-`site push-site-status --site=SITE_B` +\n-Displays the current status of the push to the backup site `SITE_B`.\n+`site push-site-state --cache=mycache --site=NYC` +\n+Backs up the `mycache` cache to `NYC`.\n \n-`site cancel-push-state --site=SITE_B` +\n-Cancels the operation to push state to the backup site `SITE_B`.\n+`site push-site-status --cache=mycache --site=NYC` +", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMwMDAxOQ==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375300019", "bodyText": "A zero (or negative) value ignores this attribute and uses min-wait only (if configured).\nA \"site\" never go offline automatically when both are <= 0 (i.e. the default)", "author": "pruivo", "createdAt": "2020-02-05T14:49:24Z", "path": "core/src/main/resources/schema/infinispan-config-10.1.xsd", "diffHunk": "@@ -1959,12 +1971,16 @@\n   <xs:complexType name=\"take-offline\">\n     <xs:attribute name=\"after-failures\" type=\"xs:int\" default=\"0\">\n       <xs:annotation>\n-        <xs:documentation>The number of failed request operations after which this site should be taken offline. Defaults to 0 (never). A negative value would mean that the site will be taken offline after 'min-wait'.</xs:documentation>\n+        <xs:documentation>\n+          Sets the number of consecutive failures that can occur for backup operations before sites go offline. The default value is 0 (zero) which means backup locations never go offline automatically.", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMwNjMzOQ==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375306339", "bodyText": "this is the minimum time to wait before the site is taken offline after an operation fails. It is reset in a successful operation", "author": "pruivo", "createdAt": "2020-02-05T14:59:14Z", "path": "core/src/main/resources/schema/infinispan-config-10.1.xsd", "diffHunk": "@@ -1959,12 +1971,16 @@\n   <xs:complexType name=\"take-offline\">\n     <xs:attribute name=\"after-failures\" type=\"xs:int\" default=\"0\">\n       <xs:annotation>\n-        <xs:documentation>The number of failed request operations after which this site should be taken offline. Defaults to 0 (never). A negative value would mean that the site will be taken offline after 'min-wait'.</xs:documentation>\n+        <xs:documentation>\n+          Sets the number of consecutive failures that can occur for backup operations before sites go offline. The default value is 0 (zero) which means backup locations never go offline automatically.\n+        </xs:documentation>\n       </xs:annotation>\n     </xs:attribute>\n     <xs:attribute name=\"min-wait\" type=\"xs:long\" default=\"0\">\n       <xs:annotation>\n-        <xs:documentation>The minimal number of millis to wait before taking this site offline, even in the case 'after-failures' is reached. If smaller or equal to 0, then only 'after-failures' is considered.</xs:documentation>\n+        <xs:documentation>\n+          Sets the minimum time to wait, in milliseconds, for backup operations to complete before sites go offline. If you set \"after-failures\", sites go offline when the wait time is reached and the number of failures occur. To use the minimum wait time only, specify a negative value for \"after-failures\".", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMxMDk3MA==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375310970", "bodyText": "forward backup requests to a  local site", "author": "pruivo", "createdAt": "2020-02-05T15:06:24Z", "path": "documentation/src/main/asciidoc/topics/con_xsite_site_masters.adoc", "diffHunk": "@@ -0,0 +1,12 @@\n+[id='xsite_masters-{context}']\n+= Site Masters\n+Site masters are the nodes in {brandname} clusters that are responsible for\n+sending and receiving requests from backup locations.\n+\n+If a node is not a site master, it must forward backup requests to a site", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMxMzY2Mw==", "url": "https://github.com/infinispan/infinispan/pull/7816#discussion_r375313663", "bodyText": "status command missing", "author": "pruivo", "createdAt": "2020-02-05T15:10:56Z", "path": "documentation/src/main/asciidoc/topics/proc_cli_xsite_sites.adoc", "diffHunk": "@@ -0,0 +1,32 @@\n+[id='manage_sites-{context}']\n+= Bringing Backup Locations Offline and Online\n+Take backup locations offline manually and bring them back online.\n+\n+.Procedure\n+\n+* Check if backup locations are online or offline with the `site status`\n+command:\n++\n+----\n+//containers/default]> site --cache=cacheName --site=NYC", "originalCommit": "63ca0e67e7cd10ddf666ed9290e821df5e16dca1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2d6d153e4ba5bbd76fb2488b20582c21bf62673", "url": "https://github.com/infinispan/infinispan/commit/e2d6d153e4ba5bbd76fb2488b20582c21bf62673", "message": "edits for site cli and schema docs", "committedDate": "2020-02-05T19:02:18Z", "type": "forcePushed"}, {"oid": "2341842200c3652d60ffdaaedc501f99104eb43e", "url": "https://github.com/infinispan/infinispan/commit/2341842200c3652d60ffdaaedc501f99104eb43e", "message": "edits for site cli and schema docs", "committedDate": "2020-02-06T09:23:53Z", "type": "forcePushed"}, {"oid": "a582bcf48d72f33b1806fb2517ec86c812d25d6a", "url": "https://github.com/infinispan/infinispan/commit/a582bcf48d72f33b1806fb2517ec86c812d25d6a", "message": "ISPN-10835 xsite repl doc updates", "committedDate": "2020-02-06T10:19:09Z", "type": "commit"}, {"oid": "a582bcf48d72f33b1806fb2517ec86c812d25d6a", "url": "https://github.com/infinispan/infinispan/commit/a582bcf48d72f33b1806fb2517ec86c812d25d6a", "message": "ISPN-10835 xsite repl doc updates", "committedDate": "2020-02-06T10:19:09Z", "type": "forcePushed"}]}