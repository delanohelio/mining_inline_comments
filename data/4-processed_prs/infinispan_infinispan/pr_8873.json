{"pr_number": 8873, "pr_title": "ISPN-12437 xsite max idle", "pr_createdAt": "2020-11-18T18:03:51Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8873", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxMDg2NA==", "url": "https://github.com/infinispan/infinispan/pull/8873#discussion_r526310864", "bodyText": "@wburns Does this description seem adequate? I didn't want to get overly complex about the touch commands. I know if they return null then the entry is expired. But I'm not sure we need to say that.\nIs there any performance penalty that comes from latency with touch commands?", "author": "oraNod", "createdAt": "2020-11-18T18:05:36Z", "path": "documentation/src/main/asciidoc/topics/con_xsite_expiration.adoc", "diffHunk": "@@ -1,7 +1,10 @@\n [id='xsite_expiration-{context}']\n-= Expiration and Cross-Site Replication\n-{brandname} expiration controls how long entries remain in the cache.\n+= Expiration with Cross-Site Replication\n+Expiration removes cache entries based on time.\n+{brandname} provides two ways to configure expiration for entries:\n \n-* `lifespan` expiration is suitable for cross-site replication. When entries reach the maximum lifespan, {brandname} expires them independently of the remote sites.\n+`lifespan`:: Sets the maximum amount of time that entries can exist. +\n+When you set `lifespan` with cross-site replication, {brandname} clusters expire entries independently of remote sites.\n \n-* `max-idle` expiration does not work with cross-site replication. {brandname} cannot determine when cache entries reach the idle timeout in remote sites.\n+`max-idle`:: Specifies how long entries can exist based on read or write operations in a given time period. +\n+When you set a `max-idle` with cross-site replication, {brandname} clusters send touch commands during replication to coordinate idle timeout with remote sites.", "originalCommit": "0006fe6eef24a1cb2de91ce612483e672344e155", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgzMjQyNA==", "url": "https://github.com/infinispan/infinispan/pull/8873#discussion_r526832424", "bodyText": "I believe the touch commands are sent on access/read. IMO, the word \"replication\" implies some kind of write operation and should be avoided.\nPerformance is expected to be worse. You will go from simple RAM access (best case) to a remote site round-trip (ouch!)... There is no free lunch here :) The good part is the touch command isn't required in every read...", "author": "pruivo", "createdAt": "2020-11-19T12:22:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxMDg2NA=="}], "type": "inlineReview"}, {"oid": "b23cf1146033bcbf9a990d889603450ac55e5741", "url": "https://github.com/infinispan/infinispan/commit/b23cf1146033bcbf9a990d889603450ac55e5741", "message": "ISPN-12437 xsite max idle", "committedDate": "2020-11-25T16:43:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3OTM1NQ==", "url": "https://github.com/infinispan/infinispan/pull/8873#discussion_r531179355", "bodyText": "I don't think we send touch on write.", "author": "pruivo", "createdAt": "2020-11-26T18:18:39Z", "path": "documentation/src/main/asciidoc/topics/con_xsite_expiration.adoc", "diffHunk": "@@ -1,7 +1,14 @@\n [id='xsite_expiration-{context}']\n-= Expiration and Cross-Site Replication\n-{brandname} expiration controls how long entries remain in the cache.\n+= Expiration with Cross-Site Replication\n+Expiration removes cache entries based on time.\n+{brandname} provides two ways to configure expiration for entries:\n \n-* `lifespan` expiration is suitable for cross-site replication. When entries reach the maximum lifespan, {brandname} expires them independently of the remote sites.\n+`lifespan`:: Sets the maximum amount of time that entries can exist. +\n+When you set `lifespan` with cross-site replication, {brandname} clusters expire entries independently of remote sites.\n \n-* `max-idle` expiration does not work with cross-site replication. {brandname} cannot determine when cache entries reach the idle timeout in remote sites.\n+`max-idle`:: Specifies how long entries can exist based on read or write operations in a given time period. +\n+When you set a `max-idle` with cross-site replication, {brandname} clusters send touch commands on write operations, and some read operations, to coordinate idle timeout values with remote sites. +", "originalCommit": "b23cf1146033bcbf9a990d889603450ac55e5741", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1e8ee0067b642e975faa4d55e74c261e638cf463", "url": "https://github.com/infinispan/infinispan/commit/1e8ee0067b642e975faa4d55e74c261e638cf463", "message": "ISPN-12437 xsite max idle", "committedDate": "2020-11-30T10:22:56Z", "type": "commit"}, {"oid": "1e8ee0067b642e975faa4d55e74c261e638cf463", "url": "https://github.com/infinispan/infinispan/commit/1e8ee0067b642e975faa4d55e74c261e638cf463", "message": "ISPN-12437 xsite max idle", "committedDate": "2020-11-30T10:22:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU4NjU2OQ==", "url": "https://github.com/infinispan/infinispan/pull/8873#discussion_r533586569", "bodyText": "This is a bit generalized, but maybe that is the point? Seems fine though.", "author": "wburns", "createdAt": "2020-12-01T17:20:29Z", "path": "documentation/src/main/asciidoc/topics/con_xsite_expiration.adoc", "diffHunk": "@@ -1,7 +1,14 @@\n [id='xsite_expiration-{context}']\n-= Expiration and Cross-Site Replication\n-{brandname} expiration controls how long entries remain in the cache.\n+= Expiration with Cross-Site Replication\n+Expiration removes cache entries based on time.\n+{brandname} provides two ways to configure expiration for entries:\n \n-* `lifespan` expiration is suitable for cross-site replication. When entries reach the maximum lifespan, {brandname} expires them independently of the remote sites.\n+`lifespan`:: Sets the maximum amount of time that entries can exist. +\n+When you set `lifespan` with cross-site replication, {brandname} clusters expire entries independently of remote sites.\n \n-* `max-idle` expiration does not work with cross-site replication. {brandname} cannot determine when cache entries reach the idle timeout in remote sites.\n+`max-idle`:: Specifies how long entries can exist based on read or write operations in a given time period. +\n+When you set a `max-idle` with cross-site replication, {brandname} clusters send touch commands to coordinate idle timeout values with remote sites. +", "originalCommit": "1e8ee0067b642e975faa4d55e74c261e638cf463", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY0ODU3OA==", "url": "https://github.com/infinispan/infinispan/pull/8873#discussion_r533648578", "bodyText": "@wburns Yes it's a bit generalized but it seemed preferable to getting too low level. Do you think there are any points we should be more specific about or could we just merge this?", "author": "oraNod", "createdAt": "2020-12-01T18:57:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU4NjU2OQ=="}], "type": "inlineReview"}]}