{"pr_number": 8554, "pr_title": "ISPN-12108 configuring mediatypes client interop", "pr_createdAt": "2020-07-16T16:35:25Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8554", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjM5NA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r455922394", "bodyText": "@gustavonalle is this still correct for Hot Rod clients or should it change to ProtoStream?", "author": "oraNod", "createdAt": "2020-07-16T16:39:25Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_textbased_encoding.adoc", "diffHunk": "@@ -0,0 +1,25 @@\n+[id='using_text_based_storage-{context}']\n+= Using Text-Based Formats for Data\n+You can configure {brandname} to encode data in text-based formats such as\n+`text/plain`, `application/json`, or `application/xml`.\n+\n+.Procedure\n+\n+. Specify a text-based storage format as the MediaType for keys and values.\n+. Optionally specify a character set such as `UTF-8`.\n++\n+The following example configures {brandname} to store entries with the `text/plain; charset=UTF-8` format:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_text_plain.xml[]\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients should use the `org.infinispan.commons.marshall.StringMarshaller` marshaller to handle data in text-based formats.", "originalCommit": "f4a862e35aaabf1d4a7011ad1faa517b3aa1e683", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk3MTM5Mg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457971392", "bodyText": "@ryanemerson same question here, please. for text-based formats should we change StringMarshaller to ProtoStream?", "author": "oraNod", "createdAt": "2020-07-21T09:44:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjM5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk3Njk4MQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457976981", "bodyText": "I'm not sure what use-case string based is trying to appeal to. If it's simply getting something working as simple as possible, then the StringMarshaller is the way to go. Protostream is more flexible, but for text based it has to be JSON and the user has to provide/generate protostream marshallers and a schema, so it's a lot more involved.", "author": "ryanemerson", "createdAt": "2020-07-21T09:53:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjM5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAwMTQxMw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458001413", "bodyText": "hey @ryanemerson awesome. this helps clear it up a little for me. I've reworded to include some of this detail. IMO we should include ProtoStream in here too for consistency. also, when you say \"Protostream is more flexible\" - I take this to mean that you're pretty much restricted to string-based if you use StringMarshaller. that might not make much sense for Hot Rod clients. so if you want text + binary use ProtoStream. but, in this case, text means you must use the application/json mediatype.\ndoes that sound right?", "author": "oraNod", "createdAt": "2020-07-21T10:38:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjM5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzMTA4Nw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458031087", "bodyText": "I take this to mean that you're pretty much restricted to string-based if you use StringMarshaller. that might not make much sense for Hot Rod clients.\n\nExactly.\n\nso if you want text + binary use ProtoStream. but, in this case, text means you must use the application/json mediatype.\n\nI was actually wrong on this. You can still specify [text/plain, application/json, application/x-java-object, application/octet-stream]  media types and transcoding will handle it, as it converts the value to a Java object if possible and then marshalls this using Protostream. XML is not supported though.", "author": "ryanemerson", "createdAt": "2020-07-21T11:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjM5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzI2MA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r455923260", "bodyText": "@gustavonalle should we list all the marshaller options here? what about Kyro and ProtoStuff?", "author": "oraNod", "createdAt": "2020-07-16T16:40:44Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_custom_java_objects.adoc", "diffHunk": "@@ -0,0 +1,42 @@\n+[id='storing_binary_objects-{context}']\n+= Storing Java Objects in Binary Format\n+Java Hot Rod clients can handle Java objects that represent entities and\n+perform marshalling to serialize and deserialize objects into `byte[]` arrays.\n+C{plusplus}, C#, and Javascript Hot Rod clients can also handle objects in the\n+respective languages.\n+\n+If you store entries in the cache as marshalled Java objects, you should configure the cache with the MediaType of the marshalled storage.\n+\n+.Procedure\n+\n+. Specify the MediaType that matches your marshaller implementation.\n++\n+* Protostream marshaller: Configure the MediaType as `application/x-protostream`.\n+* JBoss marshalling: Configure the MediaType as `application/x-jboss-marshalling`.\n+* StringMarshaller: Configure the MediaType as `text/plain`.", "originalCommit": "f4a862e35aaabf1d4a7011ad1faa517b3aa1e683", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk3MDMxNw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457970317", "bodyText": "@ryanemerson perhaps I should ask you this question too. here we list protostream, jboss marshalling, and the string marshaller. should we include kyro and protostuff?", "author": "oraNod", "createdAt": "2020-07-21T09:42:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk3Nzk4NQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457977985", "bodyText": "I don't think so, as we don't have clear documentation on what would be required to get these working on the server-side. Tbh they haven't had any attention since they were implemented from us or users AFAIK. IMO I think we should deprecate them \\cc @tristantarrant.", "author": "ryanemerson", "createdAt": "2020-07-21T09:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0OTczNg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458049736", "bodyText": "There's also the vanilla java serialization: application/x-java-serialized-object\nRegarding Kryo and protostuff, there is no transcoder for them currently, so conversions won't work", "author": "gustavonalle", "createdAt": "2020-07-21T12:14:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE2MTAxNQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458161015", "bodyText": "@ryanemerson and @gustavonalle should kryo and protostuff be in docs for community only?", "author": "oraNod", "createdAt": "2020-07-21T14:54:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2ODIyMg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r459368222", "bodyText": "Yes", "author": "ryanemerson", "createdAt": "2020-07-23T10:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyNjU1Ng==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r455926556", "bodyText": "@gustavonalle I think this code example needs to be updated.\nplease correct my understanding but could we update the example to show application/x-protostream instead of application/x-java-object in the ConfigurationBuilder? then show application/x-java-object as the override?", "author": "oraNod", "createdAt": "2020-07-16T16:46:12Z", "path": "documentation/src/main/asciidoc/topics/proc_using_multiple_storage_formats.adoc", "diffHunk": "@@ -0,0 +1,29 @@\n+[id='mediatype_override-{context}']\n+= Using Multiple Storage Formats for Custom Code\n+You can deploy and run custom code on {brandname}, such as tasks, listeners,\n+and merge policies. Custom code on {brandname} can directly access data but \n+must also interoperate with clients that access the same data through different\n+endpoints. For example, you can create tasks that handle custom objects while\n+Hot Rod clients read and write data in binary format.\n+\n+In this case, you can configure `application/x-protostream` as the cache\n+encoding to store data in binary format then configure your custom code to\n+perform cache operations using a different MediaType.\n+\n+For example:\n+\n+[source,java]\n+----\n+include::code_examples/EncodeMediaTypeOverride.java[]", "originalCommit": "f4a862e35aaabf1d4a7011ad1faa517b3aa1e683", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA1ODYwOA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458058608", "bodyText": "This section was not part of the protocol interoperability? I need to check the context where it is inserted then I will let you know", "author": "gustavonalle", "createdAt": "2020-07-21T12:30:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyNjU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1NDEzMQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458154131", "bodyText": "thanks @gustavonalle tbh I find this topic is a little confusing. what I've been trying to do in this PR is separate the details about mediatype encoding into distinct procedures.\nin the current docs, mediatype configuration is included in the section about encoders/transcoders. IMO those details are a little advanced and can make it difficult to understand for users who are trying to get up and running. so I think it makes sense to move the procedure for configuring mediatypes to the protocol interoperability section. maybe we should move this back to the encoding section as well if it's for more advanced cases.", "author": "oraNod", "createdAt": "2020-07-21T14:45:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyNjU1Ng=="}], "type": "inlineReview"}, {"oid": "9ce554d9c82af5282f58e6be1bd1d4497826bb92", "url": "https://github.com/infinispan/infinispan/commit/9ce554d9c82af5282f58e6be1bd1d4497826bb92", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-16T16:51:15Z", "type": "forcePushed"}, {"oid": "804a83ca8d1c70fd6e1619d1fee5b5afe0e0e21e", "url": "https://github.com/infinispan/infinispan/commit/804a83ca8d1c70fd6e1619d1fee5b5afe0e0e21e", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-20T16:08:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMDQyNQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457930425", "bodyText": "EvictionStrategy.REMOVE. The method does not accept a string, only the EvictionStategy enum as an argument.", "author": "ryanemerson", "createdAt": "2020-07-21T08:35:07Z", "path": "documentation/src/main/asciidoc/topics/code_examples/MaxSizeMemory.java", "diffHunk": "@@ -0,0 +1,9 @@\n+ConfigurationBuilder cfg = new ConfigurationBuilder();\n+\n+cfg\n+  .encoding()\n+    .mediaType(\"application/x-protostream\")\n+  .memory()\n+    .maxSize(\"1.5GB\")\n+    .whenFull(\"REMOVE\")", "originalCommit": "804a83ca8d1c70fd6e1619d1fee5b5afe0e0e21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk2MTA2Ng==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457961066", "bodyText": "good catch, thanks. I even have that elsewhere in the docs. I should RTFM myself...", "author": "oraNod", "createdAt": "2020-07-21T09:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMDQyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk2MzQ4OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457963489", "bodyText": "This is where compiling code examples would really come in handy.", "author": "ryanemerson", "createdAt": "2020-07-21T09:30:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMDQyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk3MzcxNA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457973714", "bodyText": "indeed. one day... I've made a couple of attempts with jbang but I think I'm going to need someone with better java skillz. (wink, wink).", "author": "oraNod", "createdAt": "2020-07-21T09:48:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMDQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMjk2NQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457932965", "bodyText": "This is the \"user marshaller\" as it's only concerned with user key/values. The global marshaller is what we use internally for Infinispan classes.", "author": "ryanemerson", "createdAt": "2020-07-21T08:39:31Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_custom_java_objects.adoc", "diffHunk": "@@ -0,0 +1,42 @@\n+[id='storing_binary_objects-{context}']\n+= Storing Java Objects in Binary Format\n+Java Hot Rod clients can handle Java objects that represent entities and\n+perform marshalling to serialize and deserialize objects into `byte[]` arrays.\n+C{plusplus}, C#, and Javascript Hot Rod clients can also handle objects in the\n+respective languages.\n+\n+If you store entries in the cache as marshalled Java objects, you should configure the cache with the MediaType of the marshalled storage.\n+\n+.Procedure\n+\n+. Specify the MediaType that matches your marshaller implementation.\n++\n+* Protostream marshaller: Configure the MediaType as `application/x-protostream`.\n+* JBoss marshalling: Configure the MediaType as `application/x-jboss-marshalling`.\n+* StringMarshaller: Configure the MediaType as `text/plain`.\n++\n+[NOTE]\n+====\n+Alternatively, you can define a global marshaller with the `serialization`", "originalCommit": "804a83ca8d1c70fd6e1619d1fee5b5afe0e0e21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk2OTA0Mg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457969042", "bodyText": "thanks @ryanemerson that's a good clarification. can you please confirm the changes I made?", "author": "oraNod", "createdAt": "2020-07-21T09:39:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMjk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkzMzc1OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457933759", "bodyText": "Ideally the default, which is ProtoStream.", "author": "ryanemerson", "createdAt": "2020-07-21T08:40:54Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_pojos.adoc", "diffHunk": "@@ -0,0 +1,33 @@\n+[id='storing_pojos-{context}']\n+= Storing Deserialized Objects\n+You can store data as unmarshalled, Plain Old Java Objects (POJO) instead of\n+storing data in a binary format. However, this is not recommended because it\n+requires {brandname} to serialize data on client read operations and\n+deserialize data on write operations.\n+\n+.Procedure\n+\n+. Specify `application/x-java-object as the MediaType for keys and values as follows:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_java_object.xml[]\n+----\n++\n+. Put class files for all custom objects on the {brandname} server classpath.\n++\n+Add JAR files that contain custom classes and/or service providers for\n+marshaller implementations in the `server/lib` directory.\n++\n+----\n+\u251c\u2500\u2500 server\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n+\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 UserObjects.jar\n+\u2502\u00a0\u00a0  \u00a0\u00a0 \u2514\u2500\u2500 README.txt\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients must use a marshaller to handle POJOs, either the JBoss marshaller or the Java serialization mechanism.", "originalCommit": "804a83ca8d1c70fd6e1619d1fee5b5afe0e0e21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2fd7180e0d7c41fee40869670ff85027d5133ac", "url": "https://github.com/infinispan/infinispan/commit/e2fd7180e0d7c41fee40869670ff85027d5133ac", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-21T09:37:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk3ODkwOQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r457978909", "bodyText": "\"of the defined marshaller\"?", "author": "ryanemerson", "createdAt": "2020-07-21T09:57:04Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_custom_java_objects.adoc", "diffHunk": "@@ -0,0 +1,43 @@\n+[id='storing_binary_objects-{context}']\n+= Storing Java Objects in Binary Format\n+Java Hot Rod clients can handle Java objects that represent entities and\n+perform marshalling to serialize and deserialize objects into `byte[]` arrays.\n+C{plusplus}, C#, and Javascript Hot Rod clients can also handle objects in the\n+respective languages.\n+\n+If you store entries in the cache as marshalled Java objects, you should configure the cache with the MediaType of the marshalled storage.\n+\n+.Procedure\n+\n+. Specify the MediaType that matches your marshaller implementation.\n++\n+* Protostream marshaller: Configure the MediaType as `application/x-protostream`.\n+* JBoss marshalling: Configure the MediaType as `application/x-jboss-marshalling`.\n+* StringMarshaller: Configure the MediaType as `text/plain`.\n++\n+[NOTE]\n+====\n+Alternatively, you can declaratively configure the marshaller with the\n+`serialization` element or invoke the `serialization()` method in the\n+`GlobalConfigurationBuilder` class. When you configure the marshaller in this\n+way, {brandname} uses the MediaType for the defined marshaller to encode", "originalCommit": "e2fd7180e0d7c41fee40869670ff85027d5133ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0MjExNg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458042116", "bodyText": "Concurrently gives the impression of threading, what about saying?\nDefine a storage format for your data so you can use the same cache from the\n{brandname} Console, REST clients, and Hot Rod clients", "author": "gustavonalle", "createdAt": "2020-07-21T11:59:36Z", "path": "documentation/src/main/asciidoc/stories/assembly_interoperability_remote_clients.adoc", "diffHunk": "@@ -0,0 +1,18 @@\n+[id='endpoint_interop']\n+:context: data\n+= Configuring Storage Formats for Remote Client Interoperability\n+Define a storage format for your data so you can operate on entries from the\n+{brandname} Console, REST clients, and Hot Rod clients concurrently.", "originalCommit": "20cbe3c06aa08cbb3f5e5481a9cb2dd83ce2921d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE2MjI3MQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458162271", "bodyText": "sounds good. thx.", "author": "oraNod", "createdAt": "2020-07-21T14:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0MjExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0NDE3OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458044179", "bodyText": "I am having second thoughts on this. If the cache stores a random text in UTF-8, it should be readable from other clients such as node.js and C#. So this is a Y", "author": "gustavonalle", "createdAt": "2020-07-21T12:03:41Z", "path": "documentation/src/main/asciidoc/topics/con_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[id='storage_formats_client_interop-{context}']\n+= Storage Formats and Client Interoperability\n+HTTP and Hot Rod protocols are designed to handle data in different formats.\n+For example, Hot Rod is designed to send and receive binary data while REST\n+clients are best suited for handling text-based formats such as JSON, XML, or\n+plain text.\n+\n+By configuring the MediaType for keys and values, you describe the data format\n+of the cache. {brandname} can then convert data on the fly during cache\n+operations.\n+\n+If you want to use the {brandname} Console, Hot Rod clients, and REST clients\n+interchangeably when operating on data, you should configure caches to use the\n+Protobuf storage format.\n+\n+Storing data in other formats affects client interoperability and {brandname}\n+capabilities, as follows:\n+\n+.Protobuf Storage\n+[%header,cols=2*]\n+|===\n+2+| Protobuf storage is suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| Yes\n+| {brandname} Search\n+| Yes\n+| Custom Java objects\n+| Yes\n+|===\n+\n+.Text-Based Storage\n+[%header,cols=2*]\n+|===\n+2+| Text-based storage formats are suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No", "originalCommit": "20cbe3c06aa08cbb3f5e5481a9cb2dd83ce2921d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0NDk0Nw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458044947", "bodyText": "Let's be more specific here, saying \"Marshalled Java Objects\"", "author": "gustavonalle", "createdAt": "2020-07-21T12:05:15Z", "path": "documentation/src/main/asciidoc/topics/con_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[id='storage_formats_client_interop-{context}']\n+= Storage Formats and Client Interoperability\n+HTTP and Hot Rod protocols are designed to handle data in different formats.\n+For example, Hot Rod is designed to send and receive binary data while REST\n+clients are best suited for handling text-based formats such as JSON, XML, or\n+plain text.\n+\n+By configuring the MediaType for keys and values, you describe the data format\n+of the cache. {brandname} can then convert data on the fly during cache\n+operations.\n+\n+If you want to use the {brandname} Console, Hot Rod clients, and REST clients\n+interchangeably when operating on data, you should configure caches to use the\n+Protobuf storage format.\n+\n+Storing data in other formats affects client interoperability and {brandname}\n+capabilities, as follows:\n+\n+.Protobuf Storage\n+[%header,cols=2*]\n+|===\n+2+| Protobuf storage is suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| Yes\n+| {brandname} Search\n+| Yes\n+| Custom Java objects\n+| Yes\n+|===\n+\n+.Text-Based Storage\n+[%header,cols=2*]\n+|===\n+2+| Text-based storage formats are suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No\n+| {brandname} Search\n+| No\n+| Custom Java objects\n+| No\n+|===\n+\n+.Custom Java Objects", "originalCommit": "20cbe3c06aa08cbb3f5e5481a9cb2dd83ce2921d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0NTI4MQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458045281", "bodyText": "please add \"and  make the classes available in the server\"", "author": "gustavonalle", "createdAt": "2020-07-21T12:05:54Z", "path": "documentation/src/main/asciidoc/topics/con_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[id='storage_formats_client_interop-{context}']\n+= Storage Formats and Client Interoperability\n+HTTP and Hot Rod protocols are designed to handle data in different formats.\n+For example, Hot Rod is designed to send and receive binary data while REST\n+clients are best suited for handling text-based formats such as JSON, XML, or\n+plain text.\n+\n+By configuring the MediaType for keys and values, you describe the data format\n+of the cache. {brandname} can then convert data on the fly during cache\n+operations.\n+\n+If you want to use the {brandname} Console, Hot Rod clients, and REST clients\n+interchangeably when operating on data, you should configure caches to use the\n+Protobuf storage format.\n+\n+Storing data in other formats affects client interoperability and {brandname}\n+capabilities, as follows:\n+\n+.Protobuf Storage\n+[%header,cols=2*]\n+|===\n+2+| Protobuf storage is suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| Yes\n+| {brandname} Search\n+| Yes\n+| Custom Java objects\n+| Yes\n+|===\n+\n+.Text-Based Storage\n+[%header,cols=2*]\n+|===\n+2+| Text-based storage formats are suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No\n+| {brandname} Search\n+| No\n+| Custom Java objects\n+| No\n+|===\n+\n+.Custom Java Objects\n+[%header,cols=2*]\n+|===\n+2+| Custom Java objects are compatible with...\n+| {brandname} Console\n+| No\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No\n+| {brandname} Search\n+| No\n+|===\n+\n+.Plain Old Java Objects (POJO)\n+[%header,cols=2*]\n+|===\n+2+| POJOs are not recommended but compatible with...\n+| {brandname} Console\n+| No\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No\n+| {brandname} Search\n+| Yes. However, you must annotate entities to search with POJOs.", "originalCommit": "20cbe3c06aa08cbb3f5e5481a9cb2dd83ce2921d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0NjY1Mg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458046652", "bodyText": "Suggestion:\n{brandname} supports converions between `application/x-protostream` and\n`application/json` so that REST clients can read and write JSON formatted data.", "author": "gustavonalle", "createdAt": "2020-07-21T12:08:25Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_protobuf_encoding.adoc", "diffHunk": "@@ -0,0 +1,33 @@\n+[id='configuring_protobuf_encoding-{context}']\n+= Using Protobuf Encoding for Data\n+Storing data in the cache as Protobuf encoded entries provides a platform\n+independent configuration that enables you to perform cache operations from any\n+client.\n+\n+.Procedure\n+\n+. Specify `application/x-protostream` as the MediaType for keys and values as follows:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_protostream.xml[]\n+----\n++\n+[NOTE]\n+====\n+When you configure indexing, {brandname} automatically stores keys and values\n+with the `application/x-protostream` media type.\n+====\n++\n+. Configure your clients.\n+\n+For Hot Rod clients, you must register Protocol Buffers schema definitions to\n+describe the entities and marshallers that the clients use.\n+\n+{brandname} automatically converts between `application/x-protostream` and\n+`application/json` so that REST clients can read and write JSON formatted data.", "originalCommit": "20cbe3c06aa08cbb3f5e5481a9cb2dd83ce2921d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA0ODI3OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r458048279", "bodyText": "Some nuance here: for text based format, protostream can also be used without registering proto files :)", "author": "gustavonalle", "createdAt": "2020-07-21T12:11:28Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_textbased_encoding.adoc", "diffHunk": "@@ -0,0 +1,28 @@\n+[id='using_text_based_storage-{context}']\n+= Using Text-Based Formats for Data\n+You can configure {brandname} to encode data in text-based formats such as\n+`text/plain`, `application/json`, or `application/xml`.\n+\n+.Procedure\n+\n+. Specify a text-based storage format as the MediaType for keys and values.\n+. Optionally specify a character set such as `UTF-8`.\n++\n+The following example configures {brandname} to store entries with the `text/plain; charset=UTF-8` format:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_text_plain.xml[]\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients can use the\n+\n+* `org.infinispan.commons.marshall.StringMarshaller` handles plain text, JSON, XML, or any other text-based format.\n+* ProtoStream can handle JSON only but offers more flexibility for storing data in binary format. However, you must create Serialization Contexts and provide Protobuf schemas (`.proto` files) to use ProtoStream.\n+", "originalCommit": "20cbe3c06aa08cbb3f5e5481a9cb2dd83ce2921d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "079f33eaafcd39ff46856c2cd716100817f65aec", "url": "https://github.com/infinispan/infinispan/commit/079f33eaafcd39ff46856c2cd716100817f65aec", "message": "add link to kb article", "committedDate": "2020-07-22T12:42:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAzOTg3NQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r459039875", "bodyText": "I would add a link to the transcoder section, to clarify that \"can\".", "author": "rgordill", "createdAt": "2020-07-22T19:43:52Z", "path": "documentation/src/main/asciidoc/topics/con_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[id='storage_formats_client_interop-{context}']\n+= Storage Formats and Client Interoperability\n+HTTP and Hot Rod protocols are designed to handle data in different formats.\n+For example, Hot Rod is designed to send and receive binary data while REST\n+clients are best suited for handling text-based formats such as JSON, XML, or\n+plain text.\n+\n+By configuring the MediaType for keys and values, you describe the data format\n+of the cache. {brandname} can then convert data on the fly during cache\n+operations.", "originalCommit": "079f33eaafcd39ff46856c2cd716100817f65aec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6e07031a7c66d7e431f80254ebfeb00f21bcf379", "url": "https://github.com/infinispan/infinispan/commit/6e07031a7c66d7e431f80254ebfeb00f21bcf379", "message": "add link to kb article", "committedDate": "2020-07-23T10:50:16Z", "type": "forcePushed"}, {"oid": "ff200492c29cd7e47b9ac4be68ab50221804da2a", "url": "https://github.com/infinispan/infinispan/commit/ff200492c29cd7e47b9ac4be68ab50221804da2a", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-24T13:43:35Z", "type": "forcePushed"}, {"oid": "f263691a3629172cff01416e12de183530caabf7", "url": "https://github.com/infinispan/infinispan/commit/f263691a3629172cff01416e12de183530caabf7", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-24T14:26:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcyNzg4OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460727889", "bodyText": "This link seems dead", "author": "gustavonalle", "createdAt": "2020-07-27T08:28:40Z", "path": "documentation/src/main/asciidoc/topics/con_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,91 @@\n+[id='storage_formats_client_interop-{context}']\n+= Storage Formats and Client Interoperability\n+HTTP and Hot Rod protocols are designed to handle data in different formats.\n+For example, Hot Rod is designed to send and receive binary data while REST\n+clients are best suited for handling text-based formats such as JSON, XML, or\n+plain text.\n+\n+By configuring the MediaType for keys and values, you describe the data format\n+of the cache. {brandname} can then convert data on the fly during cache\n+operations.\n+\n+If you want to use the {brandname} Console, Hot Rod clients, and REST clients\n+interchangeably when operating on data, you should configure caches to use the\n+Protobuf storage format.\n+\n+Storing data in other formats affects client interoperability and {brandname}\n+capabilities, as follows:\n+\n+.Protobuf Storage\n+[%header,cols=2*]\n+|===\n+2+| Protobuf storage is suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| Yes\n+| {brandname} Search\n+| Yes\n+| Custom Java objects\n+| Yes\n+|===\n+\n+.Text-Based Storage\n+[%header,cols=2*]\n+|===\n+2+| Text-based storage formats are suitable for...\n+| {brandname} Console\n+| Yes\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| Yes\n+| {brandname} Search\n+| No\n+| Custom Java objects\n+| No\n+|===\n+\n+.Marshalled Java Objects\n+[%header,cols=2*]\n+|===\n+2+| Custom Java objects are compatible with...\n+| {brandname} Console\n+| No\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No\n+| {brandname} Search\n+| No\n+|===\n+\n+.Plain Old Java Objects (POJO)\n+[%header,cols=2*]\n+|===\n+2+| POJOs are not recommended but compatible with...\n+| {brandname} Console\n+| No\n+| REST clients\n+| Yes\n+| Java Hot Rod clients\n+| Yes\n+| Non-Java Hot Rod clients\n+| No\n+| {brandname} Search\n+| Yes. However, you must annotate entities to search with POJOs and make your classes available to {brandname} Server.\n+| Custom Java objects\n+| Yes\n+|===\n+\n+.Reference\n+\n+link:{dev_docs}#transcoders_and_data_conversion[Transcoders and Data Conversion]", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMDQxMA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460900410", "bodyText": "fixed. thanks.", "author": "oraNod", "createdAt": "2020-07-27T13:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcyNzg4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMTQ5NA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460731494", "bodyText": "Actually you can, provided keys are String", "author": "gustavonalle", "createdAt": "2020-07-27T08:34:39Z", "path": "documentation/src/main/asciidoc/topics/ref_memcached_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+[id='memcached_interoperability-{context}']\n+= Interoperability with Memcached Clients\n+The {brandname} Server Memcached endpoint is deprecated and disabled by\n+default. If you enable the Memcached endpoint, you should use a text-based\n+storage format for data. Memcached clients do not require any configuration to\n+handle text-based formats.\n+\n+Memcached text clients can handle String-based keys and `byte[]` values but\n+cannot negotiate data types with {brandname}. These clients do not offer much\n+flexibility when handling data formats because of the protocol definition.\n+\n+[NOTE]\n+====\n+If you enable the Memcached endpoint, you should not use REST or Hot Rod\n+clients to interoperate on the same data as Memcached clients.\n+====", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDM2NQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460904365", "bodyText": "@gustavonalle this note came from @wfink I think the intent of the note here is centered around security so I've updated to make that meaning a little more clear.", "author": "oraNod", "createdAt": "2020-07-27T13:51:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMTQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxMjUzOA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460912538", "bodyText": "Ok, probably because the memcached cannot use auth. So yeah, it's a bad idea, but there's a conflict of interest here: we are documenting the interop of memcached and right after telling user \"don't do it\" :), and we are marking it as \"deprecated\" but still maintaining it since at least 2 majors.\n@tristantarrant Why don't we simply remove it, as it is a liability?", "author": "gustavonalle", "createdAt": "2020-07-27T14:02:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDczMTQ5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc0MTY1Ng==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460741656", "bodyText": "The proposed changes for memcached in this PR are not totally correct and some info got lost from master\nPlease check the memcached sections on https://infinispan.org/docs/stable/titles/developing/developing.html#endpoint_interop\nI will summarize the main points here:\n\nUsers must always use Strings in the keys, it they want to access the cache from all Memcached/HotRod/REST protocols\nThe value can be anything that can be stored as byte[]: marshalled pojo, random bytes, UTF-8, etc. So basically only POJO storage is ruled out from using memcached\nSince the value is a byte[] from memcached point of view, that does not mean there is no flexibility. Some Java Memcached clients allow data transformers that marshall and unmarshall objects, just like the Hot Rod client does.", "author": "gustavonalle", "createdAt": "2020-07-27T08:51:38Z", "path": "documentation/src/main/asciidoc/topics/ref_memcached_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+[id='memcached_interoperability-{context}']\n+= Interoperability with Memcached Clients", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc0NDA3NQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460744075", "bodyText": "This snippet is being used as an illustration in the section \"Configuring the Storage Format for Data\", but IMHO this is noisy as it is also using eviction. All you need it\n<local-cache>\n  <encoding media-type=\"application/x-protostream\"/>\n</local-cache>", "author": "gustavonalle", "createdAt": "2020-07-27T08:55:29Z", "path": "documentation/src/main/asciidoc/topics/config_examples/max_count_memory.xml", "diffHunk": "@@ -0,0 +1,4 @@\n+<local-cache name=\"maximum_count\">\n+  <encoding media-type=\"application/x-protostream\"/>\n+  <memory max-count=\"500\" when-full=\"REMOVE\"/>\n+</local-cache>", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc0NzA3Mg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460747072", "bodyText": "This is rendered as\nConfigurationBuilder cfg = new ConfigurationBuilder();\n\ncfg\n  .encoding()\n    .mediaType(\"application/x-protostream\")\n  .memory()\n    .maxSize(\"1.5GB\")\n    .whenFull(EvictionStrategy.REMOVE)\n  .build());\nIt should not have unrelated eviction config", "author": "gustavonalle", "createdAt": "2020-07-27T09:00:15Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_storage_format.adoc", "diffHunk": "@@ -0,0 +1,39 @@\n+[id='configuring_storage_format_data-{context}']\n+= Configuring the Storage Format for Data\n+You configure the format in which {brandname} stores data by defining the\n+MediaType for keys and values.\n+\n+.Procedure\n+\n+* Specify the MediaType for entries in your {brandname} cache configuration.\n+\n+.Declarative examples\n+\n+The following cache definition uses the same encoding for keys and values:\n+\n+----\n+include::config_examples/max_memory.xml[]\n+----\n+\n+The following cache definition uses a different encoding for keys and values:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_media_type.xml[]\n+----\n+\n+.Programmatic examples\n+\n+The following `ConfigurationBuilder` uses the same encoding for keys and values:\n+\n+[source,java,options=\"nowrap\"]\n+----\n+include::code_examples/MaxSizeMemory.java[]", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc0ODM5MQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460748391", "bodyText": "<cache>\n   <encoding>\n      <key media-type=\"application/x-java-object; type=java.lang.Integer\"/>\n      <value media-type=\"application/xml; charset=UTF-8\"/>\n   </encoding>\n</cache>\nPlease remove the type=java.lang.Integer from the encoding, it is not enforced currently", "author": "gustavonalle", "createdAt": "2020-07-27T09:02:30Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_storage_format.adoc", "diffHunk": "@@ -0,0 +1,39 @@\n+[id='configuring_storage_format_data-{context}']\n+= Configuring the Storage Format for Data\n+You configure the format in which {brandname} stores data by defining the\n+MediaType for keys and values.\n+\n+.Procedure\n+\n+* Specify the MediaType for entries in your {brandname} cache configuration.\n+\n+.Declarative examples\n+\n+The following cache definition uses the same encoding for keys and values:\n+\n+----\n+include::config_examples/max_memory.xml[]\n+----\n+\n+The following cache definition uses a different encoding for keys and values:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_media_type.xml[]", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1MDMzNg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460750336", "bodyText": "Better say \"store data\" instead to \"encode data\"", "author": "gustavonalle", "createdAt": "2020-07-27T09:05:57Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_textbased_encoding.adoc", "diffHunk": "@@ -0,0 +1,33 @@\n+[id='using_text_based_storage-{context}']\n+= Using Text-Based Formats for Data\n+You can configure {brandname} to encode data in text-based formats such as", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1MjE1NA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460752154", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you want to use text-based formats and binary data with Hot Rod clients, you\n          \n          \n            \n            should use ProtoStream marshalling. ProtoStream can handle plain text and JSON \n          \n          \n            \n            without the need to create Serialization Contexts and register Protobuf\n          \n          \n            \n            schemas. However, ProtoStream does not support XML.\n          \n          \n            \n            Text-based formats can also be used with the Protostream marshaller in the Hot Rod client\n          \n          \n            \n            without the need to create Serialization Contexts and register Protobuf\n          \n          \n            \n            schemas, since it can handle ```String``` and ```byte[]``` types natively", "author": "gustavonalle", "createdAt": "2020-07-27T09:09:21Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_textbased_encoding.adoc", "diffHunk": "@@ -0,0 +1,33 @@\n+[id='using_text_based_storage-{context}']\n+= Using Text-Based Formats for Data\n+You can configure {brandname} to encode data in text-based formats such as\n+`text/plain`, `application/json`, or `application/xml`.\n+\n+.Procedure\n+\n+. Specify a text-based storage format as the MediaType for keys and values.\n+. Optionally specify a character set such as `UTF-8`.\n++\n+The following example configures {brandname} to store entries with the `text/plain; charset=UTF-8` format:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_text_plain.xml[]\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients can use `org.infinispan.commons.marshall.StringMarshaller`\n+to handle plain text, JSON, XML, or any other text-based format.\n+\n+If you want to use text-based formats and binary data with Hot Rod clients, you\n+should use ProtoStream marshalling. ProtoStream can handle plain text and JSON \n+without the need to create Serialization Contexts and register Protobuf\n+schemas. However, ProtoStream does not support XML.", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1NjAwNg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460756006", "bodyText": "I sense some duality between \"text\" and \"binary\" throughout the docs.\nLet me clarify: \"text\" is also binary for all it matters. text/plain, application/json, application/xml, are all stored as byte[] inside the cache. The media type is just a description of what is inside that byte[].", "author": "gustavonalle", "createdAt": "2020-07-27T09:16:02Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_textbased_encoding.adoc", "diffHunk": "@@ -0,0 +1,33 @@\n+[id='using_text_based_storage-{context}']\n+= Using Text-Based Formats for Data\n+You can configure {brandname} to encode data in text-based formats such as\n+`text/plain`, `application/json`, or `application/xml`.\n+\n+.Procedure\n+\n+. Specify a text-based storage format as the MediaType for keys and values.\n+. Optionally specify a character set such as `UTF-8`.\n++\n+The following example configures {brandname} to store entries with the `text/plain; charset=UTF-8` format:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_text_plain.xml[]\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients can use `org.infinispan.commons.marshall.StringMarshaller`\n+to handle plain text, JSON, XML, or any other text-based format.\n+\n+If you want to use text-based formats and binary data with Hot Rod clients, you\n+should use ProtoStream marshalling. ProtoStream can handle plain text and JSON \n+without the need to create Serialization Contexts and register Protobuf\n+schemas. However, ProtoStream does not support XML.\n+\n+ProtoStream offers more flexibility for storing data in binary format. However, you must  and provide Protobuf schemas (`.proto` files) to use ProtoStream.", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1NjM1Ng==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460756356", "bodyText": "Also, I think we haven't been camel casing Protostream", "author": "gustavonalle", "createdAt": "2020-07-27T09:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1NjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzNjY2Nw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460936667", "bodyText": "hmm. I've used camel case for ProtoStream elsewhere in docs. it also appears that way at: https://javadoc.io/doc/org.infinispan.protostream/protostream/latest/index.html", "author": "oraNod", "createdAt": "2020-07-27T14:34:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1NjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk0NTAxMA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460945010", "bodyText": "Sorry, I was wrong. Even ProtoStream itself uses it \ud83d\ude04", "author": "gustavonalle", "createdAt": "2020-07-27T14:46:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1NjAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1NzM2OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460757369", "bodyText": "I think it's better to not list StringMarshaller, here, since it's about Storing Java Objects in Binary Format", "author": "gustavonalle", "createdAt": "2020-07-27T09:18:29Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_custom_java_objects.adoc", "diffHunk": "@@ -0,0 +1,65 @@\n+[id='storing_binary_objects-{context}']\n+= Storing Java Objects in Binary Format\n+Java Hot Rod clients can handle Java objects that represent entities and\n+perform marshalling to serialize and deserialize objects into `byte[]` arrays.\n+C{plusplus}, C#, and Javascript Hot Rod clients can also handle objects in the\n+respective languages.\n+\n+If you store entries in the cache as marshalled Java objects, you should\n+configure the cache with the MediaType of the marshalled storage.\n+\n+.Procedure\n+\n+. Specify the MediaType that matches your marshaller implementation.\n++\n+* Protostream marshaller: Configure the MediaType as `application/x-protostream`.\n+* JBoss marshalling: Configure the MediaType as `application/x-jboss-marshalling`.\n+* StringMarshaller: Configure the MediaType as `text/plain`.", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1Nzk4OQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r460757989", "bodyText": "Unclosed backquote", "author": "gustavonalle", "createdAt": "2020-07-27T09:19:33Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_pojos.adoc", "diffHunk": "@@ -0,0 +1,42 @@\n+[id='storing_pojos-{context}']\n+= Storing Deserialized Objects\n+You can store data as unmarshalled, Plain Old Java Objects (POJO) instead of\n+storing data in a binary format.\n+\n+Storing POJO instead of binary format is not recommended because it\n+requires {brandname} to serialize data on client read operations and\n+deserialize data on write operations. To handle client interoperability with\n+custom code you should convert data on demand.\n+\n+.Procedure\n+\n+. Specify `application/x-java-object as the MediaType for keys and values as follows:", "originalCommit": "f263691a3629172cff01416e12de183530caabf7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e793ce1dfa27ada14085911163eeb35c1bcef1f0", "url": "https://github.com/infinispan/infinispan/commit/e793ce1dfa27ada14085911163eeb35c1bcef1f0", "message": "Gustavo review feedback", "committedDate": "2020-07-27T15:21:50Z", "type": "forcePushed"}, {"oid": "5240d752b21149d3a56efc3fbfc899c16bfb75ad", "url": "https://github.com/infinispan/infinispan/commit/5240d752b21149d3a56efc3fbfc899c16bfb75ad", "message": "Gustavo review feedback", "committedDate": "2020-07-27T15:26:47Z", "type": "forcePushed"}, {"oid": "3510606e01a2dadc5f94d34bee13615d6cb4d8ea", "url": "https://github.com/infinispan/infinispan/commit/3510606e01a2dadc5f94d34bee13615d6cb4d8ea", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-28T11:01:10Z", "type": "forcePushed"}, {"oid": "433572315ba7b378ea1ac5ca2e01fe697aab610f", "url": "https://github.com/infinispan/infinispan/commit/433572315ba7b378ea1ac5ca2e01fe697aab610f", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-07-28T15:35:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4MjA2Mw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r467782063", "bodyText": "However, ProtoStream cannot handle XML.\nThis phrase can be safely removed. If the cache is confgured as application/xml and protostream is the marshaller used, it can write an XML in UTF-8 byte[], so it does not need to \"handle\" XML", "author": "gustavonalle", "createdAt": "2020-08-10T09:20:49Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_textbased_encoding.adoc", "diffHunk": "@@ -0,0 +1,31 @@\n+[id='using_text_based_storage-{context}']\n+= Storing Data in Text-Based Formats\n+Configure {brandname} to store data in a text-based format such as `text/\n+plain`, `application/json`, or `application/xml`.\n+\n+.Procedure\n+\n+. Specify a text-based storage format as the MediaType for keys and values.\n+. Optionally specify a character set such as `UTF-8`.\n++\n+The following example configures {brandname} to store entries with the `text/plain; charset=UTF-8` format:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_text_plain.xml[]\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients can use `org.infinispan.commons.marshall.StringMarshaller`\n+to handle plain text, JSON, XML, or any other text-based format.\n+\n+You can also use text-based formats with the ProtoStream marshaller.\n+ProtoStream can handle `String` and `byte[]` types natively, without the need\n+to create Serialization Contexts and register Protobuf schemas (`.proto`\n+files). However, ProtoStream cannot handle XML.", "originalCommit": "433572315ba7b378ea1ac5ca2e01fe697aab610f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NTQ3Mg==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r467785472", "bodyText": "This note is not correct. When the user does not specify the media type for server caches, Infinispan will not do any encoding to store data, and will simple assume \"unknown\" type and will store whatever it receives. I think it's better to remove this NOTE altogether, even because this will change on ISPN 12: we will assume protobuf storage by default", "author": "gustavonalle", "createdAt": "2020-08-10T09:27:39Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_custom_java_objects.adoc", "diffHunk": "@@ -0,0 +1,65 @@\n+[id='storing_binary_objects-{context}']\n+= Storing Marshalled Java Objects\n+Java Hot Rod clients can handle Java objects that represent entities and\n+perform marshalling to serialize and deserialize objects into `byte[]` arrays.\n+C{plusplus}, C#, and Javascript Hot Rod clients can also handle objects in the\n+respective languages.\n+\n+If you store entries in the cache as marshalled Java objects, you should\n+configure the cache with the MediaType of the marshalled storage.\n+\n+.Procedure\n+\n+. Specify the MediaType that matches your marshaller implementation.\n++\n+* Protostream marshaller: Configure the MediaType as `application/x-protostream`.\n+* JBoss marshalling: Configure the MediaType as `application/x-jboss-marshalling`.\n+* Java serialization: Configure the MediaType as `application/x-java-serialized-object`.\n++\n+[NOTE]\n+====\n+Alternatively, you can declaratively configure the marshaller with the\n+`serialization` element or invoke the `serialization()` method in the\n+`GlobalConfigurationBuilder` class. When you configure the marshaller in this\n+way, {brandname} uses the MediaType of the defined marshaller to encode\n+entries.", "originalCommit": "433572315ba7b378ea1ac5ca2e01fe697aab610f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4ODI4MQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r467788281", "bodyText": "It seems this whole section is misplaced here. Most of the time, there is no need to deploy anything in the server when storing marshalled java objects. This is only needed when storing unmarshalled objects.\nhttps://infinispan.org/docs/stable/titles/developing/developing.html#entities_deploy", "author": "gustavonalle", "createdAt": "2020-08-10T09:32:50Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_custom_java_objects.adoc", "diffHunk": "@@ -0,0 +1,65 @@\n+[id='storing_binary_objects-{context}']\n+= Storing Marshalled Java Objects\n+Java Hot Rod clients can handle Java objects that represent entities and\n+perform marshalling to serialize and deserialize objects into `byte[]` arrays.\n+C{plusplus}, C#, and Javascript Hot Rod clients can also handle objects in the\n+respective languages.\n+\n+If you store entries in the cache as marshalled Java objects, you should\n+configure the cache with the MediaType of the marshalled storage.\n+\n+.Procedure\n+\n+. Specify the MediaType that matches your marshaller implementation.\n++\n+* Protostream marshaller: Configure the MediaType as `application/x-protostream`.\n+* JBoss marshalling: Configure the MediaType as `application/x-jboss-marshalling`.\n+* Java serialization: Configure the MediaType as `application/x-java-serialized-object`.\n++\n+[NOTE]\n+====\n+Alternatively, you can declaratively configure the marshaller with the\n+`serialization` element or invoke the `serialization()` method in the\n+`GlobalConfigurationBuilder` class. When you configure the marshaller in this\n+way, {brandname} uses the MediaType of the defined marshaller to encode\n+entries.\n+====\n++\n+. Put class files for all custom objects on the {brandname} Server classpath.\n++\n+Add JAR files that contain custom classes and/or service providers for\n+marshaller implementations in the `server/lib` directory.\n++\n+----\n+\u251c\u2500\u2500 server\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n+\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 UserObjects.jar\n+\u2502\u00a0\u00a0  \u00a0\u00a0 \u2514\u2500\u2500 README.txt\n+----\n++\n+. Configure your clients.\n+\n+Because REST clients are most suitable for handling text formats, you should use primitives such as `java.lang.String` for keys. Otherwise, REST clients must handle keys as `bytes[]` using a supported binary encoding.\n+\n+REST clients can read values for cache entries in XML or JSON format.", "originalCommit": "433572315ba7b378ea1ac5ca2e01fe697aab610f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgwODAzMQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r467808031", "bodyText": "master is more detailed about memcached. I've distilled the info here:\nTo use a memcached client with Infinispan, your cache must use the text/plain media type for the keys, and the\nvalue can be any arbitrary byte[].\n\nMost Java Memcached clients have the capability of plugging a marshaller, so the experience is similar to a Hot Rod client: POJOs are used in the client side, that are converted to/from byte[] when interacting with the server.\nLess capable memcached clients don't have the support for marshallers, and can only read and write the entry values \"as is\".\nTo better support those clients, it is possible to configure the Memcached server so that it always convert the value to specific format (https://infinispan.org/docs/stable/titles/memcached/memcached.html#memcached_client_encoding)\nAn example of usage is a cache that stores protobuf, but with a Memcached connector having client-encoding configured as application/json: memcached clients can read and write json documents, but the storage is a protobuf byte[]", "author": "gustavonalle", "createdAt": "2020-08-10T10:13:39Z", "path": "documentation/src/main/asciidoc/topics/ref_memcached_client_interoperability.adoc", "diffHunk": "@@ -0,0 +1,21 @@\n+[id='memcached_interoperability-{context}']\n+= Memcached Clients and Storage Formats\n+The {brandname} Server Memcached endpoint is deprecated and disabled by\n+default. If you enable the Memcached endpoint, you should use a text-based\n+storage format for data.\n+\n+[IMPORTANT]\n+====\n+The Memcached endpoint does not support authentication. For security purposes\n+you should use dedicated caches for Memcached clients. You should not use REST\n+or Hot Rod clients to interact on the same data set as Memcached clients.\n+====\n+\n+Memcached clients can handle keys only as String and values stored as `byte[]`.\n+However, Memcached clients cannot handle deserialized objects (POJOs).\n+", "originalCommit": "433572315ba7b378ea1ac5ca2e01fe697aab610f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUyNTEzMA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r468525130", "bodyText": "thanks @gustavonalle I don't know why I've been faffing about with the Memcached stuff so much. I've had another go at it and have hopefully captured all the right details now. I think adding an example cache encoding config is helpful. please let me know if you've more nits.", "author": "oraNod", "createdAt": "2020-08-11T11:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgwODAzMQ=="}], "type": "inlineReview"}, {"oid": "f64e68b2b8eeddd28b7fd883783b6169ea2e0ba1", "url": "https://github.com/infinispan/infinispan/commit/f64e68b2b8eeddd28b7fd883783b6169ea2e0ba1", "message": "gustavo feedback", "committedDate": "2020-08-10T12:01:30Z", "type": "forcePushed"}, {"oid": "d414f1f71ddd34198e1407a6cd2b7a49bb3c60ff", "url": "https://github.com/infinispan/infinispan/commit/d414f1f71ddd34198e1407a6cd2b7a49bb3c60ff", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-08-11T11:26:22Z", "type": "forcePushed"}, {"oid": "81a6af0b526093267b4d05743899cf026988f2f9", "url": "https://github.com/infinispan/infinispan/commit/81a6af0b526093267b4d05743899cf026988f2f9", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-08-11T11:54:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIyNjI5OA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r469226298", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {brandname} encodes your data when it reads and writes to and from caches. You\n          \n          \n            \n            {brandname} saves your data in a specific format that can be converted on-the-fly when you read and write to and from caches.", "author": "gustavonalle", "createdAt": "2020-08-12T12:35:22Z", "path": "documentation/src/main/asciidoc/stories/assembly_configuring_data_encoding.adoc", "diffHunk": "@@ -0,0 +1,24 @@\n+[id='endpoint_interop']\n+:context: data\n+= Configuring Cache Encoding\n+{brandname} encodes your data when it reads and writes to and from caches. You", "originalCommit": "81a6af0b526093267b4d05743899cf026988f2f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIyNjQ0MQ==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r469226441", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            configure the encoding by specifying a MediaType for keys and values, which\n          \n          \n            \n            configure the storage format by specifying a MediaType for keys and values, which", "author": "gustavonalle", "createdAt": "2020-08-12T12:35:39Z", "path": "documentation/src/main/asciidoc/stories/assembly_configuring_data_encoding.adoc", "diffHunk": "@@ -0,0 +1,24 @@\n+[id='endpoint_interop']\n+:context: data\n+= Configuring Cache Encoding\n+{brandname} encodes your data when it reads and writes to and from caches. You\n+configure the encoding by specifying a MediaType for keys and values, which", "originalCommit": "81a6af0b526093267b4d05743899cf026988f2f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIzMDI2Ng==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r469230266", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Configure cache encoding to use String, `text/plain`, for keys.\n          \n          \n            \n            . Configure cache encoding to use `text/plain`, for keys.", "author": "gustavonalle", "createdAt": "2020-08-12T12:42:39Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_encoding_memcached.adoc", "diffHunk": "@@ -0,0 +1,52 @@\n+[id='memcached_interoperability-{context}']\n+= Configuring Cache Encoding for Memcached Clients\n+{brandname} Server disables the Memcached endpoint by default. If you enable\n+the Memcached endpoint, you should configure caches with a suitable encoding\n+for Memcached clients.\n+\n+[IMPORTANT]\n+====\n+The Memcached endpoint does not support authentication. For security purposes\n+you should use dedicated caches for Memcached clients. You should not use REST\n+or Hot Rod clients to interact on the same data set as Memcached clients.\n+====\n+\n+.Procedure\n+\n+. Configure cache encoding to use String, `text/plain`, for keys.", "originalCommit": "81a6af0b526093267b4d05743899cf026988f2f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIzMTAxNA==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r469231014", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Memcached clients can handle keys as String only. Values can be any MediaType\n          \n          \n            \n            Memcached clients can handle keys as `text/plain` only. Values can be any MediaType", "author": "gustavonalle", "createdAt": "2020-08-12T12:44:05Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_encoding_memcached.adoc", "diffHunk": "@@ -0,0 +1,52 @@\n+[id='memcached_interoperability-{context}']\n+= Configuring Cache Encoding for Memcached Clients\n+{brandname} Server disables the Memcached endpoint by default. If you enable\n+the Memcached endpoint, you should configure caches with a suitable encoding\n+for Memcached clients.\n+\n+[IMPORTANT]\n+====\n+The Memcached endpoint does not support authentication. For security purposes\n+you should use dedicated caches for Memcached clients. You should not use REST\n+or Hot Rod clients to interact on the same data set as Memcached clients.\n+====\n+\n+.Procedure\n+\n+. Configure cache encoding to use String, `text/plain`, for keys.\n+. Specify any appropriate MediaType, other than `application/x-java-\n+object`, for values.\n++\n+Memcached clients can handle keys as String only. Values can be any MediaType", "originalCommit": "81a6af0b526093267b4d05743899cf026988f2f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIzMTUxNw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r469231517", "bodyText": "\ud83d\udc4d", "author": "gustavonalle", "createdAt": "2020-08-12T12:44:57Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_encoding_memcached.adoc", "diffHunk": "@@ -0,0 +1,52 @@\n+[id='memcached_interoperability-{context}']\n+= Configuring Cache Encoding for Memcached Clients\n+{brandname} Server disables the Memcached endpoint by default. If you enable\n+the Memcached endpoint, you should configure caches with a suitable encoding\n+for Memcached clients.\n+\n+[IMPORTANT]\n+====\n+The Memcached endpoint does not support authentication. For security purposes\n+you should use dedicated caches for Memcached clients. You should not use REST\n+or Hot Rod clients to interact on the same data set as Memcached clients.\n+====\n+\n+.Procedure\n+\n+. Configure cache encoding to use String, `text/plain`, for keys.\n+. Specify any appropriate MediaType, other than `application/x-java-\n+object`, for values.\n++\n+Memcached clients can handle keys as String only. Values can be any MediaType\n+that {brandname} stores as `byte[]`, which can be Protobuf, marshalled Java\n+objects, or a text-based format.\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_memcached.xml[]\n+----\n+\n+[TIP]\n+====\n+The Memcached endpoint includes a `client-encoding` attribute that converts the\n+encoding of values.\n+\n+For example, as in the preceding configuration example, you store values\n+encoded as Protobuf. If you want Memcached clients to read and write values as\n+JSON, you can use the following configuration:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_memcached_clients.xml[]\n+----\n+====", "originalCommit": "81a6af0b526093267b4d05743899cf026988f2f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI0MDI4Mw==", "url": "https://github.com/infinispan/infinispan/pull/8554#discussion_r469240283", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Hot Rod clients must use a marshaller to handle POJOs. You should use the\n          \n          \n            \n            ProtoStream marshaller, which is language neutral and backwards compatible.\n          \n          \n            \n            There is no changes required for Hot Rod clients. The only requirement is that the marshaller used in the client is available in the server/lib to be able to de-serialize the objects.\n          \n          \n            \n            \n          \n          \n            \n            NOTE: The ProtoStream  and JavaSerialization marshallers are already available in the server", "author": "gustavonalle", "createdAt": "2020-08-12T12:59:52Z", "path": "documentation/src/main/asciidoc/topics/proc_storing_pojos.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+[id='storing_pojos-{context}']\n+= Storing Unmarshalled Java Objects\n+You can store data as deserialized Plain Old Java Objects (POJO) instead of\n+storing data in a binary format.\n+\n+Storing POJO instead of binary format is not recommended because it\n+requires {brandname} to serialize data on client read operations and\n+deserialize data on write operations. To handle client interoperability with\n+custom code you should convert data on demand.\n+\n+.Procedure\n+\n+. Specify `application/x-java-object` as the MediaType for keys and values as follows:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/encoding_java_object.xml[]\n+----\n++\n+. Put class files for all custom objects on the {brandname} server classpath.\n++\n+Add JAR files that contain custom classes and/or service providers for\n+marshaller implementations in the `server/lib` directory.\n++\n+----\n+\u251c\u2500\u2500 server\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n+\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 UserObjects.jar\n+\u2502\u00a0\u00a0  \u00a0\u00a0 \u2514\u2500\u2500 README.txt\n+----\n++\n+. Configure your clients.\n+\n+Hot Rod clients must use a marshaller to handle POJOs. You should use the\n+ProtoStream marshaller, which is language neutral and backwards compatible.", "originalCommit": "81a6af0b526093267b4d05743899cf026988f2f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f23a611a8dff5187287ef3cf2cca13f6676f8c92", "url": "https://github.com/infinispan/infinispan/commit/f23a611a8dff5187287ef3cf2cca13f6676f8c92", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-08-12T13:10:20Z", "type": "commit"}, {"oid": "f23a611a8dff5187287ef3cf2cca13f6676f8c92", "url": "https://github.com/infinispan/infinispan/commit/f23a611a8dff5187287ef3cf2cca13f6676f8c92", "message": "ISPN-12108 configuring mediatypes client interop", "committedDate": "2020-08-12T13:10:20Z", "type": "forcePushed"}]}