{"pr_number": 8659, "pr_title": "ISPN-11838 CLI with Kubernetes Operator superpowers", "pr_createdAt": "2020-08-31T20:41:49Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8659", "timeline": [{"oid": "ea310e556a4260f34639b2a5197ca1fa3429d685", "url": "https://github.com/infinispan/infinispan/commit/ea310e556a4260f34639b2a5197ca1fa3429d685", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-01T16:15:02Z", "type": "forcePushed"}, {"oid": "ba63aaf9a5bdc121f326f7143d7300a4c8f42787", "url": "https://github.com/infinispan/infinispan/commit/ba63aaf9a5bdc121f326f7143d7300a4c8f42787", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-22T08:38:56Z", "type": "forcePushed"}, {"oid": "eb21438cde10c9fd3e335ff1bcdfbcbc4b04d6c1", "url": "https://github.com/infinispan/infinispan/commit/eb21438cde10c9fd3e335ff1bcdfbcbc4b04d6c1", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-22T10:53:01Z", "type": "forcePushed"}, {"oid": "162eab2cf5917756bf57e0678bae9ca393cc8eb0", "url": "https://github.com/infinispan/infinispan/commit/162eab2cf5917756bf57e0678bae9ca393cc8eb0", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-22T15:07:01Z", "type": "forcePushed"}, {"oid": "44c40ef2055cbc5425761396142ea6919e554271", "url": "https://github.com/infinispan/infinispan/commit/44c40ef2055cbc5425761396142ea6919e554271", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-23T10:00:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM3MzU3Nw==", "url": "https://github.com/infinispan/infinispan/pull/8659#discussion_r493373577", "bodyText": "Comments can be removed", "author": "ryanemerson", "createdAt": "2020-09-23T09:35:35Z", "path": "cli/cli-client/src/main/java/org/infinispan/cli/commands/kubernetes/Describe.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package org.infinispan.cli.commands.kubernetes;\n+\n+import static org.infinispan.cli.commands.kubernetes.Kube.INFINISPAN_SERVICE_CRD;\n+import static org.infinispan.cli.commands.kubernetes.Kube.get;\n+\n+import java.io.PrintStream;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.aesh.command.Command;\n+import org.aesh.command.CommandDefinition;\n+import org.aesh.command.CommandResult;\n+import org.aesh.command.GroupCommandDefinition;\n+import org.aesh.command.option.Option;\n+import org.infinispan.cli.commands.CliCommand;\n+import org.infinispan.cli.impl.ContextAwareCommandInvocation;\n+import org.infinispan.cli.impl.KubernetesContextImpl;\n+import org.kohsuke.MetaInfServices;\n+\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+\n+/**\n+ * @author Tristan Tarrant &lt;tristan@infinispan.org&gt;\n+ * @since 12.0\n+ **/\n+\n+@MetaInfServices(Command.class)\n+@GroupCommandDefinition(\n+      name = Describe.CMD,\n+      description = \"Describes a resource\",\n+      groupCommands = {\n+            Describe.Service.class,\n+      })\n+public class Describe extends CliCommand {\n+   public static final String CMD = \"describe\";\n+\n+   @Option(shortName = 'h', hasValue = false, overrideRequired = true)\n+   protected boolean help;\n+\n+   @Override\n+   public boolean isHelp() {\n+      return help;\n+   }\n+\n+   @Override\n+   public CommandResult exec(ContextAwareCommandInvocation invocation) {\n+      return CommandResult.FAILURE;\n+   }\n+\n+   @MetaInfServices(Command.class)\n+   @CommandDefinition(name = Service.CMD, description = \"Describes a service\")\n+   public static class Service extends CliCommand {\n+      public static final String CMD = \"service\";\n+\n+      @Option(shortName = 'n', description = \"Select the namespace\")\n+      String namespace;\n+\n+      @Option(shortName = 'h', hasValue = false, overrideRequired = true)\n+      protected boolean help;\n+\n+      @Override\n+      public boolean isHelp() {\n+         return help;\n+      }\n+\n+      @Override\n+      public CommandResult exec(ContextAwareCommandInvocation invocation) {\n+         KubernetesClient client = ((KubernetesContextImpl)invocation.getContext()).getKubernetesClient();\n+         Map<String, Object> resource = client.customResource(INFINISPAN_SERVICE_CRD).list(namespace);\n+         List<Map<String, Object>> items = get(resource, \"items\");\n+         PrintStream out = invocation.getShellOutput();\n+         out.printf(\"%-32s %-16s %-9s %-16s%n\", \"NAME\", \"NAMESPACE\", \"REPLICAS\", \"STATUS\");\n+         items.forEach(item -> {\n+            out.printf(\"%-32s %-16s %-9s \", get(item, \"metadata.name\"), get(item, \"metadata.namespace\"), get(item, \"spec.replicas\"));\n+         /*\n+         String secretName = get(item, \"spec.security.endpointSecretName\");\n+         Secret secret = getSecret(client, namespace, secretName);\n+         decodeIdentitiesSecret(secret, (u, p) -> out.printf(\"%16s %16s\", u, p));*/", "originalCommit": "162eab2cf5917756bf57e0678bae9ca393cc8eb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NDgxMw==", "url": "https://github.com/infinispan/infinispan/pull/8659#discussion_r493384813", "bodyText": "Are the contents of this package still necessary with the infinispan-quarkus PR?", "author": "ryanemerson", "createdAt": "2020-09-23T09:47:21Z", "path": "cli/cli-client/src/main/java/org/infinispan/cli/util/aesh/graal/GraalReflectionCommand.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package org.infinispan.cli.util.aesh.graal;", "originalCommit": "162eab2cf5917756bf57e0678bae9ca393cc8eb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NTY0OQ==", "url": "https://github.com/infinispan/infinispan/pull/8659#discussion_r493385649", "bodyText": "Unused, causing CI failure", "author": "ryanemerson", "createdAt": "2020-09-23T09:48:15Z", "path": "server/runtime/src/main/java/org/infinispan/server/Server.java", "diffHunk": "@@ -76,6 +76,7 @@\n import org.infinispan.server.router.routes.hotrod.HotRodServerRouteDestination;\n import org.infinispan.server.router.routes.rest.RestServerRouteDestination;\n import org.infinispan.server.router.routes.singleport.SinglePortRouteSource;\n+import org.infinispan.server.security.http.localuser.WildFlyElytronHttpLocalUserProvider;", "originalCommit": "162eab2cf5917756bf57e0678bae9ca393cc8eb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d56dd949be563a42f919769e4ff2f83f053ae2b", "url": "https://github.com/infinispan/infinispan/commit/0d56dd949be563a42f919769e4ff2f83f053ae2b", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-23T11:44:34Z", "type": "forcePushed"}, {"oid": "402c603505d4cb0015ac537226d624e12fc930f3", "url": "https://github.com/infinispan/infinispan/commit/402c603505d4cb0015ac537226d624e12fc930f3", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-24T15:28:24Z", "type": "forcePushed"}, {"oid": "cf7cf4e993687fc9b04a241f19f7519eb97ed75b", "url": "https://github.com/infinispan/infinispan/commit/cf7cf4e993687fc9b04a241f19f7519eb97ed75b", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-25T15:45:27Z", "type": "forcePushed"}, {"oid": "9ca724970108ac50c5731473325c9bc36bb646b6", "url": "https://github.com/infinispan/infinispan/commit/9ca724970108ac50c5731473325c9bc36bb646b6", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-28T07:40:14Z", "type": "forcePushed"}, {"oid": "f8f8df91ef94c546edb9fa4b87da24689ca51534", "url": "https://github.com/infinispan/infinispan/commit/f8f8df91ef94c546edb9fa4b87da24689ca51534", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-09-30T14:29:13Z", "type": "forcePushed"}, {"oid": "17938e2c06de64e1ff6e437b2470c9645e5582de", "url": "https://github.com/infinispan/infinispan/commit/17938e2c06de64e1ff6e437b2470c9645e5582de", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-12T07:16:53Z", "type": "forcePushed"}, {"oid": "b626123b7ba9caf8a720656a9db350a77fcf4d5e", "url": "https://github.com/infinispan/infinispan/commit/b626123b7ba9caf8a720656a9db350a77fcf4d5e", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-12T07:25:42Z", "type": "forcePushed"}, {"oid": "7858570ba672a4c59e36d57479150402ad1d9bfa", "url": "https://github.com/infinispan/infinispan/commit/7858570ba672a4c59e36d57479150402ad1d9bfa", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-13T14:51:21Z", "type": "forcePushed"}, {"oid": "d17b1c3ed5dd67c711ad37be410dbece94708885", "url": "https://github.com/infinispan/infinispan/commit/d17b1c3ed5dd67c711ad37be410dbece94708885", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-29T11:32:37Z", "type": "forcePushed"}, {"oid": "d496d7ceaabdd632576f0154a87536f43aec8bad", "url": "https://github.com/infinispan/infinispan/commit/d496d7ceaabdd632576f0154a87536f43aec8bad", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-29T12:59:31Z", "type": "forcePushed"}, {"oid": "c3e10b6eba26e1c7f738f1fb95656445c4c16473", "url": "https://github.com/infinispan/infinispan/commit/c3e10b6eba26e1c7f738f1fb95656445c4c16473", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-29T13:16:41Z", "type": "forcePushed"}, {"oid": "149b14d606ff1c7ac986db05e6af870b1856cae8", "url": "https://github.com/infinispan/infinispan/commit/149b14d606ff1c7ac986db05e6af870b1856cae8", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-30T16:10:44Z", "type": "forcePushed"}, {"oid": "7b765a811a7bcc78134d447fdbe48a7eaf65c691", "url": "https://github.com/infinispan/infinispan/commit/7b765a811a7bcc78134d447fdbe48a7eaf65c691", "message": "CLI Move module", "committedDate": "2020-10-30T16:11:30Z", "type": "commit"}, {"oid": "e6b48a097d5bb0b700f118802f15b5f05ac6f7e4", "url": "https://github.com/infinispan/infinispan/commit/e6b48a097d5bb0b700f118802f15b5f05ac6f7e4", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-30T16:11:30Z", "type": "commit"}, {"oid": "e6b48a097d5bb0b700f118802f15b5f05ac6f7e4", "url": "https://github.com/infinispan/infinispan/commit/e6b48a097d5bb0b700f118802f15b5f05ac6f7e4", "message": "ISPN-11838 CLI with Kubernetes Operator superpowers", "committedDate": "2020-10-30T16:11:30Z", "type": "forcePushed"}]}