{"pr_number": 7953, "pr_title": "ISPN-11263 CDI extension doc updates", "pr_createdAt": "2020-02-25T18:25:29Z", "pr_url": "https://github.com/infinispan/infinispan/pull/7953", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTUwMQ==", "url": "https://github.com/infinispan/infinispan/pull/7953#discussion_r384069501", "bodyText": "@danberindei should this be RemoteCacheManager() without the (string, int)?\nas you say there is no configuration with remote caches. RemoteCacheManager() looks up the list of servers in a file hotrod-client.properties in the classpath", "author": "oraNod", "createdAt": "2020-02-25T19:14:16Z", "path": "documentation/src/main/asciidoc/topics/proc_cdi_injecting_remote.adoc", "diffHunk": "@@ -0,0 +1,72 @@\n+[id='cdi_inject_remote']\n+= Injecting Remote Caches\n+Set up CDI beans to inject remote caches.\n+\n+.Procedure\n+\n+. Create a cache qualifier annotation.\n++\n+[source,java]\n+----\n+@Remote(\"mygreetingcache\") <1>\n+@Qualifier\n+@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})\n+@Retention(RetentionPolicy.RUNTIME)\n+@Documented\n+public @interface RemoteGreetingCache { <2>\n+}\n+----\n++\n+<1> names the cache to inject.\n+<2> creates a `@RemoteGreetingCache` qualifier.\n++\n+. Add the `@RemoteGreetingCache` qualifier to your cache injection point.\n++\n+[source,java]\n+----\n+public class GreetingService {\n+\n+    @Inject @RemoteGreetingCache\n+    private RemoteCache<String, String> cache;\n+\n+    public String greet(String user) {\n+        String cachedValue = cache.get(user);\n+        if (cachedValue == null) {\n+            cachedValue = \"Hello \" + user;\n+            cache.put(user, cachedValue);\n+        }\n+        return cachedValue;\n+    }\n+}\n+----\n+\n+[TIP]\n+====\n+You can also inject remote caches without using qualifiers.\n+\n+[source,java]\n+----\n+...\n+   @Inject\n+   @Remote(\"greetingCache\")\n+   private RemoteCache<String, String> cache;\n+----\n+====\n+\n+.Override the default remote cache manager\n+\n+[source,java]\n+----\n+...\n+import javax.enterprise.context.ApplicationScoped;\n+\n+public class Config {\n+\n+    @RemoteGreetingCache\n+    @Produces\n+    @ApplicationScoped\n+    public RemoteCacheManager defaultRemoteCacheManager() {\n+        return new RemoteCacheManager(localhost, 1544);", "originalCommit": "36b606218c285f2c7fe81b5a51338746f0beaea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU5MTg1OA==", "url": "https://github.com/infinispan/infinispan/pull/7953#discussion_r384591858", "bodyText": "Yes, that's I wanted to say initially, but a more appropriate example would be\nConfigurationBuilder builder = new ConfigurationBuilder();\nbuilder.addServer().host(\"localhost\").port(11222);\nreturn new RemoteCacheManager(builder.build());", "author": "danberindei", "createdAt": "2020-02-26T16:02:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTUwMQ=="}], "type": "inlineReview"}, {"oid": "42ec305734abe8743fb5877d82f9211ea400b541", "url": "https://github.com/infinispan/infinispan/commit/42ec305734abe8743fb5877d82f9211ea400b541", "message": "ISPN-11263 CDI extension doc updates", "committedDate": "2020-02-26T17:31:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAxNDU2OQ==", "url": "https://github.com/infinispan/infinispan/pull/7953#discussion_r385014569", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Add a producer class that defines cache configuration objects.\n          \n          \n            \n            . Add a producer method that defines the cache configuration.", "author": "danberindei", "createdAt": "2020-02-27T09:46:05Z", "path": "documentation/src/main/asciidoc/topics/proc_cdi_injecting_embedded.adoc", "diffHunk": "@@ -0,0 +1,93 @@\n+[id='cdi_inject_embed']\n+= Injecting Embedded Caches\n+Set up CDI beans to inject embedded caches.\n+\n+.Procedure\n+\n+. Create a cache qualifier annotation.\n++\n+[source,java]\n+----\n+...\n+import javax.inject.Qualifier;\n+\n+@Qualifier\n+@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})\n+@Retention(RetentionPolicy.RUNTIME)\n+@Documented\n+public @interface GreetingCache { <1>\n+}\n+----\n++\n+<1> creates a `@GreetingCache` qualifier.\n++\n+. Add a producer class that defines cache configuration objects.", "originalCommit": "42ec305734abe8743fb5877d82f9211ea400b541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAxNzU0Mw==", "url": "https://github.com/infinispan/infinispan/pull/7953#discussion_r385017543", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Configure transport for clustered cache modes, if required.\n          \n          \n            \n            . Add a producer method that creates a clustered cache manager, if required", "author": "danberindei", "createdAt": "2020-02-27T09:50:47Z", "path": "documentation/src/main/asciidoc/topics/proc_cdi_injecting_embedded.adoc", "diffHunk": "@@ -0,0 +1,93 @@\n+[id='cdi_inject_embed']\n+= Injecting Embedded Caches\n+Set up CDI beans to inject embedded caches.\n+\n+.Procedure\n+\n+. Create a cache qualifier annotation.\n++\n+[source,java]\n+----\n+...\n+import javax.inject.Qualifier;\n+\n+@Qualifier\n+@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})\n+@Retention(RetentionPolicy.RUNTIME)\n+@Documented\n+public @interface GreetingCache { <1>\n+}\n+----\n++\n+<1> creates a `@GreetingCache` qualifier.\n++\n+. Add a producer class that defines cache configuration objects.\n++\n+[source,java]\n+----\n+...\n+import org.infinispan.configuration.cache.Configuration;\n+import org.infinispan.configuration.cache.ConfigurationBuilder;\n+import org.infinispan.cdi.ConfigureCache;\n+import javax.enterprise.inject.Produces;\n+\n+public class Config {\n+\n+    @ConfigureCache(\"mygreetingcache\") <1>\n+    @GreetingCache <2>\n+    @Produces\n+    public Configuration greetingCacheConfiguration() {\n+        return new ConfigurationBuilder()\n+                    .memory()\n+                        .size(1000)\n+                    .build();\n+    }\n+}\n+----\n++\n+<1> names the cache to inject.\n+<2> adds the cache qualifier.\n++\n+. Configure transport for clustered cache modes, if required.", "originalCommit": "42ec305734abe8743fb5877d82f9211ea400b541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyMDU4MA==", "url": "https://github.com/infinispan/infinispan/pull/7953#discussion_r385020580", "bodyText": "I'd add a note here too, saying smth like\n<1> adds the cache qualifier. Normally an application does not need more than one cache manager, and the cache manager producer should have no qualifier.\n\nOr maybe it's better to mention this in the existing note 2?", "author": "danberindei", "createdAt": "2020-02-27T09:55:43Z", "path": "documentation/src/main/asciidoc/topics/proc_cdi_injecting_embedded.adoc", "diffHunk": "@@ -0,0 +1,93 @@\n+[id='cdi_inject_embed']\n+= Injecting Embedded Caches\n+Set up CDI beans to inject embedded caches.\n+\n+.Procedure\n+\n+. Create a cache qualifier annotation.\n++\n+[source,java]\n+----\n+...\n+import javax.inject.Qualifier;\n+\n+@Qualifier\n+@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})\n+@Retention(RetentionPolicy.RUNTIME)\n+@Documented\n+public @interface GreetingCache { <1>\n+}\n+----\n++\n+<1> creates a `@GreetingCache` qualifier.\n++\n+. Add a producer class that defines cache configuration objects.\n++\n+[source,java]\n+----\n+...\n+import org.infinispan.configuration.cache.Configuration;\n+import org.infinispan.configuration.cache.ConfigurationBuilder;\n+import org.infinispan.cdi.ConfigureCache;\n+import javax.enterprise.inject.Produces;\n+\n+public class Config {\n+\n+    @ConfigureCache(\"mygreetingcache\") <1>\n+    @GreetingCache <2>\n+    @Produces\n+    public Configuration greetingCacheConfiguration() {\n+        return new ConfigurationBuilder()\n+                    .memory()\n+                        .size(1000)\n+                    .build();\n+    }\n+}\n+----\n++\n+<1> names the cache to inject.\n+<2> adds the cache qualifier.\n++\n+. Configure transport for clustered cache modes, if required.\n++\n+[source,java]\n+----\n+...\n+package org.infinispan.configuration.global.GlobalConfigurationBuilder;\n+\n+public class Config {\n+\n+    @GreetingCache", "originalCommit": "42ec305734abe8743fb5877d82f9211ea400b541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b54447be33de5243a09ad2ef63ea9bc4d32a0950", "url": "https://github.com/infinispan/infinispan/commit/b54447be33de5243a09ad2ef63ea9bc4d32a0950", "message": "ISPN-11263 CDI extension doc updates", "committedDate": "2020-02-27T10:43:30Z", "type": "forcePushed"}, {"oid": "05f157f11108fc422b6f552b10d04d6dbcf86be6", "url": "https://github.com/infinispan/infinispan/commit/05f157f11108fc422b6f552b10d04d6dbcf86be6", "message": "ISPN-11263 CDI extension doc updates", "committedDate": "2020-02-27T11:01:22Z", "type": "commit"}, {"oid": "05f157f11108fc422b6f552b10d04d6dbcf86be6", "url": "https://github.com/infinispan/infinispan/commit/05f157f11108fc422b6f552b10d04d6dbcf86be6", "message": "ISPN-11263 CDI extension doc updates", "committedDate": "2020-02-27T11:01:22Z", "type": "forcePushed"}]}