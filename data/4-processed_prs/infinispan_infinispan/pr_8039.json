{"pr_number": 8039, "pr_title": "ISPN-10270 Fix DropppedConnectionsTest random failures", "pr_createdAt": "2020-03-11T17:01:41Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8039", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE3ODI5Nw==", "url": "https://github.com/infinispan/infinispan/pull/8039#discussion_r392178297", "bodyText": "I'd rather keep separate sentences on separate lines :)", "author": "danberindei", "createdAt": "2020-03-13T11:41:31Z", "path": "client/hotrod-client/src/main/java/org/infinispan/client/hotrod/impl/transport/netty/ChannelPool.java", "diffHunk": "@@ -21,16 +21,15 @@\n import io.netty.util.internal.PlatformDependent;\n \n /**\n- * This is a custom implementation of {@link io.netty.channel.Channel} pooling.\n- * Compared to {@link io.netty.channel.pool.ChannelPool} implementations in Netty it does not enforce\n- * context switch before writing to the channel.\n- * **Update**: Netty enforces going through event loop later on by delegating the write through\n- * {@link io.netty.channel.AbstractChannelHandlerContext.WriteAndFlushTask}. So writing the socket in caller\n- * thread is still TODO.\n- *\n- * It should be also more allocation-efficient since it does not create futures and invokes the callback directly\n- * if the channel is available.\n- *\n+ * This is a custom implementation of {@link io.netty.channel.Channel} pooling. Compared to {@link", "originalCommit": "a0253985c8b49f62c71dd4670e1b06a38d00cb15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MzQ4MQ==", "url": "https://github.com/infinispan/infinispan/pull/8039#discussion_r392183481", "bodyText": "Why is this assert no longer valid? I'd like to see an explanation here or in the executeOperation() javadoc on what the operation should expect, because many operations write to the channel without checking if it's active first.", "author": "danberindei", "createdAt": "2020-03-13T11:53:50Z", "path": "client/hotrod-client/src/main/java/org/infinispan/client/hotrod/impl/operations/RetryOnFailureOperation.java", "diffHunk": "@@ -69,7 +69,6 @@ protected RetryOnFailureOperation(short requestCode, short responseCode, Codec c\n \n    @Override\n    public void invoke(Channel channel) {\n-      assert channel.isActive();", "originalCommit": "a0253985c8b49f62c71dd4670e1b06a38d00cb15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI1MjA5Mg==", "url": "https://github.com/infinispan/infinispan/pull/8039#discussion_r392252092", "bodyText": "There is no point in checking if the channel is active upfront since it may become inactive at any moment during transmission. Having that assertion outside the try/catch does not properly trigger the retry logic.", "author": "tristantarrant", "createdAt": "2020-03-13T14:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MzQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYxMTUzMg==", "url": "https://github.com/infinispan/infinispan/pull/8039#discussion_r393611532", "bodyText": "@danberindei I've added some javadoc on executeOperation", "author": "tristantarrant", "createdAt": "2020-03-17T11:29:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MzQ4MQ=="}], "type": "inlineReview"}, {"oid": "75c934f74fc79c2c0070dfad567e2522e90378d8", "url": "https://github.com/infinispan/infinispan/commit/75c934f74fc79c2c0070dfad567e2522e90378d8", "message": "ISPN-10270 Fix DropppedConnectionsTest random failures\n\n* Let RetryOnFailureOperation's error handling logic handle inactive channels\n*\n* Refactor test to allow repeated invocations", "committedDate": "2020-03-17T11:29:15Z", "type": "commit"}, {"oid": "75c934f74fc79c2c0070dfad567e2522e90378d8", "url": "https://github.com/infinispan/infinispan/commit/75c934f74fc79c2c0070dfad567e2522e90378d8", "message": "ISPN-10270 Fix DropppedConnectionsTest random failures\n\n* Let RetryOnFailureOperation's error handling logic handle inactive channels\n*\n* Refactor test to allow repeated invocations", "committedDate": "2020-03-17T11:29:15Z", "type": "forcePushed"}]}