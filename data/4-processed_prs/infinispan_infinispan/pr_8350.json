{"pr_number": 8350, "pr_title": "ISPN-11851 FD_SOCK should use the same bind address as TCP", "pr_createdAt": "2020-05-19T17:36:13Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8350", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNDA5NQ==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r428204095", "bodyText": "I noticed that this stack and the default tcp stack have FD_ALL3 and FD_ALL respectively. Should we consolidate those?", "author": "wburns", "createdAt": "2020-05-20T17:59:45Z", "path": "core/src/test/resources/configs/unified/11.0.xml", "diffHunk": "@@ -10,12 +10,12 @@\n       <stack-file name=\"tcp-test\" path=\"stacks/tcp_mping/tcp1.xml\"/>\n       <!-- Inline definition -->\n       <!-- Inline definition -->\n-      <stack name=\"mping\">\n+      <stack name=\"mping\" extends=\"tcp\">", "originalCommit": "31ac40edb1f3d61fda2f0e0b7efb614cacbbe82f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNDk2Nw==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r428204967", "bodyText": "Also if we are extending tcp, we should probably only add the stack elements that are actually changing something. Most of the ones below are exactly the same.", "author": "wburns", "createdAt": "2020-05-20T18:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNDA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyOTIyMw==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r428629223", "bodyText": "Yeah, I'll remove the common ones. I tried to expedite things by only removing the bind address stuff, but in general it's a good idea to remove the duplication in the test XMLs even if the cache manager is never started.", "author": "danberindei", "createdAt": "2020-05-21T12:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNDA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MzIzMg==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r428643232", "bodyText": "Actually there's another stack extending tcp just below, so I'll keep the full definition here and only remove the bind_addr attribute.", "author": "danberindei", "createdAt": "2020-05-21T13:14:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNDA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY1ODU1MQ==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r428658551", "bodyText": "WRT FD_ALL3 and FD_ALL, FD_ALL3 is very new, and that's why I only added it in the test configurations. In the original version with extends=\"tcp\", I should have used stack.combine=\"REPLACE\" stack.position=\"FD_ALL\".", "author": "danberindei", "createdAt": "2020-05-21T13:42:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNDA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNTE1NA==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r428205154", "bodyText": "Same thing regarding trimming the rest of the protocols that are duplicate between prod and tcp.", "author": "wburns", "createdAt": "2020-05-20T18:01:27Z", "path": "documentation/src/main/asciidoc/topics/config_examples/config_inline_jgroups.xml", "diffHunk": "@@ -1,8 +1,8 @@\n <infinispan> <1>\n   <jgroups> <2>\n-    <stack name=\"prod\"> <3>\n+    <stack name=\"prod\" extends=\"tcp\"> <3>", "originalCommit": "31ac40edb1f3d61fda2f0e0b7efb614cacbbe82f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "506a2fb3d47b0689c8b36cfa804b29ce33d6543a", "url": "https://github.com/infinispan/infinispan/commit/506a2fb3d47b0689c8b36cfa804b29ce33d6543a", "message": "ISPN-11851 FD_SOCK should use the same bind address as TCP\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address", "committedDate": "2020-05-21T13:18:46Z", "type": "forcePushed"}, {"oid": "9f022b1094d40da78c928fbd49ec2a720e3f52cb", "url": "https://github.com/infinispan/infinispan/commit/9f022b1094d40da78c928fbd49ec2a720e3f52cb", "message": "ISPN-11851 Remove FD_SOCK and MPING bind_addr\n\nAll protocols inherid the bind_addr from the transport\nif not explicitly configured.\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address", "committedDate": "2020-06-02T11:29:26Z", "type": "forcePushed"}, {"oid": "294063773c696cea6eb6844d30d5297eb1e746db", "url": "https://github.com/infinispan/infinispan/commit/294063773c696cea6eb6844d30d5297eb1e746db", "message": "ISPN-11851 Remove FD_SOCK and MPING bind_addr\n\nAll protocols inherid the bind_addr from the transport\nif not explicitly configured.\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address\n\nRemove unused configuration examples.", "committedDate": "2020-06-02T11:30:45Z", "type": "forcePushed"}, {"oid": "1f274f0c87cddae7573fce82b039108762b50041", "url": "https://github.com/infinispan/infinispan/commit/1f274f0c87cddae7573fce82b039108762b50041", "message": "ISPN-11851 Remove FD_SOCK and MPING bind_addr\n\nAll protocols inherid the bind_addr from the transport\nif not explicitly configured.\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address", "committedDate": "2020-07-28T07:50:18Z", "type": "forcePushed"}, {"oid": "ef35d7f57ec62902073893d910b00c6015999609", "url": "https://github.com/infinispan/infinispan/commit/ef35d7f57ec62902073893d910b00c6015999609", "message": "ISPN-11851 Remove FD_SOCK and MPING bind_addr\n\nAll protocols inherid the bind_addr from the transport\nif not explicitly configured.\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address\n\nRemove unused configuration examples.", "committedDate": "2020-07-30T09:56:46Z", "type": "forcePushed"}, {"oid": "3072e238a92593dc09ac6a75ae892f805f8311e7", "url": "https://github.com/infinispan/infinispan/commit/3072e238a92593dc09ac6a75ae892f805f8311e7", "message": "ISPN-11851 Remove FD_SOCK and MPING bind_addr\n\nAll protocols inherit the bind_addr from the transport\nif not explicitly configured.\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address\n\nRemove unused configuration examples.", "committedDate": "2020-07-30T14:26:31Z", "type": "commit"}, {"oid": "3072e238a92593dc09ac6a75ae892f805f8311e7", "url": "https://github.com/infinispan/infinispan/commit/3072e238a92593dc09ac6a75ae892f805f8311e7", "message": "ISPN-11851 Remove FD_SOCK and MPING bind_addr\n\nAll protocols inherit the bind_addr from the transport\nif not explicitly configured.\n\nAlso deprecate system properties jgroups.tcp.address\nand jgroups.udp.address\n\nRemove unused configuration examples.", "committedDate": "2020-07-30T14:26:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk2MjIyOQ==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r463962229", "bodyText": "How about jgroups.tcp.port. Should we remove as well ?", "author": "diegolovison", "createdAt": "2020-08-01T13:30:09Z", "path": "core/src/main/resources/default-configs/default-jgroups-azure.xml", "diffHunk": "@@ -5,6 +5,7 @@\n <config xmlns=\"urn:org:jgroups\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"urn:org:jgroups http://www.jgroups.org/schema/jgroups-4.2.xsd\">\n+   <!-- jgroups.tcp.address is deprecated and will be removed, see ISPN-11867 -->\n    <TCP bind_addr=\"${jgroups.bind.address,jgroups.tcp.address:SITE_LOCAL}\"\n         bind_port=\"${jgroups.bind.port,jgroups.tcp.port:7800}\"", "originalCommit": "3072e238a92593dc09ac6a75ae892f805f8311e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE5ODI5Mg==", "url": "https://github.com/infinispan/infinispan/pull/8350#discussion_r464198292", "bodyText": "There are 2 problems with jgroups.tcp.address:\n\nIt's reused by other protocols in the stack, which may or may not use TCP sockets\nIt's arbitrary, there's no reason someone would want a different IP address for TCP vs UDP.\n\njgroups.tcp.port doesn't have any of those problems: each protocol using TCP sockets directly must have a different port, so the system property cannot be reused.", "author": "danberindei", "createdAt": "2020-08-03T05:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk2MjIyOQ=="}], "type": "inlineReview"}]}