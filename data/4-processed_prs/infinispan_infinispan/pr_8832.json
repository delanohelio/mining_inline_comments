{"pr_number": 8832, "pr_title": "ISPN-10851 JGroups encrypt docs", "pr_createdAt": "2020-11-06T16:12:03Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8832", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1NDIwMQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r518854201", "bodyText": "@tristantarrant I'd like to backport this PR to 11 but INSERT_BEFORE isn't available. I'm not sure how to use stack.combine to get SSL_KEY_EXCHANGE and ASYM_ENCRYPT in the stack before pbcast.NAKACK2. Any recommendations?", "author": "oraNod", "createdAt": "2020-11-06T16:14:15Z", "path": "documentation/src/main/asciidoc/topics/config_examples/jgroups_asym_encrypt.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<infinispan>\n+    <jgroups>\n+         <stack name=\"encrypt-tcp\" extends=\"tcp\"> <1>\n+           <SSL_KEY_EXCHANGE keystore_name=\"mykeystore.jks\" <2>\n+                             keystore_password=\"changeit\" <3>\n+                             stack.combine=\"INSERT_AFTER\"\n+                             stack.position=\"VERIFY_SUSPECT\"/> <4>\n+           <ASYM_ENCRYPT asym_keylength=\"512\" <5>\n+                    asym_algorithm=\"RSA\" <6>\n+                    change_key_on_coord_leave = \"false\" <7>\n+                    change_key_on_leave = \"false\" <8>\n+                    use_external_key_exchange = \"true\" <9>\n+                    stack.combine=\"INSERT_BEFORE\"", "originalCommit": "f4a50ea88ef05c8e52b330ba4a7fab6a8e01baf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg3NTEyMw==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r518875123", "bodyText": "Well, since our stacks all have VERIFY_SUSPECT above pbcast.NAKACK2 just use INSERT_AFTER with that. Not ideal, but saves us from backporting", "author": "tristantarrant", "createdAt": "2020-11-06T16:48:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1NDIwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg3Nzg2OQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r518877869", "bodyText": "Right but the problem I've found is that I can't use INSERT_AFTER with both SSL_KEY_EXCHANGE and ASYM_ENCRYPT.", "author": "oraNod", "createdAt": "2020-11-06T16:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1NDIwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg4MDQwMQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r518880401", "bodyText": "Actually it looks like it's OK if I do this (on 11):\n<SSL_KEY_EXCHANGE ... stack.combine=\"INSERT_AFTER\" stack.position=\"VERIFY_SUSPECT\"/>\n<ASYM_ENCRYPT ... stack.combine=\"INSERT_AFTER\" stack.position=\"SSL_KEY_EXCHANGE\"/>\n\nThat seems to work fine. I'll update with that config when I create the backport for this content to 11 (unless you see anything wrong with it). Thanks.", "author": "oraNod", "createdAt": "2020-11-06T16:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1NDIwMQ=="}], "type": "inlineReview"}, {"oid": "77474288678f63b533beaf9d89e350c3f424406d", "url": "https://github.com/infinispan/infinispan/commit/77474288678f63b533beaf9d89e350c3f424406d", "message": "clarify sym_encrypt is not less secure than asym_encrypt", "committedDate": "2020-11-09T15:34:39Z", "type": "forcePushed"}, {"oid": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "url": "https://github.com/infinispan/infinispan/commit/483e1051c14c5106819a8b559b5da6000ae0d1e3", "message": "ISPN-10851 JGroups encrypt docs", "committedDate": "2020-11-13T14:23:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEzMjU0MA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523132540", "bodyText": "what kind of security are we trying to achieve here? RSA 512 bits isn't secure since 2000 and can be crack in a couple of hours currently.", "author": "pruivo", "createdAt": "2020-11-13T18:06:47Z", "path": "documentation/src/main/asciidoc/topics/config_examples/jgroups_asym_encrypt.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<infinispan>\n+    <jgroups>\n+         <stack name=\"encrypt-tcp\" extends=\"tcp\"> <1>\n+           <SSL_KEY_EXCHANGE keystore_name=\"mykeystore.jks\" <2>\n+                             keystore_password=\"changeit\" <3>\n+                             stack.combine=\"INSERT_AFTER\"\n+                             stack.position=\"VERIFY_SUSPECT\"/> <4>\n+           <ASYM_ENCRYPT asym_keylength=\"512\" <5>", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDExNTM0OQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r524115349", "bodyText": "@pruivo Well spotted. Do you think we should change to 2048 or is there something better?", "author": "oraNod", "createdAt": "2020-11-16T10:52:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEzMjU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDMxNTY4Nw==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r524315687", "bodyText": "2048 is fine. You have 4096 if you want to be safe for the next +1000 years or so xD", "author": "pruivo", "createdAt": "2020-11-16T14:39:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEzMjU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE0NzU4Nw==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523147587", "bodyText": "is the public key encrypted? @belaban ?", "author": "pruivo", "createdAt": "2020-11-13T18:32:13Z", "path": "documentation/src/main/asciidoc/topics/con_jgroups_encrypt.adoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[id='jgroups_encryption-{context}']\n+= {brandname} Cluster Security\n+To secure cluster traffic, you configure {brandname} nodes to encrypt JGroups message payloads with secret keys.\n+\n+{brandname} nodes can obtain secret keys from either:\n+\n+* The coordinator node (asymmetric encryption).\n+* A shared keystore (symmetric encryption).\n+\n+.Retrieving secret keys from coordinator nodes\n+\n+You configure asymmetric encryption by adding the `ASYM_ENCRYPT` protocol to a JGroups stack in your {brandname} configuration.\n+This allows {brandname} clusters to generate and distribute secret keys.\n+\n+[IMPORTANT]\n+====\n+When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.\n+This protects your cluster from man-in-the-middle (MitM) attacks.\n+====\n+\n+Asymmetric encryption secures cluster traffic as follows:\n+\n+. The first node in the {brandname} cluster, the coordinator node, generates a secret key.\n+. A joining node performs certificate authentication with the coordinator to mutually verify identity.\n+. The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcyMTY0OA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523721648", "bodyText": "@pruivo If this is with SSL_ENCRYPT, then the entire request goes out over SSL, so, yes.", "author": "belaban", "createdAt": "2020-11-15T07:45:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE0NzU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE0ODU1Mw==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523148553", "bodyText": "is the message signed? what if an attacker injects a message with some other key encrypted (basically a DoS attack)?\n//crap, I'm overthinking again...", "author": "pruivo", "createdAt": "2020-11-13T18:33:52Z", "path": "documentation/src/main/asciidoc/topics/con_jgroups_encrypt.adoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[id='jgroups_encryption-{context}']\n+= {brandname} Cluster Security\n+To secure cluster traffic, you configure {brandname} nodes to encrypt JGroups message payloads with secret keys.\n+\n+{brandname} nodes can obtain secret keys from either:\n+\n+* The coordinator node (asymmetric encryption).\n+* A shared keystore (symmetric encryption).\n+\n+.Retrieving secret keys from coordinator nodes\n+\n+You configure asymmetric encryption by adding the `ASYM_ENCRYPT` protocol to a JGroups stack in your {brandname} configuration.\n+This allows {brandname} clusters to generate and distribute secret keys.\n+\n+[IMPORTANT]\n+====\n+When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.\n+This protects your cluster from man-in-the-middle (MitM) attacks.\n+====\n+\n+Asymmetric encryption secures cluster traffic as follows:\n+\n+. The first node in the {brandname} cluster, the coordinator node, generates a secret key.\n+. A joining node performs certificate authentication with the coordinator to mutually verify identity.\n+. The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.\n+. The coordinator node encrypts the secret key with the public key and returns it to the joining node.", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1MzgwNg==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523153806", "bodyText": "@belaban can you comment on what \"faster\" means here? If I understood the description properly, the asymmetric algorithm is only used to exchange the session key. Then, all messages are encrypted with a symmetric algorithm (so as in SYM_ENCRYPT); so the performance should be the same (assuming the same sym algo)", "author": "pruivo", "createdAt": "2020-11-13T18:41:42Z", "path": "documentation/src/main/asciidoc/topics/con_jgroups_encrypt.adoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[id='jgroups_encryption-{context}']\n+= {brandname} Cluster Security\n+To secure cluster traffic, you configure {brandname} nodes to encrypt JGroups message payloads with secret keys.\n+\n+{brandname} nodes can obtain secret keys from either:\n+\n+* The coordinator node (asymmetric encryption).\n+* A shared keystore (symmetric encryption).\n+\n+.Retrieving secret keys from coordinator nodes\n+\n+You configure asymmetric encryption by adding the `ASYM_ENCRYPT` protocol to a JGroups stack in your {brandname} configuration.\n+This allows {brandname} clusters to generate and distribute secret keys.\n+\n+[IMPORTANT]\n+====\n+When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.\n+This protects your cluster from man-in-the-middle (MitM) attacks.\n+====\n+\n+Asymmetric encryption secures cluster traffic as follows:\n+\n+. The first node in the {brandname} cluster, the coordinator node, generates a secret key.\n+. A joining node performs certificate authentication with the coordinator to mutually verify identity.\n+. The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.\n+. The coordinator node encrypts the secret key with the public key and returns it to the joining node.\n+. The joining node decrypts and installs the secret key.\n+. The node joins the cluster, encrypting and decrypting messages with the secret key.\n+\n+.Retrieving secret keys from shared keystores\n+\n+You configure symmetric encryption by adding the `SYM_ENCRYPT` protocol to a JGroups stack in your {brandname} configuration.\n+This allows {brandname} clusters to obtain secret keys from keystores that you provide.\n+\n+. Nodes install the secret key from a keystore on the {brandname} classpath at startup.\n+. Node join clusters, encrypting and decrypting messages with the secret key.\n+\n+.Comparison of asymmetric and symmetric encryption\n+\n+`ASYM_ENCRYPT` with certificate authentication provides an additional layer of encryption in comparison with `SYM_ENCRYPT`.\n+You provide keystores that encrypt the requests to coordinator nodes for the secret key.\n+{brandname} automatically generates that secret key and handles cluster traffic, while letting you specify when to generate secret keys.\n+For example, you can configure clusters to generate new secret keys when nodes leave.\n+This ensures that nodes cannot bypass certificate authentication and join with old keys.\n+\n+`SYM_ENCRYPT`, on the other hand, is faster than `ASYM_ENCRYPT` because nodes install secret keys directly from keystores, rather than over the network.", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcyMTc1NQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523721755", "bodyText": "Faster means that establishment of a connection is faster with SYM_ENCRYPT, as we don't need to exchange keys first. After that, during regular operation, both protocols have the same speed.", "author": "belaban", "createdAt": "2020-11-15T07:46:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1MzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDExMzYyNA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r524113624", "bodyText": "Thanks for the comments here, guys. @pruivo Does the \"because nodes install ...\" phrase not convey the reason why SYM_ENCRYPT is faster? Each node just gets the key from the keystore on it's classpath instead of having to do key exchange with the coordinator, because joining nodes send their public keys to get the secret key from the coordinator. Actually I think I'll just reword to something like this. Cheers. \ud83d\ude38", "author": "oraNod", "createdAt": "2020-11-16T10:51:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1MzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDMyMDc0MQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r524320741", "bodyText": "@oraNod I wanted to be sure if there isn't anything weird happening in the background.\nUsually, the network latency is quite low, so the time to install the key from the coordinator or the latency accessing the disk to install from the file (keystore) shouldn't differ much (IMO, of course, I could be wrong eh eh).", "author": "pruivo", "createdAt": "2020-11-16T14:46:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1MzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUxMDQxOQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r525510419", "bodyText": "@pruivo I got this from Bela who said \"I would also document SYM_ENCRYPT, as it is faster than ASYM_ENCRYPT.\" I've reworded this a little. Maybe I should trim things down some more and say:\n\"SYM_ENCRYPT, on the other hand, is faster than ASYM_ENCRYPT because nodes do not need to perform key exchange with the cluster coordinator.\"\nAnd drop the bit about \"install secret keys directly from keystores on their classpaths\" - I see your point about latency. WDYT?", "author": "oraNod", "createdAt": "2020-11-17T20:40:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1MzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTkxOTcwMA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r525919700", "bodyText": "sound good \ud83d\udc4d", "author": "pruivo", "createdAt": "2020-11-18T09:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1MzgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1NDgxMg==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523154812", "bodyText": "isn't {server_home}/server/conf?", "author": "pruivo", "createdAt": "2020-11-13T18:43:46Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_jgroups_asym_encrypt.adoc", "diffHunk": "@@ -0,0 +1,53 @@\n+[id='configuring_jgroups_asym_encrypt-{context}']\n+= Configuring Cluster Transport with Asymmetric Encryption\n+Configure {brandname} clusters to generate and distribute secret keys that encrypt JGroups messages.\n+\n+.Procedure\n+\n+. Create a keystore with certificate chains that enables {brandname} to verify node identity.\n+. Place the keystore on the classpath for each node in the cluster.\n++\n+For {brandname} Server, you put the keystore in the {server_home} directory.", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2NDg1NA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523164854", "bodyText": "actually, use the same path as in https://infinispan.org/docs/stable/titles/server/server.html#configuring_infinispan_log_properties\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For {brandname} Server, you put the keystore in the {server_home} directory.\n          \n          \n            \n            For {brandname} Server, you put the keystore in the `{server_home}/${infinispan.server.root}/conf/` directory.", "author": "pruivo", "createdAt": "2020-11-13T19:03:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1NDgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDEwNzc5Mg==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r524107792", "bodyText": "@pruivo I think the keystore needs to be in $ISPN_HOME. if not you the server throws an exception.", "author": "oraNod", "createdAt": "2020-11-16T10:45:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1NDgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk5MTMxNQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r525991315", "bodyText": "you're right, as usual :)", "author": "pruivo", "createdAt": "2020-11-18T10:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1NDgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1NTc4MA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523155780", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * link:{jgroups_schema}[JGroups 4.2 XSD]\n          \n          \n            \n            * link:{jgroups_schema}[JGroups 4.2 Schema]", "author": "pruivo", "createdAt": "2020-11-13T18:45:41Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_jgroups_sym_encrypt.adoc", "diffHunk": "@@ -0,0 +1,50 @@\n+[id='configuring_jgroups_sym_encrypt-{context}']\n+= Configuring Cluster Transport with Symmetric Encryption\n+Configure {brandname} clusters to encrypt JGroups messages with secret keys from keystores that you provide.\n+\n+.Procedure\n+\n+. Create a keystore that contains a secret key.\n+. Place the keystore on the classpath for each node in the cluster.\n++\n+For {brandname} Server, you put the keystore in the {server_home} directory.\n++\n+. Add the `SYM_ENCRYPT` protocol to a JGroups stack in your {brandname} configuration, as in the following example:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/jgroups_sym_encrypt.xml[]\n+----\n++\n+<1> Creates a secure JGroups stack named \"encrypt-tcp\" that extends the default TCP stack for {brandname}.\n+<2> Names the keystore from which nodes obtain secret keys.\n+<3> Specifies the keystore type. JGroups uses JCEKS by default.\n+<4> Specifies the keystore password.\n+<5> Specifies the secret key password.\n+<6> Specifies the secret key alias.\n+<7> Uses the `stack.combine` and `stack.position` attributes to insert `SYM_ENCRYPT` into the default TCP stack after the `VERIFY_SUSPECT` protocol.\n+<8> Configures the {brandname} cluster to use the secure JGroups stack.\n+\n+.Verification\n+\n+When you start your {brandname} cluster, the following log message indicates that the cluster is using the secure JGroups stack:\n+\n+[source,bash,options=\"nowrap\"]\n+----\n+[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack <encrypted_stack_name>\n+----\n+\n+{brandname} nodes can join the cluster only if they use `SYM_ENCRYPT` and can obtain the secret key from the shared keystore.\n+Otherwise the following message is written to {brandname} logs:\n+\n+----\n+[org.jgroups.protocols.SYM_ENCRYPT] <hostname>: received message without encrypt header from <hostname>; dropping it\n+----\n+\n+.Reference\n+\n+The example `SYM_ENCRYPT` configuration in this procedure shows commonly used parameters.\n+Refer to JGroups documentation for the full set of available parameters.\n+\n+* link:{jgroups_docs}[JGroups 4 Manual]\n+* link:{jgroups_schema}[JGroups 4.2 XSD]", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1NjAwMA==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523156000", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * link:{jgroups_schema}[JGroups 4.2 XSD]\n          \n          \n            \n            * link:{jgroups_schema}[JGroups 4.2 Schema]", "author": "pruivo", "createdAt": "2020-11-13T18:46:06Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_jgroups_asym_encrypt.adoc", "diffHunk": "@@ -0,0 +1,53 @@\n+[id='configuring_jgroups_asym_encrypt-{context}']\n+= Configuring Cluster Transport with Asymmetric Encryption\n+Configure {brandname} clusters to generate and distribute secret keys that encrypt JGroups messages.\n+\n+.Procedure\n+\n+. Create a keystore with certificate chains that enables {brandname} to verify node identity.\n+. Place the keystore on the classpath for each node in the cluster.\n++\n+For {brandname} Server, you put the keystore in the {server_home} directory.\n++\n+. Add the `SSL_KEY_EXCHANGE` and `ASYM_ENCRYPT` protocols to a JGroups stack in your {brandname} configuration, as in the following example:\n++\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+include::config_examples/jgroups_asym_encrypt.xml[]\n+----\n++\n+<1> Creates a secure JGroups stack named \"encrypt-tcp\" that extends the default TCP stack for {brandname}.\n+<2> Names the keystore that nodes use to perform certificate authentication.\n+<3> Specifies the keystore password.\n+<4> Uses the `stack.combine` and `stack.position` attributes to insert `SSL_KEY_EXCHANGE` into the default TCP stack after the `VERIFY_SUSPECT` protocol.\n+<5> Specifies the length of the secret key that the coordinator node generates. The default value is `2048`.\n+<6> Specifies the cipher engine the coordinator node uses to generate secret keys. The default value is `RSA`.\n+<7> Configures {brandname} to generate and distribute a new secret key when the coordinator node changes.\n+<8> Configures {brandname} to generate and distribute a new secret key when nodes leave.\n+<9> Configures {brandname} nodes to use the `SSL_KEY_EXCHANGE` protocol for certificate authentication.\n+<10> Uses the `stack.combine` and `stack.position` attributes to insert `ASYM_ENCRYPT` into the default TCP stack before the `pbcast.NAKACK2` protocol.\n+<11> Configures the {brandname} cluster to use the secure JGroups stack.\n+\n+.Verification\n+\n+When you start your {brandname} cluster, the following log message indicates that the cluster is using the secure JGroups stack:\n+\n+[source,bash,options=\"nowrap\"]\n+----\n+[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack <encrypted_stack_name>\n+----\n+\n+{brandname} nodes can join the cluster only if they use `ASYM_ENCRYPT` and can obtain the secret key from the coordinator node.\n+Otherwise the following message is written to {brandname} logs:\n+\n+----\n+[org.jgroups.protocols.ASYM_ENCRYPT] <hostname>: received message without encrypt header from <hostname>; dropping it\n+----\n+\n+.Reference\n+\n+The example `ASYM_ENCRYPT` configuration in this procedure shows commonly used parameters.\n+Refer to JGroups documentation for the full set of available parameters.\n+\n+* link:{jgroups_docs}[JGroups 4 Manual]\n+* link:{jgroups_schema}[JGroups 4.2 XSD]", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1ODE4NQ==", "url": "https://github.com/infinispan/infinispan/pull/8832#discussion_r523158185", "bodyText": "{server_home}/server/conf I think...", "author": "pruivo", "createdAt": "2020-11-13T18:50:21Z", "path": "documentation/src/main/asciidoc/topics/proc_configuring_jgroups_sym_encrypt.adoc", "diffHunk": "@@ -0,0 +1,50 @@\n+[id='configuring_jgroups_sym_encrypt-{context}']\n+= Configuring Cluster Transport with Symmetric Encryption\n+Configure {brandname} clusters to encrypt JGroups messages with secret keys from keystores that you provide.\n+\n+.Procedure\n+\n+. Create a keystore that contains a secret key.\n+. Place the keystore on the classpath for each node in the cluster.\n++\n+For {brandname} Server, you put the keystore in the {server_home} directory.", "originalCommit": "483e1051c14c5106819a8b559b5da6000ae0d1e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c1beb6ebd3946e7b857f2e156920f3aab0de24b", "url": "https://github.com/infinispan/infinispan/commit/1c1beb6ebd3946e7b857f2e156920f3aab0de24b", "message": "ISPN-10851 JGroups encrypt docs", "committedDate": "2020-11-16T10:56:06Z", "type": "forcePushed"}, {"oid": "8cfd53645e8b3b4f723f10429a498f2967b03059", "url": "https://github.com/infinispan/infinispan/commit/8cfd53645e8b3b4f723f10429a498f2967b03059", "message": "RSA length", "committedDate": "2020-11-17T20:40:34Z", "type": "forcePushed"}, {"oid": "2df08f63c34b9e2f63706d0c62c72dc7e5377f58", "url": "https://github.com/infinispan/infinispan/commit/2df08f63c34b9e2f63706d0c62c72dc7e5377f58", "message": "ISPN-10851 JGroups encrypt docs", "committedDate": "2020-11-18T09:16:16Z", "type": "forcePushed"}, {"oid": "272021c5540ed7bddda03b24a834d24b412c6764", "url": "https://github.com/infinispan/infinispan/commit/272021c5540ed7bddda03b24a834d24b412c6764", "message": "ISPN-10851 JGroups encrypt docs", "committedDate": "2020-11-23T17:16:59Z", "type": "commit"}, {"oid": "272021c5540ed7bddda03b24a834d24b412c6764", "url": "https://github.com/infinispan/infinispan/commit/272021c5540ed7bddda03b24a834d24b412c6764", "message": "ISPN-10851 JGroups encrypt docs", "committedDate": "2020-11-23T17:16:59Z", "type": "forcePushed"}]}