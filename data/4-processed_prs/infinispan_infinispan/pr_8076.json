{"pr_number": 8076, "pr_title": "ISPN-11504 update docs with segment column name for jdbc cache stores", "pr_createdAt": "2020-03-23T12:31:25Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8076", "timeline": [{"oid": "78b4852e5929fb64dd9b565e3d0a436738f9515d", "url": "https://github.com/infinispan/infinispan/commit/78b4852e5929fb64dd9b565e3d0a436738f9515d", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-23T13:07:34Z", "type": "forcePushed"}, {"oid": "c0493c27f75606eb12e887c9f551e50504cb8612", "url": "https://github.com/infinispan/infinispan/commit/c0493c27f75606eb12e887c9f551e50504cb8612", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-23T17:29:55Z", "type": "forcePushed"}, {"oid": "7b7c74fb0980f530814ca2cf981e0ac6101594fc", "url": "https://github.com/infinispan/infinispan/commit/7b7c74fb0980f530814ca2cf981e0ac6101594fc", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-23T17:31:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyNjI5MA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r396626290", "bodyText": "This should probably just be INT as well.", "author": "ryanemerson", "createdAt": "2020-03-23T17:27:15Z", "path": "documentation/src/main/asciidoc/topics/code_examples/PersistenceJdbcStringBasedStore.java", "diffHunk": "@@ -11,6 +11,7 @@\n          .idColumnName(\"ID_COLUMN\").idColumnType(\"VARCHAR(255)\")\n          .dataColumnName(\"DATA_COLUMN\").dataColumnType(\"BINARY\")\n          .timestampColumnName(\"TIMESTAMP_COLUMN\").timestampColumnType(\"BIGINT\")\n+         .segmentColumnName(\"SEGMENT_COLUMN\").segmentColumnType(\"BIGINT\")", "originalCommit": "78b4852e5929fb64dd9b565e3d0a436738f9515d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyODEwNA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r396628104", "bodyText": "The original wording is more accurate. If passivation is enabled, then not all entries will be stored in-memory.", "author": "ryanemerson", "createdAt": "2020-03-23T17:29:47Z", "path": "documentation/src/main/asciidoc/topics/con_write_through.adoc", "diffHunk": "@@ -1,10 +1,14 @@\n [id='write_through']\n = Write-Through\n-Write-Through is an cache writing mode where writes to memory and writes to cache stores are synchronous. When a client application updates a cache entry, in most cases by invoking `Cache.put()`, {brandname} does not return the call until it updates the cache store. This cache writing mode results in updates to the cache store concluding within the boundaries of the client thread.\n+Write-Through is an cache writing mode where writes to memory and writes to\n+cache stores are synchronous. When a client application updates a cache entry,\n+in most cases by invoking `Cache.put()`, {brandname} does not return the call\n+until it updates the cache store. This cache writing mode results in updates to\n+the cache store concluding within the boundaries of the client thread.\n \n The primary advantage of Write-Through mode is that the cache and cache store\n-are updated simultaneously, which ensures that the cache store is always\n-consistent with the cache.\n+are updated simultaneously, which ensures that the cache store contains all\n+entries that are in-memory.", "originalCommit": "78b4852e5929fb64dd9b565e3d0a436738f9515d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA3NDUzNA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r408074534", "bodyText": "@ryanemerson @oraNod\nI meant to change or explain the word \"cache\" as for me \"cache\" means the complete clustered cache. But in case of a local cache-store (like file) it contains only the entries where this node is the owner.\nBut maybe this is too technical thinking and might confuse other users", "author": "wfink", "createdAt": "2020-04-14T11:49:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyODEwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyODgyNg==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r396628826", "bodyText": "INT", "author": "ryanemerson", "createdAt": "2020-03-23T17:30:44Z", "path": "documentation/src/main/asciidoc/topics/config_examples/persistence_example_jdbc.xml", "diffHunk": "@@ -1,14 +1,14 @@\n <persistence>\n-   <string-keyed-jdbc-store xmlns=\"urn:infinispan:config:store:jdbc:{schemaversion}\"\n-     shared=\"true\">\n+   <string-keyed-jdbc-store xmlns=\"urn:infinispan:config:store:jdbc:{schemaversion}\" shared=\"true\">\n       <connection-pool connection-url=\"jdbc:h2:mem:infinispan_string_based;DB_CLOSE_DELAY=-1\"\n-        username=\"sa\"\n-        driver=\"org.h2.Driver\"/>\n+                       username=\"sa\"\n+                       driver=\"org.h2.Driver\"/>\n       <string-keyed-table drop-on-exit=\"true\"\n-        prefix=\"ISPN_STRING_TABLE\">\n+                          prefix=\"ISPN_STRING_TABLE\">\n          <id-column name=\"ID_COLUMN\" type=\"VARCHAR(255)\" />\n          <data-column name=\"DATA_COLUMN\" type=\"BINARY\" />\n          <timestamp-column name=\"TIMESTAMP_COLUMN\" type=\"BIGINT\" />\n+         <segment-column name=\"SEGMENT_COLUMN\" type=\"BIGINT\" />", "originalCommit": "c0493c27f75606eb12e887c9f551e50504cb8612", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyOTM4NA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r396629384", "bodyText": "Maybe lose \"additional\" as it's no longer optional by default.", "author": "ryanemerson", "createdAt": "2020-03-23T17:31:29Z", "path": "documentation/src/main/asciidoc/topics/ref_cache_store_jdbc.adoc", "diffHunk": "@@ -19,5 +19,5 @@ shared.\n \n .Segmentation\n \n-`JdbcStringBasedStore` supports segmentation and uses an additional column in\n-the database table to represent the segment to which an entry belongs.\n+`JdbcStringBasedStore` uses segmentation by default and requires an additional\n+column in the database table to represent the segments to which entries belong.", "originalCommit": "c0493c27f75606eb12e887c9f551e50504cb8612", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzMDkxNA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r396630914", "bodyText": "The second sentence is not that clear imo. The store maintains an in-memory index of keys, whilst key/values are stored in the file.", "author": "ryanemerson", "createdAt": "2020-03-23T17:33:42Z", "path": "documentation/src/main/asciidoc/topics/ref_cache_store_sfs.adoc", "diffHunk": "@@ -1,14 +1,17 @@\n [id='sfs_cache_store']\n = Single File Cache Stores\n-Single File cache stores, `SingleFileStore`, persist data to a single file and maintains an in-memory index of keys and their values in that file.\n+Single File cache stores, `SingleFileStore`, persist data to file. {brandname}\n+also maintains an in-memory index of keys and their values in the store. By\n+default, Single File cache stores are segmented, which means that {brandname}", "originalCommit": "7b7c74fb0980f530814ca2cf981e0ac6101594fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "056339b8fcff06eceb1ffe9db12ff5ba2f078ba9", "url": "https://github.com/infinispan/infinispan/commit/056339b8fcff06eceb1ffe9db12ff5ba2f078ba9", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-23T19:55:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxOTUxMQ==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r397019511", "bodyText": "This second sentence needs more information. This is what I was clarifying for Wolf. If fail-silently is false, the exceptions are only thrown once the modification queue size becomes full or if  the underlying store is known to be unavailable when a write operation is attempted. For example if the queue size is 100, during the time it takes for the store to be detected as unavailable, it's possible for 99 write operations to be queued without an exception being thrown. If the server is then kill before the store becomes available again, those 99 operations will be lost as they were never persisted.", "author": "ryanemerson", "createdAt": "2020-03-24T09:42:18Z", "path": "documentation/src/main/asciidoc/topics/con_write_behind.adoc", "diffHunk": "@@ -26,6 +26,15 @@ write to the cache and the write to the cache store is as small as possible.\n include::config_examples/persistence_write_through_async.xml[]\n ----\n \n+The preceding configuration example uses the `fail-silently` parameter to\n+control what happens when either the cache store is unavailable or the\n+modification queue is full.\n+\n+* If `fail-silently=\"true\"` then {brandname} logs WARN messages and rejects\n+write operations.\n+* If `fail-silently=\"false\"` then {brandname} throws exceptions and rejects\n+write operations.", "originalCommit": "056339b8fcff06eceb1ffe9db12ff5ba2f078ba9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "206f1e68f3da5cb51b28a7e66b731af008b7b151", "url": "https://github.com/infinispan/infinispan/commit/206f1e68f3da5cb51b28a7e66b731af008b7b151", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-24T10:23:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1MTY4NA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r397051684", "bodyText": "@ryanemerson hey does this sound right? not sure if we need to add some guidance on what to do if you have a segmented cache store with an older version, such as 9.4. I think it's probably not an issue for RHDG given that segmentation was not supported with most cache stores, if any. but could there be a case where users in 9.4 could have a segmented cache store and no path to migrate data to 10+?", "author": "oraNod", "createdAt": "2020-03-24T10:34:54Z", "path": "documentation/src/main/asciidoc/topics/con_store_migrator.adoc", "diffHunk": "@@ -14,3 +14,9 @@ the target cache.\n `StoreMigrator` also lets you migrate data from one type of cache store to\n another. For example, you can migrate from a JDBC String-Based cache store to a\n Single File cache store.\n+\n+[IMPORTANT]\n+====\n+`StoreMigrator` migrates non-segmented cache stores to segmented cache stores\n+only. It is not currently possible to migrate segmented cache stores.\n+====", "originalCommit": "ef71bafe053f63c6ad13e0afb199224e83d364db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyNDI3OQ==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r397924279", "bodyText": "@wburns When were segmented stores added? 9.4.x or 10.x?", "author": "ryanemerson", "createdAt": "2020-03-25T15:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1MTY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyNjA4NA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r397926084", "bodyText": "It was added in 9.4.x. The sentence here is incorrect. The problem is you can't migrate from a segmented store to either different number of segment store or non segmented.", "author": "wburns", "createdAt": "2020-03-25T15:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1MTY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAwMjMxMA==", "url": "https://github.com/infinispan/infinispan/pull/8076#discussion_r398002310", "bodyText": "thanks for clarifying @wburns  !", "author": "oraNod", "createdAt": "2020-03-25T16:39:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1MTY4NA=="}], "type": "inlineReview"}, {"oid": "852801adb0a8127e3b5643576f84b9bfc5a0bc81", "url": "https://github.com/infinispan/infinispan/commit/852801adb0a8127e3b5643576f84b9bfc5a0bc81", "message": "storemigrator segmented only", "committedDate": "2020-03-24T12:50:15Z", "type": "forcePushed"}, {"oid": "e21fe6aea36300cd8b504a9946dd408267a66df2", "url": "https://github.com/infinispan/infinispan/commit/e21fe6aea36300cd8b504a9946dd408267a66df2", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-25T14:57:51Z", "type": "forcePushed"}, {"oid": "f723336f4baebec2ef731a3b18ab2ac04b876e4f", "url": "https://github.com/infinispan/infinispan/commit/f723336f4baebec2ef731a3b18ab2ac04b876e4f", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-25T16:39:09Z", "type": "forcePushed"}, {"oid": "35883364525d6010877090a6b15a0862936b40c1", "url": "https://github.com/infinispan/infinispan/commit/35883364525d6010877090a6b15a0862936b40c1", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-26T09:29:35Z", "type": "forcePushed"}, {"oid": "0425b2dc63803b489d8d103b6283c413f8377f41", "url": "https://github.com/infinispan/infinispan/commit/0425b2dc63803b489d8d103b6283c413f8377f41", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-26T10:11:58Z", "type": "commit"}, {"oid": "0425b2dc63803b489d8d103b6283c413f8377f41", "url": "https://github.com/infinispan/infinispan/commit/0425b2dc63803b489d8d103b6283c413f8377f41", "message": "ISPN-11504 update docs with segment column name for jdbc cache stores", "committedDate": "2020-03-26T10:11:58Z", "type": "forcePushed"}]}