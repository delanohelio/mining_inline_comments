{"pr_number": 8658, "pr_title": "ISPN-12272 clarify xsite docs", "pr_createdAt": "2020-08-31T15:23:48Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8658", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkzOTkzNA==", "url": "https://github.com/infinispan/infinispan/pull/8658#discussion_r480939934", "bodyText": "infinispan doesn't wait after the 5 failures. it always waits from the first failure\n\"the site is taken offline if +5 consecutive failures & 10 seconds elapsed since the first failure\"", "author": "pruivo", "createdAt": "2020-09-01T07:53:44Z", "path": "documentation/src/main/asciidoc/topics/con_xsite_auto_offline.adoc", "diffHunk": "@@ -1,58 +1,65 @@\n [id='xsite_auto_offline-{context}']\n-= Taking Sites Offline Automatically\n-Backup configurations include timeout values for operations to replicate\n-data to remote sites. When backup operations reach the timeout, {brandname}\n-records the operation as a failure.\n+= Automatically Taking Backups Offline\n+You can configure backup locations to go offline automatically when the remote\n+sites become unavailable. This prevents {brandname} nodes from continuously\n+attempting to replicate data to offline backup locations, which results in\n+error messages and consumes resources.\n \n-To automatically take sites offline, you can then configure the\n-number of **consecutive** failures that can occur.\n-\n-For example, the **NYC** backup configuration specifies five as the number of\n-failures after which **NYC** goes offline. If **LON** attempts five consecutive\n-backup operations that fail, {brandname} automatically takes **NYC** offline.\n-**LON** then stops backing up to **NYC** until you bring the site back online.\n+.Timeout for backup operations\n+Backup configurations include timeout values for operations to replicate data.\n+If operations do not complete before the timeout occurs, Infinispan records\n+them as failures.\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-<backup site=\"NYC\" strategy=\"ASYNC\">\n-\t<take-offline after-failures=\"5\"/>\n+<backup site=\"NYC\" strategy=\"ASYNC\" timeout=\"10000\"> <1>\n+\t...\n </backup>\n ----\n \n-You can also specify the amount of time to wait before taking sites offline.\n-When backup operations fail, {brandname} waits before taking sites offline. If\n-a backup request succeeds before the wait time runs out, {brandname} does not\n-take the site offline.\n+<1> Operations to replicate data to **NYC** are recorded as failures if they do\n+not complete after 10 seconds.\n+\n+.Number of failures\n+You can specify the number of **consecutive** failures that can occur before\n+backup locations go offline.\n+\n+For example, the following configuration for **NYC** sets five as the number of\n+failed operations before it goes offline:\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-<backup site=\"NYC\" strategy=\"ASYNC\">\n-\t<take-offline after-failures=\"5\"\n-                min-wait=\"10000\"/>\n+<backup site=\"NYC\" strategy=\"ASYNC\" timeout=\"10000\">\n+\t<take-offline after-failures=\"5\"/> <1>\n </backup>\n ----\n \n-In the preceding example, if failures occur for 5 consecutive operations,\n-{brandname} waits 10 seconds and, if no requests are successful within the 10\n-second wait time, {brandname} then takes **NYC** offline.\n+<1> If a cluster attempts to replicate data to **NYC** and five consecutive\n+operations fail, {brandname} automatically takes the backup offline.\n \n-To use only a minimum wait time for automatically taking locations offline, set\n-a negative or zero value for the `after-failures` attribute; for example:\n+.Time to wait\n+You can also specify how long to wait before taking sites offline when backup\n+operations fail. If a backup request succeeds before the wait time runs out,\n+{brandname} does not take the site offline.\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-<backup site=\"NYC\" strategy=\"ASYNC\">\n-\t<take-offline after-failures=\"-1\"\n-                min-wait=\"10000\"/>\n+<backup site=\"NYC\" strategy=\"ASYNC\" timeout=\"10000\">\n+\t<take-offline after-failures=\"5\"\n+                min-wait=\"10000\"/> <1>\n </backup>\n ----\n \n+<1> If five consecutive operations fail, {brandname} waits 10 seconds and, if", "originalCommit": "a03c5b592bab7e8af08819ad1e50e899656b246a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk0MjU2OA==", "url": "https://github.com/infinispan/infinispan/pull/8658#discussion_r480942568", "bodyText": "this is not a valid JGroups' configuration file.\nWhat are you trying to achieve here?", "author": "pruivo", "createdAt": "2020-09-01T07:56:48Z", "path": "documentation/src/main/asciidoc/topics/ref_xsite_jgroups_relay_custom.adoc", "diffHunk": "@@ -24,9 +24,41 @@\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-include::config_examples/jgroups-relay.xml[]\n+<config xmlns=\"urn:org:jgroups\"\n+      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+      xsi:schemaLocation=\"urn:org:jgroups http://www.jgroups.org/schema/jgroups-4.1.xsd\">\n+\n+    <!-- Use TCP for inter-cluster transport. -->\n+    <TCP bind_addr=\"127.0.0.1\"\n+         bind_port=\"7200\"\n+         port_range=\"30\"\n+\n+         thread_pool.min_threads=\"0\"\n+         thread_pool.max_threads=\"8\"\n+         thread_pool.keep_alive_time=\"5000\"\n+    />\n+\n+    <!-- Use TCPPING for inter-cluster discovery. -->\n+    <TCPPING timeout=\"3000\"\n+             initial_hosts=\"127.0.0.1[7200]\"\n+             port_range=\"3\"\n+             ergonomics=\"false\"/>\n+\n+    <jgroups>", "originalCommit": "a03c5b592bab7e8af08819ad1e50e899656b246a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk0MzcyOQ==", "url": "https://github.com/infinispan/infinispan/pull/8658#discussion_r480943729", "bodyText": "@wfink please clarify ^", "author": "oraNod", "createdAt": "2020-09-01T07:58:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk0MjU2OA=="}], "type": "inlineReview"}, {"oid": "bc5f78835d67f3f0886685c18194b9020a8f4777", "url": "https://github.com/infinispan/infinispan/commit/bc5f78835d67f3f0886685c18194b9020a8f4777", "message": "wolf review", "committedDate": "2020-09-01T16:26:14Z", "type": "forcePushed"}, {"oid": "189918fc7da64876460128e8bc1248d5a995d1bc", "url": "https://github.com/infinispan/infinispan/commit/189918fc7da64876460128e8bc1248d5a995d1bc", "message": "wolf review", "committedDate": "2020-09-01T16:31:19Z", "type": "forcePushed"}, {"oid": "c6e42a4b8af30eb5240372183a8a631b47ae4514", "url": "https://github.com/infinispan/infinispan/commit/c6e42a4b8af30eb5240372183a8a631b47ae4514", "message": "ISPN-12272 clarify xsite docs", "committedDate": "2020-09-02T09:39:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1ODEwNg==", "url": "https://github.com/infinispan/infinispan/pull/8658#discussion_r482058106", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            consecutive failures or 15 seconds elapse after the first failed operation,\n          \n          \n            \n            consecutive failures and 15 seconds elapse after the first failed operation,", "author": "pruivo", "createdAt": "2020-09-02T13:13:56Z", "path": "documentation/src/main/asciidoc/topics/con_xsite_auto_offline.adoc", "diffHunk": "@@ -1,58 +1,66 @@\n [id='xsite_auto_offline-{context}']\n-= Taking Sites Offline Automatically\n-Backup configurations include timeout values for operations to replicate\n-data to remote sites. When backup operations reach the timeout, {brandname}\n-records the operation as a failure.\n+= Automatically Taking Backups Offline\n+You can configure backup locations to go offline automatically when the remote\n+sites become unavailable. This prevents {brandname} nodes from continuously\n+attempting to replicate data to offline backup locations, which results in\n+error messages and consumes resources.\n \n-To automatically take sites offline, you can then configure the\n-number of **consecutive** failures that can occur.\n-\n-For example, the **NYC** backup configuration specifies five as the number of\n-failures after which **NYC** goes offline. If **LON** attempts five consecutive\n-backup operations that fail, {brandname} automatically takes **NYC** offline.\n-**LON** then stops backing up to **NYC** until you bring the site back online.\n+.Timeout for backup operations\n+Backup configurations include timeout values for operations to replicate data.\n+If operations do not complete before the timeout occurs, Infinispan records\n+them as failures.\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-<backup site=\"NYC\" strategy=\"ASYNC\">\n-\t<take-offline after-failures=\"5\"/>\n+<backup site=\"NYC\" strategy=\"ASYNC\" timeout=\"10000\"> <1>\n+\t...\n </backup>\n ----\n \n-You can also specify the amount of time to wait before taking sites offline.\n-When backup operations fail, {brandname} waits before taking sites offline. If\n-a backup request succeeds before the wait time runs out, {brandname} does not\n-take the site offline.\n+<1> Operations to replicate data to **NYC** are recorded as failures if they do\n+not complete after 10 seconds.\n+\n+.Number of failures\n+You can specify the number of **consecutive** failures that can occur before\n+backup locations go offline.\n+\n+For example, the following configuration for **NYC** sets five as the number of\n+failed operations before it goes offline:\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-<backup site=\"NYC\" strategy=\"ASYNC\">\n-\t<take-offline after-failures=\"5\"\n-                min-wait=\"10000\"/>\n+<backup site=\"NYC\" strategy=\"ASYNC\" timeout=\"10000\">\n+\t<take-offline after-failures=\"5\"/> <1>\n </backup>\n ----\n \n-In the preceding example, if failures occur for 5 consecutive operations,\n-{brandname} waits 10 seconds and, if no requests are successful within the 10\n-second wait time, {brandname} then takes **NYC** offline.\n+<1> If a cluster attempts to replicate data to **NYC** and five consecutive\n+operations fail, {brandname} automatically takes the backup offline.\n \n-To use only a minimum wait time for automatically taking locations offline, set\n-a negative or zero value for the `after-failures` attribute; for example:\n+.Time to wait\n+You can also specify how long to wait before taking sites offline when backup\n+operations fail. If a backup request succeeds before the wait time runs out,\n+{brandname} does not take the site offline.\n \n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-<backup site=\"NYC\" strategy=\"ASYNC\">\n-\t<take-offline after-failures=\"-1\"\n-                min-wait=\"10000\"/>\n+<backup site=\"NYC\" strategy=\"ASYNC\" timeout=\"10000\">\n+\t<take-offline after-failures=\"5\"\n+                min-wait=\"15000\"/> <1>\n </backup>\n ----\n \n+<1> If a cluster attempts to replicate data to **NYC** and there are five\n+consecutive failures or 15 seconds elapse after the first failed operation,", "originalCommit": "c6e42a4b8af30eb5240372183a8a631b47ae4514", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3d30f302bc16d14b8605fab9fc3e2bd26f01f30a", "url": "https://github.com/infinispan/infinispan/commit/3d30f302bc16d14b8605fab9fc3e2bd26f01f30a", "message": "ISPN-12272 clarify xsite docs", "committedDate": "2020-09-02T13:17:22Z", "type": "commit"}, {"oid": "3d30f302bc16d14b8605fab9fc3e2bd26f01f30a", "url": "https://github.com/infinispan/infinispan/commit/3d30f302bc16d14b8605fab9fc3e2bd26f01f30a", "message": "ISPN-12272 clarify xsite docs", "committedDate": "2020-09-02T13:17:22Z", "type": "forcePushed"}]}