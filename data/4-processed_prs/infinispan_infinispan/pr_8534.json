{"pr_number": 8534, "pr_title": "ISPN-12098 JDBC String Base Cache Store (sybase160) trying to create an index when already exist", "pr_createdAt": "2020-07-08T13:23:40Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8534", "timeline": [{"oid": "a01b67f576016db6c33ab3023d1859cd727a591e", "url": "https://github.com/infinispan/infinispan/commit/a01b67f576016db6c33ab3023d1859cd727a591e", "message": "ISPN-12098 JDBC String Base Cache Store (sybase160) trying to create an index when already exist", "committedDate": "2020-07-08T13:52:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA1MjI3Nw==", "url": "https://github.com/infinispan/infinispan/pull/8534#discussion_r452052277", "bodyText": "If we do String index = rs.getString(\"INDEX_NAME\"); if (index != null ...) we only make a single call to the JDBC driver. From the ResultSet docs:\nFor maximum portability, result set columns within each row should be read in left-to-right order, and each column should be read only once.\n\nhttps://docs.oracle.com/javase/8/docs/api/java/sql/ResultSet.html", "author": "ryanemerson", "createdAt": "2020-07-09T08:30:15Z", "path": "persistence/jdbc/src/main/java/org/infinispan/persistence/jdbc/impl/table/SybaseTableManager.java", "diffHunk": "@@ -65,4 +72,24 @@ protected String initUpsertRowSql() {\n                config.segmentColumnName());\n       }\n    }\n+\n+   @Override\n+   protected boolean indexExists(String indexName, Connection conn) throws PersistenceException {\n+      ResultSet rs = null;\n+      try {\n+         DatabaseMetaData meta = conn.getMetaData();\n+         rs = meta.getIndexInfo(null, tableName.getSchema(), tableName.getName(), false, false);\n+\n+         while (rs.next()) {\n+            if (rs.getString(\"INDEX_NAME\") != null && indexName.equalsIgnoreCase(rs.getString(\"INDEX_NAME\").replaceAll(\"\\\"\", \"\"))) {", "originalCommit": "a01b67f576016db6c33ab3023d1859cd727a591e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMyOTg5Nw==", "url": "https://github.com/infinispan/infinispan/pull/8534#discussion_r452329897", "bodyText": "@ryanemerson Good catch, it was updated, thanks", "author": "gustavolira", "createdAt": "2020-07-09T16:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA1MjI3Nw=="}], "type": "inlineReview"}, {"oid": "8c4837ed15afec3302efef83cc755fe3c1883ae9", "url": "https://github.com/infinispan/infinispan/commit/8c4837ed15afec3302efef83cc755fe3c1883ae9", "message": "ISPN-12098 JDBC String Base Cache Store (sybase160) trying to create an index when already exist", "committedDate": "2020-07-09T16:06:15Z", "type": "commit"}, {"oid": "8c4837ed15afec3302efef83cc755fe3c1883ae9", "url": "https://github.com/infinispan/infinispan/commit/8c4837ed15afec3302efef83cc755fe3c1883ae9", "message": "ISPN-12098 JDBC String Base Cache Store (sybase160) trying to create an index when already exist", "committedDate": "2020-07-09T16:06:15Z", "type": "forcePushed"}]}