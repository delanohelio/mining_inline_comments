{"pr_number": 1379, "pr_title": "Improvement: Add error-prone check that forbids extending java.lang.Error", "pr_createdAt": "2020-06-02T20:30:58Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1379", "timeline": [{"oid": "ef0c41ca8721c69242b6421a84071e866c335ff6", "url": "https://github.com/palantir/gradle-baseline/commit/ef0c41ca8721c69242b6421a84071e866c335ff6", "message": "Improvement: Add error-prone check that forbids extending\njava.lang.Error", "committedDate": "2020-06-02T20:19:02Z", "type": "commit"}, {"oid": "b25d914cadf3e485e4db96a140a23102538edd8d", "url": "https://github.com/palantir/gradle-baseline/commit/b25d914cadf3e485e4db96a140a23102538edd8d", "message": "Fix fix", "committedDate": "2020-06-02T20:28:28Z", "type": "commit"}, {"oid": "9c0b21629fba43364dfc3496d9b6ec49e159c757", "url": "https://github.com/palantir/gradle-baseline/commit/9c0b21629fba43364dfc3496d9b6ec49e159c757", "message": "Add generated changelog entries", "committedDate": "2020-06-02T20:28:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE3NjIxNA==", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434176214", "bodyText": "I'm not sure we want to suggest a replacement for classes that extend specific error implementations, just those which extend Error. We could fail without a suggested fix in the case of specific error types.", "author": "carterkozak", "createdAt": "2020-06-02T21:07:58Z", "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ExtendsError.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.fixes.SuggestedFixes;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.google.errorprone.suppliers.Suppliers;\n+import com.sun.source.tree.ClassTree;\n+import com.sun.source.tree.Tree;\n+import com.sun.tools.javac.code.Type;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ExtendsError\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = BugPattern.LinkType.CUSTOM,\n+        providesFix = BugPattern.ProvidesFix.REQUIRES_HUMAN_ATTENTION,\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Class should not extend java.lang.Error. While allowed by java it can lead to surprising behaviour\"\n+                + \" if users end up catching Error.\")\n+public final class ExtendsError extends BugChecker implements BugChecker.ClassTreeMatcher {\n+    private static final Matcher<ClassTree> ERROR_MATCHER = Matchers.isSubtypeOf(Error.class);\n+\n+    @Override\n+    public Description matchClass(ClassTree tree, VisitorState state) {\n+        if (tree.getKind() != Tree.Kind.CLASS) {\n+            // Don't apply to out interfaces and enums\n+            return Description.NO_MATCH;\n+        }\n+\n+        if (!ERROR_MATCHER.matches(tree, state)) {\n+            return Description.NO_MATCH;\n+        }\n+\n+        return buildDescription(tree).addFix(buildFix(tree, state)).build();", "originalCommit": "9c0b21629fba43364dfc3496d9b6ec49e159c757", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE3NjMyNg==", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434176326", "bodyText": "What if I extend Throwable?", "author": "carterkozak", "createdAt": "2020-06-02T21:08:12Z", "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ExtendsError.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.fixes.SuggestedFixes;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.google.errorprone.suppliers.Suppliers;\n+import com.sun.source.tree.ClassTree;\n+import com.sun.source.tree.Tree;\n+import com.sun.tools.javac.code.Type;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ExtendsError\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = BugPattern.LinkType.CUSTOM,\n+        providesFix = BugPattern.ProvidesFix.REQUIRES_HUMAN_ATTENTION,\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Class should not extend java.lang.Error. While allowed by java it can lead to surprising behaviour\"\n+                + \" if users end up catching Error.\")\n+public final class ExtendsError extends BugChecker implements BugChecker.ClassTreeMatcher {", "originalCommit": "9c0b21629fba43364dfc3496d9b6ec49e159c757", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NDU1Nw==", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434194557", "bodyText": "I think we should also forbid that, I would be surprised if java allowed that", "author": "robert3005", "createdAt": "2020-06-02T21:48:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE3NjMyNg=="}], "type": "inlineReview"}, {"oid": "91566efafa683ae10a252b683ea9746dbdbb4b9a", "url": "https://github.com/palantir/gradle-baseline/commit/91566efafa683ae10a252b683ea9746dbdbb4b9a", "message": "rename", "committedDate": "2020-06-02T22:29:42Z", "type": "commit"}, {"oid": "2c130fd7b80e517481808b8d4d530cc8a0bac4c6", "url": "https://github.com/palantir/gradle-baseline/commit/2c130fd7b80e517481808b8d4d530cc8a0bac4c6", "message": "fix test", "committedDate": "2020-06-02T22:47:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc1ODI2OA==", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434758268", "bodyText": "I think you have to add this to the list that gets applied by default in the errorprone plugin", "author": "ferozco", "createdAt": "2020-06-03T18:07:13Z", "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ExtendsErrorOrThrowable.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.fixes.SuggestedFixes;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.google.errorprone.suppliers.Suppliers;\n+import com.sun.source.tree.ClassTree;\n+import com.sun.source.tree.Tree;\n+import com.sun.tools.javac.code.Type;\n+import java.util.Optional;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ExtendsErrorOrThrowable\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = BugPattern.LinkType.CUSTOM,\n+        providesFix = BugPattern.ProvidesFix.REQUIRES_HUMAN_ATTENTION,\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Class should not extend Error or Throwable directly. While allowed by java \"\n+                + \"it can lead to surprising behaviour if users end up catching Error or Throwable.\")\n+public final class ExtendsErrorOrThrowable extends BugChecker implements BugChecker.ClassTreeMatcher {", "originalCommit": "2c130fd7b80e517481808b8d4d530cc8a0bac4c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa4c7fde45d24b27e2babd312f8a0ac5e9f3f363", "url": "https://github.com/palantir/gradle-baseline/commit/fa4c7fde45d24b27e2babd312f8a0ac5e9f3f363", "message": "add to list", "committedDate": "2020-06-03T18:09:15Z", "type": "commit"}]}