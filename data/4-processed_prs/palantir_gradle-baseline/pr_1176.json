{"pr_number": 1176, "pr_title": "Fix 6.1 checkstyle report finalizer failure", "pr_createdAt": "2020-01-20T16:19:47Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1176", "timeline": [{"oid": "c526a218e14ab53abfadcb2a025b261bb398a63d", "url": "https://github.com/palantir/gradle-baseline/commit/c526a218e14ab53abfadcb2a025b261bb398a63d", "message": "Start writing a test and fix deprecation warnings", "committedDate": "2020-01-20T14:11:48Z", "type": "commit"}, {"oid": "ea379d844a0027656fc135fe4e442f2b3d260e58", "url": "https://github.com/palantir/gradle-baseline/commit/ea379d844a0027656fc135fe4e442f2b3d260e58", "message": "Finally get a test failure", "committedDate": "2020-01-20T14:25:30Z", "type": "commit"}, {"oid": "fec27a31a4b83b9b3d800a8b7069c835eaa90863", "url": "https://github.com/palantir/gradle-baseline/commit/fec27a31a4b83b9b3d800a8b7069c835eaa90863", "message": "Jump throguh some hoops", "committedDate": "2020-01-20T14:54:12Z", "type": "commit"}, {"oid": "320ecbec58b227741b66392ddc7fe4266ee0979a", "url": "https://github.com/palantir/gradle-baseline/commit/320ecbec58b227741b66392ddc7fe4266ee0979a", "message": "Fix problem and upgrade to 6.1 to get new code", "committedDate": "2020-01-20T14:58:27Z", "type": "commit"}, {"oid": "01ca418bb3df081160c27858b4d6dd599786ad95", "url": "https://github.com/palantir/gradle-baseline/commit/01ca418bb3df081160c27858b4d6dd599786ad95", "message": "Configure the task eagerly before the property is finalised, also downgrade gradle back", "committedDate": "2020-01-20T15:25:27Z", "type": "commit"}, {"oid": "529ce44159f18f18799068a4ee42f5e48bbe9ed1", "url": "https://github.com/palantir/gradle-baseline/commit/529ce44159f18f18799068a4ee42f5e48bbe9ed1", "message": "Fix mistakenly changed files", "committedDate": "2020-01-20T16:16:50Z", "type": "commit"}, {"oid": "272e3cee099c67091bd58217e9df2d6f04362e85", "url": "https://github.com/palantir/gradle-baseline/commit/272e3cee099c67091bd58217e9df2d6f04362e85", "message": "Add generated changelog entries", "committedDate": "2020-01-20T16:16:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzNTAxMQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1176#discussion_r368635011", "bodyText": "would it make sense to just not use nebula for this one test? i.e. to go through all the ProjectBuilder stuff manually?", "author": "iamdanfox", "createdAt": "2020-01-20T16:27:22Z", "path": "gradle-baseline-java/src/test/groovy/com/palantir/baseline/JunitReportsPluginSpec.groovy", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline\n+\n+import nebula.test.IntegrationSpec\n+import nebula.test.functional.ExecutionResult\n+import spock.lang.Unroll\n+\n+@Unroll\n+class JunitReportsPluginSpec extends IntegrationSpec {\n+    private static final List<String> GRADLE_TEST_VERSIONS = ['5.6.4', '6.1']\n+\n+    def '#gradleVersionNumber: configures the checkstlye plugin correctly'() {\n+        setup:\n+        gradleVersion = gradleVersionNumber\n+\n+        when:\n+        buildFile << '''\n+            apply plugin: 'java'\n+            apply plugin: 'checkstyle'\n+            apply plugin: 'com.palantir.junit-reports'\n+            \n+            repositories {\n+                jcenter()\n+            }\n+        '''.stripIndent()\n+\n+        file('src/main/java/foo/Foo.java') << '''\n+            package foo;\n+            public class Foo {}\n+        '''.stripIndent()\n+\n+        ExecutionResult executionResult = runTasks('checkstyleMain')\n+\n+        then:\n+        // Running checkstyle inside nebula does not work as there are classpath problems that result in the `groovy-all`\n+        // not being on Gradle's classpath. So the best we can do to verify that the checkstyle actually ran is to\n+        // verify we get the classpath error that happens when the checkstyle class runs :(\n+        // https://github.com/gradle/gradle/issues/3995\n+        executionResult.standardError.contains 'java.lang.ClassNotFoundException: groovy.util.AntBuilder'", "originalCommit": "272e3cee099c67091bd58217e9df2d6f04362e85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY3NTA5Ng==", "url": "https://github.com/palantir/gradle-baseline/pull/1176#discussion_r368675096", "bodyText": "I don't think we can run with a specified gradle version without using nebula?", "author": "CRogers", "createdAt": "2020-01-20T18:09:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzNTAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY3NTI5OA==", "url": "https://github.com/palantir/gradle-baseline/pull/1176#discussion_r368675298", "bodyText": "This also happens in gradle test kit and the other 3rd party gradleTest framework :(", "author": "CRogers", "createdAt": "2020-01-20T18:09:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzNTAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODcyMzAyOA==", "url": "https://github.com/palantir/gradle-baseline/pull/1176#discussion_r368723028", "bodyText": "you can https://docs.gradle.org/current/userguide/test_kit.html#sub:gradle-runner-gradle-version", "author": "robert3005", "createdAt": "2020-01-20T20:56:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzNTAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODcyMzI4Mg==", "url": "https://github.com/palantir/gradle-baseline/pull/1176#discussion_r368723282", "bodyText": "also if you disable debug it will not cause issues. Gradle test runner debug mode is a little too magical on your classpath", "author": "robert3005", "createdAt": "2020-01-20T20:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzNTAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDExNjUyMA==", "url": "https://github.com/palantir/gradle-baseline/pull/1176#discussion_r370116520", "bodyText": "Well, I gave using testkit/ProjectBuilder directly a go and I just couldn't get it to work (kept saying the existing code worked on Gradle 6.1) :( So this (or no test) may have to suffice.", "author": "CRogers", "createdAt": "2020-01-23T13:30:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzNTAxMQ=="}], "type": "inlineReview"}, {"oid": "642a72badaf0b23af1a9617628ad070ac4d58810", "url": "https://github.com/palantir/gradle-baseline/commit/642a72badaf0b23af1a9617628ad070ac4d58810", "message": "Attempt to use testkit", "committedDate": "2020-01-23T12:08:02Z", "type": "commit"}, {"oid": "1c3e659666cbee262c55f5c41ccd9fe14a85015b", "url": "https://github.com/palantir/gradle-baseline/commit/1c3e659666cbee262c55f5c41ccd9fe14a85015b", "message": "Revert \"Attempt to use testkit\"\n\nThis reverts commit 642a72badaf0b23af1a9617628ad070ac4d58810.", "committedDate": "2020-01-23T12:08:06Z", "type": "commit"}, {"oid": "dc4ba461134b8d7be241cb0007863a896e7a4e8e", "url": "https://github.com/palantir/gradle-baseline/commit/dc4ba461134b8d7be241cb0007863a896e7a4e8e", "message": "Merge branch 'fix-junit-reportsw-gradle-6.1' of github.com:palantir/gradle-baseline into fix-junit-reportsw-gradle-6.1", "committedDate": "2020-01-23T12:08:08Z", "type": "commit"}, {"oid": "c72f068d25281ed0469b1c9d843f7927c674098c", "url": "https://github.com/palantir/gradle-baseline/commit/c72f068d25281ed0469b1c9d843f7927c674098c", "message": "Use afterEvaluate to really make sure it works", "committedDate": "2020-01-23T12:20:47Z", "type": "commit"}, {"oid": "4d362d93c3bb97095c5ed1ed3032f708b2f3b80a", "url": "https://github.com/palantir/gradle-baseline/commit/4d362d93c3bb97095c5ed1ed3032f708b2f3b80a", "message": "Fix imports", "committedDate": "2020-01-23T12:29:52Z", "type": "commit"}, {"oid": "bbbe9edcf9736095caa00726e0868f7b83b7b935", "url": "https://github.com/palantir/gradle-baseline/commit/bbbe9edcf9736095caa00726e0868f7b83b7b935", "message": "Format files before merge", "committedDate": "2020-01-23T12:32:55Z", "type": "commit"}, {"oid": "95245eb9cc902af7a189a43a2496d1b5f66dd658", "url": "https://github.com/palantir/gradle-baseline/commit/95245eb9cc902af7a189a43a2496d1b5f66dd658", "message": "Merge branch 'develop' of github.com:palantir/gradle-baseline into fix-junit-reportsw-gradle-6.1", "committedDate": "2020-01-23T12:33:35Z", "type": "commit"}, {"oid": "b7a016393d35c4a4340eaaebe0375e38c8b35c40", "url": "https://github.com/palantir/gradle-baseline/commit/b7a016393d35c4a4340eaaebe0375e38c8b35c40", "message": "Fix format", "committedDate": "2020-01-23T12:37:12Z", "type": "commit"}, {"oid": "0961d5443e13b5526ac858ebd1a6e6f77a2dc7b7", "url": "https://github.com/palantir/gradle-baseline/commit/0961d5443e13b5526ac858ebd1a6e6f77a2dc7b7", "message": "Remove deprecation", "committedDate": "2020-01-23T14:04:41Z", "type": "commit"}]}