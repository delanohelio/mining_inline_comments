{"pr_number": 1394, "pr_title": "Added support for logsafe Arg arrays in Slf4jLogsafeArgs.", "pr_createdAt": "2020-06-08T02:16:06Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1394", "timeline": [{"oid": "92fd52063fc7414c6abcab730b3ee4b022566728", "url": "https://github.com/palantir/gradle-baseline/commit/92fd52063fc7414c6abcab730b3ee4b022566728", "message": "Added support for logsafe Arg arrays in Slf4jLogsafeArgs.", "committedDate": "2020-06-08T02:03:34Z", "type": "commit"}, {"oid": "1bad8278c2530f254d4f781730b73fbadffe4886", "url": "https://github.com/palantir/gradle-baseline/commit/1bad8278c2530f254d4f781730b73fbadffe4886", "message": "Reduced cyclomatic complexity.", "committedDate": "2020-06-08T06:25:37Z", "type": "commit"}, {"oid": "d9eb188b96d85a54891429c5eb724bb96f3ec8eb", "url": "https://github.com/palantir/gradle-baseline/commit/d9eb188b96d85a54891429c5eb724bb96f3ec8eb", "message": "Simplified logic. Vararg array argument now goes through regardless of type.", "committedDate": "2020-06-11T05:16:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3MzExNA==", "url": "https://github.com/palantir/gradle-baseline/pull/1394#discussion_r438973114", "bodyText": "Any chance we can avoid the stream here? This code is super hot because we log a lot of things, one large internal project in particular benefits from any compile speedup we can provide!", "author": "carterkozak", "createdAt": "2020-06-11T17:59:42Z", "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/Slf4jLogsafeArgs.java", "diffHunk": "@@ -68,24 +73,27 @@ public Description matchMethodInvocation(MethodInvocationTree tree, VisitorState\n         }\n \n         List<? extends ExpressionTree> allArgs = tree.getArguments();\n-        int lastIndex = allArgs.size() - 1;\n-        int startArg = MARKER.matches(allArgs.get(0), state) ? 2 : 1;\n-        ExpressionTree lastArg = allArgs.get(lastIndex);\n-        boolean lastArgIsThrowable = THROWABLE.matches(lastArg, state);\n-        int endArg = lastArgIsThrowable ? lastIndex - 1 : lastIndex;\n+        int startArgIndex = MARKER.matches(allArgs.get(0), state) ? 2 : 1;\n+        int lastArgIndex = allArgs.size() - 1;\n+        ExpressionTree lastArg = allArgs.get(lastArgIndex);\n \n-        ImmutableList.Builder<Integer> badArgsBuilder = ImmutableList.builder();\n-        for (int i = startArg; i <= endArg; i++) {\n-            if (!ARG.matches(allArgs.get(i), state)) {\n-                badArgsBuilder.add(i);\n-            }\n+        if (startArgIndex == lastArgIndex && OBJECT_ARRAY.matches(lastArg, state)) {\n+            return Description.NO_MATCH;\n         }\n-        List<Integer> badArgs = badArgsBuilder.build();\n-        if (badArgs.isEmpty() || TestCheckUtils.isTestCode(state)) {\n+\n+        boolean lastArgIsThrowable = THROWABLE.matches(lastArg, state);\n+        int lastNonThrowableArgIndex = lastArgIsThrowable ? lastArgIndex - 1 : lastArgIndex;\n+\n+        List<Integer> badArgIndices = IntStream.rangeClosed(startArgIndex, lastNonThrowableArgIndex)\n+                .filter(i -> !ARG.matches(allArgs.get(i), state))\n+                .boxed()\n+                .collect(Collectors.toList());", "originalCommit": "d9eb188b96d85a54891429c5eb724bb96f3ec8eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk4NjI5Nw==", "url": "https://github.com/palantir/gradle-baseline/pull/1394#discussion_r438986297", "bodyText": "Oh, I thought I spotted a nice simplification. Not my intention to slow it down. I'll revert to the previous for-each loop.", "author": "aioobe", "createdAt": "2020-06-11T18:24:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3MzExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYwOTE3MA==", "url": "https://github.com/palantir/gradle-baseline/pull/1394#discussion_r439609170", "bodyText": "Reverted but had to factor it out to a method to pass the cyclomatic check.", "author": "aioobe", "createdAt": "2020-06-12T19:38:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3MzExNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3MzMwOQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1394#discussion_r438973309", "bodyText": "nice", "author": "carterkozak", "createdAt": "2020-06-11T18:00:03Z", "path": "baseline-error-prone/src/test/java/com/palantir/baseline/errorprone/Slf4jLogsafeArgsTest.java", "diffHunk": "@@ -47,6 +47,7 @@ private void test(String logArgs, String failingArgs) throws Exception {\n                         \"    public String getName() { return null; }\",\n                         \"    public void add(Marker reference) {}\",\n                         \"    public boolean remove(Marker reference) { return true; }\",\n+                        \"    @SuppressWarnings(\\\"deprecation\\\")\",", "originalCommit": "d9eb188b96d85a54891429c5eb724bb96f3ec8eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2de50062a96ed5d1fb2e012e7bc4337acab5fa8f", "url": "https://github.com/palantir/gradle-baseline/commit/2de50062a96ed5d1fb2e012e7bc4337acab5fa8f", "message": "Reverted from Stream to for loop", "committedDate": "2020-06-12T19:31:43Z", "type": "commit"}, {"oid": "79c2523037ea3f73abcd512225a9957a2aa45f44", "url": "https://github.com/palantir/gradle-baseline/commit/79c2523037ea3f73abcd512225a9957a2aa45f44", "message": "Added changelog entry.", "committedDate": "2020-06-17T16:19:04Z", "type": "commit"}, {"oid": "3bd2a1e0bafa7199bf2220c44e6b5dae06992519", "url": "https://github.com/palantir/gradle-baseline/commit/3bd2a1e0bafa7199bf2220c44e6b5dae06992519", "message": "Improve gradle-baseline-java integration with IntelliJ import (#1411)\n\nAdds the proper configuration files upon IntelliJ import of a gradle project for checkstyle and copyright.\r\n\r\nThis generates the following additional files:\r\n- .idea/copyright/profiles_settings.xml\r\n- an xml file under .idea/copyright/ per copyright file under .baseline/copyright\r\n- .idea/checkstyle-idea.xml (and adds Checkstyle-IDEA to the external dependencies) if baseline-checkstyle is applied\r\n- Either .idea/codeStyleSettings.xml or a .idea/codeStyles/ folder with the contents being copied from .baseline/idea\r\n  - If .baseline/idea/codeStyles is present, it will copy its contents, otherwise, it will fall back to .baseline/idea/intellij-java-palantir-style.xml as currently\r\n  - The fallback is using a legacy IntelliJ format and requires closing and reopening the project to be taken into account", "committedDate": "2020-06-17T16:36:20Z", "type": "commit"}, {"oid": "f1c1f638c0831a727ff656501ba3b9ab1a62cf69", "url": "https://github.com/palantir/gradle-baseline/commit/f1c1f638c0831a727ff656501ba3b9ab1a62cf69", "message": "Autorelease 3.28.0", "committedDate": "2020-06-17T16:36:21Z", "type": "commit"}, {"oid": "792859bb7cb9a47e70ea83874554d18d81e41da2", "url": "https://github.com/palantir/gradle-baseline/commit/792859bb7cb9a47e70ea83874554d18d81e41da2", "message": "Added support for logsafe Arg arrays in Slf4jLogsafeArgs.", "committedDate": "2020-06-17T17:23:26Z", "type": "commit"}, {"oid": "2b925b5d299737fb4e7b9af3dd1aea745832685e", "url": "https://github.com/palantir/gradle-baseline/commit/2b925b5d299737fb4e7b9af3dd1aea745832685e", "message": "Reduced cyclomatic complexity.", "committedDate": "2020-06-17T17:23:26Z", "type": "commit"}, {"oid": "c93356b0c52b153511cc81b212362da00e2f5e99", "url": "https://github.com/palantir/gradle-baseline/commit/c93356b0c52b153511cc81b212362da00e2f5e99", "message": "Simplified logic. Vararg array argument now goes through regardless of type.", "committedDate": "2020-06-17T17:23:26Z", "type": "commit"}, {"oid": "e80f07a43055be3260058d558a1d027b815eed3b", "url": "https://github.com/palantir/gradle-baseline/commit/e80f07a43055be3260058d558a1d027b815eed3b", "message": "Reverted from Stream to for loop", "committedDate": "2020-06-17T17:23:26Z", "type": "commit"}, {"oid": "e45c87434e93332e1fb775240add76d10aa18d90", "url": "https://github.com/palantir/gradle-baseline/commit/e45c87434e93332e1fb775240add76d10aa18d90", "message": "Added changelog entry.", "committedDate": "2020-06-17T17:23:26Z", "type": "commit"}, {"oid": "52998ca708b12124911f5e1b8aa743efc99f8456", "url": "https://github.com/palantir/gradle-baseline/commit/52998ca708b12124911f5e1b8aa743efc99f8456", "message": "Merge branch 'fix-safe-args-warning' of github.com:aioobe/gradle-baseline into fix-safe-args-warning", "committedDate": "2020-06-17T17:24:31Z", "type": "commit"}]}