{"pr_number": 113, "pr_title": "Ruby detectable test", "pr_createdAt": "2020-02-11T21:09:21Z", "pr_url": "https://github.com/blackducksoftware/synopsys-detect/pull/113", "timeline": [{"oid": "cc2d4e780d0a881c589cb641b0d4e4e0f3676d7d", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/cc2d4e780d0a881c589cb641b0d4e4e0f3676d7d", "message": "fix(test): Replaced GraphCompare operations in RubygemsNodePackagerTest with more focused assertions", "committedDate": "2020-02-11T15:59:25Z", "type": "commit"}, {"oid": "037529ff1d5e1479c66d9e3cc8e89aae3997c9e9", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/037529ff1d5e1479c66d9e3cc8e89aae3997c9e9", "message": "fix(test): Created extension of DetectableFunctionalTest for RubyGems", "committedDate": "2020-02-11T20:37:11Z", "type": "commit"}, {"oid": "51f7cee30be704ca26bbd43ada2ca95dd561645e", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/51f7cee30be704ca26bbd43ada2ca95dd561645e", "message": "Merge branch 'master' into rubyDetectableTest", "committedDate": "2020-02-11T20:39:56Z", "type": "commit"}, {"oid": "6a474069ae976a8bc16e52366abc51e6f8220f58", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/6a474069ae976a8bc16e52366abc51e6f8220f58", "message": "feat(test): Created test that extends DetectableFunctionalTest", "committedDate": "2020-02-11T21:07:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MDc2MQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378370761", "bodyText": "You should assert on everything in the file or remove it from the file.", "author": "taikuukaits", "createdAt": "2020-02-12T16:37:19Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/GemlockDetectableTest.kt", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.synopsys.integration.detectable.detectables.rubygems.gemlock.functional\n+\n+import com.synopsys.integration.bdio.model.Forge\n+import com.synopsys.integration.detectable.Detectable\n+import com.synopsys.integration.detectable.DetectableEnvironment\n+import com.synopsys.integration.detectable.Extraction\n+import com.synopsys.integration.detectable.functional.DetectableFunctionalTest\n+import com.synopsys.integration.detectable.util.graph.NameVersionGraphAssert\n+import org.junit.jupiter.api.Assertions\n+\n+class GemlockDetectableTest : DetectableFunctionalTest(\"gemlock\") {\n+    override fun setup() {\n+        addFiles {\n+            file(\"Gemfile.lock\", \"\"\"\n+                GEM\n+                  remote: https://rubygems.org/\n+                  specs:\n+                    RubyInline (3.12.4)\n+                          ZenTest (~> 4.3)\n+                    ZenTest (4.11.1)\n+                    activesupport (4.2.8)\n+                          i18n (~> 0.7)\n+                          minitest (~> 5.1)\n+                          thread_safe (~> 0.3, >= 0.3.4)\n+                    thread_safe (0.3.6)\n+                    cocoapods (1.2.1)\n+                          activesupport (>= 4.0.2, < 5)", "originalCommit": "6a474069ae976a8bc16e52366abc51e6f8220f58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MDkxOA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378370918", "bodyText": "Still have a TODO in here.", "author": "taikuukaits", "createdAt": "2020-02-12T16:37:33Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/RubyGemsDetectableTest.kt", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.synopsys.integration.detectable.detectables.rubygems.gemlock.functional\n+\n+import com.synopsys.integration.detectable.Detectable\n+import com.synopsys.integration.detectable.DetectableEnvironment\n+import com.synopsys.integration.detectable.Extraction\n+import com.synopsys.integration.detectable.detectable.executable.ExecutableOutput\n+import com.synopsys.integration.detectable.functional.DetectableFunctionalTest\n+\n+class RubyGemsDetectableTest : DetectableFunctionalTest(\"rubygems\") {\n+    override fun setup() {\n+        addFiles {\n+            file(\"Gemfile.lock\", \"\"\"\n+                GEM\n+                  remote: https://rubygems.org/\n+                  specs:\n+            \"\"\".trimIndent()\n+            )\n+        }\n+\n+        addExecutableOutput(\n+                ExecutableOutput()\n+        )\n+\n+    }\n+\n+    override fun create(environment: DetectableEnvironment): Detectable {\n+        return detectableFactory.createGemlockDetectable(environment)\n+    }\n+\n+    override fun assert(extraction: Extraction) {\n+        TODO(\"not implemented\") //To change body of created functions use File | Settings | File Templates.", "originalCommit": "6a474069ae976a8bc16e52366abc51e6f8220f58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM4MDI3OQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378380279", "bodyText": "forgot to delete this file, this was an unfinished first draft of GemlockDetectableTest", "author": "crowleySynopsys", "createdAt": "2020-02-12T16:52:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MDkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MTcyNg==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378371726", "bodyText": "I agree. Remove them.", "author": "JakeMathews", "createdAt": "2020-02-12T16:38:45Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/GemlockNodeParserTest.java", "diffHunk": "@@ -64,6 +64,8 @@ public void testParsingGemfileLock() throws MissingExternalIdException {\n         GraphCompare.assertEqualsResource(\"/rubygems/expectedParser_graph.json\", dependencyGraph);\n     }\n \n+    // ^ these two test the exact same thing, and they are the same as RubyGemsNodePackagerTest.packagerTest\n+", "originalCommit": "6a474069ae976a8bc16e52366abc51e6f8220f58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MjE0NA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378372144", "bodyText": "You don't need this if your detectable doesn't require executables.", "author": "JakeMathews", "createdAt": "2020-02-12T16:39:22Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/RubyGemsDetectableTest.kt", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.synopsys.integration.detectable.detectables.rubygems.gemlock.functional\n+\n+import com.synopsys.integration.detectable.Detectable\n+import com.synopsys.integration.detectable.DetectableEnvironment\n+import com.synopsys.integration.detectable.Extraction\n+import com.synopsys.integration.detectable.detectable.executable.ExecutableOutput\n+import com.synopsys.integration.detectable.functional.DetectableFunctionalTest\n+\n+class RubyGemsDetectableTest : DetectableFunctionalTest(\"rubygems\") {\n+    override fun setup() {\n+        addFiles {\n+            file(\"Gemfile.lock\", \"\"\"\n+                GEM\n+                  remote: https://rubygems.org/\n+                  specs:\n+            \"\"\".trimIndent()\n+            )\n+        }\n+\n+        addExecutableOutput(\n+                ExecutableOutput()\n+        )", "originalCommit": "6a474069ae976a8bc16e52366abc51e6f8220f58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM4MDE1MA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378380150", "bodyText": "forgot to delete this file, this was an unfinished first draft of GemlockDetectableTest", "author": "crowleySynopsys", "createdAt": "2020-02-12T16:51:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MjE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MzYyMA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378373620", "bodyText": "The Gemfile.lock used for this test is huge. Assert on everything in that file or remove it.", "author": "JakeMathews", "createdAt": "2020-02-12T16:41:44Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/RubygemsNodePackagerTest.java", "diffHunk": "@@ -51,7 +50,15 @@ void packagerTest() throws MissingExternalIdException {\n         final DependencyGraph projects = rubygemsNodePackager.parseProjectDependencies(actualText);\n         Assertions.assertEquals(8, projects.getRootDependencies().size());\n \n-        GraphCompare.assertEqualsResource(\"/rubygems/expectedPackager_graph.json\", projects);", "originalCommit": "6a474069ae976a8bc16e52366abc51e6f8220f58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3OTUwMQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378379501", "bodyText": "I thought the goal was just to assert on every \"unique\" type of relationship/stipulation in the file, no, @taikuukaits ?", "author": "crowleySynopsys", "createdAt": "2020-02-12T16:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MzYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM5Nzc5OA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r378397798", "bodyText": "Yes. Do that, and delete every non unique entry.", "author": "JakeMathews", "createdAt": "2020-02-12T17:21:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM3MzYyMA=="}], "type": "inlineReview"}, {"oid": "424e8af1dcac755d11c6ac9f970a7ed43c282d9c", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/424e8af1dcac755d11c6ac9f970a7ed43c282d9c", "message": "fix(test): Delected RubyGemsDetectableTest", "committedDate": "2020-02-12T16:52:38Z", "type": "commit"}, {"oid": "be278dbf3e0a3e48e8cadcf56c6e634e7e1a08bf", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/be278dbf3e0a3e48e8cadcf56c6e634e7e1a08bf", "message": "fix(test): Delected unused resources, redundant tests, untested stipulations in GemlockDetectableTest", "committedDate": "2020-02-12T17:18:23Z", "type": "commit"}, {"oid": "7f406d69aacc40b1d4382da2889b8cdef36fc954", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/7f406d69aacc40b1d4382da2889b8cdef36fc954", "message": "fix(test): Trimmed Gemfile.lock", "committedDate": "2020-02-12T17:26:55Z", "type": "commit"}, {"oid": "7ef50fe3223a59e2d85f31ac64d2d81c99418908", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/7ef50fe3223a59e2d85f31ac64d2d81c99418908", "message": "Merge branch 'master' into rubyDetectableTest", "committedDate": "2020-02-12T21:10:28Z", "type": "commit"}, {"oid": "f9a1abf850ac047735d08ce10d86a84afe036e16", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/f9a1abf850ac047735d08ce10d86a84afe036e16", "message": "Merge branch 'master' into rubyDetectableTest", "committedDate": "2020-02-19T15:38:14Z", "type": "commit"}, {"oid": "99b6f84b956c06ce8c3e49940a8900e852b4988f", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/99b6f84b956c06ce8c3e49940a8900e852b4988f", "message": "fix(test): Convert GemlockDetectableTest to java, delete redundant RubygemsNodePackagerTest.packagerTest", "committedDate": "2020-02-19T15:39:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjczNTgxNg==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r382735816", "bodyText": "If it has root size 2, why only one hasRootDependency?", "author": "taikuukaits", "createdAt": "2020-02-21T18:25:53Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/GemlockDetectableTest.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.synopsys.integration.detectable.detectables.rubygems.gemlock.functional;\n+\n+import java.io.IOException;\n+import java.nio.file.Paths;\n+\n+import org.jetbrains.annotations.NotNull;\n+import org.junit.jupiter.api.Assertions;\n+\n+import com.synopsys.integration.bdio.model.Forge;\n+import com.synopsys.integration.detectable.Detectable;\n+import com.synopsys.integration.detectable.DetectableEnvironment;\n+import com.synopsys.integration.detectable.Extraction;\n+import com.synopsys.integration.detectable.functional.DetectableFunctionalTest;\n+import com.synopsys.integration.detectable.util.graph.NameVersionGraphAssert;\n+\n+public class GemlockDetectableTest extends DetectableFunctionalTest {\n+\n+    public GemlockDetectableTest() throws IOException {\n+        super(\"gemlock\");\n+    }\n+\n+    @Override\n+    public void setup() throws IOException {\n+        addFile(Paths.get(\"Gemfile.lock\"),\n+            \"GEM\",\n+            \"  remote:https://rubygems.org/\",\n+            \"  specs:\",\n+            \"    RubyInline (3.12.4)\",\n+            \"      ZenTest (~>4.3)\",\n+            \"    ZenTest (4.11.1)\",\n+            \"    activesupport (4.2.8)\",\n+            \"      thread_safe (~>0.3,>=0.3.4)\",\n+            \"    thread_safe (0.3.6)\",\n+            \"    cocoapods (1.2.1)\",\n+            \"      activesupport (>=4.0.2,< 5)\",\n+            \"    cocoapods-keys (2.0.0)\",\n+            \"      osx_keychain\",\n+            \"    osx_keychain (1.0.1)\",\n+            \"      RubyInline (~>3)\",\n+            \"\",\n+            \"PLATFORMS\",\n+            \"  ruby\",\n+            \"\",\n+            \"DEPENDENCIES\",\n+            \"  cocoapods (>=1.1.0)\",\n+            \"  cocoapods-keys\",\n+            \"\",\n+            \"BUNDLED WITH\",\n+            \"  1.14.6\");\n+    }\n+\n+    @Override\n+    public Detectable create(@NotNull final DetectableEnvironment detectableEnvironment) {\n+        return detectableFactory.createGemlockDetectable(detectableEnvironment);\n+    }\n+\n+    @Override\n+    public void assertExtraction(@NotNull final Extraction extraction) {\n+        Assertions.assertNotEquals(0, extraction.getCodeLocations().size(), \"A code location should have been generated.\");\n+\n+        NameVersionGraphAssert graphAssert = new NameVersionGraphAssert(Forge.RUBYGEMS, extraction.getCodeLocations().get(0).getDependencyGraph());\n+        graphAssert.hasRootSize(2);\n+        graphAssert.hasRootDependency(\"cocoapods\", \"1.2.1\");", "originalCommit": "99b6f84b956c06ce8c3e49940a8900e852b4988f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8b42e0c738c09cc21037d9bb15be80e2b5612007", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/8b42e0c738c09cc21037d9bb15be80e2b5612007", "message": "fix(test): Added assertion for second root dependency in GemlockDetectableTest", "committedDate": "2020-02-21T18:32:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzEzNTYyNA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r387135624", "bodyText": "The other tests in this file seem to need the same treatment. They access large resource files with minimal assertions.", "author": "JakeMathews", "createdAt": "2020-03-03T16:22:19Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/GemlockNodeParserTest.java", "diffHunk": "@@ -38,31 +37,9 @@\n import com.synopsys.integration.detectable.annotations.FunctionalTest;\n import com.synopsys.integration.detectable.detectables.rubygems.gemlock.parse.GemlockParser;\n import com.synopsys.integration.detectable.util.FunctionalTestFiles;\n-import com.synopsys.integration.detectable.util.GraphCompare;\n \n @FunctionalTest\n public class GemlockNodeParserTest {", "originalCommit": "8b42e0c738c09cc21037d9bb15be80e2b5612007", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzEzNjUzMQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r387136531", "bodyText": "Move the resource file into the test here. We also need more assertions.", "author": "JakeMathews", "createdAt": "2020-03-03T16:23:26Z", "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/rubygems/gemlock/functional/RubygemsNodePackagerTest.java", "diffHunk": "@@ -36,24 +34,12 @@\n import com.synopsys.integration.detectable.annotations.FunctionalTest;\n import com.synopsys.integration.detectable.detectables.rubygems.gemlock.parse.GemlockParser;\n import com.synopsys.integration.detectable.util.FunctionalTestFiles;\n-import com.synopsys.integration.detectable.util.GraphCompare;\n import com.synopsys.integration.detectable.util.graph.GraphAssert;\n \n @FunctionalTest\n public class RubygemsNodePackagerTest {\n     private final ExternalIdFactory externalIdFactory = new ExternalIdFactory();\n \n-    @Test\n-    @Disabled\n-    void packagerTest() throws MissingExternalIdException {\n-        final List<String> actualText = FunctionalTestFiles.asListOfStrings(\"/rubygems/Gemfile.lock\");\n-        final GemlockParser rubygemsNodePackager = new GemlockParser(new ExternalIdFactory());\n-        final DependencyGraph projects = rubygemsNodePackager.parseProjectDependencies(actualText);\n-        Assertions.assertEquals(8, projects.getRootDependencies().size());\n-\n-        GraphCompare.assertEqualsResource(\"/rubygems/expectedPackager_graph.json\", projects);\n-    }\n-\n     @Test\n     void findsAllVersions() throws MissingExternalIdException {", "originalCommit": "8b42e0c738c09cc21037d9bb15be80e2b5612007", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzEzNzM2MQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/113#discussion_r387137361", "bodyText": "This file in now small enough that it should be moved into the tests.", "author": "JakeMathews", "createdAt": "2020-03-03T16:24:29Z", "path": "detectable/src/test/resources/detectables/functional/rubygems/Gemfile.lock", "diffHunk": "@@ -1,169 +1,25 @@\n GEM\n   remote: https://rubygems.org/\n   specs:\n-    CFPropertyList (2.3.5)", "originalCommit": "8b42e0c738c09cc21037d9bb15be80e2b5612007", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "481971dfa4ad716b08a7f6982a68f0713ba5e1b6", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/481971dfa4ad716b08a7f6982a68f0713ba5e1b6", "message": "fix(test): Moved test resources for ruby detectable into test files, deleted resource files", "committedDate": "2020-03-03T20:22:43Z", "type": "commit"}]}