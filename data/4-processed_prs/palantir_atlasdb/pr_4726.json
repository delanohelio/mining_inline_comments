{"pr_number": 4726, "pr_title": "[PaxosLog] Part 3: Namespacing SqlitePaxosStateLog", "pr_createdAt": "2020-04-21T21:08:37Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4726", "timeline": [{"oid": "32000580e250e84e5d55e0fc041ccf1e68dcde57", "url": "https://github.com/palantir/atlasdb/commit/32000580e250e84e5d55e0fc041ccf1e68dcde57", "message": "Namespaced paxos state log", "committedDate": "2020-04-21T20:49:49Z", "type": "commit"}, {"oid": "94948a9cdf6f488e11a2c60944469f13c70b4767", "url": "https://github.com/palantir/atlasdb/commit/94948a9cdf6f488e11a2c60944469f13c70b4767", "message": "Add test for namespacing", "committedDate": "2020-04-21T20:51:35Z", "type": "commit"}, {"oid": "284153aa386627da7334958bc7ad33edc59f1fff", "url": "https://github.com/palantir/atlasdb/commit/284153aa386627da7334958bc7ad33edc59f1fff", "message": "Wiring up learners to expose", "committedDate": "2020-04-21T20:59:53Z", "type": "commit"}, {"oid": "f6653971fd81dff19214223b2cff390bfc893263", "url": "https://github.com/palantir/atlasdb/commit/f6653971fd81dff19214223b2cff390bfc893263", "message": "Compile break", "committedDate": "2020-04-21T21:12:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMjEyNQ==", "url": "https://github.com/palantir/atlasdb/pull/4726#discussion_r412522125", "bodyText": "Table per namespace, interesting.", "author": "jkozlowski", "createdAt": "2020-04-21T22:01:49Z", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -30,26 +30,34 @@\n \n public final class SqlitePaxosStateLog<V extends Persistable & Versionable> implements PaxosStateLog<V> {\n     private final Supplier<Connection> connectionSupplier;\n+    private final String logNamespace;\n \n-    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier) {\n+    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier, String logNamespace) {\n         this.connectionSupplier = connectionSupplier;\n+        this.logNamespace = logNamespace;\n     }\n \n-    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(Supplier<Connection> conn) {\n-        SqlitePaxosStateLog<V> log = new SqlitePaxosStateLog<>(conn);\n+    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(\n+            Supplier<Connection> conn,\n+            String logNamespace) {\n+        SqlitePaxosStateLog<V> log = new SqlitePaxosStateLog<>(conn, logNamespace);\n         log.initialize();\n         return log;\n     }\n \n     private void initialize() {\n-        executeVoid(\"CREATE TABLE IF NOT EXISTS paxosLog (seq BIGINT, val BLOB, CONSTRAINT pk_dual PRIMARY KEY (seq))\");\n+        executeVoid(\n+                String.format(\n+                        \"CREATE TABLE IF NOT EXISTS %s (seq BIGINT, val BLOB, CONSTRAINT pk_%s PRIMARY KEY (seq))\",", "originalCommit": "f6653971fd81dff19214223b2cff390bfc893263", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMjQwMQ==", "url": "https://github.com/palantir/atlasdb/pull/4726#discussion_r412522401", "bodyText": "Can you create as many sqlite instances as you want if it's backed by the filesystem? Does it maintain some on-disk locks or something?", "author": "jkozlowski", "createdAt": "2020-04-21T22:02:26Z", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -30,26 +30,34 @@\n \n public final class SqlitePaxosStateLog<V extends Persistable & Versionable> implements PaxosStateLog<V> {\n     private final Supplier<Connection> connectionSupplier;\n+    private final String logNamespace;\n \n-    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier) {\n+    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier, String logNamespace) {\n         this.connectionSupplier = connectionSupplier;\n+        this.logNamespace = logNamespace;\n     }\n \n-    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(Supplier<Connection> conn) {\n-        SqlitePaxosStateLog<V> log = new SqlitePaxosStateLog<>(conn);\n+    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(\n+            Supplier<Connection> conn,", "originalCommit": "f6653971fd81dff19214223b2cff390bfc893263", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzE4NQ==", "url": "https://github.com/palantir/atlasdb/pull/4726#discussion_r412523185", "bodyText": "Do we need to enforce something about the logNamespace, I don't suspect sqlite likes any odd table names?", "author": "jkozlowski", "createdAt": "2020-04-21T22:03:59Z", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -30,26 +30,34 @@\n \n public final class SqlitePaxosStateLog<V extends Persistable & Versionable> implements PaxosStateLog<V> {\n     private final Supplier<Connection> connectionSupplier;\n+    private final String logNamespace;\n \n-    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier) {\n+    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier, String logNamespace) {", "originalCommit": "f6653971fd81dff19214223b2cff390bfc893263", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6df56e1cf70b66c17cbccd312929fac67ac6939e", "url": "https://github.com/palantir/atlasdb/commit/6df56e1cf70b66c17cbccd312929fac67ac6939e", "message": "Resolve merge conflicts", "committedDate": "2020-04-27T11:00:14Z", "type": "commit"}]}