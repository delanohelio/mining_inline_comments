{"pr_number": 4741, "pr_title": "Standardize on NamedThreadFactory for observability", "pr_createdAt": "2020-04-28T19:05:55Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4741", "timeline": [{"oid": "426c56d55cb1607f638fc674621bc8ccab486b84", "url": "https://github.com/palantir/atlasdb/commit/426c56d55cb1607f638fc674621bc8ccab486b84", "message": "Standardize on NamedThreadFactory for observability\n\nInstead of using a mix between ThreadFactoryBuilder and\nNamedThreadFactory, we standardize on the latter for standard\ninstrumentation.", "committedDate": "2020-04-28T18:54:18Z", "type": "commit"}, {"oid": "1d74684d774f3fcd38c52f7bdd1dea21dcbb54de", "url": "https://github.com/palantir/atlasdb/commit/1d74684d774f3fcd38c52f7bdd1dea21dcbb54de", "message": "Add generated changelog entries", "committedDate": "2020-04-28T18:54:18Z", "type": "commit"}, {"oid": "8d456c67848cbebbfc48688c829d48a456017ef1", "url": "https://github.com/palantir/atlasdb/commit/8d456c67848cbebbfc48688c829d48a456017ef1", "message": "daemon", "committedDate": "2020-04-28T19:08:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMjMwNg==", "url": "https://github.com/palantir/atlasdb/pull/4741#discussion_r417322306", "bodyText": "Flag that for internal ski product, this will basically report weird metrics? We start many TransactionManagers, so if you hoped this would give you a total count and whatnot, don't think this will work.", "author": "jkozlowski", "createdAt": "2020-04-29T13:40:26Z", "path": "atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java", "diffHunk": "@@ -61,11 +61,7 @@ private static ThreadFactory threadFactory(String safeLoggablePurpose) {\n     }\n \n     private static ThreadFactory createThreadFactory(String safeLoggablePurpose) {\n-        String namePrefix = String.format(\"autobatcher.%s-\", safeLoggablePurpose);\n-        return new ThreadFactoryBuilder()\n-                .setDaemon(true)\n-                .setNameFormat(namePrefix + \"%d\")\n-                .build();\n+        return new NamedThreadFactory(\"autobatcher.\" + safeLoggablePurpose, true);", "originalCommit": "8d456c67848cbebbfc48688c829d48a456017ef1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMzE4NA==", "url": "https://github.com/palantir/atlasdb/pull/4741#discussion_r417323184", "bodyText": "That said I don't think it's necessarily worse than no-instrumentation, just don't know if this will get us what we want. Also, this will be a few extra time series.", "author": "jkozlowski", "createdAt": "2020-04-29T13:41:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMjMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMzkyMg==", "url": "https://github.com/palantir/atlasdb/pull/4741#discussion_r417323922", "bodyText": "Actually, had a look at the metrics, and looks like this will be cumulative, so all good.", "author": "jkozlowski", "createdAt": "2020-04-29T13:42:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMjMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyNTE0OA==", "url": "https://github.com/palantir/atlasdb/pull/4741#discussion_r417325148", "bodyText": "The underlying metric objects are shared so duplicate names are okay, if the safeLoggablePurpose differs that gives me even more specificity. Either way it solves my problem :-)", "author": "carterkozak", "createdAt": "2020-04-29T13:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMyMjMwNg=="}], "type": "inlineReview"}]}