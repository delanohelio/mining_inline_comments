{"pr_number": 5044, "pr_title": "Upgrade gradle-baseline", "pr_createdAt": "2020-10-18T19:03:04Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5044", "timeline": [{"oid": "454fad002d23c248634f720d1cd7b21a1280bc76", "url": "https://github.com/palantir/atlasdb/commit/454fad002d23c248634f720d1cd7b21a1280bc76", "message": "Sort gradle plugins", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "a755de561133a41fc79afd228d9c0aa2fde4f36d", "url": "https://github.com/palantir/atlasdb/commit/a755de561133a41fc79afd228d9c0aa2fde4f36d", "message": "Add gradle-palantir-java-format", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "087ca49d116365b491a259777f7a12b7276b07d2", "url": "https://github.com/palantir/atlasdb/commit/087ca49d116365b491a259777f7a12b7276b07d2", "message": "Use gradle-baseline-java:3.43.0", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "4695062fa3a0a80a215fec2aabf6dadae90e2368", "url": "https://github.com/palantir/atlasdb/commit/4695062fa3a0a80a215fec2aabf6dadae90e2368", "message": "Run baselineUpdateConfig", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "0bd984c7cdd92f6bdef0cf4e37882eaa0c0fe962", "url": "https://github.com/palantir/atlasdb/commit/0bd984c7cdd92f6bdef0cf4e37882eaa0c0fe962", "message": "Standardize baseline configuration in build.gradle", "committedDate": "2020-10-19T15:36:06Z", "type": "forcePushed"}, {"oid": "9d3b2d1b3141339a23018665630962e90dea9a8f", "url": "https://github.com/palantir/atlasdb/commit/9d3b2d1b3141339a23018665630962e90dea9a8f", "message": "Apply gradle-palantir-java-format", "committedDate": "2020-10-19T16:08:34Z", "type": "commit"}, {"oid": "a8a2938ca3348ed1734a705cad764ee99f2a4180", "url": "https://github.com/palantir/atlasdb/commit/a8a2938ca3348ed1734a705cad764ee99f2a4180", "message": "Use com.google.errorprone 2.4.0 and org.immutables 2.8.8", "committedDate": "2020-10-19T16:08:44Z", "type": "commit"}, {"oid": "ccf4cba94bfc7825506a3e184f4401e898258184", "url": "https://github.com/palantir/atlasdb/commit/ccf4cba94bfc7825506a3e184f4401e898258184", "message": "Apply error-prone automated refactorings", "committedDate": "2020-10-19T16:08:44Z", "type": "commit"}, {"oid": "c84902feecf118529012f4a8d9b00a6659f324b1", "url": "https://github.com/palantir/atlasdb/commit/c84902feecf118529012f4a8d9b00a6659f324b1", "message": "Temporarily relax error-prone constraints until we can fix all violations", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "5a79e245d7f9c0ed80f3af484e5b2d024b7fa16c", "url": "https://github.com/palantir/atlasdb/commit/5a79e245d7f9c0ed80f3af484e5b2d024b7fa16c", "message": "Use method reference to workaround error-prone compilation failure\n\n/Volumes/git/palantir/atlasdb/atlasdb-tests-shared/src/test/java/com/palantir/atlasdb/transaction/impl/SnapshotTransactionTest.java:1378: error: An unhandled exception was thrown by the Error Prone static analysis plugin.\n        assertThatExceptionOfType(TransactionLockTimeoutException.class).isThrownBy(() -> transaction.commit());\n                                                                                    ^\n     Please report this at https://github.com/google/error-prone/issues/new and include the following:\n\n     error-prone version: 2.4.0\n     BugPattern: LambdaMethodReference\n     Stack Trace:\n     java.lang.NullPointerException\n        at com.google.errorprone.fixes.SuggestedFixes.compilesWithFix(SuggestedFixes.java:1214)\n        at com.google.errorprone.fixes.SuggestedFixes.compilesWithFix(SuggestedFixes.java:1100)\n        at com.google.errorprone.fixes.SuggestedFixes.compilesWithFix(SuggestedFixes.java:1082)\n        at com.palantir.baseline.errorprone.LambdaMethodReference.lambda$convertMethodInvocations$1(LambdaMethodReference.java:170)", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "70e4d102be2104e628dff663b7922cbd4025aa15", "url": "https://github.com/palantir/atlasdb/commit/70e4d102be2104e628dff663b7922cbd4025aa15", "message": "Add generated changelog entries", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "f51a1e16ca368b349423665ebd5e7f6aad486ee2", "url": "https://github.com/palantir/atlasdb/commit/f51a1e16ca368b349423665ebd5e7f6aad486ee2", "message": "Unpin checkstyle version", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "6df76a1caaf7ccec5d89caf8b2b85f17bb76aec1", "url": "https://github.com/palantir/atlasdb/commit/6df76a1caaf7ccec5d89caf8b2b85f17bb76aec1", "message": "Rely on gradle-baseline IntelliJ Idea defaults\n\nRemove IntelliJ Idea overrides", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "7095dc440d70005a250a6d4a75ab396816d28dc8", "url": "https://github.com/palantir/atlasdb/commit/7095dc440d70005a250a6d4a75ab396816d28dc8", "message": "Suppress some checkstyle rules until they can be remediated\n\nFix up minor checkstyle violations", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "a5c70cca662ce45f233fcb2ac100d03a80e2ae18", "url": "https://github.com/palantir/atlasdb/commit/a5c70cca662ce45f233fcb2ac100d03a80e2ae18", "message": "Upgrade to gradle 6.7", "committedDate": "2020-10-19T16:08:59Z", "type": "commit"}, {"oid": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "url": "https://github.com/palantir/atlasdb/commit/84fc524ef2d555cadf7ef92a7051bbe247a6db90", "message": "Standardize baseline configuration in build.gradle", "committedDate": "2020-10-19T16:08:59Z", "type": "commit"}, {"oid": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "url": "https://github.com/palantir/atlasdb/commit/84fc524ef2d555cadf7ef92a7051bbe247a6db90", "message": "Standardize baseline configuration in build.gradle", "committedDate": "2020-10-19T16:08:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3OTcxMw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507879713", "bodyText": "nice", "author": "carterkozak", "createdAt": "2020-10-19T16:14:16Z", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/impl/TableSplittingKeyValueService.java", "diffHunk": "@@ -377,8 +378,7 @@ public void compactInternally(TableReference tableRef, boolean inMaintenanceMode\n     public ClusterAvailabilityStatus getClusterAvailabilityStatus() {\n         return delegates.stream()\n                 .map(kvs -> kvs.getClusterAvailabilityStatus())\n-                .sorted()\n-                .findFirst()\n+                .min(Comparator.naturalOrder())", "originalCommit": "ccf4cba94bfc7825506a3e184f4401e898258184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNjM5Mw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507906393", "bodyText": "This was an automated gradle-baseline refactor", "author": "schlosna", "createdAt": "2020-10-19T16:55:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3OTcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4MjMzNg==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507882336", "bodyText": "I don't think we need a changelog for these unless there are specific fixes we want to call out.\nIf we keep the changelog we should remove the template components and write a a short description of the pieces consumers may be interested in.", "author": "carterkozak", "createdAt": "2020-10-19T16:18:07Z", "path": "changelog/@unreleased/pr-5044.v2.yml", "diffHunk": "@@ -0,0 +1,34 @@\n+type: improvement\n+improvement:\n+  description: |-\n+    Upgrade gradle-baseline\n+\n+    **Goals (and why)**:\n+    AtlasDB's gradle-baseline version is significantly out of date and is not being kept up-to-date by excavators. Similar to #5043 , this upgrades the gradle-baseline version used so that atlasdb is enforcing (most of) the checks baseline provides\n+\n+    **Implementation Description (bullets)**:\n+\n+    Steps below can be seen in individual commits on this PR\n+\n+    - Apply gradle-palantir-java-format plugin\n+    - Bump gradle-baseline plugin version\n+    - Update baseline configs\n+    - Bump error-prone and immutables versions for compatibility with error-prone\n+    - Apply automated gradle-baseline refactorings (`./gradlew compileJava compileTestJava -PrefasterApply -PerrorProneApply`)\n+    - Reformat (`./gradlew format`)\n+    - Temporarily relax some error-prone checks from error to warning (to be fixed iteratively in follow up PRs after merge)\n+    - Workaround error-prone fatal error with lambda method reference check\n+\n+    **Testing (What was existing testing like?  What have you done to improve it?)**:\n+    Local compilation\n+\n+    **Concerns (what feedback would you like?)**:\n+    The reformat generated a ton of diffs, we may want to split that out separately, but I wanted to use the automated refactorings which also generate a bunch of diffs.\n+\n+    **Where should we start reviewing?**:\n+    `build.gradle` has most of the changes and temporary exclusions.\n+\n+    **Priority (whenever / two weeks / yesterday)**:\n+    Whenever\n+  links:\n+  - https://github.com/palantir/atlasdb/pull/5044", "originalCommit": "70e4d102be2104e628dff663b7922cbd4025aa15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3ODY2Mw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507878663", "bodyText": "moved to custom-suppressions.xml per gradle-baseline standard", "author": "schlosna", "createdAt": "2020-10-19T16:12:44Z", "path": ".baseline/checkstyle/checkstyle-suppressions.xml", "diffHunk": "@@ -21,17 +25,5 @@\n     <suppress files=\"\\.(bdr|eot|gif|gzip|jar|json|otf|png|svg|ttf|woff|zip)$\" checks=\"NewlineAtEndOfFile\" />\n \n     <!-- Generated code should not be subjected to checkstyle. -->\n-    <suppress files=\"[/\\\\].*[/\\\\]generated_src[/\\\\]\" checks=\".\" />\n-    <suppress files=\"[/\\\\].*[/\\\\]generated_testSrc[/\\\\]\" checks=\".\" />\n-    <suppress files=\"[/\\\\].*[/\\\\]generated[/\\\\]\" checks=\".\" />\n-\n-    <!-- Certain AtlasDB projects are ignored. -->\n-    <suppress files=\"atlasdb-client/*\" checks=\".\" />\n-    <suppress files=\"atlasdb-commons/*\" checks=\".\" />\n-    <suppress files=\"atlasdb-console/*\" checks=\".\" />\n-    <suppress files=\"atlasdb-jdbc/*\" checks=\".\" />\n-    <suppress files=\"atlasdb-jdbc-tests/*\" checks=\".\" />\n-    <suppress files=\"cassandra-partitioner/*\" checks=\".\" />\n-    <suppress files=\"commons-db/*\" checks=\".\" />\n-    <suppress files=\"lock-impl/*\" checks=\".\" />", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3OTk4NA==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507879984", "bodyText": "I opted to skip these checks for now so that we have the vast majority of improved baseline checks, and we can burn these down in smaller, independent PRs that are easier to review", "author": "schlosna", "createdAt": "2020-10-19T16:14:42Z", "path": ".baseline/checkstyle/custom-suppressions.xml", "diffHunk": "@@ -0,0 +1,40 @@\n+<?xml version=\"1.0\"?>\n+<!DOCTYPE suppressions PUBLIC\n+        \"-//Checkstyle//DTD SuppressionFilter Configuration 1.2//EN\"\n+        \"https://checkstyle.org/dtds/suppressions_1_2.dtd\">\n+\n+<!-- IMPORTANT ECLIPSE NOTE: If you change this file, you must restart Eclipse\n+ for your changes to take effect in its Checkstyle integration. -->\n+\n+<!-- custom-suppressions.xml allows users to specify suppressions that will not be overridden by\n+     baselineUpdateConfig -->\n+<suppressions>\n+    <!-- Generated code should not be subjected to checkstyle. -->\n+    <suppress files=\"[/\\\\].*[/\\\\]generated_src[/\\\\]\" checks=\".\"/>\n+    <suppress files=\"[/\\\\].*[/\\\\]generated_testSrc[/\\\\]\" checks=\".\"/>\n+    <suppress files=\"[/\\\\].*[/\\\\]generated[/\\\\]\" checks=\".\"/>\n+\n+    <!-- ignore tests until they can be remediated -->\n+    <suppress files=\"[/\\\\]src[/\\\\].*[Tt]est[/\\\\](java|groovy)[/\\\\]\" checks=\".\" />\n+\n+    <!-- Skip some explicit checks until they can be remediated -->\n+    <suppress files=\".*\" checks=\"AnnotationUseStyle\"/>\n+    <suppress files=\".*\" checks=\"AvoidStaticImport\"/>\n+    <suppress files=\".*\" checks=\"CyclomaticComplexity\"/>\n+    <suppress files=\".*\" checks=\"DesignForExtension\"/>\n+    <suppress files=\".*\" checks=\"RegexpSinglelineJava\"/>\n+    <suppress files=\".*\" checks=\"RedundantModifier\"/>\n+    <suppress files=\".*\" checks=\"SummaryJavadocCheck\"/>\n+    <suppress files=\".*\" checks=\"VisibilityModifier\"/>\n+    <suppress files=\".*\" id=\"BanGuavaCaches\"/>", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4MTAxMQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507881011", "bodyText": "sorted these to simplify future updates.", "author": "schlosna", "createdAt": "2020-10-19T16:16:05Z", "path": "build.gradle", "diffHunk": "@@ -12,18 +12,19 @@ buildscript {\n     }\n \n     dependencies {\n-        classpath 'com.netflix.nebula:gradle-info-plugin:7.1.4'\n         classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5'\n-        classpath 'com.palantir.metricschema:gradle-metric-schema:0.5.5'\n-        classpath 'org.jfrog.buildinfo:build-info-extractor-gradle:4.9.8'\n-        classpath 'gradle.plugin.com.palantir.gradle.docker:gradle-docker:0.22.1'\n-        classpath 'com.palantir.baseline:gradle-baseline-java:1.8.2'\n+        classpath 'com.netflix.nebula:gradle-info-plugin:7.1.4'\n+        classpath 'com.netflix.nebula:nebula-publishing-plugin:17.2.1'\n+        classpath 'com.palantir.baseline:gradle-baseline-java:3.43.0'\n         classpath 'com.palantir.gradle.conjure:gradle-conjure:4.22.0'\n-        classpath 'gradle.plugin.com.palantir.gradle.gitversion:gradle-git-version:0.11.0'\n+        classpath 'com.palantir.javaformat:gradle-palantir-java-format:1.0.1'\n+        classpath 'com.palantir.metricschema:gradle-metric-schema:0.5.5'\n         classpath 'com.palantir.sls-packaging:gradle-sls-packaging:4.10.1'\n-        classpath 'com.netflix.nebula:nebula-publishing-plugin:17.2.1'\n         classpath 'gradle.plugin.com.hierynomus.gradle.plugins:license-gradle-plugin:0.15.0'\n+        classpath 'gradle.plugin.com.palantir.gradle.docker:gradle-docker:0.22.1'\n+        classpath 'gradle.plugin.com.palantir.gradle.gitversion:gradle-git-version:0.11.0'\n         classpath 'gradle.plugin.org.inferred:gradle-processors:3.3.0'\n+        classpath 'org.jfrog.buildinfo:build-info-extractor-gradle:4.9.8'", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NDQ0MA==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507884440", "bodyText": "applied by default now https://github.com/palantir/gradle-baseline/blob/32b092e918cb3f46380273fd7957a26b09ee0d6a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/Baseline.java#L36", "author": "schlosna", "createdAt": "2020-10-19T16:21:14Z", "path": "build.gradle", "diffHunk": "@@ -35,8 +36,7 @@ plugins {\n     id 'com.google.protobuf' version '0.8.10'\n }\n \n-apply plugin: 'com.palantir.baseline-config'\n-apply plugin: 'com.palantir.baseline-circleci'", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NDY0Nw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507884647", "bodyText": "applied by default now https://github.com/palantir/gradle-baseline/blob/32b092e918cb3f46380273fd7957a26b09ee0d6a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/Baseline.java#L35", "author": "schlosna", "createdAt": "2020-10-19T16:21:35Z", "path": "build.gradle", "diffHunk": "@@ -35,8 +36,7 @@ plugins {\n     id 'com.google.protobuf' version '0.8.10'\n }\n \n-apply plugin: 'com.palantir.baseline-config'", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NDk5Mw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507884993", "bodyText": "use standard formatting to streamline the baseline refactorings", "author": "schlosna", "createdAt": "2020-10-19T16:22:03Z", "path": "build.gradle", "diffHunk": "@@ -65,6 +65,7 @@ allprojects {\n \n     apply plugin: 'java-library'\n     apply plugin: 'org.inferred.processors'  // installs the \"processor\" configuration needed for baseline-error-prone\n+    apply plugin: 'com.palantir.java-format'", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NjIyNw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507886227", "bodyText": "relaxing from error to warning for now, will burn down in separate PRs", "author": "schlosna", "createdAt": "2020-10-19T16:23:49Z", "path": "build.gradle", "diffHunk": "@@ -104,6 +105,44 @@ allprojects {\n             it.substitute it.module('org.glassfish.web:javax.el') with it.module('org.glassfish:jakarta.el:3.0.3')\n         }\n     }\n+\n+    plugins.withId('com.palantir.baseline-error-prone', {\n+        tasks.withType(JavaCompile).configureEach {\n+            options.errorprone.disableWarningsInGeneratedCode = true\n+            options.errorprone.errorproneArgs.addAll([\n+                '-XepDisableWarningsInGeneratedCode',\n+                '-XepExcludedPaths:.*(generated).*',\n+            ])\n+\n+            // temporarily relax constraints until we can fix all violations\n+            Set<String> errorsToRelax = [\n+                'CatchBlockLogException',\n+                'CheckReturnValue',\n+                'DangerousCompletableFutureUsage',\n+                'DoNotMock',\n+                'ExecutorSubmitRunnableFutureIgnored',\n+                'ExtendsErrorOrThrowable',\n+                'ImmutablesBuilderMissingInitialization',\n+                'InputStreamSlowMultibyteRead',\n+                'LogSafePreconditionsMessageFormat',\n+                'PreconditionsConstantMessage',\n+                'PreconditionsInvalidPlaceholder',\n+                'PreferSafeLoggingPreconditions',\n+                'ReadReturnValueIgnored',\n+                'ReferenceEquality',\n+                'ReturnValueIgnored',\n+                'SafeLoggingExceptionMessageFormat',\n+                'Slf4jLevelCheck',\n+                'StreamOfEmpty',\n+                'StrictUnusedVariable',\n+                'ValidateConstantMessage',\n+            ]\n+            for (String checkName : errorsToRelax) {\n+                options.errorprone.warn(checkName)\n+            }", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NzEwNQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507887105", "bodyText": "moved all of this to build.gradle and this is no longer opt-in, its default on everywhere", "author": "schlosna", "createdAt": "2020-10-19T16:25:04Z", "path": "gradle/baseline.gradle", "diffHunk": "@@ -1,42 +0,0 @@\n-apply plugin: 'com.palantir.baseline-checkstyle'\n-\n-// ./gradlew compileJava compileTestJava -PenableErrorProne=true\n-if (enableErrorProne.toBoolean()) {", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMzODQ1OA==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r508338458", "bodyText": "So reading through it looks like this was doing some per main/test package differences, but I think it's fine. We should quickly drive all the turned off warnings.", "author": "jkozlowski", "createdAt": "2020-10-20T09:12:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NzEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4ODMyNw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507888327", "bodyText": "defaulting to gradle-baseline's IntelliJ Idea integration configs. Checkstyle now works properly and compiles fine for me in IDEA 2020.3 CE EAP.", "author": "schlosna", "createdAt": "2020-10-19T16:26:50Z", "path": "gradle/idea.gradle", "diffHunk": "@@ -1,215 +0,0 @@\n-apply plugin: 'java-library'\n-apply plugin: 'idea'\n-\n-assert sourceCompatibility instanceof JavaVersion;\n-assert targetCompatibility instanceof JavaVersion;\n-assert sourceCompatibility == targetCompatibility;\n-\n-project.tasks.withType(JavaCompile) { JavaCompile task ->\n-  // This actually runs javax.tools.JavaCompiler in-process, but we can still pass arguments\n-  // as though it were running the javac executable.\n-  task.options.compilerArgs << \"-XDignore.symbol.file\";\n-  task.options.compilerArgs << \"-Xlint:none\";\n-  task.options.compilerArgs << '-encoding' << 'utf-8';\n-  task.options.encoding = 'UTF-8'", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4ODg2Nw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507888867", "bodyText": "We can probably clean up more of these in a follow up PR", "author": "schlosna", "createdAt": "2020-10-19T16:27:38Z", "path": "gradle/shared.gradle", "diffHunk": "@@ -27,7 +26,6 @@ dependencies {\n     // Dont add Java8 compile/runtime dependencies here as commons-executors needs to be compatible with Java6 clients\n     compile group: 'com.google.code.findbugs', name: 'jsr305'\n     compile group: 'com.google.code.findbugs', name: 'findbugs-annotations'\n-    checkstyle group: 'com.puppycrawl.tools', name: 'checkstyle', version: libVersions.checkstyle\n     testCompile group: 'junit', name: 'junit'\n     testCompile group: 'org.assertj', name: 'assertj-core'", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4OTgwNQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507889805", "bodyText": "AtlasDB has had JDK8 as minimum dependency for a while, and this old version of checkstyle isn't compatible with gradle-baseline's checkstyle rules, and this old version would breaks Idea Checkstyle integration, but now this all works properly.", "author": "schlosna", "createdAt": "2020-10-19T16:29:08Z", "path": "gradle/versions.gradle", "diffHunk": "@@ -28,7 +28,6 @@ ext.libVersions =\n     protoc: '3.5.1',\n     findbugs: '1.3.9',\n     hikariCP: '3.4.1',\n-    checkstyle: '6.18',", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MDI2Mg==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507890262", "bodyText": "bumping this was necessary to fix gradle-baseline & error-prone compatibility", "author": "schlosna", "createdAt": "2020-10-19T16:29:45Z", "path": "versions.props", "diffHunk": "@@ -45,7 +45,7 @@ org.clojure:clojure = 1.8.0\n org.codehaus.groovy:* = 2.4.4\n org.derive4j:* = 1.1.1\n org.freemarker:freemarker = 2.3.29\n-org.immutables:* = 2.8.2\n+org.immutables:* = 2.8.8", "originalCommit": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37e7ab5569cd946cf7abcdde6aa4e85302924e99", "url": "https://github.com/palantir/atlasdb/commit/37e7ab5569cd946cf7abcdde6aa4e85302924e99", "message": "Remove changelog", "committedDate": "2020-10-19T16:58:19Z", "type": "commit"}, {"oid": "ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "url": "https://github.com/palantir/atlasdb/commit/ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "message": "Update error-prone configuration (#5048)\n\n* Update error-prone configuration\n\n* Fix PreferCollectionConstructors\n\n```\n./gradlew compileJava compileTestJava -PerrorProneApply=PreferCollectionConstructors\n./gradlew format\n```\n\n* Fix BracesRequired\n\n`./gradlew compileJava compileTestJava -PerrorProneApply=BracesRequired && ./gradlew format`\n\n* Fix LoggerEnclosingClass\n\n`./gradlew compileJava compileTestJava -PerrorProneApply=LoggerEnclosingClass && ./gradlew format`\n\n* Fix Slf4jLevelCheck\n\n```\n./gradlew compileJava compileTestJava -PerrorProneApply=Slf4jLevelCheck && ./gradlew format\n```\n\n* Fix ExecutorSubmitRunnableFutureIgnored\n\n* Fix RedundantModifier\n\n* Fix MissingOverride\n\n* Fix LambdaMethodReference\n\n* Fix FinalClass\n\n* silence StrictUnusedVariable to avoid losing other signal\n\n* Fix PreferStaticLoggers\n\n* Fix UnnecessaryLambdaArgumentParentheses\n\n* Fix BadImport\n\n* Fix UnnecessaryParentheses\n\n* remove unnecessary comments\n\n* Disable JdkObsolete for now to reduce compilation spam\n\n* More FinalClass fixes\n\n* More MissingOverride\n\n* Fix Incomparable\n\n* Fix CollectionStreamForEach\n\n* Fix StreamOfEmpty\n\n* More LambdaMethodReference\n\n* More BadImport\n\n* More ClassCanBeStatic\n\n* Suppress PreferStaticLoggers in ProfilingTimelockServiceTest\n\n* Suppress static/final class on MaxTimestampsToGiveTimestampService\n\nRequired for mockito spies\n\n* Suppress PreferStaticLoggers in TimestampAllocationFailuresTest\n\n* format\n\nCo-authored-by: Carter Kozak <ckozak@palantir.com>", "committedDate": "2020-10-19T22:02:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM0NzA4MQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r508347081", "bodyText": "\ud83d\udcaf", "author": "jeremyk-91", "createdAt": "2020-10-20T09:24:59Z", "path": ".baseline/idea/intellij-java-palantir-style.xml", "diffHunk": "@@ -100,30 +87,44 @@\n           <option name=\"ALIGN_MULTILINE_PARAMETERS\" value=\"false\" />\n           <option name=\"ALIGN_MULTILINE_RESOURCES\" value=\"false\" />\n           <option name=\"ARRAY_INITIALIZER_WRAP\" value=\"1\" />\n+          <option name=\"ASSIGNMENT_WRAP\" value=\"1\" />\n           <option name=\"BINARY_OPERATION_SIGN_ON_NEXT_LINE\" value=\"true\" />\n           <option name=\"BINARY_OPERATION_WRAP\" value=\"1\" />\n           <option name=\"BLANK_LINES_AROUND_METHOD_IN_INTERFACE\" value=\"0\" />\n-          <option name=\"CALL_PARAMETERS_WRAP\" value=\"1\" />\n+          <option name=\"CALL_PARAMETERS_LPAREN_ON_NEXT_LINE\" value=\"true\" />\n+          <option name=\"CALL_PARAMETERS_WRAP\" value=\"5\" />\n           <option name=\"DOWHILE_BRACE_FORCE\" value=\"3\" />\n+          <option name=\"ENUM_CONSTANTS_WRAP\" value=\"2\" />\n           <option name=\"EXTENDS_KEYWORD_WRAP\" value=\"1\" />\n           <option name=\"EXTENDS_LIST_WRAP\" value=\"1\" />\n+          <option name=\"FIELD_ANNOTATION_WRAP\" value=\"1\" />\n           <option name=\"FOR_BRACE_FORCE\" value=\"3\" />\n           <option name=\"FOR_STATEMENT_WRAP\" value=\"1\" />\n           <option name=\"IF_BRACE_FORCE\" value=\"3\" />\n-          <option name=\"KEEP_BLANK_LINES_BEFORE_RBRACE\" value=\"1\" />\n+          <option name=\"KEEP_BLANK_LINES_BEFORE_RBRACE\" value=\"0\" />\n+          <option name=\"KEEP_BLANK_LINES_IN_CODE\" value=\"1\" />\n+          <option name=\"KEEP_BLANK_LINES_IN_DECLARATIONS\" value=\"1\" />\n           <option name=\"KEEP_CONTROL_STATEMENT_IN_ONE_LINE\" value=\"false\" />\n           <option name=\"KEEP_FIRST_COLUMN_COMMENT\" value=\"false\" />\n           <option name=\"KEEP_SIMPLE_CLASSES_IN_ONE_LINE\" value=\"true\" />\n+          <option name=\"KEEP_SIMPLE_LAMBDAS_IN_ONE_LINE\" value=\"true\" />\n           <option name=\"KEEP_SIMPLE_METHODS_IN_ONE_LINE\" value=\"true\" />\n-          <option name=\"METHOD_PARAMETERS_WRAP\" value=\"1\" />\n+          <option name=\"LINE_COMMENT_AT_FIRST_COLUMN\" value=\"false\" />\n+          <option name=\"LINE_COMMENT_ADD_SPACE\" value=\"true\" />\n+          <option name=\"METHOD_CALL_CHAIN_WRAP\" value=\"5\" />\n+          <option name=\"METHOD_PARAMETERS_LPAREN_ON_NEXT_LINE\" value=\"true\" />\n+          <option name=\"METHOD_PARAMETERS_WRAP\" value=\"5\" />\n+          <option name=\"OPTIMIZE_IMPORTS_ON_THE_FLY\" value=\"true\" />", "originalCommit": "ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1MDEyMQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r508350121", "bodyText": "Is this OK? Lines 114-115 suggests that (authorized) should be indicated on both lines", "author": "jeremyk-91", "createdAt": "2020-10-20T09:29:18Z", "path": "atlasdb-console/src/main/groovy/com/palantir/atlasdb/console/AtlasConsoleBinder.java", "diffHunk": "@@ -99,7 +99,8 @@ public Object call() {\n             System.out.println(\"\\nTopics with help messages:\\n\"); // (authorized)\n             System.out.println(help.keySet().toString()); // (authorized)\n             System.out.println(\"\\nCall help(\\'topic\\') to view information on a specific topic.\\n\"); // (authorized)\n-            System.out.println(\"If you'd like to enable database mutations (not recommended), re-run console with the 'mutations_enabled' flag\\n\"); // (authorized)\n+            System.out.println(\"If you'd like to enable database mutations (not recommended), re-run console with the\"\n+                    + \" 'mutations_enabled' flag\\n\"); // (authorized)", "originalCommit": "ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1OTEwMQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r508359101", "bodyText": "Had a look internally - this is probably OK (see e.g. the large internal product's class that inspects atlas's lock service)", "author": "jeremyk-91", "createdAt": "2020-10-20T09:42:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1MDEyMQ=="}], "type": "inlineReview"}, {"oid": "e5dabf951b6be2500290651563172f69eff1c5a3", "url": "https://github.com/palantir/atlasdb/commit/e5dabf951b6be2500290651563172f69eff1c5a3", "message": "Merge branch 'develop' into ds/format", "committedDate": "2020-10-20T11:30:35Z", "type": "commit"}, {"oid": "07f875c24519141932db640c264dd51d718f5de9", "url": "https://github.com/palantir/atlasdb/commit/07f875c24519141932db640c264dd51d718f5de9", "message": "Fixup merge formatting", "committedDate": "2020-10-20T11:47:48Z", "type": "commit"}]}