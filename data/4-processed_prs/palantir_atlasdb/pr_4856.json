{"pr_number": 4856, "pr_title": "Change API from SortedMap to NavigableMap.", "pr_createdAt": "2020-06-23T08:48:17Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4856", "timeline": [{"oid": "bb42161873c8f26c97e45dca08ee281844a54c80", "url": "https://github.com/palantir/atlasdb/commit/bb42161873c8f26c97e45dca08ee281844a54c80", "message": "Change to NavigableMap.", "committedDate": "2020-06-23T08:44:22Z", "type": "commit"}, {"oid": "dc723b5b4c98bb27ed0e3098ba757254fbfb02c7", "url": "https://github.com/palantir/atlasdb/commit/dc723b5b4c98bb27ed0e3098ba757254fbfb02c7", "message": "Fixup", "committedDate": "2020-06-23T08:49:28Z", "type": "commit"}, {"oid": "4b01ece5d4646dc80d368210b2e480b339dd4d17", "url": "https://github.com/palantir/atlasdb/commit/4b01ece5d4646dc80d368210b2e480b339dd4d17", "message": "Fixup", "committedDate": "2020-06-23T09:40:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5NzA2Mg==", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444097062", "bodyText": "This one is potentially dev-breaky (generics are invariant), though a quick look internally suggests that it has a few users outside AtlasDB, the last of which was updated in mid-2019 so I think it's fine. I'd suggest calling this one out in changelog to be certain.", "author": "jeremyk-91", "createdAt": "2020-06-23T09:41:45Z", "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/keyvalue/impl/Cells.java", "diffHunk": "@@ -111,7 +112,7 @@ public static Cell createLargestCellForRow(byte[] rowName) {\n         return ret;\n     }\n \n-    public static <T> NavigableMap<byte[], SortedMap<byte[], T>> breakCellsUpByRow(Map<Cell, T> map) {\n+    public static <T> NavigableMap<byte[], NavigableMap<byte[], T>> breakCellsUpByRow(Map<Cell, T> map) {", "originalCommit": "dc723b5b4c98bb27ed0e3098ba757254fbfb02c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0NDA3Mw==", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444144073", "bodyText": "Added to the changelog.", "author": "jkozlowski", "createdAt": "2020-06-23T11:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5NzA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5OTI4OA==", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444099288", "bodyText": "This one doesn't seem to have external users, so should be fine", "author": "jeremyk-91", "createdAt": "2020-06-23T09:45:35Z", "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/ResultsExtractor.java", "diffHunk": "@@ -78,15 +78,15 @@ public ResultsExtractor(MetricsManager metricsManager) {\n             ColumnSelection selection,\n             byte[] endExclusive) {\n         byte[] lastRow = extractResults(colsByKey, startTs, selection);\n-        SortedMap<byte[], SortedMap<byte[], T>> resultsByRow = Cells.breakCellsUpByRow(asMap());\n+        NavigableMap<byte[], NavigableMap<byte[], T>> resultsByRow = Cells.breakCellsUpByRow(asMap());\n         return getRowResults(endExclusive, lastRow, resultsByRow);\n     }\n \n     public static <T> TokenBackedBasicResultsPage<RowResult<T>, byte[]> getRowResults(\n             byte[] endExclusive,\n             byte[] lastRow,\n-            SortedMap<byte[], SortedMap<byte[], T>> resultsByRow) {\n-        SortedMap<byte[], RowResult<T>> ret = RowResults.viewOfSortedMap(resultsByRow);\n+            NavigableMap<byte[], NavigableMap<byte[], T>> resultsByRow) {", "originalCommit": "4b01ece5d4646dc80d368210b2e480b339dd4d17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0NDE1Mw==", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444144153", "bodyText": "Still added to changelog.", "author": "jkozlowski", "createdAt": "2020-06-23T11:10:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5OTI4OA=="}], "type": "inlineReview"}, {"oid": "ed7b6345ab596e12c090a13709068bb3da36d1e4", "url": "https://github.com/palantir/atlasdb/commit/ed7b6345ab596e12c090a13709068bb3da36d1e4", "message": "Fixup", "committedDate": "2020-06-23T09:58:51Z", "type": "commit"}, {"oid": "c68b2a53fbebc04ad7987c6c64bc8e34ccc199a6", "url": "https://github.com/palantir/atlasdb/commit/c68b2a53fbebc04ad7987c6c64bc8e34ccc199a6", "message": "Regenerate table.", "committedDate": "2020-06-23T10:56:31Z", "type": "commit"}, {"oid": "d7195d2055762e7628dc8eabb379037771c86f4e", "url": "https://github.com/palantir/atlasdb/commit/d7195d2055762e7628dc8eabb379037771c86f4e", "message": "Add generated changelog entries", "committedDate": "2020-06-23T10:56:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ1NjAxMA==", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444456010", "bodyText": "isn't this a binary backcompat break?", "author": "j-baker", "createdAt": "2020-06-23T19:26:41Z", "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/transaction/api/Transaction.java", "diffHunk": "@@ -65,7 +65,7 @@\n      * @return a mapping of rows to the columns matching the provided column selection\n      */\n     @Idempotent\n-    SortedMap<byte[], RowResult<byte[]>> getRows(\n+    NavigableMap<byte[], RowResult<byte[]>> getRows(", "originalCommit": "d7195d2055762e7628dc8eabb379037771c86f4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMyNTA2Mw==", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r544325063", "bodyText": "Yes, just hit this. It seems that anyone relying on internal libraries (like atlas-event-queue) will need to upgrade as they get errors like this:\njava.lang.NoSuchMethodError: 'java.util.SortedMap com.palantir.atlasdb.transaction.api.Transaction.getRows(com.palantir.atlasdb.keyvalue.api.TableReference, java.lang.Iterable, com.palantir.atlasdb.keyvalue.api.ColumnSelection)'\n\tat com.palantir.atlas.sequential.schema.generated.OffsetsTable.getRows(OffsetsTable.java:613)\n\tat com.palantir.atlas.sequential.store.OffsetsStore.getOffsets(OffsetsStore.java:79)\n\tat com.palantir.atlas.sequential.store.OffsetsStore.getLatestOffsets(OffsetsStore.java:40)\n\tat com.palantir.atlas.sequential.OrderedTableReader.getLatestOffsets(OrderedTableReader.java:95)\n\tat com.palantir.atlas.sequential.ObjectMappingReader.getLatestOffsets(ObjectMappingReader.java:46)\n\tat com.palantir.atlas.sequential.api.SequentialTableReader.getLatestOffset(SequentialTableReader.java:81)\n\tat com.palantir.atlas.eventdriven.AtlasEventReader.lambda$getLatestOffset$1(AtlasEventReader.java:34)", "author": "iamdanfox", "createdAt": "2020-12-16T14:07:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ1NjAxMA=="}], "type": "inlineReview"}]}