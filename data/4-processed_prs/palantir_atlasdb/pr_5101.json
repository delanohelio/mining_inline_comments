{"pr_number": 5101, "pr_title": "[Cross Client Batching - 1] | TimeLock Batch endpoints", "pr_createdAt": "2020-11-05T14:42:47Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5101", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODExNzE0NA==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518117144", "bodyText": "I don't know what opinions are on just adding these endpoints / requests to the current timelock api, or creating a new one (as you have done here) - but either way, I think it's really weird to import in definitions from the other API.", "author": "Jolyon-S", "createdAt": "2020-11-05T15:00:41Z", "path": "timelock-api/src/main/conjure/cross-client-batched-timelock-api.yml", "diffHunk": "@@ -0,0 +1,63 @@\n+types:\n+  imports:\n+    LeaderTime:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.v2.LeaderTime\n+    Long:\n+      base-type: any\n+      external:\n+        java: java.lang.Long\n+    LockWatchStateUpdate:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.watch.LockWatchStateUpdate\n+    ConjureIdentifiedVersion:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.ConjureIdentifiedVersion", "originalCommit": "a3456eb30bab2665f7def13fec9375541147a2db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE4NjU2Nw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518186567", "bodyText": "I'd prefer we just use the existing API file. In my mind the model was that they would be placed on a different service, but in the same API.", "author": "jeremyk-91", "createdAt": "2020-11-05T16:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODExNzE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyODAyMw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518128023", "bodyText": "I'm not convinced this is the right approach. I'd have thought you would want a request type like NamespacedLeaderTimes, then call with a list of those. The point of that would be if you had incoming requests for leader time such as:\nnamespace1\nnamespace2\nnamespace3\nnamespace1\nsay they all get batched together - you'd likely want to further gather together all requests of the same namespace into their own requests, so that you can do clever things (coalesce / reduce overheads etc). Maybe I'm missing something - I've just looked at this briefly - but that seems like the right thing to do.", "author": "Jolyon-S", "createdAt": "2020-11-05T15:15:21Z", "path": "timelock-api/src/main/conjure/cross-client-batched-timelock-api.yml", "diffHunk": "@@ -0,0 +1,63 @@\n+types:\n+  imports:\n+    LeaderTime:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.v2.LeaderTime\n+    Long:\n+      base-type: any\n+      external:\n+        java: java.lang.Long\n+    LockWatchStateUpdate:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.watch.LockWatchStateUpdate\n+    ConjureIdentifiedVersion:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.ConjureIdentifiedVersion\n+    GetCommitTimestampsRequest:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.GetCommitTimestampsRequest\n+    GetCommitTimestampsResponse:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.GetCommitTimestampsResponse\n+  definitions:\n+    default-package: com.palantir.atlasdb.timelock.api\n+    objects:\n+      NamespacedLeaderTime:\n+        fields:\n+          namespace: string\n+          leaderTime: LeaderTime\n+      NamespacedGetCommitTimestampsRequest:\n+        fields:\n+          namespace: string\n+          getCommitTimestampsRequest: GetCommitTimestampsRequest\n+      NamespacedGetCommitTimestampsResponse:\n+        fields:\n+          namespace: string\n+          getCommitTimestampsResponse: GetCommitTimestampsResponse\n+\n+services:\n+  CrossClientBatchedConjureTimelockService:\n+    name: Cross Client Batched Timelock Service\n+    default-auth: header\n+    package: com.palantir.atlasdb.timelock.batch.api\n+    base-path: /tl/batch\n+    endpoints:\n+      leaderTimes:\n+        http: POST /lts\n+        args:\n+          namespaces: list<string>\n+        returns: list<NamespacedLeaderTime>", "originalCommit": "a3456eb30bab2665f7def13fec9375541147a2db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE4NjM1Nw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518186357", "bodyText": "You're right, the server should be defensive against multiple queries for same namespace.", "author": "sudiksha27", "createdAt": "2020-11-05T16:29:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyODAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE4ODMwMw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518188303", "bodyText": "This is LeaderTime, though, which is a coalescing endpoint, and so for this one Sudiksha's API is correct (notice that namespaces is a list of strings, and any futures for those namespaces will be answered with the correct answer from the list of NamespacedLeaderTimes).", "author": "jeremyk-91", "createdAt": "2020-11-05T16:31:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyODAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE5ODAyMw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518198023", "bodyText": "For leaderTime, I think having a set of namespaces should be okay. I am unsure if we need more than one computation for any client (even if they are making more than one query).\nResolving collision for NamespacedGetCommitTimestampsRequest might be trickier because of LockWatchVersion but, I can also not see the case where we manage to make two queries in one request with different lockWatchVersion for same client.", "author": "sudiksha27", "createdAt": "2020-11-05T16:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyODAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIwMDEzNQ==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518200135", "bodyText": "I can:\nImagine we have one service using atlasdb-proxy that has multiple nodes. They might all talk to the same node of atlasdb-proxy but with different internal lockWatchVersions, and would expect different responses (and yet would all be the same namespace in Atlas).", "author": "Jolyon-S", "createdAt": "2020-11-05T16:48:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyODAyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE5OTM2Ng==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518199366", "bodyText": "This one on the other hand is a bit messier - there's some nontrivial logic in how to reduce all of the legacy GetCommitTimestampRequests into a single one (basically you can take the oldest easily, maybe the newest if there's some clever hackery on the client side).", "author": "jeremyk-91", "createdAt": "2020-11-05T16:47:06Z", "path": "timelock-api/src/main/conjure/cross-client-batched-timelock-api.yml", "diffHunk": "@@ -0,0 +1,63 @@\n+types:\n+  imports:\n+    LeaderTime:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.v2.LeaderTime\n+    Long:\n+      base-type: any\n+      external:\n+        java: java.lang.Long\n+    LockWatchStateUpdate:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.watch.LockWatchStateUpdate\n+    ConjureIdentifiedVersion:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.ConjureIdentifiedVersion\n+    GetCommitTimestampsRequest:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.GetCommitTimestampsRequest\n+    GetCommitTimestampsResponse:\n+      base-type: any\n+      external:\n+        java: com.palantir.atlasdb.timelock.api.GetCommitTimestampsResponse\n+  definitions:\n+    default-package: com.palantir.atlasdb.timelock.api\n+    objects:\n+      NamespacedLeaderTime:\n+        fields:\n+          namespace: string\n+          leaderTime: LeaderTime\n+      NamespacedGetCommitTimestampsRequest:\n+        fields:\n+          namespace: string\n+          getCommitTimestampsRequest: GetCommitTimestampsRequest\n+      NamespacedGetCommitTimestampsResponse:\n+        fields:\n+          namespace: string\n+          getCommitTimestampsResponse: GetCommitTimestampsResponse\n+\n+services:\n+  CrossClientBatchedConjureTimelockService:\n+    name: Cross Client Batched Timelock Service\n+    default-auth: header\n+    package: com.palantir.atlasdb.timelock.batch.api\n+    base-path: /tl/batch\n+    endpoints:\n+      leaderTimes:\n+        http: POST /lts\n+        args:\n+          namespaces: set<string>\n+        returns: list<NamespacedLeaderTime>\n+        docs: |\n+          Cross client batched version of ConjureTimelockService#leaderTime endpoint for acquiring leaderTimes.\n+      getCommitTimestamps:\n+        http: POST /gcts\n+        args:\n+          requests: list<NamespacedGetCommitTimestampsRequest>", "originalCommit": "e70a92e75e55fa665bb807821a6ac2e22e399932", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI3NDIwNA==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518274204", "bodyText": "missed on pass 1: I don't think CrossClientBatched should be a part of the service name as it's more of an implementation detail, it should really be something like MultiClientConjureTimelockService?", "author": "jeremyk-91", "createdAt": "2020-11-05T18:33:07Z", "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -181,4 +193,24 @@ services:\n         http: POST /sw/{namespace}\n         args:\n           namespace: string\n-          request: LockWatchRequest\n\\ No newline at end of file\n+          request: LockWatchRequest\n+  CrossClientBatchedConjureTimelockService:", "originalCommit": "d4febce3339d6055cd9611f8f67fd31e139c0484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI3NDQzNg==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518274436", "bodyText": "as above, the notion of batching should not exist at this level.", "author": "jeremyk-91", "createdAt": "2020-11-05T18:33:32Z", "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -181,4 +193,24 @@ services:\n         http: POST /sw/{namespace}\n         args:\n           namespace: string\n-          request: LockWatchRequest\n\\ No newline at end of file\n+          request: LockWatchRequest\n+  CrossClientBatchedConjureTimelockService:\n+    name: Cross Client Batched Timelock Service\n+    default-auth: header\n+    package: com.palantir.atlasdb.timelock.batch.api\n+    base-path: /tl/batch\n+    endpoints:\n+      leaderTimes:\n+        http: POST /lts\n+        args:\n+          namespaces: set<string>\n+        returns: list<NamespacedLeaderTime>\n+        docs: |\n+          Cross client batched version of ConjureTimelockService#leaderTime endpoint for acquiring leaderTimes.", "originalCommit": "d4febce3339d6055cd9611f8f67fd31e139c0484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI3NDU1Mg==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518274552", "bodyText": "as above: don't think batching is correct. multiclient maybe - or can this just go in the same package?", "author": "jeremyk-91", "createdAt": "2020-11-05T18:33:46Z", "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -181,4 +193,24 @@ services:\n         http: POST /sw/{namespace}\n         args:\n           namespace: string\n-          request: LockWatchRequest\n\\ No newline at end of file\n+          request: LockWatchRequest\n+  CrossClientBatchedConjureTimelockService:\n+    name: Cross Client Batched Timelock Service\n+    default-auth: header\n+    package: com.palantir.atlasdb.timelock.batch.api", "originalCommit": "d4febce3339d6055cd9611f8f67fd31e139c0484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI3NTQ2MQ==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518275461", "bodyText": "can we name this getServiceForNamespace or something like that?", "author": "jeremyk-91", "createdAt": "2020-11-05T18:35:21Z", "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/batch/CrossClientBatchedConjureTimeLockResource.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.timelock.batch;\n+\n+import com.google.common.util.concurrent.Futures;\n+import com.google.common.util.concurrent.ListenableFuture;\n+import com.google.common.util.concurrent.MoreExecutors;\n+import com.palantir.atlasdb.timelock.AsyncTimelockService;\n+import com.palantir.atlasdb.timelock.ConjureResourceExceptionHandler;\n+import com.palantir.atlasdb.timelock.api.ConjureIdentifiedVersion;\n+import com.palantir.atlasdb.timelock.api.GetCommitTimestampsResponse;\n+import com.palantir.atlasdb.timelock.api.NamespacedGetCommitTimestampsRequest;\n+import com.palantir.atlasdb.timelock.api.NamespacedGetCommitTimestampsResponse;\n+import com.palantir.atlasdb.timelock.api.NamespacedLeaderTime;\n+import com.palantir.atlasdb.timelock.batch.api.UndertowCrossClientBatchedConjureTimelockService;\n+import com.palantir.lock.v2.LeaderTime;\n+import com.palantir.lock.watch.LockWatchVersion;\n+import com.palantir.tokens.auth.AuthHeader;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+public final class CrossClientBatchedConjureTimeLockResource\n+        implements UndertowCrossClientBatchedConjureTimelockService {\n+    private final ConjureResourceExceptionHandler exceptionHandler;\n+    private final Function<String, AsyncTimelockService> timelockServices;\n+\n+    private CrossClientBatchedConjureTimeLockResource(\n+            ConjureResourceExceptionHandler exceptionHandler, Function<String, AsyncTimelockService> timelockServices) {\n+        this.exceptionHandler = exceptionHandler;\n+        this.timelockServices = timelockServices;\n+    }\n+\n+    @Override\n+    public ListenableFuture<List<NamespacedLeaderTime>> leaderTimes(AuthHeader authHeader, Set<String> namespaces) {\n+        List<ListenableFuture<NamespacedLeaderTime>> futures = namespaces.stream()\n+                .map(this::getNamespacedLeaderTimeListenableFuture)\n+                .collect(Collectors.toList());\n+\n+        return handleExceptions(() -> Futures.allAsList(futures));\n+    }\n+\n+    @Override\n+    public ListenableFuture<List<NamespacedGetCommitTimestampsResponse>> getCommitTimestamps(\n+            AuthHeader authHeader, List<NamespacedGetCommitTimestampsRequest> requests) {\n+        List<ListenableFuture<NamespacedGetCommitTimestampsResponse>> futures = requests.stream()\n+                .map(this::getNamespacedGetCommitTimestampsResponseListenableFuture)\n+                .collect(Collectors.toList());\n+\n+        return handleExceptions(() -> Futures.allAsList(futures));\n+    }\n+\n+    private ListenableFuture<NamespacedLeaderTime> getNamespacedLeaderTimeListenableFuture(String namespace) {\n+        ListenableFuture<LeaderTime> leaderTimeListenableFuture =\n+                forNamespace(namespace).leaderTime();\n+        return Futures.transform(\n+                leaderTimeListenableFuture,\n+                leaderTime -> NamespacedLeaderTime.of(namespace, leaderTime),\n+                MoreExecutors.directExecutor());\n+    }\n+\n+    private ListenableFuture<NamespacedGetCommitTimestampsResponse>\n+            getNamespacedGetCommitTimestampsResponseListenableFuture(NamespacedGetCommitTimestampsRequest request) {\n+        ListenableFuture<GetCommitTimestampsResponse> commitTimestamps = forNamespace(request.getNamespace())\n+                .getCommitTimestamps(\n+                        request.getNumTimestamps(),\n+                        request.getLastKnownVersion().map(this::toIdentifiedVersion));\n+        return Futures.transform(\n+                commitTimestamps,\n+                commitTimestampsResponse -> NamespacedGetCommitTimestampsResponse.builder()\n+                        .namespace(request.getNamespace())\n+                        .inclusiveLower(commitTimestampsResponse.getInclusiveLower())\n+                        .inclusiveUpper(commitTimestampsResponse.getInclusiveUpper())\n+                        .lockWatchUpdate(commitTimestampsResponse.getLockWatchUpdate())\n+                        .build(),\n+                MoreExecutors.directExecutor());\n+    }\n+\n+    private AsyncTimelockService forNamespace(String namespace) {", "originalCommit": "d4febce3339d6055cd9611f8f67fd31e139c0484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI3NjE4Nw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r518276187", "bodyText": "I think this is safe and correct; can you explain why this is the case?", "author": "jeremyk-91", "createdAt": "2020-11-05T18:36:35Z", "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/batch/CrossClientBatchedConjureTimeLockResource.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.timelock.batch;\n+\n+import com.google.common.util.concurrent.Futures;\n+import com.google.common.util.concurrent.ListenableFuture;\n+import com.google.common.util.concurrent.MoreExecutors;\n+import com.palantir.atlasdb.timelock.AsyncTimelockService;\n+import com.palantir.atlasdb.timelock.ConjureResourceExceptionHandler;\n+import com.palantir.atlasdb.timelock.api.ConjureIdentifiedVersion;\n+import com.palantir.atlasdb.timelock.api.GetCommitTimestampsResponse;\n+import com.palantir.atlasdb.timelock.api.NamespacedGetCommitTimestampsRequest;\n+import com.palantir.atlasdb.timelock.api.NamespacedGetCommitTimestampsResponse;\n+import com.palantir.atlasdb.timelock.api.NamespacedLeaderTime;\n+import com.palantir.atlasdb.timelock.batch.api.UndertowCrossClientBatchedConjureTimelockService;\n+import com.palantir.lock.v2.LeaderTime;\n+import com.palantir.lock.watch.LockWatchVersion;\n+import com.palantir.tokens.auth.AuthHeader;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+public final class CrossClientBatchedConjureTimeLockResource\n+        implements UndertowCrossClientBatchedConjureTimelockService {\n+    private final ConjureResourceExceptionHandler exceptionHandler;\n+    private final Function<String, AsyncTimelockService> timelockServices;\n+\n+    private CrossClientBatchedConjureTimeLockResource(\n+            ConjureResourceExceptionHandler exceptionHandler, Function<String, AsyncTimelockService> timelockServices) {\n+        this.exceptionHandler = exceptionHandler;\n+        this.timelockServices = timelockServices;\n+    }\n+\n+    @Override\n+    public ListenableFuture<List<NamespacedLeaderTime>> leaderTimes(AuthHeader authHeader, Set<String> namespaces) {\n+        List<ListenableFuture<NamespacedLeaderTime>> futures = namespaces.stream()\n+                .map(this::getNamespacedLeaderTimeListenableFuture)\n+                .collect(Collectors.toList());\n+\n+        return handleExceptions(() -> Futures.allAsList(futures));\n+    }\n+\n+    @Override\n+    public ListenableFuture<List<NamespacedGetCommitTimestampsResponse>> getCommitTimestamps(\n+            AuthHeader authHeader, List<NamespacedGetCommitTimestampsRequest> requests) {\n+        List<ListenableFuture<NamespacedGetCommitTimestampsResponse>> futures = requests.stream()\n+                .map(this::getNamespacedGetCommitTimestampsResponseListenableFuture)\n+                .collect(Collectors.toList());\n+\n+        return handleExceptions(() -> Futures.allAsList(futures));\n+    }\n+\n+    private ListenableFuture<NamespacedLeaderTime> getNamespacedLeaderTimeListenableFuture(String namespace) {\n+        ListenableFuture<LeaderTime> leaderTimeListenableFuture =\n+                forNamespace(namespace).leaderTime();\n+        return Futures.transform(\n+                leaderTimeListenableFuture,\n+                leaderTime -> NamespacedLeaderTime.of(namespace, leaderTime),\n+                MoreExecutors.directExecutor());\n+    }\n+\n+    private ListenableFuture<NamespacedGetCommitTimestampsResponse>\n+            getNamespacedGetCommitTimestampsResponseListenableFuture(NamespacedGetCommitTimestampsRequest request) {\n+        ListenableFuture<GetCommitTimestampsResponse> commitTimestamps = forNamespace(request.getNamespace())\n+                .getCommitTimestamps(\n+                        request.getNumTimestamps(),\n+                        request.getLastKnownVersion().map(this::toIdentifiedVersion));\n+        return Futures.transform(\n+                commitTimestamps,\n+                commitTimestampsResponse -> NamespacedGetCommitTimestampsResponse.builder()\n+                        .namespace(request.getNamespace())\n+                        .inclusiveLower(commitTimestampsResponse.getInclusiveLower())\n+                        .inclusiveUpper(commitTimestampsResponse.getInclusiveUpper())\n+                        .lockWatchUpdate(commitTimestampsResponse.getLockWatchUpdate())\n+                        .build(),\n+                MoreExecutors.directExecutor());", "originalCommit": "d4febce3339d6055cd9611f8f67fd31e139c0484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7ad1525b8f0f106dae76deac36e2e3c609a3ab49", "url": "https://github.com/palantir/atlasdb/commit/7ad1525b8f0f106dae76deac36e2e3c609a3ab49", "message": "WIP", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "fe4fd6918ce680826f8c20b64c236097aa876d81", "url": "https://github.com/palantir/atlasdb/commit/fe4fd6918ce680826f8c20b64c236097aa876d81", "message": "getCommitTimestamps", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "a6cb78d03e7688636537dac7179b8f2dc73489f9", "url": "https://github.com/palantir/atlasdb/commit/a6cb78d03e7688636537dac7179b8f2dc73489f9", "message": "Minor", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "71395c05c2b03bef092d3506e9235c5cadcccd98", "url": "https://github.com/palantir/atlasdb/commit/71395c05c2b03bef092d3506e9235c5cadcccd98", "message": "Fix", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "a5e8d17ffafbaaa858d4592d04868df444827972", "url": "https://github.com/palantir/atlasdb/commit/a5e8d17ffafbaaa858d4592d04868df444827972", "message": "Fix", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "4165a05cd20f1663575175b3d6ab31b480ff90e6", "url": "https://github.com/palantir/atlasdb/commit/4165a05cd20f1663575175b3d6ab31b480ff90e6", "message": "Refactor api", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "0f7ad372de632fa07c66437f043e17aee58ffe59", "url": "https://github.com/palantir/atlasdb/commit/0f7ad372de632fa07c66437f043e17aee58ffe59", "message": "WIP - addressing style comments", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "a6f19e65459e8b31ee3b2914a9e9043ce062de91", "url": "https://github.com/palantir/atlasdb/commit/a6f19e65459e8b31ee3b2914a9e9043ce062de91", "message": "WIP", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "5b762c4cd5acb4c73b54d73813d064bce477b66c", "url": "https://github.com/palantir/atlasdb/commit/5b762c4cd5acb4c73b54d73813d064bce477b66c", "message": "Sanity tests", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "3247bc7296f772e2e5958a42a2f69db26f1ddca3", "url": "https://github.com/palantir/atlasdb/commit/3247bc7296f772e2e5958a42a2f69db26f1ddca3", "message": "Tests | exception thrown if a query fails", "committedDate": "2020-11-09T15:06:37Z", "type": "commit"}, {"oid": "3247bc7296f772e2e5958a42a2f69db26f1ddca3", "url": "https://github.com/palantir/atlasdb/commit/3247bc7296f772e2e5958a42a2f69db26f1ddca3", "message": "Tests | exception thrown if a query fails", "committedDate": "2020-11-09T15:06:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5ODg0Nw==", "url": "https://github.com/palantir/atlasdb/pull/5101#discussion_r521298847", "bodyText": "change base path", "author": "sudiksha27", "createdAt": "2020-11-11T11:39:33Z", "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -181,4 +193,24 @@ services:\n         http: POST /sw/{namespace}\n         args:\n           namespace: string\n-          request: LockWatchRequest\n\\ No newline at end of file\n+          request: LockWatchRequest\n+  MultiClientConjureTimelockService:\n+    name: Multi Client Timelock Service\n+    default-auth: header\n+    package: com.palantir.atlasdb.timelock.api\n+    base-path: /tl/batch\n+    endpoints:", "originalCommit": "3247bc7296f772e2e5958a42a2f69db26f1ddca3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bea6c20d05f13c623ec6eeab81efbc8bf6ced05d", "url": "https://github.com/palantir/atlasdb/commit/bea6c20d05f13c623ec6eeab81efbc8bf6ced05d", "message": "Address comment | fix path", "committedDate": "2020-11-16T10:33:50Z", "type": "commit"}]}