{"pr_number": 4974, "pr_title": "Leader election slos", "pr_createdAt": "2020-09-04T16:18:38Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4974", "timeline": [{"oid": "4695090a3d545c367294e992cad26c43f62610d1", "url": "https://github.com/palantir/atlasdb/commit/4695090a3d545c367294e992cad26c43f62610d1", "message": "major bug fix", "committedDate": "2020-09-04T08:01:27Z", "type": "commit"}, {"oid": "4eda8c7e34786ab8699ccfad797561df32625e4c", "url": "https://github.com/palantir/atlasdb/commit/4eda8c7e34786ab8699ccfad797561df32625e4c", "message": "My experiments with TimeLock", "committedDate": "2020-09-04T09:39:49Z", "type": "commit"}, {"oid": "7131447215d279c6414f916401301354f9191f68", "url": "https://github.com/palantir/atlasdb/commit/7131447215d279c6414f916401301354f9191f68", "message": "format", "committedDate": "2020-09-04T10:02:30Z", "type": "commit"}, {"oid": "550bb1591d3c3d076b13c8761f499442b8fa2f2d", "url": "https://github.com/palantir/atlasdb/commit/550bb1591d3c3d076b13c8761f499442b8fa2f2d", "message": "clean up 1", "committedDate": "2020-09-04T10:33:37Z", "type": "commit"}, {"oid": "c711142a23a526d8b89f92581cb32ac90c707711", "url": "https://github.com/palantir/atlasdb/commit/c711142a23a526d8b89f92581cb32ac90c707711", "message": "Refactor", "committedDate": "2020-09-04T11:31:05Z", "type": "commit"}, {"oid": "f0c95df5db1ad553d68c038b51ec9a3f6dc47e8f", "url": "https://github.com/palantir/atlasdb/commit/f0c95df5db1ad553d68c038b51ec9a3f6dc47e8f", "message": "Wire", "committedDate": "2020-09-04T12:55:50Z", "type": "commit"}, {"oid": "9093f896f403196e0f3375c46fb20d9eab54792a", "url": "https://github.com/palantir/atlasdb/commit/9093f896f403196e0f3375c46fb20d9eab54792a", "message": "Fix tests", "committedDate": "2020-09-04T13:35:44Z", "type": "commit"}, {"oid": "a6f7ff19c6c3525ba516fe73c376fe3635d05fb2", "url": "https://github.com/palantir/atlasdb/commit/a6f7ff19c6c3525ba516fe73c376fe3635d05fb2", "message": "Refactor + cleanup", "committedDate": "2020-09-04T13:51:35Z", "type": "commit"}, {"oid": "2f388698206174f1cbfaee6cc8476013ea76266d", "url": "https://github.com/palantir/atlasdb/commit/2f388698206174f1cbfaee6cc8476013ea76266d", "message": "Minor refactor", "committedDate": "2020-09-04T13:58:50Z", "type": "commit"}, {"oid": "c37c6a2642babfe743b81eb84560e0375730c864", "url": "https://github.com/palantir/atlasdb/commit/c37c6a2642babfe743b81eb84560e0375730c864", "message": "Add generated changelog entries", "committedDate": "2020-09-04T13:58:50Z", "type": "commit"}, {"oid": "f623a18ce6ec0910fee42ff2f8407de98789a049", "url": "https://github.com/palantir/atlasdb/commit/f623a18ce6ec0910fee42ff2f8407de98789a049", "message": "Add generated changelog entries", "committedDate": "2020-09-04T13:58:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxOTU0NQ==", "url": "https://github.com/palantir/atlasdb/pull/4974#discussion_r484819545", "bodyText": "nit: fix", "author": "gmaretic", "createdAt": "2020-09-08T10:37:15Z", "path": "changelog/@unreleased/pr-4974.v2.yml", "diffHunk": "@@ -0,0 +1,6 @@\n+type: improvement", "originalCommit": "c37c6a2642babfe743b81eb84560e0375730c864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxOTc2Mw==", "url": "https://github.com/palantir/atlasdb/pull/4974#discussion_r484819763", "bodyText": "fine tuning? :D", "author": "gmaretic", "createdAt": "2020-09-08T10:37:41Z", "path": "leader-election-impl/src/main/java/com/palantir/leader/health/LeaderElectionHealthCheck.java", "diffHunk": "@@ -16,19 +16,33 @@\n \n package com.palantir.leader.health;\n \n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n import com.palantir.leader.LeaderElectionServiceMetrics;\n+import com.palantir.paxos.Client;\n \n public class LeaderElectionHealthCheck {\n-    private static final double MAX_ALLOWED_LAST_5_MINUTE_RATE = 0.016;\n+    private static final double MAX_ALLOWED_LAST_5_MINUTE_RATE = 0.015;", "originalCommit": "c37c6a2642babfe743b81eb84560e0375730c864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgyMDA0OQ==", "url": "https://github.com/palantir/atlasdb/pull/4974#discussion_r484820049", "bodyText": "nit: one line, and extra newline", "author": "gmaretic", "createdAt": "2020-09-08T10:38:14Z", "path": "leader-election-impl/src/main/java/com/palantir/leader/health/LeaderElectionHealthCheck.java", "diffHunk": "@@ -16,19 +16,33 @@\n \n package com.palantir.leader.health;\n \n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n import com.palantir.leader.LeaderElectionServiceMetrics;\n+import com.palantir.paxos.Client;\n \n public class LeaderElectionHealthCheck {\n-    private static final double MAX_ALLOWED_LAST_5_MINUTE_RATE = 0.016;\n+    private static final double MAX_ALLOWED_LAST_5_MINUTE_RATE = 0.015;\n+    private final ConcurrentMap<Client, LeaderElectionServiceMetrics> clientWiseMetrics\n+            = new ConcurrentHashMap<>();", "originalCommit": "c37c6a2642babfe743b81eb84560e0375730c864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgyMDQ2Nw==", "url": "https://github.com/palantir/atlasdb/pull/4974#discussion_r484820467", "bodyText": "nit: one line", "author": "gmaretic", "createdAt": "2020-09-08T10:39:03Z", "path": "leader-election-impl/src/main/java/com/palantir/leader/health/LeaderElectionHealthCheck.java", "diffHunk": "@@ -16,19 +16,33 @@\n \n package com.palantir.leader.health;\n \n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n import com.palantir.leader.LeaderElectionServiceMetrics;\n+import com.palantir.paxos.Client;\n \n public class LeaderElectionHealthCheck {\n-    private static final double MAX_ALLOWED_LAST_5_MINUTE_RATE = 0.016;\n+    private static final double MAX_ALLOWED_LAST_5_MINUTE_RATE = 0.015;\n+    private final ConcurrentMap<Client, LeaderElectionServiceMetrics> clientWiseMetrics\n+            = new ConcurrentHashMap<>();\n+\n \n-    private final LeaderElectionServiceMetrics leaderElectionServiceMetrics;\n+    public void registerClient(Client namespace,", "originalCommit": "c37c6a2642babfe743b81eb84560e0375730c864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgzMDEzNg==", "url": "https://github.com/palantir/atlasdb/pull/4974#discussion_r484830136", "bodyText": "Add a test with multiple clients", "author": "gmaretic", "createdAt": "2020-09-08T10:57:44Z", "path": "leader-election-impl/src/test/java/com/palantir/leader/LeadershipElectionCheckTest.java", "diffHunk": "@@ -33,40 +33,41 @@\n import com.codahale.metrics.Meter;\n import com.palantir.leader.health.LeaderElectionHealthCheck;\n import com.palantir.leader.health.LeaderElectionHealthStatus;\n+import com.palantir.paxos.Client;\n import com.palantir.tritium.metrics.registry.TaggedMetricRegistry;\n \n public class LeadershipElectionCheckTest {\n     private final FakeTimeClock fakeTimeClock = new FakeTimeClock();\n     private final TaggedMetricRegistry registry = mock(TaggedMetricRegistry.class);\n     private final LeaderElectionServiceMetrics leaderElectionServiceMetrics =\n             LeaderElectionServiceMetrics.of(registry);\n-    private final LeaderElectionHealthCheck leaderElectionHealthCheck =\n-            new LeaderElectionHealthCheck(leaderElectionServiceMetrics);\n+    private final LeaderElectionHealthCheck leaderElectionHealthCheck = new LeaderElectionHealthCheck();\n+    private static final Client CLIENT = Client.of(\"abc\");", "originalCommit": "c37c6a2642babfe743b81eb84560e0375730c864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "08ebe2b8bfedd10386466e72d27de246275f697b", "url": "https://github.com/palantir/atlasdb/commit/08ebe2b8bfedd10386466e72d27de246275f697b", "message": "Address comments", "committedDate": "2020-09-09T11:26:27Z", "type": "commit"}, {"oid": "7d2ce3c8a7768852a673bee174785fe3da642d2c", "url": "https://github.com/palantir/atlasdb/commit/7d2ce3c8a7768852a673bee174785fe3da642d2c", "message": "Spotless", "committedDate": "2020-09-09T11:29:48Z", "type": "commit"}, {"oid": "4a67b579fe326bafa399e3dbdae725a0f00cc7b8", "url": "https://github.com/palantir/atlasdb/commit/4a67b579fe326bafa399e3dbdae725a0f00cc7b8", "message": "Checkstyle", "committedDate": "2020-09-09T11:36:18Z", "type": "commit"}]}