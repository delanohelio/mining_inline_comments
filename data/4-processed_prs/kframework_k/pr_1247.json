{"pr_number": 1247, "pr_title": "GLR Bison parser", "pr_createdAt": "2020-05-01T19:04:15Z", "pr_url": "https://github.com/kframework/k/pull/1247", "timeline": [{"oid": "1882076507159503e8942049a60fe9094edf6623", "url": "https://github.com/kframework/k/commit/1882076507159503e8942049a60fe9094edf6623", "message": "module to declare ambiugities that persist until runtime", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "9fa87cf13a57ef4c740e632acfe36e794cf6f50d", "url": "https://github.com/kframework/k/commit/9fa87cf13a57ef4c740e632acfe36e794cf6f50d", "message": "left associative list option", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "39b4d0e3fc0b376885f6e68ef8e7b55449bd0ff8", "url": "https://github.com/kframework/k/commit/39b4d0e3fc0b376885f6e68ef8e7b55449bd0ff8", "message": "improve bison and flex code quality to include locations and reentrant\nparsing", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "1987240529bca3c4c725c25e620fa6f13386e976", "url": "https://github.com/kframework/k/commit/1987240529bca3c4c725c25e620fa6f13386e976", "message": "glr parsing", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "178157f71a442ec646113597d883afa16d687e10", "url": "https://github.com/kframework/k/commit/178157f71a442ec646113597d883afa16d687e10", "message": "remove projections from grammar", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "1d267eb8a7f5b83b108bb9a8621d32df90115b28", "url": "https://github.com/kframework/k/commit/1d267eb8a7f5b83b108bb9a8621d32df90115b28", "message": "add test", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "ea71bfcd25c0a12edd1dacc0415d03492b112728", "url": "https://github.com/kframework/k/commit/ea71bfcd25c0a12edd1dacc0415d03492b112728", "message": "--gen-glr-bison-parser", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "112fb06b07fd59f80099c7bfe9319fa27c208e62", "url": "https://github.com/kframework/k/commit/112fb06b07fd59f80099c7bfe9319fa27c208e62", "message": "fix whitespace", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "d1038aa2b3dc086bd13a2d29f73457b7eb7004e1", "url": "https://github.com/kframework/k/commit/d1038aa2b3dc086bd13a2d29f73457b7eb7004e1", "message": "fix more whitespace", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "06107f918f0099f2f1102150ccaba15469fcae33", "url": "https://github.com/kframework/k/commit/06107f918f0099f2f1102150ccaba15469fcae33", "message": "fix compile error", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "92cb12a50f8fcebc285618bd403f4c8c38b0bbad", "url": "https://github.com/kframework/k/commit/92cb12a50f8fcebc285618bd403f4c8c38b0bbad", "message": "fix bug in RuleGrammarGenerator", "committedDate": "2020-05-04T17:52:52Z", "type": "commit"}, {"oid": "36d45351accd7b0beb77f57c0823a09a550f1a9e", "url": "https://github.com/kframework/k/commit/36d45351accd7b0beb77f57c0823a09a550f1a9e", "message": "try to fix build", "committedDate": "2020-05-04T18:00:20Z", "type": "commit"}, {"oid": "36d45351accd7b0beb77f57c0823a09a550f1a9e", "url": "https://github.com/kframework/k/commit/36d45351accd7b0beb77f57c0823a09a550f1a9e", "message": "try to fix build", "committedDate": "2020-05-04T18:00:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NDQwMw==", "url": "https://github.com/kframework/k/pull/1247#discussion_r419754403", "bodyText": "The for doesn't look very nice. What happened?", "author": "radumereuta", "createdAt": "2020-05-04T21:59:10Z", "path": "k-distribution/tests/regression-new/parse-c/c18-syntax.k", "diffHunk": "@@ -0,0 +1,340 @@\n+module C-LEXICAL-SORTS\n+  syntax Identifier\n+  syntax Constant ::= Char\n+  syntax StringLiteral\n+  syntax Char\n+endmodule\n+\n+module C-LEXICAL\n+  imports C-LEXICAL-SORTS\n+\n+  imports ID-SYNTAX\n+  imports FLOAT-SYNTAX\n+  imports STRING-SYNTAX\n+\n+  syntax Identifier ::= Id\n+  syntax Constant ::= IntConstant | Float\n+  syntax StringLiteral ::= String\n+\n+  syntax IntConstant ::= r\"(([1-9][0-9]*)|(0[0-7]*)|(0[xX][0-9a-fA-F]+))(([uU][lL]?)|([uU]((ll)|(LL)))|([lL][uU]?)|(((ll)|(LL))[uU]?))?\"\n+  syntax Char ::= r\"[LuU]?'(([^'\\\\n\\\\\\\\])|(\\\\\\\\['\\\\\\\"?\\\\\\\\abfnrtv])|(\\\\\\\\[0-7]{3})|(\\\\\\\\x[0-9a-fA-F]+)|(\\\\\\\\u[0-9a-fA-F]{4})|(\\\\\\\\U[0-9a-fA-F]{8}))+'\" [token]\n+\n+endmodule\n+\n+module C18-COMMON\n+  imports C-LEXICAL-SORTS\n+\n+  // \\section(A.2.1)\n+\n+  syntax Exp ::= Identifier\n+               | Constant\n+               | StringLiteral\n+               | \"(\" Exp \")\" [bracket]\n+               | \"_Generic\" \"(\" Exp \",\" GenericAssocs \")\"\n+               > Exp \"[\" Exp \"]\"\n+               | Exp \"(\" Exps \")\"\n+               | Exp \"(\" \")\"\n+               | Exp \".\" Identifier\n+               | Exp \"->\" Identifier\n+               | Exp \"++\"\n+               | Exp \"--\"\n+               | \"(\" TypeName \")\" \"{\" Inits \"}\"\n+               | \"(\" TypeName \")\" \"{\" Inits \",\" \"}\"\n+               > \"++\" Exp\n+               | \"--\" Exp\n+               | \"&\" Exp\n+               | \"*\" Exp\n+               | \"+\" Exp\n+               | \"-\" Exp\n+               | \"~\" Exp\n+               | \"!\" Exp\n+               | \"sizeof\" Exp\n+               | \"sizeof\" \"(\" TypeName \")\"\n+               | \"_Alignof\" \"(\" TypeName \")\"\n+               > \"(\" TypeName \")\" Exp\n+               > left:\n+                 Exp \"*\" Exp\n+               | Exp \"/\" Exp\n+               | Exp \"%\" Exp\n+               > left:\n+                 Exp \"+\" Exp\n+               | Exp \"-\" Exp\n+               > left:\n+                 Exp \"<<\" Exp\n+               | Exp \">>\" Exp\n+               > left:\n+                 Exp \"<\" Exp\n+               | Exp \">\" Exp\n+               | Exp \"<=\" Exp\n+               | Exp \">=\" Exp\n+               > left:\n+                 Exp \"==\" Exp\n+               | Exp \"==\" Exp\n+               > left:\n+                 Exp \"&\" Exp\n+               > left:\n+                 Exp \"^\" Exp\n+               > left:\n+                 Exp \"|\" Exp\n+               > left:\n+                 Exp \"&&\" Exp\n+               > left:\n+                 Exp \"||\" Exp\n+               > right:\n+                 Exp \"?\" Exp \":\" Exp\n+               > right:\n+                 Exp \"=\" Exp [assign]\n+               | Exp \"*=\" Exp [assign]\n+               | Exp \"/=\" Exp [assign]\n+               | Exp \"%=\" Exp [assign]\n+               | Exp \"+=\" Exp [assign]\n+               | Exp \"-=\" Exp [assign]\n+               | Exp \"<<=\" Exp [assign]\n+               | Exp \">>=\" Exp [assign]\n+               | Exp \"&=\" Exp [assign]\n+               | Exp \"^=\" Exp [assign]\n+               | Exp \"|=\" Exp [assign]\n+               > left:\n+                 Exp \",\" Exp [comma]\n+  syntax priorities assignExp > comma\n+  syntax priorities constantExp > assign\n+\n+  syntax GenericAssocs ::= NeList{GenericAssoc,\",\"}\n+\n+  syntax GenericAssoc ::= TypeName \":\" Exp  [assignExp]\n+                              | \"default\" \":\" Exp [assignExp]\n+\n+  syntax Exps ::= Exp [klabel(arg), assignExp]\n+                | Exps \",\" Exp [assignExp]\n+\n+  // \\section(A.2.2)\n+\n+  syntax Decl ::= DeclSpecifiers InitDecls \";\"\n+                | DeclSpecifiers \";\"\n+                | StaticAssertDecl\n+\n+  syntax DeclSpecifiers ::= NeList{DeclSpecifier,\"\"}\n+\n+  syntax DeclSpecifier ::= StorageClassSpecifier\n+                         | TypeSpecifier\n+                         | TypeQualifier\n+                         | FunctionSpecifier\n+                         | AlignmentSpecifier\n+\n+  syntax InitDecls ::= NeList{InitDecl,\",\"}\n+\n+  syntax InitDecl ::= Declarator\n+                    | Declarator \"=\" Init\n+\n+  syntax StorageClassSpecifier ::= \"typedef\"\n+                                 | \"extern\"\n+                                 | \"static\"\n+                                 | \"_Thread_local\"\n+                                 | \"auto\"\n+                                 | \"register\"\n+\n+  syntax TypeSpecifier ::= \"void\"\n+                         | \"char\"\n+                         | \"short\"\n+                         | \"int\"\n+                         | \"long\"\n+                         | \"float\"\n+                         | \"double\"\n+                         | \"signed\"\n+                         | \"unsigned\"\n+                         | \"_Bool\"\n+                         | \"_Complex\"\n+                         | AtomicTypeSpecifier\n+                         | \"struct\" Identifier \"{\" StructDecls \"}\"\n+                         | \"struct\" \"{\" StructDecls \"}\"\n+                         | \"struct\" Identifier\n+                         | \"union\" Identifier \"{\" StructDecls \"}\"\n+                         | \"union\" \"{\" StructDecls \"}\"\n+                         | \"union\" Identifier\n+                         | \"enum\" Identifier \"{\" Enumerators \"}\"\n+                         | \"enum\" \"{\" Enumerators \"}\"\n+                         | \"enum\" Identifier \"{\" Enumerators \",\" \"}\"\n+                         | \"enum\" \"{\" Enumerators \",\" \"}\"\n+                         | \"enum\" Identifier\n+                         | Identifier\n+\n+  syntax AtomicTypeSpecifier ::= \"_Atomic\" \"(\" TypeName \")\"\n+\n+  syntax StructDecls ::= NeList{StructDecl,\"\"}\n+\n+  syntax StructDecl ::= SpecifierQuals StructDeclarators \";\"\n+                      | SpecifierQuals \";\"\n+                      | StaticAssertDecl\n+\n+  syntax SpecifierQuals ::= NeList{SpecifierQual,\"\"}\n+\n+  syntax SpecifierQual ::= TypeSpecifier\n+                         | TypeQualifier\n+\n+  syntax StructDeclarators ::= NeList{StructDeclarator,\",\"}\n+\n+  syntax StructDeclarator ::= Declarator\n+                            | Declarator \":\" Exp [constantExp]\n+                            | \":\" Exp [constantExp]\n+\n+  syntax Enumerators ::= NeList{Enumerator,\",\"}\n+\n+  syntax Enumerator ::= Identifier\n+                      | Identifier \"=\" Exp [constantExp]\n+\n+  syntax TypeQualifier ::= \"const\" | \"restrict\" | \"volatile\" | \"_Atomic\"\n+  syntax FunctionSpecifier ::= \"inline\" | \"_Noreturn\"\n+  syntax AlignmentSpecifier ::= \"_Alignas\" \"(\" TypeName \")\"\n+                              | \"_Alignas\" \"(\" Exp \")\"\n+\n+  syntax Declarator ::= Pointer DirectDeclarator\n+                      | DirectDeclarator\n+\n+  syntax DirectDeclarator ::= Identifier\n+                            | \"(\" Declarator \")\" [bracket]\n+                            | DirectDeclarator \"[\" TypeQualifiers Exp \"]\"\n+                            | DirectDeclarator \"[\" TypeQualifiers \"]\"\n+                            | DirectDeclarator \"[\" Exp \"]\"\n+                            | DirectDeclarator \"[\" \"]\"\n+                            | DirectDeclarator \"[\" \"static\" TypeQualifiers Exp \"]\"\n+                            | DirectDeclarator \"[\" \"static\" Exp \"]\"\n+                            | DirectDeclarator \"[\" TypeQualifiers \"static\" Exp \"]\"\n+                            | DirectDeclarator \"[\" TypeQualifiers \"*\" \"]\"\n+                            | DirectDeclarator \"[\" \"*\" \"]\"\n+                            | DirectDeclarator \"(\" ParamTypeList \")\"\n+                            | DirectDeclarator \"(\" Identifiers \")\"\n+                            | DirectDeclarator \"(\" \")\"\n+\n+  syntax FunctionDeclarator ::= Pointer FunctionDirectDeclarator\n+                              | FunctionDirectDeclarator\n+\n+  syntax FunctionDirectDeclarator ::= \"(\" FunctionDeclarator \")\"\n+                                    | DirectDeclarator \"(\" ParamTypeList \")\"\n+                                    | DirectDeclarator \"(\" Identifiers \")\"\n+                                    | DirectDeclarator \"(\" \")\"\n+\n+  syntax Pointer ::= \"*\"\n+                   | \"*\" TypeQualifiers\n+                   | \"*\" Pointer\n+                   | \"*\" TypeQualifiers Pointer\n+\n+  syntax TypeQualifiers ::= NeList{TypeQualifier,\"\"}\n+\n+  syntax ParamTypeList ::= Params\n+                         | Params \",\" \"...\"\n+\n+  syntax Params ::= NeList{ParamDecl,\",\"}\n+\n+  syntax ParamDecl ::= DeclSpecifiers Declarator\n+                     | DeclSpecifiers\n+                     | DeclSpecifiers AbstractDeclarator\n+\n+  syntax Identifiers ::= NeList{Identifier,\",\"}\n+\n+  syntax TypeName ::= SpecifierQuals\n+                    | SpecifierQuals AbstractDeclarator\n+\n+  syntax AbstractDeclarator ::= Pointer\n+                              | DirectAbstractDeclarator\n+                              | Pointer DirectAbstractDeclarator\n+\n+  syntax DirectAbstractDeclarator ::= \"(\" AbstractDeclarator \")\" [bracket]\n+                                    | \"[\" \"]\"\n+                                    | \"[\" TypeQualifiers \"]\"\n+                                    | \"[\" TypeQualifiers Exp \"]\"\n+                                    | DirectAbstractDeclarator \"[\" Exp \"]\"\n+                                    | \"[\" \"static\" Exp \"]\"\n+                                    | \"[\" \"static\" TypeQualifiers Exp \"]\"\n+                                    | DirectAbstractDeclarator \"[\" \"static\" Exp \"]\"\n+                                    | DirectAbstractDeclarator \"[\" \"static\" TypeQualifiers Exp \"]\"\n+                                    | DirectAbstractDeclarator \"[\" TypeQualifiers \"static\" Exp \"]\"\n+                                    | \"[\" TypeQualifiers \"static\" Exp \"]\"\n+                                    | \"[\" \"*\" \"]\"\n+                                    | DirectAbstractDeclarator \"[\" \"*\" \"]\"\n+                                    | \"(\" \")\"\n+                                    | \"(\" ParamTypeList \")\"\n+                                    | DirectAbstractDeclarator \"(\" \")\"\n+                                    | DirectAbstractDeclarator \"(\" ParamTypeList \")\"\n+\n+  syntax Init ::= Exp [klabel(initExp), assignExp]\n+                | \"{\" Inits \"}\"\n+                | \"{\" Inits \",\" \"}\"\n+\n+  syntax Inits ::= NeList{InitDesignation,\",\"}\n+\n+  syntax InitDesignation ::= Init | Designators \"=\" Init\n+\n+  syntax Designators ::= NeList{Designator,\"\"}\n+\n+  syntax Designator ::= \"[\" Exp \"]\"\n+                      | \".\" Identifier\n+\n+  syntax StaticAssertDecl ::= \"_Static_assert\" \"(\" Exp \",\" StringLiteral \")\" \";\"\n+\n+  // \\section(A.2.3)\n+\n+  syntax Stmt ::= Identifier \":\" Stmt\n+                | \"case\" Exp \":\" Stmt\n+                | \"default\" \":\" Stmt\n+                | CompoundStmt\n+                | \";\"\n+                | Exp \";\"\n+                | \"if\" \"(\" Exp \")\" Stmt\n+                | \"if\" \"(\" Exp \")\" Stmt \"else\" Stmt [avoid]\n+                | \"switch\" \"(\" Exp \")\" Stmt\n+                | \"while\" \"(\" Exp \")\" Stmt\n+                | \"do\" Stmt \"while\" \"(\" Exp \")\" \";\"\n+                | \"for\" \"(\"     \";\"     \";\"     \")\" Stmt\n+                | \"for\" \"(\"     \";\" Exp \";\"     \")\" Stmt\n+                | \"for\" \"(\"     \";\" Exp \";\" Exp \")\" Stmt\n+                | \"for\" \"(\"     \";\"     \";\" Exp \")\" Stmt\n+                | \"for\" \"(\" Exp \";\"     \";\"     \")\" Stmt\n+                | \"for\" \"(\" Exp \";\" Exp \";\"     \")\" Stmt\n+                | \"for\" \"(\" Exp \";\" Exp \";\" Exp \")\" Stmt\n+                | \"for\" \"(\" Exp \";\"     \";\" Exp \")\" Stmt\n+                | \"for\" \"(\" Decl     \";\"     \")\" Stmt\n+                | \"for\" \"(\" Decl Exp \";\"     \")\" Stmt\n+                | \"for\" \"(\" Decl Exp \";\" Exp \")\" Stmt\n+                | \"for\" \"(\" Decl     \";\" Exp \")\" Stmt", "originalCommit": "36d45351accd7b0beb77f57c0823a09a550f1a9e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5NTgzMQ==", "url": "https://github.com/kframework/k/pull/1247#discussion_r419795831", "bodyText": "Combinatory explosion. The reference grammar has three optional norterminals, so we generate 2^3=8 productions. The alternative would be to introduce a new nonterminal that has an empty production, but bison dislikes this immensely and you end up with a parser that splits a lot more often.", "author": "dwightguth", "createdAt": "2020-05-04T23:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NDQwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NTgwMQ==", "url": "https://github.com/kframework/k/pull/1247#discussion_r419755801", "bodyText": "Why the extra space? :)", "author": "radumereuta", "createdAt": "2020-05-04T22:02:28Z", "path": "kernel/src/main/java/org/kframework/parser/inner/kernel/Scanner.java", "diffHunk": "@@ -201,8 +207,8 @@ private void writeAction(StringBuilder flex, TerminalLike key) {\n     private void writeStandaloneAction(StringBuilder flex, TerminalLike key) {\n         flex.append(\" {\\n\" +\n             \"  int kind = \").append(tokens.get(key)._1()+1).append(\";\\n\" +\n-            \"  *((char **)&yylval) = malloc(strlen(yytext) + 1);\\n\" +\n-            \"  strcpy(*((char **)&yylval), yytext);\\n\" +\n+            \"  *((char **)yylval  ) = malloc(strlen(yytext) + 1);\\n\" +", "originalCommit": "36d45351accd7b0beb77f57c0823a09a550f1a9e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "162c21f2532abfa9dd3d4f6ca9e8a2b20088cebf", "url": "https://github.com/kframework/k/commit/162c21f2532abfa9dd3d4f6ca9e8a2b20088cebf", "message": "strip whitespace", "committedDate": "2020-05-05T14:42:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3MDk5NA==", "url": "https://github.com/kframework/k/pull/1247#discussion_r420170994", "bodyText": "We should emit a parser for each $ variable that shows up in the configuration, not just $PGM.", "author": "ehildenb", "createdAt": "2020-05-05T14:51:18Z", "path": "kernel/src/main/java/org/kframework/kompile/KompileOptions.java", "diffHunk": "@@ -135,6 +137,9 @@ public boolean isKore() {\n         @Parameter(names=\"--gen-bison-parser\", description=\"Emit bison parser for the PGM configuration variable within the syntax module of your definition into the kompiled definition.\")\n         public boolean genBisonParser;\n \n+        @Parameter(names=\"--gen-glr-bison-parser\", description=\"Emit GLR bison parser for the PGM configuration variable within the syntax module of your definition into the kompiled definition.\")\n+        public boolean genGlrBisonParser;", "originalCommit": "162c21f2532abfa9dd3d4f6ca9e8a2b20088cebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3MTU1OA==", "url": "https://github.com/kframework/k/pull/1247#discussion_r420171558", "bodyText": "Should this be left instead?", "author": "ehildenb", "createdAt": "2020-05-05T14:52:00Z", "path": "kernel/src/main/java/org/kframework/kore/convertors/KILtoKORE.java", "diffHunk": "@@ -300,9 +303,15 @@ public void applyUserList(Set<org.kframework.definition.Sentence> res,\n         org.kframework.definition.Production prod1, prod3;\n \n         // Es ::= E \",\" Es\n-        prod1 = Production(KLabel(p.getKLabel(kore), immutable(p.getParams())), sort,\n-                Seq(NonTerminal(elementSort), Terminal(userList.getSeparator()), NonTerminal(sort)),\n-                attrs.add(\"right\"));\n+        if (bisonLists) {\n+          prod1 = Production(KLabel(p.getKLabel(kore), immutable(p.getParams())), sort,\n+                  Seq(NonTerminal(sort), Terminal(userList.getSeparator()), NonTerminal(elementSort)),\n+                  attrs.add(\"right\"));", "originalCommit": "162c21f2532abfa9dd3d4f6ca9e8a2b20088cebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c36e119a1ca8c44536dc4d279bd0fbd4cae14f8e", "url": "https://github.com/kframework/k/commit/c36e119a1ca8c44536dc4d279bd0fbd4cae14f8e", "message": "fix associativity of list production with --bison-lists", "committedDate": "2020-05-05T15:33:16Z", "type": "commit"}, {"oid": "a8128f003a7fda511ac9e8dc9715f79d5458c257", "url": "https://github.com/kframework/k/commit/a8128f003a7fda511ac9e8dc9715f79d5458c257", "message": "Merge branch 'master' into glr", "committedDate": "2020-05-05T16:51:12Z", "type": "commit"}]}