{"pr_number": 1272, "pr_title": "Reorganize K distribution to remove dependence on /usr/lib/kframework sysroot [brew-staging: reorg]", "pr_createdAt": "2020-05-08T17:52:00Z", "pr_url": "https://github.com/kframework/k/pull/1272", "timeline": [{"oid": "4688e6980a1301c74bfa50b05bf5a2069b76af0d", "url": "https://github.com/kframework/k/commit/4688e6980a1301c74bfa50b05bf5a2069b76af0d", "message": "tmp: use branch of k-exercises", "committedDate": "2020-05-12T13:13:48Z", "type": "forcePushed"}, {"oid": "cc94130128146a41fc785bc711fe4818847ccbed", "url": "https://github.com/kframework/k/commit/cc94130128146a41fc785bc711fe4818847ccbed", "message": "more paths", "committedDate": "2020-05-12T14:59:17Z", "type": "forcePushed"}, {"oid": "74b4eaaa122206ab9ee29d23f40cf4575738c13c", "url": "https://github.com/kframework/k/commit/74b4eaaa122206ab9ee29d23f40cf4575738c13c", "message": "tmp: build more stuff", "committedDate": "2020-05-13T16:10:11Z", "type": "forcePushed"}, {"oid": "0d33c27e7b7602d37fbf47334be4b01676f7b2e3", "url": "https://github.com/kframework/k/commit/0d33c27e7b7602d37fbf47334be4b01676f7b2e3", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-13T18:00:15Z", "type": "forcePushed"}, {"oid": "68fac78fb3a4536fba76c2f7d6f35185eaf76f90", "url": "https://github.com/kframework/k/commit/68fac78fb3a4536fba76c2f7d6f35185eaf76f90", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-14T15:45:27Z", "type": "forcePushed"}, {"oid": "1e303a4bb557d4f67aecdb28f6750ec3e9c0d1fe", "url": "https://github.com/kframework/k/commit/1e303a4bb557d4f67aecdb28f6750ec3e9c0d1fe", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-14T22:41:05Z", "type": "forcePushed"}, {"oid": "29cafaf36623c2160084c03c7535a2f7246e1b43", "url": "https://github.com/kframework/k/commit/29cafaf36623c2160084c03c7535a2f7246e1b43", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-15T16:01:07Z", "type": "forcePushed"}, {"oid": "e3e96f2e6454ce9336de0cb52830db4daa361158", "url": "https://github.com/kframework/k/commit/e3e96f2e6454ce9336de0cb52830db4daa361158", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-15T16:31:34Z", "type": "forcePushed"}, {"oid": "9e8687f9d2553ae884f9b4fcb1402b5ebe988743", "url": "https://github.com/kframework/k/commit/9e8687f9d2553ae884f9b4fcb1402b5ebe988743", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-15T16:49:33Z", "type": "forcePushed"}, {"oid": "a966c9595dfcaa853b0739c61a17934d3282d54a", "url": "https://github.com/kframework/k/commit/a966c9595dfcaa853b0739c61a17934d3282d54a", "message": "tmp: run Mac OS build [brew-staging: reorg]", "committedDate": "2020-05-15T18:34:09Z", "type": "forcePushed"}, {"oid": "ab2dc97fbc4b443bfa129c761ef549b2e3efef82", "url": "https://github.com/kframework/k/commit/ab2dc97fbc4b443bfa129c761ef549b2e3efef82", "message": "remove windows specific stuff", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "55b283ea4f30a1ca3af00dca09e424dd975f31cd", "url": "https://github.com/kframework/k/commit/55b283ea4f30a1ca3af00dca09e424dd975f31cd", "message": "rearrange directory structure", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "14eafd19ba934ff0ac8747fd4432b2d2c531e2ec", "url": "https://github.com/kframework/k/commit/14eafd19ba934ff0ac8747fd4432b2d2c531e2ec", "message": "refactor access to include directory", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "409b2c25b21e0bef351861f74bc0ae58945c9fc0", "url": "https://github.com/kframework/k/commit/409b2c25b21e0bef351861f74bc0ae58945c9fc0", "message": "rename script", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "fc07a6250de2c861aff089c263a618d738a7359b", "url": "https://github.com/kframework/k/commit/fc07a6250de2c861aff089c263a618d738a7359b", "message": "clean up packaging", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "1d8a6df50d6c40f5d3d41571e278afb63d1746da", "url": "https://github.com/kframework/k/commit/1d8a6df50d6c40f5d3d41571e278afb63d1746da", "message": "clean up packaging", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "23d135f696dca4d18a5a875df559433c8d58ef23", "url": "https://github.com/kframework/k/commit/23d135f696dca4d18a5a875df559433c8d58ef23", "message": "move include dir", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "776561db82b5c665a0aa7e46b9d9cc8c8e2d52fb", "url": "https://github.com/kframework/k/commit/776561db82b5c665a0aa7e46b9d9cc8c8e2d52fb", "message": "rename code references to include dir", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "99fa722a692d26db0387c9a32479038ad26d571c", "url": "https://github.com/kframework/k/commit/99fa722a692d26db0387c9a32479038ad26d571c", "message": "rename some other directory references", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "cba14e51be1db7da7511f2826b1046658e525711", "url": "https://github.com/kframework/k/commit/cba14e51be1db7da7511f2826b1046658e525711", "message": "add another case to find-k.mak", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "3228c4a5d5568502960d018aa9cf4fed1495c5db", "url": "https://github.com/kframework/k/commit/3228c4a5d5568502960d018aa9cf4fed1495c5db", "message": "rename references to include dir in make files", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "e369aa8611eb9158f48d522625e5c2d7f0be5e3e", "url": "https://github.com/kframework/k/commit/e369aa8611eb9158f48d522625e5c2d7f0be5e3e", "message": "fix some more paths", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "7dc8daf520536d7b9b9d2f260652026e18ca59e8", "url": "https://github.com/kframework/k/commit/7dc8daf520536d7b9b9d2f260652026e18ca59e8", "message": "fix merge conflict", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "2a96f6eb66b6bb3bf0c885018997104a55c22b52", "url": "https://github.com/kframework/k/commit/2a96f6eb66b6bb3bf0c885018997104a55c22b52", "message": "fix merge conflict", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "bf5ef960cd6fe8eb230146b9edbb4ba78623a663", "url": "https://github.com/kframework/k/commit/bf5ef960cd6fe8eb230146b9edbb4ba78623a663", "message": "fix another merge conflict", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "92b08a4e570b0f43a3e0bceb379d732a5cd6ab27", "url": "https://github.com/kframework/k/commit/92b08a4e570b0f43a3e0bceb379d732a5cd6ab27", "message": "fix some more bad paths", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "6ef22087dfcf11c2d0b9fd0b667fff32c5cd623c", "url": "https://github.com/kframework/k/commit/6ef22087dfcf11c2d0b9fd0b667fff32c5cd623c", "message": "more paths", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "3e38e1f96024fc91849aea4524dd607090cc1a28", "url": "https://github.com/kframework/k/commit/3e38e1f96024fc91849aea4524dd607090cc1a28", "message": "use current commit rather than current master for brew staging", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "ba5bdf79b15c62d127825ae4b0bb7d26280bb122", "url": "https://github.com/kframework/k/commit/ba5bdf79b15c62d127825ae4b0bb7d26280bb122", "message": "update opam version", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "ae64b3195746a18ed00b9f0b85041d627bc38f9a", "url": "https://github.com/kframework/k/commit/ae64b3195746a18ed00b9f0b85041d627bc38f9a", "message": "update mlgmp patchfile", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "61a7a81404afc160eb0bd18392f606cddcb63f0e", "url": "https://github.com/kframework/k/commit/61a7a81404afc160eb0bd18392f606cddcb63f0e", "message": "don't load Realdef twice", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "c98a6a9592bb1b05edce31036eaadb55637ea28f", "url": "https://github.com/kframework/k/commit/c98a6a9592bb1b05edce31036eaadb55637ea28f", "message": "tmp: update submodule", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "url": "https://github.com/kframework/k/commit/13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "message": "tmp: use branch of k-exercises", "committedDate": "2020-05-15T21:27:24Z", "type": "commit"}, {"oid": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "url": "https://github.com/kframework/k/commit/13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "message": "tmp: use branch of k-exercises", "committedDate": "2020-05-15T21:27:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU0OTY1Mw==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426549653", "bodyText": "Make sure this gets changed back before merge.", "author": "ehildenb", "createdAt": "2020-05-18T11:13:29Z", "path": "Jenkinsfile", "diffHunk": "@@ -50,7 +50,7 @@ pipeline {\n                     }\n                   }\n                   stages {\n-                    stage('Checkout code') { steps { dir('k-exercises') { git url: 'git@github.com:kframework/k-exercises.git' } } }\n+                    stage('Checkout code') { steps { dir('k-exercises') { git url: 'git@github.com:kframework/k-exercises.git', branch: 'reorg' } } }", "originalCommit": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU0OTk5Mw==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426549993", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                dir('kframework') {\n          \n          \n            \n                                  checkout scm\n          \n          \n            \n                                }\n          \n          \n            \n                                dir('kframework') { checkout scm }\n          \n      \n    \n    \n  \n\nSticking to the formatting where we use less lines has made the Jenkinsfile more readable on many projects.", "author": "ehildenb", "createdAt": "2020-05-18T11:14:10Z", "path": "Jenkinsfile", "diffHunk": "@@ -318,15 +318,16 @@ pipeline {\n                   agent { label 'anka' }\n                   steps {\n                     unstash 'src'\n+                    dir('kframework') {\n+                      checkout scm\n+                    }", "originalCommit": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MDkwNw==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426550907", "bodyText": "What is this file used for? Searching for kframework/kore in this state-delta doesn't reveal anything where it's using this file for something AFAICT.", "author": "ehildenb", "createdAt": "2020-05-18T11:16:04Z", "path": "k-distribution/include/kframework/kore", "diffHunk": "@@ -0,0 +1 @@\n+../../../haskell-backend/src/main/native/haskell-backend/src/main/kore/", "originalCommit": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYyMjE2NQ==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426622165", "bodyText": "This is a symlink to where the kore prelude is declared which is used in source builds.", "author": "dwightguth", "createdAt": "2020-05-18T13:23:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MDkwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MTU3Mw==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426551573", "bodyText": "Spacing of these lines looks weird.", "author": "ehildenb", "createdAt": "2020-05-18T11:17:23Z", "path": "k-distribution/src/main/scripts/bin/k-configure-opam-common", "diffHunk": "@@ -1,18 +1,19 @@\n add_repo() {\n-  opam repository add k \"$(dirname \"$0\")/../lib/opam\" \\\n-   || opam repository set-url k \"$(dirname \"$0\")/../lib/opam\"\n+  opam repository add k \"$(dirname \"$0\")/../lib/kframework/opam\" \\\n+   || opam repository set-url k \"$(dirname \"$0\")/../lib/kframework/opam\"\n   opam update\n }\n \n-OCAML_VERSION=\"4.06.1+k$1\"\n case \"$(opam --version)\" in\n 1.*)\n+        OCAML_VERSION=\"4.06.1+k$1\"\n \techo Detected Opam version 1\n \topam init $INIT_ARGS\n \tadd_repo\n \topam switch \"$OCAML_VERSION\"\n \t;;\n 2.*)\n+        OCAML_VERSION=\"4.10.0$1\"", "originalCommit": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU3ODI5NA==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426578294", "bodyText": "Mixing spaces with tabs, it seems... Should we pick one of the two (at least, one per language) and convert all sources?", "author": "virgil-serbanuta", "createdAt": "2020-05-18T12:09:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MTU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY0MjQ5MA==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426642490", "bodyText": "No need to convert all sources, we can just make sure we don't introduce new errors and fix ones we find along the way.", "author": "ehildenb", "createdAt": "2020-05-18T13:53:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MTU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MzUwOQ==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426553509", "bodyText": "Why do we need to check so many places? I thought that this was to make the installation point standard across all distributions? Is the /usr/include/kframework vs /usr/local/include/kframework a difference between Linux/MacOS.\nI guess the point is more to make it so that we're not doing everything under /usr/lib/kframework/..., but instead directly inside /usr/... (on Linux) or /usr/local/... (on MacOS)?", "author": "ehildenb", "createdAt": "2020-05-18T11:21:17Z", "path": "k-distribution/tutorial/find-k.mak", "diffHunk": "@@ -1,10 +1,12 @@\n MAKEFILE_PATH := $(dir $(abspath $(lastword $(MAKEFILE_LIST))))\n-ifneq (,$(wildcard ${MAKEFILE_PATH}/../include/ktest.mak))\n+ifneq (,$(wildcard ${MAKEFILE_PATH}/../../../include/kframework/ktest.mak))\n+export K_HOME?=${MAKEFILE_PATH}/../../../\n+else ifneq (,$(wildcard ${MAKEFILE_PATH}/../include/kframework/ktest.mak))\n export K_HOME?=${MAKEFILE_PATH}/..\n-else ifneq (,$(wildcard /usr/lib/kframework/include/ktest.mak))\n-export K_HOME?=/usr/lib/kframework\n-else ifneq (,$(wildcard /usr/local/lib/kframework/include/ktest.mak))\n-export K_HOME?=/usr/local/lib/kframework\n+else ifneq (,$(wildcard /usr/include/kframework/ktest.mak))\n+export K_HOME?=/usr\n+else ifneq (,$(wildcard /usr/local/include/kframework/ktest.mak))\n+export K_HOME?=/usr/local", "originalCommit": "13bad6d2b308fe67c5330b362fa4ff25ecfc127d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc3NTI0OQ==", "url": "https://github.com/kframework/k/pull/1272#discussion_r426775249", "bodyText": "These are the cases for if the tutorial is run from its github sources, its maven target directory, or from a debian package, or from mac os.", "author": "dwightguth", "createdAt": "2020-05-18T17:10:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1MzUwOQ=="}], "type": "inlineReview"}, {"oid": "7f8ff44618c4faa7d0166e78e3be597652ca18da", "url": "https://github.com/kframework/k/commit/7f8ff44618c4faa7d0166e78e3be597652ca18da", "message": "Update Jenkinsfile\n\nCo-authored-by: Everett Hildenbrandt <everett.hildenbrandt@gmail.com>", "committedDate": "2020-05-18T13:22:07Z", "type": "commit"}, {"oid": "e4e7e04a0e467dc11b9de9eba43cc953dd988b86", "url": "https://github.com/kframework/k/commit/e4e7e04a0e467dc11b9de9eba43cc953dd988b86", "message": "fix whitespace", "committedDate": "2020-05-18T17:20:15Z", "type": "commit"}, {"oid": "36447f47c84d74e600bd9582ad9ab0eec39a0676", "url": "https://github.com/kframework/k/commit/36447f47c84d74e600bd9582ad9ab0eec39a0676", "message": "remove some more references to windows", "committedDate": "2020-05-18T17:20:15Z", "type": "commit"}, {"oid": "58ae0a76570e0eaba59dc052d8f8b7e929e42db5", "url": "https://github.com/kframework/k/commit/58ae0a76570e0eaba59dc052d8f8b7e929e42db5", "message": "Merge branch 'master' into reorg", "committedDate": "2020-05-18T17:22:20Z", "type": "commit"}, {"oid": "d8b236031134dc0b1b9b0a552de420ee843bccd3", "url": "https://github.com/kframework/k/commit/d8b236031134dc0b1b9b0a552de420ee843bccd3", "message": "update llvm backend submodule", "committedDate": "2020-05-20T14:14:36Z", "type": "commit"}, {"oid": "3c18751540f2bf28b45da73d470df4c9f8a318e0", "url": "https://github.com/kframework/k/commit/3c18751540f2bf28b45da73d470df4c9f8a318e0", "message": "Revert \"tmp: use branch of k-exercises\"\n\nThis reverts commit 13bad6d2b308fe67c5330b362fa4ff25ecfc127d.", "committedDate": "2020-05-20T14:14:36Z", "type": "commit"}, {"oid": "bae89173d05a093a7ac3c1b66ba9a2f578d3312c", "url": "https://github.com/kframework/k/commit/bae89173d05a093a7ac3c1b66ba9a2f578d3312c", "message": "Merge branch 'master' into reorg", "committedDate": "2020-05-20T14:14:39Z", "type": "commit"}, {"oid": "1c45291324d1041cffc5407cc675f3998f6b24bc", "url": "https://github.com/kframework/k/commit/1c45291324d1041cffc5407cc675f3998f6b24bc", "message": "update llvm backend submodule", "committedDate": "2020-05-20T16:21:14Z", "type": "commit"}]}