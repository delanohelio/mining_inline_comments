{"pr_number": 4401, "pr_title": "Use swipe to refresh", "pr_createdAt": "2020-09-03T11:56:21Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4401", "timeline": [{"oid": "aabada4957c3be0dfdf2163042d12cb9cda3243f", "url": "https://github.com/AntennaPod/AntennaPod/commit/aabada4957c3be0dfdf2163042d12cb9cda3243f", "message": "add swipe to refresh to subscriptions", "committedDate": "2020-09-03T11:52:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MTk5Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498491992", "bodyText": "I think this would be easier with new Handler().postDelayed(() -> ..., 800)", "author": "ByteHamster", "createdAt": "2020-10-01T20:20:16Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -102,6 +104,20 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container,\n \n         feedsFilteredMsg = root.findViewById(R.id.feeds_filtered_message);\n         feedsFilteredMsg.setOnClickListener((l) -> FeedFilterDialog.showDialog(requireContext()));\n+\n+        SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swiperefresh);\n+        swipeRefreshLayout.setOnRefreshListener(() -> {\n+            AutoUpdateManager.runImmediate(requireContext());\n+            new Thread(() -> {\n+                try {\n+                    Thread.sleep(800);\n+                } catch (Exception ignore) {\n+                }\n+                getActivity().runOnUiThread(() -> {\n+                    swipeRefreshLayout.setRefreshing(false);\n+                });", "originalCommit": "aabada4957c3be0dfdf2163042d12cb9cda3243f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "53fcdfabc183f5c3d7c8b01b2bdb8e0ddfb2eb90", "url": "https://github.com/AntennaPod/AntennaPod/commit/53fcdfabc183f5c3d7c8b01b2bdb8e0ddfb2eb90", "message": "use postDelayed", "committedDate": "2020-10-02T15:00:14Z", "type": "commit"}, {"oid": "70b92a08cfe32a5d1250535ade2e7cc09811bae4", "url": "https://github.com/AntennaPod/AntennaPod/commit/70b92a08cfe32a5d1250535ade2e7cc09811bae4", "message": "add swipeToRefresh to EpisodesListFragment and FeedItemlistFragment", "committedDate": "2020-10-02T15:13:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg4OTExOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498889119", "bodyText": "I think you don't need getActivity().runOnUiThread. Handlers that are created on the UI thread run their runnable on the UI thread, too.", "author": "ByteHamster", "createdAt": "2020-10-02T15:21:39Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java", "diffHunk": "@@ -214,6 +217,14 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n             ((SimpleItemAnimator) animator).setSupportsChangeAnimations(false);\n         }\n \n+        SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n+        swipeRefreshLayout.setOnRefreshListener(() -> {\n+            AutoUpdateManager.runImmediate(requireContext());\n+            new Handler().postDelayed(() ->\n+                            getActivity().runOnUiThread(() -> swipeRefreshLayout.setRefreshing(false))", "originalCommit": "70b92a08cfe32a5d1250535ade2e7cc09811bae4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5MDQ0MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498890441", "bodyText": "I have not tried it yet but I think this padding should be applied to the recyclerView, not the swipe layout. Otherwise, the scroll bar on big tablets will not be on the edge of the screen.", "author": "ByteHamster", "createdAt": "2020-10-02T15:23:55Z", "path": "app/src/main/res/layout/feed_item_list_fragment.xml", "diffHunk": "@@ -48,12 +48,19 @@\n         </com.google.android.material.appbar.CollapsingToolbarLayout>\n     </com.google.android.material.appbar.AppBarLayout>\n \n-    <de.danoeh.antennapod.view.EpisodeItemListRecyclerView\n-            android:id=\"@+id/recyclerView\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"match_parent\"\n-            android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\"\n-            app:layout_behavior=\"@string/appbar_scrolling_view_behavior\" />\n+    <androidx.swiperefreshlayout.widget.SwipeRefreshLayout\n+        android:id=\"@+id/swipeRefresh\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\"", "originalCommit": "70b92a08cfe32a5d1250535ade2e7cc09811bae4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5ODg3OA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498898878", "bodyText": "I am not sure but I think this does not make any difference as the recyclerview matches the parent or is the padding attribute handled differently in a recyclerview than it is in a listview?", "author": "asdoi", "createdAt": "2020-10-02T15:38:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5MDQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkyMDAyNA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498920024", "bodyText": "It does make a difference :) The recyclerView's scroll bar is then influenced by the padding. See screenshot below. Before, the scroll bar was on the right side of the screen.", "author": "ByteHamster", "createdAt": "2020-10-02T16:18:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5MDQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3NTQwMA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498975400", "bodyText": "Well, I always learn something new. \ud83d\ude09", "author": "asdoi", "createdAt": "2020-10-02T18:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5MDQ0MQ=="}], "type": "inlineReview"}, {"oid": "6a8007b388491f931d73a55bea289148536478ad", "url": "https://github.com/AntennaPod/AntennaPod/commit/6a8007b388491f931d73a55bea289148536478ad", "message": "update handler.postDelayed", "committedDate": "2020-10-02T15:41:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkyMTI2MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498921260", "bodyText": "1 second feels a bit too much to me. This is sometimes more than what it takes to actually refresh. What about 500ms?", "author": "ByteHamster", "createdAt": "2020-10-02T16:20:39Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java", "diffHunk": "@@ -214,6 +217,12 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n             ((SimpleItemAnimator) animator).setSupportsChangeAnimations(false);\n         }\n \n+        SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n+        swipeRefreshLayout.setOnRefreshListener(() -> {\n+            AutoUpdateManager.runImmediate(requireContext());\n+            new Handler().postDelayed(() -> swipeRefreshLayout.setRefreshing(false), 1000);", "originalCommit": "6a8007b388491f931d73a55bea289148536478ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "url": "https://github.com/AntennaPod/AntennaPod/commit/69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "message": "fix padding", "committedDate": "2020-10-02T18:11:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3NjE3MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498976170", "bodyText": "Is there any class where constants like this one are saved, I did not find an appropriate one.\nFurthermore I changed the duration to 750ms which is the time for one repetition.", "author": "asdoi", "createdAt": "2020-10-02T18:14:42Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -66,6 +69,8 @@\n     private static final String PREFS = \"SubscriptionFragment\";\n     private static final String PREF_NUM_COLUMNS = \"columns\";\n \n+    public static final int SWIPE_TO_REFRESH_DURATION = 750;", "originalCommit": "69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA0Mjg0Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r499042843", "bodyText": "Good question. I don't think we have a class for such constants. The most Android way would probably be to use the core/res/values/integers.xml file and then load with getResources().getInteger(R.integer.xy)", "author": "ByteHamster", "createdAt": "2020-10-02T20:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3NjE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3ODkyOA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498978928", "bodyText": "I am now unsure about that paddingBottom as it is needed for clipToPadding.\nAlso, please have a look about all other paddings to make sure that I did not make any mistakes \ud83d\ude09", "author": "asdoi", "createdAt": "2020-10-02T18:17:38Z", "path": "app/src/main/res/layout/fragment_subscriptions.xml", "diffHunk": "@@ -28,17 +28,24 @@\n             android:textColor=\"?android:attr/textColorSecondary\"\n             android:textSize=\"@dimen/text_size_small\" />\n \n-    <GridView\n-            android:layout_below=\"@id/feeds_filtered_message\"\n-            android:id=\"@+id/subscriptions_grid\"\n-            android:layout_width=\"match_parent\"\n-            android:numColumns=\"3\"\n-            android:horizontalSpacing=\"2dp\"\n-            android:verticalSpacing=\"2dp\"\n-            android:layout_height=\"match_parent\"\n-            android:layout_gravity=\"center_horizontal\"\n-            android:paddingBottom=\"88dp\"\n-            android:clipToPadding=\"false\"/>\n+    <androidx.swiperefreshlayout.widget.SwipeRefreshLayout\n+        android:id=\"@+id/swipeRefresh\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:layout_below=\"@id/feeds_filtered_message\">\n+\n+        <GridView\n+                android:id=\"@+id/subscriptions_grid\"\n+                android:layout_width=\"match_parent\"\n+                android:numColumns=\"3\"\n+                android:horizontalSpacing=\"2dp\"\n+                android:verticalSpacing=\"2dp\"\n+                android:layout_height=\"match_parent\"\n+                android:layout_gravity=\"center_horizontal\"\n+                android:paddingBottom=\"88dp\"", "originalCommit": "69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2NDQ3Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r499064473", "bodyText": "all_episodes_fragment.xml now has a tiny white space on the bottom of the screen. I think the padding should be applied to the RecyclerView, not to the SwipeRefreshLayout, there.\nThe padding here in fragment_subscriptions.xml looks good.", "author": "ByteHamster", "createdAt": "2020-10-02T21:48:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3ODkyOA=="}], "type": "inlineReview"}, {"oid": "81f33c24a62418f461ceac830500f01a5bcb528e", "url": "https://github.com/AntennaPod/AntennaPod/commit/81f33c24a62418f461ceac830500f01a5bcb528e", "message": "move duration const to integers.xml", "committedDate": "2020-10-02T21:14:05Z", "type": "commit"}, {"oid": "3e180a088fc5596b8ae6416a11be65bb37110f6b", "url": "https://github.com/AntennaPod/AntennaPod/commit/3e180a088fc5596b8ae6416a11be65bb37110f6b", "message": "update padding", "committedDate": "2020-10-03T12:41:36Z", "type": "commit"}]}