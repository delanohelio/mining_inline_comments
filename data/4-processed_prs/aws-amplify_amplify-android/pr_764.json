{"pr_number": 764, "pr_title": "chore(rxbindings): cleanup adapters and align datastore apis", "pr_createdAt": "2020-08-27T07:57:18Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/764", "timeline": [{"oid": "977531b7dcf2bc3ebaf122e822c56ff7bc56b26b", "url": "https://github.com/aws-amplify/amplify-android/commit/977531b7dcf2bc3ebaf122e822c56ff7bc56b26b", "message": "chore(rxbindings): cleanup adapters and align datastore apis\n\n1. Refactor RxAdapters, to clearly distinguish beteween cancelable and\n   void behaviors.\n2. Update all bindings to make more deliberate use of the updated\n   RxAdapters\n3. Update the RxDataStoreCategoryBehavior and RxDataStoreBinding with\n   new APIs that had been added to the vanilla category spec, but did\n   not make their way into the Rx spec.", "committedDate": "2020-08-27T08:00:03Z", "type": "commit"}, {"oid": "977531b7dcf2bc3ebaf122e822c56ff7bc56b26b", "url": "https://github.com/aws-amplify/amplify-android/commit/977531b7dcf2bc3ebaf122e822c56ff7bc56b26b", "message": "chore(rxbindings): cleanup adapters and align datastore apis\n\n1. Refactor RxAdapters, to clearly distinguish beteween cancelable and\n   void behaviors.\n2. Update all bindings to make more deliberate use of the updated\n   RxAdapters\n3. Update the RxDataStoreCategoryBehavior and RxDataStoreBinding with\n   new APIs that had been added to the vanilla category spec, but did\n   not make their way into the Rx spec.", "committedDate": "2020-08-27T08:00:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM3NTAyOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/764#discussion_r478375029", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * Describes a behavior emits a notification of start to an {@link Consumer},\n          \n          \n            \n                     * Describes a behavior which emits a notification of start to an {@link Consumer},", "author": "rjuliano", "createdAt": "2020-08-27T12:19:03Z", "path": "rxbindings/src/main/java/com/amplifyframework/rx/RxAdapters.java", "diffHunk": "@@ -25,80 +25,142 @@\n import io.reactivex.rxjava3.core.Single;\n \n /**\n- * Utility method to convert between behaviors that use the Amplify framework's native\n- * {@link Consumer} and {@link Action}, into {@link Single} and {@link Observable}.\n+ * Utilities for modeling Amplify category behaviors, and converting\n+ * those category behaviors into Rx objects (Observable, Single, Completable).\n  */\n final class RxAdapters {\n     private RxAdapters() {}\n \n-    static <T, E extends Throwable> Completable toCompletable(VoidResultEmitter<T, E> voidResultEmitter) {\n-        return Completable.defer(() -> Completable.create(emitter ->\n-            voidResultEmitter.emitTo(result -> emitter.onComplete(), emitter::onError)\n-        ));\n-    }\n+    /**\n+     * Cancelable behaviors are those Amplify category behaviors which return a cancelable\n+     * operation. For example, most behaviors in Storage and Predictions will return\n+     * a cancelable operation, whereas DataStore and Auth do not.\n+     */\n+    static final class CancelableBehaviors {\n+        private CancelableBehaviors() {}\n \n-    static <T, E extends Throwable> Single<T> toSingle(CancelableResultEmitter<T, E> cancelableResultEmitter) {\n-        return Single.defer(() -> Single.create(emitter -> {\n-            final Cancelable cancelable =\n-                cancelableResultEmitter.emitTo(emitter::onSuccess, emitter::onError);\n-            emitter.setDisposable(AmplifyDisposables.fromCancelable(cancelable));\n-        }));\n-    }\n+        static <E extends Throwable> Completable toCompletable(ActionEmitter<E> behavior) {\n+            return Completable.create(subscriber -> {\n+                Cancelable cancelable = behavior.emitTo(subscriber::onComplete, subscriber::onError);\n+                subscriber.setDisposable(AmplifyDisposables.fromCancelable(cancelable));\n+            });\n+        }\n \n-    static <S, T, E extends Throwable> Observable<T> toObservable(\n-            CancelableStreamEmitter<S, T, E> cancelableStreamEmitter) {\n-        return Observable.defer(() -> Observable.create(emitter -> {\n-            Cancelable cancelable = cancelableStreamEmitter.streamTo(\n-                NoOpConsumer.create(),\n-                emitter::onNext,\n-                emitter::onError,\n-                emitter::onComplete\n-            );\n-            emitter.setDisposable(AmplifyDisposables.fromCancelable(cancelable));\n-        }));\n-    }\n+        static <T, E extends Throwable> Single<T> toSingle(ResultEmitter<T, E> behavior) {\n+            return Single.create(subscriber -> {\n+                Cancelable cancelable = behavior.emitTo(subscriber::onSuccess, subscriber::onError);\n+                subscriber.setDisposable(AmplifyDisposables.fromCancelable(cancelable));\n+            });\n+        }\n \n-    /**\n-     * A behavior which emits to a result listener, but returns no value, itself.\n-     */\n-    interface VoidResultEmitter<T, E extends Throwable> {\n-        void emitTo(Consumer<T> onResult, Consumer<E> onError);\n-    }\n+        static <S, T, E extends Throwable> Observable<T> toObservable(StreamEmitter<S, T, E> behavior) {\n+            return Observable.create(subscriber -> {\n+                Cancelable cancelable = behavior.streamTo(\n+                    NoOpConsumer.create(),\n+                    subscriber::onNext,\n+                    subscriber::onError,\n+                    subscriber::onComplete\n+                );\n+                subscriber.setDisposable(AmplifyDisposables.fromCancelable(cancelable));\n+            });\n+        }\n \n-    /**\n-     * Describes a behavior which emits results to a result or error {@link Consumer},\n-     * and can be canceled via an {@link Cancelable}. Such a method\n-     * may be wrapped into an {@link Single} in a uniform way such as by the\n-     * {@link RxAdapters#toSingle(CancelableResultEmitter)} method.\n-     * @param <T> Type of result accepted by result consumer\n-     * @param <E> Type of error accepted by error consumer\n-     */\n-    interface CancelableResultEmitter<T, E extends Throwable> {\n-        Cancelable emitTo(Consumer<T> onResult, Consumer<E> onError);\n-    }\n+        /**\n+         * Describes a behavior emits a notification of start to an {@link Consumer},", "originalCommit": "977531b7dcf2bc3ebaf122e822c56ff7bc56b26b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "840eb3df1251cc74daed92f80bf7bd997f65cfd6", "url": "https://github.com/aws-amplify/amplify-android/commit/840eb3df1251cc74daed92f80bf7bd997f65cfd6", "message": "Update rxbindings/src/main/java/com/amplifyframework/rx/RxAdapters.java\n\nCo-authored-by: Rafael Juliano <r_juliano@hotmail.com>", "committedDate": "2020-08-27T15:11:25Z", "type": "commit"}]}