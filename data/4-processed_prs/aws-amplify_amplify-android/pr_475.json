{"pr_number": 475, "pr_title": "Allow a global log level in the AndroidLoggingPlugin", "pr_createdAt": "2020-05-16T20:44:35Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/475", "timeline": [{"oid": "a9dbb667d82a6bc73a891435bbf3df23daba34a8", "url": "https://github.com/aws-amplify/amplify-android/commit/a9dbb667d82a6bc73a891435bbf3df23daba34a8", "message": "Standardize log slugs and log levels\n\nAdds a mechanism to set a global log level. Configuring Amplify with:\n\n  Amplify.addPlugin(new AndroidLoggingPlugin(LogLevel.VERBOSE))\n\nWill cause any new Loggers to use LogLevel.VERBOSE as the default log\nlevel.\n\nAdditionally, transitions the codebase to use\n\n  LoggingCategoryBehavior#forCategory(CategoryType)\n\nInstead of:\n\n  LoggingCategoryBehavior#forNamespace(String).", "committedDate": "2020-05-16T20:34:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5NjU3OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/475#discussion_r426196578", "bodyText": "This drops the aws- prefix from the log slugs, which doesn't necessarily seem wrong to me, but did spark the thought that is there a reason for individual plugins to differentiate themselves? (say, for instance, you're using the aws-analytics-pinpoint plugin and the foo-analytics-bar plugin, for example.", "author": "jpignata", "createdAt": "2020-05-16T22:26:02Z", "path": "aws-analytics-pinpoint/src/androidTest/java/com/amplifyframework/analytics/pinpoint/AnalyticsPinpointInstrumentedTest.java", "diffHunk": "@@ -50,11 +51,8 @@\n  * Validates the functionality of the {@link AmazonPinpointAnalyticsPlugin}.\n  */\n public class AnalyticsPinpointInstrumentedTest {\n+    private static final Logger LOG = Amplify.Logging.forCategory(CategoryType.ANALYTICS);", "originalCommit": "a9dbb667d82a6bc73a891435bbf3df23daba34a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIwNzI5OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/475#discussion_r426207299", "bodyText": "Yea, I'm not sold on it either. I'll update the PR to only include the default log level change.", "author": "jamesonwilliams", "createdAt": "2020-05-17T01:41:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5NjU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5ODA1NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/475#discussion_r426198054", "bodyText": "This is an interesting one as there will be routinely two plugins -- aws-predictions and aws-predictions-tensorflow running concurrently.", "author": "jpignata", "createdAt": "2020-05-16T22:51:30Z", "path": "aws-predictions-tensorflow/src/main/java/com/amplifyframework/predictions/tensorflow/service/TensorFlowPredictionsService.java", "diffHunk": "@@ -35,7 +36,7 @@\n  * pre-trained models to make predictions offline.\n  */\n public final class TensorFlowPredictionsService {\n-    private static final Logger LOG = Amplify.Logging.forNamespace(\"amplify:aws-predictions-tensorflow\");\n+    private static final Logger LOG = Amplify.Logging.forCategory(CategoryType.PREDICTIONS);", "originalCommit": "a9dbb667d82a6bc73a891435bbf3df23daba34a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIwNzI4OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/475#discussion_r426207289", "bodyText": "The original format here was both like ampilfy:plugin-name and amplify-category-name.\nUnfortunately, forPlugin(Plugin<?> plugin) turned out not to be a realistic option. It would mean we'd have to have the plugin instance available in order to call the logger.\nI don't love putting everything under the categroy slug, but at least its consistent.\nI'll redo this PR and just make it about the default log level, not about the slug stuff.", "author": "jamesonwilliams", "createdAt": "2020-05-17T01:41:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5ODA1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5ODMzNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/475#discussion_r426198334", "bodyText": "Huh. I guess it stands to reason that DataStore would lowercase to data-store, but I hadn't seen it before.", "author": "jpignata", "createdAt": "2020-05-16T22:56:54Z", "path": "core/src/test/java/com/amplifyframework/logging/AndroidLoggingPluginTest.java", "diffHunk": "@@ -129,6 +135,36 @@ public void noContentLoggedAtThresholdNone() {\n         assertTrue(systemLog.getLines().isEmpty());\n     }\n \n+    /**\n+     * The {@link AndroidLoggingPlugin#forCategory(CategoryType)} implementation contains\n+     * special rules to normalize a log slut from a category name. Validate these conversions.\n+     */\n+    @Test\n+    public void correctSlugGeneratedForCategories() {\n+        AndroidLoggingPlugin plugin = new AndroidLoggingPlugin();\n+\n+        final Map<CategoryType, String> actuals = new HashMap<>();\n+        for (CategoryType categoryType : CategoryType.values()) {\n+            String result = plugin.forCategory(categoryType).getNamespace();\n+            actuals.put(categoryType, result);\n+        }\n+        final Map<CategoryType, String> expected = new HashMap<>();\n+        expected.put(CategoryType.ANALYTICS, \"amplify:analytics\");\n+        expected.put(CategoryType.API, \"amplify:api\");\n+        expected.put(CategoryType.AUTH, \"amplify:auth\");\n+        expected.put(CategoryType.DATASTORE, \"amplify:data-store\");", "originalCommit": "a9dbb667d82a6bc73a891435bbf3df23daba34a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIwNzE1OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/475#discussion_r426207158", "bodyText": "Hm, yea, same. datastore looks more natural. I can probably just update the logic to print a string of lowercase letters without punctuation, that might work.", "author": "jamesonwilliams", "createdAt": "2020-05-17T01:39:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5ODMzNA=="}], "type": "inlineReview"}, {"oid": "7db28f6048f89d5c3794e2919cafb84eeaf478c7", "url": "https://github.com/aws-amplify/amplify-android/commit/7db28f6048f89d5c3794e2919cafb84eeaf478c7", "message": "Fixups", "committedDate": "2020-05-17T02:36:06Z", "type": "commit"}, {"oid": "0bd2ec25023683932937bf080857538081fe15ea", "url": "https://github.com/aws-amplify/amplify-android/commit/0bd2ec25023683932937bf080857538081fe15ea", "message": "AndroidLoggingPlugin instantiable from 3p", "committedDate": "2020-05-17T02:40:15Z", "type": "commit"}, {"oid": "0b7793bd864a0651f88179fe7728ac4b32570081", "url": "https://github.com/aws-amplify/amplify-android/commit/0b7793bd864a0651f88179fe7728ac4b32570081", "message": "Merge remote-tracking branch 'origin/master' into standardize_logging", "committedDate": "2020-05-17T03:54:20Z", "type": "commit"}]}