{"pr_number": 506, "pr_title": "Integrates Auth with Predictions, Updates Sign Out, Disables AWS Logs", "pr_createdAt": "2020-05-21T20:48:32Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/506", "timeline": [{"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "url": "https://github.com/aws-amplify/amplify-android/commit/bf542bc1005c70e0df8b2df81590678a4d1c688d", "message": "Integrates Auth with Predictions, Updates Sign Out, Disables AWS Logs", "committedDate": "2020-05-21T20:43:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MjM5OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428952399", "bodyText": "I do wonder idly if we could do a kludge a thing where we listen to the logs and reply them all as DEBUG.  A bad idea for later maybe.", "author": "jpignata", "createdAt": "2020-05-21T22:36:43Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -119,6 +123,7 @@ public void configure(\n     ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n         final AtomicReference<Exception> asyncException = new AtomicReference<>();\n+        LogFactory.setLevel(LogFactory.Level.OFF);", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1OTA2MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428959061", "bodyText": "Maybe - I kinda want to get away from logging stuff in favor of Hub and Callbacks but we should discuss as a team what we want our policy to be on that,", "author": "TrekSoft", "createdAt": "2020-05-21T22:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MjM5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzY4Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428953687", "bodyText": "Copypasta.", "author": "jpignata", "createdAt": "2020-05-21T22:40:56Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -79,7 +91,26 @@ public String getPluginKey() {\n     @Override\n     public void configure(JSONObject pluginConfiguration, @NonNull Context context) throws PredictionsException {\n         this.configuration = AWSPredictionsPluginConfiguration.fromJson(pluginConfiguration);\n-        this.predictionsService = new AWSPredictionsService(configuration);\n+\n+        AWSCredentialsProvider credentialsProvider;\n+\n+        if (credentialsProviderOverride != null) {\n+            credentialsProvider = credentialsProviderOverride;\n+        } else {\n+            try {\n+                credentialsProvider =\n+                        (AWSMobileClient) Amplify.Auth.getPlugin(AUTH_DEPENDENCY_PLUGIN_KEY).getEscapeHatch();\n+            } catch (IllegalStateException exception) {\n+                throw new PredictionsException(\n+                        \"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin but it is currently missing\",\n+                        exception,\n+                        \"Before configuring Amplify, be sure to add AWSPredictionsPlugin same as you added \" +\n+                                \"AWSPinpointAnalyticsPlugin.\"", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1ODgzNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428958834", "bodyText": "Yeah gonna clean this all up after GA - it's all throughout the framework.", "author": "TrekSoft", "createdAt": "2020-05-21T22:57:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzY4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1NDE3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428954170", "bodyText": "This formatting seems curious?", "author": "jpignata", "createdAt": "2020-05-21T22:42:38Z", "path": "core/src/main/java/com/amplifyframework/auth/options/AuthSignOutOptions.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.util.ObjectsCompat;\n+\n+/**\n+ * Advanced options for signing out.\n+ */\n+public class AuthSignOutOptions {\n+    private final boolean globalSignOut;\n+\n+    /**\n+     * Advanced options for signing up.\n+     * @param globalSignOut Sign out of all devices\n+     */\n+    protected AuthSignOutOptions(\n+            boolean globalSignOut", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1OTMxNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428959314", "bodyText": "How so?", "author": "TrekSoft", "createdAt": "2020-05-21T22:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1NDE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkwOTI3NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428909274", "bodyText": "\"AWSPredictionsPlugin\"", "author": "raphkim", "createdAt": "2020-05-21T20:55:11Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -79,7 +91,26 @@ public String getPluginKey() {\n     @Override\n     public void configure(JSONObject pluginConfiguration, @NonNull Context context) throws PredictionsException {\n         this.configuration = AWSPredictionsPluginConfiguration.fromJson(pluginConfiguration);\n-        this.predictionsService = new AWSPredictionsService(configuration);\n+\n+        AWSCredentialsProvider credentialsProvider;\n+\n+        if (credentialsProviderOverride != null) {\n+            credentialsProvider = credentialsProviderOverride;\n+        } else {\n+            try {\n+                credentialsProvider =\n+                        (AWSMobileClient) Amplify.Auth.getPlugin(AUTH_DEPENDENCY_PLUGIN_KEY).getEscapeHatch();\n+            } catch (IllegalStateException exception) {\n+                throw new PredictionsException(\n+                        \"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin but it is currently missing\",\n+                        exception,\n+                        \"Before configuring Amplify, be sure to add AWSPredictionsPlugin same as you added \" +\n+                                \"AWSPinpointAnalyticsPlugin.\"", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkxMDczNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428910737", "bodyText": "i think the general pattern should be\npublic AWSPredictionsPlugin() {\n    this(null);\n}\n\n@VisibleForTesting\nAWSPredictionsPlugin(AWSCredentialsProvider provider) {\n    ...\n}\n\nSo that credentialsProviderOverride is explicitly assigned in both cases.", "author": "raphkim", "createdAt": "2020-05-21T20:58:06Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -70,6 +76,12 @@ public AWSPredictionsPlugin() {\n         this.executorService = Executors.newCachedThreadPool();\n     }\n \n+    @VisibleForTesting\n+    AWSPredictionsPlugin(AWSCredentialsProvider credentialsProviderOverride) {\n+        this();\n+        this.credentialsProviderOverride = credentialsProviderOverride;\n+    }", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkxMTQ1Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428911456", "bodyText": "nit: punctuation\n\"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin, but it is currently missing.\"", "author": "raphkim", "createdAt": "2020-05-21T20:59:27Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -79,7 +91,26 @@ public String getPluginKey() {\n     @Override\n     public void configure(JSONObject pluginConfiguration, @NonNull Context context) throws PredictionsException {\n         this.configuration = AWSPredictionsPluginConfiguration.fromJson(pluginConfiguration);\n-        this.predictionsService = new AWSPredictionsService(configuration);\n+\n+        AWSCredentialsProvider credentialsProvider;\n+\n+        if (credentialsProviderOverride != null) {\n+            credentialsProvider = credentialsProviderOverride;\n+        } else {\n+            try {\n+                credentialsProvider =\n+                        (AWSMobileClient) Amplify.Auth.getPlugin(AUTH_DEPENDENCY_PLUGIN_KEY).getEscapeHatch();\n+            } catch (IllegalStateException exception) {\n+                throw new PredictionsException(\n+                        \"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin but it is currently missing\",", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA3MzA5Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r429073096", "bodyText": "Is this for turning off mobile client logs?", "author": "raphkim", "createdAt": "2020-05-22T06:52:03Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -119,6 +123,7 @@ public void configure(\n     ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n         final AtomicReference<Exception> asyncException = new AtomicReference<>();\n+        LogFactory.setLevel(LogFactory.Level.OFF);", "originalCommit": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}