{"pr_number": 1021, "pr_title": "fix(aws-datastore): null modelName in OutboxMutationProcessed", "pr_createdAt": "2020-12-02T20:32:15Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/1021", "timeline": [{"oid": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91", "url": "https://github.com/aws-amplify/amplify-android/commit/899d6de232dbafdbf65bb8b3c4b51a2db68fda91", "message": "fix(aws-datastore): null modelName in OutboxMutationProcessed\n\nWhen the MutationProcessor successfully processes an item from the\nMutation Outbox, it will publish an OutboxMutationProcessed event to the\nHub.\n\nThe AppSync response itself contains no infromation about *what type* of\nmodel has just been published. That information is only available before\nmaking the request.\n\nAs a consequence, we cannot inspect the modelName from the AppSync\nresponse, and instead, we should pull it out of the MutationProcessor's\nrequest context.\n\nTo validate this fix, the various instrumentation tests are updated to\nuse the getModelName() code path on the OutboxMutationProcessed event.\n\nResolves: https://github.com/aws-amplify/amplify-android/issues/1012", "committedDate": "2020-12-02T20:31:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ2MzI3Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/1021#discussion_r534463276", "bodyText": "This line is the actual fix. Everything else is just wiring or test changes.", "author": "jamesonwilliams", "createdAt": "2020-12-02T20:33:58Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/MutationProcessor.java", "diffHunk": "@@ -141,7 +141,10 @@ private Completable drainMutationOutbox() {\n                     // if there are outstanding mutations in the outbox.\n                     mutationOutbox.remove(mutationOutboxItem.getMutationId())\n                         .andThen(merger.merge(modelWithMetadata))\n-                        .doOnComplete(() -> announceMutationProcessed(modelWithMetadata))\n+                        .doOnComplete(() -> {\n+                            String modelName = mutationOutboxItem.getModelSchema().getName();", "originalCommit": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}