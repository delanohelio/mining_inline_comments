{"pr_number": 534, "pr_title": "Show build outputs and unit test results in CircleCI Web UI", "pr_createdAt": "2020-05-27T00:01:08Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/534", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "url": "https://github.com/aws-amplify/amplify-android/commit/4b7a15137e20d336c52d04fc4da509d7f9427c0c", "message": "Integrate Build and Unit Test Outputs to CircleCI Console\n\n1. Aggregate jUnit test results into a `test-results` directory. Inform\n   CircleCI of this directory, so that it can report the results of a\n   unit test run.\n\n2. Bundle all build artifacts into a tarball, so that they can be\n   inspected.", "committedDate": "2020-05-27T01:46:36Z", "type": "commit"}, {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "url": "https://github.com/aws-amplify/amplify-android/commit/4b7a15137e20d336c52d04fc4da509d7f9427c0c", "message": "Integrate Build and Unit Test Outputs to CircleCI Console\n\n1. Aggregate jUnit test results into a `test-results` directory. Inform\n   CircleCI of this directory, so that it can report the results of a\n   unit test run.\n\n2. Bundle all build artifacts into a tarball, so that they can be\n   inspected.", "committedDate": "2020-05-27T01:46:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNDIyOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432114229", "bodyText": "mkdir -p would be slightly more robust in that it a) will make the full tree if the spec happens to need it, and b) won't fail if the directory suddenly starts to exist between the test and the mkdir command.", "author": "palpatim", "createdAt": "2020-05-28T20:47:59Z", "path": ".circleci/aggregate-build-artifacts.sh", "diffHunk": "@@ -0,0 +1,31 @@\n+#!/bin/bash\n+\n+set -e \n+\n+modules_with_build_trees() {\n+   for item in *; do\n+       if [ -d \"$item/build\" ]; then\n+           echo \"$item\"\n+       fi\n+   done\n+}\n+readonly modules=($(modules_with_build_trees))\n+readonly current_dir=\"$(pwd)\"\n+readonly aggregation_dir=\"build-artifacts\"\n+\n+if [ ! -d \"$aggregation_dir\" ]; then\n+    mkdir \"$aggregation_dir\"", "originalCommit": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExOTAyMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432119021", "bodyText": "will move to this", "author": "jamesonwilliams", "createdAt": "2020-05-28T20:57:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNDIyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNjY1NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432116655", "bodyText": "As above, maybe mkdir -p?", "author": "palpatim", "createdAt": "2020-05-28T20:52:55Z", "path": ".circleci/aggregate-test-results.sh", "diffHunk": "@@ -0,0 +1,32 @@\n+#!/bin/bash\n+\n+set -e\n+\n+readonly circle_ci_storage_dir='test-results'\n+readonly cur_dir=$(pwd)\n+readonly junit_xmls_path='build/test-results/testDebugUnitTest'\n+\n+[ -z \"$1\" ] && echo \"Usage: $0 <workdir_path>\" >&2 && exit 1\n+\n+module_test_results() {\n+    for item in *; do\n+        if [ -d \"$item/$junit_xmls_path\" ]; then\n+            echo $item\n+        fi\n+    done\n+}\n+readonly test_results_dirs=($(module_test_results))\n+\n+if [ ! -d $circle_ci_storage_dir ]; then\n+    mkdir $circle_ci_storage_dir", "originalCommit": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExODk2MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432118961", "bodyText": "will move to this", "author": "jamesonwilliams", "createdAt": "2020-05-28T20:57:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNjY1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNjg0OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432116848", "bodyText": "I assume the aggregate-build-artifacts takes the place of publishing to local maven?", "author": "palpatim", "createdAt": "2020-05-28T20:53:13Z", "path": ".circleci/config.yml", "diffHunk": "@@ -90,12 +90,14 @@ jobs:\n       - generate_gradle_wrapper\n       - run:\n           name: Build the project\n-          command: bash gradlew build\n-      - run:\n-          name: Publish the project to local maven\n-          command: bash gradlew publishToMavenLocal", "originalCommit": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExODY5Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432118697", "bodyText": "This publishToMavenLocal step is actually not needed. It was carried over into this project from the SDK -- there, it is important.", "author": "jamesonwilliams", "createdAt": "2020-05-28T20:56:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNjg0OA=="}], "type": "inlineReview"}, {"oid": "5c5e5589e1038a020bfcd6af0a5f2fb566da31f6", "url": "https://github.com/aws-amplify/amplify-android/commit/5c5e5589e1038a020bfcd6af0a5f2fb566da31f6", "message": "Merge remote-tracking branch 'origin/master' into aggregate_test_results", "committedDate": "2020-05-28T20:58:20Z", "type": "commit"}, {"oid": "459487c3e914be43f24dbf00e1d963d1d6ef0ce3", "url": "https://github.com/aws-amplify/amplify-android/commit/459487c3e914be43f24dbf00e1d963d1d6ef0ce3", "message": "Use mkdir -p instead of checking if the directories are created first", "committedDate": "2020-05-28T21:00:28Z", "type": "commit"}]}