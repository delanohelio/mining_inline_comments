{"pr_number": 432, "pr_title": "Implement online text to speech conversion", "pr_createdAt": "2020-05-06T08:45:51Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/432", "timeline": [{"oid": "c7a710b1aa48de978da7f39e0c31d391309c3ee6", "url": "https://github.com/aws-amplify/amplify-android/commit/c7a710b1aa48de978da7f39e0c31d391309c3ee6", "message": "Implement online text to speech conversion", "committedDate": "2020-05-05T22:27:09Z", "type": "commit"}, {"oid": "ac85a2029045ecdee2d2c54fead735d6dc537dfc", "url": "https://github.com/aws-amplify/amplify-android/commit/ac85a2029045ecdee2d2c54fead735d6dc537dfc", "message": "Add instrumentation test", "committedDate": "2020-05-05T22:27:20Z", "type": "commit"}, {"oid": "7894289a3c834cff6890ac8b74027f6c237c7117", "url": "https://github.com/aws-amplify/amplify-android/commit/7894289a3c834cff6890ac8b74027f6c237c7117", "message": "Fix checkstyle", "committedDate": "2020-05-05T22:47:11Z", "type": "commit"}, {"oid": "88af966707db509a2b8079a9429082b93bdaa02f", "url": "https://github.com/aws-amplify/amplify-android/commit/88af966707db509a2b8079a9429082b93bdaa02f", "message": "Add voice type enums", "committedDate": "2020-05-06T06:34:43Z", "type": "commit"}, {"oid": "79442dd35395f611fcec8549c095515f194e0687", "url": "https://github.com/aws-amplify/amplify-android/commit/79442dd35395f611fcec8549c095515f194e0687", "message": "Add polly client to escape hatch", "committedDate": "2020-05-06T21:15:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1MTI2NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421951265", "bodyText": "(unrelated to this PR)\nThoughts on renaming Result to Response (and all subclasses) or something else?   I don't really like Result because it might cause some customer confusion with Kotlin's Result class.", "author": "richardmcclellan", "createdAt": "2020-05-08T05:46:47Z", "path": "core/src/main/java/com/amplifyframework/predictions/result/TextToSpeechResult.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.result;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.core.async.Result;\n+\n+import java.io.InputStream;\n+import java.util.Objects;\n+\n+/**\n+ * The result of the call to synthesize speech from text.\n+ */\n+public final class TextToSpeechResult implements Result {", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MTg3Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421981876", "bodyText": "^ I agree... Result doesn't really serve any purpose.\nMeanwhile, calling the actual classes <purpose>Result is in alignment with what iOS has, so I don't think I will be changing that to Response. Especially if we are removing Result class, then there shouldn't be namespace conflict with Kotlin anymore right?", "author": "raphkim", "createdAt": "2020-05-08T07:10:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1MTI2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk5NTkwNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421995904", "bodyText": "#440", "author": "jamesonwilliams", "createdAt": "2020-05-08T07:42:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1MTI2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDM1MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421960351", "bodyText": "When I was in Alexa, we had some tests that used AWS services to do TTS and ASR. This was a ~fair external verification, since they were ~separate services. Here, we don't have such an external verification mechanism.\nHowever, we do have mechanisms to:\n\nConvert text to speech;\nConvert speech to text.\n\nyou can have a test that does the \"does speech to text work?\" by providing an input wav, and expecting some valid text back.\nFor the \"convert text to speech,\" you can assume the \"speech to text\" part works. Then do:\n\nArrange some text.\nAct: convert it to speech.\nRun speech to text (assuming that this component works), and get text back.\nAssert that the returned text is ~close to the arranged text.", "author": "jamesonwilliams", "createdAt": "2020-05-08T06:16:32Z", "path": "aws-predictions/src/androidTest/java/com/amplifyframework/predictions/aws/AWSPredictionsTextToSpeechTest.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws;\n+\n+import android.content.Context;\n+\n+import com.amplifyframework.predictions.PredictionsCategory;\n+import com.amplifyframework.predictions.PredictionsException;\n+import com.amplifyframework.predictions.aws.test.R;\n+import com.amplifyframework.predictions.result.TextToSpeechResult;\n+import com.amplifyframework.testutils.Assets;\n+import com.amplifyframework.testutils.sync.SynchronousMobileClient;\n+import com.amplifyframework.testutils.sync.SynchronousPredictions;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import java.io.InputStream;\n+\n+import static androidx.test.core.app.ApplicationProvider.getApplicationContext;\n+import static org.junit.Assert.assertNotNull;\n+\n+/**\n+ * Tests that Predictions text-to-speech conversion\n+ * delivers a non-null result for valid input.\n+ */\n+public final class AWSPredictionsTextToSpeechTest {\n+\n+    private SynchronousPredictions predictions;\n+\n+    /**\n+     * Configure Predictions category before each test.\n+     * @throws Exception if mobile client initialization fails\n+     */\n+    @Before\n+    public void setUp() throws Exception {\n+        Context context = getApplicationContext();\n+\n+        // Set up Auth\n+        SynchronousMobileClient.instance().initialize();\n+\n+        // Delegate to Predictions category\n+        PredictionsCategory asyncDelegate =\n+                TestPredictionsCategory.create(context, R.raw.amplifyconfiguration);\n+        predictions = SynchronousPredictions.delegatingTo(asyncDelegate);\n+    }\n+\n+    /**\n+     * This is a placeholder test case for text-to-speech conversion.\n+     * @throws PredictionsException if prediction fails\n+     */\n+    @Test\n+    public void testTextToSpeechReturnsNonNullResult() throws PredictionsException {\n+        // Interpret english text and assert non-null result\n+        final String englishText = Assets.readAsString(\"sample-text-en.txt\");\n+        TextToSpeechResult result = predictions.convertTextToSpeech(englishText);\n+\n+        // Assert non-null audio data\n+        InputStream audioData = result.getAudioData();\n+        assertNotNull(audioData);", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MjQyMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421982423", "bodyText": "I was thinking about this... but it turns out we won't be able to support speech to text for GA... Android SDK doesn't have transcribe-streaming implemented", "author": "raphkim", "createdAt": "2020-05-08T07:11:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDM1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4NjM0NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421986344", "bodyText": "Ah okay! Makes sense", "author": "jamesonwilliams", "createdAt": "2020-05-08T07:20:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDM1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDkxNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421960915", "bodyText": "If you have enums for these things, why not just use them everywhere?", "author": "jamesonwilliams", "createdAt": "2020-05-08T06:18:14Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/configuration/SpeechGeneratorConfiguration.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.configuration;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.predictions.aws.NetworkPolicy;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+/**\n+ * Configures the behavior for speech generation.\n+ */\n+public final class SpeechGeneratorConfiguration {\n+    private static final String CONFIG_NAME = \"speechGenerator\";\n+\n+    private final String voice;\n+    private final String language;", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MjcyNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421982726", "bodyText": "Enum is scoped to the plugin, since these names only make sense in the context of AWS Polly, and \"voice\" is a configurable value in core category options for text-to-speech...", "author": "raphkim", "createdAt": "2020-05-08T07:12:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDkxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MjIyMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421962223", "bodyText": "Don't forget to do equals, hashCode, toString on all of your models, request and response types.", "author": "jamesonwilliams", "createdAt": "2020-05-08T06:21:58Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/request/AWSPollyRequest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.request;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.predictions.aws.models.VoiceType;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Simple request instance for speech synthesis operation.\n+ */\n+public final class AWSPollyRequest {", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MjkxOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421982919", "bodyText": "After this PR + dummy transcribe PR, I will go through every model to add them!", "author": "raphkim", "createdAt": "2020-05-08T07:13:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MjIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MzIzOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421963239", "bodyText": "This is String since VoiceType is in the plugin, right? Any other options? (I agree, this is better than including the current VoiceType into core!)", "author": "jamesonwilliams", "createdAt": "2020-05-08T06:24:42Z", "path": "core/src/main/java/com/amplifyframework/predictions/options/TextToSpeechOptions.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.core.async.Options;\n+\n+/**\n+ * Options for text to speech conversion operation.\n+ */\n+public final class TextToSpeechOptions implements Options {\n+    private final String voiceType;\n+\n+    private TextToSpeechOptions(final Builder builder) {\n+        this.voiceType = builder.getVoiceType();\n+    }\n+\n+    /**\n+     * Gets the custom voice type if specified.\n+     * Null otherwise.\n+     * @return the custom voice type\n+     */\n+    @Nullable\n+    public String getVoiceType() {", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk5ODI2MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421998260", "bodyText": "I figured it out! VoiceType is now a core predictions interface with String getVoice(); method, and AWSVoiceType implements that voice type inside the plugin!", "author": "raphkim", "createdAt": "2020-05-08T07:47:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MzIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1MzcyNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421953726", "bodyText": "As discussed offline, it'd be best for this to support voices that are multi-lingual.", "author": "richardmcclellan", "createdAt": "2020-05-08T05:55:13Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/models/VoiceType.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.models;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+/**\n+ * Types of voice to synthesize speech with.\n+ *\n+ * @see <a href=https://docs.aws.amazon.com/polly/latest/dg/voicelist.html>Voices in Amazon Polly</a>\n+ */\n+@SuppressWarnings(\"JavadocVariable\")\n+public enum VoiceType {", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1NzU1OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421957558", "bodyText": "Woah, TIL about underscore literals :)", "author": "richardmcclellan", "createdAt": "2020-05-08T06:07:43Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSPollyService.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.service;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.core.Consumer;\n+import com.amplifyframework.predictions.PredictionsException;\n+import com.amplifyframework.predictions.aws.AWSPredictionsPluginConfiguration;\n+import com.amplifyframework.predictions.aws.configuration.SpeechGeneratorConfiguration;\n+import com.amplifyframework.predictions.aws.models.VoiceType;\n+import com.amplifyframework.predictions.result.TextToSpeechResult;\n+import com.amplifyframework.util.UserAgent;\n+\n+import com.amazonaws.AmazonClientException;\n+import com.amazonaws.ClientConfiguration;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.services.polly.AmazonPollyClient;\n+import com.amazonaws.services.polly.AmazonPollyPresigningClient;\n+import com.amazonaws.services.polly.model.OutputFormat;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechRequest;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechResult;\n+import com.amazonaws.services.polly.model.TextType;\n+\n+import java.io.InputStream;\n+\n+/**\n+ * Predictions service for performing text to speech conversion.\n+ */\n+final class AWSPollyService {\n+    private static final int MP3_SAMPLE_RATE = 24_000;", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1OTEyNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421959125", "bodyText": "Could you represent an unknown VoiceType with null instead of a UNKNOWN type?", "author": "richardmcclellan", "createdAt": "2020-05-08T06:12:39Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSPollyService.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.service;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.core.Consumer;\n+import com.amplifyframework.predictions.PredictionsException;\n+import com.amplifyframework.predictions.aws.AWSPredictionsPluginConfiguration;\n+import com.amplifyframework.predictions.aws.configuration.SpeechGeneratorConfiguration;\n+import com.amplifyframework.predictions.aws.models.VoiceType;\n+import com.amplifyframework.predictions.result.TextToSpeechResult;\n+import com.amplifyframework.util.UserAgent;\n+\n+import com.amazonaws.AmazonClientException;\n+import com.amazonaws.ClientConfiguration;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.services.polly.AmazonPollyClient;\n+import com.amazonaws.services.polly.AmazonPollyPresigningClient;\n+import com.amazonaws.services.polly.model.OutputFormat;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechRequest;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechResult;\n+import com.amazonaws.services.polly.model.TextType;\n+\n+import java.io.InputStream;\n+\n+/**\n+ * Predictions service for performing text to speech conversion.\n+ */\n+final class AWSPollyService {\n+    private static final int MP3_SAMPLE_RATE = 24_000;\n+\n+    private final AmazonPollyClient polly;\n+    private final AWSPredictionsPluginConfiguration pluginConfiguration;\n+\n+    AWSPollyService(AWSPredictionsPluginConfiguration pluginConfiguration) {\n+        this.polly = createPollyClient();\n+        this.pluginConfiguration = pluginConfiguration;\n+    }\n+\n+    private AmazonPollyClient createPollyClient() {\n+        AWSCredentialsProvider credentialsProvider = AWSMobileClient.getInstance();\n+        ClientConfiguration configuration = new ClientConfiguration();\n+        configuration.setUserAgent(UserAgent.string());\n+        return new AmazonPollyPresigningClient(credentialsProvider, configuration);\n+    }\n+\n+    void synthesizeSpeech(\n+            @NonNull String text,\n+            @NonNull VoiceType voiceType,\n+            @NonNull Consumer<TextToSpeechResult> onSuccess,\n+            @NonNull Consumer<PredictionsException> onError\n+    ) {\n+        try {\n+            InputStream data = synthesizeSpeech(text, voiceType);\n+            onSuccess.accept(TextToSpeechResult.fromAudioData(data));\n+        } catch (PredictionsException exception) {\n+            onError.accept(exception);\n+        }\n+    }\n+\n+    private InputStream synthesizeSpeech(String text, VoiceType voiceType) throws PredictionsException {\n+        final String languageCode;\n+        final String voiceId;\n+        if (VoiceType.UNKNOWN.equals(voiceType)) {", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk5MzcwOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421993708", "bodyText": "I'd prefer to leave all instances where a VoiceType is expected to be @NonNull as to minimize null-checking", "author": "raphkim", "createdAt": "2020-05-08T07:37:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1OTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDU4NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421960585", "bodyText": "I think this should be \"Amazon Polly\", not \"AWS Polly\".   And not just for Polly, for the same change should probably be made for all the other Predictions Services as well.  Maybe something to address in a separate PR.", "author": "richardmcclellan", "createdAt": "2020-05-08T06:17:14Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSPollyService.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.service;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.core.Consumer;\n+import com.amplifyframework.predictions.PredictionsException;\n+import com.amplifyframework.predictions.aws.AWSPredictionsPluginConfiguration;\n+import com.amplifyframework.predictions.aws.configuration.SpeechGeneratorConfiguration;\n+import com.amplifyframework.predictions.aws.models.VoiceType;\n+import com.amplifyframework.predictions.result.TextToSpeechResult;\n+import com.amplifyframework.util.UserAgent;\n+\n+import com.amazonaws.AmazonClientException;\n+import com.amazonaws.ClientConfiguration;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.services.polly.AmazonPollyClient;\n+import com.amazonaws.services.polly.AmazonPollyPresigningClient;\n+import com.amazonaws.services.polly.model.OutputFormat;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechRequest;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechResult;\n+import com.amazonaws.services.polly.model.TextType;\n+\n+import java.io.InputStream;\n+\n+/**\n+ * Predictions service for performing text to speech conversion.\n+ */\n+final class AWSPollyService {", "originalCommit": "79442dd35395f611fcec8549c095515f194e0687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NzM4MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421977381", "bodyText": "Verified against our internal tech writers' page -- all of the services in this category are branded as Amazon whatevers.", "author": "jamesonwilliams", "createdAt": "2020-05-08T06:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk5MzkzNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r421993937", "bodyText": "shoot! I'll have to go through the code to fix those ugh", "author": "raphkim", "createdAt": "2020-05-08T07:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI0MjQ5MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r423242490", "bodyText": "(to be done in a separate PR as to not introduce non-polly stuff in this PR)", "author": "raphkim", "createdAt": "2020-05-11T18:41:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2MDU4NQ=="}], "type": "inlineReview"}, {"oid": "380b19f17d84f2dcb25b27d0314b408ceff2a90c", "url": "https://github.com/aws-amplify/amplify-android/commit/380b19f17d84f2dcb25b27d0314b408ceff2a90c", "message": "Make voice type into an interface", "committedDate": "2020-05-08T07:46:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwMjkxNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r422002914", "bodyText": "Should this have both a getVoiceName() and getLanguageCode(), to mirror the values that are in the AWSVoiceType?", "author": "jamesonwilliams", "createdAt": "2020-05-08T07:57:44Z", "path": "core/src/main/java/com/amplifyframework/predictions/models/VoiceType.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.models;\n+\n+import androidx.annotation.NonNull;\n+\n+/**\n+ * Contains details about a specific voice to be\n+ * used for synthesizing speech.\n+ */\n+public interface VoiceType {", "originalCommit": "380b19f17d84f2dcb25b27d0314b408ceff2a90c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI1NDI0MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r422254240", "bodyText": "iOS's core VoiceType doesn't contain anything about language. Strangely enough, even the plugin's extension doesn't seem to contain language code (outside of the constant name that is), which means that they won't be able to support bilingual TTS feature.", "author": "raphkim", "createdAt": "2020-05-08T16:55:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwMjkxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI2NzY4Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r422267683", "bodyText": "Since it wasn't clear whether the intention was to completely remove language from the equation or if they wanted to keep core VoiceType as generic as possible, I decided to keep the core VoiceType interface match up with iOS and only introduce the language code in the plugin specific voice type.\nThis allows us to support bilingual voices by separating AWSVoiceType#HINDI_ADITI and AWSVoiceType#INDIAN_ENGLISH_ADITI", "author": "raphkim", "createdAt": "2020-05-08T17:22:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwMjkxNA=="}], "type": "inlineReview"}, {"oid": "96a548d7b6b833bc0293dcad3a3b066b9cacf416", "url": "https://github.com/aws-amplify/amplify-android/commit/96a548d7b6b833bc0293dcad3a3b066b9cacf416", "message": "Rename voice to name", "committedDate": "2020-05-08T17:18:51Z", "type": "commit"}, {"oid": "79bb36b77c319828b768f7b3b4abe7484942069a", "url": "https://github.com/aws-amplify/amplify-android/commit/79bb36b77c319828b768f7b3b4abe7484942069a", "message": "Merge branch 'master' of https://github.com/aws-amplify/amplify-android into text-to-speech-aws", "committedDate": "2020-05-08T17:19:44Z", "type": "commit"}, {"oid": "34314451140ee133040a4627be6edf11a220b677", "url": "https://github.com/aws-amplify/amplify-android/commit/34314451140ee133040a4627be6edf11a220b677", "message": "Merge branch 'master' of https://github.com/aws-amplify/amplify-android into text-to-speech-aws", "committedDate": "2020-05-08T17:42:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NTAwNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r423975004", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                CHINESE_ZHIYU(\"Zhiyu\", \"cmn-CN\"),\n          \n          \n            \n                MANDARIN_CHINESE_ZHIYU(\"Zhiyu\", \"cmn-CN\"),", "author": "richardmcclellan", "createdAt": "2020-05-12T19:19:21Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/models/AWSVoiceType.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.models;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.predictions.models.VoiceType;\n+\n+/**\n+ * Types of voice to synthesize speech with.\n+ *\n+ * @see <a href=https://docs.aws.amazon.com/polly/latest/dg/voicelist.html>Voices in Amazon Polly</a>\n+ */\n+@SuppressWarnings(\"JavadocVariable\")\n+public enum AWSVoiceType implements VoiceType {\n+    ARABIC_ZEINA(\"Zeina\", \"arb\"),\n+    CHINESE_ZHIYU(\"Zhiyu\", \"cmn-CN\"),", "originalCommit": "34314451140ee133040a4627be6edf11a220b677", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA2MzU3Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r424063576", "bodyText": "good suggestion! Makes sense since we are following {VARIATION}_{LANGUAGE}_{NAME} scheme", "author": "raphkim", "createdAt": "2020-05-12T22:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NTAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NjQzMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r423976433", "bodyText": "Apparently languageCode is an optional parameter, and if you don't include it, multilingual voices will fall back to a default language.  I guess this is how iOS is able to not include this parameter at all, and still have a mostly working implementation.\nI like that we now have multilingual support for Android.  I'd suggest reaching out to iOS and suggesting that they add similar support.", "author": "richardmcclellan", "createdAt": "2020-05-12T19:21:51Z", "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSPollyService.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.service;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.core.Consumer;\n+import com.amplifyframework.predictions.PredictionsException;\n+import com.amplifyframework.predictions.aws.AWSPredictionsPluginConfiguration;\n+import com.amplifyframework.predictions.aws.configuration.SpeechGeneratorConfiguration;\n+import com.amplifyframework.predictions.aws.models.AWSVoiceType;\n+import com.amplifyframework.predictions.result.TextToSpeechResult;\n+import com.amplifyframework.util.UserAgent;\n+\n+import com.amazonaws.AmazonClientException;\n+import com.amazonaws.ClientConfiguration;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.services.polly.AmazonPollyClient;\n+import com.amazonaws.services.polly.AmazonPollyPresigningClient;\n+import com.amazonaws.services.polly.model.OutputFormat;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechRequest;\n+import com.amazonaws.services.polly.model.SynthesizeSpeechResult;\n+import com.amazonaws.services.polly.model.TextType;\n+\n+import java.io.InputStream;\n+\n+/**\n+ * Predictions service for performing text to speech conversion.\n+ */\n+final class AWSPollyService {\n+    private static final int MP3_SAMPLE_RATE = 24_000;\n+\n+    private final AmazonPollyClient polly;\n+    private final AWSPredictionsPluginConfiguration pluginConfiguration;\n+\n+    AWSPollyService(AWSPredictionsPluginConfiguration pluginConfiguration) {\n+        this.polly = createPollyClient();\n+        this.pluginConfiguration = pluginConfiguration;\n+    }\n+\n+    private AmazonPollyClient createPollyClient() {\n+        AWSCredentialsProvider credentialsProvider = AWSMobileClient.getInstance();\n+        ClientConfiguration configuration = new ClientConfiguration();\n+        configuration.setUserAgent(UserAgent.string());\n+        return new AmazonPollyPresigningClient(credentialsProvider, configuration);\n+    }\n+\n+    void synthesizeSpeech(\n+            @NonNull String text,\n+            @NonNull AWSVoiceType voiceType,\n+            @NonNull Consumer<TextToSpeechResult> onSuccess,\n+            @NonNull Consumer<PredictionsException> onError\n+    ) {\n+        try {\n+            InputStream data = synthesizeSpeech(text, voiceType);\n+            onSuccess.accept(TextToSpeechResult.fromAudioData(data));\n+        } catch (PredictionsException exception) {\n+            onError.accept(exception);\n+        }\n+    }\n+\n+    private InputStream synthesizeSpeech(String text, AWSVoiceType voiceType) throws PredictionsException {\n+        final String languageCode;\n+        final String voiceId;\n+        if (AWSVoiceType.UNKNOWN.equals(voiceType)) {\n+            // Obtain voice + language from plugin configuration by default\n+            SpeechGeneratorConfiguration config = pluginConfiguration.getSpeechGeneratorConfiguration();\n+            languageCode = config.getLanguage();\n+            voiceId = config.getVoice();\n+        } else {\n+            // Override configuration defaults if explicitly specified in the options\n+            languageCode = voiceType.getLanguageCode();\n+            voiceId = voiceType.getName();\n+        }\n+\n+        SynthesizeSpeechRequest request = new SynthesizeSpeechRequest()\n+                 .withText(text)\n+                 .withTextType(TextType.Text)\n+                 .withLanguageCode(languageCode)", "originalCommit": "34314451140ee133040a4627be6edf11a220b677", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA2MzcyOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/432#discussion_r424063728", "bodyText": "yep! I also noticed this shortly after. It should definitely be supported by both platforms ideally.", "author": "raphkim", "createdAt": "2020-05-12T22:11:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NjQzMw=="}], "type": "inlineReview"}, {"oid": "56fc34dcdee36704a81a19ba7c8f2c5d55225e7b", "url": "https://github.com/aws-amplify/amplify-android/commit/56fc34dcdee36704a81a19ba7c8f2c5d55225e7b", "message": "Specify chinese dialect in enum value", "committedDate": "2020-05-12T22:12:58Z", "type": "commit"}]}