{"pr_number": 218, "pr_title": "[API] Accept Lambdas in GraphQL Behaviors", "pr_createdAt": "2020-01-04T21:00:13Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/218", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQyNjA2MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/218#discussion_r363426060", "bodyText": "not exactly onResult() anymore ;)", "author": "raphkim", "createdAt": "2020-01-06T18:42:58Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/network/MockAppSyncEndpoint.java", "diffHunk": "@@ -61,24 +60,24 @@ static Configurator configure(AppSyncEndpoint mock) {\n         @SafeVarargs\n         final <T extends Model> Configurator mockSuccessResponse(\n                 Class<T> modelClass, ModelWithMetadata<T>... responseItems) {\n-\n             doAnswer(invocation -> {\n-                // Get a handle to the listener that is passed into the sync() method\n-                // ResultListener is the third and final param at index 2 (@0, @1, @2).\n-                final int argumentPositionForResultListener = 2;\n-                final ResultListener<GraphQLResponse<Iterable<ModelWithMetadata<T>>>, DataStoreException> listener =\n-                    invocation.getArgument(argumentPositionForResultListener);\n+                // Get a handle to the response consumer that is passed into the sync() method\n+                // Response consumer is the third param, at index 2 (@0, @1, @2, @3).\n+                final int argumentPositionForResponseConsumer = 2;\n+                final Consumer<GraphQLResponse<Iterable<ModelWithMetadata<T>>>> consumer =\n+                    invocation.getArgument(argumentPositionForResponseConsumer);\n \n                 // Call its onResult(), and pass the mocked items inside of a GraphQLResponse wrapper", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUxOTIzOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/218#discussion_r363519239", "bodyText": "Ah good catch, I'll update it.", "author": "jamesonwilliams", "createdAt": "2020-01-06T22:45:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQyNjA2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQzMjYxMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/218#discussion_r363432613", "bodyText": "Is there any other GraphQL behavior besides those three specified?", "author": "raphkim", "createdAt": "2020-01-06T18:57:56Z", "path": "core/src/main/java/com/amplifyframework/api/GraphQlBehavior.java", "diffHunk": "@@ -23,14 +23,13 @@\n import com.amplifyframework.api.graphql.GraphQLResponse;\n import com.amplifyframework.api.graphql.MutationType;\n import com.amplifyframework.api.graphql.SubscriptionType;\n-import com.amplifyframework.core.ResultListener;\n-import com.amplifyframework.core.StreamListener;\n+import com.amplifyframework.core.Action;\n+import com.amplifyframework.core.Consumer;\n import com.amplifyframework.core.model.Model;\n import com.amplifyframework.core.model.query.predicate.QueryPredicate;\n-import com.amplifyframework.hub.HubCategory;\n \n /**\n- * GraphQL behaviors which include operations like query/subscribe/mutate operations.\n+ * GraphQL behaviors include operations like query, subscribe, mutate, etc.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUyMDU2Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/218#discussion_r363520567", "bodyText": "Will update.", "author": "jamesonwilliams", "createdAt": "2020-01-06T22:49:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQzMjYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQzMzU2Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/218#discussion_r363433566", "bodyText": "Are we no longer using the Hub? I thought that we would be publishing everything to hub by default on top of the local callback to caller thread?", "author": "raphkim", "createdAt": "2020-01-06T19:00:10Z", "path": "core/src/main/java/com/amplifyframework/api/GraphQlBehavior.java", "diffHunk": "@@ -23,14 +23,13 @@\n import com.amplifyframework.api.graphql.GraphQLResponse;\n import com.amplifyframework.api.graphql.MutationType;\n import com.amplifyframework.api.graphql.SubscriptionType;\n-import com.amplifyframework.core.ResultListener;\n-import com.amplifyframework.core.StreamListener;\n+import com.amplifyframework.core.Action;\n+import com.amplifyframework.core.Consumer;\n import com.amplifyframework.core.model.Model;\n import com.amplifyframework.core.model.query.predicate.QueryPredicate;\n-import com.amplifyframework.hub.HubCategory;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUzMTU3NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/218#discussion_r363531575", "bodyText": "That was a plan, originally. I think it sounds like a fine idea. The only problem is that we never actually implemented any code to use Hub. We just wrote the Hub and left a bunch of documentation saying that it was getting used, when it wasn't. That was a ~dangerous state, so I've been going through and removing the false documentation. If/when we add Hub integration, we can go back and update the documentation to mention Hub again.", "author": "jamesonwilliams", "createdAt": "2020-01-06T23:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQzMzU2Ng=="}], "type": "inlineReview"}, {"oid": "47a9b0ece6523b4087068262c76a129a4b4d88ba", "url": "https://github.com/aws-amplify/amplify-android/commit/47a9b0ece6523b4087068262c76a129a4b4d88ba", "message": "[API] Accept Lambdas in GraphQL Behaviors\n\nTo reduce verbosity, the `ResultListener` and `StreamListener` are\nremoved from the contracts of the GraphQL behaviors. Instead, the\nGraphQL behaviors are reworked to accept \"decomposed\" versions of those\ncallbacks, using `Consumer` and `Action`, directly.\n\nFor example, a query in Amplify 0.9 would have been written as:\n\n```\nAmplify.API.query(Person.class,\n    new ResultListener<GraphQLResponse<Iterable<Person>>>() {\n        @Override\n        public void onResponse(GraphQLResponse<Iterable<Person>> response) {\n            Log.i(TAG, \"Got results!\");\n        }\n\n        @Override\n        public void onError(ApiException failure) {\n            Log.e(TAG, \"Failed.\", failure);\n        }\n    }\n);\n```\n\nBut is now expressed as:\n\n```\nAmplify.API.query(Person.class,\n    response -> Log.i(TAG, \"Got a response: \" + response),\n    failure -> Log.e(TAG, \"Failed to get a GraphQL response.\", failure)\n);\n```", "committedDate": "2020-01-06T22:49:36Z", "type": "commit"}]}