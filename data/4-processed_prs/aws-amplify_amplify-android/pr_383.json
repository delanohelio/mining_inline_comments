{"pr_number": 383, "pr_title": "Adds forgotPassword/confirmForgotPassword", "pr_createdAt": "2020-04-17T19:50:33Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/383", "timeline": [{"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "url": "https://github.com/aws-amplify/amplify-android/commit/f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "message": "Adds forgotPassword/confirmForgotPassword", "committedDate": "2020-04-17T19:49:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410438652", "bodyText": "How come you don't pass back convertCodeDeliveryDetails(result.getParameters()) here too? Doesn't contain any valuable info?", "author": "jamesonwilliams", "createdAt": "2020-04-17T19:53:48Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -367,22 +370,88 @@ public void onResult(UserStateDetails result) {\n \n                 @Override\n                 public void onError(Exception exception) {\n-                    onError.accept(new AuthException(\n+                    onException.accept(new AuthException(\n                             \"An error occurred while attempting to retrieve your user details\",\n                             exception,\n                             \"See attached exception for more details\"\n                     ));\n                 }\n             });\n         } catch (Throwable exception) {\n-            onError.accept(new AuthException(\n+            onException.accept(new AuthException(\n                     \"An error occurred fetching authorization details for the current user\",\n                     exception,\n                     \"See attached exception for more details\"\n             ));\n         }\n     }\n \n+    @Override\n+    public void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().forgotPassword(username, new Callback<ForgotPasswordResult>() {\n+            @Override\n+            public void onResult(ForgotPasswordResult result) {\n+                if (result.getState().equals(ForgotPasswordState.CONFIRMATION_CODE)) {\n+                    onSuccess.accept(convertCodeDeliveryDetails(result.getParameters()));\n+                } else {\n+                    onException.accept(new AuthException(\n+                            \"Received an unsupported response after triggering password recovery: \" + result.getState(),\n+                            \"This is almost certainly a bug. Please report it as an issue in our GitHub repo.\"\n+                    ));\n+                }\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred triggering password recovery\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void confirmForgotPassword(\n+            @NonNull String newPassword,\n+            @NonNull String confirmationCode,\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmForgotPassword(\n+            newPassword,\n+            confirmationCode,\n+            new Callback<ForgotPasswordResult>() {\n+                @Override\n+                public void onResult(ForgotPasswordResult result) {\n+                    if (result.getState().equals(ForgotPasswordState.DONE)) {\n+                        onSuccess.call();", "originalCommit": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0NDA4MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410444081", "bodyText": "Yeah no it's a messed up implementation in AWSMobileClient where there's only one legitimate value which is Done and everything else is empty or an error. :P", "author": "TrekSoft", "createdAt": "2020-04-17T20:06:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4MTk4Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410481987", "bodyText": "Haha oh alright!", "author": "jamesonwilliams", "createdAt": "2020-04-17T21:37:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzOTQ4OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410439489", "bodyText": "For both places, maybe:\n@param username A login identifier e.g. `awsuser22`; or, could be an email or phone number, depending on configuration", "author": "jamesonwilliams", "createdAt": "2020-04-17T19:55:43Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -33,7 +34,7 @@\n      * Creates a new user account with the specified username and password.\n      * Can also pass in user attributes to associate with the user through\n      * the options object.\n-     * @param username This can be a typical username, email, phone number, etc.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration", "originalCommit": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MDMyNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410450326", "bodyText": "Sure, will add this in the next round", "author": "TrekSoft", "createdAt": "2020-04-17T20:20:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzOTQ4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0MDI2OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410440269", "bodyText": "and the confirmation code that came from (where does it come from)?", "author": "jamesonwilliams", "createdAt": "2020-04-17T19:57:32Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -154,4 +155,28 @@ void signInWithFacebook(\n     void fetchAuthSession(\n             @NonNull Consumer<AuthSession> onSuccess,\n             @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Trigger password recovery for the given username.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Complete password recovery process by inputting user's desired new password and confirmation code.", "originalCommit": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MDQ2Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410450462", "bodyText": "It depends how it's configured so I think I'll leave it as is.", "author": "TrekSoft", "createdAt": "2020-04-17T20:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0MDI2OQ=="}], "type": "inlineReview"}]}