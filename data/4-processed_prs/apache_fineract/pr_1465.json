{"pr_number": 1465, "pr_title": "FINERACT-1209: Integration Tests using new Swagger Client API", "pr_createdAt": "2020-10-22T01:14:41Z", "pr_url": "https://github.com/apache/fineract/pull/1465", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNDkyNw==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r510104927", "bodyText": "why exclude integration-tests from Spotless now? Or are we already not covering them? Then we should separately fix that, first?", "author": "vorburger", "createdAt": "2020-10-22T12:03:55Z", "path": "build.gradle", "diffHunk": "@@ -416,9 +408,14 @@ configure(project.fineractJavaProjects) {\n \n     // Configuration for the spotless plugin\n     // https://github.com/diffplug/spotless/tree/main/plugin-gradle\n+    dependencies {\n+        spotbugsPlugins 'jp.skypencil.findbugs.slf4j:bug-pattern:1.5.0@jar'\n+        spotbugs 'com.github.spotbugs:spotbugs:4.1.4'\n+    }\n+\n     spotless {\n         java {\n-            targetExclude '**/build/**', '**/bin/**', '**/out/**'\n+            targetExclude '**/build/**', '**/bin/**', '**/out/**', '**/integration-tests/**'", "originalCommit": "721faf59a4cc5e727f510dc6fdd3b84f2df0537f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyNDg2NQ==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r510124865", "bodyText": "True... was a bit late and was not sure where all the warnings/errors were coming from. I'll revert.", "author": "vidakovic", "createdAt": "2020-10-22T12:36:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNDkyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5ODUwNA==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515498504", "bodyText": "Thanks! I have checked and see that this was done, so Resolving this point.", "author": "vorburger", "createdAt": "2020-10-31T13:43:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNDkyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNTcyMQ==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r510105721", "bodyText": "I'm guessing we currently haven't covered integration-tests? We should perhaps try to fix that, first? Or leave as is?", "author": "vorburger", "createdAt": "2020-10-22T12:05:11Z", "path": "config/checkstyle/suppressions.xml", "diffHunk": "@@ -27,4 +27,6 @@\n \n <suppressions>\n     <suppress files=\"[/\\\\]build[/\\\\]generated[/\\\\]\" checks=\".*\"/>\n+    <!-- TODO: fix integration test formatting -->\n+    <suppress files=\"[/\\\\]integration-tests[/\\\\]src[/\\\\]test[/\\\\]main[/\\\\]\" checks=\".*\"/>", "originalCommit": "721faf59a4cc5e727f510dc6fdd3b84f2df0537f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyNDU1Mg==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r510124552", "bodyText": "For now I'd leave the exclusion. Checkstyle reports an avalanche of 1500 errors. I'd say we can fix this when we migrate step by step to to fineract-client usage.", "author": "vidakovic", "createdAt": "2020-10-22T12:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNTcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5OTI3Nw==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515499277", "bodyText": "OK. Let's follow-up on that in FINERACT-1246. I'll leave this review comment open.", "author": "vorburger", "createdAt": "2020-10-31T13:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNTcyMQ=="}], "type": "inlineReview"}, {"oid": "f17af37284c0869895efebe46598396168606dec", "url": "https://github.com/apache/fineract/commit/f17af37284c0869895efebe46598396168606dec", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-25T19:41:59Z", "type": "forcePushed"}, {"oid": "4d456e4e69fd1c340e64c2d698106fb595001a3a", "url": "https://github.com/apache/fineract/commit/4d456e4e69fd1c340e64c2d698106fb595001a3a", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-26T10:24:58Z", "type": "forcePushed"}, {"oid": "569db2c83916a4136a2215fce26fc081f46a3484", "url": "https://github.com/apache/fineract/commit/569db2c83916a4136a2215fce26fc081f46a3484", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-26T10:28:12Z", "type": "forcePushed"}, {"oid": "cae3accf5caedb735bd8bd414f104561e5abaa5f", "url": "https://github.com/apache/fineract/commit/cae3accf5caedb735bd8bd414f104561e5abaa5f", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-26T10:37:05Z", "type": "forcePushed"}, {"oid": "ecb940c28bfdb095f1e37187e32e7271e0d468af", "url": "https://github.com/apache/fineract/commit/ecb940c28bfdb095f1e37187e32e7271e0d468af", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-26T20:04:56Z", "type": "forcePushed"}, {"oid": "bbe0aa21c411876dfe2ae695b95b2c2cbf6284fc", "url": "https://github.com/apache/fineract/commit/bbe0aa21c411876dfe2ae695b95b2c2cbf6284fc", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-28T09:30:19Z", "type": "forcePushed"}, {"oid": "ca2aa3067a6995f6f92e856e39ada1eeb3aef087", "url": "https://github.com/apache/fineract/commit/ca2aa3067a6995f6f92e856e39ada1eeb3aef087", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-30T11:23:58Z", "type": "forcePushed"}, {"oid": "55cac071a4589bfe14923083734d9dd19b5ba7cc", "url": "https://github.com/apache/fineract/commit/55cac071a4589bfe14923083734d9dd19b5ba7cc", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-31T19:59:42Z", "type": "forcePushed"}, {"oid": "2065410173c8b058c4e77d9e95b9994adeeecdf5", "url": "https://github.com/apache/fineract/commit/2065410173c8b058c4e77d9e95b9994adeeecdf5", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-10-31T21:39:00Z", "type": "forcePushed"}, {"oid": "99f64286d66c96d898092490f7771b55921936ec", "url": "https://github.com/apache/fineract/commit/99f64286d66c96d898092490f7771b55921936ec", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-11-01T20:19:09Z", "type": "forcePushed"}, {"oid": "e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "url": "https://github.com/apache/fineract/commit/e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-11-01T22:04:39Z", "type": "commit"}, {"oid": "e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "url": "https://github.com/apache/fineract/commit/e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "message": "FINERACT-1209: Integration Tests using new Swagger Client API", "committedDate": "2020-11-01T22:04:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTU5OA==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515821598", "bodyText": "@vidakovic my Gradle foo isn't as strong as yours \ud83d\ude04 but isn't this \"inherited\" from the root build.gradle, after (my) #1477? It's not a big enough problem to not merge this ASAP anyway (I'm reviewing this right now..), but if you agree, then perhaps you want to raise a minor clean-up PR as follow-up?", "author": "vorburger", "createdAt": "2020-11-02T08:56:39Z", "path": "integration-tests/build.gradle", "diffHunk": "@@ -0,0 +1,73 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+description = 'Fineract Integration Tests'\n+\n+apply plugin: 'com.bmuschko.cargo'\n+\n+// Configuration for the Gradle Cargo plugin\n+// https://github.com/bmuschko/gradle-cargo-plugin\n+configurations {\n+    tomcat\n+}\n+\n+apply from: 'dependencies.gradle'\n+\n+cargo {\n+    containerId \"tomcat9x\"\n+\n+    // looks like Cargo doesn't detect the WAR file automatically in the multi-module setup\n+    deployable {\n+        file = file(\"$rootDir/fineract-provider/build/libs/fineract-provider.war\")\n+        context = 'fineract-provider'\n+    }\n+\n+    local {\n+        installer {\n+            installConfiguration = configurations.tomcat\n+            downloadDir = file(\"$buildDir/download\")\n+            extractDir = file(\"$buildDir/tomcat\")\n+        }\n+        startStopTimeout = 240000\n+        containerProperties {\n+            property 'cargo.tomcat.connector.keystoreFile', file(\"$rootDir/fineract-provider/src/main/resources/keystore.jks\")\n+            property 'cargo.tomcat.connector.keystorePass', 'openmf'\n+            property 'cargo.tomcat.httpSecure', true\n+            property 'cargo.tomcat.connector.sslProtocol', 'TLS'\n+            property 'cargo.tomcat.connector.clientAuth', false\n+            property 'cargo.protocol', 'https'\n+            property 'cargo.servlet.port', 8443\n+        }\n+    }\n+}\n+\n+cargoRunLocal.dependsOn ':fineract-provider:war'\n+cargoStartLocal.dependsOn ':fineract-provider:war'\n+cargoStartLocal.mustRunAfter 'testClasses'\n+\n+test {\n+    useJUnitPlatform()\n+    testLogging {\n+        // FINERACT-927\n+        events 'skipped', 'failed'\n+        showStandardStreams = false\n+        exceptionFormat 'full'\n+    }", "originalCommit": "e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyNjQ1MQ==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515826451", "bodyText": "@vorburger correct... will create a PR for that... saw this during a rebase, but forgot to clean it up here.", "author": "vidakovic", "createdAt": "2020-11-02T09:05:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzOTc4Ng==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515839786", "bodyText": "#1490", "author": "vorburger", "createdAt": "2020-11-02T09:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTU5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMzEwNQ==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515823105", "bodyText": "@vidakovic given that this is here now, we should remove it from fineract/fineract-provider/dependencies.gradle, no? Again not a big enough problem to not merge this ASAP anyway (I'm reviewing this right now..), but if you agree, then perhaps you want to raise a minor clean-up PR as follow-up?", "author": "vorburger", "createdAt": "2020-11-02T08:59:19Z", "path": "integration-tests/dependencies.gradle", "diffHunk": "@@ -0,0 +1,45 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+dependencies {\n+    // testCompile dependencies are ONLY used in src/test, not src/main.\n+    // Do NOT repeat dependencies which are ALREADY in implementation or runtimeOnly!\n+    //\n+    tomcat 'org.apache.tomcat:tomcat:9.0.39@zip'\n+    testImplementation( files(\"$rootDir/fineract-provider/build/classes/java/main/\"),\n+            project(path: ':fineract-provider', configuration: 'runtimeElements'),\n+            'org.junit.jupiter:junit-jupiter-api:5.7.0',\n+            'com.google.truth:truth:1.0.1',\n+            'com.google.truth.extensions:truth-java8-extension:1.0.1',\n+            'org.awaitility:awaitility',\n+            // 'com.google.code.gson:gson',\n+            )\n+    testImplementation ('org.mock-server:mockserver-junit-jupiter') {\n+        exclude group: 'com.sun.mail', module: 'mailapi'\n+        exclude group: 'javax.servlet', module: 'javax.servlet-api'\n+        exclude group: 'javax.validation'\n+    }\n+    testImplementation ('io.rest-assured:rest-assured') {\n+        exclude group: 'commons-logging'\n+        exclude group: 'org.apache.sling'\n+        exclude group: 'com.sun.xml.bind'\n+    }", "originalCommit": "e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg1NjcxMw==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515856713", "bodyText": "#1491", "author": "vorburger", "createdAt": "2020-11-02T09:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMzEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMzU5OA==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515823598", "bodyText": "FTR: FINERACT-1250 had a suggestion to simplify this, which we should try in a follow-up PR (I'll raise one).", "author": "vorburger", "createdAt": "2020-11-02T09:00:14Z", "path": ".travis.yml", "diffHunk": "@@ -72,6 +72,6 @@ script:\n # using \"&&\" instead of several \"-\" means that integrationTest does not run if test fails,\n # and Docker test does not run if integration test fails, which makes PR failure easier to understand.\n # @see https://docs.travis-ci.com/user/job-lifecycle/#customizing-the-build-phase\n-  - ./gradlew --console=plain -PautomatedBuild=true licenseMain licenseTest licenseIntegrationTest check  &&  ./gradlew --console=plain -PautomatedBuild=true build integrationTest --fail-fast  &&  sudo service mysql stop  &&  docker-compose build  &&  docker-compose up -d  &&  sleep 60s  && curl -f -k --retry 5 --retry-connrefused --connect-timeout 30 --retry-delay 30 https://localhost:8443/fineract-provider/actuator/health  &&  (( $(curl -f -k --retry 5 --retry-connrefused --connect-timeout 30 --retry-delay 30 https://localhost:8443/fineract-provider/actuator/info | wc --chars) > 100 ))\n+  - ./gradlew --console=plain -PautomatedBuild=true licenseMain licenseTest check -x test  &&  ./gradlew --console=plain -PautomatedBuild=true build test --fail-fast  &&  sudo service mysql stop  &&  docker-compose build  &&  docker-compose up -d  &&  sleep 60s  && curl -f -k --retry 5 --retry-connrefused --connect-timeout 30 --retry-delay 30 https://localhost:8443/fineract-provider/actuator/health  &&  (( $(curl -f -k --retry 5 --retry-connrefused --connect-timeout 30 --retry-delay 30 https://localhost:8443/fineract-provider/actuator/info | wc --chars) > 100 ))", "originalCommit": "e3dc8bc6915ddd05aac9869e7b46cf2bd058f030", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTM4MQ==", "url": "https://github.com/apache/fineract/pull/1465#discussion_r515829381", "bodyText": "#1489", "author": "vorburger", "createdAt": "2020-11-02T09:10:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMzU5OA=="}], "type": "inlineReview"}]}