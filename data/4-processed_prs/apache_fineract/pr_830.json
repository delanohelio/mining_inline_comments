{"pr_number": 830, "pr_title": "FINERACT-822 Integrate Error Prone to Fineract", "pr_createdAt": "2020-05-08T09:24:15Z", "pr_url": "https://github.com/apache/fineract/pull/830", "timeline": [{"oid": "65f4b57aa5405f1a34380248ae8723870e30a5c7", "url": "https://github.com/apache/fineract/commit/65f4b57aa5405f1a34380248ae8723870e30a5c7", "message": "FINERACT-822 enable and enforce Error Prone", "committedDate": "2020-05-08T11:01:11Z", "type": "forcePushed"}, {"oid": "4eb1be4348f8616b4680b746da4637e236ae6b7b", "url": "https://github.com/apache/fineract/commit/4eb1be4348f8616b4680b746da4637e236ae6b7b", "message": "FINERACT-822 Error prone change version", "committedDate": "2020-05-08T11:15:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyOTcwNA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r422529704", "bodyText": "@vorburger concerning org.apache.fineract.notification.domain.Notification.setActor(Long) error prone picked this up locally", "author": "percyashu", "createdAt": "2020-05-09T18:28:32Z", "path": "fineract-provider/src/main/java/org/apache/fineract/notification/domain/Notification.java", "diffHunk": "@@ -90,7 +90,7 @@ public Long getActor() {\n     }\n \n     public void setActor(Long actor) {\n-        this.actorId = actorId;\n+        this.actorId = actor;\n     }", "originalCommit": "4eb1be4348f8616b4680b746da4637e236ae6b7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMTk1MA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r422531950", "bodyText": "@percyashu nice! FYI I've also fixed this in #858 ...", "author": "vorburger", "createdAt": "2020-05-09T18:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyOTcwNA=="}], "type": "inlineReview"}, {"oid": "af5db5b35e3abb82af1481ad47efeeacca554474", "url": "https://github.com/apache/fineract/commit/af5db5b35e3abb82af1481ad47efeeacca554474", "message": "FINERACT-822 Error prone change version", "committedDate": "2020-05-10T16:56:18Z", "type": "forcePushed"}, {"oid": "d49726a96d4a4951fb9546cec742f003e91f9221", "url": "https://github.com/apache/fineract/commit/d49726a96d4a4951fb9546cec742f003e91f9221", "message": "FINERACT-822 Error prone fixing errors", "committedDate": "2020-05-10T20:25:07Z", "type": "forcePushed"}, {"oid": "7b4ba5f6f4e8d057e05d8579df3551baae084f4e", "url": "https://github.com/apache/fineract/commit/7b4ba5f6f4e8d057e05d8579df3551baae084f4e", "message": "FINERACT-822 Error prone fixing errors", "committedDate": "2020-05-10T20:32:41Z", "type": "forcePushed"}, {"oid": "13c745869fd3dca83eaedb7379996ab42c5d2720", "url": "https://github.com/apache/fineract/commit/13c745869fd3dca83eaedb7379996ab42c5d2720", "message": "FINERACT-822 Error prone fixing errors", "committedDate": "2020-05-10T20:42:03Z", "type": "forcePushed"}, {"oid": "118d5a14adc2730ff60f2a715d897ab9205d043e", "url": "https://github.com/apache/fineract/commit/118d5a14adc2730ff60f2a715d897ab9205d043e", "message": "FINERACT-822 Error prone fixing errors", "committedDate": "2020-05-10T20:49:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzODgzNw==", "url": "https://github.com/apache/fineract/pull/830#discussion_r426038837", "bodyText": "@vorburger not sure the of the right format that was supposed to be on methods I added @SuppressWarnings(\"MisuedWeekYear\") please see https://errorprone.info/bugpattern/MisusedWeekYear", "author": "percyashu", "createdAt": "2020-05-15T20:46:27Z", "path": "fineract-provider/src/integrationTest/java/org/apache/fineract/integrationtests/variableinstallments/VariableInstallmentsFlatHelper.java", "diffHunk": "@@ -201,6 +201,7 @@ private static ArrayList createModifyMap(String date) {\n         return toReturn;\n     }\n \n+    @SuppressWarnings(\"MisusedWeekYear\")", "originalCommit": "118d5a14adc2730ff60f2a715d897ab9205d043e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTIxMA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429559210", "bodyText": "this seems suspicious - are you sure suppressing this is correct, and not actually hiding a real bug? (I haven't had a closer look, I'm hoping you'll do that...) If you are completely sure, then each @SuppressWarnings should have an inline comment with a reasonably detailed explanation why that is the right thing to do.", "author": "vorburger", "createdAt": "2020-05-23T16:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzODgzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU4Mjc4NQ==", "url": "https://github.com/apache/fineract/pull/830#discussion_r426582785", "bodyText": "@vorburger or @awasum this looks like a test any idea why they are missing @test.", "author": "percyashu", "createdAt": "2020-05-18T12:18:33Z", "path": "fineract-provider/src/integrationTest/java/org/apache/fineract/integrationtests/StaffTest.java", "diffHunk": "@@ -183,13 +185,15 @@ public void testStaffUpdate() {\n         Assert.assertEquals(mobileNo, changes.get(\"mobileNo\"));\n     }\n \n+    @SuppressWarnings(\"JUnit4TestNotRun\")\n     public void testStaffUpdateLongExternalIdError() {\n         final HashMap<String, Object> map = new HashMap<>();\n         map.put(\"externalId\", Utils.randomStringGenerator(\"EXT\", 98));\n \n         StaffHelper.updateStaff(requestSpec, responseSpecForValidationError, 1, map);\n     }", "originalCommit": "118d5a14adc2730ff60f2a715d897ab9205d043e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY0NzYwOQ==", "url": "https://github.com/apache/fineract/pull/830#discussion_r427647609", "bodyText": "@percyashu I suppose someone just \"forgot\" to add @Test ?\nWhat I suggest you do is do add @Test for all these cases (instead of @SuppressWarnings(\"JUnit4TestNotRun\")), and try running them. If they fail, slap an @Ignore on those that do fail - and then subsequently but in a later separate PR see if you can fix them (or someone else can do that, as part of future work to review all ignored tests). Sounds like a plan?", "author": "vorburger", "createdAt": "2020-05-19T23:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU4Mjc4NQ=="}], "type": "inlineReview"}, {"oid": "87e7e2e11f4c66804365cc683db65215b593334e", "url": "https://github.com/apache/fineract/commit/87e7e2e11f4c66804365cc683db65215b593334e", "message": "FINERACT-822 Remove SuppressWarnings", "committedDate": "2020-05-22T18:17:48Z", "type": "forcePushed"}, {"oid": "cb5eda0b6bbbcf458747e2aed4911872c5805302", "url": "https://github.com/apache/fineract/commit/cb5eda0b6bbbcf458747e2aed4911872c5805302", "message": "FINERACT-822 Remove SuppressWarnings from test", "committedDate": "2020-05-23T12:55:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1ODc2NQ==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429558765", "bodyText": "wait waaaaat... why are we regressing on FINERACT-959 to progress with FINERACT-822? That doesn't seem right, to me - and worth a discussion...  \ud83d\ude08 I suspect that you may be doing this because Error Prone gives warnings? IMHO we should either fix them all, as part of this - or change EP's config to shut up about particular ones which are obviously wrong (similar to what I have done in another project, have you seen the link in FINERACT-822)...  How many are there?", "author": "vorburger", "createdAt": "2020-05-23T16:14:31Z", "path": "fineract-provider/build.gradle", "diffHunk": "@@ -276,7 +278,7 @@ configurations {\n }\n \n tasks.withType(JavaCompile) {\n-    options.compilerArgs += [\"-Xlint:unchecked\",\"-Xlint:cast\",\"-Werror\"] // TODO FINERACT-959 (gradually) enable -Xlint:all (see \"javac -help -X\")\n+    options.compilerArgs += [\"-Xlint:unchecked\",\"-Xlint:cast\"] // TODO FINERACT-959 (gradually) enable -Xlint:all (see \"javac -help -X\")", "originalCommit": "cb5eda0b6bbbcf458747e2aed4911872c5805302", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NTYxMw==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429565613", "bodyText": "@vorburger thanks for the link I will configure error prone to help with the 1000 warnings.", "author": "percyashu", "createdAt": "2020-05-23T17:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1ODc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1ODkwNA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429558904", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                errorprone \"com.google.errorprone:error_prone_core:2.3.3\"\n          \n          \n            \n                errorprone \"com.google.errorprone:error_prone_core:2.3.4\"", "author": "vorburger", "createdAt": "2020-05-23T16:16:10Z", "path": "fineract-provider/build.gradle", "diffHunk": "@@ -435,6 +437,9 @@ dependencies {\n   tomcat \"org.apache.tomcat:tomcat:9.0.34@zip\"\n }\n \n+dependencies { \n+    errorprone \"com.google.errorprone:error_prone_core:2.3.3\"", "originalCommit": "cb5eda0b6bbbcf458747e2aed4911872c5805302", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTAyNg==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429559026", "bodyText": "this seems a bit suspicious to me - so this test if failing, but you are just making the response expect a validation error? Shouldn't we... fix this test, if we re-enable it, instead of cheating to get the test to pass? Re-enabling these tests could be done in a separate PR before this one, if you like (but don't have to).", "author": "vorburger", "createdAt": "2020-05-23T16:17:54Z", "path": "fineract-provider/src/integrationTest/java/org/apache/fineract/integrationtests/StaffTest.java", "diffHunk": "@@ -99,9 +101,10 @@ public void testStaffCreateMaxNameLength() {\n         map.put(\"firstname\", Utils.randomNameGenerator(\"michael_\", 42));\n         map.put(\"lastname\", Utils.randomNameGenerator(\"Doe_\", 46));\n \n-        StaffHelper.createStaffWithJson(requestSpec, responseSpec, new Gson().toJson(map));\n+        StaffHelper.createStaffWithJson(requestSpec, responseSpecForValidationError, new Gson().toJson(map));", "originalCommit": "cb5eda0b6bbbcf458747e2aed4911872c5805302", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NTYyMg==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429565622", "bodyText": "Ok will do those in seperate Pr.", "author": "percyashu", "createdAt": "2020-05-23T17:57:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTAyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTA2Ng==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429559066", "bodyText": "can you raise a JIRA for the failure and then link it here using @Ignore // TODO FINERACT-123 syntax?", "author": "vorburger", "createdAt": "2020-05-23T16:18:31Z", "path": "fineract-provider/src/integrationTest/java/org/apache/fineract/integrationtests/StaffTest.java", "diffHunk": "@@ -183,13 +186,17 @@ public void testStaffUpdate() {\n         Assert.assertEquals(mobileNo, changes.get(\"mobileNo\"));\n     }\n \n+    @Test\n+    @Ignore", "originalCommit": "cb5eda0b6bbbcf458747e2aed4911872c5805302", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NTYzMA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429565630", "bodyText": "OK will do", "author": "percyashu", "createdAt": "2020-05-23T17:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTA2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTM0NA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429559344", "bodyText": "whoa whoa - slow down, the point is to FIX all problems - not to introduce a tool that tells us about problems, and then just make the tool shut up! I have not looked closely, but just a quick glance at https://errorprone.info/bugpattern/NullTernary makes it seem to me like this is trying to telly us about a real bug? As above, if it's definitely a false positive, then put a detailed analysis explanation in an inline comment...", "author": "vorburger", "createdAt": "2020-05-23T16:22:51Z", "path": "fineract-provider/src/main/java/org/apache/fineract/interoperation/util/MathUtil.java", "diffHunk": "@@ -87,6 +87,7 @@ public static Long abs(Long value) {\n \n     /** @return calculates minimum of the two values considering null values\n      * @param notNull if true then null parameter is omitted, otherwise returns null */\n+    @SuppressWarnings(\"NullTernary\")", "originalCommit": "cb5eda0b6bbbcf458747e2aed4911872c5805302", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NTc2NQ==", "url": "https://github.com/apache/fineract/pull/830#discussion_r429565765", "bodyText": "Will look more into those remaining two remaining errors and provide if it is necessary to use the @SuppressWarnings.", "author": "percyashu", "createdAt": "2020-05-23T17:59:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1OTM0NA=="}], "type": "inlineReview"}, {"oid": "ac9ec89cc73b869b78423c68d98ae30a07b0196c", "url": "https://github.com/apache/fineract/commit/ac9ec89cc73b869b78423c68d98ae30a07b0196c", "message": "FINERACT-822 Added DefaultCharset", "committedDate": "2020-05-25T10:32:45Z", "type": "forcePushed"}, {"oid": "2b569cfdc448e901d1799056530795dc38af5cef", "url": "https://github.com/apache/fineract/commit/2b569cfdc448e901d1799056530795dc38af5cef", "message": "FINERACT-822 Make Error prone fail for StringSplitter", "committedDate": "2020-05-25T22:29:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg4NjU2NQ==", "url": "https://github.com/apache/fineract/pull/830#discussion_r430886565", "bodyText": "I see that you have added these so you can enable them and fix gradually rather than fixing the errors at once? Make sure you look at the issues rules you are disabling so that we dont miss catching some critical problems in the system.", "author": "awasum", "createdAt": "2020-05-27T06:33:48Z", "path": "fineract-provider/build.gradle", "diffHunk": "@@ -278,6 +280,86 @@ configurations {\n tasks.withType(JavaCompile) {\n     options.compilerArgs += [\"-Xlint:unchecked\",\"-Xlint:cast\",\"-Werror\"] // TODO FINERACT-959 (gradually) enable -Xlint:all (see \"javac -help -X\")\n     options.deprecation = true\n+    options.errorprone {\n+        disableWarningsInGeneratedCode = true\n+        //Todo Remove necessary checks from this list\n+        disable(\"UnusedVariable\",", "originalCommit": "2b569cfdc448e901d1799056530795dc38af5cef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU2NTMzMA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r431565330", "bodyText": "Yep these are default warning checks and will be removed from this list in separate PR", "author": "percyashu", "createdAt": "2020-05-28T03:45:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg4NjU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2OTgwMA==", "url": "https://github.com/apache/fineract/pull/830#discussion_r431969800", "bodyText": "Lets not forget to enable some of the important rules you have disable here in future PRs.", "author": "awasum", "createdAt": "2020-05-28T16:31:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg4NjU2NQ=="}], "type": "inlineReview"}, {"oid": "4b80d974785629b8a8ba790807b121b4d44504ba", "url": "https://github.com/apache/fineract/commit/4b80d974785629b8a8ba790807b121b4d44504ba", "message": "FINERACT-822 StringSplitter", "committedDate": "2020-05-27T14:09:11Z", "type": "forcePushed"}, {"oid": "f724e7f6c3ee16fdca4baf68b9d7e09e2f3e3135", "url": "https://github.com/apache/fineract/commit/f724e7f6c3ee16fdca4baf68b9d7e09e2f3e3135", "message": "FINERACT-822 Make Error prone fail for StringSplitter", "committedDate": "2020-05-27T15:40:42Z", "type": "forcePushed"}, {"oid": "dfd0e8399e4f22e411b797ccfe37622c636b749c", "url": "https://github.com/apache/fineract/commit/dfd0e8399e4f22e411b797ccfe37622c636b749c", "message": "FINERACT-822 Make Error prone fail for StringSplitter", "committedDate": "2020-05-27T16:38:42Z", "type": "forcePushed"}, {"oid": "597b8ee5f84b66c2f2099ab86e1d912e51055909", "url": "https://github.com/apache/fineract/commit/597b8ee5f84b66c2f2099ab86e1d912e51055909", "message": "FINERACT-822 Fix Default Errors checks", "committedDate": "2020-05-27T18:22:19Z", "type": "forcePushed"}, {"oid": "e32cbe77e42038c878d3aac220c65b2b5816d812", "url": "https://github.com/apache/fineract/commit/e32cbe77e42038c878d3aac220c65b2b5816d812", "message": "FINERACT-822 Integrating Error Prone", "committedDate": "2020-05-28T03:55:07Z", "type": "commit"}, {"oid": "e32cbe77e42038c878d3aac220c65b2b5816d812", "url": "https://github.com/apache/fineract/commit/e32cbe77e42038c878d3aac220c65b2b5816d812", "message": "FINERACT-822 Integrating Error Prone", "committedDate": "2020-05-28T03:55:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MDg4Mg==", "url": "https://github.com/apache/fineract/pull/830#discussion_r431970882", "bodyText": "if I understand you correctly, you want to chop this up into multiple PRs by enabling/uncommenting one or a few rules at a time and fixing them?", "author": "awasum", "createdAt": "2020-05-28T16:33:03Z", "path": "fineract-provider/build.gradle", "diffHunk": "@@ -278,6 +280,88 @@ configurations {\n tasks.withType(JavaCompile) {\n     options.compilerArgs += [\"-Xlint:unchecked\",\"-Xlint:cast\",\"-Werror\"] // TODO FINERACT-959 (gradually) enable -Xlint:all (see \"javac -help -X\")\n     options.deprecation = true\n+    options.errorprone {\n+        disableWarningsInGeneratedCode = true\n+        //Todo Remove necessary checks from this list\n+        disable(\"UnusedVariable\",\n+                \"VariableNameSameAsType\",\n+                \"InconsistentCapitalization\",\n+                \"UnnecessaryParentheses\",\n+                \"ClassCanBeStatic\",\n+                \"MissingCasesInEnumSwitch\",\n+                \"CompareToZero\",\n+                \"OperatorPrecedence\",\n+                \"MixedMutabilityReturnType\",\n+                \"SameNameButDifferent\",\n+                \"EqualsGetClass\",\n+                \"ReferenceEquality\",\n+                \"StringSplitter\",\n+                \"MissingOverride\",\n+                \"BigDecimalEquals\",\n+                \"ImmutableEnumChecker\",\n+                \"EqualsUnsafeCast\",\n+                \"AssertEqualsArgumentOrderChecker\",\n+                \"BoxedPrimitiveEquality\",\n+                \"BadImport\",\n+                \"UnusedMethod\",\n+                \"ModifiedButNotUsed\",\n+                \"ArgumentSelectionDefectChecker\",\n+                \"JodaPlusMinusLong\",\n+                \"TypeParameterUnusedInFormals\",\n+                \"DoubleBraceInitialization\",\n+                \"UnusedNestedClass\",\n+                \"UndefinedEquals\",\n+                \"JdkObsolete\",\n+                \"OperatorPrecedence\",\n+                \"NarrowingCompoundAssignment\"\n+        )\n+        //TODO gradually enable these checks\n+        error(  \"DefaultCharset\",", "originalCommit": "e32cbe77e42038c878d3aac220c65b2b5816d812", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MTM1Nw==", "url": "https://github.com/apache/fineract/pull/830#discussion_r431971357", "bodyText": "Yeah", "author": "percyashu", "createdAt": "2020-05-28T16:33:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MDg4Mg=="}], "type": "inlineReview"}]}