{"pr_number": 1292, "pr_title": "FINERACT-1129: Gradle task to create release package", "pr_createdAt": "2020-08-26T18:53:15Z", "pr_url": "https://github.com/apache/fineract/pull/1292", "timeline": [{"oid": "ccd9601cd02038499d507d71ec71269549acf516", "url": "https://github.com/apache/fineract/commit/ccd9601cd02038499d507d71ec71269549acf516", "message": "Add release task", "committedDate": "2020-08-25T22:09:37Z", "type": "commit"}, {"oid": "9b65dbe06a6a6743d9fae9e5e0be2985356cc9f8", "url": "https://github.com/apache/fineract/commit/9b65dbe06a6a6743d9fae9e5e0be2985356cc9f8", "message": "Trying to add client JAR to release for #FINERACT-1129 (relates to #FINERACT-1102)", "committedDate": "2020-08-26T11:58:21Z", "type": "commit"}, {"oid": "718fca6e48740776b18d16a59459ab17c1677802", "url": "https://github.com/apache/fineract/commit/718fca6e48740776b18d16a59459ab17c1677802", "message": "Removed extra release task and replaced with simple project property flag; fixes #FINERACT-1129", "committedDate": "2020-08-26T15:57:52Z", "type": "commit"}, {"oid": "0591fc22f45f4b23d35325b46d0c17c82721a73b", "url": "https://github.com/apache/fineract/commit/0591fc22f45f4b23d35325b46d0c17c82721a73b", "message": "Merge branch 'develop' into feature/FINERACT-1129", "committedDate": "2020-08-26T16:55:45Z", "type": "commit"}, {"oid": "1d83359249447f3b4af652c96e2a25b4b6f1d7b3", "url": "https://github.com/apache/fineract/commit/1d83359249447f3b4af652c96e2a25b4b6f1d7b3", "message": "Add Fineract client to release distribution", "committedDate": "2020-08-26T22:02:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxNjY2MA==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r477916660", "bodyText": "To avoid exactly this, is it possible to instruct people instead to pass these as command line parameters when they run the build?", "author": "ptuomola", "createdAt": "2020-08-27T02:02:33Z", "path": "README.md", "diffHunk": "@@ -353,6 +353,41 @@ Releasing\n \n [How to Release Apache Fineract](https://cwiki.apache.org/confluence/x/DRwIB) documents the process how we make the source code that is available here in this Git repository into a binary release ZIP available on http://fineract.apache.org.\n \n+Before you use Gradle to create a release you need to make sure that your GPG is properly setup and that you have set the following properties in your ~/gradle/gradle.properties:\n+```\n+signing.gnupg.keyName=7890ABCD\n+signing.gnupg.passphrase=secret\n+```\n+\n+IMPORTANT: Do not set your GPG secrets in one of the project gradle.properties and double check that you are not accidentally committing them to Git.\n+", "originalCommit": "1d83359249447f3b4af652c96e2a25b4b6f1d7b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIxODIyOA==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478218228", "bodyText": "You can do this anyway. Personally I prefer to set this up with my personal gradle.properties in my home folder, but it's not required; you can just pass the required parameters with \"-P\" on the command line and it'll work as well.", "author": "vidakovic", "createdAt": "2020-08-27T07:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxNjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyODA0Mg==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478228042", "bodyText": "Thanks. I know you can do this either way, I just wondered if it would be better in the README to suggest that way - rather than suggest that people put it in gradle.properties AND warn them not to check it in. If the suggested way is to use command line there's no risk that people will check anything in.", "author": "ptuomola", "createdAt": "2020-08-27T07:56:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxNjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MTcyNA==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478241724", "bodyText": "I've added a clarification to the README describing both ways to provide the necessary parameters (either in your home gradle.properties or via command line).", "author": "vidakovic", "createdAt": "2020-08-27T08:20:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxNjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0ODM4Mg==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478248382", "bodyText": "This section is anyway only intended for a limited audience (I think there are 3 or 4 people right now that can sign the releases). But you have a point here. Happy to change the default recommendation for the next release. Maybe you can raise that issue then on the mailing list to see what others have to contribute on that subject?", "author": "vidakovic", "createdAt": "2020-08-27T08:31:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxNjY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxODgwNQ==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r477918805", "bodyText": "Would it be cleaner to have a specific distribution task that does all the distribution activities (package and signing etc), rather than relying on the build task and a new profile?", "author": "ptuomola", "createdAt": "2020-08-27T02:04:04Z", "path": "README.md", "diffHunk": "@@ -353,6 +353,41 @@ Releasing\n \n [How to Release Apache Fineract](https://cwiki.apache.org/confluence/x/DRwIB) documents the process how we make the source code that is available here in this Git repository into a binary release ZIP available on http://fineract.apache.org.\n \n+Before you use Gradle to create a release you need to make sure that your GPG is properly setup and that you have set the following properties in your ~/gradle/gradle.properties:\n+```\n+signing.gnupg.keyName=7890ABCD\n+signing.gnupg.passphrase=secret\n+```\n+\n+IMPORTANT: Do not set your GPG secrets in one of the project gradle.properties and double check that you are not accidentally committing them to Git.\n+\n+NOTE: Let's assume your GPG key ID would be \"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890ABCD\" then you have to use the last 8 characters (i. e. \"7890ABCD\") for the signing plugin property \"signing.gnupg.keyName\". \n+\n+Execute the following task to create a distribution with an ASCII armored signature (.asc) and a SHA512 checksum file (.sha512):\n+```\n+./gradlew -Pfineract.release clean build \n+```", "originalCommit": "1d83359249447f3b4af652c96e2a25b4b6f1d7b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyMDkyNQ==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478220925", "bodyText": "I had that conversation with \u00a0@edcable and it was preferred to include this \"naturally\" (i. e. without a specific task) in the build process. Note: the release artifacts are only created when \"-Pfineract.release\" is provided on the command line which is pretty explicit. For the next release I intend to add even more features here (publishing client jar on Maven Central, uploading distribution to Apache, maybe publishing release Confluence page).", "author": "vidakovic", "createdAt": "2020-08-27T07:42:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxODgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIzMDI2MQ==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478230261", "bodyText": "OK - if it's been decided, then that's fine. Personally I would have preferred that all different activities are triggered as tasks: it's a bit confusing now that all other activities are triggered as tasks and only these with a profile.\nAlso as far as I know, you can only have one profile active - correct? So if in the future we want to have different types of builds activated as profiles, you can't create distributions of them.", "author": "ptuomola", "createdAt": "2020-08-27T07:59:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxODgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1MjcyNA==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478252724", "bodyText": "My first \"reflex\" was also to add an explicit task, but have to say that I'm not necessarily opposed to the way it's now (aka as a side effect of the distribution task). Having said that: given the short time frame I made a couple of lone decisions so I think it makes a lot of sense to present this to a broader audience (mailing list) and let them have a say how this should look like for the next release.\nFor now I just wanted to have something that helps me during the release.\nI'm not sure how this (creating the release via a command line parameter) would impede different profiles? Let's discuss this on the mailing list or maybe in a separate Jira ticket?", "author": "vidakovic", "createdAt": "2020-08-27T08:38:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxODgwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxOTcwMA==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r477919700", "bodyText": "Would it make sense to include this in the distribution task as well - so that this gets automatically ran and the user just has to review the output?", "author": "ptuomola", "createdAt": "2020-08-27T02:04:47Z", "path": "README.md", "diffHunk": "@@ -353,6 +353,41 @@ Releasing\n \n [How to Release Apache Fineract](https://cwiki.apache.org/confluence/x/DRwIB) documents the process how we make the source code that is available here in this Git repository into a binary release ZIP available on http://fineract.apache.org.\n \n+Before you use Gradle to create a release you need to make sure that your GPG is properly setup and that you have set the following properties in your ~/gradle/gradle.properties:\n+```\n+signing.gnupg.keyName=7890ABCD\n+signing.gnupg.passphrase=secret\n+```\n+\n+IMPORTANT: Do not set your GPG secrets in one of the project gradle.properties and double check that you are not accidentally committing them to Git.\n+\n+NOTE: Let's assume your GPG key ID would be \"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890ABCD\" then you have to use the last 8 characters (i. e. \"7890ABCD\") for the signing plugin property \"signing.gnupg.keyName\". \n+\n+Execute the following task to create a distribution with an ASCII armored signature (.asc) and a SHA512 checksum file (.sha512):\n+```\n+./gradlew -Pfineract.release clean build \n+```\n+\n+Above task will create the following files in folder build/distributions:\n+\n+- distribution file: apache-fineract-1.4.0-binary.tar.gz\n+- ASCII armored signatures: apache-fineract-1.4.0-binary.tar.gz.asc\n+- SHA512 checksum: apache-fineract-1.4.0-binary.tar.gz.sha512\n+\n+Verify the validity of the release distribution with:\n+```\n+gpg --verify build/distributions/apache-fineract-1.4.0-binary.tar.gz.asc\n+```", "originalCommit": "1d83359249447f3b4af652c96e2a25b4b6f1d7b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyMTY0Mg==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478221642", "bodyText": "Good point, I'll add this.", "author": "vidakovic", "createdAt": "2020-08-27T07:44:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxOTcwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkyMjMzMg==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r477922332", "bodyText": "Here we have the version hardcoded - for the Swagger documentation we pick it automatically from the git describe output. We should probably make this consistent and use one or the other...", "author": "ptuomola", "createdAt": "2020-08-27T02:06:44Z", "path": "fineract-provider/gradle.properties", "diffHunk": "@@ -16,5 +16,5 @@\n # specific language governing permissions and limitations\n # under the License.\n #\n-releaseVersion=1.0.0\n+releaseVersion=1.4.0\n buildType=BUILD", "originalCommit": "1d83359249447f3b4af652c96e2a25b4b6f1d7b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyNDEwMw==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478224103", "bodyText": "I saw that you use a Gradle version plugin to do this and I actually prefer that way. For this release I'll leave it to the hard coded version number, but would suggest your method for the whole project. Note: the version of the client JAR in the release branch is not correct (shows something like \"client-1.3.0-xyz-dirty.jar\"; I do understand that it creates that based on the last release tag; we just have to make sure that this works correctly when the release build is running (release tag 1.4.0 has to exist).", "author": "vidakovic", "createdAt": "2020-08-27T07:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkyMjMzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyODg3OA==", "url": "https://github.com/apache/fineract/pull/1292#discussion_r478228878", "bodyText": "Yes - good point, please let's make sure it works correctly when you do the release build. If not happy to help fix it if needed.", "author": "ptuomola", "createdAt": "2020-08-27T07:57:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkyMjMzMg=="}], "type": "inlineReview"}, {"oid": "db2da98c7d2fff0a64a852b1c327e0bc01543fe6", "url": "https://github.com/apache/fineract/commit/db2da98c7d2fff0a64a852b1c327e0bc01543fe6", "message": "Add automatic signature verification, clarify release signing parameter setup.", "committedDate": "2020-08-27T09:28:19Z", "type": "commit"}, {"oid": "7e06f019f81e876d41c4378f1cfcf6b082f91182", "url": "https://github.com/apache/fineract/commit/7e06f019f81e876d41c4378f1cfcf6b082f91182", "message": "Merge branch 'develop' into feature/FINERACT-1129", "committedDate": "2020-08-27T12:19:56Z", "type": "commit"}, {"oid": "05fb09a76499b71f7f1f4bab74a468592ba757a9", "url": "https://github.com/apache/fineract/commit/05fb09a76499b71f7f1f4bab74a468592ba757a9", "message": "Minor fix SHA-512 checksum file extension (ensure all lower cased as per Apache requirements)", "committedDate": "2020-08-27T13:15:05Z", "type": "commit"}]}