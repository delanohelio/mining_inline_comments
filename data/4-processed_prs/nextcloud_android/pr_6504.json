{"pr_number": 6504, "pr_title": "Sharing part2", "pr_createdAt": "2020-07-21T12:40:41Z", "pr_url": "https://github.com/nextcloud/android/pull/6504", "timeline": [{"oid": "92ce3400d05f15c97f9675d9bcdf97fba07823bf", "url": "https://github.com/nextcloud/android/commit/92ce3400d05f15c97f9675d9bcdf97fba07823bf", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-04T11:10:50Z", "type": "forcePushed"}, {"oid": "f98ce1649c47ad7f31d85b388ff0d4dfe1450f3a", "url": "https://github.com/nextcloud/android/commit/f98ce1649c47ad7f31d85b388ff0d4dfe1450f3a", "message": "Fix npe on computing enough space with non-downloaded folder content\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-08T10:28:37Z", "type": "forcePushed"}, {"oid": "8349807bd360a464c1efe7430e88eac14273ee47", "url": "https://github.com/nextcloud/android/commit/8349807bd360a464c1efe7430e88eac14273ee47", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-08T10:29:26Z", "type": "forcePushed"}, {"oid": "82d36f0cab47f10c6042df1c4c768748b4b84835", "url": "https://github.com/nextcloud/android/commit/82d36f0cab47f10c6042df1c4c768748b4b84835", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "20d24d8a6d320303056079fcf2c27f7fc1616eee", "url": "https://github.com/nextcloud/android/commit/20d24d8a6d320303056079fcf2c27f7fc1616eee", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "996b0f0e67112a267712f89d0fae03e8a982fcad", "url": "https://github.com/nextcloud/android/commit/996b0f0e67112a267712f89d0fae03e8a982fcad", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "a470bd1f56278c9cc09cd2d5ece7b0d395e45cde", "url": "https://github.com/nextcloud/android/commit/a470bd1f56278c9cc09cd2d5ece7b0d395e45cde", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "4f8de5731d675d764adde24da1b9b51f62b300e5", "url": "https://github.com/nextcloud/android/commit/4f8de5731d675d764adde24da1b9b51f62b300e5", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "7b2ed741bd684f98ca5ca1beb5fe62d91571babf", "url": "https://github.com/nextcloud/android/commit/7b2ed741bd684f98ca5ca1beb5fe62d91571babf", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "8b6171361a22d3d937cc2f414d8ca70e5434650a", "url": "https://github.com/nextcloud/android/commit/8b6171361a22d3d937cc2f414d8ca70e5434650a", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "4dfefee31ad09b7ddf6eff2d7c04ea973ff7ccca", "url": "https://github.com/nextcloud/android/commit/4dfefee31ad09b7ddf6eff2d7c04ea973ff7ccca", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "01f27dd08cb079d7a8c1efeb9c99859f5416e6fb", "url": "https://github.com/nextcloud/android/commit/01f27dd08cb079d7a8c1efeb9c99859f5416e6fb", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "32624611003d42fbde1ca0ae7a285f8458de3f06", "url": "https://github.com/nextcloud/android/commit/32624611003d42fbde1ca0ae7a285f8458de3f06", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "d6d0c5939cf7198cfda775a7ace6f11d9f6fdfcb", "url": "https://github.com/nextcloud/android/commit/d6d0c5939cf7198cfda775a7ace6f11d9f6fdfcb", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "bd3f22f65dbdbb74bc229f33e32637e1b4f4bf9e", "url": "https://github.com/nextcloud/android/commit/bd3f22f65dbdbb74bc229f33e32637e1b4f4bf9e", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:35Z", "type": "commit"}, {"oid": "50c7635869e8cd096429555bdd71712710019ced", "url": "https://github.com/nextcloud/android/commit/50c7635869e8cd096429555bdd71712710019ced", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:49Z", "type": "commit"}, {"oid": "a6c898d2a529be9c2434458cfb7beca2a5a99629", "url": "https://github.com/nextcloud/android/commit/a6c898d2a529be9c2434458cfb7beca2a5a99629", "message": "cleanup\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:52Z", "type": "commit"}, {"oid": "1a32e9b268c5b5a122444130402af214e8749404", "url": "https://github.com/nextcloud/android/commit/1a32e9b268c5b5a122444130402af214e8749404", "message": "detekt\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:52Z", "type": "commit"}, {"oid": "0d942cca55c1e0c7c0f4f225699cbd818a603f46", "url": "https://github.com/nextcloud/android/commit/0d942cca55c1e0c7c0f4f225699cbd818a603f46", "message": "ktlint\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:52Z", "type": "commit"}, {"oid": "be357db8f1d83f4089fa398fec1e2b7b4b92edfa", "url": "https://github.com/nextcloud/android/commit/be357db8f1d83f4089fa398fec1e2b7b4b92edfa", "message": "codacy\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:52Z", "type": "commit"}, {"oid": "be357db8f1d83f4089fa398fec1e2b7b4b92edfa", "url": "https://github.com/nextcloud/android/commit/be357db8f1d83f4089fa398fec1e2b7b4b92edfa", "message": "codacy\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T11:06:52Z", "type": "forcePushed"}, {"oid": "6c7b96db531cb06f12c469e8c4ca23345b8bdbc8", "url": "https://github.com/nextcloud/android/commit/6c7b96db531cb06f12c469e8c4ca23345b8bdbc8", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-09T14:37:20Z", "type": "commit"}, {"oid": "c8a49d99ba53c065fa8da78d760793b1634944f9", "url": "https://github.com/nextcloud/android/commit/c8a49d99ba53c065fa8da78d760793b1634944f9", "message": "Merge remote-tracking branch 'remotes/origin/master' into sharingPart2\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-22T06:14:43Z", "type": "commit"}, {"oid": "c8a49d99ba53c065fa8da78d760793b1634944f9", "url": "https://github.com/nextcloud/android/commit/c8a49d99ba53c065fa8da78d760793b1634944f9", "message": "Merge remote-tracking branch 'remotes/origin/master' into sharingPart2\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-22T06:14:43Z", "type": "forcePushed"}, {"oid": "98c963cb10501351b66dd694550c8572ef06c64e", "url": "https://github.com/nextcloud/android/commit/98c963cb10501351b66dd694550c8572ef06c64e", "message": "Drone: update Lint results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>", "committedDate": "2020-09-22T06:25:59Z", "type": "commit"}, {"oid": "f7e711d98d8fb23c3a1f2c7beb6f14ee4060406f", "url": "https://github.com/nextcloud/android/commit/f7e711d98d8fb23c3a1f2c7beb6f14ee4060406f", "message": "Update DocumentsProvider roots when enabling/disabling app lock feature\n\nSigned-off-by: Torsten Grote <t@grobox.de>", "committedDate": "2020-09-22T19:50:10Z", "type": "commit"}, {"oid": "c1a406f3957c440afc60c7505db728c992754817", "url": "https://github.com/nextcloud/android/commit/c1a406f3957c440afc60c7505db728c992754817", "message": "Add automerge for dependabot\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T05:22:08Z", "type": "commit"}, {"oid": "2782468a1b91eb8f5138af865744174bf57aadaf", "url": "https://github.com/nextcloud/android/commit/2782468a1b91eb8f5138af865744174bf57aadaf", "message": "Merge pull request #6995 from nextcloud/autoApprove\n\nAdd auto-approve for dependabot", "committedDate": "2020-09-23T05:23:47Z", "type": "commit"}, {"oid": "63da455635d5a4e44321d3a9f4eec6fe028885d8", "url": "https://github.com/nextcloud/android/commit/63da455635d5a4e44321d3a9f4eec6fe028885d8", "message": "Merge pull request #6991 from nextcloud/6882-passcode-update-roots\n\nUpdate DocumentsProvider roots when enabling/disabling app lock feature", "committedDate": "2020-09-23T05:27:50Z", "type": "commit"}, {"oid": "c95615aeaa7090c5b4e6e07fdd6e790af31a5b00", "url": "https://github.com/nextcloud/android/commit/c95615aeaa7090c5b4e6e07fdd6e790af31a5b00", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T06:14:35Z", "type": "commit"}, {"oid": "b516eaf6574c4186259dffd7e345709d5a76343f", "url": "https://github.com/nextcloud/android/commit/b516eaf6574c4186259dffd7e345709d5a76343f", "message": "Merge commit 'c95615aeaa7090c5b4e6e07fdd6e790af31a5b00'", "committedDate": "2020-09-23T06:14:57Z", "type": "commit"}, {"oid": "58e16bcbbe2484e2688b2f43107c950b7ec013f3", "url": "https://github.com/nextcloud/android/commit/58e16bcbbe2484e2688b2f43107c950b7ec013f3", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>", "committedDate": "2020-09-23T06:25:08Z", "type": "commit"}, {"oid": "6a1292d6902d66dca13767e800f104f544bd1338", "url": "https://github.com/nextcloud/android/commit/6a1292d6902d66dca13767e800f104f544bd1338", "message": "Rename .java to .kt\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T07:26:04Z", "type": "commit"}, {"oid": "92070d2934d32ba09bffa90231a4f91a3ec98dfd", "url": "https://github.com/nextcloud/android/commit/92070d2934d32ba09bffa90231a4f91a3ec98dfd", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T07:26:04Z", "type": "commit"}, {"oid": "07bb37ab7a39704ab7f5479905d3a9de8ed81cfd", "url": "https://github.com/nextcloud/android/commit/07bb37ab7a39704ab7f5479905d3a9de8ed81cfd", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T07:26:49Z", "type": "commit"}, {"oid": "ed90d07a17642c82e982e6e4463ba2b97f4e46a3", "url": "https://github.com/nextcloud/android/commit/ed90d07a17642c82e982e6e4463ba2b97f4e46a3", "message": "detekt, ktlint\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T07:39:58Z", "type": "commit"}, {"oid": "5c9f5a5c4f633b693ccd0367032f65cf6573c794", "url": "https://github.com/nextcloud/android/commit/5c9f5a5c4f633b693ccd0367032f65cf6573c794", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T08:08:38Z", "type": "commit"}, {"oid": "7fdda6ace0b5e6900a57ce5b5e62445bf5a889f6", "url": "https://github.com/nextcloud/android/commit/7fdda6ace0b5e6900a57ce5b5e62445bf5a889f6", "message": "use new server for tests\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T09:22:45Z", "type": "commit"}, {"oid": "e70aedaae75e4793c6ee1d310c06c249ee80554f", "url": "https://github.com/nextcloud/android/commit/e70aedaae75e4793c6ee1d310c06c249ee80554f", "message": "wip\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-09-23T13:52:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNTA2NQ==", "url": "https://github.com/nextcloud/android/pull/6504#discussion_r493615065", "bodyText": "Codacy found an issue: Assigning an Object to null is a code smell.  Consider refactoring.", "author": "nextcloud-android-bot", "createdAt": "2020-09-23T13:58:14Z", "path": "src/main/java/com/owncloud/android/ui/fragment/FileDetailSharingFragment.java", "diffHunk": "@@ -184,38 +153,37 @@ public void onActivityCreated(Bundle savedInstanceState) {\n         super.onActivityCreated(savedInstanceState);\n \n         refreshCapabilitiesFromDB();\n-        refreshPublicShareFromDB();\n+        refreshSharesFromDB();\n     }\n \n     @Override\n     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n-        View view = inflater.inflate(R.layout.file_details_sharing_fragment, container, false);\n-        unbinder = ButterKnife.bind(this, view);\n+        binding = FileDetailsSharingFragmentBinding.inflate(inflater, container, false);\n+        View view = binding.getRoot();\n \n         fileOperationsHelper = fileActivity.getFileOperationsHelper();\n         fileDataStorageManager = fileActivity.getStorageManager();\n \n-        setupView();\n+        AccountManager accountManager = AccountManager.get(getContext());\n+        String userId = accountManager.getUserData(user.toPlatformAccount(),\n+                                                   com.owncloud.android.lib.common.accounts.AccountUtils.Constants.KEY_USER_ID);\n \n-        // todo extract\n-        internalLinkIcon.getBackground().setColorFilter(getResources().getColor(R.color.grey_db),\n-                                                        PorterDuff.Mode.SRC_IN);\n-        internalLinkIcon.getDrawable().mutate().setColorFilter(getResources().getColor(R.color.black),\n-                                                               PorterDuff.Mode.SRC_IN);\n+        binding.sharesList.setAdapter(new ShareeListAdapter(fileActivity,\n+                                                            new ArrayList<>(),\n+                                                            this,\n+                                                            userId));\n+        binding.sharesList.setLayoutManager(new LinearLayoutManager(getContext()));\n+        binding.sharesList.addItemDecoration(new SimpleListItemDividerDecoration(getContext()));\n \n-        if (file.isFolder()) {\n-            internalLinkText.setText(getString(R.string.share_internal_link_to_folder_text));\n-        } else {\n-            internalLinkText.setText(getString(R.string.share_internal_link_to_file_text));\n-        }\n+        setupView();\n \n         return view;\n     }\n \n     @Override\n     public void onDestroy() {\n         super.onDestroy();\n-        unbinder.unbind();\n+        binding = null;", "originalCommit": "e70aedaae75e4793c6ee1d310c06c249ee80554f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNTA3OA==", "url": "https://github.com/nextcloud/android/pull/6504#discussion_r493615078", "bodyText": "Codacy found an issue: Possible God Class (WMC=99, ATFD=285, TCC=25.371%)", "author": "nextcloud-android-bot", "createdAt": "2020-09-23T13:58:16Z", "path": "src/main/java/com/owncloud/android/ui/fragment/FileDetailSharingFragment.java", "diffHunk": "@@ -70,25 +68,29 @@\n import com.owncloud.android.utils.DisplayUtils;\n import com.owncloud.android.utils.ThemeUtils;\n \n+import java.util.ArrayList;\n import java.util.List;\n \n import javax.inject.Inject;\n \n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.annotation.VisibleForTesting;\n import androidx.appcompat.widget.PopupMenu;\n-import androidx.appcompat.widget.SearchView;\n import androidx.fragment.app.Fragment;\n import androidx.recyclerview.widget.LinearLayoutManager;\n-import androidx.recyclerview.widget.RecyclerView;\n-import butterknife.BindView;\n-import butterknife.ButterKnife;\n-import butterknife.OnClick;\n-import butterknife.Unbinder;\n \n-public class FileDetailSharingFragment extends Fragment implements ShareeListAdapter.ShareeListAdapterListener,\n+import static com.owncloud.android.lib.resources.shares.OCShare.CREATE_PERMISSION_FLAG;\n+import static com.owncloud.android.lib.resources.shares.OCShare.DELETE_PERMISSION_FLAG;\n+import static com.owncloud.android.lib.resources.shares.OCShare.MAXIMUM_PERMISSIONS_FOR_FILE;\n+import static com.owncloud.android.lib.resources.shares.OCShare.MAXIMUM_PERMISSIONS_FOR_FOLDER;\n+import static com.owncloud.android.lib.resources.shares.OCShare.NO_PERMISSION;\n+import static com.owncloud.android.lib.resources.shares.OCShare.READ_PERMISSION_FLAG;\n+import static com.owncloud.android.lib.resources.shares.OCShare.SHARE_PERMISSION_FLAG;\n+import static com.owncloud.android.lib.resources.shares.OCShare.UPDATE_PERMISSION_FLAG;\n+\n+public class FileDetailSharingFragment extends Fragment implements ShareeListAdapterListener,", "originalCommit": "e70aedaae75e4793c6ee1d310c06c249ee80554f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNTEwMA==", "url": "https://github.com/nextcloud/android/pull/6504#discussion_r493615100", "bodyText": "Codacy found an issue: Assigning an Object to null is a code smell.  Consider refactoring.", "author": "nextcloud-android-bot", "createdAt": "2020-09-23T13:58:17Z", "path": "src/main/java/com/owncloud/android/ui/dialog/SharePasswordDialogFragment.java", "diffHunk": "@@ -217,4 +209,10 @@ private void setPassword(boolean createShare, OCFile file, String password) {\n     private void setPassword(OCShare share, String password) {\n         ((FileActivity) getActivity()).getFileOperationsHelper().setPasswordToShare(share, password);\n     }\n+\n+    @Override\n+    public void onDestroyView() {\n+        super.onDestroyView();\n+        binding = null;", "originalCommit": "e70aedaae75e4793c6ee1d310c06c249ee80554f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}