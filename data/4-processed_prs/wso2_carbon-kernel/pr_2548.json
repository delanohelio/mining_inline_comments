{"pr_number": 2548, "pr_title": "Cache resolving user ID from user name and user name from user ID", "pr_createdAt": "2020-01-24T09:14:26Z", "pr_url": "https://github.com/wso2/carbon-kernel/pull/2548", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNDg3Mw==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r370534873", "bodyText": "why this is in else statement? We should add to cache just after getting from DB.", "author": "IsuraD", "createdAt": "2020-01-24T09:17:40Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -11702,21 +11708,36 @@ protected boolean isUserIdGeneratedByUserStore(String userName, Map<String, Stri\n      */\n     public String getUserIDFromUserName(String userName) throws UserStoreException {\n \n+        String userID;\n         UserStore userStore = getUserStore(userName);\n         if (userStore.isRecurssive()) {\n             return ((AbstractUserStoreManager) userStore.getUserStoreManager())\n                     .getUserIDFromUserName(userStore.getDomainFreeName());\n         }\n \n         if (isUniqueUserIdEnabledInUserStore(userStore)) {\n-            return doGetUserIDFromUserNameWithID(userStore.getDomainFreeName());\n+            userID = AbstractUserStoreManagerCache.getInstance().getValueFromCache(userName,\n+                    RESOLVE_USER_ID_FROM_USER_NAME_CACHE_NAME);\n+            if (StringUtils.isEmpty(userID)){\n+                return doGetUserIDFromUserNameWithID(userStore.getDomainFreeName());\n+            } else {\n+                AbstractUserStoreManagerCache.getInstance().addToCache(userName, userID,", "originalCommit": "c952d3e331de78e54b11a1bb2d450bf215101d92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExNTY3Mg==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371115672", "bodyText": "fixed", "author": "Buddhimah", "createdAt": "2020-01-27T08:46:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNDg3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNTE0NA==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r370535144", "bodyText": "Why in else statement?", "author": "IsuraD", "createdAt": "2020-01-24T09:18:22Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -11702,21 +11708,36 @@ protected boolean isUserIdGeneratedByUserStore(String userName, Map<String, Stri\n      */\n     public String getUserIDFromUserName(String userName) throws UserStoreException {\n \n+        String userID;\n         UserStore userStore = getUserStore(userName);\n         if (userStore.isRecurssive()) {\n             return ((AbstractUserStoreManager) userStore.getUserStoreManager())\n                     .getUserIDFromUserName(userStore.getDomainFreeName());\n         }\n \n         if (isUniqueUserIdEnabledInUserStore(userStore)) {\n-            return doGetUserIDFromUserNameWithID(userStore.getDomainFreeName());\n+            userID = AbstractUserStoreManagerCache.getInstance().getValueFromCache(userName,\n+                    RESOLVE_USER_ID_FROM_USER_NAME_CACHE_NAME);\n+            if (StringUtils.isEmpty(userID)){\n+                return doGetUserIDFromUserNameWithID(userStore.getDomainFreeName());\n+            } else {\n+                AbstractUserStoreManagerCache.getInstance().addToCache(userName, userID,\n+                        RESOLVE_USER_ID_FROM_USER_NAME_CACHE_NAME);\n+            }\n         }\n \n         Map<String, String> claims = doGetUserClaimValues(userName,\n                 new String[]{UserCoreClaimConstants.USER_ID_CLAIM_URI},\n                 userStore.getDomainName(), null);\n         if (claims != null && claims.size() == 1) {\n-            return claims.get(UserCoreClaimConstants.USER_ID_CLAIM_URI);\n+            userID = AbstractUserStoreManagerCache.getInstance().getValueFromCache(userName,\n+                    RESOLVE_USER_NAME_FROM_USER_ID_CACHE_NAME);\n+            if (StringUtils.isEmpty(userID)) {\n+                return claims.get(UserCoreClaimConstants.USER_ID_CLAIM_URI);\n+            } else {\n+                AbstractUserStoreManagerCache.getInstance().addToCache(userName, userID,", "originalCommit": "c952d3e331de78e54b11a1bb2d450bf215101d92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExNTY1NQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371115655", "bodyText": "fixed", "author": "Buddhimah", "createdAt": "2020-01-27T08:46:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNTE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNjg1MA==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r370536850", "bodyText": "why AbstractUserStoreManagerCache?", "author": "IsuraD", "createdAt": "2020-01-24T09:22:25Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManagerCache.java", "diffHunk": "@@ -0,0 +1,170 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.carbon.user.core.common;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import javax.cache.Cache;\n+import javax.cache.CacheManager;\n+import javax.cache.Caching;\n+\n+/**\n+ * Handle Cache in Abstract User Store Manager.\n+ */\n+public class AbstractUserStoreManagerCache {", "originalCommit": "c952d3e331de78e54b11a1bb2d450bf215101d92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExNTYzMA==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371115630", "bodyText": "changed the name", "author": "Buddhimah", "createdAt": "2020-01-27T08:46:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNjg1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNjk2Mw==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r370536963", "bodyText": "UserIdResolverCache", "author": "IsuraD", "createdAt": "2020-01-24T09:22:42Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManagerCache.java", "diffHunk": "@@ -0,0 +1,170 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.carbon.user.core.common;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import javax.cache.Cache;\n+import javax.cache.CacheManager;\n+import javax.cache.Caching;\n+\n+/**\n+ * Handle Cache in Abstract User Store Manager.\n+ */\n+public class AbstractUserStoreManagerCache {", "originalCommit": "c952d3e331de78e54b11a1bb2d450bf215101d92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExNTU1MA==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371115550", "bodyText": "fixed", "author": "Buddhimah", "createdAt": "2020-01-27T08:46:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzNjk2Mw=="}], "type": "inlineReview"}, {"oid": "125d601f7e90a4fa8a95f3353973262ca2d217c3", "url": "https://github.com/wso2/carbon-kernel/commit/125d601f7e90a4fa8a95f3353973262ca2d217c3", "message": "Cache abstract user store Manager", "committedDate": "2020-01-24T11:21:15Z", "type": "forcePushed"}, {"oid": "47c13350c82b77a2d27e471201ef7603bedf0542", "url": "https://github.com/wso2/carbon-kernel/commit/47c13350c82b77a2d27e471201ef7603bedf0542", "message": "Cache abstract user store Manager", "committedDate": "2020-01-27T07:14:35Z", "type": "forcePushed"}, {"oid": "dfac1c74a6e9a88400aecf64cf5bd8b0507950c7", "url": "https://github.com/wso2/carbon-kernel/commit/dfac1c74a6e9a88400aecf64cf5bd8b0507950c7", "message": "Cache abstract user store Manager", "committedDate": "2020-01-27T07:16:41Z", "type": "forcePushed"}, {"oid": "282b444e659f8a5305d195cfc6e781a4603480f4", "url": "https://github.com/wso2/carbon-kernel/commit/282b444e659f8a5305d195cfc6e781a4603480f4", "message": "Cache abstract user store Manager", "committedDate": "2020-01-27T08:43:13Z", "type": "forcePushed"}, {"oid": "e018ed6f6567c3d119555aa3f4c15117867bbf0e", "url": "https://github.com/wso2/carbon-kernel/commit/e018ed6f6567c3d119555aa3f4c15117867bbf0e", "message": "Cache abstract user store Manager", "committedDate": "2020-01-27T13:37:31Z", "type": "commit"}, {"oid": "e018ed6f6567c3d119555aa3f4c15117867bbf0e", "url": "https://github.com/wso2/carbon-kernel/commit/e018ed6f6567c3d119555aa3f4c15117867bbf0e", "message": "Cache abstract user store Manager", "committedDate": "2020-01-27T13:37:31Z", "type": "forcePushed"}, {"oid": "4461ae4297916a58f40d8d4c7d8ff179ce3d76de", "url": "https://github.com/wso2/carbon-kernel/commit/4461ae4297916a58f40d8d4c7d8ff179ce3d76de", "message": "Return if key exsists in the cache", "committedDate": "2020-01-27T14:25:41Z", "type": "commit"}, {"oid": "06f431e5663b50a2709e25c18528c07a6fc4fe40", "url": "https://github.com/wso2/carbon-kernel/commit/06f431e5663b50a2709e25c18528c07a6fc4fe40", "message": "Extract add to cache logic", "committedDate": "2020-01-27T14:49:53Z", "type": "commit"}, {"oid": "e73cd8954d8f11a513953e086c18324ef2a2dfd2", "url": "https://github.com/wso2/carbon-kernel/commit/e73cd8954d8f11a513953e086c18324ef2a2dfd2", "message": "Extract get from cache logic", "committedDate": "2020-01-27T15:04:08Z", "type": "commit"}, {"oid": "e73cd8954d8f11a513953e086c18324ef2a2dfd2", "url": "https://github.com/wso2/carbon-kernel/commit/e73cd8954d8f11a513953e086c18324ef2a2dfd2", "message": "Extract get from cache logic", "committedDate": "2020-01-27T15:04:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYwMDcwOQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371600709", "bodyText": "Better to move doGetUserClaimValues only if the cache is empty. Otherwise, that execution is redundant.", "author": "IsuraD", "createdAt": "2020-01-28T04:04:09Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -11702,21 +11709,34 @@ protected boolean isUserIdGeneratedByUserStore(String userName, Map<String, Stri\n      */\n     public String getUserIDFromUserName(String userName) throws UserStoreException {\n \n+        String userID;\n         UserStore userStore = getUserStore(userName);\n         if (userStore.isRecurssive()) {\n             return ((AbstractUserStoreManager) userStore.getUserStoreManager())\n                     .getUserIDFromUserName(userStore.getDomainFreeName());\n         }\n \n         if (isUniqueUserIdEnabledInUserStore(userStore)) {\n-            return doGetUserIDFromUserNameWithID(userStore.getDomainFreeName());\n+            userID = getFromUserIDCache(userName, userStore);\n+            if (StringUtils.isEmpty(userID)) {\n+                userID = doGetUserIDFromUserNameWithID(userName);\n+                addToUserIDCache(userID, userName, userStore);\n+            }\n+            addToUserNameCache(userID, userName, userStore);\n+            return userID;\n         }\n \n         Map<String, String> claims = doGetUserClaimValues(userName,\n                 new String[]{UserCoreClaimConstants.USER_ID_CLAIM_URI},\n                 userStore.getDomainName(), null);\n         if (claims != null && claims.size() == 1) {\n-            return claims.get(UserCoreClaimConstants.USER_ID_CLAIM_URI);\n+            userID = getFromUserIDCache(userName, userStore);\n+            if (StringUtils.isEmpty(userID)) {\n+                userID = claims.get(UserCoreClaimConstants.USER_ID_CLAIM_URI);", "originalCommit": "e73cd8954d8f11a513953e086c18324ef2a2dfd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxMjg0Mw==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371612843", "bodyText": "Fixed by getting from the cache at the start", "author": "Buddhimah", "createdAt": "2020-01-28T05:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYwMDcwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYwMTA5MA==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371601090", "bodyText": "Move this inside try block and extract a private method named. startSuperTenantFlow", "author": "IsuraD", "createdAt": "2020-01-28T04:06:50Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserIdResolverCache.java", "diffHunk": "@@ -0,0 +1,226 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.carbon.user.core.common;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.carbon.utils.xml.StringUtils;\n+\n+import javax.cache.Cache;\n+import javax.cache.CacheManager;\n+import javax.cache.Caching;\n+\n+/**\n+ * Handle Cache in User ID resolving flow.\n+ */\n+public class UserIdResolverCache {\n+\n+    private static Log log = LogFactory.getLog(UserIdResolverCache.class);\n+    private static UserIdResolverCache userIdResolverCache = new UserIdResolverCache();\n+    private static final String USER_ID_RESOLVER_CACHE_MANAGER = \"USER_ID_RESOLVER_CACHE_MANAGER\";\n+\n+    private UserIdResolverCache() {\n+    }\n+\n+    /**\n+     * Gets a new instance of UserIdResolverCache.\n+     *\n+     * @return A new instance of UserIdResolverCache.\n+     */\n+    public synchronized static UserIdResolverCache getInstance() {\n+\n+        return userIdResolverCache;\n+    }\n+\n+    private Cache<String, String> UserIdResolverCache(String cacheName) {\n+\n+        Cache<String, String> cache;\n+        CacheManager cacheManager = Caching.getCacheManagerFactory().getCacheManager(USER_ID_RESOLVER_CACHE_MANAGER);\n+        cache = cacheManager.getCache(cacheName);\n+        return cache;\n+    }\n+\n+    /**\n+     * Add a cache entry.\n+     *\n+     * @param key       Key which cache entry is indexed.\n+     * @param entry     Actual object where cache entry is placed.\n+     * @param cacheName Name of the cache.\n+     */\n+    public void addToCache(String key, String entry, String cacheName) {\n+\n+        if (StringUtils.isEmpty(key) || StringUtils.isEmpty(entry) || StringUtils.isEmpty(cacheName)) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Invalid input parameters in add to cache request. Cache key: \" + key + \" ,Cache entry: \" +\n+                        entry + \" ,Cache name: \" + cacheName);\n+            }\n+            return;\n+        }\n+\n+        PrivilegedCarbonContext.startTenantFlow();\n+        try {\n+            PrivilegedCarbonContext carbonContext = PrivilegedCarbonContext.getThreadLocalCarbonContext();\n+            carbonContext.setTenantId(MultitenantConstants.SUPER_TENANT_ID);\n+            carbonContext.setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+\n+            Cache<String, String> cache = UserIdResolverCache(cacheName);\n+            if (cache != null && !cache.containsKey(key)) {\n+                cache.put(key, entry);\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\n+                            cacheName + \" which is under \" + USER_ID_RESOLVER_CACHE_MANAGER + \", added the entry: \"\n+                                    + entry + \" for the key: \" + key + \" successfully\");\n+                }\n+            }\n+        } finally {\n+            PrivilegedCarbonContext.endTenantFlow();\n+        }\n+    }\n+\n+    /**\n+     * Retrieves a cache entry.\n+     *\n+     * @param key       CacheKey.\n+     * @param cacheName Name of the cache.\n+     * @return Cached entry if the key presents, else returns null.\n+     */\n+    public String getValueFromCache(String key, String cacheName) {\n+\n+        if (StringUtils.isEmpty(key) || StringUtils.isEmpty(cacheName)) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Invalid input parameters in get value from cache request. Cache key: \" + key +\n+                        \" ,Cache name: \" + cacheName);\n+            }\n+            return null;\n+        }\n+\n+        PrivilegedCarbonContext.startTenantFlow();\n+\n+        try {\n+            PrivilegedCarbonContext carbonContext = PrivilegedCarbonContext.getThreadLocalCarbonContext();\n+            carbonContext.setTenantId(MultitenantConstants.SUPER_TENANT_ID);\n+            carbonContext.setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+\n+            Cache<String, String> cache = UserIdResolverCache(cacheName);\n+            if (cache != null) {\n+                if (cache.containsKey(key)) {\n+                    String entry = cache.get(key);\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(cacheName + \" which is under \" + USER_ID_RESOLVER_CACHE_MANAGER +\n+                                \", found the entry: \" + entry + \" for the key: \" + key + \" successfully.\");\n+                    }\n+                    return entry;\n+                }\n+                if (log.isDebugEnabled()) {\n+                    log.debug(cacheName + \" which is under \" + USER_ID_RESOLVER_CACHE_MANAGER +\n+                            \", doesn't contain the key: \" + key);\n+                }\n+            } else {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Error while getting the cache : \" + cacheName + \" which is under \"\n+                            + USER_ID_RESOLVER_CACHE_MANAGER);\n+                }\n+            }\n+            return null;\n+        } finally {\n+            PrivilegedCarbonContext.endTenantFlow();\n+        }\n+    }\n+\n+    /**\n+     * Clears a cache entry.\n+     *\n+     * @param key       Key to clear cache.\n+     * @param cacheName Name of the cache.\n+     */\n+    public void clearCacheEntry(String key, String cacheName) {\n+\n+        if (StringUtils.isEmpty(key) || StringUtils.isEmpty(cacheName)) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Invalid input parameters in clear from cache request. Cache key: \" + key +\n+                        \" ,Cache name: \" + cacheName);\n+            }\n+            return;\n+        }\n+\n+        PrivilegedCarbonContext.startTenantFlow();", "originalCommit": "e73cd8954d8f11a513953e086c18324ef2a2dfd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxMjg2MQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371612861", "bodyText": "fixed", "author": "Buddhimah", "createdAt": "2020-01-28T05:12:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYwMTA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYwMzMzNQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371603335", "bodyText": "Extract to a private method", "author": "ashensw", "createdAt": "2020-01-28T04:20:54Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -3693,6 +3695,11 @@ public final void deleteUser(String userName) throws UserStoreException {\n         if (isUniqueUserIdEnabled) {\n             userID = getUserIDFromUserName(userName);\n             isUserExists = userID != null;\n+            UserIdResolverCache.getInstance()", "originalCommit": "e73cd8954d8f11a513953e086c18324ef2a2dfd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxMjg4Mw==", "url": "https://github.com/wso2/carbon-kernel/pull/2548#discussion_r371612883", "bodyText": "Fixed", "author": "Buddhimah", "createdAt": "2020-01-28T05:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYwMzMzNQ=="}], "type": "inlineReview"}, {"oid": "bd0363d3266abed7c8f7ce5372670df1ddda7841", "url": "https://github.com/wso2/carbon-kernel/commit/bd0363d3266abed7c8f7ce5372670df1ddda7841", "message": "Change super tenant flow to tenant flow", "committedDate": "2020-01-28T05:11:13Z", "type": "forcePushed"}, {"oid": "dc55ad7dc2543ecec424525e7c5ffdae2031ced0", "url": "https://github.com/wso2/carbon-kernel/commit/dc55ad7dc2543ecec424525e7c5ffdae2031ced0", "message": "Change super tenant flow to tenant flow", "committedDate": "2020-01-28T05:28:29Z", "type": "forcePushed"}, {"oid": "c044ab0b4fab9fcd662239567aa0f633b32239e0", "url": "https://github.com/wso2/carbon-kernel/commit/c044ab0b4fab9fcd662239567aa0f633b32239e0", "message": "Change super tenant flow to tenant flow", "committedDate": "2020-01-28T05:39:35Z", "type": "forcePushed"}, {"oid": "375dcbc751ac71a544920706d0417febccb76d91", "url": "https://github.com/wso2/carbon-kernel/commit/375dcbc751ac71a544920706d0417febccb76d91", "message": "Change super tenant flow to tenant flow", "committedDate": "2020-01-28T05:57:46Z", "type": "forcePushed"}, {"oid": "1fc6c582866e2ac4aeb881de76c1058c85221bef", "url": "https://github.com/wso2/carbon-kernel/commit/1fc6c582866e2ac4aeb881de76c1058c85221bef", "message": "Change super tenant flow to tenant flow", "committedDate": "2020-01-28T06:08:06Z", "type": "commit"}, {"oid": "1fc6c582866e2ac4aeb881de76c1058c85221bef", "url": "https://github.com/wso2/carbon-kernel/commit/1fc6c582866e2ac4aeb881de76c1058c85221bef", "message": "Change super tenant flow to tenant flow", "committedDate": "2020-01-28T06:08:06Z", "type": "forcePushed"}]}