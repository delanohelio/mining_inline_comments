{"pr_number": 1182, "pr_title": "KYLIN-4446 Kylin on kubernetes in quick-start and production env", "pr_createdAt": "2020-04-22T13:49:02Z", "pr_url": "https://github.com/apache/kylin/pull/1182", "timeline": [{"oid": "a9a703f995410619664a60310ca88e52272c3467", "url": "https://github.com/apache/kylin/commit/a9a703f995410619664a60310ca88e52272c3467", "message": "KYLIN-4181 Schedule Kylin using Kubernetes", "committedDate": "2020-04-26T05:04:32Z", "type": "commit"}, {"oid": "949ac4d05284f4a97b2a851cdf0d80bbf20c2c78", "url": "https://github.com/apache/kylin/commit/949ac4d05284f4a97b2a851cdf0d80bbf20c2c78", "message": "KYLIN-4447 Kylin on kubernetes in a production env", "committedDate": "2020-04-26T05:07:29Z", "type": "commit"}, {"oid": "3e3086749a431b8d99e3bb096444a38ffb4c93eb", "url": "https://github.com/apache/kylin/commit/3e3086749a431b8d99e3bb096444a38ffb4c93eb", "message": "KYLIN-4447 Refactor and merge two related commits", "committedDate": "2020-04-26T06:32:03Z", "type": "commit"}, {"oid": "d2f6b713b13fde48840f254aff1f8b4524c1c8bb", "url": "https://github.com/apache/kylin/commit/d2f6b713b13fde48840f254aff1f8b4524c1c8bb", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-26T12:05:26Z", "type": "forcePushed"}, {"oid": "8ee919facb6dbac8cebd813cfdd08fe94fdcb617", "url": "https://github.com/apache/kylin/commit/8ee919facb6dbac8cebd813cfdd08fe94fdcb617", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-26T12:35:40Z", "type": "forcePushed"}, {"oid": "4e053b77dbbfef32df032805227ecfea0b57af50", "url": "https://github.com/apache/kylin/commit/4e053b77dbbfef32df032805227ecfea0b57af50", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-26T13:04:57Z", "type": "forcePushed"}, {"oid": "f34497551d71968d62c161323cd338902dd07203", "url": "https://github.com/apache/kylin/commit/f34497551d71968d62c161323cd338902dd07203", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-26T13:10:22Z", "type": "forcePushed"}, {"oid": "005ad7f228fff4124505986aa44fe33d5ca0ad60", "url": "https://github.com/apache/kylin/commit/005ad7f228fff4124505986aa44fe33d5ca0ad60", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-27T07:52:04Z", "type": "forcePushed"}, {"oid": "7d5aedf323b4c3ccc9fa98bd8818fb7ca6487a81", "url": "https://github.com/apache/kylin/commit/7d5aedf323b4c3ccc9fa98bd8818fb7ca6487a81", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-27T10:05:19Z", "type": "forcePushed"}, {"oid": "1a2c06c26c8894ae2ee7b1b72781780fb45d30b0", "url": "https://github.com/apache/kylin/commit/1a2c06c26c8894ae2ee7b1b72781780fb45d30b0", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-27T10:38:17Z", "type": "forcePushed"}, {"oid": "6b649604cb7b50c17c3da50961ac8d708241f48e", "url": "https://github.com/apache/kylin/commit/6b649604cb7b50c17c3da50961ac8d708241f48e", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-27T13:02:05Z", "type": "forcePushed"}, {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "url": "https://github.com/apache/kylin/commit/977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-04-28T02:37:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0Nzk5Mw==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r417747993", "bodyText": "I suppose we should remove the hadoop config. There are hadoop config for configmap in development files.", "author": "sanjulian", "createdAt": "2020-04-30T04:35:05Z", "path": "kubernetes/docker/hadoop-client/apache-hadoop2.7/Dockerfile", "diffHunk": "@@ -0,0 +1,85 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+FROM centos:7.3.1611\n+\n+MAINTAINER Apache Kylin\n+\n+WORKDIR /tmp\n+\n+# install jdk and other commands\n+RUN set -x \\\n+    && yum install -y which \\\n+       java-1.8.0-openjdk \\\n+       java-1.8.0-openjdk-devel \\\n+       krb5-workstation \\\n+    && yum clean all\n+\n+\n+# version variables\n+ARG HADOOP_VERSION=2.7.4\n+ARG HIVE_VERSION=1.2.2\n+ARG HBASE_VERSION=1.3.1\n+ARG SPARK_VERSION=2.2.1\n+ARG ZK_VERSION=3.4.6\n+\n+ARG APACHE_HOME=/apache\n+\n+RUN set -x \\\n+    && mkdir -p $APACHE_HOME\n+\n+ENV JAVA_HOME /etc/alternatives/jre\n+\n+# install hadoop\n+ENV HADOOP_HOME=$APACHE_HOME/hadoop\n+ADD hdp-clients/hadoop-${HADOOP_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/hadoop-${HADOOP_VERSION} $HADOOP_HOME\n+\n+#install hive\n+ENV HIVE_HOME=$APACHE_HOME/hive \n+ADD hdp-clients/apache-hive-${HIVE_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/apache-hive-${HIVE_VERSION} $HIVE_HOME\n+\n+#install hbase\n+ENV HBASE_HOME=$APACHE_HOME/hbase\n+ADD hdp-clients/hbase-${HBASE_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/hbase-${HBASE_VERSION} $HBASE_HOME\n+\n+#install spark\n+ENV SPARK_HOME=$APACHE_HOME/spark\n+ADD hdp-clients/spark-${SPARK_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/spark-${SPARK_VERSION} $SPARK_HOME\n+\n+#install zk\n+ENV ZK_HOME=$APACHE_HOME/zookeeper\n+ADD hdp-clients/zookeeper-${ZK_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/zookeeper-${ZK_VERSION} $ZK_HOME\n+\n+ENV PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HIVE_HOME/bin:$HBASE_HOME/bin:$ZK_HOME/bin\n+\n+COPY conf/hadoop $HADOOP_HOME/etc/hadoop", "originalCommit": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI0OTAxOQ==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419249019", "bodyText": "OK, I will do it.", "author": "hit-lacus", "createdAt": "2020-05-04T07:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0Nzk5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0ODQ3NA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r417748474", "bodyText": "Could we add the some build step for apache hadoop client?\nSuch as download hadoop client first, and update version in dockerfile.", "author": "sanjulian", "createdAt": "2020-04-30T04:37:03Z", "path": "kubernetes/docker/hadoop-client/README.md", "diffHunk": "@@ -0,0 +1,18 @@\n+## Background\n+### What is hadoop-client docker image and why we need this? \n+As we all know, the node you want to deploy Kylin, should has provided Hadoop \n+dependency(jars and configuration files), these dependency let you have access\n+ to Hadoop Service, such as HDFS, HBase, Hive, which are needed by Apache Kylin. \n+Unfortunately, each Hadoop distribution(CHD or HDP etc.) has its own specific jars. So, we \n+can provided specific image for specific Hadoop distribution, which will make image management task\n+more easier. This will have following two benefits:\n+1. Someone who has better knowledge on Hadoop can do this work, and let kylin \n+ user build their Kylin image base on provided Hadoop-Client image.\n+2. Upgrade Kylin will be much easier.\n+\n+### Build Step for CDH5.7\n+1. Place Spark binary(*spark-2.3.2-bin-hadoop2.7.tgz*) into dir `provided-binary`.\n+2. Run `build-image.sh` to build image.\n+\n+> If you are using other hadoop distribution, please consider build image yourself.\n+", "originalCommit": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI0ODgxMQ==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419248811", "bodyText": "OK, I will add it to readme file.", "author": "hit-lacus", "createdAt": "2020-05-04T07:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0ODQ3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NzM2MA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r417757360", "bodyText": "I suppose we do not need the services for job, since the job pod only for building cube instead of query.", "author": "sanjulian", "createdAt": "2020-04-30T05:13:22Z", "path": "kubernetes/example/deployment/kylin-job/kylin-job-service.yaml", "diffHunk": "@@ -0,0 +1,36 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: kylin-job-svc", "originalCommit": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI0ODU4MA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419248580", "bodyText": "In my test, if I use only one service, the SQL query request will be sent to both job server and query server, thus sometimes the request will be rejected, because job server won't answer such request.", "author": "hit-lacus", "createdAt": "2020-05-04T07:15:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NzM2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMzgwOA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419333808", "bodyText": "Yes, that\u2019s why I suggested to remove the service. It is unnecessary. And user talk with Kylin by query service, even call build job api.", "author": "sanjulian", "createdAt": "2020-05-04T10:09:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NzM2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxODk3OQ==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r420218979", "bodyText": "OK, I finally understand what you mean, thanks for this suggestion, it do make sense.", "author": "hit-lacus", "createdAt": "2020-05-05T15:55:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NzM2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NzMzNQ==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r418397335", "bodyText": "Remove the copy before the init.\nPlease use subPath to mount configMap or secret files for tomcat and kylin configuration.\nHere is the reference: https://kubernetes.io/docs/concepts/storage/volumes/#using-subpath", "author": "sanjulian", "createdAt": "2020-05-01T03:08:48Z", "path": "kubernetes/example/deployment/kylin-query/kylin-query-statefulset.yaml", "diffHunk": "@@ -0,0 +1,143 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: apps/v1\n+kind: StatefulSet\n+metadata:\n+  name: kylin-query\n+  namespace: kylin-example\n+  labels:\n+    app: kylin\n+    role: query\n+    environment: poc\n+    version: 3.0.1\n+    hadoop.version: cdh5.7\n+spec:\n+  serviceName: kylin-query-svc\n+  replicas: 1\n+  selector:\n+    matchLabels:\n+      app: kylin\n+      role: query\n+  template:\n+    metadata:\n+      labels:\n+        app: kylin\n+        role: query\n+    spec:\n+      hostAliases:\n+        - ip: \"10.1.3.90\"\n+          hostnames:\n+            - \"cdh-master\"\n+        - ip: \"10.1.3.93\"\n+          hostnames:\n+            - \"cdh-worker-1\"\n+        - ip: \"10.1.3.94\"\n+          hostnames:\n+            - \"cdh-worker-2\"\n+        - ip: \"10.1.3.91\"\n+          hostnames:\n+            - \"cdh-client\"\n+      containers:\n+      - name: kylin\n+        image: kylin-client:3.0.1-cdh57\n+        imagePullPolicy: IfNotPresent\n+        command:\n+        - sh\n+        - -c\n+        args:\n+        - cp $KYLIN_HOME/tomcat-config/* $KYLIN_HOME/tomcat/conf;", "originalCommit": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NzcxNA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r418397714", "bodyText": "The hadoop configmap is not used. Should we delete them or add the volume mount for hdp configuration?", "author": "sanjulian", "createdAt": "2020-05-01T03:10:27Z", "path": "kubernetes/example/deployment/kylin-query/kylin-query-statefulset.yaml", "diffHunk": "@@ -0,0 +1,143 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: apps/v1\n+kind: StatefulSet\n+metadata:\n+  name: kylin-query\n+  namespace: kylin-example\n+  labels:\n+    app: kylin\n+    role: query\n+    environment: poc\n+    version: 3.0.1\n+    hadoop.version: cdh5.7\n+spec:\n+  serviceName: kylin-query-svc\n+  replicas: 1\n+  selector:\n+    matchLabels:\n+      app: kylin\n+      role: query\n+  template:\n+    metadata:\n+      labels:\n+        app: kylin\n+        role: query\n+    spec:\n+      hostAliases:\n+        - ip: \"10.1.3.90\"\n+          hostnames:\n+            - \"cdh-master\"\n+        - ip: \"10.1.3.93\"\n+          hostnames:\n+            - \"cdh-worker-1\"\n+        - ip: \"10.1.3.94\"\n+          hostnames:\n+            - \"cdh-worker-2\"\n+        - ip: \"10.1.3.91\"\n+          hostnames:\n+            - \"cdh-client\"\n+      containers:\n+      - name: kylin\n+        image: kylin-client:3.0.1-cdh57\n+        imagePullPolicy: IfNotPresent\n+        command:\n+        - sh\n+        - -c\n+        args:\n+        - cp $KYLIN_HOME/tomcat-config/* $KYLIN_HOME/tomcat/conf;\n+          cp $KYLIN_HOME/kylin-more-config $KYLIN_HOME/tomcat/webapps/kylin/WEB-INF/classes/;\n+          $TOOL_HOME/bootstrap.sh server -d;\n+        ports:\n+        - containerPort: 7070\n+        - containerPort: 7443\n+        volumeMounts:\n+          - name: kylin-query-config\n+            mountPath: /home/apache_kylin/kylin/conf\n+          - name: tomcat-config\n+            mountPath: /home/apache_kylin/kylin/tomcat-config\n+          - name: kylin-more-config\n+            mountPath: /home/apache_kylin/kylin/kylin-more-config/\n+          - name: hadoop-config\n+            mountPath: /etc/hadoop/conf\n+          - name: hive-config\n+            mountPath: /etc/hive/conf\n+          - name: hbase-config\n+            mountPath: /etc/hbase/conf\n+          - name: kylin-logs\n+            mountPath: /home/apache_kylin/kylin/logs\n+          - name: tomcat-logs\n+            mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        resources:\n+          requests:\n+            memory: 2Gi\n+            cpu: 700m\n+          limits:\n+            memory: 2Gi\n+            cpu: 700m\n+      - name: filebeat\n+        image: docker.elastic.co/beats/filebeat:6.4.3\n+        args:\n+        - -c\n+        - /usr/share/filebeat/config/filebeat.yml\n+        - -e\n+        volumeMounts:\n+        - name: kylin-logs\n+          mountPath: /home/apache_kylin/kylin/logs\n+        - name: tomcat-logs\n+          mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        - name: filebeat-config\n+          mountPath: /usr/share/filebeat/config\n+          readOnly: true\n+        resources:\n+          requests:\n+            memory: 1Gi\n+            cpu: 300m\n+          limits:\n+            memory: 1Gi\n+            cpu: 300m\n+      volumes:\n+      - name: kylin-logs\n+        emptyDir:\n+          sizeLimit: 3Gi\n+      - name: tomcat-logs\n+        emptyDir:\n+          sizeLimit: 2Gi\n+      - configMap:", "originalCommit": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI0OTgxMg==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419249812", "bodyText": "I am not quite understand . Query server need hadoop configuration file such as hbase-site.xml.", "author": "hit-lacus", "createdAt": "2020-05-04T07:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NzcxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzNjIyNg==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419336226", "bodyText": "Sorry, my bad. I did not notice the configMap is mounted. Please ignore the previous comment I wrote.", "author": "sanjulian", "createdAt": "2020-05-04T10:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NzcxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5ODQ5MA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r418398490", "bodyText": "As I know, there are some secret files in kylin.properties, such as kylin.job.notification-mail-password, kylin.security.ldap.connection-password... Could we change the kylin-***-config as secrets instead of configMap?", "author": "sanjulian", "createdAt": "2020-05-01T03:15:06Z", "path": "kubernetes/example/deployment/kylin-query/kylin-query-statefulset.yaml", "diffHunk": "@@ -0,0 +1,143 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: apps/v1\n+kind: StatefulSet\n+metadata:\n+  name: kylin-query\n+  namespace: kylin-example\n+  labels:\n+    app: kylin\n+    role: query\n+    environment: poc\n+    version: 3.0.1\n+    hadoop.version: cdh5.7\n+spec:\n+  serviceName: kylin-query-svc\n+  replicas: 1\n+  selector:\n+    matchLabels:\n+      app: kylin\n+      role: query\n+  template:\n+    metadata:\n+      labels:\n+        app: kylin\n+        role: query\n+    spec:\n+      hostAliases:\n+        - ip: \"10.1.3.90\"\n+          hostnames:\n+            - \"cdh-master\"\n+        - ip: \"10.1.3.93\"\n+          hostnames:\n+            - \"cdh-worker-1\"\n+        - ip: \"10.1.3.94\"\n+          hostnames:\n+            - \"cdh-worker-2\"\n+        - ip: \"10.1.3.91\"\n+          hostnames:\n+            - \"cdh-client\"\n+      containers:\n+      - name: kylin\n+        image: kylin-client:3.0.1-cdh57\n+        imagePullPolicy: IfNotPresent\n+        command:\n+        - sh\n+        - -c\n+        args:\n+        - cp $KYLIN_HOME/tomcat-config/* $KYLIN_HOME/tomcat/conf;\n+          cp $KYLIN_HOME/kylin-more-config $KYLIN_HOME/tomcat/webapps/kylin/WEB-INF/classes/;\n+          $TOOL_HOME/bootstrap.sh server -d;\n+        ports:\n+        - containerPort: 7070\n+        - containerPort: 7443\n+        volumeMounts:\n+          - name: kylin-query-config\n+            mountPath: /home/apache_kylin/kylin/conf\n+          - name: tomcat-config\n+            mountPath: /home/apache_kylin/kylin/tomcat-config\n+          - name: kylin-more-config\n+            mountPath: /home/apache_kylin/kylin/kylin-more-config/\n+          - name: hadoop-config\n+            mountPath: /etc/hadoop/conf\n+          - name: hive-config\n+            mountPath: /etc/hive/conf\n+          - name: hbase-config\n+            mountPath: /etc/hbase/conf\n+          - name: kylin-logs\n+            mountPath: /home/apache_kylin/kylin/logs\n+          - name: tomcat-logs\n+            mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        resources:\n+          requests:\n+            memory: 2Gi\n+            cpu: 700m\n+          limits:\n+            memory: 2Gi\n+            cpu: 700m\n+      - name: filebeat\n+        image: docker.elastic.co/beats/filebeat:6.4.3\n+        args:\n+        - -c\n+        - /usr/share/filebeat/config/filebeat.yml\n+        - -e\n+        volumeMounts:\n+        - name: kylin-logs\n+          mountPath: /home/apache_kylin/kylin/logs\n+        - name: tomcat-logs\n+          mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        - name: filebeat-config\n+          mountPath: /usr/share/filebeat/config\n+          readOnly: true\n+        resources:\n+          requests:\n+            memory: 1Gi\n+            cpu: 300m\n+          limits:\n+            memory: 1Gi\n+            cpu: 300m\n+      volumes:\n+      - name: kylin-logs\n+        emptyDir:\n+          sizeLimit: 3Gi\n+      - name: tomcat-logs\n+        emptyDir:\n+          sizeLimit: 2Gi\n+      - configMap:\n+          name: hadoop-config\n+        name: hadoop-config\n+      - configMap:\n+          name: hive-config\n+        name: hive-config\n+      - configMap:\n+          name: hbase-config\n+        name: hbase-config\n+      - configMap:", "originalCommit": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5ODMzOA==", "url": "https://github.com/apache/kylin/pull/1182#discussion_r419298338", "bodyText": "Good suggestion! I think we can add this to documentation.", "author": "hit-lacus", "createdAt": "2020-05-04T08:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5ODQ5MA=="}], "type": "inlineReview"}, {"oid": "4274aec8b2276221f30ad1a90785640c9a8f35cf", "url": "https://github.com/apache/kylin/commit/4274aec8b2276221f30ad1a90785640c9a8f35cf", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-05-05T16:30:59Z", "type": "forcePushed"}, {"oid": "17cd40dc7d3b15e19dbf1eb682543b769a7d2061", "url": "https://github.com/apache/kylin/commit/17cd40dc7d3b15e19dbf1eb682543b769a7d2061", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-05-05T16:35:52Z", "type": "forcePushed"}, {"oid": "41eb4f992bc138eb90bebb3ebe537a373e7300b9", "url": "https://github.com/apache/kylin/commit/41eb4f992bc138eb90bebb3ebe537a373e7300b9", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-05-05T17:04:06Z", "type": "forcePushed"}, {"oid": "41eb4f992bc138eb90bebb3ebe537a373e7300b9", "url": "https://github.com/apache/kylin/commit/41eb4f992bc138eb90bebb3ebe537a373e7300b9", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)", "committedDate": "2020-05-05T17:04:06Z", "type": "commit"}]}