{"pr_number": 1411, "pr_title": "KYLIN-4760 Optimize TopN measure", "pr_createdAt": "2020-09-16T05:56:00Z", "pr_url": "https://github.com/apache/kylin/pull/1411", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzODcyNQ==", "url": "https://github.com/apache/kylin/pull/1411#discussion_r489238725", "bodyText": "Please remove this blank line.", "author": "zzcclp", "createdAt": "2020-09-16T07:57:15Z", "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/builder/CubeDictionaryBuilder.scala", "diffHunk": "@@ -65,6 +65,7 @@ class CubeDictionaryBuilder(val dataset: Dataset[Row],\n     finally lock.unlock(getLockPath(sourceColumn))\n   }\n \n+", "originalCommit": "38c3da3781ab630ec53f06d72a29d62e382d61b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI0MDk4NA==", "url": "https://github.com/apache/kylin/pull/1411#discussion_r489240984", "bodyText": "It's better add a comment here, describe that use new 'TopN AggregateFunction' to implement this function.", "author": "zzcclp", "createdAt": "2020-09-16T08:00:51Z", "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/job/CuboidAggregator.scala", "diffHunk": "@@ -98,9 +98,22 @@ object CuboidAggregator {\n             new Column(cdAggregate.toAggregateExpression()).as(id.toString)\n           }\n         case \"TOP_N\" =>\n-          val schema: StructType = constructTopNSchema(measure.pra)\n-          val udfName = UdfManager.register(measure.returnType.toKylinDataType, measure.expression, schema, !reuseLayout)\n-          callUDF(udfName, columns: _*).as(id.toString)\n+          val schema = StructType(measure.pra.map { col =>", "originalCommit": "38c3da3781ab630ec53f06d72a29d62e382d61b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwNTg4Ng==", "url": "https://github.com/apache/kylin/pull/1411#discussion_r489305886", "bodyText": "OK.", "author": "RupengWang", "createdAt": "2020-09-16T09:42:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI0MDk4NA=="}], "type": "inlineReview"}, {"oid": "ab22e3630c94e0171619e3514d12d7a66bddf631", "url": "https://github.com/apache/kylin/commit/ab22e3630c94e0171619e3514d12d7a66bddf631", "message": "KYLIN-4760 Optimize TopN measure", "committedDate": "2020-09-16T09:46:48Z", "type": "commit"}, {"oid": "ab22e3630c94e0171619e3514d12d7a66bddf631", "url": "https://github.com/apache/kylin/commit/ab22e3630c94e0171619e3514d12d7a66bddf631", "message": "KYLIN-4760 Optimize TopN measure", "committedDate": "2020-09-16T09:46:48Z", "type": "forcePushed"}]}