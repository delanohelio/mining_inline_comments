{"pr_number": 1152, "pr_title": "Allow to have different implementations of extensions", "pr_createdAt": "2020-02-10T16:01:34Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1152", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyNzk4OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377627989", "bodyText": "2 questions: do we allow null values and is extendable final?", "author": "mathbagu", "createdAt": "2020-02-11T13:19:35Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/AbstractExtensionAdder.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+/**\n+ * A base class for implementations of {@link ExtensionAdder} that holds the\n+ * extendable to be able build and then add the extension to the extendable.\n+ * This class calls {@link Extendable#createExtension} that must be overriden by\n+ * subclasses to create the extension.\n+ *\n+ * @author Jon Harper <jon.harper at rte-france.com>\n+ */\n+//TODO can we use T extends Extendable<T> here ? Then we can remove the cast in add()\n+public abstract class AbstractExtensionAdder<T, E extends Extension<T>> implements ExtensionAdder<T, E> {\n+\n+    protected T extendable;\n+\n+    protected AbstractExtensionAdder(T extendable) {\n+        this.extendable = extendable;", "originalCommit": "3d3306a819ba844912f1b2552dc397b53608a8b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMTQ0Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377801443", "bodyText": "There is no problem with forbidding null values (this is always called by doing extendable.newExtensionAdder(..)) so the extendable is never null.\nWe can also make the extendable final, even private if we want (and pass it to the createExtension method.\nYou think we should do these changes ?", "author": "jonenst", "createdAt": "2020-02-11T17:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyNzk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA5MTUzOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r380091538", "bodyText": "I think it's cleaner if you declare it private, final and if you assert the extendable is not null", "author": "mathbagu", "createdAt": "2020-02-17T10:12:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyNzk4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyODU1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377628556", "bodyText": "It's strange to have this in commons. Is it specific to IIDM extensions?", "author": "mathbagu", "createdAt": "2020-02-11T13:20:39Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/Extendable.java", "diffHunk": "@@ -49,4 +49,39 @@\n      * @return all extensions associated to this extendable object.\n      */\n     <E extends Extension<O>> Collection<E> getExtensions();\n+\n+    /**\n+     * Returns a name that is used to find matching {@link ExtensionAdderProvider}s\n+     * when selecting implementations of extensions in {@link #newExtension}. This\n+     * is meant to be overriden by extendables when multiple implementations exist.\n+     *\n+     * @return the name\n+     */\n+    default String getImplementationName() {\n+        return \"Default\";\n+    }", "originalCommit": "3d3306a819ba844912f1b2552dc397b53608a8b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc5OTQyMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377799422", "bodyText": "Not particularly. The getImplementationName method is only compared to the getImplementationName method of an ExtensionAdderProvider (when you call Extendable#newExtensionAdder). It's never compared to the NetworkFactoryServiceImpl from the iidm default implementation (although it happens to be the same constant \"Default\")\nThis is used when you have multiple implementations of an extendable, and you want the matching implementation of the extension. So this means that for all existing extendables today where we want multiple implementations, we can just create a Provider with the name \"Default\". But if we want we can also give the existing extendable an implementation name and create a Provider with this name.  For new extendable implementations we have to override and choose a new name (and use it in their providers).", "author": "jonenst", "createdAt": "2020-02-11T17:54:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyODU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyOTEzMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377629132", "bodyText": "Could you declare this method final?", "author": "mathbagu", "createdAt": "2020-02-11T13:21:41Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/Extendable.java", "diffHunk": "@@ -49,4 +49,39 @@\n      * @return all extensions associated to this extendable object.\n      */\n     <E extends Extension<O>> Collection<E> getExtensions();\n+\n+    /**\n+     * Returns a name that is used to find matching {@link ExtensionAdderProvider}s\n+     * when selecting implementations of extensions in {@link #newExtension}. This\n+     * is meant to be overriden by extendables when multiple implementations exist.\n+     *\n+     * @return the name\n+     */\n+    default String getImplementationName() {\n+        return \"Default\";\n+    }\n+\n+    /**\n+     * Returns an extensionAdder to build and add an extension for this extendable.\n+     *\n+     * The extension implementation is selected at runtime based on matching the\n+     * {@link #getImplementationName} of this extendable to the\n+     * {@link ExtensionAdderProvider#getImplementationName} of a provider.\n+     * Implementations are loaded with java's {@link java.util.ServiceLoader} using\n+     * the ExtensionAdderProvider interface.\n+     *\n+     * This is not meant to be overriden.", "originalCommit": "3d3306a819ba844912f1b2552dc397b53608a8b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc5MzI5Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377793292", "bodyText": "No, you can't have a final method in an interface", "author": "jonenst", "createdAt": "2020-02-11T17:43:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyOTEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA5MDYzMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r380090630", "bodyText": "But you agree that we do not want someone to overwrite it?", "author": "mathbagu", "createdAt": "2020-02-17T10:10:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyOTEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMDExNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377630114", "bodyText": "License is missing", "author": "mathbagu", "createdAt": "2020-02-11T13:23:30Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/ExtensionAdderProviders.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.powsybl.commons.extensions;", "originalCommit": "3d3306a819ba844912f1b2552dc397b53608a8b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMjA2Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377802062", "bodyText": "Oops good catch", "author": "jonenst", "createdAt": "2020-02-11T17:59:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMDExNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMDUwNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r377630507", "bodyText": "Sonar should warn, but static variables should be declared before this constructor", "author": "mathbagu", "createdAt": "2020-02-11T13:24:16Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/ExtensionAdderProviders.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.powsybl.commons.extensions;\n+\n+import java.util.List;\n+import java.util.ServiceLoader;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.common.base.Suppliers;\n+import com.powsybl.commons.PowsyblException;\n+\n+/**\n+ * A utility class to help finding providers using ServiceLoader.\n+ *\n+ * @author Jon Harper <jon.harper at rte-france.com>\n+ *\n+ */\n+//Don't bother with generics because serviceloader doesn't return them\n+//and we put them in a cache where we can't propagate the generic types.\n+@SuppressWarnings(\"rawtypes\")\n+final class ExtensionAdderProviders {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExtensionAdderProviders.class);\n+\n+    private ExtensionAdderProviders() {\n+    }", "originalCommit": "3d3306a819ba844912f1b2552dc397b53608a8b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk5OTc3OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r378999778", "bodyText": "done", "author": "jonenst", "createdAt": "2020-02-13T17:11:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMDUwNw=="}], "type": "inlineReview"}, {"oid": "c4c5b97d4ba351b39212d477cfa2c35f0dfc1e4d", "url": "https://github.com/powsybl/powsybl-core/commit/c4c5b97d4ba351b39212d477cfa2c35f0dfc1e4d", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-13T17:09:24Z", "type": "forcePushed"}, {"oid": "cebfc1ac8bf5500a46fc8b1971b542227bcc439b", "url": "https://github.com/powsybl/powsybl-core/commit/cebfc1ac8bf5500a46fc8b1971b542227bcc439b", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-13T17:10:44Z", "type": "forcePushed"}, {"oid": "9ba49e7ea4db5036652a4b5e138b7cf7c46defae", "url": "https://github.com/powsybl/powsybl-core/commit/9ba49e7ea4db5036652a4b5e138b7cf7c46defae", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-14T14:25:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA5MzEzNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r380093135", "bodyText": "Make a decision: if you can, do it", "author": "mathbagu", "createdAt": "2020-02-17T10:15:31Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/AbstractExtensionAdder.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+/**\n+ * A base class for implementations of {@link ExtensionAdder} that holds the\n+ * extendable to be able build and then add the extension to the extendable.\n+ * This class calls {@link Extendable#createExtension} that must be overriden by\n+ * subclasses to create the extension.\n+ *\n+ * @author Jon Harper <jon.harper at rte-france.com>\n+ */\n+//TODO can we use T extends Extendable<T> here ? Then we can remove the cast in add()", "originalCommit": "9ba49e7ea4db5036652a4b5e138b7cf7c46defae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA5NTU4NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r380095584", "bodyText": "Same remark", "author": "mathbagu", "createdAt": "2020-02-17T10:19:51Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/ExtensionAdderProvider.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+/**\n+ * A provider used through java's {@link java.util.ServiceLoader}. It will\n+ * provide an {@link ExtensionAdder} to add an extension to an extendable.\n+ * {@link #getImplementationName} is used to find providers corresponding to the\n+ * implementation of the {@link Extendable}. {@link #getAdderClass} is used to\n+ * specify the adder class.\n+ *\n+ * @author Jon Harper <jon.harper at rte-france.com>\n+ *\n+ * @param <T> The extendable\n+ * @param <E> The extension\n+ * @param <B> The extensionBuilder\n+ */\n+//TODO can we use T extends Extendable<T> here ? It would make calling newAdder safer.", "originalCommit": "9ba49e7ea4db5036652a4b5e138b7cf7c46defae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA5NjU0Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r380096542", "bodyText": "It's dirty but I assume we can write dirty code in tests... Default should not be used to avoid duplications", "author": "mathbagu", "createdAt": "2020-02-17T10:21:43Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {", "originalCommit": "9ba49e7ea4db5036652a4b5e138b7cf7c46defae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c90cb091fc5430517c21dccfd950262f27caf342", "url": "https://github.com/powsybl/powsybl-core/commit/c90cb091fc5430517c21dccfd950262f27caf342", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-18T17:31:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2MTU1Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383361552", "bodyText": "#createExtension ?", "author": "geofjamg", "createdAt": "2020-02-24T16:13:19Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/AbstractExtensionAdder.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import java.util.Objects;\n+\n+/**\n+ * A base class for implementations of {@link ExtensionAdder} that holds the\n+ * extendable to be able build and then add the extension to the extendable.\n+ * This class calls {@link Extendable#createExtension} that must be overriden by", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyMzYxNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383423614", "bodyText": "yes good catch", "author": "jonenst", "createdAt": "2020-02-24T18:01:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2MTU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NDU5Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383364597", "bodyText": "useless static?", "author": "geofjamg", "createdAt": "2020-02-24T16:18:01Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NDczMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383364733", "bodyText": "useless static?", "author": "geofjamg", "createdAt": "2020-02-24T16:18:12Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NDg1MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383364850", "bodyText": "useless static?", "author": "geofjamg", "createdAt": "2020-02-24T16:18:22Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NTI5MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383365291", "bodyText": "useless static?", "author": "geofjamg", "createdAt": "2020-02-24T16:19:03Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {\n+            return SimpleExtension.class;\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl2\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl2(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl2 createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl2();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImplProvider\n+            implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl> getAdderClass() {\n+            return SimpleExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class SimpleExtensionAdderImpl2Provider implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl2> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl2> getAdderClass() {\n+            return SimpleExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl2 newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl2(extendable);\n+        }\n+    }\n+\n+    private static interface GenericExtendable<G extends GenericExtendable<G>> extends Extendable<G> {", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NTY3Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383365672", "bodyText": "Is it used somewhere?", "author": "geofjamg", "createdAt": "2020-02-24T16:19:40Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {\n+            return SimpleExtension.class;\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl2\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl2(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl2 createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl2();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImplProvider\n+            implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl> getAdderClass() {\n+            return SimpleExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class SimpleExtensionAdderImpl2Provider implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl2> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl2> getAdderClass() {\n+            return SimpleExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl2 newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl2(extendable);\n+        }\n+    }\n+\n+    private static interface GenericExtendable<G extends GenericExtendable<G>> extends Extendable<G> {\n+    }\n+\n+    private static class GenericExtendableImpl2<G extends GenericExtendable<G>>", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyNzQwMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383427403", "bodyText": "Good catch added a test", "author": "jonenst", "createdAt": "2020-02-24T18:09:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NTY3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NTc5Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383365793", "bodyText": "useless static?", "author": "geofjamg", "createdAt": "2020-02-24T16:19:51Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {\n+            return SimpleExtension.class;\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl2\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl2(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl2 createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl2();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImplProvider\n+            implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl> getAdderClass() {\n+            return SimpleExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class SimpleExtensionAdderImpl2Provider implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl2> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl2> getAdderClass() {\n+            return SimpleExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl2 newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl2(extendable);\n+        }\n+    }\n+\n+    private static interface GenericExtendable<G extends GenericExtendable<G>> extends Extendable<G> {\n+    }\n+\n+    private static class GenericExtendableImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtendable<G> implements GenericExtendable<G> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SpecificExtendable", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyMzQ4NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383423485", "bodyText": "Yes", "author": "jonenst", "createdAt": "2020-02-24T18:01:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NTc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NTk3MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383365970", "bodyText": "useless static?", "author": "geofjamg", "createdAt": "2020-02-24T16:20:06Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {\n+            return SimpleExtension.class;\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl2\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl2(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl2 createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl2();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImplProvider\n+            implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl> getAdderClass() {\n+            return SimpleExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class SimpleExtensionAdderImpl2Provider implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl2> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl2> getAdderClass() {\n+            return SimpleExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl2 newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl2(extendable);\n+        }\n+    }\n+\n+    private static interface GenericExtendable<G extends GenericExtendable<G>> extends Extendable<G> {\n+    }\n+\n+    private static class GenericExtendableImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtendable<G> implements GenericExtendable<G> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SpecificExtendable\n+            extends GenericExtendable<SpecificExtendable> {\n+    }\n+\n+    private static class SpecificExtendableImpl2\n+            extends AbstractExtendable<SpecificExtendable>\n+            implements SpecificExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface GenericExtension<G extends GenericExtendable<G>> extends Extension<G> {\n+\n+        static <G extends GenericExtendable<G>> Class<GenericExtension<G>> clazz() {\n+            return (Class<GenericExtension<G>>) (Class) GenericExtension.class;\n+        }\n+\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class GenericExtensionImpl<G extends GenericExtendable<G>>\n+            extends AbstractExtension<G>\n+            implements GenericExtension<G> {\n+    }\n+\n+    private static class GenericExtensionImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtension<G>\n+            implements GenericExtension<G> {\n+    }\n+\n+    private static interface GenericExtensionAdder<G extends GenericExtendable<G>> extends ExtensionAdder<G, GenericExtension<G>> {", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NjYwNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383366604", "bodyText": "Unused variable?", "author": "geofjamg", "createdAt": "2020-02-24T16:21:03Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {\n+            return SimpleExtension.class;\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl2\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl2(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl2 createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl2();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImplProvider\n+            implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl> getAdderClass() {\n+            return SimpleExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class SimpleExtensionAdderImpl2Provider implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl2> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl2> getAdderClass() {\n+            return SimpleExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl2 newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl2(extendable);\n+        }\n+    }\n+\n+    private static interface GenericExtendable<G extends GenericExtendable<G>> extends Extendable<G> {\n+    }\n+\n+    private static class GenericExtendableImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtendable<G> implements GenericExtendable<G> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SpecificExtendable\n+            extends GenericExtendable<SpecificExtendable> {\n+    }\n+\n+    private static class SpecificExtendableImpl2\n+            extends AbstractExtendable<SpecificExtendable>\n+            implements SpecificExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface GenericExtension<G extends GenericExtendable<G>> extends Extension<G> {\n+\n+        static <G extends GenericExtendable<G>> Class<GenericExtension<G>> clazz() {\n+            return (Class<GenericExtension<G>>) (Class) GenericExtension.class;\n+        }\n+\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class GenericExtensionImpl<G extends GenericExtendable<G>>\n+            extends AbstractExtension<G>\n+            implements GenericExtension<G> {\n+    }\n+\n+    private static class GenericExtensionImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtension<G>\n+            implements GenericExtension<G> {\n+    }\n+\n+    private static interface GenericExtensionAdder<G extends GenericExtendable<G>> extends ExtensionAdder<G, GenericExtension<G>> {\n+        static <G extends GenericExtendable<G>> Class<GenericExtensionAdder<G>> clazz() {\n+            return (Class<GenericExtensionAdder<G>>) (Class) GenericExtensionAdder.class;\n+        }\n+\n+        default Class<GenericExtension> getExtensionClass() {\n+            return GenericExtension.class;\n+        }\n+    }\n+\n+    private static class GenericExtensionAdderImpl<G extends GenericExtendable<G>>\n+            extends AbstractExtensionAdder<G, GenericExtension<G>>\n+            implements GenericExtensionAdder<G> {\n+        protected GenericExtensionAdderImpl(G extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected GenericExtensionImpl<G> createExtension(G genericExtendable) {\n+            return new GenericExtensionImpl<>();\n+        }\n+    }\n+\n+    private static class GenericExtensionAdderImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtensionAdder<G, GenericExtension<G>>\n+            implements GenericExtensionAdder<G> {\n+        protected GenericExtensionAdderImpl2(G extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected GenericExtensionImpl2<G> createExtension(G genericExtendable) {\n+            return new GenericExtensionImpl2<>();\n+        }\n+    }\n+\n+    private static class GenericExtensionAdderImplProvider<G extends GenericExtendable<G>>\n+            implements\n+            ExtensionAdderProvider<G, GenericExtension<G>, GenericExtensionAdderImpl<G>> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<GenericExtensionAdderImpl> getAdderClass() {\n+            return GenericExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public GenericExtensionAdderImpl<G> newAdder(G extendable) {\n+            return new GenericExtensionAdderImpl<>(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class GenericExtensionAdderImpl2Provider<G extends GenericExtendable<G>>\n+            implements\n+            ExtensionAdderProvider<G, GenericExtension<G>, GenericExtensionAdderImpl2<G>> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<GenericExtensionAdderImpl2> getAdderClass() {\n+            return GenericExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public GenericExtensionAdderImpl2<G> newAdder(G extendable) {\n+            return new GenericExtensionAdderImpl2<>(extendable);\n+        }\n+    }\n+\n+    @Test\n+    public void test() {\n+        List<ExtensionAdderProvider> listProviders = Arrays.asList(\n+                new SimpleExtensionAdderImplProvider(),\n+                new SimpleExtensionAdderImpl2Provider(),\n+                new GenericExtensionAdderImplProvider(),\n+                new GenericExtensionAdderImpl2Provider());\n+        ConcurrentMap<Pair<String, Class>, ExtensionAdderProvider> cache = new ConcurrentHashMap<>();\n+        ConcurrentMap<String, List<ExtensionAdderProvider>> mapProviders = ExtensionAdderProviders.groupProvidersByName(listProviders);\n+        ExtensionAdderProvider a = ExtensionAdderProviders.findCachedProvider(\"Default\",\n+                SimpleExtensionAdder.class, mapProviders, cache);\n+        assertEquals(\"Default\", a.getImplementationName());\n+        assertEquals(SimpleExtensionAdderImplProvider.class, a.getClass());\n+        assertEquals(1, cache.size());\n+        ExtensionAdderProvider b = ExtensionAdderProviders.findCachedProvider(\"Custom\",\n+                SimpleExtensionAdder.class, mapProviders, cache);\n+        assertEquals(\"Custom\", b.getImplementationName());\n+        assertEquals(SimpleExtensionAdderImpl2Provider.class, b.getClass());\n+        assertEquals(2, cache.size());\n+\n+        // Do it again, it should work from the cache\n+        assertEquals(\"Default\", ExtensionAdderProviders.findCachedProvider(\"Default\", SimpleExtensionAdder.class,\n+                new ConcurrentHashMap<>(), cache).getImplementationName());\n+        assertEquals(\"Custom\", ExtensionAdderProviders.findCachedProvider(\"Custom\", SimpleExtensionAdder.class,\n+                                new ConcurrentHashMap<>(), cache)\n+                        .getImplementationName());\n+    }\n+\n+    @Test\n+    public void testMissing() {\n+        try {\n+            ExtensionAdderProviders.findCachedProvider(\"Default\",\n+                    SimpleExtensionAdder.class, new ConcurrentHashMap<>(),\n+                    new ConcurrentHashMap<>());\n+            fail(\"Should throw Missing Provider exception\");\n+        } catch (PowsyblException e) {\n+            assertTrue(\"Should throw Missing Provider exception\",\n+                    e.getMessage().contains(\"not found\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testMissingAlternate() {\n+        try {\n+            List<ExtensionAdderProvider> listProviders = Arrays", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyNzIzMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383427230", "bodyText": "Good catch the test was not testing what I wanted to test", "author": "jonenst", "createdAt": "2020-02-24T18:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2NjYwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2Njk2MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383366960", "bodyText": "Unused variable?", "author": "geofjamg", "createdAt": "2020-02-24T16:21:35Z", "path": "commons/src/test/java/com/powsybl/commons/extensions/ExtensionAdderProvidersTest.java", "diffHunk": "@@ -0,0 +1,355 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import static org.junit.Assert.*;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.Test;\n+\n+import com.google.auto.service.AutoService;\n+import com.powsybl.commons.PowsyblException;\n+\n+public class ExtensionAdderProvidersTest {\n+\n+    private static interface SimpleExtendable extends Extendable<SimpleExtendable> {\n+    }\n+\n+    private static class SimpleExtendableImpl2\n+            extends AbstractExtendable<SimpleExtendable> implements SimpleExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SimpleExtension extends Extension<SimpleExtendable> {\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class SimpleExtensionImpl extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static class SimpleExtensionImpl2 extends AbstractExtension<SimpleExtendable>\n+            implements SimpleExtension {\n+    }\n+\n+    private static interface SimpleExtensionAdder extends ExtensionAdder<SimpleExtendable, SimpleExtension> {\n+        default Class<SimpleExtension> getExtensionClass() {\n+            return SimpleExtension.class;\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImpl2\n+            extends AbstractExtensionAdder<SimpleExtendable, SimpleExtension>\n+            implements SimpleExtensionAdder {\n+        protected SimpleExtensionAdderImpl2(SimpleExtendable extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected SimpleExtensionImpl2 createExtension(SimpleExtendable extendable) {\n+            return new SimpleExtensionImpl2();\n+        }\n+    }\n+\n+    private static class SimpleExtensionAdderImplProvider\n+            implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl> getAdderClass() {\n+            return SimpleExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class SimpleExtensionAdderImpl2Provider implements\n+            ExtensionAdderProvider<SimpleExtendable, SimpleExtension, SimpleExtensionAdderImpl2> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<SimpleExtensionAdderImpl2> getAdderClass() {\n+            return SimpleExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public SimpleExtensionAdderImpl2 newAdder(SimpleExtendable extendable) {\n+            return new SimpleExtensionAdderImpl2(extendable);\n+        }\n+    }\n+\n+    private static interface GenericExtendable<G extends GenericExtendable<G>> extends Extendable<G> {\n+    }\n+\n+    private static class GenericExtendableImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtendable<G> implements GenericExtendable<G> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface SpecificExtendable\n+            extends GenericExtendable<SpecificExtendable> {\n+    }\n+\n+    private static class SpecificExtendableImpl2\n+            extends AbstractExtendable<SpecificExtendable>\n+            implements SpecificExtendable {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+    }\n+\n+    private static interface GenericExtension<G extends GenericExtendable<G>> extends Extension<G> {\n+\n+        static <G extends GenericExtendable<G>> Class<GenericExtension<G>> clazz() {\n+            return (Class<GenericExtension<G>>) (Class) GenericExtension.class;\n+        }\n+\n+        default String getName() {\n+            return \"SimpleExtension\";\n+        }\n+    }\n+\n+    private static class GenericExtensionImpl<G extends GenericExtendable<G>>\n+            extends AbstractExtension<G>\n+            implements GenericExtension<G> {\n+    }\n+\n+    private static class GenericExtensionImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtension<G>\n+            implements GenericExtension<G> {\n+    }\n+\n+    private static interface GenericExtensionAdder<G extends GenericExtendable<G>> extends ExtensionAdder<G, GenericExtension<G>> {\n+        static <G extends GenericExtendable<G>> Class<GenericExtensionAdder<G>> clazz() {\n+            return (Class<GenericExtensionAdder<G>>) (Class) GenericExtensionAdder.class;\n+        }\n+\n+        default Class<GenericExtension> getExtensionClass() {\n+            return GenericExtension.class;\n+        }\n+    }\n+\n+    private static class GenericExtensionAdderImpl<G extends GenericExtendable<G>>\n+            extends AbstractExtensionAdder<G, GenericExtension<G>>\n+            implements GenericExtensionAdder<G> {\n+        protected GenericExtensionAdderImpl(G extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected GenericExtensionImpl<G> createExtension(G genericExtendable) {\n+            return new GenericExtensionImpl<>();\n+        }\n+    }\n+\n+    private static class GenericExtensionAdderImpl2<G extends GenericExtendable<G>>\n+            extends AbstractExtensionAdder<G, GenericExtension<G>>\n+            implements GenericExtensionAdder<G> {\n+        protected GenericExtensionAdderImpl2(G extendable) {\n+            super(extendable);\n+        }\n+\n+        @Override\n+        protected GenericExtensionImpl2<G> createExtension(G genericExtendable) {\n+            return new GenericExtensionImpl2<>();\n+        }\n+    }\n+\n+    private static class GenericExtensionAdderImplProvider<G extends GenericExtendable<G>>\n+            implements\n+            ExtensionAdderProvider<G, GenericExtension<G>, GenericExtensionAdderImpl<G>> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Default\";\n+        }\n+\n+        @Override\n+        public Class<GenericExtensionAdderImpl> getAdderClass() {\n+            return GenericExtensionAdderImpl.class;\n+        }\n+\n+        @Override\n+        public GenericExtensionAdderImpl<G> newAdder(G extendable) {\n+            return new GenericExtensionAdderImpl<>(extendable);\n+        }\n+    }\n+\n+    @AutoService(ExtensionAdderProvider.class)\n+    public static class GenericExtensionAdderImpl2Provider<G extends GenericExtendable<G>>\n+            implements\n+            ExtensionAdderProvider<G, GenericExtension<G>, GenericExtensionAdderImpl2<G>> {\n+        @Override\n+        public String getImplementationName() {\n+            return \"Custom\";\n+        }\n+\n+        @Override\n+        public Class<GenericExtensionAdderImpl2> getAdderClass() {\n+            return GenericExtensionAdderImpl2.class;\n+        }\n+\n+        @Override\n+        public GenericExtensionAdderImpl2<G> newAdder(G extendable) {\n+            return new GenericExtensionAdderImpl2<>(extendable);\n+        }\n+    }\n+\n+    @Test\n+    public void test() {\n+        List<ExtensionAdderProvider> listProviders = Arrays.asList(\n+                new SimpleExtensionAdderImplProvider(),\n+                new SimpleExtensionAdderImpl2Provider(),\n+                new GenericExtensionAdderImplProvider(),\n+                new GenericExtensionAdderImpl2Provider());\n+        ConcurrentMap<Pair<String, Class>, ExtensionAdderProvider> cache = new ConcurrentHashMap<>();\n+        ConcurrentMap<String, List<ExtensionAdderProvider>> mapProviders = ExtensionAdderProviders.groupProvidersByName(listProviders);\n+        ExtensionAdderProvider a = ExtensionAdderProviders.findCachedProvider(\"Default\",\n+                SimpleExtensionAdder.class, mapProviders, cache);\n+        assertEquals(\"Default\", a.getImplementationName());\n+        assertEquals(SimpleExtensionAdderImplProvider.class, a.getClass());\n+        assertEquals(1, cache.size());\n+        ExtensionAdderProvider b = ExtensionAdderProviders.findCachedProvider(\"Custom\",\n+                SimpleExtensionAdder.class, mapProviders, cache);\n+        assertEquals(\"Custom\", b.getImplementationName());\n+        assertEquals(SimpleExtensionAdderImpl2Provider.class, b.getClass());\n+        assertEquals(2, cache.size());\n+\n+        // Do it again, it should work from the cache\n+        assertEquals(\"Default\", ExtensionAdderProviders.findCachedProvider(\"Default\", SimpleExtensionAdder.class,\n+                new ConcurrentHashMap<>(), cache).getImplementationName());\n+        assertEquals(\"Custom\", ExtensionAdderProviders.findCachedProvider(\"Custom\", SimpleExtensionAdder.class,\n+                                new ConcurrentHashMap<>(), cache)\n+                        .getImplementationName());\n+    }\n+\n+    @Test\n+    public void testMissing() {\n+        try {\n+            ExtensionAdderProviders.findCachedProvider(\"Default\",\n+                    SimpleExtensionAdder.class, new ConcurrentHashMap<>(),\n+                    new ConcurrentHashMap<>());\n+            fail(\"Should throw Missing Provider exception\");\n+        } catch (PowsyblException e) {\n+            assertTrue(\"Should throw Missing Provider exception\",\n+                    e.getMessage().contains(\"not found\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testMissingAlternate() {\n+        try {\n+            List<ExtensionAdderProvider> listProviders = Arrays\n+                    .asList(new SimpleExtensionAdderImplProvider());\n+            ExtensionAdderProviders.findCachedProvider(\"Custom\",\n+                    SimpleExtensionAdder.class, new ConcurrentHashMap<>(),\n+                    new ConcurrentHashMap<>());\n+            fail(\"Should throw Missing Provider exception\");\n+        } catch (PowsyblException e) {\n+            assertTrue(\"Should throw Missing Provider exception\",\n+                    e.getMessage().contains(\"not found\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testMissingAlternate2() {\n+        try {\n+            List<ExtensionAdderProvider> listProviders = Arrays", "originalCommit": "c90cb091fc5430517c21dccfd950262f27caf342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyNzI1NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383427254", "bodyText": "Good catch the test was not testing what I wanted to test", "author": "jonenst", "createdAt": "2020-02-24T18:09:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM2Njk2MA=="}], "type": "inlineReview"}, {"oid": "86e7e43f57cf16576c7db771ebf19340183f8254", "url": "https://github.com/powsybl/powsybl-core/commit/86e7e43f57cf16576c7db771ebf19340183f8254", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-24T18:01:10Z", "type": "forcePushed"}, {"oid": "d6b57197d6d6919dae05e0b43302ce62860a564e", "url": "https://github.com/powsybl/powsybl-core/commit/d6b57197d6d6919dae05e0b43302ce62860a564e", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-24T18:13:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2MjA4MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383762080", "bodyText": "Maybe a copy/past error: are you sure about this message?", "author": "mathbagu", "createdAt": "2020-02-25T09:41:20Z", "path": "commons/src/main/java/com/powsybl/commons/extensions/ExtensionAdderProviders.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.commons.extensions;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.ServiceLoader;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.common.base.Suppliers;\n+import com.powsybl.commons.PowsyblException;\n+\n+/**\n+ * A utility class to help finding providers using ServiceLoader.\n+ *\n+ * @author Jon Harper <jon.harper at rte-france.com>\n+ *\n+ */\n+//Don't bother with generics because serviceloader doesn't return them\n+//and we put them in a cache where we can't propagate the generic types.\n+@SuppressWarnings(\"rawtypes\")\n+public final class ExtensionAdderProviders {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExtensionAdderProviders.class);\n+\n+    private static final Supplier<ConcurrentMap<String, List<ExtensionAdderProvider>>> ADDER_PROVIDERS = Suppliers\n+            .memoize(() -> groupProvidersByName(ServiceLoader.load(ExtensionAdderProvider.class)))::get;\n+\n+    private static final ConcurrentMap<Pair<String, Class>, ExtensionAdderProvider> CACHE = new ConcurrentHashMap<>();\n+\n+    //package private for tests\n+    static ConcurrentMap<String, List<ExtensionAdderProvider>> groupProvidersByName(Iterable<ExtensionAdderProvider> i) {\n+        return StreamSupport.stream(i.spliterator(), false).collect(Collectors\n+                .groupingByConcurrent(ExtensionAdderProvider::getImplementationName));\n+    }\n+\n+    private ExtensionAdderProviders() {\n+    }\n+\n+    private static <O, E extends Extension<O>, B extends ExtensionAdder<O, E>> ExtensionAdderProvider findProvider(\n+            String name, Class<B> type,\n+            ConcurrentMap<String, List<ExtensionAdderProvider>> providersMap) {\n+\n+        List<ExtensionAdderProvider> providersForName = providersMap.get(name);\n+        if (providersForName == null) {\n+            providersForName = Collections.emptyList();\n+        }\n+        List<ExtensionAdderProvider> providers = providersForName.stream()\n+                .filter(s -> type.isAssignableFrom(s.getAdderClass()))\n+                .collect(Collectors.toList());\n+\n+        if (providers.isEmpty()) {\n+            LOGGER.error(\n+                    \"ExtensionAdderProvider not found for ExtensionAdder {} for implementation {}\",\n+                    type.getSimpleName(), name);\n+            throw new PowsyblException(\"ExtensionAdderProvider not found\");\n+        }\n+\n+        if (providers.size() > 1) {\n+            LOGGER.error(\n+                    \"Multiple ExtensionAdderProviders found for ExtensionAdder {} for implementation {} : {}\",\n+                    type.getSimpleName(), name, providers);\n+            throw new PowsyblException(\n+                    \"Multiple platform configuration providers found\");", "originalCommit": "c49faed9ae314ed693031aab747f9fc0a9bf5ff0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2NjYyMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383766623", "bodyText": "Oops yes", "author": "jonenst", "createdAt": "2020-02-25T09:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2MjA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3MDU0Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1152#discussion_r383770542", "bodyText": "fixed", "author": "jonenst", "createdAt": "2020-02-25T09:53:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2MjA4MA=="}], "type": "inlineReview"}, {"oid": "edd940e736fb9c37a4e298659181fa7d736da50d", "url": "https://github.com/powsybl/powsybl-core/commit/edd940e736fb9c37a4e298659181fa7d736da50d", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-25T09:55:30Z", "type": "commit"}, {"oid": "edd940e736fb9c37a4e298659181fa7d736da50d", "url": "https://github.com/powsybl/powsybl-core/commit/edd940e736fb9c37a4e298659181fa7d736da50d", "message": "Allow to have different implementations of extensions\n\nSigned-off-by: Jon Harper <jon.harper87@gmail.com>", "committedDate": "2020-02-25T09:55:30Z", "type": "forcePushed"}, {"oid": "0be9beb61cb16e99a06c743fd8bb02acfa30ea89", "url": "https://github.com/powsybl/powsybl-core/commit/0be9beb61cb16e99a06c743fd8bb02acfa30ea89", "message": "Merge branch 'master' into extension2", "committedDate": "2020-02-25T15:26:03Z", "type": "commit"}]}