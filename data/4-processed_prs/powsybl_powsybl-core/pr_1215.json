{"pr_number": 1215, "pr_title": "Delete multi-files mode of XIIDM import/export", "pr_createdAt": "2020-03-10T14:50:26Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1215", "timeline": [{"oid": "0ab33980eb9eab505385e698ca1b3ca8ef76b147", "url": "https://github.com/powsybl/powsybl-core/commit/0ab33980eb9eab505385e698ca1b3ca8ef76b147", "message": "corrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-12T16:23:09Z", "type": "forcePushed"}, {"oid": "a6e9fb2f5d8ec40cfb5dd8abc72563694d19bc2e", "url": "https://github.com/powsybl/powsybl-core/commit/a6e9fb2f5d8ec40cfb5dd8abc72563694d19bc2e", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-12T16:38:09Z", "type": "forcePushed"}, {"oid": "f5c5a17bca8436bc6e0c51163acf9923a6c421d9", "url": "https://github.com/powsybl/powsybl-core/commit/f5c5a17bca8436bc6e0c51163acf9923a6c421d9", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-12T16:46:18Z", "type": "forcePushed"}, {"oid": "3ba42e02dfa98a2a4af8a285bab098be5e9dfb7a", "url": "https://github.com/powsybl/powsybl-core/commit/3ba42e02dfa98a2a4af8a285bab098be5e9dfb7a", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-12T16:51:22Z", "type": "forcePushed"}, {"oid": "18057e6f27bd365783ace3384539a58e460f24c3", "url": "https://github.com/powsybl/powsybl-core/commit/18057e6f27bd365783ace3384539a58e460f24c3", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete white spaces\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-13T08:30:35Z", "type": "forcePushed"}, {"oid": "3546b07f3af7753d57e2080892c512c2d189f622", "url": "https://github.com/powsybl/powsybl-core/commit/3546b07f3af7753d57e2080892c512c2d189f622", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete white spaces\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-13T08:42:36Z", "type": "forcePushed"}, {"oid": "16f715e6eafaedcd65ce1068d02b40e5b4ef426b", "url": "https://github.com/powsybl/powsybl-core/commit/16f715e6eafaedcd65ce1068d02b40e5b4ef426b", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete white spaces\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete unused field\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-13T08:57:04Z", "type": "forcePushed"}, {"oid": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "url": "https://github.com/powsybl/powsybl-core/commit/4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete white spaces\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete unused field\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrect checkstyle\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-13T09:55:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3Mjc5OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392272799", "bodyText": "Is it a good idea to mutualize this?", "author": "mathbagu", "createdAt": "2020-03-13T14:46:06Z", "path": "commons/src/main/java/com/powsybl/commons/xml/XmlUtil.java", "diffHunk": "@@ -173,4 +179,29 @@ public static float readOptionalFloatAttribute(XMLStreamReader reader, String at\n         String attributeValue = reader.getAttributeValue(null, attributeName);\n         return attributeValue != null ? Float.valueOf(attributeValue) : defaultValue;\n     }\n+\n+    public static XMLStreamWriter writeStartAttributes(OutputStream os, String prefix, String namespaceUri, String rootName, String indentString, boolean indent) throws XMLStreamException {\n+        XMLStreamWriter writer;\n+        writer = createXmlStreamWriter(indentString, indent, os);\n+        writer.writeStartDocument(StandardCharsets.UTF_8.toString(), \"1.0\");\n+        writer.setPrefix(prefix, namespaceUri);\n+        writer.writeStartElement(namespaceUri, rootName);\n+        writer.writeNamespace(prefix, namespaceUri);\n+        return writer;\n+    }", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3MzE3OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392273178", "bodyText": "Same question? The name of this method is not OK. As a developer, I don't know it will end my XML document.", "author": "mathbagu", "createdAt": "2020-03-13T14:46:45Z", "path": "commons/src/main/java/com/powsybl/commons/xml/XmlUtil.java", "diffHunk": "@@ -173,4 +179,29 @@ public static float readOptionalFloatAttribute(XMLStreamReader reader, String at\n         String attributeValue = reader.getAttributeValue(null, attributeName);\n         return attributeValue != null ? Float.valueOf(attributeValue) : defaultValue;\n     }\n+\n+    public static XMLStreamWriter writeStartAttributes(OutputStream os, String prefix, String namespaceUri, String rootName, String indentString, boolean indent) throws XMLStreamException {\n+        XMLStreamWriter writer;\n+        writer = createXmlStreamWriter(indentString, indent, os);\n+        writer.writeStartDocument(StandardCharsets.UTF_8.toString(), \"1.0\");\n+        writer.setPrefix(prefix, namespaceUri);\n+        writer.writeStartElement(namespaceUri, rootName);\n+        writer.writeNamespace(prefix, namespaceUri);\n+        return writer;\n+    }\n+\n+    private static XMLStreamWriter createXmlStreamWriter(String indentString, boolean indent, OutputStream os) throws XMLStreamException {\n+        XMLStreamWriter writer = XML_OUTPUT_FACTORY_SUPPLIER.get().createXMLStreamWriter(os, StandardCharsets.UTF_8.toString());\n+        if (indent) {\n+            IndentingXMLStreamWriter indentingWriter = new IndentingXMLStreamWriter(writer);\n+            indentingWriter.setIndent(indentString);\n+            writer = indentingWriter;\n+        }\n+        return writer;\n+    }\n+\n+    public static void writeEndElement(XMLStreamWriter writer) throws XMLStreamException {\n+        writer.writeEndElement();\n+        writer.writeEndDocument();\n+    }", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3Mzg3Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392273873", "bodyText": "You should revert this change: if bad people use the order of this enum, they can consider it as a regression. Keep only the @Deprecated", "author": "mathbagu", "createdAt": "2020-03-13T14:47:55Z", "path": "iidm/iidm-converter-api/src/main/java/com/powsybl/iidm/IidmImportExportMode.java", "diffHunk": "@@ -8,12 +8,14 @@\n \n /***\n  * @author Chamseddine BENHAMED <chamseddine.benhamed at rte-france.com>\n+ *\n+ * @deprecated Not used anymore\n  */\n-\n+@Deprecated\n public enum IidmImportExportMode {\n     ONE_SEPARATED_FILE_PER_EXTENSION_TYPE,\n-    UNIQUE_FILE,\n-    EXTENSIONS_IN_ONE_SEPARATED_FILE\n+    EXTENSIONS_IN_ONE_SEPARATED_FILE,\n+    UNIQUE_FILE", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NTU0Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392275542", "bodyText": "Is there a validateWithoutExtension?", "author": "mathbagu", "createdAt": "2020-03-13T14:50:38Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/NetworkXml.java", "diffHunk": "@@ -436,62 +326,23 @@ public static Anonymizer write(Network network, ExportOptions options, DataSourc\n         try (OutputStream osb = dataSource.newOutputStream(\"\", dataSourceExt, false);\n              BufferedOutputStream bosb = new BufferedOutputStream(osb)) {\n \n-            if (options.getMode() == IidmImportExportMode.UNIQUE_FILE) {\n-                Anonymizer anonymizer = write(network, options, bosb);\n-                if (options.isAnonymized()) {\n-                    try (BufferedWriter writer2 = new BufferedWriter(new OutputStreamWriter(dataSource.newOutputStream(\"_mapping\", \"csv\", false), StandardCharsets.UTF_8))) {\n-                        anonymizer.write(writer2);\n-                    }\n-                }\n-                return anonymizer;\n-            }\n-\n-            NetworkXmlWriterContext context = writeBaseNetwork(network, bosb, options);\n-            writeEndElement(context.getWriter());\n-\n-            // write extensions\n-            if (!options.withNoExtension() && !getNetworkExtensions(network).isEmpty()) {\n-\n-                if (options.getMode() == IidmImportExportMode.EXTENSIONS_IN_ONE_SEPARATED_FILE) {\n-                    try (OutputStream ose = dataSource.newOutputStream(\"-ext\", dataSourceExt, false);\n-                         BufferedOutputStream bose = new BufferedOutputStream(ose)) {\n-\n-                        final XMLStreamWriter extensionsWriter = initializeWriter(network, bose, options);\n-                        context.setExtensionsWriter(extensionsWriter);\n-                        writeExtensions(network, context, options);\n-                        writeEndElement(extensionsWriter);\n-                    }\n-                } else if (options.getMode() == IidmImportExportMode.ONE_SEPARATED_FILE_PER_EXTENSION_TYPE) {\n-                    writeExtensionsInMultipleFile(network, context, dataSource, options, dataSourceExt);\n-                }\n-            }\n-\n+            Anonymizer anonymizer = write(network, options, bosb);\n             if (options.isAnonymized()) {\n                 try (BufferedWriter writer2 = new BufferedWriter(new OutputStreamWriter(dataSource.newOutputStream(\"_mapping\", \"csv\", false), StandardCharsets.UTF_8))) {\n-                    context.getAnonymizer().write(writer2);\n+                    anonymizer.write(writer2);\n                 }\n             }\n-            return context.getAnonymizer();\n-        } catch (XMLStreamException e) {\n-            throw new UncheckedXmlStreamException(e);\n+            return anonymizer;\n         }\n     }\n \n     public static Anonymizer writeAndValidate(Network n, Path xmlFile) {\n-        try {\n-            return writeAndValidate(n, new ExportOptions(), xmlFile);\n-        } catch (IOException e) {\n-            throw new UncheckedIOException(e);\n-        }\n+        return writeAndValidate(n, new ExportOptions(), xmlFile);\n     }\n \n-    public static Anonymizer writeAndValidate(Network n, ExportOptions options, Path xmlFile) throws IOException {\n+    public static Anonymizer writeAndValidate(Network n, ExportOptions options, Path xmlFile) {\n         Anonymizer anonymizer = write(n, options, xmlFile);\n-        if (options.getMode() == IidmImportExportMode.UNIQUE_FILE) {\n-            validateWithExtensions(xmlFile);\n-            return anonymizer;\n-        }\n-        validate(xmlFile, options.getMode());\n+        validateWithExtensions(xmlFile);", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM0MjE1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r394342156", "bodyText": "There was but as it is not used anymore, I will rename this one as you suggested", "author": "miovd", "createdAt": "2020-03-18T13:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NTU0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NjI4OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392276289", "bodyText": "Is it a good idea to forget the Import/export Options? Are you sure we should not keep both? As the ImportOptions is not deprecated, why this method is?", "author": "mathbagu", "createdAt": "2020-03-13T14:51:42Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/NetworkXml.java", "diffHunk": "@@ -618,140 +467,32 @@ public static Network read(ReadOnlyDataSource dataSource, NetworkFactory network\n         try (InputStream isb = dataSource.newInputStream(null, dataSourceExt)) {\n             network = NetworkXml.read(isb, options, anonymizer, networkFactory);\n         }\n-        if (!options.withNoExtension()) {\n-            switch (options.getMode()) {\n-                case EXTENSIONS_IN_ONE_SEPARATED_FILE:\n-                    // in this case we have to read all extensions from one  file\n-                    try (InputStream ise = dataSource.newInputStream(\"-ext\", dataSourceExt)) {\n-                        readExtensions(network, ise, anonymizer, options);\n-                    } catch (IOException e) {\n-                        LOGGER.warn(String.format(\"the extensions file wasn't found while importing, please ensure that the file name respect the naming convention baseFileName-ext.%s\", dataSourceExt));\n-                    }\n-                    break;\n-                case ONE_SEPARATED_FILE_PER_EXTENSION_TYPE:\n-                    String ext = dataSourceExt.isEmpty() ? \"\" : \".\" + dataSourceExt;\n-                    // here we'll read all extensions declared in the extensions set\n-                    readExtensions(network, dataSource, anonymizer, options, ext);\n-                    break;\n-                default:\n-                    break;\n-            }\n-        }\n         return network;\n     }\n \n-    public static Network read(Path xmlFile, ImportOptions options) throws IOException {\n-        DataSource dataSource = getDataSourceFromPath(xmlFile);\n-        String ext = getFileExtensionFromPath(xmlFile);\n-        return read(dataSource, NetworkFactory.findDefault(), options, ext);\n-    }\n-\n-    public static Network validateAndRead(Path xmlFile) {\n-        try {\n-            return validateAndRead(xmlFile, new ImportOptions());\n-        } catch (IOException e) {\n-            throw new UncheckedIOException(e);\n-        }\n-    }\n-\n-    private static void validate(Path xmlFile, IidmImportExportMode mode) throws IOException {\n-        DataSource dataSource = getDataSourceFromPath(xmlFile);\n-        String ext = getFileExtensionFromPath(xmlFile);\n-\n-        if (mode == IidmImportExportMode.EXTENSIONS_IN_ONE_SEPARATED_FILE) {\n-            try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + ext)) {\n-                validateWithExtensions(ise);\n-            }\n-            try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + \"-ext.\" + ext)) {\n-                validateWithExtensions(ise);\n-            }\n-        } else {\n-            Set<String> listNames = dataSource.listNames(\".*\\\\.\" + ext);\n-            for (String fileName : listNames) {\n-                try (InputStream ise = dataSource.newInputStream(fileName)) {\n-                    validateWithExtensions(ise);\n-                }\n-            }\n-        }\n-    }\n-\n-    public static Network validateAndRead(Path xmlFile, ImportOptions options) throws IOException {\n-        if (options.getMode() == IidmImportExportMode.UNIQUE_FILE) {\n-            validateWithExtensions(xmlFile);\n-            return read(xmlFile);\n-        }\n-        validate(xmlFile, options.getMode());\n-        return read(xmlFile, options);\n+    /**\n+     * @deprecated Use {@link #read(Path)} instead.\n+     */\n+    @Deprecated\n+    public static Network read(Path xmlFile, ImportOptions options) {\n+        return read(xmlFile);", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NjgwNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392276806", "bodyText": "Same question", "author": "mathbagu", "createdAt": "2020-03-13T14:52:34Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/NetworkXml.java", "diffHunk": "@@ -618,140 +467,32 @@ public static Network read(ReadOnlyDataSource dataSource, NetworkFactory network\n         try (InputStream isb = dataSource.newInputStream(null, dataSourceExt)) {\n             network = NetworkXml.read(isb, options, anonymizer, networkFactory);\n         }\n-        if (!options.withNoExtension()) {\n-            switch (options.getMode()) {\n-                case EXTENSIONS_IN_ONE_SEPARATED_FILE:\n-                    // in this case we have to read all extensions from one  file\n-                    try (InputStream ise = dataSource.newInputStream(\"-ext\", dataSourceExt)) {\n-                        readExtensions(network, ise, anonymizer, options);\n-                    } catch (IOException e) {\n-                        LOGGER.warn(String.format(\"the extensions file wasn't found while importing, please ensure that the file name respect the naming convention baseFileName-ext.%s\", dataSourceExt));\n-                    }\n-                    break;\n-                case ONE_SEPARATED_FILE_PER_EXTENSION_TYPE:\n-                    String ext = dataSourceExt.isEmpty() ? \"\" : \".\" + dataSourceExt;\n-                    // here we'll read all extensions declared in the extensions set\n-                    readExtensions(network, dataSource, anonymizer, options, ext);\n-                    break;\n-                default:\n-                    break;\n-            }\n-        }\n         return network;\n     }\n \n-    public static Network read(Path xmlFile, ImportOptions options) throws IOException {\n-        DataSource dataSource = getDataSourceFromPath(xmlFile);\n-        String ext = getFileExtensionFromPath(xmlFile);\n-        return read(dataSource, NetworkFactory.findDefault(), options, ext);\n-    }\n-\n-    public static Network validateAndRead(Path xmlFile) {\n-        try {\n-            return validateAndRead(xmlFile, new ImportOptions());\n-        } catch (IOException e) {\n-            throw new UncheckedIOException(e);\n-        }\n-    }\n-\n-    private static void validate(Path xmlFile, IidmImportExportMode mode) throws IOException {\n-        DataSource dataSource = getDataSourceFromPath(xmlFile);\n-        String ext = getFileExtensionFromPath(xmlFile);\n-\n-        if (mode == IidmImportExportMode.EXTENSIONS_IN_ONE_SEPARATED_FILE) {\n-            try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + ext)) {\n-                validateWithExtensions(ise);\n-            }\n-            try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + \"-ext.\" + ext)) {\n-                validateWithExtensions(ise);\n-            }\n-        } else {\n-            Set<String> listNames = dataSource.listNames(\".*\\\\.\" + ext);\n-            for (String fileName : listNames) {\n-                try (InputStream ise = dataSource.newInputStream(fileName)) {\n-                    validateWithExtensions(ise);\n-                }\n-            }\n-        }\n-    }\n-\n-    public static Network validateAndRead(Path xmlFile, ImportOptions options) throws IOException {\n-        if (options.getMode() == IidmImportExportMode.UNIQUE_FILE) {\n-            validateWithExtensions(xmlFile);\n-            return read(xmlFile);\n-        }\n-        validate(xmlFile, options.getMode());\n-        return read(xmlFile, options);\n+    /**\n+     * @deprecated Use {@link #read(Path)} instead.\n+     */\n+    @Deprecated\n+    public static Network read(Path xmlFile, ImportOptions options) {\n+        return read(xmlFile);\n     }\n \n-    // To read extensions from multiple extension files\n-    static void readExtensions(Network network, ReadOnlyDataSource dataSource, Anonymizer anonymizer, ImportOptions options, String ext) throws IOException {\n-        options.getExtensions().ifPresent(extensions -> {\n-            for (String extension : extensions) {\n-                try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + \"-\" + extension + ext)) {\n-                    readExtensions(network, ise, anonymizer, options);\n-                } catch (IOException e) {\n-                    LOGGER.warn(String.format(\"the %s extension file is not found despite it was declared in the extensions list\", extension));\n-                }\n-            }\n-        });\n-\n-        if (!options.getExtensions().isPresent()) {\n-            Set<String> listNames = dataSource.listNames(\".*\" + ext);\n-            listNames.remove(dataSource.getBaseName() + ext);\n-            for (String fileName : listNames) {\n-                try (InputStream ise = dataSource.newInputStream(fileName)) {\n-                    readExtensions(network, ise, anonymizer, options);\n-                } catch (IOException e) {\n-                    LOGGER.warn(String.format(\"the %s file is not found \", fileName));\n-                }\n-            }\n-        }\n+    /**\n+     * @deprecated Use {@link #validateAndRead(Path)} instead.\n+     */\n+    @Deprecated\n+    public static Network validateAndRead(Path xmlFile, ImportOptions options) {\n+        return validateAndRead(xmlFile);", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NzA2MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392277061", "bodyText": "I think you should rename this method validate", "author": "mathbagu", "createdAt": "2020-03-13T14:52:59Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/NetworkXml.java", "diffHunk": "@@ -618,140 +467,32 @@ public static Network read(ReadOnlyDataSource dataSource, NetworkFactory network\n         try (InputStream isb = dataSource.newInputStream(null, dataSourceExt)) {\n             network = NetworkXml.read(isb, options, anonymizer, networkFactory);\n         }\n-        if (!options.withNoExtension()) {\n-            switch (options.getMode()) {\n-                case EXTENSIONS_IN_ONE_SEPARATED_FILE:\n-                    // in this case we have to read all extensions from one  file\n-                    try (InputStream ise = dataSource.newInputStream(\"-ext\", dataSourceExt)) {\n-                        readExtensions(network, ise, anonymizer, options);\n-                    } catch (IOException e) {\n-                        LOGGER.warn(String.format(\"the extensions file wasn't found while importing, please ensure that the file name respect the naming convention baseFileName-ext.%s\", dataSourceExt));\n-                    }\n-                    break;\n-                case ONE_SEPARATED_FILE_PER_EXTENSION_TYPE:\n-                    String ext = dataSourceExt.isEmpty() ? \"\" : \".\" + dataSourceExt;\n-                    // here we'll read all extensions declared in the extensions set\n-                    readExtensions(network, dataSource, anonymizer, options, ext);\n-                    break;\n-                default:\n-                    break;\n-            }\n-        }\n         return network;\n     }\n \n-    public static Network read(Path xmlFile, ImportOptions options) throws IOException {\n-        DataSource dataSource = getDataSourceFromPath(xmlFile);\n-        String ext = getFileExtensionFromPath(xmlFile);\n-        return read(dataSource, NetworkFactory.findDefault(), options, ext);\n-    }\n-\n-    public static Network validateAndRead(Path xmlFile) {\n-        try {\n-            return validateAndRead(xmlFile, new ImportOptions());\n-        } catch (IOException e) {\n-            throw new UncheckedIOException(e);\n-        }\n-    }\n-\n-    private static void validate(Path xmlFile, IidmImportExportMode mode) throws IOException {\n-        DataSource dataSource = getDataSourceFromPath(xmlFile);\n-        String ext = getFileExtensionFromPath(xmlFile);\n-\n-        if (mode == IidmImportExportMode.EXTENSIONS_IN_ONE_SEPARATED_FILE) {\n-            try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + ext)) {\n-                validateWithExtensions(ise);\n-            }\n-            try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + \"-ext.\" + ext)) {\n-                validateWithExtensions(ise);\n-            }\n-        } else {\n-            Set<String> listNames = dataSource.listNames(\".*\\\\.\" + ext);\n-            for (String fileName : listNames) {\n-                try (InputStream ise = dataSource.newInputStream(fileName)) {\n-                    validateWithExtensions(ise);\n-                }\n-            }\n-        }\n-    }\n-\n-    public static Network validateAndRead(Path xmlFile, ImportOptions options) throws IOException {\n-        if (options.getMode() == IidmImportExportMode.UNIQUE_FILE) {\n-            validateWithExtensions(xmlFile);\n-            return read(xmlFile);\n-        }\n-        validate(xmlFile, options.getMode());\n-        return read(xmlFile, options);\n+    /**\n+     * @deprecated Use {@link #read(Path)} instead.\n+     */\n+    @Deprecated\n+    public static Network read(Path xmlFile, ImportOptions options) {\n+        return read(xmlFile);\n     }\n \n-    // To read extensions from multiple extension files\n-    static void readExtensions(Network network, ReadOnlyDataSource dataSource, Anonymizer anonymizer, ImportOptions options, String ext) throws IOException {\n-        options.getExtensions().ifPresent(extensions -> {\n-            for (String extension : extensions) {\n-                try (InputStream ise = dataSource.newInputStream(dataSource.getBaseName() + \"-\" + extension + ext)) {\n-                    readExtensions(network, ise, anonymizer, options);\n-                } catch (IOException e) {\n-                    LOGGER.warn(String.format(\"the %s extension file is not found despite it was declared in the extensions list\", extension));\n-                }\n-            }\n-        });\n-\n-        if (!options.getExtensions().isPresent()) {\n-            Set<String> listNames = dataSource.listNames(\".*\" + ext);\n-            listNames.remove(dataSource.getBaseName() + ext);\n-            for (String fileName : listNames) {\n-                try (InputStream ise = dataSource.newInputStream(fileName)) {\n-                    readExtensions(network, ise, anonymizer, options);\n-                } catch (IOException e) {\n-                    LOGGER.warn(String.format(\"the %s file is not found \", fileName));\n-                }\n-            }\n-        }\n+    /**\n+     * @deprecated Use {@link #validateAndRead(Path)} instead.\n+     */\n+    @Deprecated\n+    public static Network validateAndRead(Path xmlFile, ImportOptions options) {\n+        return validateAndRead(xmlFile);\n     }\n \n-    // To read extensions from an extensions file\n-    static Network readExtensions(Network network, InputStream ise, Anonymizer anonymizer, ImportOptions options) {\n-        try {\n-            XMLStreamReader reader = XML_INPUT_FACTORY_SUPPLIER.get().createXMLStreamReader(ise);\n-            int state = reader.next();\n-            while (state == XMLStreamReader.COMMENT) {\n-                state = reader.next();\n-            }\n-            String id = reader.getAttributeValue(null, \"id\");\n-            DateTime date = DateTime.parse(reader.getAttributeValue(null, CASE_DATE));\n-\n-            //verify that the extensions file matches with the same network\n-            if (!network.getId().equals(id) || !network.getCaseDate().equals(date)) {\n-                throw new PowsyblException(\"Extension file do not match with the base file !\");\n-            }\n-\n-            NetworkXmlReaderContext context = new NetworkXmlReaderContext(anonymizer, reader, options, CURRENT_IIDM_XML_VERSION);\n-            context.buildExtensionNamespaceUriList(EXTENSIONS_SUPPLIER.get().getProviders().stream());\n-            Set<String> extensionNamesNotFound = new TreeSet<>();\n-\n-            XmlUtil.readUntilEndElement(NETWORK_ROOT_ELEMENT_NAME, reader, () -> {\n-                if (reader.getLocalName().equals(EXTENSION_ELEMENT_NAME)) {\n-                    String id2 = context.getAnonymizer().deanonymizeString(reader.getAttributeValue(null, \"id\"));\n-                    Identifiable identifiable = network.getIdentifiable(id2);\n-                    if (identifiable == null) {\n-                        throw new PowsyblException(\"Identifiable \" + id2 + \" not found\");\n-                    }\n-                    readExtensions(identifiable, context, extensionNamesNotFound);\n-                } else {\n-                    throw new PowsyblException(\"Unexpected element: \" + reader.getLocalName());\n-                }\n-            });\n-\n-            checkExtensionsNotFound(context, extensionNamesNotFound);\n-\n-            return network;\n-        } catch (XMLStreamException e) {\n-            throw new UncheckedXmlStreamException(e);\n-        }\n+    public static Network validateAndRead(Path xmlFile) {\n+        validateWithExtensions(xmlFile);", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3ODA3Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392278073", "bodyText": "Do you think it's better with a method? Why don't you finish the job here:\nprivate ExportOptions createExportOptions(Properties parameters) {\n    ...\n}", "author": "mathbagu", "createdAt": "2020-03-13T14:54:42Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/XMLExporter.java", "diffHunk": "@@ -149,4 +138,16 @@ private void addExtensionsVersions(Properties parameters, ExportOptions options)\n             }\n         });\n     }\n+\n+    protected void buildExportOptions(Properties parameters, ExportOptions options) {\n+        options.setIndent(ConversionParameters.readBooleanParameter(getFormat(), parameters, INDENT_PARAMETER, defaultValueConfig))\n+                .setWithBranchSV(ConversionParameters.readBooleanParameter(getFormat(), parameters, WITH_BRANCH_STATE_VARIABLES_PARAMETER, defaultValueConfig))\n+                .setOnlyMainCc(ConversionParameters.readBooleanParameter(getFormat(), parameters, ONLY_MAIN_CC_PARAMETER, defaultValueConfig))\n+                .setAnonymized(ConversionParameters.readBooleanParameter(getFormat(), parameters, ANONYMISED_PARAMETER, defaultValueConfig))\n+                .setTopologyLevel(TopologyLevel.valueOf(ConversionParameters.readStringParameter(getFormat(), parameters, TOPOLOGY_LEVEL_PARAMETER, defaultValueConfig)))\n+                .setThrowExceptionIfExtensionNotFound(ConversionParameters.readBooleanParameter(getFormat(), parameters, THROW_EXCEPTION_IF_EXTENSION_NOT_FOUND_PARAMETER, defaultValueConfig))\n+                .setExtensions(ConversionParameters.readStringListParameter(getFormat(), parameters, EXTENSIONS_LIST_PARAMETER, defaultValueConfig) != null ? new HashSet<>(ConversionParameters.readStringListParameter(getFormat(), parameters, EXTENSIONS_LIST_PARAMETER, defaultValueConfig)) : null)\n+                .setVersion(ConversionParameters.readStringParameter(getFormat(), parameters, VERSION_PARAMETER, defaultValueConfig));\n+        addExtensionsVersions(parameters, options);\n+    }", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3ODMxMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1215#discussion_r392278312", "bodyText": "Same remark", "author": "mathbagu", "createdAt": "2020-03-13T14:55:08Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/XMLImporter.java", "diffHunk": "@@ -195,5 +187,12 @@ public Network importData(ReadOnlyDataSource dataSource, NetworkFactory networkF\n         }\n         return network;\n     }\n+\n+    protected void buildImportOptions(Properties parameters, ImportOptions options) {\n+        options\n+                .setThrowExceptionIfExtensionNotFound(ConversionParameters.readBooleanParameter(getFormat(), parameters, THROW_EXCEPTION_IF_EXTENSION_NOT_FOUND_PARAMETER, defaultValueConfig))\n+                .setExtensions(ConversionParameters.readStringListParameter(getFormat(), parameters, EXTENSIONS_LIST_PARAMETER, defaultValueConfig) != null ? new HashSet<>(ConversionParameters.readStringListParameter(getFormat(), parameters, EXTENSIONS_LIST_PARAMETER, defaultValueConfig)) : null);\n+\n+    }", "originalCommit": "4dee8c8c859c4fd8b6b9934d9f1fefdbeb743c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "764a1e64263139d32e0973d4378b8eb96ea39ca0", "url": "https://github.com/powsybl/powsybl-core/commit/764a1e64263139d32e0973d4378b8eb96ea39ca0", "message": "Move all code regarding multi-files XIIDM files in new modules\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:20:11Z", "type": "commit"}, {"oid": "4c731858f3fa4bde2887f1699f157003c9c90741", "url": "https://github.com/powsybl/powsybl-core/commit/4c731858f3fa4bde2887f1699f157003c9c90741", "message": "Add tests + corrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:20:11Z", "type": "commit"}, {"oid": "38b3d2a1ac5862ec7cbba47d9b47585337ff475e", "url": "https://github.com/powsybl/powsybl-core/commit/38b3d2a1ac5862ec7cbba47d9b47585337ff475e", "message": "Revert public level of XML components\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:20:11Z", "type": "commit"}, {"oid": "0eabf0727f82bbc5f34e501049bd10ca110d92f2", "url": "https://github.com/powsybl/powsybl-core/commit/0eabf0727f82bbc5f34e501049bd10ca110d92f2", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete white spaces\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete unused field\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrect checkstyle\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:20:11Z", "type": "commit"}, {"oid": "0eabf0727f82bbc5f34e501049bd10ca110d92f2", "url": "https://github.com/powsybl/powsybl-core/commit/0eabf0727f82bbc5f34e501049bd10ca110d92f2", "message": "Deletion of multi-files XIIDM import/export\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd deprecated comments + correct a code smell\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete whitespace changes\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nclean\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete white spaces\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ndelete unused field\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrect checkstyle\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:20:11Z", "type": "forcePushed"}, {"oid": "9959afe5e58206f97a51c32b4f86b1ca224dba5b", "url": "https://github.com/powsybl/powsybl-core/commit/9959afe5e58206f97a51c32b4f86b1ca224dba5b", "message": "Revert XmlUtil mutualization\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:33:34Z", "type": "commit"}, {"oid": "f9ffecb6d8eca3eb7e187a8be900af9c7e492532", "url": "https://github.com/powsybl/powsybl-core/commit/f9ffecb6d8eca3eb7e187a8be900af9c7e492532", "message": "Revert order change in IidmImportExportMode\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T11:34:24Z", "type": "commit"}, {"oid": "72f211218508b92916afd4f6ef4295b13f372c26", "url": "https://github.com/powsybl/powsybl-core/commit/72f211218508b92916afd4f6ef4295b13f372c26", "message": "Refactoring XmlImporter and XmlExporter for options creations\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T13:02:55Z", "type": "commit"}, {"oid": "0d534f7a3f00134db344ff6c93e5b2e3b67ac9ef", "url": "https://github.com/powsybl/powsybl-core/commit/0d534f7a3f00134db344ff6c93e5b2e3b67ac9ef", "message": "Do not deprecate read(Path, ImportOptions) and validateAndRead(Path, ImportOptions)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T13:08:26Z", "type": "commit"}, {"oid": "7adb7d07e5c1164b24badc51881aaa72764b008b", "url": "https://github.com/powsybl/powsybl-core/commit/7adb7d07e5c1164b24badc51881aaa72764b008b", "message": "Rename validateWithoutExtensions as validate and delete validation without extensions (never used)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T13:23:41Z", "type": "commit"}, {"oid": "f0106241ed9ff2734b72258ec91d2fe15be53d20", "url": "https://github.com/powsybl/powsybl-core/commit/f0106241ed9ff2734b72258ec91d2fe15be53d20", "message": "Revert changes commons/pom.xml\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-18T13:33:26Z", "type": "commit"}, {"oid": "4dffe20f087918c29cc601c61b460d65046c99aa", "url": "https://github.com/powsybl/powsybl-core/commit/4dffe20f087918c29cc601c61b460d65046c99aa", "message": "Merge branch 'master' into separate_multi_xiidm", "committedDate": "2020-03-23T10:17:55Z", "type": "commit"}]}