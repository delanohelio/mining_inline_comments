{"pr_number": 1359, "pr_title": "IIDM operational limits ", "pr_createdAt": "2020-06-19T08:08:08Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1359", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MTQ5Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r443381497", "bodyText": "Don't forget the license header", "author": "mathbagu", "createdAt": "2020-06-22T08:00:37Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/LoadingLimits.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.powsybl.iidm.network;", "originalCommit": "9f8a5f9f9fc684ec88a15edcaf3cdae33b1db699", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MTY1Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r443381653", "bodyText": "Fix copyright information. I think you rename the CurrentLimitsAdder to LoadingLimitsAdder, but maybe you should fix it", "author": "mathbagu", "createdAt": "2020-06-22T08:00:59Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/LoadingLimitsAdder.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/**\n+ * Copyright (c) 2016, All partners of the iTesla project (http://www.itesla-project.eu/consortium)", "originalCommit": "9f8a5f9f9fc684ec88a15edcaf3cdae33b1db699", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MjE2Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r443382166", "bodyText": "Don't forget the license header", "author": "mathbagu", "createdAt": "2020-06-22T08:01:56Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/OperationalLimits.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.powsybl.iidm.network;", "originalCommit": "9f8a5f9f9fc684ec88a15edcaf3cdae33b1db699", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "391c3885f0645ca692275c851ce03317f3490655", "url": "https://github.com/powsybl/powsybl-core/commit/391c3885f0645ca692275c851ce03317f3490655", "message": "Add copyright and authors\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-06-23T14:58:22Z", "type": "forcePushed"}, {"oid": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "url": "https://github.com/powsybl/powsybl-core/commit/d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "message": "Adding hasTemporaryLimits in LoadingLimitsAdder\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-01T07:34:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5NzY5Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448897692", "bodyText": "I am really at ease with this function name choice. I imagine that we have it from the actual API. What do you think ?", "author": "annetill", "createdAt": "2020-07-02T10:13:47Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/LoadingLimits.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+import java.util.Collection;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ * @author Thibaut Vermeulen <thibaut.vermeulen at rte-france.com>\n+ */\n+public interface LoadingLimits extends OperationalLimits {\n+\n+    /**\n+     * Temporary current limit.\n+     */\n+    interface TemporaryLimit {\n+\n+        /**\n+         * Get the temporary limit name\n+         * @return the temporary limit name\n+         */\n+        String getName();\n+\n+        /**\n+         * Get the temporary limit value.\n+         * @return the temporary limit value\n+         */\n+        double getValue();\n+\n+        /**\n+         * Get the acceptable duration of the limit in second.\n+         * @return the acceptable duration of the limit in second\n+         */\n+        int getAcceptableDuration();\n+\n+        /**\n+         * Check if the temporary limit is a real limit corresponding to an overloading  protection or just an operating\n+         * rule\n+         * @return false if it is a real limit, false otherwise\n+         */\n+        boolean isFictitious();", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MjQwNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450072406", "bodyText": "I agree: we should rename this method. This method returns true if there is an protection automaton that monitor the equipment. I think we can find a better name.", "author": "mathbagu", "createdAt": "2020-07-06T08:43:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5NzY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNTg3NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450215875", "bodyText": "Okay, I agree, is hasOverloadingProtection() an okay name?\nAlso, I am not sure limits other than current limits can have protection automaton, should this be specific to CurrentLimits.TL?", "author": "miovd", "createdAt": "2020-07-06T13:22:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5NzY5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMjI4Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448902287", "bodyText": "I am not sure to well understand: here we don't have the methods getApparentPowerLimits1() and getActivePowerLimits1() ?  So how do I do to get them ?", "author": "annetill", "createdAt": "2020-07-02T10:22:15Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -57,16 +60,79 @@\n \n     Side getSide(Terminal terminal);\n \n-    CurrentLimits getCurrentLimits(Side side);\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} or {@link #getOperationalLimits2(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits(Side side) {\n+        if (side == Side.ONE) {\n+            return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+        } else if (side == Side.TWO) {\n+            return getOperationalLimits2(LimitType.CURRENT, CurrentLimits.class);\n+        }\n+        throw new AssertionError(\"Unexpected side: \" + side);\n+    }\n \n-    CurrentLimits getCurrentLimits1();\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits1() {\n+        return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+    }\n+\n+    default List<OperationalLimits> getOperationalLimits1() {", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2ODM0Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450068346", "bodyText": "This method will return a list of operational limit, that contains apparent limits, active power limits, and current limits.\nIn the API, we have to give a default behavior to the method to ensure backward compatibility. In previous IIDM version, only current limits was supported. So the implementation seems correct.", "author": "mathbagu", "createdAt": "2020-07-06T08:36:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMjI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMjc0NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448902745", "bodyText": "Same remark, how do I access to apparent power limits and active power limits ?", "author": "annetill", "createdAt": "2020-07-02T10:23:15Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/DanglingLine.java", "diffHunk": "@@ -98,8 +101,21 @@\n      */\n     String getUcteXnodeCode();\n \n-    CurrentLimits getCurrentLimits();\n-\n-    CurrentLimitsAdder newCurrentLimits();\n-\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits() {\n+        return getOperationalLimits(LimitType.CURRENT, CurrentLimits.class);\n+    }\n+", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMzIyMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448903222", "bodyText": "Indeed you just leave getCurrentLimits() for compatibility but you will remove it ?", "author": "annetill", "createdAt": "2020-07-02T10:24:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMjc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNjI0Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450216247", "bodyText": "Yes, this is it.", "author": "miovd", "createdAt": "2020-07-06T13:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMjc0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDE1NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448904155", "bodyText": "Mmmmm I think that we have a problem here. Do you have any idea of the solution ?", "author": "annetill", "createdAt": "2020-07-02T10:26:01Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Switch.java", "diffHunk": "@@ -53,4 +56,44 @@\n      * @param retained the retain status of the switch\n      */\n     void setRetained(boolean retained);\n+\n+    default List<OperationalLimits> getOperationalLimits1() {\n+        return Collections.emptyList();\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits1(LimitType limitType, Class<L> limitClazz) {\n+        return null;\n+    }\n+\n+    default CurrentLimitsAdder newCurrentLimits1() {\n+        throw new UnsupportedOperationException();", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDgxMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448904811", "bodyText": "Do we have a side for switches ?", "author": "annetill", "createdAt": "2020-07-02T10:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDE1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNzIxMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450217213", "bodyText": "We don't have \"side\" object per see, but we discriminate between node1 and node2 (or bus1 and bus2) of a switch", "author": "miovd", "createdAt": "2020-07-06T13:24:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDE1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNzQ1OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r448907458", "bodyText": "Why do we have this exception ?", "author": "annetill", "createdAt": "2020-07-02T10:32:42Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Injection.java", "diffHunk": "@@ -18,4 +21,27 @@\n      */\n     Terminal getTerminal();\n \n+    default List<OperationalLimits> getOperationalLimits() {\n+        return Collections.emptyList();\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits(LimitType type, Class<L> limitClazz) {\n+        return null;\n+    }\n+\n+    default CurrentLimitsAdder newCurrentLimits() {\n+        throw new UnsupportedOperationException();", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNzU5MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450217591", "bodyText": "It is only to prevent breaking change (error in implementation - for example in persistent IIDM)", "author": "miovd", "createdAt": "2020-07-06T13:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNzQ1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NjMwOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450066309", "bodyText": "Should we be more specific? The type of the limit is not CURRENT anymore?", "author": "mathbagu", "createdAt": "2020-07-06T08:32:42Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -28,7 +31,7 @@\n          * In particular, it determines the duration during which\n          * the current current value may be sustained.\n          */\n-        CurrentLimits.TemporaryLimit getTemporaryLimit();\n+        LoadingLimits.TemporaryLimit getTemporaryLimit();", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA5NTA3Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450095073", "bodyText": "Good remark... Not sure but I think for now, it will only be for current limits, I will keep it at that.", "author": "miovd", "createdAt": "2020-07-06T09:23:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NjMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NzA2MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450067061", "bodyText": "I don't know if it's possible, but to have the same bahaviour you have to use the new method, but the first parameter is LimitType.CURRENT and the second one is CurrentLimits.class", "author": "mathbagu", "createdAt": "2020-07-06T08:34:04Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -57,16 +60,79 @@\n \n     Side getSide(Terminal terminal);\n \n-    CurrentLimits getCurrentLimits(Side side);\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} or {@link #getOperationalLimits2(LimitType, Class)} instead.", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc0NTU1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450745556", "bodyText": "Add snipets of code in javadoc to specify it", "author": "miovd", "createdAt": "2020-07-07T09:51:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NzA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NzIwNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450067204", "bodyText": "Same remark", "author": "mathbagu", "createdAt": "2020-07-06T08:34:19Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -57,16 +60,79 @@\n \n     Side getSide(Terminal terminal);\n \n-    CurrentLimits getCurrentLimits(Side side);\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} or {@link #getOperationalLimits2(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits(Side side) {\n+        if (side == Side.ONE) {\n+            return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+        } else if (side == Side.TWO) {\n+            return getOperationalLimits2(LimitType.CURRENT, CurrentLimits.class);\n+        }\n+        throw new AssertionError(\"Unexpected side: \" + side);\n+    }\n \n-    CurrentLimits getCurrentLimits1();\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} instead.", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc0NTYyMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450745620", "bodyText": "Same", "author": "miovd", "createdAt": "2020-07-07T09:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NzIwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2OTM3NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450069375", "bodyText": "I don't know how it's possible, but do we really need to pass both parameters? For instance, in ReactiveLimitsHolder, we only pass the class:\n<L extends ReactiveLimits> L getReactiveLimits(Class<L> type)", "author": "mathbagu", "createdAt": "2020-07-06T08:38:17Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -57,16 +60,79 @@\n \n     Side getSide(Terminal terminal);\n \n-    CurrentLimits getCurrentLimits(Side side);\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} or {@link #getOperationalLimits2(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits(Side side) {\n+        if (side == Side.ONE) {\n+            return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+        } else if (side == Side.TWO) {\n+            return getOperationalLimits2(LimitType.CURRENT, CurrentLimits.class);\n+        }\n+        throw new AssertionError(\"Unexpected side: \" + side);\n+    }\n \n-    CurrentLimits getCurrentLimits1();\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits1() {\n+        return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+    }\n+\n+    default List<OperationalLimits> getOperationalLimits1() {\n+        return Collections.singletonList(getCurrentLimits1());\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits1(LimitType limitType, Class<L> limitClazz) {\n+        return limitType == LimitType.CURRENT && limitClazz == CurrentLimits.class ? (L) getCurrentLimits1() : null;", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY4NTg2NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450685864", "bodyText": "The issue is: what do we do if a user passes a parent class of two different kinds of limits? (for example, LoadingLimits.class). We do not have this issue with reactive limits because an equipment only has one instance of reactive limits.", "author": "miovd", "createdAt": "2020-07-07T08:12:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2OTM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MDY0OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450070648", "bodyText": "Are all these type of limits are possible for lines and/or transformers? I thought apparentPower was for transformers: we do not have this information for lines.", "author": "mathbagu", "createdAt": "2020-07-06T08:40:27Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -57,16 +60,79 @@\n \n     Side getSide(Terminal terminal);\n \n-    CurrentLimits getCurrentLimits(Side side);\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} or {@link #getOperationalLimits2(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits(Side side) {\n+        if (side == Side.ONE) {\n+            return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+        } else if (side == Side.TWO) {\n+            return getOperationalLimits2(LimitType.CURRENT, CurrentLimits.class);\n+        }\n+        throw new AssertionError(\"Unexpected side: \" + side);\n+    }\n \n-    CurrentLimits getCurrentLimits1();\n+    /**\n+     * @deprecated Use {@link #getOperationalLimits1(LimitType, Class)} instead.\n+     */\n+    @Deprecated\n+    default CurrentLimits getCurrentLimits1() {\n+        return getOperationalLimits1(LimitType.CURRENT, CurrentLimits.class);\n+    }\n+\n+    default List<OperationalLimits> getOperationalLimits1() {\n+        return Collections.singletonList(getCurrentLimits1());\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits1(LimitType limitType, Class<L> limitClazz) {\n+        return limitType == LimitType.CURRENT && limitClazz == CurrentLimits.class ? (L) getCurrentLimits1() : null;\n+    }\n \n     CurrentLimitsAdder newCurrentLimits1();\n \n-    CurrentLimits getCurrentLimits2();\n+    default ApparentPowerLimitsAdder newApparentPowerLimits1() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default ActivePowerLimitsAdder newActivePowerLimits1() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default VoltageLimitsAdder newVoltageLimits1() {\n+        throw new UnsupportedOperationException();\n+    }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxOTIxNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450219216", "bodyText": "apparentPower is voltage*current so it should be fine (ratedS is manufacturer information). For voltage limits, I think we would look at bus voltage at the point of connection of the equipment to check if the limit is respected or not", "author": "miovd", "createdAt": "2020-07-06T13:27:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MDY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MTY2Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450071667", "bodyText": "Some of the operation limits are weird for injections. In IIDM, we do not have sufficient information to compute them.", "author": "mathbagu", "createdAt": "2020-07-06T08:42:16Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Injection.java", "diffHunk": "@@ -18,4 +21,27 @@\n      */\n     Terminal getTerminal();\n \n+    default List<OperationalLimits> getOperationalLimits() {\n+        return Collections.emptyList();\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits(LimitType type, Class<L> limitClazz) {\n+        return null;\n+    }\n+\n+    default CurrentLimitsAdder newCurrentLimits() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default ApparentPowerLimitsAdder newApparentPowerLimits() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default ActivePowerLimitsAdder newActivePowerLimits() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default VoltageLimitsAdder newVoltageLimits() {\n+        throw new UnsupportedOperationException();\n+    }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIyMDAxNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450220015", "bodyText": "Same answer as above", "author": "miovd", "createdAt": "2020-07-06T13:28:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MTY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MjkwMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450072902", "bodyText": "I'm not convinced you have to provide a default method here: default method should not be used to factorize the code (use abstract class instead).", "author": "mathbagu", "createdAt": "2020-07-06T08:44:32Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/OperationalLimits.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ * @author Thibaut Vermeulen <thibaut.vermeulen at rte-france.com>\n+ */\n+public interface OperationalLimits {\n+    /**\n+     * Get the operational limits' type (can be APPARENT_POWER, CURRENT or VOLTAGE)\n+     */\n+    LimitType getLimitType();\n+\n+    default void remove() {\n+        // do nothing\n+    }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIyMTExOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450221118", "bodyText": "It is mostly to prevent breaking changes. Is it better in your opinion to throw an exception?", "author": "miovd", "createdAt": "2020-07-06T13:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MjkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3MzgwOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450073808", "bodyText": "I would refactor a little bit the code: create a OperationLimitsHolder interface, to avoid to declare these methods everywhere?", "author": "mathbagu", "createdAt": "2020-07-06T08:46:03Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Switch.java", "diffHunk": "@@ -53,4 +56,44 @@\n      * @param retained the retain status of the switch\n      */\n     void setRetained(boolean retained);\n+\n+    default List<OperationalLimits> getOperationalLimits1() {\n+        return Collections.emptyList();\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits1(LimitType limitType, Class<L> limitClazz) {\n+        return null;\n+    }\n+\n+    default CurrentLimitsAdder newCurrentLimits1() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default ApparentPowerLimitsAdder newApparentPowerLimits1() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default VoltageLimitsAdder newVoltageLimits1() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default List<OperationalLimits> getOperationalLimits2() {\n+        return Collections.emptyList();\n+    }\n+\n+    default <L extends OperationalLimits> L getOperationalLimits2(LimitType limitType, Class<L> limitClazz) {\n+        return null;\n+    }\n+\n+    default CurrentLimitsAdder newCurrentLimits2() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default ApparentPowerLimitsAdder newApparentPowerLimits2() {\n+        throw new UnsupportedOperationException();\n+    }\n+\n+    default VoltageLimitsAdder newVoltageLimits2() {\n+        throw new UnsupportedOperationException();\n+    }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NDMyNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450074327", "bodyText": "I think a word is missing:\n\nmust be defined and greater than 0", "author": "mathbagu", "createdAt": "2020-07-06T08:46:57Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,8 +385,9 @@ public static void checkConnected(Validable validable, Boolean connected) {\n     }\n \n     public static void checkPermanentLimit(Validable validable, double permanentLimit) {\n+        // TODO: if (Double.isNaN(permanentLimit) || permanentLimit <= 0) {\n         if (permanentLimit <= 0) {\n-            throw new ValidationException(validable, \"permanent limit must be > 0\");\n+            throw new ValidationException(validable, \"permanent limit must defined and be > 0\");", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NTAwNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450075004", "bodyText": "Is it really useful to have these getters?", "author": "mathbagu", "createdAt": "2020-07-06T08:48:09Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractBranch.java", "diffHunk": "@@ -80,54 +82,71 @@ public Side getSide(Terminal terminal) {\n     }\n \n     @Override\n-    public void setCurrentLimits(Branch.Side side, CurrentLimitsImpl limits) {\n-        switch (side) {\n-            case ONE:\n-                CurrentLimits oldValue1 = limits1;\n-                limits1 = limits;\n-                notifyUpdate(\"currentLimits1\", oldValue1, limits1);\n-                break;\n-            case TWO:\n-                CurrentLimits oldValue2 = limits2;\n-                limits2 = limits;\n-                notifyUpdate(\"currentLimits2\", oldValue2, limits2);\n-                break;\n-            default:\n-                throw new AssertionError(\"Unexpected Branch.Side value: \" + side);\n-        }\n+    public List<OperationalLimits> getOperationalLimits1() {\n+        return operationalLimitsHolder1.getOperationalLimits();\n     }\n \n     @Override\n-    public CurrentLimits getCurrentLimits(Side side) {\n-        switch (side) {\n-            case ONE:\n-                return limits1;\n-            case TWO:\n-                return limits2;\n-            default:\n-                throw new AssertionError(\"Unexpected Branch.Side value: \" + side);\n-        }\n+    public <L extends OperationalLimits> L getOperationalLimits1(LimitType limitType, Class<L> limitClazz) {\n+        return operationalLimitsHolder1.getOperationalLimits(limitType, limitClazz);\n+    }\n+\n+    @Override\n+    public CurrentLimitsAdder newCurrentLimits1() {\n+        return operationalLimitsHolder1.newCurrentLimits();\n+    }\n \n+    @Override\n+    public ApparentPowerLimitsAdder newApparentPowerLimits1() {\n+        return operationalLimitsHolder1.newApparentPowerLimits();\n     }\n \n     @Override\n-    public CurrentLimits getCurrentLimits1() {\n-        return limits1;\n+    public ActivePowerLimitsAdder newActivePowerLimits1() {\n+        return operationalLimitsHolder1.newActivePowerLimitsAdder();\n     }\n \n     @Override\n-    public CurrentLimitsAdder newCurrentLimits1() {\n-        return new CurrentLimitsAdderImpl<>(Branch.Side.ONE, this);\n+    public VoltageLimitsAdder newVoltageLimits1() {\n+        return operationalLimitsHolder1.newVoltageLimits();\n     }\n \n     @Override\n-    public CurrentLimits getCurrentLimits2() {\n-        return limits2;\n+    public List<OperationalLimits> getOperationalLimits2() {\n+        return operationalLimitsHolder2.getOperationalLimits();\n+    }\n+\n+    @Override\n+    public <L extends OperationalLimits> L getOperationalLimits2(LimitType limitType, Class<L> limitClazz) {\n+        return operationalLimitsHolder2.getOperationalLimits(limitType, limitClazz);\n     }\n \n     @Override\n     public CurrentLimitsAdder newCurrentLimits2() {\n-        return new CurrentLimitsAdderImpl<>(Branch.Side.TWO, this);\n+        return operationalLimitsHolder2.newCurrentLimits();\n+    }\n+\n+    @Override\n+    public ApparentPowerLimitsAdder newApparentPowerLimits2() {\n+        return operationalLimitsHolder2.newApparentPowerLimits();\n+    }\n+\n+    @Override\n+    public ActivePowerLimitsAdder newActivePowerLimits2() {\n+        return operationalLimitsHolder2.newActivePowerLimitsAdder();\n+    }\n+\n+    @Override\n+    public VoltageLimitsAdder newVoltageLimits2() {\n+        return operationalLimitsHolder2.newVoltageLimits();\n+    }\n+\n+    OperationalLimitsHolderImpl getLimitsHolder1() {\n+        return operationalLimitsHolder1;\n+    }\n+\n+    OperationalLimitsHolderImpl getLimitsHolder2() {\n+        return operationalLimitsHolder2;", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIyMjQyMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450222423", "bodyText": "Yes, for topological merge in NetworkImpl", "author": "miovd", "createdAt": "2020-07-06T13:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NTAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NTU3NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450075574", "bodyText": "Reorder these attributes: owner, permanentLimit, temporaryLimit", "author": "mathbagu", "createdAt": "2020-07-06T08:49:10Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractLoadingLimits.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.LoadingLimits;\n+import com.powsybl.iidm.network.ValidationUtil;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.TreeMap;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractLoadingLimits<L extends AbstractLoadingLimits<L>> implements LoadingLimits {\n+\n+    private double permanentLimit;\n+\n+    private final TreeMap<Integer, TemporaryLimit> temporaryLimits;\n+\n+    protected final OperationalLimitsOwner owner;", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NTgzOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450075839", "bodyText": "Move the owner at the first place.", "author": "mathbagu", "createdAt": "2020-07-06T08:49:37Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractLoadingLimits.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.LoadingLimits;\n+import com.powsybl.iidm.network.ValidationUtil;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.TreeMap;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractLoadingLimits<L extends AbstractLoadingLimits<L>> implements LoadingLimits {\n+\n+    private double permanentLimit;\n+\n+    private final TreeMap<Integer, TemporaryLimit> temporaryLimits;\n+\n+    protected final OperationalLimitsOwner owner;\n+\n+    static class TemporaryLimitImpl implements TemporaryLimit {\n+\n+        private final String name;\n+\n+        private final double value;\n+\n+        private final int acceptableDuration;\n+\n+        private boolean fictitious;\n+\n+        TemporaryLimitImpl(String name, double value, int acceptableDuration, boolean fictitious) {\n+            this.name = Objects.requireNonNull(name);\n+            this.value = value;\n+            this.acceptableDuration = acceptableDuration;\n+            this.fictitious = fictitious;\n+        }\n+\n+        @Override\n+        public String getName() {\n+            return name;\n+        }\n+\n+        @Override\n+        public double getValue() {\n+            return value;\n+        }\n+\n+        @Override\n+        public int getAcceptableDuration() {\n+            return acceptableDuration;\n+        }\n+\n+        @Override\n+        public boolean isFictitious() {\n+            return fictitious;\n+        }\n+    }\n+\n+    AbstractLoadingLimits(double permanentLimit, TreeMap<Integer, TemporaryLimit> temporaryLimits, OperationalLimitsOwner owner) {", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NjkwOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450076909", "bodyText": "I think the remove method could me mutualized:\nowner.setOperationLimit(getLimitType(), null);", "author": "mathbagu", "createdAt": "2020-07-06T08:51:31Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ApparentPowerLimitsImpl.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ApparentPowerLimits;\n+import com.powsybl.iidm.network.LimitType;\n+\n+import java.util.TreeMap;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ApparentPowerLimitsImpl extends AbstractLoadingLimits<ApparentPowerLimitsImpl> implements ApparentPowerLimits {\n+\n+    ApparentPowerLimitsImpl(double permanentLimit, TreeMap<Integer, TemporaryLimit> temporaryLimits, OperationalLimitsOwner owner) {\n+        super(permanentLimit, temporaryLimits, owner);\n+    }\n+\n+    @Override\n+    public void remove() {\n+        owner.setOperationalLimits(LimitType.APPARENT_POWER, null);", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE0MDExNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r492140116", "bodyText": "It seems you liked my comment, but you didn't take it into account", "author": "mathbagu", "createdAt": "2020-09-21T15:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NjkwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NzYyNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450077627", "bodyText": "Are null allowed?\nYou should switch the parameter order", "author": "mathbagu", "createdAt": "2020-07-06T08:52:44Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/OperationalLimitsHolderImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.*;\n+\n+import java.util.ArrayList;\n+import java.util.EnumMap;\n+import java.util.List;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class OperationalLimitsHolderImpl implements OperationalLimitsOwner {\n+\n+    private final EnumMap<LimitType, OperationalLimits> operationalLimits = new EnumMap<>(LimitType.class);\n+    private final AbstractIdentifiable<?> identifiable;\n+    private final String attributeName;\n+\n+    OperationalLimitsHolderImpl(String attributeName, AbstractIdentifiable<?> identifiable) {\n+        this.identifiable = identifiable;\n+        this.attributeName = attributeName;", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3ODY3OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450078678", "bodyText": "Should be declared as final?", "author": "mathbagu", "createdAt": "2020-07-06T08:54:31Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ThreeWindingsTransformerImpl.java", "diffHunk": "@@ -37,7 +34,7 @@\n \n         private double ratedS;\n \n-        private CurrentLimits limits;\n+        private OperationalLimitsHolderImpl operationalLimitsHolder;", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzNjU4MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450236581", "bodyText": "It is only set in setTransformer() i.e. when the transformer is created which is only after the legs are created, which explains why it isn't final.", "author": "miovd", "createdAt": "2020-07-06T13:54:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3ODY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3OTYxNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450079614", "bodyText": "Do we need to introduce a new method to avoid this duplication (3 times)", "author": "mathbagu", "createdAt": "2020-07-06T08:56:01Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/VoltageLimitsImpl.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ValidationException;\n+import com.powsybl.iidm.network.ValidationUtil;\n+import com.powsybl.iidm.network.VoltageLimits;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class VoltageLimitsImpl implements VoltageLimits {\n+\n+    private final OperationalLimitsOwner owner;\n+    private double highVoltage;\n+    private double lowVoltage;\n+\n+    VoltageLimitsImpl(OperationalLimitsOwner owner, double lowVoltage, double highVoltage) {\n+        this.owner = owner;\n+        this.highVoltage = highVoltage;\n+        this.lowVoltage = lowVoltage;\n+    }\n+\n+    @Override\n+    public double getHighVoltage() {\n+        return highVoltage;\n+    }\n+\n+    @Override\n+    public VoltageLimits setHighVoltage(double highVoltage) {\n+        if (Double.isNaN(lowVoltage) && Double.isNaN(highVoltage)) {\n+            throw new ValidationException(owner, \"At least the low or the high voltage limit must be defined.\");\n+        }\n+        ValidationUtil.checkVoltageLimits(owner, lowVoltage, highVoltage);", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MDA1NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450080055", "bodyText": "Remove these methods?", "author": "mathbagu", "createdAt": "2020-07-06T08:56:44Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/AbstractBranchAdapter.java", "diffHunk": "@@ -53,30 +52,83 @@ public Side getSide(final Terminal terminal) {\n     // Simple delegated methods ------\n     // -------------------------------\n     @Override\n+    @Deprecated\n     public CurrentLimits getCurrentLimits(final Side side) {\n         return getDelegate().getCurrentLimits(side);\n     }\n \n     @Override\n+    @Deprecated\n     public CurrentLimits getCurrentLimits1() {\n         return getDelegate().getCurrentLimits1();\n     }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MDM0Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450080347", "bodyText": "Remove this method", "author": "mathbagu", "createdAt": "2020-07-06T08:57:13Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/DanglingLineAdapter.java", "diffHunk": "@@ -92,12 +92,8 @@ public String getUcteXnodeCode() {\n     }\n \n     @Override\n+    @Deprecated\n     public CurrentLimits getCurrentLimits() {\n         return getDelegate().getCurrentLimits();\n     }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MDU4OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450080589", "bodyText": "Why this method is removed?", "author": "mathbagu", "createdAt": "2020-07-06T08:57:40Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/DanglingLineAdapter.java", "diffHunk": "@@ -92,12 +92,8 @@ public String getUcteXnodeCode() {\n     }\n \n     @Override\n+    @Deprecated\n     public CurrentLimits getCurrentLimits() {\n         return getDelegate().getCurrentLimits();\n     }\n-\n-    @Override\n-    public CurrentLimitsAdder newCurrentLimits() {\n-        return getDelegate().newCurrentLimits();\n-    }", "originalCommit": "d6113474e8c1a3f5f3a5af097c03ded105d0adbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzODc0Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r450238743", "bodyText": "I deplaced it in AbstractInjectionAdapter", "author": "miovd", "createdAt": "2020-07-06T13:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MDU4OQ=="}], "type": "inlineReview"}, {"oid": "0c55e87ea06d5bcc8b3a6a645f75725d24a67c80", "url": "https://github.com/powsybl/powsybl-core/commit/0c55e87ea06d5bcc8b3a6a645f75725d24a67c80", "message": "Take reviewer comment into account (part 1)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-06T14:56:53Z", "type": "forcePushed"}, {"oid": "747beb918a918f45403c13e9c7471351f678389b", "url": "https://github.com/powsybl/powsybl-core/commit/747beb918a918f45403c13e9c7471351f678389b", "message": "Change isFictitious() method by hasOverloadingLimit()\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-17T09:33:29Z", "type": "forcePushed"}, {"oid": "dc868dd2c6edab64643c47bfedc3cb9ae318f321", "url": "https://github.com/powsybl/powsybl-core/commit/dc868dd2c6edab64643c47bfedc3cb9ae318f321", "message": "Do not use leg.getCurrentLimits() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-07-21T15:39:14Z", "type": "forcePushed"}, {"oid": "bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "url": "https://github.com/powsybl/powsybl-core/commit/bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "message": "Do not use leg.getCurrentLimits() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-09-16T13:01:44Z", "type": "forcePushed"}, {"oid": "bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "url": "https://github.com/powsybl/powsybl-core/commit/bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "message": "Do not use leg.getCurrentLimits() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-09-16T13:01:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEzNTU1Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r492135552", "bodyText": "What about this TODO?", "author": "mathbagu", "createdAt": "2020-09-21T15:14:11Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,8 +392,9 @@ public static void checkConnected(Validable validable, Boolean connected) {\n     }\n \n     public static void checkPermanentLimit(Validable validable, double permanentLimit) {\n+        // TODO: if (Double.isNaN(permanentLimit) || permanentLimit <= 0) {", "originalCommit": "bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE0MTM1Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r492141353", "bodyText": "I would hide the getLimitsHolder from the API, because it's not really user friendly", "author": "mathbagu", "createdAt": "2020-09-21T15:19:13Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/NetworkImpl.java", "diffHunk": "@@ -995,8 +994,8 @@ private void replaceDanglingLineByLine(List<MergedLine> lines, Multimap<Boundary\n                 la.setNode2(mergedLine.node2);\n             }\n             TieLineImpl l = la.add();\n-            l.setCurrentLimits(Side.ONE, (CurrentLimitsImpl) mergedLine.limits1);\n-            l.setCurrentLimits(Side.TWO, (CurrentLimitsImpl) mergedLine.limits2);\n+            l.getLimitsHolder1().setOperationalLimits(LimitType.CURRENT, mergedLine.limits1);\n+            l.getLimitsHolder2().setOperationalLimits(LimitType.CURRENT, mergedLine.limits2);", "originalCommit": "bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE0MzYzOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r492143638", "bodyText": "Should we notify the listeners when setters are called. Same remark everywhere. I think it was done in the previous version\nThe add and remove method should also notify", "author": "mathbagu", "createdAt": "2020-09-21T15:21:23Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/VoltageLimitsImpl.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ValidationUtil;\n+import com.powsybl.iidm.network.VoltageLimits;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class VoltageLimitsImpl extends AbstractOperationalLimits implements VoltageLimits {\n+\n+    private double highVoltage;\n+    private double lowVoltage;\n+\n+    VoltageLimitsImpl(OperationalLimitsOwner owner, double lowVoltage, double highVoltage) {\n+        super(owner);\n+        this.highVoltage = highVoltage;\n+        this.lowVoltage = lowVoltage;\n+    }\n+\n+    @Override\n+    public double getHighVoltage() {\n+        return highVoltage;\n+    }\n+\n+    @Override\n+    public VoltageLimits setHighVoltage(double highVoltage) {\n+        ValidationUtil.checkDefinedVoltageLimits(owner, lowVoltage, highVoltage);\n+        this.highVoltage = highVoltage;\n+        return this;\n+    }\n+\n+    @Override\n+    public double getLowVoltage() {\n+        return lowVoltage;\n+    }\n+\n+    @Override\n+    public VoltageLimits setLowVoltage(double lowVoltage) {\n+        ValidationUtil.checkDefinedVoltageLimits(owner, lowVoltage, highVoltage);\n+        this.lowVoltage = lowVoltage;\n+        return this;\n+    }\n+}", "originalCommit": "bbd020879e44c3337ab15fdfd2b5adcd8c585a44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyNjc1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542226756", "bodyText": "@MioRtia: Could you please considerer this remark", "author": "mathbagu", "createdAt": "2020-12-14T09:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE0MzYzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMzMDIzNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542330234", "bodyText": "Ah, yes we can. Will be modified.", "author": "miovd", "createdAt": "2020-12-14T11:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE0MzYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMzOTMyMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530339320", "bodyText": "Finally we allow voltage limits on equipments ? I thought we decided to limit voltage limits to buses and bus bar sections. I am not sure to be able to simulate that level of details in the open load flow for example.", "author": "annetill", "createdAt": "2020-11-25T12:32:45Z", "path": "iidm/iidm-tck/src/test/java/com/powsybl/iidm/network/tck/AbstractVoltageLimitsTest.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.tck;\n+\n+import com.powsybl.iidm.network.Load;\n+import com.powsybl.iidm.network.Network;\n+import com.powsybl.iidm.network.VoltageLimits;\n+import com.powsybl.iidm.network.test.EurostagTutorialExample1Factory;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public abstract class AbstractVoltageLimitsTest {\n+\n+    private static Network createNetwork() {", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM0MjgyMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530342821", "bodyText": "I am not sure to understand how voltage limits work indeed. You associate it to the terminal connected at network side ? I imagine that it is similar for the other operational limits.", "author": "annetill", "createdAt": "2020-11-25T12:38:36Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/ThreeWindingsTransformerAdapter.java", "diffHunk": "@@ -95,6 +100,36 @@ public CurrentLimitsAdder newCurrentLimits() {\n             return getDelegate().newCurrentLimits();\n         }\n \n+        @Override\n+        public ApparentPowerLimits getApparentPowerLimits() {\n+            return getDelegate().getApparentPowerLimits();\n+        }\n+\n+        @Override\n+        public ApparentPowerLimitsAdder newApparentPowerLimits() {\n+            return getDelegate().newApparentPowerLimits();\n+        }\n+\n+        @Override\n+        public ActivePowerLimits getActivePowerLimits() {\n+            return getDelegate().getActivePowerLimits();\n+        }\n+\n+        @Override\n+        public ActivePowerLimitsAdder newActivePowerLimits() {\n+            return getDelegate().newActivePowerLimits();\n+        }\n+\n+        @Override\n+        public VoltageLimits getVoltageLimits() {", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM0Mzg1NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530343854", "bodyText": "Same remark about voltage limits.", "author": "annetill", "createdAt": "2020-11-25T12:40:22Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/SwitchAdapter.java", "diffHunk": "@@ -50,4 +51,49 @@ public boolean isRetained() {\n     public void setRetained(final boolean retained) {\n         getDelegate().setRetained(retained);\n     }\n+\n+    @Override\n+    public List<OperationalLimits> getOperationalLimits() {\n+        return getDelegate().getOperationalLimits();\n+    }\n+\n+    @Override\n+    public CurrentLimits getCurrentLimits() {\n+        return getDelegate().getCurrentLimits();\n+    }\n+\n+    @Override\n+    public CurrentLimitsAdder newCurrentLimits() {\n+        return getDelegate().newCurrentLimits();\n+    }\n+\n+    @Override\n+    public ActivePowerLimits getActivePowerLimits() {\n+        return getDelegate().getActivePowerLimits();\n+    }\n+\n+    @Override\n+    public ActivePowerLimitsAdder newActivePowerLimits() {\n+        return getDelegate().newActivePowerLimits();\n+    }\n+\n+    @Override\n+    public ApparentPowerLimits getApparentPowerLimits() {\n+        return getDelegate().getApparentPowerLimits();\n+    }\n+\n+    @Override\n+    public ApparentPowerLimitsAdder newApparentPowerLimits() {\n+        return getDelegate().newApparentPowerLimits();\n+    }\n+\n+    @Override\n+    public VoltageLimits getVoltageLimits() {", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM0NDA5MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530344091", "bodyText": "I thought that we decide to ignore operational limits for switches ?", "author": "annetill", "createdAt": "2020-11-25T12:40:45Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/SwitchAdapter.java", "diffHunk": "@@ -50,4 +51,49 @@ public boolean isRetained() {\n     public void setRetained(final boolean retained) {\n         getDelegate().setRetained(retained);\n     }\n+\n+    @Override\n+    public List<OperationalLimits> getOperationalLimits() {", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM0NjY2NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530346664", "bodyText": "Same remark, to complex to deal with that for me.", "author": "annetill", "createdAt": "2020-11-25T12:44:57Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/AbstractInjectionAdapter.java", "diffHunk": "@@ -22,4 +23,49 @@ protected AbstractInjectionAdapter(I delegate, MergingViewIndex index) {\n     public final Terminal getTerminal() {\n         return getIndex().getTerminal(getDelegate().getTerminal());\n     }\n+\n+    @Override\n+    public List<OperationalLimits> getOperationalLimits() {\n+        return getDelegate().getOperationalLimits();\n+    }\n+\n+    @Override\n+    public CurrentLimits getCurrentLimits() {\n+        return getDelegate().getCurrentLimits();\n+    }\n+\n+    @Override\n+    public CurrentLimitsAdder newCurrentLimits() {\n+        return getDelegate().newCurrentLimits();\n+    }\n+\n+    @Override\n+    public ApparentPowerLimits getApparentPowerLimits() {\n+        return getDelegate().getApparentPowerLimits();\n+    }\n+\n+    @Override\n+    public ApparentPowerLimitsAdder newApparentPowerLimits() {\n+        return getDelegate().newApparentPowerLimits();\n+    }\n+\n+    @Override\n+    public ActivePowerLimits getActivePowerLimits() {\n+        return getDelegate().getActivePowerLimits();\n+    }\n+\n+    @Override\n+    public ActivePowerLimitsAdder newActivePowerLimits() {\n+        return getDelegate().newActivePowerLimits();\n+    }\n+\n+    @Override\n+    public VoltageLimits getVoltageLimits() {", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM0NzIxMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530347211", "bodyText": "Same remark.", "author": "annetill", "createdAt": "2020-11-25T12:45:43Z", "path": "iidm/iidm-mergingview/src/main/java/com/powsybl/iidm/mergingview/AbstractBranchAdapter.java", "diffHunk": "@@ -77,6 +111,36 @@ public CurrentLimitsAdder newCurrentLimits2() {\n         return getDelegate().newCurrentLimits2();\n     }\n \n+    @Override\n+    public ApparentPowerLimits getApparentPowerLimits2() {\n+        return getDelegate().getApparentPowerLimits2();\n+    }\n+\n+    @Override\n+    public ApparentPowerLimitsAdder newApparentPowerLimits2() {\n+        return getDelegate().newApparentPowerLimits2();\n+    }\n+\n+    @Override\n+    public ActivePowerLimits getActivePowerLimits2() {\n+        return getDelegate().getActivePowerLimits2();\n+    }\n+\n+    @Override\n+    public ActivePowerLimitsAdder newActivePowerLimits2() {\n+        return getDelegate().newActivePowerLimits2();\n+    }\n+\n+    @Override\n+    public VoltageLimits getVoltageLimits2() {\n+        return getDelegate().getVoltageLimits2();\n+    }\n+\n+    @Override\n+    public VoltageLimitsAdder newVoltageLimits2() {", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM0OTUzNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r530349536", "bodyText": "For me, a switch does not have operational limits. It is going to increase considerably our network for nothing because secrutiy analysis are run on bus/breaker view.", "author": "annetill", "createdAt": "2020-11-25T12:49:39Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/SwitchImpl.java", "diffHunk": "@@ -137,4 +139,48 @@ protected String getTypeDescription() {\n         return \"Switch\";\n     }\n \n+    @Override", "originalCommit": "73c83e6e9ebf85fe2bcf0ab643b961524ef7650b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b4c15d5b0e02ddd8de4fb7656922de705f763ebb", "url": "https://github.com/powsybl/powsybl-core/commit/b4c15d5b0e02ddd8de4fb7656922de705f763ebb", "message": "Change API for operational limits\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrection\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrection API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrection API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl with ISO behavior\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nfix\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl of apparent power limits added\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl of voltage limits added\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nSmall correction impl (Breaking change)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nCorrect code smells\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nCorrect unit for apparent power limits\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd ActivePowerLimits to API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl of active power limits + renaming (correction) in Leg\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDelete getUnit() method\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd copyright and authors\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd checks\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd activepowerlimits test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImplementation for merging view\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdding hasTemporaryLimits in LoadingLimitsAdder\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nTake reviewer comment into account (part 1)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nRefactoring check of voltage limits (reviewer comment)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nSome refactoring + impl operational limits for switches\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd missing @Override tag\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nUpdate javadoc (reviewer comment)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nSwitch is not a sided operational limits holder\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nChange isFictitious() method by hasOverloadingLimit()\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use branch.getCurrentLimits1() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use branch.getCurrentLimits1() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use branch.getCurrentLimits2() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use leg.getCurrentLimits() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nChange API with user-friendly getters\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-11-25T13:44:34Z", "type": "forcePushed"}, {"oid": "5956d93a3d5288fab965194f0eba80a1c73412c1", "url": "https://github.com/powsybl/powsybl-core/commit/5956d93a3d5288fab965194f0eba80a1c73412c1", "message": "wip first ideas for iidm operational limits (#899)", "committedDate": "2020-12-01T10:12:03Z", "type": "commit"}, {"oid": "1bca6546cd659f82b6d35cee923498118dc17c3d", "url": "https://github.com/powsybl/powsybl-core/commit/1bca6546cd659f82b6d35cee923498118dc17c3d", "message": "Change API for operational limits\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrection\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrection API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\ncorrection API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl with ISO behavior\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nfix\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl of apparent power limits added\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl of voltage limits added\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nSmall correction impl (Breaking change)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nCorrect code smells\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nCorrect unit for apparent power limits\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd ActivePowerLimits to API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImpl of active power limits + renaming (correction) in Leg\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDelete getUnit() method\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd copyright and authors\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd checks\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd activepowerlimits test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nImplementation for merging view\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdding hasTemporaryLimits in LoadingLimitsAdder\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nTake reviewer comment into account (part 1)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nRefactoring check of voltage limits (reviewer comment)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nSome refactoring + impl operational limits for switches\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nAdd missing @Override tag\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nUpdate javadoc (reviewer comment)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nSwitch is not a sided operational limits holder\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nChange isFictitious() method by hasOverloadingLimit()\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use branch.getCurrentLimits1() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use branch.getCurrentLimits1() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use branch.getCurrentLimits2() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nDo not use leg.getCurrentLimits() anymore (deprecated)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>\n\nChange API with user-friendly getters\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:13:12Z", "type": "commit"}, {"oid": "c4855e3d26a81810f52bd3d2e091774d5f6d3dee", "url": "https://github.com/powsybl/powsybl-core/commit/c4855e3d26a81810f52bd3d2e091774d5f6d3dee", "message": "Narrow possible limits in IIDM API\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:13:42Z", "type": "commit"}, {"oid": "a8fa84ad64e93b6057ff17d7234594427f5d864e", "url": "https://github.com/powsybl/powsybl-core/commit/a8fa84ad64e93b6057ff17d7234594427f5d864e", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:13:42Z", "type": "commit"}, {"oid": "99e235796d42f046291679b7603427dd40eb1630", "url": "https://github.com/powsybl/powsybl-core/commit/99e235796d42f046291679b7603427dd40eb1630", "message": "Add test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:13:42Z", "type": "commit"}, {"oid": "b52db6951b3cfaa7eec1ac08755e342889ff845c", "url": "https://github.com/powsybl/powsybl-core/commit/b52db6951b3cfaa7eec1ac08755e342889ff845c", "message": "Changes for busbarsection/buses\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:13:42Z", "type": "commit"}, {"oid": "b52db6951b3cfaa7eec1ac08755e342889ff845c", "url": "https://github.com/powsybl/powsybl-core/commit/b52db6951b3cfaa7eec1ac08755e342889ff845c", "message": "Changes for busbarsection/buses\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:13:42Z", "type": "forcePushed"}, {"oid": "d152a49ddd80675378c93ebcd13f4373b0d51f64", "url": "https://github.com/powsybl/powsybl-core/commit/d152a49ddd80675378c93ebcd13f4373b0d51f64", "message": "make getOperationalLimits unmodifiable\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T10:21:20Z", "type": "commit"}, {"oid": "874970078911c2a2b9e92e1354e968871e3bd00e", "url": "https://github.com/powsybl/powsybl-core/commit/874970078911c2a2b9e92e1354e968871e3bd00e", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T13:38:08Z", "type": "commit"}, {"oid": "6a63b589dca76c5564759f8857b8954a9db67b7a", "url": "https://github.com/powsybl/powsybl-core/commit/6a63b589dca76c5564759f8857b8954a9db67b7a", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-01T14:56:01Z", "type": "commit"}, {"oid": "158afcb46784c9f23471efddc47653f0b179752f", "url": "https://github.com/powsybl/powsybl-core/commit/158afcb46784c9f23471efddc47653f0b179752f", "message": "Merge.\n\nSigned-off-by: Anne Tilloy <anne.tilloy@rte-france.com>", "committedDate": "2020-12-07T13:05:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMDIzMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542210233", "bodyText": "Lines 528 and 529 are the same: is there a regression? If not, remove one of the two lines.", "author": "mathbagu", "createdAt": "2020-12-14T08:53:15Z", "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/conformity/modified/CgmesConformity1ModifiedConversionTest.java", "diffHunk": "@@ -526,7 +526,7 @@ public void miniNodeBreakerTestLimits() {\n         assertEquals(525, l0.getCurrentLimits1().getPermanentLimit(), tol);\n         assertNull(l0.getCurrentLimits2());\n         assertEquals(525, l1.getCurrentLimits1().getPermanentLimit(), tol);\n-        assertEquals(525, l1.getCurrentLimits2().getPermanentLimit(), tol);\n+        assertEquals(525, l1.getCurrentLimits1().getPermanentLimit(), tol);", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNjMyNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542216325", "bodyText": "Still the same discussion: I suppose you will use this new method (and the others) in the converters. Suppose you use a different implementation of IIDM, this will crash the import.\nI don't know if we should care about it, or if we have to change our strategy for defaulted methods, like providing a mock that does nothing but ensure that the importers work with not updated implementations", "author": "mathbagu", "createdAt": "2020-12-14T09:02:42Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Branch.java", "diffHunk": "@@ -140,16 +143,81 @@\n \n     Side getSide(Terminal terminal);\n \n-    CurrentLimits getCurrentLimits(Side side);\n+    default List<OperationalLimits> getOperationalLimits1() {\n+        return getCurrentLimits1() != null ? Collections.singletonList(getCurrentLimits1()) : Collections.emptyList();\n+    }\n \n     CurrentLimits getCurrentLimits1();\n \n+    default ActivePowerLimits getActivePowerLimits1() {\n+        return null;\n+    }\n+\n+    default ApparentPowerLimits getApparentPowerLimits1() {\n+        return null;\n+    }\n+\n     CurrentLimitsAdder newCurrentLimits1();\n \n+    default ActivePowerLimitsAdder newActivePowerLimits1() {\n+        throw new UnsupportedOperationException();", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMyODkxNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542328917", "bodyText": "To be honest, not sure what it is best for whole new objects... I worry that adding mock objects will only make the API more confusing", "author": "miovd", "createdAt": "2020-12-14T11:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNjMyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM3MjAyOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r544372029", "bodyText": "The mock is not the good solution: what I mean is implementing the new methods with a throw will hide the issue. You don't break the compilation but it will fail at runtime that it's worst.", "author": "mathbagu", "createdAt": "2020-12-16T15:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNjMyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNzIxMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542217213", "bodyText": "I saw that the branch doesn't inherit from FlowsLimitsHolder. Do I miss something?\nTo be checked: how calculated bus manage limits.", "author": "mathbagu", "createdAt": "2020-12-14T09:04:15Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/Bus.java", "diffHunk": "@@ -17,7 +17,7 @@\n  *\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n  */\n-public interface Bus extends Identifiable<Bus> {\n+public interface Bus extends Identifiable<Bus>, VoltageLimitsHolder {", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ0ODA2Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542448062", "bodyText": "What I made was: when setting a calculated bus (NB to BB), it is actually the busbarsections underneath which are set (an error is thrown if there is none). For a merged bus (BusBreaker to Bus), it is actually the BB buses underneath which are set.", "author": "miovd", "createdAt": "2020-12-14T14:56:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNzIxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ0ODg3MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542448870", "bodyText": "About FlowsLimitsHolder: there is only for holder with no side. Branch directly supports sided flows limits getters and setters in its API.", "author": "miovd", "createdAt": "2020-12-14T14:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNzIxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ5NTA3MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542495071", "bodyText": "Changed a bit the mechanism in the new commits", "author": "miovd", "createdAt": "2020-12-14T15:54:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNzIxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIyODIwNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r545228205", "bodyText": "I've thought a bit about your proposition and I don't think it is relevant to make Branch inherit from FlowsLimitHolder: indeed, in any cases, it hasn't any common methods with flow limit holder without sides so if we needed to iterate on FlowsLimitHolder, we would at the end cast it as Branch to use it so it is a bit pointless...\nFor example, we would have:\nIdentifiable i = network.getIdentifiable(\"i\");\nif (i instanceof FlowsLimitHolder) {\n     if (i instance of Branch) {\n           i.newCurrentLimits1()...\n     } else {\n           i.newCurrentLimits()...\n    }\n}\ninstead of:\nIdentifiable i = network.getIdentifiable(\"i\");\nif (i instanceof FlowsLimitHolder) {\n     i.newCurrentLimits().....\n} else if (i instanceof Branch) {\n     i.newCurrentLimits1().....\n}\nI think the second solution is clearer.", "author": "miovd", "createdAt": "2020-12-17T16:32:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNzIxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxOTgxMg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542219812", "bodyText": "I'm pretty sure it won't be the case: I propose to sort the voltageLimits and return the lowest to avoid missing violations", "author": "mathbagu", "createdAt": "2020-12-14T09:08:14Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/CalculatedBusImpl.java", "diffHunk": "@@ -188,6 +188,23 @@ public Component getSynchronousComponent() {\n         return terminalRef == null ? null : scm.getComponent(terminalRef.getSynchronousComponentNumber());\n     }\n \n+    @Override\n+    public VoltageLimits getVoltageLimits() {\n+        return getConnectableStream(BusbarSection.class)\n+                .map(VoltageLimitsHolder::getVoltageLimits)\n+                .filter(Objects::nonNull)\n+                .findFirst() // we suppose that all voltage limits in a same calculated bus are equals", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyMDgyOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542220829", "bodyText": "I would throw an exception in all case: we could probably accept that limits have to be created from \"configured\" objects (BusbarSections and ConfiguredBus). It's arguable.", "author": "mathbagu", "createdAt": "2020-12-14T09:09:45Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/CalculatedBusImpl.java", "diffHunk": "@@ -188,6 +188,23 @@ public Component getSynchronousComponent() {\n         return terminalRef == null ? null : scm.getComponent(terminalRef.getSynchronousComponentNumber());\n     }\n \n+    @Override\n+    public VoltageLimits getVoltageLimits() {\n+        return getConnectableStream(BusbarSection.class)\n+                .map(VoltageLimitsHolder::getVoltageLimits)\n+                .filter(Objects::nonNull)\n+                .findFirst() // we suppose that all voltage limits in a same calculated bus are equals\n+                .orElse(null);\n+    }\n+\n+    @Override\n+    public VoltageLimitsAdder newVoltageLimits() {\n+        return getConnectableStream(BusbarSection.class)\n+                .findFirst()\n+                .map(VoltageLimitsHolder::newVoltageLimits)\n+                .orElseThrow(() -> new ValidationException(this, \"No busbarsection is associated to this calculated bus: no voltage limit can be created.\"));\n+    }", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyMTI3Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542221272", "bodyText": "See CalculatedBusImpl remarks", "author": "mathbagu", "createdAt": "2020-12-14T09:10:28Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/MergedBus.java", "diffHunk": "@@ -198,6 +199,23 @@ public Component getSynchronousComponent() {\n         throw new AssertionError(\"Should not happen\");\n     }\n \n+    @Override\n+    public VoltageLimits getVoltageLimits() {\n+        return buses.stream()\n+                .map(VoltageLimitsHolder::getVoltageLimits)\n+                .filter(Objects::nonNull)\n+                .findFirst() // we suppose that all voltage limits in a same calculated bus are equals\n+                .orElse(null);\n+    }\n+\n+    @Override\n+    public VoltageLimitsAdder newVoltageLimits() {\n+        return buses.stream()\n+                .findFirst()\n+                .map(VoltageLimitsHolder::newVoltageLimits)\n+                .orElseThrow(() -> new AssertionError(\"Should not happen\")); // a merged bus should at least contain one configured bus\n+    }", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyMzk2Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542223962", "bodyText": "Do you really need to return a List, or a Collection could be OK?", "author": "mathbagu", "createdAt": "2020-12-14T09:14:25Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/OperationalLimitsHolderImpl.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.*;\n+\n+import java.util.*;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class OperationalLimitsHolderImpl implements OperationalLimitsOwner {\n+\n+    private final EnumMap<LimitType, OperationalLimits> operationalLimits = new EnumMap<>(LimitType.class);\n+    private final AbstractIdentifiable<?> identifiable;\n+    private final String attributeName;\n+\n+    OperationalLimitsHolderImpl(AbstractIdentifiable<?> identifiable, String attributeName) {\n+        this.identifiable = Objects.requireNonNull(identifiable);\n+        this.attributeName = Objects.requireNonNull(attributeName);\n+    }\n+\n+    @Override\n+    public void setOperationalLimits(LimitType limitType, OperationalLimits operationalLimits) {\n+        OperationalLimits oldValue = this.operationalLimits.put(limitType, operationalLimits);\n+        identifiable.getNetwork().getListeners().notifyUpdate(identifiable, attributeName + \"_\" + limitType, oldValue, operationalLimits);\n+    }\n+\n+    List<OperationalLimits> getOperationalLimits() {\n+        return Collections.unmodifiableList(new ArrayList<>(operationalLimits.values()));\n+    }", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMyOTUzMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542329530", "bodyText": "A collection would be okay, I will modify this", "author": "miovd", "createdAt": "2020-12-14T11:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyMzk2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ5ODA3MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542498071", "bodyText": "Just to be sure: do you mean in the API or in the implementation?", "author": "miovd", "createdAt": "2020-12-14T15:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyMzk2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyNDgxNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542224815", "bodyText": "To be reverted?", "author": "mathbagu", "createdAt": "2020-12-14T09:15:49Z", "path": "action/action-dsl/src/main/java/com/powsybl/action/dsl/ast/ActionExpressionEvaluator.java", "diffHunk": "@@ -93,7 +93,7 @@ private Branch getBranch() {\n         /**\n          * TODO: to move to IIDM\n          */\n-        private static double getPermanentLimit(Branch branch, Branch.Side side) {\n+        private static double getPermanentLimit(Branch<?> branch, Branch.Side side) {", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyNjQwNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r542226407", "bodyText": "To be discuss: is it better to return the VoltageLimits or to return the owner to be able to create additional limits?", "author": "mathbagu", "createdAt": "2020-12-14T09:18:09Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/VoltageLimitsAdderImpl.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.*;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class VoltageLimitsAdderImpl implements VoltageLimitsAdder {\n+\n+    private final OperationalLimitsOwner owner;\n+    private double highVoltage = Double.NaN;\n+    private double lowVoltage = Double.NaN;\n+\n+    VoltageLimitsAdderImpl(OperationalLimitsOwner owner) {\n+        this.owner = owner;\n+    }\n+\n+    @Override\n+    public VoltageLimitsAdder setHighVoltage(double highVoltage) {\n+        this.highVoltage = highVoltage;\n+        return this;\n+    }\n+\n+    @Override\n+    public VoltageLimitsAdder setLowVoltage(double lowVoltage) {\n+        this.lowVoltage = lowVoltage;\n+        return this;\n+    }\n+\n+    @Override\n+    public VoltageLimits add() {", "originalCommit": "158afcb46784c9f23471efddc47653f0b179752f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0Mzc5OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r543343799", "bodyText": "Both approaches are good for me. In favor of returning the limits: this is what we are doing with reactive limits so it would be consistent regarding the API. Furthermore, not sure it makes sense for VoltageLimits for example: objects supporting voltage limits do not support other kinds of limits.", "author": "miovd", "createdAt": "2020-12-15T13:33:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyNjQwNw=="}], "type": "inlineReview"}, {"oid": "a08c85431054c0eeeb059e71e76c13825c41aeb5", "url": "https://github.com/powsybl/powsybl-core/commit/a08c85431054c0eeeb059e71e76c13825c41aeb5", "message": "Correct regression test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-14T14:54:48Z", "type": "commit"}, {"oid": "849b2a6ef4d0a88325565ecfc42356a523013339", "url": "https://github.com/powsybl/powsybl-core/commit/849b2a6ef4d0a88325565ecfc42356a523013339", "message": "Forbid creation of voltage limits on calculated objects\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-14T15:25:40Z", "type": "commit"}, {"oid": "30f7696cb9da6bfc17c6112768d9787dc0391272", "url": "https://github.com/powsybl/powsybl-core/commit/30f7696cb9da6bfc17c6112768d9787dc0391272", "message": "Change how voltage limits on calculated objects are handled\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-14T15:53:52Z", "type": "commit"}, {"oid": "8c7cd3957590b551b2be4f6f226c7bff139206ad", "url": "https://github.com/powsybl/powsybl-core/commit/8c7cd3957590b551b2be4f6f226c7bff139206ad", "message": "Revert weird change (due to merge)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-14T15:55:28Z", "type": "commit"}, {"oid": "26bcf815000f80ce0ea8219667627a2f54c1dded", "url": "https://github.com/powsybl/powsybl-core/commit/26bcf815000f80ce0ea8219667627a2f54c1dded", "message": "Add notifications\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-14T16:30:25Z", "type": "commit"}, {"oid": "965703c1c4d11dc22390e766ecb7f6b3991e0f07", "url": "https://github.com/powsybl/powsybl-core/commit/965703c1c4d11dc22390e766ecb7f6b3991e0f07", "message": "Add checks for voltage limits\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-16T15:39:38Z", "type": "commit"}, {"oid": "d751a03af80283aad9ec18b3a4f2cd85e9b494ae", "url": "https://github.com/powsybl/powsybl-core/commit/d751a03af80283aad9ec18b3a4f2cd85e9b494ae", "message": "Make VoltageLevel a VoltageLimitsHolder\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-17T14:58:25Z", "type": "commit"}, {"oid": "bbb6f680bf4fba56dcec7ede1c62e9203d335ea7", "url": "https://github.com/powsybl/powsybl-core/commit/bbb6f680bf4fba56dcec7ede1c62e9203d335ea7", "message": "Replace all uses of deprecated methods\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-17T15:54:00Z", "type": "commit"}, {"oid": "c1717dc182c6266b672ff306f1d02654853d4c22", "url": "https://github.com/powsybl/powsybl-core/commit/c1717dc182c6266b672ff306f1d02654853d4c22", "message": "Replace List getOperationalLimits() by Collection getOperationalLimits()\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-17T16:23:38Z", "type": "commit"}, {"oid": "76d7cca93b78075bc40ecd0eba2dd7081ae18bab", "url": "https://github.com/powsybl/powsybl-core/commit/76d7cca93b78075bc40ecd0eba2dd7081ae18bab", "message": "Add test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-12-17T16:48:22Z", "type": "commit"}, {"oid": "d5a04fd8214b900b7b82ea665428e54d431e49a2", "url": "https://github.com/powsybl/powsybl-core/commit/d5a04fd8214b900b7b82ea665428e54d431e49a2", "message": "Revert \"Replace all uses of deprecated methods\"\n\nThis reverts commit bbb6f68\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-04T13:10:20Z", "type": "commit"}, {"oid": "53b2068afa5b920417d4456513f6e975d3019a73", "url": "https://github.com/powsybl/powsybl-core/commit/53b2068afa5b920417d4456513f6e975d3019a73", "message": "Revert \"Make VoltageLevel a VoltageLimitsHolder\"\n\nThis reverts commit d751a03\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-04T13:10:28Z", "type": "commit"}, {"oid": "6cc9f4b9562b1f8cde399c4111bb191e72e50fc5", "url": "https://github.com/powsybl/powsybl-core/commit/6cc9f4b9562b1f8cde399c4111bb191e72e50fc5", "message": "Revert \"Add checks for voltage limits\"\n\nThis reverts commit 965703c\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-04T13:10:35Z", "type": "commit"}, {"oid": "3024ea9655ef36de9a7b362f599e25b9bb6d4486", "url": "https://github.com/powsybl/powsybl-core/commit/3024ea9655ef36de9a7b362f599e25b9bb6d4486", "message": "Delete references to Voltage Limits\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-04T13:29:43Z", "type": "commit"}, {"oid": "2d462b8df2875a275e90207407dc55a8ab3cb4c4", "url": "https://github.com/powsybl/powsybl-core/commit/2d462b8df2875a275e90207407dc55a8ab3cb4c4", "message": "Delete unused method\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-04T13:58:15Z", "type": "commit"}, {"oid": "3ed3e58675830f02453ac0ab8f509d492be25aab", "url": "https://github.com/powsybl/powsybl-core/commit/3ed3e58675830f02453ac0ab8f509d492be25aab", "message": "Small cleaning\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-04T14:26:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkzODA0OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1359#discussion_r551938048", "bodyText": "Do you still need this modification?", "author": "annetill", "createdAt": "2021-01-05T13:41:32Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/CalculatedBus.java", "diffHunk": "@@ -6,12 +6,13 @@\n  */\n package com.powsybl.iidm.network.impl;\n \n+import com.powsybl.iidm.network.Validable;\n+\n /**\n  *\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n  */\n-interface CalculatedBus extends BusExt {\n+interface CalculatedBus extends BusExt, Validable {", "originalCommit": "3ed3e58675830f02453ac0ab8f509d492be25aab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d8228cca4aefd6568cc2b25ee868bf16439a125c", "url": "https://github.com/powsybl/powsybl-core/commit/d8228cca4aefd6568cc2b25ee868bf16439a125c", "message": "Explicitly break the API for new...Limits() methods\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-05T14:01:41Z", "type": "commit"}, {"oid": "9a29e6a92322a796ab583621984b0a5ebfd5fc56", "url": "https://github.com/powsybl/powsybl-core/commit/9a29e6a92322a796ab583621984b0a5ebfd5fc56", "message": "Use setFictitious instead of setOverloadingProtection\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2021-01-08T09:43:55Z", "type": "commit"}, {"oid": "0c72574364f9c2a932cc55e39c1ffa79d921228c", "url": "https://github.com/powsybl/powsybl-core/commit/0c72574364f9c2a932cc55e39c1ffa79d921228c", "message": "Merge branch 'master' into iidm_operational_limits", "committedDate": "2021-01-11T12:25:43Z", "type": "commit"}]}