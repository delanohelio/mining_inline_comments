{"pr_number": 1356, "pr_title": "Improvements of PSS/E importer:", "pr_createdAt": "2020-06-17T20:21:20Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1356", "timeline": [{"oid": "20abc9339d6273467d5617aca9786b65c7dc61d5", "url": "https://github.com/powsybl/powsybl-core/commit/20abc9339d6273467d5617aca9786b65c7dc61d5", "message": "Improvements of PSS/E importer:\n- supporting both raw and RAW file extensions\n- supporting STATUS = 0 of equipments\n- modification of header detection\n- reading Qmin and Qmax of generating units\n- modification of targetQ setter\n- better check of the number of windings of transformers", "committedDate": "2020-06-17T20:14:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDc3OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r443230779", "bodyText": "Have you tried what you get in the case of a *.raw|RAW file but the content is not a raw file?", "author": "geofjamg", "createdAt": "2020-06-21T15:30:47Z", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -65,15 +66,31 @@ public String getComment() {\n         return \"PSS/E Format to IIDM converter\";\n     }\n \n+    private String findExtension(ReadOnlyDataSource dataSource, boolean throwException) throws IOException {\n+        for (String ext : EXTS) {\n+            if (dataSource.exists(null, ext)) {\n+                return ext;\n+            }\n+        }\n+        if (throwException) {\n+            throw new PsseException(\"File \" + dataSource.getBaseName()\n+                    + \".\" + Joiner.on(\"|\").join(EXTS) + \" not found\");\n+        }\n+        return null;\n+    }\n+\n     @Override\n     public boolean exists(ReadOnlyDataSource dataSource) {\n         try {\n-            if (dataSource.exists(null, EXT)) {\n-                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n-                    String titleLine = reader.readLine();\n-                    if (titleLine != null) {\n-                        return titleLine.length() >= 38\n-                                && titleLine.charAt(37) == '/';\n+            String ext = findExtension(dataSource, false);\n+            if (ext != null) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, ext)))) {", "originalCommit": "20abc9339d6273467d5617aca9786b65c7dc61d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMTA5NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r443231094", "bodyText": "Ideally we should had unit tests to cover the different cases (real raw or RAW, fake one)", "author": "geofjamg", "createdAt": "2020-06-21T15:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0MTI0MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r443641240", "bodyText": "raw is a really common extension, used for instance in photography. I think it's a good idea to check if the file is valid or not.", "author": "mathbagu", "createdAt": "2020-06-22T15:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAwNTk4Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r444005983", "bodyText": "I have added a test for a better check of the header", "author": "JB-H", "createdAt": "2020-06-23T07:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4MTM1NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r444081355", "bodyText": "I added an additional unit test to cover @mathbagu use case so a \"fake\" .raw file.", "author": "geofjamg", "createdAt": "2020-06-23T09:15:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMDc3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYzOTcxMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r443639711", "bodyText": "Use String.join(\"|\", EXTS) instead of Joiner.on?", "author": "mathbagu", "createdAt": "2020-06-22T15:22:57Z", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -65,15 +66,31 @@ public String getComment() {\n         return \"PSS/E Format to IIDM converter\";\n     }\n \n+    private String findExtension(ReadOnlyDataSource dataSource, boolean throwException) throws IOException {\n+        for (String ext : EXTS) {\n+            if (dataSource.exists(null, ext)) {\n+                return ext;\n+            }\n+        }\n+        if (throwException) {\n+            throw new PsseException(\"File \" + dataSource.getBaseName()\n+                    + \".\" + Joiner.on(\"|\").join(EXTS) + \" not found\");", "originalCommit": "20abc9339d6273467d5617aca9786b65c7dc61d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAxMTg0OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r444011848", "bodyText": "I modified PSSE and UCT import since they were using the same approach", "author": "JB-H", "createdAt": "2020-06-23T07:18:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYzOTcxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0NDEzNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r443644137", "bodyText": "Is this catch OK? There is probably to many try/catch level where only one is sufficient?", "author": "mathbagu", "createdAt": "2020-06-22T15:29:12Z", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -300,62 +339,67 @@ public Network importData(ReadOnlyDataSource dataSource, NetworkFactory networkF\n \n         Network network = networkFactory.createNetwork(dataSource.getBaseName(), FORMAT);\n \n-        try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n-\n-            // parse file\n-            PsseRawModel psseModel = new PsseRawReader().read(reader);\n-\n-            // set date and time\n-            // TODO\n-\n-            // build container to fit IIDM requirements\n-            List<Object> branches = ImmutableList.builder()\n-                    .addAll(psseModel.getNonTransformerBranches())\n-                    .addAll(psseModel.getTransformers())\n-                    .build();\n-            ToIntFunction<Object> branchToNum1 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getI() : ((PsseTransformer) branch).getFirstRecord().getI();\n-            ToIntFunction<Object> branchToNum2 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getJ() : ((PsseTransformer) branch).getFirstRecord().getJ();\n-            ToDoubleFunction<Object> branchToResistance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getR() : ((PsseTransformer) branch).getSecondRecord().getR12();\n-            ToDoubleFunction<Object> branchToReactance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getX() : ((PsseTransformer) branch).getSecondRecord().getX12();\n-            Predicate<Object> branchToIsTransformer = branch -> branch instanceof PsseTransformer;\n-            ContainersMapping containerMapping = ContainersMapping.create(psseModel.getBuses(), branches, PsseBus::getI, branchToNum1,\n-                branchToNum2, branchToResistance, branchToReactance, branchToIsTransformer,\n-                busNums -> \"VL\" + busNums.iterator().next(), substationNum -> \"S\" + substationNum++);\n-\n-            boolean ignoreBaseVoltage = ConversionParameters.readBooleanParameter(FORMAT, parameters, IGNORE_BASE_VOLTAGE_PARAMETER,\n-                    ParameterDefaultValueConfig.INSTANCE);\n-            PerUnitContext perUnitContext = new PerUnitContext(psseModel.getCaseIdentification().getSbase(), ignoreBaseVoltage);\n-\n-            // create buses\n-            createBuses(psseModel, containerMapping, perUnitContext, network);\n-\n-            //Create loads\n-            for (PsseLoad psseLoad : psseModel.getLoads()) {\n-                createLoad(psseLoad, containerMapping, network);\n-            }\n+        try {\n+            String ext = findExtension(dataSource, true);\n+            try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, ext)))) {\n+\n+                // parse file\n+                PsseRawModel psseModel = new PsseRawReader().read(reader);\n+\n+                // set date and time\n+                // TODO\n+\n+                // build container to fit IIDM requirements\n+                List<Object> branches = ImmutableList.builder()\n+                        .addAll(psseModel.getNonTransformerBranches())\n+                        .addAll(psseModel.getTransformers())\n+                        .build();\n+                ToIntFunction<Object> branchToNum1 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getI() : ((PsseTransformer) branch).getFirstRecord().getI();\n+                ToIntFunction<Object> branchToNum2 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getJ() : ((PsseTransformer) branch).getFirstRecord().getJ();\n+                ToDoubleFunction<Object> branchToResistance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getR() : ((PsseTransformer) branch).getSecondRecord().getR12();\n+                ToDoubleFunction<Object> branchToReactance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getX() : ((PsseTransformer) branch).getSecondRecord().getX12();\n+                Predicate<Object> branchToIsTransformer = branch -> branch instanceof PsseTransformer;\n+                ContainersMapping containerMapping = ContainersMapping.create(psseModel.getBuses(), branches, PsseBus::getI, branchToNum1,\n+                    branchToNum2, branchToResistance, branchToReactance, branchToIsTransformer,\n+                    busNums -> \"VL\" + busNums.iterator().next(), substationNum -> \"S\" + substationNum++);\n+\n+                boolean ignoreBaseVoltage = ConversionParameters.readBooleanParameter(FORMAT, parameters, IGNORE_BASE_VOLTAGE_PARAMETER,\n+                        ParameterDefaultValueConfig.INSTANCE);\n+                PerUnitContext perUnitContext = new PerUnitContext(psseModel.getCaseIdentification().getSbase(), ignoreBaseVoltage);\n+\n+                // create buses\n+                createBuses(psseModel, containerMapping, perUnitContext, network);\n+\n+                //Create loads\n+                for (PsseLoad psseLoad : psseModel.getLoads()) {\n+                    createLoad(psseLoad, containerMapping, network);\n+                }\n \n-            //Create shunts\n-            for (PsseFixedShunt psseShunt : psseModel.getFixedShunts()) {\n-                createShuntCompensator(psseShunt, perUnitContext, containerMapping, network);\n-            }\n+                //Create shunts\n+                for (PsseFixedShunt psseShunt : psseModel.getFixedShunts()) {\n+                    createShuntCompensator(psseShunt, perUnitContext, containerMapping, network);\n+                }\n \n-            for (PsseGenerator psseGen : psseModel.getGenerators()) {\n-                createGenerator(psseGen, containerMapping, network);\n-            }\n+                for (PsseGenerator psseGen : psseModel.getGenerators()) {\n+                    createGenerator(psseGen, containerMapping, network);\n+                }\n \n-            for (PsseNonTransformerBranch psseLine : psseModel.getNonTransformerBranches()) {\n-                createLine(psseLine, containerMapping, perUnitContext, network);\n-            }\n+                for (PsseNonTransformerBranch psseLine : psseModel.getNonTransformerBranches()) {\n+                    createLine(psseLine, containerMapping, perUnitContext, network);\n+                }\n \n-            for (PsseTransformer psseTfo : psseModel.getTransformers()) {\n-                createTransformer(psseTfo, containerMapping, perUnitContext, network);\n+                for (PsseTransformer psseTfo : psseModel.getTransformers()) {\n+                    createTransformer(psseTfo, containerMapping, perUnitContext, network);\n+                }\n+\n+            } catch (IOException e) {\n+                throw new UncheckedIOException(e);\n             }", "originalCommit": "20abc9339d6273467d5617aca9786b65c7dc61d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAxNDg1NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1356#discussion_r444014855", "bodyText": "proposition of modification done", "author": "JB-H", "createdAt": "2020-06-23T07:23:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0NDEzNw=="}], "type": "inlineReview"}, {"oid": "f3736ed48368414a532bddd505ab3c7eca98e82e", "url": "https://github.com/powsybl/powsybl-core/commit/f3736ed48368414a532bddd505ab3c7eca98e82e", "message": "Improvements of PSS/E importer:\n- supporting both raw and RAW file extensions\n- supporting STATUS = 0 of equipments\n- modification of header detection\n- reading Qmin and Qmax of generating units\n- modification of targetQ setter\n- better check of the number of windings of transformers\n\nSigned-off-by: Jean-Baptiste Heyberger <jbheyberger@gmail.com>", "committedDate": "2020-06-22T20:00:16Z", "type": "commit"}, {"oid": "de47296411e82eb40f01a9e806015e61a255ba74", "url": "https://github.com/powsybl/powsybl-core/commit/de47296411e82eb40f01a9e806015e61a255ba74", "message": "Improvements of PSS/E importer:\n- supporting both raw and RAW file extensions\n- supporting STATUS = 0 of equipments\n- modification of header detection\n- reading Qmin and Qmax of generating units\n- modification of targetQ setter\n- better check of the number of windings of transformers\n\nSigned-off-by: Jean-Baptiste Heyberger <jbheyberger@gmail.com>", "committedDate": "2020-06-22T20:00:50Z", "type": "commit"}, {"oid": "676d79c46077c2ac11d5981fecd2975793306673", "url": "https://github.com/powsybl/powsybl-core/commit/676d79c46077c2ac11d5981fecd2975793306673", "message": "use of String.join(\"|\", EXTS) to handle extensions of uct and raw files\n\nSigned-off-by: Jean-Baptiste Heyberger <jbheyberger@gmail.com>", "committedDate": "2020-06-23T07:16:49Z", "type": "commit"}, {"oid": "d122daca1131ba90d5ebcf99bbaff187c373d89f", "url": "https://github.com/powsybl/powsybl-core/commit/d122daca1131ba90d5ebcf99bbaff187c373d89f", "message": "Improvements of PSS/E importer:\n- supporting both raw and RAW file extensions\n- supporting STATUS = 0 of equipments\n- modification of header detection\n- reading Qmin and Qmax of generating units\n- modification of targetQ setter\n- better check of the number of windings of transformers\n\nSigned-off-by: Jean-Baptiste Heyberger <jbheyberger@gmail.com>", "committedDate": "2020-06-23T07:23:24Z", "type": "commit"}, {"oid": "df0f259b95397566d10ac473a75b9a6dc61e34f8", "url": "https://github.com/powsybl/powsybl-core/commit/df0f259b95397566d10ac473a75b9a6dc61e34f8", "message": "Add fake raw file unit test\n\nSigned-off-by: Geoffroy Jamgotchian <geoffroy.jamgotchian@rte-france.com>", "committedDate": "2020-06-23T09:13:10Z", "type": "commit"}, {"oid": "035ccea84594508bbaf6a08208354a76ecb332f5", "url": "https://github.com/powsybl/powsybl-core/commit/035ccea84594508bbaf6a08208354a76ecb332f5", "message": "Merge branch 'master' into psse-converter-b2", "committedDate": "2020-06-23T09:17:15Z", "type": "commit"}, {"oid": "643e521e503b593cc508ea918f5d4d8192f16f8d", "url": "https://github.com/powsybl/powsybl-core/commit/643e521e503b593cc508ea918f5d4d8192f16f8d", "message": "Add more unit tests\n\nSigned-off-by: Geoffroy Jamgotchian <geoffroy.jamgotchian@rte-france.com>", "committedDate": "2020-06-23T13:30:16Z", "type": "commit"}, {"oid": "f08eb4a009903ab1964895ab29eb16b16f3b5a1f", "url": "https://github.com/powsybl/powsybl-core/commit/f08eb4a009903ab1964895ab29eb16b16f3b5a1f", "message": "Merge remote-tracking branch 'origin/psse-converter-b2' into psse-converter-b2", "committedDate": "2020-06-23T13:30:27Z", "type": "commit"}, {"oid": "c16bf68e7ab7f85531305acebfbedb8d320896ad", "url": "https://github.com/powsybl/powsybl-core/commit/c16bf68e7ab7f85531305acebfbedb8d320896ad", "message": "Merge branch 'master' into psse-converter-b2", "committedDate": "2020-06-23T13:31:52Z", "type": "commit"}]}