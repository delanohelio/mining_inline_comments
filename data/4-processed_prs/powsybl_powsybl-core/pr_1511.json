{"pr_number": 1511, "pr_title": "Finish ExecutionReport implementation to get std out/err stream", "pr_createdAt": "2020-10-07T18:24:09Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1511", "timeline": [{"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d", "url": "https://github.com/powsybl/powsybl-core/commit/079607f86606b0cc200ae09fc5d93a6a049c929d", "message": "Finish ExecutionReport implementation to get std out/err stream\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-10-07T21:25:04Z", "type": "commit"}, {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d", "url": "https://github.com/powsybl/powsybl-core/commit/079607f86606b0cc200ae09fc5d93a6a049c929d", "message": "Finish ExecutionReport implementation to get std out/err stream\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-10-07T21:25:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501533699", "bodyText": "Is it relevant to make a constructor without parameters with a default directory (maybe not)(don't forget the Breaking change label if it is not the case)?", "author": "MioRtia", "createdAt": "2020-10-08T08:20:23Z", "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {\n-        return OK;\n-    }\n-\n     /**\n      * Create an execution report with no execution error.\n      */\n-    public DefaultExecutionReport() {\n-        this(Collections.emptyList());\n+    public DefaultExecutionReport(Path workingDirectory) {\n+        this(workingDirectory, Collections.emptyList());", "originalCommit": "079607f86606b0cc200ae09fc5d93a6a049c929d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0ODM0OA==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501548348", "bodyText": "Not sure it's relevant to have a default constructor. The working directory is the temporary directory used during the execution. From my point of view, computations always run in a temporary directory, even if no data are stored in it, it's created by the computation manager (part of the API).", "author": "mathbagu", "createdAt": "2020-10-08T08:43:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTY3NjQyOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501676429", "bodyText": "Okay!", "author": "miovd", "createdAt": "2020-10-08T12:21:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDMzMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501534330", "bodyText": "Sonarcloud said it is not useful to add the toString() method as the logger already formats paths", "author": "MioRtia", "createdAt": "2020-10-08T08:21:21Z", "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -65,4 +63,29 @@ public void log() {\n         }\n     }\n \n+    @Override\n+    public Optional<InputStream> getStdOut(Command command, int index) {\n+        return getOutputFile(command, index, \".out\");\n+    }\n+\n+    @Override\n+    public Optional<InputStream> getStdErr(Command command, int index) {\n+        return getOutputFile(command, index, \".err\");\n+    }\n+\n+    private Optional<InputStream> getOutputFile(Command command, int index, String extension) {\n+        Objects.requireNonNull(command);\n+        if (index < 0) {\n+            throw new IllegalArgumentException(\"Invalid index: \" + index);\n+        }\n+\n+        Path path = workingDirectory.resolve(command.getId() + \"_\" + index + extension);\n+        try {\n+            return Optional.of(Files.newInputStream(path));\n+        } catch (IOException e) {\n+            LOGGER.warn(\"Unable to read {}: {}\", path.toString(), e.getMessage());", "originalCommit": "079607f86606b0cc200ae09fc5d93a6a049c929d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0NjU1NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501546554", "bodyText": "Fixed in the last commit", "author": "mathbagu", "createdAt": "2020-10-08T08:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDMzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDczOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501534738", "bodyText": "Just for me, when did we use this method? (Don't forget the Breaking change label if we delete it)", "author": "MioRtia", "createdAt": "2020-10-08T08:22:00Z", "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {", "originalCommit": "079607f86606b0cc200ae09fc5d93a6a049c929d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0NzAzNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501547034", "bodyText": "This was used only in the unit test, but it's really useful to return always the same instance.", "author": "mathbagu", "createdAt": "2020-10-08T08:41:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDczOA=="}], "type": "inlineReview"}, {"oid": "8712945247369376f971f8b5c50eeccb40b3154b", "url": "https://github.com/powsybl/powsybl-core/commit/8712945247369376f971f8b5c50eeccb40b3154b", "message": "Increase code coverage\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-10-08T08:31:55Z", "type": "commit"}, {"oid": "30a8b600ee3f30dc1ae5f4c170def8850378eefd", "url": "https://github.com/powsybl/powsybl-core/commit/30a8b600ee3f30dc1ae5f4c170def8850378eefd", "message": "Fix coding style\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>", "committedDate": "2020-10-08T12:02:22Z", "type": "commit"}, {"oid": "8a4d4d498b5d3f75114e2a01c1ed36aad1f6f7e3", "url": "https://github.com/powsybl/powsybl-core/commit/8a4d4d498b5d3f75114e2a01c1ed36aad1f6f7e3", "message": "Merge branch 'master' into fix-execution-report", "committedDate": "2020-10-08T12:38:53Z", "type": "commit"}]}