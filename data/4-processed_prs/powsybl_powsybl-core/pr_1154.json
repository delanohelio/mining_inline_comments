{"pr_number": 1154, "pr_title": "Fix LoadFlowParameters copy.", "pr_createdAt": "2020-02-11T13:55:05Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1154", "timeline": [{"oid": "c33ff9ac05bc03c2d9eb806193eae51cbdadccbf", "url": "https://github.com/powsybl/powsybl-core/commit/c33ff9ac05bc03c2d9eb806193eae51cbdadccbf", "message": "Fix LoadFlowParameters copy.\n\nCopy extensions via serialize instance.\nFix usage in SecurityAnalysisImpl.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>", "committedDate": "2020-02-11T13:53:37Z", "type": "commit"}, {"oid": "689bf9000b265120309126302df007e393d1be91", "url": "https://github.com/powsybl/powsybl-core/commit/689bf9000b265120309126302df007e393d1be91", "message": "Merge branch 'master' into fix_lf_parameter_copy", "committedDate": "2020-02-11T13:55:50Z", "type": "commit"}, {"oid": "b92ecf178b70301374b996d01f430d119766ed75", "url": "https://github.com/powsybl/powsybl-core/commit/b92ecf178b70301374b996d01f430d119766ed75", "message": "Proposition to fix jackson dependency management.\n\nThe version of jackson-core and jackson-annotations pulled by blazegraph\nwere not compatible with the version of jackson-databind used by the project.\n\nSigned-off-by: Sylvain Leclerc <sylvain.leclerc@rte-france.com>", "committedDate": "2020-02-11T16:49:27Z", "type": "commit"}, {"oid": "b92ecf178b70301374b996d01f430d119766ed75", "url": "https://github.com/powsybl/powsybl-core/commit/b92ecf178b70301374b996d01f430d119766ed75", "message": "Proposition to fix jackson dependency management.\n\nThe version of jackson-core and jackson-annotations pulled by blazegraph\nwere not compatible with the version of jackson-databind used by the project.\n\nSigned-off-by: Sylvain Leclerc <sylvain.leclerc@rte-france.com>", "committedDate": "2020-02-11T16:49:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NzQyMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1154#discussion_r379297423", "bodyText": "Why do you use ByteArrayBuilder?  Why don't you use ByteArrayOutputStream?", "author": "mathbagu", "createdAt": "2020-02-14T08:14:56Z", "path": "loadflow/loadflow-api/src/main/java/com/powsybl/loadflow/LoadFlowParameters.java", "diffHunk": "@@ -181,7 +186,19 @@ public LoadFlowParameters setSpecificCompatibility(boolean specificCompatibility\n     }\n \n     public LoadFlowParameters copy() {\n-        return new LoadFlowParameters(this);\n+        byte[] bytes = writeInMemory();\n+        try (ByteArrayInputStream bais = new ByteArrayInputStream(bytes)) {\n+            return JsonLoadFlowParameters.read(bais);\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private byte[] writeInMemory() {\n+        try (ByteArrayBuilder byteArrayBuilder = new ByteArrayBuilder()) {", "originalCommit": "b92ecf178b70301374b996d01f430d119766ed75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMzNjk0Mg==", "url": "https://github.com/powsybl/powsybl-core/pull/1154#discussion_r379336942", "bodyText": "From doc, it seems like it is a better usage here.\n\nSince version 1.5, also implements OutputStream to allow efficient aggregation of output content as a byte array, similar to how ByteArrayOutputStream works, but somewhat more efficiently for many use cases.\n\nhttps://fasterxml.github.io/jackson-core/javadoc/2.3.0/com/fasterxml/jackson/core/util/ByteArrayBuilder.html", "author": "yichen88", "createdAt": "2020-02-14T09:47:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NzQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0Nzc2MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1154#discussion_r380047760", "bodyText": "We could probably keep ByteArrayBuilder then...", "author": "mathbagu", "createdAt": "2020-02-17T08:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NzQyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5Nzk3Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1154#discussion_r379297977", "bodyText": "I cannot see where this dependency is used. Is it really needed?\nThis dependency should be declared before jackson-core.", "author": "mathbagu", "createdAt": "2020-02-14T08:16:32Z", "path": "pom.xml", "diffHunk": "@@ -136,6 +136,16 @@\n                 <artifactId>bigdata-core</artifactId>\n                 <version>${blazegraph.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>com.fasterxml.jackson.core</groupId>\n+                <artifactId>jackson-core</artifactId>\n+                <version>${jackson.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>com.fasterxml.jackson.core</groupId>\n+                <artifactId>jackson-annotations</artifactId>", "originalCommit": "b92ecf178b70301374b996d01f430d119766ed75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwMzY2NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1154#discussion_r379403664", "bodyText": "The jackson-annotations and jackson-core are pulled by jackson-databind (hence the order, but we can change it).\nIn case we don't impose here the version used, blazegraph pulls its own version of those dependencies, which is inconsistent with our version of jackson-databind : it throws unknown methods exceptions at runtime in cgmes unit tests.\nAs it could happen with dependencies other than blazegraph, it's better to impose our own version of those 2 dependencies a the parent pom level.", "author": "sylvlecl", "createdAt": "2020-02-14T12:24:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5Nzk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwNjU0Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1154#discussion_r379406546", "bodyText": "It's now correctly sorted!", "author": "sylvlecl", "createdAt": "2020-02-14T12:31:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5Nzk3Nw=="}], "type": "inlineReview"}, {"oid": "767c9035c1c2b423b5826d49d68e4250a53bbcac", "url": "https://github.com/powsybl/powsybl-core/commit/767c9035c1c2b423b5826d49d68e4250a53bbcac", "message": "Fix alphabetical sort order in dependency management.\n\nSigned-off-by: Sylvain Leclerc <sylvain.leclerc@rte-france.com>", "committedDate": "2020-02-14T12:30:36Z", "type": "commit"}, {"oid": "3816f5d3d24602937dfdb85bcc7bdbb834856395", "url": "https://github.com/powsybl/powsybl-core/commit/3816f5d3d24602937dfdb85bcc7bdbb834856395", "message": "Remove un-used copy constructor and add java doc.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>", "committedDate": "2020-02-17T09:12:03Z", "type": "commit"}, {"oid": "1e38976f401a4de151f12413ab570a8d2150e3c3", "url": "https://github.com/powsybl/powsybl-core/commit/1e38976f401a4de151f12413ab570a8d2150e3c3", "message": "Merge branch 'master' into fix_lf_parameter_copy", "committedDate": "2020-03-06T08:37:36Z", "type": "commit"}]}