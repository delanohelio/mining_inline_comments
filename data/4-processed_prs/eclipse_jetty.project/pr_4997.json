{"pr_number": 4997, "pr_title": "Issue #4572 - Implementing old logging TAG_PAD as Message Alignment.", "pr_createdAt": "2020-06-24T15:55:39Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4997", "timeline": [{"oid": "e929d0c5d13ccc04e6a596e1b1dbaa6dc626ddd0", "url": "https://github.com/eclipse/jetty.project/commit/e929d0c5d13ccc04e6a596e1b1dbaa6dc626ddd0", "message": "Issue #4572 - Implementing old logging TAG_PAD as Message Alignment.\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-06-24T15:54:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzA1Ng==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r445447056", "bodyText": "Much better name!  I thought TAG_PAD was some known name as it was in a TODO", "author": "gregw", "createdAt": "2020-06-25T10:00:52Z", "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/StdErrAppender.java", "diffHunk": "@@ -32,7 +32,7 @@\n      * Configuration keys specific to the StdErrAppender\n      */\n     static final String NAME_CONDENSE_KEY = \"org.eclipse.jetty.logging.appender.NAME_CONDENSE\";\n-    static final String THREAD_PADDING_KEY = \"org.eclipse.jetty.logging.appender.THREAD_PADDING\";\n+    static final String MESSAGE_ALIGN_KEY = \"org.eclipse.jetty.logging.appender.MESSAGE_ALIGN\";", "originalCommit": "e929d0c5d13ccc04e6a596e1b1dbaa6dc626ddd0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzM2MQ==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r445447361", "bodyText": "I'm just a little cautious that repeat might be less efficient than taking a substring of a longer string.", "author": "gregw", "createdAt": "2020-06-25T10:01:28Z", "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/StdErrAppender.java", "diffHunk": "@@ -154,11 +154,15 @@ private void format(StringBuilder builder, JettyLogger logger, Level level, long\n \n         // Thread Name\n         builder.append(':');\n-        builder.append(threadName); // TODO: support TAG_PAD configuration\n+        builder.append(threadName);\n         builder.append(':');\n \n         // Message\n-        builder.append(' ');\n+        int padAmount = messageAlignColumn - builder.length();\n+        if (padAmount > 0)\n+            builder.append(\" \".repeat(padAmount));", "originalCommit": "e929d0c5d13ccc04e6a596e1b1dbaa6dc626ddd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUxMTM3OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r445511379", "bodyText": "Fair enough, i'll see what the numbers show.\nI did look at the implementation of both in java.lang.String.\n\nString.substring() results in a new String object, based on \"this.value\" byte[] array, with an array copy to a new array for the new String object.\nString.repeat() results in a new String object, based on \"this.value\" byte[] array, with an array copy to a new array for the new String object.", "author": "joakime", "createdAt": "2020-06-25T12:12:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzM2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5MDgyNA==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r455990824", "bodyText": "@gregw here's the results of the IndentBenchmark (jmh) test.\nhttps://github.com/eclipse/jetty.project/blob/jetty-10.0.x-4572-message-indent/tests/jetty-jmh/src/main/java/org/eclipse/jetty/logging/jmh/IndentBenchmark.java\nBenchmark                                                               Mode  Cnt          Score           Error   Units\nIndentBenchmark.testStringRepeatLarge                                  thrpt    7  186589212.883 \u00b1  14318698.518   ops/s\nIndentBenchmark.testStringRepeatLarge:\u00b7gc.alloc.rate                   thrpt    7       7822.988 \u00b1       601.504  MB/sec\nIndentBenchmark.testStringRepeatLarge:\u00b7gc.alloc.rate.norm              thrpt    7         88.000 \u00b1         0.001    B/op\nIndentBenchmark.testStringRepeatLarge:\u00b7gc.churn.G1_Eden_Space          thrpt    7       7854.853 \u00b1      3677.899  MB/sec\nIndentBenchmark.testStringRepeatLarge:\u00b7gc.churn.G1_Eden_Space.norm     thrpt    7         88.310 \u00b1        40.367    B/op\nIndentBenchmark.testStringRepeatLarge:\u00b7gc.count                        thrpt    7         18.000                  counts\nIndentBenchmark.testStringRepeatLarge:\u00b7gc.time                         thrpt    7         64.000                      ms\nIndentBenchmark.testStringRepeatSmall                                  thrpt    7  343002605.870 \u00b1  25715711.800   ops/s\nIndentBenchmark.testStringRepeatSmall:\u00b7gc.alloc.rate                   thrpt    7       9150.062 \u00b1       688.673  MB/sec\nIndentBenchmark.testStringRepeatSmall:\u00b7gc.alloc.rate.norm              thrpt    7         56.000 \u00b1         0.001    B/op\nIndentBenchmark.testStringRepeatSmall:\u00b7gc.churn.G1_Eden_Space          thrpt    7       9078.653 \u00b1      4249.875  MB/sec\nIndentBenchmark.testStringRepeatSmall:\u00b7gc.churn.G1_Eden_Space.norm     thrpt    7         55.546 \u00b1        25.642    B/op\nIndentBenchmark.testStringRepeatSmall:\u00b7gc.count                        thrpt    7         18.000                  counts\nIndentBenchmark.testStringRepeatSmall:\u00b7gc.time                         thrpt    7         73.000                      ms\nIndentBenchmark.testStringSubStringLarge                               thrpt    7  179315393.232 \u00b1 109455137.398   ops/s\nIndentBenchmark.testStringSubStringLarge:\u00b7gc.alloc.rate                thrpt    7       7518.461 \u00b1      4593.109  MB/sec\nIndentBenchmark.testStringSubStringLarge:\u00b7gc.alloc.rate.norm           thrpt    7         88.000 \u00b1         0.001    B/op\nIndentBenchmark.testStringSubStringLarge:\u00b7gc.churn.G1_Eden_Space       thrpt    7       7535.104 \u00b1      6436.079  MB/sec\nIndentBenchmark.testStringSubStringLarge:\u00b7gc.churn.G1_Eden_Space.norm  thrpt    7         87.144 \u00b1        46.695    B/op\nIndentBenchmark.testStringSubStringLarge:\u00b7gc.count                     thrpt    7         18.000                  counts\nIndentBenchmark.testStringSubStringLarge:\u00b7gc.time                      thrpt    7         51.000                      ms\nIndentBenchmark.testStringSubStringSmall                               thrpt    7  303492551.318 \u00b1  41265934.036   ops/s\nIndentBenchmark.testStringSubStringSmall:\u00b7gc.alloc.rate                thrpt    7       8096.412 \u00b1      1102.379  MB/sec\nIndentBenchmark.testStringSubStringSmall:\u00b7gc.alloc.rate.norm           thrpt    7         56.000 \u00b1         0.001    B/op\nIndentBenchmark.testStringSubStringSmall:\u00b7gc.churn.G1_Eden_Space       thrpt    7       8215.101 \u00b1      3847.187  MB/sec\nIndentBenchmark.testStringSubStringSmall:\u00b7gc.churn.G1_Eden_Space.norm  thrpt    7         56.618 \u00b1        22.595    B/op\nIndentBenchmark.testStringSubStringSmall:\u00b7gc.count                     thrpt    7         18.000                  counts\nIndentBenchmark.testStringSubStringSmall:\u00b7gc.time                      thrpt    7         43.000                      ms", "author": "joakime", "createdAt": "2020-07-16T18:32:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzM2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5NTI4Mg==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r455995282", "bodyText": "When I look at the results, I see that String.repeat() is slightly faster (in terms of ops/s.  4% faster in large cases, 12% faster in the small cases).\nAnd the GC is about the same.\nBut with a higher error-bars on the substring version.", "author": "joakime", "createdAt": "2020-07-16T18:40:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzM2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY1MTMyOQ==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r470651329", "bodyText": "@gregw bump. could use a review of the benchmark results here.", "author": "joakime", "createdAt": "2020-08-14T14:17:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzM2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5NDU4OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4997#discussion_r471594589", "bodyText": "repeat LGTM.    I think there may be other places we can do the same.... but another PR.", "author": "gregw", "createdAt": "2020-08-17T16:25:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NzM2MQ=="}], "type": "inlineReview"}, {"oid": "c564c9647ecda423441515e68603c130fbd99967", "url": "https://github.com/eclipse/jetty.project/commit/c564c9647ecda423441515e68603c130fbd99967", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-4572-message-indent", "committedDate": "2020-07-16T18:21:32Z", "type": "commit"}, {"oid": "f87711b2daf083e42708d6dd1143cbb72616e8a0", "url": "https://github.com/eclipse/jetty.project/commit/f87711b2daf083e42708d6dd1143cbb72616e8a0", "message": "Adding jmh test to compare String.substring() vs String.repeat()\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-07-16T18:30:47Z", "type": "commit"}, {"oid": "5a0f18513bb4383cddb186cecc8ab5ecf9a0335d", "url": "https://github.com/eclipse/jetty.project/commit/5a0f18513bb4383cddb186cecc8ab5ecf9a0335d", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-4572-message-indent", "committedDate": "2020-08-20T18:29:50Z", "type": "commit"}, {"oid": "47229e019014a812957f18b06ce39183626bbdfb", "url": "https://github.com/eclipse/jetty.project/commit/47229e019014a812957f18b06ce39183626bbdfb", "message": "Addressing checkstyle error\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-08-20T18:31:17Z", "type": "commit"}]}