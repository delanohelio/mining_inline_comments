{"pr_number": 5180, "pr_title": "Change the way ConnectorStatistics is added to the Servers Connectors", "pr_createdAt": "2020-08-21T05:56:59Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5180", "timeline": [{"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "url": "https://github.com/eclipse/jetty.project/commit/623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "message": "Change the way ConnectorStatistics is added to the Servers Connectors\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-08-21T05:45:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU3NDQ0Mg==", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475574442", "bodyText": "maybe addBeanToAllConnectors()", "author": "gregw", "createdAt": "2020-08-24T12:50:07Z", "path": "examples/embedded/src/main/java/org/eclipse/jetty/embedded/OneServletContextJmxStats.java", "diffHunk": "@@ -45,7 +45,7 @@ public static Server createServer(int port)\n         context.addServlet(DefaultServlet.class, \"/\");\n \n         // Add Connector Statistics tracking to all connectors\n-        ServerConnectionStatistics.addToAllConnectors(server);\n+        server.addToAllConnectors(new ConnectionStatistics());", "originalCommit": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYzMDg1OA==", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475630858", "bodyText": "The method currently takes a Connection.Listener so what about addListenerToAllConnectors()?\nOr should I generalise it to addBeanToAllConnectors(Object o).", "author": "lachlan-roberts", "createdAt": "2020-08-24T13:58:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU3NDQ0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1NDkwMw==", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475654903", "bodyText": "I think the impl just does an addBean, so addBeanToAllConnectors(Object) is best.   If I missed something and it is about Listeners, then `addListenerToAllConnectors(Listener)", "author": "gregw", "createdAt": "2020-08-24T14:30:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU3NDQ0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY3NDk2Mg==", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475674962", "bodyText": "@gregw changing this to addBeanToAllConnectors will make this javadoc irrelevant.\nMaybe it is worth keeping it as a Listener method to keep this documentation around, it doesn't seem obvious that adding a Listener as a bean on a connector would add it for all new connections. Only other place I can see this mentioned is the javadoc for ConnectionStatistics which doesn't seem the right place.", "author": "lachlan-roberts", "createdAt": "2020-08-24T14:56:36Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Server.java", "diffHunk": "@@ -265,6 +266,19 @@ public void setConnectors(Connector[] connectors)\n             _connectors.addAll(Arrays.asList(connectors));\n     }\n \n+    /**\n+     * Add a {@link Connection.Listener} as a bean to all connectors on the server, this\n+     * will register the listener with all connections accepted by the connectors.\n+     * @param listener the listener to be added.", "originalCommit": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyMTIyMA==", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475721220", "bodyText": "See my suggestion for the javadoc below.", "author": "gregw", "createdAt": "2020-08-24T15:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY3NDk2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyMDk1Mw==", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475720953", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * Add a {@link Connection.Listener} as a bean to all connectors on the server, this\n          \n          \n            \n                 * will register the listener with all connections accepted by the connectors.\n          \n          \n            \n                 * @param listener the listener to be added.\n          \n          \n            \n                 */\n          \n          \n            \n                public void addToAllConnectors(Connection.Listener listener)\n          \n          \n            \n                {\n          \n          \n            \n                    for (Connector connector : getConnectors())\n          \n          \n            \n                    {\n          \n          \n            \n                        connector.addBean(listener);\n          \n          \n            \n                    }\n          \n          \n            \n                }\n          \n          \n            \n                /**\n          \n          \n            \n                 * Add a bean to all connectors on the server.\n          \n          \n            \n                 * If the bean is an instance of {@link Connection.Listener} it will also be \n          \n          \n            \n                 * registered as a listener on all connections accepted by the connectors.\n          \n          \n            \n                 * @param bean the bean to be added.\n          \n          \n            \n                 */\n          \n          \n            \n                public void addBeanToAllConnectors(Object bean)\n          \n          \n            \n                {\n          \n          \n            \n                    for (Connector connector : getConnectors())\n          \n          \n            \n                    {\n          \n          \n            \n                        connector.addBean(bean);\n          \n          \n            \n                    }\n          \n          \n            \n                }", "author": "gregw", "createdAt": "2020-08-24T15:59:19Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Server.java", "diffHunk": "@@ -265,6 +266,19 @@ public void setConnectors(Connector[] connectors)\n             _connectors.addAll(Arrays.asList(connectors));\n     }\n \n+    /**\n+     * Add a {@link Connection.Listener} as a bean to all connectors on the server, this\n+     * will register the listener with all connections accepted by the connectors.\n+     * @param listener the listener to be added.\n+     */\n+    public void addToAllConnectors(Connection.Listener listener)\n+    {\n+        for (Connector connector : getConnectors())\n+        {\n+            connector.addBean(listener);\n+        }\n+    }", "originalCommit": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8faa71818f479db5a8cd0d74d8e2034df872bb96", "url": "https://github.com/eclipse/jetty.project/commit/8faa71818f479db5a8cd0d74d8e2034df872bb96", "message": "change addToAllConnectors method to addBeanToAllConnectors\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-08-25T00:22:18Z", "type": "commit"}]}