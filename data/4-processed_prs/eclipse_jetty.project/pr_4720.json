{"pr_number": 4720, "pr_title": "Issue #4719 Keep previous charencoding if not set in content type", "pr_createdAt": "2020-03-26T11:44:53Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4720", "timeline": [{"oid": "b73052923c2d90d6dad6fd721b8fe7093280c47d", "url": "https://github.com/eclipse/jetty.project/commit/b73052923c2d90d6dad6fd721b8fe7093280c47d", "message": "Issue #4719 Keep previous charencoding if not set in content type\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-26T11:43:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r398785369", "bodyText": "Does this get sent over the wire on HTTP/1.1 as ...\nContent-Type: foo/bar; charset=utf-8\n\n?\nIf so, then this PR is either doing too much, or we lack the extra tests to prove that we allow a user to turn off that charset= portion on the HTTP response.", "author": "joakime", "createdAt": "2020-03-26T18:07:59Z", "path": "jetty-server/src/test/java/org/eclipse/jetty/server/ResponseTest.java", "diffHunk": "@@ -624,7 +635,7 @@ public void testResetContentTypeWithCharacterEncoding() throws Exception\n \n         response.setContentType(\"wrong/answer;charset=utf-8\");\n         response.setContentType(\"foo/bar\");\n-        assertEquals(\"foo/bar\", response.getContentType());\n+        assertEquals(\"foo/bar;charset=utf-8\", response.getContentType());", "originalCommit": "b73052923c2d90d6dad6fd721b8fe7093280c47d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NDUwMA==", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r398794500", "bodyText": "This change won't force a change to the charset: in fact, the change prevents a change to the charset that that spec does not support.  Unfortunately, the javadoc for ServletResponse.setContentType() does not make this behaviour clear in the case of the content-type without char-set, so all we have to go on is the tck test: https://github.com/eclipse-ee4j/jakartaee-tck/blob/master/src/com/sun/ts/tests/servlet/api/common/response/ResponseTests.java#L680", "author": "janbartel", "createdAt": "2020-03-26T18:21:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzNDU4OA==", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r398834588", "bodyText": "I created a new branch (from this one) called jetty-10.0.x-4719-keepcharencoding-extratests with new testcases to show the concern (see commit e0b322f).\nTwo of the new testcases in ResponseHeadersTest are now failing ...\n\ntestCharsetChangeToJsonMimeType()\ntestCharsetChangeToJsonMimeTypeSetCharsetToNull()\n\n\nInteresting aside, I didn't know you could use HttpServletResponse.reset() after obtaining a getWriter() and still use that writer.", "author": "joakime", "createdAt": "2020-03-26T19:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5NzQyMA==", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r399197420", "bodyText": "@joakime I've merged your branch into mine, and added a fix for content types like json that must have an assumed char set. Thanks for the concrete tests!!", "author": "janbartel", "createdAt": "2020-03-27T11:24:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ=="}], "type": "inlineReview"}, {"oid": "e0b322f7d556837986accb3e881d5ec374285ede", "url": "https://github.com/eclipse/jetty.project/commit/e0b322f7d556837986accb3e881d5ec374285ede", "message": "Issue #4719 - Adding unit tests for charset reset/change\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-03-26T19:19:57Z", "type": "commit"}, {"oid": "fc74c1eeaeb2c39cfac7bdbf326a464dc228c423", "url": "https://github.com/eclipse/jetty.project/commit/fc74c1eeaeb2c39cfac7bdbf326a464dc228c423", "message": "Issue #4719 - Adding unit tests for charset reset/change\n\nMinor formatting and more comments.\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-03-26T19:30:00Z", "type": "commit"}, {"oid": "775ad5a77047067ca57d4339d412e2feeb98eac4", "url": "https://github.com/eclipse/jetty.project/commit/775ad5a77047067ca57d4339d412e2feeb98eac4", "message": "Issue #4719 incorporate new tests, fix char encoding that should be assumed\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-27T11:22:33Z", "type": "commit"}]}