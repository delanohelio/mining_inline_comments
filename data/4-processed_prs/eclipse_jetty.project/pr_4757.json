{"pr_number": 4757, "pr_title": "Use HandlerList instead of HandlerCollection", "pr_createdAt": "2020-04-08T09:05:06Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4757", "timeline": [{"oid": "407f6d005acabf372b336eda08cf0959d3f70454", "url": "https://github.com/eclipse/jetty.project/commit/407f6d005acabf372b336eda08cf0959d3f70454", "message": "Use HandlerList instead of HandlerCollection\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-04-08T09:03:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3NDM5NQ==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r405374395", "bodyText": "@olamy the structure of this XML is a bit strange. Not sure why the two Contexts are not under the ContextHandlerCollection?", "author": "gregw", "createdAt": "2020-04-08T09:09:39Z", "path": "tests/test-integration/src/test/resources/RFC2616Base.xml", "diffHunk": "@@ -33,7 +33,7 @@\n     <!-- Set handler Collection Structure                            -->\n     <!-- =========================================================== -->\n     <Set name=\"handler\">\n-      <New id=\"Handlers\" class=\"org.eclipse.jetty.server.handler.HandlerCollection\">\n+      <New id=\"Handlers\" class=\"org.eclipse.jetty.server.handler.HandlerList\">", "originalCommit": "407f6d005acabf372b336eda08cf0959d3f70454", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzMDQ4MQ==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r406130481", "bodyText": "No idea but I agree it's really strange and need to be fixed", "author": "olamy", "createdAt": "2020-04-09T11:11:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3NDM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkyNzc1Ng==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r407927756", "bodyText": "OK - will do in a separate PR", "author": "gregw", "createdAt": "2020-04-14T07:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3NDM5NQ=="}], "type": "inlineReview"}, {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "url": "https://github.com/eclipse/jetty.project/commit/6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "message": "Use HandlerList instead of HandlerCollection\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-04-08T13:07:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNjAxOQ==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408336019", "bodyText": "Meh.\nI like the HandlerList + addHandler view of the original.", "author": "joakime", "createdAt": "2020-04-14T18:09:06Z", "path": "examples/embedded/src/main/java/org/eclipse/jetty/embedded/WebSocketJsrServer.java", "diffHunk": "@@ -65,8 +62,7 @@ public static Server createServer(int port)\n             }\n         );\n \n-        handlers.addHandler(new DefaultHandler());\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "originalCommit": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyNzc1Mg==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408627752", "bodyText": "I think there is value in reducing 4 lines of code to 1, specially as the structure was previous spread over 15 lines.", "author": "gregw", "createdAt": "2020-04-15T07:13:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNjAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMzQ5Nw==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408633497", "bodyText": "Since ServletContextHandler is a terminal Handler, what's the point of having a DefaultHandler afterwards?", "author": "sbordet", "createdAt": "2020-04-15T07:24:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNjAxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzODc1OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408338759", "bodyText": "We shouldn't get rid of all of our usages of addHandler(Handler).\nThat needs to be tested as well.", "author": "joakime", "createdAt": "2020-04-14T18:13:45Z", "path": "jetty-server/src/test/java/org/eclipse/jetty/server/handler/SecuredRedirectHandlerTest.java", "diffHunk": "@@ -126,11 +126,7 @@ public static void startServer() throws Exception\n         contextHandlers.setHandlers(new Handler[]{redirectHandler, rootContext, test1Context, test2Context});\n \n         // Create server level handler tree\n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(contextHandlers);\n-        handlers.addHandler(new DefaultHandler()); // round things out\n-\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(contextHandlers, new DefaultHandler()));", "originalCommit": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyNjc3MA==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408626770", "bodyText": "There are still many usage examples and tests.  Specially when the handlers are complex or variable.", "author": "gregw", "createdAt": "2020-04-15T07:11:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzODc1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTI0NQ==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639245", "bodyText": "Again, is DefaultHandler ever called since ServletContextHandler is a terminal handler?", "author": "sbordet", "createdAt": "2020-04-15T07:35:24Z", "path": "jetty-websocket/websocket-javax-tests/src/test/java/org/eclipse/jetty/websocket/javax/tests/RestartContextTest.java", "diffHunk": "@@ -72,12 +72,7 @@ public void testStartStopStartServletContextListener() throws Exception\n         context.addEventListener(new AddEndpointListener());\n \n         // Setup handler tree\n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n-\n-        // Add handler tree to server\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "originalCommit": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcwMzQ3OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408703479", "bodyText": "@sbordet ServletContextHandler is not always a terminal handler.\nAll ContextHandler must first match a request before they continue handling it. They reject a match because of context path and/or virtual host and/or named connector.  Even if a request matches the context, it can still be returned unhandled if the ServletHandler is configured to have no default.", "author": "gregw", "createdAt": "2020-04-15T09:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTI0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTQ1Ng==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639456", "bodyText": "Ditto.", "author": "sbordet", "createdAt": "2020-04-15T07:35:48Z", "path": "jetty-websocket/websocket-javax-tests/src/test/java/org/eclipse/jetty/websocket/javax/tests/RestartContextTest.java", "diffHunk": "@@ -114,9 +109,7 @@ public void testStartStopStartConfigurator() throws Exception\n         });\n \n         // Setup handler tree\n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n+        HandlerList handlers = new HandlerList(context, new DefaultHandler());", "originalCommit": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTU4Mw==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639583", "bodyText": "Ditto", "author": "sbordet", "createdAt": "2020-04-15T07:36:04Z", "path": "jetty-websocket/websocket-jetty-server/src/test/java/org/eclipse/jetty/websocket/server/browser/BrowserDebugTool.java", "diffHunk": "@@ -114,11 +114,7 @@ public void prepare(int port)\n         ServletHolder defHolder = new ServletHolder(\"default\", DefaultServlet.class);\n         context.addServlet(defHolder, \"/\");\n \n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n-\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "originalCommit": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTcwNw==", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639707", "bodyText": "Ditto.", "author": "sbordet", "createdAt": "2020-04-15T07:36:20Z", "path": "jetty-websocket/websocket-jetty-tests/src/test/java/org/eclipse/jetty/websocket/tests/client/BadNetworkTest.java", "diffHunk": "@@ -86,10 +86,7 @@ public void configure(JettyWebSocketServletFactory factory)\n         });\n         context.addServlet(holder, \"/ws\");\n \n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "originalCommit": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}