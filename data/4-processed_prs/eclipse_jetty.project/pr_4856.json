{"pr_number": 4856, "pr_title": "introduce socket configuration properties in Jetty XML files", "pr_createdAt": "2020-05-08T09:17:55Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4856", "timeline": [{"oid": "d9e8a70fb93268f29fd688e12ba3e5ca5019cbbc", "url": "https://github.com/eclipse/jetty.project/commit/d9e8a70fb93268f29fd688e12ba3e5ca5019cbbc", "message": "introduce socket configuration properties in Jetty XML files\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>", "committedDate": "2020-05-08T09:20:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA0MTQ0OA==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422041448", "bodyText": "Please:\n\nrename the property names to jetty.http.acceptedTcpNoDelay (i.e. not dot after accepted)\nadd acceptedReuseAddress - use reuseAddress on the ServerSocket and acceptedReuseAddress on the accepted Socket", "author": "sbordet", "createdAt": "2020-05-08T09:24:05Z", "path": "jetty-server/src/main/config/etc/jetty-http.xml", "diffHunk": "@@ -34,6 +34,10 @@\n         <Set name=\"idleTimeout\"><Property name=\"jetty.http.idleTimeout\" deprecated=\"http.timeout\" default=\"30000\"/></Set>\n         <Set name=\"acceptorPriorityDelta\"><Property name=\"jetty.http.acceptorPriorityDelta\" deprecated=\"http.acceptorPriorityDelta\" default=\"0\"/></Set>\n         <Set name=\"acceptQueueSize\"><Property name=\"jetty.http.acceptQueueSize\" deprecated=\"http.acceptQueueSize\" default=\"0\"/></Set>\n+        <Set name=\"reuseAddress\"><Property name=\"jetty.http.reuseAddress\" default=\"true\"/></Set>\n+        <Set name=\"acceptedTcpNoDelay\"><Property name=\"jetty.http.accepted.tcpNoDelay\" default=\"true\"/></Set>\n+        <Set name=\"acceptedReceiveBufferSize\"><Property name=\"jetty.http.accepted.receiveBufferSize\" default=\"-1\"/></Set>\n+        <Set name=\"acceptedSendBufferSize\"><Property name=\"jetty.http.accepted.sendBufferSize\" default=\"-1\"/></Set>", "originalCommit": "d9e8a70fb93268f29fd688e12ba3e5ca5019cbbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA1OTQ1OA==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422059458", "bodyText": "I'm okay with renaming the properties.\nRegarding acceptedReuseAddress, I don't think setting SO_REUSEADDR as any effect on an accepted socket.", "author": "lorban", "createdAt": "2020-05-08T10:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA0MTQ0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA0MTU2Ng==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422041566", "bodyText": "Same as above.", "author": "sbordet", "createdAt": "2020-05-08T09:24:20Z", "path": "jetty-server/src/main/config/etc/jetty-ssl.xml", "diffHunk": "@@ -26,6 +26,10 @@\n         <Set name=\"idleTimeout\"><Property name=\"jetty.ssl.idleTimeout\" deprecated=\"ssl.timeout\" default=\"30000\"/></Set>\n         <Set name=\"acceptorPriorityDelta\"><Property name=\"jetty.ssl.acceptorPriorityDelta\" deprecated=\"ssl.acceptorPriorityDelta\" default=\"0\"/></Set>\n         <Set name=\"acceptQueueSize\"><Property name=\"jetty.ssl.acceptQueueSize\" deprecated=\"ssl.acceptQueueSize\" default=\"0\"/></Set>\n+        <Set name=\"reuseAddress\"><Property name=\"jetty.http.reuseAddress\" default=\"true\"/></Set>\n+        <Set name=\"acceptedTcpNoDelay\"><Property name=\"jetty.http.accepted.tcpNoDelay\" default=\"true\"/></Set>\n+        <Set name=\"acceptedReceiveBufferSize\"><Property name=\"jetty.http.accepted.receiveBufferSize\" default=\"-1\"/></Set>\n+        <Set name=\"acceptedSendBufferSize\"><Property name=\"jetty.http.accepted.sendBufferSize\" default=\"-1\"/></Set>", "originalCommit": "d9e8a70fb93268f29fd688e12ba3e5ca5019cbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA0MjE5OA==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422042198", "bodyText": "Please check if we hardcode tcpNoDelay=true for the ServerSocket too, and make it settable.", "author": "sbordet", "createdAt": "2020-05-08T09:25:38Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -83,6 +83,9 @@\n     private volatile int _localPort = -1;\n     private volatile int _acceptQueueSize = 0;\n     private volatile boolean _reuseAddress = true;\n+    private volatile boolean _acceptedTcpNoDelay = true;", "originalCommit": "d9e8a70fb93268f29fd688e12ba3e5ca5019cbbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA1NzE3NQ==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422057175", "bodyText": "No, we don't touch tcpNoDelay on the ServerSocket because there was no API to do that before JDK 9.", "author": "lorban", "createdAt": "2020-05-08T10:00:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA0MjE5OA=="}], "type": "inlineReview"}, {"oid": "2efe447bf86e97b8153884ff7f0a3cd3a97415c1", "url": "https://github.com/eclipse/jetty.project/commit/2efe447bf86e97b8153884ff7f0a3cd3a97415c1", "message": "introduce socket configuration properties in Jetty XML files\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>", "committedDate": "2020-05-08T10:20:53Z", "type": "forcePushed"}, {"oid": "da2c7f48a1e629a63d5429e2b2c29278bced249a", "url": "https://github.com/eclipse/jetty.project/commit/da2c7f48a1e629a63d5429e2b2c29278bced249a", "message": "introduce socket configuration properties in Jetty XML files\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>", "committedDate": "2020-05-08T10:24:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA4MjEwNg==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422082106", "bodyText": "These are good. Can you please go to the correspondent *.mod file and add them there too?", "author": "sbordet", "createdAt": "2020-05-08T11:03:20Z", "path": "jetty-server/src/main/config/etc/jetty-http.xml", "diffHunk": "@@ -34,6 +34,10 @@\n         <Set name=\"idleTimeout\"><Property name=\"jetty.http.idleTimeout\" deprecated=\"http.timeout\" default=\"30000\"/></Set>\n         <Set name=\"acceptorPriorityDelta\"><Property name=\"jetty.http.acceptorPriorityDelta\" deprecated=\"http.acceptorPriorityDelta\" default=\"0\"/></Set>\n         <Set name=\"acceptQueueSize\"><Property name=\"jetty.http.acceptQueueSize\" deprecated=\"http.acceptQueueSize\" default=\"0\"/></Set>\n+        <Set name=\"reuseAddress\"><Property name=\"jetty.http.reuseAddress\" default=\"true\"/></Set>\n+        <Set name=\"acceptedTcpNoDelay\"><Property name=\"jetty.http.acceptedTcpNoDelay\" default=\"true\"/></Set>\n+        <Set name=\"acceptedReceiveBufferSize\"><Property name=\"jetty.http.acceptedReceiveBufferSize\" default=\"-1\"/></Set>\n+        <Set name=\"acceptedSendBufferSize\"><Property name=\"jetty.http.acceptedSendBufferSize\" default=\"-1\"/></Set>", "originalCommit": "da2c7f48a1e629a63d5429e2b2c29278bced249a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA4Mjk5OA==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422082998", "bodyText": "Sure, let me do it.", "author": "lorban", "createdAt": "2020-05-08T11:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA4MjEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA4MjEzOA==", "url": "https://github.com/eclipse/jetty.project/pull/4856#discussion_r422082138", "bodyText": "Ditto.", "author": "sbordet", "createdAt": "2020-05-08T11:03:25Z", "path": "jetty-server/src/main/config/etc/jetty-ssl.xml", "diffHunk": "@@ -26,6 +26,10 @@\n         <Set name=\"idleTimeout\"><Property name=\"jetty.ssl.idleTimeout\" deprecated=\"ssl.timeout\" default=\"30000\"/></Set>\n         <Set name=\"acceptorPriorityDelta\"><Property name=\"jetty.ssl.acceptorPriorityDelta\" deprecated=\"ssl.acceptorPriorityDelta\" default=\"0\"/></Set>\n         <Set name=\"acceptQueueSize\"><Property name=\"jetty.ssl.acceptQueueSize\" deprecated=\"ssl.acceptQueueSize\" default=\"0\"/></Set>\n+        <Set name=\"reuseAddress\"><Property name=\"jetty.ssl.reuseAddress\" default=\"true\"/></Set>\n+        <Set name=\"acceptedTcpNoDelay\"><Property name=\"jetty.ssl.acceptedTcpNoDelay\" default=\"true\"/></Set>\n+        <Set name=\"acceptedReceiveBufferSize\"><Property name=\"jetty.ssl.acceptedReceiveBufferSize\" default=\"-1\"/></Set>\n+        <Set name=\"acceptedSendBufferSize\"><Property name=\"jetty.ssl.acceptedSendBufferSize\" default=\"-1\"/></Set>", "originalCommit": "da2c7f48a1e629a63d5429e2b2c29278bced249a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "409db8d065b8e89f2c64ed7d37669c0f84836625", "url": "https://github.com/eclipse/jetty.project/commit/409db8d065b8e89f2c64ed7d37669c0f84836625", "message": "introduce socket configuration properties in Jetty XML files\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>", "committedDate": "2020-05-08T11:14:50Z", "type": "commit"}, {"oid": "409db8d065b8e89f2c64ed7d37669c0f84836625", "url": "https://github.com/eclipse/jetty.project/commit/409db8d065b8e89f2c64ed7d37669c0f84836625", "message": "introduce socket configuration properties in Jetty XML files\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>", "committedDate": "2020-05-08T11:14:50Z", "type": "forcePushed"}]}