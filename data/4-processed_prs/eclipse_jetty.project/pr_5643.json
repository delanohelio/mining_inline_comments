{"pr_number": 5643, "pr_title": "Cleanup request/response recycle #4711", "pr_createdAt": "2020-11-11T22:06:04Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5643", "timeline": [{"oid": "a99ab04fe5bccdd943c8eba892a9c30275689cea", "url": "https://github.com/eclipse/jetty.project/commit/a99ab04fe5bccdd943c8eba892a9c30275689cea", "message": "Cleanup request/response recycle #4711\n\nReordered recycle in request and response to field order so that we can check that all fields are recycled.", "committedDate": "2020-11-11T22:05:06Z", "type": "commit"}, {"oid": "b7467071eb4f549f524c85c462d6bb48204403b9", "url": "https://github.com/eclipse/jetty.project/commit/b7467071eb4f549f524c85c462d6bb48204403b9", "message": "Fixed ordering of reader consumption", "committedDate": "2020-11-12T10:45:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwNDAyNg==", "url": "https://github.com/eclipse/jetty.project/pull/5643#discussion_r524004026", "bodyText": "while loops require braces for checkstyle.", "author": "sbordet", "createdAt": "2020-11-16T09:13:13Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Request.java", "diffHunk": "@@ -1857,37 +1857,40 @@ public boolean hasMetaData()\n \n     protected void recycle()\n     {\n-        _metaData = null;\n-        _originalURI = null;\n-\n         if (_context != null)\n             throw new IllegalStateException(\"Request in context!\");\n-\n-        if (_inputState == INPUT_READER)\n+        if (_reader != null && _inputState == INPUT_READER)\n         {\n             try\n             {\n                 int r = _reader.read();\n                 while (r != -1)\n-                {", "originalCommit": "b7467071eb4f549f524c85c462d6bb48204403b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwNTEyNQ==", "url": "https://github.com/eclipse/jetty.project/pull/5643#discussion_r524005125", "bodyText": "Unnecessary newline.", "author": "sbordet", "createdAt": "2020-11-16T09:14:13Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Request.java", "diffHunk": "@@ -1857,37 +1857,40 @@ public boolean hasMetaData()\n \n     protected void recycle()\n     {\n-        _metaData = null;\n-        _originalURI = null;\n-\n         if (_context != null)\n             throw new IllegalStateException(\"Request in context!\");\n-\n-        if (_inputState == INPUT_READER)\n+        if (_reader != null && _inputState == INPUT_READER)\n         {\n             try\n             {\n                 int r = _reader.read();\n                 while (r != -1)\n-                {\n                     r = _reader.read();\n-                }\n             }\n             catch (Exception e)\n             {\n                 LOG.ignore(e);\n                 _reader = null;\n+                _readerEncoding = null;\n             }\n         }\n \n-        _dispatcherType = null;\n-        setAuthentication(Authentication.NOT_CHECKED);\n         getHttpChannelState().recycle();\n-        if (_async != null)\n-            _async.reset();\n-        _async = null;\n+        _requestAttributeListeners.clear();\n+        _input.recycle();\n+", "originalCommit": "b7467071eb4f549f524c85c462d6bb48204403b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aee2f386247febc7ddb925c4fdb1840309517d69", "url": "https://github.com/eclipse/jetty.project/commit/aee2f386247febc7ddb925c4fdb1840309517d69", "message": "update from review", "committedDate": "2020-11-16T09:30:10Z", "type": "commit"}]}