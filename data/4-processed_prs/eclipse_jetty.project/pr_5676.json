{"pr_number": 5676, "pr_title": "Issue #5675 Update some osgi test dependencies", "pr_createdAt": "2020-11-16T15:13:52Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5676", "timeline": [{"oid": "bdb4dd435e18336c61f67d270004e17696481bc3", "url": "https://github.com/eclipse/jetty.project/commit/bdb4dd435e18336c61f67d270004e17696481bc3", "message": "Issue #5675 Update some osgi test dependencies\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-11-16T15:09:45Z", "type": "commit"}, {"oid": "c8af99e6c6a33f75eb927bb860d00f301289f430", "url": "https://github.com/eclipse/jetty.project/commit/c8af99e6c6a33f75eb927bb860d00f301289f430", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-5675-update-osgi-test-deps", "committedDate": "2020-11-17T14:51:09Z", "type": "commit"}, {"oid": "f911dbcd5d65bc9cae745b29a37bb38c6d77284c", "url": "https://github.com/eclipse/jetty.project/commit/f911dbcd5d65bc9cae745b29a37bb38c6d77284c", "message": "Issue #5675 update osgi platform version\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-11-23T09:07:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU1ODExMg==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r529558112", "bodyText": "This osgi-services-version is still using ...\n<dependency>\n  <groupId>org.eclipse.osgi</groupId>\n  <artifactId>org.eclipse.osgi.services</artifactId>\n  <version>3.2.100.v20100503</version>\n</dependency>\nWhich is the old, bad, maven coordinates. (which is a 10 year old artifact now with no updates on this coordinate space)\nLink to old / bad coordinates: https://search.maven.org/artifact/org.eclipse.osgi/org.eclipse.osgi.services\nThe correct coordinates for osgi.services is ...\n<dependency>\n  <groupId>org.eclipse.platform</groupId>\n  <artifactId>org.eclipse.osgi.services</artifactId>\n  <version>3.9.0</version>\n</dependency>\nWhich was updated 14-Sep-2020\nLink to proper coordinates: https://search.maven.org/artifact/org.eclipse.platform/org.eclipse.osgi.services", "author": "joakime", "createdAt": "2020-11-24T13:49:26Z", "path": "jetty-osgi/pom.xml", "diffHunk": "@@ -12,7 +12,7 @@\n   <packaging>pom</packaging>\n \n   <properties>\n-    <osgi-version>3.6.0.v20100517</osgi-version>\n+    <osgi-version>3.7.1</osgi-version>\n     <osgi-services-version>3.2.100.v20100503</osgi-services-version>", "originalCommit": "f911dbcd5d65bc9cae745b29a37bb38c6d77284c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU1OTU3OA==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r529559578", "bodyText": "If you're positive that those 2 different coordinates are for the osgi services, then I'll try updating the version of that. I did look for a newer version, but obviously only at the old coordinates.", "author": "janbartel", "createdAt": "2020-11-24T13:51:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU1ODExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MDE0MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r529560141", "bodyText": "The version from the bad coordinates is also dependent on the older osgi version ...\n    <dependency>\n      <groupId>org.eclipse.osgi</groupId>\n      <artifactId>org.eclipse.osgi</artifactId>\n      <version>3.6.0.v20100517</version>\n    </dependency>", "author": "joakime", "createdAt": "2020-11-24T13:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU1ODExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2Mzc0NQ==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r529563745", "bodyText": "The listed packages for both ...\nOld Coordinate Space\n$ jar -tvf org.eclipse.osgi.services-3.2.100.v20100503.jar | cut -c37- | grep -E \".class$\" | sed -e \"s/[A-Za-z0-9\\$]*\\.class//\" | sort -u | grep -v \"META-INF\"\norg/osgi/service/cm/\norg/osgi/service/component/\norg/osgi/service/device/\norg/osgi/service/event/\norg/osgi/service/http/\norg/osgi/service/io/\norg/osgi/service/log/\norg/osgi/service/metatype/\norg/osgi/service/provisioning/\norg/osgi/service/upnp/\norg/osgi/service/useradmin/\norg/osgi/service/wireadmin/\n\nNew Coordinate Space\n$ jar -tvf org.eclipse.osgi.services-3.9.0.jar | cut -c37- | grep -E \".class$\" | sed -e \"s/[A-Za-z0-9\\$\\-]*\\.class//\" | sort -u | grep -v \"META-INF\"\norg/osgi/service/cm/\norg/osgi/service/component/\norg/osgi/service/component/annotations/\norg/osgi/service/component/runtime/\norg/osgi/service/component/runtime/dto/\norg/osgi/service/device/\norg/osgi/service/event/\norg/osgi/service/http/\norg/osgi/service/http/context/\norg/osgi/service/http/runtime/\norg/osgi/service/http/runtime/dto/\norg/osgi/service/http/whiteboard/\norg/osgi/service/log/\norg/osgi/service/metatype/\norg/osgi/service/provisioning/\norg/osgi/service/upnp/\norg/osgi/service/useradmin/\norg/osgi/service/wireadmin/", "author": "joakime", "createdAt": "2020-11-24T13:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU1ODExMg=="}], "type": "inlineReview"}, {"oid": "e730c274a73e463ccf3892e2ff203b369b74dd53", "url": "https://github.com/eclipse/jetty.project/commit/e730c274a73e463ccf3892e2ff203b369b74dd53", "message": "Issue 5675 Also update osgi services to newest version.\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-11-24T16:20:56Z", "type": "commit"}, {"oid": "4aac7f03f1a08292c37598125427a619defbfb49", "url": "https://github.com/eclipse/jetty.project/commit/4aac7f03f1a08292c37598125427a619defbfb49", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-5675-update-osgi-test-deps", "committedDate": "2020-11-25T13:30:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyODg5MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530528891", "bodyText": "Why add only org.osgi.service.event and not the rest of the other packages in the new osgi-service jar?", "author": "joakime", "createdAt": "2020-11-25T17:11:42Z", "path": "jetty-osgi/jetty-osgi-boot/pom.xml", "diffHunk": "@@ -81,7 +81,8 @@\n                 javax.transaction.xa;version=\"1.1.0\";resolution:=optional,\n                 org.objectweb.asm;version=\"$(version;=;${asm.version})\";resolution:=optional,\n                 org.osgi.framework,\n-                org.osgi.service.cm;version=\"1.2.0\",\n+                org.osgi.service.cm;version=\"1.4.0\",\n+                org.osgi.service.event;version=\"1.4.0\",", "originalCommit": "4aac7f03f1a08292c37598125427a619defbfb49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0MzIzMg==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530643232", "bodyText": "Because clearly they're not needed to function.", "author": "janbartel", "createdAt": "2020-11-25T21:08:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyODg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyOTUzMg==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530529532", "bodyText": "Shouldn't this be .versionAsInProject() instead of .version(\"3.5.0\") ?", "author": "joakime", "createdAt": "2020-11-25T17:12:42Z", "path": "jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestJettyOSGiAnnotationParser.java", "diffHunk": "@@ -64,8 +64,8 @@\n         options.add(TestOSGiUtil.optionalRemoteDebug());\n         options.add(CoreOptions.junitBundles());\n         options.addAll(TestOSGiUtil.coreJettyDependencies());\n-        options.add(mavenBundle().groupId(\"biz.aQute.bnd\").artifactId(\"bndlib\").versionAsInProject().start());\n-        options.add(mavenBundle().groupId(\"org.ops4j.pax.tinybundles\").artifactId(\"tinybundles\").version(\"2.1.1\").start());\n+        options.add(mavenBundle().groupId(\"biz.aQute.bnd\").artifactId(\"biz.aQute.bndlib\").version(\"3.5.0\").start());", "originalCommit": "4aac7f03f1a08292c37598125427a619defbfb49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0NjQyMg==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530646422", "bodyText": "Nope, see the comment in TestJettyOSGiBootWithJavaxWebSocket.java : for the tests that use tinybundles, we have to back down the version of bndlib for compatibility reasons.", "author": "janbartel", "createdAt": "2020-11-25T21:15:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyOTUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyOTcyOQ==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530529729", "bodyText": "Shouldn't this be .versionAsInProject() instead of .version(\"3.5.0\") ?", "author": "joakime", "createdAt": "2020-11-25T17:13:01Z", "path": "jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestJettyOSGiBootWithJavaxWebSocket.java", "diffHunk": "@@ -93,8 +93,9 @@\n     public static List<Option> extraDependencies()\n     {\n         List<Option> res = new ArrayList<>();\n-        res.add(mavenBundle().groupId(\"biz.aQute.bnd\").artifactId(\"bndlib\").versionAsInProject().start());\n-        res.add(mavenBundle().groupId(\"org.ops4j.pax.tinybundles\").artifactId(\"tinybundles\").version(\"2.1.1\").start());\n+        //Need an earlier version of bndlib because of tinybundles\n+        res.add(mavenBundle().groupId(\"biz.aQute.bnd\").artifactId(\"biz.aQute.bndlib\").version(\"3.5.0\").start());", "originalCommit": "4aac7f03f1a08292c37598125427a619defbfb49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0NjUwMA==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530646500", "bodyText": "Nope, see previous comment.", "author": "janbartel", "createdAt": "2020-11-25T21:16:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyOTcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyOTg5Nw==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530529897", "bodyText": "Shouldn't this be .versionAsInProject() instead of .version(\"3.5.0\") ?", "author": "joakime", "createdAt": "2020-11-25T17:13:17Z", "path": "jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestJettyOSGiClasspathResources.java", "diffHunk": "@@ -70,8 +69,9 @@\n             \"com.sun.org.apache.xpath.internal.jaxp\", \"com.sun.org.apache.xpath.internal.objects\"));\n \n         options.addAll(TestOSGiUtil.coreJettyDependencies());\n-        options.add(mavenBundle().groupId(\"biz.aQute.bnd\").artifactId(\"bndlib\").versionAsInProject().start());\n-        options.add(mavenBundle().groupId(\"org.ops4j.pax.tinybundles\").artifactId(\"tinybundles\").version(\"2.1.1\").start());\n+        //Note: we have to back down the version of bnd used here because tinybundles expects only this version\n+        options.add(mavenBundle().groupId(\"biz.aQute.bnd\").artifactId(\"biz.aQute.bndlib\").version(\"3.5.0\").start());", "originalCommit": "4aac7f03f1a08292c37598125427a619defbfb49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0Njk2Nw==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530646967", "bodyText": "Nope, the comment above is telling you why not: when using tinybundles we have to back down the version of bndlib for compatibility.", "author": "janbartel", "createdAt": "2020-11-25T21:17:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyOTg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUzMDA5OA==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530530098", "bodyText": "Do we want a property for this one too?", "author": "joakime", "createdAt": "2020-11-25T17:13:38Z", "path": "jetty-osgi/test-jetty-osgi/pom.xml", "diffHunk": "@@ -88,13 +118,19 @@\n     <dependency>\n       <groupId>org.eclipse.platform</groupId>\n       <artifactId>org.eclipse.osgi</artifactId>\n-      <version>3.16.0</version>\n+      <version>${osgi-version}</version>\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n       <groupId>org.eclipse.platform</groupId>\n       <artifactId>org.eclipse.osgi.services</artifactId>\n-      <version>3.9.0</version>\n+      <version>${osgi-services-version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.eclipse.platform</groupId>\n+      <artifactId>org.eclipse.osgi.util</artifactId>\n+      <version>3.5.300</version>", "originalCommit": "4aac7f03f1a08292c37598125427a619defbfb49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0ODkxNA==", "url": "https://github.com/eclipse/jetty.project/pull/5676#discussion_r530648914", "bodyText": "Done.", "author": "janbartel", "createdAt": "2020-11-25T21:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUzMDA5OA=="}], "type": "inlineReview"}, {"oid": "e45ab8a61b63ac0ea57babdb6e2a3a19b4cfe022", "url": "https://github.com/eclipse/jetty.project/commit/e45ab8a61b63ac0ea57babdb6e2a3a19b4cfe022", "message": "Issue #5675 Make property for osgi utils.\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-11-25T21:21:54Z", "type": "commit"}, {"oid": "21893bfb01847e502579d8f43dc8cd0f5fe32572", "url": "https://github.com/eclipse/jetty.project/commit/21893bfb01847e502579d8f43dc8cd0f5fe32572", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-5675-update-osgi-test-deps", "committedDate": "2020-11-30T13:45:27Z", "type": "commit"}, {"oid": "7ad620a462407b05a843b6a6e9ad1cfb4beafde3", "url": "https://github.com/eclipse/jetty.project/commit/7ad620a462407b05a843b6a6e9ad1cfb4beafde3", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-5675-update-osgi-test-deps", "committedDate": "2020-12-01T14:00:42Z", "type": "commit"}]}