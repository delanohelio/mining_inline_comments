{"pr_number": 5494, "pr_title": "Issue #5492 - Adding java.features.* start properties", "pr_createdAt": "2020-10-22T17:21:49Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5494", "timeline": [{"oid": "4ddd1a1a8c7ced537fdb470113e520b37a033a2c", "url": "https://github.com/eclipse/jetty.project/commit/4ddd1a1a8c7ced537fdb470113e520b37a033a2c", "message": "Issue #5492 - Adding java.features.* start properties\n\n+ Simplifying alpn start modules in the process.\n  (from 11 to 3)\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-10-22T17:20:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5NTYwNw==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r510695607", "bodyText": "As discussed, I won't add features that we don't use -- keep only java.feature.alpn.\nFor example, loom won't be available in 16 AFAIK, and other features may be available only with --enable-preview so it's not only the java version, we may need to sniff the existence of classes/methods, etc.", "author": "sbordet", "createdAt": "2020-10-23T07:43:36Z", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/StartArgs.java", "diffHunk": "@@ -1505,6 +1505,12 @@ public void setProperty(String key, String value, String source)\n             {\n                 JavaVersion ver = JavaVersion.parse(value);\n                 properties.setProperty(\"java.version.platform\", Integer.toString(ver.getPlatform()), source);\n+\n+                // features built into java.\n+                properties.setProperty(\"java.feature.alpn\", Boolean.toString(ver.getPlatform() >= 9), source);\n+                properties.setProperty(\"java.feature.jpms\", Boolean.toString(ver.getPlatform() >= 9), source);\n+                properties.setProperty(\"java.feature.loom\", Boolean.toString(ver.getPlatform() >= 16), source);", "originalCommit": "4ddd1a1a8c7ced537fdb470113e520b37a033a2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjM4MjIxNA==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r576382214", "bodyText": "Removed loom entirely.\nLeft jpms (in 9.4.x) as it has a use there. (no valid use in 10.0.x+)", "author": "joakime", "createdAt": "2021-02-15T19:10:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5NTYwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyMjA5Nw==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r512122097", "bodyText": "Does \"feature\" add much?\nHow about just \"java.alpn\" ?", "author": "gregw", "createdAt": "2020-10-26T16:59:59Z", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/StartArgs.java", "diffHunk": "@@ -1505,6 +1505,12 @@ public void setProperty(String key, String value, String source)\n             {\n                 JavaVersion ver = JavaVersion.parse(value);\n                 properties.setProperty(\"java.version.platform\", Integer.toString(ver.getPlatform()), source);\n+\n+                // features built into java.\n+                properties.setProperty(\"java.feature.alpn\", Boolean.toString(ver.getPlatform() >= 9), source);", "originalCommit": "4ddd1a1a8c7ced537fdb470113e520b37a033a2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1NTIzNQ==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r512155235", "bodyText": "If I saw java.alpn I would assume it's a alpn configuration, to tweak alpn behavior.\nA different name I'm open to.\nPerhaps we should probably make the prefix something that might not conflict in the future.\nStay away from the java. prefix?\nPerhaps jvm.feature.alpn ?\nor runtime.feature.alpn ?", "author": "joakime", "createdAt": "2020-10-26T17:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyMjA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NzI3OQ==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r512467279", "bodyText": "OK, I can live with \"feature\".    I think I have a slight preference for \"jvm.feature\" rather than \"java.feature\"", "author": "gregw", "createdAt": "2020-10-27T07:33:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyMjA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MjYyOA==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r512592628", "bodyText": "But it's not a JVM feature - like a GC or JIT is.\nIt's really a Java API feature, so I think it should remain java.feature.alpn.", "author": "sbordet", "createdAt": "2020-10-27T10:56:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyMjA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNjA3NA==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r512636074", "bodyText": "Before I change anything here, I'm going to let this conversation simmer for a few days to see what develops.  See if opinions change (or not).", "author": "joakime", "createdAt": "2020-10-27T12:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyMjA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2NjAxOQ==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r512666019", "bodyText": "I'm happy for you to leave the names as they are.", "author": "gregw", "createdAt": "2020-10-27T12:53:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyMjA5Nw=="}], "type": "inlineReview"}, {"oid": "de5b8bc84a0abd91c629d5cc9dadb977ca9992c8", "url": "https://github.com/eclipse/jetty.project/commit/de5b8bc84a0abd91c629d5cc9dadb977ca9992c8", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-5492-java-features-start-properties", "committedDate": "2021-02-15T18:59:48Z", "type": "commit"}, {"oid": "1b15c1e4a33cfe23ebcb5bae1aea34ed885389d9", "url": "https://github.com/eclipse/jetty.project/commit/1b15c1e4a33cfe23ebcb5bae1aea34ed885389d9", "message": "Issue #5492 - Changing from \"java.feature.*\" to \"runtime.feature.*\"\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2021-02-15T19:09:24Z", "type": "commit"}, {"oid": "7ed68d068133cc8ce54d68cda4f8ce8cf27f3827", "url": "https://github.com/eclipse/jetty.project/commit/7ed68d068133cc8ce54d68cda4f8ce8cf27f3827", "message": "Issue #5492 - Updating jetty-start property test expectations\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2021-02-15T20:25:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjcxMTQ5Ng==", "url": "https://github.com/eclipse/jetty.project/pull/5494#discussion_r576711496", "bodyText": "*.feature.jpms is not used, so I would remove it -- no need to leave in the code unnecessary stuff.", "author": "sbordet", "createdAt": "2021-02-16T10:24:49Z", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/StartArgs.java", "diffHunk": "@@ -1505,6 +1505,13 @@ public void setProperty(String key, String value, String source)\n             {\n                 JavaVersion ver = JavaVersion.parse(value);\n                 properties.setProperty(\"java.version.platform\", Integer.toString(ver.getPlatform()), source);\n+\n+                // features built into java.\n+                // In Jetty 10+ these will always be true, but still need to stick around for users that\n+                // want to move between Jetty 9.4.x and 10.0.x+\n+                properties.setProperty(\"runtime.feature.alpn\", Boolean.toString(isMethodAvailable(javax.net.ssl.SSLParameters.class, \"getApplicationProtocols\", null)), source);\n+                properties.setProperty(\"runtime.feature.jpms\", Boolean.toString(isClassAvailable(\"java.lang.ModuleLayer\")), source);", "originalCommit": "7ed68d068133cc8ce54d68cda4f8ce8cf27f3827", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2aa1a68079be674a8f1b77945c70b0d5728ccaca", "url": "https://github.com/eclipse/jetty.project/commit/2aa1a68079be674a8f1b77945c70b0d5728ccaca", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-5492-java-features-start-properties", "committedDate": "2021-02-18T16:55:34Z", "type": "commit"}, {"oid": "f2bed1368bfea82ad48311e74c027c4c20b122a6", "url": "https://github.com/eclipse/jetty.project/commit/f2bed1368bfea82ad48311e74c027c4c20b122a6", "message": "Issue #5492 - changed from review\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2021-02-18T17:14:54Z", "type": "commit"}]}