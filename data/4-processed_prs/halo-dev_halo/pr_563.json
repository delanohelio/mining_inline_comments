{"pr_number": 563, "pr_title": "Feature/custom url", "pr_createdAt": "2020-02-11T04:24:52Z", "pr_url": "https://github.com/halo-dev/halo/pull/563", "timeline": [{"oid": "58f365dddbd85de8f53724d06388e23d2a12fa02", "url": "https://github.com/halo-dev/halo/commit/58f365dddbd85de8f53724d06388e23d2a12fa02", "message": "feat: build full path for category and tag.", "committedDate": "2020-02-10T17:29:07Z", "type": "commit"}, {"oid": "df3a4d6348eb6751c1c198b0f9f430c39bd1f0a3", "url": "https://github.com/halo-dev/halo/commit/df3a4d6348eb6751c1c198b0f9f430c39bd1f0a3", "message": "feat: build full path for post.", "committedDate": "2020-02-10T18:00:03Z", "type": "commit"}, {"oid": "f1a430cc2e50cc6477e8b447b81c3e512ecb03e2", "url": "https://github.com/halo-dev/halo/commit/f1a430cc2e50cc6477e8b447b81c3e512ecb03e2", "message": "feat: build full path for sheet.", "committedDate": "2020-02-10T18:09:57Z", "type": "commit"}, {"oid": "a4da89205c563a19b896e06eb83e179682fcaa35", "url": "https://github.com/halo-dev/halo/commit/a4da89205c563a19b896e06eb83e179682fcaa35", "message": "feat: build full path for post.", "committedDate": "2020-02-11T04:18:05Z", "type": "commit"}, {"oid": "a9b9e0a1c33c6c889fe317c3fbbb7bab9b42915c", "url": "https://github.com/halo-dev/halo/commit/a9b9e0a1c33c6c889fe317c3fbbb7bab9b42915c", "message": "feat: change post url for rss sitemap pages.", "committedDate": "2020-02-11T04:50:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0Mjg3OA==", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r377442878", "bodyText": "\u8fd9\u4e2a\u62fc\u63a5\u7684\u90e8\u5206\u548ctag\u903b\u8f91\u5dee\u4e0d\u591a\u662f\u4e0d\u662f\u8003\u8651\u62bd\u53d6\u4e00\u4e0b", "author": "guqing", "createdAt": "2020-02-11T04:34:25Z", "path": "src/main/java/run/halo/app/service/impl/CategoryServiceImpl.java", "diffHunk": "@@ -188,7 +193,23 @@ public void removeCategoryAndPostCategoryBy(Integer categoryId) {\n     public CategoryDTO convertTo(Category category) {\n         Assert.notNull(category, \"Category must not be null\");\n \n-        return new CategoryDTO().convertFrom(category);\n+        CategoryDTO categoryDTO = new CategoryDTO().convertFrom(category);\n+\n+        StringBuilder fullPath = new StringBuilder();", "originalCommit": "a4da89205c563a19b896e06eb83e179682fcaa35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ2NTI4MA==", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r377465280", "bodyText": "\u597d", "author": "ruibaby", "createdAt": "2020-02-11T06:46:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0Mjg3OA=="}], "type": "inlineReview"}, {"oid": "9f0c7df0ee3a471f08bd0b560b35262ce1da936c", "url": "https://github.com/halo-dev/halo/commit/9f0c7df0ee3a471f08bd0b560b35262ce1da936c", "message": "feat: support set links/photos/journal page prefix.", "committedDate": "2020-02-11T05:53:04Z", "type": "commit"}, {"oid": "70ae56e5dcf1dd1b20fef58241d79ed33cd1c471", "url": "https://github.com/halo-dev/halo/commit/70ae56e5dcf1dd1b20fef58241d79ed33cd1c471", "message": "feat: support set internal sheet's title.", "committedDate": "2020-02-11T06:43:32Z", "type": "commit"}, {"oid": "d5c180ca33e8d1ccf2bbd450316f463e02273e61", "url": "https://github.com/halo-dev/halo/commit/d5c180ca33e8d1ccf2bbd450316f463e02273e61", "message": "refactor: build full path method.", "committedDate": "2020-02-11T07:04:21Z", "type": "commit"}, {"oid": "a2f33d58268bde595b9bf3e7a0bd601c6dddda13", "url": "https://github.com/halo-dev/halo/commit/a2f33d58268bde595b9bf3e7a0bd601c6dddda13", "message": "refactor: archives post full path.", "committedDate": "2020-02-11T12:48:31Z", "type": "commit"}, {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620", "url": "https://github.com/halo-dev/halo/commit/65dd741ede1c73d8eeeca2bb5adcb332a58fa620", "message": "feat: support nextPageFullPath and prePageFullPath variable in pageable pages.", "committedDate": "2020-02-14T06:05:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2NTcyOQ==", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r379265729", "bodyText": "\u8fd9\u4e48\u591a if  else\uff0c\u5f97\u8003\u8651\u4f18\u5316\u4e00\u4e0b\u4e86\u3002", "author": "JohnNiang", "createdAt": "2020-02-14T06:15:47Z", "path": "src/main/java/run/halo/app/controller/content/ContentContentController.java", "diffHunk": "@@ -37,41 +34,56 @@\n \n     private final TagModel tagModel;\n \n+    private final JournalModel journalModel;\n+\n+    private final PhotoModel photoModel;\n+\n     private final OptionService optionService;\n \n     private final PostService postService;\n \n     private final SheetService sheetService;\n \n+    private final ThemeService themeService;\n+\n     public ContentContentController(PostModel postModel,\n                                     SheetModel sheetModel,\n                                     CategoryModel categoryModel,\n                                     TagModel tagModel,\n+                                    JournalModel journalModel,\n+                                    PhotoModel photoModel,\n                                     OptionService optionService,\n                                     PostService postService,\n-                                    SheetService sheetService) {\n+                                    SheetService sheetService,\n+                                    ThemeService themeService) {\n         this.postModel = postModel;\n         this.sheetModel = sheetModel;\n         this.categoryModel = categoryModel;\n         this.tagModel = tagModel;\n+        this.journalModel = journalModel;\n+        this.photoModel = photoModel;\n         this.optionService = optionService;\n         this.postService = postService;\n         this.sheetService = sheetService;\n+        this.themeService = themeService;\n     }\n \n     @GetMapping(\"{prefix}\")\n     public String content(@PathVariable(\"prefix\") String prefix,\n                           Model model) {\n-        String archivesPrefix = optionService.getByPropertyOrDefault(PermalinkProperties.ARCHIVES_PREFIX, String.class, PermalinkProperties.ARCHIVES_PREFIX.defaultValue());\n-        String categoriesPrefix = optionService.getByPropertyOrDefault(PermalinkProperties.CATEGORIES_PREFIX, String.class, PermalinkProperties.CATEGORIES_PREFIX.defaultValue());\n-        String tagsPrefix = optionService.getByPropertyOrDefault(PermalinkProperties.TAGS_PREFIX, String.class, PermalinkProperties.TAGS_PREFIX.defaultValue());\n-\n-        if (archivesPrefix.equals(prefix)) {\n+        if (optionService.getArchivesPrefix().equals(prefix)) {", "originalCommit": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI3MDczMA==", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r379270730", "bodyText": "\u4f1a\u7684", "author": "ruibaby", "createdAt": "2020-02-14T06:38:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2NTcyOQ=="}], "type": "inlineReview"}, {"oid": "98a0592e7c28851dc1a8bbed1e7f3ccdfe7c824c", "url": "https://github.com/halo-dev/halo/commit/98a0592e7c28851dc1a8bbed1e7f3ccdfe7c824c", "message": "Update CommentEventListener.java", "committedDate": "2020-02-14T06:48:20Z", "type": "commit"}, {"oid": "470c96474ec81fc95ad319ffdfd0d9ce2a5bd5b7", "url": "https://github.com/halo-dev/halo/commit/470c96474ec81fc95ad319ffdfd0d9ce2a5bd5b7", "message": "feat: make rss formats more standard.", "committedDate": "2020-02-15T09:10:11Z", "type": "commit"}, {"oid": "7e8593c2f78fb60c1928751723393cb0ad5871d8", "url": "https://github.com/halo-dev/halo/commit/7e8593c2f78fb60c1928751723393cb0ad5871d8", "message": "feat: add some useful freemarker variable.", "committedDate": "2020-02-15T16:17:01Z", "type": "commit"}, {"oid": "fc1e9f63f5efdd448452aaeb904ebaadfb1263cc", "url": "https://github.com/halo-dev/halo/commit/fc1e9f63f5efdd448452aaeb904ebaadfb1263cc", "message": "feat: add some useful freemarker variable.", "committedDate": "2020-02-16T05:01:02Z", "type": "commit"}, {"oid": "ea17f22d38f801901fbc676a58debd502d2b80f2", "url": "https://github.com/halo-dev/halo/commit/ea17f22d38f801901fbc676a58debd502d2b80f2", "message": "feat: add some useful freemarker variable.", "committedDate": "2020-02-16T05:04:46Z", "type": "commit"}, {"oid": "7f0cd86b97122e37d54f2a9a66561537a23c1984", "url": "https://github.com/halo-dev/halo/commit/7f0cd86b97122e37d54f2a9a66561537a23c1984", "message": "refactor: preview post and password post.", "committedDate": "2020-02-16T06:38:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg4Mjc1Mw==", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r379882753", "bodyText": "\u8fd9\u91cc\u53ef\u4ee5\u8003\u8651\u7528 OneTimeTokenService \u6765\u4ee3\u66ff\u3002", "author": "JohnNiang", "createdAt": "2020-02-16T07:52:12Z", "path": "src/main/java/run/halo/app/controller/content/ContentContentController.java", "diffHunk": "@@ -170,4 +181,38 @@ public String content(@PathVariable(\"year\") Integer year,\n             throw new NotFoundException(\"Not Found\");\n         }\n     }\n+\n+    @PostMapping(value = \"archives/{url:.*}/password\")\n+    @CacheLock(traceRequest = true, expired = 2)\n+    public String password(@PathVariable(\"url\") String url,\n+                           @RequestParam(value = \"password\") String password) throws UnsupportedEncodingException {\n+        Post post = postService.getBy(PostStatus.INTIMATE, url);\n+\n+        post.setUrl(URLEncoder.encode(post.getUrl(), StandardCharsets.UTF_8.name()));\n+\n+        BasePostMinimalDTO postMinimalDTO = postService.convertToMinimal(post);\n+\n+        StringBuilder redirectUrl = new StringBuilder();\n+\n+        if (!optionService.isEnabledAbsolutePath()) {\n+            redirectUrl.append(optionService.getBlogBaseUrl());\n+        }\n+\n+        redirectUrl.append(postMinimalDTO.getFullPath());\n+\n+        if (password.equals(post.getPassword())) {\n+            String token = IdUtil.simpleUUID();\n+            cacheStore.putAny(token, token, 10, TimeUnit.SECONDS);", "originalCommit": "7f0cd86b97122e37d54f2a9a66561537a23c1984", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a745011b5f9e4a809fd08a1ef2a483577002c914", "url": "https://github.com/halo-dev/halo/commit/a745011b5f9e4a809fd08a1ef2a483577002c914", "message": "Merge branch 'master' into feature/custom-url", "committedDate": "2020-02-24T15:41:04Z", "type": "commit"}]}