{"pr_number": 1382, "pr_title": "[Minor test fix] Enabled and fixed a TestKafkaCheckpointManager test", "pr_createdAt": "2020-06-12T16:57:55Z", "pr_url": "https://github.com/apache/samza/pull/1382", "timeline": [{"oid": "784c422ad207da746fb6c37d3abe589bedc06f0f", "url": "https://github.com/apache/samza/commit/784c422ad207da746fb6c37d3abe589bedc06f0f", "message": "[Minor test fix] Enabled and fixed a TestKafkaCheckpointManager test", "committedDate": "2020-06-12T16:52:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1MDY0OA==", "url": "https://github.com/apache/samza/pull/1382#discussion_r439650648", "bodyText": "Do you know why we need to spy the class under test here rather than mock the underlying objects used by the method that is stubbed?", "author": "bkonold", "createdAt": "2020-06-12T21:31:41Z", "path": "samza-kafka/src/test/scala/org/apache/samza/checkpoint/kafka/TestKafkaCheckpointManager.scala", "diffHunk": "@@ -82,7 +83,6 @@ class TestKafkaCheckpointManager extends KafkaServerTestHarness {\n     val spec = new KafkaStreamSpec(\"id\", checkpointTopic, checkpointSystemName, 1, 1, props)\n     val checkPointManager = Mockito.spy(new KafkaCheckpointManager(spec, new MockSystemFactory, false, config, new NoOpMetricsRegistry))", "originalCommit": "784c422ad207da746fb6c37d3abe589bedc06f0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1NzY0Ng==", "url": "https://github.com/apache/samza/pull/1382#discussion_r439657646", "bodyText": "It's not necessary to use the spy, but this test seems to be using some \"real\" method implementations for some underlying objects, so I guess it is a little awkward to mix in mocking too. I'm not a fan of how this unit test class was written overall (e.g. I think it uses an embedded Kafka/Zk just to run a unit test), but I also didn't have time to refactor everything, so I went with the easiest fix.", "author": "cameronlee314", "createdAt": "2020-06-12T21:54:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1OTczOA==", "url": "https://github.com/apache/samza/pull/1382#discussion_r439659738", "bodyText": "Fair enough. Better than the test being disabled.\nI'd be more worried if all invocations of KafkaCheckpointManager.getSystemProducer were stubbed using the spy, but it looks to be specifically targeting the second invocation (the first is during construction), so the test is at least not completely masking away the contract with SystemFactory.\nYou can ignore this comment.", "author": "bkonold", "createdAt": "2020-06-12T22:02:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1MDY0OA=="}], "type": "inlineReview"}]}