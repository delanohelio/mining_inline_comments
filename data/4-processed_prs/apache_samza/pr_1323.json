{"pr_number": 1323, "pr_title": "Add docs for configs of Azure Blob SystemProducer ", "pr_createdAt": "2020-03-20T19:30:17Z", "pr_url": "https://github.com/apache/samza/pull/1323", "timeline": [{"oid": "ae0dd3faf2cf32eecafb04358241b95f92092777", "url": "https://github.com/apache/samza/commit/ae0dd3faf2cf32eecafb04358241b95f92092777", "message": "Add docs for Azure Blob SystemProducer", "committedDate": "2020-03-20T19:28:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgyODc0Nw==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396828747", "bodyText": "Minor: The **__system-name__** part looks a little inconsistent with the other sections (which use systems.*.samza.factory).", "author": "cameronlee314", "createdAt": "2020-03-23T23:56:58Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYwMDY5MQ==", "url": "https://github.com/apache/samza/pull/1323#discussion_r397600691", "bodyText": "I did it on purpose to be able to highlight that system-name is the Azure container name. Seemed simpler to do this.", "author": "lakshmi-manasa-g", "createdAt": "2020-03-25T04:15:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgyODc0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgyOTM1NA==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396829354", "bodyText": "Minor: It looks like other parts of this documentation use false instead of \"false\".", "author": "cameronlee314", "createdAt": "2020-03-23T23:59:00Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>\n+**_system-name_** is the Azure container name you want to produce blobs to. If such a container does not exist then it is created.<br> \n+\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|sensitive.systems.**_system-name_**.azureblob.account.name| |__Required:__ The Azure account name to which the Azure container belongs to. |\n+|sensitive.systems.**_system-name_**.azureblob.account.key| |__Required:__ Key for the Azure account specified above.|\n+\n+#### <a name=\"advanced-azure-blob-storage\"></a>[Advanced Azure Blob Storage Configurations](#advanced-azure-blob-storage)\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|systems.**_system-name_**.azureblob.proxy.use |\"false\"|if true, proxy will be used to connect to Azure.|", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMDAxMw==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396830013", "bodyText": "Minor: For consistency, maybe put the actual milliseconds number. You can put 30s in parentheses or as a note in the Description part.", "author": "cameronlee314", "createdAt": "2020-03-24T00:01:21Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>\n+**_system-name_** is the Azure container name you want to produce blobs to. If such a container does not exist then it is created.<br> \n+\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|sensitive.systems.**_system-name_**.azureblob.account.name| |__Required:__ The Azure account name to which the Azure container belongs to. |\n+|sensitive.systems.**_system-name_**.azureblob.account.key| |__Required:__ Key for the Azure account specified above.|\n+\n+#### <a name=\"advanced-azure-blob-storage\"></a>[Advanced Azure Blob Storage Configurations](#advanced-azure-blob-storage)\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|systems.**_system-name_**.azureblob.proxy.use |\"false\"|if true, proxy will be used to connect to Azure.|\n+|systems.**_system-name_**.azureblob.proxy.hostname| |if proxy.use is true then host name of proxy.|\n+|systems.**_system-name_**.azureblob.proxy.port| |if proxy.use is true then port of proxy.|\n+|samza.azureblob.log.slowRequestMs|30 secs|The duration after which an Azure request will be logged as a warning.|", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMDgyNg==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396830826", "bodyText": "Minor: extra space before 4.75TB", "author": "cameronlee314", "createdAt": "2020-03-24T00:04:26Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>\n+**_system-name_** is the Azure container name you want to produce blobs to. If such a container does not exist then it is created.<br> \n+\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|sensitive.systems.**_system-name_**.azureblob.account.name| |__Required:__ The Azure account name to which the Azure container belongs to. |\n+|sensitive.systems.**_system-name_**.azureblob.account.key| |__Required:__ Key for the Azure account specified above.|\n+\n+#### <a name=\"advanced-azure-blob-storage\"></a>[Advanced Azure Blob Storage Configurations](#advanced-azure-blob-storage)\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|systems.**_system-name_**.azureblob.proxy.use |\"false\"|if true, proxy will be used to connect to Azure.|\n+|systems.**_system-name_**.azureblob.proxy.hostname| |if proxy.use is true then host name of proxy.|\n+|systems.**_system-name_**.azureblob.proxy.port| |if proxy.use is true then port of proxy.|\n+|samza.azureblob.log.slowRequestMs|30 secs|The duration after which an Azure request will be logged as a warning.|\n+|systems.**_system-name_**.azureblob.writer.factory.class|`org.apache.samza.system.`<br>`azureblob.avro.`<br>`AzureBlobAvroWriterFactory`|Fully qualified class name of the `org.apache.samza.system.azureblob.producer.AzureBlobWriter` impl for the system producer.<br><br>The default writer creates blobs that are of type AVRO and require the messages sent to a blob to be AVRO records. The blobs created by the default writer are of type [Block Blobs](https://docs.microsoft.com/en-us/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs).<br>All the following configs are relevant to this default writer.|\n+|systems.**_system-name_**.azureblob.compression.type|\"none\"|type of compression to be used before uploading blocks. Can be \"none\" or \"gzip\".|\n+|systems.**_system-name_**.azureblob.maxFlushThresholdSize|10485760 (10 MB)|max size of the uncompressed block to be uploaded in bytes. Maximum size allowed by Azure is 100MB.|\n+|systems.**_system-name_**.azureblob.maxBlobSize|Long.MAX_VALUE (unlimited)|max size of the uncompressed blob in bytes.<br>If default value then size is unlimited capped only by Azure BlockBlob size of  4.75 TB (100 MB per block X 50,000 blocks).|", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMTA3Ng==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396831076", "bodyText": "Minor: same as above regarding using the actual milliseconds value", "author": "cameronlee314", "createdAt": "2020-03-24T00:05:25Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>\n+**_system-name_** is the Azure container name you want to produce blobs to. If such a container does not exist then it is created.<br> \n+\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|sensitive.systems.**_system-name_**.azureblob.account.name| |__Required:__ The Azure account name to which the Azure container belongs to. |\n+|sensitive.systems.**_system-name_**.azureblob.account.key| |__Required:__ Key for the Azure account specified above.|\n+\n+#### <a name=\"advanced-azure-blob-storage\"></a>[Advanced Azure Blob Storage Configurations](#advanced-azure-blob-storage)\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|systems.**_system-name_**.azureblob.proxy.use |\"false\"|if true, proxy will be used to connect to Azure.|\n+|systems.**_system-name_**.azureblob.proxy.hostname| |if proxy.use is true then host name of proxy.|\n+|systems.**_system-name_**.azureblob.proxy.port| |if proxy.use is true then port of proxy.|\n+|samza.azureblob.log.slowRequestMs|30 secs|The duration after which an Azure request will be logged as a warning.|\n+|systems.**_system-name_**.azureblob.writer.factory.class|`org.apache.samza.system.`<br>`azureblob.avro.`<br>`AzureBlobAvroWriterFactory`|Fully qualified class name of the `org.apache.samza.system.azureblob.producer.AzureBlobWriter` impl for the system producer.<br><br>The default writer creates blobs that are of type AVRO and require the messages sent to a blob to be AVRO records. The blobs created by the default writer are of type [Block Blobs](https://docs.microsoft.com/en-us/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs).<br>All the following configs are relevant to this default writer.|\n+|systems.**_system-name_**.azureblob.compression.type|\"none\"|type of compression to be used before uploading blocks. Can be \"none\" or \"gzip\".|\n+|systems.**_system-name_**.azureblob.maxFlushThresholdSize|10485760 (10 MB)|max size of the uncompressed block to be uploaded in bytes. Maximum size allowed by Azure is 100MB.|\n+|systems.**_system-name_**.azureblob.maxBlobSize|Long.MAX_VALUE (unlimited)|max size of the uncompressed blob in bytes.<br>If default value then size is unlimited capped only by Azure BlockBlob size of  4.75 TB (100 MB per block X 50,000 blocks).|\n+|systems.**_system-name_**.azureblob.maxMessagesPerBlob|Long.MAX_VALUE (unlimited)|max number of messages per blob.|\n+|systems.**_system-name_**.azureblob.threadPoolCount|2|number of threads for the asynchronous uploading of blocks.|\n+|systems.**_system-name_**.azureblob.blockingQueueSize|Thread Pool Count * 2|size of the queue to hold blocks ready to be uploaded by asynchronous threads.<br>If all threads are busy uploading then blocks are queued and if queue is full then main thread will start uploading which will block processing of incoming messages.|\n+|systems.**_system-name_**.azureblob.flushTimeoutMs|3 mins|timeout to finish uploading all blocks before committing a blob.|\n+|systems.**_system-name_**.azureblob.closeTimeoutMs|5 mins|timeout to finish committing all the blobs currently being written to. This does not include the flush timeout per blob.|", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMjYxMA==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396832610", "bodyText": "Can you please clarify the description? I think the usage of the term \"duration\" might be overloaded. Do you mean that if the Azure request takes 30s to complete, then it will be logged?", "author": "cameronlee314", "createdAt": "2020-03-24T00:10:30Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>\n+**_system-name_** is the Azure container name you want to produce blobs to. If such a container does not exist then it is created.<br> \n+\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|sensitive.systems.**_system-name_**.azureblob.account.name| |__Required:__ The Azure account name to which the Azure container belongs to. |\n+|sensitive.systems.**_system-name_**.azureblob.account.key| |__Required:__ Key for the Azure account specified above.|\n+\n+#### <a name=\"advanced-azure-blob-storage\"></a>[Advanced Azure Blob Storage Configurations](#advanced-azure-blob-storage)\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|systems.**_system-name_**.azureblob.proxy.use |\"false\"|if true, proxy will be used to connect to Azure.|\n+|systems.**_system-name_**.azureblob.proxy.hostname| |if proxy.use is true then host name of proxy.|\n+|systems.**_system-name_**.azureblob.proxy.port| |if proxy.use is true then port of proxy.|\n+|samza.azureblob.log.slowRequestMs|30 secs|The duration after which an Azure request will be logged as a warning.|", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYwMTc3MA==", "url": "https://github.com/apache/samza/pull/1323#discussion_r397601770", "bodyText": "Actually, i just realized that this is an old azure config (before Azure v12). Hence removing it completely.", "author": "lakshmi-manasa-g", "createdAt": "2020-03-25T04:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMjYxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMzgxNA==", "url": "https://github.com/apache/samza/pull/1323#discussion_r396833814", "bodyText": "Regarding \"All the following configs are relevant to this default writer.\": The following configs apply to other writers too, right? The wording kind of makes it sound like the following configs won't apply to a non-default writer. Can you please clarify that a little bit (or maybe you can just remove that sentence)?", "author": "cameronlee314", "createdAt": "2020-03-24T00:14:45Z", "path": "docs/learn/documentation/versioned/jobs/samza-configurations.md", "diffHunk": "@@ -245,6 +246,34 @@ Configs for producing to [ElasticSearch](https://www.elastic.co/products/elastic\n |systems.**_system-name_**.<br>bulk.flush.max.size.mb|5|The maximum aggregate size of messages in the buffered before flushing.|\n |systems.**_system-name_**.<br>bulk.flush.interval.ms|never|How often buffered messages should be flushed.|\n \n+#### <a name=\"azure-blob-storage\"></a>[3.7 Azure Blob Storage](#azure-blob-storage)\n+Configs for producing to [Azure Blob Storage](https://azure.microsoft.com/en-us/services/storage/blobs/). This section applies if you have set systems.**__system-name__**.samza.factory = `org.apache.samza.system.azureblob.AzureBlobSystemFactory`.<br>\n+**_system-name_** is the Azure container name you want to produce blobs to. If such a container does not exist then it is created.<br> \n+\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|sensitive.systems.**_system-name_**.azureblob.account.name| |__Required:__ The Azure account name to which the Azure container belongs to. |\n+|sensitive.systems.**_system-name_**.azureblob.account.key| |__Required:__ Key for the Azure account specified above.|\n+\n+#### <a name=\"advanced-azure-blob-storage\"></a>[Advanced Azure Blob Storage Configurations](#advanced-azure-blob-storage)\n+|Name|Default|Description|\n+|--- |--- |--- |\n+|systems.**_system-name_**.azureblob.proxy.use |\"false\"|if true, proxy will be used to connect to Azure.|\n+|systems.**_system-name_**.azureblob.proxy.hostname| |if proxy.use is true then host name of proxy.|\n+|systems.**_system-name_**.azureblob.proxy.port| |if proxy.use is true then port of proxy.|\n+|samza.azureblob.log.slowRequestMs|30 secs|The duration after which an Azure request will be logged as a warning.|\n+|systems.**_system-name_**.azureblob.writer.factory.class|`org.apache.samza.system.`<br>`azureblob.avro.`<br>`AzureBlobAvroWriterFactory`|Fully qualified class name of the `org.apache.samza.system.azureblob.producer.AzureBlobWriter` impl for the system producer.<br><br>The default writer creates blobs that are of type AVRO and require the messages sent to a blob to be AVRO records. The blobs created by the default writer are of type [Block Blobs](https://docs.microsoft.com/en-us/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs).<br>All the following configs are relevant to this default writer.|", "originalCommit": "ae0dd3faf2cf32eecafb04358241b95f92092777", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYwMjkwOA==", "url": "https://github.com/apache/samza/pull/1323#discussion_r397602908", "bodyText": "yes, you are right. if a new non-default writer were to wired it, some of these would apply to it but not all - for example, the new writer might choose to create append blobs and not block blobs in which case flush threshold size and flush timeout and maybe even thread pool count dont make sense as these are all for uploading blocks of a blob. But understand your concern and removing that sentence.", "author": "lakshmi-manasa-g", "createdAt": "2020-03-25T04:25:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgzMzgxNA=="}], "type": "inlineReview"}, {"oid": "7df38edef0620e974e5cfac34a6f1d560a63b7c4", "url": "https://github.com/apache/samza/commit/7df38edef0620e974e5cfac34a6f1d560a63b7c4", "message": "address comments", "committedDate": "2020-03-25T04:29:09Z", "type": "commit"}]}