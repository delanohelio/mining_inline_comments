{"pr_number": 1290, "pr_title": "SAMZA-2468: Make Standby containers respond to shutdown request", "pr_createdAt": "2020-02-25T18:11:22Z", "pr_url": "https://github.com/apache/samza/pull/1290", "timeline": [{"oid": "0f6bf26fbf3cfb4cb12a6efa1a995e9c273d7cc4", "url": "https://github.com/apache/samza/commit/0f6bf26fbf3cfb4cb12a6efa1a995e9c273d7cc4", "message": "Make Standby containers to respond to shutdown request", "committedDate": "2020-02-25T17:52:53Z", "type": "commit"}, {"oid": "619318bf61e902b4e57f0b99dc630e3d0d7696cf", "url": "https://github.com/apache/samza/commit/619318bf61e902b4e57f0b99dc630e3d0d7696cf", "message": "Adressing feedback", "committedDate": "2020-02-25T18:31:48Z", "type": "commit"}, {"oid": "619318bf61e902b4e57f0b99dc630e3d0d7696cf", "url": "https://github.com/apache/samza/commit/619318bf61e902b4e57f0b99dc630e3d0d7696cf", "message": "Adressing feedback", "committedDate": "2020-02-25T18:31:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTU2MA==", "url": "https://github.com/apache/samza/pull/1290#discussion_r384069560", "bodyText": "please add a unit test :)", "author": "mynameborat", "createdAt": "2020-02-25T19:14:23Z", "path": "samza-core/src/main/scala/org/apache/samza/container/SamzaContainer.scala", "diffHunk": "@@ -865,6 +868,11 @@ class SamzaContainer(\n       return\n     }\n \n+    /**\n+      * Countdown the standbyContainerShutdownLatch so standby container can invoke a shutdown sequence\n+      */\n+    standbyContainerShutdownLatch.countDown();", "originalCommit": "619318bf61e902b4e57f0b99dc630e3d0d7696cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA5NTkyMQ==", "url": "https://github.com/apache/samza/pull/1290#discussion_r384095921", "bodyText": "sure", "author": "Sanil15", "createdAt": "2020-02-25T20:03:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTU2MA=="}], "type": "inlineReview"}, {"oid": "5c612eb2cc30e11963a9832a3b611dc4af86b40c", "url": "https://github.com/apache/samza/commit/5c612eb2cc30e11963a9832a3b611dc4af86b40c", "message": "Adding unit test", "committedDate": "2020-02-25T20:01:32Z", "type": "commit"}, {"oid": "b5831bbc1768c84be72036c778154edd5e0f31aa", "url": "https://github.com/apache/samza/commit/b5831bbc1768c84be72036c778154edd5e0f31aa", "message": "Nit pick improve", "committedDate": "2020-02-25T20:10:02Z", "type": "commit"}, {"oid": "b5831bbc1768c84be72036c778154edd5e0f31aa", "url": "https://github.com/apache/samza/commit/b5831bbc1768c84be72036c778154edd5e0f31aa", "message": "Nit pick improve", "committedDate": "2020-02-25T20:10:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3Nzg3MA==", "url": "https://github.com/apache/samza/pull/1290#discussion_r384177870", "bodyText": "Can we do without the sleep in the test ?  Also, we should verify that the countdown() was actually called.\nI think it should be possible to test the behavior by making the latch visible for testing ?", "author": "abhishekshivanna", "createdAt": "2020-02-25T22:57:39Z", "path": "samza-core/src/test/scala/org/apache/samza/container/TestSamzaContainer.scala", "diffHunk": "@@ -126,6 +126,45 @@ class TestSamzaContainer extends AssertionsForJUnit with MockitoSugar {\n     verify(this.runLoop).run()\n   }\n \n+\n+  @Test\n+  def testShutDownSequenceForStandbyContainers() {\n+    class ShutDownSignal(container: SamzaContainer) extends Runnable {\n+      def run(): Unit = {\n+        Thread.sleep(2000)", "originalCommit": "b5831bbc1768c84be72036c778154edd5e0f31aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3OTI3Nw==", "url": "https://github.com/apache/samza/pull/1290#discussion_r384179277", "bodyText": "runLoop.run is blocking call so cannot do this without sleep\n\nAlso, we should verify that the countdown() was actually called\n\nwell the verification is done on the shutdown methods which only gets called once that latch is counted down if the latch was not all these shutdown methods won't be invoked, hence I do not feel exposing this latch outside and verifying on it is necessary", "author": "Sanil15", "createdAt": "2020-02-25T23:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3Nzg3MA=="}], "type": "inlineReview"}, {"oid": "ba75f0eac2fbd7e5be4b98decf9377a310e2bae9", "url": "https://github.com/apache/samza/commit/ba75f0eac2fbd7e5be4b98decf9377a310e2bae9", "message": "Empty Commit to trigger build", "committedDate": "2020-02-26T00:00:12Z", "type": "commit"}, {"oid": "54912273361783b01ef8fdc2c932248b1bf20b6b", "url": "https://github.com/apache/samza/commit/54912273361783b01ef8fdc2c932248b1bf20b6b", "message": "Empty Commit to trigger build", "committedDate": "2020-02-26T00:00:22Z", "type": "commit"}]}