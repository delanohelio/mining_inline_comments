{"pr_number": 1246, "pr_title": "SAMZA-2409: Update YarnJob to construct job submission env varible", "pr_createdAt": "2020-01-10T02:03:37Z", "pr_url": "https://github.com/apache/samza/pull/1246", "timeline": [{"oid": "5889452fe2809fac1b7b0e27dcb0e7d140b2dc02", "url": "https://github.com/apache/samza/commit/5889452fe2809fac1b7b0e27dcb0e7d140b2dc02", "message": "SAMZA-2409: Update YarnJob to construct job submission env varible\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Depending the on the existence of job.config.loader.factory, YarnJob will alternatively wraps job submission configs to Yarn.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nTests:\nUnit Tests", "committedDate": "2020-01-10T01:57:42Z", "type": "commit"}, {"oid": "8229a053986d9de12c026e519f390f13fb79d037", "url": "https://github.com/apache/samza/commit/8229a053986d9de12c026e519f390f13fb79d037", "message": "SAMZA-2409: Update YarnJob to construct job submission env varible\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Depending the on the existence of job.config.loader.factory, YarnJob will alternatively wraps job submission configs to Yarn.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nTests:\nUnit Tests", "committedDate": "2020-01-10T01:59:41Z", "type": "commit"}, {"oid": "6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3", "url": "https://github.com/apache/samza/commit/6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3", "message": "Merge branch 'SAMZA-2409' of https://github.com/kw2542/samza into SAMZA-2409", "committedDate": "2020-01-10T02:01:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMDUxNw==", "url": "https://github.com/apache/samza/pull/1246#discussion_r366100517", "bodyText": "Is \"config\" here intended to be only the subset of configs required for submissions (the subset you outlined in SEP-23)?\nI may be misunderstanding the flow somewhere, but won't ApplicationRunnerMain end up loading the full (pre-planning) config from the properties file which will end up getting passed through to here?", "author": "bkonold", "createdAt": "2020-01-14T00:31:16Z", "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/YarnJob.scala", "diffHunk": "@@ -173,10 +173,16 @@ object YarnJob extends Logging {\n   @VisibleForTesting\n   private[yarn] def buildEnvironment(config: Config, yarnConfig: YarnConfig,\n     jobConfig: JobConfig): Map[String, String] = {\n-    val coordinatorSystemConfig = CoordinatorStreamUtil.buildCoordinatorStreamConfig(config)\n     val envMapBuilder = Map.newBuilder[String, String]\n-    envMapBuilder += ShellCommandConfig.ENV_COORDINATOR_SYSTEM_CONFIG ->\n-      Util.envVarEscape(SamzaObjectMapper.getObjectMapper.writeValueAsString(coordinatorSystemConfig))\n+    if (jobConfig.getConfigLoaderFactory.isPresent) {\n+      envMapBuilder += ShellCommandConfig.ENV_SUBMISSION_CONFIG ->\n+        Util.envVarEscape(SamzaObjectMapper.getObjectMapper.writeValueAsString(config))", "originalCommit": "6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMjQwMQ==", "url": "https://github.com/apache/samza/pull/1246#discussion_r366102401", "bodyText": "Very good question, in the final approved SEP-23, we will not read any properties/config file during submission anymore. All submission related configs will be provided explicitly using --config.\nApplicationRunnerMain will be updated in a separate PR to reflect this change as well. Full job config will only be read on AM, and then apply the overridden values we get from ApplicationRunnerMain will be passed to AM to override the value we load.", "author": "kw2542", "createdAt": "2020-01-14T00:39:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMDUxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMjA3MA==", "url": "https://github.com/apache/samza/pull/1246#discussion_r366112070", "bodyText": "Sounds good. Thanks for clarifying.", "author": "bkonold", "createdAt": "2020-01-14T01:20:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMDUxNw=="}], "type": "inlineReview"}, {"oid": "99a667638703f68889b097ad8ad637f14137ceeb", "url": "https://github.com/apache/samza/commit/99a667638703f68889b097ad8ad637f14137ceeb", "message": "Add clean up ticket", "committedDate": "2020-01-14T20:32:21Z", "type": "commit"}]}