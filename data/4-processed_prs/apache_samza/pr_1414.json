{"pr_number": 1414, "pr_title": "SAMZA-2579: Force restart feature for Container Placements", "pr_createdAt": "2020-08-13T01:31:07Z", "pr_url": "https://github.com/apache/samza/pull/1414", "timeline": [{"oid": "3ae626a626a5de1872ddcd18ddbef11b65d6a285", "url": "https://github.com/apache/samza/commit/3ae626a626a5de1872ddcd18ddbef11b65d6a285", "message": "Force restart feature for Container Placements", "committedDate": "2020-08-13T01:24:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MjQ4MQ==", "url": "https://github.com/apache/samza/pull/1414#discussion_r473262481", "bodyText": "Isnt force-restart a misnomer here?\nAll its really doing is issuing a stop and relying on the AM to bring it back up?\nIn a corner case, AM will not be able to bring it back up on the same host, rather on a different available host?", "author": "rmatharu", "createdAt": "2020-08-19T19:16:34Z", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -54,6 +54,8 @@\n \n   private static final Logger LOG = LoggerFactory.getLogger(ContainerManager.class);\n   private static final String ANY_HOST = ResourceRequestState.ANY_HOST;\n+  private static final String LAST_SEEN = \"LAST_SEEN\";\n+  private static final String FORCE_RESTART_LAST_SEEN = \"FORCE_RESTART_LAST_SEEN\";", "originalCommit": "3ae626a626a5de1872ddcd18ddbef11b65d6a285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzNDc2OQ==", "url": "https://github.com/apache/samza/pull/1414#discussion_r474334769", "bodyText": "discussed offline, its the destinationHost param which is.\nAll its really doing is issuing a stop and relying on the AM to bring it back up?\nYup that is what is it doing\nIn a corner case, AM will not be able to bring it back up on the same host, rather on a different available host?\nYes and that is documented", "author": "Sanil15", "createdAt": "2020-08-21T00:00:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MjQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MzE3OA==", "url": "https://github.com/apache/samza/pull/1414#discussion_r473263178", "bodyText": "This comment has the same meaning as the one above\n\"if (destinationHost.equals(FORCE_RESTART_LAST_SEEN))\"\nCould we write the difference", "author": "rmatharu", "createdAt": "2020-08-19T19:18:01Z", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -391,6 +402,28 @@ public void registerContainerPlacementAction(ContainerPlacementRequestMessage re\n       return;\n     }\n \n+    /*\n+     * When destination host is {@code FORCE_RESTART_LAST_SEEN} its treated as eqvivalent to kill -9 operation for the container\n+     * In this scenario container is stopped first and we fallback to normal restart path\n+     */\n+    if (destinationHost.equals(FORCE_RESTART_LAST_SEEN)) {\n+      LOG.info(\"Issuing a force restart for Processor ID: {} for ContainerPlacement action request {}\", processorId, requestMessage);\n+      clusterResourceManager.stopStreamProcessor(samzaApplicationState.runningProcessors.get(processorId));\n+      writeContainerPlacementResponseMessage(requestMessage, ContainerPlacementMessage.StatusCode.SUCCEEDED,\n+          \"Successfully issued a stop container request falling back to normal restart path\");\n+      return;\n+    }\n+\n+    /**\n+     * When destination host is {@code LAST_SEEN} its treated as a restart request on the host where container is running\n+     * on or has been seen last\n+     */", "originalCommit": "3ae626a626a5de1872ddcd18ddbef11b65d6a285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzNDgyOA==", "url": "https://github.com/apache/samza/pull/1414#discussion_r474334828", "bodyText": "sure", "author": "Sanil15", "createdAt": "2020-08-21T00:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MzE3OA=="}], "type": "inlineReview"}, {"oid": "a6e3cc0857e5a43691b8864674c7541a56a03815", "url": "https://github.com/apache/samza/commit/a6e3cc0857e5a43691b8864674c7541a56a03815", "message": "Cleanup comments", "committedDate": "2020-08-21T00:12:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc2ODYxNA==", "url": "https://github.com/apache/samza/pull/1414#discussion_r475768614", "bodyText": "small thing:\nI think its equivalent to a \"kill\"  (i.e., sigstop), not \"kill -9\" (sigkill).\nCould you verify using the yarn docs", "author": "rmatharu", "createdAt": "2020-08-24T17:14:07Z", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -391,6 +402,30 @@ public void registerContainerPlacementAction(ContainerPlacementRequestMessage re\n       return;\n     }\n \n+    /*\n+     * When destination host is {@code FORCE_RESTART_LAST_SEEN} its treated as eqvivalent to kill -9 operation for the container", "originalCommit": "a6e3cc0857e5a43691b8864674c7541a56a03815", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}