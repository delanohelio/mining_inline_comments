{"pr_number": 3773, "pr_title": "Check if selected map layer file exists before using it", "pr_createdAt": "2020-04-09T11:35:30Z", "pr_url": "https://github.com/getodk/collect/pull/3773", "timeline": [{"oid": "a7fe96206211ecbaefd879824d7c9694e8b535a5", "url": "https://github.com/getodk/collect/commit/a7fe96206211ecbaefd879824d7c9694e8b535a5", "message": "Check if selected map layer file exists before using it", "committedDate": "2020-04-09T09:07:49Z", "type": "commit"}, {"oid": "dca6503e3e83124dabc452162af1a23bf9da560f", "url": "https://github.com/getodk/collect/commit/dca6503e3e83124dabc452162af1a23bf9da560f", "message": "Factored out getReferenceLayerFile() method", "committedDate": "2020-04-09T09:21:58Z", "type": "commit"}, {"oid": "86c798472929feb4d860fadac714b9958f96769b", "url": "https://github.com/getodk/collect/commit/86c798472929feb4d860fadac714b9958f96769b", "message": "Select none if another option selected but its file does not exist", "committedDate": "2020-04-09T10:07:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxODI5Nw==", "url": "https://github.com/getodk/collect/pull/3773#discussion_r411518297", "bodyText": "It feels to me like this could be static util helper method (that probably takes a StoragePathProvider and Bundle as args). I'd generally think about a default implementation adding something to the external interface where as this seems more like a helper for the MapFragment implementations. What do you think?\nEither way I think this piece of logic should have a test to drive out that it checks for file existance as well as grabbing the layer path.", "author": "seadowg", "createdAt": "2020-04-20T16:27:58Z", "path": "collect_app/src/main/java/org/odk/collect/android/geo/MapFragment.java", "diffHunk": "@@ -206,4 +209,11 @@ void addTo(\n     interface FeatureListener {\n         void onFeature(int featureId);\n     }\n+\n+    default File getReferenceLayerFile(Bundle config) {", "originalCommit": "86c798472929feb4d860fadac714b9958f96769b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAzMjA5NA==", "url": "https://github.com/getodk/collect/pull/3773#discussion_r412032094", "bodyText": "Ok I moved getReferenceLayerFile() to GeoUtils. When it comes to tests... getAbsoluteOfflineMapLayerPath() has its own tests so does that make sense to write a test just to check the return statement (file existence):\nreturn path != null && new File(path).exists()\n                ? new File(path)\n                : null;\n\n?", "author": "grzesiek2010", "createdAt": "2020-04-21T09:37:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxODI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA4MjQ1Mg==", "url": "https://github.com/getodk/collect/pull/3773#discussion_r412082452", "bodyText": "Yeah it's a small decision but it's an important one so good to have a test to make sure it stays in place.", "author": "seadowg", "createdAt": "2020-04-21T10:55:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxODI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNTA2Nw==", "url": "https://github.com/getodk/collect/pull/3773#discussion_r412225067", "bodyText": "Ok done, I added tests.", "author": "grzesiek2010", "createdAt": "2020-04-21T14:17:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxODI5Nw=="}], "type": "inlineReview"}, {"oid": "5c013f09b36432f89a2d6979ed04e583c09deb63", "url": "https://github.com/getodk/collect/commit/5c013f09b36432f89a2d6979ed04e583c09deb63", "message": "Moved getReferenceLayerFile() to GeoUtils", "committedDate": "2020-04-21T09:03:57Z", "type": "commit"}, {"oid": "b59842d437f699e02519e09f2f3c80a0dc157e90", "url": "https://github.com/getodk/collect/commit/b59842d437f699e02519e09f2f3c80a0dc157e90", "message": "Added tests", "committedDate": "2020-04-21T13:55:47Z", "type": "commit"}]}