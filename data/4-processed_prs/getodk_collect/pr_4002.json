{"pr_number": 4002, "pr_title": "Match exactly analytics", "pr_createdAt": "2020-07-31T16:44:00Z", "pr_url": "https://github.com/getodk/collect/pull/4002", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxNzkwNg==", "url": "https://github.com/getodk/collect/pull/4002#discussion_r463717906", "bodyText": "I wanted to do this here rather than when the settings are changed/imported as it avoids handling all the different possible cases and also makes sure we always have a value for this property set. It means the values we have are probably going to be slightly behind (as we'll be waiting for the next time the app boots for the property to be set) but I think that'll be ok.", "author": "seadowg", "createdAt": "2020-07-31T16:45:47Z", "path": "collect_app/src/main/java/org/odk/collect/android/application/initialization/ApplicationInitializer.java", "diffHunk": "@@ -55,21 +60,30 @@ public void initialize() {\n         initializeLocale();\n     }\n \n-    public void initializePreferences() {\n+    private void initializePreferences() {\n         performMigrations();\n         reloadSharedPreferences();\n     }\n \n-    public void initializeFrameworks() {\n+    private void initializeFrameworks() {\n         NotificationUtils.createNotificationChannel(context);\n         JodaTimeAndroid.init(context);\n         initializeLogging();\n         AppCompatDelegate.setCompatVectorFromResourcesEnabled(true);\n         initializeMapFrameworks();\n         initializeJavaRosa();\n+        initializeAnalytics();\n     }\n \n-    public void initializeLocale() {\n+    private void initializeAnalytics() {\n+        String formUpdateMode = generalSharedPreferences\n+                .getSharedPreferences()\n+                .getString(GeneralKeys.KEY_FORM_UPDATE_MODE, FormUpdateMode.MANUAL.getValue(context));\n+\n+        analytics.setUserProperty(\"FormUpdateMode\", formUpdateMode);", "originalCommit": "1235ae7002de37e87704c49db7371f41a4586fda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEyMTY5Ng==", "url": "https://github.com/getodk/collect/pull/4002#discussion_r464121696", "bodyText": "What do you think of using the hostname instead of the raw setting value? The raw server setting value would mean we differentiate between different Central App Users. Hostname would give us a sense of organizations that use match exactly and specifically the manual sync button.", "author": "lognaturel", "createdAt": "2020-08-02T20:45:54Z", "path": "collect_app/src/main/java/org/odk/collect/android/formmanagement/BlankFormsListViewModel.java", "diffHunk": "@@ -87,6 +99,12 @@ public void syncWithServer() {\n         });\n     }\n \n+    private void logManualSync() {\n+        String url = preferencesProvider.getGeneralSharedPreferences().getString(GeneralKeys.KEY_SERVER_URL, \"\");\n+        String urlHash = FileUtils.getMd5Hash(new ByteArrayInputStream(url.getBytes()));", "originalCommit": "1235ae7002de37e87704c49db7371f41a4586fda", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI5NzgzNQ==", "url": "https://github.com/getodk/collect/pull/4002#discussion_r464297835", "bodyText": "Yeah that makes more sense", "author": "seadowg", "createdAt": "2020-08-03T09:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEyMTY5Ng=="}], "type": "inlineReview"}, {"oid": "bed0bd48577fba28cf1a226084ebcee024c7f18d", "url": "https://github.com/getodk/collect/commit/bed0bd48577fba28cf1a226084ebcee024c7f18d", "message": "Log event when manual match exactly refresh started", "committedDate": "2020-08-03T12:04:02Z", "type": "commit"}, {"oid": "0cd567e3258aad8c0bc3832d9f2b8b060214d406", "url": "https://github.com/getodk/collect/commit/0cd567e3258aad8c0bc3832d9f2b8b060214d406", "message": "Add analytics event when manual match exactly sync completes", "committedDate": "2020-08-03T12:04:02Z", "type": "commit"}, {"oid": "627c6c6feb4c90fd21f0ad2fa5ac27c3d4ca2421", "url": "https://github.com/getodk/collect/commit/627c6c6feb4c90fd21f0ad2fa5ac27c3d4ca2421", "message": "Log analytics when background match exactly sync completes", "committedDate": "2020-08-03T12:04:02Z", "type": "commit"}, {"oid": "4ea20223478b9565256dcc1e4becaf65d4dd1bf6", "url": "https://github.com/getodk/collect/commit/4ea20223478b9565256dcc1e4becaf65d4dd1bf6", "message": "Add url hash to manual refresh analytics", "committedDate": "2020-08-03T12:08:49Z", "type": "commit"}, {"oid": "62e6761f16a420e9c9d1f54fa34348a2143b7e34", "url": "https://github.com/getodk/collect/commit/62e6761f16a420e9c9d1f54fa34348a2143b7e34", "message": "Set form update mode user property when booting app", "committedDate": "2020-08-03T12:08:51Z", "type": "commit"}, {"oid": "62e6761f16a420e9c9d1f54fa34348a2143b7e34", "url": "https://github.com/getodk/collect/commit/62e6761f16a420e9c9d1f54fa34348a2143b7e34", "message": "Set form update mode user property when booting app", "committedDate": "2020-08-03T12:08:51Z", "type": "forcePushed"}, {"oid": "590188beae77396add3ac4dd2276a06343adc5a1", "url": "https://github.com/getodk/collect/commit/590188beae77396add3ac4dd2276a06343adc5a1", "message": "Use host for manual sync analytics", "committedDate": "2020-08-03T12:14:12Z", "type": "commit"}, {"oid": "2655327da6f0f7e595286a18b60c9935f1f2508b", "url": "https://github.com/getodk/collect/commit/2655327da6f0f7e595286a18b60c9935f1f2508b", "message": "Optimize imports", "committedDate": "2020-08-03T12:19:59Z", "type": "commit"}, {"oid": "2655327da6f0f7e595286a18b60c9935f1f2508b", "url": "https://github.com/getodk/collect/commit/2655327da6f0f7e595286a18b60c9935f1f2508b", "message": "Optimize imports", "committedDate": "2020-08-03T12:19:59Z", "type": "forcePushed"}]}