{"pr_number": 4233, "pr_title": "Rework ResetStateRule ", "pr_createdAt": "2020-11-20T11:41:38Z", "pr_url": "https://github.com/getodk/collect/pull/4233", "timeline": [{"oid": "f0a008b01a83c609876fd5306d28ba4bcb80d61f", "url": "https://github.com/getodk/collect/commit/f0a008b01a83c609876fd5306d28ba4bcb80d61f", "message": "Delete files instead of using ApplicationResetter in tests", "committedDate": "2020-11-20T10:48:08Z", "type": "commit"}, {"oid": "ebcb1404ce88c752b511099d28c301eb2c08ecec", "url": "https://github.com/getodk/collect/commit/ebcb1404ce88c752b511099d28c301eb2c08ecec", "message": "Make sure rules run in correct order", "committedDate": "2020-11-20T11:38:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYzNjMwNw==", "url": "https://github.com/getodk/collect/pull/4233#discussion_r527636307", "bodyText": "This was causing problems as the path it would get would be determined when the class was loaded.", "author": "seadowg", "createdAt": "2020-11-20T11:42:15Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/CustomSQLiteQueryExecutionTest.java", "diffHunk": "@@ -20,30 +20,29 @@\n import android.database.Cursor;\n import android.database.sqlite.SQLiteDatabase;\n \n-import androidx.test.rule.GrantPermissionRule;\n import androidx.test.ext.junit.runners.AndroidJUnit4;\n+import androidx.test.rule.GrantPermissionRule;\n \n-import org.junit.Before;\n import org.junit.Rule;\n import org.junit.Test;\n import org.junit.rules.RuleChain;\n import org.junit.runner.RunWith;\n-import org.odk.collect.android.storage.StoragePathProvider;\n-import org.odk.collect.android.storage.StorageSubdirectory;\n-import org.odk.collect.android.support.ResetStateRule;\n+import org.odk.collect.android.support.RunnableRule;\n import org.odk.collect.android.utilities.CustomSQLiteQueryExecutor;\n \n+import java.io.File;\n+import java.io.IOException;\n+\n import static junit.framework.Assert.assertEquals;\n import static junit.framework.Assert.assertFalse;\n import static junit.framework.Assert.assertTrue;\n \n @RunWith(AndroidJUnit4.class)\n public class CustomSQLiteQueryExecutionTest {\n-    private static final String DATABASE_PATH = new StoragePathProvider().getDirPath(StorageSubdirectory.METADATA) + \"/test.db\";", "originalCommit": "ebcb1404ce88c752b511099d28c301eb2c08ecec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYzNjQ5MA==", "url": "https://github.com/getodk/collect/pull/4233#discussion_r527636490", "bodyText": "This is just testing our db helpers so it doesn't need to talk to our \"real\" db.", "author": "seadowg", "createdAt": "2020-11-20T11:42:35Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/CustomSQLiteQueryExecutionTest.java", "diffHunk": "@@ -53,14 +52,15 @@\n                     Manifest.permission.READ_EXTERNAL_STORAGE,\n                     Manifest.permission.WRITE_EXTERNAL_STORAGE)\n             )\n-            .around(new ResetStateRule());\n-\n-    @Before\n-    public void setUp() {\n-        sqLiteDatabase = SQLiteDatabase.openOrCreateDatabase(DATABASE_PATH, null, null);\n-        dropTable(TEST_TABLE_NAME);\n-        dropTable(TEST_TABLE_NAME_2);\n-    }\n+            .around(new RunnableRule(() -> {\n+                try {\n+                    File dbPath = File.createTempFile(\"test\", \".db\");", "originalCommit": "ebcb1404ce88c752b511099d28c301eb2c08ecec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}