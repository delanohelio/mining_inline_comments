{"pr_number": 4274, "pr_title": "Fixed creating multiple files for recording selfie videos", "pr_createdAt": "2020-12-07T13:47:11Z", "pr_url": "https://github.com/getodk/collect/pull/4274", "timeline": [{"oid": "a88266cc20e3cf296efa8e6ae4adc96d3a567116", "url": "https://github.com/getodk/collect/commit/a88266cc20e3cf296efa8e6ae4adc96d3a567116", "message": "Use one reusable temp video file for recording selfie videos", "committedDate": "2020-12-07T12:56:21Z", "type": "commit"}, {"oid": "82989ceb2b62d38ce4aac646a35927f4766d427d", "url": "https://github.com/getodk/collect/commit/82989ceb2b62d38ce4aac646a35927f4766d427d", "message": "Removed unused code from CameraUtils", "committedDate": "2020-12-07T13:01:12Z", "type": "commit"}, {"oid": "ea54db15e793d4ae35d8304d18ce32b6aa63941c", "url": "https://github.com/getodk/collect/commit/ea54db15e793d4ae35d8304d18ce32b6aa63941c", "message": "Removed duplicated tmp file path for drawings", "committedDate": "2020-12-07T13:04:12Z", "type": "commit"}, {"oid": "277e217f110903c7f6269659c87424bca96939aa", "url": "https://github.com/getodk/collect/commit/277e217f110903c7f6269659c87424bca96939aa", "message": "Naming improvements", "committedDate": "2020-12-07T13:05:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2MTgyOQ==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537661829", "bodyText": "If you're going to be creating a new StoragePathProvider here anyway I think you can do away with the indirection and just use new StoragePathProvider().getTmpVideoPath() inline.", "author": "lognaturel", "createdAt": "2020-12-07T16:51:25Z", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/CameraUtils.java", "diffHunk": "@@ -123,10 +124,8 @@ public static void savePhoto(String path, byte[] data) {\n             Timber.e(e);\n         }\n     }\n-  \n-    public static String getVideoFilePath(Context context) {\n-        final File dir = context.getExternalFilesDir(null);\n-        return (dir == null ? \"\" : (dir.getAbsolutePath() + \"/\"))\n-                + System.currentTimeMillis() + \".mp4\";\n+\n+    public static String getVideoFilePath() {\n+        return new StoragePathProvider().getTmpVideoPath();", "originalCommit": "a88266cc20e3cf296efa8e6ae4adc96d3a567116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg4OTYzMA==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537889630", "bodyText": "Done.", "author": "grzesiek2010", "createdAt": "2020-12-07T22:43:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2MTgyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2Mjc4MQ==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537662781", "bodyText": "This is an existing issue but still want to highlight it. I don't think we know the image is a jpg. It could be a png, bmp, ... We should fix this at some point. Maybe a separate issue?", "author": "lognaturel", "createdAt": "2020-12-07T16:52:39Z", "path": "collect_app/src/main/java/org/odk/collect/android/storage/StoragePathProvider.java", "diffHunk": "@@ -79,11 +79,11 @@ public String getStorageRootDirPath() {\n                 : getUnscopedStorageRootDirPath();\n     }\n \n-    public String getTmpFilePath() {\n+    public String getTmpImageFilePath() {", "originalCommit": "277e217f110903c7f6269659c87424bca96939aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg5MjE4MA==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537892180", "bodyText": "You are right I'll file an issue.", "author": "grzesiek2010", "createdAt": "2020-12-07T22:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMDQ3Ng==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537900476", "bodyText": "Hmm unfortunately I think it's not possible... we pass our tmp file starting a camera app because it's a way to capture a full-size photo:\nhttps://developer.android.com/training/camera/photobasics#TaskPath\nwe don't know what format such an external app is going to return so like in the documentation we use jpg. Then the captured photo is saved to our tmp file.", "author": "grzesiek2010", "createdAt": "2020-12-07T23:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNDk0Mg==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537904942", "bodyText": "I see. Can we check the mime type and fix the extension later? I think all images are submitted with a jpg extension but maybe I\u2019m remembering wrong.", "author": "lognaturel", "createdAt": "2020-12-07T23:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI0OTk4NQ==", "url": "https://github.com/getodk/collect/pull/4274#discussion_r538249985", "bodyText": "No really, I mean we can read mime type using the tmp file where an external app saves captured photos but it's pointless because it will always be jpeg.", "author": "grzesiek2010", "createdAt": "2020-12-08T11:09:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2Mjc4MQ=="}], "type": "inlineReview"}, {"oid": "9dce1b364eecaeb64a4b778c5674c8eb19e1c2bc", "url": "https://github.com/getodk/collect/commit/9dce1b364eecaeb64a4b778c5674c8eb19e1c2bc", "message": "Code improvements", "committedDate": "2020-12-07T22:36:53Z", "type": "commit"}]}