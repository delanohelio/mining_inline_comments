{"pr_number": 4232, "pr_title": "Use glide to display images in selects", "pr_createdAt": "2020-11-19T20:10:09Z", "pr_url": "https://github.com/getodk/collect/pull/4232", "timeline": [{"oid": "6f451b29f93a0bd1e092e699860e92c977d3a950", "url": "https://github.com/getodk/collect/commit/6f451b29f93a0bd1e092e699860e92c977d3a950", "message": "Added Glide dependency", "committedDate": "2020-11-19T10:29:27Z", "type": "commit"}, {"oid": "0a60daba66e1d7d975b0569cf05b5c51708ac83b", "url": "https://github.com/getodk/collect/commit/0a60daba66e1d7d975b0569cf05b5c51708ac83b", "message": "Removed redundant setupImage() method", "committedDate": "2020-11-19T10:33:17Z", "type": "commit"}, {"oid": "812d890e85839b711b7145dee42bec396d7cb679", "url": "https://github.com/getodk/collect/commit/812d890e85839b711b7145dee42bec396d7cb679", "message": "Use glide to load images in AudioVideoImageTextLabel", "committedDate": "2020-11-19T10:44:42Z", "type": "commit"}, {"oid": "7dc03450602c1f0e414656afa929cc40b4af0efc", "url": "https://github.com/getodk/collect/commit/7dc03450602c1f0e414656afa929cc40b4af0efc", "message": "Got rid of recycling drawables", "committedDate": "2020-11-19T11:11:33Z", "type": "commit"}, {"oid": "bd355c44dc50e7cd22bd418bde243ca525e5a639", "url": "https://github.com/getodk/collect/commit/bd355c44dc50e7cd22bd418bde243ca525e5a639", "message": "Factored out NoButtonsItem class to handle no buttons items in the same way we handle AudioVideoImageTextLabel", "committedDate": "2020-11-19T13:36:24Z", "type": "commit"}, {"oid": "b0b4dbe8a669d0652e23d740960923978c52810d", "url": "https://github.com/getodk/collect/commit/b0b4dbe8a669d0652e23d740960923978c52810d", "message": "Use glide to load images in no-buttons mode", "committedDate": "2020-11-19T14:08:30Z", "type": "commit"}, {"oid": "49c67fdb50b4515e44c2b0a6c51a94995de01c82", "url": "https://github.com/getodk/collect/commit/49c67fdb50b4515e44c2b0a6c51a94995de01c82", "message": "Images in no-buttons mode gridView should take the all available space", "committedDate": "2020-11-19T19:32:28Z", "type": "commit"}, {"oid": "9dbd7475356defacf514968075e89587a43cad16", "url": "https://github.com/getodk/collect/commit/9dbd7475356defacf514968075e89587a43cad16", "message": "Code improvements", "committedDate": "2020-11-19T19:33:28Z", "type": "commit"}, {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "url": "https://github.com/getodk/collect/commit/4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "message": "Fixed displaying images in different sizes while scrolling the list", "committedDate": "2020-11-19T20:09:40Z", "type": "commit"}, {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "url": "https://github.com/getodk/collect/commit/4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "message": "Fixed displaying images in different sizes while scrolling the list", "committedDate": "2020-11-19T20:09:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ==", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527168551", "bodyText": "@lognaturel maybe it's time to get rid of those error messages? Glide can display a special image that will be used if something is wrong so we could have such an error/missing file image?", "author": "grzesiek2010", "createdAt": "2020-11-19T20:12:40Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/questions/AudioVideoImageTextLabel.java", "diffHunk": "@@ -143,7 +142,20 @@ public void setAudio(String audioURI, AudioHelper audioHelper) {\n     }\n \n     public void setImage(@NonNull File imageFile) {\n-        setupImage(imageFile);\n+        if (imageFile.exists()) {\n+            imageView.layout(0, 0, 0, 0);\n+\n+            Glide.with(this)\n+                    .load(imageFile)\n+                    .centerInside()\n+                    .into(imageView);\n+\n+            imageView.setVisibility(VISIBLE);\n+            imageView.setOnClickListener(this);\n+        } else {\n+            missingImage.setVisibility(VISIBLE);\n+            missingImage.setText(getContext().getString(R.string.file_missing, imageFile));", "originalCommit": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNzI4OQ==", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527227289", "bodyText": "I think using a missing image file is a good idea and will make it more obvious that something is wrong.\nThe advantage of the message is that it lets the user know where the image is expected to be and what its file name is. How about leaving this message and adding the missing image? Or is there a strong reason to get rid of it?", "author": "lognaturel", "createdAt": "2020-11-19T21:53:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU4NTMwNw==", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527585307", "bodyText": "Ok I'll file a separate issue for that.", "author": "grzesiek2010", "createdAt": "2020-11-20T10:08:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw==", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527169533", "bodyText": "All of these is removed because it caused crashes since Glide use caching. I could disable caching in Glide and then keep this code but it's not recommended and I believe it's a very old code that we no longer need because we have more powerful devices and also glide should deal with it better.", "author": "grzesiek2010", "createdAt": "2020-11-19T20:14:31Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/QuestionWidget.java", "diffHunk": "@@ -291,40 +285,6 @@ public QuestionDetails getQuestionDetails() {\n         return questionDetails;\n     }\n \n-    // http://code.google.com/p/android/issues/detail?id=8488\n-    private void recycleDrawablesRecursive(ViewGroup viewGroup, List<ImageView> images) {", "originalCommit": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIzMDk2Mw==", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527230963", "bodyText": "This seems reasonable to me. Am I understanding correctly that the Glide cache will be some kind of singleton so on activity rotation all images should be able to come from some cache layer?", "author": "lognaturel", "createdAt": "2020-11-19T22:00:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU3NjgwMA==", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527576800", "bodyText": "Yes I'm not sure about rotating and would need to double check but it uses caching for example when we navigate between questions so probably during rotating as well.", "author": "grzesiek2010", "createdAt": "2020-11-20T09:54:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw=="}], "type": "inlineReview"}, {"oid": "6f49f04f077a46625c949fb6dc9943ee80fcd590", "url": "https://github.com/getodk/collect/commit/6f49f04f077a46625c949fb6dc9943ee80fcd590", "message": "Fixed tests", "committedDate": "2020-11-19T20:38:49Z", "type": "commit"}, {"oid": "95312a78129f78a0823b00721f0c19ae9e531a12", "url": "https://github.com/getodk/collect/commit/95312a78129f78a0823b00721f0c19ae9e531a12", "message": "Merge branch 'master' into COLLECT-4205", "committedDate": "2020-11-24T12:50:47Z", "type": "commit"}]}