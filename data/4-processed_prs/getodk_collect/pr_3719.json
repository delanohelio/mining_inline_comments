{"pr_number": 3719, "pr_title": "Avoid multiclicking in Admin and General settings", "pr_createdAt": "2020-03-17T10:35:38Z", "pr_url": "https://github.com/getodk/collect/pull/3719", "timeline": [{"oid": "5ffced803b473ec9dd9ede7978cd257cd8854282", "url": "https://github.com/getodk/collect/commit/5ffced803b473ec9dd9ede7978cd257cd8854282", "message": "Factored out MultiClickGuard class", "committedDate": "2020-03-05T14:36:17Z", "type": "commit"}, {"oid": "2c6cfce9c54b813c04d0d7a6b392e8cde3d823bc", "url": "https://github.com/getodk/collect/commit/2c6cfce9c54b813c04d0d7a6b392e8cde3d823bc", "message": "Avoid multiclicking in Admin preferences", "committedDate": "2020-03-17T09:59:27Z", "type": "commit"}, {"oid": "fec4e45fa6cc6dd8eaf38604f2f1bad85a63ef95", "url": "https://github.com/getodk/collect/commit/fec4e45fa6cc6dd8eaf38604f2f1bad85a63ef95", "message": "Avoid multiclicking in General preferences", "committedDate": "2020-03-17T10:04:24Z", "type": "commit"}, {"oid": "4429e47844bf962248434dacdf433415dc11bf8d", "url": "https://github.com/getodk/collect/commit/4429e47844bf962248434dacdf433415dc11bf8d", "message": "Handle starting general prefs from admin prefs in AdminPreferencesFragment to avoid multiclicking", "committedDate": "2020-03-17T10:28:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ==", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394322591", "bodyText": "I'm not sure I understand this. Does this assume no time passes between clicks in tests? As far as I can see this is true if not time has passed since the last click. In both espresso and normal junit it's very possible for a millisecond to pass between clicks. Maybe I just need some more caffeine \u2615\ufe0f.", "author": "seadowg", "createdAt": "2020-03-18T12:52:48Z", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/MultiClickGuard.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.os.SystemClock;\n+\n+public class MultiClickGuard {\n+    private static final int CLICK_DEBOUNCE_MS = 1000;\n+\n+    private static long lastClickTime;\n+    private static String lastClickName;\n+\n+    private MultiClickGuard() {\n+    }\n+\n+    // Debounce multiple clicks within the same screen\n+    public static boolean allowClick(String className) {\n+        long elapsedRealtime = SystemClock.elapsedRealtime();\n+        boolean isSameClass = className.equals(lastClickName);\n+        boolean isBeyondThreshold = elapsedRealtime - lastClickTime > CLICK_DEBOUNCE_MS;\n+        boolean isBeyondTestThreshold = lastClickTime == 0 || lastClickTime == elapsedRealtime; // just for tests", "originalCommit": "4429e47844bf962248434dacdf433415dc11bf8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg3MzU5OA==", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394873598", "bodyText": "Yes, someone has added it on purpose so I guess it fixed the problem he had run into.", "author": "grzesiek2010", "createdAt": "2020-03-19T08:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg3NTAxNg==", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394875016", "bodyText": "Generally it shouldn't be a problem in which test a situation like that could happen that you need to click on the same element twice quickly?", "author": "grzesiek2010", "createdAt": "2020-03-19T08:58:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwMjM3NA==", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394902374", "bodyText": "Is doesn't need to be the same element though right? It just needs to be in the same class (generally we're passing the Activity). Personlly the solution confuses me and I'm sure there are simpler ways to work out if we're in tests or not. I can look at later seeing as I have a personal vendetta against the line \ud83d\ude01. Let's just make sure to run connectedAndroidTest to check Espresso doesn't run into any problems with all the new guards.", "author": "seadowg", "createdAt": "2020-03-19T09:46:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMDA0MA==", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394920040", "bodyText": "Is doesn't need to be the same element though right?\n\nright.", "author": "grzesiek2010", "createdAt": "2020-03-19T10:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ=="}], "type": "inlineReview"}, {"oid": "d90727072728810cc761abcd44c443302ac725fc", "url": "https://github.com/getodk/collect/commit/d90727072728810cc761abcd44c443302ac725fc", "message": "Avoid multiclicking on Form Metadata", "committedDate": "2020-03-20T15:31:01Z", "type": "commit"}]}