{"pr_number": 4016, "pr_title": "Adjusted gesture navigation", "pr_createdAt": "2020-08-07T12:18:36Z", "pr_url": "https://github.com/getodk/collect/pull/4016", "timeline": [{"oid": "3ab1692a0c47d869532001719f915dba3ed0c429", "url": "https://github.com/getodk/collect/commit/3ab1692a0c47d869532001719f915dba3ed0c429", "message": "Adjusted gesture navigation", "committedDate": "2020-08-11T12:25:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0MzM4OQ==", "url": "https://github.com/getodk/collect/pull/4016#discussion_r471843389", "bodyText": "I think this is clearer with xdpi and ydpi inline. The comment is very clear and dpi is common for \"dots per inch\".", "author": "lognaturel", "createdAt": "2020-08-18T00:19:37Z", "path": "collect_app/src/main/java/org/odk/collect/android/listeners/SwipeHandler.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.odk.collect.android.listeners;\n+\n+import android.content.Context;\n+import android.view.GestureDetector;\n+import android.view.MotionEvent;\n+\n+import androidx.core.widget.NestedScrollView;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.formentry.ODKView;\n+import org.odk.collect.android.preferences.GeneralKeys;\n+import org.odk.collect.android.preferences.GeneralSharedPreferences;\n+import org.odk.collect.android.utilities.FlingRegister;\n+import org.odk.collect.android.utilities.ScreenUtils;\n+\n+import timber.log.Timber;\n+\n+public class SwipeHandler {\n+    private final GestureDetector gestureDetector;\n+    private final OnSwipeListener onSwipe;\n+    private ODKView odkView;\n+    private boolean allowSwiping = true;\n+    private boolean beenSwiped;\n+\n+    public interface OnSwipeListener {\n+        void showPreviousView();\n+        void showNextView();\n+    }\n+\n+    public SwipeHandler(Context context) {\n+        gestureDetector = new GestureDetector(context, new GestureListener());\n+        this.onSwipe = (OnSwipeListener) context;\n+    }\n+\n+    public void setOdkView(ODKView odkView) {\n+        this.odkView = odkView;\n+    }\n+\n+    public void setAllowSwiping(boolean allowSwiping) {\n+        this.allowSwiping = allowSwiping;\n+    }\n+\n+    public void setBeenSwiped(boolean beenSwiped) {\n+        this.beenSwiped = beenSwiped;\n+    }\n+\n+    public boolean beenSwiped() {\n+        return beenSwiped;\n+    }\n+\n+    public GestureDetector getGestureDetector() {\n+        return gestureDetector;\n+    }\n+\n+    public class GestureListener implements GestureDetector.OnGestureListener {\n+\n+        @Override\n+        public boolean onDown(MotionEvent event) {\n+            return false;\n+        }\n+\n+        @Override\n+        public void onShowPress(MotionEvent e) {\n+\n+        }\n+\n+        @Override\n+        public boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY) {\n+            // The onFling() captures the 'up' event so our view thinks it gets long pressed. We don't want that, so cancel it.\n+            if (odkView != null) {\n+                odkView.cancelLongPress();\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public void onLongPress(MotionEvent e) {\n+\n+        }\n+\n+        @Override\n+        public boolean onSingleTapUp(MotionEvent e) {\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {\n+            FlingRegister.flingDetected();\n+\n+            // only check the swipe if it's enabled in preferences\n+            String navigation = (String) GeneralSharedPreferences.getInstance()\n+                    .get(GeneralKeys.KEY_NAVIGATION);\n+\n+            if (e1 != null && e2 != null\n+                    && navigation.contains(GeneralKeys.NAVIGATION_SWIPE) && allowSwiping) {\n+                // Looks for user swipes. If the user has swiped, move to the appropriate screen.\n+\n+                // For all screens a swipe is left/right of at least .25\" and up/down of less than .25\" OR left/right of > .5\"\n+                int xpixellimit = (int) (ScreenUtils.getXPixelsNumberPerInch() * .25);", "originalCommit": "b0d424411286f88f4ba3b6fabf9364c162f8b888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0NjMxMw==", "url": "https://github.com/getodk/collect/pull/4016#discussion_r471846313", "bodyText": "Right but still I think it's good to keep the code in a separate class (ScreenUtils) so I just change naming.", "author": "grzesiek2010", "createdAt": "2020-08-18T00:30:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0MzM4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0NzUwNg==", "url": "https://github.com/getodk/collect/pull/4016#discussion_r471847506", "bodyText": "I guess that by avoiding the direct dependency on the Collect instance it gets things a little closer to being testable. Fine by me.", "author": "lognaturel", "createdAt": "2020-08-18T00:35:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0MzM4OQ=="}], "type": "inlineReview"}, {"oid": "fff080e4331506551de734f58336b43176a8b965", "url": "https://github.com/getodk/collect/commit/fff080e4331506551de734f58336b43176a8b965", "message": "Adjusted gesture navigation", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "793538b7adbc328ab5dbe16cb576c7a7cca69525", "url": "https://github.com/getodk/collect/commit/793538b7adbc328ab5dbe16cb576c7a7cca69525", "message": "Adjust gesture navigation only if vertical scrolling is enabled", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "44797958fab02d04af1433285217fd5bb4818f32", "url": "https://github.com/getodk/collect/commit/44797958fab02d04af1433285217fd5bb4818f32", "message": "Moved the code responsible for gesture navigation out of FormEntryActivity\"", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "f691c9bc495a9ec6dba184022d6d7931d0107b20", "url": "https://github.com/getodk/collect/commit/f691c9bc495a9ec6dba184022d6d7931d0107b20", "message": "Code improvements", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "fc81fd8f9fda449065b5b9f308052eba01334ab5", "url": "https://github.com/getodk/collect/commit/fc81fd8f9fda449065b5b9f308052eba01334ab5", "message": "Fixed calculating swipes", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "dbb92204c86a318f197d6b0c4b9bf856283f79f9", "url": "https://github.com/getodk/collect/commit/dbb92204c86a318f197d6b0c4b9bf856283f79f9", "message": "Code improvements", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "url": "https://github.com/getodk/collect/commit/e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "message": "Naming improvements", "committedDate": "2020-08-18T21:52:51Z", "type": "commit"}, {"oid": "e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "url": "https://github.com/getodk/collect/commit/e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "message": "Naming improvements", "committedDate": "2020-08-18T21:52:51Z", "type": "forcePushed"}]}