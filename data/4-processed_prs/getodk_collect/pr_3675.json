{"pr_number": 3675, "pr_title": "Fix flakey tests", "pr_createdAt": "2020-03-04T18:58:30Z", "pr_url": "https://github.com/getodk/collect/pull/3675", "timeline": [{"oid": "6336c772732621455141ec9696852a346dc9a129", "url": "https://github.com/getodk/collect/commit/6336c772732621455141ec9696852a346dc9a129", "message": "Use Robolectric to test MainMenuActivity onDestroy", "committedDate": "2020-03-04T17:32:43Z", "type": "commit"}, {"oid": "c0a1854afe754aff202f6025a66b272f02d66e8f", "url": "https://github.com/getodk/collect/commit/c0a1854afe754aff202f6025a66b272f02d66e8f", "message": "Use ActivityScenario for MainMenuActivity", "committedDate": "2020-03-04T17:45:06Z", "type": "commit"}, {"oid": "228c85301061005abba5882fc0803f578ff617b0", "url": "https://github.com/getodk/collect/commit/228c85301061005abba5882fc0803f578ff617b0", "message": "Use AsyncTask for resetting app so Espresso works", "committedDate": "2020-03-04T18:51:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387874472", "bodyText": "So is this a no-op or am I missing something?", "author": "lognaturel", "createdAt": "2020-03-04T19:09:32Z", "path": "collect_app/src/test/java/org/odk/collect/android/activities/MainMenuActivityTest.java", "diffHunk": "@@ -26,12 +26,13 @@\n import dagger.Provides;\n \n import static android.os.Environment.MEDIA_MOUNTED;\n+import static androidx.lifecycle.Lifecycle.State.DESTROYED;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.equalTo;\n import static org.robolectric.Shadows.shadowOf;\n import static org.robolectric.annotation.LooperMode.Mode.PAUSED;\n \n-@RunWith(RobolectricTestRunner.class)\n+@RunWith(AndroidJUnit4.class)", "originalCommit": "c0a1854afe754aff202f6025a66b272f02d66e8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NTkzNw==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387875937", "bodyText": "I think so. The docs seem to make a distinction http://robolectric.org/androidx_test/. I guess again for me I find it useful to know that this is an \"Android X\" test. Do you think it's confusing?", "author": "seadowg", "createdAt": "2020-03-04T19:12:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3Njc2MQ==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387876761", "bodyText": "It's not a big deal but I'd like to have a sense of when I should explicitly specify a runner or not.", "author": "lognaturel", "createdAt": "2020-03-04T19:13:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3ODE0MA==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387878140", "bodyText": "I guess I think for these ones there should always be a runner to show that we're not just using JUnit. It's a little wierd because anything in androidTest automatically uses this runner but that's a really strange concept for anyone used to JUnit (not even Spring does that).", "author": "seadowg", "createdAt": "2020-03-04T19:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg4MTUyNA==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387881524", "bodyText": "To summarize: for tests in test that don't use Robolectric, then it's just JUnit and not specifying an explicit runner makes sense. But if they're in androidTest and use the androidx AndroidJUnit4 runner, we should make that explicit even though it's the default because it's a weird default?", "author": "lognaturel", "createdAt": "2020-03-04T19:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg4NzQyMQ==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387887421", "bodyText": "My gut tells me that's the right thing yeah.", "author": "seadowg", "createdAt": "2020-03-04T19:33:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg4Nzc5OQ==", "url": "https://github.com/getodk/collect/pull/3675#discussion_r387887799", "bodyText": "I appreciate your gut for sharing a clear rule to follow. \ud83d\udc4d", "author": "lognaturel", "createdAt": "2020-03-04T19:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDQ3Mg=="}], "type": "inlineReview"}]}