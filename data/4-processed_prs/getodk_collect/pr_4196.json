{"pr_number": 4196, "pr_title": "Force storage migration", "pr_createdAt": "2020-11-02T11:14:12Z", "pr_url": "https://github.com/getodk/collect/pull/4196", "timeline": [{"oid": "fc8c04a9bdea66715c8328c2cc1bfcd3114950bf", "url": "https://github.com/getodk/collect/commit/fc8c04a9bdea66715c8328c2cc1bfcd3114950bf", "message": "Fixed alreadyTriedToMigrateDataToday() and added tests", "committedDate": "2020-11-09T22:55:34Z", "type": "forcePushed"}, {"oid": "714f37775a3f02d728fdd8a0fd87b76e27920161", "url": "https://github.com/getodk/collect/commit/714f37775a3f02d728fdd8a0fd87b76e27920161", "message": "Fixed alreadyTriedToMigrateDataToday() and added tests", "committedDate": "2020-11-10T01:24:10Z", "type": "forcePushed"}, {"oid": "6a42c3c4f597222fa2ec82d39c09926d3bde8b63", "url": "https://github.com/getodk/collect/commit/6a42c3c4f597222fa2ec82d39c09926d3bde8b63", "message": "Fixed alreadyTriedToMigrateDataToday() and added tests", "committedDate": "2020-11-10T01:56:05Z", "type": "forcePushed"}, {"oid": "b59f58ee6e6662c6d955292d2c11770efbdf59c5", "url": "https://github.com/getodk/collect/commit/b59f58ee6e6662c6d955292d2c11770efbdf59c5", "message": "Bumped androidTargetSdk and added requestLegacyExternalStorage flag", "committedDate": "2020-11-12T12:16:16Z", "type": "commit"}, {"oid": "05b849ff8051a448f792e5064d7100de25afcdc9", "url": "https://github.com/getodk/collect/commit/05b849ff8051a448f792e5064d7100de25afcdc9", "message": "Enable scoped storage for fresh installs", "committedDate": "2020-11-12T12:16:16Z", "type": "commit"}, {"oid": "c59ace1f9f21abce2d8e70a3a15f981142a6ec36", "url": "https://github.com/getodk/collect/commit/c59ace1f9f21abce2d8e70a3a15f981142a6ec36", "message": "Try to perform automatic migration if needed", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "5323eb5aa9be019d437ae7c641d4b78df7b9a47c", "url": "https://github.com/getodk/collect/commit/5323eb5aa9be019d437ae7c641d4b78df7b9a47c", "message": "Fixed paths in tests", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "c1950b0b90623c67fcf64c83d49dc7ce51d25dfe", "url": "https://github.com/getodk/collect/commit/c1950b0b90623c67fcf64c83d49dc7ce51d25dfe", "message": "Fixed StorageMigrationTest", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "f2305b57778f24b4f8322413457374d97ea9a764", "url": "https://github.com/getodk/collect/commit/f2305b57778f24b4f8322413457374d97ea9a764", "message": "Use scoped storage in tests by default", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "8b491a4a30786705b072b2ac3071cadd77a25e5c", "url": "https://github.com/getodk/collect/commit/8b491a4a30786705b072b2ac3071cadd77a25e5c", "message": "Updated the message displayed in the banner", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "0153be2ba4f9b2e9e2044965ae472384c9b04a21", "url": "https://github.com/getodk/collect/commit/0153be2ba4f9b2e9e2044965ae472384c9b04a21", "message": "Fixed MainMenuButtonsVisibilityTest", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "c1981520569431603a7e178726f99562c45abb12", "url": "https://github.com/getodk/collect/commit/c1981520569431603a7e178726f99562c45abb12", "message": "Fixed alreadyTriedToMigrateDataToday() and added tests", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "084a5786a0d6eb474d70c4f3a3f680bcad1a3ca8", "url": "https://github.com/getodk/collect/commit/084a5786a0d6eb474d70c4f3a3f680bcad1a3ca8", "message": "Add recreating database helpers to ResetStateRule", "committedDate": "2020-11-12T12:16:45Z", "type": "commit"}, {"oid": "084a5786a0d6eb474d70c4f3a3f680bcad1a3ca8", "url": "https://github.com/getodk/collect/commit/084a5786a0d6eb474d70c4f3a3f680bcad1a3ca8", "message": "Add recreating database helpers to ResetStateRule", "committedDate": "2020-11-12T12:16:45Z", "type": "forcePushed"}, {"oid": "8ddac304b26206390cfadc5b335fc7c89c80deed", "url": "https://github.com/getodk/collect/commit/8ddac304b26206390cfadc5b335fc7c89c80deed", "message": "Tests", "committedDate": "2020-11-12T12:45:44Z", "type": "forcePushed"}, {"oid": "108820d7465820ec26134bb433f53dc3352c7bac", "url": "https://github.com/getodk/collect/commit/108820d7465820ec26134bb433f53dc3352c7bac", "message": "Tests", "committedDate": "2020-11-12T13:20:16Z", "type": "forcePushed"}, {"oid": "ffaaacd608f6773fcdadff1aa7b4b85271f4a9b1", "url": "https://github.com/getodk/collect/commit/ffaaacd608f6773fcdadff1aa7b4b85271f4a9b1", "message": "Fixed circleCi", "committedDate": "2020-11-12T13:41:29Z", "type": "forcePushed"}, {"oid": "056049d0ddfb0eda5ad1d2675d882c839f8240a9", "url": "https://github.com/getodk/collect/commit/056049d0ddfb0eda5ad1d2675d882c839f8240a9", "message": "Fixed circleCi", "committedDate": "2020-11-12T14:05:08Z", "type": "forcePushed"}, {"oid": "988907402b85e2a1455992833548262e5fb3b98d", "url": "https://github.com/getodk/collect/commit/988907402b85e2a1455992833548262e5fb3b98d", "message": "Fixed circleCi", "committedDate": "2020-11-12T14:25:46Z", "type": "forcePushed"}, {"oid": "026da9f1b9cf6a26fddd5473c4c1b9c6bcb12270", "url": "https://github.com/getodk/collect/commit/026da9f1b9cf6a26fddd5473c4c1b9c6bcb12270", "message": "Fixed circleCi", "committedDate": "2020-11-12T14:35:13Z", "type": "forcePushed"}, {"oid": "83fc861dc39a8fd8fe5007d6f9f005c855198481", "url": "https://github.com/getodk/collect/commit/83fc861dc39a8fd8fe5007d6f9f005c855198481", "message": "Fixed circleCi", "committedDate": "2020-11-12T14:45:15Z", "type": "forcePushed"}, {"oid": "7a9bd40109b8bc0ae59a8b10c1de550c8fc14783", "url": "https://github.com/getodk/collect/commit/7a9bd40109b8bc0ae59a8b10c1de550c8fc14783", "message": "Fixed circleCi", "committedDate": "2020-11-12T14:58:26Z", "type": "forcePushed"}, {"oid": "f5fe32f44008e458439e80298bbe631e8792c86f", "url": "https://github.com/getodk/collect/commit/f5fe32f44008e458439e80298bbe631e8792c86f", "message": "Fixed circleCi", "committedDate": "2020-11-12T15:07:48Z", "type": "forcePushed"}, {"oid": "5458b9fa4f12096d933ec6baf2146f5388890fca", "url": "https://github.com/getodk/collect/commit/5458b9fa4f12096d933ec6baf2146f5388890fca", "message": "Fixed circleCi", "committedDate": "2020-11-12T15:16:48Z", "type": "forcePushed"}, {"oid": "763e701aba600499e6cf3782de429c636268df92", "url": "https://github.com/getodk/collect/commit/763e701aba600499e6cf3782de429c636268df92", "message": "Fixed circleCi", "committedDate": "2020-11-12T15:38:44Z", "type": "forcePushed"}, {"oid": "282f81b949214a8196555d44f470b1c7ece7d874", "url": "https://github.com/getodk/collect/commit/282f81b949214a8196555d44f470b1c7ece7d874", "message": "Fixed circleCi", "committedDate": "2020-11-12T16:00:22Z", "type": "forcePushed"}, {"oid": "f2624e1f51a2b0cf646277d4ff24e41554dc2b4b", "url": "https://github.com/getodk/collect/commit/f2624e1f51a2b0cf646277d4ff24e41554dc2b4b", "message": "Fixed circleCi", "committedDate": "2020-11-12T16:10:00Z", "type": "forcePushed"}, {"oid": "ec5c50a43f1a9fce8e185bc15139e8a075fa3cb1", "url": "https://github.com/getodk/collect/commit/ec5c50a43f1a9fce8e185bc15139e8a075fa3cb1", "message": "Fixed circleCi", "committedDate": "2020-11-12T16:24:04Z", "type": "forcePushed"}, {"oid": "dc0ac9f7c4cecd645d74dd8b1413164803895b0b", "url": "https://github.com/getodk/collect/commit/dc0ac9f7c4cecd645d74dd8b1413164803895b0b", "message": "Fixed circleCi", "committedDate": "2020-11-12T16:37:15Z", "type": "forcePushed"}, {"oid": "41a638db006af1e850aba675f6b004eb9f1d6850", "url": "https://github.com/getodk/collect/commit/41a638db006af1e850aba675f6b004eb9f1d6850", "message": "Fixed circleCi", "committedDate": "2020-11-12T16:56:08Z", "type": "forcePushed"}, {"oid": "5f1309d05b725e53ea9c90441a15d56149f6ee7a", "url": "https://github.com/getodk/collect/commit/5f1309d05b725e53ea9c90441a15d56149f6ee7a", "message": "Fixed circleCi", "committedDate": "2020-11-12T17:06:09Z", "type": "forcePushed"}, {"oid": "a2da737445cabd681f9a847deccbb84f7ae7262c", "url": "https://github.com/getodk/collect/commit/a2da737445cabd681f9a847deccbb84f7ae7262c", "message": "Fixed circleCi", "committedDate": "2020-11-12T17:24:37Z", "type": "forcePushed"}, {"oid": "ccdb4bb13de8e776fd94e0e5596792d6b7c82415", "url": "https://github.com/getodk/collect/commit/ccdb4bb13de8e776fd94e0e5596792d6b7c82415", "message": "Fixed circleCi", "committedDate": "2020-11-12T17:54:58Z", "type": "forcePushed"}, {"oid": "9c7d4b58f88c6355cb478998bb53fc9eeb78743f", "url": "https://github.com/getodk/collect/commit/9c7d4b58f88c6355cb478998bb53fc9eeb78743f", "message": "Fixed circleCi", "committedDate": "2020-11-12T18:19:08Z", "type": "forcePushed"}, {"oid": "4dca10346e7d58526734db7c0da75a6e68213164", "url": "https://github.com/getodk/collect/commit/4dca10346e7d58526734db7c0da75a6e68213164", "message": "Fixed circleCi", "committedDate": "2020-11-12T19:18:51Z", "type": "forcePushed"}, {"oid": "7ae18c6c2df89e410d567e115aff34862a49f537", "url": "https://github.com/getodk/collect/commit/7ae18c6c2df89e410d567e115aff34862a49f537", "message": "Fixed circleCi", "committedDate": "2020-11-12T19:43:07Z", "type": "forcePushed"}, {"oid": "c9966cbfa57497b1170af840bab6dd372507dd86", "url": "https://github.com/getodk/collect/commit/c9966cbfa57497b1170af840bab6dd372507dd86", "message": "Fixed circleCi", "committedDate": "2020-11-12T19:54:26Z", "type": "forcePushed"}, {"oid": "5a8d670f8665047392a556d21a31cb6326bf2171", "url": "https://github.com/getodk/collect/commit/5a8d670f8665047392a556d21a31cb6326bf2171", "message": "Fixed OutOfMemroryErrors", "committedDate": "2020-11-12T20:11:24Z", "type": "commit"}, {"oid": "5a8d670f8665047392a556d21a31cb6326bf2171", "url": "https://github.com/getodk/collect/commit/5a8d670f8665047392a556d21a31cb6326bf2171", "message": "Fixed OutOfMemroryErrors", "committedDate": "2020-11-12T20:11:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQwMDg5Nw==", "url": "https://github.com/getodk/collect/pull/4196#discussion_r522400897", "bodyText": "Without this my build kept failing it's probably connected somehow to bumping targetSdkVersion https://circleci.com/docs/2.0/language-android/#handling-out-of-memory-errors", "author": "grzesiek2010", "createdAt": "2020-11-12T20:23:12Z", "path": "collect_app/build.gradle", "diffHunk": "@@ -200,6 +200,9 @@ android {\n         unitTests {\n             includeAndroidResources = true\n             returnDefaultValues = true\n+            all {\n+                maxHeapSize = \"1024m\"", "originalCommit": "5a8d670f8665047392a556d21a31cb6326bf2171", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUwOTYzMA==", "url": "https://github.com/getodk/collect/pull/4196#discussion_r524509630", "bodyText": "\"The migration should have happened automatically. If you still see this message it indicates that something went wrong. Please try to perform migration manually.\" -> \"An automatic migration attempt failed. Please migrate manually.\"", "author": "lognaturel", "createdAt": "2020-11-16T19:12:06Z", "path": "strings/src/main/res/values/strings.xml", "diffHunk": "@@ -670,7 +670,7 @@\n     <string name=\"save_legacy_settings_warning\">Will be removed in a future version. Please use the QR code above.</string>\n     <string name=\"reason_for_changes_description\">You need to explain the reason for changes to this form</string>\n \n-    <string name=\"scoped_storage_banner_text\">You must migrate Collect forms to private storage to comply with Android requirements. In Collect v1.29, <b>the migration will be forced on install</b>.</string>\n+    <string name=\"scoped_storage_banner_text\">You must migrate Collect forms to private storage to comply with Android requirements. The migration should have happened automatically. If you still see this message it indicates that something went wrong. Please try to perform migration manually.</string>", "originalCommit": "8b491a4a30786705b072b2ac3071cadd77a25e5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4MTA2Ng==", "url": "https://github.com/getodk/collect/pull/4196#discussion_r524581066", "bodyText": "Done. Do you also want to add something to the message that is displayed when migration is performed without errors? Now it's just Storage migration completed! but I remember that you were thinking about it, that it might be unclear for users that don't perform it manually.", "author": "grzesiek2010", "createdAt": "2020-11-16T21:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUwOTYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkwMDA3MA==", "url": "https://github.com/getodk/collect/pull/4196#discussion_r524900070", "bodyText": "I think it's ok. Maybe a toast would be less disruptive since it's not really all that important for users to see. Let's get to beta and ask for feedback.", "author": "lognaturel", "createdAt": "2020-11-17T05:53:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUwOTYzMA=="}], "type": "inlineReview"}, {"oid": "c1226e5b67e8e6e5db880c98b40be54ec96b7b61", "url": "https://github.com/getodk/collect/commit/c1226e5b67e8e6e5db880c98b40be54ec96b7b61", "message": "Improved strings", "committedDate": "2020-11-16T21:03:39Z", "type": "commit"}]}