{"pr_number": 3818, "pr_title": "Server settings", "pr_createdAt": "2020-05-08T12:36:34Z", "pr_url": "https://github.com/getodk/collect/pull/3818", "timeline": [{"oid": "a106e25d7c57b6a3807063233330527907fe4745", "url": "https://github.com/getodk/collect/commit/a106e25d7c57b6a3807063233330527907fe4745", "message": "Remove unused strings", "committedDate": "2020-05-08T12:53:49Z", "type": "forcePushed"}, {"oid": "af7639ad2ce31b862bacc368bb7383098e7b973a", "url": "https://github.com/getodk/collect/commit/af7639ad2ce31b862bacc368bb7383098e7b973a", "message": "Remove unused strings", "committedDate": "2020-05-08T14:25:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5Njc1Ng==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422696756", "bodyText": "Even though this is now a feature test, I think keeping the link to @getodk/testers' internal numbering (NODK-235) would be good so we can identify where those cases are being addressed. @getodk/testers?", "author": "lognaturel", "createdAt": "2020-05-10T20:34:07Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/feature/settings/CustomServerPathsTest.java", "diffHunk": "@@ -0,0 +1,101 @@\n+package org.odk.collect.android.feature.settings;\n+\n+import android.Manifest;\n+import android.webkit.MimeTypeMap;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+import androidx.test.rule.GrantPermissionRule;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.RuleChain;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.injection.config.AppDependencyModule;\n+import org.odk.collect.android.openrosa.OpenRosaHttpInterface;\n+import org.odk.collect.android.support.CopyFormRule;\n+import org.odk.collect.android.support.FeatureTestRule;\n+import org.odk.collect.android.support.ResetStateRule;\n+import org.odk.collect.android.support.StubOpenRosaServer;\n+import org.odk.collect.android.support.pages.GeneralSettingsPage;\n+import org.odk.collect.android.support.pages.MainMenuPage;\n+import org.odk.collect.utilities.UserAgentProvider;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class CustomServerPathsTest {", "originalCommit": "10cec272658ef1652ff80f4036a9df3553f0f4c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NzEzMw==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422697133", "bodyText": "Might be good to have coverage for this admin mode behavior or at least flag it for QA.", "author": "lognaturel", "createdAt": "2020-05-10T20:37:40Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ServerPreferencesFragment.java", "diffHunk": "@@ -76,23 +78,68 @@\n     //protected ExtendedEditTextPreference smsGatewayPreference;\n     protected EditTextPreference submissionUrlPreference;\n     protected EditTextPreference formListUrlPreference;\n-    private ListPopupWindow listPopupWindow;\n-    private Preference selectedGoogleAccountPreference;\n-    private boolean allowClickSelectedGoogleAccountPreference = true;\n \n     @Inject\n     OpenRosaAPIClient openRosaAPIClient;\n-\n     @Inject\n     GoogleAccountsManager accountsManager;\n-\n     @Inject\n     Analytics analytics;\n \n-    /*\n-    private ListPreference transportPreference;\n-    private ExtendedPreferenceCategory smsPreferenceCategory;\n-    */\n+    private ListPopupWindow listPopupWindow;\n+    private Preference selectedGoogleAccountPreference;\n+    private boolean allowClickSelectedGoogleAccountPreference = true;\n+\n+    public static ServerPreferencesFragment newInstance(boolean adminMode) {", "originalCommit": "ab7906f5de7eaa1a939380ee32d6ecaa9ea1e23e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg4OTE1Mw==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422889153", "bodyText": "Great point. @getodk/testers for this PR it would be good to double check the server settings screen in admin mode!", "author": "seadowg", "createdAt": "2020-05-11T08:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NzEzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NzI5Mw==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422697293", "bodyText": "Remove references.xml suffix.", "author": "lognaturel", "createdAt": "2020-05-10T20:39:02Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/GeneralKeys.java", "diffHunk": "@@ -17,7 +17,7 @@\n     public static final String KEY_USERNAME                 = \"username\";\n     public static final String KEY_PASSWORD                 = \"password\";\n \n-    // other_preferences.xml\n+    // custom_server_paths_preferences.xmlreferences.xml", "originalCommit": "1af861d5ad3f109e83c0c68721e885af3af91799", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NzMyMw==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422697323", "bodyText": "custom_server_paths_preferences.xml", "author": "lognaturel", "createdAt": "2020-05-10T20:39:23Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/GeneralKeys.java", "diffHunk": "@@ -132,7 +132,7 @@\n         hashMap.put(KEY_GOOGLE_SHEETS_URL,          \"\");\n         // identity_preferences.xml\n         hashMap.put(KEY_ANALYTICS,                  true);\n-        // other_preferences.xml\n+        // custom_server_paths_preferenceshs_preferences.xml", "originalCommit": "1af861d5ad3f109e83c0c68721e885af3af91799", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NzM0OQ==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422697349", "bodyText": "Rename?", "author": "lognaturel", "createdAt": "2020-05-10T20:39:37Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ServerPreferencesFragment.java", "diffHunk": "@@ -135,9 +136,6 @@ private void initProtocolPrefs() {\n             addAggregatePreferences();", "originalCommit": "1af861d5ad3f109e83c0c68721e885af3af91799", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5Nzg1MQ==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422697851", "bodyText": "Rename?", "author": "lognaturel", "createdAt": "2020-05-10T20:43:51Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/support/pages/ServerSettingsPage.java", "diffHunk": "@@ -23,12 +21,12 @@ public ServerSettingsPage assertOnPage() {\n     }\n \n     public ServerSettingsPage clickOnServerType() {\n-        onData(PreferenceMatchers.withKey(\"protocol\")).perform(click());\n+        onView(withText(getTranslatedString(R.string.type))).perform(click());\n         return this;\n     }\n \n     public ServerSettingsPage clickAggregateUsername() {", "originalCommit": "e046dd8851a47d627f2da6d425440ba4def8a2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5Nzk1Ng==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422697956", "bodyText": "Maybe \"legacy\" doesn't add anything and we should use \"Custom server paths\" everywhere. The detail text about removal is clear enough, I think. I had proposed that wording but now that I've looked at translations for the .settings feature that also uses \"legacy\", I think it can be hard to translate to other languages.", "author": "lognaturel", "createdAt": "2020-05-10T20:44:45Z", "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -743,4 +743,5 @@\n     <string name=\"preference_not_available\">Not available</string>\n     <string name=\"legacy_custom_server_paths\">Legacy custom server paths</string>\n     <string name=\"custom_server_paths\">Custom server paths</string>", "originalCommit": "e046dd8851a47d627f2da6d425440ba4def8a2d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg5MDI1NQ==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422890255", "bodyText": "Makes sense. I'll change it!", "author": "seadowg", "createdAt": "2020-05-11T08:59:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5Nzk1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5ODAwNA==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422698004", "bodyText": "I don't think people know what \"OpenRosa\" is. Could we say \"Please use /formList and /submission on your server\"?", "author": "lognaturel", "createdAt": "2020-05-10T20:45:27Z", "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -743,4 +743,5 @@\n     <string name=\"preference_not_available\">Not available</string>\n     <string name=\"legacy_custom_server_paths\">Legacy custom server paths</string>\n     <string name=\"custom_server_paths\">Custom server paths</string>\n+    <string name=\"legacy_custom_server_paths_summary\">Will be removed in a future version. Please use standard Open Rosa paths on your server.</string>", "originalCommit": "e046dd8851a47d627f2da6d425440ba4def8a2d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg5MjA3MQ==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422892071", "bodyText": "I thought it looked a little weird but I don't have strong feelings about it. I'll change it.", "author": "seadowg", "createdAt": "2020-05-11T09:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5ODAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5ODE1Mg==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r422698152", "bodyText": "I think this can now be untranslated? Or at least the resource name should change to server_platform_odk or server_platform_default.", "author": "lognaturel", "createdAt": "2020-05-10T20:46:34Z", "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -174,7 +174,7 @@\n     <string name=\"save_as_error\">Saved name must not be blank!</string>\n     <string name=\"edit_prompt\">Edit Prompt</string>\n     <string name=\"selected_google_account_text\">Google account</string>\n-    <string name=\"server_platform_odk_aggregate\">ODK Aggregate</string>\n+    <string name=\"server_platform_odk_aggregate\">ODK</string>", "originalCommit": "82293af58e18f3ca216e58fdeb45b039743df719", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5MDQwNw==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r423390407", "bodyText": "This needs to be addressed before this PR is merged so translators get the right thing. Coming back to it, I have a preference for adding an ODK string to untranslated.xml for this instead of sending a translatable string.", "author": "lognaturel", "createdAt": "2020-05-12T00:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5ODE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MTM5NA==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r423571394", "bodyText": "Ach my bad for dismissing. WIll change this!", "author": "seadowg", "createdAt": "2020-05-12T08:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5ODE1Mg=="}], "type": "inlineReview"}, {"oid": "73bbca99d02c1b7c76aeecfc7cbf892ef762c623", "url": "https://github.com/getodk/collect/commit/73bbca99d02c1b7c76aeecfc7cbf892ef762c623", "message": "Rewrite custom server paths test to use stubbed open rosa server", "committedDate": "2020-05-12T09:07:50Z", "type": "commit"}, {"oid": "9f8cefe6da2cd9dfb9ff6b986c5e0b976fa04842", "url": "https://github.com/getodk/collect/commit/9f8cefe6da2cd9dfb9ff6b986c5e0b976fa04842", "message": "Inline unused super class for server preferences", "committedDate": "2020-05-12T09:07:50Z", "type": "commit"}, {"oid": "cbe3a673942623007d6aa399ceda852afdae3b6d", "url": "https://github.com/getodk/collect/commit/cbe3a673942623007d6aa399ceda852afdae3b6d", "message": "Move custom server paths to their own screen", "committedDate": "2020-05-12T09:07:51Z", "type": "commit"}, {"oid": "43ecd1ce54054dbd75cd5168f07e682f39dcc222", "url": "https://github.com/getodk/collect/commit/43ecd1ce54054dbd75cd5168f07e682f39dcc222", "message": "Revise layouts for server preferences", "committedDate": "2020-05-12T09:07:51Z", "type": "commit"}, {"oid": "cc279dd2f7051065cec38c3d7b69db5ae51b82a0", "url": "https://github.com/getodk/collect/commit/cc279dd2f7051065cec38c3d7b69db5ae51b82a0", "message": "Change server type string", "committedDate": "2020-05-12T09:07:51Z", "type": "commit"}, {"oid": "60afe90551925a73f99e580a88a6a56ae5f57076", "url": "https://github.com/getodk/collect/commit/60afe90551925a73f99e580a88a6a56ae5f57076", "message": "Remove unused strings", "committedDate": "2020-05-12T09:07:51Z", "type": "commit"}, {"oid": "138d8c4abd4069f7e9da5e00e9fd55a68362fd56", "url": "https://github.com/getodk/collect/commit/138d8c4abd4069f7e9da5e00e9fd55a68362fd56", "message": "Remove unused strings", "committedDate": "2020-05-12T09:20:06Z", "type": "commit"}, {"oid": "5c893105465871aa14259c37bdacc933b7013ded", "url": "https://github.com/getodk/collect/commit/5c893105465871aa14259c37bdacc933b7013ded", "message": "Revise wording", "committedDate": "2020-05-12T09:20:07Z", "type": "commit"}, {"oid": "ef81e6e30c387b2dc20a93364fcc11f6f27a8da6", "url": "https://github.com/getodk/collect/commit/ef81e6e30c387b2dc20a93364fcc11f6f27a8da6", "message": "Move ODK string to untranslated", "committedDate": "2020-05-12T09:20:08Z", "type": "commit"}, {"oid": "2585d5fdea9a68e1cee7e0a1ee238d4fd7648325", "url": "https://github.com/getodk/collect/commit/2585d5fdea9a68e1cee7e0a1ee238d4fd7648325", "message": "Use correct server type in tests", "committedDate": "2020-05-12T09:20:50Z", "type": "commit"}, {"oid": "2585d5fdea9a68e1cee7e0a1ee238d4fd7648325", "url": "https://github.com/getodk/collect/commit/2585d5fdea9a68e1cee7e0a1ee238d4fd7648325", "message": "Use correct server type in tests", "committedDate": "2020-05-12T09:20:50Z", "type": "forcePushed"}, {"oid": "f2833a145314b0d6a22d40eb4c6dae3c09971f87", "url": "https://github.com/getodk/collect/commit/f2833a145314b0d6a22d40eb4c6dae3c09971f87", "message": "Fix preferences crash when rotating screen", "committedDate": "2020-05-12T14:05:38Z", "type": "commit"}, {"oid": "e40a2df6db6423de32831c7b9ef35b19acb2145d", "url": "https://github.com/getodk/collect/commit/e40a2df6db6423de32831c7b9ef35b19acb2145d", "message": "Pull out and test protocol mapping logic", "committedDate": "2020-05-12T14:46:27Z", "type": "commit"}, {"oid": "7826f96450fc235500454aed5bacdbcbee894108", "url": "https://github.com/getodk/collect/commit/7826f96450fc235500454aed5bacdbcbee894108", "message": "Add migration fro other server type", "committedDate": "2020-05-12T15:58:29Z", "type": "commit"}, {"oid": "86637a3af3d823494463f93c1eeca8be6e61b380", "url": "https://github.com/getodk/collect/commit/86637a3af3d823494463f93c1eeca8be6e61b380", "message": "Add regression tests tags to tests", "committedDate": "2020-05-13T09:24:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg1NTIxMg==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r430855212", "bodyText": "This and ValueTranslator feel somewhat disjoint from the migration tools in org.odk.collect.android.preferences. It would be good to consolidate them in your follow-up.", "author": "lognaturel", "createdAt": "2020-05-27T04:49:56Z", "path": "collect_app/src/main/java/org/odk/collect/android/application/initialization/migration/MigrationUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.application.initialization.migration;", "originalCommit": "7826f96450fc235500454aed5bacdbcbee894108", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkyNDQ0MQ==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r430924441", "bodyText": "@lognaturel they fit the structure that #3813 introduces so should fit in when these are merged \ud83d\ude00", "author": "seadowg", "createdAt": "2020-05-27T07:53:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg1NTIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODAzNQ==", "url": "https://github.com/getodk/collect/pull/3818#discussion_r431438035", "bodyText": "Oh great, I only went for a skim on that one since it was already reviewed!", "author": "lognaturel", "createdAt": "2020-05-27T20:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg1NTIxMg=="}], "type": "inlineReview"}, {"oid": "40fac56802b20fce016795c10ace111d66f75fd9", "url": "https://github.com/getodk/collect/commit/40fac56802b20fce016795c10ace111d66f75fd9", "message": "Correct server type dialog title", "committedDate": "2020-05-27T14:46:30Z", "type": "commit"}, {"oid": "40fac56802b20fce016795c10ace111d66f75fd9", "url": "https://github.com/getodk/collect/commit/40fac56802b20fce016795c10ace111d66f75fd9", "message": "Correct server type dialog title", "committedDate": "2020-05-27T14:46:30Z", "type": "forcePushed"}, {"oid": "796da8bf8506bfa4668d49a9f4e10813c1e39495", "url": "https://github.com/getodk/collect/commit/796da8bf8506bfa4668d49a9f4e10813c1e39495", "message": "Merge branch 'master' into server-settings", "committedDate": "2020-05-27T15:08:17Z", "type": "commit"}, {"oid": "b5da578858dd5c72f1e893fa9d1d55b4e59a3b09", "url": "https://github.com/getodk/collect/commit/b5da578858dd5c72f1e893fa9d1d55b4e59a3b09", "message": "Merge remote-tracking branch 'opendatakit/master' into server-settings", "committedDate": "2020-05-28T08:24:17Z", "type": "commit"}, {"oid": "003dade85f6b59ab8706472837ceb0e7a715f907", "url": "https://github.com/getodk/collect/commit/003dade85f6b59ab8706472837ceb0e7a715f907", "message": "Correct test rule name", "committedDate": "2020-05-28T08:37:53Z", "type": "commit"}, {"oid": "63df97dcf309147b7a9c33a8664a8d6056b2d0df", "url": "https://github.com/getodk/collect/commit/63df97dcf309147b7a9c33a8664a8d6056b2d0df", "message": "Don't allow multiclick on custom server paths button", "committedDate": "2020-06-03T14:11:42Z", "type": "commit"}, {"oid": "bce2c9b4b3b7b5bc3153ccc8932a6f36d8f9dd09", "url": "https://github.com/getodk/collect/commit/bce2c9b4b3b7b5bc3153ccc8932a6f36d8f9dd09", "message": "Stop server paths from being reset to default when loaded", "committedDate": "2020-06-03T14:33:49Z", "type": "commit"}]}