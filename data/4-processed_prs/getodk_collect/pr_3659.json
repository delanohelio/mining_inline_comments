{"pr_number": 3659, "pr_title": "Revise main menu layout/design", "pr_createdAt": "2020-02-28T17:03:06Z", "pr_url": "https://github.com/getodk/collect/pull/3659", "timeline": [{"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9", "url": "https://github.com/getodk/collect/commit/e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9", "message": "Use MaterialToolbar on Main Menu", "committedDate": "2020-03-02T16:40:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTAxNQ==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386539015", "bodyText": "How did you decide to remove the v? We have the v prefix everywhere that we show a Collect version including GitHub releases, the forum, the Play Store release notes, etc. That's the case across all ODK tools. I like the consistency and would personally keep the v in.", "author": "lognaturel", "createdAt": "2020-03-02T17:31:08Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);\n+\n+        if (split.length > 1) {\n+            return split[1];\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    private String versionNameWithoutPrefix() {\n+        return BuildConfig.VERSION_NAME.split(\"v\")[1];", "originalCommit": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU0MDkzNQ==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386540935", "bodyText": "Yeah no strong feeling really. Will change this.", "author": "seadowg", "createdAt": "2020-03-02T17:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTk4MQ==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386539981", "bodyText": "This means that for beta versions the beta will be at the bottom of the screen. I think of the beta as being part of the version (e.g. we put v1.26.0-beta.0 in the release notes) and I think it's helpful to have up top.", "author": "lognaturel", "createdAt": "2020-03-02T17:32:52Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);", "originalCommit": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU0MTc0NQ==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386541745", "bodyText": "Make sense. I'll change it!", "author": "seadowg", "createdAt": "2020-03-02T17:36:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTk4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386573940", "bodyText": "Nice! These tests end up looking really nice.\nI probably would have pushed all the methods now in the view model into the version provider class and kept the view model super thin so that tests wouldn't need Robolectric and to limit the dependence on Android-specific components for paranoia reasons but I do like how all this ends up looking.", "author": "lognaturel", "createdAt": "2020-03-02T18:37:21Z", "path": "collect_app/src/test/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModelTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class MainMenuViewModelTest {\n+\n+    @Test\n+    public void version_whenRelease_returnsSemanticVersionWithPrefix() {\n+        MainMenuViewModel viewModel = new MainMenuViewModel(() -> \"v1.1.7\");", "originalCommit": "42e75e433fa2627207ce5bafec3330ca0a7ce340", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3NTU0Mg==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386575542", "bodyText": "Yeah another step would be to extract a VersionDescriptionParser to deal with all this (and move the tests there) but I don't think that's worth it until the ViewModel is doing other things.", "author": "seadowg", "createdAt": "2020-03-02T18:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3NTgxMw==", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386575813", "bodyText": "Makes sense!", "author": "lognaturel", "createdAt": "2020-03-02T18:40:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA=="}], "type": "inlineReview"}, {"oid": "618a2eceeb8e7b62bdf1279f0484353db825ca00", "url": "https://github.com/getodk/collect/commit/618a2eceeb8e7b62bdf1279f0484353db825ca00", "message": "Remove unused imports", "committedDate": "2020-03-04T11:16:23Z", "type": "forcePushed"}, {"oid": "5e0827cafb284e3116147155b0540280965d944d", "url": "https://github.com/getodk/collect/commit/5e0827cafb284e3116147155b0540280965d944d", "message": "Remove tag line and title from Main Menu", "committedDate": "2020-03-04T11:55:19Z", "type": "commit"}, {"oid": "29da843210d96262a665694b85886e5c94fffc89", "url": "https://github.com/getodk/collect/commit/29da843210d96262a665694b85886e5c94fffc89", "message": "Use MaterialButtons in MainMenu", "committedDate": "2020-03-04T11:55:19Z", "type": "commit"}, {"oid": "d49e0a65441805f6404f54c0be1873e75e22216a", "url": "https://github.com/getodk/collect/commit/d49e0a65441805f6404f54c0be1873e75e22216a", "message": "Use version name to get Main Menu title", "committedDate": "2020-03-04T11:55:19Z", "type": "commit"}, {"oid": "332d2ad934090b459d025b1ea595dd3f2b0419d3", "url": "https://github.com/getodk/collect/commit/332d2ad934090b459d025b1ea595dd3f2b0419d3", "message": "Make button style more accessible by removing all caps", "committedDate": "2020-03-04T11:55:19Z", "type": "commit"}, {"oid": "410bd4079a73a8d4e77d5e68a633a4956bd05f8c", "url": "https://github.com/getodk/collect/commit/410bd4079a73a8d4e77d5e68a633a4956bd05f8c", "message": "Use old styles for main menu buttons", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "de16b10a5caf8a06a9b033c4d805d1bad3b8613d", "url": "https://github.com/getodk/collect/commit/de16b10a5caf8a06a9b033c4d805d1bad3b8613d", "message": "Reduce top button padding", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "f95bcb0a505deba59a1e560f319e29339595a075", "url": "https://github.com/getodk/collect/commit/f95bcb0a505deba59a1e560f319e29339595a075", "message": "Remove tests covered by Espresso", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "add6a3eb7f89c31f30a6a13f55893a353bb11553", "url": "https://github.com/getodk/collect/commit/add6a3eb7f89c31f30a6a13f55893a353bb11553", "message": "Remove unused string", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "9352530d10a14b105328e34685791ada52e7e9df", "url": "https://github.com/getodk/collect/commit/9352530d10a14b105328e34685791ada52e7e9df", "message": "Correct app name", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "cd16047c595fbfbeaa9c3ae2d0fa2fc7e6c8a024", "url": "https://github.com/getodk/collect/commit/cd16047c595fbfbeaa9c3ae2d0fa2fc7e6c8a024", "message": "Move version logic to view model", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "b6502742366ae14e69989b75013a8401f6b2f3f7", "url": "https://github.com/getodk/collect/commit/b6502742366ae14e69989b75013a8401f6b2f3f7", "message": "Add version sha to main menu", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "29ff188956a53a4c57deac99c0891081042e232c", "url": "https://github.com/getodk/collect/commit/29ff188956a53a4c57deac99c0891081042e232c", "message": "Use MaterialToolbar on Main Menu", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "55c53a731d03c66c6015617e3d54437764aed8a6", "url": "https://github.com/getodk/collect/commit/55c53a731d03c66c6015617e3d54437764aed8a6", "message": "Include beta in toolbar title", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "2026d532f2a0b8f7f30062798cd5bd00099090eb", "url": "https://github.com/getodk/collect/commit/2026d532f2a0b8f7f30062798cd5bd00099090eb", "message": "Use lighter primary color in dark theme", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "b4e64341c3d9a80921c23313df21e465bd4550bf", "url": "https://github.com/getodk/collect/commit/b4e64341c3d9a80921c23313df21e465bd4550bf", "message": "Remove unused imports", "committedDate": "2020-03-04T11:55:20Z", "type": "commit"}, {"oid": "b4e64341c3d9a80921c23313df21e465bd4550bf", "url": "https://github.com/getodk/collect/commit/b4e64341c3d9a80921c23313df21e465bd4550bf", "message": "Remove unused imports", "committedDate": "2020-03-04T11:55:20Z", "type": "forcePushed"}]}