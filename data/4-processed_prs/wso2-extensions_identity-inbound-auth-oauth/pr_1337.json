{"pr_number": 1337, "pr_title": "Fix validating id token encryption algorithm and method", "pr_createdAt": "2020-02-28T10:17:35Z", "pr_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337", "timeline": [{"oid": "2ba6b892cfa18a3ff2c5016c2b8b2263ce374dc1", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/2ba6b892cfa18a3ff2c5016c2b8b2263ce374dc1", "message": "Fix validating id token encryption algorithm and method", "committedDate": "2020-02-28T10:13:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMjk5Ng==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r385632996", "bodyText": "Add new line", "author": "janakamarasena", "createdAt": "2020-02-28T10:58:41Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -1295,6 +1308,44 @@ void logOnInvalidConfig(String appName, String tokenType, long defaultValue) {\n         return requestedScopeValidators;\n     }\n \n+\n+    /**\n+     * Get the IdToken Encryption Method registered by the user and filter the allowed one.\n+     *\n+     * @param application Application user have registered\n+     * @return idTokenEncryptionMethod\n+     * @throws IdentityOAuthAdminException Identity OAuthAdmin exception.\n+     */\n+    String filterIdTokenEncryptionMethod(OAuthConsumerAppDTO application) throws IdentityOAuthAdminException {\n+        List<String> supportedIdTokenEncryptionMethods = OAuthServerConfiguration.getInstance()\n+                .getSupportedIdTokenEncryptionMethods();\n+        String idTokenEncryptionMethod = application.getIdTokenEncryptionMethod();\n+        if (!supportedIdTokenEncryptionMethods.contains(idTokenEncryptionMethod)) {\n+            String msg = String.format(\"'%s' IdToken Encryption Method is not allowed.\", idTokenEncryptionMethod);\n+            throw handleClientError(INVALID_REQUEST, msg);\n+        }\n+        return idTokenEncryptionMethod;\n+    }\n+\n+    /**\n+     * Get the IdToken Encryption Algorithm registered by the user and filter the allowed one.\n+     *\n+     * @param application Application user have registered\n+     * @return idTokenEncryptionAlgorithm\n+     * @throws IdentityOAuthAdminException Identity OAuthAdmin exception.\n+     */\n+    String filterIdTokenEncryptionAlgorithm(OAuthConsumerAppDTO application) throws IdentityOAuthAdminException {\n+        List<String> supportedIdTokenEncryptionAlgorithms = OAuthServerConfiguration.getInstance()", "originalCommit": "2ba6b892cfa18a3ff2c5016c2b8b2263ce374dc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzNzU3Mg==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r385637572", "bodyText": "Fixed", "author": "Sathiyakugan", "createdAt": "2020-02-28T11:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMjk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMzA5Ng==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r385633096", "bodyText": "Remove extra line", "author": "janakamarasena", "createdAt": "2020-02-28T10:58:53Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -1295,6 +1308,44 @@ void logOnInvalidConfig(String appName, String tokenType, long defaultValue) {\n         return requestedScopeValidators;\n     }\n \n+\n+    /**\n+     * Get the IdToken Encryption Method registered by the user and filter the allowed one.\n+     *\n+     * @param application Application user have registered\n+     * @return idTokenEncryptionMethod\n+     * @throws IdentityOAuthAdminException Identity OAuthAdmin exception.\n+     */\n+    String filterIdTokenEncryptionMethod(OAuthConsumerAppDTO application) throws IdentityOAuthAdminException {\n+        List<String> supportedIdTokenEncryptionMethods = OAuthServerConfiguration.getInstance()\n+                .getSupportedIdTokenEncryptionMethods();\n+        String idTokenEncryptionMethod = application.getIdTokenEncryptionMethod();\n+        if (!supportedIdTokenEncryptionMethods.contains(idTokenEncryptionMethod)) {\n+            String msg = String.format(\"'%s' IdToken Encryption Method is not allowed.\", idTokenEncryptionMethod);\n+            throw handleClientError(INVALID_REQUEST, msg);\n+        }\n+        return idTokenEncryptionMethod;\n+    }\n+\n+    /**\n+     * Get the IdToken Encryption Algorithm registered by the user and filter the allowed one.\n+     *\n+     * @param application Application user have registered\n+     * @return idTokenEncryptionAlgorithm\n+     * @throws IdentityOAuthAdminException Identity OAuthAdmin exception.\n+     */\n+    String filterIdTokenEncryptionAlgorithm(OAuthConsumerAppDTO application) throws IdentityOAuthAdminException {\n+        List<String> supportedIdTokenEncryptionAlgorithms = OAuthServerConfiguration.getInstance()\n+                .getSupportedIdTokenEncryptionAlgorithm();\n+        String idTokenEncryptionAlgorithm = application.getIdTokenEncryptionAlgorithm();\n+        if (!supportedIdTokenEncryptionAlgorithms.contains(idTokenEncryptionAlgorithm)) {\n+            String msg = String.format(\"'%s' IdToken Encryption Method is not allowed.\", idTokenEncryptionAlgorithm);\n+            throw handleClientError(INVALID_REQUEST, msg);\n+        }\n+        return idTokenEncryptionAlgorithm;\n+    }\n+", "originalCommit": "2ba6b892cfa18a3ff2c5016c2b8b2263ce374dc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzNzU5MQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r385637591", "bodyText": "Fixed", "author": "Sathiyakugan", "createdAt": "2020-02-28T11:09:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMzA5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMzI3MQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r385633271", "bodyText": "remove extra line", "author": "janakamarasena", "createdAt": "2020-02-28T10:59:17Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -1295,6 +1308,44 @@ void logOnInvalidConfig(String appName, String tokenType, long defaultValue) {\n         return requestedScopeValidators;\n     }\n \n+", "originalCommit": "2ba6b892cfa18a3ff2c5016c2b8b2263ce374dc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzNzYwNw==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r385637607", "bodyText": "Fixed", "author": "Sathiyakugan", "createdAt": "2020-02-28T11:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMzI3MQ=="}], "type": "inlineReview"}, {"oid": "b4875b1c8a1e92f0fc8c01dcf04f5d27528c1364", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/b4875b1c8a1e92f0fc8c01dcf04f5d27528c1364", "message": "fix the formatting issues", "committedDate": "2020-02-28T11:07:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDI1Mg==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r502750252", "bodyText": "Isn't this redundant?", "author": "darshanasbg", "createdAt": "2020-10-10T05:42:49Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -279,9 +279,16 @@ public OAuthConsumerAppDTO registerAndRetrieveOAuthApplicationData(OAuthConsumer\n                     // Set OIDC Config Properties.\n                     app.setRequestObjectSignatureValidationEnabled(\n                             application.isRequestObjectSignatureValidationEnabled());\n-                    app.setIdTokenEncryptionEnabled(application.isIdTokenEncryptionEnabled());\n-                    app.setIdTokenEncryptionAlgorithm(application.getIdTokenEncryptionAlgorithm());\n-                    app.setIdTokenEncryptionMethod(application.getIdTokenEncryptionMethod());\n+\n+                    // Validate IdToken Encryption configurations.\n+                    if (application.isIdTokenEncryptionEnabled()) {\n+                        app.setIdTokenEncryptionEnabled(application.isIdTokenEncryptionEnabled());\n+                        if (application.isIdTokenEncryptionEnabled()) {", "originalCommit": "b4875b1c8a1e92f0fc8c01dcf04f5d27528c1364", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2Mzc0Mg==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r503463742", "bodyText": "Fixed in 4adb239#diff-1e769d65ab3dba0fc2f6ab9b801f1e72", "author": "Sathiyakugan", "createdAt": "2020-10-12T18:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDI2MQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r502750261", "bodyText": "Isn't this redundant?", "author": "darshanasbg", "createdAt": "2020-10-10T05:42:54Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -449,9 +456,15 @@ public void updateConsumerApplication(OAuthConsumerAppDTO consumerAppDTO) throws\n             oauthappdo.setScopeValidators(filterScopeValidators(consumerAppDTO));\n             oauthappdo.setRequestObjectSignatureValidationEnabled(consumerAppDTO\n                     .isRequestObjectSignatureValidationEnabled());\n-            oauthappdo.setIdTokenEncryptionEnabled(consumerAppDTO.isIdTokenEncryptionEnabled());\n-            oauthappdo.setIdTokenEncryptionAlgorithm(consumerAppDTO.getIdTokenEncryptionAlgorithm());\n-            oauthappdo.setIdTokenEncryptionMethod(consumerAppDTO.getIdTokenEncryptionMethod());\n+            // Validate IdToken Encryption configurations.\n+            if (consumerAppDTO.isIdTokenEncryptionEnabled()) {\n+                oauthappdo.setIdTokenEncryptionEnabled(consumerAppDTO.isIdTokenEncryptionEnabled());\n+                if (consumerAppDTO.isIdTokenEncryptionEnabled()) {", "originalCommit": "b4875b1c8a1e92f0fc8c01dcf04f5d27528c1364", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2Mzc5Mg==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r503463792", "bodyText": "Fixed in 4adb239#diff-1e769d65ab3dba0fc2f6ab9b801f1e72", "author": "Sathiyakugan", "createdAt": "2020-10-12T18:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDMzNg==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r502750336", "bodyText": "Should this be a private method?", "author": "darshanasbg", "createdAt": "2020-10-10T05:44:16Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -1295,6 +1308,45 @@ void logOnInvalidConfig(String appName, String tokenType, long defaultValue) {\n         return requestedScopeValidators;\n     }\n \n+\n+    /**\n+     * Get the IdToken Encryption Method registered by the user and filter the allowed one.\n+     *\n+     * @param application Application user have registered\n+     * @return idTokenEncryptionMethod\n+     * @throws IdentityOAuthAdminException Identity OAuthAdmin exception.\n+     */\n+    String filterIdTokenEncryptionMethod(OAuthConsumerAppDTO application) throws IdentityOAuthAdminException {", "originalCommit": "b4875b1c8a1e92f0fc8c01dcf04f5d27528c1364", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4OTY3MQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1337#discussion_r516689671", "bodyText": "Fixed with #1470", "author": "Sathiyakugan", "createdAt": "2020-11-03T14:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDMzNg=="}], "type": "inlineReview"}]}