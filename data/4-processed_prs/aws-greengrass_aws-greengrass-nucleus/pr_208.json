{"pr_number": 208, "pr_title": "Fixing more race conditions", "pr_createdAt": "2020-04-22T23:55:56Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MDcwNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208#discussion_r413950707", "bodyText": "Why only add the check in requestRestart()? Shouldn't this be also added to the rest request* methods?", "author": "fengwang666", "createdAt": "2020-04-23T16:37:05Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -634,6 +634,10 @@ final void requestReinstall() {\n      */\n     final void requestRestart() {\n         synchronized (desiredStateList) {\n+            // Ignore restart requests if the service is closed\n+            if (isClosed.get()) {\n+                return;\n+            }", "originalCommit": "4c7dfb4c78f4589b93b12541a9b0b05fd3e70203", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MjU5OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208#discussion_r413952598", "bodyText": "Quite possibly, yes, except for requestStop. The race condition which I think I was seeing is that during shutdown, it was requesting restart due to dependencies changing states.", "author": "MikeDombo", "createdAt": "2020-04-23T16:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MDcwNw=="}], "type": "inlineReview"}, {"oid": "ac79134764de28c710f4cf42a10b76de78f9632d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ac79134764de28c710f4cf42a10b76de78f9632d", "message": "Fix flaky test unable to shutdown due to race in close() with requestRestart()", "committedDate": "2020-04-23T18:01:08Z", "type": "commit"}, {"oid": "ae88c74744242134229c33edbfda1e083f6dc705", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae88c74744242134229c33edbfda1e083f6dc705", "message": "Add EGExtension to E2E test", "committedDate": "2020-04-23T18:01:08Z", "type": "commit"}, {"oid": "2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "message": "Add closed check to all except requestStop. Ignore rare IPC exception", "committedDate": "2020-04-23T18:01:08Z", "type": "commit"}, {"oid": "2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "message": "Add closed check to all except requestStop. Ignore rare IPC exception", "committedDate": "2020-04-23T18:01:08Z", "type": "forcePushed"}]}