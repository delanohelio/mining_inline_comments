{"pr_number": 291, "pr_title": "Split coverage reports and checks for unit and integ tests", "pr_createdAt": "2020-06-25T22:17:45Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MDE5OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445870199", "bodyText": "This won't work. It will only put 1 comment and the second will overwrite the first.", "author": "MikeDombo", "createdAt": "2020-06-25T22:19:41Z", "path": ".github/workflows/maven.yml", "diffHunk": "@@ -58,6 +60,24 @@ jobs:\n           show_branch: true\n           # Use class names instead of the filename\n           show_class_names: true\n+      - name: cobertura-report-integration-test", "originalCommit": "5b127ed6497a6a3ee79eeb335972a7ed80d6f297", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MzIxMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445873211", "bodyText": "Right, let me check, I created a pull request anyway to run all actions and test but having a hard time to reach this point due to test failures. Will change when I'm able to test it", "author": "shaguptashaikh", "createdAt": "2020-06-25T22:28:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MDE5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg4Nzc2OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445887769", "bodyText": "So it doesn't publish a new report rather edits the comment, even if the build step is split into two for unit and integ tests it will retain that behavior. So we will probably need to keep this report merged and only split the minimum coverage requirements", "author": "shaguptashaikh", "createdAt": "2020-06-25T23:13:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MDE5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg4ODIyMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445888223", "bodyText": "Yes, that is what I meant. You can't get 2 coverage reports as comments.", "author": "MikeDombo", "createdAt": "2020-06-25T23:15:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MDE5OQ=="}], "type": "inlineReview"}, {"oid": "5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "message": "Split coverage reports and checks for unit and integ tests", "committedDate": "2020-06-25T22:31:03Z", "type": "commit"}, {"oid": "5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "message": "Split coverage reports and checks for unit and integ tests", "committedDate": "2020-06-25T22:31:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk0NjU1NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445946554", "bodyText": "Why add complexity too? Should we just settle on a single metric like line, branch, or instruction?", "author": "MikeDombo", "createdAt": "2020-06-26T03:16:57Z", "path": "pom.xml", "diffHunk": "@@ -376,53 +376,80 @@\n                         </goals>\n                     </execution>\n                     <execution>\n-                        <id>merge-results</id>\n+                        <id>unit-test-report</id>\n                         <phase>verify</phase>\n                         <goals>\n-                            <goal>merge</goal>\n+                            <goal>report</goal>\n                         </goals>\n                         <configuration>\n-                            <fileSets>\n-                                <fileSet>\n-                                    <directory>${project.build.directory}</directory>\n-                                    <includes>\n-                                        <include>*.exec</include>\n-                                    </includes>\n-                                    <excludes>\n-                                        <exclude>aggregate.exec</exclude>\n-                                    </excludes>\n-                                </fileSet>\n-                            </fileSets>\n-                            <destFile>${project.build.directory}/aggregate.exec</destFile>\n+                            <dataFile>${project.build.directory}/jacoco.exec</dataFile>\n+                            <outputDirectory>target/jacoco-report</outputDirectory>\n                         </configuration>\n                     </execution>\n                     <execution>\n-                        <id>post-merge-report</id>\n+                        <id>integration-test-report</id>\n                         <phase>verify</phase>\n                         <goals>\n                             <goal>report</goal>\n                         </goals>\n                         <configuration>\n-                            <dataFile>${project.build.directory}/aggregate.exec</dataFile>\n-                            <outputDirectory>target/jacoco-report</outputDirectory>\n+                            <dataFile>${project.build.directory}/jacoco-it.exec</dataFile>\n+                            <outputDirectory>target/jacoco-report/jacoco-it</outputDirectory>\n                         </configuration>\n                     </execution>\n                     <execution>\n-                        <id>jacoco-check</id>\n+                        <id>jacoco-check-unit-test</id>\n                         <phase>verify</phase>\n                         <goals>\n                             <goal>check</goal>\n                         </goals>\n                         <configuration>\n-                            <dataFile>${project.build.directory}/aggregate.exec</dataFile>\n+                            <dataFile>${project.build.directory}/jacoco.exec</dataFile>\n                             <rules>\n                                 <rule>\n                                     <element>BUNDLE</element>\n                                     <limits>\n                                         <limit>\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.81</minimum>\n+                                            <minimum>0.66</minimum>\n+                                        </limit>\n+                                        <limit>\n+                                            <counter>LINE</counter>\n+                                            <value>COVEREDRATIO</value>\n+                                            <minimum>0.67</minimum>\n+                                        </limit>\n+                                        <limit>\n+                                            <counter>BRANCH</counter>\n+                                            <value>COVEREDRATIO</value>\n+                                            <minimum>0.59</minimum>\n+                                        </limit>\n+                                    </limits>\n+                                </rule>\n+                            </rules>\n+                        </configuration>\n+                    </execution>\n+                    <execution>\n+                        <id>jacoco-check-integration-test</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>check</goal>\n+                        </goals>\n+                        <configuration>\n+                            <dataFile>${project.build.directory}/jacoco-it.exec</dataFile>\n+                            <rules>\n+                                <rule>\n+                                    <element>BUNDLE</element>\n+                                    <limits>\n+                                        <limit>\n+                                            <counter>INSTRUCTION</counter>\n+                                            <value>COVEREDRATIO</value>\n+                                            <minimum>0.58</minimum>\n+                                        </limit>\n+                                        <limit>\n+                                            <counter>COMPLEXITY</counter>", "originalCommit": "117eafa68eb76766c2213499d748031385239682", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cc4be6c93d06036cc14f04282aad2575989990a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cc4be6c93d06036cc14f04282aad2575989990a", "message": "[testing-only] enhancements to reports", "committedDate": "2020-06-26T18:48:44Z", "type": "commit"}, {"oid": "4cc4be6c93d06036cc14f04282aad2575989990a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cc4be6c93d06036cc14f04282aad2575989990a", "message": "[testing-only] enhancements to reports", "committedDate": "2020-06-26T18:48:44Z", "type": "forcePushed"}]}