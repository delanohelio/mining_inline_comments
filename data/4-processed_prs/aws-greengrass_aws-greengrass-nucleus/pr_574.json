{"pr_number": 574, "pr_title": "Shadow deployment report state", "pr_createdAt": "2020-10-27T05:01:15Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574", "timeline": [{"oid": "e76736d2852631cfcc080b5ae0346e01f9495f39", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e76736d2852631cfcc080b5ae0346e01f9495f39", "message": "add some fields", "committedDate": "2020-10-27T14:48:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0MDI0NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r513040244", "bodyText": "you remove the desiredStateQueue all state required to update the reported state of shadow are present in Map<String, Object> deploymentDetails", "author": "fahadmohammed01", "createdAt": "2020-10-27T21:21:46Z", "path": "src/main/java/com/aws/greengrass/deployment/ShadowDeploymentListener.java", "diffHunk": "@@ -182,51 +183,48 @@ private void publishToGetDeviceShadowTopic() {\n \n     @SuppressFBWarnings\n     private Boolean deploymentStatusChanged(Map<String, Object> deploymentDetails) {\n-        DeploymentStatus status = DeploymentStatus.valueOf((String)\n-                deploymentDetails.get(DEPLOYMENT_STATUS_KEY_NAME));\n-\n         String configurationArn = (String) deploymentDetails.get(DEPLOYMENT_ID_KEY_NAME);\n-        // only update reported state when the deployment succeeds.\n-        if (DeploymentStatus.SUCCEEDED.equals(status)) {\n-\n-            Pair<String, Map<String, Object>> desired = desiredStateQueue.peek();\n-            // discard configurations that might have got added to the queue but the deployment\n-            // got discarded before being processed due to a new shadow deployment\n-            while (desired != null && !desired.getLeft().equals(configurationArn)) {\n-                desiredStateQueue.poll();\n-                desired = desiredStateQueue.peek();\n-            }\n+        Pair<String, Map<String, Object>> desired = desiredStateQueue.peek();\n+        // discard configurations that might have got added to the queue but the deployment\n+        // got discarded before being processed due to a new shadow deployment\n+        while (desired != null && !desired.getLeft().equals(configurationArn)) {", "originalCommit": "e76736d2852631cfcc080b5ae0346e01f9495f39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7847957e75265d358ceb8953f0742dcc80efe45b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7847957e75265d358ceb8953f0742dcc80efe45b", "message": "finish impl", "committedDate": "2020-10-29T00:57:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxOTU0Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r515419542", "bodyText": "Lets create a new hash map here, wouldnt this just add two more keys with the same value while keeping the originals keys DEPLOYMENT_DETAILED_STATUS_KEY, DEPLOYMENT_FAILURE_CAUSE_KEY", "author": "fahadmohammed01", "createdAt": "2020-10-30T23:13:12Z", "path": "src/main/java/com/aws/greengrass/deployment/ShadowDeploymentListener.java", "diffHunk": "@@ -182,59 +189,52 @@ private void publishToGetDeviceShadowTopic() {\n \n     @SuppressFBWarnings\n     private Boolean deploymentStatusChanged(Map<String, Object> deploymentDetails) {\n-        DeploymentStatus status = DeploymentStatus.valueOf((String)\n-                deploymentDetails.get(DEPLOYMENT_STATUS_KEY_NAME));\n-\n         String configurationArn = (String) deploymentDetails.get(DEPLOYMENT_ID_KEY_NAME);\n-        // only update reported state when the deployment succeeds.\n-        if (DeploymentStatus.SUCCEEDED.equals(status)) {\n+        try {\n+            ShadowState shadowState = new ShadowState();\n+            shadowState.reported = getReportedShadowState(deploymentDetails);\n+            UpdateNamedShadowRequest updateNamedShadowRequest = new UpdateNamedShadowRequest();\n+            updateNamedShadowRequest.shadowName = DEPLOYMENT_SHADOW_NAME;\n+            updateNamedShadowRequest.thingName = thingName;\n+            updateNamedShadowRequest.state = shadowState;\n+            iotShadowClient.PublishUpdateNamedShadow(updateNamedShadowRequest, QualityOfService.AT_LEAST_ONCE)\n+                    .get(TIMEOUT_FOR_PUBLISHING_TO_TOPICS_SECONDS, TimeUnit.SECONDS);\n+            logger.atInfo().kv(CONFIGURATION_ARN_LOG_KEY_NAME, configurationArn)\n+                    .log(\"Updated reported state for deployment\");\n+            return true;\n+        } catch (InterruptedException e) {\n+            //Since this method can run as runnable cannot throw exception so handling exceptions here\n+            logger.atWarn().log(\"Interrupted while publishing reported state\");\n+        } catch (ExecutionException e) {\n+            logger.atError().setCause(e).log(\"Caught exception while publishing reported state\");\n+        } catch (TimeoutException e) {\n+            logger.atWarn().setCause(e).log(\"Publish reported state timed out, will retry shortly\");\n+        }\n+        return false;\n+    }\n \n-            Pair<String, Map<String, Object>> desired = desiredStateQueue.peek();\n-            // discard configurations that might have got added to the queue but the deployment\n-            // got discarded before being processed due to a new shadow deployment\n-            while (desired != null && !desired.getLeft().equals(configurationArn)) {\n-                desiredStateQueue.poll();\n-                desired = desiredStateQueue.peek();\n-            }\n+    @SuppressWarnings(\"PMD.LooseCoupling\")\n+    private HashMap<String, Object> getReportedShadowState(Map<String, Object> deploymentDetails) {\n+        HashMap<String, Object> statusDetails =\n+                (HashMap<String, Object>) deploymentDetails.get(DEPLOYMENT_STATUS_DETAILS_KEY_NAME);\n+        statusDetails.put(DETAILED_STATUS_KEY, statusDetails.get(DEPLOYMENT_DETAILED_STATUS_KEY));", "originalCommit": "004427fa7d0e14d4d748f35db61a4a77db7f6683", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcyMDk5OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r515720998", "bodyText": "Oops meant to do that", "author": "tilo-chen", "createdAt": "2020-11-02T03:13:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxOTU0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQyMTA5Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r515421093", "bodyText": "Line256 should use configuration.get(FLEET_CONFIG_KEY)) instead of configuration. Can we test this by pointing to a different shadow and updating the shadow (simulate cloud)", "author": "fahadmohammed01", "createdAt": "2020-10-30T23:20:52Z", "path": "src/main/java/com/aws/greengrass/deployment/ShadowDeploymentListener.java", "diffHunk": "@@ -259,9 +259,12 @@ protected void shadowUpdated(Map<String, Object> configuration, Integer version)\n             return;\n         }\n \n-        desiredStateQueue.add(new Pair<>(configurationArn, configuration));\n-        Deployment deployment =\n-                new Deployment(configurationString, DeploymentType.SHADOW, configurationArn);\n+        Deployment deployment;", "originalCommit": "004427fa7d0e14d4d748f35db61a4a77db7f6683", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcxODM5Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r515718393", "bodyText": "Fixed", "author": "tilo-chen", "createdAt": "2020-11-02T02:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQyMTA5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQyMTI0Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r515421242", "bodyText": "we dont need this check, the deployment details can be emitted for both shadow and jobs deployments. Lets not check this in as it would break existing e2e and FSS related UAT's", "author": "fahadmohammed01", "createdAt": "2020-10-30T23:21:44Z", "path": "src/main/java/com/aws/greengrass/status/FleetStatusService.java", "diffHunk": "@@ -240,6 +246,13 @@ private Boolean deploymentStatusChanged(Map<String, Object> deploymentDetails) {\n             logger.atDebug().log(\"Updating Fleet Status service for deployment with ID: {}\",\n                     deploymentDetails.get(DEPLOYMENT_ID_KEY_NAME));\n             isDeploymentInProgress.set(false);\n+            if (type == SHADOW) {", "originalCommit": "004427fa7d0e14d4d748f35db61a4a77db7f6683", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcyMjg5OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r515722899", "bodyText": "Removed the check.", "author": "tilo-chen", "createdAt": "2020-11-02T03:23:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQyMTI0Mg=="}], "type": "inlineReview"}, {"oid": "4c308968b72727f9e940271e35b1681441b9f0c1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4c308968b72727f9e940271e35b1681441b9f0c1", "message": "draft shadow deployment report state", "committedDate": "2020-11-02T02:40:17Z", "type": "commit"}, {"oid": "7f274761b315695e001f428a6135e315e4ec0b54", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7f274761b315695e001f428a6135e315e4ec0b54", "message": "add some fields", "committedDate": "2020-11-02T02:40:17Z", "type": "commit"}, {"oid": "3d513734c4bce25576096fe63ad4e8bba9242464", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3d513734c4bce25576096fe63ad4e8bba9242464", "message": "finish impl", "committedDate": "2020-11-02T02:40:17Z", "type": "commit"}, {"oid": "bc7646248b5c51c07706feb31ee6cac1c2a53dd6", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bc7646248b5c51c07706feb31ee6cac1c2a53dd6", "message": "fixes", "committedDate": "2020-11-02T03:31:23Z", "type": "commit"}, {"oid": "bc7646248b5c51c07706feb31ee6cac1c2a53dd6", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bc7646248b5c51c07706feb31ee6cac1c2a53dd6", "message": "fixes", "committedDate": "2020-11-02T03:31:23Z", "type": "forcePushed"}, {"oid": "715ec34856f78c6e10d5c4135f2cd5c3b3e44025", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/715ec34856f78c6e10d5c4135f2cd5c3b3e44025", "message": "add null check", "committedDate": "2020-11-02T05:39:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIyNDU0Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516224543", "bodyText": "nit: DESIRED_STATUS_CANCELED.equals(...)", "author": "hui-yang", "createdAt": "2020-11-02T20:06:03Z", "path": "src/main/java/com/aws/greengrass/deployment/ShadowDeploymentListener.java", "diffHunk": "@@ -253,15 +256,18 @@ protected void shadowUpdated(Map<String, Object> configuration, Integer version)\n \n         String configurationString;\n         try {\n-            configurationString = SerializerFactory.getJsonObjectMapper().writeValueAsString(configuration);\n+            configurationString = SerializerFactory.getJsonObjectMapper().writeValueAsString(fleetConfig);\n         } catch (JsonProcessingException e) {\n             logger.atError(\"Unable to process shadow update\", e);\n             return;\n         }\n \n-        desiredStateQueue.add(new Pair<>(configurationArn, configuration));\n-        Deployment deployment =\n-                new Deployment(configurationString, DeploymentType.SHADOW, configurationArn);\n+        Deployment deployment;\n+        if (desired.get(DESIRED_STATUS_KEY).equals(DESIRED_STATUS_CANCELED)) {", "originalCommit": "715ec34856f78c6e10d5c4135f2cd5c3b3e44025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg0ODg4Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516848887", "bodyText": "oh so that the LHS can't be null \ud83d\udc4d", "author": "tilo-chen", "createdAt": "2020-11-03T17:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIyNDU0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIyNzcyMA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516227720", "bodyText": "Is this information only reported to shadow (not in iot jobs)?\nThe version may need to be changed later, by looking up Nucleus component deviceConfiguration.getNucleusComponentName()", "author": "hui-yang", "createdAt": "2020-11-02T20:12:38Z", "path": "src/main/java/com/aws/greengrass/deployment/ShadowDeploymentListener.java", "diffHunk": "@@ -182,59 +189,55 @@ private void publishToGetDeviceShadowTopic() {\n \n     @SuppressFBWarnings\n     private Boolean deploymentStatusChanged(Map<String, Object> deploymentDetails) {\n-        DeploymentStatus status = DeploymentStatus.valueOf((String)\n-                deploymentDetails.get(DEPLOYMENT_STATUS_KEY_NAME));\n-\n         String configurationArn = (String) deploymentDetails.get(DEPLOYMENT_ID_KEY_NAME);\n-        // only update reported state when the deployment succeeds.\n-        if (DeploymentStatus.SUCCEEDED.equals(status)) {\n+        try {\n+            ShadowState shadowState = new ShadowState();\n+            shadowState.reported = getReportedShadowState(deploymentDetails);\n+            UpdateNamedShadowRequest updateNamedShadowRequest = new UpdateNamedShadowRequest();\n+            updateNamedShadowRequest.shadowName = DEPLOYMENT_SHADOW_NAME;\n+            updateNamedShadowRequest.thingName = thingName;\n+            updateNamedShadowRequest.state = shadowState;\n+            iotShadowClient.PublishUpdateNamedShadow(updateNamedShadowRequest, QualityOfService.AT_LEAST_ONCE)\n+                    .get(TIMEOUT_FOR_PUBLISHING_TO_TOPICS_SECONDS, TimeUnit.SECONDS);\n+            logger.atInfo().kv(CONFIGURATION_ARN_LOG_KEY_NAME, configurationArn)\n+                    .log(\"Updated reported state for deployment\");\n+            return true;\n+        } catch (InterruptedException e) {\n+            //Since this method can run as runnable cannot throw exception so handling exceptions here\n+            logger.atWarn().log(\"Interrupted while publishing reported state\");\n+        } catch (ExecutionException e) {\n+            logger.atError().setCause(e).log(\"Caught exception while publishing reported state\");\n+        } catch (TimeoutException e) {\n+            logger.atWarn().setCause(e).log(\"Publish reported state timed out, will retry shortly\");\n+        }\n+        return false;\n+    }\n \n-            Pair<String, Map<String, Object>> desired = desiredStateQueue.peek();\n-            // discard configurations that might have got added to the queue but the deployment\n-            // got discarded before being processed due to a new shadow deployment\n-            while (desired != null && !desired.getLeft().equals(configurationArn)) {\n-                desiredStateQueue.poll();\n-                desired = desiredStateQueue.peek();\n-            }\n+    @SuppressWarnings(\"PMD.LooseCoupling\")\n+    private HashMap<String, Object> getReportedShadowState(Map<String, Object> deploymentDetails) {\n+        Map<String, Object> deploymentStatusDetails =\n+                (Map<String, Object>) deploymentDetails.get(DEPLOYMENT_STATUS_DETAILS_KEY_NAME);\n \n-            if (desired == null) {\n-                logger.atError().kv(CONFIGURATION_ARN_LOG_KEY_NAME, configurationArn)\n-                        .log(\"Unable to update shadow for deployment\");\n-                return true;\n-            }\n+        HashMap<String, Object> statusDetails = new HashMap<>();\n+        statusDetails.put(DETAILED_STATUS_KEY, deploymentStatusDetails.get(DEPLOYMENT_DETAILED_STATUS_KEY));\n+        statusDetails.put(FAILURE_CAUSE_KEY, deploymentStatusDetails.get(DEPLOYMENT_FAILURE_CAUSE_KEY));\n \n-            try {\n-                ShadowState shadowState = new ShadowState();\n-                shadowState.reported = new HashMap<>(desired.getRight());\n-                UpdateNamedShadowRequest updateNamedShadowRequest = new UpdateNamedShadowRequest();\n-                updateNamedShadowRequest.shadowName = DEPLOYMENT_SHADOW_NAME;\n-                updateNamedShadowRequest.thingName = thingName;\n-                updateNamedShadowRequest.state = shadowState;\n-                iotShadowClient.PublishUpdateNamedShadow(updateNamedShadowRequest, QualityOfService.AT_LEAST_ONCE)\n-                        .get(TIMEOUT_FOR_PUBLISHING_TO_TOPICS_SECONDS, TimeUnit.SECONDS);\n-                desiredStateQueue.remove();\n-                logger.atInfo().kv(CONFIGURATION_ARN_LOG_KEY_NAME, configurationArn)\n-                        .log(\"Updated reported state for deployment\");\n-                return true;\n-            } catch (InterruptedException e) {\n-                //Since this method can run as runnable cannot throw exception so handling exceptions here\n-                logger.atWarn().log(\"Interrupted while publishing reported state\");\n-            } catch (ExecutionException e) {\n-                logger.atError().setCause(e).log(\"Caught exception while publishing reported state\");\n-            } catch (TimeoutException e) {\n-                logger.atWarn().setCause(e).log(\"Publish reported state timed out, will retry shortly\");\n-            }\n-            return false;\n-        }\n-        return true;\n+        HashMap<String, Object> reported = new HashMap<>();\n+        reported.put(ARN_FOR_STATUS_KEY, deploymentDetails.get(DEPLOYMENT_ID_KEY_NAME));\n+        reported.put(STATUS_KEY, deploymentDetails.get(DEPLOYMENT_STATUS_KEY_NAME));\n+        reported.put(STATUS_DETAILS_KEY, statusDetails);\n+        reported.put(GGC_VERSION_KEY, KERNEL_VERSION);", "originalCommit": "715ec34856f78c6e10d5c4135f2cd5c3b3e44025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3MDUyNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516870527", "bodyText": "Noted! There's a few more places getting the version from lifecyclemanager.KernelVersion. getNucleusComponentName right now doesn't contain the version number yet.", "author": "tilo-chen", "createdAt": "2020-11-03T18:24:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIyNzcyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3ODc3OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516378778", "bodyText": "should this cast happen safely? maybe check if the get does not return null?", "author": "nikkhilmuthye", "createdAt": "2020-11-03T01:10:15Z", "path": "src/main/java/com/aws/greengrass/status/FleetStatusService.java", "diffHunk": "@@ -359,6 +364,24 @@ private void uploadFleetStatusServiceData(Set<GreengrassService> greengrassServi\n                 .ggcVersion(KERNEL_VERSION)\n                 .sequenceNumber(sequenceNumber)\n                 .build();\n+\n+        if (deploymentDetails != null) {\n+            DeploymentInformation deploymentInformation = DeploymentInformation.builder()\n+                    .status((String) deploymentDetails.get(DEPLOYMENT_STATUS_KEY_NAME))\n+                    .fleetConfigurationArnForStatus((String) deploymentDetails.get(DEPLOYMENT_ID_KEY_NAME))\n+                    .build();\n+            Map<String, String> statusDetailsMap =", "originalCommit": "715ec34856f78c6e10d5c4135f2cd5c3b3e44025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg1MDM4Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516850382", "bodyText": "Right. Should have check for null before casting", "author": "tilo-chen", "createdAt": "2020-11-03T17:49:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3ODc3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3OTgyMA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516379820", "bodyText": "It would probably be better if you send a DeploymentInformation in this function and create the object in deploymentStatusChanged", "author": "nikkhilmuthye", "createdAt": "2020-11-03T01:14:22Z", "path": "src/main/java/com/aws/greengrass/status/FleetStatusService.java", "diffHunk": "@@ -277,12 +281,13 @@ private void updateEventTriggeredFleetStatusData() {\n         });\n         removedDependenciesSet.forEach(allServiceNamesMap::remove);\n         removedDependenciesSet.clear();\n-        uploadFleetStatusServiceData(updatedGreengrassServiceSet, overAllStatus.get());\n+        uploadFleetStatusServiceData(updatedGreengrassServiceSet, overAllStatus.get(), deploymentDetails);\n         isEventTriggeredUpdateInProgress.set(false);\n     }\n \n     private void uploadFleetStatusServiceData(Set<GreengrassService> greengrassServiceSet,\n-                                              OverallStatus overAllStatus) {\n+                                              OverallStatus overAllStatus,\n+                                              Map<String, Object> deploymentDetails) {", "originalCommit": "715ec34856f78c6e10d5c4135f2cd5c3b3e44025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3MzY3Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r516873676", "bodyText": "Good point!", "author": "tilo-chen", "createdAt": "2020-11-03T18:30:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3OTgyMA=="}], "type": "inlineReview"}, {"oid": "44437383e4ffb0e316e980e122fa9153fcfdae9f", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/44437383e4ffb0e316e980e122fa9153fcfdae9f", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-03T17:50:58Z", "type": "commit"}, {"oid": "bc220aab4f1e32a9e6f9f3d00b3e7cd90128c630", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bc220aab4f1e32a9e6f9f3d00b3e7cd90128c630", "message": "address comments", "committedDate": "2020-11-03T19:49:01Z", "type": "commit"}, {"oid": "8a1e0ad0084f2050df287093d44e207f3ff6916c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8a1e0ad0084f2050df287093d44e207f3ff6916c", "message": "report shadow cancel status; name change", "committedDate": "2020-11-06T17:40:42Z", "type": "commit"}, {"oid": "dd8c7569cd81809ebe9d4585852293324476cc8e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/dd8c7569cd81809ebe9d4585852293324476cc8e", "message": "Merge branch 'master' of github.com:aws/aws-greengrass-nucleus into shadow-deploy-report", "committedDate": "2020-11-06T19:46:10Z", "type": "commit"}, {"oid": "b44d337ea52cc09282ea8f3258b0ef077cd32c3e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b44d337ea52cc09282ea8f3258b0ef077cd32c3e", "message": "name change", "committedDate": "2020-11-06T19:47:06Z", "type": "commit"}, {"oid": "078c1dbf9a16890344f8877b662ecacf1124dee1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/078c1dbf9a16890344f8877b662ecacf1124dee1", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-10T15:26:16Z", "type": "commit"}, {"oid": "6a4f32f60356633a4939ab1fcec9ae931fb53682", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6a4f32f60356633a4939ab1fcec9ae931fb53682", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-11T04:09:26Z", "type": "commit"}, {"oid": "f98fbc11e869aeef1f0ceae3161256e83311450e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f98fbc11e869aeef1f0ceae3161256e83311450e", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-11T18:22:30Z", "type": "commit"}, {"oid": "c064fc613014ab8acc26e452128afc34c63f7874", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c064fc613014ab8acc26e452128afc34c63f7874", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-11T22:32:46Z", "type": "commit"}, {"oid": "0150d73a7d9bf3505027a188140900fc374a424c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0150d73a7d9bf3505027a188140900fc374a424c", "message": "handle shadow update properly", "committedDate": "2020-11-12T00:08:58Z", "type": "commit"}, {"oid": "a8d34e5e1cb8d40b81270d88187ccc5a31b24e3d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a8d34e5e1cb8d40b81270d88187ccc5a31b24e3d", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-12T00:10:05Z", "type": "commit"}, {"oid": "822aef31a943ff91ee8751044eac36e442a185d0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/822aef31a943ff91ee8751044eac36e442a185d0", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-12T15:51:53Z", "type": "commit"}, {"oid": "df2a23fb4c29004447cfa698c21df9c5defa3735", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/df2a23fb4c29004447cfa698c21df9c5defa3735", "message": "update e2e test", "committedDate": "2020-11-12T20:41:30Z", "type": "commit"}, {"oid": "708a3ae253225244f63ad3ac870d3cebde6763e9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/708a3ae253225244f63ad3ac870d3cebde6763e9", "message": "update e2e test", "committedDate": "2020-11-12T21:15:20Z", "type": "commit"}, {"oid": "a4634f2d8b921472a2b457e41dd4c069e21f6eb3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a4634f2d8b921472a2b457e41dd4c069e21f6eb3", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-12T21:34:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ3MTAwNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r522471007", "bodyText": "Can you add a unit test which will use this function?", "author": "nikkhilmuthye", "createdAt": "2020-11-12T22:25:44Z", "path": "src/main/java/com/aws/greengrass/status/FleetStatusService.java", "diffHunk": "@@ -437,6 +445,20 @@ private OverallStatus getOverallStatusBasedOnServiceState(OverallStatus overallS\n         return OverallStatus.HEALTHY;\n     }\n \n+    private DeploymentInformation getDeploymentInformation(Map<String, Object> deploymentDetails) {", "originalCommit": "a4634f2d8b921472a2b457e41dd4c069e21f6eb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ4MTIxNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r522481217", "bodyText": "Added some assertions for this in existing unit tests", "author": "tilo-chen", "createdAt": "2020-11-12T22:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ3MTAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUxNjMwMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r522516302", "bodyText": "You also need to make sure that the status details are also set right if they exist? Can you add that as well?", "author": "nikkhilmuthye", "createdAt": "2020-11-12T23:57:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ3MTAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU0MDgxNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/574#discussion_r522540814", "bodyText": "Missed it... Thanks!", "author": "tilo-chen", "createdAt": "2020-11-13T01:04:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ3MTAwNw=="}], "type": "inlineReview"}, {"oid": "a6e392ec700f717f88d0f95836e01f625ce7c1ea", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a6e392ec700f717f88d0f95836e01f625ce7c1ea", "message": "add unit test assertions", "committedDate": "2020-11-12T22:47:38Z", "type": "commit"}, {"oid": "b3e6f639666ce69ac20e796dc83b18743244d418", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b3e6f639666ce69ac20e796dc83b18743244d418", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-13T00:12:27Z", "type": "commit"}, {"oid": "81791ca2a7d741461e77dd75a7012c326092ff40", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/81791ca2a7d741461e77dd75a7012c326092ff40", "message": "add status details assertions", "committedDate": "2020-11-13T01:24:27Z", "type": "commit"}, {"oid": "9e89fa3ed940f5681ea422f176884c59e99515ca", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e89fa3ed940f5681ea422f176884c59e99515ca", "message": "Merge branch 'shadow-deploy-report' of github.com:aws/aws-greengrass-nucleus into shadow-deploy-report", "committedDate": "2020-11-13T01:25:13Z", "type": "commit"}, {"oid": "6b06d7c9581cc0e85a742977cd87dd12cf1df7da", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6b06d7c9581cc0e85a742977cd87dd12cf1df7da", "message": "Merge branch 'master' into shadow-deploy-report", "committedDate": "2020-11-13T01:26:00Z", "type": "commit"}]}