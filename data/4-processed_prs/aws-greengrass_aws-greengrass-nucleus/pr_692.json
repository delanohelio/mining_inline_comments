{"pr_number": 692, "pr_title": "Platform test migration", "pr_createdAt": "2020-11-17T06:19:13Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692", "timeline": [{"oid": "aad9180a11437c0dbb9b696abc4a8903530cc498", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aad9180a11437c0dbb9b696abc4a8903530cc498", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility.", "committedDate": "2020-11-17T20:11:49Z", "type": "forcePushed"}, {"oid": "ba5a85fa5b3d311722c96cc5e6ad25c90193b773", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ba5a85fa5b3d311722c96cc5e6ad25c90193b773", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility.", "committedDate": "2020-11-17T20:19:01Z", "type": "forcePushed"}, {"oid": "a9b62817b86017f52a5cf97cbff7b24bce1fa513", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a9b62817b86017f52a5cf97cbff7b24bce1fa513", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility.", "committedDate": "2020-11-17T20:41:25Z", "type": "forcePushed"}, {"oid": "550d0a78f988db8e7c0c1b51ce70d8d2b6a23dfc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/550d0a78f988db8e7c0c1b51ce70d8d2b6a23dfc", "message": "remove legacy platform resolving in unit test recipe", "committedDate": "2020-11-17T21:10:33Z", "type": "commit"}, {"oid": "a2905aacf98a572ed1831fe86421106d9a0e3ea4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a2905aacf98a572ed1831fe86421106d9a0e3ea4", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility.", "committedDate": "2020-11-17T21:10:33Z", "type": "commit"}, {"oid": "7d60bebe728bac26c886a4011448fef41284af02", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7d60bebe728bac26c886a4011448fef41284af02", "message": "remove legacy platformr resolving logic", "committedDate": "2020-11-17T21:10:33Z", "type": "forcePushed"}, {"oid": "7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "message": "remove legacy platformr resolving logic", "committedDate": "2020-11-17T22:09:59Z", "type": "commit"}, {"oid": "7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "message": "remove legacy platformr resolving logic", "committedDate": "2020-11-17T22:09:59Z", "type": "forcePushed"}, {"oid": "43898a1d3587cb4d2de2a48e96416441e4d0efdd", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/43898a1d3587cb4d2de2a48e96416441e4d0efdd", "message": "Fix tests", "committedDate": "2020-11-18T06:57:14Z", "type": "commit"}, {"oid": "36497e45cb193b95158975acb9736c0af59c4767", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/36497e45cb193b95158975acb9736c0af59c4767", "message": "Merge branch 'master' into platform-test-migration", "committedDate": "2020-11-18T06:57:44Z", "type": "commit"}, {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "message": "Merge branch 'master' into platform-test-migration", "committedDate": "2020-11-18T08:34:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Nzg5NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526387895", "bodyText": "yay!, Can we totally remove jackson-jr?", "author": "MikeDombo", "createdAt": "2020-11-18T20:10:48Z", "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/deployment/DeploymentConfigMergingTest.java", "diffHunk": "@@ -34,8 +35,6 @@\n import com.aws.greengrass.testcommons.testutilities.NoOpPathOwnershipHandler;\n import com.aws.greengrass.testcommons.testutilities.TestUtils;\n import com.aws.greengrass.util.Coerce;\n-import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;", "originalCommit": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQyNjc0Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526426743", "bodyText": "I'm afraid not. At least AFAIK Configuration.java is using it", "author": "ShirleyZheng92", "createdAt": "2020-11-18T21:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Nzg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQyNzQ5OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526427498", "bodyText": "It might be, but it doesn't need to be.", "author": "MikeDombo", "createdAt": "2020-11-18T21:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Nzg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5MDU1MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526390551", "bodyText": "fairly sure that your change will fail on windows because of the way that echo works with quotes in cmd compared to powershell.\nBut I guess we can fix it when we build for windows again", "author": "MikeDombo", "createdAt": "2020-11-18T20:15:34Z", "path": "src/integrationtests/resources/com/aws/greengrass/integrationtests/lifecyclemanager/kernel_restart_new_config.yaml", "diffHunk": "@@ -11,14 +11,10 @@ services:\n \n   service_3:\n     lifecycle:\n-      run:\n-        posix: echo \"service_3\"\n-        windows: powershell -command echo \"service_3\"", "originalCommit": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQzMTg2Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526431866", "bodyText": "this change also deletes echo for posix too - I'm assuming the echo is not needed.", "author": "JamieHunter", "createdAt": "2020-11-18T21:27:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5MDU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5NDU0OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526394549", "bodyText": "just use getName not canonical", "author": "MikeDombo", "createdAt": "2020-11-18T20:19:30Z", "path": "src/main/java/com/aws/greengrass/util/platforms/Platform.java", "diffHunk": "@@ -35,17 +49,19 @@ public static synchronized Platform getInstance() {\n         if (INSTANCE != null) {\n             return INSTANCE;\n         }\n-        if (Exec.isWindows) {\n+\n+        if (PlatformResolver.isWindows) {\n             INSTANCE = new WindowsPlatform();\n-        } else if (PlatformResolver.RANKS.get().containsKey(\"qnx\")) {\n+        } else if (UNIX_SYS_VER.contains(\"qnx\")) {\n             INSTANCE = new QNXPlatform();\n-        } else if (PlatformResolver.RANKS.get().containsKey(\"macos\") || PlatformResolver.RANKS.get()\n-                .containsKey(\"darwin\")) {\n+        } else if (UNIX_SYS_VER.contains(\"darwin\") || UNIX_SYS_VER.contains(\"macos\")) {\n             INSTANCE = new DarwinPlatform();\n         } else {\n             INSTANCE = new UnixPlatform();\n         }\n \n+        logger.atInfo().log(\"Getting platform instance {}.\", INSTANCE.getClass().getCanonicalName());", "originalCommit": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5NDg5Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526394897", "bodyText": "use hamcrest assertthat contains", "author": "MikeDombo", "createdAt": "2020-11-18T20:20:00Z", "path": "src/test/java/com/aws/greengrass/componentmanager/ComponentStoreTest.java", "diffHunk": "@@ -214,8 +214,11 @@ void GIVEN_an_invalid_recipe_exists_WHEN_findPackageRecipe_THEN_loading_exceptio\n \n         // WHEN\n         // THEN\n-        assertThrows(PackageLoadingException.class,\n-                () -> componentStore.findPackageRecipe(new ComponentIdentifier(\"InvalidRecipe\", new Semver(\"1.0.0\"))));\n+        PackageLoadingException pe = assertThrows(PackageLoadingException.class,\n+                () -> componentStore.findPackageRecipe(\n+                        new ComponentIdentifier(\"InvalidRecipe\", new Semver(\"1.0.0\"))));\n+        assertTrue(pe.getMessage().contains(\"Failed to parse recipe file content to contract model\"),", "originalCommit": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d0dd47a3de834ecac71523d5dbeb49dc33cd61fc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d0dd47a3de834ecac71523d5dbeb49dc33cd61fc", "message": "Merge branch 'master' into platform-test-migration", "committedDate": "2020-11-18T21:00:58Z", "type": "commit"}, {"oid": "bd4861f3ebd240974dd1419dddf4cb36f7904fdb", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bd4861f3ebd240974dd1419dddf4cb36f7904fdb", "message": "Merge branch 'master' into platform-test-migration", "committedDate": "2020-11-18T22:05:41Z", "type": "commit"}]}