{"pr_number": 396, "pr_title": "Evergreen setup support kernel dry run", "pr_createdAt": "2020-08-27T00:58:53Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396", "timeline": [{"oid": "5630bf371ffe617d5b183a4e0c7d520be7793fe4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5630bf371ffe617d5b183a4e0c7d520be7793fe4", "message": "support dry run with easy setup", "committedDate": "2020-08-27T00:48:48Z", "type": "commit"}, {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8014aaf69f087aa7702c8c4a823d36fa700053f5", "message": "Merge branch 'master' into easy-setup-dry-run", "committedDate": "2020-08-27T00:59:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgzMjM5MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r477832390", "bodyText": "no system. Use setup.errStream or just outstream if we don't have an err stream", "author": "MikeDombo", "createdAt": "2020-08-27T01:00:55Z", "path": "src/main/java/com/aws/iot/evergreen/easysetup/EvergreenSetup.java", "diffHunk": "@@ -141,46 +146,55 @@ public EvergreenSetup(PrintStream ps, String... setupArgs) {\n             {\"PMD.NullAssignment\", \"PMD.AvoidCatchingThrowable\", \"PMD.DoNotCallSystemExit\", \"PMD.SystemPrintln\"})\n     public static void main(String[] args) {\n         try {\n-            EvergreenSetup setup = new EvergreenSetup(System.out, args);\n+            EvergreenSetup evergreenSetup = new EvergreenSetup(System.out, args);\n+            evergreenSetup.performSetUp();\n+        } catch (Throwable t) {\n+            logger.atError().setCause(t).log(\"Error while trying to setup Evergreen kernel\");\n+            System.err.println(\"Error while trying to setup Evergreen kernel\");\n+            t.printStackTrace(System.err);", "originalCommit": "8014aaf69f087aa7702c8c4a823d36fa700053f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzg1MDAyMA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r477850020", "bodyText": "EvergreenSetup output stream is System.out", "author": "fahadmohammed01", "createdAt": "2020-08-27T01:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgzMjM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzg1MTk1NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r477851955", "bodyText": "I know, but we shouldn't use it directly, so that we can actually test is by injecting our own stream.", "author": "MikeDombo", "createdAt": "2020-08-27T01:11:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgzMjM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU5MTQ0Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478591447", "bodyText": "Updated", "author": "fahadmohammed01", "createdAt": "2020-08-27T17:46:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgzMjM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA5MDk0MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478090941", "bodyText": "Nit - setUp or setup?", "author": "shaguptashaikh", "createdAt": "2020-08-27T04:20:57Z", "path": "src/main/java/com/aws/iot/evergreen/easysetup/EvergreenSetup.java", "diffHunk": "@@ -141,46 +146,55 @@ public EvergreenSetup(PrintStream ps, String... setupArgs) {\n             {\"PMD.NullAssignment\", \"PMD.AvoidCatchingThrowable\", \"PMD.DoNotCallSystemExit\", \"PMD.SystemPrintln\"})\n     public static void main(String[] args) {\n         try {\n-            EvergreenSetup setup = new EvergreenSetup(System.out, args);\n+            EvergreenSetup evergreenSetup = new EvergreenSetup(System.out, args);\n+            evergreenSetup.performSetUp();\n+        } catch (Throwable t) {\n+            logger.atError().setCause(t).log(\"Error while trying to setup Evergreen kernel\");\n+            System.err.println(\"Error while trying to setup Evergreen kernel\");\n+            t.printStackTrace(System.err);\n+            System.exit(1);\n+        }\n+    }\n \n-            // Describe usage of the command\n-            if (setup.showHelp) {\n-                setup.outStream.println(SHOW_HELP_RESPONSE);\n-                System.exit(0);\n-            }\n+    void performSetUp() throws IOException, DeviceConfigurationException {", "originalCommit": "8014aaf69f087aa7702c8c4a823d36fa700053f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY1NTQxNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478655416", "bodyText": "updated", "author": "fahadmohammed01", "createdAt": "2020-08-27T19:46:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA5MDk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU4ODc3NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478588774", "bodyText": "dryrun may not be the right name for this option. Can we simply have --start?", "author": "hui-yang", "createdAt": "2020-08-27T17:41:46Z", "path": "src/main/java/com/aws/iot/evergreen/easysetup/EvergreenSetup.java", "diffHunk": "@@ -84,6 +84,10 @@\n     private static final String SETUP_SYSTEM_SERVICE_ARG_SHORT = \"-ss\";\n     private static final boolean SETUP_SYSTEM_SERVICE_ARG_DEFAULT = false;\n \n+    private static final String KERNEL_DRY_RUN_ARG = \"--dry-run\";\n+    private static final String KERNEL_DRY_RUN_ARG_SHORT = \"-dr\";\n+    private static final boolean KERNEL_DRY_RUN_ARG_DEFAULT = false;", "originalCommit": "8014aaf69f087aa7702c8c4a823d36fa700053f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY1NTMyMA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478655320", "bodyText": "updated", "author": "fahadmohammed01", "createdAt": "2020-08-27T19:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU4ODc3NA=="}], "type": "inlineReview"}, {"oid": "afc39d6b5d35df5509446002f886786c31d521b3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/afc39d6b5d35df5509446002f886786c31d521b3", "message": "addressed pr comments", "committedDate": "2020-08-27T19:45:46Z", "type": "commit"}, {"oid": "ca0011ab8772a28dd9cddf6c9b935a3d9a3856c0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ca0011ab8772a28dd9cddf6c9b935a3d9a3856c0", "message": "minor typo", "committedDate": "2020-08-27T19:45:46Z", "type": "commit"}, {"oid": "2e623dce0ce2f4645199ee627a5dfbfcddc6ec37", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2e623dce0ce2f4645199ee627a5dfbfcddc6ec37", "message": "renamed variables", "committedDate": "2020-08-27T19:45:46Z", "type": "commit"}, {"oid": "94d7493188ee8c4faf080a63ec543db2552e7ea7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/94d7493188ee8c4faf080a63ec543db2552e7ea7", "message": "Merge branch 'master' into easy-setup-dry-run", "committedDate": "2020-08-27T19:46:42Z", "type": "commit"}]}