{"pr_number": 408, "pr_title": "Use common model from maven repo", "pr_createdAt": "2020-09-01T21:10:31Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408", "timeline": [{"oid": "cab23e3934f73252e26b2325d48dfc83fda488a7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cab23e3934f73252e26b2325d48dfc83fda488a7", "message": "Fix to add architecture in listAvailablePackageMetadata", "committedDate": "2020-09-01T21:08:37Z", "type": "commit"}, {"oid": "d406e308d46937bc12d1a4a680cc3bdf8bd092bc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d406e308d46937bc12d1a4a680cc3bdf8bd092bc", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-01T23:07:14Z", "type": "commit"}, {"oid": "b99468b318fd6f7d9a9fbefeccbd3b29a42d9ebc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b99468b318fd6f7d9a9fbefeccbd3b29a42d9ebc", "message": "Use common model in brazil package", "committedDate": "2020-09-02T05:02:26Z", "type": "commit"}, {"oid": "b99468b318fd6f7d9a9fbefeccbd3b29a42d9ebc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b99468b318fd6f7d9a9fbefeccbd3b29a42d9ebc", "message": "Use common model in brazil package", "committedDate": "2020-09-02T05:02:26Z", "type": "forcePushed"}, {"oid": "cf4e0c619bdd4b5af1d194b1f8ec40fcddc6a3b6", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cf4e0c619bdd4b5af1d194b1f8ec40fcddc6a3b6", "message": "Fix componentType in integ tests", "committedDate": "2020-09-02T06:28:44Z", "type": "commit"}, {"oid": "9d6e23866377ea9f74f1afab03fe99fa67abf3ef", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9d6e23866377ea9f74f1afab03fe99fa67abf3ef", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-02T21:06:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MTg0Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483171842", "bodyText": ".name() in favor of toString()", "author": "leaf94", "createdAt": "2020-09-03T18:23:42Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/converter/RecipeLoader.java", "diffHunk": "@@ -75,13 +76,19 @@\n \n         PlatformSpecificManifest platformSpecificManifest = optionalPlatformSpecificManifest.get();\n \n+        // null check on componentType. Shouldn't happen if cloud recipe is parsed correctly.\n+        String componentType = null;\n+        if (componentRecipe.getComponentType() != null) {\n+            componentType = componentRecipe.getComponentType().toString();", "originalCommit": "9d6e23866377ea9f74f1afab03fe99fa67abf3ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NzYzNw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483347637", "bodyText": "Sure", "author": "ShirleyZheng92", "createdAt": "2020-09-04T02:15:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MTg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MzI3NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483173275", "bodyText": "Let's make our ComponentType also strongly typed?", "author": "leaf94", "createdAt": "2020-09-03T18:26:18Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/converter/RecipeLoader.java", "diffHunk": "@@ -75,13 +76,19 @@\n \n         PlatformSpecificManifest platformSpecificManifest = optionalPlatformSpecificManifest.get();\n \n+        // null check on componentType. Shouldn't happen if cloud recipe is parsed correctly.\n+        String componentType = null;", "originalCommit": "9d6e23866377ea9f74f1afab03fe99fa67abf3ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0ODY4OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485248688", "bodyText": "+1", "author": "MikeDombo", "createdAt": "2020-09-08T23:24:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MzI3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MzYyNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483173624", "bodyText": "also .name() to prevent unexpected behavior when toString() is overriden", "author": "leaf94", "createdAt": "2020-09-03T18:26:58Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/converter/RecipeLoader.java", "diffHunk": "@@ -126,12 +133,18 @@ private static PackageParameter convertParameterFromFile(@Nonnull ComponentParam\n     }\n \n     private static ComponentArtifact convertArtifactFromFile(\n-            @Nonnull com.aws.iot.evergreen.packagemanager.common.ComponentArtifact componentArtifact) {\n+            @Nonnull com.amazon.aws.iot.greengrass.component.common.ComponentArtifact componentArtifact) {\n+        String unArchive;\n+        if (componentArtifact.getUnarchive() == null) {\n+            unArchive = Unarchive.NONE.toString();\n+        } else {\n+            unArchive = componentArtifact.getUnarchive().toString();", "originalCommit": "9d6e23866377ea9f74f1afab03fe99fa67abf3ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3NDE4OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483174189", "bodyText": "Also let's make it strongly typed", "author": "leaf94", "createdAt": "2020-09-03T18:27:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MzYyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NzQ3MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483347470", "bodyText": "I'd like to separate the strongly typed UNARCHIVE and ComponentType in a different PR. Seems that String->Enum type change can bring a lot of scattered diff", "author": "ShirleyZheng92", "createdAt": "2020-09-04T02:14:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MzYyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0ODAxOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483348019", "bodyText": "It already is typed. It was typed in kernel as well as the common model", "author": "MikeDombo", "createdAt": "2020-09-04T02:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MzYyNA=="}], "type": "inlineReview"}, {"oid": "0c87e9ca14d7f4641bd96ce37c1e0fea642caf04", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0c87e9ca14d7f4641bd96ce37c1e0fea642caf04", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-03T22:54:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODA2Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483298062", "bodyText": "the purpose of raw is that it does not exist (in cloud). That's how I'm able to tell that it is working.", "author": "MikeDombo", "createdAt": "2020-09-03T23:04:33Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/deployment/DeploymentTaskIntegrationTest.java", "diffHunk": "@@ -168,7 +168,7 @@ static void tearDown() {\n     @Order(1)\n     void GIVEN_sample_deployment_doc_WHEN_submitted_to_deployment_task_THEN_services_start_in_kernel(ExtensionContext context)\n             throws Exception {\n-        ((Map) kernel.getContext().getvIfExists(Kernel.SERVICE_TYPE_TO_CLASS_MAP_KEY).get()).put(\"raw\",\n+        ((Map) kernel.getContext().getvIfExists(Kernel.SERVICE_TYPE_TO_CLASS_MAP_KEY).get()).put(\"plugin\",", "originalCommit": "0c87e9ca14d7f4641bd96ce37c1e0fea642caf04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5OTc4OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483299788", "bodyText": "This might be ok though", "author": "MikeDombo", "createdAt": "2020-09-03T23:10:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NzA5Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483347096", "bodyText": "Since componentType in common model is enum. When parsing from recipe, the \"raw\" will be ignored.", "author": "ShirleyZheng92", "createdAt": "2020-09-04T02:13:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODU0Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483298547", "bodyText": "null might be fine. Customers shouldn't be specifying it", "author": "MikeDombo", "createdAt": "2020-09-03T23:06:01Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/converter/RecipeLoader.java", "diffHunk": "@@ -75,13 +76,19 @@\n \n         PlatformSpecificManifest platformSpecificManifest = optionalPlatformSpecificManifest.get();\n \n+        // null check on componentType. Shouldn't happen if cloud recipe is parsed correctly.", "originalCommit": "0c87e9ca14d7f4641bd96ce37c1e0fea642caf04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NzE0OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483347149", "bodyText": "Is it only specified by lambda launcher?", "author": "ShirleyZheng92", "createdAt": "2020-09-04T02:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NzcwMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483347701", "bodyText": "Component type is used by us for plugin and lambda, that's all", "author": "MikeDombo", "createdAt": "2020-09-04T02:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODk5MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483298990", "bodyText": "plugin shouldn't have a class", "author": "MikeDombo", "createdAt": "2020-09-03T23:07:30Z", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/deployment/LocalDeploymentListenerIntegTest.java", "diffHunk": "@@ -68,6 +70,9 @@ static void tearDown() {\n     void GIVEN_sample_deployment_doc_WHEN_submitted_to_deployment_task_THEN_services_start_in_kernel(\n             ExtensionContext context) throws Exception {\n         ignoreExceptionOfType(context, PackageDownloadException.class);\n+        // set class for PLUGIN\n+        ((Map) kernel.getContext().getvIfExists(Kernel.SERVICE_TYPE_TO_CLASS_MAP_KEY).get()).put(\"plugin\",\n+                GenericExternalService.class.getName());", "originalCommit": "0c87e9ca14d7f4641bd96ce37c1e0fea642caf04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5OTk0MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r483299940", "bodyText": "Use EvergreenService", "author": "MikeDombo", "createdAt": "2020-09-03T23:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODk5MA=="}], "type": "inlineReview"}, {"oid": "1e4dc4da06f0b1a82c696afc65903b3b1b087261", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1e4dc4da06f0b1a82c696afc65903b3b1b087261", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-04T02:12:12Z", "type": "commit"}, {"oid": "8fc59a399cece012ebf45739935cbc2e296e1759", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8fc59a399cece012ebf45739935cbc2e296e1759", "message": "Address comments", "committedDate": "2020-09-04T04:20:08Z", "type": "commit"}, {"oid": "447ecaa486e4ec8aa039e4566be1a713a282ed5c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/447ecaa486e4ec8aa039e4566be1a713a282ed5c", "message": "make Unarhive enum", "committedDate": "2020-09-04T22:00:19Z", "type": "commit"}, {"oid": "3e2108131c2828905ca35eed0e3986a3a86b4082", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3e2108131c2828905ca35eed0e3986a3a86b4082", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-04T22:56:17Z", "type": "commit"}, {"oid": "deedd08e7fd7281bbb5c9eb26179a73cca05962d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/deedd08e7fd7281bbb5c9eb26179a73cca05962d", "message": "make Unarhive enum", "committedDate": "2020-09-08T08:17:22Z", "type": "commit"}, {"oid": "6696ac116f220736f8cbd2da22753c12fe37678b", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6696ac116f220736f8cbd2da22753c12fe37678b", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-08T23:02:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0ODgwNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485248806", "bodyText": "what happened to the strong typing?", "author": "MikeDombo", "createdAt": "2020-09-08T23:25:18Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/converter/RecipeLoader.java", "diffHunk": "@@ -126,12 +132,17 @@ private static PackageParameter convertParameterFromFile(@Nonnull ComponentParam\n     }\n \n     private static ComponentArtifact convertArtifactFromFile(\n-            @Nonnull com.aws.iot.evergreen.packagemanager.common.ComponentArtifact componentArtifact) {\n+            @Nonnull com.amazon.aws.iot.greengrass.component.common.ComponentArtifact componentArtifact) {\n+        // null check on Unnarchive. Shouldn't happen if cloud recipe is parsed correctly.\n+        Unarchive unArchive = Unarchive.NONE;\n+        if (componentArtifact.getUnarchive() != null) {\n+            unArchive = Unarchive.valueOf(componentArtifact.getUnarchive().name());\n+        }", "originalCommit": "6696ac116f220736f8cbd2da22753c12fe37678b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI1NzU2NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485257564", "bodyText": "Or I guess, why are there 2 \"Unarchive\"s? Let's just use one", "author": "MikeDombo", "createdAt": "2020-09-08T23:54:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0ODgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDA1MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485260051", "bodyText": "Yeah. We have kernel/model/PackageRecipe vs common/model/ComponentRecipe because they now differ completely. But I'm fine with they both use same type from common model, like for \"componentType\" to use common/model/ComponentType.\nThe alternative is to have two set of models completely. For example,  kernel/model/ComponentType vs common/model/ComponentType. But it's a lot of additional work and we don't really gain any benefit until these two models differ. (ex. need to add device specific helper logic).", "author": "leaf94", "createdAt": "2020-09-09T00:02:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0ODgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDI4OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485260288", "bodyText": "Having said that though, no additional change is required for this PR - I'm picking this up on top of it to finalize models for B1.", "author": "leaf94", "createdAt": "2020-09-09T00:03:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0ODgwNg=="}], "type": "inlineReview"}, {"oid": "80df10c01df665087af5cf597a8c088ed387488c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/80df10c01df665087af5cf597a8c088ed387488c", "message": "Merge branch 'master' into platform_fix", "committedDate": "2020-09-08T23:47:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMzNDIzNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485334234", "bodyText": "don't sleep", "author": "MikeDombo", "createdAt": "2020-09-09T04:44:01Z", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/CustomerApp-1.0.0.yaml", "diffHunk": "@@ -5,6 +5,22 @@ Description: A customer app\n Publisher: Me\n Version: '1.0.0'\n Manifests:\n+  - Platform:\n+      os: windows\n+    Parameters:\n+      - name: sampleText\n+        value: This is a test\n+        type: STRING\n+    Lifecycle:\n+      run:\n+        powershell -command \"& { echo \\\"Hello evergreen. {{params:sampleText.value}}\\\"; sleep 5 }\"", "originalCommit": "b98e18e5aeb21b69a53a7a5677945d0312c7b1b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMzNDMyMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/408#discussion_r485334323", "bodyText": "unless you need that for some reason", "author": "MikeDombo", "createdAt": "2020-09-09T04:44:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMzNDIzNA=="}], "type": "inlineReview"}, {"oid": "5b9c6ee1d51c3618f5004227ee3008d06114d56a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5b9c6ee1d51c3618f5004227ee3008d06114d56a", "message": "fix powershell command for windows test", "committedDate": "2020-09-09T05:00:34Z", "type": "commit"}, {"oid": "5b9c6ee1d51c3618f5004227ee3008d06114d56a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5b9c6ee1d51c3618f5004227ee3008d06114d56a", "message": "fix powershell command for windows test", "committedDate": "2020-09-09T05:00:34Z", "type": "forcePushed"}]}