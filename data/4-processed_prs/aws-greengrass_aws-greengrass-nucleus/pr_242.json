{"pr_number": 242, "pr_title": "Update deployment parameters to Configuration to match cloud service", "pr_createdAt": "2020-05-14T18:53:25Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242", "timeline": [{"oid": "e84c7d5016b6a3df3551ca2e2c6b605da6612fe3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e84c7d5016b6a3df3551ca2e2c6b605da6612fe3", "message": "Update deployment parameters to Configuration to match cloud service", "committedDate": "2020-05-15T16:43:18Z", "type": "commit"}, {"oid": "d87f3c5594000eea96398cd30dcf94a7245ec397", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d87f3c5594000eea96398cd30dcf94a7245ec397", "message": "Disable broken cloud integration test", "committedDate": "2020-05-15T16:53:33Z", "type": "forcePushed"}, {"oid": "22f17e3677182bf0f1e000c9a473802af2f45ddb", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/22f17e3677182bf0f1e000c9a473802af2f45ddb", "message": "Disable broken cloud integration test", "committedDate": "2020-05-15T16:57:06Z", "type": "commit"}, {"oid": "22f17e3677182bf0f1e000c9a473802af2f45ddb", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/22f17e3677182bf0f1e000c9a473802af2f45ddb", "message": "Disable broken cloud integration test", "committedDate": "2020-05-15T16:57:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk1MTgwMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425951803", "bodyText": "typo? ParameterType.BOOLEAN", "author": "hui-yang", "createdAt": "2020-05-15T17:39:41Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageParameter.java", "diffHunk": "@@ -47,6 +51,29 @@ public PackageParameter(String name, String value, ParameterType type) {\n         this.value = value;\n     }\n \n+    /**\n+     * Get a set of parameters from a map of ParameterName -> ParameterValue.\n+     *\n+     * @param configuration map of parameters\n+     * @return set of parameters\n+     */\n+    public static Set<PackageParameter> fromMap(Map<String, Object> configuration) {\n+        HashSet<PackageParameter> set = new HashSet<>();\n+        for (Map.Entry<String, Object> parameter : configuration.entrySet()) {\n+            Object value = parameter.getValue();\n+            if (value instanceof String) {\n+                set.add(new PackageParameter(parameter.getKey(), (String) parameter.getValue(), ParameterType.STRING));\n+            } else if (value instanceof Boolean) {\n+                set.add(new PackageParameter(parameter.getKey(), ((Boolean) parameter.getValue()).toString(),\n+                        ParameterType.STRING));", "originalCommit": "22f17e3677182bf0f1e000c9a473802af2f45ddb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk1MjYxOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425952619", "bodyText": "nit: replace all the parameter.getValue() with value", "author": "hui-yang", "createdAt": "2020-05-15T17:41:15Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageParameter.java", "diffHunk": "@@ -47,6 +51,29 @@ public PackageParameter(String name, String value, ParameterType type) {\n         this.value = value;\n     }\n \n+    /**\n+     * Get a set of parameters from a map of ParameterName -> ParameterValue.\n+     *\n+     * @param configuration map of parameters\n+     * @return set of parameters\n+     */\n+    public static Set<PackageParameter> fromMap(Map<String, Object> configuration) {\n+        HashSet<PackageParameter> set = new HashSet<>();\n+        for (Map.Entry<String, Object> parameter : configuration.entrySet()) {\n+            Object value = parameter.getValue();\n+            if (value instanceof String) {\n+                set.add(new PackageParameter(parameter.getKey(), (String) parameter.getValue(), ParameterType.STRING));", "originalCommit": "22f17e3677182bf0f1e000c9a473802af2f45ddb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dcaf57c1ad62a83085f058af76b4db1ba7367a37", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/dcaf57c1ad62a83085f058af76b4db1ba7367a37", "message": "Address pr comments", "committedDate": "2020-05-15T17:46:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2MDM4MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425960381", "bodyText": "Handle lists and maps (recursive parsing)? Will need the ParameterType also to support that.\nRight now if a list is passed then it will be ignored. The cloud document uses example of a list.", "author": "abanthiy", "createdAt": "2020-05-15T17:56:21Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageParameter.java", "diffHunk": "@@ -47,6 +51,29 @@ public PackageParameter(String name, String value, ParameterType type) {\n         this.value = value;\n     }\n \n+    /**\n+     * Get a set of parameters from a map of ParameterName -> ParameterValue.\n+     *\n+     * @param configuration map of parameters\n+     * @return set of parameters\n+     */\n+    public static Set<PackageParameter> fromMap(Map<String, Object> configuration) {\n+        HashSet<PackageParameter> set = new HashSet<>();\n+        for (Map.Entry<String, Object> parameter : configuration.entrySet()) {\n+            Object value = parameter.getValue();\n+            if (value instanceof String) {\n+                set.add(new PackageParameter(parameter.getKey(), (String) parameter.getValue(), ParameterType.STRING));\n+            } else if (value instanceof Boolean) {\n+                set.add(new PackageParameter(parameter.getKey(), ((Boolean) parameter.getValue()).toString(),\n+                        ParameterType.STRING));\n+            } else if (value instanceof Number) {\n+                set.add(new PackageParameter(parameter.getKey(), String.valueOf(parameter.getValue()),\n+                        ParameterType.NUMBER));\n+            }", "originalCommit": "22f17e3677182bf0f1e000c9a473802af2f45ddb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2NTg4NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425965884", "bodyText": "I don't think it makes sense to support that because our parameters need to be turned into strings. I'm not sure what it would mean to have a list as an environment variable.\nFor example, we do {{params:param1.value}}, which of course can be any string value. But I don't know what we'd want to do for lists and maps.", "author": "MikeDombo", "createdAt": "2020-05-15T18:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2MDM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4NjkyNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425986924", "bodyText": "A customer can parse that string as list in their service. I am just reading from the cloud doc which says supporting complex types for params. I am ok with us not handling it right now but expectation of cloud should be clear.", "author": "abanthiy", "createdAt": "2020-05-15T18:50:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2MDM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4Nzg2OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425987869", "bodyText": "Agreed, I'll check with cloud and others. I'm not sure we want/need to support anything more complex.", "author": "MikeDombo", "createdAt": "2020-05-15T18:52:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2MDM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4ODExOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/242#discussion_r425988119", "bodyText": "For lists and maps they will still be valid json strings, so can be added to config as it is i.e. as strings for now. Example, a json list or map that goes into the custom config. Looks like it will take the type ParameterType.STRING here for now, in the meeting people were inclined towards having explicit validation on Json list / map by introducing new parameter types accordingly. But that is not needed right away. For now what we have will unblock the cloud and device integration and we can come back and add more types later as needed", "author": "shaguptashaikh", "createdAt": "2020-05-15T18:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2MDM4MQ=="}], "type": "inlineReview"}]}