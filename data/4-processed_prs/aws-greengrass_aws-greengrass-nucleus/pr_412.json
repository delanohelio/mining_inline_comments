{"pr_number": 412, "pr_title": "Deployment service get component group configs", "pr_createdAt": "2020-09-04T17:57:03Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412", "timeline": [{"oid": "b6906fcd919e3b742909bda76a446eea17b688fd", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b6906fcd919e3b742909bda76a446eea17b688fd", "message": "Get group config arns by component. Add unit test.", "committedDate": "2020-09-04T17:52:29Z", "type": "commit"}, {"oid": "2d8b385611b50b6beb259be6ee2007dfc38f82e8", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2d8b385611b50b6beb259be6ee2007dfc38f82e8", "message": "Merge branch 'master' into deploymentServiceGetComponentGroupChanges", "committedDate": "2020-09-04T20:34:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDc1Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#discussion_r483834753", "bodyText": "nit: why not fleetConfigArn?", "author": "hui-yang", "createdAt": "2020-09-04T20:38:48Z", "path": "src/main/java/com/aws/iot/evergreen/deployment/DeploymentService.java", "diffHunk": "@@ -67,7 +67,7 @@\n     public static final String GROUP_TO_ROOT_COMPONENTS_TOPICS = \"GroupToRootComponents\";\n     public static final String COMPONENTS_TO_GROUPS_TOPICS = \"ComponentToGroups\";\n     public static final String GROUP_TO_ROOT_COMPONENTS_VERSION_KEY = \"version\";\n-    public static final String GROUP_TO_ROOT_COMPONENTS_GROUP_DEPLOYMENT_ID = \"groupDeploymentId\";\n+    public static final String GROUP_TO_ROOT_COMPONENTS_GROUP_CONFIG_ARN = \"groupConfigArn\";", "originalCommit": "2d8b385611b50b6beb259be6ee2007dfc38f82e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDkyOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#discussion_r483834929", "bodyText": "Are these two functions only used in tests?", "author": "hui-yang", "createdAt": "2020-09-04T20:39:21Z", "path": "src/main/java/com/aws/iot/evergreen/deployment/DeploymentService.java", "diffHunk": "@@ -495,4 +495,41 @@ private void setComponentsToGroupsMapping(Topics groupsToRootComponents) {\n         }\n \n     }\n+\n+    /**\n+     * Gets the list of all the groups that the component is a part of.\n+     *\n+     * @param componentName The name of the component.\n+     * @return The list of groups the component is a part of.\n+     */\n+    public Set<String> getGroupConfigsForUserComponent(String componentName) {\n+        Topics componentsToGroupsTopics = config.lookupTopics(COMPONENTS_TO_GROUPS_TOPICS);\n+\n+        Set<String> componentGroups = new HashSet<>();\n+        if (componentsToGroupsTopics != null) {\n+            Topics groupsTopics = componentsToGroupsTopics.lookupTopics(componentName);\n+            groupsTopics.children.values().stream().map(n -> (Topic) n).map(Topic::getName)\n+                    .forEach(componentGroups::add);\n+        }\n+        return componentGroups;\n+    }\n+\n+    /**\n+     * Gets the list of all the groups that the thing is a part of.\n+     * @return All the group configs.\n+     */\n+    public Set<String> getAllGroupConfigs() {\n+        Topics componentsToGroupsTopics = config.lookupTopics(COMPONENTS_TO_GROUPS_TOPICS);\n+\n+        Set<String> componentGroups = new HashSet<>();\n+        if (componentsToGroupsTopics != null) {\n+            componentsToGroupsTopics.iterator().forEachRemaining(node -> {\n+                Topics groupsTopics = (Topics) node;\n+                groupsTopics.children.values().stream().map(n -> (Topic) n).map(Topic::getName)\n+                        .forEach(componentGroups::add);\n+\n+            });\n+        }\n+        return componentGroups;\n+    }", "originalCommit": "2d8b385611b50b6beb259be6ee2007dfc38f82e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNTc2NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#discussion_r483835764", "bodyText": "No. These will be used in the log-manager to get the groups the component/system belongs to; for calculating the log group/stream name", "author": "nikkhilmuthye", "createdAt": "2020-09-04T20:41:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDkyOQ=="}], "type": "inlineReview"}]}