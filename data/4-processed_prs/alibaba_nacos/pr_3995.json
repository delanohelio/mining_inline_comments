{"pr_number": 3995, "pr_title": "Refactor dispatch task execute", "pr_createdAt": "2020-10-15T09:17:14Z", "pr_url": "https://github.com/alibaba/nacos/pull/3995", "timeline": [{"oid": "d4f21fc974c63ac0839f5dab6fdd0dca7cc28a6c", "url": "https://github.com/alibaba/nacos/commit/d4f21fc974c63ac0839f5dab6fdd0dca7cc28a6c", "message": "Refactor nacos task execute engine", "committedDate": "2020-10-15T02:44:10Z", "type": "commit"}, {"oid": "6b291294d605fba294f3e381488d4142291afc59", "url": "https://github.com/alibaba/nacos/commit/6b291294d605fba294f3e381488d4142291afc59", "message": "Refactor nacos task execute engine", "committedDate": "2020-10-15T06:43:20Z", "type": "commit"}, {"oid": "0ba85b823c42c1e6c6e4280096a846e503e52d52", "url": "https://github.com/alibaba/nacos/commit/0ba85b823c42c1e6c6e4280096a846e503e52d52", "message": "For checkstyle", "committedDate": "2020-10-15T08:44:44Z", "type": "commit"}, {"oid": "e2b1f38be54de5d5037409df5530c0ce7047500f", "url": "https://github.com/alibaba/nacos/commit/e2b1f38be54de5d5037409df5530c0ce7047500f", "message": "For checkstyle", "committedDate": "2020-10-15T08:45:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NDc3Mw==", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505494773", "bodyText": "Can it be dynamically changed or defined by the user", "author": "chuntaojun", "createdAt": "2020-10-15T12:19:22Z", "path": "common/src/main/java/com/alibaba/nacos/common/task/engine/NacosExecuteTaskExecuteEngine.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.task.engine;\n+\n+import com.alibaba.nacos.api.exception.NacosException;\n+import com.alibaba.nacos.common.task.AbstractExecuteTask;\n+import com.alibaba.nacos.common.task.NacosTaskProcessor;\n+import org.slf4j.Logger;\n+\n+import java.util.Collection;\n+\n+/**\n+ * Nacos execute task execute engine.\n+ *\n+ * @author xiweng.yy\n+ */\n+public class NacosExecuteTaskExecuteEngine extends AbstractNacosTaskExecuteEngine<AbstractExecuteTask> {\n+    \n+    private final TaskExecuteWorker[] executeWorkers;", "originalCommit": "e2b1f38be54de5d5037409df5530c0ce7047500f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NTIxNA==", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505495214", "bodyText": "If I remember correctly, there's a special way to do this", "author": "chuntaojun", "createdAt": "2020-10-15T12:20:06Z", "path": "common/src/main/java/com/alibaba/nacos/common/task/engine/NacosExecuteTaskExecuteEngine.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.task.engine;\n+\n+import com.alibaba.nacos.api.exception.NacosException;\n+import com.alibaba.nacos.common.task.AbstractExecuteTask;\n+import com.alibaba.nacos.common.task.NacosTaskProcessor;\n+import org.slf4j.Logger;\n+\n+import java.util.Collection;\n+\n+/**\n+ * Nacos execute task execute engine.\n+ *\n+ * @author xiweng.yy\n+ */\n+public class NacosExecuteTaskExecuteEngine extends AbstractNacosTaskExecuteEngine<AbstractExecuteTask> {\n+    \n+    private final TaskExecuteWorker[] executeWorkers;\n+    \n+    public NacosExecuteTaskExecuteEngine(String name, Logger logger) {\n+        super(logger);\n+        int workerCount = findWorkerCount();\n+        executeWorkers = new TaskExecuteWorker[workerCount];\n+        for (int mod = 0; mod < workerCount; ++mod) {\n+            executeWorkers[mod] = new TaskExecuteWorker(name, mod, workerCount);\n+        }\n+    }\n+    \n+    private int findWorkerCount() {", "originalCommit": "e2b1f38be54de5d5037409df5530c0ce7047500f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk3MTAwOQ==", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505971009", "bodyText": "How to do this?", "author": "KomachiSion", "createdAt": "2020-10-16T01:40:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NTIxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAyMjY2OA==", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r506022668", "bodyText": "com.alibaba.nacos.common.utils.ThreadUtils#getSuitableThreadCount", "author": "chuntaojun", "createdAt": "2020-10-16T03:23:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NTIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NzEzNg==", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505497136", "bodyText": "must be thread ? why not use runnable that execute by thread-pool-executor", "author": "chuntaojun", "createdAt": "2020-10-15T12:23:14Z", "path": "common/src/main/java/com/alibaba/nacos/common/task/engine/TaskExecuteWorker.java", "diffHunk": "@@ -101,12 +96,12 @@ public void shutdown() throws NacosException {\n      * Inner execute worker.\n      */\n     private class InnerWorker extends Thread {", "originalCommit": "e2b1f38be54de5d5037409df5530c0ce7047500f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk3MDkxMA==", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505970910", "bodyText": "I just move this part, It can be enhance in other atomic PR", "author": "KomachiSion", "createdAt": "2020-10-16T01:40:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NzEzNg=="}], "type": "inlineReview"}, {"oid": "e8fe6692dc6799e2d3564a78b761bc82f932141a", "url": "https://github.com/alibaba/nacos/commit/e8fe6692dc6799e2d3564a78b761bc82f932141a", "message": "Use ThreadUtils to reduce duplicate codes", "committedDate": "2020-10-16T03:43:09Z", "type": "commit"}, {"oid": "b0c9ddb2a2c2bfcfbbcf620ea46f509739bc81d6", "url": "https://github.com/alibaba/nacos/commit/b0c9ddb2a2c2bfcfbbcf620ea46f509739bc81d6", "message": "Set custom logger for TaskExecuteWorker", "committedDate": "2020-10-16T03:53:12Z", "type": "commit"}, {"oid": "0f20fcd8f3811967564f7c593e11a9f1df617ef7", "url": "https://github.com/alibaba/nacos/commit/0f20fcd8f3811967564f7c593e11a9f1df617ef7", "message": "Set custom logger for TaskExecuteWorker", "committedDate": "2020-10-16T03:58:44Z", "type": "commit"}]}