{"pr_number": 3084, "pr_title": "[ISSUE #2856]Adjust the use of thread pools", "pr_createdAt": "2020-06-16T12:05:22Z", "pr_url": "https://github.com/alibaba/nacos/pull/3084", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg0NjI4Nw==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r440846287", "bodyText": "\u4f7f\u7528ClassUtils\u91cc\u9762\u7684\u5de5\u5177\u7c7b\u5904\u7406", "author": "chuntaojun", "createdAt": "2020-06-16T13:24:46Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/service/ConfigSubService.java", "diffHunk": "@@ -54,16 +57,10 @@\n     public ConfigSubService(ServerMemberManager memberManager) {\n         this.memberManager = memberManager;\n \n-        scheduler = Executors.newScheduledThreadPool(\n-            ThreadUtils.getSuitableThreadCount(), new ThreadFactory() {\n-                @Override\n-                public Thread newThread(Runnable r) {\n-                    Thread t = new Thread(r);\n-                    t.setDaemon(true);\n-                    t.setName(\"com.alibaba.nacos.ConfigSubService\");\n-                    return t;\n-                }\n-            });\n+        scheduler = ExecutorFactory.newScheduledExecutorService(\n+                Config.class.getCanonicalName(),", "originalCommit": "3898974d0f1d74238764b0302ef55b7aa64f83ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1NzkxMg==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r440857912", "bodyText": "\u5176\u4ed6\u7c7b\u4f3c\u7684\u5730\u65b9\u540c\u4e0a\u5904\u7406", "author": "chuntaojun", "createdAt": "2020-06-16T13:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg0NjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg2NjE0Mg==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r440866142", "bodyText": "ok \u6211\u6539\u4e0b", "author": "wangweizZZ", "createdAt": "2020-06-16T13:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg0NjI4Nw=="}], "type": "inlineReview"}, {"oid": "8c2ef446e2d8a6dbb281dae0cc3bbc894094f431", "url": "https://github.com/alibaba/nacos/commit/8c2ef446e2d8a6dbb281dae0cc3bbc894094f431", "message": "[ISSUE #2856]Adjust the use of thread pools", "committedDate": "2020-06-16T16:36:05Z", "type": "forcePushed"}, {"oid": "315cf811bb2571088fa23b08ce5cac630c305c28", "url": "https://github.com/alibaba/nacos/commit/315cf811bb2571088fa23b08ce5cac630c305c28", "message": "[ISSUE #2856][module:core\u3001consistency]Adjust the use of thread pools\n\nChange-Id: I793770ca0f287157dc88e3ecf1147ea308e4a547", "committedDate": "2020-06-17T04:45:07Z", "type": "commit"}, {"oid": "315cf811bb2571088fa23b08ce5cac630c305c28", "url": "https://github.com/alibaba/nacos/commit/315cf811bb2571088fa23b08ce5cac630c305c28", "message": "[ISSUE #2856][module:core\u3001consistency]Adjust the use of thread pools\n\nChange-Id: I793770ca0f287157dc88e3ecf1147ea308e4a547", "committedDate": "2020-06-17T04:45:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NjYxOA==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441286618", "bodyText": "return directly, do not use tmp variable.\nlike return Executors.newFixedThreadPool(1);\nfollow methods are the same.", "author": "KomachiSion", "createdAt": "2020-06-17T05:21:19Z", "path": "common/src/main/java/com/alibaba/nacos/common/executor/ExecutorFactory.java", "diffHunk": "@@ -27,70 +27,169 @@\n /**\n  * Unified thread pool creation factory, and actively create thread\n  * pool resources by ThreadPoolManager for unified life cycle management\n+ * {@link ExecutorFactory.Managed}\n+ *\n+ * Unified thread pool creation factory without life cycle management\n+ * {@link ExecutorFactory}\n  *\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n @SuppressWarnings(\"PMD.ThreadPoolCreationRule\")\n public final class ExecutorFactory {\n \n-    private static final ThreadPoolManager THREAD_POOL_MANAGER = ThreadPoolManager.getInstance();\n+    public static ExecutorService newSingleExecutorService() {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1);\n+        return executorService;", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5NzA1MQ==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441297051", "bodyText": "ok", "author": "wangweizZZ", "createdAt": "2020-06-17T05:55:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NjYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NzM1OQ==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441287359", "bodyText": "don't change the old methods.\nremove them after change to use new mehtod will be ok.", "author": "KomachiSion", "createdAt": "2020-06-17T05:23:52Z", "path": "common/src/main/java/com/alibaba/nacos/common/executor/ExecutorFactory.java", "diffHunk": "@@ -27,70 +27,169 @@\n /**\n  * Unified thread pool creation factory, and actively create thread\n  * pool resources by ThreadPoolManager for unified life cycle management\n+ * {@link ExecutorFactory.Managed}\n+ *\n+ * Unified thread pool creation factory without life cycle management\n+ * {@link ExecutorFactory}\n  *\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n @SuppressWarnings(\"PMD.ThreadPoolCreationRule\")\n public final class ExecutorFactory {\n \n-    private static final ThreadPoolManager THREAD_POOL_MANAGER = ThreadPoolManager.getInstance();\n+    public static ExecutorService newSingleExecutorService() {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1);\n+        return executorService;\n+    }\n+\n+    public static ExecutorService newSingleExecutorService(final ThreadFactory threadFactory) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1, threadFactory);\n+        return executorService;\n+    }\n \n-    public static final String DEFAULT_NAMESPACE = \"nacos\";\n+    public static ExecutorService newFixExecutorService(final int nThreads) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(nThreads);\n+        return executorService;\n+    }\n \n+    public static ExecutorService newFixExecutorService(final int nThreads,\n+                                                        final ThreadFactory threadFactory) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(nThreads, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ScheduledExecutorService newSingleScheduledExecutorService(final ThreadFactory threadFactory) {\n+        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ScheduledExecutorService newScheduledExecutorService( final int nThreads,\n+                                                                        final ThreadFactory threadFactory) {\n+        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(nThreads, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ThreadPoolExecutor newCustomerThreadExecutor(\n+        final int coreThreads,\n+        final int maxThreads,\n+        final long keepAliveTimeMs,\n+        final ThreadFactory threadFactory) {\n+        ThreadPoolExecutor executor = new ThreadPoolExecutor(coreThreads, maxThreads,\n+            keepAliveTimeMs, TimeUnit.MILLISECONDS,\n+            new LinkedBlockingQueue<Runnable>(),\n+            threadFactory);\n+        return executor;\n+    }\n+    //TODO remove Deprecated function after replace all module\n+    @Deprecated\n     public static ExecutorService newSingleExecutorService(final String group) {\n         ExecutorService executorService = Executors.newFixedThreadPool(1);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ExecutorService newSingleExecutorService(final String group,\n-                                                           final ThreadFactory threadFactory) {\n+        final ThreadFactory threadFactory) {\n         ExecutorService executorService = Executors.newFixedThreadPool(1, threadFactory);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5ODM0Mg==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441298342", "bodyText": "ok, i will rollback the old methods now,and remove them after replace all module", "author": "wangweizZZ", "createdAt": "2020-06-17T05:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NzM1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDI3MQ==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441290271", "bodyText": "If register to managed, whether should shutdown in here?", "author": "KomachiSion", "createdAt": "2020-06-17T05:34:35Z", "path": "core/src/main/java/com/alibaba/nacos/core/file/WatchFileCenter.java", "diffHunk": "@@ -176,7 +175,8 @@ void addSubscribe(final FileWatcher watcher) {\n \t\t}\n \n \t\tvoid shutdown() {\n-\t\t\twatch = false;\n+\t\t    watch = false;\n+            ThreadUtils.shutdownThreadPool(this.callBackExecutor);", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMzkyNw==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441303927", "bodyText": "yes\u3002if register to managed", "author": "wangweizZZ", "createdAt": "2020-06-17T06:15:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDM1NA==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441290354", "bodyText": "\u4e0d\u7eb3\u5165\u81ea\u52a8\u7ba1\u7406\u7684\uff0c\u4e0d\u9700\u8981group\u53c2\u6570", "author": "chuntaojun", "createdAt": "2020-06-17T05:34:53Z", "path": "common/src/main/java/com/alibaba/nacos/common/executor/ExecutorFactory.java", "diffHunk": "@@ -27,70 +27,169 @@\n /**\n  * Unified thread pool creation factory, and actively create thread\n  * pool resources by ThreadPoolManager for unified life cycle management\n+ * {@link ExecutorFactory.Managed}\n+ *\n+ * Unified thread pool creation factory without life cycle management\n+ * {@link ExecutorFactory}\n  *\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n @SuppressWarnings(\"PMD.ThreadPoolCreationRule\")\n public final class ExecutorFactory {\n \n-    private static final ThreadPoolManager THREAD_POOL_MANAGER = ThreadPoolManager.getInstance();\n+    public static ExecutorService newSingleExecutorService() {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1);\n+        return executorService;\n+    }\n+\n+    public static ExecutorService newSingleExecutorService(final ThreadFactory threadFactory) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1, threadFactory);\n+        return executorService;\n+    }\n \n-    public static final String DEFAULT_NAMESPACE = \"nacos\";\n+    public static ExecutorService newFixExecutorService(final int nThreads) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(nThreads);\n+        return executorService;\n+    }\n \n+    public static ExecutorService newFixExecutorService(final int nThreads,\n+                                                        final ThreadFactory threadFactory) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(nThreads, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ScheduledExecutorService newSingleScheduledExecutorService(final ThreadFactory threadFactory) {\n+        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ScheduledExecutorService newScheduledExecutorService( final int nThreads,\n+                                                                        final ThreadFactory threadFactory) {\n+        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(nThreads, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ThreadPoolExecutor newCustomerThreadExecutor(\n+        final int coreThreads,\n+        final int maxThreads,\n+        final long keepAliveTimeMs,\n+        final ThreadFactory threadFactory) {\n+        ThreadPoolExecutor executor = new ThreadPoolExecutor(coreThreads, maxThreads,\n+            keepAliveTimeMs, TimeUnit.MILLISECONDS,\n+            new LinkedBlockingQueue<Runnable>(),\n+            threadFactory);\n+        return executor;\n+    }\n+    //TODO remove Deprecated function after replace all module\n+    @Deprecated\n     public static ExecutorService newSingleExecutorService(final String group) {\n         ExecutorService executorService = Executors.newFixedThreadPool(1);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ExecutorService newSingleExecutorService(final String group,\n-                                                           final ThreadFactory threadFactory) {\n+        final ThreadFactory threadFactory) {\n         ExecutorService executorService = Executors.newFixedThreadPool(1, threadFactory);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ExecutorService newFixExecutorService(final String group,", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5ODkzMg==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441298932", "bodyText": "\u55ef \u56e0\u4e3a\u8fd9\u4e2apr\u5f53\u524d\u53ea\u662f\u6539\u4e86\u90e8\u5206\u6a21\u5757\uff0c\u5176\u4ed6\u6a21\u5757\u672a\u4fee\u6539\u7684\u8fd8\u5728\u4f7f\u7528\u8fd9\u90e8\u5206group\u7684\uff0c\u76ee\u524d\u5148\u6807\u8bb0deprecated\uff0c\u6539\u5b8c\u6240\u6709\u6a21\u5757\u8fd9\u4e9b\u5e26group\u7684\u5c31\u53ef\u4ee5\u5220\u4e86", "author": "wangweizZZ", "createdAt": "2020-06-17T06:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDM1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDkyOA==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441290928", "bodyText": "\u6216\u8bb8\u53ef\u4ee5\u4e0d\u9700\u8981\u8fd9\u4e2a\uff0c\u6709\u5e26group\u53c2\u6570\u7684\u5c31\u662f\u9700\u8981\u88ab\u81ea\u52a8\u7eb3\u5165\u7ba1\u7406\u7684\uff0c\u6ce8\u91ca\u8bf4\u660e\u5c31\u597d", "author": "chuntaojun", "createdAt": "2020-06-17T05:36:44Z", "path": "common/src/main/java/com/alibaba/nacos/common/executor/ExecutorFactory.java", "diffHunk": "@@ -27,70 +27,169 @@\n /**\n  * Unified thread pool creation factory, and actively create thread\n  * pool resources by ThreadPoolManager for unified life cycle management\n+ * {@link ExecutorFactory.Managed}\n+ *\n+ * Unified thread pool creation factory without life cycle management\n+ * {@link ExecutorFactory}\n  *\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n @SuppressWarnings(\"PMD.ThreadPoolCreationRule\")\n public final class ExecutorFactory {\n \n-    private static final ThreadPoolManager THREAD_POOL_MANAGER = ThreadPoolManager.getInstance();\n+    public static ExecutorService newSingleExecutorService() {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1);\n+        return executorService;\n+    }\n+\n+    public static ExecutorService newSingleExecutorService(final ThreadFactory threadFactory) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(1, threadFactory);\n+        return executorService;\n+    }\n \n-    public static final String DEFAULT_NAMESPACE = \"nacos\";\n+    public static ExecutorService newFixExecutorService(final int nThreads) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(nThreads);\n+        return executorService;\n+    }\n \n+    public static ExecutorService newFixExecutorService(final int nThreads,\n+                                                        final ThreadFactory threadFactory) {\n+        ExecutorService executorService = Executors.newFixedThreadPool(nThreads, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ScheduledExecutorService newSingleScheduledExecutorService(final ThreadFactory threadFactory) {\n+        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ScheduledExecutorService newScheduledExecutorService( final int nThreads,\n+                                                                        final ThreadFactory threadFactory) {\n+        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(nThreads, threadFactory);\n+        return executorService;\n+    }\n+\n+    public static ThreadPoolExecutor newCustomerThreadExecutor(\n+        final int coreThreads,\n+        final int maxThreads,\n+        final long keepAliveTimeMs,\n+        final ThreadFactory threadFactory) {\n+        ThreadPoolExecutor executor = new ThreadPoolExecutor(coreThreads, maxThreads,\n+            keepAliveTimeMs, TimeUnit.MILLISECONDS,\n+            new LinkedBlockingQueue<Runnable>(),\n+            threadFactory);\n+        return executor;\n+    }\n+    //TODO remove Deprecated function after replace all module\n+    @Deprecated\n     public static ExecutorService newSingleExecutorService(final String group) {\n         ExecutorService executorService = Executors.newFixedThreadPool(1);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ExecutorService newSingleExecutorService(final String group,\n-                                                           final ThreadFactory threadFactory) {\n+        final ThreadFactory threadFactory) {\n         ExecutorService executorService = Executors.newFixedThreadPool(1, threadFactory);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ExecutorService newFixExecutorService(final String group,\n-                                                        final int nThreads) {\n+        final int nThreads) {\n         ExecutorService executorService = Executors.newFixedThreadPool(nThreads);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ExecutorService newFixExecutorService(final String group,\n-                                                        final int nThreads,\n-                                                        final ThreadFactory threadFactory) {\n+        final int nThreads,\n+        final ThreadFactory threadFactory) {\n         ExecutorService executorService = Executors.newFixedThreadPool(nThreads, threadFactory);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ScheduledExecutorService newSingleScheduledExecutorService(final String group,\n-                                                                             final ThreadFactory threadFactory) {\n+        final ThreadFactory threadFactory) {\n         ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1, threadFactory);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ScheduledExecutorService newScheduledExecutorService(final String group,\n-                                                                       final int nThreads,\n-                                                                       final ThreadFactory threadFactory) {\n+        final int nThreads,\n+        final ThreadFactory threadFactory) {\n         ScheduledExecutorService executorService = Executors.newScheduledThreadPool(nThreads, threadFactory);\n-        THREAD_POOL_MANAGER.register(DEFAULT_NAMESPACE, group, executorService);\n         return executorService;\n     }\n-\n+    @Deprecated\n     public static ThreadPoolExecutor newCustomerThreadExecutor(final String group,\n+        final int coreThreads,\n+        final int maxThreads,\n+        final long keepAliveTimeMs,\n+        final ThreadFactory threadFactory) {\n+        ThreadPoolExecutor executor = new ThreadPoolExecutor(coreThreads, maxThreads,\n+            keepAliveTimeMs, TimeUnit.MILLISECONDS,\n+            new LinkedBlockingQueue<Runnable>(),\n+            threadFactory);\n+        return executor;\n+    }\n+\n+    public final static class Managed{", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxMTg5NA==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441311894", "bodyText": "emmm. \u4e2a\u4eba\u89c9\u5f97\u66f4\u6e05\u6670\u4e00\u70b9\u3002\u8fd9\u4e2a\u53ef\u4ee5\u518d\u770b\u4e0b \u5927\u5bb6\u7684\u610f\u89c1", "author": "wangweizZZ", "createdAt": "2020-06-17T06:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDkyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQyOTE2NQ==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441429165", "bodyText": "\u6211\u89c9\u5f97\u53ef\u4ee5\u7559\uff0c\u66f4\u5bb9\u6613\u8868\u8fbe\u8bed\u610f\uff0c\u4e4b\u540e\u53ef\u4ee5\u770b\u60c5\u51b5\u79fb\u52a8\u5230\u66f4\u5408\u7406\u7684\u4f4d\u7f6e\u3002", "author": "KomachiSion", "createdAt": "2020-06-17T09:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MDkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTI5OQ==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441291299", "bodyText": "\u8fd9\u4e9b\u901a\u8fc7class\u83b7\u53d6\u7c7b\u4fe1\u606f\u7684\uff0c\u90fd\u7528ClassUtils", "author": "chuntaojun", "createdAt": "2020-06-17T05:37:45Z", "path": "consistency/src/main/java/com/alibaba/nacos/consistency/ProtocolMetaData.java", "diffHunk": "@@ -40,7 +40,10 @@\n @SuppressWarnings(\"PMD.Rule:CollectionInitShouldAssignCapacityRule\")\n public final class ProtocolMetaData {\n \n-    private static final Executor EXECUTOR = ExecutorFactory.newFixExecutorService(ProtocolMetaData.class.getCanonicalName(), 4, new NameThreadFactory(\"nacos.consistency.protocol.metadata\"));\n+    private static final Executor EXECUTOR = ExecutorFactory.Managed.newFixExecutorService(\n+            ProtocolMetaData.class.getCanonicalName(),", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5NTExMA==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441295110", "bodyText": "\u8fd9\u4e2a\u5730\u65b9\u6ca1\u6539\u662f\u56e0\u4e3a\u8fd9\u4e2a consistency \u5e76\u4e0d\u4f9d\u8d56 core\u6a21\u5757,\u6ca1\u6709core \u91cc\u8fb9\u7684 ClassUtils", "author": "wangweizZZ", "createdAt": "2020-06-17T05:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTI5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTU5MQ==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441291591", "bodyText": "Should use Managed. newSingleExecutorService?", "author": "KomachiSion", "createdAt": "2020-06-17T05:38:30Z", "path": "core/src/main/java/com/alibaba/nacos/core/file/WatchFileCenter.java", "diffHunk": "@@ -154,9 +154,8 @@ public WatchDirJob(String paths) throws NacosException {\n \t\t\t}\n \n \t\t\tthis.callBackExecutor = ExecutorFactory\n-\t\t\t\t\t.newFixExecutorService(WatchFileCenter.class.getCanonicalName(),\n-\t\t\t\t\t\t\t1,\n-\t\t\t\t\t\t\tnew NameThreadFactory(\"com.alibaba.nacos.file.watch-\" + paths));\n+                    .newSingleExecutorService(", "originalCommit": "315cf811bb2571088fa23b08ce5cac630c305c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMzUxMw==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441303513", "bodyText": "Because this ExecutorService belong to WatchDirJob instance. I worry about the WatchFileCenter will dymaic add/remove WatchDirJob instance .If exist remove behavior ,it should manage itself", "author": "wangweizZZ", "createdAt": "2020-06-17T06:14:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwODc0Nw==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441308747", "bodyText": "@chuntaojun what do you think", "author": "wangweizZZ", "createdAt": "2020-06-17T06:28:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxMjcxMg==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441312712", "bodyText": "yes, it should be manage itself", "author": "chuntaojun", "createdAt": "2020-06-17T06:37:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQzNDA5Ng==", "url": "https://github.com/alibaba/nacos/pull/3084#discussion_r441434096", "bodyText": "ok", "author": "KomachiSion", "createdAt": "2020-06-17T10:06:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MTU5MQ=="}], "type": "inlineReview"}, {"oid": "7949f034fa8c48755427539b9124b0c9e389e135", "url": "https://github.com/alibaba/nacos/commit/7949f034fa8c48755427539b9124b0c9e389e135", "message": "code optimize\n\nChange-Id: I023ed73332f3f69c93277f25e57e0ee5c3975f02", "committedDate": "2020-06-17T07:32:08Z", "type": "commit"}]}