{"pr_number": 4572, "pr_title": "[ISSUE-#4567] Refactor nacos-client Load Logging Configuration code.", "pr_createdAt": "2020-12-25T07:01:44Z", "pr_url": "https://github.com/alibaba/nacos/pull/4572", "timeline": [{"oid": "57965d8f664dc8be5f0d58bc27b6b9e8a17e6f5d", "url": "https://github.com/alibaba/nacos/commit/57965d8f664dc8be5f0d58bc27b6b9e8a17e6f5d", "message": "for #4567, refactor nacos-client logging load Configuration code.", "committedDate": "2020-12-25T06:57:15Z", "type": "commit"}, {"oid": "2d49c2017ae589276ca92a2b7a37a7b937a6aa22", "url": "https://github.com/alibaba/nacos/commit/2d49c2017ae589276ca92a2b7a37a7b937a6aa22", "message": "Modify exception handling.", "committedDate": "2020-12-25T07:06:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyNzU1MQ==", "url": "https://github.com/alibaba/nacos/pull/4572#discussion_r548827551", "bodyText": "\u8fd9\u91cc\u8981\u4e0d\u8981\u964d\u7ea7\u4e00\u4e0b\uff0c\u81ea\u5b9a\u4e49\u7684\u5931\u8d25\u4e86\u7528\u9ed8\u8ba4\u7684\u3002", "author": "horizonzy", "createdAt": "2020-12-25T07:57:00Z", "path": "client/src/main/java/com/alibaba/nacos/client/logging/NacosLoggingUtils.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.client.logging;\n+\n+import com.alibaba.nacos.client.logging.log4j2.Log4J2NacosLogging;\n+import com.alibaba.nacos.client.logging.logback.LogbackNacosLogging;\n+import org.slf4j.LoggerFactory;\n+import org.slf4j.Logger;\n+\n+/**\n+ * nacos logging.\n+ *\n+ * @author mai.jh\n+ */\n+public final class NacosLoggingUtils {\n+    \n+    private static final Logger LOGGER = LoggerFactory.getLogger(NacosLoggingUtils.class);\n+    \n+    /**\n+     * Load logging Configuration.\n+     */\n+    public static void loadConfiguration() {\n+        loadConfiguration(null);\n+    }\n+    \n+    /**\n+     * Load the log configuration file according to the specified {@link AbstractNacosLogging} implementation, If {@code\n+     * logging} is null, use the default policy.\n+     *\n+     * @param logging {@link AbstractNacosLogging}\n+     */\n+    public static void loadConfiguration(AbstractNacosLogging logging) {\n+        try {\n+            if (logging != null) {\n+                logging.loadConfiguration();", "originalCommit": "2d49c2017ae589276ca92a2b7a37a7b937a6aa22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyODE0Nw==", "url": "https://github.com/alibaba/nacos/pull/4572#discussion_r548828147", "bodyText": "\u53ef\u884c", "author": "Maijh97", "createdAt": "2020-12-25T08:01:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyNzU1MQ=="}], "type": "inlineReview"}, {"oid": "a95f024a94d81938f1450426ca894f3bc4b2cd5f", "url": "https://github.com/alibaba/nacos/commit/a95f024a94d81938f1450426ca894f3bc4b2cd5f", "message": "When customizing AbstractNacosLogging Load Configuration Fail, use the default Logging Load Configuration.", "committedDate": "2020-12-25T08:15:14Z", "type": "commit"}, {"oid": "17069ced72a98f5436cb38d77c0e458eb98d342f", "url": "https://github.com/alibaba/nacos/commit/17069ced72a98f5436cb38d77c0e458eb98d342f", "message": "NacosLogging has been modified to a single-column mode.", "committedDate": "2020-12-25T10:27:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgzMTgzMw==", "url": "https://github.com/alibaba/nacos/pull/4572#discussion_r548831833", "bodyText": "LOGGER.warn(\"Customize the {} load configuration fail, use default log configuration. Message: {}\", logging.getClass().getName(), e.getMessage());", "author": "horizonzy", "createdAt": "2020-12-25T08:23:27Z", "path": "client/src/main/java/com/alibaba/nacos/client/logging/NacosLoggingUtils.java", "diffHunk": "@@ -46,7 +46,12 @@ public static void loadConfiguration() {\n     public static void loadConfiguration(AbstractNacosLogging logging) {\n         try {\n             if (logging != null) {\n-                logging.loadConfiguration();\n+                try {\n+                    logging.loadConfiguration();\n+                } catch (Exception e) {\n+                    LOGGER.warn(\"Customize the {} load Configuration fail, message: {}\", logging.getClass().getName(), e.getMessage());", "originalCommit": "a95f024a94d81938f1450426ca894f3bc4b2cd5f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg1Mzk0Mg==", "url": "https://github.com/alibaba/nacos/pull/4572#discussion_r548853942", "bodyText": "\u8fd9\u4e2a\u53d8\u91cf\u611f\u89c9\u597d\u7ed5\u554a\u3002", "author": "horizonzy", "createdAt": "2020-12-25T10:44:31Z", "path": "client/src/main/java/com/alibaba/nacos/client/logging/NacosLogging.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.client.logging;\n+\n+import com.alibaba.nacos.client.logging.log4j2.Log4J2NacosLogging;\n+import com.alibaba.nacos.client.logging.logback.LogbackNacosLogging;\n+import org.slf4j.LoggerFactory;\n+import org.slf4j.Logger;\n+\n+/**\n+ * nacos logging.\n+ *\n+ * @author mai.jh\n+ */\n+public class NacosLogging {\n+    \n+    private static final Logger LOGGER = LoggerFactory.getLogger(NacosLogging.class);\n+    \n+    private AbstractNacosLogging nacosLogging;\n+    \n+    private boolean isLogback = false;\n+    \n+    private NacosLogging() {\n+        try {\n+            Class.forName(\"ch.qos.logback.classic.Logger\");\n+            nacosLogging = new LogbackNacosLogging();\n+            isLogback = true;\n+        } catch (ClassNotFoundException e) {\n+            nacosLogging = new Log4J2NacosLogging();\n+        }\n+    }\n+    \n+    private static class NacosLoggingInstance {\n+        \n+        private static final NacosLogging INSTANCE = new NacosLogging();\n+    }\n+    \n+    public static NacosLogging getInstance() {\n+        return NacosLoggingInstance.INSTANCE;\n+    }\n+    \n+    /**\n+     * Load logging Configuration.\n+     */\n+    public void loadConfiguration() {\n+        try {\n+            nacosLogging.loadConfiguration();", "originalCommit": "17069ced72a98f5436cb38d77c0e458eb98d342f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkzNDQzMQ==", "url": "https://github.com/alibaba/nacos/pull/4572#discussion_r548934431", "bodyText": "\u8fd9\u91cc\u662f\u5355\u4f8b\u6a21\u5f0f+\u7b56\u7565\u6a21\u5f0f\u7684\u5b9e\u73b0\uff0c\u5bf9\u5916\u5176\u5b9e\u53ea\u66b4\u9732\u4e86\u8fd9\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5185\u90e8\u5177\u4f53\u662flogback\u8fd8\u662flog4j2\u662f\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u51b3\u5b9a\u7684\u3002\n\u6682\u65f6\u6ca1\u6709\u5f00\u653e\u5b8c\u5168\u62d3\u5c55\uff0c\u4e3b\u8981\u662f\u4e24\u4e2a\u8003\u8651\uff0c \u4e00\u65b9\u9762\u662fnacos\u7684\u65e5\u5fd7\u4e3b\u8981\u662f\u7ed9\u8fd0\u7ef4\u4eba\u5458\u6392\u67e5\u7528\uff0c\u4e0d\u5e0c\u671b\u4e1a\u52a1\u4eba\u5458\u968f\u610f\u7684\u6539\u52a8nacos\u65e5\u5fd7\u8f93\u51fa\u7684\u7ea7\u522b\u548c\u5185\u5bb9\uff0c\u53e6\u4e00\u65b9\u9762\u65e5\u5fd7\u6846\u67b6\u5176\u5b9e\u5e76\u4e0d\u592a\u591a\uff0c\u4e0d\u4f1a\u9891\u7e41\u6269\u5c55\uff0c\u9002\u914d\u8d77\u6765\u96be\u5ea6\u4e0d\u9ad8\u3002\n\u5c06\u6765\u5982\u679c\u9700\u8981\u5b8c\u5168\u62d3\u5c55\uff0c \u521d\u59cb\u5316\u52a0\u8f7d\u7684\u65f6\u5019\u7528\u4e2aSPI\u5c31\u53ef\u4ee5\u4e86\u3002", "author": "KomachiSion", "createdAt": "2020-12-26T02:41:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg1Mzk0Mg=="}], "type": "inlineReview"}]}