{"pr_number": 808, "pr_title": "JENA-1978: Fuseki examples", "pr_createdAt": "2020-10-09T15:26:36Z", "pr_url": "https://github.com/apache/jena/pull/808", "timeline": [{"oid": "04c836740d9c3c050b39c8642cdc204cdbcd7708", "url": "https://github.com/apache/jena/commit/04c836740d9c3c050b39c8642cdc204cdbcd7708", "message": "Consolidate RAT setup", "committedDate": "2020-10-09T07:52:19Z", "type": "commit"}, {"oid": "8692b27156f2aed0a37566b90bfdd855918d2649", "url": "https://github.com/apache/jena/commit/8692b27156f2aed0a37566b90bfdd855918d2649", "message": "Make the request header id into a constant", "committedDate": "2020-10-09T15:19:25Z", "type": "commit"}, {"oid": "5d7898306fe5a2e6402302ab6535c636f625db7a", "url": "https://github.com/apache/jena/commit/5d7898306fe5a2e6402302ab6535c636f625db7a", "message": "JENA-1976: Default to enabled CORS for coimmand line Fuskei main exec", "committedDate": "2020-10-09T15:20:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY2MTk3Nw==", "url": "https://github.com/apache/jena/pull/808#discussion_r502661977", "bodyText": "Extra spaces", "author": "kinow", "createdAt": "2020-10-09T20:42:12Z", "path": "jena-fuseki2/jena-fuseki-main/src/main/java/org/apache/jena/fuseki/main/cmds/FusekiMain.java", "diffHunk": "@@ -82,8 +82,9 @@\n     private static ArgDecl  argConfig       = new ArgDecl(ArgDecl.HasValue, \"config\", \"conf\");\n     private static ArgDecl  argGZip         = new ArgDecl(ArgDecl.HasValue, \"gzip\");\n     private static ArgDecl  argBase         = new ArgDecl(ArgDecl.HasValue, \"base\", \"files\");\n-\n+    ", "originalCommit": "6c953a36d4209fd16b859cb974d11f41edbece45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNzQwNw==", "url": "https://github.com/apache/jena/pull/808#discussion_r502737407", "bodyText": "Missing newline", "author": "kinow", "createdAt": "2020-10-10T02:59:02Z", "path": "jena-fuseki2/jena-fuseki-main/src/test/java/org/apache/jena/fuseki/main/examples/InitFusekiCustomOperation.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.jena.fuseki.main.examples;\n+\n+import java.io.IOException;\n+\n+import org.apache.jena.atlas.lib.DateTimeUtils;\n+import org.apache.jena.fuseki.Fuseki;\n+import org.apache.jena.fuseki.FusekiException;\n+import org.apache.jena.fuseki.build.FusekiExt;\n+import org.apache.jena.fuseki.server.Operation;\n+import org.apache.jena.fuseki.servlets.ActionService;\n+import org.apache.jena.fuseki.servlets.HttpAction;\n+import org.apache.jena.riot.WebContent;\n+import org.apache.jena.sys.JenaSubsystemLifecycle;\n+import org.apache.jena.web.HttpSC;\n+\n+/**\n+* See https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html\n+*\n+* Example: the file has one line which is the full package, class name.\n+* Build: src/main/resources/META-INF/services/org.apache.jena.sys.JenaSubsystemLifecycle\n+* ----\n+* fuseki.examples.Ex_FusekiCustomOperation.InitFusekiCustomOperation\n+* ----\n+*/\n+public class InitFusekiCustomOperation implements JenaSubsystemLifecycle {\n+\n+    public InitFusekiCustomOperation() {}\n+\n+    @Override\n+    public void start() {\n+        // Can use Fuseki server logging.\n+        Fuseki.configLog.info(\"Add custom operation\");\n+        System.err.println(\"**** Fuseki extension ****\");\n+        Operation op = Operation.alloc(\"http://example/extra-service\", \"extra-service\", \"Test\");\n+        FusekiExt.registerOperation(op, new MyCustomService());\n+        FusekiExt.addDefaultEndpoint(op, \"extra\");\n+    }\n+\n+    @Override\n+    public void stop() {}\n+\n+    @Override\n+    public int level() { return 1000; }\n+\n+    // For convenience of the example - include the implementation of the custom operation in the same file.\n+    private static class MyCustomService extends ActionService {\n+\n+        // Choose.\n+        @Override\n+        public void execGet(HttpAction action) {\n+            executeLifecycle(action);\n+        }\n+\n+        @Override\n+        public void validate(HttpAction action) { }\n+\n+        @Override\n+        public void execute(HttpAction action) {\n+            action.response.setStatus(HttpSC.OK_200);\n+            action.response.setContentType(WebContent.contentTypeTextPlain);\n+            try {\n+                action.response.getOutputStream().print(\"** GET ** \"+DateTimeUtils.nowAsXSDDateTimeString());\n+            } catch (IOException e) {\n+                throw new FusekiException(e);\n+            }\n+        }\n+    }\n+}", "originalCommit": "6c953a36d4209fd16b859cb974d11f41edbece45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNzY3Ng==", "url": "https://github.com/apache/jena/pull/808#discussion_r502737676", "bodyText": "Missing newline", "author": "kinow", "createdAt": "2020-10-10T03:01:35Z", "path": "jena-fuseki2/jena-fuseki-main/src/test/java/org/apache/jena/fuseki/main/examples/ExFuseki_4_CustomOperation_External.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.jena.fuseki.main.examples;\n+\n+import java.util.ServiceLoader;\n+\n+import org.apache.jena.fuseki.main.FusekiServer;\n+import org.apache.jena.fuseki.system.FusekiLogging;\n+import org.apache.jena.riot.web.HttpOp;\n+import org.apache.jena.sparql.core.DatasetGraphFactory;\n+import org.apache.jena.sys.JenaSystem;\n+\n+/**\n+ * Example of adding a new operation to a Fuseki server by registering it with the\n+ * global Fuseki registries.\n+ *\n+ * The custom operation is loaded using {@link ServiceLoader} as shown in\n+ * {@link InitFusekiCustomOperation}.\n+ *\n+ * Doing this, adding the jar to the classpath, including the {@link ServiceLoader}\n+ * setup, will automatically add it to the server.\n+ * <p>\n+ * See <a href=\"https://jena.apache.org/documentation/notes/jena-repack.html\">Repacking Jena jars</a>.\n+ * <p>\n+ * See <a href=\"https://jena.apache.org/documentation/notes/system-initialization.html\">System Initialization</a>\n+ */\n+public class ExFuseki_4_CustomOperation_External {\n+\n+    static {\n+        JenaSystem.init();\n+        FusekiLogging.setLogging();\n+    }\n+\n+    // Example usage.\n+    public static void main(String...args) {\n+\n+        // Imitate Service loader behaviour.\n+        new InitFusekiCustomOperation().start();\n+\n+\n+        // Standard Fuseki startup by commandline.\n+        // /ds/extra will be added because InitFusekiCustomOperation adds it to the default services.\n+\n+        // ThreadLib.async(()->FusekiMainCmd.main(\"--port=3230\", \"--mem\", \"/ds\"));\n+        //Lib.sleep(1000);\n+        // Same as the above command line except it does not block the thread (which is why the ThreadLib.async is added).\n+        FusekiServer.create().port(3230).add(\"/ds\", DatasetGraphFactory.createTxnMem()).build().start();\n+\n+        callOperation(\"extra\");\n+        System.exit(0);\n+    }\n+\n+    private static void callOperation(String name) {\n+        String x = HttpOp.execHttpGetString(\"http://localhost:3230/ds/\"+name);\n+        if ( x == null ) {\n+            System.out.println(\"Not found : <null>\");\n+        } else {\n+            System.out.print(x);\n+            if ( ! x.endsWith(\"\\n\") )\n+                System.out.println();\n+        }\n+    }\n+}", "originalCommit": "6c953a36d4209fd16b859cb974d11f41edbece45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e0737568a56e48aae4f46fc6776179f8b72174c3", "url": "https://github.com/apache/jena/commit/e0737568a56e48aae4f46fc6776179f8b72174c3", "message": "JENA-1978: Fuseki examples", "committedDate": "2020-10-10T09:38:04Z", "type": "commit"}, {"oid": "e0737568a56e48aae4f46fc6776179f8b72174c3", "url": "https://github.com/apache/jena/commit/e0737568a56e48aae4f46fc6776179f8b72174c3", "message": "JENA-1978: Fuseki examples", "committedDate": "2020-10-10T09:38:04Z", "type": "forcePushed"}]}