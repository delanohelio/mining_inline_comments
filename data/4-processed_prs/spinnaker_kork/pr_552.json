{"pr_number": 552, "pr_title": "fix(plugins): Set the service version to the actual resolved value in\u2026", "pr_createdAt": "2020-03-14T22:15:55Z", "pr_url": "https://github.com/spinnaker/kork/pull/552", "timeline": [{"oid": "0d0dd55f5f34bd981e5914994c71f0819dd5f76e", "url": "https://github.com/spinnaker/kork/commit/0d0dd55f5f34bd981e5914994c71f0819dd5f76e", "message": "fix(plugins): Set the service version to the actual resolved value instead of default it to unknown all the time", "committedDate": "2020-03-14T22:09:24Z", "type": "commit"}, {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1", "url": "https://github.com/spinnaker/kork/commit/bf8e88f2319ac6bd543e12a9d352dbbd0097ece1", "message": "Merge branch 'master' into plugin_version_bug", "committedDate": "2020-03-14T22:16:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5Mjk0Ng==", "url": "https://github.com/spinnaker/kork/pull/552#discussion_r392692946", "bodyText": "lol oops \ud83d\udcaf", "author": "robzienert", "createdAt": "2020-03-15T17:07:13Z", "path": "kork-core/src/main/java/com/netflix/spinnaker/kork/version/ServiceVersion.java", "diffHunk": "@@ -62,7 +62,10 @@ public String resolve() {\n         }\n       }\n \n-      resolvedServiceVersion = UNKNOWN_VERSION;\n+      if (resolvedServiceVersion == null || resolvedServiceVersion.isEmpty()) {\n+        log.warn(\"Unable to determine the service version, setting it to unknown\");\n+        resolvedServiceVersion = UNKNOWN_VERSION;\n+      }", "originalCommit": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MzIwMQ==", "url": "https://github.com/spinnaker/kork/pull/552#discussion_r392693201", "bodyText": "nit: Seeing 0.0.0 across two different files. Worth making a const somewhere instead?", "author": "robzienert", "createdAt": "2020-03-15T17:10:58Z", "path": "kork-plugins/src/main/kotlin/com/netflix/spinnaker/kork/plugins/update/SpinnakerUpdateManager.kt", "diffHunk": "@@ -108,8 +108,15 @@ class SpinnakerUpdateManager(\n     val versionManager = SpinnakerServiceVersionManager(serviceName)\n     val lastPluginRelease: MutableMap<String, PluginRelease> = mutableMapOf()\n \n+    // If service version cannot be determined(i.e 0.0.0),\n+    // just check if the release requirement mentions the service to see if the plugin is applicable. This case should\n+    // never happen, we should always know the system version but if it happens we can at least give a matching plugin\n+    // to the service name in question.\n+    //\n+    // If version is determined, check the version constraint explicitly to decide if the plugin is applicable or not.\n     for (release in pluginInfo.releases) {\n-      if (systemVersion == \"0.0.0\" || versionManager.checkVersionConstraint(systemVersion, release.requires)) {\n+      if ((systemVersion == \"0.0.0\" && release.requires.contains(serviceName, ignoreCase = true)) ||", "originalCommit": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "362903f71a7a4d8cb7046faa0af7c74839ddd5a0", "url": "https://github.com/spinnaker/kork/commit/362903f71a7a4d8cb7046faa0af7c74839ddd5a0", "message": "fix(plugins): Set the default service version as const", "committedDate": "2020-03-17T03:45:43Z", "type": "commit"}, {"oid": "315a36ab9be539a7440505e50c5bfe67ba1eab1b", "url": "https://github.com/spinnaker/kork/commit/315a36ab9be539a7440505e50c5bfe67ba1eab1b", "message": "Merge branch 'master' into plugin_version_bug", "committedDate": "2020-03-17T03:51:25Z", "type": "commit"}]}