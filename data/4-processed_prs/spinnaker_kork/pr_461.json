{"pr_number": 461, "pr_title": "fix(secrets): Do not share yamlparser across threads", "pr_createdAt": "2020-01-08T21:43:53Z", "pr_url": "https://github.com/spinnaker/kork/pull/461", "timeline": [{"oid": "a94402f0efe07b20abec21866f115dad9bf4baa3", "url": "https://github.com/spinnaker/kork/commit/a94402f0efe07b20abec21866f115dad9bf4baa3", "message": "fix(secrets): Do not share yamlparser across threads", "committedDate": "2020-01-08T21:23:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ3NDcyMg==", "url": "https://github.com/spinnaker/kork/pull/461#discussion_r364474722", "bodyText": "Small nit - If all you're doing in getYamlParser() is returning a new Yaml() why not just make this line new Yaml().load(...) and eliminate the extra method?", "author": "ethanfrogers", "createdAt": "2020-01-08T22:27:41Z", "path": "kork-secrets/src/main/java/com/netflix/spinnaker/kork/secrets/engines/AbstractStorageSecretEngine.java", "diffHunk": "@@ -110,7 +114,7 @@ protected abstract InputStream downloadRemoteFile(EncryptedSecret encryptedSecre\n   }\n \n   protected void parseAsYaml(String fileURI, InputStream inputStream) {\n-    Map<String, Object> parsed = yamlParser.load(inputStream);\n+    Map<String, Object> parsed = getYamlParser().load(inputStream);", "originalCommit": "a94402f0efe07b20abec21866f115dad9bf4baa3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ3Njc3Ng==", "url": "https://github.com/spinnaker/kork/pull/461#discussion_r364476776", "bodyText": "Since the original yamlParser was a protected variable, I wanted to preserve that for possible child classes and created a protected method, but just creating a new Yaml instance in place also works.", "author": "german-muzquiz", "createdAt": "2020-01-08T22:33:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ3NDcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ3NzI3Mw==", "url": "https://github.com/spinnaker/kork/pull/461#discussion_r364477273", "bodyText": "Either way is fine. Just curious!", "author": "ethanfrogers", "createdAt": "2020-01-08T22:34:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ3NDcyMg=="}], "type": "inlineReview"}, {"oid": "0f123bb5e06c56fcf208b41e032dd7fb47f9d7c8", "url": "https://github.com/spinnaker/kork/commit/0f123bb5e06c56fcf208b41e032dd7fb47f9d7c8", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-14T15:51:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3ODEyNg==", "url": "https://github.com/spinnaker/kork/pull/461#discussion_r366478126", "bodyText": "Can you mark it @Deprecated and use new Yaml() below?", "author": "ncknt", "createdAt": "2020-01-14T17:38:59Z", "path": "kork-secrets/src/main/java/com/netflix/spinnaker/kork/secrets/engines/AbstractStorageSecretEngine.java", "diffHunk": "@@ -92,6 +90,12 @@ public EncryptedSecret encrypt(String secretToEncrypt) throws UnsupportedOperati\n     throw new UnsupportedOperationException(\"This operation is not supported\");\n   }\n \n+  protected Yaml getYamlParser() {", "originalCommit": "0f123bb5e06c56fcf208b41e032dd7fb47f9d7c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MjM5OQ==", "url": "https://github.com/spinnaker/kork/pull/461#discussion_r366582399", "bodyText": "Was thinking of deprecating this method, not just the field and use new Yaml() below. The method is useless now.", "author": "ncknt", "createdAt": "2020-01-14T21:30:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3ODEyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4NDg2OQ==", "url": "https://github.com/spinnaker/kork/pull/461#discussion_r366584869", "bodyText": "The method is new in this PR, I created it instead of using new Yaml() inline because I saw that the variable was protected, and wanted to keep the ability for subclasses to get an instance of the yaml parser.\nI'll remove it since it just created more confusion.", "author": "german-muzquiz", "createdAt": "2020-01-14T21:36:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3ODEyNg=="}], "type": "inlineReview"}, {"oid": "ff27be95e46364874af0edf618de3096b2ab5da9", "url": "https://github.com/spinnaker/kork/commit/ff27be95e46364874af0edf618de3096b2ab5da9", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-14T17:42:13Z", "type": "commit"}, {"oid": "f40acbca8df18d5ea110a50d63935237a5d96ae0", "url": "https://github.com/spinnaker/kork/commit/f40acbca8df18d5ea110a50d63935237a5d96ae0", "message": "fix(secrets): yamlParser variable marked deprecated in favor of method.", "committedDate": "2020-01-14T17:46:04Z", "type": "commit"}, {"oid": "8b7d43a06009e132ddfc248d38472445202ed44f", "url": "https://github.com/spinnaker/kork/commit/8b7d43a06009e132ddfc248d38472445202ed44f", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-14T18:47:08Z", "type": "commit"}, {"oid": "b8ade0666d1cc370c83b618ffbbac57f0027b91f", "url": "https://github.com/spinnaker/kork/commit/b8ade0666d1cc370c83b618ffbbac57f0027b91f", "message": "fix(secrets): Removed method to get yaml parser and instantiate it inline instead", "committedDate": "2020-01-14T21:38:32Z", "type": "commit"}, {"oid": "3f5edd24d513a4263bbf6c01105fc03814ec746c", "url": "https://github.com/spinnaker/kork/commit/3f5edd24d513a4263bbf6c01105fc03814ec746c", "message": "Merge branch 'fix/secrets-multithreading' of github.com:armory-io/kork into fix/secrets-multithreading", "committedDate": "2020-01-14T21:38:50Z", "type": "commit"}, {"oid": "0ab3f8f8cbb5074df7c5c155a425f6ca7f4a33bd", "url": "https://github.com/spinnaker/kork/commit/0ab3f8f8cbb5074df7c5c155a425f6ca7f4a33bd", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-17T15:47:45Z", "type": "commit"}, {"oid": "f55326bbd70880c49ce0c3807000043bb32ddd38", "url": "https://github.com/spinnaker/kork/commit/f55326bbd70880c49ce0c3807000043bb32ddd38", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-20T16:17:14Z", "type": "commit"}, {"oid": "0cab0f42ce6d6ca1cdc01f4b3d6b10ea8b711d56", "url": "https://github.com/spinnaker/kork/commit/0cab0f42ce6d6ca1cdc01f4b3d6b10ea8b711d56", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-20T21:09:19Z", "type": "commit"}, {"oid": "6e5f19a8850018d194c3ca21b4de3d937c33f26e", "url": "https://github.com/spinnaker/kork/commit/6e5f19a8850018d194c3ca21b4de3d937c33f26e", "message": "Merge branch 'master' into fix/secrets-multithreading", "committedDate": "2020-01-21T14:00:44Z", "type": "commit"}]}