{"pr_number": 490, "pr_title": "feat(auth): expand AuthenticatedRequest API", "pr_createdAt": "2020-01-27T22:17:53Z", "pr_url": "https://github.com/spinnaker/kork/pull/490", "timeline": [{"oid": "04e184dde5effb5a5ead5e9d8f29a87dbf161157", "url": "https://github.com/spinnaker/kork/commit/04e184dde5effb5a5ead5e9d8f29a87dbf161157", "message": "feat(auth): expand AuthenticatedRequest API\n\nQuality of life change that adds nice getters and setters in AuthenticatedRequest. With this change, the MDC updates and lookups are encapsulated in AuthenticatedRequest and don't leak out in AuthenticatedRequestFilter or any other caller.\n\nAlso factor out AuthenticatedRequest::clear() to reduce some duplication.", "committedDate": "2020-01-27T22:10:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUyMDcxOA==", "url": "https://github.com/spinnaker/kork/pull/490#discussion_r371520718", "bodyText": "will .toString() result in same as .getHeader()", "author": "marchello2000", "createdAt": "2020-01-27T22:33:46Z", "path": "kork-security/src/main/java/com/netflix/spinnaker/security/AuthenticatedRequest.java", "diffHunk": "@@ -217,23 +196,74 @@ private static void setOrRemoveMdc(String key, String value) {\n    */\n   public static Optional<String> getSpinnakerRequestId() {\n     return Optional.of(\n-        Optional.ofNullable(MDC.get(Header.REQUEST_ID.getHeader()))\n+        get(Header.REQUEST_ID)\n             .orElse(\n                 getSpinnakerExecutionId()\n                     .map(id -> format(\"%s:%s\", id, UUID.randomUUID().toString()))\n                     .orElse(UUID.randomUUID().toString())));\n   }\n \n   public static Optional<String> getSpinnakerUserOrigin() {\n-    return Optional.ofNullable(MDC.get(Header.USER_ORIGIN.getHeader()));\n+    return get(Header.USER_ORIGIN);\n   }\n \n   public static Optional<String> getSpinnakerExecutionId() {\n-    return Optional.ofNullable(MDC.get(Header.EXECUTION_ID.getHeader()));\n+    return get(Header.EXECUTION_ID);\n   }\n \n   public static Optional<String> getSpinnakerApplication() {\n-    return Optional.ofNullable(MDC.get(Header.APPLICATION.getHeader()));\n+    return get(Header.APPLICATION);\n+  }\n+\n+  public static Optional<String> get(Header header) {\n+    return Optional.ofNullable(MDC.get(header.getHeader()));\n+  }\n+\n+  public static void setAccounts(String accounts) {\n+    set(Header.ACCOUNTS, accounts);\n+  }\n+\n+  public static void setUser(String user) {\n+    set(Header.USER, user);\n+  }\n+\n+  public static void setUserOrigin(String value) {\n+    set(Header.USER_ORIGIN, value);\n+  }\n+\n+  public static void setRequestId(String value) {\n+    set(Header.REQUEST_ID, value);\n+  }\n+\n+  public static void setExecutionId(String value) {\n+    set(Header.EXECUTION_ID, value);\n+  }\n+\n+  public static void setApplication(String value) {\n+    set(Header.APPLICATION, value);\n+  }\n+\n+  public static void set(Header header, String value) {\n+    set(header.toString(), value);", "originalCommit": "04e184dde5effb5a5ead5e9d8f29a87dbf161157", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUyNDQyNQ==", "url": "https://github.com/spinnaker/kork/pull/490#discussion_r371524425", "bodyText": "nope, good catch", "author": "dreynaud", "createdAt": "2020-01-27T22:43:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUyMDcxOA=="}], "type": "inlineReview"}, {"oid": "1bd9be9395593416668cbb877a7ac6071d6b385d", "url": "https://github.com/spinnaker/kork/commit/1bd9be9395593416668cbb877a7ac6071d6b385d", "message": "fix(auth): Header::getHeader is not Header::toString", "committedDate": "2020-01-27T22:44:23Z", "type": "commit"}]}