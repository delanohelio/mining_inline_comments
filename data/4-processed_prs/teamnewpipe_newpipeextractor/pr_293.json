{"pr_number": 293, "pr_title": "[SoundCloud] Fix by migrating to `api-v2` and other improvements", "pr_createdAt": "2020-03-17T15:03:05Z", "pr_url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293", "timeline": [{"oid": "f3095713f9cc158a092eb24d3338c0c8fafd4a8d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f3095713f9cc158a092eb24d3338c0c8fafd4a8d", "message": "[SoundCloud] Use api-v2 in PlaylistExtractor\n\nRewrote methods to calculate next page url and to get items from it. `api-v2` is different from `api` since the initial playlist page contains (usually) the full info of the first 3 streams and only the id of the other. Then the single tracks can be requested in batch using `/tracks?ids=id1,id2,...`.", "committedDate": "2020-03-17T14:12:13Z", "type": "commit"}, {"oid": "d0e66cc600ad43a48e17c65e29e897f4b549a3d0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d0e66cc600ad43a48e17c65e29e897f4b549a3d0", "message": "[SoundCloud] Improve thumbnail url extraction in playlists\n\nPrevent NullPointerExceptions and remove duplicate code", "committedDate": "2020-03-17T14:13:28Z", "type": "commit"}, {"oid": "c3d811fde5ced6518381173b0d4c0e73a13d0b08", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c3d811fde5ced6518381173b0d4c0e73a13d0b08", "message": "[SoundCloud] Use api-v2 in SubscriptionExtractor\n\nAlso added", "committedDate": "2020-03-17T14:22:25Z", "type": "commit"}, {"oid": "4b1121aac7d48e84f97048028aa6005f2acc1d5f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4b1121aac7d48e84f97048028aa6005f2acc1d5f", "message": "[SoundCloud] Add tests for api-v2 channel urls", "committedDate": "2020-03-17T14:23:13Z", "type": "commit"}, {"oid": "d4aa4a076375af22256fb622547bab71a3eb4a3e", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d4aa4a076375af22256fb622547bab71a3eb4a3e", "message": "[SoundCloud] Fix typo in ChartsExtractor", "committedDate": "2020-03-17T14:25:11Z", "type": "commit"}, {"oid": "ca8bf53b61131a8849789e76156f490d12a15751", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/ca8bf53b61131a8849789e76156f490d12a15751", "message": "[SoundCloud] Fix playlist test: number of streams changed", "committedDate": "2020-03-17T14:35:33Z", "type": "commit"}, {"oid": "1558da6f6b2aa4613c6af45f302104b1464d28a0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/1558da6f6b2aa4613c6af45f302104b1464d28a0", "message": "[SoundCloud] Fix playlist next page generation", "committedDate": "2020-03-17T14:46:35Z", "type": "commit"}, {"oid": "65bdb3bc9dd45c8d8fd198064497e9473be6e16f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/65bdb3bc9dd45c8d8fd198064497e9473be6e16f", "message": "[SoundCloud] Unignore ignored playlist tests", "committedDate": "2020-03-17T14:49:58Z", "type": "commit"}, {"oid": "0e1b4bbf17d460b081b409c35d276d4ba0eed15f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0e1b4bbf17d460b081b409c35d276d4ba0eed15f", "message": "[SoundCloud] Test playlists banner: it should not exist", "committedDate": "2020-03-17T14:53:25Z", "type": "commit"}, {"oid": "5e4ddb368fe25b809e28428119b032f93b4ce28d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5e4ddb368fe25b809e28428119b032f93b4ce28d", "message": "[SoundCloud] Fix extractors built from next playlist pages\n\nThey didn't have the information to calculate another next page url. So now `nextPageUrl` contains a full link with all video ids, and `getPage` takes the first part of the url (containing 15 streams) and produces another `nextPageUrl` with the remaining streams.\nAlso add a test for this.", "committedDate": "2020-03-17T17:04:40Z", "type": "commit"}, {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4389fd3b7b37608be495a17f93e63cf1b6feba8b", "message": "[SoundCloud] Migrate StreamExtractor to api-v2", "committedDate": "2020-03-17T17:06:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMDY0Mg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393910642", "bodyText": "What are you even doing here? getNextPageUrl should always return the same URL, as it's the next page relative to the initial page, see https://github.com/TeamNewPipe/NewPipeExtractor/blob/dev/extractor/src/main/java/org/schabi/newpipe/extractor/ListExtractor.java#L36.", "author": "wb9688", "createdAt": "2020-03-17T19:12:52Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudPlaylistExtractorTest.java", "diffHunk": "@@ -229,6 +234,15 @@ public static void setUp() throws Exception {\n         public void testGetPageInNewExtractor() throws Exception {\n             final PlaylistExtractor newExtractor = SoundCloud.getPlaylistExtractor(extractor.getUrl());\n             defaultTestGetPageInNewExtractor(extractor, newExtractor);\n+            String page1 = newExtractor.getNextPageUrl();\n+            defaultTestMoreItems(newExtractor); // there has to be another page\n+            String page2 = newExtractor.getNextPageUrl();\n+            defaultTestMoreItems(newExtractor); // and another one\n+            String page3 = newExtractor.getNextPageUrl();\n+\n+            assertNotEquals(\"Same pages\", page1, page2);\n+            assertNotEquals(\"Same pages\", page2, page3);\n+            assertNotEquals(\"Same pages\", page3, page1);", "originalCommit": "4389fd3b7b37608be495a17f93e63cf1b6feba8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNTg5NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393915895", "bodyText": "So why did the old extractor do the same thing as I do? Every time getPage was called it overwrote nextPageUrl with the url of the page coming after the one provided as the argument of getPage, thus having the same behaviour as now.", "author": "Stypox", "createdAt": "2020-03-17T19:23:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMDY0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxODczNw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393918737", "bodyText": "I don't know, that would be a bug. YouTube doesn't do it: https://github.com/TeamNewPipe/NewPipeExtractor/blob/dev/extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubePlaylistExtractor.java#L81, and YouTube is the 'golden' service implementation.", "author": "wb9688", "createdAt": "2020-03-17T19:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMDY0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyMzc5MA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393923790", "bodyText": "Ok, will change this ;-)", "author": "Stypox", "createdAt": "2020-03-17T19:38:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMDY0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMTYyMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393911620", "bodyText": "Why did you remove the code for better resolution? Does api-v2 return that by default?", "author": "wb9688", "createdAt": "2020-03-17T19:14:48Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudPlaylistExtractor.java", "diffHunk": "@@ -64,21 +74,20 @@ public String getThumbnailUrl() {\n             // if it also fails, return null\n             try {\n                 final InfoItemsPage<StreamInfoItem> infoItems = getInitialPage();\n-                if (infoItems.getItems().isEmpty()) return null;\n \n                 for (StreamInfoItem item : infoItems.getItems()) {\n-                    final String thumbnailUrl = item.getThumbnailUrl();\n-                    if (thumbnailUrl == null || thumbnailUrl.isEmpty()) continue;\n-\n-                    String thumbnailUrlBetterResolution = thumbnailUrl.replace(\"large.jpg\", \"crop.jpg\");", "originalCommit": "4389fd3b7b37608be495a17f93e63cf1b6feba8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNDA4MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393914081", "bodyText": "I didn't remove it, I just moved it below", "author": "Stypox", "createdAt": "2020-03-17T19:19:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMTYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNTc5NA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393915794", "bodyText": "Sorry for not noticing this, didn't I tell you I was tired?", "author": "wb9688", "createdAt": "2020-03-17T19:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMTYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMjI3Nw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393912277", "bodyText": "Why did you change this? This test was to check that this playlist indeed doesn't have a next page of items.", "author": "wb9688", "createdAt": "2020-03-17T19:16:03Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudPlaylistExtractorTest.java", "diffHunk": "@@ -70,7 +73,9 @@ public void testRelatedItems() throws Exception {\n         }\n \n         @Test\n-        public void testMoreRelatedItems() {\n+        public void testMoreRelatedItems() throws Exception {\n+            defaultTestMoreItems(extractor);", "originalCommit": "4389fd3b7b37608be495a17f93e63cf1b6feba8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNDQwNw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393914407", "bodyText": "Now the first page of items does not contain the 10 items, but only 3 of them", "author": "Stypox", "createdAt": "2020-03-17T19:20:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMjI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNjIxNQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393916215", "bodyText": "Then the lines below should be deleted, however it would be better to change it to a playlist with less than 3 streams.", "author": "wb9688", "createdAt": "2020-03-17T19:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMjI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyMzkxMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393923910", "bodyText": "Ok, will do", "author": "Stypox", "createdAt": "2020-03-17T19:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMjI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMzI5NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393913295", "bodyText": "Why is this change needed? Also, I don't think those additional imports are needed here.", "author": "wb9688", "createdAt": "2020-03-17T19:18:04Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudStreamExtractor.java", "diffHunk": "@@ -55,14 +57,14 @@ public String getName() {\n \n     @Nonnull\n     @Override\n-    public String getTextualUploadDate() {\n-        return track.getString(\"created_at\");\n+    public String getTextualUploadDate() throws ParsingException {\n+        return track.getString(\"created_at\").replace(\"T\",\" \").replace(\"Z\", \"\");", "originalCommit": "4389fd3b7b37608be495a17f93e63cf1b6feba8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNzY5MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393917691", "bodyText": "For some reason SoundCloud api-v2 returns upload date in format \"2016-07-31 18:18:07\" instead of \"2016/07/31T18:18:07Z+0000\", so even though getTextualUploadDate should return the scraped date as a fallback, I converted it to a human readable one since it takes no effort and works reliably.", "author": "Stypox", "createdAt": "2020-03-17T19:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMzI5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNzg0NA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393917844", "bodyText": "Will remove the imports though", "author": "Stypox", "createdAt": "2020-03-17T19:26:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMzI5NQ=="}], "type": "inlineReview"}, {"oid": "ae47c9587c186013bb278d9aaafd0a9a1d8c0946", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/ae47c9587c186013bb278d9aaafd0a9a1d8c0946", "message": "[SoundCloud] Optimize imports in edited files", "committedDate": "2020-03-17T19:32:04Z", "type": "commit"}, {"oid": "c505d4e2b77b12e4d2d259121d66937ded756de1", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c505d4e2b77b12e4d2d259121d66937ded756de1", "message": "[SoundCloud] Remove trailing , in playlist page urls", "committedDate": "2020-03-17T19:36:59Z", "type": "commit"}, {"oid": "45bb646480b13c59d5c6f9aef53b257c51fbf0d5", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/45bb646480b13c59d5c6f9aef53b257c51fbf0d5", "message": "[SoundCloud] Do not overwrite nextPageUrl in PlaylistExtractor\n\nConsistent with YouTube and the documentation", "committedDate": "2020-03-17T19:56:47Z", "type": "commit"}, {"oid": "265cfb61f37c6a626b56f552e5619c95b6a3a34c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/265cfb61f37c6a626b56f552e5619c95b6a3a34c", "message": "[SoundCloud] Add test for small playlist, use defaultTestGetPageInNewExtractor", "committedDate": "2020-03-17T20:03:50Z", "type": "commit"}, {"oid": "222d659d9e6ebebed5ea9a690518b1a7c1ac0c2d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/222d659d9e6ebebed5ea9a690518b1a7c1ac0c2d", "message": "[SoundCloud] Don't make separate request for getAudioStreams() in StreamExtractor\n\nSigned-off-by: Stypox <stypox@pm.me>", "committedDate": "2020-03-18T10:30:15Z", "type": "commit"}]}