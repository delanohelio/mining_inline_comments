{"pr_number": 262, "pr_title": "Improve yt_new", "pr_createdAt": "2020-02-26T08:40:04Z", "pr_url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262", "timeline": [{"oid": "0973263aab14b75ab56216ea795b31c6f562f15d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0973263aab14b75ab56216ea795b31c6f562f15d", "message": "Use pbj in YoutubeSearchExtractor", "committedDate": "2020-02-26T14:27:46Z", "type": "commit"}, {"oid": "89a41a7f69b63c09e4cc8b7f381e07380718c297", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/89a41a7f69b63c09e4cc8b7f381e07380718c297", "message": "Use pbj in YoutubeChannelExtractor", "committedDate": "2020-02-26T14:27:50Z", "type": "commit"}, {"oid": "15afbea3e19f83b33cabdca71fbdce669179b2ef", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/15afbea3e19f83b33cabdca71fbdce669179b2ef", "message": "Use pbj in YoutubePlaylistExtractor", "committedDate": "2020-02-26T14:27:50Z", "type": "commit"}, {"oid": "985c3ec877fa8e62073bb1fc81135e08ac33fda2", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/985c3ec877fa8e62073bb1fc81135e08ac33fda2", "message": "Improve getClientVersion()", "committedDate": "2020-02-26T14:27:50Z", "type": "commit"}, {"oid": "1c3a4e710ba820f43208a75045c03d61e914359a", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/1c3a4e710ba820f43208a75045c03d61e914359a", "message": "Check if there are no related streams in getAgeLimit()", "committedDate": "2020-02-26T15:03:06Z", "type": "commit"}, {"oid": "bb3a3d70bf14cff501fbe514ce05f10cc6f4a148", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/bb3a3d70bf14cff501fbe514ce05f10cc6f4a148", "message": "Use pbj in YoutubeTrendingExtractor", "committedDate": "2020-02-26T15:10:24Z", "type": "commit"}, {"oid": "88282761f44921e0533afdf93a4d83de0c0a4c20", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/88282761f44921e0533afdf93a4d83de0c0a4c20", "message": "Fix YoutubeStreamExtractor not being able to getAgeLimit() in onFetchPage()", "committedDate": "2020-02-26T15:19:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4NTY0MA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r384585640", "bodyText": "Did you mean two instead of do?", "author": "B0pol", "createdAt": "2020-02-26T15:54:07Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/linkHandler/YoutubeParsingHelper.java", "diffHunk": "@@ -162,55 +171,83 @@ public static JsonObject getInitialData(String html) throws ParsingException {\n \n     /**\n      * Get the client version from a page\n-     * @param initialData\n-     * @param html The page HTML\n      * @return\n      * @throws ParsingException\n      */\n-    public static String getClientVersion(JsonObject initialData, String html) throws ParsingException {\n-        if (initialData == null) initialData = getInitialData(html);\n-        JsonArray serviceTrackingParams = initialData.getObject(\"responseContext\").getArray(\"serviceTrackingParams\");\n-        String shortClientVersion = null;\n-\n-        // try to get version from initial data first\n-        for (Object service : serviceTrackingParams) {\n-            JsonObject s = (JsonObject) service;\n-            if (s.getString(\"service\").equals(\"CSI\")) {\n-                JsonArray params = s.getArray(\"params\");\n-                for (Object param: params) {\n-                    JsonObject p = (JsonObject) param;\n-                    String key = p.getString(\"key\");\n-                    if (key != null && key.equals(\"cver\")) {\n-                        return p.getString(\"value\");\n+    public static String getClientVersion() throws ParsingException {\n+        if (clientVersion != null && !clientVersion.isEmpty()) return clientVersion;\n+\n+        // Test if hard-coded client version is valid\n+        try {\n+            final String url = \"https://www.youtube.com/results?search_query=test&pbj=1\";\n+\n+            Map<String, List<String>> headers = new HashMap<>();\n+            headers.put(\"X-YouTube-Client-Name\", Collections.singletonList(\"1\"));\n+            headers.put(\"X-YouTube-Client-Version\",\n+                    Collections.singletonList(HARDCODED_CLIENT_VERSION));\n+            final String response = getDownloader().get(url, headers).responseBody();\n+            if (response.length() > 50) { // ensure to have a valid response\n+                clientVersion = HARDCODED_CLIENT_VERSION;\n+                return clientVersion;\n+            }\n+        } catch (Exception ignored) {}\n+\n+        // Try extracting it from YouTube's website otherwise\n+        try {\n+            final String url = \"https://www.youtube.com/results?search_query=test\";\n+            final String html = getDownloader().get(url).responseBody();\n+            JsonObject initialData = getInitialData(html);\n+            JsonArray serviceTrackingParams = initialData.getObject(\"responseContext\").getArray(\"serviceTrackingParams\");\n+            String shortClientVersion = null;\n+\n+            // try to get version from initial data first\n+            for (Object service : serviceTrackingParams) {\n+                JsonObject s = (JsonObject) service;\n+                if (s.getString(\"service\").equals(\"CSI\")) {\n+                    JsonArray params = s.getArray(\"params\");\n+                    for (Object param : params) {\n+                        JsonObject p = (JsonObject) param;\n+                        String key = p.getString(\"key\");\n+                        if (key != null && key.equals(\"cver\")) {\n+                            clientVersion = p.getString(\"value\");\n+                            return clientVersion;\n+                        }\n                     }\n-                }\n-            } else if (s.getString(\"service\").equals(\"ECATCHER\")) {\n-                // fallback to get a shortened client version which does not contain the last do digits\n-                JsonArray params = s.getArray(\"params\");\n-                for (Object param: params) {\n-                    JsonObject p = (JsonObject) param;\n-                    String key = p.getString(\"key\");\n-                    if (key != null && key.equals(\"client.version\")) {\n-                        shortClientVersion = p.getString(\"value\");\n+                } else if (s.getString(\"service\").equals(\"ECATCHER\")) {\n+                    // fallback to get a shortened client version which does not contain the last do digits", "originalCommit": "88282761f44921e0533afdf93a4d83de0c0a4c20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU5Mjk5MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r384592991", "bodyText": "Blame @TobiGr ;)", "author": "wb9688", "createdAt": "2020-02-26T16:04:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4NTY0MA=="}], "type": "inlineReview"}, {"oid": "8dc39d517ae3e8080f902ceb28fe173cf0d75ff7", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8dc39d517ae3e8080f902ceb28fe173cf0d75ff7", "message": "Fix tests\n\nExcept testGetFullLinksInDescription() in DescriptionTestUnboxing, since that requires other changes first.", "committedDate": "2020-02-26T16:31:01Z", "type": "commit"}, {"oid": "8d503407ef32fe1cac5359f042e909ba4878a807", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8d503407ef32fe1cac5359f042e909ba4878a807", "message": "Parse browseEndpoint and watchEndpoint in descriptions", "committedDate": "2020-02-26T18:37:58Z", "type": "commit"}, {"oid": "a2d8489e169ce43d9d3646c9ccb21d56e7f79b2b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/a2d8489e169ce43d9d3646c9ccb21d56e7f79b2b", "message": "Parse timestamps in description", "committedDate": "2020-02-26T19:27:30Z", "type": "commit"}, {"oid": "db305408e906614fbdff44d963fc94aed1363c9c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/db305408e906614fbdff44d963fc94aed1363c9c", "message": "Get all expandedShelfContentsRenderers in YoutubeTrendingExtractor", "committedDate": "2020-02-26T19:37:20Z", "type": "commit"}, {"oid": "cdbc751b874a5f096a885a4f09b45efe6bfb403a", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/cdbc751b874a5f096a885a4f09b45efe6bfb403a", "message": "Fix getUploaderUrl() in YoutubeStreamInfoItemExtractor", "committedDate": "2020-02-27T08:05:41Z", "type": "commit"}, {"oid": "2399d46ab039c8e07b27885e3240cb8087e0ef57", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/2399d46ab039c8e07b27885e3240cb8087e0ef57", "message": "Fix YoutubeChannelExtractor for channels without videos", "committedDate": "2020-02-27T08:21:25Z", "type": "commit"}, {"oid": "951ed9f0d85b5a526b40d5883c676fb8069ea312", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/951ed9f0d85b5a526b40d5883c676fb8069ea312", "message": "Don't call getUploaderInfo() in onFetchPage() for playlists\n\nThis way YouTube Music playlists will keep working in NewPipe", "committedDate": "2020-02-27T08:27:56Z", "type": "commit"}, {"oid": "8aa560bef4c23f5c0cb8c543a50a30226784c8ef", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8aa560bef4c23f5c0cb8c543a50a30226784c8ef", "message": "Fix video titles consisting of multiple parts due to @", "committedDate": "2020-02-27T08:42:22Z", "type": "commit"}, {"oid": "880b9510880c9809dbd23e232bdbdb31d827d75c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/880b9510880c9809dbd23e232bdbdb31d827d75c", "message": "Fix getUploaderAvatarUrl() in YoutubeStreamExtractor", "committedDate": "2020-02-27T08:53:59Z", "type": "commit"}, {"oid": "8ebd971648729e397f63c4c24ca7ccc523d4ec94", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8ebd971648729e397f63c4c24ca7ccc523d4ec94", "message": "Fix channel descriptions consisting of multiple parts", "committedDate": "2020-02-27T09:06:35Z", "type": "commit"}, {"oid": "0798bdd5cd03bb44c0593a28b9c23df472e762ef", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0798bdd5cd03bb44c0593a28b9c23df472e762ef", "message": "Fix getSubscriberCount() for 0 subscribers", "committedDate": "2020-02-27T15:26:22Z", "type": "commit"}, {"oid": "365b0329f3dfb0dba257d1399624b5e9a4a56822", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/365b0329f3dfb0dba257d1399624b5e9a4a56822", "message": "Implement getTextFromObject() function", "committedDate": "2020-02-27T16:39:23Z", "type": "commit"}, {"oid": "838d834ce217037a6c3212458356053b289cc316", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/838d834ce217037a6c3212458356053b289cc316", "message": "Get Uploads view of Videos tab", "committedDate": "2020-02-27T17:54:27Z", "type": "commit"}, {"oid": "94a2d5be463704dc551b1dca330110c36846ea7c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/94a2d5be463704dc551b1dca330110c36846ea7c", "message": "Fix thumbnail URLs starting with //", "committedDate": "2020-02-27T18:08:46Z", "type": "commit"}, {"oid": "f946310af590f5ef9d428cadd59113380d971d03", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f946310af590f5ef9d428cadd59113380d971d03", "message": "Fix search queries with a promotedSparklesTextSearchRenderer returning 0 results", "committedDate": "2020-02-28T07:57:44Z", "type": "commit"}, {"oid": "612ec06839bfef5db6616f99aba81e243bc6cd14", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/612ec06839bfef5db6616f99aba81e243bc6cd14", "message": "Actually fix thumbnail URLs starting with //", "committedDate": "2020-02-28T08:36:33Z", "type": "commit"}, {"oid": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "message": "Use pbj in YoutubeStreamExtractor", "committedDate": "2020-02-28T14:17:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0ODI3MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385748271", "bodyText": "Please do this in a separate method and add a test to check if the hard-coded client version is valid.", "author": "TobiGr", "createdAt": "2020-02-28T15:10:50Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/linkHandler/YoutubeParsingHelper.java", "diffHunk": "@@ -162,56 +177,163 @@ public static JsonObject getInitialData(String html) throws ParsingException {\n \n     /**\n      * Get the client version from a page\n-     * @param initialData\n-     * @param html The page HTML\n      * @return\n      * @throws ParsingException\n      */\n-    public static String getClientVersion(JsonObject initialData, String html) throws ParsingException {\n-        if (initialData == null) initialData = getInitialData(html);\n-        JsonArray serviceTrackingParams = initialData.getObject(\"responseContext\").getArray(\"serviceTrackingParams\");\n-        String shortClientVersion = null;\n-\n-        // try to get version from initial data first\n-        for (Object service : serviceTrackingParams) {\n-            JsonObject s = (JsonObject) service;\n-            if (s.getString(\"service\").equals(\"CSI\")) {\n-                JsonArray params = s.getArray(\"params\");\n-                for (Object param: params) {\n-                    JsonObject p = (JsonObject) param;\n-                    String key = p.getString(\"key\");\n-                    if (key != null && key.equals(\"cver\")) {\n-                        return p.getString(\"value\");\n+    public static String getClientVersion() throws ParsingException {\n+        if (clientVersion != null && !clientVersion.isEmpty()) return clientVersion;\n+\n+        // Test if hard-coded client version is valid\n+        try {\n+            final String url = \"https://www.youtube.com/results?search_query=test&pbj=1\";\n+\n+            Map<String, List<String>> headers = new HashMap<>();\n+            headers.put(\"X-YouTube-Client-Name\", Collections.singletonList(\"1\"));\n+            headers.put(\"X-YouTube-Client-Version\",\n+                    Collections.singletonList(HARDCODED_CLIENT_VERSION));\n+            final String response = getDownloader().get(url, headers).responseBody();\n+            if (response.length() > 50) { // ensure to have a valid response\n+                clientVersion = HARDCODED_CLIENT_VERSION;\n+                return clientVersion;\n+            }\n+        } catch (Exception ignored) {}", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTU4MA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385749580", "bodyText": "We might want to append response to the exception message. This could help us with debugging error reports later.\nApart from that, we could also add a\npublic static boolean isJsonResponseValid(String response) to YouTubeParsingHelper.", "author": "TobiGr", "createdAt": "2020-02-28T15:13:07Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeChannelExtractor.java", "diffHunk": "@@ -64,16 +60,35 @@ public YoutubeChannelExtractor(StreamingService service, ListLinkHandler linkHan\n \n     @Override\n     public void onFetchPage(@Nonnull Downloader downloader) throws IOException, ExtractionException {\n-        String channelUrl = super.getUrl() + CHANNEL_URL_PARAMETERS;\n-        final Response response = downloader.get(channelUrl, getExtractorLocalization());\n-        doc = YoutubeParsingHelper.parseAndCheckPage(channelUrl, response);\n-        initialData = YoutubeParsingHelper.getInitialData(response.responseBody());\n+        final String url = super.getUrl() + \"/videos?pbj=1&view=0&flow=grid\";\n+\n+        JsonArray ajaxJson;\n+\n+        Map<String, List<String>> headers = new HashMap<>();\n+        headers.put(\"X-YouTube-Client-Name\", Collections.singletonList(\"1\"));\n+        headers.put(\"X-YouTube-Client-Version\",\n+                Collections.singletonList(YoutubeParsingHelper.getClientVersion()));\n+        final String response = getDownloader().get(url, headers, getExtractorLocalization()).responseBody();\n+        if (response.length() < 50) { // ensure to have a valid response\n+            throw new ParsingException(\"Could not parse json data for next streams\");\n+        }", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1NjczMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385756730", "bodyText": "We might want to append response to the exception message. This could help us with debugging error reports later.\n\nI'll do that. The error message doesn't make sense (probably copied from somewhere), so I'll improve that as well.\n\nApart from that, we could also add a\npublic static boolean isJsonResponseValid(String response) to YouTubeParsingHelper.\n\nIs that really needed for just response.length() < 50?", "author": "wb9688", "createdAt": "2020-02-28T15:25:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0ODQ4Mg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385848482", "bodyText": "It is ok for now, but maybe we can validate a response in the future differently (and more accurate). We can leave it for now.", "author": "TobiGr", "createdAt": "2020-02-28T18:19:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg1MTc5OA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385851798", "bodyText": "YouTube returns {\"reload\":\"now\"} iirc if the client version is incorrect. I think this check isn't needed anymore now that we check whether the client version is valid and stuff in getClientVersion().", "author": "wb9688", "createdAt": "2020-02-28T18:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTczNzY3Ng==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385737676", "bodyText": "Since you are using getVideoTab() many times in many functions, I'd suggest saving it in a variable on initialization, in order to speed up things", "author": "Stypox", "createdAt": "2020-02-28T14:52:27Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeChannelExtractor.java", "diffHunk": "@@ -290,6 +293,14 @@ private JsonObject getVideoTab() throws ParsingException {\n             throw new ParsingException(\"Could not find Videos tab\");\n         }\n \n+        try {\n+            if (getTextFromObject(videoTab.getObject(\"content\").getObject(\"sectionListRenderer\")\n+                    .getArray(\"contents\").getObject(0).getObject(\"itemSectionRenderer\")\n+                    .getArray(\"contents\").getObject(0).getObject(\"messageRenderer\")\n+                    .getObject(\"text\")).equals(\"This channel has no videos.\"))\n+                return null;\n+        } catch (Exception ignored) {}\n+\n         return videoTab;\n     }\n }", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0MTMxMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385741310", "bodyText": "Could you extract these lines into a separate function taking just url as argument and returns initialData, put it in a common YouTube helper file, and use it whenever possible? I see it is being used in many places, and it's better to avoid duplicate code", "author": "Stypox", "createdAt": "2020-02-28T14:58:51Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubePlaylistExtractor.java", "diffHunk": "@@ -41,11 +40,26 @@ public YoutubePlaylistExtractor(StreamingService service, ListLinkHandler linkHa\n \n     @Override\n     public void onFetchPage(@Nonnull Downloader downloader) throws IOException, ExtractionException {\n-        final String url = getUrl();\n-        final Response response = downloader.get(url, getExtractorLocalization());\n-        doc = YoutubeParsingHelper.parseAndCheckPage(url, response);\n-        initialData = YoutubeParsingHelper.getInitialData(response.responseBody());\n-        uploaderInfo = getUploaderInfo();\n+        final String url = getUrl() + \"&pbj=1\";\n+\n+        JsonArray ajaxJson;\n+\n+        Map<String, List<String>> headers = new HashMap<>();\n+        headers.put(\"X-YouTube-Client-Name\", Collections.singletonList(\"1\"));\n+        headers.put(\"X-YouTube-Client-Version\",\n+                Collections.singletonList(YoutubeParsingHelper.getClientVersion()));\n+        final String response = getDownloader().get(url, headers, getExtractorLocalization()).responseBody();\n+        if (response.length() < 50) { // ensure to have a valid response\n+            throw new ParsingException(\"Could not parse json data for next streams\");\n+        }\n+\n+        try {\n+            ajaxJson = JsonParser.array().from(response);\n+        } catch (JsonParserException e) {\n+            throw new ParsingException(\"Could not parse json data for next streams\", e);\n+        }\n+\n+        initialData = ajaxJson.getObject(1).getObject(\"response\");", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3NzM4Nw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385777387", "bodyText": "Yes, that was actually my plan, but I forgot about it. Thanks for reminding me.", "author": "wb9688", "createdAt": "2020-02-28T15:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0MTMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NDYzMw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385744633", "bodyText": "This removes one check when the duration extractor was successful with first try\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            }\n          \n          \n            \n                        } catch (Exception ignored) {}\n          \n          \n            \n                    }\n          \n          \n            \n                    if (duration != null) return YoutubeParsingHelper.parseDurationString(duration);\n          \n          \n            \n                    throw new ParsingException(\"Could not get duration\");\n          \n          \n            \n                            }\n          \n          \n            \n                        } catch (Exception ignored) {}\n          \n          \n            \n                        \n          \n          \n            \n                        if (duration == null) {\n          \n          \n            \n                            throw new ParsingException(\"Could not get duration\");\n          \n          \n            \n                        }\n          \n          \n            \n                    }\n          \n          \n            \n                    return YoutubeParsingHelper.parseDurationString(duration);", "author": "Stypox", "createdAt": "2020-02-28T15:04:20Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -76,46 +79,46 @@ public String getUrl() throws ParsingException {\n \n     @Override\n     public String getName() throws ParsingException {\n-        String name = null;\n-        try {\n-            name = videoInfo.getObject(\"title\").getString(\"simpleText\");\n-        } catch (Exception ignored) {}\n-        if (name == null) {\n-            try {\n-                name = videoInfo.getObject(\"title\").getArray(\"runs\").getObject(0).getString(\"text\");\n-            } catch (Exception ignored) {}\n-        }\n+        String name = getTextFromObject(videoInfo.getObject(\"title\"));\n         if (name != null && !name.isEmpty()) return name;\n         throw new ParsingException(\"Could not get name\");\n     }\n \n     @Override\n     public long getDuration() throws ParsingException {\n+        if (getStreamType() == StreamType.LIVE_STREAM) return -1;\n+        String duration = null;\n         try {\n-            if (getStreamType() == StreamType.LIVE_STREAM) return -1;\n-            return YoutubeParsingHelper.parseDurationString(videoInfo.getObject(\"lengthText\").getString(\"simpleText\"));\n-        } catch (Exception e) {\n-            throw new ParsingException(\"Could not get duration\", e);\n+            duration = getTextFromObject(videoInfo.getObject(\"lengthText\"));\n+        } catch (Exception ignored) {}\n+        if (duration == null) {\n+            try {\n+                for (Object thumbnailOverlay : videoInfo.getArray(\"thumbnailOverlays\")) {\n+                    if (((JsonObject) thumbnailOverlay).getObject(\"thumbnailOverlayTimeStatusRenderer\") != null) {\n+                        duration = getTextFromObject(((JsonObject) thumbnailOverlay)\n+                                .getObject(\"thumbnailOverlayTimeStatusRenderer\").getObject(\"text\"));\n+                    }\n+                }\n+            } catch (Exception ignored) {}\n         }\n+        if (duration != null) return YoutubeParsingHelper.parseDurationString(duration);\n+        throw new ParsingException(\"Could not get duration\");", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3NzkwNQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385777905", "bodyText": "True, this probably happens at a lot of other places as well, but makes almost no difference.", "author": "wb9688", "createdAt": "2020-02-28T16:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NDYzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NzMwNA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385747304", "bodyText": "In order to remove some checks and make more clear that there are many methods to extract the url which are tried one after the other, I'd suggest doing something like this:\n// try method one\n\nif (url == null) {\n    // try method two\n\n    if (url == null) {\n        // try method three\n\n        if (url == null || url.isEmpty()) {\n            // throw exception\n        }\n    }\n}", "author": "Stypox", "createdAt": "2020-02-28T15:09:12Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -125,30 +128,27 @@ public String getUploaderName() throws ParsingException {\n     @Override\n     public String getUploaderUrl() throws ParsingException {", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3NTIzMg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385775232", "bodyText": "As in the following?\ntry {\n    // Do whatever\n} catch (Exception ignored) {}\n\nif (url == null) {\n    try {\n        // Do whatever\n    } catch (Exception ignored) {}\n\n    if (url == null) {\n        try {\n            // Do whatever\n        } catch (Exception ignored) {}\n\n        if (url == null || url.isEmpty()) {\n           throw new ParsingException(\"whatever\");\n        }\n    }\n}\nOr what do you mean? I'm not sure if I think that's cleaner. @TobiGr: What do you think?", "author": "wb9688", "createdAt": "2020-02-28T15:55:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NzMwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg2NjI2Mw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385866263", "bodyText": "Well, the code above has less url == null checks when the first extraction method returns a valid result and is therefore \"faster\". On the other hand when the url is empty, we might not throw an Exception, but return an empty string. So we'd need something like this.\ntry {\n    // Do whatever\n} catch (Exception ignored) {}\n\nif (url == null) {\n    try {\n        // Do whatever\n    } catch (Exception ignored) {}\n\n    if (url == null) {\n        try {\n            // Do whatever\n        } catch (Exception ignored) {}\n    }\n}\nif (url == null || url.isEmpty()) {\n    throw new ParsingException(\"whatever\");\n}\nreturn url;\nHowever, I do not understand, why we only check once whether the url is empty. We should do this either every time or not at all. I suggest to remove this isEmpty check, because the JSON fields won't be empty. They either exist and contain a valid value or do not exist. That's why I'd use the following, which might be more efficient when having a valid result at the beginning.\ntry {\n    // Do whatever\n} catch (Exception ignored) {}\n\nif (url == null) {\n    try {\n        // Do whatever\n    } catch (Exception ignored) {}\n\n    if (url == null) {\n        try {\n            // Do whatever\n        } catch (Exception ignored) {}\n\n        if (url == null) {\n            throw new ParsingException(\"whatever\");\n        }\n    }\n}\n\nreturn url;\nHowever, these kind of changes won't speed up anything in a way a user can recognize that. If you want, you can change it, but maybe we should ask @Stypox first, if we understood correctly what he meant.", "author": "TobiGr", "createdAt": "2020-02-28T18:57:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NzMwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk0NDY5Mw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385944693", "bodyText": "In terms of speed up this does not actually do much, but I think the second snippet provided by @TobiGr is more readable, since the indentation makes it clear that if the first method succeeds, the function will return that result immediately. With the current implementation you have to read and process more lines in order to understand that if the first method succeeds nothing else happens (i.e. there is no post processing or other things) @TobiGr @wb9688", "author": "Stypox", "createdAt": "2020-02-28T22:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NzMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTE0MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385749141", "bodyText": "Same as above: since you often use getVideoPrimaryInfoRenderer(), it would be a good idea to save it in a variable", "author": "Stypox", "createdAt": "2020-02-28T15:12:21Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -116,7 +113,7 @@ public String getName() throws ParsingException {\n         assertPageFetched();\n         String title = null;\n         try {\n-            title = getVideoPrimaryInfoRenderer().getObject(\"title\").getArray(\"runs\").getObject(0).getString(\"text\");", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTYxMw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385749613", "bodyText": "Why doesn't assertPageFetched() work anymore?", "author": "Stypox", "createdAt": "2020-02-28T15:13:10Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -261,17 +212,14 @@ public Description getDescription() throws ParsingException {\n     }\n \n     @Override\n-    public int getAgeLimit() throws ParsingException {\n-        assertPageFetched();\n-        if (!isAgeRestricted) {\n+    public int getAgeLimit() {\n+        if (initialData == null || initialData.isEmpty()) throw new IllegalStateException(\"initialData is not parsed yet\");", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc2NDM2Mw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385764363", "bodyText": "Because getAgeLimit is (now indirectly) being called in onFetchPage().", "author": "wb9688", "createdAt": "2020-02-28T15:37:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0OTYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1MDkzNw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385750937", "bodyText": "Same as above to save if checks and improve code readability, I'd move if (uploaderId == null) throw new ParsingException(\"Could not get uploader url\"); at the end of the if just above", "author": "Stypox", "createdAt": "2020-02-28T15:15:32Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -381,17 +322,15 @@ public long getDislikeCount() throws ParsingException {\n     @Override\n     public String getUploaderUrl() throws ParsingException {\n         assertPageFetched();\n-        String uploaderId = null;\n         try {\n-            uploaderId = getVideoSecondaryInfoRenderer().getObject(\"owner\").getObject(\"videoOwnerRenderer\")\n-                    .getObject(\"navigationEndpoint\").getObject(\"browseEndpoint\").getString(\"browseId\");\n+            String uploaderUrl = getUrlFromNavigationEndpoint(getVideoSecondaryInfoRenderer()\n+                    .getObject(\"owner\").getObject(\"videoOwnerRenderer\").getObject(\"navigationEndpoint\"));\n+            if (uploaderUrl != null) return uploaderUrl;\n+        } catch (Exception ignored) {}\n+        try {\n+            String uploaderId = playerResponse.getObject(\"videoDetails\").getString(\"channelId\");\n+            if (uploaderId != null) return \"https://www.youtube.com/channel/\" + uploaderId;\n         } catch (Exception ignored) {}\n-        if (uploaderId == null) {\n-            try {\n-                uploaderId = playerResponse.getObject(\"videoDetails\").getString(\"channelId\");\n-            } catch (Exception ignored) {}\n-        }\n-        if (uploaderId != null) return \"https://www.youtube.com/channel/\" + uploaderId;\n         throw new ParsingException(\"Could not get uploader url\");", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1MTk5Mg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385751992", "bodyText": "The result of this function should, too, being cached, since it is used many times", "author": "Stypox", "createdAt": "2020-02-28T15:17:15Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -261,17 +212,14 @@ public Description getDescription() throws ParsingException {\n     }\n \n     @Override\n-    public int getAgeLimit() throws ParsingException {\n-        assertPageFetched();\n-        if (!isAgeRestricted) {\n+    public int getAgeLimit() {", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1MjI3Mw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385752273", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (getAgeLimit() == 18) {\n          \n          \n            \n                    if (getAgeLimit() != NO_AGE_LIMIT) {", "author": "Stypox", "createdAt": "2020-02-28T15:17:46Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -578,7 +504,7 @@ public StreamType getStreamType() throws ParsingException {\n     @Override\n     public StreamInfoItem getNextStream() throws ExtractionException {\n         assertPageFetched();\n-        if (isAgeRestricted) {\n+        if (getAgeLimit() == 18) {", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc2NTE1OA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385765158", "bodyText": "That's better indeed, though getAgeLimit() will only ever return 18.", "author": "wb9688", "createdAt": "2020-02-28T15:38:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1MjI3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1MjQyOQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385752429", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (getAgeLimit() == 18) {\n          \n          \n            \n                    if (getAgeLimit() != NO_AGE_LIMIT) {", "author": "Stypox", "createdAt": "2020-02-28T15:18:03Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -599,7 +525,7 @@ public StreamInfoItem getNextStream() throws ExtractionException {\n     @Override\n     public StreamInfoItemsCollector getRelatedStreams() throws ExtractionException {\n         assertPageFetched();\n-        if (isAgeRestricted) {\n+        if (getAgeLimit() == 18) {", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1MjcwOA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385752708", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (getAgeLimit() == 18) return Collections.emptyList();\n          \n          \n            \n                    if (getAgeLimit() != NO_AGE_LIMIT) return Collections.emptyList();", "author": "Stypox", "createdAt": "2020-02-28T15:18:30Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -869,7 +773,7 @@ private String getDecryptionFuncName(String playerCode) throws DecryptException\n     @Nonnull\n     private List<SubtitlesInfo> getAvailableSubtitlesInfo() {\n         // If the video is age restricted getPlayerConfig will fail\n-        if (isAgeRestricted) return Collections.emptyList();\n+        if (getAgeLimit() == 18) return Collections.emptyList();", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1NDc1MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385754751", "bodyText": "Isn't there a way to always get the uploader url in the \"/channel/ID\" form? This would make it consistent with other urls in the app, preventing bugs such as duplicate subscriptions", "author": "Stypox", "createdAt": "2020-02-28T15:21:59Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubePlaylistExtractor.java", "diffHunk": "@@ -127,8 +149,7 @@ public String getBannerUrl() {\n     @Override\n     public String getUploaderUrl() throws ParsingException {\n         try {\n-            return YoutubeChannelExtractor.CHANNEL_URL_BASE +\n-                    uploaderInfo.getObject(\"navigationEndpoint\").getObject(\"browseEndpoint\").getString(\"browseId\");\n+            return getUrlFromNavigationEndpoint(getUploaderInfo().getObject(\"navigationEndpoint\"));", "originalCommit": "7898ba230d1ce192be343b16afc2e3d3dfb88ae0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc2NjkyOQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385766929", "bodyText": "Yes, there is I think. Edit: namely reverting that change.", "author": "wb9688", "createdAt": "2020-02-28T15:41:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1NDc1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzNTA1OA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386035058", "bodyText": "@TobiGr: I don't think we should do that, as there are many other ways to get to a /user/name channel in NewPipe. Plus NewPipe could do a simple call to getId() or getUrl() in YoutubeChannelExtractor to get a /channel/id URL, if NewPipe isn't doing that already.", "author": "wb9688", "createdAt": "2020-02-29T15:26:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1NDc1MQ=="}], "type": "inlineReview"}, {"oid": "b89b6b1db229c522fd1eebbb6aed60ee41e8fc4d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/b89b6b1db229c522fd1eebbb6aed60ee41e8fc4d", "message": "Check if hard-coded client version is valid in separate function", "committedDate": "2020-02-28T15:35:24Z", "type": "commit"}, {"oid": "beb07a4852fc27c65ff2db56270085dd663a8012", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/beb07a4852fc27c65ff2db56270085dd663a8012", "message": "Add test to check whether hardcoded client version is still valid", "committedDate": "2020-02-28T15:36:14Z", "type": "commit"}, {"oid": "0b940f5cf47adbefc1f04df5d6232ef24b1cb895", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0b940f5cf47adbefc1f04df5d6232ef24b1cb895", "message": "Use \"getAgeLimit() != NO_AGE_LIMIT\" instead of \"getAgeLimit() == 18\"", "committedDate": "2020-02-28T15:40:50Z", "type": "commit"}, {"oid": "8bfbae904d4b16ec3cc412f9877e725571094a66", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8bfbae904d4b16ec3cc412f9877e725571094a66", "message": "Cache getVideo(Primary|Secondary)InfoRenderer()", "committedDate": "2020-02-28T16:03:21Z", "type": "commit"}, {"oid": "6ba03e542bac3a088787a5db556d97d6f1205dc0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/6ba03e542bac3a088787a5db556d97d6f1205dc0", "message": "Cache getVideoTab()", "committedDate": "2020-02-28T16:05:31Z", "type": "commit"}, {"oid": "4ff655352de245dacc901c179ea70e7512ad853c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4ff655352de245dacc901c179ea70e7512ad853c", "message": "Reimplement getAgeLimit()", "committedDate": "2020-02-28T16:14:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1Nzg1MA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385957850", "bodyText": "This should be done using the\nYoutubeChannelLinkHandlerFactory.getUrl(iploaderId, null, null) method. But it seems to be buggy to me. It does not return \"https://www.youtube.com/channel/ID\", but \"https://www.youtube.com/ID\". I searched for a small random channel (www.youtube.com/user/effectpl) and looked up its channelId (UCuyC5c8JXzPx71aMg7rGFgQ). While www.youtube.com/UCuyC5c8JXzPx71aMg7rGFgQ results in a 404 response,  www.youtube.com/channel/UCuyC5c8JXzPx71aMg7rGFgQ is valid.\nDoes anyone know, why it is implemented that way?", "author": "TobiGr", "createdAt": "2020-02-28T22:49:33Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -381,17 +321,15 @@ public long getDislikeCount() throws ParsingException {\n     @Override\n     public String getUploaderUrl() throws ParsingException {\n         assertPageFetched();\n-        String uploaderId = null;\n         try {\n-            uploaderId = getVideoSecondaryInfoRenderer().getObject(\"owner\").getObject(\"videoOwnerRenderer\")\n-                    .getObject(\"navigationEndpoint\").getObject(\"browseEndpoint\").getString(\"browseId\");\n+            String uploaderUrl = getUrlFromNavigationEndpoint(getVideoSecondaryInfoRenderer()\n+                    .getObject(\"owner\").getObject(\"videoOwnerRenderer\").getObject(\"navigationEndpoint\"));\n+            if (uploaderUrl != null) return uploaderUrl;\n+        } catch (Exception ignored) {}\n+        try {\n+            String uploaderId = playerResponse.getObject(\"videoDetails\").getString(\"channelId\");\n+            if (uploaderId != null) return \"https://www.youtube.com/channel/\" + uploaderId;", "originalCommit": "4ff655352de245dacc901c179ea70e7512ad853c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODk3MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385958971", "bodyText": "That's something I noticed as well. It appears that someone wants to have channel/UCwhatever as input there, so that it would also accept e.g. user/whatever URLs without having to do a conversion of some kind.", "author": "wb9688", "createdAt": "2020-02-28T22:53:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1Nzg1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4MDkwMQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r385980901", "bodyText": "Ah yes, correct. That was the reason. Can you please add this info as Jdoc and use the method?", "author": "TobiGr", "createdAt": "2020-02-29T00:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1Nzg1MA=="}], "type": "inlineReview"}, {"oid": "4f406512c2eb0e7b2dfbdab6e17d94e36a8844bb", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4f406512c2eb0e7b2dfbdab6e17d94e36a8844bb", "message": "Use YoutubeChannelLinkHandlerFactory", "committedDate": "2020-02-29T15:26:28Z", "type": "commit"}, {"oid": "157055fbfd7d9b125bdbcf286c7e8b33eb736def", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/157055fbfd7d9b125bdbcf286c7e8b33eb736def", "message": "Create getJsonResponse() function", "committedDate": "2020-02-29T15:42:04Z", "type": "commit"}, {"oid": "45df8248bfdb83696bf4f6f255e20abcdd162438", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/45df8248bfdb83696bf4f6f255e20abcdd162438", "message": "Use Localization in getJsonResponse()", "committedDate": "2020-02-29T15:55:07Z", "type": "commit"}, {"oid": "a6a63e957030429223ad824aa1e8ad46408e6c65", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/a6a63e957030429223ad824aa1e8ad46408e6c65", "message": "Let isHardcodedClientVersionValid() throw IOException", "committedDate": "2020-02-29T16:01:36Z", "type": "commit"}, {"oid": "bfe3eb1409a63a2c83269a452940a141beec7007", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/bfe3eb1409a63a2c83269a452940a141beec7007", "message": "Use suggested try-if code style", "committedDate": "2020-02-29T16:18:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzOTQ1MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386039451", "bodyText": "Is that a good idea? Because we are talking about channel name, something youtubers (can) change often & easily. Check for id would be better (unchangeable)", "author": "B0pol", "createdAt": "2020-02-29T16:38:11Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/youtube/search/YoutubeSearchExtractorChannelOnlyTest.java", "diffHunk": "@@ -77,7 +92,7 @@ public void testChannelUrl() {\n             if (item instanceof ChannelInfoItem) {\n                 ChannelInfoItem channel = (ChannelInfoItem) item;\n \n-                if (channel.getSubscriberCount() > 5e7) { // the real PewDiePie\n+                if (channel.getSubscriberCount() > 5e7 && channel.getName().equals(\"PewDiePie\")) { // the real PewDiePie", "originalCommit": "a6a63e957030429223ad824aa1e8ad46408e6c65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzOTQ5NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386039495", "bodyText": "You're right, except that there's no way to get an ID from a ChannelInfoItem.", "author": "wb9688", "createdAt": "2020-02-29T16:38:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzOTQ1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0MDI4Ng==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386040286", "bodyText": "Then change 5e7 (50M) to 1e8, ie 100M", "author": "B0pol", "createdAt": "2020-02-29T16:51:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzOTQ1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0MTgwOA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386041808", "bodyText": "The problem is T-Series showing up in the results, so that won't help. What would help is a break after the first channel is found that matches the subscriber criteria.", "author": "wb9688", "createdAt": "2020-02-29T17:16:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzOTQ1MQ=="}], "type": "inlineReview"}, {"oid": "3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "message": "Improve testChannelUrl()", "committedDate": "2020-02-29T17:20:35Z", "type": "commit"}, {"oid": "280707953106ffa9f6ef719c4b76cac2865910eb", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/280707953106ffa9f6ef719c4b76cac2865910eb", "message": "Catch NumberFormatException instead of checking whether viewCount equals \"Recommended for you\"", "committedDate": "2020-02-29T20:28:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0ODcxNg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386048716", "bodyText": "This string sometimes doesn't exist and we end up with https://www.youtube.comnull.\nI think you mentioned in a comment above, and it seems like the browseId is returned everytime.\nWould have to watch out though, because browseEndpoint seems like a generic response and maybe other types of items are returned as well.\nIt'd also help with the consistency of the /channel endpoint use, as some VEVO channels still return their canonicalBaseUrl using /user. Although you already told you opinion about this, it isn't always possible to call that method everywhere (for example: show the subscribe button in lists isn't the most reliable thing when this sort of thing happens), but meh, it's a limitation that we have to live with.\nPS: Discovered with the improvements made in this PR: #265.", "author": "mauriciocolli", "createdAt": "2020-02-29T19:08:16Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/linkHandler/YoutubeParsingHelper.java", "diffHunk": "@@ -160,58 +178,189 @@ public static JsonObject getInitialData(String html) throws ParsingException {\n         }\n     }\n \n+    public static boolean isHardcodedClientVersionValid() throws IOException {\n+        try {\n+            final String url = \"https://www.youtube.com/results?search_query=test&pbj=1\";\n+\n+            Map<String, List<String>> headers = new HashMap<>();\n+            headers.put(\"X-YouTube-Client-Name\", Collections.singletonList(\"1\"));\n+            headers.put(\"X-YouTube-Client-Version\",\n+                    Collections.singletonList(HARDCODED_CLIENT_VERSION));\n+            final String response = getDownloader().get(url, headers).responseBody();\n+            if (response.length() > 50) { // ensure to have a valid response\n+                return true;\n+            }\n+        } catch (ReCaptchaException ignored) {}\n+\n+        return false;\n+    }\n+\n     /**\n      * Get the client version from a page\n-     * @param initialData\n-     * @param html The page HTML\n      * @return\n      * @throws ParsingException\n      */\n-    public static String getClientVersion(JsonObject initialData, String html) throws ParsingException {\n-        if (initialData == null) initialData = getInitialData(html);\n-        JsonArray serviceTrackingParams = initialData.getObject(\"responseContext\").getArray(\"serviceTrackingParams\");\n-        String shortClientVersion = null;\n-\n-        // try to get version from initial data first\n-        for (Object service : serviceTrackingParams) {\n-            JsonObject s = (JsonObject) service;\n-            if (s.getString(\"service\").equals(\"CSI\")) {\n-                JsonArray params = s.getArray(\"params\");\n-                for (Object param: params) {\n-                    JsonObject p = (JsonObject) param;\n-                    String key = p.getString(\"key\");\n-                    if (key != null && key.equals(\"cver\")) {\n-                        return p.getString(\"value\");\n+    public static String getClientVersion() throws ParsingException, IOException {\n+        if (clientVersion != null && !clientVersion.isEmpty()) return clientVersion;\n+\n+        if (isHardcodedClientVersionValid()) {\n+            clientVersion = HARDCODED_CLIENT_VERSION;\n+            return clientVersion;\n+        }\n+\n+        // Try extracting it from YouTube's website otherwise\n+        try {\n+            final String url = \"https://www.youtube.com/results?search_query=test\";\n+            final String html = getDownloader().get(url).responseBody();\n+            JsonObject initialData = getInitialData(html);\n+            JsonArray serviceTrackingParams = initialData.getObject(\"responseContext\").getArray(\"serviceTrackingParams\");\n+            String shortClientVersion = null;\n+\n+            // try to get version from initial data first\n+            for (Object service : serviceTrackingParams) {\n+                JsonObject s = (JsonObject) service;\n+                if (s.getString(\"service\").equals(\"CSI\")) {\n+                    JsonArray params = s.getArray(\"params\");\n+                    for (Object param : params) {\n+                        JsonObject p = (JsonObject) param;\n+                        String key = p.getString(\"key\");\n+                        if (key != null && key.equals(\"cver\")) {\n+                            clientVersion = p.getString(\"value\");\n+                            return clientVersion;\n+                        }\n+                    }\n+                } else if (s.getString(\"service\").equals(\"ECATCHER\")) {\n+                    // fallback to get a shortened client version which does not contain the last two digits\n+                    JsonArray params = s.getArray(\"params\");\n+                    for (Object param : params) {\n+                        JsonObject p = (JsonObject) param;\n+                        String key = p.getString(\"key\");\n+                        if (key != null && key.equals(\"client.version\")) {\n+                            shortClientVersion = p.getString(\"value\");\n+                        }\n+                    }\n+                }\n+            }\n+\n+            String contextClientVersion;\n+            String[] patterns = {\n+                    \"INNERTUBE_CONTEXT_CLIENT_VERSION\\\":\\\"([0-9\\\\.]+?)\\\"\",\n+                    \"innertube_context_client_version\\\":\\\"([0-9\\\\.]+?)\\\"\",\n+                    \"client.version=([0-9\\\\.]+)\"\n+            };\n+            for (String pattern : patterns) {\n+                try {\n+                    contextClientVersion = Parser.matchGroup1(pattern, html);\n+                    if (contextClientVersion != null && !contextClientVersion.isEmpty()) {\n+                        clientVersion = contextClientVersion;\n+                        return clientVersion;\n                     }\n+                } catch (Exception ignored) {\n                 }\n-            } else if (s.getString(\"service\").equals(\"ECATCHER\")) {\n-                // fallback to get a shortened client version which does not contain the last do digits\n-                JsonArray params = s.getArray(\"params\");\n-                for (Object param: params) {\n-                    JsonObject p = (JsonObject) param;\n-                    String key = p.getString(\"key\");\n-                    if (key != null && key.equals(\"client.version\")) {\n-                        shortClientVersion = p.getString(\"value\");\n+            }\n+\n+            if (shortClientVersion != null) {\n+                clientVersion = shortClientVersion;\n+                return clientVersion;\n+            }\n+        } catch (Exception ignored) {}\n+\n+        throw new ParsingException(\"Could not get client version\");\n+    }\n+\n+    public static String getUrlFromNavigationEndpoint(JsonObject navigationEndpoint) {\n+        if (navigationEndpoint.getObject(\"urlEndpoint\") != null) {\n+            String internUrl = navigationEndpoint.getObject(\"urlEndpoint\").getString(\"url\");\n+            if (internUrl.startsWith(\"/redirect?\")) {\n+                // q parameter can be the first parameter\n+                internUrl = internUrl.substring(10);\n+                String[] params = internUrl.split(\"&\");\n+                for (String param : params) {\n+                    if (param.split(\"=\")[0].equals(\"q\")) {\n+                        String url;\n+                        try {\n+                            url = URLDecoder.decode(param.split(\"=\")[1], StandardCharsets.UTF_8.name());\n+                        } catch (UnsupportedEncodingException e) {\n+                            return null;\n+                        }\n+                        return url;\n                     }\n                 }\n+            } else if (internUrl.startsWith(\"http\")) {\n+                return internUrl;\n+            }\n+        } else if (navigationEndpoint.getObject(\"browseEndpoint\") != null) {\n+            return \"https://www.youtube.com\" + navigationEndpoint.getObject(\"browseEndpoint\").getString(\"canonicalBaseUrl\");", "originalCommit": "3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA1MDIyOQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386050229", "bodyText": "This doesn't take into account the \"No views\" case.\nAlso, shame there's no other way to detect this cases.\n@B0pol considering there's even more of these hard coded checks, it seems like parsing all the languages will be annoying, unless you map all the cases. A tremendous maintenance burden, even if it is automated (get the english and compare pages from other languages with it). Would increase the code complexity a lot I think.", "author": "mauriciocolli", "createdAt": "2020-02-29T19:31:19Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -185,13 +194,7 @@ public long getViewCount() throws ParsingException {\n             if (videoInfo.getObject(\"topStandaloneBadge\") != null || isPremium()) {\n                 return -1;\n             }\n-            String viewCount;\n-            if (getStreamType() == StreamType.LIVE_STREAM)  {\n-                viewCount = videoInfo.getObject(\"viewCountText\")\n-                        .getArray(\"runs\").getObject(0).getString(\"text\");\n-            } else {\n-                viewCount = videoInfo.getObject(\"viewCountText\").getString(\"simpleText\");\n-            }\n+            String viewCount = getTextFromObject(videoInfo.getObject(\"viewCountText\"));\n             if (viewCount.equals(\"Recommended for you\")) return -1;\n             return Long.parseLong(Utils.removeNonDigitCharacters(viewCount));", "originalCommit": "3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA1MDQ3Ng==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386050476", "bodyText": "This fails when a video has no views because they are hidden.\nFor example, the Vox channel has some videos which fall in this case, like this one.\nPS: Oddly enough, I went and checked the extractor for streams and for a surprise, there the views are actually available.  Oversight by YouTube I guess.", "author": "mauriciocolli", "createdAt": "2020-02-29T19:35:39Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -185,13 +194,7 @@ public long getViewCount() throws ParsingException {\n             if (videoInfo.getObject(\"topStandaloneBadge\") != null || isPremium()) {\n                 return -1;\n             }\n-            String viewCount;\n-            if (getStreamType() == StreamType.LIVE_STREAM)  {\n-                viewCount = videoInfo.getObject(\"viewCountText\")\n-                        .getArray(\"runs\").getObject(0).getString(\"text\");\n-            } else {\n-                viewCount = videoInfo.getObject(\"viewCountText\").getString(\"simpleText\");\n-            }\n+            String viewCount = getTextFromObject(videoInfo.getObject(\"viewCountText\"));", "originalCommit": "3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA1MTY5NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386051695", "bodyText": "Should handle video premieres, as the date will be in the future.\nAvailable in the upcomingEventData object, I think the core of the old implementation could be reused here:\n\n  \n    \n      NewPipeExtractor/extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java\n    \n    \n        Lines 264 to 287\n      in\n      26234a1\n    \n    \n    \n    \n\n        \n          \n           private boolean isVideoReminder() { \n        \n\n        \n          \n               return !item.select(\"span.yt-uix-livereminder\").isEmpty(); \n        \n\n        \n          \n           } \n        \n\n        \n          \n            \n        \n\n        \n          \n           private Calendar getDateFromReminder() throws ParsingException { \n        \n\n        \n          \n               final Element timeFuture = item.select(\"span.yt-badge.localized-date\").first(); \n        \n\n        \n          \n            \n        \n\n        \n          \n               if (timeFuture == null) { \n        \n\n        \n          \n                   throw new ParsingException(\"Span timeFuture is null\"); \n        \n\n        \n          \n               } \n        \n\n        \n          \n            \n        \n\n        \n          \n               final String timestamp = timeFuture.attr(\"data-timestamp\"); \n        \n\n        \n          \n               if (!timestamp.isEmpty()) { \n        \n\n        \n          \n                   try { \n        \n\n        \n          \n                       final Calendar calendar = Calendar.getInstance(); \n        \n\n        \n          \n                       calendar.setTime(new Date(Long.parseLong(timestamp) * 1000L)); \n        \n\n        \n          \n                       return calendar; \n        \n\n        \n          \n                   } catch (Exception e) { \n        \n\n        \n          \n                       throw new ParsingException(\"Could not parse = \\\"\" + timestamp + \"\\\"\"); \n        \n\n        \n          \n                   } \n        \n\n        \n          \n               } \n        \n\n        \n          \n            \n        \n\n        \n          \n               throw new ParsingException(\"Could not parse date from reminder element: \\\"\" + timeFuture + \"\\\"\"); \n        \n\n        \n          \n           }", "author": "mauriciocolli", "createdAt": "2020-02-29T19:56:18Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -76,89 +79,95 @@ public String getUrl() throws ParsingException {\n \n     @Override\n     public String getName() throws ParsingException {\n-        String name = null;\n-        try {\n-            name = videoInfo.getObject(\"title\").getString(\"simpleText\");\n-        } catch (Exception ignored) {}\n-        if (name == null) {\n-            try {\n-                name = videoInfo.getObject(\"title\").getArray(\"runs\").getObject(0).getString(\"text\");\n-            } catch (Exception ignored) {}\n-        }\n+        String name = getTextFromObject(videoInfo.getObject(\"title\"));\n         if (name != null && !name.isEmpty()) return name;\n         throw new ParsingException(\"Could not get name\");\n     }\n \n     @Override\n     public long getDuration() throws ParsingException {\n+        if (getStreamType() == StreamType.LIVE_STREAM) return -1;\n+\n+        String duration = null;\n+\n         try {\n-            if (getStreamType() == StreamType.LIVE_STREAM) return -1;\n-            return YoutubeParsingHelper.parseDurationString(videoInfo.getObject(\"lengthText\").getString(\"simpleText\"));\n-        } catch (Exception e) {\n-            throw new ParsingException(\"Could not get duration\", e);\n+            duration = getTextFromObject(videoInfo.getObject(\"lengthText\"));\n+        } catch (Exception ignored) {}\n+\n+        if (duration == null) {\n+            try {\n+                for (Object thumbnailOverlay : videoInfo.getArray(\"thumbnailOverlays\")) {\n+                    if (((JsonObject) thumbnailOverlay).getObject(\"thumbnailOverlayTimeStatusRenderer\") != null) {\n+                        duration = getTextFromObject(((JsonObject) thumbnailOverlay)\n+                                .getObject(\"thumbnailOverlayTimeStatusRenderer\").getObject(\"text\"));\n+                    }\n+                }\n+            } catch (Exception ignored) {}\n+\n+            if (duration == null) throw new ParsingException(\"Could not get duration\");\n         }\n+\n+        return YoutubeParsingHelper.parseDurationString(duration);\n     }\n \n     @Override\n     public String getUploaderName() throws ParsingException {\n         String name = null;\n+\n         try {\n-            name = videoInfo.getObject(\"longBylineText\").getArray(\"runs\")\n-                    .getObject(0).getString(\"text\");\n+            name = getTextFromObject(videoInfo.getObject(\"longBylineText\"));\n         } catch (Exception ignored) {}\n+\n         if (name == null) {\n             try {\n-                name = videoInfo.getObject(\"ownerText\").getArray(\"runs\")\n-                        .getObject(0).getString(\"text\");\n-            } catch (Exception ignored) {}\n-        }\n-        if (name == null) {\n-            try {\n-                name = videoInfo.getObject(\"shortBylineText\").getArray(\"runs\")\n-                        .getObject(0).getString(\"text\");\n+                name = getTextFromObject(videoInfo.getObject(\"ownerText\"));\n             } catch (Exception ignored) {}\n+\n+            if (name == null) {\n+                try {\n+                    name = getTextFromObject(videoInfo.getObject(\"shortBylineText\"));\n+                } catch (Exception ignored) {}\n+\n+                if (name == null) throw new ParsingException(\"Could not get uploader name\");\n+            }\n         }\n-        if (name != null && !name.isEmpty()) return name;\n-        throw new ParsingException(\"Could not get uploader name\");\n+\n+        return name;\n     }\n \n     @Override\n     public String getUploaderUrl() throws ParsingException {\n+        String url = null;\n+\n         try {\n-            String id = null;\n+            url = getUrlFromNavigationEndpoint(videoInfo.getObject(\"longBylineText\")\n+                    .getArray(\"runs\").getObject(0).getObject(\"navigationEndpoint\"));\n+        } catch (Exception ignored) {}\n+\n+        if (url == null) {\n             try {\n-                id = videoInfo.getObject(\"longBylineText\").getArray(\"runs\")\n-                        .getObject(0).getObject(\"navigationEndpoint\")\n-                        .getObject(\"browseEndpoint\").getString(\"browseId\");\n+                url = getUrlFromNavigationEndpoint(videoInfo.getObject(\"ownerText\")\n+                        .getArray(\"runs\").getObject(0).getObject(\"navigationEndpoint\"));\n             } catch (Exception ignored) {}\n-            if (id == null) {\n-                try {\n-                    id = videoInfo.getObject(\"ownerText\").getArray(\"runs\")\n-                            .getObject(0).getObject(\"navigationEndpoint\")\n-                            .getObject(\"browseEndpoint\").getString(\"browseId\");\n-                } catch (Exception ignored) {}\n-            }\n-            if (id == null) {\n+\n+            if (url == null) {\n                 try {\n-                    id = videoInfo.getObject(\"shortBylineText\").getArray(\"runs\")\n-                            .getObject(0).getObject(\"navigationEndpoint\")\n-                            .getObject(\"browseEndpoint\").getString(\"browseId\");\n+                    url = getUrlFromNavigationEndpoint(videoInfo.getObject(\"shortBylineText\")\n+                            .getArray(\"runs\").getObject(0).getObject(\"navigationEndpoint\"));\n                 } catch (Exception ignored) {}\n+\n+                if (url == null) throw new ParsingException(\"Could not get uploader url\");\n             }\n-            if (id == null || id.isEmpty()) {\n-                throw new IllegalArgumentException(\"is empty\");\n-            }\n-            return YoutubeChannelLinkHandlerFactory.getInstance().getUrl(id);\n-        } catch (Exception e) {\n-            throw new ParsingException(\"Could not get uploader url\");\n         }\n+\n+        return url;\n     }\n \n     @Nullable\n     @Override\n     public String getTextualUploadDate() {", "originalCommit": "3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA1NDQ0Nw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/262#discussion_r386054447", "bodyText": "Doesn't handle video premieres.", "author": "mauriciocolli", "createdAt": "2020-02-29T20:43:21Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -76,89 +79,95 @@ public String getUrl() throws ParsingException {\n \n     @Override\n     public String getName() throws ParsingException {\n-        String name = null;\n-        try {\n-            name = videoInfo.getObject(\"title\").getString(\"simpleText\");\n-        } catch (Exception ignored) {}\n-        if (name == null) {\n-            try {\n-                name = videoInfo.getObject(\"title\").getArray(\"runs\").getObject(0).getString(\"text\");\n-            } catch (Exception ignored) {}\n-        }\n+        String name = getTextFromObject(videoInfo.getObject(\"title\"));\n         if (name != null && !name.isEmpty()) return name;\n         throw new ParsingException(\"Could not get name\");\n     }\n \n     @Override\n     public long getDuration() throws ParsingException {", "originalCommit": "3e4d2fd64e4fd00f02ebacb8c31d9e3b2de7d6ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}