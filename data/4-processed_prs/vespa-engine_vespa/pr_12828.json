{"pr_number": 12828, "pr_title": "Balder/control naptime", "pr_createdAt": "2020-04-04T16:30:31Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12828", "timeline": [{"oid": "607c7cb232f436c2f094f1cb8cde03e76b6e360d", "url": "https://github.com/vespa-engine/vespa/commit/607c7cb232f436c2f094f1cb8cde03e76b6e360d", "message": "Control nap time", "committedDate": "2020-04-04T15:49:47Z", "type": "commit"}, {"oid": "a8043a2e3edb544442961e3947c466e6d45ad716", "url": "https://github.com/vespa-engine/vespa/commit/a8043a2e3edb544442961e3947c466e6d45ad716", "message": "Go back to initial and rerun tests.", "committedDate": "2020-04-04T16:28:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyNDEzNw==", "url": "https://github.com/vespa-engine/vespa/pull/12828#discussion_r403924137", "bodyText": "What is the end effect if wp < _watermark and this expression underflows?", "author": "vekterli", "createdAt": "2020-04-06T08:45:01Z", "path": "staging_vespalib/src/vespa/vespalib/util/singleexecutor.cpp", "diffHunk": "@@ -144,7 +151,7 @@ SingleExecutor::wait_for_room(Lock & lock) {\n     }\n     _queueSize.add(numTasks());\n     while (numTasks() >= _taskLimit.load(std::memory_order_relaxed)) {\n-        sleepProducer(lock, 10ms, wp - taskLimit/4);\n+        sleepProducer(lock, _napTime, wp - _watermark);", "originalCommit": "a8043a2e3edb544442961e3947c466e6d45ad716", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyNjQwOQ==", "url": "https://github.com/vespa-engine/vespa/pull/12828#discussion_r403926409", "bodyText": "Intentional to change default watermark from /4 to /10?", "author": "vekterli", "createdAt": "2020-04-06T08:48:43Z", "path": "staging_vespalib/src/vespa/vespalib/util/singleexecutor.cpp", "diffHunk": "@@ -6,6 +6,10 @@\n namespace vespalib {\n \n SingleExecutor::SingleExecutor(uint32_t taskLimit)\n+    : SingleExecutor(taskLimit, taskLimit/10, 5ms)", "originalCommit": "a8043a2e3edb544442961e3947c466e6d45ad716", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}