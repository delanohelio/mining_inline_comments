{"pr_number": 12663, "pr_title": "Add benchmark for xxhash32, xxhash64 and legacy", "pr_createdAt": "2020-03-23T08:54:50Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12663", "timeline": [{"oid": "dff6595075b5c6b47bef9297b29e99351341ad38", "url": "https://github.com/vespa-engine/vespa/commit/dff6595075b5c6b47bef9297b29e99351341ad38", "message": "Add benchmark for xxhash32, xxhash64 and legacy", "committedDate": "2020-03-23T08:51:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMxNTE3NQ==", "url": "https://github.com/vespa-engine/vespa/pull/12663#discussion_r396315175", "bodyText": "Since all these benchmarks are the same aside from the evaluation call, could consider factoring out as template argument to a generic benchmark loop function.", "author": "vekterli", "createdAt": "2020-03-23T09:32:43Z", "path": "vespalib/src/tests/stllike/lookup_benchmark.cpp", "diffHunk": "@@ -95,6 +95,41 @@ size_t benchHashMapVespaLib2(size_t sz, size_t numLookups)\n     return benchM(set, sz, numLookups);\n }\n \n+std::unique_ptr<char []> createData(size_t sz) {\n+    auto data = std::make_unique<char []>(sz);\n+    for (size_t i(0); i < sz; i++) {\n+        data.get()[i] = i + '0';\n+    }\n+    return data;\n+}\n+\n+size_t benchXXHash32(size_t sz, size_t numLookups) {\n+    auto data = createData(sz);\n+    size_t sum(0);\n+    for (size_t i(0); i < numLookups; i++) {\n+        sum += XXH32(data.get(), sz, 0);\n+    }\n+    return sum;\n+}\n+\n+size_t benchXXHash64(size_t sz, size_t numLookups) {\n+    auto data = createData(sz);\n+    size_t sum(0);\n+    for (size_t i(0); i < numLookups; i++) {\n+        sum += XXH64(data.get(), sz, 0);\n+    }\n+    return sum;\n+}\n+\n+size_t benchLegacyHash(size_t sz, size_t numLookups) {\n+    auto data = createData(sz);\n+    size_t sum(0);\n+    for (size_t i(0); i < numLookups; i++) {\n+        sum += vespalib::hashValue(data.get(), sz);\n+    }\n+    return sum;\n+}", "originalCommit": "dff6595075b5c6b47bef9297b29e99351341ad38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMjIzMA==", "url": "https://github.com/vespa-engine/vespa/pull/12663#discussion_r396322230", "bodyText": "Yes, I will make one more round.", "author": "baldersheim", "createdAt": "2020-03-23T09:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMxNTE3NQ=="}], "type": "inlineReview"}]}