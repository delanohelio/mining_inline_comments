{"pr_number": 13421, "pr_title": "Arnej/more intermediate filters", "pr_createdAt": "2020-05-28T14:07:40Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13421", "timeline": [{"oid": "f48cd2de9227c811475797429588e590583dc0fb", "url": "https://github.com/vespa-engine/vespa/commit/f48cd2de9227c811475797429588e590583dc0fb", "message": "equiv filter is equivalent to OR", "committedDate": "2020-05-28T14:06:08Z", "type": "commit"}, {"oid": "17d88084e6b898bacc44b2805206d552c14cd167", "url": "https://github.com/vespa-engine/vespa/commit/17d88084e6b898bacc44b2805206d552c14cd167", "message": "make more intermediate operators implement createFilterSearch\n\n* Rank just returns filter from first child\n* Near degrades to AND in the UPPER_BOUND case\n* ONear degrades to AND in the UPPER_BOUND case\n* SourceBlender degrades to OR in the UPPER_BOUND case\n* Phrase degrades to AND in the UPPER_BOUND case", "committedDate": "2020-05-28T14:06:08Z", "type": "commit"}, {"oid": "6366e23e0f46b4ddb0488e4541c46cfcc126a2e4", "url": "https://github.com/vespa-engine/vespa/commit/6366e23e0f46b4ddb0488e4541c46cfcc126a2e4", "message": "implement createFilterSearch in whitelist blueprint", "committedDate": "2020-05-28T14:06:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5MjUzMg==", "url": "https://github.com/vespa-engine/vespa/pull/13421#discussion_r431892532", "bodyText": "This is a slippery slope that could lead to templated and/or multiple inheritance real fast. I would prefer utility functions for creating AND/OR filter searches that are called from explicit implementations over this.", "author": "havardpe", "createdAt": "2020-05-28T14:43:24Z", "path": "searchlib/src/vespa/searchlib/queryeval/intermediate_blueprints.h", "diffHunk": "@@ -103,7 +105,14 @@ class WeakAndBlueprint : public IntermediateBlueprint\n \n //-----------------------------------------------------------------------------\n \n-class NearBlueprint : public IntermediateBlueprint\n+/** shared implementation for operators that degrade to AND when creating filter for upper-bound case */\n+class FilterUpperAndBlueprint : public IntermediateBlueprint", "originalCommit": "6366e23e0f46b4ddb0488e4541c46cfcc126a2e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2OTk5Mw==", "url": "https://github.com/vespa-engine/vespa/pull/13421#discussion_r432269993", "bodyText": "Agree", "author": "geirst", "createdAt": "2020-05-29T05:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5MjUzMg=="}], "type": "inlineReview"}, {"oid": "d6a4cac8a10f1090f9de6e689bd1342e3bf1abfc", "url": "https://github.com/vespa-engine/vespa/commit/d6a4cac8a10f1090f9de6e689bd1342e3bf1abfc", "message": "use helper method instead of inheritance", "committedDate": "2020-05-29T05:30:40Z", "type": "commit"}, {"oid": "cceb654d43601f670c9b9a47fa93f6b23079e57b", "url": "https://github.com/vespa-engine/vespa/commit/cceb654d43601f670c9b9a47fa93f6b23079e57b", "message": "more general helper function, use it from AND also", "committedDate": "2020-05-29T09:09:33Z", "type": "commit"}]}