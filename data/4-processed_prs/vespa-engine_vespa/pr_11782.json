{"pr_number": 11782, "pr_title": "Balder/bring your backing buffer along", "pr_createdAt": "2020-01-14T14:57:12Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/11782", "timeline": [{"oid": "8ab0d17f86ed4f4680f2c3237c4b5dd9937b3adb", "url": "https://github.com/vespa-engine/vespa/commit/8ab0d17f86ed4f4680f2c3237c4b5dd9937b3adb", "message": "use std::move instead of swap to reduce simplify strange interfaces.", "committedDate": "2020-01-14T13:50:54Z", "type": "commit"}, {"oid": "6ddc242f9ab1331c9bf0d5ce373a7a4e3b153196", "url": "https://github.com/vespa-engine/vespa/commit/6ddc242f9ab1331c9bf0d5ce373a7a4e3b153196", "message": "GC constructor collapsed away.", "committedDate": "2020-01-14T13:50:54Z", "type": "commit"}, {"oid": "a772cb05a682fd05fabd0d571417ec7976d0165d", "url": "https://github.com/vespa-engine/vespa/commit/a772cb05a682fd05fabd0d571417ec7976d0165d", "message": "Avoid swap. Inline and use anonymous namespaces for better code generation.", "committedDate": "2020-01-14T13:50:54Z", "type": "commit"}, {"oid": "80835efd5c385b6f8e19212a7c032e57af1fd73d", "url": "https://github.com/vespa-engine/vespa/commit/80835efd5c385b6f8e19212a7c032e57af1fd73d", "message": "Remove virtuality of DocumentId.", "committedDate": "2020-01-14T14:56:03Z", "type": "commit"}, {"oid": "f0636713bd57f443dd486ff10296465327b333a1", "url": "https://github.com/vespa-engine/vespa/commit/f0636713bd57f443dd486ff10296465327b333a1", "message": "GC unused code", "committedDate": "2020-01-14T15:04:17Z", "type": "commit"}, {"oid": "7e0c1731e36eb7048977ad14d6457182fb5ec4c1", "url": "https://github.com/vespa-engine/vespa/commit/7e0c1731e36eb7048977ad14d6457182fb5ec4c1", "message": "GC unused code", "committedDate": "2020-01-14T15:38:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk0OTA1Mg==", "url": "https://github.com/vespa-engine/vespa/pull/11782#discussion_r366949052", "bodyText": "Is explicit toString needed since DocumentId instances are streamable? This question applies to other places where this is done in the PR", "author": "vekterli", "createdAt": "2020-01-15T15:44:16Z", "path": "document/src/vespa/document/fieldvalue/document.cpp", "diffHunk": "@@ -226,9 +226,9 @@ Document::print(std::ostream& out, bool verbose,\n                 const std::string& indent) const\n {\n     if (!verbose) {\n-        out << \"Document(\" << getId() << \", \" << getType() << \")\";\n+        out << \"Document(\" << getId().toString() << \", \" << getType() << \")\";\n     } else {\n-        out << \"Document(\" << getId() << \"\\n\" << indent << \"  \";\n+        out << \"Document(\" << getId().toString() << \"\\n\" << indent << \"  \";", "originalCommit": "80835efd5c385b6f8e19212a7c032e57af1fd73d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0ODU0MA==", "url": "https://github.com/vespa-engine/vespa/pull/11782#discussion_r367348540", "bodyText": "No, cleaned usages of toString() not necessary.", "author": "baldersheim", "createdAt": "2020-01-16T10:43:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk0OTA1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk1NDI4Mw==", "url": "https://github.com/vespa-engine/vespa/pull/11782#discussion_r366954283", "bodyText": "Consider adding a comment that this type must be a compatible DocumentType instance. Or perhaps move the invocation of verifyDocumentType into this function (updating VespaDocumentDeserializer::readDocument accordingly)?", "author": "vekterli", "createdAt": "2020-01-15T15:52:44Z", "path": "document/src/vespa/document/fieldvalue/document.h", "diffHunk": "@@ -54,11 +56,10 @@ class Document : public StructuredFieldValue\n \n     Document& operator=(const Document&);\n \n-    void swap(Document & rhs);\n-\n     void accept(FieldValueVisitor &visitor) override { visitor.visit(*this); }\n     void accept(ConstFieldValueVisitor &visitor) const override { visitor.visit(*this); }\n \n+    void setType(const DataType & type) override;", "originalCommit": "a772cb05a682fd05fabd0d571417ec7976d0165d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0OTE3NA==", "url": "https://github.com/vespa-engine/vespa/pull/11782#discussion_r367349174", "bodyText": "I will write it behind my ear and do that in a later PR.", "author": "baldersheim", "createdAt": "2020-01-16T10:45:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk1NDI4Mw=="}], "type": "inlineReview"}, {"oid": "6b816198bd0d8a518465c8015e6dc9ee40399cd2", "url": "https://github.com/vespa-engine/vespa/commit/6b816198bd0d8a518465c8015e6dc9ee40399cd2", "message": "Just use the stream method.", "committedDate": "2020-01-16T10:42:38Z", "type": "commit"}]}