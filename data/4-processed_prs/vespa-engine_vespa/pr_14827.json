{"pr_number": 14827, "pr_title": "vespalib::Monitor -> std::mutex and std::condition_variable", "pr_createdAt": "2020-10-12T18:28:53Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14827", "timeline": [{"oid": "e072003cb1cc8d863ed0766fac78e6fb46b80176", "url": "https://github.com/vespa-engine/vespa/commit/e072003cb1cc8d863ed0766fac78e6fb46b80176", "message": "vespalib::Monitor -> std::mutex and std::condition_variable", "committedDate": "2020-10-12T18:27:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ3NDQ1NQ==", "url": "https://github.com/vespa-engine/vespa/pull/14827#discussion_r503474455", "bodyText": "Consider removing now unused scope block", "author": "vekterli", "createdAt": "2020-10-12T18:49:47Z", "path": "storageframework/src/vespa/storageframework/generic/thread/thread.cpp", "diffHunk": "@@ -3,30 +3,27 @@\n #include \"thread.h\"\n #include <vespa/vespalib/util/sync.h>\n \n-namespace storage {\n-namespace framework {\n+namespace storage::framework {\n \n void\n Thread::interruptAndJoin(vespalib::Monitor* m)\n {\n     interrupt();\n-    if (m != 0) {\n+    if (m != nullptr) {\n         vespalib::MonitorGuard monitorGuard(*m);\n         monitorGuard.broadcast();\n     }\n     join();\n }\n \n void\n-Thread::interruptAndJoin(std::mutex &m, std::condition_variable &cv)\n+Thread::interruptAndJoin(std::condition_variable &cv)\n {\n     interrupt();\n     {\n-        std::lock_guard<std::mutex> guard(m);\n         cv.notify_all();\n     }", "originalCommit": "e072003cb1cc8d863ed0766fac78e6fb46b80176", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5MDg1OA==", "url": "https://github.com/vespa-engine/vespa/pull/14827#discussion_r503490858", "bodyText": "Thanks, done", "author": "baldersheim", "createdAt": "2020-10-12T19:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ3NDQ1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ3NDg2Ng==", "url": "https://github.com/vespa-engine/vespa/pull/14827#discussion_r503474866", "bodyText": "Consider removing comment about \"-1 = waiting forever\", as that probably doesn't work anymore (did it ever?)", "author": "vekterli", "createdAt": "2020-10-12T18:50:36Z", "path": "storage/src/vespa/storage/common/storagelink.h", "diffHunk": "@@ -199,7 +201,7 @@ class Queue {\n      * (0 = don't wait, -1 = forever)\n      * @return  true or false if the queue was empty.\n      */\n-    bool getNext(std::shared_ptr<api::StorageMessage>& msg, int timeout);\n+    bool getNext(std::shared_ptr<api::StorageMessage>& msg, vespalib::duration timeout);", "originalCommit": "e072003cb1cc8d863ed0766fac78e6fb46b80176", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5MDk1Mg==", "url": "https://github.com/vespa-engine/vespa/pull/14827#discussion_r503490952", "bodyText": "Done.", "author": "baldersheim", "createdAt": "2020-10-12T19:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ3NDg2Ng=="}], "type": "inlineReview"}, {"oid": "6a73dc17c633bfa150a41354f843c91d805ef795", "url": "https://github.com/vespa-engine/vespa/commit/6a73dc17c633bfa150a41354f843c91d805ef795", "message": "No longer any need to scope the notify call. Also remove comment on timeout.", "committedDate": "2020-10-12T19:28:18Z", "type": "commit"}]}