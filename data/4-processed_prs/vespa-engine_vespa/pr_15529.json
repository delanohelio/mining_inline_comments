{"pr_number": 15529, "pr_title": "first cut errata", "pr_createdAt": "2020-11-30T09:36:31Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15529", "timeline": [{"oid": "4b0007aa0027276ab7c5d5c4a52b75fce7ed7f03", "url": "https://github.com/vespa-engine/vespa/commit/4b0007aa0027276ab7c5d5c4a52b75fce7ed7f03", "message": "first cut errata", "committedDate": "2020-11-30T09:35:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ3OTAzMg==", "url": "https://github.com/vespa-engine/vespa/pull/15529#discussion_r532479032", "bodyText": "We should probably use versions here. Introduced in Vespa 7.277.38. Fixed in 7.292.82.", "author": "geirst", "createdAt": "2020-11-30T10:08:14Z", "path": "ERRATA.md", "diffHunk": "@@ -0,0 +1,36 @@\n+<!-- Copyright verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->\n+\n+## Errata\n+\n+### 2020-11-30: Document inconsistency\n+This bug existed between 2020-08-28 and 2020-09-23.", "originalCommit": "4b0007aa0027276ab7c5d5c4a52b75fce7ed7f03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ4NTAyNA==", "url": "https://github.com/vespa-engine/vespa/pull/15529#discussion_r532485024", "bodyText": "better!", "author": "kkraune", "createdAt": "2020-11-30T10:17:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ3OTAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ3OTIyNw==", "url": "https://github.com/vespa-engine/vespa/pull/15529#discussion_r532479227", "bodyText": "This was fixed in 7.292.82.", "author": "geirst", "createdAt": "2020-11-30T10:08:36Z", "path": "ERRATA.md", "diffHunk": "@@ -0,0 +1,36 @@\n+<!-- Copyright verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->\n+\n+## Errata\n+\n+### 2020-11-30: Document inconsistency\n+This bug existed between 2020-08-28 and 2020-09-23.\n+The following needs to happen to trigger the bug:\n+\n+* Visibility delay is non-zero.\n+* A new config change is deployed that contains changes to proton.\n+  This config snapshot is stored in the transaction log on the content node.\n+* vespa-proton-bin is restarted, and as part of the prepare for restart step,\n+  at least one attribute vector is not flushed to the current serial number.\n+* Due to the bug, replay of the transaction log will fail to replay feed operations to attributes after replaying the config change.\n+  The effect is that all attributes that were not flushed as part of prepare for restart\n+  will not get any of the updates since the last time they were flushed.\n+* If a document was previously removed, lid space compaction will move another document to that local document id.\n+  Due to later missing updates as part of restarting we might see values from the removed document for some of the attributes.\n+* When the problem attributes are later flushed this inconsistency will be permanent.\n+\n+Solution:\n+* Upgrade Vespa to at least vespa-7.306.19-1.el7.x86_64.rpm.", "originalCommit": "4b0007aa0027276ab7c5d5c4a52b75fce7ed7f03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MDU5OA==", "url": "https://github.com/vespa-engine/vespa/pull/15529#discussion_r532460598", "bodyText": "It would be good to have the exact Vespa version ranges here", "author": "vekterli", "createdAt": "2020-11-30T09:40:05Z", "path": "ERRATA.md", "diffHunk": "@@ -0,0 +1,36 @@\n+<!-- Copyright verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->\n+\n+## Errata\n+\n+### 2020-11-30: Document inconsistency\n+This bug existed between 2020-08-28 and 2020-09-23.", "originalCommit": "4b0007aa0027276ab7c5d5c4a52b75fce7ed7f03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzI4NQ==", "url": "https://github.com/vespa-engine/vespa/pull/15529#discussion_r532463285", "bodyText": "I'm presuming this needed the old explicit visibility-delay option to be set explicitly to > 0? If so, consider mentioning that this was not the default setting.", "author": "vekterli", "createdAt": "2020-11-30T09:44:24Z", "path": "ERRATA.md", "diffHunk": "@@ -0,0 +1,36 @@\n+<!-- Copyright verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->\n+\n+## Errata\n+\n+### 2020-11-30: Document inconsistency\n+This bug existed between 2020-08-28 and 2020-09-23.\n+The following needs to happen to trigger the bug:\n+\n+* Visibility delay is non-zero.", "originalCommit": "4b0007aa0027276ab7c5d5c4a52b75fce7ed7f03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ4NTY0Nw==", "url": "https://github.com/vespa-engine/vespa/pull/15529#discussion_r532485647", "bodyText": "yes, good clarification, will add", "author": "kkraune", "createdAt": "2020-11-30T10:18:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzI4NQ=="}], "type": "inlineReview"}, {"oid": "bf493134bc7e1b28bf7f1e84a53f44e01d3ab83a", "url": "https://github.com/vespa-engine/vespa/commit/bf493134bc7e1b28bf7f1e84a53f44e01d3ab83a", "message": "versin ranges, non-default visibility-delay", "committedDate": "2020-11-30T10:21:49Z", "type": "commit"}]}