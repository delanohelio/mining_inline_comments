{"pr_number": 14241, "pr_title": "- Add test for sequencing.", "pr_createdAt": "2020-09-02T10:12:18Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14241", "timeline": [{"oid": "ea820868d666739da68850ecae07d20628d941b6", "url": "https://github.com/vespa-engine/vespa/commit/ea820868d666739da68850ecae07d20628d941b6", "message": "- Add test for sequencing.\n- Also sequence multiple operations to the same id as the originating request.", "committedDate": "2020-09-02T10:09:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA==", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482016460", "bodyText": "Shouldn't this be numMsgWithOriginalSequenceId >= 1 ?", "author": "bratseth", "createdAt": "2020-09-02T12:05:15Z", "path": "docproc/src/main/java/com/yahoo/docproc/jdisc/messagebus/MbusRequestContext.java", "diffHunk": "@@ -96,12 +97,16 @@ public void processingDone(List<Processing> processings) {\n         }\n         long inputSequenceId = requestMsg.getSequenceId();\n         ResponseMerger responseHandler = new ResponseMerger(requestMsg, messages.size(), this);\n+        int numMsgWithOriginalSequenceId = 0;\n         for (Message message : messages) {\n+            if (message.getSequenceId() == inputSequenceId) numMsgWithOriginalSequenceId++;\n+        }\n+        for (Message message : messages) {\n+            String path = internalNoThrottledSourcePath;\n+            if ((numMsgWithOriginalSequenceId == 1) && (message.getSequenceId() == inputSequenceId))", "originalCommit": "ea820868d666739da68850ecae07d20628d941b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAyNDIyMw==", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482024223", "bodyText": "No, you shall only continue on the original path if there is exactly one operation with the same id as the incoming operation. If there are multiple operations with the same id they must always be sequenced. If they are to the original id or not does not matter.", "author": "baldersheim", "createdAt": "2020-09-02T12:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAyNDkxNQ==", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482024915", "bodyText": "The if is actually the normal path :)", "author": "baldersheim", "createdAt": "2020-09-02T12:21:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAyNjA3Mw==", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482026073", "bodyText": "\ud83d\udc4d", "author": "bratseth", "createdAt": "2020-09-02T12:23:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA=="}], "type": "inlineReview"}]}