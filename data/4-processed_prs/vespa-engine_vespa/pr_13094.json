{"pr_number": 13094, "pr_title": "Implement hasReply avoid copying the shared_ptr just to peak at the r", "pr_createdAt": "2020-04-28T15:00:25Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13094", "timeline": [{"oid": "9370479561c4098775ca3c6ae3985eb563ce050d", "url": "https://github.com/vespa-engine/vespa/commit/9370479561c4098775ca3c6ae3985eb563ce050d", "message": "Implement hasReply avoid copying the shared_ptr just to peak at the result.", "committedDate": "2020-04-28T14:57:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5MjgzOQ==", "url": "https://github.com/vespa-engine/vespa/pull/13094#discussion_r416692839", "bodyText": "I'd prefer this to be called something like steal_reply_sp, as the current name implies the function doesn't have any side effects", "author": "vekterli", "createdAt": "2020-04-28T15:09:48Z", "path": "storage/src/vespa/storage/persistence/persistenceutil.h", "diffHunk": "@@ -43,20 +42,27 @@ class MessageTracker : protected Types {\n      * commands like merge. */\n     void dontReply() { _sendReply = false; }\n \n-    api::StorageReply::SP getReply() {\n-        return _reply;\n+    bool hasReply() const { return bool(_reply); }\n+    const api::StorageReply & getReply() const {\n+        return *_reply;\n+    }\n+    api::StorageReply & getReply() {\n+        return *_reply;\n+    }\n+    api::StorageReply::SP getReplySP() {", "originalCommit": "9370479561c4098775ca3c6ae3985eb563ce050d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcwMDg3MA==", "url": "https://github.com/vespa-engine/vespa/pull/13094#discussion_r416700870", "bodyText": "Done.", "author": "baldersheim", "createdAt": "2020-04-28T15:19:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5MjgzOQ=="}], "type": "inlineReview"}, {"oid": "87789913698f4fd12c4bc81b6a731325f32fce02", "url": "https://github.com/vespa-engine/vespa/commit/87789913698f4fd12c4bc81b6a731325f32fce02", "message": "getReplySP => stealReplySP", "committedDate": "2020-04-28T15:16:53Z", "type": "commit"}, {"oid": "9cd9ec58087661a1b55d97234d33da31d31e8158", "url": "https://github.com/vespa-engine/vespa/commit/9cd9ec58087661a1b55d97234d33da31d31e8158", "message": "Use rvalue qualifier", "committedDate": "2020-04-28T15:29:07Z", "type": "commit"}]}