{"pr_number": 14224, "pr_title": "Arnej/add direct tensor attribute", "pr_createdAt": "2020-09-01T10:16:18Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14224", "timeline": [{"oid": "b4967f9ca09ad4728a86daf43368d0df418f3d68", "url": "https://github.com/vespa-engine/vespa/commit/b4967f9ca09ad4728a86daf43368d0df418f3d68", "message": "add DirectTensorAttribute implementation", "committedDate": "2020-09-01T09:17:09Z", "type": "commit"}, {"oid": "7f2bba064e2bd2aa79a6aea9658821e3ec1e7c76", "url": "https://github.com/vespa-engine/vespa/commit/7f2bba064e2bd2aa79a6aea9658821e3ec1e7c76", "message": "set_tensor() -> store_tensor() to better reflect intent", "committedDate": "2020-09-01T10:14:39Z", "type": "commit"}, {"oid": "00415c9642d15a2a03c7d1692df05697a18f3edd", "url": "https://github.com/vespa-engine/vespa/commit/00415c9642d15a2a03c7d1692df05697a18f3edd", "message": "create DirectTensorAttribute for sparse tensors with fast-search", "committedDate": "2020-09-01T10:14:44Z", "type": "commit"}, {"oid": "5d52e67fb5222b65201204786785d62d8655de39", "url": "https://github.com/vespa-engine/vespa/commit/5d52e67fb5222b65201204786785d62d8655de39", "message": "use direct access to tensor when possible", "committedDate": "2020-09-01T10:14:45Z", "type": "commit"}, {"oid": "fb43df5c1cdd0802754c13d6243179e18183fd5d", "url": "https://github.com/vespa-engine/vespa/commit/fb43df5c1cdd0802754c13d6243179e18183fd5d", "message": "unit test direct tensor reference as well", "committedDate": "2020-09-01T10:14:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwMjEyNA==", "url": "https://github.com/vespa-engine/vespa/pull/14224#discussion_r481102124", "bodyText": "To avoid type checking in the inner-loop, consider creating a separate executor instead and choose that in createTensorAttributeExecutor() in attributefeature.cpp.", "author": "geirst", "createdAt": "2020-09-01T12:33:17Z", "path": "searchlib/src/vespa/searchlib/features/tensor_attribute_executor.cpp", "diffHunk": "@@ -17,6 +18,11 @@ TensorAttributeExecutor(const search::tensor::ITensorAttribute *attribute)\n void\n TensorAttributeExecutor::execute(uint32_t docId)\n {\n+    using DTA = search::tensor::DirectTensorAttribute;", "originalCommit": "5d52e67fb5222b65201204786785d62d8655de39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0NzU3NA==", "url": "https://github.com/vespa-engine/vespa/pull/14224#discussion_r481147574", "bodyText": "done.", "author": "arnej27959", "createdAt": "2020-09-01T13:43:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwMjEyNA=="}], "type": "inlineReview"}, {"oid": "1e3ffd7130e44e696281ed7f8ccda28180cf2538", "url": "https://github.com/vespa-engine/vespa/commit/1e3ffd7130e44e696281ed7f8ccda28180cf2538", "message": "allow \"attribute: fast-search\" for sparse tensors", "committedDate": "2020-09-01T13:19:04Z", "type": "commit"}, {"oid": "618dd98341a131cd40e70cf8a150948284ad55e1", "url": "https://github.com/vespa-engine/vespa/commit/618dd98341a131cd40e70cf8a150948284ad55e1", "message": "even simpler executor for direct tensor attributes", "committedDate": "2020-09-01T13:34:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1MzEwNg==", "url": "https://github.com/vespa-engine/vespa/pull/14224#discussion_r481153106", "bodyText": "Consider reverting change to TensorAttributeExecutor now that we have a DIrectTensorAttributeExecutor ?", "author": "toregge", "createdAt": "2020-09-01T13:51:22Z", "path": "searchlib/src/vespa/searchlib/features/attributefeature.cpp", "diffHunk": "@@ -469,6 +472,9 @@ createTensorAttributeExecutor(const IAttributeVector *attribute, const vespalib:\n     if (tensorType.is_dense()) {\n         return stash.create<DenseTensorAttributeExecutor>(tensorAttribute);\n     }\n+    if (auto direct = dynamic_cast<const DirectTensorAttribute *>(tensorAttribute)) {\n+        return stash.create<DirectTensorAttributeExecutor>(*direct);\n+    }", "originalCommit": "618dd98341a131cd40e70cf8a150948284ad55e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1NTczMA==", "url": "https://github.com/vespa-engine/vespa/pull/14224#discussion_r481155730", "bodyText": "yes - i forgot about that, thank you.", "author": "arnej27959", "createdAt": "2020-09-01T13:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1MzEwNg=="}], "type": "inlineReview"}, {"oid": "03bbd9929378a602788499d0dba2bb4319617fbb", "url": "https://github.com/vespa-engine/vespa/commit/03bbd9929378a602788499d0dba2bb4319617fbb", "message": "Revert \"use direct access to tensor when possible\"\n\n(this is now handled by its own executor)\n\nThis reverts commit 5d52e67fb5222b65201204786785d62d8655de39.", "committedDate": "2020-09-01T13:53:53Z", "type": "commit"}]}