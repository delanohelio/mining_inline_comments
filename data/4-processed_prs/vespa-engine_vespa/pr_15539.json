{"pr_number": 15539, "pr_title": "Bratseth/filter unstable later", "pr_createdAt": "2020-11-30T13:32:06Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15539", "timeline": [{"oid": "69667e75981ef43b9048354ccb89295b676af265", "url": "https://github.com/vespa-engine/vespa/commit/69667e75981ef43b9048354ccb89295b676af265", "message": "Filter unstable at db insert", "committedDate": "2020-11-30T10:32:45Z", "type": "commit"}, {"oid": "ac7af6d0b2e4f2fe8399d26518262d5d7396c794", "url": "https://github.com/vespa-engine/vespa/commit/ac7af6d0b2e4f2fe8399d26518262d5d7396c794", "message": "Store metrics with inService or stable false", "committedDate": "2020-11-30T12:10:45Z", "type": "commit"}, {"oid": "9a2bce1b48ebcaa807e79ce7bb048ff2e93c6473", "url": "https://github.com/vespa-engine/vespa/commit/9a2bce1b48ebcaa807e79ce7bb048ff2e93c6473", "message": "Filter at read time", "committedDate": "2020-11-30T12:51:38Z", "type": "commit"}, {"oid": "7ad2fca1417f807ebd81a716a2fbfdc458397927", "url": "https://github.com/vespa-engine/vespa/commit/7ad2fca1417f807ebd81a716a2fbfdc458397927", "message": "Add tests", "committedDate": "2020-11-30T13:03:36Z", "type": "commit"}, {"oid": "4765de9be3717b0dcdc08deac520b7fd7f4f9dca", "url": "https://github.com/vespa-engine/vespa/commit/4765de9be3717b0dcdc08deac520b7fd7f4f9dca", "message": "Add temporary additional information", "committedDate": "2020-11-30T13:31:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwNzYyMg==", "url": "https://github.com/vespa-engine/vespa/pull/15539#discussion_r532607622", "bodyText": "This is unused now?", "author": "freva", "createdAt": "2020-11-30T13:46:55Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeMetricsDbMaintainer.java", "diffHunk": "@@ -63,6 +63,7 @@ protected boolean maintain() {\n     private Collection<Pair<String, MetricSnapshot>> filter(Collection<Pair<String, MetricSnapshot>> snapshots) {", "originalCommit": "4765de9be3717b0dcdc08deac520b7fd7f4f9dca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyNjI4NQ==", "url": "https://github.com/vespa-engine/vespa/pull/15539#discussion_r532626285", "bodyText": "Yes, removed thanks", "author": "bratseth", "createdAt": "2020-11-30T14:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwNzYyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYxMDc0MQ==", "url": "https://github.com/vespa-engine/vespa/pull/15539#discussion_r532610741", "bodyText": "What about the existing tables?", "author": "freva", "createdAt": "2020-11-30T13:51:40Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/autoscale/QuestMetricsDb.java", "diffHunk": "@@ -152,7 +154,8 @@ private void ensureExists(String tableName) {\n \n         try (SqlCompiler compiler = new SqlCompiler(engine)) {\n             compiler.compile(\"create table \" + tableName +\n-                             \" (hostname string, at timestamp, cpu_util float, mem_total_util float, disk_util float, application_generation long)\" +\n+                             \" (hostname string, at timestamp, cpu_util float, mem_total_util float, disk_util float,\" +", "originalCommit": "4765de9be3717b0dcdc08deac520b7fd7f4f9dca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyNzMyNQ==", "url": "https://github.com/vespa-engine/vespa/pull/15539#discussion_r532627325", "bodyText": "They will get default values, which is not what we want here (we want true not false), but the only effect is no autoscaling for a while, so I think that's okay.", "author": "bratseth", "createdAt": "2020-11-30T14:15:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYxMDc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0MjU5OQ==", "url": "https://github.com/vespa-engine/vespa/pull/15539#discussion_r532642599", "bodyText": "So as soon as you add a row with 6th column, that is legal even though the table was created with 5 columns, and all existing rows will get a default value of the type of the 6th column in the new row?", "author": "freva", "createdAt": "2020-11-30T14:36:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYxMDc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY2NDU5Nw==", "url": "https://github.com/vespa-engine/vespa/pull/15539#discussion_r532664597", "bodyText": "Apparently - I tested it. Couldn't find any documentation on this scenario.", "author": "bratseth", "createdAt": "2020-11-30T15:06:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYxMDc0MQ=="}], "type": "inlineReview"}, {"oid": "7d518d8eaa1a0a2e8711213cab4bb8f5e227e84f", "url": "https://github.com/vespa-engine/vespa/commit/7d518d8eaa1a0a2e8711213cab4bb8f5e227e84f", "message": "Remove dead code", "committedDate": "2020-11-30T14:13:59Z", "type": "commit"}]}