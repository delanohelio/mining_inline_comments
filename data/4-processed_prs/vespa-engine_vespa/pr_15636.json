{"pr_number": 15636, "pr_title": "Arnej/less mutable dense tensor view", "pr_createdAt": "2020-12-03T12:49:14Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15636", "timeline": [{"oid": "f5a3b49a2f3fe9f926b28633946ed0a47768516d", "url": "https://github.com/vespa-engine/vespa/commit/f5a3b49a2f3fe9f926b28633946ed0a47768516d", "message": "include only what is needed", "committedDate": "2020-12-03T11:23:25Z", "type": "commit"}, {"oid": "957237a4e2859bda5ccaf536c0553092f0edde76", "url": "https://github.com/vespa-engine/vespa/commit/957237a4e2859bda5ccaf536c0553092f0edde76", "message": "simplify notImplemented()\n\n* no need for notImplemented() to be virtual\n* special version for documentmetastore does not seem to\n  add any value\n* ensure [[noreturn]] attribute actually works", "committedDate": "2020-12-03T11:23:25Z", "type": "commit"}, {"oid": "c3fef6299473204c6e5b0ea1e020ce9c17621b2c", "url": "https://github.com/vespa-engine/vespa/commit/c3fef6299473204c6e5b0ea1e020ce9c17621b2c", "message": "extract_dense_view can just return the cells reference", "committedDate": "2020-12-03T11:23:25Z", "type": "commit"}, {"oid": "a15a1170bf007ddf1223eb4efeded13af3414756", "url": "https://github.com/vespa-engine/vespa/commit/a15a1170bf007ddf1223eb4efeded13af3414756", "message": "getTensor with mutable view no longer needed", "committedDate": "2020-12-03T11:23:26Z", "type": "commit"}, {"oid": "055dbdc3cbc9fcfb0e95246953f356835caa6fb6", "url": "https://github.com/vespa-engine/vespa/commit/055dbdc3cbc9fcfb0e95246953f356835caa6fb6", "message": "GC leftovers", "committedDate": "2020-12-03T11:23:26Z", "type": "commit"}, {"oid": "913f34b83a52ae90a6b88fcb1b7ad7acf8402731", "url": "https://github.com/vespa-engine/vespa/commit/913f34b83a52ae90a6b88fcb1b7ad7acf8402731", "message": "be a Value directly\n\n* move to vespalib::eval namespace\n* do not inherit via DenseTensorView", "committedDate": "2020-12-03T11:23:26Z", "type": "commit"}, {"oid": "76e7067ce6c9c7f7186a88ea9a9713681168af46", "url": "https://github.com/vespa-engine/vespa/commit/76e7067ce6c9c7f7186a88ea9a9713681168af46", "message": "can now just extract cells directly", "committedDate": "2020-12-03T11:23:26Z", "type": "commit"}, {"oid": "2b59e7df82e6d47eefd06cc6a0b2cc8f7031250a", "url": "https://github.com/vespa-engine/vespa/commit/2b59e7df82e6d47eefd06cc6a0b2cc8f7031250a", "message": "track API changes", "committedDate": "2020-12-03T11:23:26Z", "type": "commit"}, {"oid": "416d6daaffb6f4bcaca02622ae6e50b52725993e", "url": "https://github.com/vespa-engine/vespa/commit/416d6daaffb6f4bcaca02622ae6e50b52725993e", "message": "rename extract_dense_view -> extract_cells_ref", "committedDate": "2020-12-03T12:10:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIxNDA0OQ==", "url": "https://github.com/vespa-engine/vespa/pull/15636#discussion_r535214049", "bodyText": "consider keeping the assert for cell type equality", "author": "havardpe", "createdAt": "2020-12-03T13:11:11Z", "path": "eval/src/vespa/eval/tensor/dense/mutable_dense_tensor_view.h", "diffHunk": "@@ -2,25 +2,27 @@\n \n #pragma once\n \n-#include \"dense_tensor_view.h\"\n+#include <vespa/eval/eval/value.h>\n #include <cassert>\n \n-namespace vespalib::tensor {\n+namespace vespalib::eval {\n \n /**\n- * A mutable view to a dense tensor where all dimensions are indexed.\n+ * A dense tensor with a cells reference that can be modified.\n  */\n-class MutableDenseTensorView : public DenseTensorView\n-{\n+class MutableDenseTensorView : public Value {\n private:\n-    eval::ValueType _type;\n-\n+    const ValueType _type;\n+    TypedCells _cells;\n public:\n-    MutableDenseTensorView(eval::ValueType type_in);\n-    MutableDenseTensorView(MutableDenseTensorView &&) = default;\n+    MutableDenseTensorView(const ValueType &type_in);\n     void setCells(TypedCells cells_in) {\n-        initCellsRef(cells_in);\n+        _cells = cells_in;", "originalCommit": "416d6daaffb6f4bcaca02622ae6e50b52725993e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ae914e3a26518b6c098fb5b2569f0cab9cf77a73", "url": "https://github.com/vespa-engine/vespa/commit/ae914e3a26518b6c098fb5b2569f0cab9cf77a73", "message": "assert on cell type also", "committedDate": "2020-12-03T13:57:18Z", "type": "commit"}]}