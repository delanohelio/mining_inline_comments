{"pr_number": 13571, "pr_title": "use typify_invoke to select matmul implementation", "pr_createdAt": "2020-06-12T13:57:15Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13571", "timeline": [{"oid": "5233b53188a40bfc51f38990173d5d906534499a", "url": "https://github.com/vespa-engine/vespa/commit/5233b53188a40bfc51f38990173d5d906534499a", "message": "use typify_invoke to select matmul implementation\n\n* instead of a chain of select functions, use typify_invoke;\n  use partial specialization on a struct to handle the\n  double*double and float*float cases specially.", "committedDate": "2020-06-12T13:50:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ1NTU1Nw==", "url": "https://github.com/vespa-engine/vespa/pull/13571#discussion_r439455557", "bodyText": "can we eliminate this struct by letting the others capture the TypifyBool::Result instead of bool?", "author": "havardpe", "createdAt": "2020-06-12T14:32:19Z", "path": "eval/src/vespa/eval/tensor/dense/dense_matmul_function.cpp", "diffHunk": "@@ -160,6 +119,35 @@ const TensorFunction &create_matmul(const TensorFunction &a, const TensorFunctio\n     }\n }\n \n+template <typename LCT, typename RCT, bool lhs_common_inner, bool rhs_common_inner>\n+struct MyMatMulOp {\n+    static auto get_fun() {\n+        return my_matmul_op<LCT, RCT, lhs_common_inner, rhs_common_inner>;\n+    }\n+};\n+\n+template <bool lhs_common_inner, bool rhs_common_inner>\n+struct MyMatMulOp<double, double, lhs_common_inner, rhs_common_inner> {\n+    static auto get_fun() {\n+            return my_cblas_double_matmul_op<lhs_common_inner, rhs_common_inner>;\n+    }\n+};\n+\n+template <bool lhs_common_inner, bool rhs_common_inner>\n+struct MyMatMulOp<float, float, lhs_common_inner, rhs_common_inner> {\n+    static auto get_fun() {\n+        return my_cblas_float_matmul_op<lhs_common_inner, rhs_common_inner>;\n+    }\n+};\n+\n+struct MyTarget {", "originalCommit": "5233b53188a40bfc51f38990173d5d906534499a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNTYzNQ==", "url": "https://github.com/vespa-engine/vespa/pull/13571#discussion_r439735635", "bodyText": "alternative suggestion added below", "author": "havardpe", "createdAt": "2020-06-13T12:29:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ1NTU1Nw=="}], "type": "inlineReview"}, {"oid": "20843210c453422350d42652d4a21ef94cce5ebe", "url": "https://github.com/vespa-engine/vespa/commit/20843210c453422350d42652d4a21ef94cce5ebe", "message": "replace template magic with if statement", "committedDate": "2020-06-13T10:32:54Z", "type": "commit"}]}