{"pr_number": 12135, "pr_title": "Hnsw simplifications with distance function interface", "pr_createdAt": "2020-02-10T12:33:48Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12135", "timeline": [{"oid": "8164e4a5c4910a878e49663730de5c2b310d5940", "url": "https://github.com/vespa-engine/vespa/commit/8164e4a5c4910a878e49663730de5c2b310d5940", "message": "Add interface used to calculate the distance between two n-dim vectors.", "committedDate": "2020-02-10T12:12:08Z", "type": "commit"}, {"oid": "1debbb54c26ce0c146a1d0711beea55adef3173b", "url": "https://github.com/vespa-engine/vespa/commit/1debbb54c26ce0c146a1d0711beea55adef3173b", "message": "Move code to the hnsw index base class as we no longer depend on the float type.", "committedDate": "2020-02-10T12:19:40Z", "type": "commit"}, {"oid": "b9e867c4a20e9aa340dbdb110066083ebcc2a619", "url": "https://github.com/vespa-engine/vespa/commit/b9e867c4a20e9aa340dbdb110066083ebcc2a619", "message": "Rename HnswIndexBase -> HnswIndex and remove the templated class.", "committedDate": "2020-02-10T12:30:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwMTYwMQ==", "url": "https://github.com/vespa-engine/vespa/pull/12135#discussion_r377501601", "bodyText": "i don't see that you should need \"template\" here...", "author": "arnej27959", "createdAt": "2020-02-11T08:49:19Z", "path": "searchlib/src/vespa/searchlib/tensor/distance_functions.h", "diffHunk": "@@ -0,0 +1,34 @@\n+// Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include \"distance_function.h\"\n+\n+namespace search::tensor {\n+\n+// TODO: Make distance functions hardware optimized.\n+\n+/**\n+ * Calculates the square of the standard Euclidean distance.\n+ */\n+template <typename FloatType>\n+class SquaredEuclideanDistance : public DistanceFunction {\n+public:\n+    double calc(const vespalib::tensor::TypedCells& lhs, const vespalib::tensor::TypedCells& rhs) const override {\n+        auto lhs_vector = lhs.template typify<FloatType>();", "originalCommit": "b9e867c4a20e9aa340dbdb110066083ebcc2a619", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU4NjA1MA==", "url": "https://github.com/vespa-engine/vespa/pull/12135#discussion_r377586050", "bodyText": "You are right. It was (somehow) needed when this was done inside the templated HnswIndex class, but not here. Fixed.", "author": "geirst", "createdAt": "2020-02-11T11:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwMTYwMQ=="}], "type": "inlineReview"}, {"oid": "e3e77d310e0ca6363a6b4571ca55f85356db60af", "url": "https://github.com/vespa-engine/vespa/commit/e3e77d310e0ca6363a6b4571ca55f85356db60af", "message": "Remove unneeded \"template\" keyword.", "committedDate": "2020-02-11T11:43:54Z", "type": "commit"}]}