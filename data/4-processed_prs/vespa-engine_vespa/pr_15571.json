{"pr_number": 15571, "pr_title": "- Separate out the tail of the EventLoop into separate method to ease\u2026", "pr_createdAt": "2020-12-01T15:05:49Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15571", "timeline": [{"oid": "5b54a8f0613183596c8a8259c659e4a942b1304d", "url": "https://github.com/vespa-engine/vespa/commit/5b54a8f0613183596c8a8259c659e4a942b1304d", "message": "- Separate out the tail of the EventLoop into separate method to ease readability.\n- Also separate out timeout handling of old connections to separate method and unify on vespalib::time.", "committedDate": "2020-12-01T14:52:43Z", "type": "commit"}, {"oid": "3870d89984073b8ba0537943e690d38d7842a7cd", "url": "https://github.com/vespa-engine/vespa/commit/3870d89984073b8ba0537943e690d38d7842a7cd", "message": "Unify on steady_xxx", "committedDate": "2020-12-01T15:05:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNjQ5NQ==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534016495", "bodyText": "We no longer need OptimizeFor", "author": "havardpe", "createdAt": "2020-12-02T09:27:45Z", "path": "fnet/src/vespa/fnet/transport_thread.cpp", "diffHunk": "@@ -19,6 +19,7 @@ using vespalib::ServerSocket;\n using vespalib::SocketHandle;\n using vespalib::SocketSpec;\n using OptimizeFor = vespalib::Executor::OptimizeFor;", "originalCommit": "3870d89984073b8ba0537943e690d38d7842a7cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAyMjI4Ng==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534022286", "bodyText": "Fixed", "author": "baldersheim", "createdAt": "2020-12-02T09:36:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNjQ5NQ=="}], "type": "inlineReview"}, {"oid": "26bce0d7d92ccf74899e2992c596eeae8d01804c", "url": "https://github.com/vespa-engine/vespa/commit/26bce0d7d92ccf74899e2992c596eeae8d01804c", "message": "GC unused vespalib::Executor::OptimizeFor", "committedDate": "2020-12-02T09:35:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzMzkwNg==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534033906", "bodyText": "should not be public", "author": "havardpe", "createdAt": "2020-12-02T09:52:57Z", "path": "fnet/src/vespa/fnet/transport_thread.h", "diffHunk": "@@ -156,6 +154,9 @@ class FNET_TransportThread : public FastOS_Runnable\n      **/\n     bool InitEventLoop();\n \n+    void endEventLoop();", "originalCommit": "3870d89984073b8ba0537943e690d38d7842a7cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MjIwOQ==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534042209", "bodyText": "It is in the private: section so I think this is good.", "author": "baldersheim", "createdAt": "2020-12-02T10:04:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzMzkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0OTQyNg==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534049426", "bodyText": "my bad, I forgot we removed the single-threaded option a long time ago", "author": "havardpe", "createdAt": "2020-12-02T10:15:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzMzkwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzNDA0NA==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534034044", "bodyText": "should not be public", "author": "havardpe", "createdAt": "2020-12-02T09:53:08Z", "path": "fnet/src/vespa/fnet/transport_thread.h", "diffHunk": "@@ -156,6 +154,9 @@ class FNET_TransportThread : public FastOS_Runnable\n      **/\n     bool InitEventLoop();\n \n+    void endEventLoop();\n+    void checkTimedoutComponents(vespalib::duration timeout);", "originalCommit": "3870d89984073b8ba0537943e690d38d7842a7cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MjMyOA==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534042328", "bodyText": "It is in the private: section so I think this is good.", "author": "baldersheim", "createdAt": "2020-12-02T10:04:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzNDA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0OTYwOQ==", "url": "https://github.com/vespa-engine/vespa/pull/15571#discussion_r534049609", "bodyText": "my bad, I forgot we removed the single-threaded option a long time ago", "author": "havardpe", "createdAt": "2020-12-02T10:15:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzNDA0NA=="}], "type": "inlineReview"}]}