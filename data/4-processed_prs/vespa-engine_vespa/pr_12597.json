{"pr_number": 12597, "pr_title": "Act on the readable subset of applications when appropriate", "pr_createdAt": "2020-03-17T13:10:39Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12597", "timeline": [{"oid": "77f6a2fb86fc4368306d123626f120b179fc6f57", "url": "https://github.com/vespa-engine/vespa/commit/77f6a2fb86fc4368306d123626f120b179fc6f57", "message": "Remove unused ApplicationIdSource interface and related classes", "committedDate": "2020-03-17T14:02:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE5MzY3MA==", "url": "https://github.com/vespa-engine/vespa/pull/12597#discussion_r394193670", "bodyText": "Perhaps add a test with a deployment scenario, where one app is unreadable?", "author": "jonmv", "createdAt": "2020-03-18T09:03:12Z", "path": "controller-server/src/test/java/com/yahoo/vespa/hosted/controller/ControllerTest.java", "diffHunk": "@@ -939,4 +941,25 @@ public void testChangeEndpointCluster() {\n                                                        .rotations().get(0).clusterId());\n     }\n \n+    @Test\n+    public void testReadableApplications() {\n+        var db = new MockCuratorDb();\n+        var tester = new DeploymentTester(new ControllerTester(db));\n+\n+        // Create two applications\n+        tester.newDeploymentContext(\"t1\", \"a1\", \"default\");\n+        tester.newDeploymentContext(\"t2\", \"a2\", \"default\");\n+        assertEquals(2, tester.applications().readable().size());\n+\n+        // Write invalid data to one application\n+        db.curator().set(Path.fromString(\"/controller/v1/applications/t2:a2\"), new byte[]{(byte) 0xDE, (byte) 0xAD});\n+        assertEquals(1, tester.applications().readable().size());\n+\n+        try {\n+            tester.applications().asList();\n+            fail(\"Expected exception\");\n+        } catch (Exception ignored) {\n+        }\n+    }\n+", "originalCommit": "77f6a2fb86fc4368306d123626f120b179fc6f57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "95687a4eef69a4ebfc27c7391d1ec2152104fb66", "url": "https://github.com/vespa-engine/vespa/commit/95687a4eef69a4ebfc27c7391d1ec2152104fb66", "message": "Remove user tenant cleanup", "committedDate": "2020-03-18T13:14:55Z", "type": "commit"}, {"oid": "53ec9e367187cb208b95db1e4f4a1f33b9d1aac9", "url": "https://github.com/vespa-engine/vespa/commit/53ec9e367187cb208b95db1e4f4a1f33b9d1aac9", "message": "Act on the readable subset of applications when appropriate", "committedDate": "2020-03-18T13:14:55Z", "type": "commit"}, {"oid": "2451e73874428f2fa38701490f1b95e5add4fbeb", "url": "https://github.com/vespa-engine/vespa/commit/2451e73874428f2fa38701490f1b95e5add4fbeb", "message": "Remove unused ApplicationIdSource interface and related classes", "committedDate": "2020-03-18T13:14:55Z", "type": "commit"}, {"oid": "b37ede37fd837c2f7af12950ce78eb4dd2a5a9c2", "url": "https://github.com/vespa-engine/vespa/commit/b37ede37fd837c2f7af12950ce78eb4dd2a5a9c2", "message": "Refactor assignment of single rotation", "committedDate": "2020-03-18T13:34:02Z", "type": "commit"}, {"oid": "6dbdc482cb824c92184d44c59ac013382f67881f", "url": "https://github.com/vespa-engine/vespa/commit/6dbdc482cb824c92184d44c59ac013382f67881f", "message": "Test deployment while unreadable application exists", "committedDate": "2020-03-18T13:34:02Z", "type": "commit"}, {"oid": "6dbdc482cb824c92184d44c59ac013382f67881f", "url": "https://github.com/vespa-engine/vespa/commit/6dbdc482cb824c92184d44c59ac013382f67881f", "message": "Test deployment while unreadable application exists", "committedDate": "2020-03-18T13:34:02Z", "type": "forcePushed"}]}