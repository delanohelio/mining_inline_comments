{"pr_number": 14852, "pr_title": "Arnej/some eval additions", "pr_createdAt": "2020-10-14T11:07:03Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14852", "timeline": [{"oid": "4ebdf1d14cb14d386d8359f53be418bc5546860b", "url": "https://github.com/vespa-engine/vespa/commit/4ebdf1d14cb14d386d8359f53be418bc5546860b", "message": "add copy() method to EngineOrFactory, to replace Tensor::clone()", "committedDate": "2020-10-14T10:25:47Z", "type": "commit"}, {"oid": "725c352a20bae355e3424e4658fa56ddd9c053d9", "url": "https://github.com/vespa-engine/vespa/commit/725c352a20bae355e3424e4658fa56ddd9c053d9", "message": "remove DenseTensorView::cellsRef(), just use cells()", "committedDate": "2020-10-14T10:28:01Z", "type": "commit"}, {"oid": "28e6edf935fb6e602f904b567e32605638cabef6", "url": "https://github.com/vespa-engine/vespa/commit/28e6edf935fb6e602f904b567e32605638cabef6", "message": "add operator== and operator<< for testing only", "committedDate": "2020-10-14T10:29:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYyMTc0Mw==", "url": "https://github.com/vespa-engine/vespa/pull/14852#discussion_r504621743", "bodyText": "we should not use EngineOrFactory::get in the eval library.\nhere we should keep and open mind about implementation, everywhere else, we should use EngineOrFactory::get to select the implementation.\nThis would not be useful for unit tests, since comparing values created by the SimpleTensorEngine would result in problems, since DefaultTensorEngine is the default tensor implementation.", "author": "havardpe", "createdAt": "2020-10-14T12:04:55Z", "path": "eval/src/vespa/eval/eval/test/value_compare.cpp", "diffHunk": "@@ -0,0 +1,22 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"value_compare.h\"\n+#include <vespa/eval/eval/engine_or_factory.h>\n+\n+namespace vespalib::eval {\n+\n+bool operator==(const Value &lhs, const Value &rhs)\n+{\n+    auto engine = EngineOrFactory::get();", "originalCommit": "28e6edf935fb6e602f904b567e32605638cabef6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYyMjM0Nw==", "url": "https://github.com/vespa-engine/vespa/pull/14852#discussion_r504622347", "bodyText": "same as above", "author": "havardpe", "createdAt": "2020-10-14T12:05:59Z", "path": "eval/src/vespa/eval/eval/test/value_compare.cpp", "diffHunk": "@@ -0,0 +1,22 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"value_compare.h\"\n+#include <vespa/eval/eval/engine_or_factory.h>\n+\n+namespace vespalib::eval {\n+\n+bool operator==(const Value &lhs, const Value &rhs)\n+{\n+    auto engine = EngineOrFactory::get();\n+    return engine.to_spec(lhs) == engine.to_spec(rhs);\n+}\n+\n+std::ostream &operator<<(std::ostream &out, const Value &value)\n+{\n+    auto engine = EngineOrFactory::get();", "originalCommit": "28e6edf935fb6e602f904b567e32605638cabef6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "499edde41b9341b940401ae6169f2ad6926cd642", "url": "https://github.com/vespa-engine/vespa/commit/499edde41b9341b940401ae6169f2ad6926cd642", "message": "detect engine with dynamic_cast instead", "committedDate": "2020-10-14T12:25:08Z", "type": "commit"}, {"oid": "c45266c12f0a7b8c67a74f535e01057561505564", "url": "https://github.com/vespa-engine/vespa/commit/c45266c12f0a7b8c67a74f535e01057561505564", "message": "update TensorSpec::from_value and use that", "committedDate": "2020-10-14T12:34:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY2MTgzOA==", "url": "https://github.com/vespa-engine/vespa/pull/14852#discussion_r504661838", "bodyText": "I think return here is better for full forwarding", "author": "havardpe", "createdAt": "2020-10-14T13:08:06Z", "path": "eval/src/vespa/eval/eval/test/value_compare.cpp", "diffHunk": "@@ -0,0 +1,21 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"value_compare.h\"\n+#include <vespa/eval/eval/tensor.h>\n+#include <vespa/eval/eval/tensor_engine.h>\n+#include <vespa/eval/eval/value_codec.h>\n+\n+namespace vespalib::eval {\n+\n+bool operator==(const Value &lhs, const Value &rhs)\n+{\n+    return TensorSpec::from_value(lhs) == TensorSpec::from_value(rhs);\n+}\n+\n+std::ostream &operator<<(std::ostream &out, const Value &value)\n+{\n+    out << TensorSpec::from_value(value);", "originalCommit": "c45266c12f0a7b8c67a74f535e01057561505564", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY2MTk2Ng==", "url": "https://github.com/vespa-engine/vespa/pull/14852#discussion_r504661966", "bodyText": "tensor -> value", "author": "havardpe", "createdAt": "2020-10-14T13:08:15Z", "path": "eval/src/vespa/eval/eval/test/value_compare.h", "diffHunk": "@@ -0,0 +1,13 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include <vespa/eval/eval/value.h>\n+\n+namespace vespalib::eval {\n+\n+bool operator==(const Value &lhs, const Value &rhs);\n+std::ostream &operator<<(std::ostream &out, const Value &tensor);", "originalCommit": "c45266c12f0a7b8c67a74f535e01057561505564", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8956a4e0299342eea6660c098cafc8497d8ceae6", "url": "https://github.com/vespa-engine/vespa/commit/8956a4e0299342eea6660c098cafc8497d8ceae6", "message": "minor cosmetic fixes", "committedDate": "2020-10-14T13:11:43Z", "type": "commit"}, {"oid": "1f5a099c4b2f26d779501ed0b4758175e1a01457", "url": "https://github.com/vespa-engine/vespa/commit/1f5a099c4b2f26d779501ed0b4758175e1a01457", "message": "use cells() not cellsRef()", "committedDate": "2020-10-14T13:39:47Z", "type": "commit"}]}