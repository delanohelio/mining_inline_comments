{"pr_number": 13216, "pr_title": "Account and limit number of lids per file to reduce spkies during com\u2026", "pr_createdAt": "2020-05-11T17:59:46Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13216", "timeline": [{"oid": "98d7c8f1c1bd36200db961c0b848a820014ab61f", "url": "https://github.com/vespa-engine/vespa/commit/98d7c8f1c1bd36200db961c0b848a820014ab61f", "message": "Account and limit number of lids per file to reduce spkies during compaction.\nThis is to avoid ending up with a very long listof lids that are removed but not compacted away due to lidspace compaction being disabled when\nremoves and delets are too frequent.", "committedDate": "2020-05-11T17:49:38Z", "type": "commit"}, {"oid": "eb40abca82046351a2a62258645ab09305d08c74", "url": "https://github.com/vespa-engine/vespa/commit/eb40abca82046351a2a62258645ab09305d08c74", "message": "Depends on scheduling order so range must be extended.", "committedDate": "2020-05-11T21:14:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM3MTA2Ng==", "url": "https://github.com/vespa-engine/vespa/pull/13216#discussion_r424371066", "bodyText": "Consider using search::test::DirectoryHandler (searchlib/test/directory_handler.h) instead.", "author": "geirst", "createdAt": "2020-05-13T11:40:46Z", "path": "searchlib/src/tests/docstore/logdatastore/logdatastore_test.cpp", "diffHunk": "@@ -202,15 +202,24 @@ TEST(\"test that DirectIOPadding works accordng to spec\") {\n }\n #endif\n \n-TEST(\"testGrowing\") {\n-    FastOS_File::EmptyAndRemoveDirectory(\"growing\");\n-    EXPECT_TRUE(FastOS_File::MakeDirectory(\"growing\"));\n-    LogDataStore::Config config; //(100000, 0.1, 3.0, 0.2, 8, true, CompressionConfig::LZ4,\n-                                // WriteableFileChunk::Config(CompressionConfig(CompressionConfig::LZ4, 9, 60), 1000));\n-    config.setMaxFileSize(100000).setMaxDiskBloatFactor(0.1).setMaxBucketSpread(3.0).setMinFileSizeFactor(0.2)\n-            .compactCompression({CompressionConfig::LZ4})\n-            .setFileConfig({{CompressionConfig::LZ4, 9, 60}, 1000});\n-    vespalib::ThreadStackExecutor executor(8, 128*1024);\n+class TmpDirectory {", "originalCommit": "98d7c8f1c1bd36200db961c0b848a820014ab61f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQyMTIzNw==", "url": "https://github.com/vespa-engine/vespa/pull/13216#discussion_r424421237", "bodyText": "Done", "author": "baldersheim", "createdAt": "2020-05-13T13:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM3MTA2Ng=="}], "type": "inlineReview"}, {"oid": "53238ea2d254f35b5b0032c95c1eb3476d061318", "url": "https://github.com/vespa-engine/vespa/commit/53238ea2d254f35b5b0032c95c1eb3476d061318", "message": "Use DirectoryHandler to reduce code duplication.", "committedDate": "2020-05-13T12:57:01Z", "type": "commit"}]}