{"pr_number": 12845, "pr_title": "Add verbose property to print docId when set", "pr_createdAt": "2020-04-06T08:12:00Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12845", "timeline": [{"oid": "d220ba5608c848831d4304bbc229993020dd0063", "url": "https://github.com/vespa-engine/vespa/commit/d220ba5608c848831d4304bbc229993020dd0063", "message": "add print id when error", "committedDate": "2020-04-06T08:09:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNDQ5NA==", "url": "https://github.com/vespa-engine/vespa/pull/12845#discussion_r403914494", "bodyText": "This should probably not be a system out here. Use the warnlog function. But, isn't this information already in the line below as the entire tuple is output to warnlog? If so, I don't see the point of adding additional output here. If not, rather change the exception out below to explicitly add the docid. No configuration should be necessary for this.", "author": "lesters", "createdAt": "2020-04-06T08:29:05Z", "path": "vespa-hadoop/src/main/java/com/yahoo/vespa/hadoop/pig/VespaDocumentOperation.java", "diffHunk": "@@ -157,6 +160,12 @@ public String exec(Tuple tuple) throws IOException {\n             if (statusReporter != null) {\n                 statusReporter.incrCounter(\"Vespa Document Operation Counters\", \"Document operation failed\", 1);\n             }\n+            if (printIdOnError) {\n+                Schema inputSchema = getInputSchema();\n+                Map<String, Object> fields = TupleTools.tupleMap(inputSchema, tuple);\n+                String docId = TupleTools.toString(fields, template);\n+                System.out.println(\"Error occur when processing document with docID: \" +docId);", "originalCommit": "d220ba5608c848831d4304bbc229993020dd0063", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk2MTc0OA==", "url": "https://github.com/vespa-engine/vespa/pull/12845#discussion_r403961748", "bodyText": "Make sense. BTW, if we want to always print the docID out (System.out.println() will be at line 151, before the create function is called). Is it acceptable that we just print it out or should we make it a property just like in this PR? Thanks!", "author": "jingtinghuang", "createdAt": "2020-04-06T09:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNDQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2NTAzNA==", "url": "https://github.com/vespa-engine/vespa/pull/12845#discussion_r404465034", "bodyText": "@lesters", "author": "jingtinghuang", "createdAt": "2020-04-07T00:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNDQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU4MTMzOA==", "url": "https://github.com/vespa-engine/vespa/pull/12845#discussion_r404581338", "bodyText": "Well, we definitely shouldn't be stdout'ing the document id for each document by default, as grid feeds usually have quite a large number of documents. If you want such a feature, add a verbose or debug property, and if this property is set you can output it. Make sure this property is by default off.", "author": "lesters", "createdAt": "2020-04-07T07:06:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNDQ5NA=="}], "type": "inlineReview"}, {"oid": "1c0ae314ffc19ad9f7a1e7d2e08b14df329c16ca", "url": "https://github.com/vespa-engine/vespa/commit/1c0ae314ffc19ad9f7a1e7d2e08b14df329c16ca", "message": "add property verbose", "committedDate": "2020-04-08T02:54:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk4NjczNQ==", "url": "https://github.com/vespa-engine/vespa/pull/12845#discussion_r407986735", "bodyText": "To be consequent with other code here, move this to the section below for other properties that are retrieved, e.g. line 104ish. Also, make this a private final boolean, not a static. I guess, to be consequent, call this verbose so it can be used for other things as well. So, in sum, private final boolean verbose;.", "author": "lesters", "createdAt": "2020-04-14T09:14:53Z", "path": "vespa-hadoop/src/main/java/com/yahoo/vespa/hadoop/pig/VespaDocumentOperation.java", "diffHunk": "@@ -80,6 +81,7 @@ public static boolean valid(String text) {\n     private static final String PARTIAL_UPDATE_ASSIGN = \"assign\";\n     private static final String PARTIAL_UPDATE_ADD = \"add\";\n     private static final String PARTIAL_UPDATE_REMOVE = \"remove\";\n+    private static boolean printId;", "originalCommit": "1c0ae314ffc19ad9f7a1e7d2e08b14df329c16ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk4Njk2MQ==", "url": "https://github.com/vespa-engine/vespa/pull/12845#discussion_r407986961", "bodyText": "if (verbose) {", "author": "lesters", "createdAt": "2020-04-14T09:15:16Z", "path": "vespa-hadoop/src/main/java/com/yahoo/vespa/hadoop/pig/VespaDocumentOperation.java", "diffHunk": "@@ -145,6 +148,9 @@ public String exec(Tuple tuple) throws IOException {\n             Schema inputSchema = getInputSchema();\n             Map<String, Object> fields = TupleTools.tupleMap(inputSchema, tuple);\n             String docId = TupleTools.toString(fields, template);\n+            if (printId) {", "originalCommit": "1c0ae314ffc19ad9f7a1e7d2e08b14df329c16ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c0ae314ffc19ad9f7a1e7d2e08b14df329c16ca", "url": "https://github.com/vespa-engine/vespa/commit/1c0ae314ffc19ad9f7a1e7d2e08b14df329c16ca", "message": "add property verbose", "committedDate": "2020-04-08T02:54:23Z", "type": "forcePushed"}, {"oid": "4c99c5ef7854433cd7e4e74ecf877d907b5e3187", "url": "https://github.com/vespa-engine/vespa/commit/4c99c5ef7854433cd7e4e74ecf877d907b5e3187", "message": "change variable printId to verbose", "committedDate": "2020-04-16T08:07:10Z", "type": "commit"}]}