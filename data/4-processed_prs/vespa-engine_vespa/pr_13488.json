{"pr_number": 13488, "pr_title": "use vector of UP as MultiSearch::Children", "pr_createdAt": "2020-06-04T12:58:16Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13488", "timeline": [{"oid": "67134e619715227e6cbe91f365213487ff1b1f34", "url": "https://github.com/vespa-engine/vespa/commit/67134e619715227e6cbe91f365213487ff1b1f34", "message": "use vector of UP as MultiSearch::Children\n\n* add helper class for constructing MultiSearch::Children\n  (mostly for unit tests)\n* rewrite as needed to adapt", "committedDate": "2020-06-04T10:19:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgyNjQ5MQ==", "url": "https://github.com/vespa-engine/vespa/pull/13488#discussion_r435826491", "bodyText": "Should you not use std::make_unique instead ?", "author": "baldersheim", "createdAt": "2020-06-05T10:14:00Z", "path": "searchlib/src/vespa/searchlib/queryeval/sourceblendersearch.cpp", "diffHunk": "@@ -158,14 +158,14 @@ SourceBlenderSearch::setChild(size_t index, SearchIterator::UP child) {\n     _sources[_children[index]] = child.release();\n }\n \n-SourceBlenderSearch *\n+SearchIterator::UP\n SourceBlenderSearch::create(std::unique_ptr<sourceselector::Iterator> sourceSelector,\n                             const Children &children, bool strict)\n {\n     if (strict) {\n-        return new SourceBlenderSearchStrict(std::move(sourceSelector), children);\n+        return SearchIterator::UP(new SourceBlenderSearchStrict(std::move(sourceSelector), children));", "originalCommit": "67134e619715227e6cbe91f365213487ff1b1f34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkxOTMwOA==", "url": "https://github.com/vespa-engine/vespa/pull/13488#discussion_r435919308", "bodyText": "I wanted to handle Strict and non-Strict the same way, and the other constructor wasn't public; will adjust with a NonStrict variant and use make_unique.", "author": "arnej27959", "createdAt": "2020-06-05T13:26:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgyNjQ5MQ=="}], "type": "inlineReview"}, {"oid": "10044079375f308895ab8848a7b3d2d4a38f1441", "url": "https://github.com/vespa-engine/vespa/commit/10044079375f308895ab8848a7b3d2d4a38f1441", "message": "add TODOs about further use of unique_ptr", "committedDate": "2020-06-05T12:32:25Z", "type": "commit"}, {"oid": "fbc19529236528b262d80a068b456bf02e878e89", "url": "https://github.com/vespa-engine/vespa/commit/fbc19529236528b262d80a068b456bf02e878e89", "message": "adjust to use std::make_unique", "committedDate": "2020-06-05T13:11:23Z", "type": "commit"}]}