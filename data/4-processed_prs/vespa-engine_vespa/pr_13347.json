{"pr_number": 13347, "pr_title": "Factor out portions of field match computer to field match computer shared state.", "pr_createdAt": "2020-05-22T12:59:49Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13347", "timeline": [{"oid": "a7adf86dcd43d949ed99b2a8881e0739a4c8ae08", "url": "https://github.com/vespa-engine/vespa/commit/a7adf86dcd43d949ed99b2a8881e0739a4c8ae08", "message": "Factor out portions of field match computer to field match computer shared state.", "committedDate": "2020-05-22T12:54:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc2OTk2MA==", "url": "https://github.com/vespa-engine/vespa/pull/13347#discussion_r429769960", "bodyText": "Any reason why you copy the fields in the shared state, and not use it where they are ?", "author": "baldersheim", "createdAt": "2020-05-25T07:18:43Z", "path": "searchlib/src/vespa/searchlib/features/fieldmatch/computer.cpp", "diffHunk": "@@ -15,55 +17,24 @@ using namespace search::fef;\n \n namespace search::features::fieldmatch {\n \n-Computer::Computer(const vespalib::string &propertyNamespace, const PhraseSplitter &splitter,\n-                   const FieldInfo &fieldInfo, const Params &params) :\n-    _splitter(splitter),\n-    _fieldId(fieldInfo.id()),\n-    _params(params),\n-    _useCachedHits(true),\n-    _queryTerms(),\n-    _queryTermFieldMatch(),\n-    _totalTermWeight(0),\n-    _totalTermSignificance(0.0f),\n-    _fieldLength(FieldPositionsIterator::UNKNOWN_LENGTH),\n-    _currentMetrics(this),\n-    _finalMetrics(this),\n-    _simpleMetrics(params),\n-    _segments(),\n-    _alternativeSegmentationsTried(0),\n-    _cachedHits()\n+Computer::Computer(const ComputerSharedState& shared_state, const PhraseSplitter& splitter)\n+    : _shared_state(shared_state),\n+      _splitter(splitter),\n+      _fieldId(_shared_state.get_field_id()),", "originalCommit": "a7adf86dcd43d949ed99b2a8881e0739a4c8ae08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgzMTU0Mw==", "url": "https://github.com/vespa-engine/vespa/pull/13347#discussion_r429831543", "bodyText": "To keep the data localized while also minimizing the size of the PR diff.", "author": "toregge", "createdAt": "2020-05-25T09:24:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc2OTk2MA=="}], "type": "inlineReview"}]}