{"pr_number": 12248, "pr_title": "fail faster and record when missing endpoint cert", "pr_createdAt": "2020-02-18T13:56:33Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12248", "timeline": [{"oid": "19a6d9e3819c0c18dca6c8b776d83f7171665f28", "url": "https://github.com/vespa-engine/vespa/commit/19a6d9e3819c0c18dca6c8b776d83f7171665f28", "message": "fail faster and record when missing endpoint cert", "committedDate": "2020-02-18T13:55:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcwNzI2MQ==", "url": "https://github.com/vespa-engine/vespa/pull/12248#discussion_r380707261", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    return Optional.of(RunStatus.endpointCertificateTimeout);\n          \n          \n            \n                                    return Optional.of(endpointCertificateTimeout);", "author": "jonmv", "createdAt": "2020-02-18T14:31:26Z", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java", "diffHunk": "@@ -273,9 +275,14 @@ public InternalStepRunner(Controller controller) {\n             Optional<RunStatus> result = startTime.isBefore(controller.clock().instant().minus(Duration.ofHours(1)))\n                                          ? Optional.of(deploymentFailed) : Optional.empty();\n             switch (e.getErrorCode()) {\n+                case CERTIFICATE_NOT_READY:\n+                    if (startTime.plus(endpointCertificateTimeout).isBefore(controller.clock().instant())) {\n+                        logger.log(\"Deployment failed to find provisioned endpoint certificate after \" + endpointCertificateTimeout);\n+                        return Optional.of(RunStatus.endpointCertificateTimeout);", "originalCommit": "19a6d9e3819c0c18dca6c8b776d83f7171665f28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcwNzQ0Mg==", "url": "https://github.com/vespa-engine/vespa/pull/12248#discussion_r380707442", "bodyText": "You statically imported it already :)", "author": "jonmv", "createdAt": "2020-02-18T14:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcwNzI2MQ=="}], "type": "inlineReview"}, {"oid": "19a6d9e3819c0c18dca6c8b776d83f7171665f28", "url": "https://github.com/vespa-engine/vespa/commit/19a6d9e3819c0c18dca6c8b776d83f7171665f28", "message": "fail faster and record when missing endpoint cert", "committedDate": "2020-02-18T13:55:59Z", "type": "forcePushed"}]}