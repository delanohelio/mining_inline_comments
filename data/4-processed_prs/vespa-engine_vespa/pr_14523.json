{"pr_number": 14523, "pr_title": "Cache node objects", "pr_createdAt": "2020-09-24T11:21:41Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14523", "timeline": [{"oid": "985e7c38cd848c5f4f3adcdc454bbe62ba817323", "url": "https://github.com/vespa-engine/vespa/commit/985e7c38cd848c5f4f3adcdc454bbe62ba817323", "message": "Add node object cache", "committedDate": "2020-09-24T10:44:33Z", "type": "commit"}, {"oid": "87063d6525aace2042378d94bc1616a35c69f761", "url": "https://github.com/vespa-engine/vespa/commit/87063d6525aace2042378d94bc1616a35c69f761", "message": "Report node object cache metrics", "committedDate": "2020-09-24T10:58:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1MjM1Nw==", "url": "https://github.com/vespa-engine/vespa/pull/14523#discussion_r494252357", "bodyText": "I guess the size should be configurable.", "author": "baldersheim", "createdAt": "2020-09-24T11:51:49Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/persistence/NodeSerializer.java", "diffHunk": "@@ -107,6 +113,12 @@\n     // Network port fields\n     private static final String networkPortsKey = \"networkPorts\";\n \n+    // A cache of deserialized Node objects. The cache is keyed on the hash of serialized node data.\n+    //\n+    // Deserializing a Node from slime is expensive, and happens frequently. Node instances that have already been\n+    // deserialized are returned from this cache instead of being deserialized again.\n+    private final Cache<Long, Node> cache = CacheBuilder.newBuilder().maximumSize(1000).build();", "originalCommit": "87063d6525aace2042378d94bc1616a35c69f761", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "00b8a48ebdecacec264b3a457557ca723ec88a21", "url": "https://github.com/vespa-engine/vespa/commit/00b8a48ebdecacec264b3a457557ca723ec88a21", "message": "Add flag for adjusting cache size", "committedDate": "2020-09-24T12:11:30Z", "type": "commit"}]}