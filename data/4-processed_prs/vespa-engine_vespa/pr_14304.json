{"pr_number": 14304, "pr_title": "Balder/group commits to tls 2 remaining rebased", "pr_createdAt": "2020-09-07T06:06:09Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14304", "timeline": [{"oid": "76ec6e75656dd944ea61de46dbfd5d1173f3bb81", "url": "https://github.com/vespa-engine/vespa/commit/76ec6e75656dd944ea61de46dbfd5d1173f3bb81", "message": "Group commits to TLS and sync (resurrected).", "committedDate": "2020-09-06T11:13:09Z", "type": "commit"}, {"oid": "e63ea578a31339bd8cf3a473fdda288be9c01725", "url": "https://github.com/vespa-engine/vespa/commit/e63ea578a31339bd8cf3a473fdda288be9c01725", "message": "Also consider doing compression.", "committedDate": "2020-09-06T11:13:10Z", "type": "commit"}, {"oid": "50af9d8d0119b42dc71ff57e271a9b5a3711d2f1", "url": "https://github.com/vespa-engine/vespa/commit/50af9d8d0119b42dc71ff57e271a9b5a3711d2f1", "message": "Follow fsync config.", "committedDate": "2020-09-06T11:13:10Z", "type": "commit"}, {"oid": "4023193782d0364ecc3dcca7ecd7daceca2a4c87", "url": "https://github.com/vespa-engine/vespa/commit/4023193782d0364ecc3dcca7ecd7daceca2a4c87", "message": "Avoid negation", "committedDate": "2020-09-06T11:13:10Z", "type": "commit"}, {"oid": "f6efaa2a9b9d71912372fec609d7496ca1e072fa", "url": "https://github.com/vespa-engine/vespa/commit/f6efaa2a9b9d71912372fec609d7496ca1e072fa", "message": "Use NONE as default for now", "committedDate": "2020-09-06T11:13:10Z", "type": "commit"}, {"oid": "f84faaddbcbbcf78156a07ff614e8d8a6f390083", "url": "https://github.com/vespa-engine/vespa/commit/f84faaddbcbbcf78156a07ff614e8d8a6f390083", "message": "Update expected error message.", "committedDate": "2020-09-06T11:13:10Z", "type": "commit"}, {"oid": "eb69db8a095ae681cbfe23a7c2978b5af5b77be3", "url": "https://github.com/vespa-engine/vespa/commit/eb69db8a095ae681cbfe23a7c2978b5af5b77be3", "message": "Use the scheduler to regulary commit operations to the TLS.", "committedDate": "2020-09-07T06:02:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1MzY5NA==", "url": "https://github.com/vespa-engine/vespa/pull/14304#discussion_r484353694", "bodyText": "This looks like a memory leak. You'll need to remember the task, and call Kill() as part of teardown.", "author": "toregge", "createdAt": "2020-09-07T10:48:33Z", "path": "searchlib/src/vespa/searchlib/transactionlog/translogserver.cpp", "diffHunk": "@@ -144,6 +167,9 @@ TransLogServer::TransLogServer(const vespalib::string &name, int listenPort, con\n         throw std::runtime_error(make_string(\"Failed creating tls base dir %s r(%d), e(%d). Requires manual intervention.\", _baseDir.c_str(), retval, errno));\n     }\n     start(*_threadPool);\n+    double chunkAgeLimit = vespalib::to_s(_domainConfig.getChunkAgeLimit());\n+    auto staleCommitTask = new StaleCommitTask(_supervisor->GetScheduler(), *this, chunkAgeLimit);\n+    staleCommitTask->ScheduleNow();", "originalCommit": "eb69db8a095ae681cbfe23a7c2978b5af5b77be3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQxODA3OQ==", "url": "https://github.com/vespa-engine/vespa/pull/14304#discussion_r484418079", "bodyText": "Plugged", "author": "baldersheim", "createdAt": "2020-09-07T12:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1MzY5NA=="}], "type": "inlineReview"}, {"oid": "99d3974f8dbb95c797d32dcaf39b718cde49a6c1", "url": "https://github.com/vespa-engine/vespa/commit/99d3974f8dbb95c797d32dcaf39b718cde49a6c1", "message": "Properly clean up stale commit task. Also reduce visibility of code.", "committedDate": "2020-09-07T12:45:02Z", "type": "commit"}]}