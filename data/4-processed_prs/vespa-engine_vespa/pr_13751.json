{"pr_number": 13751, "pr_title": "Add filter iterators for weak and blueprints.", "pr_createdAt": "2020-06-30T10:01:45Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13751", "timeline": [{"oid": "5852621e03b26d9e10d10a5d94e6d9a55f0e6d53", "url": "https://github.com/vespa-engine/vespa/commit/5852621e03b26d9e10d10a5d94e6d9a55f0e6d53", "message": "Add filter iterators for weak and blueprints.", "committedDate": "2020-06-30T09:57:53Z", "type": "commit"}, {"oid": "45a49659d89d66cbf4fe92c323f446a2160673b8", "url": "https://github.com/vespa-engine/vespa/commit/45a49659d89d66cbf4fe92c323f446a2160673b8", "message": "Add filter iterator for weak and blueprint.", "committedDate": "2020-06-30T11:17:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1NTE1OQ==", "url": "https://github.com/vespa-engine/vespa/pull/13751#discussion_r447655159", "bodyText": "when constraint is LOWER_BOUND, all WeakAnd variants must create filter as if it's AND.", "author": "arnej27959", "createdAt": "2020-06-30T12:48:23Z", "path": "searchlib/src/vespa/searchlib/attribute/attribute_blueprint_factory.cpp", "diffHunk": "@@ -416,9 +416,21 @@ class DirectWandBlueprint : public queryeval::ComplexLeafBlueprint\n                         .setDocIdLimit(get_docid_limit()),\n                 _weights, _terms, _attr, strict);\n     }\n+    std::unique_ptr<SearchIterator> createFilterSearch(bool strict, FilterConstraint constraint) const override;\n     bool always_needs_unpack() const override { return true; }\n };\n \n+std::unique_ptr<SearchIterator>\n+DirectWandBlueprint::createFilterSearch(bool, FilterConstraint) const\n+{\n+    std::vector<DocumentWeightIterator> iterators;\n+    iterators.reserve(_terms.size());\n+    for (const IDocumentWeightAttribute::LookupResult &r : _terms) {\n+        _attr.create(r.posting_idx, iterators);\n+    }\n+    return attribute::DocumentWeightOrFilterSearch::create(std::move(iterators));", "originalCommit": "45a49659d89d66cbf4fe92c323f446a2160673b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY4NzI4NA==", "url": "https://github.com/vespa-engine/vespa/pull/13751#discussion_r447687284", "bodyText": "I'll change it to use EmptySearch for LOWER_BOUND.", "author": "toregge", "createdAt": "2020-06-30T13:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1NTE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwMDY2OQ==", "url": "https://github.com/vespa-engine/vespa/pull/13751#discussion_r447700669", "bodyText": "Fixed.", "author": "toregge", "createdAt": "2020-06-30T13:53:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1NTE1OQ=="}], "type": "inlineReview"}, {"oid": "c88dfb03753ea4292a163e249f386ed7e17e2e56", "url": "https://github.com/vespa-engine/vespa/commit/c88dfb03753ea4292a163e249f386ed7e17e2e56", "message": "Use empty search when filter constraint is lower bound for wand variants.", "committedDate": "2020-06-30T13:50:17Z", "type": "commit"}]}