{"pr_number": 15843, "pr_title": "Add some smartness to what to build in PR's.", "pr_createdAt": "2020-12-17T21:47:34Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15843", "timeline": [{"oid": "0f145a8c9fce39fa862b0eb2b568ba2a1fa84216", "url": "https://github.com/vespa-engine/vespa/commit/0f145a8c9fce39fa862b0eb2b568ba2a1fa84216", "message": "Add some smartness to what to build in PR's.", "committedDate": "2020-12-17T21:47:16Z", "type": "commit"}, {"oid": "e05249a2380721ed4c491b386c5da4ae0f92e97b", "url": "https://github.com/vespa-engine/vespa/commit/e05249a2380721ed4c491b386c5da4ae0f92e97b", "message": "Only set -e", "committedDate": "2020-12-18T07:34:52Z", "type": "commit"}, {"oid": "a121c888ea4b606f855890ebda936987a3e2a81f", "url": "https://github.com/vespa-engine/vespa/commit/a121c888ea4b606f855890ebda936987a3e2a81f", "message": "Print something if the detection failed.", "committedDate": "2020-12-18T08:21:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3NTA0Ng==", "url": "https://github.com/vespa-engine/vespa/pull/15843#discussion_r545775046", "bodyText": "Shouldn't this be bootstrap.sh full?", "author": "hmusum", "createdAt": "2020-12-18T11:35:09Z", "path": "travis/travis-build.sh", "diffHunk": "@@ -0,0 +1,49 @@\n+#!/bin/bash\n+# Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+set -e\n+\n+export SOURCE_DIR=/source\n+export NUM_THREADS=6\n+export MALLOC_ARENA_MAX=1\n+export MAVEN_OPTS=\"-Xss1m -Xms128m -Xmx2g\"\n+source /etc/profile.d/enable-devtoolset-9.sh\n+source /etc/profile.d/enable-rh-maven35.sh\n+\n+ccache --max-size=1600M\n+ccache --set-config=compression=true\n+ccache -p\n+\n+if ! source /source/travis/detect-what-to-build.sh; then\n+    echo \"Could not detect what to build.\"\n+    SHOULD_BUILD=all\n+fi\n+\n+echo \"Building: $SHOULD_BUILD\"\n+\n+cd ${SOURCE_DIR}\n+\n+case $SHOULD_BUILD in\n+  cpp)\n+    env VESPA_MAVEN_EXTRA_OPTS=\"--no-snapshot-updates --batch-mode --threads ${NUM_THREADS}\" sh ./bootstrap.sh full\n+    cmake3 -DVESPA_UNPRIVILEGED=no .\n+    make -j ${NUM_THREADS}\n+    ctest3 --output-on-failure -j ${NUM_THREADS}\n+    ccache --show-stats\n+    ;;\n+  java)\n+    env VESPA_MAVEN_EXTRA_OPTS=\"--no-snapshot-updates --batch-mode --threads ${NUM_THREADS}\" sh ./bootstrap.sh java\n+    mvn -V install --no-snapshot-updates --batch-mode --threads ${NUM_THREADS}\n+    ;;\n+  *)\n+    env VESPA_MAVEN_EXTRA_OPTS=\"--no-snapshot-updates --batch-mode --threads ${NUM_THREADS}\" sh ./bootstrap.sh java", "originalCommit": "a121c888ea4b606f855890ebda936987a3e2a81f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3ODk1OA==", "url": "https://github.com/vespa-engine/vespa/pull/15843#discussion_r545778958", "bodyText": "When we build all, all the java artifacts will be built with Maven.  Using full here will work but the modules will be recompiled (waste) on the next line. The *) does exactly what we did for all PRs earlier.", "author": "aressem", "createdAt": "2020-12-18T11:43:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3NTA0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc4MTcwOA==", "url": "https://github.com/vespa-engine/vespa/pull/15843#discussion_r545781708", "bodyText": "Great!", "author": "hmusum", "createdAt": "2020-12-18T11:49:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3NTA0Ng=="}], "type": "inlineReview"}]}