{"pr_number": 13766, "pr_title": "Skip dispatching on reply in FileStorManager", "pr_createdAt": "2020-07-01T11:29:08Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13766", "timeline": [{"oid": "9d8138fd907efeeb7a98305cd5068e82c23e53db", "url": "https://github.com/vespa-engine/vespa/commit/9d8138fd907efeeb7a98305cd5068e82c23e53db", "message": "Skip dispatching on reply in FileStorManager", "committedDate": "2020-07-01T11:27:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjk1NQ==", "url": "https://github.com/vespa-engine/vespa/pull/13766#discussion_r448316955", "bodyText": "The comment above this call implies that not dispatching could cause a deadlock. Has the threading/locking been changed sufficiently that this no longer is a problem? If so, the comment should be removed. If not, some more pondering might be needed.", "author": "vekterli", "createdAt": "2020-07-01T12:06:07Z", "path": "storage/src/vespa/storage/persistence/filestorage/filestormanager.cpp", "diffHunk": "@@ -765,13 +765,13 @@ FileStorManager::sendReply(const std::shared_ptr<api::StorageReply>& reply)\n     // Currently we need to dispatch due to replies sent by remapQueue\n     // function in handlerimpl, as filestorthread keeps bucket db lock\n     // while running this function\n-    dispatchUp(reply);\n+    sendUp(reply);", "originalCommit": "9d8138fd907efeeb7a98305cd5068e82c23e53db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjU3OQ==", "url": "https://github.com/vespa-engine/vespa/pull/13766#discussion_r448382579", "bodyText": "You are right. Reverting and just doing GC of members.", "author": "baldersheim", "createdAt": "2020-07-01T13:58:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjk1NQ=="}], "type": "inlineReview"}, {"oid": "37970688ca08a4dd712e41bc8d239fab2b6a9b86", "url": "https://github.com/vespa-engine/vespa/commit/37970688ca08a4dd712e41bc8d239fab2b6a9b86", "message": "Need this dispatching still to avoid deadlocks.", "committedDate": "2020-07-01T13:47:35Z", "type": "commit"}]}