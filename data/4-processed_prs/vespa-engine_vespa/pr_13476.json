{"pr_number": 13476, "pr_title": "Bjorncs/container thread pool", "pr_createdAt": "2020-06-03T15:12:37Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13476", "timeline": [{"oid": "a9a3cadedbf5c5270fcf8541eb37e8ef69ea57f0", "url": "https://github.com/vespa-engine/vespa/commit/a9a3cadedbf5c5270fcf8541eb37e8ef69ea57f0", "message": "Add config for thread pool name", "committedDate": "2020-06-03T15:10:39Z", "type": "commit"}, {"oid": "b2b874ebabfcecffbfeece5623048d9dca597e65", "url": "https://github.com/vespa-engine/vespa/commit/b2b874ebabfcecffbfeece5623048d9dca597e65", "message": "Add config for core pool size", "committedDate": "2020-06-03T15:10:39Z", "type": "commit"}, {"oid": "3166f8a263d9a64773a4edf2aa31f0229b5c8568", "url": "https://github.com/vespa-engine/vespa/commit/3166f8a263d9a64773a4edf2aa31f0229b5c8568", "message": "Add config for keep alive time", "committedDate": "2020-06-03T15:10:39Z", "type": "commit"}, {"oid": "eb07ffe8bd6cd9bce0db51f78826d88adb968a07", "url": "https://github.com/vespa-engine/vespa/commit/eb07ffe8bd6cd9bce0db51f78826d88adb968a07", "message": "Add thread pool name as dimension to metric values", "committedDate": "2020-06-03T15:10:39Z", "type": "commit"}, {"oid": "54c7d6419ed0702f4f6d23211a88051393551664", "url": "https://github.com/vespa-engine/vespa/commit/54c7d6419ed0702f4f6d23211a88051393551664", "message": "Update ABI spec for ThreadpoolConfig", "committedDate": "2020-06-03T15:10:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMjMwNg==", "url": "https://github.com/vespa-engine/vespa/pull/13476#discussion_r434722306", "bodyText": "missing EOL", "author": "baldersheim", "createdAt": "2020-06-03T17:05:03Z", "path": "container-core/src/main/resources/configdefinitions/threadpool.def", "diffHunk": "@@ -16,3 +22,6 @@ queueSize int default=0\n # get out of a bad state. This should be set a bit higher than the expected max execution\n # time of each request when in a state of overload, i.e about \"worst case execution time*2\"\n maxThreadExecutionTimeSeconds int default=190\n+\n+# Prefix for the name of the threads\n+name string default=\"default-pool\"", "originalCommit": "54c7d6419ed0702f4f6d23211a88051393551664", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMjk4Nw==", "url": "https://github.com/vespa-engine/vespa/pull/13476#discussion_r434722987", "bodyText": "I think the default should be more agressive. I was thinking 5s.", "author": "baldersheim", "createdAt": "2020-06-03T17:06:14Z", "path": "container-core/src/main/resources/configdefinitions/threadpool.def", "diffHunk": "@@ -2,10 +2,16 @@\n \n namespace=container.handler\n \n-## Num ber of thread in the thread pool\n+## Maximum number of thread in the thread pool\n ## Setting it to 0 or negative number will cause it to be set to #cores * 4\n maxthreads int default=500\n \n+# The number of threads to keep in the pool, even if they are idle\n+corePoolSize int default=500\n+\n+# The number of seconds that excess idle threads will wait for new tasks before terminating\n+keepAliveTime double default=60.0", "originalCommit": "54c7d6419ed0702f4f6d23211a88051393551664", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "60feaaa998976c427570bea1f9138472249a4ffd", "url": "https://github.com/vespa-engine/vespa/commit/60feaaa998976c427570bea1f9138472249a4ffd", "message": "Fix noeol and set default idletime to 5s", "committedDate": "2020-06-03T20:07:40Z", "type": "commit"}, {"oid": "68409466b1b5df8175a9aa6757c59c4a5aa3c965", "url": "https://github.com/vespa-engine/vespa/commit/68409466b1b5df8175a9aa6757c59c4a5aa3c965", "message": "Annotate primary constructor with @Inject.", "committedDate": "2020-06-03T20:15:35Z", "type": "commit"}]}