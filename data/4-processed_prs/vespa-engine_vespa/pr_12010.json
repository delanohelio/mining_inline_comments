{"pr_number": 12010, "pr_title": "Do not hold the lock when visiting documents inflight.", "pr_createdAt": "2020-01-30T13:38:22Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12010", "timeline": [{"oid": "a0aafd375b7f20404a08ad32a4a58f73b75a3165", "url": "https://github.com/vespa-engine/vespa/commit/a0aafd375b7f20404a08ad32a4a58f73b75a3165", "message": "Do not hold the lock when visiting documents inflight.", "committedDate": "2020-01-30T13:37:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk2NzcxNA==", "url": "https://github.com/vespa-engine/vespa/pull/12010#discussion_r372967714", "bodyText": "Should we consider using Alloc here in case of some crazy big documents?", "author": "vekterli", "createdAt": "2020-01-30T14:08:00Z", "path": "searchlib/src/vespa/searchlib/docstore/writeablefilechunk.cpp", "diffHunk": "@@ -225,12 +233,18 @@ WriteableFileChunk::read(LidInfoWithLidV::const_iterator begin, size_t count, IB\n                         assert(chunk == _active->getId());\n                         buffer = _active->getLid(li.getLid());\n                     }\n-                    visitor.visit(li.getLid(), buffer);\n+                    auto copy = std::make_unique<char[]>(buffer.size());", "originalCommit": "a0aafd375b7f20404a08ad32a4a58f73b75a3165", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk3NjcyNw==", "url": "https://github.com/vespa-engine/vespa/pull/12010#discussion_r372976727", "bodyText": "Good point, fixed.", "author": "baldersheim", "createdAt": "2020-01-30T14:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk2NzcxNA=="}], "type": "inlineReview"}, {"oid": "959a019461a8bc4494813982195af9b558c724f9", "url": "https://github.com/vespa-engine/vespa/commit/959a019461a8bc4494813982195af9b558c724f9", "message": "Use vespalib::alloc::Allo instead. Will handle large documents smoother.", "committedDate": "2020-01-30T14:21:32Z", "type": "commit"}]}