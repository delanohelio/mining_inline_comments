{"pr_number": 14121, "pr_title": "Move exception handling to where we can give proper feedback to the u\u2026", "pr_createdAt": "2020-08-20T22:40:27Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14121", "timeline": [{"oid": "6c6203e47bcca5309f0865c7e6c02855c6224a1c", "url": "https://github.com/vespa-engine/vespa/commit/6c6203e47bcca5309f0865c7e6c02855c6224a1c", "message": "Move exception handling to where we can give proper feedback to the user.", "committedDate": "2020-08-20T22:27:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMTk4NA==", "url": "https://github.com/vespa-engine/vespa/pull/14121#discussion_r474501984", "bodyText": "consider start using the vespalib::make_string_short::fmt function", "author": "havardpe", "createdAt": "2020-08-21T08:08:11Z", "path": "storage/src/vespa/storage/persistence/persistencethread.cpp", "diffHunk": "@@ -8,13 +8,16 @@\n #include <vespa/storage/common/bucketoperationlogger.h>\n #include <vespa/document/fieldset/fieldsetrepo.h>\n #include <vespa/document/update/documentupdate.h>\n+#include <vespa/document/base/exceptions.h>\n #include <vespa/vespalib/util/exceptions.h>\n #include <vespa/vespalib/util/isequencedtaskexecutor.h>\n #include <vespa/vespalib/stllike/hash_map.hpp>\n \n #include <vespa/log/log.h>\n LOG_SETUP(\".persistence.thread\");\n \n+using vespalib::make_string;", "originalCommit": "6c6203e47bcca5309f0865c7e6c02855c6224a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU4OTc3MQ==", "url": "https://github.com/vespa-engine/vespa/pull/14121#discussion_r474589771", "bodyText": "Done", "author": "baldersheim", "createdAt": "2020-08-21T09:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMTk4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMzI2OQ==", "url": "https://github.com/vespa-engine/vespa/pull/14121#discussion_r474503269", "bodyText": "this sounds like the field is not found in the field set, when the field is already in the field set, but not found in the document.", "author": "havardpe", "createdAt": "2020-08-21T08:09:42Z", "path": "storage/src/vespa/storage/persistence/persistencethread.cpp", "diffHunk": "@@ -277,6 +280,22 @@ spi::ReadConsistency api_read_consistency_to_spi(api::InternalReadConsistency co\n     }\n }\n \n+document::FieldSet::SP\n+getFieldSet(const document::FieldSetRepo & repo, vespalib::stringref name, MessageTracker & tracker) {\n+    try {\n+        return repo.getFieldSet(name);\n+    } catch (document::FieldNotFoundException & e) {\n+        tracker.fail(storage::api::ReturnCode::ILLEGAL_PARAMETERS,\n+                     make_string(\"Field %s not found in fieldset %s\",", "originalCommit": "6c6203e47bcca5309f0865c7e6c02855c6224a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU4OTkzNw==", "url": "https://github.com/vespa-engine/vespa/pull/14121#discussion_r474589937", "bodyText": "Fixed", "author": "baldersheim", "createdAt": "2020-08-21T09:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMzI2OQ=="}], "type": "inlineReview"}, {"oid": "8aa115bbd4ce57d0391c21f4ed1854e78b86cf7e", "url": "https://github.com/vespa-engine/vespa/commit/8aa115bbd4ce57d0391c21f4ed1854e78b86cf7e", "message": "Improve error message, and use 'using' to simplify code.", "committedDate": "2020-08-21T09:44:32Z", "type": "commit"}]}