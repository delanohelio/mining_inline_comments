{"pr_number": 11986, "pr_title": "Geirst/fix search for false in imported bool attributes", "pr_createdAt": "2020-01-28T16:10:39Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/11986", "timeline": [{"oid": "d47dc1ca38ff5c0611923acfbac8d50ae5ea7807", "url": "https://github.com/vespa-engine/vespa/commit/d47dc1ca38ff5c0611923acfbac8d50ae5ea7807", "message": "Rename searchcontext.cpp -> searchcontext_test.cpp", "committedDate": "2020-01-28T11:30:28Z", "type": "commit"}, {"oid": "671b81cb952aa19704e9c50d93f083066c528810", "url": "https://github.com/vespa-engine/vespa/commit/671b81cb952aa19704e9c50d93f083066c528810", "message": "Correctly handle search for \"false\" in the underlying search context of singleboolattribute.\n\nThis code path is used when searching on an imported bool attribute (from a parent document),\ncombined with other query terms (e.g. under an AND) such that the search iterator for the imported bool attributes is not strict.\nIn this case the underlying search context is used, and search for \"false\" would previously return all \"true\" documents instead.", "committedDate": "2020-01-28T15:55:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkzODUwOA==", "url": "https://github.com/vespa-engine/vespa/pull/11986#discussion_r371938508", "bodyText": "More readable with (_invert != _bv.testBit(docId)) ?", "author": "baldersheim", "createdAt": "2020-01-28T17:10:22Z", "path": "searchlib/src/vespa/searchlib/attribute/singleboolattribute.cpp", "diffHunk": "@@ -104,7 +104,7 @@ class BitVectorSearchContext : public AttributeVector::SearchContext, public att\n     bool _valid;\n     bool valid() const override { return _valid; }\n     int32_t onFind(DocId docId, int32_t elemId, int32_t & weight) const override final {\n-        if ((elemId == 0) && _bv.testBit(docId)) {\n+        if ((elemId == 0) && (!_invert == _bv.testBit(docId))) {", "originalCommit": "671b81cb952aa19704e9c50d93f083066c528810", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkzODcyNQ==", "url": "https://github.com/vespa-engine/vespa/pull/11986#discussion_r371938725", "bodyText": "More readable with (_invert != _bv.testBit(docId)) ?", "author": "baldersheim", "createdAt": "2020-01-28T17:10:44Z", "path": "searchlib/src/vespa/searchlib/attribute/singleboolattribute.cpp", "diffHunk": "@@ -113,7 +113,7 @@ class BitVectorSearchContext : public AttributeVector::SearchContext, public att\n     }\n \n     int32_t onFind(DocId docId, int32_t elemId) const override final {\n-        return ((elemId == 0) && _bv.testBit(docId)) ? 0 : -1;\n+        return ((elemId == 0) && (!_invert == _bv.testBit(docId))) ? 0 : -1;", "originalCommit": "671b81cb952aa19704e9c50d93f083066c528810", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a64bc2a8c0dc48e36209599a170356a6b18440b6", "url": "https://github.com/vespa-engine/vespa/commit/a64bc2a8c0dc48e36209599a170356a6b18440b6", "message": "Make it more readable.", "committedDate": "2020-01-28T19:17:29Z", "type": "commit"}]}