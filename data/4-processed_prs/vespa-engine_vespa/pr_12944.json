{"pr_number": 12944, "pr_title": "Add flag control over softstart seconds", "pr_createdAt": "2020-04-16T10:50:48Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12944", "timeline": [{"oid": "ab4749ee3ea0cc4986c7e572f804a29d76fe1a6c", "url": "https://github.com/vespa-engine/vespa/commit/ab4749ee3ea0cc4986c7e572f804a29d76fe1a6c", "message": "Add flag control over softstart seconds.", "committedDate": "2020-04-16T10:48:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2OTA2NQ==", "url": "https://github.com/vespa-engine/vespa/pull/12944#discussion_r409469065", "bodyText": "Since only the application ID dimension is set here, the value can only depend on the application ID, not hostname.\nOtherwise this PR looks good to me.", "author": "hakonhall", "createdAt": "2020-04-16T11:00:58Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/deploy/ModelContextImpl.java", "diffHunk": "@@ -183,6 +184,8 @@ public Properties(ApplicationId applicationId,\n             this.endpointCertificateSecrets = endpointCertificateSecrets;\n             defaultTermwiseLimit = Flags.DEFAULT_TERM_WISE_LIMIT.bindTo(flagSource)\n                     .with(FetchVector.Dimension.APPLICATION_ID, applicationId.serializedForm()).value();\n+            defaultSoftStartSeconds = Flags.DEFAULT_SOFT_START_SECONDS.bindTo(flagSource)\n+                    .with(FetchVector.Dimension.APPLICATION_ID, applicationId.serializedForm()).value();", "originalCommit": "ab4749ee3ea0cc4986c7e572f804a29d76fe1a6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4MDc0OQ==", "url": "https://github.com/vespa-engine/vespa/pull/12944#discussion_r409480749", "bodyText": "So how can I control this with hostname too ?\nI see that there is a Dimension.HOSTNAME, but I do not have the hostname accessible here.\nAny example ?", "author": "baldersheim", "createdAt": "2020-04-16T11:23:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwMTY2MA==", "url": "https://github.com/vespa-engine/vespa/pull/12944#discussion_r409501660", "bodyText": "All current examples of HOSTNAME are trivial: the hostname would be given and you would invoke with(HOSTNAME, hostname) here like you did for APPLICATION_ID.\nHowever this will not work here, as all we have are data structures that will apply during the deployment of a given application, irrespective of the hosts involved.\nSo could we wait with resolving the flag until closer to the place in the config model where we know the involved host?  No, because changing the flag wouldn't bump the config version and wouldn't trigger a new fetch, and possibly leaving half of the nodes with one view of the flags and the other half with another view.\nOne possibility is to freeze the flag values (fork the flag source), and pass that through to the config model. Another faster time-to-market would be to have a special value (say a String) which is specially handled in the config model (split on \";\" in to a set of hostnames).", "author": "hakonhall", "createdAt": "2020-04-16T12:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc4MzcxNw==", "url": "https://github.com/vespa-engine/vespa/pull/12944#discussion_r409783717", "bodyText": "OK, then the host dimension needs another solution.", "author": "baldersheim", "createdAt": "2020-04-16T19:03:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2OTA2NQ=="}], "type": "inlineReview"}, {"oid": "e0b93a22f5f09e6b939eab50e3ff138ef15fbd42", "url": "https://github.com/vespa-engine/vespa/commit/e0b93a22f5f09e6b939eab50e3ff138ef15fbd42", "message": "Document that it is per zone too.", "committedDate": "2020-04-16T12:54:39Z", "type": "commit"}]}