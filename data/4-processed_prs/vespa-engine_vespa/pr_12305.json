{"pr_number": 12305, "pr_title": "Bjorncs/stabilize log handler test", "pr_createdAt": "2020-02-21T13:38:37Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12305", "timeline": [{"oid": "dbebc35581a75d713fd83d4d7d3fd2591e777de5", "url": "https://github.com/vespa-engine/vespa/commit/dbebc35581a75d713fd83d4d7d3fd2591e777de5", "message": "Explicitly declare maven-compiler-plugin to resolve import issues with IntelliJ", "committedDate": "2020-02-21T12:56:30Z", "type": "commit"}, {"oid": "6f770eab5d40183214caf575e445605abb309962", "url": "https://github.com/vespa-engine/vespa/commit/6f770eab5d40183214caf575e445605abb309962", "message": "Improve test assertions for LogFileHandlerTestCase", "committedDate": "2020-02-21T12:59:44Z", "type": "commit"}, {"oid": "78c9cf6cfd031e10301ad38e1a34e60430f21a88", "url": "https://github.com/vespa-engine/vespa/commit/78c9cf6cfd031e10301ad38e1a34e60430f21a88", "message": "Cleanup author tag", "committedDate": "2020-02-21T13:06:04Z", "type": "commit"}, {"oid": "f71034d801aaea5961e5020bb5985756b0dbb535", "url": "https://github.com/vespa-engine/vespa/commit/f71034d801aaea5961e5020bb5985756b0dbb535", "message": "Cleanup javadoc comment", "committedDate": "2020-02-21T13:06:50Z", "type": "commit"}, {"oid": "0b29d2ef8290e073bf783d83dbbce7966349df7c", "url": "https://github.com/vespa-engine/vespa/commit/0b29d2ef8290e073bf783d83dbbce7966349df7c", "message": "Use TemporaryFolder junit rule for temporary test files and directories", "committedDate": "2020-02-21T13:27:57Z", "type": "commit"}, {"oid": "ce422b7c3d5384a6d3eb8249882702101e3e9c41", "url": "https://github.com/vespa-engine/vespa/commit/ce422b7c3d5384a6d3eb8249882702101e3e9c41", "message": "Remove silly exception handling and conditional execution", "committedDate": "2020-02-21T13:27:57Z", "type": "commit"}, {"oid": "9c37326604592f569f176275a479f1e19d6d4de8", "url": "https://github.com/vespa-engine/vespa/commit/9c37326604592f569f176275a479f1e19d6d4de8", "message": "Make fileName volatile", "committedDate": "2020-02-21T13:27:57Z", "type": "commit"}, {"oid": "8bd2a1514fcdf7604706f899ca96697a77b41731", "url": "https://github.com/vespa-engine/vespa/commit/8bd2a1514fcdf7604706f899ca96697a77b41731", "message": "Reduce use of long sleep periods", "committedDate": "2020-02-21T13:27:57Z", "type": "commit"}, {"oid": "6d4b498a9c77be293a0b9baab78bf6fb730ad80d", "url": "https://github.com/vespa-engine/vespa/commit/6d4b498a9c77be293a0b9baab78bf6fb730ad80d", "message": "Shutdown log handler thread at end of each test method\n\nThe log handler will shutdown the JVM (logAndDie) if the junit\ntemporarly folder rule performs cleanup prior to a log rotation.", "committedDate": "2020-02-21T13:36:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382590403", "bodyText": "Another assert framework ? @bratseth and @hmusum\nWon't junit suffice. I thought we are getting rid of the hamcrest stuff. This seems like a replacement.", "author": "baldersheim", "createdAt": "2020-02-21T13:50:38Z", "path": "container-accesslogging/pom.xml", "diffHunk": "@@ -65,6 +65,11 @@\n       <artifactId>jackson-databind</artifactId>\n       <scope>provided</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.assertj</groupId>\n+      <artifactId>assertj-core</artifactId>\n+      <scope>test</scope>", "originalCommit": "6d4b498a9c77be293a0b9baab78bf6fb730ad80d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5NzEzNQ==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382597135", "bodyText": "assertj is a modern incarnation of fest-assert. It's api is way better than hamcrest in my opinion. The simple assert methods from junit does not provide good error messages on failure.", "author": "bjorncs", "createdAt": "2020-02-21T14:04:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNzI4Ng==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382607286", "bodyText": "You're adding a new dependency to be able to write assertThat(31).isEqualTo(first) instead of assertEquals(31, first).\nI suppose there's nothing I can say which adds helpfully to what immediately should become apparent to somebody reading that sentence, and this isn't important so feel free to do whatever you want, but I'll keep removing these when I encounter them in stuff I'm working on.", "author": "bratseth", "createdAt": "2020-02-21T14:23:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYxMzIyNA==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382613224", "bodyText": "I agree that assertj is overkill for assert-a-equals-b kind of assertions.\nAssertj is handy for writing more complex assertions in a type safe manner. Examples from this PR:\nassertThat(content).hasLineCount(logEntries);\nassertThat(uncompressed).exists();\nassertThat(compressed).doesNotExist();\nassertThat(f1).startsWith(\"./testcompression/logfilehandlertest.\");", "author": "bjorncs", "createdAt": "2020-02-21T14:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYxNDYwNw==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382614607", "bodyText": "All those can be done with a single line of code.", "author": "bratseth", "createdAt": "2020-02-21T14:36:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYxNzI3NA==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382617274", "bodyText": "Yes, they were all one-liners in the original code. The new assertj statements are more readable in my opinion + provide better error messages on failure.", "author": "bjorncs", "createdAt": "2020-02-21T14:41:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYzMDQ0Ng==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382630446", "bodyText": "Good error messages are a great aid when hunting bugs that are hard to reproduce locally. For instance, the generated error message from startsWith will include the content of the actual string and the expected prefix. The original assertTrue expression would only output something like \"expected true but got false\".", "author": "bjorncs", "createdAt": "2020-02-21T15:04:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY0MTYzMQ==", "url": "https://github.com/vespa-engine/vespa/pull/12305#discussion_r382641631", "bodyText": "Yes, some times it is worth writing a few lines of code to make things more understandable, perhaps a custom assert method in the test. In a subset of those cases it is possible to find a library that already implements the assert method you have in mind. But I bet you wouldn't pull it in to avoid writing a few lines of code in any other circumstamnces.", "author": "bratseth", "createdAt": "2020-02-21T15:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDQwMw=="}], "type": "inlineReview"}]}