{"pr_number": 13315, "pr_title": "change splunkd startup logic", "pr_createdAt": "2020-05-20T06:20:19Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13315", "timeline": [{"oid": "2d58542e836c805e80162d045d358a6eacf12936", "url": "https://github.com/vespa-engine/vespa/commit/2d58542e836c805e80162d045d358a6eacf12936", "message": "change splunkd startup logic\n\n* doing \"start\" then \"restart\" seems to trigger splunkd core dumps,\n  so we will try \"stop\" + wait + \"start\" instead.\n* log logforwarder actions on info level to make it easier to\n  track splunk activity.", "committedDate": "2020-05-20T06:17:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc2OTEzNA==", "url": "https://github.com/vespa-engine/vespa/pull/13315#discussion_r427769134", "bodyText": "It looked from the logs like stopping splunkd would take roughly 15s. I don't know what happens if we don't wait for the previous instance to shut down, but it's probably OK, since we don't know otherwise by now.", "author": "jonmv", "createdAt": "2020-05-20T06:28:08Z", "path": "logforwarder/src/apps/vespa-logforwarder-start/child-handler.cpp", "diffHunk": "@@ -76,14 +76,15 @@ void\n ChildHandler::startChild(const vespalib::string &prefix)\n {\n     if (! _childRunning) {\n+        // it is possible that splunk was already running anyway, so\n+        // make sure we restart it to get new config activated:\n+        runSplunk(prefix, {\"stop\"});\n+        sleep(1);", "originalCommit": "2d58542e836c805e80162d045d358a6eacf12936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}