{"pr_number": 12182, "pr_title": "Splunk: Setting default application Id values in _meta", "pr_createdAt": "2020-02-13T14:24:44Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12182", "timeline": [{"oid": "0912fe7370a58b661e6edb58c69f8cb1585e8dd2", "url": "https://github.com/vespa-engine/vespa/commit/0912fe7370a58b661e6edb58c69f8cb1585e8dd2", "message": "Setting default application Id values in _meta", "committedDate": "2020-02-13T14:23:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM5NDMzMA==", "url": "https://github.com/vespa-engine/vespa/pull/12182#discussion_r379394330", "bodyText": "must be \"fp =\" not \"*fp =\"", "author": "arnej27959", "createdAt": "2020-02-14T11:58:48Z", "path": "logforwarder/src/apps/vespa-logforwarder-start/cf-handler.cpp", "diffHunk": "@@ -76,6 +77,17 @@ CfHandler::doConfigure()\n     fclose(fp);\n     rename(tmpPath.c_str(), path.c_str());\n \n+    path = cfFilePath(config.splunkHome, \"inputs.conf\");\n+    tmpPath = path + \".new\";\n+    *fp = fopen(tmpPath.c_str(), \"w\");", "originalCommit": "0912fe7370a58b661e6edb58c69f8cb1585e8dd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM5NDQ4MA==", "url": "https://github.com/vespa-engine/vespa/pull/12182#discussion_r379394480", "bodyText": "consider using VESPA_HOSTNAME instead?", "author": "arnej27959", "createdAt": "2020-02-14T11:59:15Z", "path": "logforwarder/src/apps/vespa-logforwarder-start/cf-handler.cpp", "diffHunk": "@@ -76,6 +77,17 @@ CfHandler::doConfigure()\n     fclose(fp);\n     rename(tmpPath.c_str(), path.c_str());\n \n+    path = cfFilePath(config.splunkHome, \"inputs.conf\");\n+    tmpPath = path + \".new\";\n+    *fp = fopen(tmpPath.c_str(), \"w\");\n+    if (fp == NULL) return;\n+\n+    fprintf(fp, \"[default]\\n\");\n+    fprintf(fp, \"host = %s\\n\", getenv(\"HOSTNAME\"));", "originalCommit": "0912fe7370a58b661e6edb58c69f8cb1585e8dd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM5NDk1Ng==", "url": "https://github.com/vespa-engine/vespa/pull/12182#discussion_r379394956", "bodyText": "must be VESPA_APPLICATION here.\nalso, we should probably detect if any of these are unset (getenv returns null pointer), i guess...", "author": "arnej27959", "createdAt": "2020-02-14T12:00:33Z", "path": "logforwarder/src/apps/vespa-logforwarder-start/cf-handler.cpp", "diffHunk": "@@ -76,6 +77,17 @@ CfHandler::doConfigure()\n     fclose(fp);\n     rename(tmpPath.c_str(), path.c_str());\n \n+    path = cfFilePath(config.splunkHome, \"inputs.conf\");\n+    tmpPath = path + \".new\";\n+    *fp = fopen(tmpPath.c_str(), \"w\");\n+    if (fp == NULL) return;\n+\n+    fprintf(fp, \"[default]\\n\");\n+    fprintf(fp, \"host = %s\\n\", getenv(\"HOSTNAME\"));\n+    fprintf(fp, \"_meta = vespa_tenant::%s vespa_application::%s vespa_instance::%s\\n\", getenv(\"VESPA_TENANT\"), getenv(\"VESPA_APPLICTAION\"), getenv(\"VESPA_INSTANCE\"));", "originalCommit": "0912fe7370a58b661e6edb58c69f8cb1585e8dd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e5f5a6b2faadf3ad22f9ead1e3ea48a19ac0e7cf", "url": "https://github.com/vespa-engine/vespa/commit/e5f5a6b2faadf3ad22f9ead1e3ea48a19ac0e7cf", "message": "fix syntax and typo", "committedDate": "2020-02-14T12:13:47Z", "type": "commit"}, {"oid": "07965876cec40d5973defe13f0ed271ad3e33208", "url": "https://github.com/vespa-engine/vespa/commit/07965876cec40d5973defe13f0ed271ad3e33208", "message": "Safeguarding and fixing typos", "committedDate": "2020-02-14T12:23:59Z", "type": "commit"}, {"oid": "e482a89addaac3507f20921527677e1be0b978e4", "url": "https://github.com/vespa-engine/vespa/commit/e482a89addaac3507f20921527677e1be0b978e4", "message": "Merge remote-tracking branch 'origin/bjormel/splunk-logforwarder-default-inputs.conf' into bjormel/splunk-logforwarder-default-inputs.conf\n\n# Conflicts:\n#\tlogforwarder/src/apps/vespa-logforwarder-start/cf-handler.cpp", "committedDate": "2020-02-14T12:24:58Z", "type": "commit"}, {"oid": "5927c9f2374e8dcf7d00d2957bd22ed1c1a0d819", "url": "https://github.com/vespa-engine/vespa/commit/5927c9f2374e8dcf7d00d2957bd22ed1c1a0d819", "message": "Safeguarding", "committedDate": "2020-02-14T12:29:17Z", "type": "commit"}]}