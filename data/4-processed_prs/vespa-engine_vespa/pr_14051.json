{"pr_number": 14051, "pr_title": "Balder/use an actual fieldset repo", "pr_createdAt": "2020-08-14T18:51:34Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14051", "timeline": [{"oid": "bbc768d6ef92f166717d65e67689f6aa15c98952", "url": "https://github.com/vespa-engine/vespa/commit/bbc768d6ef92f166717d65e67689f6aa15c98952", "message": "Change api so that we can drop clone from the interface and prepare for using a true repo.", "committedDate": "2020-08-14T16:08:20Z", "type": "commit"}, {"oid": "729e8546d793a43ecfc94c11d5eed042d4dc74e1", "url": "https://github.com/vespa-engine/vespa/commit/729e8546d793a43ecfc94c11d5eed042d4dc74e1", "message": "Build the FieldSetRepo up front with all configured fieldsets to avoid building them for every get() call.\"", "committedDate": "2020-08-14T18:48:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAyNDc1OQ==", "url": "https://github.com/vespa-engine/vespa/pull/14051#discussion_r472024759", "bodyText": "this type name is somewhat confusing and dishonest", "author": "havardpe", "createdAt": "2020-08-18T08:56:36Z", "path": "storage/src/vespa/storage/common/storagecomponent.h", "diffHunk": "@@ -58,34 +59,38 @@ struct StorageComponentRegister;\n \n class StorageComponent : public framework::Component {\n public:\n+    struct Repos {\n+        explicit Repos(std::shared_ptr<const document::DocumentTypeRepo> repo);\n+        ~Repos();\n+        const std::shared_ptr<const document::DocumentTypeRepo> documentTypeRepo;\n+        const std::shared_ptr<const document::FieldSetRepo> fieldSetRepo;\n+    };\n     using UP = std::unique_ptr<StorageComponent>;\n     using PriorityConfig = vespa::config::content::core::internal::InternalStorPrioritymappingType;\n-    using DocumentTypeRepoSP = std::shared_ptr<const document::DocumentTypeRepo>;\n+    using DocumentTypeRepoSP = std::shared_ptr<Repos>;", "originalCommit": "729e8546d793a43ecfc94c11d5eed042d4dc74e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ3MDQ2OQ==", "url": "https://github.com/vespa-engine/vespa/pull/14051#discussion_r472470469", "bodyText": "Fixed", "author": "baldersheim", "createdAt": "2020-08-18T20:27:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAyNDc1OQ=="}], "type": "inlineReview"}, {"oid": "623648364a8e32ff0ec811f2a8b0179bd13d5956", "url": "https://github.com/vespa-engine/vespa/commit/623648364a8e32ff0ec811f2a8b0179bd13d5956", "message": "Avoid renaming a simple shared_ptr.", "committedDate": "2020-08-18T20:27:33Z", "type": "commit"}]}