{"pr_number": 14337, "pr_title": "Arnej/more time for prepare for restart ", "pr_createdAt": "2020-09-09T11:58:18Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14337", "timeline": [{"oid": "ea33b99bc73a50aabbd42a79cc83159bf61a4e79", "url": "https://github.com/vespa-engine/vespa/commit/ea33b99bc73a50aabbd42a79cc83159bf61a4e79", "message": "allocate 10 minutes for proton.prepareRestart", "committedDate": "2020-09-09T11:40:36Z", "type": "commit"}, {"oid": "813c6084ebb71613310c1f015501e78144254c1c", "url": "https://github.com/vespa-engine/vespa/commit/813c6084ebb71613310c1f015501e78144254c1c", "message": "more time for clean shutdown\n\n* wait 12 minutes before sending SIGTERM to entire process group\n* wait 15 minutes before sending SIGKILL to entire process group", "committedDate": "2020-09-09T11:46:23Z", "type": "commit"}, {"oid": "d0ac0e8561c4bc49b07c1903278430e9a723054f", "url": "https://github.com/vespa-engine/vespa/commit/d0ac0e8561c4bc49b07c1903278430e9a723054f", "message": "avoid confusing \"showdown\" messages", "committedDate": "2020-09-09T11:50:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2NjEyOA==", "url": "https://github.com/vespa-engine/vespa/pull/14337#discussion_r485566128", "bodyText": "@arnej27959 and @baldersheim: If we are not able to differentiate between processes, perhaps we should be conservative at first and increase this to only 120 seconds?", "author": "geirst", "createdAt": "2020-09-09T12:19:35Z", "path": "vespalog/src/logger/runserver.cpp", "diffHunk": "@@ -390,16 +390,16 @@ int main(int argc, char *argv[])\n             } else {\n                 fprintf(stdout, \"%s was running with pid %d, sending SIGTERM\\n\",\n                     service, pid);\n-                if (killpg(pid, SIGTERM) != 0) {\n+                if (kill(pid, SIGTERM) != 0) {\n                     fprintf(stderr, \"could not signal %d: %s\\n\", pid,\n                             strerror(errno));\n                     return 1;\n                 }\n             }\n-            fprintf(stdout, \"Waiting for exit (up to 60 seconds)\\n\");\n-            for (int cnt(0); cnt < 1800; cnt++) {\n+            fprintf(stdout, \"Waiting for exit (up to 15 minutes)\\n\");", "originalCommit": "d0ac0e8561c4bc49b07c1903278430e9a723054f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7e3bfe3b4f81f06da7a623bc9a7643efff6ebab6", "url": "https://github.com/vespa-engine/vespa/commit/7e3bfe3b4f81f06da7a623bc9a7643efff6ebab6", "message": "run prepare_for_shutdown before sending any signals", "committedDate": "2020-09-10T09:45:44Z", "type": "commit"}]}