{"pr_number": 13027, "pr_title": "Split suggesting and autoscaling.", "pr_createdAt": "2020-04-22T22:55:10Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13027", "timeline": [{"oid": "638d2407cc0e5b75c094e5496b1baea6231f2bbf", "url": "https://github.com/vespa-engine/vespa/commit/638d2407cc0e5b75c094e5496b1baea6231f2bbf", "message": "Split suggesting and autoscaling", "committedDate": "2020-04-22T22:54:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU1NzAyNg==", "url": "https://github.com/vespa-engine/vespa/pull/13027#discussion_r413557026", "bodyText": "Is this safe? Looks like this is called during deployment and deciding the targeted resources. If this is not a new deployment that has run for some time, then it probably has target resources. If the user then changes the limits so that the target is outside, this will throw?", "author": "freva", "createdAt": "2020-04-23T06:52:55Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/applications/Application.java", "diffHunk": "@@ -52,7 +56,7 @@ public Application with(Cluster cluster) {\n     public Application withClusterLimits(ClusterSpec.Id id, ClusterResources min, ClusterResources max) {\n         Cluster cluster = clusters.get(id);\n         if (cluster == null)\n-            cluster = new Cluster(id, min, max, Optional.empty());\n+            cluster = new Cluster(id, min, max, Optional.empty(), Optional.empty());\n         else\n             cluster = cluster.withLimits(min, max);", "originalCommit": "638d2407cc0e5b75c094e5496b1baea6231f2bbf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU5OTI2NQ==", "url": "https://github.com/vespa-engine/vespa/pull/13027#discussion_r413599265", "bodyText": "It will not throw but wipe the target. I think that is correct.\nIn the case where new limits are set which are outside the current size we'll pick the lowest limit. That's not the right choice if the entire new window is below the current size, but this isn't perfectly straightforward since it's multidimensional ... so I plan to do some more work on making that safe, but it's orthogonal to this.", "author": "bratseth", "createdAt": "2020-04-23T08:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU1NzAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYwODE1Mg==", "url": "https://github.com/vespa-engine/vespa/pull/13027#discussion_r413608152", "bodyText": "Where does it wipe it? Cluster::withLimits creates new Cluster with the new min, max while keeping old target?", "author": "freva", "createdAt": "2020-04-23T08:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU1NzAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYxMzAyOQ==", "url": "https://github.com/vespa-engine/vespa/pull/13027#discussion_r413613029", "bodyText": "In the Cluster constructor.", "author": "bratseth", "createdAt": "2020-04-23T08:22:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU1NzAyNg=="}], "type": "inlineReview"}]}