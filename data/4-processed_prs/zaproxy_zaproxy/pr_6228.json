{"pr_number": 6228, "pr_title": "Update Log4j to 2.x", "pr_createdAt": "2020-10-07T10:49:22Z", "pr_url": "https://github.com/zaproxy/zaproxy/pull/6228", "timeline": [{"oid": "d19f7eda9d0ff8299a0fac45dcf67b94e8925f82", "url": "https://github.com/zaproxy/zaproxy/commit/d19f7eda9d0ff8299a0fac45dcf67b94e8925f82", "message": "Update Log4j to 2.x\n\nDepend on the new major version and use 1.x bridge.\n\nConfigure Log4j 2 to use a single logger context for ZAP, to use the\nsame log configuration for everything (core, add-ons, dependencies).\n\nUse two Log4j 2 configurations for main code, one during bootstrap and\nanother for remaining lifecycle:\n - The bootstrap configuration is automatically loaded by Log4j, from\n the file `log4j2.properties`, which just logs errors to std out.\n - The other configuration, bundled as `log4j2-home.properties`, is\n copied to ZAP home as `log4j2.properties` and is loaded once the home\n is known. This configuration is the equivalent Log4j 1 configuration\n also copied/loaded from the ZAP home.\n\nUse a specific configuration for the tests (`log4j2-test.properties`,\nlog set to off by default), to not require to tweak the log manually\nthroughout the tests.\nRemove usages of Log4j 1 `NullAppender` in the tests, the class does not\nexist in the Log4j 1.x bridge, also, superseded by the configuration.\n\nMigrate the following classes to use the new Log4j 2 APIs:\n - `Constant`, to load the configuration;\n - `SplashScreen`, to show the info/error log events;\n - `ExtensionLog4j`, to show and count error log events;\n - `ZAP.UncaughtExceptionLogger`, to log the uncaught exceptions;\n - `ZapBootstrap`, to disable the std out log when specified.\n\nRemove usage of Log4j 1 configuration in `DaemonBootstrap` and\n`GuiBootstrap`, no longer needed and would have no effect.\nChange `CommandLineBootstrap` to disable the std out log if not already.\n\nDeprecate `ZapOutputWriter`, no longer used nor functional.\nRemove `ZAP#JERICHO_LOGGER_PROVIDER`, the logger provider is no longer\nneeded, Jericho includes a provider for Log4j 2. Exclude it from binary\ncompatibility checks (was not part of the API).\n\nClose #6196.\n\nSigned-off-by: thc202 <thc202@gmail.com>", "committedDate": "2020-10-07T10:46:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkyMTkwMA==", "url": "https://github.com/zaproxy/zaproxy/pull/6228#discussion_r500921900", "bodyText": "Why is this fully qualified vs using an import?", "author": "kingthorin", "createdAt": "2020-10-07T10:59:21Z", "path": "zap/src/main/java/org/zaproxy/zap/ZAP.java", "diffHunk": "@@ -188,11 +179,12 @@ public static EventBus getEventBus() {\n         return eventBus;\n     }\n \n-    private static final class UncaughtExceptionLogger implements Thread.UncaughtExceptionHandler {\n+    static final class UncaughtExceptionLogger implements Thread.UncaughtExceptionHandler {\n \n-        private static final Logger logger = Logger.getLogger(UncaughtExceptionLogger.class);\n+        private static final org.apache.logging.log4j.Logger logger =", "originalCommit": "d19f7eda9d0ff8299a0fac45dcf67b94e8925f82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkyOTk4Nw==", "url": "https://github.com/zaproxy/zaproxy/pull/6228#discussion_r500929987", "bodyText": "There's already an import of the Logger class (from 1.x).", "author": "thc202", "createdAt": "2020-10-07T11:14:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkyMTkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkyMzMzNA==", "url": "https://github.com/zaproxy/zaproxy/pull/6228#discussion_r500923334", "bodyText": "Should this indicate version or \u201csee\u201d?", "author": "kingthorin", "createdAt": "2020-10-07T11:02:02Z", "path": "zap/src/main/java/org/zaproxy/zap/extension/log4j/ZapOutputWriter.java", "diffHunk": "@@ -26,6 +26,7 @@\n import org.parosproxy.paros.view.View;\n import org.zaproxy.zap.view.ScanStatus;\n \n+@Deprecated", "originalCommit": "d19f7eda9d0ff8299a0fac45dcf67b94e8925f82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkzMDE4NA==", "url": "https://github.com/zaproxy/zaproxy/pull/6228#discussion_r500930184", "bodyText": "This is an internal class, I guess we could remove already but just in case deprecated it instead.", "author": "thc202", "createdAt": "2020-10-07T11:15:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkyMzMzNA=="}], "type": "inlineReview"}]}