{"pr_number": 1196, "pr_title": "Add AdminClient-based replica reassignment.", "pr_createdAt": "2020-05-20T05:25:04Z", "pr_url": "https://github.com/linkedin/cruise-control/pull/1196", "timeline": [{"oid": "3109f21fb9103e6451c956b417968a901030ea13", "url": "https://github.com/linkedin/cruise-control/commit/3109f21fb9103e6451c956b417968a901030ea13", "message": "Add AdminClient-based replica reassignment.", "committedDate": "2020-05-20T05:09:30Z", "type": "commit"}, {"oid": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "url": "https://github.com/linkedin/cruise-control/commit/dc5b844a126df2f46e3b13004fefed6dc6de8583", "message": "Make CircleCI happy.", "committedDate": "2020-05-20T18:07:22Z", "type": "commit"}, {"oid": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "url": "https://github.com/linkedin/cruise-control/commit/dc5b844a126df2f46e3b13004fefed6dc6de8583", "message": "Make CircleCI happy.", "committedDate": "2020-05-20T18:07:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxMTc2OQ==", "url": "https://github.com/linkedin/cruise-control/pull/1196#discussion_r428211769", "bodyText": "should we apply the same exception handling logic to isOngoingIntraBrokerReplicaMovement() ? currently in side that method we ignore these exception.", "author": "kidkun", "createdAt": "2020-05-20T18:13:03Z", "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/executor/Executor.java", "diffHunk": "@@ -573,8 +576,15 @@ private void startExecution(LoadMonitor loadMonitor,\n    * Sanity check whether there are ongoing (1) inter-broker or intra-broker replica movements or (2) leadership movements.\n    */\n   private void sanityCheckOngoingMovement() throws OngoingExecutionException {\n+    boolean hasOngoingPartitionReassignments;\n+    try {\n+      hasOngoingPartitionReassignments = hasOngoingPartitionReassignments();\n+    } catch (TimeoutException | InterruptedException | ExecutionException e) {", "originalCommit": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIyODU2Nw==", "url": "https://github.com/linkedin/cruise-control/pull/1196#discussion_r428228567", "bodyText": "nit: update Javadoc of this method.\nalso the description seems inaccurate, we are checking the latest metadata instead of zookeeper for task finish status.", "author": "kidkun", "createdAt": "2020-05-20T18:38:10Z", "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/executor/Executor.java", "diffHunk": "@@ -1157,7 +1167,8 @@ private void deleteZNodesToStopExecution() {\n     /**\n      * This method periodically checks ZooKeeper to see if (1) partition or (2) leadership reassignment has finished or not.\n      */\n-    private List<ExecutionTask> waitForExecutionTaskToFinish() {\n+    private List<ExecutionTask> waitForExecutionTaskToFinish(AlterPartitionReassignmentsResult result)", "originalCommit": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0MDQzOQ==", "url": "https://github.com/linkedin/cruise-control/pull/1196#discussion_r428240439", "bodyText": "Should we add a timeout here?", "author": "kidkun", "createdAt": "2020-05-20T18:57:53Z", "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/executor/Executor.java", "diffHunk": "@@ -1403,6 +1417,17 @@ private boolean maybeMarkTaskAsDeadOrAborting(Cluster cluster,\n       return false;\n     }\n \n+    private boolean verifyFutureError(Future<?> future, Class<? extends Throwable> exceptionClass) {\n+      try {\n+        future.get();", "originalCommit": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NTU5OA==", "url": "https://github.com/linkedin/cruise-control/pull/1196#discussion_r428245598", "bodyText": "After switch to use admin client, this method seems redundant. should remove this one?", "author": "kidkun", "createdAt": "2020-05-20T19:06:45Z", "path": "cruise-control/src/main/scala/com/linkedin/kafka/cruisecontrol/executor/ExecutorUtils.scala", "diffHunk": "@@ -26,16 +26,16 @@ object ExecutorUtils {\n    * within the cluster, (2) introduce a new replica to the cluster (3) remove an existing replica from the cluster.\n    *\n    * @param kafkaZkClient the KafkaZkClient class to use for partition reassignment.\n-   * @param reassignmentTasks Replica reassignment tasks to be executed.\n+   * @param tasksToExecute Replica reassignment tasks to be executed.\n    */\n   def executeReplicaReassignmentTasks(kafkaZkClient: KafkaZkClient,", "originalCommit": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMyODA3MQ==", "url": "https://github.com/linkedin/cruise-control/pull/1196#discussion_r428328071", "bodyText": "Marked as deprecated -- thanks!", "author": "efeg", "createdAt": "2020-05-20T21:50:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NTU5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0NzQxOQ==", "url": "https://github.com/linkedin/cruise-control/pull/1196#discussion_r428247419", "bodyText": "This method seems not used?", "author": "kidkun", "createdAt": "2020-05-20T19:09:46Z", "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/utils/CCEmbeddedBroker.java", "diffHunk": "@@ -99,6 +99,10 @@ public void awaitShutdown() {\n     _kafkaServer.awaitShutdown();\n   }\n \n+  public KafkaServer kafkaServer() {", "originalCommit": "dc5b844a126df2f46e3b13004fefed6dc6de8583", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3503f2e3bb64e5705da55d172ed7285c45598c0f", "url": "https://github.com/linkedin/cruise-control/commit/3503f2e3bb64e5705da55d172ed7285c45598c0f", "message": "Address the feedback.", "committedDate": "2020-05-20T21:48:41Z", "type": "commit"}]}