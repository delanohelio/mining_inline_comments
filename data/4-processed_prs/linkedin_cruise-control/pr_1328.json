{"pr_number": 1328, "pr_title": "Skip parsing scopes that have keys without a matching value.", "pr_createdAt": "2020-09-17T02:27:45Z", "pr_url": "https://github.com/linkedin/cruise-control/pull/1328", "timeline": [{"oid": "f2745f206046d1e5416bcc761407b880cfeda789", "url": "https://github.com/linkedin/cruise-control/commit/f2745f206046d1e5416bcc761407b880cfeda789", "message": "Skip parsing scopes that have keys without a matching value.", "committedDate": "2020-09-17T02:20:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk2MzgwOA==", "url": "https://github.com/linkedin/cruise-control/pull/1328#discussion_r489963808", "bodyText": "Do you know if it's safe to ignore generating the map for these metrics?", "author": "smccauliff", "createdAt": "2020-09-17T04:30:33Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/metric/MetricsUtils.java", "diffHunk": "@@ -204,11 +204,15 @@ public static boolean isInterested(com.yammer.metrics.core.MetricName metricName\n \n   /**\n    * Convert a yammer metrics scope to a tags map.\n+   * Skip parsing scopes that (1) are {@code null} or (2) have keys without a matching value\n+   * (see https://github.com/linkedin/cruise-control/issues/1296).\n    */\n   private static Map<String, String> yammerMetricScopeToTags(String scope) {\n     if (scope != null) {\n       String[] kv = scope.split(\"\\\\.\");\n-      assert kv.length % 2 == 0;\n+      if (kv.length % 2 != 0) {\n+        return Collections.emptyMap();", "originalCommit": "f2745f206046d1e5416bcc761407b880cfeda789", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ2MDExNg==", "url": "https://github.com/linkedin/cruise-control/pull/1328#discussion_r490460116", "bodyText": "This util function helps with the identification of whether given Kafka Yammer metrics are of interest to CC metrics reporter or not. The Kafka code ensures that scope is either a KV pair separated by a dot or null (see relevant code). Hence, unless these assumptions are broken, this should be safe.\nHowever, in the unlikely scenario, where scope of Yammer metrics contains an odd number of elements, generating an empty map here may lead to a false positive -- i.e. the Yammer metric can be mistakenly identified as one of the metrics that CC metrics reporter is interested in. To prevent this scenario, I updated the handling logic for kv.length % 2 != 0 case in yammerMetricScopeToTags to return null (to indicate unacceptable scope) and the callers of this util function to take a note of this response to avoid misidentification of tags.", "author": "efeg", "createdAt": "2020-09-17T18:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk2MzgwOA=="}], "type": "inlineReview"}, {"oid": "dedc8c7e1108f88c576783837d94a3746d129984", "url": "https://github.com/linkedin/cruise-control/commit/dedc8c7e1108f88c576783837d94a3746d129984", "message": "Address the feedback", "committedDate": "2020-09-17T18:11:45Z", "type": "commit"}]}