{"pr_number": 1246, "pr_title": "modify how to get kafka port", "pr_createdAt": "2020-06-22T08:54:12Z", "pr_url": "https://github.com/linkedin/cruise-control/pull/1246", "timeline": [{"oid": "7b94c5257e62db996adede2f9a03451163e2a7de", "url": "https://github.com/linkedin/cruise-control/commit/7b94c5257e62db996adede2f9a03451163e2a7de", "message": "Change the way to get kafka port", "committedDate": "2020-06-22T09:45:08Z", "type": "forcePushed"}, {"oid": "18decdf12a34e0b0d3f00d475fb718ac8f3127f1", "url": "https://github.com/linkedin/cruise-control/commit/18decdf12a34e0b0d3f00d475fb718ac8f3127f1", "message": "Change the way to get kafka port", "committedDate": "2020-06-22T11:12:43Z", "type": "forcePushed"}, {"oid": "b2cdda341b096a022a31a741a8b43a7f84749e73", "url": "https://github.com/linkedin/cruise-control/commit/b2cdda341b096a022a31a741a8b43a7f84749e73", "message": "Change the way to get kafka port", "committedDate": "2020-06-22T11:21:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NTMyMA==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448045320", "bodyText": "To ensure backwards compatibility and robustness, can we ensure that\n\nif configs.get(\"port\") is not null, use this as port\notherwise if configs.get(\"listeners\") is not null and it has a non-empty port, use that as port\notherwise use the default hostname and port -- i.e. localhost and 9092.\n\nAlso can we move the parsing of port to a small function with this priority of retrieval documented?", "author": "efeg", "createdAt": "2020-07-01T00:07:20Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,8 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = listeners == null ? \"localhost:9092\" : listeners.substring(listeners.lastIndexOf(\"/\") + 1, listeners.length());", "originalCommit": "b2cdda341b096a022a31a741a8b43a7f84749e73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NzUwMw==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448047503", "bodyText": "Note that listeners config can be specified without a host -- such as SSL://:9091 (see https://kafka.apache.org/documentation/#listeners). However, providing an empty hostname in bootstrap.servers config will cause an exception.\nShould we limit this parsing to retrieval of port?", "author": "efeg", "createdAt": "2020-07-01T00:15:08Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,8 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = listeners == null ? \"localhost:9092\" : listeners.substring(listeners.lastIndexOf(\"/\") + 1, listeners.length());", "originalCommit": "b2cdda341b096a022a31a741a8b43a7f84749e73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg0ODEwOA==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448848108", "bodyText": "Thanks  for your answer, you are right.Let me make some changes.", "author": "sasukerui", "createdAt": "2020-07-02T08:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NzUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NzcyNg==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448047726", "bodyText": "Nit: (not introduced in this patch) Can we move the hardcoded values (e.g. localhost, 9092) to static variables?", "author": "efeg", "createdAt": "2020-07-01T00:15:56Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,8 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = listeners == null ? \"localhost:9092\" : listeners.substring(listeners.lastIndexOf(\"/\") + 1, listeners.length());", "originalCommit": "b2cdda341b096a022a31a741a8b43a7f84749e73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MDUxOA==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449340518", "bodyText": "Thanks for the update!\n#1246 (comment) from the first round of review seems not addressed. This patch drops parsing the value of port. However, existing users might depend on value retrieval via port config.\n\nCan we make sure that the behavior is the same as before if port config exists?\nCan we move this parsing logic to a small function with this priority of retrieval documented?\n\n-- please let me know if you have any questions.", "author": "efeg", "createdAt": "2020-07-03T02:01:45Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {\n+          bootstrapServers = \"0.0.0.0:\" + allListeners[2];\n+        } else {\n+          bootstrapServers = allListeners[1].substring(2, allListeners[1].length()) + \":\" + allListeners[2];\n+        }\n+      } else {\n+        bootstrapServers = \"localhost:9092\";\n+      }", "originalCommit": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0MDE5Nw==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r450940197", "bodyText": "Thanks for your answer. l know,let me modify.", "author": "sasukerui", "createdAt": "2020-07-07T15:10:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MDUxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIzMjMxNQ==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r451232315", "bodyText": "If KafkaConfig.ListenersProp() is configured, port  is not null and the value of port will not be used\uff0cmaybe\n\nif configs.get(KafkaConfig.ListenersProp())  is not null, parse host and port in KafkaConfig.ListenersProp(),use this as port\notherwise if configs.get(KafkaConfig.PortProp())  is not null , use that as port\notherwise use the default hostname and port -- i.e. localhost and 9092.", "author": "sasukerui", "createdAt": "2020-07-08T01:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MDUxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MTQ3OA==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449341478", "bodyText": "#1246 (comment) does not seem to be addressed.\nCan we avoid using hardcoded values such as \"listeners\" or \"0.0.0.0:\"?\n\nFor config names, we can use the original source of the config names, such as (1) KafkaConfig.ListenersProp() and (2) KafkaConfig.PortProp().\nFor default values, we can use static variables -- e.g.\n\n  protected static final String DEFAULT_BOOTSTRAP_SERVERS_PORT = \"9092\";\n  protected static final String DEFAULT_BOOTSTRAP_SERVERS_HOST = \"localhost\";", "author": "efeg", "createdAt": "2020-07-03T02:06:35Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {\n+          bootstrapServers = \"0.0.0.0:\" + allListeners[2];", "originalCommit": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MjczNQ==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449342735", "bodyText": "What is the expected structure if allListeners[1].length() == 2 is true (and what is expected when it is false)?", "author": "efeg", "createdAt": "2020-07-03T02:12:44Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {", "originalCommit": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxMDY4Mw==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r450910683", "bodyText": "What is the expected structure if allListeners[1].length() == 2 is true (and what is expected when it is false)?\nThanks for your answer.\neg:\nPLAINTEXT://:9092  'allListeners[1].length() == 2' is 'true'\nPLAINTEXT://myhost:9092\u3001PLAINTEXT://localhost:9092   'allListeners[1].length() == 2' is 'false'\nbut I found that if it is ipv6 it will not be established,let me modify", "author": "sasukerui", "createdAt": "2020-07-07T14:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MjczNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0Mjg5MQ==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449342891", "bodyText": "Why do we switch to 0.0.0.0 from localhost?", "author": "efeg", "createdAt": "2020-07-03T02:13:34Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {\n+          bootstrapServers = \"0.0.0.0:\" + allListeners[2];", "originalCommit": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzNzkwNw==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r450937907", "bodyText": "Why do we switch to 0.0.0.0 from localhost?\nsuch as SSL://:9091\uff0chost is empty, new EndPoint  host will be assigned null\n' if (host == null || host.trim.isEmpty)'\n'anyLocalAddress.holder().hostName = \"0.0.0.0\" '", "author": "sasukerui", "createdAt": "2020-07-07T15:07:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0Mjg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIzOTIxNg==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r451239216", "bodyText": "l misunderstood\nsuch as SSL://:9091,kafka server will listen to 0.0.0.0, but as kafka client we should use localhost", "author": "sasukerui", "createdAt": "2020-07-08T02:00:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0Mjg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MzE2Nw==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449343167", "bodyText": "Can we refer to KafkaConfig.ListenersProp() instead of hardcoding \"listeners\"?", "author": "efeg", "createdAt": "2020-07-03T02:14:53Z", "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporterTest.java", "diffHunk": "@@ -202,4 +202,15 @@ public void testUpdatingMetricsTopicConfig() throws ExecutionException, Interrup\n     topicDescription = adminClient.describeTopics(Collections.singleton(TOPIC)).values().get(TOPIC).get();\n     assertEquals(2, topicDescription.partitions().size());\n   }\n+  @Test\n+  public void testGetKafkaBootstrapServersConfigure() throws ExecutionException, InterruptedException {\n+    String bootstrapServers = \"\";\n+    for (Map<Object, Object> brokerConfig : buildBrokerConfigs()) {\n+      if (brokerConfig.containsKey(\"listeners\")) {\n+         String listeners = String.valueOf(brokerConfig.get(\"listeners\"));", "originalCommit": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MzgyMQ==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449343821", "bodyText": "Should we update this test to handle cases described on #1246 (comment)?", "author": "efeg", "createdAt": "2020-07-03T02:17:52Z", "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporterTest.java", "diffHunk": "@@ -202,4 +202,15 @@ public void testUpdatingMetricsTopicConfig() throws ExecutionException, Interrup\n     topicDescription = adminClient.describeTopics(Collections.singleton(TOPIC)).values().get(TOPIC).get();\n     assertEquals(2, topicDescription.partitions().size());\n   }\n+  @Test\n+  public void testGetKafkaBootstrapServersConfigure() throws ExecutionException, InterruptedException {", "originalCommit": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c37ef8b395a29122a79292c096dffa3708055f8", "url": "https://github.com/linkedin/cruise-control/commit/1c37ef8b395a29122a79292c096dffa3708055f8", "message": "Change the way to get kafka port", "committedDate": "2020-07-09T01:28:46Z", "type": "forcePushed"}, {"oid": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "url": "https://github.com/linkedin/cruise-control/commit/fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "message": "modify how to get kafka port", "committedDate": "2020-07-10T06:24:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTQyNA==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r455215424", "bodyText": ": should not be part of DEFAULT_BOOTSTRAP_SERVERS_HOST.", "author": "efeg", "createdAt": "2020-07-15T17:28:31Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -73,6 +73,7 @@\n   private int _metricsTopicAutoCreateRetries;\n   protected static final String CRUISE_CONTROL_METRICS_TOPIC_CLEAN_UP_POLICY = \"delete\";\n   protected static final Duration PRODUCER_CLOSE_TIMEOUT = Duration.ofSeconds(5);\n+  protected static final String DEFAULT_BOOTSTRAP_SERVERS_HOST = \"localhost:\";", "originalCommit": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIzMzk3Mw==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r455233973", "bodyText": "This change(1) breaks backwards compatibility and (2) uses null as port if neither port nor listeners configs are specified.\nBreaks backwards compatibility:\nIn this new logic, if a user has both listeners and port configs specified, then the port config will be ignored now -- which was not the case in the existing logic.\nPlease ensure that\n\nif configs.get(KafkaConfig.PortProp()) is not null, use this as port (this is regardless of whether listeners has been specified in configs or not)\notherwise if configs.get(\"listeners\") is not null and it has a non-empty port, use that as port\notherwise use the default hostname and port -- i.e. localhost and 9092.\n\nPlease see #1246 (comment).\nMay assign null as the port\nIf neither port nor listeners configs are specified, then bootstrapServers will be localhost:null.", "author": "efeg", "createdAt": "2020-07-15T17:52:11Z", "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -107,14 +108,29 @@ public void close() {\n     }\n   }\n \n+  static String getBootstrapServers(Map<String, ?> configs) {\n+    String listeners = String.valueOf(configs.get(KafkaConfig.ListenersProp()));\n+    if (listeners != null && listeners.length() != 0) {", "originalCommit": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b363d125539a67bb7ef01409518b76e865f140cd", "url": "https://github.com/linkedin/cruise-control/commit/b363d125539a67bb7ef01409518b76e865f140cd", "message": "Modify how to get kafka port", "committedDate": "2020-11-25T01:03:26Z", "type": "commit"}, {"oid": "068336947fbbf3986de8f9c780acd634d99863aa", "url": "https://github.com/linkedin/cruise-control/commit/068336947fbbf3986de8f9c780acd634d99863aa", "message": "Address the feedback", "committedDate": "2020-11-25T03:46:19Z", "type": "commit"}, {"oid": "068336947fbbf3986de8f9c780acd634d99863aa", "url": "https://github.com/linkedin/cruise-control/commit/068336947fbbf3986de8f9c780acd634d99863aa", "message": "Address the feedback", "committedDate": "2020-11-25T03:46:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUwNjIwMA==", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r534506200", "bodyText": "Nit: how about renaming this variable as urlParsePattern. compile seems to be too vague to me", "author": "Lincong", "createdAt": "2020-12-02T21:53:02Z", "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporterTest.java", "diffHunk": "@@ -202,4 +205,33 @@ public void testUpdatingMetricsTopicConfig() throws ExecutionException, Interrup\n     topicDescription = adminClient.describeTopics(Collections.singleton(TOPIC)).values().get(TOPIC).get();\n     assertEquals(2, topicDescription.partitions().size());\n   }\n+\n+  @Test\n+  public void testGetKafkaBootstrapServersConfigure() {\n+    // Test with a \"listeners\" config with a host\n+    Map<Object, Object> brokerConfig = buildBrokerConfigs().get(0);\n+    Map<String, Object> listenersMap = Collections.singletonMap(KafkaConfig.ListenersProp(), brokerConfig.get(KafkaConfig.ListenersProp()));\n+    String bootstrapServers = CruiseControlMetricsReporter.getBootstrapServers(listenersMap);\n+    String urlParse = \"\\\\[?([0-9a-zA-Z\\\\-%._:]*)]?:(-?[0-9]+)\";\n+    Pattern compile = Pattern.compile(urlParse);", "originalCommit": "068336947fbbf3986de8f9c780acd634d99863aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "04e7456d687214d44cf1a01af46c3b570c2e3eba", "url": "https://github.com/linkedin/cruise-control/commit/04e7456d687214d44cf1a01af46c3b570c2e3eba", "message": "Address the feedback.", "committedDate": "2020-12-02T21:58:13Z", "type": "commit"}]}