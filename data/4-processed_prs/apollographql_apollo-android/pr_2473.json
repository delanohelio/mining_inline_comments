{"pr_number": 2473, "pr_title": "[apollo-api] Parse Longs only once", "pr_createdAt": "2020-07-25T16:48:53Z", "pr_url": "https://github.com/apollographql/apollo-android/pull/2473", "timeline": [{"oid": "b529c46be7810476a93c1cfd4dfc548b47917b2d", "url": "https://github.com/apollographql/apollo-android/commit/b529c46be7810476a93c1cfd4dfc548b47917b2d", "message": "set version to 3.0.0-alpha01", "committedDate": "2020-07-24T14:09:52Z", "type": "commit"}, {"oid": "ca51f3370f21c0d4fab7e809eeca42b7767f27b3", "url": "https://github.com/apollographql/apollo-android/commit/ca51f3370f21c0d4fab7e809eeca42b7767f27b3", "message": "remove Long and Float default adapters", "committedDate": "2020-07-25T16:49:26Z", "type": "forcePushed"}, {"oid": "8971baf234dc75ea8feb20acc77e42f0358a0a7c", "url": "https://github.com/apollographql/apollo-android/commit/8971baf234dc75ea8feb20acc77e42f0358a0a7c", "message": "remove Long and Float default adapters", "committedDate": "2020-07-25T16:50:40Z", "type": "commit"}, {"oid": "8971baf234dc75ea8feb20acc77e42f0358a0a7c", "url": "https://github.com/apollographql/apollo-android/commit/8971baf234dc75ea8feb20acc77e42f0358a0a7c", "message": "remove Long and Float default adapters", "committedDate": "2020-07-25T16:50:40Z", "type": "forcePushed"}, {"oid": "71046fdcc84d68f0b8ba3173d504fdbdf4893fff", "url": "https://github.com/apollographql/apollo-android/commit/71046fdcc84d68f0b8ba3173d504fdbdf4893fff", "message": "remove unused methods", "committedDate": "2020-07-27T09:43:38Z", "type": "commit"}, {"oid": "fd72eccc7dc3746ddd933eccca6c58f29b0201b6", "url": "https://github.com/apollographql/apollo-android/commit/fd72eccc7dc3746ddd933eccca6c58f29b0201b6", "message": "add a performance test", "committedDate": "2020-07-27T12:43:45Z", "type": "commit"}, {"oid": "b7153df195003ab3dd8c1974caadc990732eedcb", "url": "https://github.com/apollographql/apollo-android/commit/b7153df195003ab3dd8c1974caadc990732eedcb", "message": "add some float tests", "committedDate": "2020-07-27T14:50:17Z", "type": "commit"}, {"oid": "581b159f5d789504f6cadfb09f373f48605e3a8a", "url": "https://github.com/apollographql/apollo-android/commit/581b159f5d789504f6cadfb09f373f48605e3a8a", "message": "parse Longs only once", "committedDate": "2020-07-27T15:39:36Z", "type": "commit"}, {"oid": "42bae64e70bc9d8dfa4ef9157544b63ca64ed6e2", "url": "https://github.com/apollographql/apollo-android/commit/42bae64e70bc9d8dfa4ef9157544b63ca64ed6e2", "message": "update comments", "committedDate": "2020-07-27T15:42:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyNTk0MA==", "url": "https://github.com/apollographql/apollo-android/pull/2473#discussion_r461225940", "bodyText": "Is there any reason to not use our JsonWriter to compose test json? I mean at least we can avoid extra dependency to kotlinx-serialization that is used as far as I understood only for this test?", "author": "sav007", "createdAt": "2020-07-27T23:23:10Z", "path": "apollo-integration/src/test/java/com/apollographql/apollo/performance/NumberParsingTest.kt", "diffHunk": "@@ -0,0 +1,103 @@\n+package com.apollographql.apollo.performance\n+\n+import com.apollographql.apollo.ApolloClient\n+import com.apollographql.apollo.Utils.immediateExecutor\n+import com.apollographql.apollo.Utils.immediateExecutorService\n+import com.apollographql.apollo.api.internal.SimpleOperationResponseParser\n+import com.apollographql.apollo.fetcher.ApolloResponseFetchers\n+import com.apollographql.apollo.integration.performance.GetFloatsQuery\n+import com.apollographql.apollo.integration.performance.GetIntsQuery\n+import kotlinx.coroutines.runBlocking\n+import kotlinx.serialization.json.JsonArray\n+import kotlinx.serialization.json.JsonObject\n+import kotlinx.serialization.json.JsonPrimitive\n+import okhttp3.Dispatcher\n+import okhttp3.OkHttpClient\n+import okio.ByteString\n+import okio.ByteString.Companion.encodeUtf8\n+import kotlin.random.Random\n+import kotlin.test.Test\n+import kotlin.time.ExperimentalTime\n+import kotlin.time.measureTime\n+\n+data class Data(\n+    val randomInts: List<Int>\n+)\n+\n+/**\n+ * These tests are disabled by default. Set the `runPerformanceTests` property to run them:\n+ * ./gradlew :apollo-integration:testDebug --tests '*parseFloats*' -DrunPerformanceTests=true\n+ */\n+@OptIn(ExperimentalTime::class)\n+class NumberParsingTest {\n+  /**\n+   * A test to benchmark the parsing of integers in Json.\n+   */\n+  @Test\n+  fun parseInts() {\n+\n+    val random = Random.Default\n+\n+    val data = JsonObject(\n+        mapOf(\n+            \"data\" to JsonObject(\n+                mapOf(\n+                    \"randomInts\" to JsonArray(\n+                        0.until(10000).map {\n+                          JsonPrimitive(random.nextInt())\n+                        }\n+                    )\n+                )\n+            )\n+        )\n+    )\n+\n+    val json = data.toString().encodeUtf8()", "originalCommit": "42bae64e70bc9d8dfa4ef9157544b63ca64ed6e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2NDAxNA==", "url": "https://github.com/apollographql/apollo-android/pull/2473#discussion_r461464014", "bodyText": "It was mostly me being lazy to count the number of beginObject and endObjects using the JsonWriter API. I just did it.", "author": "martinbonnin", "createdAt": "2020-07-28T09:57:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyNTk0MA=="}], "type": "inlineReview"}, {"oid": "ec6e255d9850a969f21f2a39bae24caaa2639002", "url": "https://github.com/apollographql/apollo-android/commit/ec6e255d9850a969f21f2a39bae24caaa2639002", "message": "remove kotlinx-serialization", "committedDate": "2020-07-28T09:57:34Z", "type": "commit"}, {"oid": "4b880267bb3a34922413bc3d23afd5370bbca211", "url": "https://github.com/apollographql/apollo-android/commit/4b880267bb3a34922413bc3d23afd5370bbca211", "message": "restore the default scalar adapters", "committedDate": "2020-07-29T08:09:57Z", "type": "commit"}, {"oid": "bd721e022e5ecc2e6b9045fbe9f0f109093204cf", "url": "https://github.com/apollographql/apollo-android/commit/bd721e022e5ecc2e6b9045fbe9f0f109093204cf", "message": "add comments", "committedDate": "2020-07-29T08:13:18Z", "type": "commit"}]}