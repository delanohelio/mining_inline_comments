{"pr_number": 2711, "pr_title": "[Compiler] support multiple arguments in directives", "pr_createdAt": "2020-10-29T10:39:06Z", "pr_url": "https://github.com/apollographql/apollo-android/pull/2711", "timeline": [{"oid": "46a1fc1b2ba4373064ad95755bf4726911c052be", "url": "https://github.com/apollographql/apollo-android/commit/46a1fc1b2ba4373064ad95755bf4726911c052be", "message": "support multiple arguments in directives", "committedDate": "2020-10-29T10:37:11Z", "type": "commit"}, {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3", "url": "https://github.com/apollographql/apollo-android/commit/6f18b250a91e5ec799bd86c1e15a8ff718b575a3", "message": "update test fixtures", "committedDate": "2020-10-29T10:37:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2MTAzMA==", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514161030", "bodyText": "Not sure what the ':' was up there but I didn't find it in http://spec.graphql.org/draft/#Directives so I'm assuming it's safe to remove that case.", "author": "martinbonnin", "createdAt": "2020-10-29T10:40:02Z", "path": "apollo-compiler/src/main/antlr/com/apollographql/apollo/compiler/parser/antlr/GraphQL.g4", "diffHunk": "@@ -96,7 +96,7 @@ directives\n    ;\n \n directive\n-   : '@' NAME ':' valueOrVariable | '@' NAME | '@' NAME '(' argument ')'\n+   : '@' NAME arguments?", "originalCommit": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA==", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514164130", "bodyText": "It looks like a field with @include(if: false) will still generate a non-nullable field. That sounds like a bug?", "author": "martinbonnin", "createdAt": "2020-10-29T10:45:39Z", "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -361,18 +361,30 @@ class GraphQLDocumentParser(\n   private fun GraphQLParser.DirectivesContext?.parse(): List<Condition> {\n     return this?.directive()?.mapNotNull { ctx ->\n       val name = ctx.NAME().text\n-      val argument = ctx.argument()\n-      when {\n-        argument == null -> null\n-        name != \"skip\" && name != \"include\" -> null\n-        argument.NAME()?.text != \"if\" || argument.valueOrVariable()?.variable() == null -> null\n-        else -> Condition(\n-            kind = \"BooleanCondition\",\n-            variableName = argument.valueOrVariable().variable().NAME().text,\n-            inverted = ctx.NAME().text == \"skip\",\n-            sourceLocation = SourceLocation(argument.valueOrVariable()?.start ?: argument.NAME().symbol)\n-        )\n+      val arguments = ctx.arguments()\n+\n+      if (name != \"skip\" && name != \"include\" ) {\n+        // we only support skip and include directives for now\n+        return@mapNotNull null\n+      }\n+\n+      if (arguments.argument().size != 1) {\n+        // skip and include should only have a single argument\n+        return@mapNotNull null\n       }\n+\n+      val argument = arguments.argument().first()\n+      if (argument.NAME().text != \"if\" || argument.valueOrVariable().variable() == null) {\n+        // The argument should be named \"if\"\n+        // Not 100% why we ignore non-variable arguments", "originalCommit": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc0MDM5Nw==", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514740397", "bodyText": "Yeah look like a bug to me. Just I guessed we missed it.", "author": "sav007", "createdAt": "2020-10-30T02:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk3MzA1Mw==", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514973053", "bodyText": "\ud83d\udc4d will fix in a follow-up PR", "author": "martinbonnin", "createdAt": "2020-10-30T09:37:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA=="}], "type": "inlineReview"}]}