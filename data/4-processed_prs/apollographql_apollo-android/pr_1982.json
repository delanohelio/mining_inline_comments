{"pr_number": 1982, "pr_title": "[Plugin] Fix compile task naming", "pr_createdAt": "2020-02-08T23:26:24Z", "pr_url": "https://github.com/apollographql/apollo-android/pull/1982", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc0MTc2Mw==", "url": "https://github.com/apollographql/apollo-android/pull/1982#discussion_r376741763", "bodyText": "Hmm, I'm not sure about using internal APIs. This bite me back a lot of times before. Task names are public. Gradle and Kotlin team will never change task names like compileKotlin or compileFooJava. But they may do internal refactoring which even removed/renames this class.\nLittle duplication of code where you need to remove Main is not too bad.", "author": "tasomaniac", "createdAt": "2020-02-08T23:41:51Z", "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/JvmTaskConfigurator.kt", "diffHunk": "@@ -2,6 +2,7 @@ package com.apollographql.apollo.gradle.internal\n \n import org.gradle.api.NamedDomainObjectContainer\n import org.gradle.api.Project\n+import org.gradle.api.internal.jvm.ClassDirectoryBinaryNamingScheme", "originalCommit": "086e39aef70cc5e7e8b058b363e086a911ff96e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc0MjA0OA==", "url": "https://github.com/apollographql/apollo-android/pull/1982#discussion_r376742048", "bodyText": "Shoots, I didn't see this was internal. You're completely right, that'll break if/when gradle decides to move things around. I'll try to duplicate the logic here. It's not only about the \"Main\" thing but also about - and maybe some other characters ?", "author": "martinbonnin", "createdAt": "2020-02-08T23:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc0MTc2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc0MzM0Mw==", "url": "https://github.com/apollographql/apollo-android/pull/1982#discussion_r376743343", "bodyText": "It should be better now. The java plugin uses a regex to find word boundaries, which explains why - was considered a boundary.", "author": "martinbonnin", "createdAt": "2020-02-09T00:09:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc0MTc2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxNTAwNA==", "url": "https://github.com/apollographql/apollo-android/pull/1982#discussion_r376815004", "bodyText": "nit: \ud83e\udd14 I think Kotlin 'String.decapitalize()' provides the same function?", "author": "sav007", "createdAt": "2020-02-09T21:01:07Z", "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/GUtil.kt", "diffHunk": "@@ -0,0 +1,59 @@\n+package com.apollographql.apollo.gradle.internal\n+\n+import java.util.regex.Pattern\n+\n+/*\n+ * Adapted from Gradle GUtil.java so that we can match the task names\n+ *\n+ * Copyright 2010 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+object GUtil {\n+  private val WORD_SEPARATOR: Pattern = Pattern.compile(\"\\\\W+\")\n+\n+  fun String.uncapitalize(): String {\n+    return if (isNotEmpty() && this[0].isUpperCase()) substring(0, 1).toLowerCase() + substring(1) else this\n+  }", "originalCommit": "49af672d4f20c110ee6d7c77a5cb519bdd7f892d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0NTc5Mw==", "url": "https://github.com/apollographql/apollo-android/pull/1982#discussion_r376945793", "bodyText": "\ud83d\udc4d I was looking for uncaptalize, I missed decapitalize. Thanks for the heads up!", "author": "martinbonnin", "createdAt": "2020-02-10T09:27:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxNTAwNA=="}], "type": "inlineReview"}, {"oid": "64e1156f27a2564e979af20fb17053446e5131de", "url": "https://github.com/apollographql/apollo-android/commit/64e1156f27a2564e979af20fb17053446e5131de", "message": "borrow some code from the Java plugin to make sure the taskName matches", "committedDate": "2020-02-10T09:26:15Z", "type": "commit"}, {"oid": "122c558824174d012748231359d9efc7edc7a58e", "url": "https://github.com/apollographql/apollo-android/commit/122c558824174d012748231359d9efc7edc7a58e", "message": "Added a test for sourceSets with a dash inside", "committedDate": "2020-02-10T09:26:15Z", "type": "commit"}, {"oid": "e53827a36479680884d2ac47520ee8dcf28a23df", "url": "https://github.com/apollographql/apollo-android/commit/e53827a36479680884d2ac47520ee8dcf28a23df", "message": "do not rely on internal APIs", "committedDate": "2020-02-10T09:26:15Z", "type": "commit"}, {"oid": "1f96c093835c1e6bb4932e5edc1a87fec6d50b62", "url": "https://github.com/apollographql/apollo-android/commit/1f96c093835c1e6bb4932e5edc1a87fec6d50b62", "message": "use Kotlin builtin function", "committedDate": "2020-02-10T09:26:55Z", "type": "commit"}, {"oid": "1f96c093835c1e6bb4932e5edc1a87fec6d50b62", "url": "https://github.com/apollographql/apollo-android/commit/1f96c093835c1e6bb4932e5edc1a87fec6d50b62", "message": "use Kotlin builtin function", "committedDate": "2020-02-10T09:26:55Z", "type": "forcePushed"}]}