{"pr_number": 2032, "pr_title": "Expose Compilation Units earlier", "pr_createdAt": "2020-03-04T16:37:52Z", "pr_url": "https://github.com/apollographql/apollo-android/pull/2032", "timeline": [{"oid": "36d362b30ef47de885644f10312339529653111a", "url": "https://github.com/apollographql/apollo-android/commit/36d362b30ef47de885644f10312339529653111a", "message": "added a test to debug https://github.com/apollographql/apollo-android/issues/1970", "committedDate": "2020-03-04T16:38:37Z", "type": "commit"}, {"oid": "36d362b30ef47de885644f10312339529653111a", "url": "https://github.com/apollographql/apollo-android/commit/36d362b30ef47de885644f10312339529653111a", "message": "added a test to debug https://github.com/apollographql/apollo-android/issues/1970", "committedDate": "2020-03-04T16:38:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NTE2OQ==", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r387795169", "bodyText": "Shouldn't this be\nschemaFile = file(\"/path/to/your/schema.json\")", "author": "japplin", "createdAt": "2020-03-04T16:46:39Z", "path": "README.md", "diffHunk": "@@ -304,9 +304,9 @@ apollo {\n // With:\n apollo {\n   onCompilationUnit {\n-     schemaFile = \"/path/to/your/schema.json\"\n+     schemaFile.set(\"/path/to/your/schema.json\")", "originalCommit": "36d362b30ef47de885644f10312339529653111a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5OTM1Mw==", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r387799353", "bodyText": "Yup, my bad, I wanted to make something that worked in kotlin and groovy but forgot the file part...", "author": "martinbonnin", "createdAt": "2020-03-04T16:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NTE2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5OTY2Nw==", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r387799667", "bodyText": "I think schemaFile.set(file(\"/path/to/your/schema.json\")) would work equally well in Groovy and Kotlin.", "author": "martinbonnin", "createdAt": "2020-03-04T16:53:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NTE2OQ=="}], "type": "inlineReview"}, {"oid": "e3e6c7c4b1e8dac957d530f74a9a0100730c264a", "url": "https://github.com/apollographql/apollo-android/commit/e3e6c7c4b1e8dac957d530f74a9a0100730c264a", "message": "fix doc", "committedDate": "2020-03-04T16:52:27Z", "type": "commit"}, {"oid": "fa6ac7b5a09ad620345f21015dfaf69409fc84b8", "url": "https://github.com/apollographql/apollo-android/commit/fa6ac7b5a09ad620345f21015dfaf69409fc84b8", "message": "added a comment", "committedDate": "2020-03-06T11:04:05Z", "type": "commit"}, {"oid": "a14d479cba8347e0b8db7c61964b1b013a11ebe5", "url": "https://github.com/apollographql/apollo-android/commit/a14d479cba8347e0b8db7c61964b1b013a11ebe5", "message": "added a new test project", "committedDate": "2020-03-06T11:04:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3ODgwOA==", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r388878808", "bodyText": "@tasomaniac if ok with you, I'll switch to using plain test directories for plugin tests instead of programmatically constructing them like it was the case before. It's just easier to maintain and debug.", "author": "martinbonnin", "createdAt": "2020-03-06T12:36:32Z", "path": "apollo-gradle-plugin/testProjects/README.md", "diffHunk": "@@ -0,0 +1,13 @@\n+# testProjects\n+\n+This directory contains projects used by the plugin tests.\n+\n+You can find other files in [../src/test/files](../src/test/files). These projects are programmatically constructed but it becomes harder and harder to maintain so new test projects should be added here. It will duplicate some files and schemas but git should do the correct thing and only store objects once.", "originalCommit": "a14d479cba8347e0b8db7c61964b1b013a11ebe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4NjQyMg==", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r388986422", "bodyText": "Let's try and see. In other projects, I've also made them programmatically since they are dynamic and some pieces needs to change.\nFor the first time here, I've seen the approach is slightly different. I think it makes sense.", "author": "tasomaniac", "createdAt": "2020-03-06T15:58:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3ODgwOA=="}], "type": "inlineReview"}, {"oid": "5c46eaa2e1281a72435d8f590617beac40414e74", "url": "https://github.com/apollographql/apollo-android/commit/5c46eaa2e1281a72435d8f590617beac40414e74", "message": "added a simple project", "committedDate": "2020-03-07T20:34:54Z", "type": "commit"}, {"oid": "ca6eba407a3f5d8ae0fe27cae81d375e17db8810", "url": "https://github.com/apollographql/apollo-android/commit/ca6eba407a3f5d8ae0fe27cae81d375e17db8810", "message": "added a simple Kotlin project", "committedDate": "2020-03-07T20:37:46Z", "type": "commit"}, {"oid": "5dbe6593b35439c54d865d1ddf1cdf37c1f659aa", "url": "https://github.com/apollographql/apollo-android/commit/5dbe6593b35439c54d865d1ddf1cdf37c1f659aa", "message": "cleanup", "committedDate": "2020-03-07T21:02:09Z", "type": "commit"}, {"oid": "d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13", "url": "https://github.com/apollographql/apollo-android/commit/d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13", "message": "expose compilationUnits to users before the task is configured", "committedDate": "2020-03-07T21:44:10Z", "type": "commit"}, {"oid": "32ed91184b2294ea99a89ad995fa4a968ec504b1", "url": "https://github.com/apollographql/apollo-android/commit/32ed91184b2294ea99a89ad995fa4a968ec504b1", "message": "remove unused test projects", "committedDate": "2020-03-07T21:46:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNDU3MQ==", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r389314571", "bodyText": "\ud83d\udcaf", "author": "tasomaniac", "createdAt": "2020-03-07T21:47:24Z", "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/ApolloPlugin.kt", "diffHunk": "@@ -99,16 +99,22 @@ open class ApolloPlugin : Plugin<Project> {\n             it.dependsOn(codegenProvider)\n           }\n \n+          compilationUnit.outputDir.set(codegenProvider.flatMap { it.outputDir })\n+          compilationUnit.operationOutputFile.set(codegenProvider.flatMap { it.operationOutputFile })\n+\n+          /**\n+           * Order matters here. See https://github.com/apollographql/apollo-android/issues/1970\n+           * We want to expose the `CompilationUnit` to users before the task is configured by\n+           * AndroidTaskConfigurator.registerGeneratedDirectory so that schemaFile and sourceDirectorySet are\n+           * correctly set\n+           */\n+          apolloExtension.compilationUnits.add(compilationUnit)", "originalCommit": "d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}