{"pr_number": 3193, "pr_title": "Rename AnnotatedTypeMerger to AnnotatedTypeReplacer", "pr_createdAt": "2020-03-24T21:00:34Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3193", "timeline": [{"oid": "092a1f040da80d324fedefcdbf0843bd2e46a29d", "url": "https://github.com/typetools/checker-framework/commit/092a1f040da80d324fedefcdbf0843bd2e46a29d", "message": "rename AnnotatedTypeMerger and AnnotatedTypeReplacer to names that are less confusing", "committedDate": "2020-03-24T20:54:07Z", "type": "commit"}, {"oid": "a58b4633f83dc91b9f4548425abe13f877ac7c30", "url": "https://github.com/typetools/checker-framework/commit/a58b4633f83dc91b9f4548425abe13f877ac7c30", "message": "add changelog entry", "committedDate": "2020-03-24T20:56:19Z", "type": "commit"}, {"oid": "f497f4f1926ecba63d5ace8945d67e82e81b6d4f", "url": "https://github.com/typetools/checker-framework/commit/f497f4f1926ecba63d5ace8945d67e82e81b6d4f", "message": "Merge branch 'master' of github.com:typetools/checker-framework into rename-annotated-type-merger", "committedDate": "2020-03-24T21:15:04Z", "type": "commit"}, {"oid": "0b8e26705f4fdb95c8e731440eb5a6a82c99d060", "url": "https://github.com/typetools/checker-framework/commit/0b8e26705f4fdb95c8e731440eb5a6a82c99d060", "message": "add missing javadoc in keyforpropagator", "committedDate": "2020-03-24T21:32:42Z", "type": "commit"}, {"oid": "eaec0d04926543c46884c20a4149b74e02fc1b95", "url": "https://github.com/typetools/checker-framework/commit/eaec0d04926543c46884c20a4149b74e02fc1b95", "message": "hopefully fix javadoc weirdness", "committedDate": "2020-03-24T21:56:30Z", "type": "commit"}, {"oid": "10230e995ccbfc08798027822ede5ba58a9ebd5c", "url": "https://github.com/typetools/checker-framework/commit/10230e995ccbfc08798027822ede5ba58a9ebd5c", "message": "Merge ../checker-framework-branch-master into rename-annotated-type-merger", "committedDate": "2020-03-26T15:07:04Z", "type": "commit"}, {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "url": "https://github.com/typetools/checker-framework/commit/8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "message": "Put all renamings together in changelog.txt", "committedDate": "2020-03-26T15:10:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1ODE5MQ==", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398958191", "bodyText": "The line above this one should now refer to AnnotatedTypeReplacer.", "author": "wmdietl", "createdAt": "2020-03-26T23:49:17Z", "path": "framework/src/main/java/org/checkerframework/framework/stub/StubParser.java", "diffHunk": "@@ -1965,9 +1965,9 @@ private void putNew(\n                 // annotation exist in both types in the same location for the same hierarchy.", "originalCommit": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1OTAyNg==", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398959026", "bodyText": "The line above talks about merge. It also says that it does that instead of replacing them. So it is confusing that this now uses a replacer.", "author": "wmdietl", "createdAt": "2020-03-26T23:51:57Z", "path": "framework/src/main/java/org/checkerframework/framework/type/TypeFromExpressionVisitor.java", "diffHunk": "@@ -353,10 +353,11 @@ public AnnotatedTypeMirror visitWildcard(WildcardTree node, AnnotatedTypeFactory\n         // This ensures that the structure of the wildcard will match that created by", "originalCommit": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0OTQ1Ng==", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r399449456", "bodyText": "I think this comment is just wrong - this PR didn't change the semantics of AnnotatedTypeMerger/AnnotatedTypeReplacer at all: the class always only did replacement.", "author": "kelloggm", "createdAt": "2020-03-27T18:05:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1OTAyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MDIyNw==", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398960227", "bodyText": "This comment still refers to merger.", "author": "wmdietl", "createdAt": "2020-03-26T23:55:41Z", "path": "checker/src/main/java/org/checkerframework/checker/nullness/KeyForPropagator.java", "diffHunk": "@@ -178,23 +178,30 @@ public void propagateNewClassTree(\n      * An annotated type merger that merges @KeyFor annotations and only if the type that is", "originalCommit": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MDUzNQ==", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398960535", "bodyText": "The PR would be nicer if these parameter renamings happened separately, to focus on the essential changes.", "author": "wmdietl", "createdAt": "2020-03-26T23:56:47Z", "path": "checker/src/main/java/org/checkerframework/checker/nullness/KeyForPropagator.java", "diffHunk": "@@ -178,23 +178,30 @@ public void propagateNewClassTree(\n      * An annotated type merger that merges @KeyFor annotations and only if the type that is\n      * receiving an annotation has an @UnknownKeyFor annotation or NO key for annotations.\n      */\n-    private class KeyForPropagationMerger extends AnnotatedTypeMerger {\n+    private class KeyForPropagationReplacer extends AnnotatedTypeReplacer {\n+\n+        /** The processing environment. */\n         private final ProcessingEnvironment env;\n \n-        private KeyForPropagationMerger(ProcessingEnvironment env) {\n+        /**\n+         * Create a new replacer.\n+         *\n+         * @param env the processing environment\n+         */\n+        private KeyForPropagationReplacer(ProcessingEnvironment env) {\n             this.env = env;\n         }\n \n         @Override\n-        protected void replaceAnnotations(AnnotatedTypeMirror from, AnnotatedTypeMirror to) {\n-            final AnnotationMirror fromKeyFor = from.getAnnotationInHierarchy(UNKNOWN_KEYFOR);\n-            final AnnotationMirror toKeyFor = to.getAnnotationInHierarchy(UNKNOWN_KEYFOR);\n+        protected void replaceAnnotations(AnnotatedTypeMirror src, AnnotatedTypeMirror dst) {", "originalCommit": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MDk4MQ==", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398960981", "bodyText": "It would have been more consistent to rename to from and to, like in the earlier methods.", "author": "wmdietl", "createdAt": "2020-03-26T23:58:11Z", "path": "framework/src/main/java/org/checkerframework/framework/type/visitor/AnnotatedTypeReplacer.java", "diffHunk": "@@ -69,14 +84,20 @@ protected Void combineRs(Void r1, Void r2) {\n         return r1;\n     }\n \n+    /**\n+     * Replace the annotations in dst with the annotations in src\n+     *\n+     * @param src the source of the annotations\n+     * @param dst the destination of the annotations\n+     */\n     protected void replaceAnnotations(\n-            final AnnotatedTypeMirror one, final AnnotatedTypeMirror two) {\n+            final AnnotatedTypeMirror src, final AnnotatedTypeMirror dst) {", "originalCommit": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}