{"pr_number": 3371, "pr_title": "Add live variable analysis to dataflow framework.", "pr_createdAt": "2020-06-13T05:46:34Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3371", "timeline": [{"oid": "737e03ef9e90ec686ea1233f2302c64d37c284aa", "url": "https://github.com/typetools/checker-framework/commit/737e03ef9e90ec686ea1233f2302c64d37c284aa", "message": "Refactor dataflow framework. Introduce backward analysis.\n\nCo-authored-by: Charles Chen <Charleszhuochen@gmail.com>", "committedDate": "2020-06-13T03:44:40Z", "type": "commit"}, {"oid": "8a9337c9e22695233cb97c59cabdab851ad6bedc", "url": "https://github.com/typetools/checker-framework/commit/8a9337c9e22695233cb97c59cabdab851ad6bedc", "message": "Add live variable analysis.\n\nCo-authored-by: Charles Chen <Charleszhuochen@gmail.com>", "committedDate": "2020-06-13T04:19:23Z", "type": "commit"}, {"oid": "f4f1ed3157b5daa7a50016c5e9d296b2a6c7f1c3", "url": "https://github.com/typetools/checker-framework/commit/f4f1ed3157b5daa7a50016c5e9d296b2a6c7f1c3", "message": "Tweaks.", "committedDate": "2020-06-17T19:14:30Z", "type": "commit"}, {"oid": "066c7d395ed53a70f83b4a1a1ecdc8ca06769eb0", "url": "https://github.com/typetools/checker-framework/commit/066c7d395ed53a70f83b4a1a1ecdc8ca06769eb0", "message": "Resolve comments.\nReduce the differences between forward and backward analysis implementation.", "committedDate": "2020-06-17T20:34:26Z", "type": "commit"}, {"oid": "720123f017c5e0c47688c5fae5c05ab01677eb8c", "url": "https://github.com/typetools/checker-framework/commit/720123f017c5e0c47688c5fae5c05ab01677eb8c", "message": "Merge remote-tracking branch 'typetools/master' into typetools-backward-analysis", "committedDate": "2020-06-17T20:34:35Z", "type": "commit"}, {"oid": "0d8664d081e7cdfede1f38ffd18a93091d1c9ff9", "url": "https://github.com/typetools/checker-framework/commit/0d8664d081e7cdfede1f38ffd18a93091d1c9ff9", "message": "Remove unused import.", "committedDate": "2020-06-17T20:37:27Z", "type": "commit"}, {"oid": "ef4fcb59196b5df74b5e8c3be6b2c9bbd8a4fb78", "url": "https://github.com/typetools/checker-framework/commit/ef4fcb59196b5df74b5e8c3be6b2c9bbd8a4fb78", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-17T20:40:19Z", "type": "commit"}, {"oid": "741e968c009f94182ff6738a9f47b930b0a1967f", "url": "https://github.com/typetools/checker-framework/commit/741e968c009f94182ff6738a9f47b930b0a1967f", "message": "Add a TODO comment for widening support for backward analysis.\nTweaks the javadoc.", "committedDate": "2020-06-17T21:40:54Z", "type": "commit"}, {"oid": "8a2940c1a9af637e064d93233a5c0569b22992f3", "url": "https://github.com/typetools/checker-framework/commit/8a2940c1a9af637e064d93233a5c0569b22992f3", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-17T21:41:24Z", "type": "commit"}, {"oid": "9880400eb6f4354105fea809e8254a071a0120a2", "url": "https://github.com/typetools/checker-framework/commit/9880400eb6f4354105fea809e8254a071a0120a2", "message": "Merge remote-tracking branch 'typetools/master' into typetools-backward-analysis", "committedDate": "2020-06-21T01:33:52Z", "type": "commit"}, {"oid": "80f00db88d74cb5fe9ee381e0729ad07cc7122ba", "url": "https://github.com/typetools/checker-framework/commit/80f00db88d74cb5fe9ee381e0729ad07cc7122ba", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-21T01:34:30Z", "type": "commit"}, {"oid": "247c6d8dae718be3332e623306f323a483815c13", "url": "https://github.com/typetools/checker-framework/commit/247c6d8dae718be3332e623306f323a483815c13", "message": "Pull latest code from typetools.", "committedDate": "2020-06-25T03:45:21Z", "type": "commit"}, {"oid": "582f5afc8567b5c91e3ae5801c764796886debce", "url": "https://github.com/typetools/checker-framework/commit/582f5afc8567b5c91e3ae5801c764796886debce", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-25T03:52:29Z", "type": "commit"}, {"oid": "95632cfcc0e9d625f459fb246886cfcc1199d10c", "url": "https://github.com/typetools/checker-framework/commit/95632cfcc0e9d625f459fb246886cfcc1199d10c", "message": "Add live variable analysis test.", "committedDate": "2020-06-25T06:11:38Z", "type": "commit"}, {"oid": "8e69be7f46cd0450de9da5fbc360ebb00bb60245", "url": "https://github.com/typetools/checker-framework/commit/8e69be7f46cd0450de9da5fbc360ebb00bb60245", "message": "Ready for review.", "committedDate": "2020-06-26T03:18:17Z", "type": "commit"}, {"oid": "ef29c77cfb9ae52d669e60eaf0c076c2e4e91fdb", "url": "https://github.com/typetools/checker-framework/commit/ef29c77cfb9ae52d669e60eaf0c076c2e4e91fdb", "message": "Tweaks.", "committedDate": "2020-06-26T17:05:53Z", "type": "commit"}, {"oid": "f911b4ccc145698e0d795cb20d71746606b73fb7", "url": "https://github.com/typetools/checker-framework/commit/f911b4ccc145698e0d795cb20d71746606b73fb7", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-26T17:06:41Z", "type": "commit"}, {"oid": "0c2faaf3647ef05cfd2b70fff2785cc152fa5819", "url": "https://github.com/typetools/checker-framework/commit/0c2faaf3647ef05cfd2b70fff2785cc152fa5819", "message": "Revert \"Tweaks.\"\n\nThis reverts commit ef29c77c", "committedDate": "2020-06-26T17:10:01Z", "type": "commit"}, {"oid": "d996fd0760d700aa6b962c1c3188cfa22df75b14", "url": "https://github.com/typetools/checker-framework/commit/d996fd0760d700aa6b962c1c3188cfa22df75b14", "message": "Merge branch 'master' into typetools-backward-analysis", "committedDate": "2020-06-26T22:19:23Z", "type": "commit"}, {"oid": "4e8d1d89dd4ad09e24a7663ceaaeb20d19efbd73", "url": "https://github.com/typetools/checker-framework/commit/4e8d1d89dd4ad09e24a7663ceaaeb20d19efbd73", "message": "Merge branch 'master' into typetools-live-variable-analysis", "committedDate": "2020-06-26T22:54:07Z", "type": "commit"}, {"oid": "3109b5f931b5c6c2ecf069df45ea4734674397bf", "url": "https://github.com/typetools/checker-framework/commit/3109b5f931b5c6c2ecf069df45ea4734674397bf", "message": "Merge remote-tracking branch 'origin/typetools-live-variable-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-26T23:02:46Z", "type": "commit"}, {"oid": "78454288079939bbb75eb938d578a6e3572bf3d1", "url": "https://github.com/typetools/checker-framework/commit/78454288079939bbb75eb938d578a6e3572bf3d1", "message": "Add getLastNode() back.", "committedDate": "2020-06-27T04:20:35Z", "type": "commit"}, {"oid": "f7298ee2715c2da7fcb3d510ee89878eedb30146", "url": "https://github.com/typetools/checker-framework/commit/f7298ee2715c2da7fcb3d510ee89878eedb30146", "message": "Merge remote-tracking branch 'typetools/master' into typetools-backward-analysis", "committedDate": "2020-06-27T04:20:53Z", "type": "commit"}, {"oid": "96f10aaefeebcace852d51399995bf4dfeee1fde", "url": "https://github.com/typetools/checker-framework/commit/96f10aaefeebcace852d51399995bf4dfeee1fde", "message": "Pull the latest code.\nUpdate Expected.txt.", "committedDate": "2020-06-27T04:26:20Z", "type": "commit"}, {"oid": "c7290abc9cc7704ff2cf34c8034753f972c9f5ff", "url": "https://github.com/typetools/checker-framework/commit/c7290abc9cc7704ff2cf34c8034753f972c9f5ff", "message": "Use preconditions instead of asserts.", "committedDate": "2020-06-29T12:35:47Z", "type": "commit"}, {"oid": "3c7229253b54ebd86292433f273624c05f6f71b5", "url": "https://github.com/typetools/checker-framework/commit/3c7229253b54ebd86292433f273624c05f6f71b5", "message": "Simplify changelog.", "committedDate": "2020-06-29T12:39:06Z", "type": "commit"}, {"oid": "e01fec3e3fe530a67434640331750f1d23fd158d", "url": "https://github.com/typetools/checker-framework/commit/e01fec3e3fe530a67434640331750f1d23fd158d", "message": "Merge remote-tracking branch 'typetools/master' into typetools-backward-analysis", "committedDate": "2020-06-29T17:21:19Z", "type": "commit"}, {"oid": "01a49af69fafd5eebe41b4df64cf8ce48e6f7375", "url": "https://github.com/typetools/checker-framework/commit/01a49af69fafd5eebe41b4df64cf8ce48e6f7375", "message": "Resolve comments.", "committedDate": "2020-06-29T17:26:42Z", "type": "commit"}, {"oid": "d411396f4c40aab75beb6d3dbad4e74ddc103c5c", "url": "https://github.com/typetools/checker-framework/commit/d411396f4c40aab75beb6d3dbad4e74ddc103c5c", "message": "Tweaks.", "committedDate": "2020-06-29T18:21:17Z", "type": "commit"}, {"oid": "33befd17278417161590d663e95702afb17f9115", "url": "https://github.com/typetools/checker-framework/commit/33befd17278417161590d663e95702afb17f9115", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-29T19:15:52Z", "type": "commit"}, {"oid": "3d10dff362872a7111fb5f751f9216b5f9d6d8aa", "url": "https://github.com/typetools/checker-framework/commit/3d10dff362872a7111fb5f751f9216b5f9d6d8aa", "message": "Merge remote-tracking branch 'origin/master' into typetools-backward-analysis", "committedDate": "2020-06-30T15:38:38Z", "type": "commit"}, {"oid": "cbebd6c7d27f1ebe7d10a365df08895e0b25a32d", "url": "https://github.com/typetools/checker-framework/commit/cbebd6c7d27f1ebe7d10a365df08895e0b25a32d", "message": "Use block instead of bb as parameter name.", "committedDate": "2020-06-30T15:54:00Z", "type": "commit"}, {"oid": "77f50dfe960804603bdad6da8ea256f3a0c3da64", "url": "https://github.com/typetools/checker-framework/commit/77f50dfe960804603bdad6da8ea256f3a0c3da64", "message": "Merge pull request #13 from smillst/typetools-backward-analysis\n\nUse block instead of bb as parameter name.", "committedDate": "2020-06-30T16:01:51Z", "type": "commit"}, {"oid": "f549ff7f77e296cf6c0aca2a3582916b5fb15776", "url": "https://github.com/typetools/checker-framework/commit/f549ff7f77e296cf6c0aca2a3582916b5fb15776", "message": "Resolve comment.", "committedDate": "2020-06-30T16:10:16Z", "type": "commit"}, {"oid": "5ab4d76c269424673723e7dee8f143a118416961", "url": "https://github.com/typetools/checker-framework/commit/5ab4d76c269424673723e7dee8f143a118416961", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-backward-analysis", "committedDate": "2020-06-30T16:12:06Z", "type": "commit"}, {"oid": "975e04a4b1e5976a010cfa54171f863eb0730889", "url": "https://github.com/typetools/checker-framework/commit/975e04a4b1e5976a010cfa54171f863eb0730889", "message": "Merge remote-tracking branch 'origin/typetools-backward-analysis' into typetools-live-variable-analysis", "committedDate": "2020-06-30T16:12:27Z", "type": "commit"}, {"oid": "c97eb5dbe49074b482779a8cdaee09a42920600c", "url": "https://github.com/typetools/checker-framework/commit/c97eb5dbe49074b482779a8cdaee09a42920600c", "message": "Merge remote-tracking branch 'typetools/master' into typetools-live-variable-analysis", "committedDate": "2020-06-30T18:56:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxOTA4NA==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r447919084", "bodyText": "This will be improved by https://github.com/typetools/checker-framework/pull/3395/files#diff-b5fa6abf87cb7ac00c95e235720bfa66R50-R56. .trim() seems not the best solution here.\nThe reason I added trim() is to remove the extra blank line at the end of the string graph. This blank line is generated by visualizing special blocks (exit or special-exit). If we left this extra blank line, Excepted.txt will fail the basic style test (too many blank lines at the end of the file).", "author": "xingweitian", "createdAt": "2020-06-30T19:11:32Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/StringCFGVisualizer.java", "diffHunk": "@@ -25,7 +25,7 @@\n     @Override\n     public Map<String, Object> visualize(\n             ControlFlowGraph cfg, Block entry, @Nullable Analysis<V, S, T> analysis) {\n-        String stringGraph = visualizeGraph(cfg, entry, analysis);\n+        String stringGraph = visualizeGraph(cfg, entry, analysis).trim();", "originalCommit": "c97eb5dbe49074b482779a8cdaee09a42920600c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "15b652df627b473a9fd59c016f51cec891be0b36", "url": "https://github.com/typetools/checker-framework/commit/15b652df627b473a9fd59c016f51cec891be0b36", "message": "Don't use a Makefile for the test.", "committedDate": "2020-06-30T20:08:58Z", "type": "commit"}, {"oid": "a178adedbcb32f33af570ace45e78f7df76e5f02", "url": "https://github.com/typetools/checker-framework/commit/a178adedbcb32f33af570ace45e78f7df76e5f02", "message": "Add comments.", "committedDate": "2020-06-30T20:18:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNTM1MA==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r447925350", "bodyText": "I think this should just show the code in LiveVariablePlayground.  This is a link to the Javadoc which doesn't explain how to use the analysis.  The just delete LiveVariablePlayground as it contents are identical to LiveVariable in the test directory.\nMore generally, do you expect people to use this analysis or this just for testing?  If it's for testing, it should be moved to src/test/java.  If it's for general use, should it be mentioned in the dataflow manual?", "author": "smillst", "createdAt": "2020-06-30T19:23:27Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/livevariable/package-info.java", "diffHunk": "@@ -0,0 +1,9 @@\n+/**\n+ * Classes using for live variable analysis. Live variable analysis is a backward analysis to\n+ * calculate the variables that are live at each point in the program. To run live variable\n+ * analysis, see {@link org.checkerframework.dataflow.cfg.playground.LiveVariablePlayground}.", "originalCommit": "c97eb5dbe49074b482779a8cdaee09a42920600c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA5ODgyMg==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r448098822", "bodyText": "Thanks for the comment! I would expect people to run the LiveVariablePlayground. It now has been mentioned in the manual.\nI am not sure what to do with this package-info.java, I just wanted to point the users to LiveVariablePlayground. Do you mean that I need to copy and paste LiveVariablePlayground's code here?", "author": "xingweitian", "createdAt": "2020-07-01T03:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNTM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzOTgwOQ==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r448439809", "bodyText": "I see the livevariable backwards analysis like the constantpropagation forward analyses: demo analyses for the dataflow framework that are only used in their respective playgrounds. Either one could be useful to users.\nIf we decide to move the livevariable implementation we should also move the constantpropagation and the playgrounds to a test directory.\nI like the suggestion of adding a section to the dataflow manual, like for constantpropagation: https://github.com/typetools/checker-framework/blob/master/dataflow/manual/content.tex#L1699\nAs this PR contains the tests for the backwards analysis implementation, it might be good to merge it and work on the manual in a separate PR. But it's also not critical to get this PR into the release, so we can work on the manual section in this PR.", "author": "wmdietl", "createdAt": "2020-07-01T15:22:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNTM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MTAzOA==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r448441038", "bodyText": "Oh, this PR already adds it to the dataflow manual. So that's not a blocker.", "author": "wmdietl", "createdAt": "2020-07-01T15:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNTM1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk0OTkxMw==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r447949913", "bodyText": "This should be named LiveVarValue.", "author": "smillst", "createdAt": "2020-06-30T20:10:06Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/livevariable/LiveVar.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.checkerframework.dataflow.livevariable;\n+\n+import org.checkerframework.checker.nullness.qual.Nullable;\n+import org.checkerframework.dataflow.analysis.AbstractValue;\n+import org.checkerframework.dataflow.cfg.node.Node;\n+import org.checkerframework.javacutil.BugInCF;\n+\n+/** A live variable wrapper turning node into abstract value. */\n+public class LiveVar implements AbstractValue<LiveVar> {", "originalCommit": "15b652df627b473a9fd59c016f51cec891be0b36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MDU0Mg==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r447950542", "bodyText": "A \"live variable wrapper\" would wrap a live variable, but this is wrapping a node.  Could you please improve this documentation?", "author": "smillst", "createdAt": "2020-06-30T20:11:23Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/livevariable/LiveVar.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.checkerframework.dataflow.livevariable;\n+\n+import org.checkerframework.checker.nullness.qual.Nullable;\n+import org.checkerframework.dataflow.analysis.AbstractValue;\n+import org.checkerframework.dataflow.cfg.node.Node;\n+import org.checkerframework.javacutil.BugInCF;\n+\n+/** A live variable wrapper turning node into abstract value. */", "originalCommit": "15b652df627b473a9fd59c016f51cec891be0b36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTc4OA==", "url": "https://github.com/typetools/checker-framework/pull/3371#discussion_r447955788", "bodyText": "FYI, I rewrote the Makefile test to a Gradle test.", "author": "smillst", "createdAt": "2020-06-30T20:21:39Z", "path": "dataflow/build.gradle", "diffHunk": "@@ -31,3 +31,31 @@ task deployArtifactsToSonatype {\n         mvnSignAndDeployMultipleToSonatype(shadowJar.archiveFile.get().toString(), sourcesJar.archiveFile.get().toString(), javadocJar.archiveFile.get().toString(), \"${pomFiles}/dataflow-shaded-pom.xml\")\n     }\n }\n+\n+task liveVariableTest(dependsOn: compileTestJava, group: 'Verification') {", "originalCommit": "a178adedbcb32f33af570ace45e78f7df76e5f02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48bf2b216caad9573a2cfb0691c658dcb7850274", "url": "https://github.com/typetools/checker-framework/commit/48bf2b216caad9573a2cfb0691c658dcb7850274", "message": "Resolve comments.", "committedDate": "2020-06-30T20:50:32Z", "type": "commit"}, {"oid": "e9222b64587917da3f11e75c9de3e058ba310752", "url": "https://github.com/typetools/checker-framework/commit/e9222b64587917da3f11e75c9de3e058ba310752", "message": "Resolve comments.", "committedDate": "2020-07-01T03:13:45Z", "type": "commit"}, {"oid": "3a8dd987c53aa0e0deb8749bf0bb4d23c9a48c7f", "url": "https://github.com/typetools/checker-framework/commit/3a8dd987c53aa0e0deb8749bf0bb4d23c9a48c7f", "message": "Merge remote-tracking branch 'typetools/master' into typetools-live-variable-analysis", "committedDate": "2020-07-01T14:26:23Z", "type": "commit"}, {"oid": "5adf45aad31dd123cdfd503ee3226e52e7f1dcb2", "url": "https://github.com/typetools/checker-framework/commit/5adf45aad31dd123cdfd503ee3226e52e7f1dcb2", "message": "Pull the latest change, update expected string graph.", "committedDate": "2020-07-01T14:34:42Z", "type": "commit"}, {"oid": "164d18ab3cba32623f10a5734b6162224e024463", "url": "https://github.com/typetools/checker-framework/commit/164d18ab3cba32623f10a5734b6162224e024463", "message": "Merge remote-tracking branch 'typetools/master' into typetools-live-variable-analysis", "committedDate": "2020-07-01T15:18:05Z", "type": "commit"}, {"oid": "3a088de9ab05edad0465c2c3daefde84a513a2ab", "url": "https://github.com/typetools/checker-framework/commit/3a088de9ab05edad0465c2c3daefde84a513a2ab", "message": "Now we can remove trim().", "committedDate": "2020-07-01T15:19:22Z", "type": "commit"}]}