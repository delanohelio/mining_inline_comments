{"pr_number": 3366, "pr_title": "AbstractQualifierPolymorphism: use AnnotationMirrors instead of sets of AnnotationMirrors", "pr_createdAt": "2020-06-09T17:05:38Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3366", "timeline": [{"oid": "7103f31564c910c8a20ffc3616a4d23cd1d66bf2", "url": "https://github.com/typetools/checker-framework/commit/7103f31564c910c8a20ffc3616a4d23cd1d66bf2", "message": "Move a file and explain the `visitor` directory", "committedDate": "2020-04-14T03:31:11Z", "type": "commit"}, {"oid": "3740dd645b4b0f1c8f368e4922baadea72e6cf22", "url": "https://github.com/typetools/checker-framework/commit/3740dd645b4b0f1c8f368e4922baadea72e6cf22", "message": "Move text to a different file.", "committedDate": "2020-04-19T21:57:13Z", "type": "commit"}, {"oid": "ee7dfaa9df28eb509ba16d5f4bda4d7de6b768ee", "url": "https://github.com/typetools/checker-framework/commit/ee7dfaa9df28eb509ba16d5f4bda4d7de6b768ee", "message": "Make classes abstract", "committedDate": "2020-04-19T22:00:41Z", "type": "commit"}, {"oid": "565bbf06c221eeabcff84c2a7f8294b84d5552c8", "url": "https://github.com/typetools/checker-framework/commit/565bbf06c221eeabcff84c2a7f8294b84d5552c8", "message": "Merge ../checker-framework-branch-master into framework-visitor-2", "committedDate": "2020-04-19T22:27:55Z", "type": "commit"}, {"oid": "ed6cda52a5a0e65539177dbe4f65020922ff71d0", "url": "https://github.com/typetools/checker-framework/commit/ed6cda52a5a0e65539177dbe4f65020922ff71d0", "message": "Fix compilation errors", "committedDate": "2020-04-19T23:04:38Z", "type": "commit"}, {"oid": "35a3014ad19c20bf270dc22db08579ba6c6aaa85", "url": "https://github.com/typetools/checker-framework/commit/35a3014ad19c20bf270dc22db08579ba6c6aaa85", "message": "Add (vague) Javadoc", "committedDate": "2020-04-20T14:55:18Z", "type": "commit"}, {"oid": "22fb38f515d864cf9ba9aaf45c923adec2dc6cf3", "url": "https://github.com/typetools/checker-framework/commit/22fb38f515d864cf9ba9aaf45c923adec2dc6cf3", "message": "Merge ../checker-framework-branch-master into framework-visitor-2", "committedDate": "2020-04-20T21:24:09Z", "type": "commit"}, {"oid": "2e58efe0ce6115d200bee89d8140f845a47ec64d", "url": "https://github.com/typetools/checker-framework/commit/2e58efe0ce6115d200bee89d8140f845a47ec64d", "message": "Merge branch 'master' into framework-visitor-2", "committedDate": "2020-05-18T20:10:44Z", "type": "commit"}, {"oid": "3b4892e7b99cbea9b7030ad5c31ad3b9483681a4", "url": "https://github.com/typetools/checker-framework/commit/3b4892e7b99cbea9b7030ad5c31ad3b9483681a4", "message": "Add functional constructors.", "committedDate": "2020-05-19T16:50:41Z", "type": "commit"}, {"oid": "8898b99c7ab41faa83766257cdeb387ae16ca86c", "url": "https://github.com/typetools/checker-framework/commit/8898b99c7ab41faa83766257cdeb387ae16ca86c", "message": "Convert to functional.", "committedDate": "2020-05-19T17:47:12Z", "type": "commit"}, {"oid": "f80a5b2793c44660feb2b94f069abe1c47115f3b", "url": "https://github.com/typetools/checker-framework/commit/f80a5b2793c44660feb2b94f069abe1c47115f3b", "message": "Fix bug.", "committedDate": "2020-05-19T20:18:51Z", "type": "commit"}, {"oid": "b41c86c37cb8eddba85cef6a5e38efc348e3459e", "url": "https://github.com/typetools/checker-framework/commit/b41c86c37cb8eddba85cef6a5e38efc348e3459e", "message": "Add default value, add Javadoc, fix few bugs.", "committedDate": "2020-05-20T16:09:52Z", "type": "commit"}, {"oid": "0ee72e9ea85d63d473cce7295a101d70f4c97c5d", "url": "https://github.com/typetools/checker-framework/commit/0ee72e9ea85d63d473cce7295a101d70f4c97c5d", "message": "Use SimpleATS.", "committedDate": "2020-05-20T16:41:04Z", "type": "commit"}, {"oid": "28c281da948096eaddbf9dcfc7be94be7ad5a0a6", "url": "https://github.com/typetools/checker-framework/commit/28c281da948096eaddbf9dcfc7be94be7ad5a0a6", "message": "Add default result and javadoc.", "committedDate": "2020-05-20T16:43:26Z", "type": "commit"}, {"oid": "c192b0512056c34adc6aae615b86652b3a3e0422", "url": "https://github.com/typetools/checker-framework/commit/c192b0512056c34adc6aae615b86652b3a3e0422", "message": "Correct Javadoc.", "committedDate": "2020-05-20T16:46:06Z", "type": "commit"}, {"oid": "e97dd0114ccc166446d03a033040912a770cfccd", "url": "https://github.com/typetools/checker-framework/commit/e97dd0114ccc166446d03a033040912a770cfccd", "message": "Correct bug.", "committedDate": "2020-05-20T16:49:24Z", "type": "commit"}, {"oid": "70e676bc132e67233219cf9c6807acb2a3c8c1f7", "url": "https://github.com/typetools/checker-framework/commit/70e676bc132e67233219cf9c6807acb2a3c8c1f7", "message": "Merge branch 'tmp' into type-scanner-function\n\n# Conflicts:\n#\tframework/src/main/java/org/checkerframework/framework/type/visitor/AnnotatedTypeScanner.java", "committedDate": "2020-05-20T16:58:15Z", "type": "commit"}, {"oid": "bad9816fbd07f3035bc8ec30069486620f0e0b4f", "url": "https://github.com/typetools/checker-framework/commit/bad9816fbd07f3035bc8ec30069486620f0e0b4f", "message": "Clean up hashcode visitor.", "committedDate": "2020-05-20T17:14:13Z", "type": "commit"}, {"oid": "f1dcfd96d3fe3b150d59eb608bcb1193f52e4621", "url": "https://github.com/typetools/checker-framework/commit/f1dcfd96d3fe3b150d59eb608bcb1193f52e4621", "message": "ExpressionErrorChecker and TCConvert", "committedDate": "2020-05-20T17:26:38Z", "type": "commit"}, {"oid": "07610753024f13a0ddc0b478037495d194e070b1", "url": "https://github.com/typetools/checker-framework/commit/07610753024f13a0ddc0b478037495d194e070b1", "message": "Add comment.", "committedDate": "2020-05-20T17:37:53Z", "type": "commit"}, {"oid": "b992c77d3df48b6a3b726e8a8a6cadc36f54de12", "url": "https://github.com/typetools/checker-framework/commit/b992c77d3df48b6a3b726e8a8a6cadc36f54de12", "message": "Correct.", "committedDate": "2020-05-20T17:40:41Z", "type": "commit"}, {"oid": "59103e378c782fe54f8158769b0ac74e3a7d3af8", "url": "https://github.com/typetools/checker-framework/commit/59103e378c782fe54f8158769b0ac74e3a7d3af8", "message": "Javadoc.", "committedDate": "2020-05-20T19:17:50Z", "type": "commit"}, {"oid": "2636e540146622be03f40c27fb1225e4cf1b962c", "url": "https://github.com/typetools/checker-framework/commit/2636e540146622be03f40c27fb1225e4cf1b962c", "message": "Javadoc.", "committedDate": "2020-05-20T19:39:00Z", "type": "commit"}, {"oid": "c01e604c0ad74166dfe323fe84fe27c456c8a806", "url": "https://github.com/typetools/checker-framework/commit/c01e604c0ad74166dfe323fe84fe27c456c8a806", "message": "Javadoc.", "committedDate": "2020-05-20T19:51:08Z", "type": "commit"}, {"oid": "e8347e3ba6c46741936d664059faa8ce76d37d32", "url": "https://github.com/typetools/checker-framework/commit/e8347e3ba6c46741936d664059faa8ce76d37d32", "message": "Fix Javdoc.", "committedDate": "2020-05-20T20:08:55Z", "type": "commit"}, {"oid": "dfceaa0a720d64de442c21c10f91b643c346a0dc", "url": "https://github.com/typetools/checker-framework/commit/dfceaa0a720d64de442c21c10f91b643c346a0dc", "message": "Fix typo.", "committedDate": "2020-05-20T20:28:10Z", "type": "commit"}, {"oid": "f38d40f2fa15b8550cae149c87e4611e7c868bff", "url": "https://github.com/typetools/checker-framework/commit/f38d40f2fa15b8550cae149c87e4611e7c868bff", "message": "Checkpoint.", "committedDate": "2020-05-20T21:02:01Z", "type": "commit"}, {"oid": "8eb1004a223e016120840b4a411901908a754648", "url": "https://github.com/typetools/checker-framework/commit/8eb1004a223e016120840b4a411901908a754648", "message": "Checkpoint.", "committedDate": "2020-05-20T21:18:15Z", "type": "commit"}, {"oid": "c8c5b0e128335c5a57c4b17f38cf454fbb3bd702", "url": "https://github.com/typetools/checker-framework/commit/c8c5b0e128335c5a57c4b17f38cf454fbb3bd702", "message": "Checkpoint.", "committedDate": "2020-05-20T21:30:35Z", "type": "commit"}, {"oid": "75d67dfef6a288d082df3a6b6e92bcad980de8d8", "url": "https://github.com/typetools/checker-framework/commit/75d67dfef6a288d082df3a6b6e92bcad980de8d8", "message": "Correct HashCodeVisitor.", "committedDate": "2020-05-20T21:48:29Z", "type": "commit"}, {"oid": "c09b8089e7041dbe85f7602dc97df2e0972e1f09", "url": "https://github.com/typetools/checker-framework/commit/c09b8089e7041dbe85f7602dc97df2e0972e1f09", "message": "Tweaks and more Javadoc.", "committedDate": "2020-05-21T16:29:08Z", "type": "commit"}, {"oid": "0b00e050d41f6f2d2e6bd17ca441c726c3d922a2", "url": "https://github.com/typetools/checker-framework/commit/0b00e050d41f6f2d2e6bd17ca441c726c3d922a2", "message": "Tweaks and more Javadoc.", "committedDate": "2020-05-21T16:30:10Z", "type": "commit"}, {"oid": "dffc1a07134b6eefc853d44009b47dbb6e289120", "url": "https://github.com/typetools/checker-framework/commit/dffc1a07134b6eefc853d44009b47dbb6e289120", "message": "Correction.", "committedDate": "2020-05-21T16:31:35Z", "type": "commit"}, {"oid": "bbd9774dd7bc614620ba09af5d456bca388a53c9", "url": "https://github.com/typetools/checker-framework/commit/bbd9774dd7bc614620ba09af5d456bca388a53c9", "message": "Reduce code.", "committedDate": "2020-05-21T17:08:11Z", "type": "commit"}, {"oid": "c0f0bdbf974c2a6cc957dd822700b8fb40436201", "url": "https://github.com/typetools/checker-framework/commit/c0f0bdbf974c2a6cc957dd822700b8fb40436201", "message": "Corrections.", "committedDate": "2020-05-21T17:36:39Z", "type": "commit"}, {"oid": "f04357c88e82fc2df5b9838a51b0c99e6b2b7ce6", "url": "https://github.com/typetools/checker-framework/commit/f04357c88e82fc2df5b9838a51b0c99e6b2b7ce6", "message": "Add Javadoc.", "committedDate": "2020-05-21T18:37:14Z", "type": "commit"}, {"oid": "7b4bd7e7bb1135871bb86e9f93c4bf01e991716a", "url": "https://github.com/typetools/checker-framework/commit/7b4bd7e7bb1135871bb86e9f93c4bf01e991716a", "message": "Add Javadoc.", "committedDate": "2020-05-21T18:56:11Z", "type": "commit"}, {"oid": "e4b17b6712f68b47617081c80b11cc05f102006f", "url": "https://github.com/typetools/checker-framework/commit/e4b17b6712f68b47617081c80b11cc05f102006f", "message": "Merge remote-tracking branch 'remotes/origin/master' into type-scanner-function", "committedDate": "2020-06-02T19:26:30Z", "type": "commit"}, {"oid": "abb998e995b1f6d7c39f62704509ecbf25735fca", "url": "https://github.com/typetools/checker-framework/commit/abb998e995b1f6d7c39f62704509ecbf25735fca", "message": "Merge ../checker-framework-branch-master into type-scanner-function", "committedDate": "2020-06-03T16:53:28Z", "type": "commit"}, {"oid": "0120a6ebe6437728b7b47e1621eabe59eed0cd3e", "url": "https://github.com/typetools/checker-framework/commit/0120a6ebe6437728b7b47e1621eabe59eed0cd3e", "message": "Fix ErrorProne warnings.", "committedDate": "2020-06-03T18:43:51Z", "type": "commit"}, {"oid": "0ff2a8003d1123f13f5dc2d4d5cf49d41af9f3ab", "url": "https://github.com/typetools/checker-framework/commit/0ff2a8003d1123f13f5dc2d4d5cf49d41af9f3ab", "message": "In AbstractQualifierPolymorphism, use AnnotationMirrors instead of sets of AnnotationMirrors\n\nSet were used in the past because `@PolyAll` could be instantiated  with multiple qualifiers.", "committedDate": "2020-06-09T17:02:37Z", "type": "commit"}, {"oid": "4d21baa7e6a06bf123ee5fac4ccf21077493ecb8", "url": "https://github.com/typetools/checker-framework/commit/4d21baa7e6a06bf123ee5fac4ccf21077493ecb8", "message": "Add Javadoc.", "committedDate": "2020-06-09T17:19:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4MTY1Nw==", "url": "https://github.com/typetools/checker-framework/pull/3366#discussion_r439581657", "bodyText": "The set should be removed, right? Returns the annotation that is....", "author": "wmdietl", "createdAt": "2020-06-12T18:33:13Z", "path": "framework/src/main/java/org/checkerframework/framework/type/poly/AbstractQualifierPolymorphism.java", "diffHunk": "@@ -235,42 +235,46 @@ public void resolve(\n     }\n \n     /**\n-     * If the primary annotation of {@code actualType} is a polymorphic qualifier, then it is mapped\n+     * If the primary annotation of {@code polyType} is a polymorphic qualifier, then it is mapped\n      * to the primary annotation of {@code type} and the map is returned. Otherwise, an empty map is\n      * returned.\n+     *\n+     * @param type type with qualifier to us in the map\n+     * @param polyType type that may have polymorphic qualifiers\n+     * @return a mapping from the polymorphic qualifiers in {@code polyType} to the qualifiers in\n+     *     {@code type}\n      */\n-    private AnnotationMirrorMap<AnnotationMirrorSet> mapQualifierToPoly(\n-            AnnotatedTypeMirror type, AnnotatedTypeMirror actualType) {\n-        AnnotationMirrorMap<AnnotationMirrorSet> result = new AnnotationMirrorMap<>();\n+    private AnnotationMirrorMap<AnnotationMirror> mapQualifierToPoly(\n+            AnnotatedTypeMirror type, AnnotatedTypeMirror polyType) {\n+        AnnotationMirrorMap<AnnotationMirror> result = new AnnotationMirrorMap<>();\n \n         for (Map.Entry<AnnotationMirror, AnnotationMirror> kv : polyQuals.entrySet()) {\n             AnnotationMirror top = kv.getValue();\n             AnnotationMirror poly = kv.getKey();\n-            if (actualType.hasAnnotation(poly)) {\n+            if (polyType.hasAnnotation(poly)) {\n                 AnnotationMirror typeQual = type.getAnnotationInHierarchy(top);\n                 if (typeQual != null) {\n-                    result.put(poly, AnnotationMirrorSet.singleElementSet(typeQual));\n+                    result.put(poly, typeQual);\n                 }\n             }\n         }\n         return result;\n     }\n \n     /**\n-     * Returns an annotation set that is the merge of the two sets of annotations. The sets are\n+     * Returns annotation set that is the combination of the two annotations. The annotations are", "originalCommit": "4d21baa7e6a06bf123ee5fac4ccf21077493ecb8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4MjEzMQ==", "url": "https://github.com/typetools/checker-framework/pull/3366#discussion_r439582131", "bodyText": "an annotation", "author": "wmdietl", "createdAt": "2020-06-12T18:34:17Z", "path": "framework/src/main/java/org/checkerframework/framework/type/poly/AbstractQualifierPolymorphism.java", "diffHunk": "@@ -235,42 +235,46 @@ public void resolve(\n     }\n \n     /**\n-     * If the primary annotation of {@code actualType} is a polymorphic qualifier, then it is mapped\n+     * If the primary annotation of {@code polyType} is a polymorphic qualifier, then it is mapped\n      * to the primary annotation of {@code type} and the map is returned. Otherwise, an empty map is\n      * returned.\n+     *\n+     * @param type type with qualifier to us in the map\n+     * @param polyType type that may have polymorphic qualifiers\n+     * @return a mapping from the polymorphic qualifiers in {@code polyType} to the qualifiers in\n+     *     {@code type}\n      */\n-    private AnnotationMirrorMap<AnnotationMirrorSet> mapQualifierToPoly(\n-            AnnotatedTypeMirror type, AnnotatedTypeMirror actualType) {\n-        AnnotationMirrorMap<AnnotationMirrorSet> result = new AnnotationMirrorMap<>();\n+    private AnnotationMirrorMap<AnnotationMirror> mapQualifierToPoly(\n+            AnnotatedTypeMirror type, AnnotatedTypeMirror polyType) {\n+        AnnotationMirrorMap<AnnotationMirror> result = new AnnotationMirrorMap<>();\n \n         for (Map.Entry<AnnotationMirror, AnnotationMirror> kv : polyQuals.entrySet()) {\n             AnnotationMirror top = kv.getValue();\n             AnnotationMirror poly = kv.getKey();\n-            if (actualType.hasAnnotation(poly)) {\n+            if (polyType.hasAnnotation(poly)) {\n                 AnnotationMirror typeQual = type.getAnnotationInHierarchy(top);\n                 if (typeQual != null) {\n-                    result.put(poly, AnnotationMirrorSet.singleElementSet(typeQual));\n+                    result.put(poly, typeQual);\n                 }\n             }\n         }\n         return result;\n     }\n \n     /**\n-     * Returns an annotation set that is the merge of the two sets of annotations. The sets are\n+     * Returns annotation set that is the combination of the two annotations. The annotations are\n      * instantiations for {@code polyQual}.\n      *\n      * <p>The combination is typically their least upper bound. (It could be the GLB in the case\n      * that all arguments to a polymorphic method must have the same annotation.)\n      *\n-     * @param polyQual polymorphic qualifier for which {@code a1Annos} and {@code a2Annos} are\n-     *     instantiations\n-     * @param a1Annos a set that is an instantiation of {@code polyQual}\n-     * @param a2Annos a set that is an instantiation of {@code polyQual}\n-     * @return the merge of the two sets\n+     * @param polyQual polymorphic qualifier for which {@code a1} and {@code a2} are instantiations\n+     * @param a1 an annotation that is an instantiation of {@code polyQual}\n+     * @param a2 an annotation that is an instantiation of {@code polyQual}\n+     * @return a annotation that is the combination of the two annotations", "originalCommit": "4d21baa7e6a06bf123ee5fac4ccf21077493ecb8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6aff8870268e3e1cbd6e4445dc1bb70a160d56dc", "url": "https://github.com/typetools/checker-framework/commit/6aff8870268e3e1cbd6e4445dc1bb70a160d56dc", "message": "Address review comments.", "committedDate": "2020-06-15T16:51:19Z", "type": "commit"}, {"oid": "bb54febe1a04efa57236d034ef6fa92993679496", "url": "https://github.com/typetools/checker-framework/commit/bb54febe1a04efa57236d034ef6fa92993679496", "message": "Merge remote-tracking branch 'origin/master' into type-scanner-function", "committedDate": "2020-06-15T16:52:17Z", "type": "commit"}, {"oid": "2aea1c0b2e6664d2999de3a94352a2550bafff9b", "url": "https://github.com/typetools/checker-framework/commit/2aea1c0b2e6664d2999de3a94352a2550bafff9b", "message": "Fix comments.", "committedDate": "2020-06-15T16:54:14Z", "type": "commit"}, {"oid": "4bce6a57133202f2f057f059951a94951e606e5f", "url": "https://github.com/typetools/checker-framework/commit/4bce6a57133202f2f057f059951a94951e606e5f", "message": "Merge remote-tracking branch 'origin/master' into polyQuals", "committedDate": "2020-06-15T16:54:21Z", "type": "commit"}, {"oid": "bc8df2496b13ae4f7151244714aad480e5f6bbd3", "url": "https://github.com/typetools/checker-framework/commit/bc8df2496b13ae4f7151244714aad480e5f6bbd3", "message": "Merge branch 'type-scanner-function' into polyQuals", "committedDate": "2020-06-15T16:59:04Z", "type": "commit"}, {"oid": "e5893fe0d86e85457d3a760ef34bffadf128bb9a", "url": "https://github.com/typetools/checker-framework/commit/e5893fe0d86e85457d3a760ef34bffadf128bb9a", "message": "Merge remote-tracking branch 'remotes/origin/master' into polyQuals", "committedDate": "2020-06-15T20:39:22Z", "type": "commit"}]}