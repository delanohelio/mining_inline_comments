{"pr_number": 3042, "pr_title": "Don't try to infer type argument for a method invocation returned by a lambda (Fixes #3036)", "pr_createdAt": "2020-01-09T17:32:00Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3042", "timeline": [{"oid": "df5917f8354ce9b24ff469ad80ef7b03585232cb", "url": "https://github.com/typetools/checker-framework/commit/df5917f8354ce9b24ff469ad80ef7b03585232cb", "message": "Suppress lambda warning.", "committedDate": "2020-01-09T17:25:05Z", "type": "commit"}, {"oid": "be664be42c61bc6088efe794c148ce2eeea9f32b", "url": "https://github.com/typetools/checker-framework/commit/be664be42c61bc6088efe794c148ce2eeea9f32b", "message": "Fix comment.", "committedDate": "2020-01-09T17:26:00Z", "type": "commit"}, {"oid": "7e04e59c212794d8e03bdd77177181ce71f315bd", "url": "https://github.com/typetools/checker-framework/commit/7e04e59c212794d8e03bdd77177181ce71f315bd", "message": "Different fix.", "committedDate": "2020-01-09T17:29:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3MDk5Ng==", "url": "https://github.com/typetools/checker-framework/pull/3042#discussion_r365470996", "bodyText": "A comment about the first case would be good in the documentation below.", "author": "wmdietl", "createdAt": "2020-01-10T23:33:49Z", "path": "framework/src/main/java/org/checkerframework/framework/util/typeinference/DefaultTypeArgumentInference.java", "diffHunk": "@@ -135,7 +136,12 @@ public DefaultTypeArgumentInference(AnnotatedTypeFactory typeFactory) {\n \n         final Set<TypeVariable> targets = TypeArgInferenceUtil.methodTypeToTargets(methodType);\n \n-        if (assignedTo == null && TreeUtils.getAssignmentContext(pathToExpression) != null) {\n+        if ((pathToExpression.getParentPath() != null", "originalCommit": "7e04e59c212794d8e03bdd77177181ce71f315bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3MTExNA==", "url": "https://github.com/typetools/checker-framework/pull/3042#discussion_r365471114", "bodyText": "I'm wondering whether using TreeUtils.enclosingMethodOrLambda and then checking for LAMBDA_EXPRESSION would be a bit shorter.", "author": "wmdietl", "createdAt": "2020-01-10T23:34:27Z", "path": "framework/src/main/java/org/checkerframework/framework/util/typeinference/DefaultTypeArgumentInference.java", "diffHunk": "@@ -135,7 +136,12 @@ public DefaultTypeArgumentInference(AnnotatedTypeFactory typeFactory) {\n \n         final Set<TypeVariable> targets = TypeArgInferenceUtil.methodTypeToTargets(methodType);\n \n-        if (assignedTo == null && TreeUtils.getAssignmentContext(pathToExpression) != null) {\n+        if ((pathToExpression.getParentPath() != null\n+                        && pathToExpression.getParentPath().getLeaf() != null\n+                        && pathToExpression.getParentPath().getLeaf().getKind()", "originalCommit": "7e04e59c212794d8e03bdd77177181ce71f315bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3MzUyMQ==", "url": "https://github.com/typetools/checker-framework/pull/3042#discussion_r365473521", "bodyText": "The type arguments cannot be inferred if the immediate parent is lambda expression.  TreeUtils.enclosingMethodOrLambda might return a lambda expression that is the parent's parent, so it doesn't work.", "author": "smillst", "createdAt": "2020-01-10T23:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3MTExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MTU3Mw==", "url": "https://github.com/typetools/checker-framework/pull/3042#discussion_r365491573", "bodyText": "Couldn't the method invocation be parenthesized?\nCouldn't one write mapper = dsData1 -> ((ImmutableMap.of(...)))? Not the nicest style, but would be a bit odd not to handle.", "author": "wmdietl", "createdAt": "2020-01-11T02:20:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ3MTExNA=="}], "type": "inlineReview"}, {"oid": "ee9fae77643a9fbe7fd2c152e0fdf6539aaeb18d", "url": "https://github.com/typetools/checker-framework/commit/ee9fae77643a9fbe7fd2c152e0fdf6539aaeb18d", "message": "Add comment.", "committedDate": "2020-01-10T23:49:36Z", "type": "commit"}, {"oid": "a180476b3508913f606b4e94ba54359c7dd77679", "url": "https://github.com/typetools/checker-framework/commit/a180476b3508913f606b4e94ba54359c7dd77679", "message": "Merge branch 'master' into issue3036", "committedDate": "2020-01-14T18:11:43Z", "type": "commit"}, {"oid": "cd7c9b3c3820ab22b2e0dca5a32ea4f570112555", "url": "https://github.com/typetools/checker-framework/commit/cd7c9b3c3820ab22b2e0dca5a32ea4f570112555", "message": "Use util method.", "committedDate": "2020-01-14T18:15:14Z", "type": "commit"}]}