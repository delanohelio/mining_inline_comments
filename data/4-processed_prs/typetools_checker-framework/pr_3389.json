{"pr_number": 3389, "pr_title": "Handle while true (Fixes #3249)", "pr_createdAt": "2020-06-17T19:13:11Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3389", "timeline": [{"oid": "33ec2db1afbbf0c1e7fc24acb1491bda1a4b405e", "url": "https://github.com/typetools/checker-framework/commit/33ec2db1afbbf0c1e7fc24acb1491bda1a4b405e", "message": "adapt while(true) logic", "committedDate": "2020-06-17T16:38:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTA3NA==", "url": "https://github.com/typetools/checker-framework/pull/3389#discussion_r445141074", "bodyText": "true is a literal not a constant. So this should say Determine whether loop condition is the boolean literal \"true\",.   You've used constant instead of literal in other places in this pull request.  Please change all uses.", "author": "smillst", "createdAt": "2020-06-24T20:06:00Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/CFGBuilder.java", "diffHunk": "@@ -4913,15 +4915,30 @@ public Node visitWhileLoop(WhileLoopTree tree, Void p) {\n             // Condition\n             addLabelForNextNode(conditionStart);\n             assert tree.getCondition() != null;\n+            // Determine whether loop condition is a constant true, according to the compiler logic.", "originalCommit": "33ec2db1afbbf0c1e7fc24acb1491bda1a4b405e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE1OTI5MA==", "url": "https://github.com/typetools/checker-framework/pull/3389#discussion_r445159290", "bodyText": "More generally, a literal appears in source code, and a constant is an expression that can be evaluated at compile time.  So, true is both a literal and a constant.  4 > 3 is a constant.\nUsing these terms consistently will help to make the code easier to read.  Thanks!\n(I haven't read the code to determine whether it is checking for the literal true or the constant true.)", "author": "mernst", "createdAt": "2020-06-24T20:41:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTA3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE4MDkwNQ==", "url": "https://github.com/typetools/checker-framework/pull/3389#discussion_r445180905", "bodyText": "@smillst This PR correctly uses constant. The compiler handles \"!false\" and \"6 > 4\" as being the compile-time constant true.\n@d367wang Please add the following test case:\n    Issue3249() {\n        double local;\n        while (6 > 4) {\n            local = 1;\n            break;\n        }\n        field = local;\n    }", "author": "wmdietl", "createdAt": "2020-06-24T21:25:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MzE3NQ==", "url": "https://github.com/typetools/checker-framework/pull/3389#discussion_r445143175", "bodyText": "This method works for any tree, even if that tree is not a loop condition.  We might find uses for this method outside of this class, would you please move it to TreeUtils and rename it to isLiteralTrue.", "author": "smillst", "createdAt": "2020-06-24T20:10:11Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/CFGBuilder.java", "diffHunk": "@@ -4985,6 +5002,35 @@ public Node visitOther(Tree tree, Void p) {\n         }\n     }\n \n+    /**\n+     * Determine whether loop condition {@link JCTree} is a constant true, according to the compiler", "originalCommit": "33ec2db1afbbf0c1e7fc24acb1491bda1a4b405e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE4MTc4MQ==", "url": "https://github.com/typetools/checker-framework/pull/3389#discussion_r445181781", "bodyText": "Moving to TreeUtils sounds good. As name I would use isExpressionConstantTrue or isExprConstTrue, or the current isCondConstTrue.", "author": "wmdietl", "createdAt": "2020-06-24T21:27:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MzE3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE4NjUxMg==", "url": "https://github.com/typetools/checker-framework/pull/3389#discussion_r445186512", "bodyText": "The Javadoc should say is a compile-time constant true or as the JLS uses a condition expression has the constant value true.  (I clearly misunderstood the term constant true, other might, too.)", "author": "smillst", "createdAt": "2020-06-24T21:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MzE3NQ=="}], "type": "inlineReview"}, {"oid": "7a196f0af63569a9b25427411977ef34073dfe15", "url": "https://github.com/typetools/checker-framework/commit/7a196f0af63569a9b25427411977ef34073dfe15", "message": "improve comment; create isExprConstTrue in TreeUtils", "committedDate": "2020-06-27T22:50:23Z", "type": "commit"}, {"oid": "88fd853b1cfe3d5e534a29d8ed5dbb5db9969d57", "url": "https://github.com/typetools/checker-framework/commit/88fd853b1cfe3d5e534a29d8ed5dbb5db9969d57", "message": "Merge branch 'master' of https://github.com/typetools/checker-framework into issue-3249", "committedDate": "2020-06-27T22:52:15Z", "type": "commit"}, {"oid": "394a78b3f1bff9600a2371390a297e7fa4581883", "url": "https://github.com/typetools/checker-framework/commit/394a78b3f1bff9600a2371390a297e7fa4581883", "message": "edit Javadoc", "committedDate": "2020-06-28T00:05:40Z", "type": "commit"}]}