{"pr_number": 3516, "pr_title": "Visualize CFGs without package names", "pr_createdAt": "2020-07-27T16:41:27Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3516", "timeline": [{"oid": "7de0c52c73f16fc2f71d7a4d168913e8da811bf3", "url": "https://github.com/typetools/checker-framework/commit/7de0c52c73f16fc2f71d7a4d168913e8da811bf3", "message": "Improve CFG visualization documentation", "committedDate": "2020-07-27T00:22:54Z", "type": "commit"}, {"oid": "7e830e6f4b6a56ea28fe69a6d291a77f9a3ef451", "url": "https://github.com/typetools/checker-framework/commit/7e830e6f4b6a56ea28fe69a6d291a77f9a3ef451", "message": "Add some more documentation", "committedDate": "2020-07-27T01:11:54Z", "type": "commit"}, {"oid": "299320f0acec2ab09b44a9695c67bbfd3b752f52", "url": "https://github.com/typetools/checker-framework/commit/299320f0acec2ab09b44a9695c67bbfd3b752f52", "message": "More documentation improvements", "committedDate": "2020-07-27T01:27:26Z", "type": "commit"}, {"oid": "b8d442091603277afad448baa368b80eeee242da", "url": "https://github.com/typetools/checker-framework/commit/b8d442091603277afad448baa368b80eeee242da", "message": "Visualize CFGs without package names\n\nThis makes the CFG smaller and easier to read.  In rare cases when there are\nmultiple classes with the same name, it might hide important information.  If\nthat comes up, we can introduce a flag to print classes in fully-qualified form.", "committedDate": "2020-07-27T03:27:17Z", "type": "commit"}, {"oid": "d68d96821dd2934f18256d310eeee259ee1d8c82", "url": "https://github.com/typetools/checker-framework/commit/d68d96821dd2934f18256d310eeee259ee1d8c82", "message": "Merge ../checker-framework-branch-master into cfgviz-documentation", "committedDate": "2020-07-27T03:32:50Z", "type": "commit"}, {"oid": "1d69290545a6f65d58de260b05d8acfce0661bf2", "url": "https://github.com/typetools/checker-framework/commit/1d69290545a6f65d58de260b05d8acfce0661bf2", "message": "Merge ../checker-framework-fork-mernst-branch-cfgviz-documentation into cfgviz-nopackage", "committedDate": "2020-07-27T03:33:09Z", "type": "commit"}, {"oid": "fd41ff4f5f3d8272ecb509f2b15595e985a1fe63", "url": "https://github.com/typetools/checker-framework/commit/fd41ff4f5f3d8272ecb509f2b15595e985a1fe63", "message": "Handle another typekind", "committedDate": "2020-07-27T03:50:09Z", "type": "commit"}, {"oid": "0e07fa4e0b82076fe70fe3c2709bdd68e81919a7", "url": "https://github.com/typetools/checker-framework/commit/0e07fa4e0b82076fe70fe3c2709bdd68e81919a7", "message": "Make output more concise", "committedDate": "2020-07-27T03:57:46Z", "type": "commit"}, {"oid": "44e04326147b6066d5f2bc64a19955b87e8b39d5", "url": "https://github.com/typetools/checker-framework/commit/44e04326147b6066d5f2bc64a19955b87e8b39d5", "message": "Add Javadoc", "committedDate": "2020-07-27T04:56:49Z", "type": "commit"}, {"oid": "cdda8038459505d6257031997bb1d4808fc1b8b8", "url": "https://github.com/typetools/checker-framework/commit/cdda8038459505d6257031997bb1d4808fc1b8b8", "message": "Add Javadoc", "committedDate": "2020-07-27T14:37:05Z", "type": "commit"}, {"oid": "b4fea823f632c827cb5c4e4eb9bd7abe6c56227a", "url": "https://github.com/typetools/checker-framework/commit/b4fea823f632c827cb5c4e4eb9bd7abe6c56227a", "message": "Add nullness type annotation", "committedDate": "2020-07-27T14:39:40Z", "type": "commit"}, {"oid": "310a8e47d8add9dc0a2118703be03d0bc628da1f", "url": "https://github.com/typetools/checker-framework/commit/310a8e47d8add9dc0a2118703be03d0bc628da1f", "message": "Merge ../checker-framework-branch-master into cfgviz-documentation", "committedDate": "2020-07-28T00:18:22Z", "type": "commit"}, {"oid": "5b1614893348f3d5f56c1cf250332f29a9f11a4f", "url": "https://github.com/typetools/checker-framework/commit/5b1614893348f3d5f56c1cf250332f29a9f11a4f", "message": "Merge ../checker-framework-fork-mernst-branch-cfgviz-documentation into cfgviz-nopackage", "committedDate": "2020-07-28T00:18:30Z", "type": "commit"}, {"oid": "9056b1170907d2f1f88e6abe50452ce45f44c684", "url": "https://github.com/typetools/checker-framework/commit/9056b1170907d2f1f88e6abe50452ce45f44c684", "message": "Merge ../checker-framework-branch-master into cfgviz-documentation", "committedDate": "2020-07-29T05:20:23Z", "type": "commit"}, {"oid": "f7376940026a65b41d8e9733891d85b51705400d", "url": "https://github.com/typetools/checker-framework/commit/f7376940026a65b41d8e9733891d85b51705400d", "message": "Merge ../checker-framework-fork-mernst-branch-cfgviz-documentation into cfgviz-nopackage", "committedDate": "2020-07-29T05:20:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1MTYwMg==", "url": "https://github.com/typetools/checker-framework/pull/3516#discussion_r462651602", "bodyText": "Can this field also be protected final?", "author": "wmdietl", "createdAt": "2020-07-29T23:43:57Z", "path": "framework/src/main/java/org/checkerframework/framework/flow/CFAbstractValue.java", "diffHunk": "@@ -51,9 +55,21 @@\n     /** The analysis class this value belongs to. */\n     protected final CFAbstractAnalysis<V, ?, ?> analysis;\n \n+    /** The underlying (Java) type in this abstract value. */\n     protected final TypeMirror underlyingType;\n+    /** The annotations in this abstract value. */\n     protected final Set<AnnotationMirror> annotations;\n \n+    /** Formats annotations without their package names. */\n+    AnnotationFormatter annoFormatter = new DefaultAnnotationFormatter();", "originalCommit": "f7376940026a65b41d8e9733891d85b51705400d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1NDE2OA==", "url": "https://github.com/typetools/checker-framework/pull/3516#discussion_r462654168", "bodyText": "I'm a bit concerned about adding this field. We create many abstract values and this will make that more costly.\nWe only call toString/toStringSimple when we debug/visualize the CFG, so it would overall probably be much better to only create the formatter in toStringSimple.\nWhat do you think?", "author": "wmdietl", "createdAt": "2020-07-29T23:52:12Z", "path": "framework/src/main/java/org/checkerframework/framework/flow/CFAbstractValue.java", "diffHunk": "@@ -51,9 +55,21 @@\n     /** The analysis class this value belongs to. */\n     protected final CFAbstractAnalysis<V, ?, ?> analysis;\n \n+    /** The underlying (Java) type in this abstract value. */\n     protected final TypeMirror underlyingType;\n+    /** The annotations in this abstract value. */\n     protected final Set<AnnotationMirror> annotations;\n \n+    /** Formats annotations without their package names. */\n+    AnnotationFormatter annoFormatter = new DefaultAnnotationFormatter();", "originalCommit": "f7376940026a65b41d8e9733891d85b51705400d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5OTY3OQ==", "url": "https://github.com/typetools/checker-framework/pull/3516#discussion_r463199679", "bodyText": "I made the field static.  It has no state, but since its methods are non-static, there must be an instance of AnnotationFormatter.  But that instance can be the same for all uses.", "author": "mernst", "createdAt": "2020-07-30T18:45:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1NDE2OA=="}], "type": "inlineReview"}, {"oid": "c5b8c3b5689cbb81fb1c79999277303e154c8c42", "url": "https://github.com/typetools/checker-framework/commit/c5b8c3b5689cbb81fb1c79999277303e154c8c42", "message": "Merge ../checker-framework-branch-master into cfgviz-nopackage", "committedDate": "2020-07-30T18:40:23Z", "type": "commit"}, {"oid": "53b0b9b9c110fe552fb13616cdf0b018e260b3bb", "url": "https://github.com/typetools/checker-framework/commit/53b0b9b9c110fe552fb13616cdf0b018e260b3bb", "message": "Make defaultAnnotationFormatter field static", "committedDate": "2020-07-30T18:45:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM0MzYxMg==", "url": "https://github.com/typetools/checker-framework/pull/3516#discussion_r463343612", "bodyText": "Any reason to not make it final?\nI would probably still move this into toStringSimple, because that's the only place that uses this field and that method won't be used much. But I'm fine with a static field.", "author": "wmdietl", "createdAt": "2020-07-31T00:31:45Z", "path": "framework/src/main/java/org/checkerframework/framework/flow/CFAbstractValue.java", "diffHunk": "@@ -48,12 +51,25 @@\n  */\n public abstract class CFAbstractValue<V extends CFAbstractValue<V>> implements AbstractValue<V> {\n \n+    /** Formats annotations without their package names. */\n+    protected static DefaultAnnotationFormatter defaultAnnotationFormatter =", "originalCommit": "53b0b9b9c110fe552fb13616cdf0b018e260b3bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM0NDIxMQ==", "url": "https://github.com/typetools/checker-framework/pull/3516#discussion_r463344211", "bodyText": "Now that this method is public, we should move it to TypesUtils - the parameter type is TypeMirror, so that's where I would expect such a method.", "author": "wmdietl", "createdAt": "2020-07-31T00:34:06Z", "path": "javacutil/src/main/java/org/checkerframework/javacutil/ElementUtils.java", "diffHunk": "@@ -215,20 +215,27 @@ public static String getSimpleName(ExecutableElement element) {\n      * @param type a type\n      * @return the simple type name, without annotations\n      */\n-    private static String simpleTypeName(TypeMirror type) {\n+    public static String simpleTypeName(TypeMirror type) {", "originalCommit": "53b0b9b9c110fe552fb13616cdf0b018e260b3bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ad184f1314506ad15bcef3ec5c38c387581b623e", "url": "https://github.com/typetools/checker-framework/commit/ad184f1314506ad15bcef3ec5c38c387581b623e", "message": "Merge ../checker-framework-branch-master into cfgviz-nopackage", "committedDate": "2020-07-31T01:05:16Z", "type": "commit"}, {"oid": "e3b83db7f5a0a1befc1d6e51f6f1468c8786ad55", "url": "https://github.com/typetools/checker-framework/commit/e3b83db7f5a0a1befc1d6e51f6f1468c8786ad55", "message": "Address code review feedback", "committedDate": "2020-07-31T04:27:03Z", "type": "commit"}, {"oid": "96b6d5446471ecfb0caca3098f9a72653f7eb4a4", "url": "https://github.com/typetools/checker-framework/commit/96b6d5446471ecfb0caca3098f9a72653f7eb4a4", "message": "Merge ../checker-framework-branch-master into cfgviz-nopackage", "committedDate": "2020-07-31T05:43:42Z", "type": "commit"}]}