{"pr_number": 3481, "pr_title": "Validate instanceof types (Fixes #3033 and #762)", "pr_createdAt": "2020-07-19T17:48:25Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3481", "timeline": [{"oid": "aa831a4ec49b0be44a67d058efffdc8a35f46afe", "url": "https://github.com/typetools/checker-framework/commit/aa831a4ec49b0be44a67d058efffdc8a35f46afe", "message": "Introducing errors and warnings for use of instanceof in Nullness Checker", "committedDate": "2020-07-18T16:52:49Z", "type": "commit"}, {"oid": "0037c3a33ce532d074de5641e86d36f7101b2acd", "url": "https://github.com/typetools/checker-framework/commit/0037c3a33ce532d074de5641e86d36f7101b2acd", "message": "Applying checks only for annotated classes", "committedDate": "2020-07-19T06:07:19Z", "type": "commit"}, {"oid": "1d59c6ca2d2b265c7c18373a97e2a4634ed550c8", "url": "https://github.com/typetools/checker-framework/commit/1d59c6ca2d2b265c7c18373a97e2a4634ed550c8", "message": "Fixing errors", "committedDate": "2020-07-19T10:34:04Z", "type": "commit"}, {"oid": "416aaf0018a4343240fef9a46edde30755215b02", "url": "https://github.com/typetools/checker-framework/commit/416aaf0018a4343240fef9a46edde30755215b02", "message": "Removing import *", "committedDate": "2020-07-19T17:28:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MzgxOA==", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r457763818", "bodyText": "Could you:\n\ncall TreeUtils.annotationsFromTree()\nuse AnnotationUtils.containsSame to look for the annotations\n\nThen you don't need to change the visibility below.", "author": "wmdietl", "createdAt": "2020-07-21T00:22:24Z", "path": "checker/src/main/java/org/checkerframework/checker/nullness/NullnessVisitor.java", "diffHunk": "@@ -380,6 +381,20 @@ public Void visitIf(IfTree node, Void p) {\n         return super.visitIf(node, p);\n     }\n \n+    @Override\n+    public Void visitInstanceOf(InstanceOfTree node, Void p) {\n+        if (node.getType().getKind() == Kind.ANNOTATED_TYPE) {\n+            AnnotatedTypeMirror type = atypeFactory.fromExpression((ExpressionTree) node.getType());", "originalCommit": "416aaf0018a4343240fef9a46edde30755215b02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNjEwNg==", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r457926106", "bodyText": "Thanks for the help! I have used the above methods and reset the visibility of fromExpression to private in AnnotatedTypeFactory.", "author": "aditya3434", "createdAt": "2020-07-21T08:27:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MzgxOA=="}], "type": "inlineReview"}, {"oid": "edec7f72c4db977cbab0577d966cd1e012ee3879", "url": "https://github.com/typetools/checker-framework/commit/edec7f72c4db977cbab0577d966cd1e012ee3879", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-07-21T07:43:09Z", "type": "commit"}, {"oid": "cb4d4afa13a8d7cb9bb954b4c093110b82948920", "url": "https://github.com/typetools/checker-framework/commit/cb4d4afa13a8d7cb9bb954b4c093110b82948920", "message": "Requested changes", "committedDate": "2020-07-21T07:44:11Z", "type": "commit"}, {"oid": "fb2f36f33044fbd9c662dc59230e15171d43bda6", "url": "https://github.com/typetools/checker-framework/commit/fb2f36f33044fbd9c662dc59230e15171d43bda6", "message": "Removing import *", "committedDate": "2020-07-21T08:34:23Z", "type": "commit"}, {"oid": "1bb83f218bf81e4452ac8490a1e76ab714d47589", "url": "https://github.com/typetools/checker-framework/commit/1bb83f218bf81e4452ac8490a1e76ab714d47589", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-07-22T07:57:58Z", "type": "commit"}, {"oid": "5027ea45e997957b08d56d3ce43607991538fa8b", "url": "https://github.com/typetools/checker-framework/commit/5027ea45e997957b08d56d3ce43607991538fa8b", "message": "Adding test case", "committedDate": "2020-07-22T07:58:23Z", "type": "commit"}, {"oid": "9258b91685f5f44013c19bc6e5b7ef0f0f76ec3f", "url": "https://github.com/typetools/checker-framework/commit/9258b91685f5f44013c19bc6e5b7ef0f0f76ec3f", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-07-27T08:01:23Z", "type": "commit"}, {"oid": "f6f9cf8fe5a135b9c0006cbb622c5c7087e934df", "url": "https://github.com/typetools/checker-framework/commit/f6f9cf8fe5a135b9c0006cbb622c5c7087e934df", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-07-31T06:33:06Z", "type": "commit"}, {"oid": "27e5621fcfd386a85ce3976c766dcb0e922eb8f3", "url": "https://github.com/typetools/checker-framework/commit/27e5621fcfd386a85ce3976c766dcb0e922eb8f3", "message": "Adding general checks", "committedDate": "2020-07-31T08:57:14Z", "type": "commit"}, {"oid": "4483f786d4a75ac565b6497bd7c5aa5be0323b83", "url": "https://github.com/typetools/checker-framework/commit/4483f786d4a75ac565b6497bd7c5aa5be0323b83", "message": "Adding test case", "committedDate": "2020-08-03T08:09:52Z", "type": "commit"}, {"oid": "78254a512b40095845e5f9f805b7a1367588e86f", "url": "https://github.com/typetools/checker-framework/commit/78254a512b40095845e5f9f805b7a1367588e86f", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-03T08:11:01Z", "type": "commit"}, {"oid": "cd9ed4f24b9509f7610a740ddea8785257668894", "url": "https://github.com/typetools/checker-framework/commit/cd9ed4f24b9509f7610a740ddea8785257668894", "message": "Formatting changes", "committedDate": "2020-08-03T09:09:30Z", "type": "commit"}, {"oid": "f3fde1548cec8e41efadb6554575dc260ce45cd7", "url": "https://github.com/typetools/checker-framework/commit/f3fde1548cec8e41efadb6554575dc260ce45cd7", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-09T10:09:16Z", "type": "commit"}, {"oid": "e9affb635d0fde6d71657c04d4f5fc015b0153b1", "url": "https://github.com/typetools/checker-framework/commit/e9affb635d0fde6d71657c04d4f5fc015b0153b1", "message": "Fixing merge conflicts", "committedDate": "2020-08-09T15:14:24Z", "type": "commit"}, {"oid": "f664c8cf7845baf95125e266b137e3adac8b8b31", "url": "https://github.com/typetools/checker-framework/commit/f664c8cf7845baf95125e266b137e3adac8b8b31", "message": "Removing .*", "committedDate": "2020-08-10T11:32:31Z", "type": "commit"}, {"oid": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c", "url": "https://github.com/typetools/checker-framework/commit/429a06a84cf6e1103b3e6350dc478b7fc6a4e40c", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-11T08:28:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNTYzMw==", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r469605633", "bodyText": "\".error\" makes this key longer without making it more informative.  I suggest shortening the key.", "author": "mernst", "createdAt": "2020-08-12T23:38:20Z", "path": "checker/src/main/java/org/checkerframework/checker/nullness/messages.properties", "diffHunk": "@@ -16,3 +16,5 @@ new.class.type.invalid=the annotations %s do not need be applied in object creat\n toArray.nullable.elements.not.newarray=call of toArray on collection of non-null elements yields an array of possibly-null elements; omit the argument to toArray or make it an explicit array constructor\n toArray.nullable.elements.mismatched.size=call of toArray on collection of non-null elements yields an array of possibly-null elements; cannot determine that the argument array has the same size as the receiver collection\n clear.system.property=call might clear a predefined system property; pass -Alint=permitClearProperty to permit it\n+instanceof.nullable.error=instanceof is only true for a non-null expression", "originalCommit": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNTY3NQ==", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r469605675", "bodyText": "I find this error message confusing.  The only point of performing x instanceof C is when C is a subtype of x's compile-time type, so it's weird for the message to say only that.\nI think this message is trying to say that, at run time, instanceof will not check the annotations.  Please make it do so.  That is similar to the \"cast.unsafe\" message earlier in the file.  You could make the error key \"instanceof.unsafe\" for parallelism.\nAlso, please use standard terms in the diagnostic message.  The JLS uses \"expression\" where you use \"operand\"", "author": "mernst", "createdAt": "2020-08-12T23:38:26Z", "path": "framework/src/main/java/org/checkerframework/common/basetype/messages.properties", "diffHunk": "@@ -111,3 +111,4 @@ field.invariant.not.found.superclass=the field invariant annotation is missing f\n field.invariant.not.subtype.superclass=the qualifier for field %s is not a subtype of the qualifier in the superclass field invariant%nfound: %s%nsuperclass type: %s\n \n invalid.annotation.location.bytecode=found annotation in unexpected location in bytecode on element: %s %nUse -AignoreInvalidAnnotationLocations to suppress this warning\n+operand.instanceof.subtype=reference type is a subtype of the operand type.%nOperand Type : %s%nReference Type : %s", "originalCommit": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fb26e9460d35050390e71df87fdbe2d003ec5700", "url": "https://github.com/typetools/checker-framework/commit/fb26e9460d35050390e71df87fdbe2d003ec5700", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-13T09:03:30Z", "type": "commit"}, {"oid": "34bba132086f751fac0d5d772440eb6a380e402f", "url": "https://github.com/typetools/checker-framework/commit/34bba132086f751fac0d5d772440eb6a380e402f", "message": "Changing error messages", "committedDate": "2020-08-13T12:11:07Z", "type": "commit"}, {"oid": "9fd5bffcb0b4428a73b96fb4c99dda92477f7d08", "url": "https://github.com/typetools/checker-framework/commit/9fd5bffcb0b4428a73b96fb4c99dda92477f7d08", "message": "Merge ../checker-framework-branch-master into issue3033", "committedDate": "2020-08-13T19:32:29Z", "type": "commit"}, {"oid": "df8a8de343370fb84c3cf21c75d296a10cb4f35a", "url": "https://github.com/typetools/checker-framework/commit/df8a8de343370fb84c3cf21c75d296a10cb4f35a", "message": "Merge branch 'issue3033' of https://github.com/aditya3434/checker-framework into issue3033", "committedDate": "2020-08-14T10:36:23Z", "type": "commit"}, {"oid": "daad1e9bce16f8e54525e86793ac422375b85658", "url": "https://github.com/typetools/checker-framework/commit/daad1e9bce16f8e54525e86793ac422375b85658", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-15T04:14:33Z", "type": "commit"}, {"oid": "e6a881d56e72ac49f3458c2d00bf160ec484ef39", "url": "https://github.com/typetools/checker-framework/commit/e6a881d56e72ac49f3458c2d00bf160ec484ef39", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-21T05:25:52Z", "type": "commit"}, {"oid": "93c7201610620b8025b584bb5408409a959693e8", "url": "https://github.com/typetools/checker-framework/commit/93c7201610620b8025b584bb5408409a959693e8", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-26T09:02:29Z", "type": "commit"}, {"oid": "ab6f6f980fb5a241cd723b4c51bd75fd68504009", "url": "https://github.com/typetools/checker-framework/commit/ab6f6f980fb5a241cd723b4c51bd75fd68504009", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-29T06:15:51Z", "type": "commit"}, {"oid": "c50faabf06523defdf41bd3d1ce9c7431ae08c2c", "url": "https://github.com/typetools/checker-framework/commit/c50faabf06523defdf41bd3d1ce9c7431ae08c2c", "message": "Merge branch 'master' into issue3033", "committedDate": "2020-08-30T11:36:31Z", "type": "commit"}, {"oid": "6804f3056f8b03bc0d07389b7e82f3c91d7dbe04", "url": "https://github.com/typetools/checker-framework/commit/6804f3056f8b03bc0d07389b7e82f3c91d7dbe04", "message": "Tweak variable names", "committedDate": "2020-09-08T19:13:49Z", "type": "commit"}, {"oid": "fa8a97e3bef53336ce4896d93a28caed2576bfc0", "url": "https://github.com/typetools/checker-framework/commit/fa8a97e3bef53336ce4896d93a28caed2576bfc0", "message": "Merge ../checker-framework-branch-master into issue3033", "committedDate": "2020-09-08T19:14:44Z", "type": "commit"}]}