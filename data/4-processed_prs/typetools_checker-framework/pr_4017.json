{"pr_number": 4017, "pr_title": "Improve AnnotationFileParser diagnostics", "pr_createdAt": "2020-12-13T21:55:06Z", "pr_url": "https://github.com/typetools/checker-framework/pull/4017", "timeline": [{"oid": "2f59d9ed7c9e9e7bd264224e2d0005a65a91433e", "url": "https://github.com/typetools/checker-framework/commit/2f59d9ed7c9e9e7bd264224e2d0005a65a91433e", "message": "AnnotationFileParser diagnostics", "committedDate": "2020-12-13T19:06:51Z", "type": "commit"}, {"oid": "3f5b793663ba7f96f0c92c152c5b6e286a39de02", "url": "https://github.com/typetools/checker-framework/commit/3f5b793663ba7f96f0c92c152c5b6e286a39de02", "message": "Merge ../checker-framework-branch-master into AnnotationFileParser-diagnostics", "committedDate": "2020-12-14T17:10:56Z", "type": "commit"}, {"oid": "0ed282e454df73d4a5936a556313636c65782af6", "url": "https://github.com/typetools/checker-framework/commit/0ed282e454df73d4a5936a556313636c65782af6", "message": "If only one message, put it on the first line", "committedDate": "2020-12-14T17:12:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY2OTE4Mg==", "url": "https://github.com/typetools/checker-framework/pull/4017#discussion_r542669182", "bodyText": "I don't understand why this is disabled.", "author": "smillst", "createdAt": "2020-12-14T19:16:42Z", "path": "framework/src/main/java/org/checkerframework/framework/stub/AnnotationFileParser.java", "diffHunk": "@@ -1315,6 +1330,14 @@ private void recordDeclAnnotation(\n                     // `annoMirror` is applicable to `elt`\n                     annos.add(annoMirror);\n                 }\n+            } else {\n+                // TODO: Warn about what file it was found in.\n+                if (false) {\n+                    stubWarnNotFound(", "originalCommit": "0ed282e454df73d4a5936a556313636c65782af6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY3MDM2NA==", "url": "https://github.com/typetools/checker-framework/pull/4017#discussion_r542670364", "bodyText": "The field filename can be used for this.  Maybe all AnnotationFileParser warnings should report the filename?", "author": "smillst", "createdAt": "2020-12-14T19:17:51Z", "path": "framework/src/main/java/org/checkerframework/framework/stub/AnnotationFileParser.java", "diffHunk": "@@ -1284,7 +1298,8 @@ private void annotate(AnnotatedTypeMirror type, List<AnnotationExpr> annotations\n             if (annoMirror != null) {\n                 type.replaceAnnotation(annoMirror);\n             } else {\n-                stubWarnNotFound(\"Unknown annotation: \" + annotation);\n+                // TODO: Be more specific: In what file?", "originalCommit": "0ed282e454df73d4a5936a556313636c65782af6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9ead4b3c74e5c7ebe74bc43253954883e133a1dd", "url": "https://github.com/typetools/checker-framework/commit/9ead4b3c74e5c7ebe74bc43253954883e133a1dd", "message": "Give filename in messages", "committedDate": "2020-12-14T19:26:33Z", "type": "commit"}, {"oid": "2a7a898466ff37aa4ce08fa109728f3cbda35dc6", "url": "https://github.com/typetools/checker-framework/commit/2a7a898466ff37aa4ce08fa109728f3cbda35dc6", "message": "Update expected output (wrongly, with filesystem-specific path)", "committedDate": "2020-12-14T19:32:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY5MDUwMQ==", "url": "https://github.com/typetools/checker-framework/pull/4017#discussion_r542690501", "bodyText": "@smillst Do you know offhand how to write this test so it will pass on all file systems?  (One way would be to add a flag, used only for debugging, that disables this output.)", "author": "mernst", "createdAt": "2020-12-14T19:35:48Z", "path": "checker/jtreg/stubs/issue2059/AnnoNotFound.out", "diffHunk": "@@ -1,2 +1,2 @@\n-- compiler.warn.proc.messager: AnnotationFileParser: Unknown annotation: @Nullable\n+- compiler.warn.proc.messager: AnnotationFileParser: Unknown annotation @Nullable in /home/mernst/research/types/checker-framework-fork-mernst-branch-AnnotationFileParser-diagnostics/checker/jtreg/stubs/issue2059/AnnoNotFound.astub", "originalCommit": "2a7a898466ff37aa4ce08fa109728f3cbda35dc6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjcyMzE5Ng==", "url": "https://github.com/typetools/checker-framework/pull/4017#discussion_r542723196", "bodyText": "Maybe if -Anomsgtext is passed, then don't output the filename?", "author": "smillst", "createdAt": "2020-12-14T20:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY5MDUwMQ=="}], "type": "inlineReview"}, {"oid": "cd4f0c131063bbad1c0c8e49dba92eb1a8ddc0b6", "url": "https://github.com/typetools/checker-framework/commit/cd4f0c131063bbad1c0c8e49dba92eb1a8ddc0b6", "message": "Don't output file name if -Anomsgtext is passed", "committedDate": "2020-12-14T20:39:07Z", "type": "commit"}, {"oid": "46b7c7a1cfe40b29c83deac22148ea1a42c0ed28", "url": "https://github.com/typetools/checker-framework/commit/46b7c7a1cfe40b29c83deac22148ea1a42c0ed28", "message": "Give file name and line number in error messages", "committedDate": "2020-12-15T03:54:13Z", "type": "commit"}, {"oid": "3fc61a815902bf7b37f12ef5e2861ad15a27d0d1", "url": "https://github.com/typetools/checker-framework/commit/3fc61a815902bf7b37f12ef5e2861ad15a27d0d1", "message": "Merge ../checker-framework-branch-master into AnnotationFileParser-diagnostics", "committedDate": "2020-12-15T04:42:14Z", "type": "commit"}, {"oid": "fa57a5478b8b098805f6d7ca6e86f0f58d685ff9", "url": "https://github.com/typetools/checker-framework/commit/fa57a5478b8b098805f6d7ca6e86f0f58d685ff9", "message": "Fix jtreg tests", "committedDate": "2020-12-15T05:11:19Z", "type": "commit"}, {"oid": "89537ee3c56daf62693db4c7dda053b8f538ce19", "url": "https://github.com/typetools/checker-framework/commit/89537ee3c56daf62693db4c7dda053b8f538ce19", "message": "Update AnnotationFileParser warnings", "committedDate": "2020-12-15T05:16:15Z", "type": "commit"}, {"oid": "a34ecc758d1f7338fb5f9dd33c81669950083cbb", "url": "https://github.com/typetools/checker-framework/commit/a34ecc758d1f7338fb5f9dd33c81669950083cbb", "message": "Add Javadoc", "committedDate": "2020-12-15T13:54:03Z", "type": "commit"}, {"oid": "8216f2336f2f7c7f17c1724ecbcd101aed62d16c", "url": "https://github.com/typetools/checker-framework/commit/8216f2336f2f7c7f17c1724ecbcd101aed62d16c", "message": "Test ouput", "committedDate": "2020-12-15T14:46:38Z", "type": "commit"}, {"oid": "3b84d40d559df1cec8ae07ec3c03e699bc93275f", "url": "https://github.com/typetools/checker-framework/commit/3b84d40d559df1cec8ae07ec3c03e699bc93275f", "message": "Don't show absolute path", "committedDate": "2020-12-15T15:04:27Z", "type": "commit"}, {"oid": "12ec9aa033550f53ad5834762bbb794f0b458859", "url": "https://github.com/typetools/checker-framework/commit/12ec9aa033550f53ad5834762bbb794f0b458859", "message": "Merge ../checker-framework-fork-mernst-branch-jtreg-missing into AnnotationFileParser-diagnostics", "committedDate": "2020-12-15T15:32:33Z", "type": "commit"}, {"oid": "4e7cce9461aed838550088f99a3baf2722661851", "url": "https://github.com/typetools/checker-framework/commit/4e7cce9461aed838550088f99a3baf2722661851", "message": "Make output deterministic", "committedDate": "2020-12-15T16:21:36Z", "type": "commit"}, {"oid": "c8f2267ed7acd1c0ac4078df4068f8c611e5d764", "url": "https://github.com/typetools/checker-framework/commit/c8f2267ed7acd1c0ac4078df4068f8c611e5d764", "message": "Merge ../checker-framework-branch-master into AnnotationFileParser-diagnostics", "committedDate": "2020-12-15T16:31:16Z", "type": "commit"}]}