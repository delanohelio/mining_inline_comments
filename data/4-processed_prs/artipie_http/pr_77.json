{"pr_number": 77, "pr_title": "116 1", "pr_createdAt": "2020-03-16T13:07:34Z", "pr_url": "https://github.com/artipie/http/pull/77", "timeline": [{"oid": "2d35b0623e4515debcfa12a0b26cd1ff076886dc", "url": "https://github.com/artipie/http/commit/2d35b0623e4515debcfa12a0b26cd1ff076886dc", "message": "resolve #116", "committedDate": "2020-03-16T12:11:35Z", "type": "commit"}, {"oid": "3e57d37d0a783eaead9cd265975d11223751c5c5", "url": "https://github.com/artipie/http/commit/3e57d37d0a783eaead9cd265975d11223751c5c5", "message": "fix lint", "committedDate": "2020-03-16T13:05:16Z", "type": "commit"}, {"oid": "696632f353e7d1b42ff0ce99251e9a6e0875686f", "url": "https://github.com/artipie/http/commit/696632f353e7d1b42ff0ce99251e9a6e0875686f", "message": "concat headers", "committedDate": "2020-03-16T14:12:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNTQ5MQ==", "url": "https://github.com/artipie/http/pull/77#discussion_r393425491", "bodyText": "@Guseyn Here we are adding new headers instead of overriding them as the javadoc says, is that right?", "author": "paulodamaso", "createdAt": "2020-03-17T03:27:16Z", "path": "src/main/java/com/artipie/http/rs/RsWithHeaders.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+\n+package com.artipie.http.rs;\n+\n+import com.artipie.http.Connection;\n+import com.artipie.http.Response;\n+import com.google.common.collect.Iterables;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import java.util.concurrent.CompletionStage;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * RsWithHeaders.\n+ *\n+ * @since 0.1\n+ */\n+public final class RsWithHeaders implements Response {\n+\n+    /**\n+     * Origin response.\n+     */\n+    private final Response origin;\n+\n+    /**\n+     * Headers.\n+     */\n+    private final Iterable<Map.Entry<String, String>> headers;\n+\n+    /**\n+     * Ctor.\n+     *\n+     * @param origin Response\n+     * @param headers Headers\n+     */\n+    public RsWithHeaders(\n+        final Response origin,\n+        final Iterable<Map.Entry<String, String>> headers) {\n+        this.origin = origin;\n+        this.headers = headers;\n+    }\n+\n+    @Override\n+    public CompletionStage<Void> send(final Connection con) {\n+        return this.origin.send(new RsWithHeaders.ConWithHeaders(con, this.headers));\n+    }\n+\n+    /**\n+     * Connection with overridden headers.\n+     * @since 0.3\n+     */\n+    private static final class ConWithHeaders implements Connection {\n+\n+        /**\n+         * Origin connection.\n+         */\n+        private final Connection origin;\n+\n+        /**\n+         * New headers.\n+         */\n+        private final Iterable<Map.Entry<String, String>> headers;\n+\n+        /**\n+         * Ctor.\n+         *\n+         * @param origin Connection\n+         * @param headers Headers\n+         */\n+        private ConWithHeaders(\n+            final Connection origin,\n+            final Iterable<Map.Entry<String, String>> headers) {\n+            this.origin = origin;\n+            this.headers = headers;\n+        }\n+\n+        @Override\n+        public CompletionStage<Void> accept(\n+            final RsStatus status,\n+            final Iterable<Map.Entry<String, String>> hrs,\n+            final Publisher<ByteBuffer> body) {\n+            return this.origin.accept(status, Iterables.concat(this.headers, hrs), body);", "originalCommit": "696632f353e7d1b42ff0ce99251e9a6e0875686f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3ODM5Ng==", "url": "https://github.com/artipie/http/pull/77#discussion_r393478396", "bodyText": "@paulodamaso sure, I will update the java docs", "author": "Guseyn", "createdAt": "2020-03-17T07:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNTQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3OTA0MQ==", "url": "https://github.com/artipie/http/pull/77#discussion_r393479041", "bodyText": "@paulodamaso fixed.", "author": "Guseyn", "createdAt": "2020-03-17T07:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNTQ5MQ=="}], "type": "inlineReview"}, {"oid": "4471efd5981abc708376d567acea97909ccc67cf", "url": "https://github.com/artipie/http/commit/4471efd5981abc708376d567acea97909ccc67cf", "message": "fix javadoc", "committedDate": "2020-03-17T07:07:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4NzAwNQ==", "url": "https://github.com/artipie/http/pull/77#discussion_r393787005", "bodyText": "@Guseyn can we add additional constructor with single key-value header, e.g. RsWithHeaders(Response origin, String name, String value)? It seems this constructor will be more popular than with Iterable<Map.Entry<String, String>>", "author": "g4s8", "createdAt": "2020-03-17T15:57:52Z", "path": "src/main/java/com/artipie/http/rs/RsWithHeaders.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+\n+package com.artipie.http.rs;\n+\n+import com.artipie.http.Connection;\n+import com.artipie.http.Response;\n+import com.google.common.collect.Iterables;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import java.util.concurrent.CompletionStage;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * RsWithHeaders.\n+ *\n+ * @since 0.1\n+ */\n+public final class RsWithHeaders implements Response {\n+\n+    /**\n+     * Origin response.\n+     */\n+    private final Response origin;\n+\n+    /**\n+     * Headers.\n+     */\n+    private final Iterable<Map.Entry<String, String>> headers;\n+\n+    /**\n+     * Ctor.\n+     *\n+     * @param origin Response\n+     * @param headers Headers\n+     */\n+    public RsWithHeaders(", "originalCommit": "4471efd5981abc708376d567acea97909ccc67cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4NzY4NA==", "url": "https://github.com/artipie/http/pull/77#discussion_r393787684", "bodyText": "@Guseyn there should be next minor version", "author": "g4s8", "createdAt": "2020-03-17T15:58:44Z", "path": "src/main/java/com/artipie/http/rs/RsWithHeaders.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+\n+package com.artipie.http.rs;\n+\n+import com.artipie.http.Connection;\n+import com.artipie.http.Response;\n+import com.google.common.collect.Iterables;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import java.util.concurrent.CompletionStage;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * RsWithHeaders.\n+ *\n+ * @since 0.1", "originalCommit": "4471efd5981abc708376d567acea97909ccc67cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "78bc60ede3d8756ffa587a49ba35fdd55ad27c9f", "url": "https://github.com/artipie/http/commit/78bc60ede3d8756ffa587a49ba35fdd55ad27c9f", "message": "additional ctor for RsWithHeaders", "committedDate": "2020-03-18T10:13:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2MzcxMQ==", "url": "https://github.com/artipie/http/pull/77#discussion_r394263711", "bodyText": "@Guseyn can we avoid using {{ add(..); }} here?", "author": "g4s8", "createdAt": "2020-03-18T11:01:51Z", "path": "src/main/java/com/artipie/http/rs/RsWithHeaders.java", "diffHunk": "@@ -62,6 +64,18 @@ public RsWithHeaders(\n         this.headers = headers;\n     }\n \n+    /**\n+     * Ctor.\n+     *\n+     * @param origin Response\n+     */\n+    public RsWithHeaders(Response origin, String name, String value) {\n+        this.origin = origin;\n+        this.headers = new ArrayList<Map.Entry<String, String>>(){{\n+            add(new MapEntry<>(name, value));", "originalCommit": "78bc60ede3d8756ffa587a49ba35fdd55ad27c9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4ODg3Nw==", "url": "https://github.com/artipie/http/pull/77#discussion_r394288877", "bodyText": "@g4s8 done.", "author": "Guseyn", "createdAt": "2020-03-18T11:50:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2MzcxMQ=="}], "type": "inlineReview"}, {"oid": "d1a68b8f4061935ecb1410daa1996b4818e27ca7", "url": "https://github.com/artipie/http/commit/d1a68b8f4061935ecb1410daa1996b4818e27ca7", "message": "rs with headers: fix lint", "committedDate": "2020-03-18T11:29:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4MTc1NA==", "url": "https://github.com/artipie/http/pull/77#discussion_r394281754", "bodyText": "@Guseyn please improve javadocs for class", "author": "g4s8", "createdAt": "2020-03-18T11:36:25Z", "path": "src/main/java/com/artipie/http/rs/RsWithHeaders.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+\n+package com.artipie.http.rs;\n+\n+import com.artipie.http.Connection;\n+import com.artipie.http.Response;\n+import com.google.common.collect.Iterables;\n+import java.nio.ByteBuffer;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.concurrent.CompletionStage;\n+import org.cactoos.map.MapEntry;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * RsWithHeaders.", "originalCommit": "d1a68b8f4061935ecb1410daa1996b4818e27ca7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4OTAwNQ==", "url": "https://github.com/artipie/http/pull/77#discussion_r394289005", "bodyText": "@g4s8 done.", "author": "Guseyn", "createdAt": "2020-03-18T11:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4MTc1NA=="}], "type": "inlineReview"}, {"oid": "a17f884a946932f7cc7ce634a14e82da88402b77", "url": "https://github.com/artipie/http/commit/a17f884a946932f7cc7ce634a14e82da88402b77", "message": "fixed", "committedDate": "2020-03-18T11:49:40Z", "type": "commit"}, {"oid": "568022f44e0e74ebe5174e64d6bb2233a3b32c3e", "url": "https://github.com/artipie/http/commit/568022f44e0e74ebe5174e64d6bb2233a3b32c3e", "message": "fix version", "committedDate": "2020-03-18T11:53:01Z", "type": "commit"}]}