{"pr_number": 2304, "pr_title": "fix #1803 instrumenting onNext in MonoMetrics", "pr_createdAt": "2020-08-05T16:20:33Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2304", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzMTc5NQ==", "url": "https://github.com/reactor/reactor-core/pull/2304#discussion_r466531795", "bodyText": "status=completed and status=completedEmpty", "author": "simonbasle", "createdAt": "2020-08-06T16:21:46Z", "path": "docs/asciidoc/metrics.adoc", "diffHunk": "@@ -88,14 +88,17 @@ Just adding these two operators will expose a whole bunch of useful metrics!\n \n | [name].onNext.delay | Timer | Measures delays between onNext signals (or between onSubscribe and first onNext)\n \n-| [name].flow.duration | Timer | Times the duration elapsed between a subscription and the termination or cancellation of the sequence. A status tag is added to specify what event caused the timer to end (`onComplete`, `onError`, `cancel`).\n+| [name].flow.duration | Timer | Times the duration elapsed between a subscription and the termination or cancellation of the sequence. A status tag is added to specify what event caused the timer to end (`onComplete`, `onCompleteEmpty`, `onError`, `cancel`).\n |=======\n \n+\n+\n Want to know how many times your event processing has restarted due to some error? Read `reactor.subscribed`, because `retry()` operator will re-subscribe to the source publisher on error.\n \n Interested in \"events per second\" metric? Measure the rate of `reactor.onNext.delay` 's count.\n \n Want to be alerted when the listener throws an error? `reactor.flow.duration` with `status=error` tag is your friend.\n+Similarly, `status=onComplete` and `status=onCompleteEmpty` will allow you to distinguish sequences that completed with elements from sequences that completed empty.", "originalCommit": "ad76461552b0031f977c834b880ddf249df7ff48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzMTgyMw==", "url": "https://github.com/reactor/reactor-core/pull/2304#discussion_r466531823", "bodyText": "actually, this documentation is wrong. the status values are completed, cancelled completedEmpty and error \ud83d\ude22 for the 3 old possible values, this was already wrong in 3.2 documentation though...", "author": "simonbasle", "createdAt": "2020-08-06T16:21:49Z", "path": "docs/asciidoc/metrics.adoc", "diffHunk": "@@ -88,14 +88,17 @@ Just adding these two operators will expose a whole bunch of useful metrics!\n \n | [name].onNext.delay | Timer | Measures delays between onNext signals (or between onSubscribe and first onNext)\n \n-| [name].flow.duration | Timer | Times the duration elapsed between a subscription and the termination or cancellation of the sequence. A status tag is added to specify what event caused the timer to end (`onComplete`, `onError`, `cancel`).\n+| [name].flow.duration | Timer | Times the duration elapsed between a subscription and the termination or cancellation of the sequence. A status tag is added to specify what event caused the timer to end (`onComplete`, `onCompleteEmpty`, `onError`, `cancel`).", "originalCommit": "ad76461552b0031f977c834b880ddf249df7ff48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzMTk1Mg==", "url": "https://github.com/reactor/reactor-core/pull/2304#discussion_r466531952", "bodyText": "the status values are wrong here", "author": "simonbasle", "createdAt": "2020-08-06T16:22:04Z", "path": "reactor-core/src/main/java/reactor/core/publisher/FluxMetrics.java", "diffHunk": "@@ -220,7 +226,7 @@ public Object scanUnsafe(Attr key) {\n \tstatic final String METER_SUBSCRIBED     = \".subscribed\";\n \t/**\n \t * Meter that times the duration elapsed between a subscription and the termination or cancellation of the sequence.\n-\t * A status tag is added to specify what event caused the timer to end (onComplete, onError, cancel).\n+\t * A status tag is added to specify what event caused the timer to end (onComplete, onCompleteEmpty, onError, cancel).", "originalCommit": "ad76461552b0031f977c834b880ddf249df7ff48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d4158f461a0cd8ee8f3a05f8039bab857f5e99f6", "url": "https://github.com/reactor/reactor-core/commit/d4158f461a0cd8ee8f3a05f8039bab857f5e99f6", "message": "fix #1803 Differentiate empty vs valued sequences in metrics via tag\n\nThis commit changes the status tag associated with completion on the\nreactor.flow.duration Timer to differentiate the case where the Flux\nor Mono completed without a single `onNext` (`status=completedEmpty`)\nfrom the case where data was emitted (`status=completed`).", "committedDate": "2020-08-07T14:08:37Z", "type": "commit"}, {"oid": "d4158f461a0cd8ee8f3a05f8039bab857f5e99f6", "url": "https://github.com/reactor/reactor-core/commit/d4158f461a0cd8ee8f3a05f8039bab857f5e99f6", "message": "fix #1803 Differentiate empty vs valued sequences in metrics via tag\n\nThis commit changes the status tag associated with completion on the\nreactor.flow.duration Timer to differentiate the case where the Flux\nor Mono completed without a single `onNext` (`status=completedEmpty`)\nfrom the case where data was emitted (`status=completed`).", "committedDate": "2020-08-07T14:08:37Z", "type": "forcePushed"}]}