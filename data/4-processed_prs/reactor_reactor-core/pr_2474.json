{"pr_number": 2474, "pr_title": "fix #2470 Make refguide BOM snippets use version from gradle.properties", "pr_createdAt": "2020-11-03T11:20:31Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2474", "timeline": [{"oid": "209c4426fc8c7dd9aace0f5b61545b43abc42bb5", "url": "https://github.com/reactor/reactor-core/commit/209c4426fc8c7dd9aace0f5b61545b43abc42bb5", "message": "fix #2470 Make refguide BOM snippets attribute-based, bump via gradle\n\nThis commit adds a document attribute to the gettingStarted.adoc file\nto store the BOM version displayed in Maven/Gradle snippets.\n\nAdditionally, the `bumpVersionsInReadme` Gradle task now copies that\nfile and perform variable substitution, replacing the previous version\nwith whichever BOM version is passed to the command line using\n `-PbomVersion=SOMETHING` (only affecting the attribute declaration).\n\nIf the attribute is not defined, no substitution should occur.", "committedDate": "2020-11-03T11:19:33Z", "type": "commit"}, {"oid": "a5dafb0f983da4f963e0543cb4d9e48ec3ba8000", "url": "https://github.com/reactor/reactor-core/commit/a5dafb0f983da4f963e0543cb4d9e48ec3ba8000", "message": "Polish #2470 to reflect the current 3.3.x latest BOM", "committedDate": "2020-11-03T11:23:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3ODA5OA==", "url": "https://github.com/reactor/reactor-core/pull/2474#discussion_r516678098", "bodyText": "I suggest passing the attribute directly via the asciidoc plugin, ie \n  \n    \n      reactor-core/gradle/asciidoc.gradle\n    \n    \n         Line 44\n      in\n      4bdfbd3\n    \n    \n    \n    \n\n        \n          \n           attributes 'allow-uri-read': '',", "author": "ericbottard", "createdAt": "2020-11-03T13:48:56Z", "path": "gradle/releaser.gradle", "diffHunk": "@@ -55,25 +55,40 @@ task copyReadme(type: Copy, group: \"releaser helpers\", description: \"copies the\n \tinto rootProject.buildDir\n }\n \n+task copyGettingStarted(type: Copy, group: \"releaser helpers\", description: \"copies the gettingStarted.adoc in preparation for search and replace\") {\n+\tfrom(rootProject.rootDir) {\n+\t\tinclude \"docs/asciidoc/gettingStarted.adoc\"\n+\t}\n+\tinto rootProject.buildDir\n+}\n+\n task bumpVersionsInReadme(type: Copy, group: \"releaser helpers\", description: \"replaces versions in README\") {\n+\tdef bomVersion = rootProject.findProperty(\"bomVersion\")\n \tdef oldVersion = rootProject.findProperty(\"oldVersion\")\n \tdef currentVersion = rootProject.findProperty(\"currentVersion\")\n \tdef nextVersion = rootProject.findProperty(\"nextVersion\")\n \tdef oldSnapshot = currentVersion?.replace(\"RELEASE\", \"BUILD-SNAPSHOT\")\n \n \tonlyIf { oldVersion != null && currentVersion != null && nextVersion != null }\n \tdependsOn copyReadme\n+\tdependsOn copyGettingStarted\n \n \tdoLast {\n \t\tprintln \"Will replace $oldVersion with $currentVersion and $oldSnapshot with $nextVersion\"\n+\t\tif (bomVersion == null) println \"No `bomVersion` set, will not change bom version in gettingStarted.adoc\"\n+\t\telse println \"Will change bomVersion in gettingStarted.adoc to $bomVersion\"\n \t}\n \tfrom(rootProject.buildDir) {\n \t\tinclude 'README.md'\n+\t\tinclude \"docs/asciidoc/gettingStarted.adoc\"\n \t}\n \tinto rootProject.rootDir\n-\tfilter { line -> line\n-\t\t.replace(oldVersion, currentVersion)\n-\t\t.replace(oldSnapshot, nextVersion)\n+\tfilter { line -> (bomVersion == null) ?\n+\t\tline.replace(oldVersion, currentVersion)\n+\t\t\t.replace(oldSnapshot, nextVersion) :\n+\t\tline.replace(oldVersion, currentVersion)\n+\t\t\t.replace(oldSnapshot, nextVersion)\n+\t\t\t.replaceAll(\"\\\\:reactorReleaseTrain\\\\: .*\", \":reactorReleaseTrain: \" + bomVersion)", "originalCommit": "a5dafb0f983da4f963e0543cb4d9e48ec3ba8000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcyNzQ3OA==", "url": "https://github.com/reactor/reactor-core/pull/2474#discussion_r516727478", "bodyText": "let's put it in the gradle.properties then, and a manual step on top of the README bump task", "author": "simonbasle", "createdAt": "2020-11-03T14:54:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3ODA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjczMTEyNw==", "url": "https://github.com/reactor/reactor-core/pull/2474#discussion_r516731127", "bodyText": "updated", "author": "simonbasle", "createdAt": "2020-11-03T14:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3ODA5OA=="}], "type": "inlineReview"}, {"oid": "5d8bea4da4cc0ac02cd6ca49e4a707a3e7b94fce", "url": "https://github.com/reactor/reactor-core/commit/5d8bea4da4cc0ac02cd6ca49e4a707a3e7b94fce", "message": "switch to using gradle.properties and passing the attribute via gradle plugin", "committedDate": "2020-11-03T14:56:12Z", "type": "commit"}, {"oid": "39ad59e219ca2648f79d4d5251193d8b559acffc", "url": "https://github.com/reactor/reactor-core/commit/39ad59e219ca2648f79d4d5251193d8b559acffc", "message": "remove leftover of previous task", "committedDate": "2020-11-03T14:57:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc5ODkyNw==", "url": "https://github.com/reactor/reactor-core/pull/2474#discussion_r516798927", "bodyText": "wouldn't it be better to link to https://projectreactor.io/docs that contains both the release train + core's version?", "author": "bsideup", "createdAt": "2020-11-03T16:31:07Z", "path": "docs/asciidoc/gettingStarted.adoc", "diffHunk": "@@ -83,20 +83,25 @@ However, if you want to force the use of a specific artifact's version, you can\n it when adding your dependency, as you usually would. You can also forgo the BOM entirely\n and specify dependencies by their artifact versions.\n \n+WARNING: As of this version (reactor-core {project-version}), the latest stable BOM in the associated\n+release train line is `{reactorReleaseTrain}`, which is what is used in snippets below.\n+There might be newer versions since then (including snapshots, milestones and new release train lines),\n+see https://github.com/reactor/reactor/releases/.", "originalCommit": "39ad59e219ca2648f79d4d5251193d8b559acffc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4NTc5OA==", "url": "https://github.com/reactor/reactor-core/pull/2474#discussion_r517985798", "bodyText": "indeed, fixed", "author": "simonbasle", "createdAt": "2020-11-05T11:37:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc5ODkyNw=="}], "type": "inlineReview"}, {"oid": "04659d7f94f73fa8c7e8eff76365452b2365d407", "url": "https://github.com/reactor/reactor-core/commit/04659d7f94f73fa8c7e8eff76365452b2365d407", "message": "replace link to github releases with project site docs section", "committedDate": "2020-11-05T11:37:44Z", "type": "commit"}]}