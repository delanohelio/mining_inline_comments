{"pr_number": 2093, "pr_title": "[test] Remove testStaticInit task, verify in main test task", "pr_createdAt": "2020-03-31T14:41:26Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2093", "timeline": [{"oid": "8077bd3f4f3671ce5fff343e9ec66aac21d8ce50", "url": "https://github.com/reactor/reactor-core/commit/8077bd3f4f3671ce5fff343e9ec66aac21d8ce50", "message": "[test] Remove testStaticInit task, verify in main test task\n\nThe special task is there to test static initialization of a single\nsystem property, which can be made more testable by extracting an\ninitializing method. This limits the risk that different tests that\nreset the hooks would impact that staticInit test.\n\nWe fix that early on, but we already saw a manifestation of potential\nissue on 3.3 (`master`):\n - JUnit 5 is used with both Jupiter engine and Vintage engine\n - a TestExecutionListener is added that resets all hooks after test\n methods but also classes and test engines\n - Gradle 6 seems to induce an empty execution of the Jupiter engine\n before the Vintage engine, which resets the hook (including the\n statically initialized GLOBAL_TRACE)", "committedDate": "2020-03-31T14:35:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5MzU4Nw==", "url": "https://github.com/reactor/reactor-core/pull/2093#discussion_r400993587", "bodyText": "@simonbasle these tests were triggered by a chain (check -> testStaticInit -must-run-after-> loops) but now they are not executed at all.\nConsider adding dependsOn(loops) to check's config", "author": "bsideup", "createdAt": "2020-03-31T15:12:39Z", "path": "reactor-core/build.gradle", "diffHunk": "@@ -212,29 +212,15 @@ task kdocZip(type: Zip, dependsOn: dokka) {\n   from(\"${project.buildDir}/docs/kdoc\")\n }\n \n-task testStaticInit(type: Test, group: 'verification') {\n-  systemProperty 'reactor.trace.operatorStacktrace', 'true'\n-  include '**/*TestStaticInit.*'\n-  doFirst {\n-\tprintln \"Additional tests from `testStaticInit` ($includes)\"\n-  }\n-  afterSuite { TestDescriptor descriptor, TestResult result ->\n-\tif (result.testCount > 0 && (result.skippedTestCount + result.failedTestCount + result.successfulTestCount == 0)) {\n-\t  throw new GradleException(\"No static initialization tests were executed\")\n-\t}\n-  }\n-}\n \n task loops(type: Test, group: 'verification') {\n-  mustRunAfter testStaticInit", "originalCommit": "8077bd3f4f3671ce5fff343e9ec66aac21d8ce50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNjE2NA==", "url": "https://github.com/reactor/reactor-core/pull/2093#discussion_r401116164", "bodyText": "it's there, conditional on the version being a .RELEASE (loops are just calling normal single-run tests in big loops btw). the mustRunAfter was there so that static init test was guaranteed to be ordered first, then the other tests would run (so that they don't reset the hook by running before the staticInitTest) \ud83d\udc4d", "author": "simonbasle", "createdAt": "2020-03-31T18:13:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5MzU4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNjYwNw==", "url": "https://github.com/reactor/reactor-core/pull/2093#discussion_r401116607", "bodyText": "see https://github.com/reactor/reactor-core/blob/3.2.x/reactor-core/build.gradle#L247", "author": "simonbasle", "createdAt": "2020-03-31T18:14:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5MzU4Nw=="}], "type": "inlineReview"}]}