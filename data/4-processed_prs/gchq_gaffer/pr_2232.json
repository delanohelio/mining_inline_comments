{"pr_number": 2232, "pr_title": "Gh 2225 federated get all graph info", "pr_createdAt": "2020-01-22T15:01:38Z", "pr_url": "https://github.com/gchq/Gaffer/pull/2232", "timeline": [{"oid": "3e187ef4c4ca284cf7f2bf95ec76516c23fe23b3", "url": "https://github.com/gchq/Gaffer/commit/3e187ef4c4ca284cf7f2bf95ec76516c23fe23b3", "message": "Typo", "committedDate": "2019-12-20T17:51:09Z", "type": "commit"}, {"oid": "69e26a38fabb70bd1fab37798d277f13e7c856db", "url": "https://github.com/gchq/Gaffer/commit/69e26a38fabb70bd1fab37798d277f13e7c856db", "message": "gh-2223 FederatedAdminIT tests", "committedDate": "2020-01-17T15:49:13Z", "type": "commit"}, {"oid": "dd0052afdb2944a048393344cc97f80a29784e0d", "url": "https://github.com/gchq/Gaffer/commit/dd0052afdb2944a048393344cc97f80a29784e0d", "message": "gh-2223 Admin Override for RemoveGraph and GetAllGraphIds", "committedDate": "2020-01-17T15:49:30Z", "type": "commit"}, {"oid": "336425581173a62997f9efb0dc169619b33266dd", "url": "https://github.com/gchq/Gaffer/commit/336425581173a62997f9efb0dc169619b33266dd", "message": "gh-2223 Admin override for RemoveGraph uses predicate", "committedDate": "2020-01-17T15:50:26Z", "type": "commit"}, {"oid": "15f7ad1d0730f65d33533bb1f590d2b740e126e1", "url": "https://github.com/gchq/Gaffer/commit/15f7ad1d0730f65d33533bb1f590d2b740e126e1", "message": "gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override.", "committedDate": "2020-01-17T15:50:37Z", "type": "commit"}, {"oid": "7f9e65937dd4ba645439f874ce0894e3e5161906", "url": "https://github.com/gchq/Gaffer/commit/7f9e65937dd4ba645439f874ce0894e3e5161906", "message": "gh-2223 change to gaffer.store.admin.auth and renaming", "committedDate": "2020-01-17T17:11:03Z", "type": "commit"}, {"oid": "66d769ac1d19ebc1ea22025917485e28c1794087", "url": "https://github.com/gchq/Gaffer/commit/66d769ac1d19ebc1ea22025917485e28c1794087", "message": "gh-2225 Federated GetAllGraphInfo", "committedDate": "2020-01-17T17:17:10Z", "type": "commit"}, {"oid": "c447901ad7573340ae01578203d9f5011370adfa", "url": "https://github.com/gchq/Gaffer/commit/c447901ad7573340ae01578203d9f5011370adfa", "message": "gh-2225 FederatedGetAllGraphInfoHandler has AdminAll and User usage.", "committedDate": "2020-01-17T17:17:33Z", "type": "commit"}, {"oid": "5891ac0d1fa3c535f20b988f8cff13529a6aea14", "url": "https://github.com/gchq/Gaffer/commit/5891ac0d1fa3c535f20b988f8cff13529a6aea14", "message": "gh-2223 checkstyle", "committedDate": "2020-01-17T17:33:10Z", "type": "commit"}, {"oid": "fd5055e26296fab04a7d69d23cd3e53aa4fabd97", "url": "https://github.com/gchq/Gaffer/commit/fd5055e26296fab04a7d69d23cd3e53aa4fabd97", "message": "gh-2225 checkstyle", "committedDate": "2020-01-17T17:33:29Z", "type": "commit"}, {"oid": "6699a0a362fb7bb298cf7819d92686b46ab51462", "url": "https://github.com/gchq/Gaffer/commit/6699a0a362fb7bb298cf7819d92686b46ab51462", "message": "gh-2225 GetGraphInfo can be filtered by graphIds", "committedDate": "2020-01-18T18:02:05Z", "type": "commit"}, {"oid": "2d4d7104042eebff93f876761d4a567a216a11bd", "url": "https://github.com/gchq/Gaffer/commit/2d4d7104042eebff93f876761d4a567a216a11bd", "message": "gh-2223 remove graph admin param added.", "committedDate": "2020-01-20T20:07:05Z", "type": "commit"}, {"oid": "d4a69281b1220337e7c78efa016d5883408ce93a", "url": "https://github.com/gchq/Gaffer/commit/d4a69281b1220337e7c78efa016d5883408ce93a", "message": "gh-2225 getAllGraphsAndAuths isAdmin param", "committedDate": "2020-01-20T20:08:49Z", "type": "commit"}, {"oid": "be4b64e033b63e85a954d2cb3e495f236d451d31", "url": "https://github.com/gchq/Gaffer/commit/be4b64e033b63e85a954d2cb3e495f236d451d31", "message": "Merge branch 'develop' into gh-2223-Federated-Admin-override", "committedDate": "2020-01-21T15:04:25Z", "type": "commit"}, {"oid": "b893e9d87aef924765afba8c7affd533c71d9fdd", "url": "https://github.com/gchq/Gaffer/commit/b893e9d87aef924765afba8c7affd533c71d9fdd", "message": "Merge branch 'develop' into gh-2225-federated-getAllGraphInfo", "committedDate": "2020-01-21T15:04:48Z", "type": "commit"}, {"oid": "f54bc80d150c59ba87bcc18ea08d0ef1f038980d", "url": "https://github.com/gchq/Gaffer/commit/f54bc80d150c59ba87bcc18ea08d0ef1f038980d", "message": "gh-2223 refinements and package protected methods in FederatedGraphStorage", "committedDate": "2020-01-21T18:04:16Z", "type": "commit"}, {"oid": "68e6a108c0b59216e257c05dd0522ddf6dc7b062", "url": "https://github.com/gchq/Gaffer/commit/68e6a108c0b59216e257c05dd0522ddf6dc7b062", "message": "gh-2225 refinements and package protected methods in FederatedGraphStorage", "committedDate": "2020-01-21T18:19:00Z", "type": "commit"}, {"oid": "f292a9346528e09ee0e12b93ce438b6d0c7053cf", "url": "https://github.com/gchq/Gaffer/commit/f292a9346528e09ee0e12b93ce438b6d0c7053cf", "message": "Merge branch 'gh-2223-Federated-Admin-override' into gh-2225-federated-getAllGraphInfo\n\n# Conflicts:\n#\tstore-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n#\tstore-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/integration/FederatedAdminIT.java", "committedDate": "2020-01-22T15:14:52Z", "type": "commit"}, {"oid": "f292a9346528e09ee0e12b93ce438b6d0c7053cf", "url": "https://github.com/gchq/Gaffer/commit/f292a9346528e09ee0e12b93ce438b6d0c7053cf", "message": "Merge branch 'gh-2223-Federated-Admin-override' into gh-2225-federated-getAllGraphInfo\n\n# Conflicts:\n#\tstore-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n#\tstore-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/integration/FederatedAdminIT.java", "committedDate": "2020-01-22T15:14:52Z", "type": "forcePushed"}, {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "url": "https://github.com/gchq/Gaffer/commit/2a9065ea0d479997e8f5ea215063ce47afaa921b", "message": "Merge branch 'federated-admin-changes' into gh-2225-federated-getAllGraphInfo", "committedDate": "2020-01-22T15:50:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0OTM3NA==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369649374", "bodyText": "Don't think you need this second check", "author": "d47853", "createdAt": "2020-01-22T16:01:53Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java", "diffHunk": "@@ -513,4 +513,36 @@ private void makeAllGraphsFromCache() throws StorageException {\n             }\n         }\n     }\n+\n+    HashMap<String, Object> getAllGraphsAndAuths(final User user, final List<String> graphIds) {\n+        final HashMap<String, Object> graphIdFedAccessMap = new HashMap<>();\n+        storage.entrySet()\n+                .stream()\n+                .filter(entry -> isValidToView(user, entry.getKey()))\n+                .forEach(entry -> {\n+                    FederatedAccess federatedAccess = entry.getKey();\n+                    populateGraphIdAccessMap(graphIdFedAccessMap, graphIds, federatedAccess, entry.getValue());\n+                });\n+\n+        return graphIdFedAccessMap;\n+    }\n+\n+    private void populateGraphIdAccessMap(final HashMap<String, Object> graphIdFedAccessMap, final List<String> graphIds, final FederatedAccess federatedAccess, final Set<Graph> graphs) {\n+        for (final Graph g : graphs) {\n+            if (nonNull(graphIds) && !graphIds.isEmpty()) {", "originalCommit": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MTExMw==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369691113", "bodyText": "As we have seen this is to change the logic.\nif no lists is provided I want all the graphs. I'll add text.", "author": "GCHQDev404", "createdAt": "2020-01-22T17:13:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0OTM3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY2OTY2Mw==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369669663", "bodyText": "Why use the toString()? Isn't it simpler to just add the FederatedAccess object directly?", "author": "d47853", "createdAt": "2020-01-22T16:35:44Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java", "diffHunk": "@@ -513,4 +513,36 @@ private void makeAllGraphsFromCache() throws StorageException {\n             }\n         }\n     }\n+\n+    HashMap<String, Object> getAllGraphsAndAuths(final User user, final List<String> graphIds) {\n+        final HashMap<String, Object> graphIdFedAccessMap = new HashMap<>();\n+        storage.entrySet()\n+                .stream()\n+                .filter(entry -> isValidToView(user, entry.getKey()))\n+                .forEach(entry -> {\n+                    FederatedAccess federatedAccess = entry.getKey();\n+                    populateGraphIdAccessMap(graphIdFedAccessMap, graphIds, federatedAccess, entry.getValue());\n+                });\n+\n+        return graphIdFedAccessMap;\n+    }\n+\n+    private void populateGraphIdAccessMap(final HashMap<String, Object> graphIdFedAccessMap, final List<String> graphIds, final FederatedAccess federatedAccess, final Set<Graph> graphs) {\n+        for (final Graph g : graphs) {\n+            if (nonNull(graphIds) && !graphIds.isEmpty()) {\n+                if (graphIds.contains(g.getGraphId())) {\n+                    graphIdFedAccessMap.put(g.getGraphId(), federatedAccess.toString());", "originalCommit": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3MjQ0MA==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369672440", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2017-2019 Crown Copyright\n          \n          \n            \n             * Copyright 2020 Crown Copyright", "author": "d47853", "createdAt": "2020-01-22T16:40:25Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/GetAllGraphInfo.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "originalCommit": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3Mjk2Ng==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369672966", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @Since(\"1.10.4\")\n          \n          \n            \n            @Since(\"1.10.6\")", "author": "d47853", "createdAt": "2020-01-22T16:41:17Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/GetAllGraphInfo.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package uk.gov.gchq.gaffer.federatedstore.operation;\n+\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.apache.commons.lang3.exception.CloneFailedException;\n+\n+import uk.gov.gchq.gaffer.operation.io.Output;\n+import uk.gov.gchq.gaffer.operation.serialisation.TypeReferenceImpl;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+\n+import java.util.Map;\n+\n+import static uk.gov.gchq.gaffer.federatedstore.FederatedStoreConstants.KEY_OPERATION_OPTIONS_GRAPH_IDS;\n+\n+/**\n+ * An Operation to get all the graphIds within scope of the FederatedStore.\n+ */\n+@JsonPropertyOrder(value = {\"class\"}, alphabetic = true)\n+@Since(\"1.10.4\")", "originalCommit": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3MzQ0MA==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369673440", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2017-2019 Crown Copyright\n          \n          \n            \n             * Copyright 2020 Crown Copyright", "author": "d47853", "createdAt": "2020-01-22T16:42:05Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/handler/impl/FederatedGetAllGraphInfoHandler.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "originalCommit": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3NDAxMg==", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369674012", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2017-2019 Crown Copyright\n          \n          \n            \n             * Copyright 2020 Crown Copyright", "author": "d47853", "createdAt": "2020-01-22T16:42:58Z", "path": "store-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/operation/GetAllGraphInfoTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "originalCommit": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3c299ea38d4d4e179814c8bc5353216c2edc10db", "url": "https://github.com/gchq/Gaffer/commit/3c299ea38d4d4e179814c8bc5353216c2edc10db", "message": "Apply suggestions from code review\n\nCo-Authored-By: d47853 <d47853@users.noreply.github.com>", "committedDate": "2020-01-22T16:56:25Z", "type": "commit"}, {"oid": "b3244a4ba2a4d7d7a191edbd33465b42916b990c", "url": "https://github.com/gchq/Gaffer/commit/b3244a4ba2a4d7d7a191edbd33465b42916b990c", "message": "gh-2225 PR changes GetGraphInfo returns FederatedAccess not string.", "committedDate": "2020-01-22T17:54:12Z", "type": "commit"}]}