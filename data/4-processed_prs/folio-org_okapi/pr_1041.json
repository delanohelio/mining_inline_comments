{"pr_number": 1041, "pr_title": "Support both \"http.port\" and \"port\" property variables", "pr_createdAt": "2020-11-10T21:00:52Z", "pr_url": "https://github.com/folio-org/okapi/pull/1041", "timeline": [{"oid": "266fc609f7aebcc19f77608bedcb6a6779f4b667", "url": "https://github.com/folio-org/okapi/commit/266fc609f7aebcc19f77608bedcb6a6779f4b667", "message": "Support both \"http.port\" and \"port\" property variables\n\n\"http.port\" is the command-line option name that all RMB based\nmodules support:\nhttps://github.com/folio-org/raml-module-builder#command-line-options\n\nFor consistency Okapi should also support this.\n\nThe guide.md should show \"http.port\" because most modules\nare RMB based and support only this form.", "committedDate": "2020-11-10T20:54:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODMxNA==", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521488314", "bodyText": "So http.port is only supported as property. Not as Json configuration. Is that intended?", "author": "adamdickmeiss", "createdAt": "2020-11-11T16:39:15Z", "path": "okapi-core/src/main/java/org/folio/okapi/MainVerticle.java", "diffHunk": "@@ -83,7 +83,8 @@ public void init(Vertx vertx, Context context) {\n     super.init(vertx, context);\n \n     JsonObject config = context.config();\n-    port = Integer.parseInt(Config.getSysConf(\"port\", \"9130\", config));\n+    String portString = System.getProperty(\"http.port\", \"9130\");\n+    port = Integer.parseInt(Config.getSysConf(\"port\", portString, config));\n     String okapiVersion2 = Config.getSysConf(\"okapiVersion\", null, config);", "originalCommit": "266fc609f7aebcc19f77608bedcb6a6779f4b667", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNzI0Mw==", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521637243", "bodyText": "No, good catch!\nFixed.", "author": "julianladisch", "createdAt": "2020-11-11T21:03:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODMxNA=="}], "type": "inlineReview"}, {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b", "url": "https://github.com/folio-org/okapi/commit/97238ed75b784ad27b1478d0de12ace617123a9b", "message": "Config.getSysConf with 2 keys, http.port in okapi.sh", "committedDate": "2020-11-11T21:03:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxNjUwNQ==", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521916505", "bodyText": "I'm not sure I follow. This is a value, not a name. Hopefully no system tampers with values. So I don't think we should excuse anything here.", "author": "adamdickmeiss", "createdAt": "2020-11-12T08:21:28Z", "path": "dist/okapi.sh", "diffHunk": "@@ -121,9 +121,19 @@ parse_okapi_conf()  {\n       OKAPI_JAVA_OPTS+=\" -Dhost=${host}\"\n    fi\n \n-   # configure okapi port\n-   if [ \"$port\" ]; then\n-      OKAPI_JAVA_OPTS+=\" -Dport=${port}\"\n+   # configure okapi http port\n+   # Environment variables with periods/dots in their names are deprecated\n+   # because a period is not POSIX compliant and therefore some shells, notably,\n+   # the BusyBox /bin/sh included in Alpine Linux, strip them:\n+   # https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html\n+   # https://github.com/docker-library/docs/tree/master/openjdk#environment-variables-with-periods-in-their-names\n+   # https://wiki.ubuntu.com/DashAsBinSh\n+   # https://wiki.ubuntu.com/DashAsBinSh/Spec\n+   # Java property variable names allow periods/dots.\n+   if [ \"$http_port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${http_port}\"\n+   elif [ \"$port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${port}\"\n    fi", "originalCommit": "97238ed75b784ad27b1478d0de12ace617123a9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk0OTU3Mg==", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521949572", "bodyText": "You mean http_port of course. ok.", "author": "adamdickmeiss", "createdAt": "2020-11-12T09:12:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxNjUwNQ=="}], "type": "inlineReview"}, {"oid": "ec804157cfd2f5012dc18f7518536ab3e886c041", "url": "https://github.com/folio-org/okapi/commit/ec804157cfd2f5012dc18f7518536ab3e886c041", "message": "Merge branch 'master' into http.port", "committedDate": "2020-12-14T09:17:49Z", "type": "commit"}]}