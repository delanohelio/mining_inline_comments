{"pr_number": 867, "pr_title": "Improve reporting when too many records are not committed", "pr_createdAt": "2020-11-12T16:29:16Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1MTA5Nw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#discussion_r523051097", "bodyText": "I'm not sure if the remark about the maximum capacity is always true. In my case, only the timeout hit (I have 89 messages waiting in batching). Not sure if you should change the wording.", "author": "andreas-eberle", "createdAt": "2020-11-13T16:11:49Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/i18n/KafkaLogging.java", "diffHunk": "@@ -139,8 +139,11 @@\n     void configuredPattern(String channel, String pattern);\n \n     @LogMessage(level = Logger.Level.WARN)\n-    @Message(id = 18231, value = \"The amount of received messages without acking is too high for topic partition '%s', amount %d.\")\n-    void receivedTooManyMessagesWithoutAcking(String topicPartition, long amount);\n+    @Message(id = 18231, value = \"The amount of received messages without acking is too high for topic partition '%s', \"\n+            + \"amount %d. The last committed offset was %d. It means that the Kafka connector received Kafka Records that \"\n+            + \"have neither be acked nor nacked in a timely fashion. The connector accumulates records in memory, but that \"\n+            + \"buffer reached its maximum capacity. The connector cannot commit as a record processing has not completed.\")", "originalCommit": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNDYyOA==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#discussion_r523804628", "bodyText": "You are right, there is also a deadline.\nI fixed it.", "author": "cescoffier", "createdAt": "2020-11-15T19:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1MTA5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2MDA2Nw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#discussion_r523160067", "bodyText": "This null check isn't strictly necessary since the code block is in a while received offset is not empty. But this is fine.", "author": "pcasaes", "createdAt": "2020-11-13T18:54:02Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/commit/KafkaThrottledLatestProcessedCommit.java", "diffHunk": "@@ -355,10 +366,14 @@ long clearLesserSequentiallyProcessedOffsetsAndReturnLargestOffset() {\n                         break;\n                     }\n                     unProcessedTotal--;\n-                    largestSequentialProcessedOffset = receivedOffsets.poll().getOffset();\n+                    OffsetReceivedAt poll = receivedOffsets.poll();\n+                    if (poll != null) {\n+                        largestSequentialProcessedOffset = poll.getOffset();\n+                    }", "originalCommit": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNDcxMw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#discussion_r523804713", "bodyText": "Yes, some weird issues have been reported. So, better to be safe...", "author": "cescoffier", "createdAt": "2020-11-15T19:50:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2MDA2Nw=="}], "type": "inlineReview"}, {"oid": "e16c139a515bc3b01683112dcf076f182c308fac", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/e16c139a515bc3b01683112dcf076f182c308fac", "message": "Fix #865\n\nImprove reporting when too many message have not been acked or nacked.\nThe exception contains the last committed offset as well as the topic/partition.\nThe logged message explains why the exception has been thrown.", "committedDate": "2020-11-14T09:48:30Z", "type": "commit"}, {"oid": "e16c139a515bc3b01683112dcf076f182c308fac", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/e16c139a515bc3b01683112dcf076f182c308fac", "message": "Fix #865\n\nImprove reporting when too many message have not been acked or nacked.\nThe exception contains the last committed offset as well as the topic/partition.\nThe logged message explains why the exception has been thrown.", "committedDate": "2020-11-14T09:48:30Z", "type": "forcePushed"}]}