{"pr_number": 8354, "pr_title": "[modbus] Add hints to potential problems on Modbus readout", "pr_createdAt": "2020-08-27T11:18:14Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8354", "timeline": [{"oid": "ac5ea6a2bb6d65f7d8d9da235bab25d53aee7fcb", "url": "https://github.com/openhab/openhab-addons/commit/ac5ea6a2bb6d65f7d8d9da235bab25d53aee7fcb", "message": "add hints to common problems\n\nSigned-Off-By: Markus Storm <markus.storm@gmx.net>", "committedDate": "2020-08-27T11:17:48Z", "type": "commit"}, {"oid": "f5b591ce4d16415142941a509658eabe0d5b091f", "url": "https://github.com/openhab/openhab-addons/commit/f5b591ce4d16415142941a509658eabe0d5b091f", "message": "add troubleshooting session\n\nSigned-Off-By: Markus Storm <markus.storm@gmx.net>", "committedDate": "2020-08-27T12:51:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY0NTU5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r478645599", "bodyText": "\"Eventually\"? Can we remove the word?\nWhat do you mean with \"range of registers that is too large?\" We have discussion on adding a check for the count parameter in #8228 (comment)\nAlso, I think workaround is without spaces", "author": "ssalonen", "createdAt": "2020-08-27T19:27:16Z", "path": "bundles/org.openhab.binding.modbus/README.md", "diffHunk": "@@ -174,11 +174,14 @@ You must give each of your bridge Things a reference (thing ID) that is unique f\n | `maxTries`    | integer |          | `3`                | Maximum tries when reading. <br /><br />Number of tries when reading data, if some of the reading fail. For single try, enter 1.                                                               |\n | `cacheMillis` | integer |          | `50`               | Duration for data cache to be valid, in milliseconds. This cache is used only to serve `REFRESH`  commands. Use zero to disable the caching.                                                   |\n \n-Note: Polling can be manually triggered by sending `REFRESH` command to item bound to channel of `data` thing.\n+Polling can be manually triggered by sending `REFRESH` command to item bound to channel of `data` thing.\n When manually triggering polling, a new poll is executed as soon as possible, and sibling `data` things (i.e. things that share the same `poller` bridge) are updated.\n In case the `poller` had just received a data response or an error occurred, a cached response is used instead.\n See [Refresh command](#refresh-command) section for more details.\n \n+Some devices do not allow to query a range of registers that is too large or spans reserved registers.\n+Eventually split your poller into multiple smaller ones to work around this problem.", "originalCommit": "f5b591ce4d16415142941a509658eabe0d5b091f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczNjI2NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r482736265", "bodyText": "Any changes here?\n@ssalonen you can use the icon  to suggest an alternative text.", "author": "Hilbrand", "createdAt": "2020-09-03T06:36:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY0NTU5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg2NzI2Mw==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r482867263", "bodyText": "I reworded that", "author": "mstormi", "createdAt": "2020-09-03T10:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY0NTU5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgyODA0OA==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r478828048", "bodyText": "How about\nWith Modbus TCP devices, there may be multiple network interfaces available, e.g. Wifi and wired Ethernet. However, with some devices the Modbus data is accessible with only one of the interfaces. You need to check the device manufacturer manual, or simply try out which of the IPs are returning valid modbus data.", "author": "ssalonen", "createdAt": "2020-08-28T04:46:53Z", "path": "bundles/org.openhab.binding.modbus/README.md", "diffHunk": "@@ -985,6 +988,18 @@ end\n \n Please be aware that `REFRESH` commands are \"throttled\" (to be exact, responses are cached) with `poller` parameter `cacheMillis`.\n \n+## Troubleshooting\n+\n+Modbus, while simple at its heart, potentially is a complicated standard to use because there's a lot of freedom (and bugs) when it comes to implementations.\n+There are many device or vendor specific quirks and wrinkles you might stumble across. Here's some:\n+\n+* a device may have more than one interface with a port open (502 or other) that it responds on, but may have no connection to the real bus hardware.", "originalCommit": "f5b591ce4d16415142941a509658eabe0d5b091f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgyODYwMg==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r478828602", "bodyText": "I would not go so far to recommend serial. Serial has many practical issues (physical connections etc)\nCan we comment anything general what interface to use? After all, all devices are different.", "author": "ssalonen", "createdAt": "2020-08-28T04:49:16Z", "path": "bundles/org.openhab.binding.modbus/README.md", "diffHunk": "@@ -985,6 +988,18 @@ end\n \n Please be aware that `REFRESH` commands are \"throttled\" (to be exact, responses are cached) with `poller` parameter `cacheMillis`.\n \n+## Troubleshooting\n+\n+Modbus, while simple at its heart, potentially is a complicated standard to use because there's a lot of freedom (and bugs) when it comes to implementations.\n+There are many device or vendor specific quirks and wrinkles you might stumble across. Here's some:\n+\n+* a device may have more than one interface with a port open (502 or other) that it responds on, but may have no connection to the real bus hardware.\n+Check ALL interfaces including (and preferring) any serial connection. Usually either that or the Ethernet IP will do.", "originalCommit": "f5b591ce4d16415142941a509658eabe0d5b091f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzMTE1Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r478831157", "bodyText": "Can we make the troubleshooting more actionable?\nFor example, trying first to read large spans (more efficient especially with tens of registers with short polling), containing even undefined/undocumented data regions.\nAnd if that does not work, trying to read the data in pieces that contains only documented/valid data regions.\nWe have seen all sorts of behavior\n\nok to query undefined registers, in the end you would only use the documented registers.\nslave not responding at all if the data region contains undefined data. Will produce timeout error in binding\nslave responding with explicit error, telling that addresses are invalid. Thing will go offline and description will tell the reason\n\nThe weirdest is where you need to query 4 registers, even if you are only needing the first two. This is an issue with SMA devices openhab/openhab1-addons#4931 (comment). Comes up every now and then as people stumble on it.", "author": "ssalonen", "createdAt": "2020-08-28T05:00:21Z", "path": "bundles/org.openhab.binding.modbus/README.md", "diffHunk": "@@ -985,6 +988,18 @@ end\n \n Please be aware that `REFRESH` commands are \"throttled\" (to be exact, responses are cached) with `poller` parameter `cacheMillis`.\n \n+## Troubleshooting\n+\n+Modbus, while simple at its heart, potentially is a complicated standard to use because there's a lot of freedom (and bugs) when it comes to implementations.\n+There are many device or vendor specific quirks and wrinkles you might stumble across. Here's some:\n+\n+* a device may have more than one interface with a port open (502 or other) that it responds on, but may have no connection to the real bus hardware.\n+Check ALL interfaces including (and preferring) any serial connection. Usually either that or the Ethernet IP will do.\n+\n+* some devices do not allow to query a range of registers that is too large or spans reserved registers.\n+They may respond with an error or no error but invalid register data.", "originalCommit": "f5b591ce4d16415142941a509658eabe0d5b091f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzMTUzOA==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r478831538", "bodyText": "Perhaps the advice would be to review if any of the device specific modbus bindings are applicable for your device, e.g. Sunspec modbus binding. Many quirks are taken cared for and it's much easier for the user than the generic modbus binding.\nI think the list is in the beginning of the document.\nWhat do you think?", "author": "ssalonen", "createdAt": "2020-08-28T05:02:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzMTE1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA1NzYwOA==", "url": "https://github.com/openhab/openhab-addons/pull/8354#discussion_r479057608", "bodyText": "I've put up a couple of changes and hope they match your comments.\nRegarding the last one, this doesn't belong into troubleshooting IMHO so I didn't do anything about it.\nIt should be more prominently emphasized than now at the beginning of the document though.", "author": "mstormi", "createdAt": "2020-08-28T09:59:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzMTE1Nw=="}], "type": "inlineReview"}, {"oid": "4861122e55660f6a405363eb6dc7e9201803b60e", "url": "https://github.com/openhab/openhab-addons/commit/4861122e55660f6a405363eb6dc7e9201803b60e", "message": "improvements on Modbus troubleshooting docs", "committedDate": "2020-08-28T09:55:48Z", "type": "commit"}, {"oid": "2ec216859b44e3a62ac7a7744048e55d5ebd8475", "url": "https://github.com/openhab/openhab-addons/commit/2ec216859b44e3a62ac7a7744048e55d5ebd8475", "message": "improved wording in README.md\n\nSigned-off-by: Markus Storm <markus.storm@gmx.net>", "committedDate": "2020-09-03T10:12:56Z", "type": "commit"}]}