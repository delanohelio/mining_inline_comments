{"pr_number": 7915, "pr_title": "[somfytahoma] improved silent mode control", "pr_createdAt": "2020-06-13T15:18:03Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7915", "timeline": [{"oid": "fdda2ad84c4a166124216bce3fce0b8d54210a74", "url": "https://github.com/openhab/openhab-addons/commit/fdda2ad84c4a166124216bce3fce0b8d54210a74", "message": "[somfytahoma] improved silent mode control\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>", "committedDate": "2020-06-11T20:43:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzMxMA==", "url": "https://github.com/openhab/openhab-addons/pull/7915#discussion_r439763310", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            default:\n          \n          \n            \n                                if (CONTROL_SILENT.equals(channelUID.getId()) && (COMMAND_UP.equals(cmd) || COMMAND_DOWN.equals(cmd))) {\n          \n          \n            \n                                    // move the roller shutter to the specific position at low speed\n          \n          \n            \n                                    String param = \"[\" + (COMMAND_UP.equals(cmd) ? 0 : 100) + \", \\\"lowspeed\\\"]\";\n          \n          \n            \n                                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n          \n          \n            \n                                } else {\n          \n          \n            \n                                    sendCommand(cmd);\n          \n          \n            \n                                }\n          \n          \n            \n                            case COMMAND_UP:\n          \n          \n            \n                            case COMMAND_DOWN:\n          \n          \n            \n                                if (CONTROL_SILENT.equals(channelUID.getId())) {\n          \n          \n            \n                                    // move the roller shutter to the specific position at low speed\n          \n          \n            \n                                    String param = \"[\" + (COMMAND_UP.equals(cmd) ? 0 : 100) + \", \\\"lowspeed\\\"]\";\n          \n          \n            \n                                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n          \n          \n            \n                                    break;\n          \n          \n            \n                                }\n          \n          \n            \n                                //fall through\n          \n          \n            \n                            default:\n          \n          \n            \n                                sendCommand(cmd);", "author": "cpmeister", "createdAt": "2020-06-13T19:31:27Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaSilentRollerShutterHandler.java", "diffHunk": "@@ -45,25 +45,37 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             return;\n         } else {\n             String cmd = getTahomaCommand(command.toString());\n-            if (COMMAND_MY.equals(cmd)) {\n-                sendCommand(COMMAND_MY);\n-            } else if (COMMAND_STOP.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and STOP is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+            switch (cmd) {\n+                case COMMAND_MY:\n                     sendCommand(COMMAND_MY);\n-                }\n-            } else {\n-                if (CONTROL_SILENT.equals(channelUID.getId()) && COMMAND_SET_CLOSURE.equals(cmd)) {\n-                    // move the roller shutter to the specific position at low speed\n-                    String param = \"[\" + command.toString() + \", \\\"lowspeed\\\"]\";\n-                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n-                } else {\n-                    String param = COMMAND_SET_CLOSURE.equals(cmd) ? \"[\" + toInteger(command) + \"]\" : \"[]\";\n-                    sendCommand(cmd, param);\n-                }\n+                    break;\n+                case COMMAND_STOP:\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and STOP is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_MY);\n+                    }\n+                    break;\n+                case COMMAND_SET_CLOSURE:\n+                    if (CONTROL_SILENT.equals(channelUID.getId())) {\n+                        // move the roller shutter to the specific position at low speed\n+                        String param = \"[\" + toInteger(command) + \", \\\"lowspeed\\\"]\";\n+                        sendCommand(COMMAND_SET_CLOSURESPEED, param);\n+                    } else {\n+                        String param = \"[\" + toInteger(command) + \"]\";\n+                        sendCommand(cmd, param);\n+                    }\n+                    break;\n+                default:\n+                    if (CONTROL_SILENT.equals(channelUID.getId()) && (COMMAND_UP.equals(cmd) || COMMAND_DOWN.equals(cmd))) {\n+                        // move the roller shutter to the specific position at low speed\n+                        String param = \"[\" + (COMMAND_UP.equals(cmd) ? 0 : 100) + \", \\\"lowspeed\\\"]\";\n+                        sendCommand(COMMAND_SET_CLOSURESPEED, param);\n+                    } else {\n+                        sendCommand(cmd);\n+                    }", "originalCommit": "fdda2ad84c4a166124216bce3fce0b8d54210a74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2ODU4Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7915#discussion_r439768587", "bodyText": "Great suggestion. thanks", "author": "octa22", "createdAt": "2020-06-13T20:55:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzUzMg==", "url": "https://github.com/openhab/openhab-addons/pull/7915#discussion_r439763532", "bodyText": "You can do similar fall through shenanigans here as well by moving the COMMAND_MY case around.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            case COMMAND_STOP:\n          \n          \n            \n                                String executionId = getCurrentExecutions();\n          \n          \n            \n                                if (executionId != null) {\n          \n          \n            \n                                    // Check if the roller shutter is moving and STOP is sent => STOP it\n          \n          \n            \n                                    cancelExecution(executionId);\n          \n          \n            \n                                } else {\n          \n          \n            \n                                    sendCommand(COMMAND_MY);\n          \n          \n            \n                                }\n          \n          \n            \n                                break;\n          \n          \n            \n                            case COMMAND_STOP:\n          \n          \n            \n                                String executionId = getCurrentExecutions();\n          \n          \n            \n                                if (executionId != null) {\n          \n          \n            \n                                    // Check if the roller shutter is moving and STOP is sent => STOP it\n          \n          \n            \n                                    cancelExecution(executionId);\n          \n          \n            \n                                    break;\n          \n          \n            \n                                }\n          \n          \n            \n                                //fall through\n          \n          \n            \n                            case COMMAND_MY:\n          \n          \n            \n                                sendCommand(COMMAND_MY);\n          \n          \n            \n                                break;", "author": "cpmeister", "createdAt": "2020-06-13T19:35:08Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaSilentRollerShutterHandler.java", "diffHunk": "@@ -45,25 +45,37 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             return;\n         } else {\n             String cmd = getTahomaCommand(command.toString());\n-            if (COMMAND_MY.equals(cmd)) {\n-                sendCommand(COMMAND_MY);\n-            } else if (COMMAND_STOP.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and STOP is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+            switch (cmd) {\n+                case COMMAND_MY:\n                     sendCommand(COMMAND_MY);\n-                }\n-            } else {\n-                if (CONTROL_SILENT.equals(channelUID.getId()) && COMMAND_SET_CLOSURE.equals(cmd)) {\n-                    // move the roller shutter to the specific position at low speed\n-                    String param = \"[\" + command.toString() + \", \\\"lowspeed\\\"]\";\n-                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n-                } else {\n-                    String param = COMMAND_SET_CLOSURE.equals(cmd) ? \"[\" + toInteger(command) + \"]\" : \"[]\";\n-                    sendCommand(cmd, param);\n-                }\n+                    break;\n+                case COMMAND_STOP:\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and STOP is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_MY);\n+                    }\n+                    break;", "originalCommit": "fdda2ad84c4a166124216bce3fce0b8d54210a74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2ODYwMA==", "url": "https://github.com/openhab/openhab-addons/pull/7915#discussion_r439768600", "bodyText": "Great suggestion. thanks", "author": "octa22", "createdAt": "2020-06-13T20:56:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzUzMg=="}], "type": "inlineReview"}, {"oid": "24536e4bc72793c2747b9b230cb142fc926d362d", "url": "https://github.com/openhab/openhab-addons/commit/24536e4bc72793c2747b9b230cb142fc926d362d", "message": "[somfytahoma] implemented suggested changes from the code review\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>", "committedDate": "2020-06-13T21:13:53Z", "type": "commit"}]}