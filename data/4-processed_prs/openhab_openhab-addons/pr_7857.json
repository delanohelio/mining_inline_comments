{"pr_number": 7857, "pr_title": "[telegram] allow access restrictions on chat ids", "pr_createdAt": "2020-06-04T19:29:39Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7857", "timeline": [{"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16", "url": "https://github.com/openhab/openhab-addons/commit/20832d776ecd381af1e938f03ac7b9b1cef21b16", "message": "allow access restrictions on chat ids\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-06-04T19:14:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyOTcwNw==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r435729707", "bodyText": "Minor suggestion: use chatIdStr.substring(1) to remove the first character", "author": "ZzetT", "createdAt": "2020-06-05T07:10:00Z", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -138,10 +140,23 @@ public void initialize() {\n         TelegramConfiguration config = getConfigAs(TelegramConfiguration.class);\n \n         String botToken = config.getBotToken();\n-        chatIds.clear();\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                chatIds.add(Long.valueOf(chatIdStr));\n+                if (chatIdStr.startsWith(\"<\")) {\n+                    // inbound only\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.replace(\"<\", \"\")));\n+                } else if (chatIdStr.startsWith(\">\")) {\n+                    // outbound only\n+                    receiverChatId.add(Long.valueOf(chatIdStr.replace(\">\", \"\")));", "originalCommit": "20832d776ecd381af1e938f03ac7b9b1cef21b16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyOTcxOA==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r435729718", "bodyText": "I guess you removed the tags here to not confuse the user with the send/receive characters. Could we modify this example to also show how it would look with the prefix e.g. use \">ID2\" and to update the text in parenthesis (\"... where ID2 can only receive messages\"? Then we would also avoid confusions whether a space is required or not.", "author": "ZzetT", "createdAt": "2020-06-05T07:10:02Z", "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -62,29 +62,34 @@ In order to send a message, an action must be used instead.\n | `proxyPort`             |  None   | No       | Proxy port for telegram binding.                                                             |\n | `proxyType`             |  SOCKS5 | No       | Type of proxy server for telegram binding (SOCKS5 or HTTP). Default: SOCKS5                  |\n \n+By default chat ids are bi-directionally, i.e. they can send and receive messages.\n+They can be prefixed with an access modifier:\n+- `<` restricts the chat to send only, i.e. this chat id can send messages to openHAB, but will never receive a notification.\n+- `>` restricts the chat to receive only, i.e. this chat id will receive all notifications, but messages from this chat id will be discarded. \n+To use the reply function, chat ids need to be bi-directional.\n \n telegram.thing (no proxy):\n \n ```\n-Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"< ID >\", botToken=\"< TOKEN >\" ]\n+Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"ID\", botToken=\"TOKEN\" ]\n ```\n \n telegram.thing (multiple chat ids and markdown format):\n \n ```\n-Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"< ID1 >\",\"< ID2 >\", botToken=\"< TOKEN >\", parseMode =\"Markdown\" ]\n+Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"ID1\",\"ID2\", botToken=\"TOKEN\", parseMode =\"Markdown\" ]\n ```", "originalCommit": "20832d776ecd381af1e938f03ac7b9b1cef21b16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "url": "https://github.com/openhab/openhab-addons/commit/4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "message": "address review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-06-05T13:30:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0ODA0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r436248042", "bodyText": "If you trim() earlier it is not a good idea to use substring(1) on the not trimmed String. Maybe introduced a local variable for the `trimmedChatId and use it here and in the following lines.", "author": "cweitkamp", "createdAt": "2020-06-06T07:44:15Z", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -138,10 +140,23 @@ public void initialize() {\n         TelegramConfiguration config = getConfigAs(TelegramConfiguration.class);\n \n         String botToken = config.getBotToken();\n-        chatIds.clear();\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                chatIds.add(Long.valueOf(chatIdStr));\n+                if (chatIdStr.trim().startsWith(\"<\")) {\n+                    // inbound only\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.substring(1)));", "originalCommit": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0OTUyMw==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r436249523", "bodyText": "Good point.Done.", "author": "J-N-K", "createdAt": "2020-06-06T08:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0ODA0Mg=="}], "type": "inlineReview"}, {"oid": "0e53bb61098a3f7b4a419c893280110f86e8341b", "url": "https://github.com/openhab/openhab-addons/commit/0e53bb61098a3f7b4a419c893280110f86e8341b", "message": "address more review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-06-06T08:06:14Z", "type": "commit"}]}