{"pr_number": 9508, "pr_title": "[shelly] Improved documentation, support for UNI, 1L, Color Bulb", "pr_createdAt": "2020-12-24T12:00:46Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9508", "timeline": [{"oid": "1b5870087026072ee462495c02a52d42426d9360", "url": "https://github.com/openhab/openhab-addons/commit/1b5870087026072ee462495c02a52d42426d9360", "message": "Minor fixed, support for Shelly Color Bulb, Shelly Motion\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-12-26T14:07:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTI3MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550491271", "bodyText": "for?", "author": "fwolter", "createdAt": "2020-12-31T14:13:13Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -330,6 +376,8 @@ Depending on the device type and firmware release channels might be not availabl\n |          |outputName   |String   |yes      |Logical name of this relay output as configured in the Shelly App                |\n |          |input        |Switch   |yes      |ON: Input/Button is powered, see general notes on channels                       |\n |          |button       |Trigger  |yes      |Event trigger, see section Button Events                                         |\n+|          |lastEvent    |String   |yes      |Last event type (S/SS/SSS/L)                                                     |\n+|          |eventCount   |String   |yes      |Event counter for                                                                |", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg2OTM2Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554869366", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTI5NA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550491294", "bodyText": "for?", "author": "fwolter", "createdAt": "2020-12-31T14:13:22Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -357,6 +405,8 @@ The Thing id is derived from the service name, so that's the reason why the Thin\n |          |outputName   |String   |yes      |Logical name of this relay output as configured in the Shelly App                |\n |          |input        |Switch   |yes      |ON: Input/Button is powered, see general notes on channels                       |\n |          |button       |Trigger  |yes      |Event trigger, see section Button Events                                         |\n+|          |lastEvent    |String   |yes      |Last event type (S/SS/SSS/L)                                                     |\n+|          |eventCount   |String   |yes      |Event counter for                                                                |", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3Nzg5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554877893", "bodyText": "changed for all lines", "author": "markus7017", "createdAt": "2021-01-11T08:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTI5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTU1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550491559", "bodyText": "Therere", "author": "fwolter", "createdAt": "2020-12-31T14:14:58Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -547,9 +620,16 @@ Using the Thing configuration option `brightnessAutoOn` you could decide if the\n |white     |             |         |         |Color settings: only valid in WHITE mode                               |\n |          |temperature  |Number   |r/w      |color temperature (K): 0..100% or 3000..6500                           |\n |          |brightness   |Dimmer   |         |Brightness: 0..100% or 0..100                                          |\n- \n+\n+Note: The openHAB color picker has only values for red/green/blue (RGB), not for white as supported by the RGBW2.\n+Therere for the binding offers beside channel `hsb` also the `white` channel.", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3MDU5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554870599", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTU1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTgxNA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550491814", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |          |hsb          |HSB      |r/w      |Represents the color picker (HSBType), control r/g/b, bight not white  |\n          \n          \n            \n            |          |hsb          |HSB      |r/w      |Represents the color picker (HSBType), control r/g/b, but not white  |", "author": "fwolter", "createdAt": "2020-12-31T14:16:13Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -569,16 +649,45 @@ Using the Thing configuration option `brightnessAutoOn` you could decide if the\n |----------|-------------|---------|---------|-----------------------------------------------------------------------|\n |control   |autoOn       |Number   |r/w      |Sets a  timer to turn the device ON after every OFF; in sec            |\n |          |autoOff      |Number   |r/w      |Sets a  timer to turn the device OFF after every ON: in sec            |\n-|          |timerActive  |Switch   |yes      |ON: An auto-on/off timer is active                                          |\n+|          |timerActive  |Switch   |yes      |ON: An auto-on/off timer is active                                     |\n |white     |             |         |         |Color settings: only valid in WHITE mode                               |\n |          |brightness   |Dimmer   |         |Brightness: 0..100% or 0..100                                          |\n |meter     |currentWatts |Number   |yes      |Current power consumption in Watts                                     |\n |          |lastPower1   |Number   |yes      |Energy consumption for a round minute, 1 minute  ago                   |\n-|          |totalKWH     |Number   |yes      |Total energy consumption in Watts since the device powered up (resets on restart)|\n+|          |totalKWH     |Number   |yes      |Total energy consumption in kWh since the device powered up (resets on restart)|\n |          |lastUpdate   |DateTime |yes      |Timestamp of the last measurement                                      |\n  \n+## Shelly Duo Color (thing-type: shellyduocolor-color)\n+\n+|Group     |Channel      |Type     |read-only|Description                                                            |\n+|----------|-------------|---------|---------|-----------------------------------------------------------------------|\n+|control   |power        |Switch   |r/w      |Switch light ON/OFF                                                    |\n+|          |button       |Trigger  |yes      |Event trigger, see section Button Events                               |\n+|          |autoOn       |Number   |r/w      |Sets a  timer to turn the device ON after every OFF command; in seconds|\n+|          |autoOff      |Number   |r/w      |Sets a  timer to turn the device OFF after every ON command; in seconds|\n+|          |timerActive  |Switch   |yes      |ON: An auto-on/off timer is active                                     |\n+|color     |             |         |         |Color settings: only valid in COLOR mode                               |\n+|          |hsb          |HSB      |r/w      |Represents the color picker (HSBType), control r/g/b, bight not white  |", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3MDk5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554870992", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MTgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjA1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550492052", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Channels in group `color`or `white`apply depending on the selected mode - they are not active at the same time. \n          \n          \n            \n            Channels in group `color` or `white` apply depending on the selected mode - they are not active at the same time.", "author": "fwolter", "createdAt": "2020-12-31T14:17:23Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -600,6 +709,8 @@ Using the Thing configuration option `brightnessAutoOn` you could decide if the\n |          |             |         |         |0=No effect, 1=Meteor Shower, 2=Gradual Change, 3=Flash                |\n |meter     |currentWatts |Number   |yes      |Current power consumption in Watts                                     |\n \n+Channels in group `color`or `white`apply depending on the selected mode - they are not active at the same time. ", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3NTE1MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554875151", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:13:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNjIwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556816209", "bodyText": "I don't see any change.", "author": "fwolter", "createdAt": "2021-01-13T20:43:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIxMzQ1MA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r561213450", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-20T19:18:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzg3NzAzOA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563877038", "bodyText": "I still see no change.", "author": "fwolter", "createdAt": "2021-01-25T16:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjA1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjEzNA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550492134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `Please Note:` If you have connected an USB cable to the H&T, but channel charger is off make sure that \"Use external power supply\" settings is activated in the Shelly App's device settings.\n          \n          \n            \n            > *Please Note:* If you have connected an USB cable to the H&T, but channel charger is off make sure that \"Use external power supply\" settings is activated in the Shelly App's device settings.", "author": "fwolter", "createdAt": "2020-12-31T14:17:58Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -651,12 +762,13 @@ You can define 2 items (1 Switch, 1 Number) mapping to the same channel, see exa\n |----------|-------------|---------|---------|-----------------------------------------------------------------------|\n |sensors   |temperature  |Number   |yes      |Temperature, unit is reported by tempUnit                              |\n |          |humidity     |Number   |yes      |Relative humidity in %                                                 |\n-|          |charger      |Number   |yes      |ON: USB charging cable is                                              |\n |          |lastUpdate   |DateTime |yes      |Timestamp of the last update (any sensor value changed)                |\n |battery   |batteryLevel |Number   |yes      |Battery Level in %                                                     |\n |          |lowBattery   |Switch   |yes      |Low battery alert (< 20%)                                              |\n \n-### Shelly Flood (thing type: shellyflood)\n+`Please Note:` If you have connected an USB cable to the H&T, but channel charger is off make sure that \"Use external power supply\" settings is activated in the Shelly App's device settings.", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3OTk2Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554879966", "bodyText": "changed for all Please note", "author": "markus7017", "createdAt": "2021-01-11T08:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzg3NzUxMw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563877513", "bodyText": "I see no change.", "author": "fwolter", "createdAt": "2021-01-25T16:52:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjEzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjU1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550492552", "bodyText": "Why are there two Channels for this function? If you would use Contact instead of Switch, the user could easily select the motion icon for visualizing the state in the sitemap.", "author": "fwolter", "createdAt": "2020-12-31T14:20:05Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -680,7 +792,22 @@ You can define 2 items (1 Switch, 1 Number) mapping to the same channel, see exa\n |battery   |batteryLevel |Number   |yes      |Battery Level in %                                                     |\n |          |lowBattery   |Switch   |yes      |Low battery alert (< 20%)                                              |\n \n-### Shelly Button 1 (thing type: shellybutton1)\n+### Shelly Motion (thing-type: shellymotion)\n+\n+|Group     |Channel        |Type     |read-only|Description                                                          |\n+|----------|---------------|---------|---------|---------------------------------------------------------------------|\n+|sensors   |motion         |Switch   |yes      |ON: Motion was detected                                              |\n+|          |motionActive   |Switch   |yes      |ON: Motion is still active                                           |", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg4NzIyMA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554887220", "bodyText": "removed the 2nd channel, device handling is unclear", "author": "markus7017", "createdAt": "2021-01-11T08:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5MjU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NDc0OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550494749", "bodyText": "Logging to info should be used sparsely e.g. a newly started component or a user file that has been loaded. This could be debug or warn. Also, it seems a bit unreasonable to log the stack trace when the network fails.", "author": "fwolter", "createdAt": "2020-12-31T14:31:56Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/coap/ShellyCoapHandler.java", "diffHunk": "@@ -113,9 +121,21 @@ public synchronized void start(String thingName, ShellyThingConfiguration config\n             coapServer.start(config.localIp, this);\n             statusClient = new CoapClient(completeUrl(config.deviceIp, COLOIT_URI_DEVSTATUS))\n                     .setTimeout((long) SHELLY_API_TIMEOUT_MS).useNONs().setEndpoint(coapServer.getEndpoint());\n+            @Nullable\n+            Endpoint endpoint = null;\n+            if (statusClient != null) {\n+                endpoint = statusClient.getEndpoint();\n+            }\n+            if ((endpoint == null) || !endpoint.isStarted()) {\n+                logger.warn(\"{}: Unable to initialize CoAP access (network error)\", thingName);\n+                throw new ShellyApiException(\"Network initialization failed\");\n+            }\n             discover();\n+        } catch (SocketException e) {\n+            logger.warn(\"{}: Unable to initialize CoAP access (socket exception) - {}\", thingName, e.getMessage());\n+            throw new ShellyApiException(\"Network error\", e);\n         } catch (UnknownHostException e) {\n-            logger.debug(\"{}: CoAP Exception\", thingName, e);\n+            logger.info(\"{}: CoAP Exception (Unknown Host)\", thingName, e);", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg4NjY4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554886685", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:33:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NDc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NTE3NQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550495175", "bodyText": "Logging to info should be used sparsely e.g. a newly started component or a user file that has been loaded. This could be debug.", "author": "fwolter", "createdAt": "2020-12-31T14:34:11Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/discovery/ShellyDiscoveryParticipant.java", "diffHunk": "@@ -166,6 +159,9 @@ public DiscoveryResult createResult(final ServiceInfo service) {\n \n                     // create shellyunknown thing - will be changed during thing initialization with valid credentials\n                     thingUID = ShellyThingCreator.getThingUID(name, model, mode, true);\n+                }\n+                if (e.isTimeout()) {\n+                    logger.info(\"{}: {}\", name, messages.get(\"discovery.failed\", address, e.toString()));", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MDE2Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554890162", "bodyText": "removed", "author": "markus7017", "createdAt": "2021-01-11T08:40:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NTE3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NTIyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550495221", "bodyText": "Can you fix the line break?", "author": "fwolter", "createdAt": "2020-12-31T14:34:25Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/discovery/ShellyDiscoveryParticipant.java", "diffHunk": "@@ -188,7 +184,9 @@ public DiscoveryResult createResult(final ServiceInfo service) {\n                 return DiscoveryResultBuilder.create(thingUID).withProperties(properties).withLabel(thingLabel)\n                         .withRepresentationProperty(PROPERTY_DEV_NAME).build();\n             }\n-        } catch (IOException | NullPointerException e) {\n+        } catch (IOException |\n+\n+                NullPointerException e) {", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MDUwOA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554890508", "bodyText": "fixed", "author": "markus7017", "createdAt": "2021-01-11T08:41:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NTIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NTYzMw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550495633", "bodyText": "See above. Logging to info.", "author": "fwolter", "createdAt": "2020-12-31T14:36:19Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyBaseHandler.java", "diffHunk": "@@ -743,13 +763,13 @@ private void checkVersion(ShellyDeviceProfile prf, ShellySettingsStatus status)\n                 }\n                 autoCoIoT = true;\n             }\n+            if (status.update.hasUpdate && !version.checkBeta(getString(prf.fwVersion))) {\n+                logger.info(\"{}: {}\", thingName,\n+                        messages.get(\"versioncheck.update\", status.update.oldVersion, status.update.newVersion));", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjA3Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550496072", "bodyText": "See above. Logging to info.", "author": "fwolter", "createdAt": "2020-12-31T14:38:44Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyRelayHandler.java", "diffHunk": "@@ -222,17 +238,31 @@ private void handleRoller(Command command, String groupName, Integer index, bool\n             }\n \n             if (((command instanceof UpDownType) && UpDownType.UP.equals(command))\n-                    || ((command instanceof OnOffType) && OnOffType.ON.equals(command))) {\n+                    || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.ON))) {\n                 logger.debug(\"{}: Open roller\", thingName);\n                 api.setRollerTurn(index, SHELLY_ALWD_ROLLER_TURN_OPEN);\n-                position = SHELLY_MAX_ROLLER_POS;\n-\n+                int pos = profile.getRollerFav(config.favoriteUP - 1);\n+                position = pos > 0 ? pos : SHELLY_MAX_ROLLER_POS;\n+                if (pos > 0) {\n+                    logger.info(\"{}: Use favoriteUP id {} for positioning roller({}%)\", thingName, config.favoriteUP,\n+                            pos);", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MTIxMA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554891210", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjA3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjE3NA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550496174", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.OFF))) {\n          \n          \n            \n                                || command == OnOffType.OFF) {", "author": "fwolter", "createdAt": "2020-12-31T14:39:19Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyRelayHandler.java", "diffHunk": "@@ -222,17 +238,31 @@ private void handleRoller(Command command, String groupName, Integer index, bool\n             }\n \n             if (((command instanceof UpDownType) && UpDownType.UP.equals(command))\n-                    || ((command instanceof OnOffType) && OnOffType.ON.equals(command))) {\n+                    || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.ON))) {\n                 logger.debug(\"{}: Open roller\", thingName);\n                 api.setRollerTurn(index, SHELLY_ALWD_ROLLER_TURN_OPEN);\n-                position = SHELLY_MAX_ROLLER_POS;\n-\n+                int pos = profile.getRollerFav(config.favoriteUP - 1);\n+                position = pos > 0 ? pos : SHELLY_MAX_ROLLER_POS;\n+                if (pos > 0) {\n+                    logger.info(\"{}: Use favoriteUP id {} for positioning roller({}%)\", thingName, config.favoriteUP,\n+                            pos);\n+                }\n             }\n             if (((command instanceof UpDownType) && UpDownType.DOWN.equals(command))\n-                    || ((command instanceof OnOffType) && OnOffType.OFF.equals(command))) {\n+                    || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.OFF))) {", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MjA1NA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554892054", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:44:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyMjE1OA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556822158", "bodyText": "I don't see any change.", "author": "fwolter", "createdAt": "2021-01-13T20:55:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIxNDA3MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r561214071", "bodyText": "changed all", "author": "markus7017", "createdAt": "2021-01-20T19:19:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjE3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjIxOQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550496219", "bodyText": "See above. Logging to info.", "author": "fwolter", "createdAt": "2020-12-31T14:39:41Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyRelayHandler.java", "diffHunk": "@@ -222,17 +238,31 @@ private void handleRoller(Command command, String groupName, Integer index, bool\n             }\n \n             if (((command instanceof UpDownType) && UpDownType.UP.equals(command))\n-                    || ((command instanceof OnOffType) && OnOffType.ON.equals(command))) {\n+                    || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.ON))) {\n                 logger.debug(\"{}: Open roller\", thingName);\n                 api.setRollerTurn(index, SHELLY_ALWD_ROLLER_TURN_OPEN);\n-                position = SHELLY_MAX_ROLLER_POS;\n-\n+                int pos = profile.getRollerFav(config.favoriteUP - 1);\n+                position = pos > 0 ? pos : SHELLY_MAX_ROLLER_POS;\n+                if (pos > 0) {\n+                    logger.info(\"{}: Use favoriteUP id {} for positioning roller({}%)\", thingName, config.favoriteUP,\n+                            pos);\n+                }\n             }\n             if (((command instanceof UpDownType) && UpDownType.DOWN.equals(command))\n-                    || ((command instanceof OnOffType) && OnOffType.OFF.equals(command))) {\n+                    || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.OFF))) {\n                 logger.debug(\"{}: Closing roller\", thingName);\n-                api.setRollerTurn(index, SHELLY_ALWD_ROLLER_TURN_CLOSE);\n-                position = SHELLY_MIN_ROLLER_POS;\n+                int pos = profile.getRollerFav(config.favoriteDOWN - 1);\n+                if (pos > 0) {\n+                    // use favorite position\n+                    if (pos > 0) {\n+                        logger.info(\"{}: Use favoriteDOWN id {} for positioning roller ({}%)\", thingName,\n+                                config.favoriteDOWN, pos);", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MjIyMA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554892220", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:45:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NjIxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzE0Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550497146", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            thing-type.config.shelly.roller.favoriteUP.label = Favoriten  ID f\ufffdr UP\n          \n          \n            \n            thing-type.config.shelly.roller.favoriteUP.label = Favoriten ID f\ufffdr UP", "author": "fwolter", "createdAt": "2020-12-31T14:45:25Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -87,25 +105,61 @@ thing-type.shelly.shellyrgbw2-color.description = Shelly RGBW-Controller im Farb\n thing-type.shelly.shellyrgbw2-white.label = Shelly RGBW2 White Mode (SHRGBW2)\n thing-type.shelly.shellyrgbw2-white.description = Shelly RGBW-Controller im Wei\ufffd-Modus, 4 Streifen\n \n-# thing config - generic\n-thing-type.config.shelly.generic.userId.label = Benutzer\n-thing-type.config.shelly.generic.userId.description = Benutzerkennung f\ufffdr API-Zugriff\n-thing-type.config.shelly.generic.password.label = Passwort\n-thing-type.config.shelly.generic.password.description = Passwort f\ufffdr API-Zugriff\n-thing-type.config.shelly.generic.deviceIp.label = IP Adresse\n-thing-type.config.shelly.generic.deviceIp.description = IP Adresse der Shelly-Komponente\n-thing-type.config.shelly.generic.weakSignal.label = Schwaches Signal (dBm)\n-thing-type.config.shelly.generic.weakSignal.description = Ein Alarm wird ausgel\ufffdst, wenn das WiFi-Signal diesen Wert unterschreitet. Voreinstellung: -80 dBm\n-thing-type.config.shelly.generic.eventsButton.label = Button Events\n-thing-type.config.shelly.generic.eventsButton.description = Aktiviert die Button Action URLS\n-thing-type.config.shelly.generic.eventsPush.label = Push Events\n-thing-type.config.shelly.generic.eventsPush.description = Aktiviert die Push Button Action URLS\n-thing-type.config.shelly.generic.eventsSwitch.label = Output Events\n-thing-type.config.shelly.generic.eventsSwitch.description = Aktiviert die Output Action URLS\n-thing-type.config.shelly.generic.eventsCoIoT.label = CoIoT aktivieren\n-thing-type.config.shelly.generic.eventsCoIoT.description = Aktiviert CoIoT-Protokoll (CoAP-basiert)\n-thing-type.config.shelly.generic.updateInterval.label = Status-Intervall \n-thing-type.config.shelly.generic.updateInterval.description = Intervall f\ufffdr die Hintergundaktualisierung\n+# thing config - relay\n+thing-type.config.shelly.relay.userId.label = Benutzer\n+thing-type.config.shelly.relay.userId.description = Benutzerkennung f\ufffdr API-Zugriff\n+thing-type.config.shelly.relay.password.label = Passwort\n+thing-type.config.shelly.relay.password.description = Passwort f\ufffdr API-Zugriff\n+thing-type.config.shelly.relay.deviceIp.label = IP Adresse\n+thing-type.config.shelly.relay.deviceIp.description = IP Adresse der Shelly-Komponente\n+thing-type.config.shelly.relay.eventsButton.label = Button Events\n+thing-type.config.shelly.relay.eventsButton.description = Aktiviert die Button Action URLS\n+thing-type.config.shelly.relay.eventsPush.label = Push Events\n+thing-type.config.shelly.relay.eventsPush.description = Aktiviert die Push Button Action URLS\n+thing-type.config.shelly.relay.eventsSwitch.label = Output Events\n+thing-type.config.shelly.relay.eventsSwitch.description = Aktiviert die Output Action URLS\n+thing-type.config.shelly.relay.eventsCoIoT.label = CoIoT aktivieren\n+thing-type.config.shelly.relay.eventsCoIoT.description = Aktiviert CoIoT-Protokoll (CoAP-basiert)\n+thing-type.config.shelly.relay.updateInterval.label = Status-Intervall \n+thing-type.config.shelly.relay.updateInterval.description = Intervall f\ufffdr die Hintergundaktualisierung\n+\n+# thing config - roller\n+thing-type.config.shelly.roller.userId.label = Benutzer\n+thing-type.config.shelly.roller.userId.description = Benutzerkennung f\ufffdr API-Zugriff\n+thing-type.config.shelly.roller.password.label = Passwort\n+thing-type.config.shelly.roller.password.description = Passwort f\ufffdr API-Zugriff\n+thing-type.config.shelly.roller.favoriteUP.label = Favoriten  ID f\ufffdr UP", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MjY1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554892656", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzE0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzU0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550497541", "bodyText": "Is this English by intention?", "author": "fwolter", "createdAt": "2020-12-31T14:47:15Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -370,17 +462,19 @@ channel-type.shelly.timerAutoOff.description = Wenn das Relais eingeschaltet wir\n channel-type.shelly.timerActive.label = Timer aktiv\n channel-type.shelly.timerActive.description = ON: Auto-On/Off Timer ist aktiv\n channel-type.shelly.temperature1.label = Temperatur 1\n-channel-type.shelly.temperature1.description = Temperatur des externen Sensors #1\n+channel-type.shelly.temperature1.description = Temperatur des externen Sensors 1\n channel-type.shelly.temperature2.label = Temperatur 2\n-channel-type.shelly.temperature2.description = Temperatur des externen Sensors #2\n+channel-type.shelly.temperature2.description = Temperatur des externen Sensors 2\n channel-type.shelly.temperature3.label = Temperatur 3\n-channel-type.shelly.temperature3.description = Temperatur des externen Sensors #3\n+channel-type.shelly.temperature3.description = Temperatur des externen Sensors 3\n channel-type.shelly.humidity.label = Luftfeuchtigkeit\n channel-type.shelly.humidity.description = Relative Luftfeuchtigkeit (0..100%)\n channel-type.shelly.rollerShutter.label = Steuerung (0=offen, 100=geschlossen)\n channel-type.shelly.rollerShutter.description = Steuerung f\ufffdr den Rollladen: UP, DOWN, STOP, Position (0=offen, 100=geschlossen)\n channel-type.shelly.rollerPosition.label = Position (100=offen, 0=zu)\n channel-type.shelly.rollerPosition.description = Invertierte Position des Rollladen: 100=offen, 0=zu\n+channel-type.shelly.rollerFavorite.label = Positionsfavorit\n+channel-type.shelly.rollerFavorite.description = Set roller position by selecting favorite 1-4 (needs to be defined in the Shelly App, 0=n/a)", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5NDA5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554894093", "bodyText": "nope", "author": "markus7017", "createdAt": "2021-01-11T08:49:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzU5NA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550497594", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            channel-type.shelly.meterAccuReturned.description = Kumulierte Einspeisung in kW/h\n          \n          \n            \n            channel-type.shelly.meterAccuReturned.description = Kumulierte Einspeisung in kWh", "author": "fwolter", "createdAt": "2020-12-31T14:47:38Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -406,8 +500,8 @@ channel-type.shelly.meterAccuWatts.label = Kumulierter Verbrauch\n channel-type.shelly.meterAccuWatts.description = Kumulierter Verbrauch in Watt\n channel-type.shelly.meterAccuTotal.label = Kumulierter Gesamtverbrauch\n channel-type.shelly.meterAccuTotal.description = Kumulierter Gesamtverbrauch in kW/h\n-channel-type.shelly.meterAccuReturned.label = Kumulierter Einspeisung\n-channel-type.shelly.meterAccuReturned.description = Kumulierter Einspeisung in kW/h\n+channel-type.shelly.meterAccuReturned.label = Kumulierte Einspeisung\n+channel-type.shelly.meterAccuReturned.description = Kumulierte Einspeisung in kW/h", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5MzE5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554893199", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T08:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzgzMw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550497833", "bodyText": "This will produce warnings if fed by a float. Better use %.0f", "author": "fwolter", "createdAt": "2020-12-31T14:48:47Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/thing/device.xml", "diffHunk": "@@ -102,7 +102,7 @@\n \t\t<tags>\n \t\t\t<tag>CurrentTemperature</tag>\n \t\t</tags>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%d %unit%\">", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3NTAwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554875005", "bodyText": "changed for all %d", "author": "markus7017", "createdAt": "2021-01-11T08:13:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzkxNg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550497916", "bodyText": "Labels are expected to be as short as possible. Guideline is 2-3 words with max 20-25 chars. See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions", "author": "fwolter", "createdAt": "2020-12-31T14:49:12Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/thing/lights.xml", "diffHunk": "@@ -32,6 +32,21 @@\n \t\t<config-description-ref uri=\"thing-type:shelly:light\"/>\n \t</thing-type>\n \n+\t<thing-type id=\"shellycolorbulb\">\n+\t\t<label>Shelly Duo Color Bulb (SHSCB-1)</label>", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3ODM4Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554878386", "bodyText": "but this is the product name", "author": "markus7017", "createdAt": "2021-01-11T08:16:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Njc5MzIyNg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556793226", "bodyText": "You could remove the abbreviation, or?", "author": "fwolter", "createdAt": "2021-01-13T19:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIxMzgyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r561213821", "bodyText": "all other thing labels are following this schema", "author": "markus7017", "createdAt": "2021-01-20T19:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTcwODgyNw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r561708827", "bodyText": "There will be a checkstyle rule soon, which warns at 20 chars and generates an error at 25 chars. Would be great if you could re-work the labels in a follow-up PR.", "author": "fwolter", "createdAt": "2021-01-21T09:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NzkxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5ODI4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550498282", "bodyText": "The unit shouldn't be mentioned as the user can also decide to display the value in Wh.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<label>Total Returned Energy (kw/h)</label>\n          \n          \n            \n            \t\t<label>Total Returned Energy</label>", "author": "fwolter", "createdAt": "2020-12-31T14:51:14Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/thing/relay.xml", "diffHunk": "@@ -431,91 +453,77 @@\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Watt</label>\n \t\t<description>Current power consumption in Watt</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.2f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterAccuWatts\" advanced=\"true\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Accumulated Watt</label>\n \t\t<description>Accumulated current power consumption in Watt from all meters</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.2f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterAccuTotal\" advanced=\"true\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Accumulated Total</label>\n \t\t<description>Accumulated total power consumption in kw/h from all meters</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterAccuReturned\" advanced=\"true\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Accumulated Returned</label>\n \t\t<description>Accumulated returned power consumption in kw/h from all meters</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterReactive\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Reactive Watt</label>\n \t\t<description>Instantaneous reactive power in Watts (W)</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"lastPower1\" advanced=\"true\">\n \t\t<item-type>Number:Energy</item-type>\n \t\t<label>Last Power #1</label>\n \t\t<description>Last power consumption #1 - one rounded minute</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"lastPower2\" advanced=\"true\">\n-\t\t<item-type>Number:Energy</item-type>\n-\t\t<label>Last Power #2</label>\n-\t\t<description>Last power consumption #2 - one rounded minute</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"lastPower3\" advanced=\"true\">\n-\t\t<item-type>Number:Energy</item-type>\n-\t\t<label>Last Power #3</label>\n-\t\t<description>Last power consumption #3 - one rounded minute</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterTotal\">\n \t\t<item-type>Number:Energy</item-type>\n \t\t<label>Total Energy</label>\n \t\t<description>Total power consumption in kw/h</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterReturned\">\n \t\t<item-type>Number:Energy</item-type>\n \t\t<label>Total Returned Energy (kw/h)</label>", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3NzMzOQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554877339", "bodyText": "removed all kw/h", "author": "markus7017", "createdAt": "2021-01-11T08:15:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5ODI4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5ODM0MA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550498340", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<description>Total returned energy in kw/h</description>\n          \n          \n            \n            \t\t<description>Total returned energy</description>", "author": "fwolter", "createdAt": "2020-12-31T14:51:38Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/thing/relay.xml", "diffHunk": "@@ -431,91 +453,77 @@\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Watt</label>\n \t\t<description>Current power consumption in Watt</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.2f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterAccuWatts\" advanced=\"true\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Accumulated Watt</label>\n \t\t<description>Accumulated current power consumption in Watt from all meters</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.2f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterAccuTotal\" advanced=\"true\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Accumulated Total</label>\n \t\t<description>Accumulated total power consumption in kw/h from all meters</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterAccuReturned\" advanced=\"true\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Accumulated Returned</label>\n \t\t<description>Accumulated returned power consumption in kw/h from all meters</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterReactive\">\n \t\t<item-type>Number:Power</item-type>\n \t\t<label>Reactive Watt</label>\n \t\t<description>Instantaneous reactive power in Watts (W)</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"lastPower1\" advanced=\"true\">\n \t\t<item-type>Number:Energy</item-type>\n \t\t<label>Last Power #1</label>\n \t\t<description>Last power consumption #1 - one rounded minute</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"lastPower2\" advanced=\"true\">\n-\t\t<item-type>Number:Energy</item-type>\n-\t\t<label>Last Power #2</label>\n-\t\t<description>Last power consumption #2 - one rounded minute</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"lastPower3\" advanced=\"true\">\n-\t\t<item-type>Number:Energy</item-type>\n-\t\t<label>Last Power #3</label>\n-\t\t<description>Last power consumption #3 - one rounded minute</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterTotal\">\n \t\t<item-type>Number:Energy</item-type>\n \t\t<label>Total Energy</label>\n \t\t<description>Total power consumption in kw/h</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%.3f %unit%\">\n \t\t</state>\n \t</channel-type>\n \t<channel-type id=\"meterReturned\">\n \t\t<item-type>Number:Energy</item-type>\n \t\t<label>Total Returned Energy (kw/h)</label>\n \t\t<description>Total returned energy in kw/h</description>", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3NzU2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554877567", "bodyText": "removed", "author": "markus7017", "createdAt": "2021-01-11T08:15:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5ODM0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5ODQ3MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r550498471", "bodyText": "See above.", "author": "fwolter", "createdAt": "2020-12-31T14:52:20Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/thing/sensor.xml", "diffHunk": "@@ -285,7 +271,7 @@\n \t\t<item-type>Number:Illuminance</item-type>\n \t\t<label>Lux</label>\n \t\t<description>Brightness from the sensor (Lux)</description>\n-\t\t<state readOnly=\"true\" pattern=\"%f %unit%\">\n+\t\t<state readOnly=\"true\" pattern=\"%d %unit%\">", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg3ODA1NA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r554878054", "bodyText": "changed for all", "author": "markus7017", "createdAt": "2021-01-11T08:16:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5ODQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI2MjkwNA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r555262904", "bodyText": "\"Bevorzugte Position\" oder \"Voreingestellte Position\"?", "author": "falkena", "createdAt": "2021-01-11T18:45:24Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -370,17 +462,19 @@ channel-type.shelly.timerAutoOff.description = Wenn das Relais eingeschaltet wir\n channel-type.shelly.timerActive.label = Timer aktiv\n channel-type.shelly.timerActive.description = ON: Auto-On/Off Timer ist aktiv\n channel-type.shelly.temperature1.label = Temperatur 1\n-channel-type.shelly.temperature1.description = Temperatur des externen Sensors #1\n+channel-type.shelly.temperature1.description = Temperatur des externen Sensors 1\n channel-type.shelly.temperature2.label = Temperatur 2\n-channel-type.shelly.temperature2.description = Temperatur des externen Sensors #2\n+channel-type.shelly.temperature2.description = Temperatur des externen Sensors 2\n channel-type.shelly.temperature3.label = Temperatur 3\n-channel-type.shelly.temperature3.description = Temperatur des externen Sensors #3\n+channel-type.shelly.temperature3.description = Temperatur des externen Sensors 3\n channel-type.shelly.humidity.label = Luftfeuchtigkeit\n channel-type.shelly.humidity.description = Relative Luftfeuchtigkeit (0..100%)\n channel-type.shelly.rollerShutter.label = Steuerung (0=offen, 100=geschlossen)\n channel-type.shelly.rollerShutter.description = Steuerung f\ufffdr den Rollladen: UP, DOWN, STOP, Position (0=offen, 100=geschlossen)\n channel-type.shelly.rollerPosition.label = Position (100=offen, 0=zu)\n channel-type.shelly.rollerPosition.description = Invertierte Position des Rollladen: 100=offen, 0=zu\n+channel-type.shelly.rollerFavorite.label = Positionsfavorit", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM4OTYxOA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r555389618", "bodyText": "that's not what it mean, you could setup 4 favorites in the device and this channel allows the selection\nI want to refer to \"favorite\", because that's the language used by the App\nAny other idea?", "author": "markus7017", "createdAt": "2021-01-11T22:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI2MjkwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI2Mzk0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r555263941", "bodyText": "\"Spannung\"?", "author": "falkena", "createdAt": "2021-01-11T18:47:08Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -487,6 +581,8 @@ channel-type.shelly.sensorIllumination.state.option.unknown = Unbekannt\n channel-type.shelly.sensorIllumination.description = Angabe zum erkannten Tageslichtwert \n channel-type.shelly.sensorPPM.label = Gas-Konzentration\n channel-type.shelly.sensorPPM.description = Gemessene Konzentration in PPM\n+channel-type.shelly.sensorADC.label = Voltage (ADC)", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM4OTg2Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r555389863", "bodyText": "changed", "author": "markus7017", "createdAt": "2021-01-11T22:49:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI2Mzk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI2NTE0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r555265143", "bodyText": "\"Voreinstellung der Positionen\"?", "author": "falkena", "createdAt": "2021-01-11T18:49:21Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -27,17 +35,21 @@ message.init.noipaddress = Es konnte keine lokale IP-Adresse ermittelt werden. B\n message.init.protected = Das Ger\ufffdt ist passwortgesch\ufffdtzt, die Zugangsdaten m\ufffdssen in der Thing Konfiguration hinterlegt werden.\n message.command.failed = FEHLER: Der Befehl {0} f\ufffdr Kanal {1} kann nicht verarbeitet werden\n message.command.init = Thing aktuell nicht initialisiert, der Befehl {0} f\ufffdhrt zur Initialisierung\n+message.status.unknown.initializing = Initialisierung oder Ger\ufffdt im Schlafmodus. \n message.statusupdate.failed = Status konnte nicht aktualisiert werden\n message.event.triggered = Event erzeugt: {0}\n message.coap.init.failed = CoAP/CoIoT konnte nicht gestartet werden: {0}\n message.discovery.disabled = Das Ger\ufffdt ist als \"nicht erkennen\" markiert und wird nicht \ufffdbernommen.\n message.discovery.protected = Das Ger\ufffdt mit der IP-Adresse {0} ist zugriffsgesch\ufffdtzt und keine Zugangsdaten konfiguriert.\n message.discovery.failed = Erkennung des Ger\ufffdtes mit der IP-Adresse {0} ist fehlgeschlagen\n message.roller.calibrating = Das Ger\ufffdt ist nicht kalibriert. Es ist eine Kalibrierung mit der Shelly App erforderlich.\n+message.roller.favmissing = Positions-Favoriten werden von der installierten Firmwareversion nicht unterst\ufffdtzt (ab 1.9.2), oder sind nicht in der Shelly App konfiguriert.", "originalCommit": "1b5870087026072ee462495c02a52d42426d9360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM4OTk0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r555389942", "bodyText": "see above", "author": "markus7017", "createdAt": "2021-01-11T22:49:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI2NTE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDI2MA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556814260", "bodyText": "MQQT or MQTT?", "author": "fwolter", "createdAt": "2021-01-13T20:39:42Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -7,19 +7,20 @@ Allterco provides a rich set of smart home devices. All of them are WiFi enabled\n The binding is officially acknowledged by Allterco and openHAB is listed as a reference and directly supports the openHAB community.\n \n The binding controls the devices independently from the Allterco Shelly Cloud (in fact it can be disabled).\n-The binding co-exists with Shelly App for Smartphones, Shelly Web App, Shelly Cloud, mqqt and other 3rd party Apps.\n+The binding co-exists with Shelly App for Smartphones, Shelly App, Shelly Cloud, MQQT and other 3rd party Apps.", "originalCommit": "19eb517aac90ff1385a936168690f671e3ad0570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MDU2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557650567", "bodyText": "fixed", "author": "markus7017", "createdAt": "2021-01-14T19:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzE0NDk0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563144942", "bodyText": "I still see MQQT", "author": "fwolter", "createdAt": "2021-01-23T12:07:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzg2NzE4MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563867181", "bodyText": "fixed", "author": "markus7017", "createdAt": "2021-01-25T16:38:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDU1MA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556814550", "bodyText": "Can you fix the formatting of the table?", "author": "fwolter", "createdAt": "2021-01-13T20:40:15Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -189,6 +203,7 @@ Every device has a channel group `device` with the following channels:\n |          |updateAvailable    |Switch  |yes      |ON: A firmware update is available                                               |\n |          |statusLed          |Switch  |r/w      |ON: Status LED is disabled, OFF: LED enabled                                     |\n |          |powerLed           |Switch  |r/w      |ON: Power LED is disabled, OFF: LED enabled                                      |\n+|          |charger            |Switch  |yes      |ON: USB charging cable is connected external power supply activated.   |", "originalCommit": "19eb517aac90ff1385a936168690f671e3ad0570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MDc2NA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557650764", "bodyText": "fixed", "author": "markus7017", "createdAt": "2021-01-14T19:43:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDU1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzE0NTE1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563145155", "bodyText": "The last column is still too small. Did you push your changes or went something wrong during the merge/rebase?", "author": "fwolter", "createdAt": "2021-01-23T12:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDU1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzg2NzcyOA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563867728", "bodyText": "fixd", "author": "markus7017", "createdAt": "2021-01-25T16:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNDU1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNTgwNA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556815804", "bodyText": "This will render in two rows. Better put it in the same line. Same for the full Channel.", "author": "fwolter", "createdAt": "2021-01-13T20:42:52Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -569,16 +648,45 @@ Using the Thing configuration option `brightnessAutoOn` you could decide if the\n |----------|-------------|---------|---------|-----------------------------------------------------------------------|\n |control   |autoOn       |Number   |r/w      |Sets a  timer to turn the device ON after every OFF; in sec            |\n |          |autoOff      |Number   |r/w      |Sets a  timer to turn the device OFF after every ON: in sec            |\n-|          |timerActive  |Switch   |yes      |ON: An auto-on/off timer is active                                          |\n+|          |timerActive  |Switch   |yes      |ON: An auto-on/off timer is active                                     |\n |white     |             |         |         |Color settings: only valid in WHITE mode                               |\n |          |brightness   |Dimmer   |         |Brightness: 0..100% or 0..100                                          |\n |meter     |currentWatts |Number   |yes      |Current power consumption in Watts                                     |\n |          |lastPower1   |Number   |yes      |Energy consumption for a round minute, 1 minute  ago                   |\n-|          |totalKWH     |Number   |yes      |Total energy consumption in Watts since the device powered up (resets on restart)|\n+|          |totalKWH     |Number   |yes      |Total energy consumption in kWh since the device powered up (resets on restart)|\n |          |lastUpdate   |DateTime |yes      |Timestamp of the last measurement                                      |\n  \n+## Shelly Duo Color (thing-type: shellyduocolor-color)\n+\n+|Group     |Channel      |Type     |read-only|Description                                                            |\n+|----------|-------------|---------|---------|-----------------------------------------------------------------------|\n+|control   |power        |Switch   |r/w      |Switch light ON/OFF                                                    |\n+|          |button       |Trigger  |yes      |Event trigger, see section Button Events                               |\n+|          |autoOn       |Number   |r/w      |Sets a  timer to turn the device ON after every OFF command; in seconds|\n+|          |autoOff      |Number   |r/w      |Sets a  timer to turn the device OFF after every ON command; in seconds|\n+|          |timerActive  |Switch   |yes      |ON: An auto-on/off timer is active                                     |\n+|color     |             |         |         |Color settings: only valid in COLOR mode                               |\n+|          |hsb          |HSB      |r/w      |Represents the color picker (HSBType), control r/g/b, but not white    |\n+|          |full         |String   |r/w      |Set Red / Green / Blue / Yellow / White mode and switch mode           |\n+|          |             |         |r/w      |Valid settings: \"red\", \"green\", \"blue\", \"yellow\", \"white\" or \"r,g,b,w\" | \n+|          |red          |Dimmer   |r/w      |Red brightness: 0..100% or 0..255 (control only the red channel)       |\n+|          |green        |Dimmer   |r/w      |Green brightness: 0..100% or 0..255 (control only the green channel)   |\n+|          |blue         |Dimmer   |r/w      |Blue brightness: 0..100% or 0..255 (control only the blue channel)     |\n+|          |white        |Dimmer   |r/w      |White brightness: 0..100% or 0..255 (control only the white channel)   |\n+|          |gain         |Dimmer   |r/w      |Gain setting: 0..100%     or 0..100                                    |\n+|          |effect       |Number   |r/w      |Puts the light into effect mode: 0..3)                                 |\n+|          |             |         |         |0=No effect, 1=Meteor Shower, 2=Gradual Change, 3=Flash                |", "originalCommit": "19eb517aac90ff1385a936168690f671e3ad0570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MTEzNw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557651137", "bodyText": "fixed", "author": "markus7017", "createdAt": "2021-01-14T19:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNTgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNzkzMg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556817932", "bodyText": "Isn't there a reasonable replacement for getHostAddress()? If you don't want to fix it now, better leave the annotation away.", "author": "fwolter", "createdAt": "2021-01-13T20:47:08Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/discovery/ShellyDiscoveryParticipant.java", "diffHunk": "@@ -105,6 +97,7 @@ protected void modified(final ComponentContext componentContext) {\n         bindingConfig.updateFromProperties(componentContext.getProperties());\n     }\n \n+    @SuppressWarnings(\"deprecation\")", "originalCommit": "19eb517aac90ff1385a936168690f671e3ad0570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MTYzNg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557651636", "bodyText": "annotation removed", "author": "markus7017", "createdAt": "2021-01-14T19:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxNzkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyMTk1Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556821953", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.ON))) {\n          \n          \n            \n                                || command == OnOffType.ON) {", "author": "fwolter", "createdAt": "2021-01-13T20:54:57Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyRelayHandler.java", "diffHunk": "@@ -222,17 +238,31 @@ private void handleRoller(Command command, String groupName, Integer index, bool\n             }\n \n             if (((command instanceof UpDownType) && UpDownType.UP.equals(command))\n-                    || ((command instanceof OnOffType) && OnOffType.ON.equals(command))) {\n+                    || ((command instanceof OnOffType) && ((OnOffType) command == OnOffType.ON))) {", "originalCommit": "19eb517aac90ff1385a936168690f671e3ad0570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MjQ3Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557652472", "bodyText": "are you sure that I could remove the instance check (command may be of different types)", "author": "markus7017", "createdAt": "2021-01-14T19:46:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyMTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MjgxNQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557652815", "bodyText": "or do you mean\nif (((command instanceof UpDownType) && UpDownType.UP.equals(command))\n|| ((command instanceof OnOffType) && (command == OnOffType.ON))) {\n?", "author": "markus7017", "createdAt": "2021-01-14T19:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyMTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODk4OTM2MA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r558989360", "bodyText": "Actually you can do if(command == UpDownType.UP || command == OnOffType.ON). The == operator will return false if the type is different.", "author": "fwolter", "createdAt": "2021-01-16T18:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyMTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIwMTgyNA==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r561201824", "bodyText": "changed all", "author": "markus7017", "createdAt": "2021-01-20T18:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyMTk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyNDkxMQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r556824911", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t<channel-type id=\"sensorMotionn\">\n          \n          \n            \n            \t<channel-type id=\"sensorMotion\">", "author": "fwolter", "createdAt": "2021-01-13T21:00:12Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/OH-INF/thing/sensor.xml", "diffHunk": "@@ -300,6 +286,20 @@\n \t\t\t</options>\n \t\t</state>\n \t</channel-type>\n+\t<channel-type id=\"motionTimestamp\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Last motion</label>\n+\t\t<description>Timestamp of last detected motion</description>\n+\t\t<state readOnly=\"true\">\n+\t\t</state>\n+\t</channel-type>\n+\t<channel-type id=\"sensorMotionn\">", "originalCommit": "19eb517aac90ff1385a936168690f671e3ad0570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1MzgzNQ==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r557653835", "bodyText": "fixed", "author": "markus7017", "createdAt": "2021-01-14T19:48:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgyNDkxMQ=="}], "type": "inlineReview"}, {"oid": "41899568cd384d6610b9833049214ccc94240251", "url": "https://github.com/openhab/openhab-addons/commit/41899568cd384d6610b9833049214ccc94240251", "message": "This PR merges the 2.5 code base with new features, a bunch of bug fixes\nand improved documentation. Parts of the code has been re-factored and\nvaious issues are fixed/optimized along the way.\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T15:54:43Z", "type": "commit"}, {"oid": "d720f4623f4952d79f90fcf4604d60b7dfaae066", "url": "https://github.com/openhab/openhab-addons/commit/d720f4623f4952d79f90fcf4604d60b7dfaae066", "message": "Minor fixed, support for Shelly Color Bulb, Shelly Motion\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T15:54:43Z", "type": "commit"}, {"oid": "ce1a3ba7286dc97b7042039be8174a58a55b1d69", "url": "https://github.com/openhab/openhab-addons/commit/ce1a3ba7286dc97b7042039be8174a58a55b1d69", "message": "Review changes applied\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T15:54:43Z", "type": "commit"}, {"oid": "d49e2530d76480933e16c7101c7ddbcf3cbbf051", "url": "https://github.com/openhab/openhab-addons/commit/d49e2530d76480933e16c7101c7ddbcf3cbbf051", "message": "review change applied\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T15:54:44Z", "type": "commit"}, {"oid": "94c67caf895503206f5771e5b81dd862e18928f1", "url": "https://github.com/openhab/openhab-addons/commit/94c67caf895503206f5771e5b81dd862e18928f1", "message": "review changes\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T15:54:44Z", "type": "commit"}, {"oid": "94c67caf895503206f5771e5b81dd862e18928f1", "url": "https://github.com/openhab/openhab-addons/commit/94c67caf895503206f5771e5b81dd862e18928f1", "message": "review changes\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T15:54:44Z", "type": "forcePushed"}, {"oid": "8336b8884903091b6e3f4017f2feb69208263973", "url": "https://github.com/openhab/openhab-addons/commit/8336b8884903091b6e3f4017f2feb69208263973", "message": "Review changes\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T19:10:37Z", "type": "commit"}, {"oid": "41719db5c4c8be7ea03a670d484cbbd7a9987861", "url": "https://github.com/openhab/openhab-addons/commit/41719db5c4c8be7ea03a670d484cbbd7a9987861", "message": "review changes\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T19:20:53Z", "type": "commit"}, {"oid": "41719db5c4c8be7ea03a670d484cbbd7a9987861", "url": "https://github.com/openhab/openhab-addons/commit/41719db5c4c8be7ea03a670d484cbbd7a9987861", "message": "review changes\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-20T19:20:53Z", "type": "forcePushed"}, {"oid": "fc0ee6249c8c28d89703915d2264c9573b856a27", "url": "https://github.com/openhab/openhab-addons/commit/fc0ee6249c8c28d89703915d2264c9573b856a27", "message": "README updated\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-23T16:14:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzg4MDk0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r563880943", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        ;", "author": "fwolter", "createdAt": "2021-01-25T16:56:28Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/provider/ShellyChannelDefinitions.java", "diffHunk": "@@ -0,0 +1,609 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.shelly.internal.provider;\n+\n+import static org.openhab.binding.shelly.internal.ShellyBindingConstants.*;\n+import static org.openhab.binding.shelly.internal.util.ShellyUtils.*;\n+\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import javax.measure.Unit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellyControlRoller;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellyInputState;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsDimmer;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsEMeter;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsGlobal;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsMeter;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsRelay;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsRgbwLight;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellySettingsStatus;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellyStatusLightChannel;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellyStatusRelay;\n+import org.openhab.binding.shelly.internal.api.ShellyApiJsonDTO.ShellyStatusSensor;\n+import org.openhab.binding.shelly.internal.api.ShellyDeviceProfile;\n+import org.openhab.binding.shelly.internal.handler.ShellyBaseHandler;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.binding.builder.ChannelBuilder;\n+import org.openhab.core.thing.type.ChannelKind;\n+import org.openhab.core.thing.type.ChannelTypeUID;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link ShellyCHANNEL_DEFINITIONSDTO} defines channel information for dynamically created channels. Those will be\n+ * added on the first thing status update\n+ *\n+ * @author Markus Michels - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(service = ShellyChannelDefinitions.class)\n+public class ShellyChannelDefinitions {\n+\n+    public static final String ITEMT_STRING = \"String\";\n+    public static final String ITEMT_NUMBER = \"Number\";\n+    public static final String ITEMT_SWITCH = \"Switch\";\n+    public static final String ITEMT_CONTACT = \"Contact\";\n+    public static final String ITEMT_ROLLER = \"Rollershutter\";\n+    public static final String ITEMT_DIMMER = \"Dimmer\";\n+    public static final String ITEMT_LOCATION = \"Location\";\n+    public static final String ITEMT_DATETIME = \"DateTime\";\n+    public static final String ITEMT_TEMP = \"Number:Temperature\";\n+    public static final String ITEMT_LUX = \"Number:Illuminance\";\n+    public static final String ITEMT_POWER = \"Number:Power\";\n+    public static final String ITEMT_ENERGY = \"Number:Energy\";\n+    public static final String ITEMT_VOLT = \"Number:ElectricPotential\";\n+    public static final String ITEMT_AMP = \"Number:ElectricPotential\";\n+    public static final String ITEMT_ANGLE = \"Number:Angle\";\n+    public static final String ITEMT_DISTANCE = \"Number:Length\";\n+    public static final String ITEMT_SPEED = \"Number:Speed\";\n+    public static final String ITEMT_VOLUME = \"Number:Volume\";\n+    public static final String ITEMT_TIME = \"Number:Time\";\n+    public static final String ITEMT_PERCENT = \"Number:Dimensionless\";\n+\n+    // shortcuts to avoid line breaks (make code more readable)\n+    private static final String CHGR_DEVST = CHANNEL_GROUP_DEV_STATUS;\n+    private static final String CHGR_RELAY = CHANNEL_GROUP_RELAY_CONTROL;\n+    private static final String CHGR_ROLLER = CHANNEL_GROUP_ROL_CONTROL;\n+    private static final String CHGR_LIGHT = CHANNEL_GROUP_LIGHT_CONTROL;\n+    private static final String CHGR_STATUS = CHANNEL_GROUP_STATUS;\n+    private static final String CHGR_METER = CHANNEL_GROUP_METER;\n+    private static final String CHGR_SENSOR = CHANNEL_GROUP_SENSOR;\n+    private static final String CHGR_BAT = CHANNEL_GROUP_BATTERY;\n+\n+    public static final String PREFIX_GROUP = \"group-type.\" + BINDING_ID + \".\";\n+    public static final String PREFIX_CHANNEL = \"channel-type.\" + BINDING_ID + \".\";\n+\n+    private static final ChannelMap CHANNEL_DEFINITIONS = new ChannelMap();\n+\n+    @Activate\n+    public ShellyChannelDefinitions(@Reference ShellyTranslationProvider translationProvider) {\n+        ShellyTranslationProvider m = translationProvider;\n+\n+        // Device: Internal Temp\n+        CHANNEL_DEFINITIONS\n+                // Device\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_NAME, \"deviceName\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_ITEMP, \"deviceTemp\", ITEMT_TEMP))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_WAKEUP, \"sensorWakeup\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_ACCUWATTS, \"meterAccuWatts\", ITEMT_POWER))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_ACCUTOTAL, \"meterAccuTotal\", ITEMT_POWER))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_ACCURETURNED, \"meterAccuReturned\", ITEMT_POWER))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_CHARGER, \"charger\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_LED_STATUS_DISABLE, \"ledStatusDisable\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_LED_POWER_DISABLE, \"ledPowerDisable\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_SELFTTEST, \"selfTest\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_UPTIME, \"uptime\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_HEARTBEAT, \"heartBeat\", ITEMT_DATETIME))\n+                .add(new ShellyChannel(m, CHGR_DEVST, CHANNEL_DEVST_UPDATE, \"updateAvailable\", ITEMT_SWITCH))\n+\n+                // Relay\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_OUTPUT_NAME, \"outputName\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_OUTPUT, \"system:power\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_INPUT, \"inputState\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_BUTTON_TRIGGER, \"system:button\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_STATUS_EVENTTYPE, \"lastEvent\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_STATUS_EVENTCOUNT, \"eventCount\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_TIMER_AUTOON, \"timerAutoOn\", ITEMT_TIME))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_TIMER_AUTOOFF, \"timerAutoOff\", ITEMT_TIME))\n+                .add(new ShellyChannel(m, CHGR_RELAY, CHANNEL_TIMER_ACTIVE, \"timerActive\", ITEMT_SWITCH))\n+\n+                // Dimmer\n+                .add(new ShellyChannel(m, CHANNEL_GROUP_DIMMER_CONTROL, CHANNEL_BRIGHTNESS, \"dimmerBrightness\",\n+                        ITEMT_DIMMER))\n+\n+                // Roller\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_ROL_CONTROL_CONTROL, \"rollerShutter\", ITEMT_ROLLER))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_ROL_CONTROL_POS, \"rollerPosition\", ITEMT_DIMMER))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_ROL_CONTROL_FAV, \"rollerFavorite\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_ROL_CONTROL_STATE, \"rollerState\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_ROL_CONTROL_STOPR, \"rollerStop\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_ROL_CONTROL_SAFETY, \"rollerSafety\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_INPUT, \"inputState\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_STATUS_EVENTTYPE, \"lastEvent\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_STATUS_EVENTCOUNT, \"eventCount\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_ROLLER, CHANNEL_EVENT_TRIGGER, \"system:button\", \"system:button\"))\n+\n+                // RGBW2\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_LIGHT_POWER, \"system:power\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_INPUT, \"inputState\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_BUTTON_TRIGGER, \"system:button\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_STATUS_EVENTTYPE, \"lastEvent\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_STATUS_EVENTCOUNT, \"eventCount\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_TIMER_AUTOON, \"timerAutoOn\", ITEMT_TIME))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_TIMER_AUTOOFF, \"timerAutoOff\", ITEMT_TIME))\n+                .add(new ShellyChannel(m, CHGR_LIGHT, CHANNEL_TIMER_ACTIVE, \"timerActive\", ITEMT_SWITCH))\n+\n+                // Power Meter\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_METER_CURRENTWATTS, \"meterWatts\", ITEMT_POWER))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_METER_TOTALKWH, \"meterTotal\", ITEMT_ENERGY))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_METER_LASTMIN1, \"lastPower1\", ITEMT_ENERGY))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_LAST_UPDATE, \"lastUpdate\", ITEMT_DATETIME))\n+\n+                // EMeter\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_EMETER_TOTALRET, \"meterReturned\", ITEMT_ENERGY))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_EMETER_REACTWATTS, \"meterReactive\", ITEMT_POWER))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_EMETER_VOLTAGE, \"meterVoltage\", ITEMT_VOLT))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_EMETER_CURRENT, \"meterCurrent\", ITEMT_AMP))\n+                .add(new ShellyChannel(m, CHGR_METER, CHANNEL_EMETER_PFACTOR, \"meterPowerFactor\", ITEMT_NUMBER))\n+\n+                // Sensors\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_TEMP, \"sensorTemp\", ITEMT_TEMP))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_HUM, \"sensorHumidity\", ITEMT_PERCENT))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_LUX, \"sensorLux\", ITEMT_LUX))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_ILLUM, \"sensorIllumination\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_VOLTAGE, \"sensorADC\", ITEMT_VOLT))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_CONTACT, \"sensorContact\", ITEMT_CONTACT))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_SSTATE, \"sensorState\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_VIBRATION, \"sensorVibration\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_TILT, \"sensorTilt\", ITEMT_ANGLE))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_MOTION, \"sensorMotion\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_MOTION_TS, \"motionTimestamp\", ITEMT_DATETIME))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_FLOOD, \"sensorFlood\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_SMOKE, \"sensorSmoke\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_PPM, \"sensorPPM\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_VALVE, \"sensorValve\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_ALARM_STATE, \"alarmState\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_SENSOR_ERROR, \"sensorError\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_LAST_UPDATE, \"lastUpdate\", ITEMT_DATETIME))\n+\n+                // Button/ix3\n+                .add(new ShellyChannel(m, CHGR_STATUS, CHANNEL_INPUT, \"inputState\", ITEMT_SWITCH))\n+                .add(new ShellyChannel(m, CHGR_STATUS, CHANNEL_STATUS_EVENTTYPE, \"lastEvent\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_STATUS, CHANNEL_STATUS_EVENTCOUNT, \"eventCount\", ITEMT_NUMBER))\n+                .add(new ShellyChannel(m, CHGR_STATUS, CHANNEL_BUTTON_TRIGGER, \"system:button\", ITEMT_STRING))\n+                .add(new ShellyChannel(m, CHGR_STATUS, CHANNEL_LAST_UPDATE, \"lastUpdate\", ITEMT_DATETIME))\n+\n+                // Addon with external sensors\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_ESENDOR_TEMP1, \"sensorExtTemp\", ITEMT_TEMP))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_ESENDOR_TEMP2, \"sensorExtTemp\", ITEMT_TEMP))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_ESENDOR_TEMP3, \"sensorExtTemp\", ITEMT_TEMP))\n+                .add(new ShellyChannel(m, CHGR_SENSOR, CHANNEL_ESENDOR_HUMIDITY, \"sensorExtHum\", ITEMT_PERCENT))\n+\n+                // Battery\n+                .add(new ShellyChannel(m, CHGR_BAT, CHANNEL_SENSOR_BAT_LEVEL, \"system:battery-level\", ITEMT_PERCENT))\n+                .add(new ShellyChannel(m, CHGR_BAT, CHANNEL_SENSOR_BAT_LOW, \"system:low-battery\", ITEMT_SWITCH));\n+    }\n+\n+    public static @Nullable ShellyChannel getDefinition(String channelName) throws IllegalArgumentException {\n+        String group = substringBefore(channelName, \"#\");\n+        String channel = substringAfter(channelName, \"#\");\n+\n+        if (group.contains(CHANNEL_GROUP_METER)) {\n+            group = CHANNEL_GROUP_METER; // map meter1..n to meter\n+        } else if (group.contains(CHANNEL_GROUP_RELAY_CONTROL)) {\n+            group = CHANNEL_GROUP_RELAY_CONTROL; // map meter1..n to meter\n+        } else if (group.contains(CHANNEL_GROUP_LIGHT_CHANNEL)) {\n+            group = CHANNEL_GROUP_LIGHT_CHANNEL;\n+        } else if (group.contains(CHANNEL_GROUP_STATUS)) {\n+            group = CHANNEL_GROUP_STATUS; // map status1..n to meter\n+        }\n+\n+        if (channel.startsWith(CHANNEL_INPUT)) {\n+            channel = CHANNEL_INPUT;\n+        } else if (channel.startsWith(CHANNEL_BUTTON_TRIGGER)) {\n+            channel = CHANNEL_BUTTON_TRIGGER;\n+        } else if (channel.startsWith(CHANNEL_STATUS_EVENTTYPE)) {\n+            channel = CHANNEL_STATUS_EVENTTYPE;\n+        } else if (channel.startsWith(CHANNEL_STATUS_EVENTCOUNT)) {\n+            channel = CHANNEL_STATUS_EVENTCOUNT;\n+        }\n+\n+        String channelId = group + \"#\" + channel;\n+        return CHANNEL_DEFINITIONS.get(channelId);\n+    }\n+\n+    /**\n+     * Auto-create relay channels depending on relay type/mode\n+     *\n+     * @return ArrayList<Channel> of channels to be added to the thing\n+     */\n+    public static Map<String, Channel> createDeviceChannels(final Thing thing, final ShellyDeviceProfile profile,\n+            final ShellySettingsStatus status) {\n+        Map<String, Channel> add = new LinkedHashMap<>();\n+\n+        addChannel(thing, add, profile.settings.name != null, CHGR_DEVST, CHANNEL_DEVST_NAME);\n+\n+        if (!profile.isSensor) {\n+            // Only some devices report the internal device temp\n+            addChannel(thing, add, (status.tmp != null) || (status.temperature != null), CHGR_DEVST,\n+                    CHANNEL_DEVST_ITEMP);\n+        }\n+\n+        // If device has more than 1 meter the channel accumulatedWatts receives the accumulated value\n+        boolean accuChannel = (((status.meters != null) && (status.meters.size() > 1) && !profile.isRoller\n+                && !profile.isRGBW2) || ((status.emeters != null && status.emeters.size() > 1)));\n+        addChannel(thing, add, accuChannel, CHGR_DEVST, CHANNEL_DEVST_ACCUWATTS);\n+        addChannel(thing, add, accuChannel, CHGR_DEVST, CHANNEL_DEVST_ACCUTOTAL);\n+        addChannel(thing, add, accuChannel && (status.emeters != null), CHGR_DEVST, CHANNEL_DEVST_ACCURETURNED);\n+        addChannel(thing, add, true, CHGR_DEVST, CHANNEL_DEVST_UPDATE);\n+        addChannel(thing, add, true, CHGR_DEVST, CHANNEL_DEVST_UPTIME);\n+        addChannel(thing, add, true, CHGR_DEVST, CHANNEL_DEVST_HEARTBEAT);\n+\n+        if (profile.settings.ledPowerDisable != null) {\n+            addChannel(thing, add, true, CHGR_DEVST, CHANNEL_LED_POWER_DISABLE);\n+        }\n+        if (profile.settings.ledStatusDisable != null) {\n+            addChannel(thing, add, true, CHGR_DEVST, CHANNEL_LED_STATUS_DISABLE); // WiFi status LED\n+        }\n+        return add;\n+    }\n+\n+    /**\n+     * Auto-create relay channels depending on relay type/mode\n+     *\n+     * @return ArrayList<Channel> of channels to be added to the thing\n+     */\n+    public static Map<String, Channel> createRelayChannels(final Thing thing, final ShellyDeviceProfile profile,\n+            final ShellyStatusRelay relay, int idx) {\n+        Map<String, Channel> add = new LinkedHashMap<>();\n+        String group = profile.getControlGroup(idx);\n+\n+        ShellySettingsRelay rs = profile.settings.relays.get(idx);\n+        addChannel(thing, add, rs.ison != null, group, CHANNEL_OUTPUT);\n+        addChannel(thing, add, rs.name != null, group, CHANNEL_OUTPUT_NAME);\n+        addChannel(thing, add, rs.autoOn != null, group, CHANNEL_TIMER_AUTOON);\n+        addChannel(thing, add, rs.autoOff != null, group, CHANNEL_TIMER_AUTOOFF);\n+        addChannel(thing, add, rs.hasTimer != null, group, CHANNEL_TIMER_ACTIVE);\n+\n+        // Shelly 1/1PM Addon\n+        if (relay.extTemperature != null) {\n+            addChannel(thing, add, relay.extTemperature.sensor1 != null, CHGR_SENSOR, CHANNEL_ESENDOR_TEMP1);\n+            addChannel(thing, add, relay.extTemperature.sensor2 != null, CHGR_SENSOR, CHANNEL_ESENDOR_TEMP2);\n+            addChannel(thing, add, relay.extTemperature.sensor3 != null, CHGR_SENSOR, CHANNEL_ESENDOR_TEMP3);\n+        }\n+        if (relay.extHumidity != null) {\n+            addChannel(thing, add, relay.extHumidity.sensor1 != null, CHGR_SENSOR, CHANNEL_ESENDOR_HUMIDITY);\n+        }\n+\n+        return add;\n+    }\n+\n+    public static Map<String, Channel> createDimmerChannels(final Thing thing, final ShellyDeviceProfile profile,\n+            final ShellySettingsStatus dstatus, int idx) {\n+        Map<String, Channel> add = new LinkedHashMap<>();\n+        String group = profile.getControlGroup(idx);\n+\n+        // Shelly Dimmer has an additional brightness channel\n+        addChannel(thing, add, profile.isDimmer, group, CHANNEL_BRIGHTNESS);\n+\n+        ShellySettingsDimmer ds = profile.settings.dimmers.get(idx);\n+        addChannel(thing, add, ds.autoOn != null, group, CHANNEL_TIMER_AUTOON);\n+        addChannel(thing, add, ds.autoOff != null, group, CHANNEL_TIMER_AUTOOFF);\n+        return add;\n+    }\n+\n+    public static Map<String, Channel> createLightChannels(final Thing thing, final ShellyDeviceProfile profile,\n+            final ShellyStatusLightChannel status, int idx) {\n+        Map<String, Channel> add = new LinkedHashMap<>();\n+        String group = profile.getControlGroup(idx);\n+\n+        ShellySettingsRgbwLight light = profile.settings.lights.get(idx);\n+        // The is no brightness channel in color mode, so we need a power channel\n+        addChannel(thing, add, profile.inColor, group, CHANNEL_LIGHT_POWER);\n+\n+        addChannel(thing, add, light.autoOn != null, group, CHANNEL_TIMER_AUTOON);\n+        addChannel(thing, add, light.autoOff != null, group, CHANNEL_TIMER_AUTOOFF);\n+        addChannel(thing, add, status.hasTimer != null, group, CHANNEL_TIMER_ACTIVE);\n+        return add;\n+    }\n+\n+    public static Map<String, Channel> createInputChannels(final Thing thing, final ShellyDeviceProfile profile,\n+            final ShellySettingsStatus status, String group) {\n+        Map<String, Channel> add = new LinkedHashMap<>();\n+        if (status.inputs != null) {\n+            // Create channels per input. For devices with more than 1 input (Dimmer, 1L) multiple channel sets are\n+            // created by adding the index to the channel name\n+            boolean multi = ((profile.numRelays == 1) || profile.isDimmer || profile.isRoller)\n+                    && (profile.numInputs >= 2);\n+            for (int i = 0; i < profile.numInputs; i++) {\n+                String suffix = multi ? String.valueOf(i + 1) : \"\";\n+                ShellyInputState input = status.inputs.get(i);\n+                addChannel(thing, add, true, group, CHANNEL_INPUT + suffix);\n+                if (profile.inButtonMode(i)) {\n+                    addChannel(thing, add, input.event != null, group, CHANNEL_STATUS_EVENTTYPE + suffix);\n+                    addChannel(thing, add, input.eventCount != null, group, CHANNEL_STATUS_EVENTCOUNT + suffix);\n+                }\n+                addChannel(thing, add, true, group,\n+                        (!profile.isRoller ? CHANNEL_BUTTON_TRIGGER + suffix : CHANNEL_EVENT_TRIGGER));\n+            }\n+        } else if (status.input != null) {\n+            // old RGBW2 firmware\n+            addChannel(thing, add, true, group, CHANNEL_INPUT);\n+            addChannel(thing, add, true, group, CHANNEL_BUTTON_TRIGGER);\n+        }\n+        return add;\n+    }\n+\n+    public static Map<String, Channel> createRollerChannels(Thing thing, final ShellyControlRoller roller) {\n+        Map<String, Channel> add = new LinkedHashMap<>();\n+        addChannel(thing, add, true, CHGR_ROLLER, CHANNEL_ROL_CONTROL_CONTROL);\n+        addChannel(thing, add, true, CHGR_ROLLER, CHANNEL_ROL_CONTROL_STATE);\n+        addChannel(thing, add, true, CHGR_ROLLER, CHANNEL_EVENT_TRIGGER);\n+        addChannel(thing, add, roller.currentPos != null, CHGR_ROLLER, CHANNEL_ROL_CONTROL_POS);\n+        addChannel(thing, add, roller.stopReason != null, CHGR_ROLLER, CHANNEL_ROL_CONTROL_STOPR);\n+        addChannel(thing, add, roller.safetySwitch != null, CHGR_ROLLER, CHANNEL_ROL_CONTROL_SAFETY);\n+\n+        ShellyBaseHandler handler = (ShellyBaseHandler) thing.getHandler();\n+        if (handler != null) {\n+            ShellySettingsGlobal settings = handler.getProfile().settings;\n+            ;", "originalCommit": "fc0ee6249c8c28d89703915d2264c9573b856a27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f4417ae76a6d3bf94d567b3a5a0849a2a07ade3", "url": "https://github.com/openhab/openhab-addons/commit/8f4417ae76a6d3bf94d567b3a5a0849a2a07ade3", "message": "review change\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-26T19:49:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTM1ODQzNg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r565358436", "bodyText": "Did you remove the @NonNullByDefault accidentally?", "author": "fwolter", "createdAt": "2021-01-27T14:37:02Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/provider/ShellyTranslationProvider.java", "diffHunk": "@@ -10,40 +10,38 @@\n  *\n  * SPDX-License-Identifier: EPL-2.0\n  */\n-package org.openhab.binding.shelly.internal.util;\n+package org.openhab.binding.shelly.internal.provider;\n \n import java.util.Locale;\n \n-import org.eclipse.jdt.annotation.NonNullByDefault;\n import org.eclipse.jdt.annotation.Nullable;\n import org.openhab.core.i18n.LocaleProvider;\n import org.openhab.core.i18n.TranslationProvider;\n import org.osgi.framework.Bundle;\n+import org.osgi.framework.FrameworkUtil;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n \n /**\n  * {@link ShellyTranslationProvider} provides i18n message lookup\n  *\n  * @author Markus Michels - Initial contribution\n  */\n-@NonNullByDefault\n+@Component(service = ShellyTranslationProvider.class)", "originalCommit": "8f4417ae76a6d3bf94d567b3a5a0849a2a07ade3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMyNjA3Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9508#discussion_r567326072", "bodyText": "obviously yes, fixed", "author": "markus7017", "createdAt": "2021-01-30T22:07:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTM1ODQzNg=="}], "type": "inlineReview"}, {"oid": "61c9d0b23da5e695c0d7530046611934df60a0e1", "url": "https://github.com/openhab/openhab-addons/commit/61c9d0b23da5e695c0d7530046611934df60a0e1", "message": "review change\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2021-01-30T22:06:52Z", "type": "commit"}]}