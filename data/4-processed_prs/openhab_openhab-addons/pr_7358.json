{"pr_number": 7358, "pr_title": "[CoronaStats] Initial contribution", "pr_createdAt": "2020-04-13T19:27:29Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7358", "timeline": [{"oid": "a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "url": "https://github.com/openhab/openhab-addons/commit/a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "message": "[CoronaStats] Finished initial development\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-15T15:00:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA0OTgwOA==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409049808", "bodyText": "Please remove the empty lines between the fields.", "author": "kaikreuzer", "createdAt": "2020-04-15T18:32:42Z", "path": "bundles/org.openhab.binding.coronastats/src/main/java/org/openhab/binding/coronastats/internal/dto/CoronaStatsCases.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.coronastats.internal.dto;\n+\n+import static org.openhab.binding.coronastats.internal.CoronaStatsBindingConstants.*;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+\n+/**\n+ * The {@link CoronaStatsCountry} class holds the internal data representation of each Country\n+ *\n+ * @author Johannes Ott - Initial contribution\n+ */\n+@NonNullByDefault\n+public class CoronaStatsCases {\n+    private int cases = -1;\n+", "originalCommit": "a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMTU5Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409121596", "bodyText": "Removed", "author": "DerOetzi", "createdAt": "2020-04-15T20:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA0OTgwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDAzNg==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409050036", "bodyText": "remove empty lines", "author": "kaikreuzer", "createdAt": "2020-04-15T18:32:59Z", "path": "bundles/org.openhab.binding.coronastats/src/main/java/org/openhab/binding/coronastats/internal/dto/CoronaStatsCountry.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.coronastats.internal.dto;\n+\n+import static org.openhab.binding.coronastats.internal.CoronaStatsBindingConstants.*;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+\n+/**\n+ * The {@link CoronaStatsCountry} class holds the internal data representation of each Country\n+ *\n+ * @author Johannes Ott - Initial contribution\n+ */\n+@NonNullByDefault\n+public class CoronaStatsCountry extends CoronaStatsCases {\n+    private String country = \"\";\n+", "originalCommit": "a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMTYyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409121621", "bodyText": "Removed", "author": "DerOetzi", "createdAt": "2020-04-15T20:43:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDkyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409050921", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        updateStatus(ThingStatus.ONLINE);\n          \n          \n            \n                        updateStatus(ThingStatus.UNKNOWN);", "author": "kaikreuzer", "createdAt": "2020-04-15T18:34:25Z", "path": "bundles/org.openhab.binding.coronastats/src/main/java/org/openhab/binding/coronastats/internal/handler/CoronaStatsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\r\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\r\n+ *\r\n+ * See the NOTICE file(s) distributed with this work for additional\r\n+ * information.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ */\r\n+package org.openhab.binding.coronastats.internal.handler;\r\n+\r\n+import java.net.URI;\r\n+import java.util.Set;\r\n+import java.net.SocketTimeoutException;\r\n+import java.util.concurrent.CompletableFuture;\r\n+import java.util.concurrent.ConcurrentHashMap;\r\n+import java.util.concurrent.ScheduledFuture;\r\n+import java.util.concurrent.TimeUnit;\r\n+import java.util.concurrent.TimeoutException;\r\n+\r\n+import com.google.gson.Gson;\r\n+import com.google.gson.JsonSyntaxException;\r\n+\r\n+import org.eclipse.jdt.annotation.NonNullByDefault;\r\n+import org.eclipse.jdt.annotation.Nullable;\r\n+import org.eclipse.jetty.client.HttpClient;\r\n+import org.eclipse.jetty.client.HttpResponse;\r\n+import org.eclipse.jetty.client.api.Request;\r\n+import org.eclipse.jetty.client.api.Result;\r\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\r\n+import org.eclipse.jetty.http.HttpMethod;\r\n+import org.eclipse.smarthome.core.thing.Bridge;\r\n+import org.eclipse.smarthome.core.thing.ChannelUID;\r\n+import org.eclipse.smarthome.core.thing.Thing;\r\n+import org.eclipse.smarthome.core.thing.ThingStatus;\r\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\r\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\r\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\r\n+import org.eclipse.smarthome.core.types.Command;\r\n+import org.eclipse.smarthome.core.types.RefreshType;\r\n+import org.openhab.binding.coronastats.internal.CoronaStatsPollingException;\r\n+import org.openhab.binding.coronastats.internal.config.CoronaStatsBridgeConfiguration;\r\n+import org.openhab.binding.coronastats.internal.dto.CoronaStats;\r\n+import org.slf4j.Logger;\r\n+import org.slf4j.LoggerFactory;\r\n+\r\n+/**\r\n+ * The {@link CoronaStatsBridgeHandler} is the handler for bridge thing\r\n+ *\r\n+ * @author Johannes Ott - Initial contribution\r\n+ */\r\n+@NonNullByDefault\r\n+public class CoronaStatsBridgeHandler extends BaseBridgeHandler {\r\n+    private static final String CORONASTATS_URL = \"https://corona-stats.online/?format=json\";\r\n+\r\n+    private final Logger logger = LoggerFactory.getLogger(CoronaStatsBridgeHandler.class);\r\n+\r\n+    private CoronaStatsBridgeConfiguration bridgeConfig = new CoronaStatsBridgeConfiguration();\r\n+    private @Nullable ScheduledFuture<?> pollingJob;\r\n+    private @Nullable CoronaStats coronaStats;\r\n+    private final Set<CoronaStatsThingHandler> listeners = ConcurrentHashMap.newKeySet();\r\n+    private final HttpClient client;\r\n+    private final Gson gson = new Gson();\r\n+\r\n+    public CoronaStatsBridgeHandler(Bridge bridge, HttpClient client) {\r\n+        super(bridge);\r\n+        this.client = client;\r\n+    }\r\n+\r\n+    @Override\r\n+    public void handleCommand(ChannelUID channelUID, Command command) {\r\n+        if (command instanceof RefreshType) {\r\n+            final CoronaStats localCoronaStats = coronaStats;\r\n+            if (localCoronaStats != null) {\r\n+                notifyOnUpdate(localCoronaStats);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    @Override\r\n+    public void initialize() {\r\n+        logger.debug(\"Initializing Corona Stats bridge handler\");\r\n+        bridgeConfig = getConfigAs(CoronaStatsBridgeConfiguration.class);\r\n+\r\n+        if (bridgeConfig.isValid()) {\r\n+            startPolling();\r\n+            updateStatus(ThingStatus.ONLINE);\r", "originalCommit": "a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMTc0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409121741", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-15T20:43:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MjEzOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409052139", "bodyText": "I would suggest to remove this channel - this is nothing we usually have and there is already the updated channel on the things that should be more relevant.", "author": "kaikreuzer", "createdAt": "2020-04-15T18:36:23Z", "path": "bundles/org.openhab.binding.coronastats/src/main/resources/ESH-INF/thing/bridge.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions bindingId=\"coronastats\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\r\n+\t<bridge-type id=\"bridge\">\r\n+\t\t<label>Corona Stats Online - Bridge</label>\r\n+\t\t<description>Bridge for accessing data from https://corona-stats.online/ website.</description>\r\n+\r\n+\t\t<channels>\r\n+\t\t\t<channel id=\"refreshed\" typeId=\"refreshed\"/>\r\n+\t\t</channels>\r\n+\r\n+\t\t<config-description>\r\n+\t\t\t<parameter name=\"refresh\" type=\"integer\" unit=\"min\" min=\"15\">\r\n+\t\t\t\t<default>30</default>\r\n+\t\t\t\t<label>Refresh Interval</label>\r\n+\t\t\t\t<description>Time between two API requests in minutes. Minimum 15 minutes.</description>\r\n+\t\t\t</parameter>\r\n+\t\t</config-description>\r\n+\t\t\r\n+\t</bridge-type>\r\n+\r\n+\t<channel-type id=\"refreshed\">\r", "originalCommit": "a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMjU1MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409122551", "bodyText": "Removed, but on world object of the response there is no updated information. So just country thing have this channel for now.", "author": "DerOetzi", "createdAt": "2020-04-15T20:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MjEzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1Mjc1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409052755", "bodyText": "Please create an individual channel type for each channel (and move the label texts from the thing definitions to here).", "author": "kaikreuzer", "createdAt": "2020-04-15T18:37:22Z", "path": "bundles/org.openhab.binding.coronastats/src/main/resources/ESH-INF/thing/channel-type.xml", "diffHunk": "@@ -0,0 +1,19 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions bindingId=\"coronastats\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\r\n+\t<channel-type id=\"count\">\r", "originalCommit": "a29c3acd127bc827a7ecf9d82a821faf1b48f0bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMjY0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409122642", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-15T20:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1Mjc1NQ=="}], "type": "inlineReview"}, {"oid": "3fdbf06a31ec00f97792c2ea36356002422b0880", "url": "https://github.com/openhab/openhab-addons/commit/3fdbf06a31ec00f97792c2ea36356002422b0880", "message": "[CoronaStats] Initial contribution bridge is running\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:18Z", "type": "commit"}, {"oid": "f1b9073f91f506d74ef73b1c7e4186d167391450", "url": "https://github.com/openhab/openhab-addons/commit/f1b9073f91f506d74ef73b1c7e4186d167391450", "message": "[CoronaStats] Country thing working\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:18Z", "type": "commit"}, {"oid": "30068e16963b94564da2f23170fd0e488ce2d321", "url": "https://github.com/openhab/openhab-addons/commit/30068e16963b94564da2f23170fd0e488ce2d321", "message": "[CoronaStats] Finished initial development\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:19Z", "type": "commit"}, {"oid": "5db97edcfaeafb4495c39d37ee7b37a76548481b", "url": "https://github.com/openhab/openhab-addons/commit/5db97edcfaeafb4495c39d37ee7b37a76548481b", "message": "[CoronaStats] Fixed small checkstyle findings\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:19Z", "type": "commit"}, {"oid": "b2af6eba3c3a97f98e39d4348da61ffd1ce0849c", "url": "https://github.com/openhab/openhab-addons/commit/b2af6eba3c3a97f98e39d4348da61ffd1ce0849c", "message": "[CoronaStats] Bridge and world thing merged\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:19Z", "type": "commit"}, {"oid": "4b41e00590d4279f18a9b566b557cbc10b0aa325", "url": "https://github.com/openhab/openhab-addons/commit/4b41e00590d4279f18a9b566b557cbc10b0aa325", "message": "[CoronaStats] Merge Bridge and world thing in README\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:19Z", "type": "commit"}, {"oid": "a554c500a120a9696f7abb1b102acb18e41ff0af", "url": "https://github.com/openhab/openhab-addons/commit/a554c500a120a9696f7abb1b102acb18e41ff0af", "message": "[CoronaStats] First draft DisvoceryService\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:19Z", "type": "commit"}, {"oid": "a554c500a120a9696f7abb1b102acb18e41ff0af", "url": "https://github.com/openhab/openhab-addons/commit/a554c500a120a9696f7abb1b102acb18e41ff0af", "message": "[CoronaStats] First draft DisvoceryService\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:37:19Z", "type": "forcePushed"}, {"oid": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "url": "https://github.com/openhab/openhab-addons/commit/ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "message": "[CoronaStats] Added discovery information to README\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T17:52:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDM0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409804341", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This binding will add a default `world` thing into the Inbox. This can be used as bridge for country things you may add manually.\n          \n          \n            \n            This binding adds a default `world` thing to the Inbox.\n          \n          \n            \n            This can be used as bridge for country things you may add manually.", "author": "kaikreuzer", "createdAt": "2020-04-16T19:41:26Z", "path": "bundles/org.openhab.binding.coronastats/README.md", "diffHunk": "@@ -0,0 +1,126 @@\n+# CoronaStats Binding\r\n+\r\n+This binding provides the statistic about cases of COVID-19 from the website https://corona-stats.online/.\r\n+\r\n+\r\n+## Supported Things\r\n+\r\n+This binding supports a `world` thing, which polls the dataset in an adjustable interval as a bridge and provides the statistics for the whole world.\r\n+The `country` thing, representing the statistics for a specified country.\r\n+\r\n+## Discovery\r\n+\r\n+This binding will add a default `world` thing into the Inbox. This can be used as bridge for country things you may add manually.\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNTg4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409815882", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:02:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDY1MA==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409804650", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | Property  | Default | Required | Description                                                                              |\n          \n          \n            \n            | Parameter  | Default | Required | Description                                                                              |", "author": "kaikreuzer", "createdAt": "2020-04-16T19:41:57Z", "path": "bundles/org.openhab.binding.coronastats/README.md", "diffHunk": "@@ -0,0 +1,126 @@\n+# CoronaStats Binding\r\n+\r\n+This binding provides the statistic about cases of COVID-19 from the website https://corona-stats.online/.\r\n+\r\n+\r\n+## Supported Things\r\n+\r\n+This binding supports a `world` thing, which polls the dataset in an adjustable interval as a bridge and provides the statistics for the whole world.\r\n+The `country` thing, representing the statistics for a specified country.\r\n+\r\n+## Discovery\r\n+\r\n+This binding will add a default `world` thing into the Inbox. This can be used as bridge for country things you may add manually.\r\n+\r\n+## Thing Configuration\r\n+\r\n+### World\r\n+\r\n+| Property  | Default | Required | Description                                                                              |\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNTk1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409815959", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDY1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDc0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409804741", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | Property      | Default | Required | Description                                       |\n          \n          \n            \n            | Parameter      | Default | Required | Description                                       |", "author": "kaikreuzer", "createdAt": "2020-04-16T19:42:08Z", "path": "bundles/org.openhab.binding.coronastats/README.md", "diffHunk": "@@ -0,0 +1,126 @@\n+# CoronaStats Binding\r\n+\r\n+This binding provides the statistic about cases of COVID-19 from the website https://corona-stats.online/.\r\n+\r\n+\r\n+## Supported Things\r\n+\r\n+This binding supports a `world` thing, which polls the dataset in an adjustable interval as a bridge and provides the statistics for the whole world.\r\n+The `country` thing, representing the statistics for a specified country.\r\n+\r\n+## Discovery\r\n+\r\n+This binding will add a default `world` thing into the Inbox. This can be used as bridge for country things you may add manually.\r\n+\r\n+## Thing Configuration\r\n+\r\n+### World\r\n+\r\n+| Property  | Default | Required | Description                                                                              |\r\n+| --------- | :-----: | :------: | ---------------------------------------------------------------------------------------- |\r\n+| `refresh` |   30    |    no    | Define the interval for polling the data from website in minutes. Minimum is 15 minutes. |\r\n+\r\n+### Country\r\n+\r\n+| Property      | Default | Required | Description                                       |\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNjAxNA==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409816014", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDg2Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409804863", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For the correct 2-letter country Code have a look at the website https://corona-stats.online/\n          \n          \n            \n            For the correct 2-letter country code have a look at the website https://corona-stats.online/", "author": "kaikreuzer", "createdAt": "2020-04-16T19:42:23Z", "path": "bundles/org.openhab.binding.coronastats/README.md", "diffHunk": "@@ -0,0 +1,126 @@\n+# CoronaStats Binding\r\n+\r\n+This binding provides the statistic about cases of COVID-19 from the website https://corona-stats.online/.\r\n+\r\n+\r\n+## Supported Things\r\n+\r\n+This binding supports a `world` thing, which polls the dataset in an adjustable interval as a bridge and provides the statistics for the whole world.\r\n+The `country` thing, representing the statistics for a specified country.\r\n+\r\n+## Discovery\r\n+\r\n+This binding will add a default `world` thing into the Inbox. This can be used as bridge for country things you may add manually.\r\n+\r\n+## Thing Configuration\r\n+\r\n+### World\r\n+\r\n+| Property  | Default | Required | Description                                                                              |\r\n+| --------- | :-----: | :------: | ---------------------------------------------------------------------------------------- |\r\n+| `refresh` |   30    |    no    | Define the interval for polling the data from website in minutes. Minimum is 15 minutes. |\r\n+\r\n+### Country\r\n+\r\n+| Property      | Default | Required | Description                                       |\r\n+| ------------- | :-----: | :------: | ------------------------------------------------- |\r\n+| `countryCode` |    -    |   yes    | 2-letter code for the country you want to display |\r\n+\r\n+For the correct 2-letter country Code have a look at the website https://corona-stats.online/\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNjA2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409816067", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDg2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNjkyMg==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409806922", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String WORLD_LABEL = \"CoronaStats World\";\n          \n          \n            \n                public static final String WORLD_LABEL = \"Corona Statistics (World)\";", "author": "kaikreuzer", "createdAt": "2020-04-16T19:46:13Z", "path": "bundles/org.openhab.binding.coronastats/src/main/java/org/openhab/binding/coronastats/internal/CoronaStatsBindingConstants.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\r\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\r\n+ *\r\n+ * See the NOTICE file(s) distributed with this work for additional\r\n+ * information.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ */\r\n+package org.openhab.binding.coronastats.internal;\r\n+\r\n+import java.util.Collections;\r\n+import java.util.Set;\r\n+import java.util.stream.Collectors;\r\n+import java.util.stream.Stream;\r\n+\r\n+import org.eclipse.jdt.annotation.NonNullByDefault;\r\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\r\n+\r\n+/**\r\n+ * The {@link CoronaStatsBindingConstants} class defines common constants, which are\r\n+ * used across the whole binding.\r\n+ *\r\n+ * @author Johannes Ott - Initial contribution\r\n+ */\r\n+@NonNullByDefault\r\n+public class CoronaStatsBindingConstants {\r\n+\r\n+    public static final String BINDING_ID = \"coronastats\";\r\n+\r\n+    // World\r\n+    public static final ThingTypeUID THING_TYPE_WORLD = new ThingTypeUID(BINDING_ID, \"world\");\r\n+    public static final String STATS = \"stats\";\r\n+    public static final String WORLD_LABEL = \"CoronaStats World\";\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNjE0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409816143", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNjkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNzgzNg==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409807836", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<label>Corona Stats Online - Country</label>\n          \n          \n            \n            \t\t<label>Corona Statistics (Country)</label>", "author": "kaikreuzer", "createdAt": "2020-04-16T19:48:00Z", "path": "bundles/org.openhab.binding.coronastats/src/main/resources/ESH-INF/thing/country.xml", "diffHunk": "@@ -0,0 +1,38 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions bindingId=\"coronastats\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\r\n+\t<thing-type id=\"country\">\r\n+\t\t<supported-bridge-type-refs>\r\n+\t\t\t<bridge-type-ref id=\"world\" />\r\n+\t\t</supported-bridge-type-refs>\r\n+\t\t\r\n+\t\t<label>Corona Stats Online - Country</label>\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNjE4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409816183", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNzgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNzk5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409807995", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<description>Corona stats for a specific country</description>\n          \n          \n            \n            \t\t<description>Corona statistics for a specific country</description>", "author": "kaikreuzer", "createdAt": "2020-04-16T19:48:17Z", "path": "bundles/org.openhab.binding.coronastats/src/main/resources/ESH-INF/thing/country.xml", "diffHunk": "@@ -0,0 +1,38 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions bindingId=\"coronastats\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\r\n+\t<thing-type id=\"country\">\r\n+\t\t<supported-bridge-type-refs>\r\n+\t\t\t<bridge-type-ref id=\"world\" />\r\n+\t\t</supported-bridge-type-refs>\r\n+\t\t\r\n+\t\t<label>Corona Stats Online - Country</label>\r\n+\t\t<description>Corona stats for a specific country</description>\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNjI0Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409816246", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNzk5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwODI0Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409808246", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<label>Corona Stats Online - World</label>\n          \n          \n            \n            \t\t<label>Corona Statistics (World)</label>", "author": "kaikreuzer", "createdAt": "2020-04-16T19:48:38Z", "path": "bundles/org.openhab.binding.coronastats/src/main/resources/ESH-INF/thing/world.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions bindingId=\"coronastats\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\r\n+\t<bridge-type id=\"world\">\r\n+\t\t<label>Corona Stats Online - World</label>\r", "originalCommit": "ff21650bd147ad5f9db3f0621a65a29b82c07fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgxNjMwMw==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409816303", "bodyText": "Changed", "author": "DerOetzi", "createdAt": "2020-04-16T20:03:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwODI0Ng=="}], "type": "inlineReview"}, {"oid": "97d42eb57ae8b214538d0b3fca541cb2b667696d", "url": "https://github.com/openhab/openhab-addons/commit/97d42eb57ae8b214538d0b3fca541cb2b667696d", "message": "[CoronaStats] Changed some wordings like suggested\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T20:02:01Z", "type": "commit"}, {"oid": "20ae76084a97894a402508790d5aedbb5b995228", "url": "https://github.com/openhab/openhab-addons/commit/20ae76084a97894a402508790d5aedbb5b995228", "message": "[CoronaStats] Checkstyle fix DiscoveryService\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T20:08:05Z", "type": "commit"}, {"oid": "dbb52c31d5cc8cff959132d8908a691862682246", "url": "https://github.com/openhab/openhab-addons/commit/dbb52c31d5cc8cff959132d8908a691862682246", "message": "[CoronaStats] A few more small checkstyles\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T20:22:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3ODUxNg==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409178516", "bodyText": "I don't see a reason for this to be synchronized", "author": "cpmeister", "createdAt": "2020-04-15T22:47:53Z", "path": "bundles/org.openhab.binding.coronastats/src/main/java/org/openhab/binding/coronastats/internal/handler/CoronaStatsCountryHandler.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/**\r\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\r\n+ *\r\n+ * See the NOTICE file(s) distributed with this work for additional\r\n+ * information.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ */\r\n+package org.openhab.binding.coronastats.internal.handler;\r\n+\r\n+import org.eclipse.jdt.annotation.NonNullByDefault;\r\n+import org.eclipse.jdt.annotation.Nullable;\r\n+import org.eclipse.smarthome.core.thing.Bridge;\r\n+import org.eclipse.smarthome.core.thing.ChannelUID;\r\n+import org.eclipse.smarthome.core.thing.Thing;\r\n+import org.eclipse.smarthome.core.thing.ThingStatus;\r\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\r\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\r\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\r\n+import org.eclipse.smarthome.core.types.Command;\r\n+import org.eclipse.smarthome.core.types.RefreshType;\r\n+import org.openhab.binding.coronastats.internal.config.CoronaStatsCountryConfiguration;\r\n+import org.openhab.binding.coronastats.internal.dto.CoronaStats;\r\n+import org.openhab.binding.coronastats.internal.dto.CoronaStatsCountry;\r\n+import org.slf4j.Logger;\r\n+import org.slf4j.LoggerFactory;\r\n+\r\n+/**\r\n+ * The {@link CoronaStatsCountryHandler} is the handler for country thing\r\n+ *\r\n+ * @author Johannes Ott - Initial contribution\r\n+ */\r\n+@NonNullByDefault\r\n+public class CoronaStatsCountryHandler extends BaseThingHandler {\r\n+\r\n+    private final Logger logger = LoggerFactory.getLogger(CoronaStatsCountryHandler.class);\r\n+\r\n+    private CoronaStatsCountryConfiguration thingConfig = new CoronaStatsCountryConfiguration();\r\n+\r\n+    public CoronaStatsCountryHandler(Thing thing) {\r\n+        super(thing);\r\n+    }\r\n+\r\n+    @Override\r\n+    public void initialize() {\r\n+        thingConfig = getConfigAs(CoronaStatsCountryConfiguration.class);\r\n+        logger.debug(\"Initializing Corona Stats country handler for country code {}\", thingConfig.getCountryCode());\r\n+\r\n+        if (thingConfig.isValid()) {\r\n+            CoronaStatsWorldHandler handler = getBridgeHandler();\r\n+            if (handler == null) {\r\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridge handler missing\");\r\n+            } else {\r\n+                updateStatus(ThingStatus.ONLINE);\r\n+            }\r\n+        } else {\r\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"No valid country code given.\");\r\n+        }\r\n+    }\r\n+\r\n+    @Override\r\n+    public void dispose() {\r\n+        logger.debug(\"CoronaStats country handler disposes.\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void handleCommand(ChannelUID channelUID, Command command) {\r\n+        if (command instanceof RefreshType) {\r\n+            refresh();\r\n+        }\r\n+    }\r\n+\r\n+    private void refresh() {\r\n+        CoronaStatsWorldHandler handler = getBridgeHandler();\r\n+        if (handler != null) {\r\n+            CoronaStats coronaStats = handler.getCoronaStats();\r\n+            if (coronaStats != null) {\r\n+                notifyOnUpdate(coronaStats);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private synchronized @Nullable CoronaStatsWorldHandler getBridgeHandler() {\r", "originalCommit": "ebb6770865cc4db0c4095244786d2c45cc5b3622", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzOTc1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409839756", "bodyText": "I don't know from which binding I copied this now, but I didn't understand as well. Thought it is some framework specific thing. So if you think we can remove as well, I will do.", "author": "DerOetzi", "createdAt": "2020-04-16T20:49:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3ODUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MjQ5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409842499", "bodyText": "Yep, please remove synchronized", "author": "cpmeister", "createdAt": "2020-04-16T20:55:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3ODUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0NDA3MA==", "url": "https://github.com/openhab/openhab-addons/pull/7358#discussion_r409844070", "bodyText": "Removed", "author": "DerOetzi", "createdAt": "2020-04-16T20:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3ODUxNg=="}], "type": "inlineReview"}, {"oid": "2969007717b26ae2dc7f9147f90f8e2dccf7a8d5", "url": "https://github.com/openhab/openhab-addons/commit/2969007717b26ae2dc7f9147f90f8e2dccf7a8d5", "message": "[CoronaStats] Removed unneccessary sychronized keyword\n\nSigned-off-by: Johannes DerOetzi Ott <info@johannes-ott.net>", "committedDate": "2020-04-16T20:57:38Z", "type": "commit"}]}