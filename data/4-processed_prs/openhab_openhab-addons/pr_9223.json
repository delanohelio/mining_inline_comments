{"pr_number": 9223, "pr_title": "[bluetooth.enoceanble] Initial contribution EnOcean BLE Binding", "pr_createdAt": "2020-12-04T16:09:14Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9223", "timeline": [{"oid": "7a05327b2731a57de3d387f9d44682b33d46e7f4", "url": "https://github.com/openhab/openhab-addons/commit/7a05327b2731a57de3d387f9d44682b33d46e7f4", "message": "[bluetooth.enoceanble] Initial contribution EnOcean BLE Binding\n\nSigned-off-by: Patrick Fink <mail@pfink.de>", "committedDate": "2020-12-04T16:01:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MTIyMg==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536251222", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                public DiscoveryResult createResult(BluetoothDiscoveryDevice device) {\n          \n          \n            \n                public @Nullable DiscoveryResult createResult(BluetoothDiscoveryDevice device) {", "author": "cpmeister", "createdAt": "2020-12-04T17:15:57Z", "path": "bundles/org.openhab.binding.bluetooth.enoceanble/src/main/java/org/openhab/binding/bluetooth/enoceanble/internal/EnoceanBleDiscoveryParticipant.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.bluetooth.enoceanble.internal;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.bluetooth.BluetoothBindingConstants;\n+import org.openhab.binding.bluetooth.discovery.BluetoothDiscoveryDevice;\n+import org.openhab.binding.bluetooth.discovery.BluetoothDiscoveryParticipant;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.osgi.service.component.annotations.Component;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * This discovery participant is able to recognize ruuvitag devices and create discovery results for them.\n+ *\n+ * @author Patrick Fink - Initial contribution\n+ *\n+ */\n+@NonNullByDefault\n+@Component\n+public class EnoceanBleDiscoveryParticipant implements BluetoothDiscoveryParticipant {\n+    private final Logger logger = LoggerFactory.getLogger(EnoceanBleDiscoveryParticipant.class);\n+\n+    private static final int ENOCEAN_COMPANY_ID = 986;\n+\n+    @Override\n+    public Set<ThingTypeUID> getSupportedThingTypeUIDs() {\n+        return Collections.singleton(EnoceanBleBindingConstants.THING_TYPE_PTM215B);\n+    }\n+\n+    @Override\n+    @Nullable\n+    public ThingUID getThingUID(BluetoothDiscoveryDevice device) {\n+        Integer manufacturerId = device.getManufacturerId();\n+        logger.warn(\"Discovered device {} with manufacturerId {} and name {}\", device.getAddress(), manufacturerId,\n+                device.getName());\n+        if (manufacturerId != null && manufacturerId == ENOCEAN_COMPANY_ID) {\n+            return new ThingUID(EnoceanBleBindingConstants.THING_TYPE_PTM215B, device.getAdapter().getUID(),\n+                    device.getAddress().toString().toLowerCase().replace(\":\", \"\"));\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    @Nullable\n+    public DiscoveryResult createResult(BluetoothDiscoveryDevice device) {", "originalCommit": "7a05327b2731a57de3d387f9d44682b33d46e7f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MTMxMA==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536251310", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                public ThingUID getThingUID(BluetoothDiscoveryDevice device) {\n          \n          \n            \n                public @Nullable ThingUID getThingUID(BluetoothDiscoveryDevice device) {", "author": "cpmeister", "createdAt": "2020-12-04T17:16:07Z", "path": "bundles/org.openhab.binding.bluetooth.enoceanble/src/main/java/org/openhab/binding/bluetooth/enoceanble/internal/EnoceanBleDiscoveryParticipant.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.bluetooth.enoceanble.internal;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.bluetooth.BluetoothBindingConstants;\n+import org.openhab.binding.bluetooth.discovery.BluetoothDiscoveryDevice;\n+import org.openhab.binding.bluetooth.discovery.BluetoothDiscoveryParticipant;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.osgi.service.component.annotations.Component;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * This discovery participant is able to recognize ruuvitag devices and create discovery results for them.\n+ *\n+ * @author Patrick Fink - Initial contribution\n+ *\n+ */\n+@NonNullByDefault\n+@Component\n+public class EnoceanBleDiscoveryParticipant implements BluetoothDiscoveryParticipant {\n+    private final Logger logger = LoggerFactory.getLogger(EnoceanBleDiscoveryParticipant.class);\n+\n+    private static final int ENOCEAN_COMPANY_ID = 986;\n+\n+    @Override\n+    public Set<ThingTypeUID> getSupportedThingTypeUIDs() {\n+        return Collections.singleton(EnoceanBleBindingConstants.THING_TYPE_PTM215B);\n+    }\n+\n+    @Override\n+    @Nullable\n+    public ThingUID getThingUID(BluetoothDiscoveryDevice device) {", "originalCommit": "7a05327b2731a57de3d387f9d44682b33d46e7f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MjIyMg==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536252222", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                protected ThingHandler createHandler(Thing thing) {\n          \n          \n            \n                protected @Nullable ThingHandler createHandler(Thing thing) {", "author": "cpmeister", "createdAt": "2020-12-04T17:17:43Z", "path": "bundles/org.openhab.binding.bluetooth.enoceanble/src/main/java/org/openhab/binding/bluetooth/enoceanble/internal/EnoceanBleHandlerFactory.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.bluetooth.enoceanble.internal;\n+\n+import java.util.Collections;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.binding.BaseThingHandlerFactory;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerFactory;\n+import org.osgi.service.component.annotations.Component;\n+\n+/**\n+ * The {@link EnoceanBleHandlerFactory} is responsible for creating things and thing handlers.\n+ *\n+ * @author Patrick Fink - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(service = ThingHandlerFactory.class, configurationPid = \"binding.ruuvitag\")\n+public class EnoceanBleHandlerFactory extends BaseThingHandlerFactory {\n+\n+    private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections\n+            .singleton(EnoceanBleBindingConstants.THING_TYPE_PTM215B);\n+\n+    @Override\n+    public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n+        return SUPPORTED_THING_TYPES_UIDS.contains(thingTypeUID);\n+    }\n+\n+    @Override\n+    @Nullable\n+    protected ThingHandler createHandler(Thing thing) {", "originalCommit": "7a05327b2731a57de3d387f9d44682b33d46e7f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9c689460f8b2f7ba7b57cb9969acb11b142177ef", "url": "https://github.com/openhab/openhab-addons/commit/9c689460f8b2f7ba7b57cb9969acb11b142177ef", "message": "Put @Nullable annotation inline\r\n\r\nSigned-off-by: Patrick Fink <mail@pfink.de>\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>", "committedDate": "2020-12-04T19:08:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzMzMwNw==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536333307", "bodyText": "You don't use serial transport in this binding so you can remove this feature.", "author": "cpmeister", "createdAt": "2020-12-04T19:34:24Z", "path": "bundles/org.openhab.binding.bluetooth.enoceanble/src/main/feature/feature.xml", "diffHunk": "@@ -0,0 +1,12 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<features name=\"org.openhab.binding.bluetooth.ruuvitag-${project.version}\" xmlns=\"http://karaf.apache.org/xmlns/features/v1.4.0\">\n+\t<repository>mvn:org.openhab.core.features.karaf/org.openhab.core.features.karaf.openhab-core/${project.version}/xml/features</repository>\n+\n+\t<feature name=\"openhab-binding-bluetooth-enoceanble\" description=\"Bluetooth Binding EnOcean BLE\" version=\"${project.version}\">\n+\t\t<feature>openhab-runtime-base</feature>\n+\t\t<feature>openhab-transport-serial</feature>", "originalCommit": "9c689460f8b2f7ba7b57cb9969acb11b142177ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f613d1fdd3785d72218110f8845212f7af0f642e", "url": "https://github.com/openhab/openhab-addons/commit/f613d1fdd3785d72218110f8845212f7af0f642e", "message": "[bluetooth.enoceanble] Add binding to CODEOWNERS\n\nSigned-off-by: Patrick Fink <mail@pfink.de>", "committedDate": "2020-12-04T20:25:07Z", "type": "commit"}, {"oid": "a9839880da3a70a1fec799d6c0b4ab40cfd6dd01", "url": "https://github.com/openhab/openhab-addons/commit/a9839880da3a70a1fec799d6c0b4ab40cfd6dd01", "message": "[bluetooth.enoceanble] Remove obsolete transport serial feature\n\nSigned-off-by: Patrick Fink <mail@pfink.de>", "committedDate": "2020-12-04T20:25:43Z", "type": "commit"}, {"oid": "e90ed43db7dde471f141360a2c9f7018f6f1aaa3", "url": "https://github.com/openhab/openhab-addons/commit/e90ed43db7dde471f141360a2c9f7018f6f1aaa3", "message": "[bluetooth.enoceanble] Add binding to footer.xml\n\nSigned-off-by: Patrick Fink <mail@pfink.de>", "committedDate": "2020-12-04T20:32:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MTU5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536371591", "bodyText": "The tinyB library is no longer used for the BlueZ binding. Have you tested this with the latest version?", "author": "cpmeister", "createdAt": "2020-12-04T20:49:55Z", "path": "bundles/org.openhab.binding.bluetooth.enoceanble/README.md", "diffHunk": "@@ -0,0 +1,60 @@\n+# EnOcean BLE Binding\n+\n+This binding adds support for the\n+[EnOcean BLE PTM215B](https://www.enocean.com/de/produkte/enocean_module_24ghz_ble/ptm-215b/) rocker.\n+\n+Currently, it does not work seamlessly work with the\n+[BlueZ Binding](https://www.openhab.org/addons/bindings/bluetooth.bluez) because of limitations of this binding,\n+particularly the underlying tinyB library. The recommended / tested Bluetooth bridge binding is the", "originalCommit": "e90ed43db7dde471f141360a2c9f7018f6f1aaa3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4MTkyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536381921", "bodyText": "No, was not aware about it. Will test it.", "author": "pfink", "createdAt": "2020-12-04T21:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM5MTYxMw==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536391613", "bodyText": "... but it can take some days / weeks because I have to observe long-term performance", "author": "pfink", "createdAt": "2020-12-04T21:31:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM5NjkwMQ==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536396901", "bodyText": "Then at the very least remove the mention of the tinyB library from this comment.", "author": "cpmeister", "createdAt": "2020-12-04T21:43:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ1MzE5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536453191", "bodyText": "Did do a quick test now, could not get it to work. Adapter status is online but no rocker events are coming in. Restarting openHAB did not change anything. Tested it with the RPI4 integrated adapter as well as a USB adapter that I know is working well for BLE. Log shows no errors or warnings. I could do a deep-dive maybe next weekend. For now I'll just remove the tinyB hint. I used the newest Bluez version on Raspbian (5.50).", "author": "pfink", "createdAt": "2020-12-05T00:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MTU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MjY4MA==", "url": "https://github.com/openhab/openhab-addons/pull/9223#discussion_r536372680", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @Component(service = ThingHandlerFactory.class, configurationPid = \"binding.ruuvitag\")\n          \n          \n            \n            @Component(service = ThingHandlerFactory.class, configurationPid = \"binding.bluetooth.enoceanble\")", "author": "cpmeister", "createdAt": "2020-12-04T20:52:07Z", "path": "bundles/org.openhab.binding.bluetooth.enoceanble/src/main/java/org/openhab/binding/bluetooth/enoceanble/internal/EnoceanBleHandlerFactory.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.bluetooth.enoceanble.internal;\n+\n+import java.util.Collections;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.binding.BaseThingHandlerFactory;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerFactory;\n+import org.osgi.service.component.annotations.Component;\n+\n+/**\n+ * The {@link EnoceanBleHandlerFactory} is responsible for creating things and thing handlers.\n+ *\n+ * @author Patrick Fink - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(service = ThingHandlerFactory.class, configurationPid = \"binding.ruuvitag\")", "originalCommit": "e90ed43db7dde471f141360a2c9f7018f6f1aaa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48d736753fd70f74b2532650156ac9733e4e75f8", "url": "https://github.com/openhab/openhab-addons/commit/48d736753fd70f74b2532650156ac9733e4e75f8", "message": "[bluetooth.enoceanble] Replace ruuvitag leftovers\n\nSigned-off-by: Patrick Fink <mail@pfink.de>", "committedDate": "2020-12-04T22:35:10Z", "type": "commit"}, {"oid": "87e40a43815c249becb5f4b5ac186c5e281976a4", "url": "https://github.com/openhab/openhab-addons/commit/87e40a43815c249becb5f4b5ac186c5e281976a4", "message": "[bluetooth.enoceanble] Remove tinyB reference\n\nSigned-off-by: Patrick Fink <mail@pfink.de>", "committedDate": "2020-12-05T00:09:58Z", "type": "commit"}]}