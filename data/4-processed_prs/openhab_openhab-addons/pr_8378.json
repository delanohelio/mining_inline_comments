{"pr_number": 8378, "pr_title": "[Airquality] Binding update", "pr_createdAt": "2020-09-01T13:42:33Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8378", "timeline": [{"oid": "1613a80f2349fc9dc80ed098093d3d0430fde321", "url": "https://github.com/openhab/openhab-addons/commit/1613a80f2349fc9dc80ed098093d3d0430fde321", "message": "[Airquality] Binding update\nAdded non null annotations\nReferences passed by constructor\nRemoved org.apache.... dependencies\nCode enhancement\nFrench localization\n\nSigned-off-by: clinique <gael@lhopital.org>", "committedDate": "2020-09-01T13:36:00Z", "type": "commit"}, {"oid": "47d26b5d6b85b5ec3b43c7df45dc09b98a457922", "url": "https://github.com/openhab/openhab-addons/commit/47d26b5d6b85b5ec3b43c7df45dc09b98a457922", "message": "Adding AQI Color channel\n\nSigned-off-by: clinique <gael@lhopital.org>", "committedDate": "2020-09-01T14:04:29Z", "type": "commit"}, {"oid": "040691e8be6a93abfad3d7371129910e35090f35", "url": "https://github.com/openhab/openhab-addons/commit/040691e8be6a93abfad3d7371129910e35090f35", "message": "A SAT leftover\n\nSigned-off-by: clinique <gael@lhopital.org>", "committedDate": "2020-09-01T14:51:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNTMyMA==", "url": "https://github.com/openhab/openhab-addons/pull/8378#discussion_r481405320", "bodyText": "IIRC line feeds cannot be displayed in th UI.", "author": "fwolter", "createdAt": "2020-09-01T20:15:58Z", "path": "bundles/org.openhab.binding.airquality/src/main/java/org/openhab/binding/airquality/internal/handler/AirQualityHandler.java", "diffHunk": "@@ -86,115 +83,61 @@ public void initialize() {\n         logger.debug(\"config stationId = {}\", config.stationId);\n         logger.debug(\"config refresh = {}\", config.refresh);\n \n-        String errorMsg = null;\n+        List<String> errorMsg = new ArrayList<>();\n \n-        if (StringUtils.trimToNull(config.apikey) == null) {\n-            errorMsg = \"Parameter 'apikey' is mandatory and must be configured\";\n+        if (config.apikey.trim().isEmpty()) {\n+            errorMsg.add(\"Parameter 'apikey' is mandatory and must be configured\");\n         }\n-        if (StringUtils.trimToNull(config.location) == null && config.stationId == null) {\n-            errorMsg = \"Parameter 'location' or 'stationId' is mandatory and must be configured\";\n+        if (config.location.trim().isEmpty() && config.stationId == null) {\n+            errorMsg.add(\"Parameter 'location' or 'stationId' is mandatory and must be configured\");\n         }\n-        if (config.refresh != null && config.refresh < 5) {\n-            errorMsg = \"Parameter 'refresh' must be at least 5 minutes\";\n+        if (config.refresh < 30) {\n+            errorMsg.add(\"Parameter 'refresh' must be at least 30 minutes\");\n         }\n \n-        if (errorMsg == null) {\n-            updateStatus(ThingStatus.ONLINE);\n-            startAutomaticRefresh();\n+        if (errorMsg.isEmpty()) {\n+            ScheduledFuture<?> job = this.refreshJob;\n+            if (job == null || job.isCancelled()) {\n+                refreshJob = scheduler.scheduleWithFixedDelay(this::updateAndPublishData, 0, config.refresh,\n+                        TimeUnit.MINUTES);\n+            }\n         } else {\n-            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, errorMsg);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, String.join(\"\\n\", errorMsg));", "originalCommit": "040691e8be6a93abfad3d7371129910e35090f35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1610225d59c04b0593b8d18f7641e8426894848c", "url": "https://github.com/openhab/openhab-addons/commit/1610225d59c04b0593b8d18f7641e8426894848c", "message": "Code review corrections\n\nSigned-off-by: clinique <gael@lhopital.org>", "committedDate": "2020-09-02T13:48:22Z", "type": "commit"}]}