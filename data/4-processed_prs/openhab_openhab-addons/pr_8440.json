{"pr_number": 8440, "pr_title": "[nuki] Add smart lock door sensor state as new channel (#8438)", "pr_createdAt": "2020-09-09T20:46:53Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8440", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485925762", "bodyText": "Channels with options should be of item-type String.", "author": "Hilbrand", "createdAt": "2020-09-09T21:14:21Z", "path": "bundles/org.openhab.binding.nuki/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -101,5 +101,21 @@\n \t\t\t</options>\n \t\t</state>\n \t</channel-type>\n+\t<channel-type id=\"smartlockDoorState\">\n+\t\t<item-type>Number</item-type>", "originalCommit": "4687dd9de60634e46e30ad3dd3ded83cede30d78", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzNjY0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485936641", "bodyText": "The new channel only has numbers as value. I copied the configuration from the smartlockState which is exactly the same.", "author": "SeeAge", "createdAt": "2020-09-09T21:38:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0NDg2NA==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485944864", "bodyText": "Hmm that's not how it should be. I think in practice it's not really a problem at this moment. See here in the documentation about the information it needs to be a String: https://www.openhab.org/docs/developer/bindings/thing-xml.html#state-description", "author": "Hilbrand", "createdAt": "2020-09-09T21:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk1MTEwOA==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485951108", "bodyText": "I understand. I will test locally and give feedback asap.", "author": "SeeAge", "createdAt": "2020-09-09T22:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIyMTU0MA==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r486221540", "bodyText": "I have searched a bit, but cannot find an example in the repository where an item-type string is used while the option values are integers. As far as I can see from the state-description, an item-type string is only useful if the values are also strings.\nAlso the conversion from an integer to a state is quite strange and it seems it has to be done like this:\nupdateState(channelDoorState.getUID(), (State) new StringType(Integer.toString(NukiBindingConstants.DOORSENSOR_STATES_UNKNOWN)));\nthis is maybe because the project does not import the openhab libraries but:\nimport org.eclipse.smarthome.config.core.Configuration;\nimport org.eclipse.smarthome.core.library.types.DecimalType;\nimport org.eclipse.smarthome.core.library.types.OnOffType;\nimport org.eclipse.smarthome.core.thing.Bridge;\nimport org.eclipse.smarthome.core.thing.Channel;\nimport org.eclipse.smarthome.core.thing.ChannelUID;\nimport org.eclipse.smarthome.core.thing.Thing;\nimport org.eclipse.smarthome.core.thing.ThingStatus;\nimport org.eclipse.smarthome.core.thing.ThingStatusDetail;\nimport org.eclipse.smarthome.core.thing.ThingStatusInfo;\nimport org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\nimport org.eclipse.smarthome.core.thing.binding.ThingHandler;\nimport org.eclipse.smarthome.core.types.Command;\nimport org.eclipse.smarthome.core.types.RefreshType;\nimport org.eclipse.smarthome.core.types.State;", "author": "SeeAge", "createdAt": "2020-09-10T10:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM3OTYxNA==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r486379614", "bodyText": "I just tested a bit more. When keeping the org.eclipse.smarthome.core.types.State library, I could not cast the integer values to string states. When using the org.openhab.core.types.State library the already existing code throws a lot of errors about type conversion.\nSummary: I would like to keep the type as Number for this rather small addon. Maybe with the OpenHab 3 a conversion makes more sense.", "author": "SeeAge", "createdAt": "2020-09-10T14:16:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjMzMg==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r487532332", "bodyText": "To get to the bottom of this I've asked about what it should be and it turns out Number is actual valid. So this is perfectly fine and the documentation is wrong on this. So I'm going to merge it as is.\nFYI. the State in org.openhab is from the openHAB 1 compatibility layer and should not be used. In openHAB 3 the namespace of core will be changed from eclipse to openhab. That will mean if you look at openHAB 3 source code the State in org.eclipse is gone, and the org.openhab is than the version that was originally in org.eclipse. The openHAB 1 compatibility layer will be removed in openHAB 3.", "author": "Hilbrand", "createdAt": "2020-09-13T13:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNTc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyNjE5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485926195", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<channel id=\"lowBattery\" typeId=\"system.low-battery\"/><channel typeId=\"smartlockDoorState\" id=\"doorsensorState\"></channel>\n          \n          \n            \n            \t\t\t<channel id=\"lowBattery\" typeId=\"system.low-battery\"/>\n          \n          \n            \n            \t\t\t<channel typeId=\"smartlockDoorState\" id=\"doorsensorState\"/>\n          \n      \n    \n    \n  \n\nBut this might also be fixed when you run mvn spotless:apply on the binding", "author": "Hilbrand", "createdAt": "2020-09-09T21:15:14Z", "path": "bundles/org.openhab.binding.nuki/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -46,7 +46,7 @@\n \t\t<channels>\n \t\t\t<channel id=\"lock\" typeId=\"smartlockLock\"/>\n \t\t\t<channel id=\"lockState\" typeId=\"smartlockState\"/>\n-\t\t\t<channel id=\"lowBattery\" typeId=\"system.low-battery\"/>\n+\t\t\t<channel id=\"lowBattery\" typeId=\"system.low-battery\"/><channel typeId=\"smartlockDoorState\" id=\"doorsensorState\"></channel>", "originalCommit": "4687dd9de60634e46e30ad3dd3ded83cede30d78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyODI2NA==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485928264", "bodyText": "These constants don't seem to be used? Can they be removed.", "author": "Hilbrand", "createdAt": "2020-09-09T21:19:41Z", "path": "bundles/org.openhab.binding.nuki/src/main/java/org/openhab/binding/nuki/internal/NukiBindingConstants.java", "diffHunk": "@@ -86,4 +88,12 @@\n     // Nuki Binding additional Lock States\n     public static final int LOCK_STATES_UNLOCKING_LOCKNGO = 1002;\n     public static final int LOCK_STATES_UNLATCHING_LOCKNGO = 1007;\n+\n+    // Nuki Binding Door States", "originalCommit": "4687dd9de60634e46e30ad3dd3ded83cede30d78", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzNzQzMw==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r485937433", "bodyText": "They are not required. I added them just like the other LOCK_STATES_.... which are also not used.", "author": "SeeAge", "createdAt": "2020-09-09T21:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyODI2NA=="}], "type": "inlineReview"}, {"oid": "00119e725687b3ddebf57bfae9a23b93fe3583f4", "url": "https://github.com/openhab/openhab-addons/commit/00119e725687b3ddebf57bfae9a23b93fe3583f4", "message": "[nuki] Add smart lock door sensor state as new channel (#8438)\n\nSigned-off-by: Christian H\u00f6fler <github@seeage.com>", "committedDate": "2020-09-09T21:43:40Z", "type": "commit"}, {"oid": "7ac235c3515df439a0e60552e611ea0ae3ac9820", "url": "https://github.com/openhab/openhab-addons/commit/7ac235c3515df439a0e60552e611ea0ae3ac9820", "message": "[nuki] Add smart lock door sensor state as new channel (#8438)\n\n- convert spaces to tabs in xml file\n- fix tab formatting in README file\n\nSigned-off-by: Christian H\u00f6fler <github@seeage.com>", "committedDate": "2020-09-09T21:43:40Z", "type": "commit"}, {"oid": "7f36acc3b1caacedca754ffbee56f57c2d2c6e64", "url": "https://github.com/openhab/openhab-addons/commit/7f36acc3b1caacedca754ffbee56f57c2d2c6e64", "message": "Update bundles/org.openhab.binding.nuki/src/main/resources/ESH-INF/thing/thing-types.xml\n\nCo-authored-by: Hilbrand Bouwkamp <hilbrand@h72.nl>\nSigned-off-by: Christian H\u00f6fler <github@seeage.com>", "committedDate": "2020-09-09T21:43:40Z", "type": "commit"}, {"oid": "7f36acc3b1caacedca754ffbee56f57c2d2c6e64", "url": "https://github.com/openhab/openhab-addons/commit/7f36acc3b1caacedca754ffbee56f57c2d2c6e64", "message": "Update bundles/org.openhab.binding.nuki/src/main/resources/ESH-INF/thing/thing-types.xml\n\nCo-authored-by: Hilbrand Bouwkamp <hilbrand@h72.nl>\nSigned-off-by: Christian H\u00f6fler <github@seeage.com>", "committedDate": "2020-09-09T21:43:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjQyNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8440#discussion_r487532425", "bodyText": "For consistency:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<channel typeId=\"smartlockDoorState\" id=\"doorsensorState\"/>\n          \n          \n            \n            \t\t\t<channel id=\"doorsensorState\" typeId=\"smartlockDoorState\"/>", "author": "Hilbrand", "createdAt": "2020-09-13T13:53:32Z", "path": "bundles/org.openhab.binding.nuki/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -47,6 +47,7 @@\n \t\t\t<channel id=\"lock\" typeId=\"smartlockLock\"/>\n \t\t\t<channel id=\"lockState\" typeId=\"smartlockState\"/>\n \t\t\t<channel id=\"lowBattery\" typeId=\"system.low-battery\"/>\n+\t\t\t<channel typeId=\"smartlockDoorState\" id=\"doorsensorState\"/>", "originalCommit": "7f36acc3b1caacedca754ffbee56f57c2d2c6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "758b2120ee66a0f6e1ad475a5f8b2b40cb11359a", "url": "https://github.com/openhab/openhab-addons/commit/758b2120ee66a0f6e1ad475a5f8b2b40cb11359a", "message": "Change of consistency: swapped parameters.", "committedDate": "2020-09-13T13:54:09Z", "type": "commit"}]}