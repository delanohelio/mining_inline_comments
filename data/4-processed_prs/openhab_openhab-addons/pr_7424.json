{"pr_number": 7424, "pr_title": "[modbus] Cleaned modbus binding + extension docs", "pr_createdAt": "2020-04-19T18:58:09Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7424", "timeline": [{"oid": "29a0266c4fc2f92882dc83889bb7cdafb8f904a3", "url": "https://github.com/openhab/openhab-addons/commit/29a0266c4fc2f92882dc83889bb7cdafb8f904a3", "message": "Cleaned modbus binding + extension\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-04-19T18:57:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410968716", "bodyText": "This is different from what we do in Bluetooth and mqtt. There we have no feature.xml at all for the bundles but add the aggregated feature in the feature-build-bundle (IIRC footer.xml).", "author": "J-N-K", "createdAt": "2020-04-19T19:01:52Z", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/feature/feature.xml", "diffHunk": "@@ -1,10 +1,11 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <features name=\"org.openhab.binding.modbus.sunspec-${project.version}\" xmlns=\"http://karaf.apache.org/xmlns/features/v1.4.0\">\n-    <repository>file:${basedirRoot}/bundles/org.openhab.binding.modbus/target/feature/feature.xml</repository>\n+    <repository>mvn:org.openhab.core.features.karaf/org.openhab.core.features.karaf.openhab-core/${ohc.version}/xml/features</repository>\n \n-    <feature name=\"openhab-binding-modbus-sunspec\" description=\"SunSpec Bundle\" version=\"${project.version}\">\n+    <feature name=\"openhab-binding-modbus-sunspec\" description=\"Modbus Binding SunSpec\" version=\"${project.version}\">\n         <feature>openhab-runtime-base</feature>\n-        <feature>openhab-binding-modbus</feature>\n+        <feature>openhab-transport-modbus</feature>\n+        <bundle start-level=\"80\">mvn:org.openhab.addons.bundles/org.openhab.binding.modbus/${project.version}</bundle>", "originalCommit": "29a0266c4fc2f92882dc83889bb7cdafb8f904a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTAxOA==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410969018", "bodyText": "What is this then? https://github.com/openhab/openhab-addons/blob/2.5.x/bundles/org.openhab.binding.bluetooth.blukii/src/main/feature/feature.xml", "author": "kaikreuzer", "createdAt": "2020-04-19T19:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTI2Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410969263", "bodyText": "And https://github.com/openhab/openhab-addons/blob/2.5.x/bundles/org.openhab.binding.bluetooth.am43/src/main/feature/feature.xml and https://github.com/openhab/openhab-addons/blob/2.5.x/bundles/org.openhab.binding.bluetooth.airthings/src/main/feature/feature.xml ...", "author": "kaikreuzer", "createdAt": "2020-04-19T19:05:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTg5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410969899", "bodyText": "features/openhab-addons/src/main/resources/footer.xml\nThis are the features that are installed, so we should add modbus here, too. The single-features are excluded here: \n  \n    \n      openhab-addons/features/openhab-addons/pom.xml\n    \n    \n         Line 47\n      in\n      202bca7\n    \n    \n    \n    \n\n        \n          \n           <exclude name=\"**/org.openhab.binding.bluetooth*/**/feature.xml\"/>", "author": "J-N-K", "createdAt": "2020-04-19T19:08:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk3MjYyMA==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410972620", "bodyText": "Ok, I will add modbus there as well.\nBut what I don't understand yet: How/where are the aggregated features generated?", "author": "kaikreuzer", "createdAt": "2020-04-19T19:23:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk3MzI4NA==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410973284", "bodyText": "It slowly all comes back :-). If you tell me where to put it, I\u2018ll add a section on feature-definition and aggregation to the developer documentation. Since this is a bit special, I\u2018m not sure if it should be part of the general description for binding development.", "author": "J-N-K", "createdAt": "2020-04-19T19:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk3NDE1Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410974153", "bodyText": "Ok, I will add modbus there as well.\n\nDone.\n\nIf you tell me where to put it\n\nHm, tricky question. We don't have anything about the general structure for an add-on yet.\nhttps://www.openhab.org/docs/developer/buildsystem.html comes closest - maybe some info on feature definition could be added to that page, wdyt?", "author": "kaikreuzer", "createdAt": "2020-04-19T19:30:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMjE2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r411522167", "bodyText": "Added. I already wrote an explanation for the new embedding-strategy for dependencies but forgot to create a PR for that. Shame on me.", "author": "J-N-K", "createdAt": "2020-04-20T16:33:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU0OTI2MA==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r411549260", "bodyText": "Thanks!", "author": "kaikreuzer", "createdAt": "2020-04-20T17:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2ODcxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTE4MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410969181", "bodyText": "IIRC this is not working, because the transport bundle is not available (it\u2018s part of addons). Therefore the feature verification will fail.", "author": "J-N-K", "createdAt": "2020-04-19T19:04:37Z", "path": "bundles/org.openhab.binding.modbus/src/main/feature/feature.xml", "diffHunk": "@@ -1,6 +1,6 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <features name=\"org.openhab.binding.modbus-${project.version}\" xmlns=\"http://karaf.apache.org/xmlns/features/v1.4.0\">\n-    <repository>file:${basedirRoot}/bundles/org.openhab.io.transport.modbus/target/feature/feature.xml</repository>\n+    <repository>mvn:org.openhab.core.features.karaf/org.openhab.core.features.karaf.openhab-core/${ohc.version}/xml/features</repository>", "originalCommit": "29a0266c4fc2f92882dc83889bb7cdafb8f904a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTQ5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410969491", "bodyText": "Do we have any documentation on what how to set repository element? This is a bit confusing to me...", "author": "kaikreuzer", "createdAt": "2020-04-19T19:06:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk3MDU2NA==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410970564", "bodyText": "Agreed. In 99+% of the bundles what you did is correct. The problem arises from the fact that the bundle depends on a feature that is not part of core but of addons. The question is, if we should integrate the transport bundle in the aggregated feature, too. Then we could add all transport bundles (including dependencies) in this feature.", "author": "J-N-K", "createdAt": "2020-04-19T19:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk3MjI4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410972283", "bodyText": "Ok, thanks, I have reverted the repo entry.", "author": "kaikreuzer", "createdAt": "2020-04-19T19:21:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5MzQwMw==", "url": "https://github.com/openhab/openhab-addons/pull/7424#discussion_r410993403", "bodyText": "The problem arises from the fact that the bundle depends on a feature that is not part of core but of addons\n\nI was just browsing the addons repo when contemplating about openhab/openhab-core#1319 (comment) - and I came to the conclusion that the io.transport.modbus bundle simply does not belong in this repo, but should be moved to openhab-core, where all other io.transport bundles reside.\nWe can't move it for 2.5, but I'd strongly suggest that we move it for 3.0.", "author": "kaikreuzer", "createdAt": "2020-04-19T21:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk2OTE4MQ=="}], "type": "inlineReview"}, {"oid": "80bb3ff821ffd467277d385f53d9085b19e3e13d", "url": "https://github.com/openhab/openhab-addons/commit/80bb3ff821ffd467277d385f53d9085b19e3e13d", "message": "fixed repo definitions\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-04-19T19:19:09Z", "type": "commit"}, {"oid": "4e35ebd63670062264270bd8eecb380a6afecb86", "url": "https://github.com/openhab/openhab-addons/commit/4e35ebd63670062264270bd8eecb380a6afecb86", "message": "added modbus extension exclusion in feature generation\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-04-19T19:26:28Z", "type": "commit"}, {"oid": "f41fbafc482ad201ca3072bfb8404b610e7eb198", "url": "https://github.com/openhab/openhab-addons/commit/f41fbafc482ad201ca3072bfb8404b610e7eb198", "message": "added modbus to footer.xml\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-04-20T17:20:43Z", "type": "commit"}]}