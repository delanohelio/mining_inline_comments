{"pr_number": 8756, "pr_title": "[miio] Allow for quantity Type", "pr_createdAt": "2020-10-14T23:36:36Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8756", "timeline": [{"oid": "1228225331f50fb6f73ab00554a249a8a3a34643", "url": "https://github.com/openhab/openhab-addons/commit/1228225331f50fb6f73ab00554a249a8a3a34643", "message": "[miio] handle command\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-10-27T10:02:02Z", "type": "forcePushed"}, {"oid": "5fdabead71744ca0549bdba2df17e598c313e378", "url": "https://github.com/openhab/openhab-addons/commit/5fdabead71744ca0549bdba2df17e598c313e378", "message": "WIP\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-10-31T22:05:03Z", "type": "forcePushed"}, {"oid": "cba1d719f90a7f63278958148dad14f3baac6928", "url": "https://github.com/openhab/openhab-addons/commit/cba1d719f90a7f63278958148dad14f3baac6928", "message": "[miio] add ampere\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-05T22:09:52Z", "type": "forcePushed"}, {"oid": "ce154f136e52f92b9cd302fddb8faa0e07487e8f", "url": "https://github.com/openhab/openhab-addons/commit/ce154f136e52f92b9cd302fddb8faa0e07487e8f", "message": "[miio] Allow for quantity Type in the basic handler\n\nThis extends the miio:basic handler with the option to define channels\nwith QuantityType e.g. to use number:temperature\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-06T16:01:28Z", "type": "commit"}, {"oid": "ce154f136e52f92b9cd302fddb8faa0e07487e8f", "url": "https://github.com/openhab/openhab-addons/commit/ce154f136e52f92b9cd302fddb8faa0e07487e8f", "message": "[miio] Allow for quantity Type in the basic handler\n\nThis extends the miio:basic handler with the option to define channels\nwith QuantityType e.g. to use number:temperature\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-06T16:01:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI0NDk4MQ==", "url": "https://github.com/openhab/openhab-addons/pull/8756#discussion_r519244981", "bodyText": "you forgot to add break statements.", "author": "cpmeister", "createdAt": "2020-11-08T02:00:08Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoBasicHandler.java", "diffHunk": "@@ -534,6 +562,37 @@ private void updateChannel(@Nullable MiIoBasicChannel basicChannel, String param\n         }\n     }\n \n+    private void quantityTypeUpdate(MiIoBasicChannel basicChannel, JsonElement val, String type) {\n+        if (!basicChannel.getUnit().isBlank()) {\n+            Unit<?> unit = MiIoQuantiyTypes.get(basicChannel.getUnit());\n+            if (unit != null) {\n+                logger.debug(\"'{}' channel '{}' has unit '{}' with symbol '{}'.\", getThing().getUID(),\n+                        basicChannel.getChannel(), basicChannel.getUnit(), unit);\n+                updateState(basicChannel.getChannel(), new QuantityType<>(val.getAsBigDecimal(), unit));\n+            } else {\n+                logger.debug(\"Unit '{}' used by '{}' channel '{}' is not found.. using default unit.\",\n+                        getThing().getUID(), basicChannel.getUnit(), basicChannel.getChannel());\n+            }\n+        }\n+        // if no unit is provided or unit not found use default units, these units have so far been seen for miio\n+        // devices\n+        switch (type.toLowerCase()) {\n+            case \"temperature\":\n+                updateState(basicChannel.getChannel(), new QuantityType<>(val.getAsBigDecimal(), SIUnits.CELSIUS));\n+                break;\n+            case \"electriccurrent\":\n+                updateState(basicChannel.getChannel(),\n+                        new QuantityType<>(val.getAsBigDecimal(), SmartHomeUnits.AMPERE));\n+                break;\n+            case \"energy\":\n+                updateState(basicChannel.getChannel(), new QuantityType<>(val.getAsBigDecimal(), SmartHomeUnits.WATT));\n+            case \"time\":\n+                updateState(basicChannel.getChannel(), new QuantityType<>(val.getAsBigDecimal(), SmartHomeUnits.HOUR));\n+            default:\n+                updateState(basicChannel.getChannel(), new DecimalType(val.getAsBigDecimal()));", "originalCommit": "ce154f136e52f92b9cd302fddb8faa0e07487e8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "71d469c479cf32edb9ea07f23151ea977be54e1a", "url": "https://github.com/openhab/openhab-addons/commit/71d469c479cf32edb9ea07f23151ea977be54e1a", "message": "[miio] add missing breaks\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-08T17:43:43Z", "type": "commit"}]}