{"pr_number": 7821, "pr_title": "[sonos] Add null annotations", "pr_createdAt": "2020-05-31T07:48:17Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7821", "timeline": [{"oid": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "url": "https://github.com/openhab/openhab-addons/commit/3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "message": "[sonos] Add null annotations\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-05-31T07:45:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQyOTEwMw==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433429103", "bodyText": "I don't think clone is ever supposed to return null normally. Honestly the use of clone is outdated to begin with and would much rather a custom method created for this instead. But if you don't want to go through the work of replacing the clone method I suggest you just throw some type of runtime exception instead of returning null. Also, you can override the return type as well.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public @Nullable Object clone() {\n          \n          \n            \n                    try {\n          \n          \n            \n                        return super.clone();\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        return null;\n          \n          \n            \n                    }\n          \n          \n            \n                }\n          \n          \n            \n                public SonosAlarm clone() {\n          \n          \n            \n                    try {\n          \n          \n            \n                        return (SonosAlarm) super.clone();\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        throw new UnsupportedOperationException(e);\n          \n          \n            \n                    }\n          \n          \n            \n                }", "author": "cpmeister", "createdAt": "2020-06-01T19:02:14Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/SonosAlarm.java", "diffHunk": "@@ -12,29 +12,59 @@\n  */\n package org.openhab.binding.sonos.internal;\n \n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n /**\n  * The {@link SonosAlarm} is a datastructure to describe\n  * alarms in the Sonos ecosystem\n  *\n  * @author Karel Goderis - Initial contribution\n  */\n+@NonNullByDefault\n public class SonosAlarm implements Cloneable {\n \n+    private final int id;\n+    private String startTime;\n+    private final String duration;\n+    private final String recurrence;\n+    private boolean enabled;\n+    private final String roomUUID;\n+    private final String programURI;\n+    private final String programMetaData;\n+    private final String playMode;\n+    private final int volume;\n+    private final boolean includeLinkedZones;\n+\n+    public SonosAlarm(int id, String startTime, String duration, String recurrence, boolean enabled, String roomUUID,\n+            String programURI, String programMetaData, String playMode, int volume, boolean includeLinkedZones) {\n+        this.id = id;\n+        this.startTime = startTime;\n+        this.duration = duration;\n+        this.recurrence = recurrence;\n+        this.enabled = enabled;\n+        this.roomUUID = roomUUID;\n+        this.programURI = programURI;\n+        this.programMetaData = programMetaData;\n+        this.playMode = playMode;\n+        this.volume = volume;\n+        this.includeLinkedZones = includeLinkedZones;\n+    }\n+\n     @Override\n-    public Object clone() {\n+    public @Nullable Object clone() {\n         try {\n             return super.clone();\n         } catch (Exception e) {\n             return null;\n         }\n     }", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4NDQ1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433784456", "bodyText": "I will try to suppress the clone method.\nWe have another one in another class.", "author": "lolodomo", "createdAt": "2020-06-02T10:44:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQyOTEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MjM3Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436252376", "bodyText": "I found no reason to implement Clonable in the class SonosAlarm !\nRemoved.", "author": "lolodomo", "createdAt": "2020-06-06T09:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQyOTEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDAwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433434006", "bodyText": "The null check already done in the isPlayingQueue method, so you don't need to check beforehand.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            } else if (currentURI != null && isPlayingQueue(currentURI)) {\n          \n          \n            \n                            } else if (isPlayingQueue(currentURI)) {", "author": "cpmeister", "createdAt": "2020-06-01T19:12:17Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -2351,20 +2386,20 @@ private void scheduleNotificationSound(final Command command) {\n      * @param url in the format of //host/folder/filename.mp3\n      */\n     public void playNotificationSoundURI(Command notificationURL) {\n-        if (notificationURL != null && notificationURL instanceof StringType) {\n+        if (notificationURL instanceof StringType) {\n             try {\n                 ZonePlayerHandler coordinator = getCoordinatorHandler();\n \n                 String currentURI = coordinator.getCurrentURI();\n                 logger.debug(\"playNotificationSoundURI: currentURI {} metadata {}\", currentURI,\n                         coordinator.getCurrentURIMetadataAsString());\n \n-                if (isPlayingStream(currentURI) || isPlayingRadioStartedByAmazonEcho(currentURI)\n-                        || isPlayingRadio(currentURI)) {\n+                if ((currentURI != null) && (isPlayingStream(currentURI)\n+                        || isPlayingRadioStartedByAmazonEcho(currentURI) || isPlayingRadio(currentURI))) {\n                     handleRadioStream(currentURI, notificationURL, coordinator);\n-                } else if (isPlayingLineIn(currentURI)) {\n+                } else if (currentURI != null && isPlayingLineIn(currentURI)) {\n                     handleLineIn(currentURI, notificationURL, coordinator);\n-                } else if (isPlayingQueue(currentURI)) {\n+                } else if (currentURI != null && isPlayingQueue(currentURI)) {", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc5MTY4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433791685", "bodyText": "Yes you're right, I have to check why I added that, I just remember it was to avoid a warning.", "author": "lolodomo", "createdAt": "2020-06-02T10:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MDM4Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436250386", "bodyText": "Ok, it was in fact to avoid an error at the next line (call to handleSharedQueue with a nullable currentURI).", "author": "lolodomo", "createdAt": "2020-06-06T08:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MTU0Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436251546", "bodyText": "Fixed", "author": "lolodomo", "createdAt": "2020-06-06T08:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDEzOA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433434138", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            } else if (currentURI != null && isPlayingLineIn(currentURI)) {\n          \n          \n            \n                            } else if (isPlayingLineIn(currentURI)) {", "author": "cpmeister", "createdAt": "2020-06-01T19:12:33Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -2351,20 +2386,20 @@ private void scheduleNotificationSound(final Command command) {\n      * @param url in the format of //host/folder/filename.mp3\n      */\n     public void playNotificationSoundURI(Command notificationURL) {\n-        if (notificationURL != null && notificationURL instanceof StringType) {\n+        if (notificationURL instanceof StringType) {\n             try {\n                 ZonePlayerHandler coordinator = getCoordinatorHandler();\n \n                 String currentURI = coordinator.getCurrentURI();\n                 logger.debug(\"playNotificationSoundURI: currentURI {} metadata {}\", currentURI,\n                         coordinator.getCurrentURIMetadataAsString());\n \n-                if (isPlayingStream(currentURI) || isPlayingRadioStartedByAmazonEcho(currentURI)\n-                        || isPlayingRadio(currentURI)) {\n+                if ((currentURI != null) && (isPlayingStream(currentURI)\n+                        || isPlayingRadioStartedByAmazonEcho(currentURI) || isPlayingRadio(currentURI))) {\n                     handleRadioStream(currentURI, notificationURL, coordinator);\n-                } else if (isPlayingLineIn(currentURI)) {\n+                } else if (currentURI != null && isPlayingLineIn(currentURI)) {", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MTU2NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436251565", "bodyText": "Fixed", "author": "lolodomo", "createdAt": "2020-06-06T08:45:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDEzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDc0NA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433434744", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if ((currentURI != null) && (isPlayingStream(currentURI)\n          \n          \n            \n                                    || isPlayingRadioStartedByAmazonEcho(currentURI) || isPlayingRadio(currentURI))) {\n          \n          \n            \n                            if (isPlayingStream(currentURI) || isPlayingRadioStartedByAmazonEcho(currentURI) \n          \n          \n            \n                                    || isPlayingRadio(currentURI)) {", "author": "cpmeister", "createdAt": "2020-06-01T19:13:53Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -2351,20 +2386,20 @@ private void scheduleNotificationSound(final Command command) {\n      * @param url in the format of //host/folder/filename.mp3\n      */\n     public void playNotificationSoundURI(Command notificationURL) {\n-        if (notificationURL != null && notificationURL instanceof StringType) {\n+        if (notificationURL instanceof StringType) {\n             try {\n                 ZonePlayerHandler coordinator = getCoordinatorHandler();\n \n                 String currentURI = coordinator.getCurrentURI();\n                 logger.debug(\"playNotificationSoundURI: currentURI {} metadata {}\", currentURI,\n                         coordinator.getCurrentURIMetadataAsString());\n \n-                if (isPlayingStream(currentURI) || isPlayingRadioStartedByAmazonEcho(currentURI)\n-                        || isPlayingRadio(currentURI)) {\n+                if ((currentURI != null) && (isPlayingStream(currentURI)\n+                        || isPlayingRadioStartedByAmazonEcho(currentURI) || isPlayingRadio(currentURI))) {", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4OTIwMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433789201", "bodyText": "I probably added the test on currentURI to avoid a warning. To be checked again.", "author": "lolodomo", "createdAt": "2020-06-02T10:54:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MTU4OA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436251588", "bodyText": "Fixed.", "author": "lolodomo", "createdAt": "2020-06-06T08:45:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNDc0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNTYzMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433435631", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return alarmList == null ? new ArrayList<>() : SonosXMLParser.getAlarmsFromStringResult(alarmList);\n          \n          \n            \n                    return alarmList == null ? Collections.emptyList() : SonosXMLParser.getAlarmsFromStringResult(alarmList);", "author": "cpmeister", "createdAt": "2020-06-01T19:15:47Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -2029,85 +2057,87 @@ protected ZonePlayerHandler getHandlerByName(String remotePlayerName) throws Ill\n         for (ThingTypeUID supportedThingType : SonosBindingConstants.SUPPORTED_THING_TYPES_UIDS) {\n             Thing thing = localThingRegistry.get(new ThingUID(supportedThingType, remotePlayerName));\n             if (thing != null) {\n-                return (ZonePlayerHandler) thing.getHandler();\n+                ZonePlayerHandler handler = (ZonePlayerHandler) thing.getHandler();\n+                if (handler != null) {\n+                    return handler;\n+                }\n             }\n         }\n         for (Thing aThing : localThingRegistry.getAll()) {\n             if (SonosBindingConstants.SUPPORTED_THING_TYPES_UIDS.contains(aThing.getThingTypeUID())\n                     && aThing.getConfiguration().get(ZonePlayerConfiguration.UDN).equals(remotePlayerName)) {\n-                return (ZonePlayerHandler) aThing.getHandler();\n+                ZonePlayerHandler handler = (ZonePlayerHandler) aThing.getHandler();\n+                if (handler != null) {\n+                    return handler;\n+                }\n             }\n         }\n         throw new IllegalStateException(\"Could not find handler for \" + remotePlayerName);\n     }\n \n     public void setMute(Command command) {\n-        if (command != null) {\n-            if (command instanceof OnOffType || command instanceof OpenClosedType || command instanceof UpDownType) {\n-                Map<String, String> inputs = new HashMap<>();\n-                inputs.put(\"Channel\", \"Master\");\n+        if (command instanceof OnOffType || command instanceof OpenClosedType || command instanceof UpDownType) {\n+            Map<String, String> inputs = new HashMap<>();\n+            inputs.put(\"Channel\", \"Master\");\n \n-                if (command.equals(OnOffType.ON) || command.equals(UpDownType.UP)\n-                        || command.equals(OpenClosedType.OPEN)) {\n-                    inputs.put(\"DesiredMute\", \"True\");\n-                } else if (command.equals(OnOffType.OFF) || command.equals(UpDownType.DOWN)\n-                        || command.equals(OpenClosedType.CLOSED)) {\n-                    inputs.put(\"DesiredMute\", \"False\");\n-                }\n+            if (command.equals(OnOffType.ON) || command.equals(UpDownType.UP) || command.equals(OpenClosedType.OPEN)) {\n+                inputs.put(\"DesiredMute\", \"True\");\n+            } else if (command.equals(OnOffType.OFF) || command.equals(UpDownType.DOWN)\n+                    || command.equals(OpenClosedType.CLOSED)) {\n+                inputs.put(\"DesiredMute\", \"False\");\n+            }\n \n-                Map<String, String> result = service.invokeAction(this, \"RenderingControl\", \"SetMute\", inputs);\n+            Map<String, String> result = service.invokeAction(this, \"RenderingControl\", \"SetMute\", inputs);\n \n-                for (String variable : result.keySet()) {\n-                    this.onValueReceived(variable, result.get(variable), \"RenderingControl\");\n-                }\n+            for (String variable : result.keySet()) {\n+                this.onValueReceived(variable, result.get(variable), \"RenderingControl\");\n             }\n         }\n     }\n \n     public List<SonosAlarm> getCurrentAlarmList() {\n-        Map<String, String> result = service.invokeAction(this, \"AlarmClock\", \"ListAlarms\", null);\n+        Map<String, @Nullable String> result = service.invokeAction(this, \"AlarmClock\", \"ListAlarms\", null);\n \n         for (String variable : result.keySet()) {\n             this.onValueReceived(variable, result.get(variable), \"AlarmClock\");\n         }\n \n-        return SonosXMLParser.getAlarmsFromStringResult(result.get(\"CurrentAlarmList\"));\n+        String alarmList = result.get(\"CurrentAlarmList\");\n+        return alarmList == null ? new ArrayList<>() : SonosXMLParser.getAlarmsFromStringResult(alarmList);", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MTY0MA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436251640", "bodyText": "Changed", "author": "lolodomo", "createdAt": "2020-06-06T08:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNTYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNzY0NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433437645", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            ZonePlayerHandler handler = (ZonePlayerHandler) thing.getHandler();\n          \n          \n            \n                            if (handler != null) {\n          \n          \n            \n                                return handler;\n          \n          \n            \n                            }\n          \n          \n            \n                            ThingHandler handler = thing.getHandler();\n          \n          \n            \n                            if(handler instanceof ZonePlayerHandler){\n          \n          \n            \n                                return (ZonePlayerHandler) handler;\n          \n          \n            \n                            }", "author": "cpmeister", "createdAt": "2020-06-01T19:19:50Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -2029,85 +2057,87 @@ protected ZonePlayerHandler getHandlerByName(String remotePlayerName) throws Ill\n         for (ThingTypeUID supportedThingType : SonosBindingConstants.SUPPORTED_THING_TYPES_UIDS) {\n             Thing thing = localThingRegistry.get(new ThingUID(supportedThingType, remotePlayerName));\n             if (thing != null) {\n-                return (ZonePlayerHandler) thing.getHandler();\n+                ZonePlayerHandler handler = (ZonePlayerHandler) thing.getHandler();\n+                if (handler != null) {\n+                    return handler;\n+                }", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4NjExNg==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433786116", "bodyText": "Agree", "author": "lolodomo", "createdAt": "2020-06-02T10:48:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNzY0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNzg0OA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433437848", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            ZonePlayerHandler handler = (ZonePlayerHandler) aThing.getHandler();\n          \n          \n            \n                            if (handler != null) {\n          \n          \n            \n                                return handler;\n          \n          \n            \n                            }\n          \n          \n            \n                            ThingHandler handler = thing.getHandler();\n          \n          \n            \n                            if(handler instanceof ZonePlayerHandler){\n          \n          \n            \n                                return (ZonePlayerHandler) handler;\n          \n          \n            \n                            }", "author": "cpmeister", "createdAt": "2020-06-01T19:20:16Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -2029,85 +2057,87 @@ protected ZonePlayerHandler getHandlerByName(String remotePlayerName) throws Ill\n         for (ThingTypeUID supportedThingType : SonosBindingConstants.SUPPORTED_THING_TYPES_UIDS) {\n             Thing thing = localThingRegistry.get(new ThingUID(supportedThingType, remotePlayerName));\n             if (thing != null) {\n-                return (ZonePlayerHandler) thing.getHandler();\n+                ZonePlayerHandler handler = (ZonePlayerHandler) thing.getHandler();\n+                if (handler != null) {\n+                    return handler;\n+                }\n             }\n         }\n         for (Thing aThing : localThingRegistry.getAll()) {\n             if (SonosBindingConstants.SUPPORTED_THING_TYPES_UIDS.contains(aThing.getThingTypeUID())\n                     && aThing.getConfiguration().get(ZonePlayerConfiguration.UDN).equals(remotePlayerName)) {\n-                return (ZonePlayerHandler) aThing.getHandler();\n+                ZonePlayerHandler handler = (ZonePlayerHandler) aThing.getHandler();\n+                if (handler != null) {\n+                    return handler;\n+                }", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4NjIzOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433786239", "bodyText": "Agree", "author": "lolodomo", "createdAt": "2020-06-02T10:48:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzNzg0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzODYzNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433438635", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return zoneGroup != null ? zoneGroup.getMembers().size() == 1 : true;\n          \n          \n            \n                    return zoneGroup == null || zoneGroup.getMembers().size() == 1;", "author": "cpmeister", "createdAt": "2020-06-01T19:21:53Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -1623,7 +1644,8 @@ private boolean isAdHocGroup() {\n      * @return boolean\n      */\n     private boolean isStandalonePlayer() {\n-        return getCurrentZoneGroup() != null ? getCurrentZoneGroup().getMembers().size() == 1 : true;\n+        SonosZoneGroup zoneGroup = getCurrentZoneGroup();\n+        return zoneGroup != null ? zoneGroup.getMembers().size() == 1 : true;", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4NTg4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433785885", "bodyText": "Agree", "author": "lolodomo", "createdAt": "2020-06-02T10:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzODYzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzOTY2MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r433439661", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            resultString = new String();\n          \n          \n            \n                                            resultString = \"\";\n          \n      \n    \n    \n  \n\nI do find it strange that this field is only initialized here when later code uses it in a possibly uninitialized state.", "author": "cpmeister", "createdAt": "2020-06-01T19:24:01Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -1068,20 +1098,18 @@ else if (isPlayingStream(currentURI) || isPlayingRadioStartedByAmazonEcho(curren\n                         if (response != null) {\n                             List<String> fields = SonosXMLParser.getRadioTimeFromXML(response);\n \n-                            if (fields != null && !fields.isEmpty()) {\n+                            if (!fields.isEmpty()) {\n                                 opmlUrlSucceeded = true;\n \n                                 resultString = new String();", "originalCommit": "3934e0e2d4e3c90a433ade6ac6789f5a6fa0aeaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MTk5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436251991", "bodyText": "Changed to \"\".\nresultString is initialized to null, this is expected, the idea is to triger a change only when this is really expected.", "author": "lolodomo", "createdAt": "2020-06-06T08:53:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzOTY2MQ=="}], "type": "inlineReview"}, {"oid": "62a13fbbe7cb514b3adb495bf87e1e24501b58c1", "url": "https://github.com/openhab/openhab-addons/commit/62a13fbbe7cb514b3adb495bf87e1e24501b58c1", "message": "Review comments considered\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T09:01:29Z", "type": "commit"}, {"oid": "faf1d8cbe25f4af57917afda81f04394cbfadc15", "url": "https://github.com/openhab/openhab-addons/commit/faf1d8cbe25f4af57917afda81f04394cbfadc15", "message": "Set default values in the config class\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T09:21:55Z", "type": "commit"}, {"oid": "ba7412801d85d8b97d7d14a406f98d85b63903df", "url": "https://github.com/openhab/openhab-addons/commit/ba7412801d85d8b97d7d14a406f98d85b63903df", "message": "Set a default configuration to avoid useless null checks\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T09:36:06Z", "type": "commit"}, {"oid": "4272c8923bc835aadb352d4e46dfcaba1cd9d2b6", "url": "https://github.com/openhab/openhab-addons/commit/4272c8923bc835aadb352d4e46dfcaba1cd9d2b6", "message": "Suppress Clonable from class SonosZoneGroup\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T10:27:25Z", "type": "commit"}, {"oid": "cb56e1fc3a89f27254ff84afc0edddb613f31683", "url": "https://github.com/openhab/openhab-addons/commit/cb56e1fc3a89f27254ff84afc0edddb613f31683", "message": "Use existing methods to acceed to stateMap\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T11:48:58Z", "type": "commit"}, {"oid": "b1ed076d935dc9276a74e22ec3ac1ebf7b5e0c89", "url": "https://github.com/openhab/openhab-addons/commit/b1ed076d935dc9276a74e22ec3ac1ebf7b5e0c89", "message": "Avoid ternary operator to set a boolean\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T12:11:10Z", "type": "commit"}, {"oid": "b940bf2eab7758acda475c5166afcc435e1dbea0", "url": "https://github.com/openhab/openhab-addons/commit/b940bf2eab7758acda475c5166afcc435e1dbea0", "message": "Simplification\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-06T12:47:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5Nzk2Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436297966", "bodyText": "looks like a nice place for a switch statement on qName", "author": "cpmeister", "createdAt": "2020-06-06T20:22:14Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/SonosXMLParser.java", "diffHunk": "@@ -268,49 +271,54 @@ public static SonosMetaData getMetaDataFromXML(String xml) {\n         }\n \n         @Override\n-        public void startElement(String uri, String localName, String qName, Attributes attributes)\n-                throws SAXException {\n-            if (qName.equals(\"container\") || qName.equals(\"item\")) {\n-                id = attributes.getValue(\"id\");\n-                parentId = attributes.getValue(\"parentID\");\n-            } else if (qName.equals(\"res\")) {\n+        public void startElement(@Nullable String uri, @Nullable String localName, @Nullable String qName,\n+                @Nullable Attributes attributes) throws SAXException {\n+            if ((\"container\".equals(qName) || \"item\".equals(qName))) {", "originalCommit": "b940bf2eab7758acda475c5166afcc435e1dbea0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5ODAwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436298004", "bodyText": "same here", "author": "cpmeister", "createdAt": "2020-06-06T20:22:34Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/SonosXMLParser.java", "diffHunk": "@@ -382,41 +391,44 @@ public void endElement(String uri, String localName, String qName) throws SAXExc\n \n     private static class ResourceMetaDataHandler extends DefaultHandler {\n \n-        private String id;\n-        private String parentId;\n+        private String id = \"\";\n+        private String parentId = \"\";\n         private StringBuilder title = new StringBuilder();\n         private StringBuilder upnpClass = new StringBuilder();\n         private StringBuilder desc = new StringBuilder();\n-        private Element element = null;\n-        private SonosResourceMetaData metaData = null;\n+        private @Nullable Element element;\n+        private @Nullable SonosResourceMetaData metaData;\n \n         ResourceMetaDataHandler() {\n             // shouldn't be used outside of this package.\n         }\n \n         @Override\n-        public void startElement(String uri, String localName, String qName, Attributes attributes)\n-                throws SAXException {\n-            if (qName.equals(\"container\") || qName.equals(\"item\")) {\n-                id = attributes.getValue(\"id\");\n-                parentId = attributes.getValue(\"parentID\");\n-            } else if (qName.equals(\"desc\")) {\n+        public void startElement(@Nullable String uri, @Nullable String localName, @Nullable String qName,\n+                @Nullable Attributes attributes) throws SAXException {\n+            if ((\"container\".equals(qName) || \"item\".equals(qName))) {", "originalCommit": "b940bf2eab7758acda475c5166afcc435e1dbea0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5ODQyMA==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436298420", "bodyText": "If you turn this into a switch statement you could merge the \"Volume\",\"Mute\", and \"Loudness\" cases since they have the same logic.", "author": "cpmeister", "createdAt": "2020-06-06T20:29:32Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/SonosXMLParser.java", "diffHunk": "@@ -788,46 +801,75 @@ public SonosMetaData getMetaData() {\n \n     private static class RenderingControlEventHandler extends DefaultHandler {\n \n-        private final Map<String, String> changes = new HashMap<>();\n+        private final Map<String, @Nullable String> changes = new HashMap<>();\n \n         private boolean getPresetName = false;\n-        private String presetName;\n+        private @Nullable String presetName;\n \n         @Override\n-        public void startElement(String uri, String localName, String qName, Attributes atts) throws SAXException {\n+        public void startElement(@Nullable String uri, @Nullable String localName, @Nullable String qName,\n+                @Nullable Attributes attributes) throws SAXException {\n+            if (qName == null) {\n+                return;\n+            }\n             if (\"Volume\".equals(qName)) {", "originalCommit": "b940bf2eab7758acda475c5166afcc435e1dbea0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5ODY5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436298692", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return new ArrayList<>();\n          \n          \n            \n                        return Collections.emptyList();", "author": "cpmeister", "createdAt": "2020-06-06T20:33:57Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -1329,16 +1327,17 @@ public long getQueueSize() {\n         inputs.put(\"RequestedCount\", Integer.toString(200));\n         inputs.put(\"SortCriteria\", \"\");\n \n-        List<SonosEntry> resultList = null;\n+        Map<String, @Nullable String> result = service.invokeAction(this, \"ContentDirectory\", \"Browse\", inputs);\n \n-        Map<String, String> result = service.invokeAction(this, \"ContentDirectory\", \"Browse\", inputs);\n+        String initialResult = result.get(\"Result\");\n+        if (initialResult == null) {\n+            return new ArrayList<>();", "originalCommit": "b940bf2eab7758acda475c5166afcc435e1dbea0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5ODgzMg==", "url": "https://github.com/openhab/openhab-addons/pull/7821#discussion_r436298832", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (command instanceof IncreaseDecreaseType && command == IncreaseDecreaseType.INCREASE\n          \n          \n            \n                                && currentVolume != null) {\n          \n          \n            \n                            int i = Integer.valueOf(currentVolume);\n          \n          \n            \n                            newValue = String.valueOf(Math.min(100, i + 1));\n          \n          \n            \n                        } else if (command instanceof IncreaseDecreaseType && command == IncreaseDecreaseType.DECREASE\n          \n          \n            \n                                && currentVolume != null) {\n          \n          \n            \n                            int i = Integer.valueOf(currentVolume);\n          \n          \n            \n                            newValue = String.valueOf(Math.max(0, i - 1));\n          \n          \n            \n                        } else if (command instanceof OnOffType && command == OnOffType.ON) {\n          \n          \n            \n                            newValue = \"100\";\n          \n          \n            \n                        } else if (command instanceof OnOffType && command == OnOffType.OFF) {\n          \n          \n            \n                        if (command == IncreaseDecreaseType.INCREASE\n          \n          \n            \n                                && currentVolume != null) {\n          \n          \n            \n                            int i = Integer.valueOf(currentVolume);\n          \n          \n            \n                            newValue = String.valueOf(Math.min(100, i + 1));\n          \n          \n            \n                        } else if (command == IncreaseDecreaseType.DECREASE\n          \n          \n            \n                                && currentVolume != null) {\n          \n          \n            \n                            int i = Integer.valueOf(currentVolume);\n          \n          \n            \n                            newValue = String.valueOf(Math.max(0, i - 1));\n          \n          \n            \n                        } else if (command == OnOffType.ON) {\n          \n          \n            \n                            newValue = \"100\";\n          \n          \n            \n                        } else if (command == OnOffType.OFF) {", "author": "cpmeister", "createdAt": "2020-06-06T20:35:51Z", "path": "bundles/org.openhab.binding.sonos/src/main/java/org/openhab/binding/sonos/internal/handler/ZonePlayerHandler.java", "diffHunk": "@@ -1530,49 +1536,48 @@ protected void restoreState() {\n     }\n \n     public void saveQueue(String name, String queueID) {\n-        if (name != null && queueID != null) {\n-            Map<String, String> inputs = new HashMap<>();\n-            inputs.put(\"Title\", name);\n-            inputs.put(\"ObjectID\", queueID);\n+        Map<String, String> inputs = new HashMap<>();\n+        inputs.put(\"Title\", name);\n+        inputs.put(\"ObjectID\", queueID);\n \n-            Map<String, String> result = service.invokeAction(this, \"AVTransport\", \"SaveQueue\", inputs);\n+        Map<String, String> result = service.invokeAction(this, \"AVTransport\", \"SaveQueue\", inputs);\n \n-            for (String variable : result.keySet()) {\n-                this.onValueReceived(variable, result.get(variable), \"AVTransport\");\n-            }\n+        for (String variable : result.keySet()) {\n+            this.onValueReceived(variable, result.get(variable), \"AVTransport\");\n         }\n     }\n \n     public void setVolume(Command command) {\n-        if (command != null) {\n-            if (command instanceof OnOffType || command instanceof IncreaseDecreaseType\n-                    || command instanceof DecimalType || command instanceof PercentType) {\n-                Map<String, String> inputs = new HashMap<>();\n-\n-                String newValue = null;\n-                if (command instanceof IncreaseDecreaseType && command == IncreaseDecreaseType.INCREASE) {\n-                    int i = Integer.valueOf(this.getVolume());\n-                    newValue = String.valueOf(Math.min(100, i + 1));\n-                } else if (command instanceof IncreaseDecreaseType && command == IncreaseDecreaseType.DECREASE) {\n-                    int i = Integer.valueOf(this.getVolume());\n-                    newValue = String.valueOf(Math.max(0, i - 1));\n-                } else if (command instanceof OnOffType && command == OnOffType.ON) {\n-                    newValue = \"100\";\n-                } else if (command instanceof OnOffType && command == OnOffType.OFF) {\n-                    newValue = \"0\";\n-                } else if (command instanceof DecimalType) {\n-                    newValue = String.valueOf(((DecimalType) command).intValue());\n-                } else {\n-                    return;\n-                }\n-                inputs.put(\"Channel\", \"Master\");\n-                inputs.put(\"DesiredVolume\", newValue);\n+        if (command instanceof OnOffType || command instanceof IncreaseDecreaseType || command instanceof DecimalType\n+                || command instanceof PercentType) {\n+            Map<String, String> inputs = new HashMap<>();\n+\n+            String newValue = null;\n+            String currentVolume = getVolume();\n+            if (command instanceof IncreaseDecreaseType && command == IncreaseDecreaseType.INCREASE\n+                    && currentVolume != null) {\n+                int i = Integer.valueOf(currentVolume);\n+                newValue = String.valueOf(Math.min(100, i + 1));\n+            } else if (command instanceof IncreaseDecreaseType && command == IncreaseDecreaseType.DECREASE\n+                    && currentVolume != null) {\n+                int i = Integer.valueOf(currentVolume);\n+                newValue = String.valueOf(Math.max(0, i - 1));\n+            } else if (command instanceof OnOffType && command == OnOffType.ON) {\n+                newValue = \"100\";\n+            } else if (command instanceof OnOffType && command == OnOffType.OFF) {", "originalCommit": "b940bf2eab7758acda475c5166afcc435e1dbea0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f6973de28a120f82a0d176955041250dc3d5caf2", "url": "https://github.com/openhab/openhab-addons/commit/f6973de28a120f82a0d176955041250dc3d5caf2", "message": "Review comments about switch case and instanceof\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-08T07:45:06Z", "type": "commit"}]}