{"pr_number": 7411, "pr_title": "[hueemulation] Fixes HueEmulation DiscoveryIp not used", "pr_createdAt": "2020-04-18T15:42:36Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7411", "timeline": [{"oid": "3c20d1426916e25024b09da6f287f0b244a53501", "url": "https://github.com/openhab/openhab-addons/commit/3c20d1426916e25024b09da6f287f0b244a53501", "message": "Fixes HueEmulation DiscoveryIp not used\n\nNon uniform parameter naming prevented config param from being saved\nand used for discovery.\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-18T15:43:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDYwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410724606", "bodyText": "I think the fix should be the other way around. The config field name should be updated instead. This config is only supposed to handle a single IP address right?", "author": "cpmeister", "createdAt": "2020-04-18T17:14:12Z", "path": "bundles/org.openhab.io.hueemulation/src/main/resources/ESH-INF/config/config.xml", "diffHunk": "@@ -51,7 +51,7 @@\n \t\t\t<description>All items that are tagged with the given tags are ignore by the Hue Emulation Service. Use commas to separate multiple entries.</description>\n \t\t\t<default>internal</default>\n \t\t</parameter>\n-\t\t<parameter name=\"discoveryIp\" type=\"text\" required=\"false\">\n+\t\t<parameter name=\"discoveryIps\" type=\"text\" required=\"false\">", "originalCommit": "3c20d1426916e25024b09da6f287f0b244a53501", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDcyNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410724725", "bodyText": "Also, changing this would not be backwards compatible for people already using the binding", "author": "cpmeister", "createdAt": "2020-04-18T17:15:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDYwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MjY2Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410742663", "bodyText": "No, the code is able to handle multiple IPs (ConfigStore.java):\n        if (config.discoveryIps != null) {\n            discoveryIps = Collections.unmodifiableSet(Stream.of(config.discoveryIps.split(\",\")).map(String::trim)\n                    .map(this::byName).filter(e -> e != null).collect(Collectors.toSet()));\n\nit is also documented as such:\nREADME.md\n\nThis option allows you to override what addresses are used for the announcement.\nYou can have multiple comma separated entries.\norg.openhab.hueemulation:discoveryIps=192.168.1.100,::FFFF:A9DB:0D85\n\n\nThere is also code in UpnpServer dealing with multiple IPs.\nI personally feel not confident reverting it back to a single ip usage as there is some code evolved in the background where I dont really understand what it does. I try though to figure out how to make a fallback read so the old value is not lost.", "author": "tfelix", "createdAt": "2020-04-18T19:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDYwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MzI4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410743282", "bodyText": "If it was designed to support multiple IPs then you can keep that feature. It just wasn't clear from either the param name or the description that a comma-separated list was supported. I only suggested changing the config field because I though it only supported a single IP address.", "author": "cpmeister", "createdAt": "2020-04-18T19:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDYwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MzU2OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410743569", "bodyText": "Indeed the text inside the field does not make this clear. I also just saw it when I looked into the code (and the services readme). I am not sure if the text facing the user should be changed as well. What do you say?", "author": "tfelix", "createdAt": "2020-04-18T19:58:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDYwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MzY5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410743695", "bodyText": "Yes, please update the description to make this clear.", "author": "cpmeister", "createdAt": "2020-04-18T19:59:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNDYwNg=="}], "type": "inlineReview"}, {"oid": "f284960642c76dbe015ad1a7d1b3c8759077abf5", "url": "https://github.com/openhab/openhab-addons/commit/f284960642c76dbe015ad1a7d1b3c8759077abf5", "message": "Adds backwards compatibility for old config key\n\nTries to extract the old non plural s key  from the config as\na fallback.\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-18T19:53:19Z", "type": "forcePushed"}, {"oid": "e02395a2bb9d48e2a0cfa8ba91a19b628d6cb2f8", "url": "https://github.com/openhab/openhab-addons/commit/e02395a2bb9d48e2a0cfa8ba91a19b628d6cb2f8", "message": "Fixes HueEmulation DiscoveryIp not used\n\nNon uniform parameter naming prevented config param from being saved\nand used for discovery.\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-18T20:06:20Z", "type": "commit"}, {"oid": "35ebce63394b0781aefe0826cceacf681d24190e", "url": "https://github.com/openhab/openhab-addons/commit/35ebce63394b0781aefe0826cceacf681d24190e", "message": "Adds backwards compatibility for old config key\n\nTries to extract the old non plural s key  from the config as\na fallback.\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-18T20:06:20Z", "type": "commit"}, {"oid": "35ebce63394b0781aefe0826cceacf681d24190e", "url": "https://github.com/openhab/openhab-addons/commit/35ebce63394b0781aefe0826cceacf681d24190e", "message": "Adds backwards compatibility for old config key\n\nTries to extract the old non plural s key  from the config as\na fallback.\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-18T20:06:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1MjA2MA==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410752060", "bodyText": "I think you should change this back and just change the field name in the HueEmulationConfig.\nYou can keep the the description change though.", "author": "cpmeister", "createdAt": "2020-04-18T21:17:59Z", "path": "bundles/org.openhab.io.hueemulation/src/main/resources/ESH-INF/config/config.xml", "diffHunk": "@@ -51,9 +51,9 @@\n \t\t\t<description>All items that are tagged with the given tags are ignore by the Hue Emulation Service. Use commas to separate multiple entries.</description>\n \t\t\t<default>internal</default>\n \t\t</parameter>\n-\t\t<parameter name=\"discoveryIp\" type=\"text\" required=\"false\">\n+\t\t<parameter name=\"discoveryIps\" type=\"text\" required=\"false\">", "originalCommit": "35ebce63394b0781aefe0826cceacf681d24190e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg3NzA3MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r410877071", "bodyText": "But if I change it back then the requests to the backend once again will be PUT'ed to the backend as discoveryIp. Is this acceptable as this does not match well the README docs? However changing it here to Ips probably does not fill in the value for the users where it is already saved as discoveryIp. Probably ur right. Have to look into it in the evening for this change.", "author": "tfelix", "createdAt": "2020-04-19T10:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1MjA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1NTIzNA==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r413255234", "bodyText": "Changing the config parameter name here would break backwards compatibility by forcing users to recreate their things. All you need to do is update the field name in the code and everything should work correctly for existing users. You don't need to keep the old field name in the config code since it was wrong to begin with and thus was never used.", "author": "cpmeister", "createdAt": "2020-04-22T19:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1MjA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA0ODc0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r415048742", "bodyText": "done", "author": "tfelix", "createdAt": "2020-04-25T12:02:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1MjA2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1NTc2MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7411#discussion_r413255761", "bodyText": "You should be renaming this field instead of creating another one.", "author": "cpmeister", "createdAt": "2020-04-22T19:22:25Z", "path": "bundles/org.openhab.io.hueemulation/src/main/java/org/openhab/io/hueemulation/internal/HueEmulationConfig.java", "diffHunk": "@@ -39,6 +39,12 @@\n     /** Pairing timeout in seconds */\n     public int pairingTimeout = 60;\n     public @Nullable String discoveryIps;", "originalCommit": "35ebce63394b0781aefe0826cceacf681d24190e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91854aedc55438ffecbde64b1d56a7264b974ea4", "url": "https://github.com/openhab/openhab-addons/commit/91854aedc55438ffecbde64b1d56a7264b974ea4", "message": "Reverts property change to preserve compatibility\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-25T11:41:38Z", "type": "commit"}, {"oid": "91854aedc55438ffecbde64b1d56a7264b974ea4", "url": "https://github.com/openhab/openhab-addons/commit/91854aedc55438ffecbde64b1d56a7264b974ea4", "message": "Reverts property change to preserve compatibility\n\nSigned-off-by: Thomas Felix <thomas.felix@tfelix.de>", "committedDate": "2020-04-25T11:41:38Z", "type": "forcePushed"}]}