{"pr_number": 8180, "pr_title": "[telegram] Added support for long polling", "pr_createdAt": "2020-07-23T18:27:48Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8180", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NzgyMA==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460697820", "bodyText": "Why is the parameter set to \"required\"? I don't think this is necessary (since we also have a default value) and I think we would have issues with backward compatibility (an update of the Telegram component would break an existing configuration).", "author": "ZzetT", "createdAt": "2020-07-27T07:31:38Z", "path": "bundles/org.openhab.binding.telegram/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -55,6 +56,11 @@\n \t\t\t\t<default>SOCKS5</default>\n \t\t\t\t<description>Enter your proxy type. Default: SOCKS5</description>\n \t\t\t</parameter>\n+\t\t\t<parameter name=\"longPollingTime\" type=\"integer\" required=\"true\" min=\"0\" max=\"50\" unit=\"s\">", "originalCommit": "307feb149b7364d0c3363171ea7ece0d44b8b3e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NzcyMg==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460997722", "bodyText": "Good idea. I will fix it.", "author": "EvilPingu", "createdAt": "2020-07-27T16:00:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NzgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5ODY1Mw==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460698653", "bodyText": "Do these line brakes happen when you run make or are they related to your editor? (same with pom.xml)", "author": "ZzetT", "createdAt": "2020-07-27T07:33:22Z", "path": "bundles/org.openhab.binding.telegram/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -25,7 +25,8 @@\n \t\t\t</parameter>\n \t\t\t<parameter name=\"chatIds\" type=\"text\" required=\"true\" multiple=\"true\">\n \t\t\t\t<label>Chat Id(s)</label>\n-\t\t\t\t<description>One or more chat id(s). Access modifiers (\"&lt;\" for inbound only, \"&gt;\" for outbound only) can be used as prefix (optional).</description>\n+\t\t\t\t<description>One or more chat id(s). Access modifiers (\"&lt;\" for inbound only, \"&gt;\" for outbound only) can be\n+\t\t\t\t\tused as prefix (optional).</description>", "originalCommit": "307feb149b7364d0c3363171ea7ece0d44b8b3e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NjY3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460996677", "bodyText": "This happens when i run mvn spotless:apply -pl :org.openhab.binding.telegram", "author": "EvilPingu", "createdAt": "2020-07-27T15:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5ODY1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDk5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460704992", "bodyText": "It's a good idea to move code blocks to a new separate methods. The only thing that I don't like now is that this method has side effects (adding elements to a list which is a class members). Whereas for the initialize method it is quite clear that it's only called once or if it is called more often, the lists are cleared beforehand. Now, you need a very implicit knowledge on that new method at what point in time this method shall be called and how often.\nThe best way would be to remove the side effect, make it static and to just return the result. However, returning two lists is also a bit ugly (e.g. using the Pair<> class).\nOr maybe we should at least move the authorizedSenderChatId.clear(); receiverChatId.clear(); to that method too so that the result of the method is always the same (no matter when and how often it is called). What is your opinion?", "author": "ZzetT", "createdAt": "2020-07-27T07:45:55Z", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -196,7 +183,34 @@ public void initialize() {\n         updateStatus(ThingStatus.UNKNOWN);\n         delayThingOnlineStatus();\n         TelegramBot localBot = bot = new TelegramBot.Builder(botToken).okHttpClient(botLibClient).build();\n-        localBot.setUpdatesListener(this::handleUpdates, this::handleExceptions);\n+        localBot.setUpdatesListener(this::handleUpdates, this::handleExceptions,\n+                getGetUpdatesRequest(config.getLongPollingTime()));\n+    }\n+\n+    private void createReceiverChatIdsAndAuthorizedSenderChatIds(List<String> chatIds) {", "originalCommit": "307feb149b7364d0c3363171ea7ece0d44b8b3e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2MTU4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r461061582", "bodyText": "Of course, you're right. I have to move the clear-Methode into the new method. The the new method is deterministic.", "author": "EvilPingu", "createdAt": "2020-07-27T17:45:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDk5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MjU5MA==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r462252590", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | `longPollingTime`       |  25     | No       | TimeSpan for long polling the telegram API                                                   |\n          \n          \n            \n            | `longPollingTime`       |  25     | No       | Timespan for long polling the telegram API                                                   |", "author": "Hilbrand", "createdAt": "2020-07-29T12:15:05Z", "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -61,11 +62,14 @@ In order to send a message, an action must be used instead.\n | `proxyHost`             |  None   | No       | Proxy host for telegram binding.                                                             |\n | `proxyPort`             |  None   | No       | Proxy port for telegram binding.                                                             |\n | `proxyType`             |  SOCKS5 | No       | Type of proxy server for telegram binding (SOCKS5 or HTTP). Default: SOCKS5                  |\n+| `longPollingTime`       |  25     | No       | TimeSpan for long polling the telegram API                                                   |", "originalCommit": "84a57b952525b20f5e463a988d082b21c620a974", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ2MzM4OA==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r462463388", "bodyText": "I fixed it.", "author": "EvilPingu", "createdAt": "2020-07-29T17:23:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MjU5MA=="}], "type": "inlineReview"}, {"oid": "f7d85877b335497d62dee9f2ff42410149b7f680", "url": "https://github.com/openhab/openhab-addons/commit/f7d85877b335497d62dee9f2ff42410149b7f680", "message": "add long polling\n\nSigned-off-by: Christian Kittel <ckittel@gmx.de>", "committedDate": "2020-07-29T17:30:17Z", "type": "commit"}]}