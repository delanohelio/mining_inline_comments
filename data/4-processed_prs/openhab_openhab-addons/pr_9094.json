{"pr_number": 9094, "pr_title": "[yioremote] Make the Binding compatible to new firmware version of YIO Dock", "pr_createdAt": "2020-11-21T20:20:59Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9094", "timeline": [{"oid": "596e8308e4365465d7b8d74e34bd2974f7fc5916", "url": "https://github.com/openhab/openhab-addons/commit/596e8308e4365465d7b8d74e34bd2974f7fc5916", "message": "Make the Binding compatible to new firmware version of YIO Dock\n\nSign Off Michael Loercher <michaelloercher\n\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>", "committedDate": "2020-11-21T20:29:41Z", "type": "commit"}, {"oid": "7d6917ea31a85c520ec071ffd8a580534e83b8c0", "url": "https://github.com/openhab/openhab-addons/commit/7d6917ea31a85c520ec071ffd8a580534e83b8c0", "message": "removed senseles debug\n\nSigned-off-by: Michael Loercher<MichaelLoercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>", "committedDate": "2020-11-21T21:26:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzYxNg==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528247616", "bodyText": "Why is this file changed?", "author": "cpmeister", "createdAt": "2020-11-21T21:59:33Z", "path": "bundles/org.openhab.binding.teleinfo/src/test/resources/cbetm-base-option-1.raw", "diffHunk": "@@ -1,19 +1,19 @@\n-MOTDETAT 000000 B\n-\u0003\u0002\n-ADCO XXXXXXXXXXXX 7\n-OPTARIF BASE 0\n-ISOUSC 20 8\n-BASE 001181243 _\n-PTEC TH.. $\n-IINST1 000 H\n-IINST2 002 K\n-IINST3 000 J\n-IMAX1 026 8\n-IMAX2 018 :\n-IMAX3 027 ;\n-PMAX 07990 ?\n-PAPP 00540 *\n-MOTDETAT 400000 F\n-PPOT 00 #\u0002\n-\u0003\u0002\n+MOTDETAT 000000 B\r", "originalCommit": "7d6917ea31a85c520ec071ffd8a580534e83b8c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0Nzk4OA==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528247988", "bodyText": "Sorey don't know why.....how can I take it back?", "author": "miloit", "createdAt": "2020-11-21T22:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI1MjkyOQ==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528252929", "bodyText": "revert to origin", "author": "miloit", "createdAt": "2020-11-21T22:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzY1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528247659", "bodyText": "this one too", "author": "cpmeister", "createdAt": "2020-11-21T21:59:57Z", "path": "bundles/org.openhab.binding.teleinfo/src/test/resources/cbetm-ejp-option-1.raw", "diffHunk": "@@ -1,20 +1,20 @@\n-MOTDETAT 000000 B\n-\u0003\u0002\n-ADCO XXXXXXXXXX G\n-OPTARIF EJP. \"\n-ISOUSC 30 9\n-EJPHN 001111111 ,\n-EJPHPM 002222222 B\n-PTEC HN.. ^\n-IINST1 010 I\n-IINST2 005 N\n-IINST3 008 R\n-IMAX1 038 ;\n-IMAX2 042 7\n-IMAX3 044 :\n-PMAX 17480 :\n-PAPP 05800 .\n-MOTDETAT 000000 B\n-PPOT 00 #\u0002\n-\u0003\u0002\n+MOTDETAT 000000 B\r", "originalCommit": "7d6917ea31a85c520ec071ffd8a580534e83b8c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0ODAwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528248005", "bodyText": "Sorry don't know why.....how can I take it back?", "author": "miloit", "createdAt": "2020-11-21T22:03:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI1MjkxNg==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528252916", "bodyText": "revert to origin", "author": "miloit", "createdAt": "2020-11-21T22:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzY1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NDk4OA==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528964988", "bodyText": "Please remove this file from this PR.", "author": "cpmeister", "createdAt": "2020-11-23T20:05:42Z", "path": "bundles/org.openhab.binding.yioremote/.classpath", "diffHunk": "@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<classpath>\n+\t<classpathentry kind=\"src\" output=\"target/classes\" path=\"src/main/java\">", "originalCommit": "64aaca92bced592e65b0c2aa995338437bba872e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NDQ5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528984493", "bodyText": "How can I do this???", "author": "miloit", "createdAt": "2020-11-23T20:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NDk4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NDU3MA==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528994570", "bodyText": "removed", "author": "miloit", "createdAt": "2020-11-23T21:04:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NDk4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NjAwMw==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528966003", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    JsonObject pingMessage = new JsonObject();\n          \n          \n            \n                    pingMessage.addProperty(\"type\", type);\n          \n          \n            \n                    pingMessage.addProperty(\"command\", command);\n          \n          \n            \n                    return pingMessage.toString();\n          \n          \n            \n                    return getPingMessageJsonObject().toString();", "author": "cpmeister", "createdAt": "2020-11-23T20:07:44Z", "path": "bundles/org.openhab.binding.yioremote/src/main/java/org/openhab/binding/yioremote/internal/dto/PingMessage.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yioremote.internal.dto;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * The {@link PingMessage} the AuthenticationMessage DTO\n+ *\n+ *\n+ * @author Michael Loercher - Initial contribution\n+ */\n+@NonNullByDefault\n+public class PingMessage {\n+    private String type = \"dock\";\n+    private String command = \"ping\";\n+\n+    public String getType() {\n+        return type;\n+    }\n+\n+    public String getcommand() {\n+        return command;\n+    }\n+\n+    public void setToken(String command) {\n+        this.command = command;\n+    }\n+\n+    public JsonObject getPingMessageJsonObject() {\n+        JsonObject pingMessage = new JsonObject();\n+        pingMessage.addProperty(\"type\", type);\n+        pingMessage.addProperty(\"command\", command);\n+        return pingMessage;\n+    }\n+\n+    public String getPingMessageString() {\n+        JsonObject pingMessage = new JsonObject();\n+        pingMessage.addProperty(\"type\", type);\n+        pingMessage.addProperty(\"command\", command);\n+        return pingMessage.toString();", "originalCommit": "64aaca92bced592e65b0c2aa995338437bba872e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NjEyMg==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528986122", "bodyText": "done", "author": "miloit", "createdAt": "2020-11-23T20:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NjAwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NzU2OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528967569", "bodyText": "resetHeartbeat() always returns true now, so this code will never get called anymore...", "author": "cpmeister", "createdAt": "2020-11-23T20:10:46Z", "path": "bundles/org.openhab.binding.yioremote/src/main/java/org/openhab/binding/yioremote/internal/YIOremoteDockHandler.java", "diffHunk": "@@ -337,11 +337,30 @@ private void disposeWebsocketPollingJob() {\n     private void pollingWebsocketJob() {\n         switch (yioRemoteDockActualStatus) {\n             case AUTHENTICATION_COMPLETE:\n-                if (getAndResetHeartbeat()) {\n-                    updateChannelString(GROUP_OUTPUT, STATUS_STRING_CHANNEL,\n-                            irCodeReceivedHandler.getCode() + irCodeReceivedHandler.getFormat());\n-                    logger.debug(\"heartBeat ok\");\n+                if (resetHeartbeat()) {\n                     sendMessage(YioRemoteMessages.HEARTBEAT_MESSAGE, \"\");\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.CHECK_PONG;\n+                } else {\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.COMMUNICATION_ERROR;\n+                }\n+                break;\n+            case SEND_PING:\n+                if (resetHeartbeat()) {\n+                    sendMessage(YioRemoteMessages.HEARTBEAT_MESSAGE, \"\");\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.CHECK_PONG;\n+                } else {\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.COMMUNICATION_ERROR;\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"Connection lost no ping from YIO DOCK\");\n+                    disposeWebsocketPollingJob();\n+                    reconnectWebsocket();", "originalCommit": "64aaca92bced592e65b0c2aa995338437bba872e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NzA5MA==", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528987090", "bodyText": "done", "author": "miloit", "createdAt": "2020-11-23T20:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NzU2OQ=="}], "type": "inlineReview"}, {"oid": "c88b9c1b02b0382c69f60e60b1ac689c68b1c462", "url": "https://github.com/openhab/openhab-addons/commit/c88b9c1b02b0382c69f60e60b1ac689c68b1c462", "message": "revert files to origin\n\nSigned-off-by: Michael Loercher <michaelloercher@web.de>", "committedDate": "2020-11-23T20:38:17Z", "type": "commit"}, {"oid": "295d0ffdbd3fa45af068cafde7f3462f42b7d1b3", "url": "https://github.com/openhab/openhab-addons/commit/295d0ffdbd3fa45af068cafde7f3462f42b7d1b3", "message": "changed\n\nSigned-off-by: Michael Loercher <michaelloercher@web.de>", "committedDate": "2020-11-23T20:50:03Z", "type": "commit"}, {"oid": "eab1d1f638183e3175ed2251a85f6dbddec06fb9", "url": "https://github.com/openhab/openhab-addons/commit/eab1d1f638183e3175ed2251a85f6dbddec06fb9", "message": "Delete .classpath\n\nSigned-off-by: Michael Loercher <michaelloercher@web.de>", "committedDate": "2020-11-23T20:58:40Z", "type": "commit"}, {"oid": "fce356a362d2092289717693e256e1826765186c", "url": "https://github.com/openhab/openhab-addons/commit/fce356a362d2092289717693e256e1826765186c", "message": "changes for easier read\n\nSigned-off-by: Michael Loercher<michaelloercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>", "committedDate": "2020-11-23T21:03:31Z", "type": "commit"}, {"oid": "9abb4d31dd0193b50c4acb83b141cdb60e1d1c9a", "url": "https://github.com/openhab/openhab-addons/commit/9abb4d31dd0193b50c4acb83b141cdb60e1d1c9a", "message": "Update of code\n\nSigned-off-by: Michael Loercher<michaelloercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>", "committedDate": "2020-11-25T20:44:15Z", "type": "commit"}, {"oid": "ceed1a49d77fc06d2d8abcad89cfa9235c39f763", "url": "https://github.com/openhab/openhab-addons/commit/ceed1a49d77fc06d2d8abcad89cfa9235c39f763", "message": "code updates\n\nSigned-off-by: Michael Loercher<michaelloercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>", "committedDate": "2020-11-25T20:54:37Z", "type": "commit"}]}