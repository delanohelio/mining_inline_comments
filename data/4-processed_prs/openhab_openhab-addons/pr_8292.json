{"pr_number": 8292, "pr_title": "[persistence] addressed deprecation warnings", "pr_createdAt": "2020-08-13T15:19:58Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8292", "timeline": [{"oid": "3e9fb0fab2c912f8b877ec8ecf0f7fe70240d521", "url": "https://github.com/openhab/openhab-addons/commit/3e9fb0fab2c912f8b877ec8ecf0f7fe70240d521", "message": "[persistence] addressed deprecation warnings\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-08-13T15:19:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0MDc4OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8292#discussion_r470040789", "bodyText": "It looks like support for the java.time API was only added in JPA 2.2 whereas the add-on uses OpenJPA 2.4.0 as dependency which is based on the JPA 2.0 spec. So the quick fix is probably to convert the ZDTs to Dates here. The nicest fix would be to upgrade OpenJPA to 3.0.x or 3.1.x which is JPA 2.2. compliant, but I don't know how much work that is. \ud83d\ude09", "author": "wborn", "createdAt": "2020-08-13T15:33:02Z", "path": "bundles/org.openhab.persistence.jpa/src/main/java/org/openhab/persistence/jpa/internal/JpaPersistenceService.java", "diffHunk": "@@ -209,10 +209,10 @@ public void store(Item item, @Nullable String alias) {\n             Query query = em.createQuery(queryString);\n             query.setParameter(\"itemName\", item.getName());\n             if (hasBeginDate) {\n-                query.setParameter(\"beginDate\", filter.getBeginDate());\n+                query.setParameter(\"beginDate\", filter.getBeginDateZoned());", "originalCommit": "3e9fb0fab2c912f8b877ec8ecf0f7fe70240d521", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0NDk3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8292#discussion_r470044979", "bodyText": "Looks like the POM is using multiple versions: \ud83e\udd14\nhttps://github.com/openhab/openhab-addons/blob/master/bundles/org.openhab.persistence.jpa/pom.xml", "author": "wborn", "createdAt": "2020-08-13T15:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0MDc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwNzk0MA==", "url": "https://github.com/openhab/openhab-addons/pull/8292#discussion_r470207940", "bodyText": "Hm, I wasn't aware that we have such an old JPA in place here...\n\nThe nicest fix would be to upgrade OpenJPA to 3.0.x or 3.1.x which is JPA 2.2\n\nHm, do we actually have any active maintainer of this add-on? Or is JPA at all used by people in real life...?\n\nLooks like the POM is using multiple versions\n\nI think it is only different versions for the lib and the build plugin, isn't it?", "author": "kaikreuzer", "createdAt": "2020-08-13T19:50:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0MDc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0ODI4NA==", "url": "https://github.com/openhab/openhab-addons/pull/8292#discussion_r470248284", "bodyText": "I did find an occasional user in some community posts using JPA but no active maintainer.\nThe versions differ but the 2.4.0 version is embedded in the bundle.", "author": "wborn", "createdAt": "2020-08-13T21:06:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0MDc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc5MTI2Mg==", "url": "https://github.com/openhab/openhab-addons/pull/8292#discussion_r479791262", "bodyText": "@wborn I have now changed the code of the JPAPersistenceService to use java.util.Date internally, so that we should be safe.", "author": "kaikreuzer", "createdAt": "2020-08-30T16:48:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0MDc4OQ=="}], "type": "inlineReview"}, {"oid": "a0be7faeed2379f8c73bba9ca94e252b801313f6", "url": "https://github.com/openhab/openhab-addons/commit/a0be7faeed2379f8c73bba9ca94e252b801313f6", "message": "reverted internal JPA code to use java.util.Date\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-08-30T16:47:58Z", "type": "commit"}]}