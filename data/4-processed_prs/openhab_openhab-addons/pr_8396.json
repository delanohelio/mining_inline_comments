{"pr_number": 8396, "pr_title": "[shelly] Add channels device#deviceName, relay#outputName + refactoring", "pr_createdAt": "2020-09-04T16:25:35Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8396", "timeline": [{"oid": "67d9864930854edec2bd546d0fd09184c1fa6fbd", "url": "https://github.com/openhab/openhab-addons/commit/67d9864930854edec2bd546d0fd09184c1fa6fbd", "message": "New channels device#deviceName and relay#channelName; skip button\ntrigger when binding was started; StringUtils replaced by native Java\nstring operations\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-04T15:20:47Z", "type": "commit"}, {"oid": "c62e3346ded2c80f5f3716db0307947df9421a02", "url": "https://github.com/openhab/openhab-addons/commit/c62e3346ded2c80f5f3716db0307947df9421a02", "message": "Apache Commons IOUtils removed\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-04T16:20:41Z", "type": "commit"}, {"oid": "c0f8ebbc351183c4842a65c7979e67487f2e06d0", "url": "https://github.com/openhab/openhab-addons/commit/c0f8ebbc351183c4842a65c7979e67487f2e06d0", "message": "README updated\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-04T20:02:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNzgzMA==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r483937830", "bodyText": "deviceName sounds rather a property than a Channel.", "author": "fwolter", "createdAt": "2020-09-05T10:39:31Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -206,7 +206,8 @@ Every device has a channel group `device` with the following channels:\n \n |Group     |Channel            |Type    |read-only|Description                                                                      |\n |----------|-------------------|--------|---------|---------------------------------------------------------------------------------|\n-|device    |uptime             |Number  |yes      |Number of seconds since the device was powered up                                |\n+|device    |deviceName         |String  |yes      |Device name as configured in the Shelly App                                      |", "originalCommit": "c0f8ebbc351183c4842a65c7979e67487f2e06d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2NTkwMA==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r483965900", "bodyText": "The Shelly App allows to configure a logical device name. This becomes now a channel and can be used in the UI. If users are assigning logical names it makes sense to have them available on the OH side too. Properties can not be accessed by rules.", "author": "markus7017", "createdAt": "2020-09-05T16:29:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNzgzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEwMDgxNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r485100815", "bodyText": "Ok", "author": "fwolter", "createdAt": "2020-09-08T18:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNzgzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODE2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r483938167", "bodyText": "I'm a bit confused about the wording. If I see correctly, you don't mean an openHAB Channel, but something in Shelly what's called \"channel\", too. Is this a property, too? Same for below.", "author": "fwolter", "createdAt": "2020-09-05T10:43:26Z", "path": "bundles/org.openhab.binding.shelly/README.md", "diffHunk": "@@ -330,6 +331,7 @@ Depending on the device type and firmware release channels might be not availabl\n |----------|-------------|---------|---------|---------------------------------------------------------------------------------|\n |relay     |output       |Switch   |r/w      |Controls the relay's output channel (on/off)                                     |\n |          |input        |Switch   |yes      |ON: Input/Button is powered, see General Notes on Channels                       |\n+|          |channelName  |String   |yes      |Logical name of this channel as configured in the Shelly App                    ||", "originalCommit": "c0f8ebbc351183c4842a65c7979e67487f2e06d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2NjAwNA==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r483966004", "bodyText": "Similar to devices the Shelly App allows to assign a sysmbolic name to a relay channel. A 4Pro has 4x2 channels, each one gets it's own name.", "author": "markus7017", "createdAt": "2020-09-05T16:30:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEwMDE2NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r485100165", "bodyText": "Could you point out that a Shelly channel is meant to avoid any confusion?", "author": "fwolter", "createdAt": "2020-09-08T17:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIyMzI2OA==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r485223268", "bodyText": "I could change the channel name to \"outputName\" and the description to\nChanged it to \"Logical name of this relay output as configured in the Shelly App \"\nDoes that work better?", "author": "markus7017", "createdAt": "2020-09-08T22:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM4Nzc1MA==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r485387750", "bodyText": "That sounds better!", "author": "fwolter", "createdAt": "2020-09-09T07:12:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMDY0OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r487030649", "bodyText": "done", "author": "markus7017", "createdAt": "2020-09-11T13:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODM5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r483938395", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    fwDate = ShellyUtils.substringBefore(settings.fw, \"/\");\n          \n          \n            \n                    fwVersion = ShellyUtils.substringBetween(settings.fw, \"/\", \"@\");\n          \n          \n            \n                    fwId = ShellyUtils.substringAfter(settings.fw, \"@\");\n          \n          \n            \n                    fwDate = substringBefore(settings.fw, \"/\");\n          \n          \n            \n                    fwVersion = substringBetween(settings.fw, \"/\", \"@\");\n          \n          \n            \n                    fwId = substringAfter(settings.fw, \"@\");", "author": "fwolter", "createdAt": "2020-09-05T10:45:54Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/api/ShellyDeviceProfile.java", "diffHunk": "@@ -124,9 +119,9 @@ public ShellyDeviceProfile initialize(String thingType, String json) throws Shel\n         mode = !getString(settings.mode).isEmpty() ? getString(settings.mode).toLowerCase() : \"\";\n         hwRev = settings.hwinfo != null ? getString(settings.hwinfo.hwRevision) : \"\";\n         hwBatchId = settings.hwinfo != null ? getString(settings.hwinfo.batchId.toString()) : \"\";\n-        fwDate = getString(StringUtils.substringBefore(settings.fw, \"/\"));\n-        fwVersion = getString(StringUtils.substringBetween(settings.fw, \"/\", \"@\"));\n-        fwId = getString(StringUtils.substringAfter(settings.fw, \"@\"));\n+        fwDate = ShellyUtils.substringBefore(settings.fw, \"/\");\n+        fwVersion = ShellyUtils.substringBetween(settings.fw, \"/\", \"@\");\n+        fwId = ShellyUtils.substringAfter(settings.fw, \"@\");", "originalCommit": "c0f8ebbc351183c4842a65c7979e67487f2e06d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2OTU0Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r483969547", "bodyText": "changed (and all others)", "author": "markus7017", "createdAt": "2020-09-05T17:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzODM5NQ=="}], "type": "inlineReview"}, {"oid": "9d54a6b6ab7475b570d843e36dde7e2bd8b0d4b9", "url": "https://github.com/openhab/openhab-addons/commit/9d54a6b6ab7475b570d843e36dde7e2bd8b0d4b9", "message": "review comments applied\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-05T17:15:29Z", "type": "commit"}, {"oid": "e10f409c930ee7a4df785f00ea069d3ffa2a37ff", "url": "https://github.com/openhab/openhab-addons/commit/e10f409c930ee7a4df785f00ea069d3ffa2a37ff", "message": "fix for substringBetween()\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-07T20:34:45Z", "type": "commit"}, {"oid": "1f5ef347464d8f4e70f48e6528516121d93e968f", "url": "https://github.com/openhab/openhab-addons/commit/1f5ef347464d8f4e70f48e6528516121d93e968f", "message": "Fix for #8431: Handling of UBM for channels autoOn and autoOff\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-08T08:12:14Z", "type": "commit"}, {"oid": "7d72309bed13a7b808c657e08066ac8307461af2", "url": "https://github.com/openhab/openhab-addons/commit/7d72309bed13a7b808c657e08066ac8307461af2", "message": "Need to run \"mvn spotless:apply\" again - strange, those files were not\nmodified with last commit\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-08T08:18:29Z", "type": "commit"}, {"oid": "2fde74e92faade4f1ca34d4bfb1179b21136cb6b", "url": "https://github.com/openhab/openhab-addons/commit/2fde74e92faade4f1ca34d4bfb1179b21136cb6b", "message": "Channel relay#channelName renamed to relay#outputName; channel\ndefinition for Dimmer/Dimmer2 corrected (the is no group status anymore)\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-11T13:03:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5NzI1NA==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r487297254", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            channel-type.shelly.outputName.description = Name des Relais-Ausgangs/Kanals (Konfiguriation innerhalb der Shelly App)\n          \n          \n            \n            channel-type.shelly.outputName.description = Name des Relais-Ausgangs/Kanals (Konfiguration innerhalb der Shelly App)", "author": "fwolter", "createdAt": "2020-09-11T21:23:55Z", "path": "bundles/org.openhab.binding.shelly/src/main/resources/ESH-INF/i18n/shelly_de.properties", "diffHunk": "@@ -361,8 +361,8 @@ thing-type.shelly.shellygas.group.device.description = Informationen zum Ger\n \n \n # channels\n-channel-type.shelly.channelName.label = Kanalname\n-channel-type.shelly.channelName.description = Name des Relais-Kanals (Konfiguriation in der Shelly App)\n+channel-type.shelly.outputName.label = Ausgangsname\n+channel-type.shelly.outputName.description = Name des Relais-Ausgangs/Kanals (Konfiguriation innerhalb der Shelly App)", "originalCommit": "2fde74e92faade4f1ca34d4bfb1179b21136cb6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNTg1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8396#discussion_r487405859", "bodyText": "fixed", "author": "markus7017", "createdAt": "2020-09-12T12:41:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5NzI1NA=="}], "type": "inlineReview"}, {"oid": "1f753dc8427971787888400b89444d6ef50b1ec8", "url": "https://github.com/openhab/openhab-addons/commit/1f753dc8427971787888400b89444d6ef50b1ec8", "message": "Typo fixed\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-09-12T12:41:28Z", "type": "commit"}]}