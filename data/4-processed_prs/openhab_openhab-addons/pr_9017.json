{"pr_number": 9017, "pr_title": "[miio] add support for lumi.curtain.hagl05 Xiaomi youpin Curtain Controller (Wi-Fi)", "pr_createdAt": "2020-11-13T14:00:58Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9017", "timeline": [{"oid": "cc14f2dcf1b9ceb40a794b06d7b5b0dfe49022e2", "url": "https://github.com/openhab/openhab-addons/commit/cc14f2dcf1b9ceb40a794b06d7b5b0dfe49022e2", "message": "[miio] add support for lumi.curtain.hagl05\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-13T13:59:53Z", "type": "commit"}, {"oid": "df4e87235cdf6430cd0d5c035ee27d9d370925f3", "url": "https://github.com/openhab/openhab-addons/commit/df4e87235cdf6430cd0d5c035ee27d9d370925f3", "message": "[miio] improve channel description\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-13T14:07:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NDk1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9017#discussion_r523274959", "bodyText": "How do you know what type of unit is getting returned from the device? Does the device send a string that you parse that has the unit?", "author": "cpmeister", "createdAt": "2020-11-13T22:57:02Z", "path": "bundles/org.openhab.binding.miio/src/main/resources/database/lumi.curtain.hagl05-miot.json", "diffHunk": "@@ -0,0 +1,136 @@\n+{\n+\t\"deviceMapping\": {\n+\t\t\"id\": [\n+\t\t\t\"lumi.curtain.hagl05\"\n+\t\t],\n+\t\t\"propertyMethod\": \"get_properties\",\n+\t\t\"maxProperties\": 1,\n+\t\t\"channels\": [\n+\t\t\t{\n+\t\t\t\t\"property\": \"fault\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 1,\n+\t\t\t\t\"friendlyName\": \"Curtain Fault\",\n+\t\t\t\t\"channel\": \"Fault\",\n+\t\t\t\t\"channelType\": \"miot_uint8\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": []\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"current-position\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 3,\n+\t\t\t\t\"friendlyName\": \"Curtain Position\",\n+\t\t\t\t\"channel\": \"CurrentPosition\",\n+\t\t\t\t\"channelType\": \"miot_uint8\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": []\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"status\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 6,\n+\t\t\t\t\"friendlyName\": \"Curtain Status\",\n+\t\t\t\t\"channel\": \"Status\",\n+\t\t\t\t\"channelType\": \"miot_uint8\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": []\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"target-position\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 7,\n+\t\t\t\t\"friendlyName\": \"Curtain Target Position\",\n+\t\t\t\t\"channel\": \"TargetPosition\",\n+\t\t\t\t\"channelType\": \"miot_uint8\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": [\n+\t\t\t\t\t{\n+\t\t\t\t\t\t\"command\": \"set_properties\",\n+\t\t\t\t\t\t\"parameterType\": \"NUMBER\"\n+\t\t\t\t\t}\n+\t\t\t\t]\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"manual-enabled\",\n+\t\t\t\t\"siid\": 4,\n+\t\t\t\t\"piid\": 1,\n+\t\t\t\t\"friendlyName\": \"Curtain_cfg - Manual Enabled\",\n+\t\t\t\t\"channel\": \"ManualEnabled\",\n+\t\t\t\t\"channelType\": \"miot_int32\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": [\n+\t\t\t\t\t{\n+\t\t\t\t\t\t\"command\": \"set_properties\",\n+\t\t\t\t\t\t\"parameterType\": \"NUMBER\"\n+\t\t\t\t\t}\n+\t\t\t\t]\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"polarity\",\n+\t\t\t\t\"siid\": 4,\n+\t\t\t\t\"piid\": 2,\n+\t\t\t\t\"friendlyName\": \"Curtain_cfg - Polarity\",\n+\t\t\t\t\"channel\": \"Polarity\",\n+\t\t\t\t\"channelType\": \"miot_int32\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": [\n+\t\t\t\t\t{\n+\t\t\t\t\t\t\"command\": \"set_properties\",\n+\t\t\t\t\t\t\"parameterType\": \"NUMBER\"\n+\t\t\t\t\t}\n+\t\t\t\t]\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"pos-limit\",\n+\t\t\t\t\"siid\": 4,\n+\t\t\t\t\"piid\": 3,\n+\t\t\t\t\"friendlyName\": \"Curtain_cfg - Position Limit\",\n+\t\t\t\t\"channel\": \"PosLimit\",\n+\t\t\t\t\"channelType\": \"miot_int32\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": [\n+\t\t\t\t\t{\n+\t\t\t\t\t\t\"command\": \"set_properties\",\n+\t\t\t\t\t\t\"parameterType\": \"NUMBER\"\n+\t\t\t\t\t}\n+\t\t\t\t]\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"en-night-tip-light\",\n+\t\t\t\t\"siid\": 4,\n+\t\t\t\t\"piid\": 4,\n+\t\t\t\t\"friendlyName\": \"Set night tip light\",\n+\t\t\t\t\"channel\": \"EnNightTipLight\",\n+\t\t\t\t\"channelType\": \"miot_int32\",\n+\t\t\t\t\"type\": \"Switch\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": [\n+\t\t\t\t\t{\n+\t\t\t\t\t\t\"command\": \"set_properties\",\n+\t\t\t\t\t\t\"parameterType\": \"NUMBER\"\n+\t\t\t\t\t}\n+\t\t\t\t]\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"run-time\",\n+\t\t\t\t\"siid\": 4,\n+\t\t\t\t\"piid\": 5,\n+\t\t\t\t\"friendlyName\": \"Curtain_cfg - Runtime\",\n+\t\t\t\t\"channel\": \"RunTime\",\n+\t\t\t\t\"channelType\": \"miot_int32\",\n+\t\t\t\t\"type\": \"Number:Time\",", "originalCommit": "df4e87235cdf6430cd0d5c035ee27d9d370925f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc2NTkxNg==", "url": "https://github.com/openhab/openhab-addons/pull/9017#discussion_r523765916", "bodyText": "The spec of the device does not indicate the unit. only indicates: \"value-range\": [0, 255, 1]\nI may just remove the Nuber:Time as most devices this is the run time of the device for the total lifetime which match the int32, but the value range is not really confirming that", "author": "marcelrv", "createdAt": "2020-11-15T14:26:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NDk1OQ=="}], "type": "inlineReview"}, {"oid": "1f0fb2c20229ab6b7bc5b3b825012216976e35e1", "url": "https://github.com/openhab/openhab-addons/commit/1f0fb2c20229ab6b7bc5b3b825012216976e35e1", "message": "[miio] improved mapping for curtain hagl05\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-15T14:38:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNzA1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9017#discussion_r523807059", "bodyText": "Looks like you need to double check the channel types names you are using. I'm sure that others need to be fixed as well.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\"channelType\": \"LumiCurtainHagl05status\",\n          \n          \n            \n            \t\t\t\t\"channelType\": \"LumiCurtainHagl05_status\",", "author": "cpmeister", "createdAt": "2020-11-15T20:10:04Z", "path": "bundles/org.openhab.binding.miio/src/main/resources/database/lumi.curtain.hagl05-miot.json", "diffHunk": "@@ -0,0 +1,202 @@\n+{\n+\t\"deviceMapping\": {\n+\t\t\"id\": [\n+\t\t\t\"lumi.curtain.hagl05\"\n+\t\t],\n+\t\t\"propertyMethod\": \"get_properties\",\n+\t\t\"maxProperties\": 1,\n+\t\t\"channels\": [\n+\t\t\t{\n+\t\t\t\t\"property\": \"fault\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 1,\n+\t\t\t\t\"friendlyName\": \"Curtain - Device Fault\",\n+\t\t\t\t\"channel\": \"fault\",\n+\t\t\t\t\"channelType\": \"LumiCurtainHagl05fault\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": [],\n+\t\t\t\t\"value-list\": [\n+\t\t\t\t\t{\n+\t\t\t\t\t\t\"value\": 0,\n+\t\t\t\t\t\t\"description\": \"No faults\"\n+\t\t\t\t\t}\n+\t\t\t\t],\n+\t\t\t\t\"readmeComment\": \"Value mapping [0\\u003d\\\"No faults\\\"]\"\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"current-position\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 3,\n+\t\t\t\t\"friendlyName\": \"Curtain - Current Position\",\n+\t\t\t\t\"channel\": \"current-position\",\n+\t\t\t\t\"channelType\": \"miot_uint8\",\n+\t\t\t\t\"type\": \"Number\",\n+\t\t\t\t\"refresh\": true,\n+\t\t\t\t\"actions\": []\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\t\"property\": \"status\",\n+\t\t\t\t\"siid\": 2,\n+\t\t\t\t\"piid\": 6,\n+\t\t\t\t\"friendlyName\": \"Curtain - Status\",\n+\t\t\t\t\"channel\": \"status\",\n+\t\t\t\t\"channelType\": \"LumiCurtainHagl05status\",", "originalCommit": "1f0fb2c20229ab6b7bc5b3b825012216976e35e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyMDY1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/9017#discussion_r523820655", "bodyText": "darn, indeed is a bug in my converter utility.\nMade the improvement to have the options from the spec but got indeed mismatch in the types formatting.", "author": "marcelrv", "createdAt": "2020-11-15T22:05:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNzA1OQ=="}], "type": "inlineReview"}, {"oid": "90a8aa052d6477ab4c36ea122bd7312a72414e43", "url": "https://github.com/openhab/openhab-addons/commit/90a8aa052d6477ab4c36ea122bd7312a72414e43", "message": "[miio] fix channelTypes\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-15T21:59:25Z", "type": "commit"}]}