{"pr_number": 7401, "pr_title": "[lgwebos] Delay subscription of channel", "pr_createdAt": "2020-04-17T18:03:29Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7401", "timeline": [{"oid": "9da3527441cc3a637c322af21cff1918c47bdefa", "url": "https://github.com/openhab/openhab-addons/commit/9da3527441cc3a637c322af21cff1918c47bdefa", "message": "Delay subscription of channel. Addresses issue #7243.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>", "committedDate": "2020-04-17T18:00:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxOTc0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7401#discussion_r410419741", "bodyText": "You should call this during dispose() as well.", "author": "cpmeister", "createdAt": "2020-04-17T19:12:41Z", "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/handler/LGWebOSHandler.java", "diffHunk": "@@ -332,10 +333,34 @@ public void postUpdate(String channelId, State state) {\n             updateState(channelId, state);\n         }\n \n-        // channel subscription only works when on livetv app.\n-        if (CHANNEL_APP_LAUNCHER.equals(channelId) && APP_ID_LIVETV.equals(state.toString())) {\n-            channelHandlers.get(CHANNEL_CHANNEL).refreshSubscription(CHANNEL_CHANNEL, this);\n+        // channel subscription only works when livetv app is started,\n+        // therefore we need to slightly delay the subscription\n+        if (CHANNEL_APP_LAUNCHER.equals(channelId)) {\n+            if (APP_ID_LIVETV.equals(state.toString())) {\n+                scheduleChannelSubscriptionJob();\n+            } else {\n+                stopChannelSubscriptionJob();\n+            }\n+        }\n+    }\n+\n+    private void scheduleChannelSubscriptionJob() {\n+        ScheduledFuture<?> job = channelSubscriptionJob;\n+        if (job == null || job.isCancelled()) {\n+            logger.debug(\"Schedule channel subscription job\");\n+            channelSubscriptionJob = scheduler.schedule(\n+                    () -> channelHandlers.get(CHANNEL_CHANNEL).refreshSubscription(CHANNEL_CHANNEL, this),\n+                    CHANNEL_SUBSCRIPTION_DELAY_SECONDS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopChannelSubscriptionJob() {", "originalCommit": "9da3527441cc3a637c322af21cff1918c47bdefa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyOTE0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7401#discussion_r410429142", "bodyText": "very true", "author": "sprehn", "createdAt": "2020-04-17T19:33:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxOTc0MQ=="}], "type": "inlineReview"}, {"oid": "ace67cbec5c206f9199dd13671767965693dceed", "url": "https://github.com/openhab/openhab-addons/commit/ace67cbec5c206f9199dd13671767965693dceed", "message": "Calling stopChannelSubscriptionJob() in dispose()\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>", "committedDate": "2020-04-17T19:32:01Z", "type": "commit"}]}