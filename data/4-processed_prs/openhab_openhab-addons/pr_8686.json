{"pr_number": 8686, "pr_title": "[airvisualnode] Support AirVisual Pro version", "pr_createdAt": "2020-10-07T17:52:11Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8686", "timeline": [{"oid": "f298119751fe05f8ba6ec7647bb8f51d2bcb5069", "url": "https://github.com/openhab/openhab-addons/commit/f298119751fe05f8ba6ec7647bb8f51d2bcb5069", "message": "[airvisualnode] Support AirVisual Pro version\n\nSigned-off-by: Oleg Davydyuk <ilveann@gmail.com>", "committedDate": "2020-10-07T17:50:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA1MTExNA==", "url": "https://github.com/openhab/openhab-addons/pull/8686#discussion_r502051114", "bodyText": "If such channels are only available in certain versions of the device, then you should either make a new thing type or remove these channels during handler initialization for devices that don't support it.\nBut another question I have is whether \"Pro version\" refers to the device model or the protocol used to communicate with the device. If it is only a protocol then why not enable it by default instead of making it configurable? Is there no way to identify which devices support this protocol automatically?", "author": "cpmeister", "createdAt": "2020-10-08T22:39:33Z", "path": "bundles/org.openhab.binding.airvisualnode/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -90,6 +97,20 @@\n \t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"/>\n \t</channel-type>\n \n+\t<channel-type id=\"Pm_10\">\n+\t\t<item-type>Number:Density</item-type>\n+\t\t<label>PM10</label>\n+\t\t<description>PM10 level, \u00b5g/m&#179;(Only in Pro version)</description>\n+\t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"Pm_01\">\n+\t\t<item-type>Number:Density</item-type>\n+\t\t<label>PM0.1</label>\n+\t\t<description>PM0.1 level, \u00b5g/m&#179;(Only in Pro version)</description>\n+\t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"/>\n+\t</channel-type>", "originalCommit": "f298119751fe05f8ba6ec7647bb8f51d2bcb5069", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ5OTk0OA==", "url": "https://github.com/openhab/openhab-addons/pull/8686#discussion_r502499948", "bodyText": "I can't recognize type before providing password and adding thing and can't remove unused channels:\nthing.getChannels().removeIf(channel -> channel.getLabel().equals(\"PM0.1\") || channel.getLabel().equals(\"PM10\"));\n\njava.lang.UnsupportedOperationException: null\n\tat java.util.Collections$UnmodifiableCollection.removeIf(Collections.java:1089) ~[?:?]\n\nBut I remove from config \"isProVersion\" and recognizing it by protocol: if \"measurements\" field in Json is array - then it will be Pro version.", "author": "ilveann", "createdAt": "2020-10-09T15:13:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA1MTExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgwNzczNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8686#discussion_r502807735", "bodyText": "You have to modify channels by calling editThing, do your changes on the thing builder and then call updateThing.", "author": "cpmeister", "createdAt": "2020-10-10T16:31:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA1MTExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzODQxOA==", "url": "https://github.com/openhab/openhab-addons/pull/8686#discussion_r502838418", "bodyText": "done", "author": "ilveann", "createdAt": "2020-10-10T22:20:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA1MTExNA=="}], "type": "inlineReview"}, {"oid": "ddd52591ff966b03e2db734af213f979946f437f", "url": "https://github.com/openhab/openhab-addons/commit/ddd52591ff966b03e2db734af213f979946f437f", "message": "[airvisualnode] Autodetect Pro version\n\nSigned-off-by: Oleg Davydyuk <ilveann@gmail.com>", "committedDate": "2020-10-09T15:03:42Z", "type": "commit"}, {"oid": "3f16b25caa6eabcf8f5e471ca5bbec9d88f914dd", "url": "https://github.com/openhab/openhab-addons/commit/3f16b25caa6eabcf8f5e471ca5bbec9d88f914dd", "message": "[airvisualnode] Remove unused channels\n\nSigned-off-by: Oleg Davydyuk <ilveann@gmail.com>", "committedDate": "2020-10-10T22:18:53Z", "type": "commit"}]}