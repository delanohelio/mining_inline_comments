{"pr_number": 7140, "pr_title": "[itests mqtt.homeassistant] Fixed itests for mqtt.homeassistant", "pr_createdAt": "2020-03-10T04:30:36Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7140", "timeline": [{"oid": "9bfb28bf57215feab2ec3de5960e981b6c1f396d", "url": "https://github.com/openhab/openhab-addons/commit/9bfb28bf57215feab2ec3de5960e981b6c1f396d", "message": "mqtt.homeassistant integration test now runs, and can be debugged in eclipse\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-06T05:57:08Z", "type": "commit"}, {"oid": "9ce3256b0047efb5084b12194f0c3ece305ae829", "url": "https://github.com/openhab/openhab-addons/commit/9ce3256b0047efb5084b12194f0c3ece305ae829", "message": "Fixed detection of changes to itests\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-08T05:07:19Z", "type": "commit"}, {"oid": "04482e6240eec368024e58b207cc777f5fac3dd2", "url": "https://github.com/openhab/openhab-addons/commit/04482e6240eec368024e58b207cc777f5fac3dd2", "message": "updated bndrun with latest bundles\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-08T19:24:52Z", "type": "commit"}, {"oid": "7f3a1179d5bd641641ae4460d94fdcbc8c5ed597", "url": "https://github.com/openhab/openhab-addons/commit/7f3a1179d5bd641641ae4460d94fdcbc8c5ed597", "message": "adding latest pom changes, may back out\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T01:35:40Z", "type": "commit"}, {"oid": "38fbae599813d97a586ae4f041757362523fcd4e", "url": "https://github.com/openhab/openhab-addons/commit/38fbae599813d97a586ae4f041757362523fcd4e", "message": "minimized pom changes\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T02:12:11Z", "type": "commit"}, {"oid": "dc365d814badd1321e1d635d472c4a1b4189de6a", "url": "https://github.com/openhab/openhab-addons/commit/dc365d814badd1321e1d635d472c4a1b4189de6a", "message": "now runs homeassistant itests, and allows debugging in eclipse\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T03:24:47Z", "type": "commit"}, {"oid": "9d5ba6cc0a6b6e06ee29e2702923e23d2f4c0ce9", "url": "https://github.com/openhab/openhab-addons/commit/9d5ba6cc0a6b6e06ee29e2702923e23d2f4c0ce9", "message": "mqtt.homie and mqttembeddedbroker tests now execute, still fail though\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T04:05:29Z", "type": "commit"}, {"oid": "2ee194deee3b77c2719cd85b4ef2fdb9c8176145", "url": "https://github.com/openhab/openhab-addons/commit/2ee194deee3b77c2719cd85b4ef2fdb9c8176145", "message": "commenting out Hue emulation test since failing in JDK11\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T05:16:39Z", "type": "commit"}, {"oid": "bf3967a693e83e10d345e98ad07073edc9d834e6", "url": "https://github.com/openhab/openhab-addons/commit/bf3967a693e83e10d345e98ad07073edc9d834e6", "message": "increased timeout waiting for discovery\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T05:46:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI4MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7140#discussion_r390296281", "bodyText": "Can you extracting the build commands to a function instead of duplicating them 4x?", "author": "wborn", "createdAt": "2020-03-10T13:03:36Z", "path": "buildci.sh", "diffHunk": "@@ -62,11 +62,45 @@ if [[ ! -z \"$CHANGED_DIR\" ]] && [[ -e \"bundles/$CHANGED_DIR\" ]]; then\n     # add the postfix to make sure we actually find the correct itest\n     if [[ -e \"itests/$CHANGED_DIR.tests\" ]]; then\n         echo \"Single addon pull request: Building itest $CHANGED_DIR\"\n-        cd \"itests/$CHANGED_DIR.tests\"\n+        # build the core index project so the OSGI index.xml file is generated in the target directory\n+        # needed for resolving the OSGI bundle wiring later\n+        cd \"bom/openhab-core-index\"\n         mvn clean install -B 2>&1 |\n-\t      stdbuf -o0 grep -vE \"Download(ed|ing) from [a-z.]+: https:\" | # Filter out Download(s)\n-\t      stdbuf -o0 grep -v \"target/code-analysis\" | # filter out some debug code from reporting utility\n-\t      tee -a ${CDIR}/.build.log\n+          stdbuf -o0 grep -vE \"Download(ed|ing) from [a-z.]+: https:\" | # Filter out Download(s)\n+          stdbuf -o0 grep -v \"target/code-analysis\" | # filter out some debug code from reporting utility\n+          tee -a ${CDIR}/.build.log\n+        if [[ $? -ne 0 ]]; then\n+            exit 1\n+        fi\n+         \n+        # build the runtime index project so the OSGI index.xml file is generated in the target directory\n+        # needed for resolving the OSGI bundle wiring later\n+        cd \"../runtime-index\"\n+        mvn clean install -B 2>&1 |", "originalCommit": "bf3967a693e83e10d345e98ad07073edc9d834e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwNTAyNw==", "url": "https://github.com/openhab/openhab-addons/pull/7140#discussion_r390305027", "bodyText": "Or even better use a project list so they are all build in the same reactor using:\n-pl :org.openhab.addons.bom.openhab-core-index,:org.openhab.addons.bom.runtime-index,:org.openhab.addons.bom.test-index\nYou can probably also add :$CHANGED_DIR.tests to that list\nThat way you also don't have to cd into dirs and if the dir layout changes Maven will figure out itself where the projects are.", "author": "wborn", "createdAt": "2020-03-10T13:18:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQxNDgwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7140#discussion_r390414805", "bodyText": "Good point, the -pl flag is a good idea, will switch to that.", "author": "mehoekstra", "createdAt": "2020-03-10T15:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUxMDIzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7140#discussion_r390510233", "bodyText": "I applied the recommended changes, the script now uses the mvn -pl flag.", "author": "mehoekstra", "createdAt": "2020-03-10T18:05:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI4MQ=="}], "type": "inlineReview"}, {"oid": "34f7d79dbbcf12f076455ece0e2a17b34dbba99a", "url": "https://github.com/openhab/openhab-addons/commit/34f7d79dbbcf12f076455ece0e2a17b34dbba99a", "message": "simplified building of *-index projects\n\nSigned-off-by: Ubuntu <ubuntu@ip-172-26-13-6.us-west-2.compute.internal>", "committedDate": "2020-03-10T17:10:06Z", "type": "commit"}, {"oid": "7d4193d3c6d8fb4fe6637cf64dedeb2406601cf7", "url": "https://github.com/openhab/openhab-addons/commit/7d4193d3c6d8fb4fe6637cf64dedeb2406601cf7", "message": "forgot to include clean step in last update to buildci.sh\n\nSigned-off-by: Ubuntu <ubuntu@ip-172-26-13-6.us-west-2.compute.internal>", "committedDate": "2020-03-10T17:24:50Z", "type": "commit"}, {"oid": "11f6e70258d90a75b4644386966c4679dc69260e", "url": "https://github.com/openhab/openhab-addons/commit/11f6e70258d90a75b4644386966c4679dc69260e", "message": "Increasing another timeout a bit more\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T17:40:11Z", "type": "commit"}, {"oid": "11f6e70258d90a75b4644386966c4679dc69260e", "url": "https://github.com/openhab/openhab-addons/commit/11f6e70258d90a75b4644386966c4679dc69260e", "message": "Increasing another timeout a bit more\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T17:40:11Z", "type": "forcePushed"}, {"oid": "5e9c8fd51166e723097b4405ecb97514e0fa65b1", "url": "https://github.com/openhab/openhab-addons/commit/5e9c8fd51166e723097b4405ecb97514e0fa65b1", "message": "Integration tests should pass before they are included as modules\nin the itests/pom.xml file.  This change allows integration tests to\nbe run before they are added to itests/pom.xml, or after they have\nbeen commented out from itests/pom.xml\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-10T20:31:11Z", "type": "commit"}]}