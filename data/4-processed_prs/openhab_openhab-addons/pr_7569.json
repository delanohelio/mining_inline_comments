{"pr_number": 7569, "pr_title": "[somfytahoma] added channel for setting closure and orientation at once", "pr_createdAt": "2020-05-07T21:05:23Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7569", "timeline": [{"oid": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "url": "https://github.com/openhab/openhab-addons/commit/c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "message": "[somfytahoma] added channel for setting closure and orientation at once\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>", "committedDate": "2020-05-04T18:47:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2OTA4NA==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423269084", "bodyText": "Subsubheader? Prefixed by three hashtags and CamelCase?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            REMARKS:\n          \n          \n            \n            ### Remarks:", "author": "cweitkamp", "createdAt": "2020-05-11T19:30:02Z", "path": "bundles/org.openhab.binding.somfytahoma/README.md", "diffHunk": "@@ -60,59 +60,63 @@ Please see the example below.\n \n ## Channels\n \n-| Thing                                                                         |        Channel        | Note                                                                                                             |\n-|-------------------------------------------------------------------------------|:---------------------:|------------------------------------------------------------------------------------------------------------------|\n-| bridge                                                                        |           N.A           | bridge does not expose any channel                                                                               |\n-| gateway                                                                       |          status         | status of your Tahoma gateway                                                                                    |\n-| gate                                                                          |       gate_command      | used for controlling your gate (open, close, stop, pedestrian)                                                   |\n-| gate                                                                          |        gate_state       | get state of your gate                                                                                           |\n-| roller shutter, screen, venetian blind, garage door, awning, pergola, curtain |         control         | device controller which reacts to commands UP/DOWN/ON/OFF/OPEN/CLOSE/MY/STOP + closure 0-100                     |\n-| window                                                                        |         control         | device controller which reacts to commands UP/DOWN/ON/OFF/OPEN/CLOSE/STOP + closure 0-100                        |\n-| silent roller shutter                                                         |      silent_control     | similar to control channel but in silent mode                                                                    |\n-| venetian blind, adjustable slats roller shutter                               |       orientation       | percentual orientation of the blind's slats, it can have value 0-100). For IO Homecontrol devices only (non RTS) |\n-| adjustable slats roller shutter                                               |          rocker         | used for setting the rocker position of the roller shutter, the only position allowing the slats control         |\n-| action group                                                                  |      execute_action     | switch which reacts to ON command and triggers the predefined Tahoma action                                      |\n-| onoff, light                                                                  |          switch         | reacts to standard ON/OFF commands                                                                               |\n-| smoke sensor, occupancy sensor, contact sensor & water sensor                 |         contact         | normal value is CLOSE, changes to OPEN when detection triggered                                                  |\n-| smoke sensor, occupancy sensor, contact sensor & water sensor                 |      sensor_defect      | indicates the health of the sensor (dead, lowBatter, maintenanceRequired, noDefect)                              |\n-| smoke sensor                                                                  |      radio_battery      | maintenance radio part battery state (low, normal)                                                               |\n-| smoke sensor                                                                  |      sensor_battery     | maintenance sensor part battery state (absence, low, normal)                                                     |\n-| smoke sensor                                                                  |       short_check       | triggering the smoke sensor's short check                                                                        |\n-| smoke sensor                                                                  |        long_check       | triggering the smoke sensor's long check                                                                         |\n-| light sensor                                                                  |        luminance        | light luminance value in luxes                                                                                   |\n-| electricity sensor                                                            |    energy_consumption   | energy consumption value in watts                                                                                |\n-| humidity sensor                                                               |         humidity        | current relative humidity                                                                                        |\n-| dock                                                                          |      battery_status     | indicates running on battery (yes/no)                                                                            |\n-| dock                                                                          |      battery_level      | remaining battery percentage                                                                                     |\n-| dock                                                                          |       siren_status      | used for controlling and getting siren state (on, off, cyclic)                                                   |\n-| dock                                                                          |        short_beep       | testing of dock's siren - short beep                                                                             |\n-| dock                                                                          |        long_beep        | testing of dock's siren - long beep                                                                              |\n-| siren                                                                         |         battery         | battery level full/low/normal/verylow                                                                            |\n-| siren                                                                         |          onoff          | controlling siren status ON/OFF                                                                                  |\n-| siren                                                                         |     memorized_volume    | setting memorized volume (normal/highest)                                                                        |\n-| pod                                                                           |      cyclic_button      | pod cyclic button state                                                                                          |\n-| pod                                                                           |      battery_status     | pod battery status state                                                                                         |\n-| pod                                                                           |  lighting_led_pod_mode  | lighting LED pod mod state                                                                                       |\n-| interior alarm                                                                |      alarm_command      | used for sending commands to Somfy alarm device                                                                  |\n-| interior alarm                                                                |    intrusion_control    | used for alarm external intrusion controlling                                                                    |\n-| interior alarm, myfox alarm                                                   |       alarm_state       | state of the Somfy alarm                                                                                         |\n-| interior alarm                                                                |    target_alarm_state   | target state of the Somfy alarm                                                                                  |\n-| interior alarm, myfox alarm                                                   |     intrusion_state     | intrusion state of the Somfy alarm                                                                               |\n-| external alarm                                                                |    active_zones_state   | state of external alarm active zones                                                                             |\n-| door lock                                                                     |           lock          | switch representing unlocked/locked state                                                                        |\n-| door lock                                                                     |           open          | switch representing open/close state                                                                             |\n-| on/off heating system                                                         |   target_heating_level  | target heating level (off, eco, comfort, frostprotection)                                                        |\n-| heating system                                                                |   current_temperature   | current temperature of the heating system                                                                        |\n-| heating system                                                                |      current_state      | current state of the heating system                                                                              |\n-| heating system, thermostat                                                    |    target_temperature   | target temperature of the heating system                                                                         |\n-| heating system, thermostat                                                    |      battery_level      | battery level of the heating system                                                                              |\n-| thermostat                                                                    |       heating_mode      | standard heating mode of the thermostat (away, freeze, manual, ...)                                              |\n-| thermostat                                                                    | derogation_heating_mode | derogation heating mode of the thermostat (away, freeze, manual, ...)                                            |\n-| thermostat                                                                    |  derogation_activation  | derogation activation state (inactive, active)                                                                   |\n-| temperature sensor                                                            |       temperature       | temperature reported by the sensor                                                                               |\n-| myfox camera, myfox alarm                                                     |       cloud_status      | cloud connection status                                                                                          |\n-| myfox camera                                                                  |          shutter        | controlling of the camera shutter                                                                                |\n-| myfox alarm                                                                   |   myfox_alarm_command   | used for sending commands to Somfy Myfox alarm device                                                            |\n+| Thing                                                                         |        Channel        | Note                                                                                                                          |\n+|-------------------------------------------------------------------------------|:---------------------:|-------------------------------------------------------------------------------------------------------------------------------|\n+| bridge                                                                        |           N.A           | bridge does not expose any channel                                                                                          |\n+| gateway                                                                       |          status         | status of your Tahoma gateway                                                                                               |\n+| gate                                                                          |       gate_command      | used for controlling your gate (open, close, stop, pedestrian)                                                              |\n+| gate                                                                          |        gate_state       | get state of your gate                                                                                                      |\n+| roller shutter, screen, venetian blind, garage door, awning, pergola, curtain |         control         | device controller which reacts to commands UP/DOWN/ON/OFF/OPEN/CLOSE/MY/STOP + closure 0-100                                |\n+| window                                                                        |         control         | device controller which reacts to commands UP/DOWN/ON/OFF/OPEN/CLOSE/STOP + closure 0-100                                   |\n+| silent roller shutter                                                         |      silent_control     | similar to control channel but in silent mode                                                                               |\n+| venetian blind, adjustable slats roller shutter                               |       orientation       | percentual orientation of the blind's slats, it can have value 0-100. For IO Homecontrol devices only (non RTS)             |\n+| venetian blind, adjustable slats roller shutter                               |   closure_orientation   | percentual closure and orientation of the blind's slats, it can have value 0-100. For IO Homecontrol devices only (non RTS) |\n+| adjustable slats roller shutter                                               |          rocker         | used for setting the rocker position of the roller shutter, the only position allowing the slats control                    |\n+| action group                                                                  |      execute_action     | switch which reacts to ON command and triggers the predefined Tahoma action                                                 |\n+| onoff, light                                                                  |          switch         | reacts to standard ON/OFF commands                                                                                          |\n+| smoke sensor, occupancy sensor, contact sensor & water sensor                 |         contact         | normal value is CLOSE, changes to OPEN when detection triggered                                                             |\n+| smoke sensor, occupancy sensor, contact sensor & water sensor                 |      sensor_defect      | indicates the health of the sensor (dead, lowBatter, maintenanceRequired, noDefect)                                         |\n+| smoke sensor                                                                  |      radio_battery      | maintenance radio part battery state (low, normal)                                                                          |\n+| smoke sensor                                                                  |      sensor_battery     | maintenance sensor part battery state (absence, low, normal)                                                                |\n+| smoke sensor                                                                  |       short_check       | triggering the smoke sensor's short check                                                                                   |\n+| smoke sensor                                                                  |        long_check       | triggering the smoke sensor's long check                                                                                    |\n+| light sensor                                                                  |        luminance        | light luminance value in luxes                                                                                              |\n+| electricity sensor                                                            |    energy_consumption   | energy consumption value in watts                                                                                           |\n+| humidity sensor                                                               |         humidity        | current relative humidity                                                                                                   |\n+| dock                                                                          |      battery_status     | indicates running on battery (yes/no)                                                                                       |\n+| dock                                                                          |      battery_level      | remaining battery percentage                                                                                                |\n+| dock                                                                          |       siren_status      | used for controlling and getting siren state (on, off, cyclic)                                                              |\n+| dock                                                                          |        short_beep       | testing of dock's siren - short beep                                                                                        |\n+| dock                                                                          |        long_beep        | testing of dock's siren - long beep                                                                                         |\n+| siren                                                                         |         battery         | battery level full/low/normal/verylow                                                                                       |\n+| siren                                                                         |          onoff          | controlling siren status ON/OFF                                                                                             |\n+| siren                                                                         |     memorized_volume    | setting memorized volume (normal/highest)                                                                                   |\n+| pod                                                                           |      cyclic_button      | pod cyclic button state                                                                                                     |\n+| pod                                                                           |      battery_status     | pod battery status state                                                                                                    |\n+| pod                                                                           |  lighting_led_pod_mode  | lighting LED pod mod state                                                                                                  |\n+| interior alarm                                                                |      alarm_command      | used for sending commands to Somfy alarm device                                                                             |\n+| interior alarm                                                                |    intrusion_control    | used for alarm external intrusion controlling                                                                               |\n+| interior alarm, myfox alarm                                                   |       alarm_state       | state of the Somfy alarm                                                                                                    |\n+| interior alarm                                                                |    target_alarm_state   | target state of the Somfy alarm                                                                                             |\n+| interior alarm, myfox alarm                                                   |     intrusion_state     | intrusion state of the Somfy alarm                                                                                          |\n+| external alarm                                                                |    active_zones_state   | state of external alarm active zones                                                                                        |\n+| door lock                                                                     |           lock          | switch representing unlocked/locked state                                                                                   |\n+| door lock                                                                     |           open          | switch representing open/close state                                                                                        |\n+| on/off heating system                                                         |   target_heating_level  | target heating level (off, eco, comfort, frostprotection)                                                                   |\n+| heating system                                                                |   current_temperature   | current temperature of the heating system                                                                                   |\n+| heating system                                                                |      current_state      | current state of the heating system                                                                                         |\n+| heating system, thermostat                                                    |    target_temperature   | target temperature of the heating system                                                                                    |\n+| heating system, thermostat                                                    |      battery_level      | battery level of the heating system                                                                                         |\n+| thermostat                                                                    |       heating_mode      | standard heating mode of the thermostat (away, freeze, manual, ...)                                                         |\n+| thermostat                                                                    | derogation_heating_mode | derogation heating mode of the thermostat (away, freeze, manual, ...)                                                       |\n+| thermostat                                                                    |  derogation_activation  | derogation activation state (inactive, active)                                                                              |\n+| temperature sensor                                                            |       temperature       | temperature reported by the sensor                                                                                          |\n+| myfox camera, myfox alarm                                                     |       cloud_status      | cloud connection status                                                                                                     |\n+| myfox camera                                                                  |          shutter        | controlling of the camera shutter                                                                                           |\n+| myfox alarm                                                                   |   myfox_alarm_command   | used for sending commands to Somfy Myfox alarm device                                                                       |\n+\n+\n+REMARKS:", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NDYyNg==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423284626", "bodyText": "OK", "author": "octa22", "createdAt": "2020-05-11T19:59:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2OTA4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2OTY2NA==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423269664", "bodyText": "Can you remove this examples? We should prefer the second one when sending commands to items.", "author": "cweitkamp", "createdAt": "2020-05-11T19:31:03Z", "path": "bundles/org.openhab.binding.somfytahoma/README.md", "diffHunk": "@@ -124,11 +128,19 @@ When a roller shutter-like thing receives STOP command, there are two possible b\n If you want to set the MY position of a roller shutter and you don't care the possible movement, try sending the MOVE command (OH2 does not know MY, so it stands for \"move to MY position\")\n \n ```\n-sendCommand(ROLLERSHUTTER_THING, MOVE)\n+sendCommand(CONTROL_CHANNEL, MOVE)", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTE3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423285177", "bodyText": "Removed", "author": "octa22", "createdAt": "2020-05-11T20:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2OTY2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MDEwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423270105", "bodyText": "See above.\nPleas add an empty line between text and examples.", "author": "cweitkamp", "createdAt": "2020-05-11T19:31:56Z", "path": "bundles/org.openhab.binding.somfytahoma/README.md", "diffHunk": "@@ -124,11 +128,19 @@ When a roller shutter-like thing receives STOP command, there are two possible b\n If you want to set the MY position of a roller shutter and you don't care the possible movement, try sending the MOVE command (OH2 does not know MY, so it stands for \"move to MY position\")\n \n ```\n-sendCommand(ROLLERSHUTTER_THING, MOVE)\n+sendCommand(CONTROL_CHANNEL, MOVE)\n ```\n or\n ```\n-ROLLERSHUTTER_THING.sendCommand(MOVE)\n+CONTROL_CHANNEL.sendCommand(MOVE)\n+```\n+Blinds and adjustable slats roller shutters can control their closure and orientation by sending a comma separated string consisting of closure (0-100) and orientation (0-100) to the \"closure_orientaion\" channel.\n+```\n+sendCommand(CLOSURE_ORIENTATION_CHANNEL, \u201c50,50\u201d)", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NjI2Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423286266", "bodyText": "Fixed", "author": "octa22", "createdAt": "2020-05-11T20:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MDEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MTIxMg==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423271212", "bodyText": "Please apply the formatter (e.g. by running mvn spotless:apply in the bindings folder).", "author": "cweitkamp", "createdAt": "2020-05-11T19:34:08Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java", "diffHunk": "@@ -87,7 +87,10 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             if (OnOffType.ON.equals(command)) {\n                 sendCommand(COMMAND_SET_ROCKERPOSITION);\n             }\n-        } else {\n+        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n+            String param = \"[\" + command.toString() + \"]\";\n+            sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, param);\n+        }else {", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTgwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423285806", "bodyText": "Applied the formatter", "author": "octa22", "createdAt": "2020-05-11T20:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MTIxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDk1MA==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423274950", "bodyText": "Just for safety: What happens when the user sends \"foobar\" to this channel?", "author": "cweitkamp", "createdAt": "2020-05-11T19:41:32Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java", "diffHunk": "@@ -87,7 +87,10 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             if (OnOffType.ON.equals(command)) {\n                 sendCommand(COMMAND_SET_ROCKERPOSITION);\n             }\n-        } else {\n+        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n+            String param = \"[\" + command.toString() + \"]\";", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NjI0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423296241", "bodyText": "The Tahoma cloud will return an error, that this command expects two parameters.\nI had been thinking about doing a check for two numbers 0-100 separated by a comma, but decided to leave it on the Tahoma at the end...", "author": "octa22", "createdAt": "2020-05-11T20:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NjUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423276533", "bodyText": "Add check for !CLOSURE_AND_ORIENTATION.equals(...) earlier (line 79f).\nOtherwise will a different implementation logic be easier to maintain:\n    public void handleCommand(ChannelUID channelUID, Command command) {\n        super.handleCommand(channelUID, command);\t\n        switch(channelUID.getId()) {\n             case ROCKER:\n                 // TODO\n                 break;\n             case CLOSURE_AND_ORIENTATION:\n                 // TODO\n                 break;\n             ...\n             default:\n                 return;\n        }\n    }", "author": "cweitkamp", "createdAt": "2020-05-11T19:44:37Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java", "diffHunk": "@@ -87,7 +87,10 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             if (OnOffType.ON.equals(command)) {\n                 sendCommand(COMMAND_SET_ROCKERPOSITION);\n             }\n-        } else {\n+        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDAwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423294009", "bodyText": "used the suggested implementation", "author": "octa22", "createdAt": "2020-05-11T20:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NjUzMw=="}], "type": "inlineReview"}, {"oid": "6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "url": "https://github.com/openhab/openhab-addons/commit/6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "message": "[somfytahoma] improvements based on the PR review\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>", "committedDate": "2020-05-11T20:26:34Z", "type": "commit"}]}