{"pr_number": 311, "pr_title": "Set UtcTimestampPrecision in codegenerator", "pr_createdAt": "2020-08-31T11:57:59Z", "pr_url": "https://github.com/quickfix-j/quickfixj/pull/311", "timeline": [{"oid": "4032df86958db4ab9aefe5894710363044880271", "url": "https://github.com/quickfix-j/quickfixj/commit/4032df86958db4ab9aefe5894710363044880271", "message": "ref #310 - Set UtcTimestampPrecision in generator\n\nAdded support for setting a default UtcTimestampPrecision in the\nquickfixj-codegenerator Maven plugin. The default applies to the\nfollowing classes and their generated sub classes.\n- UtcTimeField\n- UtcTimeOnlyField\n- UtcTimeStampField", "committedDate": "2020-08-31T11:51:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEzOTM0Mw==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482139343", "bodyText": "Trivial: I think it should be \"are\".", "author": "the-thing", "createdAt": "2020-09-02T15:01:29Z", "path": "quickfixj-codegenerator/src/main/java/org/quickfixj/codegenerator/MessageCodeGenerator.java", "diffHunk": "@@ -134,6 +142,19 @@ private void generateFieldClasses(Task task) throws ParserConfigurationException\n                     Map<String, String> parameters = new HashMap<>();\n                     parameters.put(\"fieldName\", fieldName);\n                     parameters.put(\"fieldPackage\", task.getFieldPackage());\n+                    String utcTimestampPrecision = task.getUtcTimestampPrecision();\n+                    if (utcTimestampPrecision != null) {\n+                        String utcTimestampPrecisionParameterName = \"utcTimestampPrecision\";\n+                        if (!UTC_TIMESTAMP_PRECISION_ALLOWED_VALUES.contains(utcTimestampPrecision)) {\n+                            throw new CodeGenerationException(new IllegalArgumentException(String.format(\n+                                \"Allowed values for parameter %s is %s. Supplied value: \\\"%s\\\".\",", "originalCommit": "4032df86958db4ab9aefe5894710363044880271", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1NDg2OQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482254869", "bodyText": "Fixed in ce5f595.", "author": "simenflatby", "createdAt": "2020-09-02T17:47:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEzOTM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482141321", "bodyText": "Not sure how often this method is used, but this does not seem correct.", "author": "the-thing", "createdAt": "2020-09-02T15:03:11Z", "path": "quickfixj-codegenerator/src/main/java/org/quickfixj/codegenerator/MessageCodeGenerator.java", "diffHunk": "@@ -447,6 +477,7 @@ public static void main(String[] args) {\n                 task.setMessagePackage(\"quickfix.\" + version.toLowerCase());\n                 task.setOutputBaseDirectory(new File(args[2]));\n                 task.setFieldPackage(\"quickfix.field\");\n+                task.setUtcTimestampPrecision(task.utcTimestampPrecision);", "originalCommit": "4032df86958db4ab9aefe5894710363044880271", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1NjE5OQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482256199", "bodyText": "Hi @the-thing. Can you please elaborate? I did not understand what is wrong here.", "author": "simenflatby", "createdAt": "2020-09-02T17:49:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1ODEwNQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482258105", "bodyText": "Aren't you reassining the same field task.utcTimestampPrecision = task.utcTimestampPrecision?", "author": "the-thing", "createdAt": "2020-09-02T17:53:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1ODY2OA==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482258668", "bodyText": "Ah, I see now that this looks stupid\ud83d\ude02. Sets the value to it self... I'm not familiar with the usage of this main method, so maybe one of you could suggest a solution?", "author": "simenflatby", "createdAt": "2020-09-02T17:54:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1OTg4Mw==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482259883", "bodyText": "I believe this methods is used when you want to run code generation locally from IDE etc.. I would follow the same pattern as e.g. overwrite/orderedFields/useDecimal. Create an option, get an option or default value, set it.", "author": "the-thing", "createdAt": "2020-09-02T17:56:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2MTQwOA==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482261408", "bodyText": "OK. Thank you. I will have a look at it.", "author": "simenflatby", "createdAt": "2020-09-02T17:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2OTQwMg==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482269402", "bodyText": "Suggestion in e1b5bee. Created the getOption(String key, String defaultValue) in case someone want to change the default value to something other than null later. I will check back to see if you have any feedback tomorrow.", "author": "simenflatby", "createdAt": "2020-09-02T18:12:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE0MTMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3OTczNA==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482179734", "bodyText": "Trivial. In the generated classes there is an empty line here. Not sure which xsl part generates this.", "author": "the-thing", "createdAt": "2020-09-02T15:52:10Z", "path": "quickfixj-codegenerator/src/main/resources/org/quickfixj/codegenerator/Fields.xsl", "diffHunk": "@@ -87,6 +95,17 @@ public class <xsl:value-of select=\"@name\"/> extends <xsl:call-template name=\"get\n \t\tsuper(<xsl:value-of select=\"@number\"/>, new <xsl:value-of select=\"$dataType\"/>(data));\n \t}\n \t</xsl:if>\n+\n+    <xsl:choose>\n+        <xsl:when test=\"$utcTimestampPrecision\">\n+            <xsl:if test=\"@type='UTCTIMESTAMP' or @type='UTCTIME' or @type='UTCTIMEONLY'\">\n+    @Override\n+    protected UtcTimestampPrecision getDefaultUtcTimestampPrecision() {\n+        return UtcTimestampPrecision.<xsl:value-of select=\"$utcTimestampPrecision\"/>;\n+    }\n+            </xsl:if>", "originalCommit": "4032df86958db4ab9aefe5894710363044880271", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1NTE4Mg==", "url": "https://github.com/quickfix-j/quickfixj/pull/311#discussion_r482255182", "bodyText": "Fixed in 95c1373.", "author": "simenflatby", "createdAt": "2020-09-02T17:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3OTczNA=="}], "type": "inlineReview"}, {"oid": "ce5f595346c622671dc741ea09c6242ef5a7e81b", "url": "https://github.com/quickfix-j/quickfixj/commit/ce5f595346c622671dc741ea09c6242ef5a7e81b", "message": "ref #310 - Fixed typo: \"is\" -> \"are\"", "committedDate": "2020-09-02T16:17:03Z", "type": "commit"}, {"oid": "95c1373e1968d968e3002751c931d501c3d9c0f3", "url": "https://github.com/quickfix-j/quickfixj/commit/95c1373e1968d968e3002751c931d501c3d9c0f3", "message": "ref #310 - Removes excess empty lines\n\nRemoves excess empty lines from generated files", "committedDate": "2020-09-02T17:33:28Z", "type": "commit"}, {"oid": "e1bb5fc45a007aac7f21d6ebdbf0b3254361228c", "url": "https://github.com/quickfix-j/quickfixj/commit/e1bb5fc45a007aac7f21d6ebdbf0b3254361228c", "message": "ref #310 - Don't use ctor with precision\n\nIt is not nesesary to use the constructor with\nUtcTimestampPrecision. It is set as a default anyways.", "committedDate": "2020-09-02T17:45:15Z", "type": "commit"}, {"oid": "e1b5bee92c8aeb4893e5f5a77936499dc78a7a71", "url": "https://github.com/quickfix-j/quickfixj/commit/e1b5bee92c8aeb4893e5f5a77936499dc78a7a71", "message": "ref #310 - Set precision in main\n\nWhen running main method, Set utcTimestampPrecision to value from\nproperty \"generator.utcTimestampPrecision\", otherwise null.", "committedDate": "2020-09-02T18:08:57Z", "type": "commit"}]}