{"pr_number": 2554, "pr_title": "Support dark mode and dynamic Look and Feel switching", "pr_createdAt": "2020-09-30T10:36:14Z", "pr_url": "https://github.com/zaproxy/zap-extensions/pull/2554", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0NTEwMg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2554#discussion_r497445102", "bodyText": "Since this same code appears 3 times with the only difference being the object it's being applied to maybe just extract a method?", "author": "kingthorin", "createdAt": "2020-09-30T11:45:52Z", "path": "addOns/scripts/src/main/java/org/zaproxy/zap/extension/scripts/CommandPanel.java", "diffHunk": "@@ -94,10 +99,86 @@ private SyntaxHighlightTextArea getTxtOutput() {\n             if (listener != null) {\n                 this.syntaxTxtArea.addKeyListener(listener);\n             }\n+            if (isDarkLaF()) {\n+                darkLaF = true;\n+                try {\n+                    Theme theme =\n+                            Theme.load(\n+                                    HttpPanelSyntaxHighlightTextArea.class.getResourceAsStream(\n+                                            \"/org/fife/ui/rsyntaxtextarea/themes/dark.xml\"));\n+                    theme.apply(this.syntaxTxtArea);\n+                } catch (IOException e) {\n+                    // Ignore\n+                }\n+            } else {\n+                darkLaF = false;\n+            }\n         }\n         return this.syntaxTxtArea;\n     }\n \n+    private Boolean supportsDarkLaF;\n+    private Method isDarkLookAndFeelMethod;\n+    private boolean darkLaF;\n+\n+    private boolean isDarkLaF() {\n+        // TODO Update to calling the DisplayUtils.isDarkLookAndFeel() method directly once it is\n+        // available\n+        if (supportsDarkLaF == null) {\n+            supportsDarkLaF = false;\n+            try {\n+                Class<DisplayUtils> cls = DisplayUtils.class;\n+                isDarkLookAndFeelMethod = cls.getMethod(\"isDarkLookAndFeel\");\n+                if (isDarkLookAndFeelMethod != null) {\n+                    supportsDarkLaF = true;\n+                }\n+            } catch (Exception e) {\n+                // Ignore\n+            }\n+        }\n+        if (isDarkLookAndFeelMethod != null) {\n+            try {\n+                Object obj = isDarkLookAndFeelMethod.invoke(null);\n+                if (obj instanceof Boolean) {\n+                    return (Boolean) obj;\n+                }\n+            } catch (Exception e) {\n+                // Ignore\n+            }\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void updateUI() {\n+        super.updateUI();\n+        if (darkLaF != isDarkLaF()) {\n+            if (isDarkLaF()) {\n+                try {\n+                    Theme theme =\n+                            Theme.load(\n+                                    HttpPanelSyntaxHighlightTextArea.class.getResourceAsStream(\n+                                            \"/org/fife/ui/rsyntaxtextarea/themes/dark.xml\"));\n+                    theme.apply(getTxtOutput());\n+                } catch (IOException e) {\n+                    // Ignore\n+                }\n+                darkLaF = true;\n+            } else {\n+                try {\n+                    Theme theme =\n+                            Theme.load(\n+                                    HttpPanelSyntaxHighlightTextArea.class.getResourceAsStream(\n+                                            \"/org/fife/ui/rsyntaxtextarea/themes/default.xml\"));\n+                    theme.apply(getTxtOutput());\n+                } catch (IOException e) {\n+                    // Ignore\n+                }", "originalCommit": "3dfd4afaab93e23590c62d21822099ec1c0b7357", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0NTM4MA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2554#discussion_r497445380", "bodyText": "Maybe also extract the xml file path to a constant?", "author": "kingthorin", "createdAt": "2020-09-30T11:46:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0NTEwMg=="}], "type": "inlineReview"}, {"oid": "91ee740c801aa3c5fa2e724f2bc999ff9d753037", "url": "https://github.com/zaproxy/zap-extensions/commit/91ee740c801aa3c5fa2e724f2bc999ff9d753037", "message": "Support dark mode and dynamic Look and Feel switching\n\nDepends on https://github.com/zaproxy/zaproxy/pull/6202\n\nPart of https://github.com/zaproxy/zaproxy/issues/5542\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-07T15:31:58Z", "type": "forcePushed"}, {"oid": "20394bdb7b86392af6df7397214f3a0193f4f41b", "url": "https://github.com/zaproxy/zap-extensions/commit/20394bdb7b86392af6df7397214f3a0193f4f41b", "message": "Support dark mode and dynamic Look and Feel switching\n\nDepends on https://github.com/zaproxy/zaproxy/pull/6202\n\nPart of https://github.com/zaproxy/zaproxy/issues/5542\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-07T15:56:04Z", "type": "forcePushed"}, {"oid": "72fce44051344ce3117a86140998af2a386ca863", "url": "https://github.com/zaproxy/zap-extensions/commit/72fce44051344ce3117a86140998af2a386ca863", "message": "Support dark mode and dynamic Look and Feel switching\n\nDepends on https://github.com/zaproxy/zaproxy/pull/6202\n\nPart of https://github.com/zaproxy/zaproxy/issues/5542\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-07T17:18:47Z", "type": "commit"}, {"oid": "72fce44051344ce3117a86140998af2a386ca863", "url": "https://github.com/zaproxy/zap-extensions/commit/72fce44051344ce3117a86140998af2a386ca863", "message": "Support dark mode and dynamic Look and Feel switching\n\nDepends on https://github.com/zaproxy/zaproxy/pull/6202\n\nPart of https://github.com/zaproxy/zaproxy/issues/5542\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-07T17:18:47Z", "type": "forcePushed"}]}