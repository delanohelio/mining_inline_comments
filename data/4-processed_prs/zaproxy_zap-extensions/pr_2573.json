{"pr_number": 2573, "pr_title": "Expose GraphQL Options through the API", "pr_createdAt": "2020-10-13T11:15:48Z", "pr_url": "https://github.com/zaproxy/zap-extensions/pull/2573", "timeline": [{"oid": "db6a9a75cf6fec0c48b7811595b65a330d47cf30", "url": "https://github.com/zaproxy/zap-extensions/commit/db6a9a75cf6fec0c48b7811595b65a330d47cf30", "message": "Expose Options through the API\n\n- Expose Options through the API\n- Script Fixes\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-13T19:38:23Z", "type": "forcePushed"}, {"oid": "0b68c3c23580702af3a3e12a11acc1ec01feffca", "url": "https://github.com/zaproxy/zap-extensions/commit/0b68c3c23580702af3a3e12a11acc1ec01feffca", "message": "Expose Options through the API\n\n- Expose Options through the API\n- Script Fixes\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-13T19:47:33Z", "type": "forcePushed"}, {"oid": "82297857ca88dbb1435b6c1bc29f5a72ab013e9a", "url": "https://github.com/zaproxy/zap-extensions/commit/82297857ca88dbb1435b6c1bc29f5a72ab013e9a", "message": "Expose Options through the API\n\n- Expose Options through the API.\n- Fix script bugs.\n- Provide option to parse asynchronously.\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-15T11:30:37Z", "type": "forcePushed"}, {"oid": "5d88c63d9ac775f4e54279243da23d66b6746a4d", "url": "https://github.com/zaproxy/zap-extensions/commit/5d88c63d9ac775f4e54279243da23d66b6746a4d", "message": "Expose Options through the API\n\n- Expose Options through the API.\n- Fix script bugs.\n- Pass synchronously when using API.\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-15T15:13:41Z", "type": "forcePushed"}, {"oid": "3d9683cc3019a09a33b6234c9962042137876931", "url": "https://github.com/zaproxy/zap-extensions/commit/3d9683cc3019a09a33b6234c9962042137876931", "message": "Expose Options through the API\n\n- Expose Options through the API.\n- Fix script bugs.\n- Pass synchronously when using API.\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-15T15:17:01Z", "type": "forcePushed"}, {"oid": "1243146bd5b1d374ffc790220c61e4fd705d490e", "url": "https://github.com/zaproxy/zap-extensions/commit/1243146bd5b1d374ffc790220c61e4fd705d490e", "message": "Expose Options through the API\n\n- Expose Options through the API.\n- Fix script bugs.\n- Parse synchronously when using API.\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-15T15:19:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNjM0OA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505706348", "bodyText": "Core should already log the problem (in any case this should be less than error, since it's bad input not an issue with the code).", "author": "thc202", "createdAt": "2020-10-15T17:11:18Z", "path": "addOns/graphql/src/main/java/org/zaproxy/addon/graphql/GraphQlParam.java", "diffHunk": "@@ -170,6 +171,17 @@ public ArgsTypeOption getArgsType() {\n         return argsType;\n     }\n \n+    // For generating an API action.\n+    public void setArgsType(String argsType) {\n+        try {\n+            setArgsType(ArgsTypeOption.valueOf(argsType.toUpperCase(Locale.ROOT)));\n+        } catch (IllegalArgumentException e) {\n+            LOG.error('\"' + argsType + \"\\\" is not a valid Arguments Specification Type.\");", "originalCommit": "1243146bd5b1d374ffc790220c61e4fd705d490e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNjM5Nw==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505706397", "bodyText": "It should throw as ApiException, otherwise this will be handled as an internal error.", "author": "thc202", "createdAt": "2020-10-15T17:11:22Z", "path": "addOns/graphql/src/main/java/org/zaproxy/addon/graphql/GraphQlParam.java", "diffHunk": "@@ -170,6 +171,17 @@ public ArgsTypeOption getArgsType() {\n         return argsType;\n     }\n \n+    // For generating an API action.\n+    public void setArgsType(String argsType) {\n+        try {\n+            setArgsType(ArgsTypeOption.valueOf(argsType.toUpperCase(Locale.ROOT)));\n+        } catch (IllegalArgumentException e) {\n+            LOG.error('\"' + argsType + \"\\\" is not a valid Arguments Specification Type.\");\n+            // Rethrow for API.\n+            throw e;", "originalCommit": "1243146bd5b1d374ffc790220c61e4fd705d490e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNjc3OA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505706778", "bodyText": "I'd suggest syncGeneration (or other variation), it's more clear what it is for.", "author": "thc202", "createdAt": "2020-10-15T17:12:00Z", "path": "addOns/graphql/src/main/java/org/zaproxy/addon/graphql/GraphQlParser.java", "diffHunk": "@@ -50,6 +50,7 @@\n     private final ExtensionGraphQl extensionGraphQl =\n             Control.getSingleton().getExtensionLoader().getExtension(ExtensionGraphQl.class);\n     private final GraphQlParam param = extensionGraphQl.getParam();\n+    private boolean originApi;", "originalCommit": "1243146bd5b1d374ffc790220c61e4fd705d490e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNzI1Mg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505707252", "bodyText": "Isn't this true? We might need to change the command line then, the import should be synchronous as well.", "author": "thc202", "createdAt": "2020-10-15T17:12:49Z", "path": "addOns/graphql/src/main/javahelp/org/zaproxy/addon/graphql/resources/help/contents/graphql.html", "diffHunk": "@@ -47,8 +64,6 @@ <H2>Command Line</H2>\n <li>-graphqlendurl &lt;url&gt;  : Sets the Endpoint URL</li>\n </ul>\n \n-The definitions will be imported synchronously and any warnings will be displayed on the command line.", "originalCommit": "1243146bd5b1d374ffc790220c61e4fd705d490e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc4ODI1Mg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505788252", "bodyText": "At least when in command line mode, if there's GUI it should still be async.", "author": "thc202", "createdAt": "2020-10-15T19:29:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNzI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNzU4MA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505707580", "bodyText": "The null check needs to be in the left?", "author": "thc202", "createdAt": "2020-10-15T17:13:25Z", "path": "addOns/graphql/src/main/zapHomeFiles/scripts/scripts/variant/GraphQL Support.js", "diffHunk": "@@ -10,7 +10,8 @@ function getQuery(msg){\n \tvar query;\n \t\n \tif (header.getMethod() == \"POST\") {\n-\t\tif (header.getHeader(\"Content-Type\").contains(\"application/json\")) {\n+\t\tvar contentTypeHeader = header.getHeader(\"Content-Type\");\n+\t\tif (contentTypeHeader.contains(\"application/json\") || contentTypeHeader == null) {", "originalCommit": "1243146bd5b1d374ffc790220c61e4fd705d490e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwODM1NA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505708354", "bodyText": "'' \u2192 [] ?", "author": "thc202", "createdAt": "2020-10-15T17:14:44Z", "path": "addOns/graphql/src/main/zapHomeFiles/scripts/scripts/variant/GraphQL Support.js", "diffHunk": "@@ -96,11 +98,11 @@ function getLeafName(helper, nodeName, msg) {\n function getTreePath(helper, msg) {\n \tvar query = getQuery(msg);\n \tif (query == null) {\n-\t\tprint(\"  not GraphQL\");\n+\t\t// print(\"  not GraphQL\");\n \t\treturn null;\t\n \t}\n \tvar uri = msg.getRequestHeader().getURI();\n-\tvar path = uri.getPath().split('/');\n+\tvar path = uri.getPath() != null ? uri.getPath().split('/') : '';", "originalCommit": "1243146bd5b1d374ffc790220c61e4fd705d490e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MDIxOA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505760218", "bodyText": "path.length will return zero in either case but [] does seem more appropriate.", "author": "ricekot", "createdAt": "2020-10-15T18:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwODM1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc4ODY1NQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2573#discussion_r505788655", "bodyText": "Right, was more to have the same type.", "author": "thc202", "createdAt": "2020-10-15T19:30:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwODM1NA=="}], "type": "inlineReview"}, {"oid": "ff97c68c5fc2f94e3a0014645484c45354ffe5cf", "url": "https://github.com/zaproxy/zap-extensions/commit/ff97c68c5fc2f94e3a0014645484c45354ffe5cf", "message": "Expose Options through the API\n\n- Expose Options through the API.\n- Fix script bugs.\n- Parse synchronously when using API or Commandline.\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-15T20:33:30Z", "type": "commit"}, {"oid": "ff97c68c5fc2f94e3a0014645484c45354ffe5cf", "url": "https://github.com/zaproxy/zap-extensions/commit/ff97c68c5fc2f94e3a0014645484c45354ffe5cf", "message": "Expose Options through the API\n\n- Expose Options through the API.\n- Fix script bugs.\n- Parse synchronously when using API or Commandline.\n\nSigned-off-by: ricekot <ricekot@gmail.com>", "committedDate": "2020-10-15T20:33:30Z", "type": "forcePushed"}]}