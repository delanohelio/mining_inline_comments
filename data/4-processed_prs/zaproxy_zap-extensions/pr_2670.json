{"pr_number": 2670, "pr_title": "chore: added evidence to suspicious comment scan rule", "pr_createdAt": "2020-12-27T07:22:31Z", "pr_url": "https://github.com/zaproxy/zap-extensions/pull/2670", "timeline": [{"oid": "25d5202df2a312c059eac16d2f83dbc4eb2f165d", "url": "https://github.com/zaproxy/zap-extensions/commit/25d5202df2a312c059eac16d2f83dbc4eb2f165d", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-27T07:23:31Z", "type": "forcePushed"}, {"oid": "af31f657a22a99f09e9258fa962b95557a113076", "url": "https://github.com/zaproxy/zap-extensions/commit/af31f657a22a99f09e9258fa962b95557a113076", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-27T07:39:44Z", "type": "forcePushed"}, {"oid": "853f69d842fd857c71408df4b008bc3867a311d3", "url": "https://github.com/zaproxy/zap-extensions/commit/853f69d842fd857c71408df4b008bc3867a311d3", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-27T08:00:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549652924", "bodyText": "This is now raising an alert per comment, was that on purpose? The other info field will contain the information of all comments not just the one that matches the evidence.", "author": "thc202", "createdAt": "2020-12-29T10:29:06Z", "path": "addOns/pscanrules/src/main/java/org/zaproxy/zap/extension/pscanrules/InformationDisclosureSuspiciousCommentsScanRule.java", "diffHunk": "@@ -107,19 +110,21 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n                                             MESSAGE_PREFIX + \"otherinfo\", pattern, elStr));\n                             todoComments.append(\"\\n\");\n                             confidence = Alert.CONFIDENCE_LOW;\n+                            evidence.add(elStr);\n                             break; // Only need to record this script once\n                         }\n                     }\n                     offset = el.getEnd();\n                 }\n             }\n-            if (todoComments.length() > 0) {\n-                this.raiseAlert(msg, id, todoComments.toString(), confidence);\n+            for (String e : evidence) {", "originalCommit": "853f69d842fd857c71408df4b008bc3867a311d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1NDQ5OQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549654499", "bodyText": "Yep, I thought that makes more sense to have one alert per comment, do you agree?\nThe other contains the matching pattern, which is not that helpful...", "author": "omerlh", "createdAt": "2020-12-29T10:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY2MDg1MA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549660850", "bodyText": "IMO it's easier to manage with a single alert per message.", "author": "thc202", "createdAt": "2020-12-29T10:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY2NDQ3NA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549664474", "bodyText": "I was just thinking about false positives - you might want one alert per comment so you can ignore only the alerts that are false positive", "author": "omerlh", "createdAt": "2020-12-29T11:07:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY4NzcwMA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552687700", "bodyText": "Worth mentioning this in the change log as its a change in the way the rule works.", "author": "psiinon", "createdAt": "2021-01-06T14:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY5NjkwNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552696904", "bodyText": "Yep, I updated the change log", "author": "omerlh", "createdAt": "2021-01-06T15:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjczMzU5OQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552733599", "bodyText": "Did you push the changes? I'm still not seeing it :/", "author": "psiinon", "createdAt": "2021-01-06T15:49:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}], "type": "inlineReview"}, {"oid": "a72c7555d7025390ba8e516deef472b7faff5234", "url": "https://github.com/zaproxy/zap-extensions/commit/a72c7555d7025390ba8e516deef472b7faff5234", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-29T11:58:32Z", "type": "forcePushed"}, {"oid": "6499df0ee2323bb827ffdd6c5015816bdc696ef6", "url": "https://github.com/zaproxy/zap-extensions/commit/6499df0ee2323bb827ffdd6c5015816bdc696ef6", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-29T12:16:05Z", "type": "forcePushed"}, {"oid": "91cd20377679f11c5671d3d93121c63505d2b9b7", "url": "https://github.com/zaproxy/zap-extensions/commit/91cd20377679f11c5671d3d93121c63505d2b9b7", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-03T11:07:26Z", "type": "forcePushed"}, {"oid": "e39470194d159a5f7357c1cae024c66045e88706", "url": "https://github.com/zaproxy/zap-extensions/commit/e39470194d159a5f7357c1cae024c66045e88706", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-03T11:20:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjUyNDA5NQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552524095", "bodyText": "This needs to be adjusted, there's no longer a following comment/snippet. Mention the evidence?", "author": "thc202", "createdAt": "2021-01-06T11:38:12Z", "path": "addOns/pscanrules/src/main/resources/org/zaproxy/zap/extension/pscanrules/resources/Messages.properties", "diffHunk": "@@ -73,7 +73,7 @@ pscanrules.informationdisclosurereferrer.issuer.field=Issuer:\n \n pscanrules.informationdisclosuresuspiciouscomments.name=Information Disclosure - Suspicious Comments\n pscanrules.informationdisclosuresuspiciouscomments.desc=The response appears to contain suspicious comments which may help an attacker. Note: Matches made within script blocks or files are against the entire content not only comments.\n-pscanrules.informationdisclosuresuspiciouscomments.otherinfo=The following comment/snippet was identified via the pattern: {0}\\n{1}\n+pscanrules.informationdisclosuresuspiciouscomments.otherinfo=The following comment/snippet was identified via the pattern: {0}", "originalCommit": "e39470194d159a5f7357c1cae024c66045e88706", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjUzMDM2MA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552530360", "bodyText": "Fixed, hope it is better now", "author": "omerlh", "createdAt": "2021-01-06T11:53:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjUyNDA5NQ=="}], "type": "inlineReview"}, {"oid": "d92d864a156e19307cff02e87d624675524ff86d", "url": "https://github.com/zaproxy/zap-extensions/commit/d92d864a156e19307cff02e87d624675524ff86d", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-06T11:53:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjczOTg0NQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552739845", "bodyText": "@psiinon I referred to this change", "author": "omerlh", "createdAt": "2021-01-06T15:57:31Z", "path": "addOns/pscanrules/CHANGELOG.md", "diffHunk": "@@ -13,6 +13,7 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n - Handle an IllegalArgumentException that could occur in the CSP scan rule if multiple CSP headers were present and one (or more) had a report-uri directive when trying to merge them.\n - Allow to ignore cookies in same site and loosely scoped scan rules.\n - The Application Error scan rule will not alert on web assembly responses.\n+- The Suspicious Comments scan rule will include the offending line as evidence.", "originalCommit": "d92d864a156e19307cff02e87d624675524ff86d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjc0NDQwNg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552744406", "bodyText": "But not the fact that the rule now raises alerts for each instance? I think that should be mentioned too.", "author": "psiinon", "createdAt": "2021-01-06T16:02:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjczOTg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjc0NzMyNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552747324", "bodyText": "Sure, fixed :)", "author": "omerlh", "createdAt": "2021-01-06T16:04:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjczOTg0NQ=="}], "type": "inlineReview"}, {"oid": "4eb7b7ea2df0102f6276f665b0c38fd982620915", "url": "https://github.com/zaproxy/zap-extensions/commit/4eb7b7ea2df0102f6276f665b0c38fd982620915", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-06T16:04:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMyOTUwOQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r553329509", "bodyText": "fire \u2192 raise\nrequest \u2192 message\n\nIMO this could be mentioned in the previous line.", "author": "thc202", "createdAt": "2021-01-07T13:34:45Z", "path": "addOns/pscanrules/CHANGELOG.md", "diffHunk": "@@ -13,6 +13,8 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n - Handle an IllegalArgumentException that could occur in the CSP scan rule if multiple CSP headers were present and one (or more) had a report-uri directive when trying to merge them.\n - Allow to ignore cookies in same site and loosely scoped scan rules.\n - The Application Error scan rule will not alert on web assembly responses.\n+- The Suspicious Comments scan rule will include the offending line as evidence.\n+- The Suspicious Comments scan rule will fire one alert per finding, instead of one aggeregated alert per HTTP request.", "originalCommit": "4eb7b7ea2df0102f6276f665b0c38fd982620915", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMyOTU1Mw==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r553329553", "bodyText": "violating \u2192 suspicious", "author": "thc202", "createdAt": "2021-01-07T13:34:51Z", "path": "addOns/pscanrules/src/main/resources/org/zaproxy/zap/extension/pscanrules/resources/Messages.properties", "diffHunk": "@@ -73,7 +73,7 @@ pscanrules.informationdisclosurereferrer.issuer.field=Issuer:\n \n pscanrules.informationdisclosuresuspiciouscomments.name=Information Disclosure - Suspicious Comments\n pscanrules.informationdisclosuresuspiciouscomments.desc=The response appears to contain suspicious comments which may help an attacker. Note: Matches made within script blocks or files are against the entire content not only comments.\n-pscanrules.informationdisclosuresuspiciouscomments.otherinfo=The following comment/snippet was identified via the pattern: {0}\\n{1}\n+pscanrules.informationdisclosuresuspiciouscomments.otherinfo=The following pattern was used: {0}, see evidence field for the violating comment/snippet.", "originalCommit": "4eb7b7ea2df0102f6276f665b0c38fd982620915", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMzMDMyMg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r553330322", "bodyText": "Worth checking both alerts have the expected evidence too.", "author": "thc202", "createdAt": "2021-01-07T13:36:22Z", "path": "addOns/pscanrules/src/test/java/org/zaproxy/zap/extension/pscanrules/InformationDisclosureSuspiciousCommentsScanRuleUnitTest.java", "diffHunk": "@@ -120,6 +123,26 @@ public void shouldNotAlertOnSuspiciousCommentIsPartOfWordInJavaScriptResponse()\n         assertEquals(0, alertsRaised.size());\n     }\n \n+    @Test\n+    public void shouldCreateOneAlertPerSuspiciousComment()\n+            throws HttpMalformedHeaderException, URIException {\n+\n+        // Given\n+        String body =\n+                \"Some text <script>Some Script Element FIXME: DO something \\n FIXME: DO something else </script>\\nLine 2\\n\";\n+        HttpMessage msg = createHttpMessageWithRespBody(body, \"text/javascript;charset=ISO-8859-1\");\n+\n+        assertTrue(msg.getResponseHeader().isText());\n+        assertTrue(msg.getResponseHeader().isJavaScript());\n+\n+        // When\n+        scanHttpResponseReceive(msg);\n+\n+        // Then\n+        assertEquals(2, alertsRaised.size());\n+        assertEquals(Alert.CONFIDENCE_LOW, alertsRaised.get(0).getConfidence());", "originalCommit": "4eb7b7ea2df0102f6276f665b0c38fd982620915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDUyNTM3Mg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r554525372", "bodyText": "Fixed this and the rest of the comments.", "author": "omerlh", "createdAt": "2021-01-10T07:31:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMzMDMyMg=="}], "type": "inlineReview"}, {"oid": "d4c9d700fecb3fc50e5a11082e19a3e96cc707a9", "url": "https://github.com/zaproxy/zap-extensions/commit/d4c9d700fecb3fc50e5a11082e19a3e96cc707a9", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-10T07:32:35Z", "type": "forcePushed"}, {"oid": "dedb298f8126f5573706b8572ea96404543b8cb7", "url": "https://github.com/zaproxy/zap-extensions/commit/dedb298f8126f5573706b8572ea96404543b8cb7", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-10T07:46:42Z", "type": "forcePushed"}, {"oid": "0676b50cd096e4f9ece89207cc011896b400e625", "url": "https://github.com/zaproxy/zap-extensions/commit/0676b50cd096e4f9ece89207cc011896b400e625", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T08:04:27Z", "type": "forcePushed"}, {"oid": "b3e9bd30adcea15499d54fbf5c7392c9e4f0f87e", "url": "https://github.com/zaproxy/zap-extensions/commit/b3e9bd30adcea15499d54fbf5c7392c9e4f0f87e", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T08:05:11Z", "type": "forcePushed"}, {"oid": "161ba43886b263a7e875cd2929411050fd01a19a", "url": "https://github.com/zaproxy/zap-extensions/commit/161ba43886b263a7e875cd2929411050fd01a19a", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T14:01:41Z", "type": "commit"}, {"oid": "161ba43886b263a7e875cd2929411050fd01a19a", "url": "https://github.com/zaproxy/zap-extensions/commit/161ba43886b263a7e875cd2929411050fd01a19a", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T14:01:41Z", "type": "forcePushed"}]}