{"pr_number": 3822, "pr_title": "[RW-5113][risk=no] UI - Sidebar to right of page with functionality to add criteria to groups (phase 1)", "pr_createdAt": "2020-07-23T02:33:56Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3822", "timeline": [{"oid": "7ea4c0a7f81c642607dfee9011947213e79cc3eb", "url": "https://github.com/all-of-us/workbench/commit/7ea4c0a7f81c642607dfee9011947213e79cc3eb", "message": "Sidebar Icon for Cohort Criteria page", "committedDate": "2020-07-15T20:57:13Z", "type": "commit"}, {"oid": "cfd4e02767d1144b102586f27510494fe0ad7de9", "url": "https://github.com/all-of-us/workbench/commit/cfd4e02767d1144b102586f27510494fe0ad7de9", "message": "Remove extra lines etc", "committedDate": "2020-07-15T21:09:00Z", "type": "commit"}, {"oid": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "url": "https://github.com/all-of-us/workbench/commit/174d4f296c7a120801fdbda36ccac252e4cfb5cc", "message": "Fix UI test", "committedDate": "2020-07-15T21:12:54Z", "type": "commit"}, {"oid": "9fcb66d82c010cbf5a16b1d156b77af3ef3582cd", "url": "https://github.com/all-of-us/workbench/commit/9fcb66d82c010cbf5a16b1d156b77af3ef3582cd", "message": "PR Comments: Remove criteriaStore from criteriaReview and add config to selectionList", "committedDate": "2020-07-20T15:06:45Z", "type": "commit"}, {"oid": "71a8d0d31c19072ca499604401001c06bab7d601", "url": "https://github.com/all-of-us/workbench/commit/71a8d0d31c19072ca499604401001c06bab7d601", "message": "Use Growl instead of Message", "committedDate": "2020-07-20T16:56:53Z", "type": "commit"}, {"oid": "1d2956d71e4038701b888ffed1883c2eca75bc42", "url": "https://github.com/all-of-us/workbench/commit/1d2956d71e4038701b888ffed1883c2eca75bc42", "message": "Rebase", "committedDate": "2020-07-20T18:17:26Z", "type": "commit"}, {"oid": "81fa7cc4e3d69698a87f4de30d56b856a9218023", "url": "https://github.com/all-of-us/workbench/commit/81fa7cc4e3d69698a87f4de30d56b856a9218023", "message": "Criteria Cart", "committedDate": "2020-07-23T02:30:59Z", "type": "commit"}, {"oid": "66e7cf17aa3edb265bf988e5ec446a5d92f715cd", "url": "https://github.com/all-of-us/workbench/commit/66e7cf17aa3edb265bf988e5ec446a5d92f715cd", "message": "Rebase", "committedDate": "2020-07-23T02:50:46Z", "type": "commit"}, {"oid": "8ebd62c8f90a2a10490937b8f6849ee59c85e0a3", "url": "https://github.com/all-of-us/workbench/commit/8ebd62c8f90a2a10490937b8f6849ee59c85e0a3", "message": "Add comment", "committedDate": "2020-07-23T02:53:06Z", "type": "commit"}, {"oid": "f1470c509b9ac37a64379c7b64f3b3b6126028f6", "url": "https://github.com/all-of-us/workbench/commit/f1470c509b9ac37a64379c7b64f3b3b6126028f6", "message": "Revert some extra adds", "committedDate": "2020-07-23T02:55:13Z", "type": "commit"}, {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e", "url": "https://github.com/all-of-us/workbench/commit/6227e5378a9d884c905079c4d5de7c23e02df07e", "message": "Fix UI Test", "committedDate": "2020-07-23T13:23:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMzk2OQ==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459703969", "bodyText": "We should remove from currentCohortCriteriaStore instead of calling removeSelection here", "author": "dolbeew", "createdAt": "2020-07-23T20:18:44Z", "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -136,6 +141,55 @@ export class SelectionInfo extends React.Component<SelectionInfoProps, Selection\n   }\n }\n \n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <FlexColumn style={styles.selectionItem}>\n+      {this.showOr && <div style={{padding: '0.3rem 0rem 0.3rem 1rem'}}>OR&nbsp;</div>}\n+      <FlexRow style={{alignItems: 'baseline'}}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>", "originalCommit": "6227e5378a9d884c905079c4d5de7c23e02df07e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxODQ2MA==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464618460", "bodyText": "Thanks. The select icons in the tree are still not enabling after removing a selection, but I can handle that in #3836 since I've made changes to that component anyways.", "author": "dolbeew", "createdAt": "2020-08-03T19:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMzk2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyNDQxMA==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459724410", "bodyText": "It won't let me comment on the actual lines, but here are a couple I missed last time:\n\nLine 343: Use right style property instead of paddingLeft: '83%' to set growl position. Using the percentage, the position of the growl changes with the screen size.\nLine 347: Nit - Drop closing growl tag since it's empty (<Growl ref={(el) => this.growl = el}/>)", "author": "dolbeew", "createdAt": "2020-07-23T20:58:48Z", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -143,6 +149,10 @@ const css = `\n      background-color: ` + colorWithWhiteness(colors.success, 0.6) + `!important;\n      margin-left: 0.3rem;\n    }\n+\n+   .p-growl-message {\n+     margin-left: 0.5em\n+   }\n  `;\n \n export class CohortSearch extends React.Component<Props, State> {", "originalCommit": "6227e5378a9d884c905079c4d5de7c23e02df07e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyODkxMg==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459728912", "bodyText": "I went into a little more detail offline, but I think we should use the existing structure to display this content.", "author": "dolbeew", "createdAt": "2020-07-23T21:07:52Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -381,14 +394,30 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n \n     renderCriteria() {", "originalCommit": "6227e5378a9d884c905079c4d5de7c23e02df07e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTczMzk4MQ==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459733981", "bodyText": "What does the ::before do? I removed it and didn't notice any change in the display.", "author": "dolbeew", "createdAt": "2020-07-23T21:19:09Z", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -104,37 +104,43 @@ interface State {\n }\n \n const css = `\n+  .p-growl {\n+    position: sticky;\n+  }\n   .p-growl.p-growl-topright {\n-     height: 29px;\n-     width: 7rem;\n-     padding-top: 6rem;\n-     line-hieght: 1rem;\n+     height: 1rem;\n+     width: 6.4rem;\n+     padding-top: 0.4rem;\n+     line-hieght: 0.7rem;\n      margin-right: 3rem;\n-\n+   }\n+   .p-growl .p-growl-item-container .p-growl-item .p-growl-image {\n+     font-size: 1rem !important;\n+     margin-top: 0.19rem\n    }\n \n   .p-growl-item-container::before {", "originalCommit": "6227e5378a9d884c905079c4d5de7c23e02df07e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cb2f73f8714986c25a09be5e0e9183f2e0a45af", "url": "https://github.com/all-of-us/workbench/commit/4cb2f73f8714986c25a09be5e0e9183f2e0a45af", "message": "PR Comments", "committedDate": "2020-08-03T14:00:37Z", "type": "commit"}, {"oid": "852b81a3578f97d655e2490536beeb7c98610ddd", "url": "https://github.com/all-of-us/workbench/commit/852b81a3578f97d655e2490536beeb7c98610ddd", "message": "Use right rather than padding for growl", "committedDate": "2020-08-03T16:59:05Z", "type": "commit"}, {"oid": "35989d86a0cba1ab1904334785009cd305520d20", "url": "https://github.com/all-of-us/workbench/commit/35989d86a0cba1ab1904334785009cd305520d20", "message": "Remove commented out code", "committedDate": "2020-08-03T17:05:35Z", "type": "commit"}, {"oid": "d1b8d5bfc92712ec72825ca958470483e03b79b6", "url": "https://github.com/all-of-us/workbench/commit/d1b8d5bfc92712ec72825ca958470483e03b79b6", "message": "Fix ui test as Help icon is mow the second element in Icon list", "committedDate": "2020-08-03T19:06:43Z", "type": "commit"}, {"oid": "33ff6dd0b4ccb40cddb7bd12f378646dc756dba5", "url": "https://github.com/all-of-us/workbench/commit/33ff6dd0b4ccb40cddb7bd12f378646dc756dba5", "message": "Rebase", "committedDate": "2020-08-03T19:08:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5OTE5NQ==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464599195", "bodyText": "This is basically duplicating the icon container div from the render function here, which is throwing off the background of the active icon container. Also, the two FontAwesomeIcons below are identical. If we only put a condition on the counter, it should fix both, something similar to this:\nreturn <React.Fragment>\n  {(criteria && icon.page === 'criteria') &&\n    <span data-test-id = 'criteria-count' style={styles.criteriaCount}>{criteria.length}</span>}\n  <FontAwesomeIcon data-test-id={'help-sidebar-icon-' + i} icon={icon.faIcon} style={icon.style} />\n</React.Fragment>;\n\nThis would also require editing the test to use 'help-sidebar-icon-0' for the data-test-id instead of 'criteria-icon'", "author": "dolbeew", "createdAt": "2020-08-03T18:50:00Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -451,6 +461,20 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n       </PopupTrigger>;\n     }\n \n+    showIcon(icon) {\n+      const {criteria, helpContentKey} = this.props;\n+      return !icon.page || icon.page === helpContentKey || (criteria && icon.page === 'criteria');\n+    }\n+\n+    displayIcon(icon, i) {\n+      const {criteria} = this.props;\n+\n+      return (criteria && icon.page === 'criteria') ?   <div style={styles.icon} data-test-id ='criteria-icon'>", "originalCommit": "35989d86a0cba1ab1904334785009cd305520d20", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYwMTgyNQ==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464601825", "bodyText": "I like separating the condition and icon rendering into functions, much cleaner in the render function that way.", "author": "dolbeew", "createdAt": "2020-08-03T18:55:13Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -451,6 +461,20 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n       </PopupTrigger>;\n     }\n \n+    showIcon(icon) {\n+      const {criteria, helpContentKey} = this.props;\n+      return !icon.page || icon.page === helpContentKey || (criteria && icon.page === 'criteria');\n+    }\n+\n+    displayIcon(icon, i) {\n+      const {criteria} = this.props;\n+\n+      return (criteria && icon.page === 'criteria') ?   <div style={styles.icon} data-test-id ='criteria-icon'>\n+            <span data-test-id = 'criteria-count' style={styles.criteriaCount}>{criteria.length}</span>\n+            <FontAwesomeIcon data-test-id={'help-sidebar-icon-' + i} icon={icon.faIcon} style={icon.style} />\n+          </div> : <FontAwesomeIcon data-test-id={'help-sidebar-icon-' + i} icon={icon.faIcon} style={icon.style} />;\n+    }", "originalCommit": "35989d86a0cba1ab1904334785009cd305520d20", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxNjYzMA==", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464616630", "bodyText": "line-height is misspelled", "author": "dolbeew", "createdAt": "2020-08-03T19:26:40Z", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -104,37 +104,32 @@ interface State {\n }\n \n const css = `\n+  .p-growl {\n+    position: sticky;\n+  }\n   .p-growl.p-growl-topright {\n-     height: 29px;\n-     width: 7rem;\n-     padding-top: 6rem;\n-     line-hieght: 1rem;\n+     height: 1rem;\n+     width: 6.4rem;\n+     padding-top: 0.4rem;\n+     line-hieght: 0.7rem;", "originalCommit": "33ff6dd0b4ccb40cddb7bd12f378646dc756dba5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "034676f97cd66cd0bb0d702dc72ca30e0b180d23", "url": "https://github.com/all-of-us/workbench/commit/034676f97cd66cd0bb0d702dc72ca30e0b180d23", "message": "Spell Correct and moving display icon condition", "committedDate": "2020-08-03T19:51:44Z", "type": "commit"}]}