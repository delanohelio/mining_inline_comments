{"pr_number": 3788, "pr_title": "[RW-5113][risk=no] UI - Sidebar to right of page with functionality to add criteria to groups (phase 1)", "pr_createdAt": "2020-07-15T21:03:07Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3788", "timeline": [{"oid": "7ea4c0a7f81c642607dfee9011947213e79cc3eb", "url": "https://github.com/all-of-us/workbench/commit/7ea4c0a7f81c642607dfee9011947213e79cc3eb", "message": "Sidebar Icon for Cohort Criteria page", "committedDate": "2020-07-15T20:57:13Z", "type": "commit"}, {"oid": "cfd4e02767d1144b102586f27510494fe0ad7de9", "url": "https://github.com/all-of-us/workbench/commit/cfd4e02767d1144b102586f27510494fe0ad7de9", "message": "Remove extra lines etc", "committedDate": "2020-07-15T21:09:00Z", "type": "commit"}, {"oid": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "url": "https://github.com/all-of-us/workbench/commit/174d4f296c7a120801fdbda36ccac252e4cfb5cc", "message": "Fix UI test", "committedDate": "2020-07-15T21:12:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MTcxMQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455851711", "bodyText": "Was this an intentional change? It doesn't seem to do anything currently", "author": "dolbeew", "createdAt": "2020-07-16T14:57:22Z", "path": "ui/src/app/pages/data/cohort-review/cohort-review.tsx", "diffHunk": "@@ -26,7 +26,7 @@ interface State {\n   readonly: boolean;\n }\n \n-export class CohortReview extends React.Component<{}, State> {\n+export const CohortReview = withCurrentCohortCriteria()(class extends React.Component<{}, State> {", "originalCommit": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg5NDYzOQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455894639", "bodyText": "this is just to use withCurrentCohortCriteria", "author": "NehaBroad", "createdAt": "2020-07-16T15:56:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MTcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyNTgxMg==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455925812", "bodyText": "Ok, was asking because I don't think we'll need the current criteria here. Cohort review only uses cohorts that have been saved, so we shouldn't need access to any unsaved selections.", "author": "dolbeew", "createdAt": "2020-07-16T16:45:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MTcxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1OTMyMA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455859320", "bodyText": "I think the selections are meant to slide out, like how the help tips slide out when the info icon is clicked. We may want to verify before changing, but I believe that's what was discussed.", "author": "dolbeew", "createdAt": "2020-07-16T15:07:36Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -363,6 +381,18 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile())(\n       }\n     }\n \n+    renderCriteria() {\n+      const {criteria} = this.props;\n+      return <PopupTrigger", "originalCommit": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkwMTgyMQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455901821", "bodyText": "Ok, wasn't aware of this. I'll change it", "author": "NehaBroad", "createdAt": "2020-07-16T16:07:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1OTMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzkzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455923931", "bodyText": "Ok, let me know if you need to discuss, but should look similar to this block in the template and then add a new object for the icon to icons array. The hiding and showing of the content should already be built in.", "author": "dolbeew", "createdAt": "2020-07-16T16:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1OTMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3NDc3OA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457474778", "bodyText": "As discussed offline , i'll take care of this in another PR", "author": "NehaBroad", "createdAt": "2020-07-20T15:07:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1OTMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg2NzQ0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455867441", "bodyText": "The changes in this component will break the non feature flagged version of cohort builder. We either need to put the changes behind the feature flag or duplicate the component so we can change it however we want. Duplicating is probably simpler.", "author": "dolbeew", "createdAt": "2020-07-16T15:18:46Z", "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -144,9 +145,10 @@ interface Props {\n   selections: Array<Selection>;\n   setView: Function;\n   view: string;\n+  criteria?: Array<Selection>;\n }\n \n-export class SelectionList extends React.Component<Props> {\n+export const SelectionList = withCurrentCohortCriteria()(class extends React.Component<Props> {", "originalCommit": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkwMTQxMA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455901410", "bodyText": "yeah thats a good point , i will update this", "author": "NehaBroad", "createdAt": "2020-07-16T16:06:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg2NzQ0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg3MDkyMg==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455870922", "bodyText": "Just curious, did you also look at Primereact's Growl component? At a glance, it looks more similar to what the mocks call for, not sure if it's actually a better fit for what we need.", "author": "dolbeew", "createdAt": "2020-07-16T15:23:36Z", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -5,16 +5,19 @@ import {AttributesPage} from 'app/cohort-search/attributes-page/attributes-page.\n import {Demographics} from 'app/cohort-search/demographics/demographics.component';\n import {ListSearchV2} from 'app/cohort-search/list-search-v2/list-search-v2.component';\n import {searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {Selection} from 'app/cohort-search/selection-list/selection-list.component';\n import {CriteriaTree} from 'app/cohort-search/tree/tree.component';\n import {domainToTitle, generateId, typeToTitle} from 'app/cohort-search/utils';\n import {Button, Clickable} from 'app/components/buttons';\n import {FlexRowWrap} from 'app/components/flex';\n import {ClrIcon} from 'app/components/icons';\n import {SpinnerOverlay} from 'app/components/spinners';\n-import colors, {addOpacity} from 'app/styles/colors';\n+import colors, {addOpacity, colorWithWhiteness} from 'app/styles/colors';\n import {reactStyles, ReactWrapperBase} from 'app/utils';\n import {triggerEvent} from 'app/utils/analytics';\n+import {currentCohortCriteriaStore} from 'app/utils/navigation';\n import {Criteria, CriteriaType, DomainType, TemporalMention, TemporalTime} from 'generated/fetch';\n+import {Messages} from 'primereact/messages';", "originalCommit": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3NjA0OA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457476048", "bodyText": "Growl might be a better option for this as itdisplay message in overlay vs messages that are supposed to be for inline. I'll change to Growl", "author": "NehaBroad", "createdAt": "2020-07-20T15:09:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg3MDkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg3OTM2NQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r455879365", "bodyText": "This style is only applied to the info icon", "author": "dolbeew", "createdAt": "2020-07-16T15:35:10Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -177,7 +194,7 @@ const icons = (helpContentKey: string) => {\n     faIcon: helpContentKey === NOTEBOOK_HELP_CONTENT ? faFolderOpen : faInfoCircle,\n     label: helpContentKey === NOTEBOOK_HELP_CONTENT ? 'Storage Icon' : 'Help Icon',\n     page: null,\n-    style: {fontSize: '21px'},\n+    style: {fontSize: '1.1rem'},", "originalCommit": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU2Mzk0Ng==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457563946", "bodyText": "i had to increase the size a little bit to match the criteria icon", "author": "NehaBroad", "createdAt": "2020-07-20T17:09:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg3OTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYxNDI5NQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457614295", "bodyText": "If you use inspect mode on the Invision screens, looks like both should be ~21px font size", "author": "dolbeew", "createdAt": "2020-07-20T18:38:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg3OTM2NQ=="}], "type": "inlineReview"}, {"oid": "9fcb66d82c010cbf5a16b1d156b77af3ef3582cd", "url": "https://github.com/all-of-us/workbench/commit/9fcb66d82c010cbf5a16b1d156b77af3ef3582cd", "message": "PR Comments: Remove criteriaStore from criteriaReview and add config to selectionList", "committedDate": "2020-07-20T15:06:45Z", "type": "commit"}, {"oid": "71a8d0d31c19072ca499604401001c06bab7d601", "url": "https://github.com/all-of-us/workbench/commit/71a8d0d31c19072ca499604401001c06bab7d601", "message": "Use Growl instead of Message", "committedDate": "2020-07-20T16:56:53Z", "type": "commit"}, {"oid": "1d2956d71e4038701b888ffed1883c2eca75bc42", "url": "https://github.com/all-of-us/workbench/commit/1d2956d71e4038701b888ffed1883c2eca75bc42", "message": "Rebase", "committedDate": "2020-07-20T18:17:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwMTExMA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457601110", "bodyText": "Need to revert this change also, the Finish button stays disabled after selections are made in the non feature-flagged UI", "author": "dolbeew", "createdAt": "2020-07-20T18:14:19Z", "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -164,26 +167,34 @@ export class SelectionList extends React.Component<Props> {\n   }\n \n   render() {\n-    const {back, close, disableFinish, finish, removeSelection, selections, setView} = this.props;\n+    const {back, close, disableFinish, finish, removeSelection, criteria, selections, setView} = this.props;\n     return <div style={styles.selectionPanel}>\n       <h5 style={styles.selectionTitle}>Selected Criteria</h5>\n-      <div style={styles.selectionContainer}>\n-        {selections.map((selection, s) =>\n+      {serverConfigStore.getValue().enableCohortBuilderV2 && criteria && <div style={styles.selectionContainer}>\n+        {criteria.map((selection, s) =>\n           <SelectionInfo key={s}\n             index={s}\n             selection={selection}\n             removeSelection={() => removeSelection(selection)}/>\n         )}\n-      </div>\n-      <div style={styles.buttonContainer}>\n+      </div>}\n+      {!serverConfigStore.getValue().enableCohortBuilderV2 && <div style={styles.selectionContainer}>\n+        {selections.map((selection, s) =>\n+            <SelectionInfo key={s}\n+                           index={s}\n+                           selection={selection}\n+                           removeSelection={() => removeSelection(selection)}/>\n+        )}\n+      </div>}\n+      {!serverConfigStore.getValue().enableCohortBuilderV2 && <div style={styles.buttonContainer}>\n         <Button type='link'\n           style={{...styles.button, color: colors.dark, fontSize: '14px'}}\n           onClick={() => close()}>\n           Cancel\n         </Button>\n         {this.showNext && <Button type='primary' onClick={() => setView('modifiers')}\n           style={styles.button}\n-          disabled={selections.length === 0}>\n+          disabled={!criteria || criteria.length === 0}>", "originalCommit": "71a8d0d31c19072ca499604401001c06bab7d601", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwMTI4OA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457601288", "bodyText": "Same as above, need to revert this", "author": "dolbeew", "createdAt": "2020-07-20T18:14:37Z", "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -193,10 +204,10 @@ export class SelectionList extends React.Component<Props> {\n         </Button>}\n         <Button type='primary' onClick={() => finish()}\n           style={styles.button}\n-          disabled={selections.length === 0 || disableFinish}>\n+          disabled={!criteria || criteria.length === 0 || disableFinish}>", "originalCommit": "71a8d0d31c19072ca499604401001c06bab7d601", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyMTMzNA==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457621334", "bodyText": "May need to tweak/add some styles here to match the mock, can do in the follow-up PR if you prefer. Looks like mainly the check icon is too big and increases the the total height of the growl", "author": "dolbeew", "createdAt": "2020-07-20T18:51:21Z", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -104,7 +104,51 @@ interface State {\n   treeSearchTerms: string;\n }\n \n+const css = `", "originalCommit": "1d2956d71e4038701b888ffed1883c2eca75bc42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzMDg1MQ==", "url": "https://github.com/all-of-us/workbench/pull/3788#discussion_r457630851", "bodyText": "I'll take care of this in follow-up PR for criteria pop up", "author": "NehaBroad", "createdAt": "2020-07-20T19:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyMTMzNA=="}], "type": "inlineReview"}, {"oid": "dd147e82381c7d365907f56ddb2438c804b6fe5a", "url": "https://github.com/all-of-us/workbench/commit/dd147e82381c7d365907f56ddb2438c804b6fe5a", "message": "Revert style and use selections", "committedDate": "2020-07-20T19:06:44Z", "type": "commit"}]}