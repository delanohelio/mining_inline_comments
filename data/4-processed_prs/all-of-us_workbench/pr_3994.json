{"pr_number": 3994, "pr_title": "[RW-5398][risk=no] Show sidebar icon for runtime", "pr_createdAt": "2020-09-11T18:18:57Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3994", "timeline": [{"oid": "7361d3ed1fbb8e4a58758cbfa2edbbee12fd711a", "url": "https://github.com/all-of-us/workbench/commit/7361d3ed1fbb8e4a58758cbfa2edbbee12fd711a", "message": "I'm siiiiinging in the rain", "committedDate": "2020-09-11T14:26:53Z", "type": "commit"}, {"oid": "78560b8b42e050da4141da640b6be71fedb597ca", "url": "https://github.com/all-of-us/workbench/commit/78560b8b42e050da4141da640b6be71fedb597ca", "message": "show only when OWNER, WRITER", "committedDate": "2020-09-11T18:22:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyMjI0OA==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487222248", "bodyText": "It looks sort of grayed out - is the opacity the issue?", "author": "calbach", "createdAt": "2020-09-11T18:38:30Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -237,6 +248,25 @@ const icons = (helpContentKey: string) => {\n       style: {fontSize: '20px', marginLeft: '3px'},\n       tooltip: 'Annotations',\n     }];\n+  if (\n+    enableCustomRuntimes\n+    && (\n+      workspaceAccessLevel === WorkspaceAccessLevel.OWNER\n+      || workspaceAccessLevel === WorkspaceAccessLevel.WRITER\n+    )\n+  ) {\n+    return [...iconsList, {\n+      id: 'thunderstorm',\n+      disabled: true,\n+      faIcon: null,\n+      label: 'Cloud Icon',\n+      page: null,\n+      style: {height: '22px', width: '22px', marginTop: '0.25rem', opacity: 0.5},", "originalCommit": "78560b8b42e050da4141da640b6be71fedb597ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyNzM4Ng==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487227386", "bodyText": "Ah, yes, it is. I initially assumed it had to do with the disabled attribute. I can make it actually condition on that or I can just not since it's behind a feature flag and we're about to implement the panel content anyways", "author": "als364", "createdAt": "2020-09-11T18:49:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyMjI0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMTA5MQ==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487231091", "bodyText": "Yeah - I think just drop it and make this undisabled, looks like some other styling gets added if the icon is disabled, though I don't totally follow the code.\nI also think there's an argument to make the disabled status contingent on writer access, rather than hiding the icon. This isn't clearly spec'd out in the PRD or mocks, but I think most of our existing UI patterns disable the control if you lack permissions.", "author": "calbach", "createdAt": "2020-09-11T18:57:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyMjI0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNjY1OA==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487236658", "bodyText": "The styling is just changing the cursor to a circle with a slash through it.\nI agree that there's an argument for conditioning the disabled status on writer access rather than hiding the icon, but I did run this by both Shimon and Lou and they both prefer to have the icon hidden if the user isn't at least a writer.", "author": "als364", "createdAt": "2020-09-11T19:09:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyMjI0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0NDA3Ng==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487244076", "bodyText": "OK, cool, didn't realize you had already covered this with Lou and Shimon. Sounds good - then I'd just hardcode it to disabled: false for now and drop the opacity styling.", "author": "calbach", "createdAt": "2020-09-11T19:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyMjI0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyMjY3Mg==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487222672", "bodyText": "nit: can use this canWrite util: \n  \n    \n      workbench/ui/src/app/utils/workspace-permissions.ts\n    \n    \n         Line 4\n      in\n      28f2caa\n    \n    \n    \n    \n\n        \n          \n           export function canWrite(accessLevel: WorkspaceAccessLevel) {", "author": "calbach", "createdAt": "2020-09-11T18:39:20Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -237,6 +248,25 @@ const icons = (helpContentKey: string) => {\n       style: {fontSize: '20px', marginLeft: '3px'},\n       tooltip: 'Annotations',\n     }];\n+  if (\n+    enableCustomRuntimes\n+    && (\n+      workspaceAccessLevel === WorkspaceAccessLevel.OWNER", "originalCommit": "78560b8b42e050da4141da640b6be71fedb597ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e6a8399c9766f2413bb1d0e385147308a589dfc1", "url": "https://github.com/all-of-us/workbench/commit/e6a8399c9766f2413bb1d0e385147308a589dfc1", "message": "reverse greyed out icon", "committedDate": "2020-09-11T19:05:44Z", "type": "commit"}, {"oid": "216ca2955a2211ec81fcede464df9b447fd44c26", "url": "https://github.com/all-of-us/workbench/commit/216ca2955a2211ec81fcede464df9b447fd44c26", "message": "disabled=false", "committedDate": "2020-09-11T19:22:00Z", "type": "commit"}, {"oid": "4b01565f92d3b09a7b85abeb105a95d088eed7fc", "url": "https://github.com/all-of-us/workbench/commit/4b01565f92d3b09a7b85abeb105a95d088eed7fc", "message": "lint", "committedDate": "2020-09-11T19:53:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1OTA1OA==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487259058", "bodyText": "Was this a bug?\nalso nit: !icon.disabled seems more natural", "author": "calbach", "createdAt": "2020-09-11T19:53:35Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -515,12 +541,12 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n       return <React.Fragment>\n         <div style={notebookStyles ? {...styles.iconContainer, ...styles.notebookOverrides} : {...styles.iconContainer}}>\n           {!criteria && this.renderWorkspaceMenu()}\n-          {icons(helpContentKey).map((icon, i) =>\n+          {icons(helpContentKey, serverConfigStore.getValue().enableCustomRuntimes, workspace.accessLevel).map((icon, i) =>\n           this.showIcon(icon) && <div key={i} style={{display: 'table'}}>\n                 <TooltipTrigger content={<div>{tooltipId === i && icon.tooltip}</div>} side='left'>\n                   <div style={activeIcon === icon.id ? iconStyles.active : icon.disabled ? iconStyles.disabled : styles.icon}\n                        onClick={() => {\n-                         if (icon.id !== 'dataDictionary') {\n+                         if (icon.id !== 'dataDictionary' && icon.disabled === false) {", "originalCommit": "216ca2955a2211ec81fcede464df9b447fd44c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2MjQ1Mw==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487262453", "bodyText": "Yeah - it was opening on click even when disabled", "author": "als364", "createdAt": "2020-09-11T20:00:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1OTA1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2MTg1MA==", "url": "https://github.com/all-of-us/workbench/pull/3994#discussion_r487261850", "bodyText": "Adding a test case which demonstrates that this is only shown for writable workspaces would be nice, to exercise this branch", "author": "calbach", "createdAt": "2020-09-11T19:59:13Z", "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -237,6 +250,19 @@ const icons = (helpContentKey: string) => {\n       style: {fontSize: '20px', marginLeft: '3px'},\n       tooltip: 'Annotations',\n     }];\n+  if (enableCustomRuntimes && canWrite(workspaceAccessLevel)) {", "originalCommit": "4b01565f92d3b09a7b85abeb105a95d088eed7fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5610a31a7d1e672be6e6b5e29f71c22ba7697e18", "url": "https://github.com/all-of-us/workbench/commit/5610a31a7d1e672be6e6b5e29f71c22ba7697e18", "message": "test case, some test dewonkifying", "committedDate": "2020-09-11T20:25:29Z", "type": "commit"}, {"oid": "c5b2c4a69742fa654deef9c89a71d9f1e7ebdf44", "url": "https://github.com/all-of-us/workbench/commit/c5b2c4a69742fa654deef9c89a71d9f1e7ebdf44", "message": "other more better test case", "committedDate": "2020-09-11T20:29:08Z", "type": "commit"}, {"oid": "2bb66192654d813b2320628a79878c530d5781f7", "url": "https://github.com/all-of-us/workbench/commit/2bb66192654d813b2320628a79878c530d5781f7", "message": "boolean land", "committedDate": "2020-09-11T20:29:38Z", "type": "commit"}]}