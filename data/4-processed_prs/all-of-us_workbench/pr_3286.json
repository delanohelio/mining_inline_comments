{"pr_number": 3286, "pr_title": "[RW-4561][risk=no] factor out pdf viewer", "pr_createdAt": "2020-03-23T13:41:07Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3286", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3NjYwNg==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396476606", "bodyText": "nit: check the IDE settings to insert a newline before EOF", "author": "jaycarlton", "createdAt": "2020-03-23T14:07:38Z", "path": "ui/src/app/components/pdf-viewer.spec.tsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import {shallow} from 'enzyme';\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {PdfViewer, Props} from 'app/components/pdf-viewer';\n+\n+let props = {\n+  windowSize: {width: 1700, height: 0},\n+  pdfPath: '/assets/documents/fake-document-path.pdf'\n+};\n+\n+it('should load PDF pages', async() => {\n+  const wrapper = shallow(<PdfViewer {...props} />).shallow();\n+\n+  // Initially we should have a document and no pages.\n+  expect(wrapper.find(Document).length).toEqual(1);\n+  expect(wrapper.find(Page).length).toEqual(0);\n+\n+  // Simulate the PDF document loading and calling the 'onLoadSuccess' prop to indicate we have\n+  // 10 pages in the PDF.\n+  const pdfDocument = wrapper.find(Document);\n+  const onSuccess = pdfDocument.prop('onLoadSuccess') as (data: object) => {};\n+  onSuccess({numPages: 10});\n+\n+  // We should now be rendering a <Page> component for each of the pages.\n+  expect(wrapper.find(Page).length).toEqual(10);\n+});", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3ODI1MQ==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396478251", "bodyText": "thinking out loud: Is there a way to test actual content on the pages? This kinda feels like we're saying \"there are 10 pages. How many pages are there? 10? good.\" Not sure how much is really getting covered by this test I guess, but it may be all you can really do here.", "author": "jaycarlton", "createdAt": "2020-03-23T14:10:03Z", "path": "ui/src/app/components/pdf-viewer.spec.tsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import {shallow} from 'enzyme';\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {PdfViewer, Props} from 'app/components/pdf-viewer';\n+\n+let props = {\n+  windowSize: {width: 1700, height: 0},\n+  pdfPath: '/assets/documents/fake-document-path.pdf'\n+};\n+\n+it('should load PDF pages', async() => {\n+  const wrapper = shallow(<PdfViewer {...props} />).shallow();\n+\n+  // Initially we should have a document and no pages.\n+  expect(wrapper.find(Document).length).toEqual(1);\n+  expect(wrapper.find(Page).length).toEqual(0);\n+\n+  // Simulate the PDF document loading and calling the 'onLoadSuccess' prop to indicate we have\n+  // 10 pages in the PDF.\n+  const pdfDocument = wrapper.find(Document);\n+  const onSuccess = pdfDocument.prop('onLoadSuccess') as (data: object) => {};\n+  onSuccess({numPages: 10});", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5MTMzNA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396491334", "bodyText": "I could ingest the blob, I guess, but there's not much value in that. what I should really test is that the callback is getting called when we scroll all the way to the bottom.", "author": "als364", "createdAt": "2020-03-23T14:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3ODI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzNDg2OA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r397234868", "bodyText": "ah, looking at the test for the parent component, it seems like it tests some of this functionality, and the rest is covered by E2E tests.", "author": "als364", "createdAt": "2020-03-24T15:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3ODI1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3ODk5NA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396478994", "bodyText": "Could you have a /test/assets/documents/pdf1.pdf or something and test with a real doc?", "author": "jaycarlton", "createdAt": "2020-03-23T14:11:02Z", "path": "ui/src/app/components/pdf-viewer.spec.tsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import {shallow} from 'enzyme';\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {PdfViewer, Props} from 'app/components/pdf-viewer';\n+\n+let props = {\n+  windowSize: {width: 1700, height: 0},\n+  pdfPath: '/assets/documents/fake-document-path.pdf'", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MDA5MA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396480090", "bodyText": "aside: why isn't this the preferred way to do all the styles? Just a TSX style thing?", "author": "jaycarlton", "createdAt": "2020-03-23T14:12:35Z", "path": "ui/src/app/components/pdf-viewer.tsx", "diffHunk": "@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {withWindowSize} from 'app/utils';\n+\n+export interface Props {\n+  handleLastPageRender: () => void;\n+  pdfPath: string;\n+  setLastPageRef: (ref) => void;\n+  windowSize: {\n+    width: number,\n+    height: number\n+  };\n+}\n+\n+interface State {\n+  loading: boolean;\n+  numPages: number;\n+}\n+\n+export const PdfViewer = withWindowSize()( class extends React.Component<Props, State> {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {\n+      loading: true,\n+      numPages: 0\n+    };\n+  }\n+\n+  render() {\n+    const {loading, numPages} = this.state;\n+\n+    return <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n+      {loading && <SpinnerOverlay/>}\n+      <Document data-test-id='tos-pdf-document'\n+                file={this.props.pdfPath}\n+                loading=''\n+                onLoadSuccess={\n+                  data => this.setState({numPages: data.numPages, loading: false})\n+                }\n+      >\n+        {\n+          Array.from(\n+            new Array(numPages),\n+            (el, index) => (\n+                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n+                  // className and specify some style overrides in src/styles.css", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzODk5OQ==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396538999", "bodyText": "No idea. I just factored this out.", "author": "als364", "createdAt": "2020-03-23T15:30:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MDA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MTMxNA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396481314", "bodyText": "It's not obvious by the name inputRef that it has to do with last page handling. Are you just using this property assignment for its side effect of calling setLastPageRef()?", "author": "jaycarlton", "createdAt": "2020-03-23T14:14:09Z", "path": "ui/src/app/components/pdf-viewer.tsx", "diffHunk": "@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {withWindowSize} from 'app/utils';\n+\n+export interface Props {\n+  handleLastPageRender: () => void;\n+  pdfPath: string;\n+  setLastPageRef: (ref) => void;\n+  windowSize: {\n+    width: number,\n+    height: number\n+  };\n+}\n+\n+interface State {\n+  loading: boolean;\n+  numPages: number;\n+}\n+\n+export const PdfViewer = withWindowSize()( class extends React.Component<Props, State> {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {\n+      loading: true,\n+      numPages: 0\n+    };\n+  }\n+\n+  render() {\n+    const {loading, numPages} = this.state;\n+\n+    return <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n+      {loading && <SpinnerOverlay/>}\n+      <Document data-test-id='tos-pdf-document'\n+                file={this.props.pdfPath}\n+                loading=''\n+                onLoadSuccess={\n+                  data => this.setState({numPages: data.numPages, loading: false})\n+                }\n+      >\n+        {\n+          Array.from(\n+            new Array(numPages),\n+            (el, index) => (\n+                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n+                  // className and specify some style overrides in src/styles.css\n+                  <Page\n+                      renderAnnotationLayer={false}\n+                      renderTextLayer={false}\n+                      loading=''\n+                      className='tos-pdf-page'\n+                      width={Math.max(500, this.props.windowSize.width * .75)}\n+                      key={`page_${index + 1}`}\n+                      pageNumber={index + 1}\n+                      inputRef={index === numPages - 1", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNjgxNg==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396516816", "bodyText": "Yes, it's non-obvious, but that's what Page calls it, and that's not a Workbench component.", "author": "als364", "createdAt": "2020-03-23T15:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MTMxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MjI0NQ==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396482245", "bodyText": "nit: it feels redundant to have an index, a page number, and a key like page_99. Do we really need all three? If so, it would help to have unit tests to make sure they are always in sync.", "author": "jaycarlton", "createdAt": "2020-03-23T14:15:28Z", "path": "ui/src/app/components/pdf-viewer.tsx", "diffHunk": "@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {withWindowSize} from 'app/utils';\n+\n+export interface Props {\n+  handleLastPageRender: () => void;\n+  pdfPath: string;\n+  setLastPageRef: (ref) => void;\n+  windowSize: {\n+    width: number,\n+    height: number\n+  };\n+}\n+\n+interface State {\n+  loading: boolean;\n+  numPages: number;\n+}\n+\n+export const PdfViewer = withWindowSize()( class extends React.Component<Props, State> {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {\n+      loading: true,\n+      numPages: 0\n+    };\n+  }\n+\n+  render() {\n+    const {loading, numPages} = this.state;\n+\n+    return <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n+      {loading && <SpinnerOverlay/>}\n+      <Document data-test-id='tos-pdf-document'\n+                file={this.props.pdfPath}\n+                loading=''\n+                onLoadSuccess={\n+                  data => this.setState({numPages: data.numPages, loading: false})\n+                }\n+      >\n+        {\n+          Array.from(\n+            new Array(numPages),\n+            (el, index) => (\n+                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n+                  // className and specify some style overrides in src/styles.css\n+                  <Page\n+                      renderAnnotationLayer={false}\n+                      renderTextLayer={false}\n+                      loading=''\n+                      className='tos-pdf-page'\n+                      width={Math.max(500, this.props.windowSize.width * .75)}\n+                      key={`page_${index + 1}`}", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNzM1NA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396517354", "bodyText": "We do, they're all required and Page is not a Workbench component.", "author": "als364", "createdAt": "2020-03-23T15:01:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MjI0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MjgxNQ==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396482815", "bodyText": "What's the difference between {false} and false?", "author": "jaycarlton", "createdAt": "2020-03-23T14:16:15Z", "path": "ui/src/app/components/pdf-viewer.tsx", "diffHunk": "@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {withWindowSize} from 'app/utils';\n+\n+export interface Props {\n+  handleLastPageRender: () => void;\n+  pdfPath: string;\n+  setLastPageRef: (ref) => void;\n+  windowSize: {\n+    width: number,\n+    height: number\n+  };\n+}\n+\n+interface State {\n+  loading: boolean;\n+  numPages: number;\n+}\n+\n+export const PdfViewer = withWindowSize()( class extends React.Component<Props, State> {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {\n+      loading: true,\n+      numPages: 0\n+    };\n+  }\n+\n+  render() {\n+    const {loading, numPages} = this.state;\n+\n+    return <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n+      {loading && <SpinnerOverlay/>}\n+      <Document data-test-id='tos-pdf-document'\n+                file={this.props.pdfPath}\n+                loading=''\n+                onLoadSuccess={\n+                  data => this.setState({numPages: data.numPages, loading: false})\n+                }\n+      >\n+        {\n+          Array.from(\n+            new Array(numPages),\n+            (el, index) => (\n+                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n+                  // className and specify some style overrides in src/styles.css\n+                  <Page\n+                      renderAnnotationLayer={false}", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNzg4NQ==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396517885", "bodyText": "that is how one passes values. some of the rest of these are a bit wrong.", "author": "als364", "createdAt": "2020-03-23T15:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4MjgxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4NDIzMg==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396484232", "bodyText": "nit: I'd spell out terms-of-service or make it more general like pdf-page. That is, is there anything TOS-specific about this component?", "author": "jaycarlton", "createdAt": "2020-03-23T14:18:11Z", "path": "ui/src/app/components/pdf-viewer.tsx", "diffHunk": "@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {withWindowSize} from 'app/utils';\n+\n+export interface Props {\n+  handleLastPageRender: () => void;\n+  pdfPath: string;\n+  setLastPageRef: (ref) => void;\n+  windowSize: {\n+    width: number,\n+    height: number\n+  };\n+}\n+\n+interface State {\n+  loading: boolean;\n+  numPages: number;\n+}\n+\n+export const PdfViewer = withWindowSize()( class extends React.Component<Props, State> {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {\n+      loading: true,\n+      numPages: 0\n+    };\n+  }\n+\n+  render() {\n+    const {loading, numPages} = this.state;\n+\n+    return <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n+      {loading && <SpinnerOverlay/>}\n+      <Document data-test-id='tos-pdf-document'\n+                file={this.props.pdfPath}\n+                loading=''\n+                onLoadSuccess={\n+                  data => this.setState({numPages: data.numPages, loading: false})\n+                }\n+      >\n+        {\n+          Array.from(\n+            new Array(numPages),\n+            (el, index) => (\n+                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n+                  // className and specify some style overrides in src/styles.css\n+                  <Page\n+                      renderAnnotationLayer={false}\n+                      renderTextLayer={false}\n+                      loading=''\n+                      className='tos-pdf-page'", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNzQ0NA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396517444", "bodyText": "ooh good call", "author": "als364", "createdAt": "2020-03-23T15:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4NDIzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4NDg3Mw==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396484873", "bodyText": "instead of undefined, could you define a stub method to just demonstrate that it gets called and nothing happens? That feels safer too, since you don't have to test for undefined before calling.", "author": "jaycarlton", "createdAt": "2020-03-23T14:19:06Z", "path": "ui/src/app/components/pdf-viewer.tsx", "diffHunk": "@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import {Document, Page} from 'react-pdf';\n+\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {withWindowSize} from 'app/utils';\n+\n+export interface Props {\n+  handleLastPageRender: () => void;\n+  pdfPath: string;\n+  setLastPageRef: (ref) => void;\n+  windowSize: {\n+    width: number,\n+    height: number\n+  };\n+}\n+\n+interface State {\n+  loading: boolean;\n+  numPages: number;\n+}\n+\n+export const PdfViewer = withWindowSize()( class extends React.Component<Props, State> {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {\n+      loading: true,\n+      numPages: 0\n+    };\n+  }\n+\n+  render() {\n+    const {loading, numPages} = this.state;\n+\n+    return <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n+      {loading && <SpinnerOverlay/>}\n+      <Document data-test-id='tos-pdf-document'\n+                file={this.props.pdfPath}\n+                loading=''\n+                onLoadSuccess={\n+                  data => this.setState({numPages: data.numPages, loading: false})\n+                }\n+      >\n+        {\n+          Array.from(\n+            new Array(numPages),\n+            (el, index) => (\n+                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n+                  // className and specify some style overrides in src/styles.css\n+                  <Page\n+                      renderAnnotationLayer={false}\n+                      renderTextLayer={false}\n+                      loading=''\n+                      className='tos-pdf-page'\n+                      width={Math.max(500, this.props.windowSize.width * .75)}\n+                      key={`page_${index + 1}`}\n+                      pageNumber={index + 1}\n+                      inputRef={index === numPages - 1\n+                          ? (ref) => this.props.setLastPageRef(ref)\n+                          : undefined\n+                      }\n+                      onRenderSuccess={index === numPages - 1\n+                          ? () => this.props.handleLastPageRender()\n+                          : undefined", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4NTI1MA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396485250", "bodyText": "nit: check indent", "author": "jaycarlton", "createdAt": "2020-03-23T14:19:37Z", "path": "ui/src/app/pages/login/account-creation/account-creation-tos.tsx", "diffHunk": "@@ -82,7 +80,7 @@ export const AccountCreationTos = withWindowSize()(\n       }\n       this.hasCreatedIntersectionObserver = true;\n       const intersectionCallback: IntersectionObserverCallback = (\n-        entries: IntersectionObserverEntry[], unusedObserver: IntersectionObserver) => {\n+          entries: IntersectionObserverEntry[], unusedObserver: IntersectionObserver) => {", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4NzcyMA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r396487720", "bodyText": "very nice \ud83d\udcaf", "author": "jaycarlton", "createdAt": "2020-03-23T14:22:47Z", "path": "ui/src/app/pages/login/account-creation/account-creation-tos.tsx", "diffHunk": "@@ -93,44 +91,21 @@ export const AccountCreationTos = withWindowSize()(\n       observer.observe(this.lastPage);\n     }\n \n+    private setLastPageRef(ref) {\n+      this.lastPage = ref;\n+    }\n+\n     render() {\n-      const {numPages, loadingPdf, hasReadEntireTos, hasAckedTermsOfService, hasAckedPrivacyStatement} = this.state;\n+      const {hasReadEntireTos, hasAckedTermsOfService, hasAckedPrivacyStatement} = this.state;\n \n       return <FlexColumn data-test-id='account-creation-tos'\n                          style={{flex: 1, padding: '1rem 3rem 0 3rem'}}>\n-        {/* TODO: all of this PDF rendering stuff should be broken out into a separate component. */}\n-        <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n-          {loadingPdf && <SpinnerOverlay/>}\n-          <Document data-test-id='tos-pdf-document' file={this.props.pdfPath}\n-                    loading=''\n-                    onLoadSuccess={data => this.setState(\n-                      {numPages: data.numPages, loadingPdf: false})}\n-          >\n-            {\n-              Array.from(\n-                new Array(numPages),\n-                (el, index) => (\n-                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n-                  // className and specify some style overrides in src/styles.css\n-                  <Page\n-                    renderAnnotationLayer={false}\n-                    renderTextLayer={false}\n-                    loading=''\n-                    className='tos-pdf-page'\n-                    width={Math.max(500, this.props.windowSize.width * .75)}\n-                    key={`page_${index + 1}`}\n-                    pageNumber={index + 1}\n-                    inputRef={index === numPages - 1 ? (ref) => {\n-                      this.lastPage = ref;\n-                    } : undefined}\n-                    onRenderSuccess={index === numPages - 1 ? () => this.handleLastPageRender() :\n-                      undefined}\n-                  />\n-                ),\n-              )\n-            }\n-          </Document>\n-        </div>\n+        <PdfViewer", "originalCommit": "4c98e0ee90e9612d7ce690af2a335e926611572c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MzIyMw==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r397253223", "bodyText": "Is it necessary to pass in the windowSize if we're using withWindowSize() in the component? Or we can keep this and remove the withWindowSize()", "author": "ericsong", "createdAt": "2020-03-24T15:41:45Z", "path": "ui/src/app/pages/login/account-creation/account-creation-tos.tsx", "diffHunk": "@@ -93,44 +93,21 @@ export const AccountCreationTos = withWindowSize()(\n       observer.observe(this.lastPage);\n     }\n \n+    private setLastPageRef(ref) {\n+      this.lastPage = ref;\n+    }\n+\n     render() {\n-      const {numPages, loadingPdf, hasReadEntireTos, hasAckedTermsOfService, hasAckedPrivacyStatement} = this.state;\n+      const {hasReadEntireTos, hasAckedTermsOfService, hasAckedPrivacyStatement} = this.state;\n \n       return <FlexColumn data-test-id='account-creation-tos'\n                          style={{flex: 1, padding: '1rem 3rem 0 3rem'}}>\n-        {/* TODO: all of this PDF rendering stuff should be broken out into a separate component. */}\n-        <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n-          {loadingPdf && <SpinnerOverlay/>}\n-          <Document data-test-id='tos-pdf-document' file={this.props.pdfPath}\n-                    loading=''\n-                    onLoadSuccess={data => this.setState(\n-                      {numPages: data.numPages, loadingPdf: false})}\n-          >\n-            {\n-              Array.from(\n-                new Array(numPages),\n-                (el, index) => (\n-                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n-                  // className and specify some style overrides in src/styles.css\n-                  <Page\n-                    renderAnnotationLayer={false}\n-                    renderTextLayer={false}\n-                    loading=''\n-                    className='tos-pdf-page'\n-                    width={Math.max(500, this.props.windowSize.width * .75)}\n-                    key={`page_${index + 1}`}\n-                    pageNumber={index + 1}\n-                    inputRef={index === numPages - 1 ? (ref) => {\n-                      this.lastPage = ref;\n-                    } : undefined}\n-                    onRenderSuccess={index === numPages - 1 ? () => this.handleLastPageRender() :\n-                      undefined}\n-                  />\n-                ),\n-              )\n-            }\n-          </Document>\n-        </div>\n+        <PdfViewer\n+            handleLastPageRender={() => this.handleLastPageRender()}\n+            pdfPath={this.props.pdfPath}\n+            setLastPageRef={(ref) => this.setLastPageRef(ref)}\n+            windowSize={this.props.windowSize}", "originalCommit": "087bc58130ab1f2ddb77f006c0d2d6ebe6f0b544", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1NTEzMg==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r397255132", "bodyText": "the rest of the stuff in handleLastPageRender() looks like stuff that might be able to go into the shared component.\nI don't fully understand how it works but I think, ultimately, components that use the PdfViewer component just want to know when the user has read the entire PDF and not concern themselves with stuff like IntersectionObserverCallback.", "author": "ericsong", "createdAt": "2020-03-24T15:44:07Z", "path": "ui/src/app/pages/login/account-creation/account-creation-tos.tsx", "diffHunk": "@@ -82,7 +80,9 @@ export const AccountCreationTos = withWindowSize()(\n       }\n       this.hasCreatedIntersectionObserver = true;\n       const intersectionCallback: IntersectionObserverCallback = (\n-        entries: IntersectionObserverEntry[], unusedObserver: IntersectionObserver) => {\n+        entries: IntersectionObserverEntry[],", "originalCommit": "087bc58130ab1f2ddb77f006c0d2d6ebe6f0b544", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ5OTU1NA==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r397499554", "bodyText": "Per slack discussion, it appears that in order to trigger the event property you need to call simulate() on the input rather than the CheckBox element.", "author": "calbach", "createdAt": "2020-03-24T22:27:03Z", "path": "ui/src/app/pages/login/account-creation/account-creation-tos.spec.tsx", "diffHunk": "@@ -71,14 +48,15 @@ it('should enable checkboxes and next button with user input', async() => {\n   expect(getNextButton(wrapper).prop('disabled')).toBeTruthy();\n \n   // Now, simulate checking both boxes, which should enable the \"next\" button.\n+  debugger;\n   getPrivacyCheckbox(wrapper).simulate('change', {target: {checked: true}});", "originalCommit": "0212513c54ab8813192c3a5c87358eb9985a40af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b77e528d62ec75f2b7718fb822717c1f483ef8e1", "url": "https://github.com/all-of-us/workbench/commit/b77e528d62ec75f2b7718fb822717c1f483ef8e1", "message": "factor out pdf viewer", "committedDate": "2020-03-26T14:31:12Z", "type": "commit"}, {"oid": "a20a06832b3849f95ad3a0a765649fcda33b0e7b", "url": "https://github.com/all-of-us/workbench/commit/a20a06832b3849f95ad3a0a765649fcda33b0e7b", "message": "update E2E tests, some more review feedback", "committedDate": "2020-03-26T14:31:12Z", "type": "commit"}, {"oid": "75a72518b5ade4b81bd90da446b45f7b51dff7c2", "url": "https://github.com/all-of-us/workbench/commit/75a72518b5ade4b81bd90da446b45f7b51dff7c2", "message": "ok add e2e tests for real", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"oid": "f907c3f8d1d32f4bf0d218d5240fa77e8af1bb5f", "url": "https://github.com/all-of-us/workbench/commit/f907c3f8d1d32f4bf0d218d5240fa77e8af1bb5f", "message": "revert sign-in-step change for testing", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"oid": "4c9a384ce7ff23c61355472a277a42ee95acf125", "url": "https://github.com/all-of-us/workbench/commit/4c9a384ce7ff23c61355472a277a42ee95acf125", "message": "fixed most of the things", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"oid": "5dff3a5b3d55c95ec6e29051e07feec4eed053d3", "url": "https://github.com/all-of-us/workbench/commit/5dff3a5b3d55c95ec6e29051e07feec4eed053d3", "message": "debug statements for... debugging", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"oid": "c0cb6df157ba520f5f5343adb4088c4e6935cae4", "url": "https://github.com/all-of-us/workbench/commit/c0cb6df157ba520f5f5343adb4088c4e6935cae4", "message": "CheckBox -> input", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"oid": "7776c26671fc6eb80c76d198b953d5f9c8df84a3", "url": "https://github.com/all-of-us/workbench/commit/7776c26671fc6eb80c76d198b953d5f9c8df84a3", "message": "remove debugger statements", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"oid": "77803f65a3833cfccb35ef2fd996f7caf97cda95", "url": "https://github.com/all-of-us/workbench/commit/77803f65a3833cfccb35ef2fd996f7caf97cda95", "message": "move handlelastpagerender into pdf-viewer", "committedDate": "2020-03-26T14:32:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMDczNQ==", "url": "https://github.com/all-of-us/workbench/pull/3286#discussion_r398620735", "bodyText": "Nice! This interface looks super easy to use.", "author": "ericsong", "createdAt": "2020-03-26T14:34:13Z", "path": "ui/src/app/pages/login/account-creation/account-creation-tos.tsx", "diffHunk": "@@ -51,137 +49,79 @@ interface AccountCreationTosState {\n   numPages: number;\n }\n \n-export const AccountCreationTos = withWindowSize()(\n-  class extends React.Component<AccountCreationTosProps, AccountCreationTosState> {\n+export class AccountCreationTos extends React.Component<\n+  AccountCreationTosProps,\n+  AccountCreationTosState\n+> {\n+  constructor(props: AccountCreationTosProps) {\n+    super(props);\n+    this.state = {\n+      hasReadEntireTos: false,\n+      hasAckedPrivacyStatement: false,\n+      hasAckedTermsOfService: false,\n+      loadingPdf: true,\n+      numPages: 0,\n+    };\n+  }\n \n-    // Tracks whether this component has created an intersection observer to track the last page\n-    // visibility yet.\n-    hasCreatedIntersectionObserver = false;\n-    // Once the last page has been loaded, this contains a reference to the page's DOM element.\n-    lastPage: HTMLElement;\n+  render() {\n+    const {hasReadEntireTos, hasAckedTermsOfService, hasAckedPrivacyStatement} = this.state;\n \n-    constructor(props: AccountCreationTosProps) {\n-      super(props);\n-      this.state = {\n-        hasReadEntireTos: false,\n-        hasAckedPrivacyStatement: false,\n-        hasAckedTermsOfService: false,\n-        loadingPdf: true,\n-        numPages: 0,\n-      };\n-    }\n-\n-    /**\n-     * Handles the onRenderSuccess callback from the Page element at the end of the document.\n-     * This sets up the intersection listener which will change state when the user scrolls to the\n-     * end of the document.\n-     */\n-    private handleLastPageRender() {\n-      if (this.hasCreatedIntersectionObserver) {\n-        return;\n-      }\n-      this.hasCreatedIntersectionObserver = true;\n-      const intersectionCallback: IntersectionObserverCallback = (\n-        entries: IntersectionObserverEntry[], unusedObserver: IntersectionObserver) => {\n-        for (const entry of entries) {\n-          if (entry.isIntersecting) {\n-            this.setState({hasReadEntireTos: true});\n-          }\n-        }\n-      };\n-      const observer = new IntersectionObserver(intersectionCallback);\n-      observer.observe(this.lastPage);\n-    }\n-\n-    render() {\n-      const {numPages, loadingPdf, hasReadEntireTos, hasAckedTermsOfService, hasAckedPrivacyStatement} = this.state;\n-\n-      return <FlexColumn data-test-id='account-creation-tos'\n-                         style={{flex: 1, padding: '1rem 3rem 0 3rem'}}>\n-        {/* TODO: all of this PDF rendering stuff should be broken out into a separate component. */}\n-        <div style={{flex: '1 1 0', overflowY: 'auto'}}>\n-          {loadingPdf && <SpinnerOverlay/>}\n-          <Document data-test-id='tos-pdf-document' file={this.props.pdfPath}\n-                    loading=''\n-                    onLoadSuccess={data => this.setState(\n-                      {numPages: data.numPages, loadingPdf: false})}\n-          >\n-            {\n-              Array.from(\n-                new Array(numPages),\n-                (el, index) => (\n-                  // We can't set inline styles on the react-pdf Page element, so instead we set a\n-                  // className and specify some style overrides in src/styles.css\n-                  <Page\n-                    renderAnnotationLayer={false}\n-                    renderTextLayer={false}\n-                    loading=''\n-                    className='tos-pdf-page'\n-                    width={Math.max(500, this.props.windowSize.width * .75)}\n-                    key={`page_${index + 1}`}\n-                    pageNumber={index + 1}\n-                    inputRef={index === numPages - 1 ? (ref) => {\n-                      this.lastPage = ref;\n-                    } : undefined}\n-                    onRenderSuccess={index === numPages - 1 ? () => this.handleLastPageRender() :\n-                      undefined}\n-                  />\n-                ),\n-              )\n-            }\n-          </Document>\n-        </div>\n-        <FlexRow\n-          style={{display: 'inline-flex', padding: '1rem', maxWidth: '1000px', margin: 'auto'}}>\n-          <div style={{flex: 3}}>\n-            <div style={{...styles.noticeText, marginBottom: '.5rem', height: '3rem'}}>\n-              <div style={{fontWeight: 400}}>\n-                By clicking here and moving to the Registration step, you acknowledge that you\n-                understand the terms of this agreement and agree to abide by them.\n-              </div>\n-              <div>\n-                Please read through the entire agreement to continue.\n-              </div>\n+    return <FlexColumn data-test-id='account-creation-tos'\n+                       style={{flex: 1, padding: '1rem 3rem 0 3rem'}}>\n+      <PdfViewer\n+          onLastPageRender={() => this.setState({hasReadEntireTos: true})}\n+          pdfPath={this.props.pdfPath}", "originalCommit": "87dcb3af23d4110237257e60fdc72270fff372f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "77803f65a3833cfccb35ef2fd996f7caf97cda95", "url": "https://github.com/all-of-us/workbench/commit/77803f65a3833cfccb35ef2fd996f7caf97cda95", "message": "move handlelastpagerender into pdf-viewer", "committedDate": "2020-03-26T14:32:20Z", "type": "forcePushed"}]}