{"pr_number": 3516, "pr_title": "[RW-4786][risk=no] Convert demographics to React", "pr_createdAt": "2020-05-01T04:52:14Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3516", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NTYxMg==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419695612", "bodyText": "Nit: Should use colors variables.", "author": "s-rubenstein", "createdAt": "2020-05-04T20:06:10Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE0MDM3NA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420140374", "bodyText": "Ah, missed that one. Fixed.", "author": "dolbeew", "createdAt": "2020-05-05T14:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NTYxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjIxNw==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419696217", "bodyText": "Can you type this as a React.Element or something? Just is there anything more specific than any you can use?", "author": "s-rubenstein", "createdAt": "2020-05-04T20:07:11Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMjE1MQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420232151", "bodyText": "Decided to separate into two new props and drop wizard since we were only using the type and count properties.", "author": "dolbeew", "createdAt": "2020-05-05T16:13:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjMzNw==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419696337", "bodyText": "Can these be typed as more specific than any?", "author": "s-rubenstein", "createdAt": "2020-05-04T20:07:23Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;\n+}\n+\n+interface State {\n+  ageType: any;", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNjUwMw==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420236503", "bodyText": "Typed ageType as AttrName but not sure there's a good option for ageTypeNodes. Would need to be something like\ninterface AgeTypeNodes {\n  [AttrName.AGE]: Array<AgeTypeCount>;\n  [AttrName.AGEATCONSENT]: Array<AgeTypeCount>;\n  [AttrName.AGEATCDR]: Array<AgeTypeCount>;\n}\n\nbut it didn't like enums as the property names.", "author": "dolbeew", "createdAt": "2020-05-05T16:19:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjMzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTI1OQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r423155259", "bodyText": "Got it. this is probably fine for now then.", "author": "s-rubenstein", "createdAt": "2020-05-11T16:14:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjU4MA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419696580", "bodyText": "Can this be typed as React.ReactNode or something? I think we have examples of other typings of elements elsewhere in code.", "author": "s-rubenstein", "createdAt": "2020-05-04T20:07:53Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;\n+}\n+\n+interface State {\n+  ageType: any;\n+  ageTypeNodes: any;\n+  calculating: boolean;\n+  count: number;\n+  loading: boolean;\n+  maxAge: string;\n+  minAge: string;\n+  nodes: Array<any>;\n+}\n+\n+export class Demographics extends React.Component<Props, State> {\n+  ageWrapper: HTMLDivElement;\n+  slider: any;", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NzIxOQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420247219", "bodyText": "This is the actual slider object, so ReactNode doesn't work. We only use the get and set methods, so setting the type to\n{\n  get: Function;\n  set: Function;\n}\n\nseems to work.", "author": "dolbeew", "createdAt": "2020-05-05T16:35:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTY5NA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r423155694", "bodyText": "You could do a more specific typing by doing:\nget: () => TYPE\nset: (TYPE) => {}\n(I think)", "author": "s-rubenstein", "createdAt": "2020-05-11T16:14:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1OTkyMg==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r424159922", "bodyText": "Ah, nice. Changed to\n{\n  get: () => Array<string>;\n  set: (values: Array<number>) => void;\n}", "author": "dolbeew", "createdAt": "2020-05-13T04:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NjU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NzAwNA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419697004", "bodyText": "I would probably rather type these as the enum itself, and then use toString at render time.", "author": "s-rubenstein", "createdAt": "2020-05-04T20:08:43Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMDU0NQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420230545", "bodyText": "Agreed. I was converting to string since they'll eventually need to be strings on the api call request, but makes more sense to use the enum here and just convert before adding to the request.", "author": "dolbeew", "createdAt": "2020-05-05T16:11:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NzAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NzEwNg==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419697106", "bodyText": "Is there a reason to store this as a string rather than the enum?", "author": "s-rubenstein", "createdAt": "2020-05-04T20:08:56Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;\n+}\n+\n+interface State {\n+  ageType: any;\n+  ageTypeNodes: any;\n+  calculating: boolean;\n+  count: number;\n+  loading: boolean;\n+  maxAge: string;\n+  minAge: string;\n+  nodes: Array<any>;\n+}\n+\n+export class Demographics extends React.Component<Props, State> {\n+  ageWrapper: HTMLDivElement;\n+  slider: any;\n+\n+  constructor(props: Props) {\n+    super(props);\n+    this.state = {\n+      ageType: AttrName.AGE.toString(),", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNzc3NQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420237775", "bodyText": "Dropped  .toString() since we're converting when adding to the request now.", "author": "dolbeew", "createdAt": "2020-05-05T16:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5NzEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5OTEwOA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419699108", "bodyText": "We have a code style preference to use await here, rather than .then. I have no clue if this has been broadcast to the y'all? (I think we talked about it at the eng sync?)\nSo this could be done as:\nconst ageTypeNodes = await cohortBuilderApi().findAgeTypeCounts(+cdrVersionId).items.reduce((acc, item) => {\nacc[item.ageType].push(item);\nreturn acc;\n}, initialValue);\nthis.setState({ageTypeNodes}, () => this.calculateAgeFromNodes());", "author": "s-rubenstein", "createdAt": "2020-05-04T20:12:37Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;\n+}\n+\n+interface State {\n+  ageType: any;\n+  ageTypeNodes: any;\n+  calculating: boolean;\n+  count: number;\n+  loading: boolean;\n+  maxAge: string;\n+  minAge: string;\n+  nodes: Array<any>;\n+}\n+\n+export class Demographics extends React.Component<Props, State> {\n+  ageWrapper: HTMLDivElement;\n+  slider: any;\n+\n+  constructor(props: Props) {\n+    super(props);\n+    this.state = {\n+      ageType: AttrName.AGE.toString(),\n+      ageTypeNodes: undefined,\n+      calculating: false,\n+      count: null,\n+      loading: true,\n+      maxAge: defaultMaxAge,\n+      minAge: defaultMinAge,\n+      nodes: undefined,\n+    };\n+  }\n+\n+  componentDidMount(): void {\n+    if (this.props.wizard.type === CriteriaType.AGE) {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.loadAgeNodesFromApi();\n+      } else {\n+        this.setState({loading: false});\n+      }\n+    } else {\n+      this.loadNodesFromApi();\n+    }\n+  }\n+\n+  componentDidUpdate(prevProps: Readonly<Props>): void {\n+    const {selections, wizard} = this.props;\n+    if (selections !== prevProps.selections && wizard.type !== CriteriaType.AGE) {\n+      this.calculate();\n+    }\n+  }\n+\n+  loadNodesFromApi() {\n+    const {selections, wizard} = this.props;\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    this.setState({loading: true});\n+    cohortBuilderApi().findCriteriaBy(+cdrVersionId, DomainType.PERSON.toString(), wizard.type).then(response => {\n+      const nodes = response.items\n+        .filter(item => item.parentId !== 0)\n+        .sort(sortByCountThenName)\n+        .map(node => ({...node, parameterId: `param${node.conceptId || node.code}`}));\n+      if (selections.length) {\n+        this.calculate(true);\n+      }\n+      this.setState({loading: false, nodes});\n+    });\n+  }\n+\n+  loadAgeNodesFromApi() {\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    const initialValue = {\n+      [AttrName.AGE.toString()]: [],\n+      [AttrName.AGEATCONSENT.toString()]: [],\n+      [AttrName.AGEATCDR.toString()]: []\n+    };\n+    cohortBuilderApi().findAgeTypeCounts(+cdrVersionId).then(response => {", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI2Nzk5Mw==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420267993", "bodyText": "Ok, good to know. Is there style guide somewhere? Seems like I've heard it mentioned but don't think I've seen the doc before.", "author": "dolbeew", "createdAt": "2020-05-05T17:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5OTEwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NjIxMA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r423156210", "bodyText": "Yes! The style guide is here: https://github.com/all-of-us/workbench/blob/master/ui/docs/style-guide.md", "author": "s-rubenstein", "createdAt": "2020-05-11T16:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5OTEwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1OTQyOQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r424159429", "bodyText": "Perfect, thanks!", "author": "dolbeew", "createdAt": "2020-05-13T03:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5OTEwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMjQ0NA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419702444", "bodyText": "Same as above, we want to try to prefer await statements rather than .then.", "author": "s-rubenstein", "createdAt": "2020-05-04T20:18:42Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;\n+}\n+\n+interface State {\n+  ageType: any;\n+  ageTypeNodes: any;\n+  calculating: boolean;\n+  count: number;\n+  loading: boolean;\n+  maxAge: string;\n+  minAge: string;\n+  nodes: Array<any>;\n+}\n+\n+export class Demographics extends React.Component<Props, State> {\n+  ageWrapper: HTMLDivElement;\n+  slider: any;\n+\n+  constructor(props: Props) {\n+    super(props);\n+    this.state = {\n+      ageType: AttrName.AGE.toString(),\n+      ageTypeNodes: undefined,\n+      calculating: false,\n+      count: null,\n+      loading: true,\n+      maxAge: defaultMaxAge,\n+      minAge: defaultMinAge,\n+      nodes: undefined,\n+    };\n+  }\n+\n+  componentDidMount(): void {\n+    if (this.props.wizard.type === CriteriaType.AGE) {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.loadAgeNodesFromApi();\n+      } else {\n+        this.setState({loading: false});\n+      }\n+    } else {\n+      this.loadNodesFromApi();\n+    }\n+  }\n+\n+  componentDidUpdate(prevProps: Readonly<Props>): void {\n+    const {selections, wizard} = this.props;\n+    if (selections !== prevProps.selections && wizard.type !== CriteriaType.AGE) {\n+      this.calculate();\n+    }\n+  }\n+\n+  loadNodesFromApi() {\n+    const {selections, wizard} = this.props;\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    this.setState({loading: true});\n+    cohortBuilderApi().findCriteriaBy(+cdrVersionId, DomainType.PERSON.toString(), wizard.type).then(response => {\n+      const nodes = response.items\n+        .filter(item => item.parentId !== 0)\n+        .sort(sortByCountThenName)\n+        .map(node => ({...node, parameterId: `param${node.conceptId || node.code}`}));\n+      if (selections.length) {\n+        this.calculate(true);\n+      }\n+      this.setState({loading: false, nodes});\n+    });\n+  }\n+\n+  loadAgeNodesFromApi() {\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    const initialValue = {\n+      [AttrName.AGE.toString()]: [],\n+      [AttrName.AGEATCONSENT.toString()]: [],\n+      [AttrName.AGEATCDR.toString()]: []\n+    };\n+    cohortBuilderApi().findAgeTypeCounts(+cdrVersionId).then(response => {\n+      const ageTypeNodes = response.items.reduce((acc, item) => {\n+        acc[item.ageType].push(item);\n+        return acc;\n+      }, initialValue);\n+      this.setState({ageTypeNodes}, () => this.calculateAgeFromNodes());\n+    });\n+  }\n+\n+  initAgeRange() {\n+    const {selections, wizard} = this.props;\n+    if (selections.length) {\n+      const {attributes} = selections[0];\n+      const {name, operands} = attributes[0];\n+      this.slider.set([+operands[0], +operands[1]]);\n+      this.setState({count: wizard.count, maxAge: operands[1], minAge: operands[0]});\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.setState({ageType: name});\n+      }\n+    } else {\n+      // timeout prevents Angular 'ExpressionChangedAfterItHasBeenCheckedError' in CB modal component\n+      setTimeout(() => this.updateAgeSelection());\n+    }\n+    if (!serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+      const {cdrVersionId} = currentWorkspaceStore.getValue();\n+      if (!ageCountStore.getValue()[cdrVersionId]) {\n+        // Get total age count for this cdr version if it doesn't exist in the store yet\n+        this.calculateAge(true);\n+      } else if (this.setTotalAge) {\n+        this.setState({count:  ageCountStore.getValue()[cdrVersionId]});\n+      }\n+    }\n+  }\n+\n+  onMinChange(minAge: string) {\n+    const {maxAge} = this.state;\n+    let sliderMin = +minAge;\n+    if (+minAge < +defaultMinAge) {\n+      sliderMin = +defaultMinAge;\n+    } else if (+minAge > +maxAge) {\n+      sliderMin = +maxAge;\n+    }\n+    this.slider.set([sliderMin, null]);\n+    this.setState({minAge}, () => {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.calculateAgeFromNodes('min');\n+      } else {\n+        this.setState({count: null});\n+      }\n+    });\n+  }\n+\n+  onMaxChange(maxAge: string) {\n+    const {minAge} = this.state;\n+    let sliderMax = +maxAge;\n+    if (+maxAge > +defaultMaxAge) {\n+      sliderMax = +defaultMaxAge;\n+    } else if (+maxAge < +minAge) {\n+      sliderMax = +minAge;\n+    }\n+    this.slider.set([null, sliderMax]);\n+    this.setState({maxAge}, () => {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.calculateAgeFromNodes('max');\n+      } else {\n+        this.setState({count: null});\n+      }\n+    });\n+  }\n+\n+  onMaxBlur() {\n+    const {minAge} = this.state;\n+    let {maxAge} = this.state;\n+    if (+maxAge < +minAge) {\n+      maxAge = minAge;\n+    } else if (+maxAge > +defaultMaxAge || maxAge === '') {\n+      maxAge = defaultMaxAge;\n+    }\n+    this.slider.set([null, +maxAge]);\n+    this.setState({maxAge}, () => this.updateAgeSelection());\n+  }\n+\n+  onMinBlur() {\n+    const {maxAge} = this.state;\n+    let {minAge} = this.state;\n+    if (+minAge > +maxAge) {\n+      minAge = maxAge;\n+    } else if (+minAge < +defaultMinAge || minAge === '') {\n+      minAge = defaultMinAge;\n+    }\n+    this.slider.set([+minAge, null]);\n+    this.setState({minAge}, () => this.updateAgeSelection());\n+  }\n+\n+  onRadioChange(ageType: string) {\n+    this.setState({ageType}, () => {\n+      this.updateAgeSelection();\n+      this.calculateAgeFromNodes();\n+    });\n+  }\n+\n+  onSliderInit(slider: any) {\n+    this.slider = slider['noUiSlider'];\n+    if (this.slider) {\n+      this.initAgeRange();\n+      this.centerAgeCount();\n+    }\n+  }\n+\n+  onSliderUpdate(range: Array<string>) {\n+    // Use split here to drop the decimals (the slider defaults to 2 decimal places)\n+    const [min, max] = range.map(n => n.split('.')[0]);\n+    this.setState({maxAge: max, minAge: min}, () => {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.calculateAgeFromNodes();\n+      } else {\n+        this.setState({count: null});\n+      }\n+    });\n+  }\n+\n+  updateAgeSelection() {\n+    const {ageType, maxAge, minAge} = this.state;\n+    const selectedNode = {\n+      ...ageNode,\n+      name: `Age In Range ${minAge} - ${maxAge}`,\n+      attributes: [{\n+        name: ageType,\n+        operator: Operator.BETWEEN,\n+        operands: [minAge, maxAge]\n+      }],\n+    };\n+    this.props.select(selectedNode);\n+  }\n+\n+  centerAgeCount() {\n+    if (serverConfigStore.getValue().enableCBAgeTypeOptions && !!this.slider) {\n+      // get range from slider element and convert the strings to numbers\n+      const [sliderMin, sliderMax] = this.slider.get().map(v => +v);\n+      // get width as a % by dividing the selected age range by the full slider range\n+      const width = (sliderMax - sliderMin) / (+defaultMaxAge - +defaultMinAge) * 100;\n+      // get left margin as a % by dividing the change in minAge by the full slider range\n+      const marginLeft = (sliderMin - +defaultMinAge) / (+defaultMaxAge - +defaultMinAge) * 100;\n+      const wrapper = document.getElementById('count-wrapper');\n+      if (!!wrapper) {\n+        wrapper.setAttribute('style', `margin-left: ${marginLeft}%; width: ${width}%; text-align: center;`);\n+        // set style properties also for cross-browser compatibility\n+        wrapper.style.marginLeft = `${marginLeft}%`;\n+        wrapper.style.width = `${width}%`;\n+        wrapper.style.textAlign = 'center';\n+      }\n+    }\n+  }\n+\n+  selectOption(opt: any) {\n+    triggerEvent('Cohort Builder Search', 'Click', `Demo - ${typeToTitle(opt.type)} - ${opt.name}`);\n+    this.props.select({...opt, name: `${typeToTitle(opt.type)} - ${opt.name}`});\n+  }\n+\n+  calculate(init?: boolean) {\n+    let count = 0;\n+    this.props.selections.forEach(sp => {\n+      if (init) {\n+        const node = this.state.nodes.find(n => n.conceptId === sp.conceptId);\n+        if (node) {\n+          sp.count = node.count;\n+        }\n+      }\n+      count += sp.count;\n+    });\n+    this.setState({count});\n+  }\n+\n+  calculateAge(init?: boolean) {\n+    const {maxAge, minAge} = this.state;\n+    if (!init || this.setTotalAge) {\n+      this.setState({calculating: true});\n+    }\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    const min = init ? defaultMinAge : minAge;\n+    const max = init ? defaultMaxAge : maxAge;\n+    const parameter = {\n+      ...ageNode,\n+      name: `Age In Range ${min} - ${max}`,\n+      attributes: [{\n+        name: AttrName.AGE,\n+        operator: Operator.BETWEEN,\n+        operands: [min, max]\n+      }],\n+    };\n+    const request = {\n+      excludes: [],\n+      includes: [{\n+        items: [{\n+          type: DomainType.PERSON.toString(),\n+          searchParameters: [mapParameter(parameter)],\n+          modifiers: []\n+        }],\n+        temporal: false\n+      }],\n+      dataFilters: []\n+    };\n+    cohortBuilderApi().countParticipants(+cdrVersionId, request).then(response => {", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI2ODEwMQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420268101", "bodyText": "Done.", "author": "dolbeew", "createdAt": "2020-05-05T17:05:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMjQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMzY5Mg==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r419703692", "bodyText": "Could this be pulled out into a NumberInput component? I know we have a TextInput and this seems similar.", "author": "s-rubenstein", "createdAt": "2020-05-04T20:21:01Z", "path": "ui/src/app/cohort-search/demographics/demographics.component.tsx", "diffHunk": "@@ -0,0 +1,592 @@\n+import {Component, Input} from '@angular/core';\n+import Nouislider from 'nouislider-react';\n+import * as React from 'react';\n+\n+import {ageCountStore} from 'app/cohort-search/search-state.service';\n+import {mapParameter, typeToTitle} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {currentWorkspaceStore, serverConfigStore} from 'app/utils/navigation';\n+import {AttrName, CriteriaType, DomainType, Operator} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  ageContainer: {\n+    border: '1px solid #cccccc',\n+    borderRadius: '5px',\n+    margin: '0.5rem 1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 1.5rem 1rem'\n+  },\n+  ageInput: {\n+    border: `1px solid ${colors.black}`,\n+    borderRadius: '3px',\n+    fontSize: '0.5rem',\n+    fontWeight: 300,\n+    marginTop: '0.25rem',\n+    padding: '0 0.5rem',\n+    width: '1rem',\n+  },\n+  ageLabel: {\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    color: colors.primary\n+  },\n+  agePreview: {\n+    minWidth: '50%',\n+    padding: '0.25rem 1rem',\n+    width: 'auto'\n+  },\n+  calculateBtn: {\n+    background: colors.primary,\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    color: colors.white,\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem 0.25rem 0',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  count: {\n+    alignItems: 'center',\n+    background: colors.accent,\n+    borderRadius: '10px',\n+    color: colors.white,\n+    display: 'inline-flex',\n+    fontSize: '10px',\n+    height: '0.625rem',\n+    justifyContent: 'center',\n+    lineHeight: 'normal',\n+    margin: '0 0.25rem',\n+    minWidth: '0.675rem',\n+    padding: '0 4px',\n+    verticalAlign: 'middle'\n+  },\n+  countPreview: {\n+    backgroundColor: colorWithWhiteness(colors.secondary, 0.8),\n+    padding: '0.5rem',\n+    margin: '0 2.5%',\n+    position: 'absolute',\n+    width: '95%',\n+    bottom: '0.5rem',\n+  },\n+  option: {\n+    color: colors.black,\n+    cursor: 'pointer',\n+    fontSize: '13px',\n+    fontWeight: 400,\n+    marginBottom: '0.5rem',\n+    padding: '0 0.25rem',\n+    textTransform: 'capitalize',\n+  },\n+  resultText: {\n+    color: colors.primary,\n+    fontWeight: 500,\n+  },\n+  selectIcon: {\n+    color: colors.select,\n+    marginRight: '0.25rem'\n+  },\n+  selected: {\n+    cursor: 'not-allowed',\n+    opacity: 0.4\n+  },\n+  selectList: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    maxHeight: '15rem',\n+    padding: '0.5rem 0 0 1rem'\n+  },\n+  slider: {\n+    flex: 1,\n+    padding: '0 0.5rem',\n+    margin: '0 1rem',\n+  },\n+  sliderContainer: {\n+    alignItems: 'center',\n+    display: 'flex',\n+    marginRight: '1rem',\n+    paddingLeft: '1rem',\n+    width: '96%',\n+  }\n+});\n+// Template node used for age selections\n+const ageNode = {\n+  hasAncestorData: false,\n+  attributes: [],\n+  code: '',\n+  domainId: DomainType.PERSON,\n+  group: false,\n+  name: 'Age',\n+  parameterId: 'age-param',\n+  isStandard: true,\n+  type: CriteriaType.AGE,\n+  value: ''\n+};\n+\n+const ageTypes = [\n+  {label: 'Current Age', type: AttrName.AGE.toString()},\n+  {label: 'Age at Consent', type: AttrName.AGEATCONSENT.toString()},\n+  {label: 'Age at CDR Date', type: AttrName.AGEATCDR.toString()}\n+];\n+\n+const defaultMinAge = '18';\n+const defaultMaxAge = '120';\n+\n+function sortByCountThenName(critA, critB) {\n+  const A = critA.count || 0;\n+  const B = critB.count || 0;\n+  const diff = B - A;\n+  return diff === 0\n+        ? (critA.name > critB.name ? 1 : -1)\n+        : diff;\n+}\n+interface Props {\n+  select: Function;\n+  selectedIds: Array<string>;\n+  selections: Array<any>;\n+  wizard: any;\n+}\n+\n+interface State {\n+  ageType: any;\n+  ageTypeNodes: any;\n+  calculating: boolean;\n+  count: number;\n+  loading: boolean;\n+  maxAge: string;\n+  minAge: string;\n+  nodes: Array<any>;\n+}\n+\n+export class Demographics extends React.Component<Props, State> {\n+  ageWrapper: HTMLDivElement;\n+  slider: any;\n+\n+  constructor(props: Props) {\n+    super(props);\n+    this.state = {\n+      ageType: AttrName.AGE.toString(),\n+      ageTypeNodes: undefined,\n+      calculating: false,\n+      count: null,\n+      loading: true,\n+      maxAge: defaultMaxAge,\n+      minAge: defaultMinAge,\n+      nodes: undefined,\n+    };\n+  }\n+\n+  componentDidMount(): void {\n+    if (this.props.wizard.type === CriteriaType.AGE) {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.loadAgeNodesFromApi();\n+      } else {\n+        this.setState({loading: false});\n+      }\n+    } else {\n+      this.loadNodesFromApi();\n+    }\n+  }\n+\n+  componentDidUpdate(prevProps: Readonly<Props>): void {\n+    const {selections, wizard} = this.props;\n+    if (selections !== prevProps.selections && wizard.type !== CriteriaType.AGE) {\n+      this.calculate();\n+    }\n+  }\n+\n+  loadNodesFromApi() {\n+    const {selections, wizard} = this.props;\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    this.setState({loading: true});\n+    cohortBuilderApi().findCriteriaBy(+cdrVersionId, DomainType.PERSON.toString(), wizard.type).then(response => {\n+      const nodes = response.items\n+        .filter(item => item.parentId !== 0)\n+        .sort(sortByCountThenName)\n+        .map(node => ({...node, parameterId: `param${node.conceptId || node.code}`}));\n+      if (selections.length) {\n+        this.calculate(true);\n+      }\n+      this.setState({loading: false, nodes});\n+    });\n+  }\n+\n+  loadAgeNodesFromApi() {\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    const initialValue = {\n+      [AttrName.AGE.toString()]: [],\n+      [AttrName.AGEATCONSENT.toString()]: [],\n+      [AttrName.AGEATCDR.toString()]: []\n+    };\n+    cohortBuilderApi().findAgeTypeCounts(+cdrVersionId).then(response => {\n+      const ageTypeNodes = response.items.reduce((acc, item) => {\n+        acc[item.ageType].push(item);\n+        return acc;\n+      }, initialValue);\n+      this.setState({ageTypeNodes}, () => this.calculateAgeFromNodes());\n+    });\n+  }\n+\n+  initAgeRange() {\n+    const {selections, wizard} = this.props;\n+    if (selections.length) {\n+      const {attributes} = selections[0];\n+      const {name, operands} = attributes[0];\n+      this.slider.set([+operands[0], +operands[1]]);\n+      this.setState({count: wizard.count, maxAge: operands[1], minAge: operands[0]});\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.setState({ageType: name});\n+      }\n+    } else {\n+      // timeout prevents Angular 'ExpressionChangedAfterItHasBeenCheckedError' in CB modal component\n+      setTimeout(() => this.updateAgeSelection());\n+    }\n+    if (!serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+      const {cdrVersionId} = currentWorkspaceStore.getValue();\n+      if (!ageCountStore.getValue()[cdrVersionId]) {\n+        // Get total age count for this cdr version if it doesn't exist in the store yet\n+        this.calculateAge(true);\n+      } else if (this.setTotalAge) {\n+        this.setState({count:  ageCountStore.getValue()[cdrVersionId]});\n+      }\n+    }\n+  }\n+\n+  onMinChange(minAge: string) {\n+    const {maxAge} = this.state;\n+    let sliderMin = +minAge;\n+    if (+minAge < +defaultMinAge) {\n+      sliderMin = +defaultMinAge;\n+    } else if (+minAge > +maxAge) {\n+      sliderMin = +maxAge;\n+    }\n+    this.slider.set([sliderMin, null]);\n+    this.setState({minAge}, () => {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.calculateAgeFromNodes('min');\n+      } else {\n+        this.setState({count: null});\n+      }\n+    });\n+  }\n+\n+  onMaxChange(maxAge: string) {\n+    const {minAge} = this.state;\n+    let sliderMax = +maxAge;\n+    if (+maxAge > +defaultMaxAge) {\n+      sliderMax = +defaultMaxAge;\n+    } else if (+maxAge < +minAge) {\n+      sliderMax = +minAge;\n+    }\n+    this.slider.set([null, sliderMax]);\n+    this.setState({maxAge}, () => {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.calculateAgeFromNodes('max');\n+      } else {\n+        this.setState({count: null});\n+      }\n+    });\n+  }\n+\n+  onMaxBlur() {\n+    const {minAge} = this.state;\n+    let {maxAge} = this.state;\n+    if (+maxAge < +minAge) {\n+      maxAge = minAge;\n+    } else if (+maxAge > +defaultMaxAge || maxAge === '') {\n+      maxAge = defaultMaxAge;\n+    }\n+    this.slider.set([null, +maxAge]);\n+    this.setState({maxAge}, () => this.updateAgeSelection());\n+  }\n+\n+  onMinBlur() {\n+    const {maxAge} = this.state;\n+    let {minAge} = this.state;\n+    if (+minAge > +maxAge) {\n+      minAge = maxAge;\n+    } else if (+minAge < +defaultMinAge || minAge === '') {\n+      minAge = defaultMinAge;\n+    }\n+    this.slider.set([+minAge, null]);\n+    this.setState({minAge}, () => this.updateAgeSelection());\n+  }\n+\n+  onRadioChange(ageType: string) {\n+    this.setState({ageType}, () => {\n+      this.updateAgeSelection();\n+      this.calculateAgeFromNodes();\n+    });\n+  }\n+\n+  onSliderInit(slider: any) {\n+    this.slider = slider['noUiSlider'];\n+    if (this.slider) {\n+      this.initAgeRange();\n+      this.centerAgeCount();\n+    }\n+  }\n+\n+  onSliderUpdate(range: Array<string>) {\n+    // Use split here to drop the decimals (the slider defaults to 2 decimal places)\n+    const [min, max] = range.map(n => n.split('.')[0]);\n+    this.setState({maxAge: max, minAge: min}, () => {\n+      if (serverConfigStore.getValue().enableCBAgeTypeOptions) {\n+        this.calculateAgeFromNodes();\n+      } else {\n+        this.setState({count: null});\n+      }\n+    });\n+  }\n+\n+  updateAgeSelection() {\n+    const {ageType, maxAge, minAge} = this.state;\n+    const selectedNode = {\n+      ...ageNode,\n+      name: `Age In Range ${minAge} - ${maxAge}`,\n+      attributes: [{\n+        name: ageType,\n+        operator: Operator.BETWEEN,\n+        operands: [minAge, maxAge]\n+      }],\n+    };\n+    this.props.select(selectedNode);\n+  }\n+\n+  centerAgeCount() {\n+    if (serverConfigStore.getValue().enableCBAgeTypeOptions && !!this.slider) {\n+      // get range from slider element and convert the strings to numbers\n+      const [sliderMin, sliderMax] = this.slider.get().map(v => +v);\n+      // get width as a % by dividing the selected age range by the full slider range\n+      const width = (sliderMax - sliderMin) / (+defaultMaxAge - +defaultMinAge) * 100;\n+      // get left margin as a % by dividing the change in minAge by the full slider range\n+      const marginLeft = (sliderMin - +defaultMinAge) / (+defaultMaxAge - +defaultMinAge) * 100;\n+      const wrapper = document.getElementById('count-wrapper');\n+      if (!!wrapper) {\n+        wrapper.setAttribute('style', `margin-left: ${marginLeft}%; width: ${width}%; text-align: center;`);\n+        // set style properties also for cross-browser compatibility\n+        wrapper.style.marginLeft = `${marginLeft}%`;\n+        wrapper.style.width = `${width}%`;\n+        wrapper.style.textAlign = 'center';\n+      }\n+    }\n+  }\n+\n+  selectOption(opt: any) {\n+    triggerEvent('Cohort Builder Search', 'Click', `Demo - ${typeToTitle(opt.type)} - ${opt.name}`);\n+    this.props.select({...opt, name: `${typeToTitle(opt.type)} - ${opt.name}`});\n+  }\n+\n+  calculate(init?: boolean) {\n+    let count = 0;\n+    this.props.selections.forEach(sp => {\n+      if (init) {\n+        const node = this.state.nodes.find(n => n.conceptId === sp.conceptId);\n+        if (node) {\n+          sp.count = node.count;\n+        }\n+      }\n+      count += sp.count;\n+    });\n+    this.setState({count});\n+  }\n+\n+  calculateAge(init?: boolean) {\n+    const {maxAge, minAge} = this.state;\n+    if (!init || this.setTotalAge) {\n+      this.setState({calculating: true});\n+    }\n+    const {cdrVersionId} = currentWorkspaceStore.getValue();\n+    const min = init ? defaultMinAge : minAge;\n+    const max = init ? defaultMaxAge : maxAge;\n+    const parameter = {\n+      ...ageNode,\n+      name: `Age In Range ${min} - ${max}`,\n+      attributes: [{\n+        name: AttrName.AGE,\n+        operator: Operator.BETWEEN,\n+        operands: [min, max]\n+      }],\n+    };\n+    const request = {\n+      excludes: [],\n+      includes: [{\n+        items: [{\n+          type: DomainType.PERSON.toString(),\n+          searchParameters: [mapParameter(parameter)],\n+          modifiers: []\n+        }],\n+        temporal: false\n+      }],\n+      dataFilters: []\n+    };\n+    cohortBuilderApi().countParticipants(+cdrVersionId, request).then(response => {\n+      if (init) {\n+        const ageCounts = ageCountStore.getValue();\n+        ageCounts[cdrVersionId] = response;\n+        ageCountStore.next(ageCounts);\n+        if (this.setTotalAge) {\n+          this.setState({count: response});\n+        }\n+      } else {\n+        this.setState({count: response});\n+      }\n+      this.setState({calculating: false});\n+    }, (err) => {\n+      console.error(err);\n+      this.setState({calculating: false});\n+    });\n+  }\n+\n+  calculateAgeFromNodes(minOrMax?: string) {\n+    const {ageTypeNodes, ageType, maxAge, minAge} = this.state;\n+    let max = +maxAge;\n+    let min = +minAge;\n+    if (minOrMax === 'min' && min > +max) {\n+      min = max;\n+    } else if (minOrMax === 'max' && max < min) {\n+      max = min;\n+    }\n+    const count = ageTypeNodes[ageType]\n+      .filter(node => node.age >= min && node.age <= max)\n+      .reduce((acc, node) => acc + node.count, 0);\n+    this.setState({count, loading: false}, () => this.centerAgeCount());\n+  }\n+\n+  get showPreview() {\n+    const {selections, wizard} = this.props;\n+    return !this.state.loading\n+      && (selections && selections.length > 0)\n+      && !(wizard.type === CriteriaType.AGE && serverConfigStore.getValue().enableCBAgeTypeOptions);\n+  }\n+\n+  // Checks if form is in its initial state and if a count already exists before setting the total age count\n+  get setTotalAge() {\n+    const {count, maxAge, minAge} = this.state;\n+    return minAge === defaultMinAge && maxAge === defaultMaxAge && !count;\n+  }\n+\n+  render() {\n+    const {selectedIds, wizard} = this.props;\n+    const {ageType, calculating, count, loading, maxAge, minAge, nodes} = this.state;\n+    const isAge = wizard.type === CriteriaType.AGE;\n+    const calcDisabled = calculating || count !== null;\n+    return loading\n+      ? <div style={{textAlign: 'center'}}><Spinner style={{marginTop: '3rem'}}/></div>\n+      : <React.Fragment>\n+        {isAge\n+          // Age slider with number inputs\n+          ? <div style={styles.ageContainer}>\n+            <div style={styles.ageLabel}>\n+              Age Range\n+            </div>\n+            <div style={styles.sliderContainer}>\n+              <input style={styles.ageInput}\n+                type='number'\n+                id='min-age'\n+                min={defaultMinAge} max={maxAge}\n+                value={minAge}\n+                onBlur={() => this.onMinBlur()}\n+                onChange={(e) => this.onMinChange(e.target.value)}/>\n+              <div style={serverConfigStore.getValue().enableCBAgeTypeOptions\n+                ? {...styles.slider, marginBottom: '0.75rem'}\n+                : styles.slider}>\n+                {serverConfigStore.getValue().enableCBAgeTypeOptions && <div ref={(el) => this.ageWrapper = el} id='count-wrapper'>\n+                  {calculating\n+                    ? <Spinner size={16}/>\n+                    : <span style={styles.count} id='age-count'>\n+                      {count.toLocaleString()}\n+                    </span>\n+                  }\n+                </div>}\n+                <Nouislider behaviour='drag'\n+                  connect\n+                  instanceRef={(slider) => this.onSliderInit(slider)}\n+                  onChange={() => this.updateAgeSelection()}\n+                  onSlide={(v) => this.onSliderUpdate(v)}\n+                  range={{min: +defaultMinAge, max: +defaultMaxAge}}\n+                  start={[+defaultMinAge, +defaultMaxAge]}\n+                  step={1}/>\n+              </div>\n+              <input style={styles.ageInput}", "originalCommit": "be25b814cb62a83cae6c9c625d5cb6cd998290b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3NTI1NA==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r420275254", "bodyText": "There is a NumberInput component but it actually returns a regular text input, even though it tries to set type='number'. I can file a follow-up ticket to fix that component (doesn't look like it's currently being used anywhere else).", "author": "dolbeew", "createdAt": "2020-05-05T17:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMzY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NjQ5Nw==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r423156497", "bodyText": "Yeah, lets follow up by fixing that. Sounds good.", "author": "s-rubenstein", "createdAt": "2020-05-11T16:15:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMzY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1OTI2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3516#discussion_r424159261", "bodyText": "Filed RW-4947", "author": "dolbeew", "createdAt": "2020-05-13T03:58:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMzY5Mg=="}], "type": "inlineReview"}, {"oid": "3873a8c1e2ea9549ccaa29092c9ef6952503ebed", "url": "https://github.com/all-of-us/workbench/commit/3873a8c1e2ea9549ccaa29092c9ef6952503ebed", "message": "RW-4786 initial react conversion", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "a132ff50570a19fdc36fc92b397b6701c06bde03", "url": "https://github.com/all-of-us/workbench/commit/a132ff50570a19fdc36fc92b397b6701c06bde03", "message": "RW-4786 add template to render function", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "4f34e69c715e391229621e9e520d7bad3e88c78e", "url": "https://github.com/all-of-us/workbench/commit/4f34e69c715e391229621e9e520d7bad3e88c78e", "message": "RW-4786 move styles to new component", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "bd3bc37ffdd995e318c4acadb9376db0a5b32a5e", "url": "https://github.com/all-of-us/workbench/commit/bd3bc37ffdd995e318c4acadb9376db0a5b32a5e", "message": "RW-4786 switch to react nouislider", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "f3886cb39aef426d5c9ae023080c36d1342751b8", "url": "https://github.com/all-of-us/workbench/commit/f3886cb39aef426d5c9ae023080c36d1342751b8", "message": "RW-4786 sync slider with number inputs", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "89cf3fd61a5ef83108fd6eb586e008acd19180a0", "url": "https://github.com/all-of-us/workbench/commit/89cf3fd61a5ef83108fd6eb586e008acd19180a0", "message": "RW-4786 fix number input/slider updates", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "54f8552a303e0497862ddf6fbbadc91c196d424a", "url": "https://github.com/all-of-us/workbench/commit/54f8552a303e0497862ddf6fbbadc91c196d424a", "message": "RW-4786 calculate and center count above slider", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "f5db264c9d369c4e68bc651649a9f7de0182040b", "url": "https://github.com/all-of-us/workbench/commit/f5db264c9d369c4e68bc651649a9f7de0182040b", "message": "RW-4786 fix slider and inputs when editing existing item", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "fe3f52fa2d203fe414b43dacac9610f6b747c7f6", "url": "https://github.com/all-of-us/workbench/commit/fe3f52fa2d203fe414b43dacac9610f6b747c7f6", "message": "RW-4786 remove angular files, add render test", "committedDate": "2020-05-12T21:20:23Z", "type": "commit"}, {"oid": "86289833aa83f0890c3ab3761d4b2d708f5a7909", "url": "https://github.com/all-of-us/workbench/commit/86289833aa83f0890c3ab3761d4b2d708f5a7909", "message": "RW-4786 fix failing tests", "committedDate": "2020-05-12T21:20:24Z", "type": "commit"}, {"oid": "aa8426e97a46ad5f7a5693b57452050ecc6be3db", "url": "https://github.com/all-of-us/workbench/commit/aa8426e97a46ad5f7a5693b57452050ecc6be3db", "message": "RW-4786 pr feedback", "committedDate": "2020-05-12T21:20:24Z", "type": "commit"}, {"oid": "6e076a4cc991226066792873fc3ed4471e948780", "url": "https://github.com/all-of-us/workbench/commit/6e076a4cc991226066792873fc3ed4471e948780", "message": "RW-4786 fix test", "committedDate": "2020-05-12T21:20:24Z", "type": "commit"}, {"oid": "672d7a3b962713800788e9afa3f5670e07e6b3a6", "url": "https://github.com/all-of-us/workbench/commit/672d7a3b962713800788e9afa3f5670e07e6b3a6", "message": "RW-4786 address feedback/fix age count", "committedDate": "2020-05-13T03:55:05Z", "type": "commit"}, {"oid": "672d7a3b962713800788e9afa3f5670e07e6b3a6", "url": "https://github.com/all-of-us/workbench/commit/672d7a3b962713800788e9afa3f5670e07e6b3a6", "message": "RW-4786 address feedback/fix age count", "committedDate": "2020-05-13T03:55:05Z", "type": "forcePushed"}]}