{"pr_number": 3636, "pr_title": "RW-5019 adding validation for cohort def on save", "pr_createdAt": "2020-06-02T19:27:48Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3636", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyNzQxOQ==", "url": "https://github.com/all-of-us/workbench/pull/3636#discussion_r435427419", "bodyText": "Is there any chance that cohort could be null? Should we also handle nullPointer?", "author": "NehaBroad", "createdAt": "2020-06-04T17:29:24Z", "path": "api/src/main/java/org/pmiops/workbench/api/CohortsController.java", "diffHunk": "@@ -136,6 +139,16 @@ private void checkForDuplicateCohortNameException(String newCohortName, DbWorksp\n         workspaceNamespace, workspaceId, WorkspaceAccessLevel.WRITER);\n     DbWorkspace workspace = workspaceService.getRequired(workspaceNamespace, workspaceId);\n \n+    try {\n+      // validate the cohort definition\n+      new Gson().fromJson(cohort.getCriteria(), SearchRequest.class);", "originalCommit": "5ac6d86eebe166a29cbb48e1a0d8e14a7e17c4b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ1MDQ3Mw==", "url": "https://github.com/all-of-us/workbench/pull/3636#discussion_r435450473", "bodyText": "UI doesn't allow for saving a null cohort and i think swagger would throw an exception if the request body was null: https://github.com/all-of-us/workbench/blob/794bac5e2e3d8abee07a6359377008bc96cb709a/api/src/generated/java/org/pmiops/workbench/api/CohortsApiController.java#L44-L44", "author": "freemabd", "createdAt": "2020-06-04T18:07:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyNzQxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyNzg3NQ==", "url": "https://github.com/all-of-us/workbench/pull/3636#discussion_r435427875", "bodyText": "we can add @test(expected = ServerErrorException.class) rather than fail", "author": "NehaBroad", "createdAt": "2020-06-04T17:30:12Z", "path": "api/src/test/java/org/pmiops/workbench/api/CohortsControllerTest.java", "diffHunk": "@@ -368,6 +412,22 @@ public void testGetCohortsInWorkspace() throws Exception {\n     assertThat(cohorts.size()).isEqualTo(2);\n   }\n \n+  @Test", "originalCommit": "5ac6d86eebe166a29cbb48e1a0d8e14a7e17c4b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MzI2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3636#discussion_r435443261", "bodyText": "Done.", "author": "freemabd", "createdAt": "2020-06-04T17:55:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyNzg3NQ=="}], "type": "inlineReview"}, {"oid": "c67b76e9d9780c14b846174704aba0d7192265e3", "url": "https://github.com/all-of-us/workbench/commit/c67b76e9d9780c14b846174704aba0d7192265e3", "message": "RW-5019 adding validation for cohort def on save", "committedDate": "2020-06-08T14:07:48Z", "type": "commit"}, {"oid": "ba937551d8c5ae4b7e795475cee587d2402c8f0f", "url": "https://github.com/all-of-us/workbench/commit/ba937551d8c5ae4b7e795475cee587d2402c8f0f", "message": "RW-5019 fixing test case.", "committedDate": "2020-06-08T14:07:48Z", "type": "commit"}, {"oid": "ba937551d8c5ae4b7e795475cee587d2402c8f0f", "url": "https://github.com/all-of-us/workbench/commit/ba937551d8c5ae4b7e795475cee587d2402c8f0f", "message": "RW-5019 fixing test case.", "committedDate": "2020-06-08T14:07:48Z", "type": "forcePushed"}]}