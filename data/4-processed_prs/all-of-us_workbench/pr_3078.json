{"pr_number": 3078, "pr_title": "[risk=no] Reduce api-local-test memory limit", "pr_createdAt": "2020-02-03T19:53:03Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3078", "timeline": [{"oid": "6670cd34807f562bc4c4ad2552bfe3b935eba8cf", "url": "https://github.com/all-of-us/workbench/commit/6670cd34807f562bc4c4ad2552bfe3b935eba8cf", "message": "reduce api-local-test memory limit", "committedDate": "2020-02-03T19:44:33Z", "type": "commit"}, {"oid": "53b0d348f5765c90c883315c9e2ad75b83f18815", "url": "https://github.com/all-of-us/workbench/commit/53b0d348f5765c90c883315c9e2ad75b83f18815", "message": "doc", "committedDate": "2020-02-03T19:52:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxMjg4NQ==", "url": "https://github.com/all-of-us/workbench/pull/3078#discussion_r374312885", "bodyText": "SGTM. I wonder if we could write a test suite that allocates more and more memory so we can figure out what the practical limit is.\nIf it's sounding like we need to move to a higher plan, another data point indicating that is queuing for a build after several folks have merged a PR.", "author": "jaycarlton", "createdAt": "2020-02-03T20:05:04Z", "path": ".circleci/config.yml", "diffHunk": "@@ -68,7 +68,14 @@ jobs:\n           - MYSQL_PASSWORD=ubuntu\n     working_directory: ~/workbench\n     environment:\n-      JAVA_TOOL_OPTIONS: -Xmx2g\n+      # Drop to ~1.5G; the local API server starts two Java processes (the API\n+      # server and the cron emulator). The default machine has 4GB, so we want\n+      # the Java memory limit to be below half of that: other things on the\n+      # machine need memory as well. Using 2G here manifested in 137 errors.\n+      # If this limit proves to be too low, an alternative would be to use a\n+      # larger resource class:\n+      #   https://circleci.com/docs/2.0/configuration-reference/#resource_class\n+      JAVA_TOOL_OPTIONS: -Xmx1536m", "originalCommit": "53b0d348f5765c90c883315c9e2ad75b83f18815", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxNDM5Nw==", "url": "https://github.com/all-of-us/workbench/pull/3078#discussion_r374314397", "bodyText": "This doesn't require a plan upgrade, we can use these larger machines today if we wanted. It just uses more credits / cost more if we use a larger machine. Given what our server is doing, even 1G seems like it should be fine, but we can increase if there's an actual need to do so.", "author": "calbach", "createdAt": "2020-02-03T20:08:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxMjg4NQ=="}], "type": "inlineReview"}]}