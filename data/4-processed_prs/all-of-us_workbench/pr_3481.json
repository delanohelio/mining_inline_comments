{"pr_number": 3481, "pr_title": "[RW-4820][risk=no] Text area with length limits", "pr_createdAt": "2020-04-24T20:42:24Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3481", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjExNg==", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856116", "bodyText": "nit: Extract Style", "author": "NehaBroad", "createdAt": "2020-04-24T20:52:42Z", "path": "ui/src/app/components/inputs.tsx", "diffHunk": "@@ -82,6 +83,132 @@ export const ValidationError = ({children}) => {\n   >{children}</div>;\n };\n \n+export const TextArea = ({style = {}, onChange, ...props}) => {\n+  return <textarea\n+      {...props}\n+      onChange={onChange ? (e => onChange(e.target.value)) : undefined}\n+      style={{\n+        width: '100%',\n+        borderColor: inputBorderColor, borderWidth: 1, borderStyle: 'solid', borderRadius: 3,", "originalCommit": "b3858a459277b18b6370614df6291092311ff961", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjI4OA==", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856288", "bodyText": "I deliberately didn't extract the style because it's not reused and it's in a file that has multiple different classes.", "author": "als364", "createdAt": "2020-04-24T20:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjQ4OQ==", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856489", "bodyText": "nit: extract style", "author": "NehaBroad", "createdAt": "2020-04-24T20:53:25Z", "path": "ui/src/app/components/inputs.tsx", "diffHunk": "@@ -82,6 +83,132 @@ export const ValidationError = ({children}) => {\n   >{children}</div>;\n };\n \n+export const TextArea = ({style = {}, onChange, ...props}) => {\n+  return <textarea\n+      {...props}\n+      onChange={onChange ? (e => onChange(e.target.value)) : undefined}\n+      style={{\n+        width: '100%',\n+        borderColor: inputBorderColor, borderWidth: 1, borderStyle: 'solid', borderRadius: 3,\n+        padding: '0.25rem 0.5rem',\n+        backgroundColor: colors.white,\n+        ...style\n+      }}\n+  />;\n+};\n+\n+interface TextAreaWithLengthValidationMessageProps {\n+  id: string;\n+  initialText: string;\n+  maxCharacters: number;\n+  tooLongWarningCharacters: number;\n+  onChange: (s: string) => void;\n+  tooShortWarningCharacters?: number;\n+  tooShortWarning?: string;\n+}\n+\n+interface TextAreaWithLengthValidationMessageState {\n+  showTooShortWarning: boolean;\n+  text: string;\n+}\n+\n+export class TextAreaWithLengthValidationMessage extends React.Component<\n+  TextAreaWithLengthValidationMessageProps,\n+  TextAreaWithLengthValidationMessageState\n+> {\n+  constructor(props: TextAreaWithLengthValidationMessageProps) {\n+    super(props);\n+    this.state = {\n+      showTooShortWarning: false,\n+      text: props.initialText\n+    };\n+  }\n+\n+  onTextUpdate(text) {\n+    if (this.state.showTooShortWarning && text.length >= 50) {\n+      this.setState({showTooShortWarning: false});\n+    }\n+    this.setState({text: text});\n+    this.props.onChange(text);\n+  }\n+\n+  updateShowTooShortWarning() {\n+    if (\n+        this.state.text\n+        && this.props.tooShortWarningCharacters\n+        && this.props.tooShortWarning\n+        && this.state.text.length < this.props.tooShortWarningCharacters\n+    ) {\n+      this.setState({showTooShortWarning: true});\n+    } else {\n+      this.setState({showTooShortWarning: false});\n+    }\n+  }\n+\n+  renderCharacterLimitMessage(textColor: string, message: string) {\n+    return <div\n+        data-test-id='characterLimit'\n+        style={{color: textColor, marginLeft: 'auto', flex: '0 0 auto'}}\n+    >\n+      {message}\n+    </div>;\n+  }\n+\n+  render() {\n+    const {id, maxCharacters, tooShortWarning} = this.props;\n+    const {showTooShortWarning, text} = this.state;\n+\n+    return <React.Fragment>\n+      <TextArea\n+          style={{\n+            height: '15rem',", "originalCommit": "b3858a459277b18b6370614df6291092311ff961", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjY2MA==", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856660", "bodyText": "nit: extract style", "author": "NehaBroad", "createdAt": "2020-04-24T20:53:46Z", "path": "ui/src/app/components/inputs.tsx", "diffHunk": "@@ -82,6 +83,132 @@ export const ValidationError = ({children}) => {\n   >{children}</div>;\n };\n \n+export const TextArea = ({style = {}, onChange, ...props}) => {\n+  return <textarea\n+      {...props}\n+      onChange={onChange ? (e => onChange(e.target.value)) : undefined}\n+      style={{\n+        width: '100%',\n+        borderColor: inputBorderColor, borderWidth: 1, borderStyle: 'solid', borderRadius: 3,\n+        padding: '0.25rem 0.5rem',\n+        backgroundColor: colors.white,\n+        ...style\n+      }}\n+  />;\n+};\n+\n+interface TextAreaWithLengthValidationMessageProps {\n+  id: string;\n+  initialText: string;\n+  maxCharacters: number;\n+  tooLongWarningCharacters: number;\n+  onChange: (s: string) => void;\n+  tooShortWarningCharacters?: number;\n+  tooShortWarning?: string;\n+}\n+\n+interface TextAreaWithLengthValidationMessageState {\n+  showTooShortWarning: boolean;\n+  text: string;\n+}\n+\n+export class TextAreaWithLengthValidationMessage extends React.Component<\n+  TextAreaWithLengthValidationMessageProps,\n+  TextAreaWithLengthValidationMessageState\n+> {\n+  constructor(props: TextAreaWithLengthValidationMessageProps) {\n+    super(props);\n+    this.state = {\n+      showTooShortWarning: false,\n+      text: props.initialText\n+    };\n+  }\n+\n+  onTextUpdate(text) {\n+    if (this.state.showTooShortWarning && text.length >= 50) {\n+      this.setState({showTooShortWarning: false});\n+    }\n+    this.setState({text: text});\n+    this.props.onChange(text);\n+  }\n+\n+  updateShowTooShortWarning() {\n+    if (\n+        this.state.text\n+        && this.props.tooShortWarningCharacters\n+        && this.props.tooShortWarning\n+        && this.state.text.length < this.props.tooShortWarningCharacters\n+    ) {\n+      this.setState({showTooShortWarning: true});\n+    } else {\n+      this.setState({showTooShortWarning: false});\n+    }\n+  }\n+\n+  renderCharacterLimitMessage(textColor: string, message: string) {\n+    return <div\n+        data-test-id='characterLimit'\n+        style={{color: textColor, marginLeft: 'auto', flex: '0 0 auto'}}\n+    >\n+      {message}\n+    </div>;\n+  }\n+\n+  render() {\n+    const {id, maxCharacters, tooShortWarning} = this.props;\n+    const {showTooShortWarning, text} = this.state;\n+\n+    return <React.Fragment>\n+      <TextArea\n+          style={{\n+            height: '15rem',\n+            resize: 'none',\n+            width: '48rem',\n+            borderRadius: '3px 3px 0 0',\n+            boderColor: colorWithWhiteness(colors.dark, 0.5)\n+          }}\n+          id={id}\n+          value={text}\n+          onBlur={() => this.updateShowTooShortWarning()}\n+          onChange={v => this.onTextUpdate(v)}\n+      />\n+      <FlexRow\n+          style={{\n+            justifyContent: 'space-between',\n+            width: '48rem',\n+            backgroundColor: colorWithWhiteness(colors.primary, 0.95),\n+            fontSize: 12,", "originalCommit": "b3858a459277b18b6370614df6291092311ff961", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzUzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414857531", "bodyText": "Curious should this be a const rather than class?", "author": "NehaBroad", "createdAt": "2020-04-24T20:55:19Z", "path": "ui/src/app/pages/workspace/workspace-research-summary.tsx", "diffHunk": "@@ -1,111 +1,40 @@\n-import {FlexRow} from 'app/components/flex';\n-import {TextArea} from 'app/components/inputs';\n-import colors from 'app/styles/colors';\n-import {colorWithWhiteness} from 'app/styles/colors';\n-import {reactStyles} from 'app/utils';\n+import {TextAreaWithLengthValidationMessage} from 'app/components/inputs';\n import * as React from 'react';\n import {WorkspaceEditSection} from './workspace-edit-section';\n import {ResearchPurposeQuestion} from './workspace-edit-text';\n \n-const styles = reactStyles({\n-  textArea: {\n-    height: '15rem',\n-    resize: 'none',\n-    width: '48rem',\n-    borderRadius: '3px 3px 0 0',\n-    boderColor: colorWithWhiteness(colors.dark, 0.5)\n-  },\n-  textBoxCharRemaining: {\n-    justifyContent: 'space-between',\n-    width: '48rem',\n-    backgroundColor: colorWithWhiteness(colors.primary, 0.95),\n-    fontSize: 12,\n-    colors: colors.primary,\n-    padding: '0.25rem',\n-    borderRadius: '0 0 3px 3px', marginTop: '-0.5rem',\n-    border: `1px solid ${colorWithWhiteness(colors.dark, 0.5)}`\n-  },\n-});\n \n interface Props {\n+  id: string;\n   index: string;\n   onChange: Function;\n   researchPurpose: ResearchPurposeQuestion;\n   researchValue: string;\n-  rowId: string;\n }\n \n-interface State {\n-  showWarningMessage: boolean;\n-  researchValue: string;\n-  textColor: string;\n-}\n-\n-export class WorkspaceResearchSummary extends React.Component<Props, State > {\n+export class WorkspaceResearchSummary extends React.Component<Props> {", "originalCommit": "b3858a459277b18b6370614df6291092311ff961", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzY1Mw==", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414857653", "bodyText": "Ooh, yeah, now that it has no more state it can be a const!", "author": "als364", "createdAt": "2020-04-24T20:55:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzUzMQ=="}], "type": "inlineReview"}, {"oid": "ee937e0a0cc8c278985b889d0eb0fb1aac26399b", "url": "https://github.com/all-of-us/workbench/commit/ee937e0a0cc8c278985b889d0eb0fb1aac26399b", "message": "first pass", "committedDate": "2020-04-24T21:01:26Z", "type": "commit"}, {"oid": "9a9ff19ee86d1edd811db62cf4d45fbe35bc39ae", "url": "https://github.com/all-of-us/workbench/commit/9a9ff19ee86d1edd811db62cf4d45fbe35bc39ae", "message": "fixed tests", "committedDate": "2020-04-24T21:01:26Z", "type": "commit"}, {"oid": "39d1826862f66f2630e00c5d9f047855220d00e6", "url": "https://github.com/all-of-us/workbench/commit/39d1826862f66f2630e00c5d9f047855220d00e6", "message": "lint", "committedDate": "2020-04-24T21:01:27Z", "type": "commit"}, {"oid": "e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "url": "https://github.com/all-of-us/workbench/commit/e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "message": "this can be a const now it has no state", "committedDate": "2020-04-24T21:02:44Z", "type": "commit"}, {"oid": "e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "url": "https://github.com/all-of-us/workbench/commit/e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "message": "this can be a const now it has no state", "committedDate": "2020-04-24T21:02:44Z", "type": "forcePushed"}, {"oid": "e7ec6cb709fd63aa015eaece8689a0cdc6ed36dd", "url": "https://github.com/all-of-us/workbench/commit/e7ec6cb709fd63aa015eaece8689a0cdc6ed36dd", "message": "lint again I GUESS", "committedDate": "2020-04-24T21:15:58Z", "type": "commit"}, {"oid": "6072e61d43476ef2255f94ea63e8de9bd91d54fb", "url": "https://github.com/all-of-us/workbench/commit/6072e61d43476ef2255f94ea63e8de9bd91d54fb", "message": "fixed some incorrect error text", "committedDate": "2020-04-24T21:25:07Z", "type": "commit"}]}