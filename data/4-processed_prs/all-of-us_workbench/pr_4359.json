{"pr_number": 4359, "pr_title": "[no ticket][risk=no] Puppeteer refactor owner-copy-to-workspace test", "pr_createdAt": "2020-12-05T17:34:19Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4359", "timeline": [{"oid": "85bb7e7227e14e7cd7e91d87ba79db3738f0394e", "url": "https://github.com/all-of-us/workbench/commit/85bb7e7227e14e7cd7e91d87ba79db3738f0394e", "message": "rebase", "committedDate": "2020-12-05T17:37:19Z", "type": "commit"}, {"oid": "85bb7e7227e14e7cd7e91d87ba79db3738f0394e", "url": "https://github.com/all-of-us/workbench/commit/85bb7e7227e14e7cd7e91d87ba79db3738f0394e", "message": "rebase", "committedDate": "2020-12-05T17:37:19Z", "type": "forcePushed"}, {"oid": "c73653cfeeb1878125b26d8e90bfb8356b111c29", "url": "https://github.com/all-of-us/workbench/commit/c73653cfeeb1878125b26d8e90bfb8356b111c29", "message": "update", "committedDate": "2020-12-05T17:42:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5NDE0Mg==", "url": "https://github.com/all-of-us/workbench/pull/4359#discussion_r537594142", "bodyText": "Let's call this defaultCdrWorkspace", "author": "jmthibault79", "createdAt": "2020-12-07T15:25:37Z", "path": "e2e/tests/notebook/owner-copy-to-workspace.spec.ts", "diffHunk": "@@ -18,64 +19,87 @@ jest.setTimeout(20 * 60 * 1000);\n  * - Verify copied notebook is in destination Workspace.\n  * - Open copied notebook and run code to print WORKSPACE_NAMESPACE. It should match destination Workspace namespace.\n  * - Delete notebooks.\n+ *\n+ * @param {string} sourceWorkspaceName: Source workspace name\n+ * @param {string} to create new destination workspace with CDR Version\n  */\n-async function copyNotebookTest(srcCdrVersionName: string, destCdrVersionName: string) {\n-  const destWorkspace = await createWorkspace(page, destCdrVersionName).then(card => card.getWorkspaceName());\n-\n-  await createWorkspace(page, srcCdrVersionName).then(card => card.clickWorkspaceName());\n-\n-  // Create notebook in copy-from workspace.\n-  const sourceNotebookName = makeRandomName('pytest');\n-  const dataPage = new WorkspaceDataPage(page);\n-\n-  const sourceWorkspacePage = await dataPage.createNotebook(sourceNotebookName);\n-\n-  // Exit notebook and returns to the Workspace Analysis tab.\n-  const analysisPage = await sourceWorkspacePage.goAnalysisPage();\n-\n-  // Copy to destination Workspace and give notebook a new name.\n-  const copiedNotebookName = makeRandomName('copy-of');\n-  await analysisPage.copyNotebookToWorkspace(sourceNotebookName, destWorkspace, copiedNotebookName);\n-\n-  // Verify Copy Success modal.\n-  const modal = new Modal(page);\n-  await modal.waitForButton(LinkText.GoToCopiedNotebook);\n-  const textContent = await modal.getTextContent();\n-  const successMsg = `Successfully copied ${sourceNotebookName}  to ${destWorkspace} . Do you want to view the copied Notebook?`;\n-  expect(textContent).toContain(successMsg);\n-  // Dismiss modal.\n-  await modal.clickButton(LinkText.StayHere, {waitForClose: true});\n-\n-  // Delete notebook\n-  const deleteModalTextContent = await analysisPage.deleteResource(sourceNotebookName, ResourceCard.Notebook);\n-  expect(deleteModalTextContent).toContain(`Are you sure you want to delete Notebook: ${sourceNotebookName}?`);\n-\n-  // Perform actions in copied notebook.\n-  // Open destination Workspace\n-  await findOrCreateWorkspace(page, {workspaceName: destWorkspace}).then(card => card.clickWorkspaceName());\n-\n-  // Verify copy-to notebook exists in destination Workspace\n-  await dataPage.openAnalysisPage();\n-  const dataResourceCard = new DataResourceCard(page);\n-  const notebookCard = await dataResourceCard.findCard(copiedNotebookName, ResourceCard.Notebook);\n-  expect(notebookCard).toBeTruthy();\n-\n-  // Delete notebook\n-  const modalTextContent = await analysisPage.deleteResource(copiedNotebookName, ResourceCard.Notebook);\n-  expect(modalTextContent).toContain('This will permanently delete the Notebook.');\n+async function copyNotebookTest(sourceWorkspaceName: string, destCdrVersionName: string) {\n+\n+   const destWorkspace = await createWorkspace(page, destCdrVersionName).then(card => card.getWorkspaceName());\n+\n+   // Find and open source workspace Data page.\n+   const workspaceCard = await WorkspaceCard.findCard(page, sourceWorkspaceName);\n+   await workspaceCard.clickWorkspaceName();\n+\n+   // Create notebook in source workspace.\n+   const sourceNotebookName = makeRandomName('pytest');\n+   const dataPage = new WorkspaceDataPage(page);\n+\n+   const sourceWorkspacePage = await dataPage.createNotebook(sourceNotebookName);\n+\n+   // Exit notebook and returns to the Workspace Analysis tab.\n+   const analysisPage = await sourceWorkspacePage.goAnalysisPage();\n+\n+   // Copy to destination Workspace and give notebook a new name.\n+   const copiedNotebookName = makeRandomName('copy-of');\n+   await analysisPage.copyNotebookToWorkspace(sourceNotebookName, destWorkspace, copiedNotebookName);\n+\n+   // Verify Copy Success modal.\n+   const modal = new Modal(page);\n+   await modal.waitForButton(LinkText.GoToCopiedNotebook);\n+   const textContent = await modal.getTextContent();\n+   const successMsg = `Successfully copied ${sourceNotebookName}  to ${destWorkspace} . Do you want to view the copied Notebook?`;\n+   expect(textContent).toContain(successMsg);\n+   // Dismiss modal.\n+   await modal.clickButton(LinkText.StayHere, {waitForClose: true});\n+\n+   // Delete notebook\n+   const deleteModalTextContent = await analysisPage.deleteResource(sourceNotebookName, ResourceCard.Notebook);\n+   expect(deleteModalTextContent).toContain(`Are you sure you want to delete Notebook: ${sourceNotebookName}?`);\n+\n+   // Perform actions in copied notebook.\n+   // Open destination Workspace\n+   await findOrCreateWorkspace(page, {workspaceName: destWorkspace}).then(card => card.clickWorkspaceName());\n+\n+   // Verify copy-to notebook exists in destination Workspace\n+   await dataPage.openAnalysisPage();\n+   const dataResourceCard = new DataResourceCard(page);\n+   const notebookCard = await dataResourceCard.findCard(copiedNotebookName, ResourceCard.Notebook);\n+   expect(notebookCard).toBeTruthy();\n+\n+   // Delete notebook\n+   const modalTextContent = await analysisPage.deleteResource(copiedNotebookName, ResourceCard.Notebook);\n+   expect(modalTextContent).toContain('This will permanently delete the Notebook.');\n+\n+   // Delete destination workspace\n+   await analysisPage.deleteWorkspace();\n }\n \n-describe('Workspace owner Jupyter notebook action tests', () => {\n+async function createCustomCdrVersionWorkspace(cdrVersion: string): Promise<string> {\n+   const workspace = await createWorkspace(page, cdrVersion);\n+   return workspace.getWorkspaceName();\n+}\n \n-  beforeEach(async () => {\n-    await signIn(page);\n-  });\n+// Reuse same source workspace for all tests in this file, in order to reduce test playback time.\n+// Workspace to be created in first test. If create failed in first test, next test will try create it.\n+let srcWorkspace: string;", "originalCommit": "c73653cfeeb1878125b26d8e90bfb8356b111c29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwMzM5OQ==", "url": "https://github.com/all-of-us/workbench/pull/4359#discussion_r537603399", "bodyText": "Done", "author": "aweng98", "createdAt": "2020-12-07T15:37:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5NDE0Mg=="}], "type": "inlineReview"}, {"oid": "0587a4fdd0129c074eea8f8b246683700fdf05af", "url": "https://github.com/all-of-us/workbench/commit/0587a4fdd0129c074eea8f8b246683700fdf05af", "message": "address pr feedback", "committedDate": "2020-12-07T15:39:45Z", "type": "commit"}]}