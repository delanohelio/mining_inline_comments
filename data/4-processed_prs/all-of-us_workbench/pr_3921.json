{"pr_number": 3921, "pr_title": "[RW-5380][risk=no] API - CohortReviewController should use CohortBuilderService instead of CBCriteriaDao", "pr_createdAt": "2020-08-26T01:55:09Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3921", "timeline": [{"oid": "2e6334d9057edcf7b98e0895ec6be03c088f04c7", "url": "https://github.com/all-of-us/workbench/commit/2e6334d9057edcf7b98e0895ec6be03c088f04c7", "message": "Use Service not CbCriteriaDao", "committedDate": "2020-08-26T01:53:44Z", "type": "commit"}, {"oid": "aaa30853244c32bac9896040342a9c8941d43832", "url": "https://github.com/all-of-us/workbench/commit/aaa30853244c32bac9896040342a9c8941d43832", "message": "Fix BQ and Api test", "committedDate": "2020-08-26T02:42:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM5NzcyOA==", "url": "https://github.com/all-of-us/workbench/pull/3921#discussion_r477397728", "bodyText": "I was thinking about moving the logic to update PageRequest inside cohortBuilderService as well, replacing the entire method. Let me know what you think", "author": "NehaBroad", "createdAt": "2020-08-26T15:38:35Z", "path": "api/src/main/java/org/pmiops/workbench/api/CohortReviewController.java", "diffHunk": "@@ -745,25 +732,10 @@ private DbCohortReview createNewCohortReview(\n   private void convertGenderRaceEthnicitySortOrder(PageRequest pageRequest) {\n     String sortColumn = pageRequest.getSortColumn();\n     String sortName = pageRequest.getSortOrder().name();\n-    Sort sort =\n-        sortName.equalsIgnoreCase(Direction.ASC.toString())\n-            ? new Sort(Direction.ASC, \"name\")\n-            : new Sort(Direction.DESC, \"name\");\n     if (GENDER_RACE_ETHNICITY_TYPES.contains(sortColumn)) {\n-      List<DbCriteria> criteriaList =\n-          cbCriteriaDao.findByDomainIdAndTypeAndParentIdNotIn(\n-              DomainType.PERSON.toString(), sortColumn, 0L, sort);\n-      Map<String, Map<Long, String>> concepts = new HashMap<>();\n       List<String> demoList =\n-          criteriaList.stream()\n-              .map(\n-                  c ->\n-                      new ConceptIdName()\n-                          .conceptId(new Long(c.getConceptId()))\n-                          .conceptName(c.getName()))\n-              .sorted(Comparator.comparing(ConceptIdName::getConceptName))\n-              .map(c -> c.getConceptId().toString())\n-              .collect(Collectors.toList());\n+          cohortBuilderService.findSortedConceptIdsByDomainIdAndTypeAndParentIdNotIn(", "originalCommit": "aaa30853244c32bac9896040342a9c8941d43832", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU0NjYwMw==", "url": "https://github.com/all-of-us/workbench/pull/3921#discussion_r478546603", "bodyText": "That seems fine.", "author": "freemabd", "createdAt": "2020-08-27T16:29:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM5NzcyOA=="}], "type": "inlineReview"}, {"oid": "3e57b093ce3fa1597209fd134c2a856fe925e8c6", "url": "https://github.com/all-of-us/workbench/commit/3e57b093ce3fa1597209fd134c2a856fe925e8c6", "message": "Merge", "committedDate": "2020-08-27T17:50:00Z", "type": "commit"}]}