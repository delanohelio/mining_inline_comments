{"pr_number": 3012, "pr_title": "[RISK=NO][No ticket]Add default value to creation_Time", "pr_createdAt": "2020-01-17T22:50:30Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3012", "timeline": [{"oid": "64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "url": "https://github.com/all-of-us/workbench/commit/64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "message": "Add default value to creation_Time", "committedDate": "2020-01-17T22:17:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE3MTUxOA==", "url": "https://github.com/all-of-us/workbench/pull/3012#discussion_r368171518", "bodyText": "Has this already been run? If so, do we know it's safe to change it? We don't want to lose the ability to keep all the environments in lockstep.\nIn general, if I'm looking at the history of a liquibase xml file, I only ever expect to see changes when a new step is added, and the individual step xmls should only have one commit, right?", "author": "jaycarlton", "createdAt": "2020-01-17T23:02:50Z", "path": "api/db/changelog/db.changelog-115-addColumn-user-create-modified.xml", "diffHunk": "@@ -6,18 +6,12 @@\n                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n   <changeSet author=\"nsaxena\" id=\"db.changelog-115-addColumn-user-create-modified\">\n     <addColumn tableName=\"user\">\n-      <column name=\"creation_time\" type=\"datetime\">", "originalCommit": "64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIwMTU5OQ==", "url": "https://github.com/all-of-us/workbench/pull/3012#discussion_r368201599", "bodyText": "See the slack thread on why it's gotten so complicated but the TLDR on our approach is that we are going to manually rollback the 115 changset that ran on test so that this version can successfully execute.", "author": "ericsong", "createdAt": "2020-01-18T02:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE3MTUxOA=="}], "type": "inlineReview"}, {"oid": "d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "url": "https://github.com/all-of-us/workbench/commit/d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "message": "Conflict resolve", "committedDate": "2020-01-17T23:02:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5OTA5NQ==", "url": "https://github.com/all-of-us/workbench/pull/3012#discussion_r368199095", "bodyText": "I believe the tag we want to use is valueDate https://www.liquibase.org/documentation/column.html\nThat will set the column value when the migration is run. I believe defaultValueDate will set the default value in MySQL which we shouldn't need since we should be setting it to the current timestamp on object creation (in our Java code).", "author": "ericsong", "createdAt": "2020-01-18T02:11:14Z", "path": "api/db/changelog/db.changelog-115-addColumn-user-create-modified.xml", "diffHunk": "@@ -6,15 +6,12 @@\n                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n   <changeSet author=\"nsaxena\" id=\"db.changelog-115-addColumn-user-create-modified\">\n     <addColumn tableName=\"user\">\n-      <column name=\"creation_time\" type=\"datetime\">\n-        <constraints nullable=\"true\" />\n+      <column name=\"creation_time\" type=\"datetime\" defaultValueDate=\"1970-01-01 00:00:00\">\n+        <constraints nullable=\"false\" />\n       </column>\n-      <column name=\"last_modified_time\" type=\"datetime\" defaultValueDate=\"CURRENT_TIMESTAMP\">\n-        <constraints nullable=\"false\"/>\n+      <column name=\"last_modified_time\" type=\"datetime\" defaultValueDate=\"1970-01-01 00:00:00\">", "originalCommit": "d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIwNTkwMw==", "url": "https://github.com/all-of-us/workbench/pull/3012#discussion_r368205903", "bodyText": "i was finally able to resolve my server and test this, defaultValue results in 1970-01-01 00:00:00 to existing entries\n\nWhen i tried using 'value' instead of defaultValue it started throwing the error\nliquibase.exception.LiquibaseException: Unexpected error running Liquibase: Data truncation: Incorrect datetime value: '0000-00-00 00:00:00' for column 'creation_time' at row 1 [Failed SQL: ALTER TABLE workbench.user ADD creation_time datetime NOT NULL, ADD last_modified_time datetime NOT NULL]\nhttps://stackoverflow.com/questions/8904316/adding-a-non-nullable-column-to-existing-table-fails-is-the-value-attribute-b", "author": "NehaBroad", "createdAt": "2020-01-18T04:41:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5OTA5NQ=="}], "type": "inlineReview"}, {"oid": "f7c7ed09877ad85ea2c45c682008616edf3f351f", "url": "https://github.com/all-of-us/workbench/commit/f7c7ed09877ad85ea2c45c682008616edf3f351f", "message": "change changesheet name", "committedDate": "2020-01-18T16:12:43Z", "type": "commit"}]}