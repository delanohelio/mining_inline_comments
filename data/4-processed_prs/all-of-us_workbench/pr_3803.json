{"pr_number": 3803, "pr_title": "[RW-5089][risk=no] Centralize Zendesk urlset and correct sandbox URLs", "pr_createdAt": "2020-07-17T21:30:34Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3803", "timeline": [{"oid": "916d54d397b8d47c5f464944113c21ba41f4951d", "url": "https://github.com/all-of-us/workbench/commit/916d54d397b8d47c5f464944113c21ba41f4951d", "message": "Switch to Zendesk urlset", "committedDate": "2020-07-17T21:10:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5MzQzOA==", "url": "https://github.com/all-of-us/workbench/pull/3803#discussion_r457393438", "bodyText": "nit: What is the benefit of wrapping everything in an IIFE here? The only export is a ZendeskUrls object. Not actually a big difference, but it might be clearer to do:\nconst baseUrl = environment.zendeskHelpCenterUrl;\n\n... most of function body ...\n\nlet supportUrls: ZendeskUrls = urls[prodHost];\nif (urls[host]) {\n  supportUrls = urls[host];\n}\nexport supportUrls;", "author": "gjuggler", "createdAt": "2020-07-20T13:40:12Z", "path": "ui/src/app/utils/zendesk.ts", "diffHunk": "@@ -1,4 +1,69 @@\n import {ElementRef} from '@angular/core';\n+import {environment} from 'environments/environment';\n+\n+interface ZendeskUrls {\n+  billing: string,\n+  communityForum: string,\n+  createBillingAccount: string,\n+  dataDictionary: string,\n+  faq: string,\n+  gettingStarted: string,\n+  tableOfContents: string,\n+  researchPurpose: string,\n+}\n+\n+/**\n+ * A set of support URLs for the current environment. These need to be\n+ * parameterized per environment since the Zendesk support content IDs are not\n+ * stable across the prod and sandbox Zendesk instances.\n+ */\n+export const supportUrls: ZendeskUrls = ((baseUrl) => {", "originalCommit": "916d54d397b8d47c5f464944113c21ba41f4951d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYxNDcxNw==", "url": "https://github.com/all-of-us/workbench/pull/3803#discussion_r457614717", "bodyText": "Primarily stylistic preference. Generally I prefer to minimize the footprint in the package context. The state and helpers I've created (for the sole purpose of initializing these URLs) are scoped as tightly as possible and don't pollute the top level context of this file - the top-level approach leaves open the possibility of references / closures from any of the functions defined in the package. Of course, we wouldn't create any such references here, but as a first-time reader of this file I'd need to think/search to rule this out.\nVisually, I also find it easier as a reader to scan this package to understand what is being exported, and what's just the internal code details. The visual hierarchy is easier to scan than picking out the export keyword from several top-level statements.", "author": "calbach", "createdAt": "2020-07-20T18:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5MzQzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5NTYyNw==", "url": "https://github.com/all-of-us/workbench/pull/3803#discussion_r457395627", "bodyText": "Rather than trying to parse this URL and implicitly identify the Zendesk environment we're binding to, it may be simpler (and more true to the intent) to have 'prod' and 'sandbox' as the allowable env variables here, and use that to key the urls map above.", "author": "gjuggler", "createdAt": "2020-07-20T13:42:36Z", "path": "ui/src/environments/environment-type.ts", "diffHunk": "@@ -43,7 +43,6 @@ export interface Environment {\n   // The base URL for the Zendesk help center / user forum.\n   // Example value: https://aousupporthelp.zendesk.com/hc/\n   zendeskHelpCenterUrl: string;", "originalCommit": "916d54d397b8d47c5f464944113c21ba41f4951d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwNTQxNA==", "url": "https://github.com/all-of-us/workbench/pull/3803#discussion_r457605414", "bodyText": "Good suggestion. Done. I think this way is clearer. I also moved the widget key out, since it follows from the environment type.", "author": "calbach", "createdAt": "2020-07-20T18:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5NTYyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5ODI4MQ==", "url": "https://github.com/all-of-us/workbench/pull/3803#discussion_r457398281", "bodyText": "This change feels in the opposite direction from changes in all the other files (where we remove an environment dependency and add a zendesk dependency). See my comment on environment.ts below... it may be cleanest to make the env variable a simple prod vs. sandbox signal, and have all access to Zendesk URLs go through the zendesk module. Which would turn this reference into:\nhref={supportUrls.helpCenterUrl}", "author": "gjuggler", "createdAt": "2020-07-20T13:45:33Z", "path": "ui/src/app/pages/homepage/homepage.tsx", "diffHunk": "@@ -22,6 +22,7 @@ import colors, {addOpacity} from 'app/styles/colors';\n import {hasRegisteredAccessFetch, reactStyles, ReactWrapperBase, withUserProfile} from 'app/utils';\n import {AnalyticsTracker} from 'app/utils/analytics';\n import {fetchWithGlobalErrorHandler} from 'app/utils/retry';\n+import {environment} from 'environments/environment';", "originalCommit": "916d54d397b8d47c5f464944113c21ba41f4951d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwNjI4Ng==", "url": "https://github.com/all-of-us/workbench/pull/3803#discussion_r457606286", "bodyText": "Done per other suggestion. The reason this looked different is b/c the Zendesk URL was simply hardcoded on this page originally, i.e. in worse shape than the other links - otherwise I wouldn't have needed to change this", "author": "calbach", "createdAt": "2020-07-20T18:24:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5ODI4MQ=="}], "type": "inlineReview"}, {"oid": "ce598626c93d0d8c357c77a90de10ccb42be6dff", "url": "https://github.com/all-of-us/workbench/commit/ce598626c93d0d8c357c77a90de10ccb42be6dff", "message": "PR feedback", "committedDate": "2020-07-20T18:21:22Z", "type": "commit"}, {"oid": "a1a71e68bdf619a385eb126d80e8b8a0c424fd66", "url": "https://github.com/all-of-us/workbench/commit/a1a71e68bdf619a385eb126d80e8b8a0c424fd66", "message": "lint", "committedDate": "2020-07-20T18:42:03Z", "type": "commit"}]}