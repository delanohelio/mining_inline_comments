{"pr_number": 3832, "pr_title": "[no ticket][risk=no] Puppeteer: parameterize getPropValue function", "pr_createdAt": "2020-07-25T17:56:34Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3832", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxNjc5MA==", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r460916790", "bodyText": "non-async functions, await not needed.", "author": "aweng98", "createdAt": "2020-07-27T14:08:32Z", "path": "e2e/jest.test-setup.ts", "diffHunk": "@@ -15,8 +15,8 @@ const timeOut = parseInt(process.env.PUPPETEER_TIMEOUT, 10) || 90000;\n beforeEach(async () => {\n   await page.setUserAgent(userAgent);\n   // See https://github.com/puppeteer/puppeteer/blob/master/docs/api.md#pagesetdefaultnavigationtimeouttimeout\n-  await page.setDefaultNavigationTimeout(navTimeOut);\n-  await page.setDefaultTimeout(timeOut);", "originalCommit": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxNzI5Mg==", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r460917292", "bodyText": "page.url() is also non-async call. removed await here and several other places.", "author": "aweng98", "createdAt": "2020-07-27T14:09:13Z", "path": "e2e/tests/cohorts/cohorts-create.spec.ts", "diffHunk": "@@ -121,7 +121,7 @@ describe('User can create new Cohorts', () => {\n     const dataPage = new DataPage(page);\n \n     // Save url\n-    const workspaceDataUrl = await page.url();\n+    const workspaceDataUrl = page.url();", "originalCommit": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0MDk2Mw==", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465140963", "bodyText": "What does link argument name mean in this context? Maybe it should be renamed to el for consistency with attr.\nAm I right in assessing that this function is basically designed to have Puppeteer evaluate the ElementHandle into an actual Element which is then used to return the attribute value?", "author": "gjuggler", "createdAt": "2020-08-04T15:34:07Z", "path": "e2e/utils/element-utils.ts", "diffHunk": "@@ -7,24 +7,24 @@ import {ElementHandle, JSHandle, Page} from 'puppeteer';\n  * @param {string} attribute Attribute name.\n  */\n export const getAttrValue = async (page: Page, element: ElementHandle, attribute: string): Promise<string> => {\n-  return page.evaluate((link, attr) => link.getAttribute(attr), element, attribute);\n+  return page.evaluate((link, attr) => {return link.getAttribute(attr)}, element, attribute);", "originalCommit": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwNzM1Nw==", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465207357", "bodyText": "\ud83d\udc4d renamed link to elemt for consistency.\nand yes to the second question, the evaluate function does just that.", "author": "aweng98", "createdAt": "2020-08-04T17:19:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0MDk2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0Mjg3Mg==", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465142872", "bodyText": "What is the purpose of this change? This seems like the opposite syntax compared to the method above.", "author": "gjuggler", "createdAt": "2020-08-04T15:36:51Z", "path": "e2e/utils/element-utils.ts", "diffHunk": "@@ -7,24 +7,24 @@ import {ElementHandle, JSHandle, Page} from 'puppeteer';\n  * @param {string} attribute Attribute name.\n  */\n export const getAttrValue = async (page: Page, element: ElementHandle, attribute: string): Promise<string> => {\n-  return page.evaluate((link, attr) => link.getAttribute(attr), element, attribute);\n+  return page.evaluate((link, attr) => {return link.getAttribute(attr)}, element, attribute);\n }\n \n /**\n  * Gets the property value.\n  * @param {ElementHandle} element Element.\n  * @param {string} property Property name.\n  */\n-export const getPropValue = async (element: ElementHandle, property: string): Promise<string> => {\n+export async function getPropValue<T> (element: ElementHandle, property: string): Promise<T> {\n   const value = await element.getProperty(property).then((prop) => prop.jsonValue());\n-  return value.toString().trim();\n+  return value as T;\n }\n \n /*\n  * Wait until the existing element changed in DOM.\n  * @param {Page} page Instance of Puppeteer page object.\n  * @param {ElementHandle} element Element.\n  */\n-export async function waitUntilChanged(page: Page, element: ElementHandle): Promise<JSHandle> {\n+export const waitUntilChanged = async (page: Page, element: ElementHandle): Promise<JSHandle> => {", "originalCommit": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwODU4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465208587", "bodyText": "forgot to change it back. I was experimenting.", "author": "aweng98", "createdAt": "2020-08-04T17:21:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0Mjg3Mg=="}], "type": "inlineReview"}, {"oid": "45f567bddf2591d6a6622b2a3c29642728b51076", "url": "https://github.com/all-of-us/workbench/commit/45f567bddf2591d6a6622b2a3c29642728b51076", "message": "refactor getPropValue function", "committedDate": "2020-08-04T17:09:33Z", "type": "forcePushed"}, {"oid": "e2631f9ad2a7fe5b3e9a3af88bea8f090137d472", "url": "https://github.com/all-of-us/workbench/commit/e2631f9ad2a7fe5b3e9a3af88bea8f090137d472", "message": "refactor getPropValue function", "committedDate": "2020-08-04T17:14:21Z", "type": "commit"}, {"oid": "5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "url": "https://github.com/all-of-us/workbench/commit/5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "message": "PR feedback", "committedDate": "2020-08-04T17:20:55Z", "type": "commit"}, {"oid": "5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "url": "https://github.com/all-of-us/workbench/commit/5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "message": "PR feedback", "committedDate": "2020-08-04T17:20:55Z", "type": "forcePushed"}]}