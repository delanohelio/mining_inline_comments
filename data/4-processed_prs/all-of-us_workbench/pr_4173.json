{"pr_number": 4173, "pr_title": "[RW-5753][risk=no] Address flaky Puppeteer Cohort tests", "pr_createdAt": "2020-10-15T19:07:59Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4173", "timeline": [{"oid": "4d81d6c3f419a6065b3252c30c81593863cacc0a", "url": "https://github.com/all-of-us/workbench/commit/4d81d6c3f419a6065b3252c30c81593863cacc0a", "message": "bigger timeout waiting for cohort count", "committedDate": "2020-10-15T19:16:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMTY0NA==", "url": "https://github.com/all-of-us/workbench/pull/4173#discussion_r506431644", "bodyText": "Question: Why was waitForText removed?", "author": "NehaBroad", "createdAt": "2020-10-16T13:37:53Z", "path": "e2e/tests/cohorts/cohorts-create.spec.ts", "diffHunk": "@@ -46,14 +46,13 @@ describe('User can create new Cohorts', () => {\n     const group1Count = await group1.includePhysicalMeasurement(PhysicalMeasurementsCriteria.BMI, 30);\n \n     // Checking Group 1 Count. should match Group 1 participants count.\n-    await waitForText(page, group1Count, {xpath: group1.getGroupCountXpath()});\n-    const group1CountInt = Number(group1Count.replace(/,/g, ''));\n+    const group1CountInt = Number((await group1.getGroupCount()).replace(/,/g, ''));", "originalCommit": "4d81d6c3f419a6065b3252c30c81593863cacc0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMjAzNw==", "url": "https://github.com/all-of-us/workbench/pull/4173#discussion_r506432037", "bodyText": "Because you added await?", "author": "NehaBroad", "createdAt": "2020-10-16T13:38:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMTY0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ4MTAzMg==", "url": "https://github.com/all-of-us/workbench/pull/4173#discussion_r506481032", "bodyText": "Replaced it with call to await group1.getGroupCount() to find Group Count.", "author": "aweng98", "createdAt": "2020-10-16T14:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMTY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMzIwOA==", "url": "https://github.com/all-of-us/workbench/pull/4173#discussion_r506433208", "bodyText": "Since timeOut is an optional argument should there be a check to see if it exist before using it.", "author": "NehaBroad", "createdAt": "2020-10-16T13:39:29Z", "path": "e2e/utils/waits-utils.ts", "diffHunk": "@@ -225,15 +225,16 @@ export async function waitForNumberElements(page: Page,\n  */\n export async function waitForText(page: Page,\n                                   textSubstr: string,\n-                                  selector: {xpath?: string, css?: string} = {css: 'body'}): Promise<boolean> {\n+                                  selector: {xpath?: string, css?: string} = {css: 'body'},\n+                                  timeOut?: number): Promise<boolean> {\n   if (selector.css !== undefined) {\n     try {\n          // wait for visible then compare texts\n       await page.waitForSelector(selector.css, {visible: true});\n       const jsHandle = await page.waitForFunction((css, expText) => {\n         const element = document.querySelector(css);\n         return element && element.textContent.includes(expText);\n-      }, {}, selector.css, textSubstr);\n+      }, {timeout: timeOut}, selector.css, textSubstr);", "originalCommit": "4d81d6c3f419a6065b3252c30c81593863cacc0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ4MzUxMA==", "url": "https://github.com/all-of-us/workbench/pull/4173#discussion_r506483510", "bodyText": "page.waitForFunction ignores undefined optional param.", "author": "aweng98", "createdAt": "2020-10-16T14:27:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMzIwOA=="}], "type": "inlineReview"}, {"oid": "be689961da06d06eef2ece1ec53dde65268a11ba", "url": "https://github.com/all-of-us/workbench/commit/be689961da06d06eef2ece1ec53dde65268a11ba", "message": "bigger timeout waiting for cohort count", "committedDate": "2020-10-16T14:22:16Z", "type": "commit"}, {"oid": "8199421a1546d84088abc819fe161f6ec23f3750", "url": "https://github.com/all-of-us/workbench/commit/8199421a1546d84088abc819fe161f6ec23f3750", "message": "remove empty lines", "committedDate": "2020-10-16T14:48:26Z", "type": "commit"}, {"oid": "8199421a1546d84088abc819fe161f6ec23f3750", "url": "https://github.com/all-of-us/workbench/commit/8199421a1546d84088abc819fe161f6ec23f3750", "message": "remove empty lines", "committedDate": "2020-10-16T14:48:26Z", "type": "forcePushed"}]}