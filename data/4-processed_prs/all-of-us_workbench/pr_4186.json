{"pr_number": 4186, "pr_title": "[risk=low][RW-5720] Display CDR Version name string in Workspace navbar", "pr_createdAt": "2020-10-19T16:37:42Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4186", "timeline": [{"oid": "f2df13b91235c81ff93479a3c136f382a415d57e", "url": "https://github.com/all-of-us/workbench/commit/f2df13b91235c81ff93479a3c136f382a415d57e", "message": "cdrVersion() function gets the full CdrVersion object based on the current workspace's ID", "committedDate": "2020-10-19T14:30:37Z", "type": "commit"}, {"oid": "fce4e05b40a4dbf2ac33851dfa8fa4adc41a5e2f", "url": "https://github.com/all-of-us/workbench/commit/fce4e05b40a4dbf2ac33851dfa8fa4adc41a5e2f", "message": "style update", "committedDate": "2020-10-19T16:35:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5NjYzOA==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r507896638", "bodyText": "no changes to any of these - just formatting", "author": "jmthibault79", "createdAt": "2020-10-19T16:39:45Z", "path": "ui/src/app/pages/workspace/workspace-nav-bar.tsx", "diffHunk": "@@ -2,35 +2,58 @@ import {Component, Input} from '@angular/core';\n \n import {Clickable} from 'app/components/buttons';\n import colors from 'app/styles/colors';\n-import {reactStyles, ReactWrapperBase, withCurrentWorkspace, withUrlParams} from 'app/utils';\n+import {\n+  cdrVersion,\n+  reactStyles,\n+  ReactWrapperBase,\n+  withCdrVersions,\n+  withCurrentWorkspace,\n+  withUrlParams\n+} from 'app/utils';\n import {NavStore} from 'app/utils/navigation';\n \n import {serverConfigStore} from 'app/utils/navigation';\n import * as fp from 'lodash/fp';\n import * as React from 'react';\n \n-\n const styles = reactStyles({\n   container: {\n-    display: 'flex', alignItems: 'center', backgroundColor: colors.secondary,\n-    fontWeight: 500, color: 'white', textTransform: 'uppercase',\n-    height: 60, paddingRight: 16,\n+    display: 'flex',", "originalCommit": "fce4e05b40a4dbf2ac33851dfa8fa4adc41a5e2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c4c95a445e669b5acfbdd8e4abdff3fc6b4e3449", "url": "https://github.com/all-of-us/workbench/commit/c4c95a445e669b5acfbdd8e4abdff3fc6b4e3449", "message": "test fix", "committedDate": "2020-10-19T17:16:07Z", "type": "commit"}, {"oid": "fd6ddead7795a5f8a4bb3463f4f9ad34791792e5", "url": "https://github.com/all-of-us/workbench/commit/fd6ddead7795a5f8a4bb3463f4f9ad34791792e5", "message": "add tests", "committedDate": "2020-10-19T17:35:39Z", "type": "commit"}, {"oid": "eb6901368577f8e42cc2c2a04fb1e67adb232308", "url": "https://github.com/all-of-us/workbench/commit/eb6901368577f8e42cc2c2a04fb1e67adb232308", "message": "lint", "committedDate": "2020-10-19T17:36:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3NzE2NQ==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r507977165", "bodyText": "is checking for the workspace sufficient here? What if cdrVersionListResponse is still loading?", "author": "ericsong", "createdAt": "2020-10-19T18:33:57Z", "path": "ui/src/app/pages/workspace/workspace-about.tsx", "diffHunk": "@@ -244,7 +239,7 @@ export const WorkspaceAbout = fp.flow(withUserProfile(), withUrlParams(), withCd\n           </h3>\n           <div style={styles.infoBox} data-test-id='cdrVersion'>\n             <div style={styles.infoBoxHeader}>Dataset</div>\n-            <div style={{fontSize: '0.5rem'}}>{cdrVersion ? cdrVersion.name : 'Loading...'}</div>\n+            <div style={{fontSize: '0.5rem'}}>{workspace ? cdrVersion(workspace, cdrVersionListResponse).name : 'Loading...'}</div>", "originalCommit": "eb6901368577f8e42cc2c2a04fb1e67adb232308", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwODIxMQ==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r508008211", "bodyText": "There's a comment on the withCdrVersions() HOC: \"Rendering of the connected component is blocked on initial load of the CDR versions.\"", "author": "jmthibault79", "createdAt": "2020-10-19T19:26:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3NzE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcwMTIzOA==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r508701238", "bodyText": "Oops.  Looks like you were right: #4191\nThe comment above is correct.  the HOC withCdrVersions() blocks rendering until it's present because it's a ReplaySubject.  withCurrentWorkspace() is a BehaviorSubject, which doesn't have this feature unless a flag is explicitly set for it.", "author": "jmthibault79", "createdAt": "2020-10-20T17:14:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3NzE2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3ODA3Mg==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r507978072", "bodyText": "do we need this check for a workspace if we're already doing that in the parent component before rendering this?", "author": "ericsong", "createdAt": "2020-10-19T18:35:27Z", "path": "ui/src/app/pages/workspace/workspace-nav-bar.tsx", "diffHunk": "@@ -81,6 +104,9 @@ export const WorkspaceNavBarReact = fp.flow(\n     {activeTabIndex > 0 && navSeparator}\n     {fp.map(tab => navTab(tab, restrictTab(props.workspace, tab)), tabs)}\n     <div style={{flexGrow: 1}}/>\n+    {workspace && <div data-test-id='cdr-version' style={{textTransform: 'none'}}>", "originalCommit": "eb6901368577f8e42cc2c2a04fb1e67adb232308", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwNjQyNw==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r508006427", "bodyText": "That was also my assumption, but workspace is initially undefined here.  I don't know why.", "author": "jmthibault79", "createdAt": "2020-10-19T19:23:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3ODA3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcxMDU3Mw==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r508710573", "bodyText": "This line got dropped somehow.  Re-added in #4191", "author": "jmthibault79", "createdAt": "2020-10-20T17:28:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3ODA3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3ODU1MA==", "url": "https://github.com/all-of-us/workbench/pull/4186#discussion_r507978550", "bodyText": "can you add a verb to the function? I wasn't really sure what it did until I found the definition.", "author": "ericsong", "createdAt": "2020-10-19T18:36:18Z", "path": "ui/src/app/utils/index.tsx", "diffHunk": "@@ -627,3 +630,7 @@ export function validateInputForMySQL(searchString: string): Array<string> {\n   }\n   return Array.from(inputErrors);\n }\n+\n+export function cdrVersion(workspace: Workspace, cdrs: CdrVersionListResponse): CdrVersion {", "originalCommit": "eb6901368577f8e42cc2c2a04fb1e67adb232308", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cc28451cc9c9fca9308e7256fa07296e524d5db9", "url": "https://github.com/all-of-us/workbench/commit/cc28451cc9c9fca9308e7256fa07296e524d5db9", "message": "rename cdrVersion() to getCdrVersion()", "committedDate": "2020-10-19T19:27:05Z", "type": "commit"}]}