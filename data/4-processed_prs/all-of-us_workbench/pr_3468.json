{"pr_number": 3468, "pr_title": "[no ticket][risk=no] Puppeteer framework new component Dialog", "pr_createdAt": "2020-04-23T23:31:18Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3468", "timeline": [{"oid": "102a79d9983ab00bc9cd55c3c5429d7136215b7b", "url": "https://github.com/all-of-us/workbench/commit/102a79d9983ab00bc9cd55c3c5429d7136215b7b", "message": "componenet Modal\n\nsaving", "committedDate": "2020-04-23T22:39:41Z", "type": "commit"}, {"oid": "a9f4cb7bb291902cb0201d4d498fde0fb5c1275f", "url": "https://github.com/all-of-us/workbench/commit/a9f4cb7bb291902cb0201d4d498fde0fb5c1275f", "message": "refactor isLoaded", "committedDate": "2020-04-23T23:31:35Z", "type": "commit"}, {"oid": "93bb8d5eb38924821bbbeee3be046d1324e3c594", "url": "https://github.com/all-of-us/workbench/commit/93bb8d5eb38924821bbbeee3be046d1324e3c594", "message": "verify dialog text", "committedDate": "2020-04-23T23:48:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5OTI1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3468#discussion_r414199256", "bodyText": "This method used to work only for the CREATE WORKSPACE button on new workspace form. There is a separate methods for dealing with DUPLICATE WORKSPACE button on duplicate workspace form. To avoid boilerplate code, it is now just one method that handles both button, waiting and pop-up dialog.", "author": "aweng98", "createdAt": "2020-04-23T23:52:01Z", "path": "e2e/app/page/workspace-edit-page.ts", "diffHunk": "@@ -424,11 +425,20 @@ export default class WorkspaceEditPage extends AuthenticatedPage {\n   /**\n    * Find and click the CREATE WORKSPACE (FINISH) button\n    */\n-  async clickCreateFinishButton(): Promise<void> {\n-    const createButton = await this.getCreateWorkspaceButton();\n-    await createButton.focus(); // bring into viewport\n-    await this.clickAndWait(createButton);\n+  async clickCreateFinishButton(button: ElementHandle | Button): Promise<string> {\n+    await button.focus(); // bring into viewport\n+    await button.click();\n+\n+    // confirm create in pop-up dialog\n+    const dialog = new Dialog(this.page);\n+    const dialogText = await dialog.getContent();\n+    await Promise.all([\n+      dialog.clickButton(ButtonLabel.Confirm),\n+      dialog.waitUntilDialogIsClosed(),\n+      this.page.waitForNavigation({waitUntil: ['domcontentloaded', 'networkidle0'], timeout: 60000}),\n+    ]);\n     await this.waitUntilNoSpinner();\n+    return dialogText;\n   }", "originalCommit": "93bb8d5eb38924821bbbeee3be046d1324e3c594", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMDE2Ng==", "url": "https://github.com/all-of-us/workbench/pull/3468#discussion_r414200166", "bodyText": "timeout: 0 broke screenshot when test fails. changing it back to 60 seconds so takeScreenshot works again.", "author": "aweng98", "createdAt": "2020-04-23T23:54:36Z", "path": "e2e/app/page/base-page.ts", "diffHunk": "@@ -51,7 +51,7 @@ export default abstract class BasePage {\n    */\n   async clickAndWait(clickElement: ElementHandle | BaseElement) {\n     return Promise.all([\n-      this.page.waitForNavigation({waitUntil: ['domcontentloaded', 'networkidle0'], timeout: 0}),\n+      this.page.waitForNavigation({waitUntil: ['domcontentloaded', 'networkidle0'], timeout: 60000}),", "originalCommit": "93bb8d5eb38924821bbbeee3be046d1324e3c594", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMTA0Mg==", "url": "https://github.com/all-of-us/workbench/pull/3468#discussion_r414201042", "bodyText": "dialog texts verifications on selected few lines of words.", "author": "aweng98", "createdAt": "2020-04-23T23:56:54Z", "path": "e2e/tests/workspace/workspace-create.spec.ts", "diffHunk": "@@ -19,7 +19,16 @@ describe('Creating new workspaces', () => {\n     await workspacesPage.load();\n \n     // create workspace with \"No Review Requested\" radiobutton selected\n-    await workspacesPage.createWorkspace(newWorkspaceName, 'Use All of Us free credits',);\n+    const dialogTextContent = await workspacesPage.createWorkspace(newWorkspaceName, 'Use All of Us free credits',);\n+\n+    console.log(dialogTextContent);\n+\n+    // Pick out few sentenses to verify\n+    expect(dialogTextContent).toContain('Primary purpose of your project (Question 1)');\n+    expect(dialogTextContent).toContain('Summary of research purpose (Question 2)');\n+    expect(dialogTextContent).toContain('Will be displayed publicly to inform All of Us Research participants.');\n+    expect(dialogTextContent).toContain('You can also make changes to your answers after you create your workspace.');\n+", "originalCommit": "93bb8d5eb38924821bbbeee3be046d1324e3c594", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2ad4ce8b1182d735929ae5fd1ca775970274acd", "url": "https://github.com/all-of-us/workbench/commit/c2ad4ce8b1182d735929ae5fd1ca775970274acd", "message": "global timeout", "committedDate": "2020-04-24T13:42:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwNTM0OA==", "url": "https://github.com/all-of-us/workbench/pull/3468#discussion_r414605348", "bodyText": "This is a bit of a behavior change, where it will do all of them in parallel now instead of sequence. Is that okay? (I don't know if the pages need to load before you can get the tab selectors?)\nIt looks fine though, thinking about it conceptually, and this also seems better from a code standpoint! Nice job!", "author": "s-rubenstein", "createdAt": "2020-04-24T14:09:24Z", "path": "e2e/app/page/data-page.ts", "diffHunk": "@@ -21,8 +24,11 @@ export default class DataPage extends AuthenticatedPage {\n \n   async isLoaded(): Promise<boolean> {\n     try {\n-      await this.waitUntilTitleMatch('Data Page');\n-      await this.page.waitForXPath(TAB_SELECTOR.showAllTab, {visible: true});\n+      await Promise.all([", "originalCommit": "c2ad4ce8b1182d735929ae5fd1ca775970274acd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}