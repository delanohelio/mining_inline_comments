{"pr_number": 4220, "pr_title": "[risk=low][RW-1977][RW-3313][RW-3314] Resource Card refactoring ", "pr_createdAt": "2020-10-28T20:54:41Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4220", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5Mzk1Mg==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513793952", "bodyText": "Extracted from ReferenceCard, with some updates", "author": "jmthibault79", "createdAt": "2020-10-28T22:14:46Z", "path": "ui/src/app/components/data-set-reference-modal.tsx", "diffHunk": "@@ -0,0 +1,75 @@\n+import * as fp from 'lodash/fp';", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NTU1Nw==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513795557", "bodyText": "moved up from below in the file, and made into a component.  I'll reuse this for RW-5562.", "author": "jmthibault79", "createdAt": "2020-10-28T22:18:41Z", "path": "ui/src/app/components/resource-card-template.tsx", "diffHunk": "@@ -54,28 +64,60 @@ const styles = reactStyles({\n   }\n });\n \n-export interface Action {\n+interface Action {\n   icon: string;\n   displayName: string;\n   onClick: () => void;\n   disabled: boolean;\n   hoverText?: string;\n }\n \n+const ResourceActionsMenu = (props: {actions: Action[]}) => {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NTg2MQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513795861", "bodyText": "common code from the individual resource-type cards", "author": "jmthibault79", "createdAt": "2020-10-28T22:19:24Z", "path": "ui/src/app/components/resource-card-template.tsx", "diffHunk": "@@ -54,28 +64,60 @@ const styles = reactStyles({\n   }\n });\n \n-export interface Action {\n+interface Action {\n   icon: string;\n   displayName: string;\n   onClick: () => void;\n   disabled: boolean;\n   hoverText?: string;\n }\n \n+const ResourceActionsMenu = (props: {actions: Action[]}) => {\n+  const {actions} = props;\n+  return <PopupTrigger\n+      data-test-id='resource-card-menu'\n+      side='bottom'\n+      closeOnClick\n+      content={\n+        <React.Fragment>\n+          {actions.map((action, i) => {\n+            return (\n+                <TooltipTrigger key={i} content={action.hoverText}>\n+                  <MenuItem\n+                      icon={action.icon}\n+                      onClick={() => action.onClick()}\n+                      disabled={action.disabled}>\n+                    {action.displayName}\n+                  </MenuItem>\n+                </TooltipTrigger>);\n+          })}\n+        </React.Fragment>\n+      }\n+  >\n+    <Clickable data-test-id='resource-menu'>\n+      <SnowmanIcon disabled={false}/>\n+    </Clickable>\n+  </PopupTrigger>;\n+};\n+\n+\n+function canWrite(resource: WorkspaceResource): boolean {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NjEwMQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513796101", "bodyText": "can simplify the interface b/c all of these are determinable from the resource", "author": "jmthibault79", "createdAt": "2020-10-28T22:19:58Z", "path": "ui/src/app/components/resource-card-template.tsx", "diffHunk": "@@ -54,28 +64,60 @@ const styles = reactStyles({\n   }\n });\n \n-export interface Action {\n+interface Action {\n   icon: string;\n   displayName: string;\n   onClick: () => void;\n   disabled: boolean;\n   hoverText?: string;\n }\n \n+const ResourceActionsMenu = (props: {actions: Action[]}) => {\n+  const {actions} = props;\n+  return <PopupTrigger\n+      data-test-id='resource-card-menu'\n+      side='bottom'\n+      closeOnClick\n+      content={\n+        <React.Fragment>\n+          {actions.map((action, i) => {\n+            return (\n+                <TooltipTrigger key={i} content={action.hoverText}>\n+                  <MenuItem\n+                      icon={action.icon}\n+                      onClick={() => action.onClick()}\n+                      disabled={action.disabled}>\n+                    {action.displayName}\n+                  </MenuItem>\n+                </TooltipTrigger>);\n+          })}\n+        </React.Fragment>\n+      }\n+  >\n+    <Clickable data-test-id='resource-menu'>\n+      <SnowmanIcon disabled={false}/>\n+    </Clickable>\n+  </PopupTrigger>;\n+};\n+\n+\n+function canWrite(resource: WorkspaceResource): boolean {\n+  return resource.permission === 'OWNER' || resource.permission === 'WRITER';\n+}\n+\n+function canDelete(resource: WorkspaceResource): boolean {\n+  return resource.permission === 'OWNER';\n+}\n+\n interface Props {\n   actions: Action[];\n   disabled: boolean;\n-  resourceUrl: string;", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NjI0OQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513796249", "bodyText": "TODO ASAP.  Not in this PR because I think that will confuse things.", "author": "jmthibault79", "createdAt": "2020-10-28T22:20:19Z", "path": "ui/src/app/components/resource-card-template.tsx", "diffHunk": "@@ -54,28 +64,60 @@ const styles = reactStyles({\n   }\n });\n \n-export interface Action {\n+interface Action {\n   icon: string;\n   displayName: string;\n   onClick: () => void;\n   disabled: boolean;\n   hoverText?: string;\n }\n \n+const ResourceActionsMenu = (props: {actions: Action[]}) => {\n+  const {actions} = props;\n+  return <PopupTrigger\n+      data-test-id='resource-card-menu'\n+      side='bottom'\n+      closeOnClick\n+      content={\n+        <React.Fragment>\n+          {actions.map((action, i) => {\n+            return (\n+                <TooltipTrigger key={i} content={action.hoverText}>\n+                  <MenuItem\n+                      icon={action.icon}\n+                      onClick={() => action.onClick()}\n+                      disabled={action.disabled}>\n+                    {action.displayName}\n+                  </MenuItem>\n+                </TooltipTrigger>);\n+          })}\n+        </React.Fragment>\n+      }\n+  >\n+    <Clickable data-test-id='resource-menu'>\n+      <SnowmanIcon disabled={false}/>\n+    </Clickable>\n+  </PopupTrigger>;\n+};\n+\n+\n+function canWrite(resource: WorkspaceResource): boolean {\n+  return resource.permission === 'OWNER' || resource.permission === 'WRITER';\n+}\n+\n+function canDelete(resource: WorkspaceResource): boolean {\n+  return resource.permission === 'OWNER';\n+}\n+\n interface Props {\n   actions: Action[];\n   disabled: boolean;\n-  resourceUrl: string;\n+  resource: WorkspaceResource;\n   onNavigate: () => void;\n-  displayName: string;\n-  description: string;\n-  displayDate: string;\n-  footerText: string;\n-  footerColor: string;\n }\n \n // This will be renamed to ResourceCard once the old code is removed", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NzIyOA==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513797228", "bodyText": "Replaced by ResourceActionsMenu and the resource types' get actions()", "author": "jmthibault79", "createdAt": "2020-10-28T22:22:33Z", "path": "ui/src/app/components/resources.tsx", "diffHunk": "@@ -1,71 +0,0 @@\n-import * as React from 'react';\n-\n-import {Clickable, MenuItem} from 'app/components/buttons';\n-import {SnowmanIcon} from 'app/components/icons';\n-import {PopupTrigger} from 'app/components/popups';\n-import {switchCase} from 'app/utils';\n-import {ResourceType} from 'generated/fetch';\n-\n-export interface ResourceCardMenuProps {\n-  resourceType: ResourceType;\n-  onRenameResource?: Function;\n-  onCopyConceptSet?: Function;\n-  canDelete: boolean;\n-  onDeleteResource?: Function;\n-  canEdit: boolean;\n-}\n-\n-export class ResourceCardMenu extends React.Component<ResourceCardMenuProps> {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NzQ1Mg==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513797452", "bodyText": "only used by Notebooks and tests, so moved it here", "author": "jmthibault79", "createdAt": "2020-10-28T22:23:14Z", "path": "ui/src/app/pages/analysis/notebook-list.tsx", "diffHunk": "@@ -26,6 +25,19 @@ const styles = {\n   }\n };\n \n+function convertToResource(inputResource: FileDetail, workspace: WorkspaceData): WorkspaceResource {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5OTM2OA==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513799368", "bodyText": "Lots of common code pushed down to the template.\nMany of the actions are very similar across resources, so there's probably an opportunity to reduce the code further.  I'm not planning to do that here.", "author": "jmthibault79", "createdAt": "2020-10-28T22:28:00Z", "path": "ui/src/app/pages/analysis/notebook-resource-card.tsx", "diffHunk": "@@ -42,32 +45,8 @@ export const NotebookResourceCard = fp.flow(\n     };\n   }\n \n-  get resourceType(): ResourceType {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5OTczNQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513799735", "bodyText": "https://precisionmedicineinitiative.atlassian.net/browse/RW-3313", "author": "jmthibault79", "createdAt": "2020-10-28T22:28:59Z", "path": "ui/src/app/pages/data/cohort-review/cohort-review-resource-card.tsx", "diffHunk": "@@ -0,0 +1,107 @@\n+import * as fp from 'lodash/fp';\n+import * as React from 'react';\n+\n+import {RenameModal} from 'app/components/rename-modal';\n+import {Action, canDelete, canWrite, ResourceCardTemplate} from 'app/components/resource-card-template';\n+import {withConfirmDeleteModal, WithConfirmDeleteModalProps} from 'app/components/with-confirm-delete-modal';\n+import {withErrorModal, WithErrorModalProps} from 'app/components/with-error-modal';\n+import {withSpinnerOverlay, WithSpinnerOverlayProps} from 'app/components/with-spinner-overlay';\n+import {cohortReviewApi} from 'app/services/swagger-fetch-clients';\n+import {getDescription, getDisplayName, getType} from 'app/utils/resources';\n+import {WorkspaceResource} from 'generated/fetch';\n+\n+interface Props extends WithConfirmDeleteModalProps, WithErrorModalProps, WithSpinnerOverlayProps {\n+  resource: WorkspaceResource;\n+  existingNameList: string[];\n+  onUpdate: Function;\n+}\n+\n+interface State {\n+  showRenameModal: boolean;\n+}\n+\n+export const CohortReviewResourceCard = fp.flow(", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgwMDEyMQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513800121", "bodyText": "Restores the functionality from https://precisionmedicineinitiative.atlassian.net/browse/RW-2945 which was accidentally removed in a previous refactor", "author": "jmthibault79", "createdAt": "2020-10-28T22:29:53Z", "path": "ui/src/app/pages/data/cohort/cohort-resource-card.tsx", "diffHunk": "@@ -20,6 +20,7 @@ interface Props extends WithConfirmDeleteModalProps, WithErrorModalProps, WithSp\n \n interface State {\n   showRenameModal: boolean;\n+  referencingDataSets: Array<DataSet>;", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgwMTUyMg==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513801522", "bodyText": "The logic in this extracted and renamed code was hard to follow.  I may try to simplify it.", "author": "jmthibault79", "createdAt": "2020-10-28T22:33:36Z", "path": "ui/src/app/pages/data/cohort/cohort-resource-card.tsx", "diffHunk": "@@ -31,89 +32,87 @@ export const CohortResourceCard = fp.flow(\n   constructor(props: Props) {\n     super(props);\n     this.state = {\n-      showRenameModal: false\n+      showRenameModal: false,\n+      referencingDataSets: [],\n     };\n   }\n \n-  get resourceType(): ResourceType {\n-    return ResourceType.COHORT;\n-  }\n-\n-  get displayName(): string {\n-    return this.props.resource.cohort.name;\n-  }\n-\n-  // this is duplicated\n-  get canWrite(): boolean {\n-    return this.props.resource.permission === 'OWNER'\n-      || this.props.resource.permission === 'WRITER';\n-  }\n-\n-  get canDelete(): boolean {\n-    return this.props.resource.permission === 'OWNER';\n-  }\n-\n-  get resourceUrl(): string {\n-    const {workspaceNamespace, workspaceFirecloudName, cohort} = this.props.resource;\n-    return `/workspaces/${workspaceNamespace}/${workspaceFirecloudName}` +\n-      `/data/cohorts/build?cohortId=${cohort.id}`;\n-  }\n-\n-  get reviewCohortUrl(): string {\n+  get reviewUrlForCohort(): string {\n     const {workspaceNamespace, workspaceFirecloudName, cohort} = this.props.resource;\n \n     return `/workspaces/${workspaceNamespace}/${workspaceFirecloudName}` +\n       `/data/cohorts/${cohort.id}/review`;\n   }\n \n   get actions(): Action[] {\n+    const {resource} = this.props;\n     return [\n       {\n         icon: 'note',\n         displayName: 'Rename',\n         onClick: () => {\n           this.setState({showRenameModal: true});\n         },\n-        disabled: !this.canWrite\n+        disabled: !canWrite(resource)\n       },\n       {\n         icon: 'copy',\n         displayName: 'Duplicate',\n         onClick: () => this.duplicate(),\n-        disabled: !this.canWrite\n+        disabled: !canWrite(resource)\n       },\n       {\n         icon: 'pencil',\n         displayName: 'Edit',\n-        onClick: () => navigateByUrl(this.resourceUrl),\n-        disabled: !this.canWrite\n+        onClick: () => navigateByUrl(getResourceUrl(resource)),\n+        disabled: !canWrite(resource)\n       },\n       {\n         icon: 'grid-view',\n         displayName: 'Review',\n-        onClick: () => navigateByUrl(this.reviewCohortUrl),\n-        disabled: !this.canWrite\n+        onClick: () => navigateByUrl(this.reviewUrlForCohort),\n+        disabled: !canWrite(resource)\n       },\n       {\n         icon: 'trash',\n         displayName: 'Delete',\n         onClick: () => {\n-          this.props.showConfirmDeleteModal(this.displayName,\n-            this.resourceType, () => this.delete());\n+          this.props.showConfirmDeleteModal(getDisplayName(resource),\n+            getType(resource), () => this.delete());\n         },\n-        disabled: !this.canDelete\n+        disabled: !canDelete(resource)\n       }\n     ];\n   }\n \n-  delete() {\n-    return cohortsApi().deleteCohort(\n-      this.props.resource.workspaceNamespace,\n-      this.props.resource.workspaceFirecloudName,\n-      this.props.resource.cohort.id)\n-      .then(() => {\n-        this.props.onUpdate();\n-      });\n+  async setOrClearDataSetList() {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgwMTgxMw==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513801813", "bodyText": "https://precisionmedicineinitiative.atlassian.net/browse/RW-3314", "author": "jmthibault79", "createdAt": "2020-10-28T22:34:20Z", "path": "ui/src/app/pages/data/concept/concept-set-resource-card.tsx", "diffHunk": "@@ -0,0 +1,166 @@\n+import * as fp from 'lodash/fp';\n+import * as React from 'react';\n+\n+import {CopyModal} from 'app/components/copy-modal';\n+import {DataSetReferenceModal} from 'app/components/data-set-reference-modal';\n+import {RenameModal} from 'app/components/rename-modal';\n+import {Action, canDelete, canWrite, ResourceCardTemplate} from 'app/components/resource-card-template';\n+import {withConfirmDeleteModal, WithConfirmDeleteModalProps} from 'app/components/with-confirm-delete-modal';\n+import {withErrorModal, WithErrorModalProps} from 'app/components/with-error-modal';\n+import {withSpinnerOverlay, WithSpinnerOverlayProps} from 'app/components/with-spinner-overlay';\n+import {conceptSetsApi, dataSetApi} from 'app/services/swagger-fetch-clients';\n+import {getDescription, getDisplayName, getId, getType} from 'app/utils/resources';\n+import {CopyRequest, DataSet, WorkspaceResource} from 'generated/fetch';\n+\n+interface Props extends WithConfirmDeleteModalProps, WithErrorModalProps, WithSpinnerOverlayProps {\n+  resource: WorkspaceResource;\n+  existingNameList: string[];\n+  onUpdate: Function;\n+}\n+\n+interface State {\n+  showRenameModal: boolean;\n+  copyingConceptSet: boolean;\n+  referencingDataSets: Array<DataSet>;\n+}\n+\n+export const ConceptSetResourceCard = fp.flow(", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgwMzE5OA==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513803198", "bodyText": "moved to resources.ts", "author": "jmthibault79", "createdAt": "2020-10-28T22:37:46Z", "path": "ui/src/app/utils/resourceActions.ts", "diffHunk": "@@ -1,79 +0,0 @@\n-import {\n-  Cohort,\n-  CohortReview,\n-  ConceptSet,\n-  DataSet,\n-  FileDetail,\n-  ResourceType,\n-  WorkspaceAccessLevel,\n-  WorkspaceResource\n-} from 'generated/fetch';\n-import {WorkspaceData} from './workspace-data';\n-\n-export function toDisplay(resourceType: ResourceType): string {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgwMzQyNw==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r513803427", "bodyText": "moved to testing/stubs/resources-stub", "author": "jmthibault79", "createdAt": "2020-10-28T22:38:24Z", "path": "ui/src/app/utils/resourceActions.ts", "diffHunk": "@@ -1,79 +0,0 @@\n-import {\n-  Cohort,\n-  CohortReview,\n-  ConceptSet,\n-  DataSet,\n-  FileDetail,\n-  ResourceType,\n-  WorkspaceAccessLevel,\n-  WorkspaceResource\n-} from 'generated/fetch';\n-import {WorkspaceData} from './workspace-data';\n-\n-export function toDisplay(resourceType: ResourceType): string {\n-  switch (resourceType) {\n-    case ResourceType.NOTEBOOK:\n-      return 'Notebook';\n-    case ResourceType.COHORT:\n-      return 'Cohort';\n-    case ResourceType.COHORTSEARCHGROUP:\n-      return 'Group';\n-    case ResourceType.COHORTSEARCHITEM:\n-      return 'Item';\n-    case ResourceType.COHORTREVIEW:\n-      return 'Cohort Review';\n-    case ResourceType.CONCEPTSET:\n-      return 'Concept Set';\n-    case ResourceType.DATASET:\n-      return 'Dataset';\n-    case ResourceType.WORKSPACE:\n-      return 'Workspace';\n-  }\n-}\n-\n-export interface ConvertToResourcesArgs {\n-  list:  FileDetail[] | Cohort[] | CohortReview[] | ConceptSet[] | DataSet[];\n-  resourceType: ResourceType;\n-  workspace: WorkspaceData;\n-}\n-\n-export function convertToResources(args: ConvertToResourcesArgs): WorkspaceResource[] {", "originalCommit": "d839733c292785952bafac3bde23e6c16d3ca239", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa99179fd8a6e1c039f7a9ad073434a05b80a433", "url": "https://github.com/all-of-us/workbench/commit/fa99179fd8a6e1c039f7a9ad073434a05b80a433", "message": "import from lodash/fp", "committedDate": "2020-10-29T15:18:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3MTQ0NA==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r514571444", "bodyText": "New styling components/layout.\nOld, from reference-card.tsx\n<div style={{paddingBottom: '1rem'}}>\t\n            The {toDisplay(this.resourceType)} <b>{fp.startCase(this.displayName)}&nbsp;</b>\t\n            is referenced by the following datasets:\t\n            <b>\t\n              &nbsp;\t\n              {fp.join(', ' ,\t\n                this.state.dataSetByResourceIdList.map((data) => data.name))}\t\n            </b>.\t\n            Deleting the {toDisplay(this.resourceType)}\t\n            <b>{fp.startCase(this.displayName)} </b> will make these datasets unavailable for use.\t\n            Are you sure you want to delete <b>{fp.startCase(this.displayName)}</b> ?\t\n</div>", "author": "jmthibault79", "createdAt": "2020-10-29T21:13:44Z", "path": "ui/src/app/components/data-set-reference-modal.tsx", "diffHunk": "@@ -0,0 +1,77 @@\n+import * as fp from 'lodash/fp';\n+import * as React from 'react';\n+\n+import {dataSetApi} from 'app/services/swagger-fetch-clients';\n+import {reactStyles} from 'app/utils';\n+import {getDisplayName, getId, getType, getTypeString} from 'app/utils/resources';\n+import {WorkspaceResource} from 'generated/fetch';\n+import {Button} from './buttons';\n+import {Modal, ModalBody, ModalTitle} from './modals';\n+\n+const styles = reactStyles({\n+  resource: {\n+    fontWeight: 'bold',\n+  },\n+  dataSets: {\n+    fontWeight: 'bold',\n+  }\n+});\n+\n+interface Props {\n+  referencedResource: WorkspaceResource;\n+  dataSets: string;\n+  onCancel: () => void;\n+  deleteResource: () => Promise<void>;\n+}\n+\n+class DataSetReferenceModal extends React.Component<Props, {}> {\n+\n+  constructor(props: Props) {\n+    super(props);\n+  }\n+\n+  async markAndDelete() {\n+    const {referencedResource, deleteResource} = this.props;\n+    try {\n+      await dataSetApi().markDirty(\n+        referencedResource.workspaceNamespace,\n+        referencedResource.workspaceFirecloudName, {\n+          id: getId(referencedResource),\n+          resourceType: getType(referencedResource)\n+        });\n+      await deleteResource();\n+    } catch (ex) {\n+      console.log(ex);\n+    }\n+  }\n+\n+  render() {\n+    const {referencedResource, dataSets, onCancel} = this.props;\n+\n+    const resourceName = fp.startCase(getDisplayName(referencedResource));", "originalCommit": "54a960ebd9b2a808832049a2ce1c16c01afe52f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA1MzE4Ng==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r515053186", "bodyText": "Notebook names in resource actions are now uniform - no extension", "author": "jmthibault79", "createdAt": "2020-10-30T12:09:53Z", "path": "e2e/tests/notebook/notebook-owner-actions.spec.ts", "diffHunk": "@@ -73,7 +73,7 @@ describe('Workspace owner Jupyter notebook action tests', () => {\n \n     const newName = makeRandomName('test-notebook');\n     const modalTextContents = await workspaceAnalysisPage.renameResource(notebookName, newName, ResourceCard.Notebook);\n-    expect(modalTextContents).toContain(`Enter new name for ${notebookName}.ipynb`);\n+    expect(modalTextContents).toContain(`Enter new name for ${notebookName}`);", "originalCommit": "69ea5ce3fb3eea14f3fe6781b262d4ae0d26f931", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b15d7882f5f2da6701c8f4d60781b904a3e9a9e8", "url": "https://github.com/all-of-us/workbench/commit/b15d7882f5f2da6701c8f4d60781b904a3e9a9e8", "message": "tests and lint", "committedDate": "2020-10-30T20:14:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjczMDcyMA==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516730720", "bodyText": "we could just call this dataSet since that's the resource type that should always be passed in here right?", "author": "ericsong", "createdAt": "2020-11-03T14:58:58Z", "path": "ui/src/app/components/data-set-reference-modal.tsx", "diffHunk": "@@ -0,0 +1,75 @@\n+import * as fp from 'lodash/fp';\n+import * as React from 'react';\n+\n+import {dataSetApi} from 'app/services/swagger-fetch-clients';\n+import {reactStyles} from 'app/utils';\n+import {getDisplayName, getId, getType, getTypeString} from 'app/utils/resources';\n+import {WorkspaceResource} from 'generated/fetch';\n+import {Button} from './buttons';\n+import {Modal, ModalBody, ModalTitle} from './modals';\n+\n+const styles = reactStyles({\n+  resource: {\n+    fontWeight: 'bold',\n+  },\n+  dataSets: {\n+    fontWeight: 'bold',\n+  }\n+});\n+\n+interface Props {\n+  referencedResource: WorkspaceResource;", "originalCommit": "2c20f8ad89e618ab6f52b0706dae1a784f8e45ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc3MjM1Ng==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516772356", "bodyText": "it's actually only Cohorts and Concept Sets, since these are what get referenced by Datasets.", "author": "jmthibault79", "createdAt": "2020-11-03T15:54:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjczMDcyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjczNTkzOQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516735939", "bodyText": "nit: I think \"render\" better captures what is happening here versus \"get\"", "author": "ericsong", "createdAt": "2020-11-03T15:06:10Z", "path": "ui/src/app/components/get-resource-card.tsx", "diffHunk": "@@ -0,0 +1,33 @@\n+import * as fp from 'lodash/fp';\n+import * as React from 'react';\n+\n+import {NotebookResourceCard} from 'app/pages/analysis/notebook-resource-card';\n+import {CohortReviewResourceCard} from 'app/pages/data/cohort-review/cohort-review-resource-card';\n+import {CohortResourceCard} from 'app/pages/data/cohort/cohort-resource-card';\n+import {ConceptSetResourceCard} from 'app/pages/data/concept/concept-set-resource-card';\n+import {DatasetResourceCard} from 'app/pages/data/data-set/dataset-resource-card';\n+import {isCohort, isCohortReview, isConceptSet, isDataSet, isNotebook} from 'app/utils/resources';\n+import {BillingStatus, WorkspaceResource} from 'generated/fetch';\n+\n+interface GetResourceCardProps {\n+  resource: WorkspaceResource;\n+  existingNameList: string[];\n+  onUpdate: () => Promise<void>;\n+}\n+\n+function getResourceCard(props: GetResourceCardProps) {", "originalCommit": "2c20f8ad89e618ab6f52b0706dae1a784f8e45ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc1MDM3MQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516750371", "bodyText": "can we also move get-resource-card in here? Since it seems like the place to place related functions.", "author": "ericsong", "createdAt": "2020-11-03T15:25:17Z", "path": "ui/src/app/utils/resources.tsx", "diffHunk": "@@ -0,0 +1,95 @@\n+import * as fp from 'lodash/fp';\n+\n+import {dropNotebookFileSuffix} from 'app/pages/analysis/util';\n+import {ResourceType, WorkspaceResource} from 'generated/fetch';\n+import {encodeURIComponentStrict} from './navigation';\n+\n+const isCohort = (resource: WorkspaceResource): boolean => !!resource.cohort;\n+const isCohortReview = (resource: WorkspaceResource): boolean => !!resource.cohortReview;\n+const isConceptSet = (resource: WorkspaceResource): boolean => !!resource.conceptSet;\n+const isDataSet = (resource: WorkspaceResource): boolean => !!resource.dataSet;\n+const isNotebook = (resource: WorkspaceResource): boolean => !!resource.notebook;\n+\n+function toDisplay(resourceType: ResourceType): string {\n+  return fp.cond([\n+      [rt => rt === ResourceType.COHORT, () => 'Cohort'],\n+      [rt => rt === ResourceType.COHORTREVIEW, () => 'Cohort Review'],\n+      [rt => rt === ResourceType.CONCEPTSET, () => 'Concept Set'],\n+      [rt => rt === ResourceType.DATASET, () => 'Dataset'],\n+      [rt => rt === ResourceType.NOTEBOOK, () => 'Notebook'],\n+\n+      [rt => rt === ResourceType.COHORTSEARCHGROUP, () => 'Group'],\n+      [rt => rt === ResourceType.COHORTSEARCHITEM, () => 'Item'],\n+      [rt => rt === ResourceType.WORKSPACE, () => 'Workspace'],\n+  ])(resourceType);\n+}\n+\n+const getTypeString = (resource: WorkspaceResource): string => toDisplay(getType(resource));\n+\n+function getDescription(resource: WorkspaceResource): string {\n+  return fp.cond([\n+      [isCohort, r => r.cohort.description],\n+      [isCohortReview, r => r.cohortReview.description],\n+      [isConceptSet, r => r.conceptSet.description],\n+      [isDataSet, r => r.dataSet.description],\n+      [isNotebook, fp.stubString /* notebooks don't have descriptions */]\n+  ])(resource);\n+}\n+\n+function getDisplayName(resource: WorkspaceResource): string {\n+  return fp.cond([\n+      [isCohort, r => r.cohort.name],\n+      [isCohortReview, r => r.cohortReview.cohortName],\n+      [isConceptSet, r => r.conceptSet.name],\n+      [isDataSet, r => r.dataSet.name],\n+      [isNotebook, r => dropNotebookFileSuffix(r.notebook.name)],\n+  ])(resource);\n+}\n+\n+function getId(resource: WorkspaceResource): number {\n+  // Notebooks do not have IDs\n+  return fp.cond([\n+      [isCohort, r => r.cohort.id],\n+      [isCohortReview, r => r.cohortReview.cohortReviewId],\n+      [isConceptSet, r => r.conceptSet.id],\n+      [isDataSet, r => r.dataSet.id],\n+  ])(resource);\n+}\n+\n+function getResourceUrl(resource: WorkspaceResource): string {\n+  const {workspaceNamespace, workspaceFirecloudName} = resource;\n+  const workspacePrefix = `/workspaces/${workspaceNamespace}/${workspaceFirecloudName}`;\n+\n+  return fp.cond([\n+      [isCohort, r => `${workspacePrefix}/data/cohorts/build?cohortId=${r.cohort.id}`],\n+      [isCohortReview, r => `${workspacePrefix}/data/cohorts/${r.cohortReview.cohortId}/review`],\n+      [isConceptSet, r => `${workspacePrefix}/data/concepts/sets/${r.conceptSet.id}`],\n+      [isDataSet, r => `${workspacePrefix}/data/data-sets/${r.dataSet.id}`],\n+      [isNotebook, r => `${workspacePrefix}/notebooks/preview/${encodeURIComponentStrict(r.notebook.name)}`],\n+  ])(resource);\n+}\n+\n+function getType(resource: WorkspaceResource): ResourceType {\n+  return fp.cond([\n+      [isCohort, () => ResourceType.COHORT],\n+      [isCohortReview, () => ResourceType.COHORTREVIEW],\n+      [isConceptSet, () => ResourceType.CONCEPTSET],\n+      [isDataSet, () => ResourceType.DATASET],\n+      [isNotebook, () => ResourceType.NOTEBOOK],\n+  ])(resource);\n+}\n+\n+export {", "originalCommit": "2c20f8ad89e618ab6f52b0706dae1a784f8e45ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc3OTc1OA==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516779758", "bodyText": "That's what I had originally, but it makes a circular reference so I had to split it out.", "author": "jmthibault79", "createdAt": "2020-11-03T16:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc1MDM3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc1OTE4MQ==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516759181", "bodyText": "Can this be combined with the real implementation above? It looks like this function is a superset of the functionality that's in the notebook file.", "author": "ericsong", "createdAt": "2020-11-03T15:36:28Z", "path": "ui/src/testing/stubs/resources-stub.ts", "diffHunk": "@@ -0,0 +1,53 @@\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {\n+    BillingStatus,\n+    Cohort,\n+    CohortReview,\n+    ConceptSet,\n+    DataSet,\n+    FileDetail,\n+    ResourceType,\n+    WorkspaceAccessLevel,\n+    WorkspaceResource,\n+} from 'generated/fetch';\n+import {CdrVersionsStubVariables} from 'testing/stubs/cdr-versions-api-stub';\n+import {WorkspaceStubVariables} from 'testing/stubs/workspace-service-stub';\n+\n+type InputResource = FileDetail | Cohort | CohortReview | ConceptSet | DataSet;\n+\n+export function convertToResource(", "originalCommit": "2c20f8ad89e618ab6f52b0706dae1a784f8e45ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwOTg0Mw==", "url": "https://github.com/all-of-us/workbench/pull/4220#discussion_r516809843", "bodyText": "yes - the original reason for separating these is no longer valid", "author": "jmthibault79", "createdAt": "2020-11-03T16:46:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc1OTE4MQ=="}], "type": "inlineReview"}, {"oid": "674054ea7ded34efc79deeed31f28f9b5315984f", "url": "https://github.com/all-of-us/workbench/commit/674054ea7ded34efc79deeed31f28f9b5315984f", "message": "move convertToResource() to resources.tsx", "committedDate": "2020-11-03T16:37:16Z", "type": "forcePushed"}, {"oid": "41b07693378a94842ec101b189c4b0086c849784", "url": "https://github.com/all-of-us/workbench/commit/41b07693378a94842ec101b189c4b0086c849784", "message": "Extract from ResourceCard: DataSetReferenceModal, ConceptSetResourceCard, CohortReviewResourceCard\n- getResourceCard\n- resources.ts", "committedDate": "2020-11-03T20:29:23Z", "type": "commit"}, {"oid": "8cde991beb50c9cfa52b8b772f877257f1a8b4cd", "url": "https://github.com/all-of-us/workbench/commit/8cde991beb50c9cfa52b8b772f877257f1a8b4cd", "message": "fixes, cleanup, and maybeDelete()", "committedDate": "2020-11-03T20:29:23Z", "type": "commit"}, {"oid": "b993d2e268aa8f62bf3e99a681da1978423d1778", "url": "https://github.com/all-of-us/workbench/commit/b993d2e268aa8f62bf3e99a681da1978423d1778", "message": "renaming: markAndDelete + showCopyModal\n\nlint\n\nFunction -> () => Promise<void>\n\nimport from lodash/fp\n\nbetter notebook name matching\n\nBug!  Choose cohort review correctly\n\nreturn the deletion promise\n\nrv accidental chg", "committedDate": "2020-11-03T20:29:24Z", "type": "commit"}, {"oid": "6e4b250ff2de037fdf60bec52d359a625409c865", "url": "https://github.com/all-of-us/workbench/commit/6e4b250ff2de037fdf60bec52d359a625409c865", "message": "tests and lint", "committedDate": "2020-11-03T20:29:24Z", "type": "commit"}, {"oid": "7a51d35bcf41c79c705eb6a0a842b23a3286d107", "url": "https://github.com/all-of-us/workbench/commit/7a51d35bcf41c79c705eb6a0a842b23a3286d107", "message": "getResourceCard -> renderResourceCard", "committedDate": "2020-11-03T20:29:30Z", "type": "commit"}, {"oid": "81f20802e20781df83ca4b9fffc34637e2ba1c59", "url": "https://github.com/all-of-us/workbench/commit/81f20802e20781df83ca4b9fffc34637e2ba1c59", "message": "move convertToResource() to resources.tsx", "committedDate": "2020-11-03T20:29:31Z", "type": "commit"}, {"oid": "81f20802e20781df83ca4b9fffc34637e2ba1c59", "url": "https://github.com/all-of-us/workbench/commit/81f20802e20781df83ca4b9fffc34637e2ba1c59", "message": "move convertToResource() to resources.tsx", "committedDate": "2020-11-03T20:29:31Z", "type": "forcePushed"}, {"oid": "b894480c6acfe91bdb461d19b8a1c630258e0f01", "url": "https://github.com/all-of-us/workbench/commit/b894480c6acfe91bdb461d19b8a1c630258e0f01", "message": "lint", "committedDate": "2020-11-03T20:33:21Z", "type": "commit"}]}