{"pr_number": 4086, "pr_title": "[RW-5665][risk=no] Puppeteer snowman menu change", "pr_createdAt": "2020-09-30T00:55:37Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4086", "timeline": [{"oid": "0fd1bab8f4d39c1d3e1811bac703ac070cb9f520", "url": "https://github.com/all-of-us/workbench/commit/0fd1bab8f4d39c1d3e1811bac703ac070cb9f520", "message": "ellipsis menu refactor", "committedDate": "2020-09-30T13:23:53Z", "type": "commit"}, {"oid": "0fd1bab8f4d39c1d3e1811bac703ac070cb9f520", "url": "https://github.com/all-of-us/workbench/commit/0fd1bab8f4d39c1d3e1811bac703ac070cb9f520", "message": "ellipsis menu refactor", "committedDate": "2020-09-30T13:23:53Z", "type": "forcePushed"}, {"oid": "0bd3f3846eebdaf8ec32721ea301afdaa83372ca", "url": "https://github.com/all-of-us/workbench/commit/0bd3f3846eebdaf8ec32721ea301afdaa83372ca", "message": "comments update", "committedDate": "2020-09-30T13:33:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1NzcyMQ==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497557721", "bodyText": "How come this string is duplicated everywhere instead of living in snowman-menu.ts?", "author": "als364", "createdAt": "2020-09-30T14:31:18Z", "path": "e2e/app/component/card-base.ts", "diffHunk": "@@ -1,26 +1,36 @@\n import {ElementHandle, Page} from 'puppeteer';\n-import {EllipsisMenuAction} from 'app/text-labels';\n-import EllipsisMenu from './ellipsis-menu';\n+import {Option} from 'app/text-labels';\n+import Container from 'app/container';\n+import SnowmanMenu from './snowman-menu';\n \n \n-export default abstract class CardBase {\n+export default abstract class CardBase extends Container {\n \n-  ellipsisXpath = './/clr-icon[@shape=\"ellipsis-vertical\"]';\n+  private snowmanIconXpath = './/clr-icon[@shape=\"ellipsis-vertical\"]';", "originalCommit": "0bd3f3846eebdaf8ec32721ea301afdaa83372ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYzMjcxNA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497632714", "bodyText": "Finding icon and clicking icon to trigger snowman menu to open is not in snowman-menu class because icons' xpath selectors are no same on all pages.", "author": "aweng98", "createdAt": "2020-09-30T16:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1NzcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1NzgzMQ==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497657831", "bodyText": "Right, but for the most part, the .//clr-icon[@shape=\"ellipsis-vertical\"] is used in all the xpath selectors to get the snowman icon. That text doesn't need to be duplicated everywhere.", "author": "als364", "createdAt": "2020-09-30T16:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1NzcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1OTc0NA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497759744", "bodyText": "Where is a good place to put it as common str? Not so many places, I found only two files have the string.", "author": "aweng98", "createdAt": "2020-09-30T19:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1NzcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc2MDk3Mg==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497760972", "bodyText": "I'd put it in snowman-menu.ts, export the const, then access that from card-base.ts and cohort-participants-group.ts", "author": "als364", "createdAt": "2020-09-30T19:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1NzcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc2MzQzNQ==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497763435", "bodyText": "yes, good call. Done!", "author": "aweng98", "createdAt": "2020-09-30T19:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1NzcyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTQ4Nw==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497561487", "bodyText": "how come you're accessing this this way instead of the usual way of looking for the ellipsis icon?", "author": "als364", "createdAt": "2020-09-30T14:36:10Z", "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -222,20 +222,22 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n   }\n \n   /**\n-   * Select Workspace action dropdown menu option.\n-   * @param {EllipsisMenuAction} menuOption\n+   * Select Workspace action snowman menu option.\n+   * @param {Option} option\n    * @param opts\n    */\n-  async selectWorkspaceAction(menuOption: EllipsisMenuAction, opts?: { waitForNav: false }): Promise<void> {\n-    const ellipsisMenu = new EllipsisMenu(this.page, './/*[@data-test-id=\"workspace-menu-button\"]');\n-    return ellipsisMenu.clickAction(menuOption, opts);\n+  async selectWorkspaceAction(option: Option, opts?: { waitForNav: false }): Promise<void> {\n+    const iconXpath = './/*[@data-test-id=\"workspace-menu-button\"]';", "originalCommit": "0bd3f3846eebdaf8ec32721ea301afdaa83372ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYzNjMzMA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497636330", "bodyText": "Icon is not standard ellipsis icon. xpath selector is different from standard three-dots.", "author": "aweng98", "createdAt": "2020-09-30T16:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTQ4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1NzM5MA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497657390", "bodyText": "Argh, of course it's a fontawesome icon here and a clarity icon everywhere else", "author": "als364", "createdAt": "2020-09-30T16:49:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTQ4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY2MDA3Mw==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497660073", "bodyText": "An RW ticket should be created to change this icon into a clarity icon (or all Snowman icons into fontawesome icons); would you like to do that or would you like me to do that?", "author": "als364", "createdAt": "2020-09-30T16:53:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTQ4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1NzAzNA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497757034", "bodyText": "Filed new ticket RW-5682", "author": "aweng98", "createdAt": "2020-09-30T19:42:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTQ4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc2MTAxOQ==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497761019", "bodyText": "thank you!", "author": "als364", "createdAt": "2020-09-30T19:50:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTQ4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTk5Nw==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497561997", "bodyText": "This doesn't seem related to the ellipsis -> snowman renaming.", "author": "als364", "createdAt": "2020-09-30T14:36:51Z", "path": "e2e/tests/conceptsets/conceptset-edit.spec.ts", "diffHunk": "@@ -19,13 +19,13 @@ describe('Editing and Copying Concept Sets', () => {\n \n   /**\n    * Test:\n-   * - Create new workspace.\n+   * - Find an existing workspace.\n    * - Create first new Concept Set in Procedure domain.\n    * - Create second new Concept Set in Procedure domain. Add to first Concept Set.\n    */\n   test('Add to existing Concept Set in same workspace', async () => {\n     // Create a workspace\n-    const workspaceName = await findWorkspace(page, {create: true}).then(card => card.clickWorkspaceName());\n+    const workspaceName = await findWorkspace(page).then(card => card.clickWorkspaceName());", "originalCommit": "0bd3f3846eebdaf8ec32721ea301afdaa83372ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYzNzM0Nw==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497637347", "bodyText": "you're right. I can revert the change. I thought this test doesn't need a new workspace to run.", "author": "aweng98", "createdAt": "2020-09-30T16:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTk5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1ODAxNA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497658014", "bodyText": "Yes, please split this into a separate PR", "author": "als364", "createdAt": "2020-09-30T16:50:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTk5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MDQwMw==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497750403", "bodyText": "Done.", "author": "aweng98", "createdAt": "2020-09-30T19:30:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MTk5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2Nzg0MQ==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497567841", "bodyText": "Why are you disabling this instead of making the code conform with this rule?", "author": "als364", "createdAt": "2020-09-30T14:44:07Z", "path": "e2e/tslint.json", "diffHunk": "@@ -46,6 +46,9 @@\n     \"no-consecutive-blank-lines\": [\n       true,\n       2\n+    ],\n+    \"triple-equals\": [", "originalCommit": "0bd3f3846eebdaf8ec32721ea301afdaa83372ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY0MDE3NA==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497640174", "bodyText": "Because tslint fails without this option for this code \n  \n    \n      workbench/e2e/tests/notebook/notebook-download.spec.ts\n    \n    \n         Line 18\n      in\n      959d281\n    \n    \n    \n    \n\n        \n          \n           return wantDisabled == await getPropValue<boolean>(downloadBtn, 'disabled'); \n        \n    \n  \n\n\nFrom CH: the == is intentional, treat null as false.", "author": "aweng98", "createdAt": "2020-09-30T16:22:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2Nzg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1OTM3MQ==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497659371", "bodyText": "Right, but why not do a null check instead? It's worth it to not loosen the enforcement around triple equals. Double equals really does do some strange and unintuitive things in Javascript and even if it's useful here it's harmful elsewhere.", "author": "als364", "createdAt": "2020-09-30T16:52:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2Nzg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MzUwNw==", "url": "https://github.com/all-of-us/workbench/pull/4086#discussion_r497753507", "bodyText": "Okay. But on a second thought, I rather leave file unchanged in this PR. Change reverted.", "author": "aweng98", "createdAt": "2020-09-30T19:36:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2Nzg0MQ=="}], "type": "inlineReview"}, {"oid": "c2c0bd82d0726afa95c1a3abaebbc792d71424fc", "url": "https://github.com/all-of-us/workbench/commit/c2c0bd82d0726afa95c1a3abaebbc792d71424fc", "message": "PR feedback", "committedDate": "2020-09-30T19:49:26Z", "type": "commit"}, {"oid": "ff7c21c0d653c8ad7a507bc76d2e600e206bd1b0", "url": "https://github.com/all-of-us/workbench/commit/ff7c21c0d653c8ad7a507bc76d2e600e206bd1b0", "message": "PR feedback", "committedDate": "2020-09-30T19:53:59Z", "type": "commit"}, {"oid": "d5e2ba60b8b416a728c9ef0ccfdf85c368e57fdc", "url": "https://github.com/all-of-us/workbench/commit/d5e2ba60b8b416a728c9ef0ccfdf85c368e57fdc", "message": "fixed error", "committedDate": "2020-09-30T20:08:19Z", "type": "commit"}, {"oid": "46f2e3735627ca8803213b17c07e7f71f937a075", "url": "https://github.com/all-of-us/workbench/commit/46f2e3735627ca8803213b17c07e7f71f937a075", "message": "missing semi", "committedDate": "2020-09-30T20:33:44Z", "type": "commit"}]}