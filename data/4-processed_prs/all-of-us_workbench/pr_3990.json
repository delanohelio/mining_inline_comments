{"pr_number": 3990, "pr_title": "[RW-5434][risk=no] Update Puppeteer test for new Cohort Builder UI", "pr_createdAt": "2020-09-11T04:16:15Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3990", "timeline": [{"oid": "ca606422e0b54c3c0c8890108aaba921229f23b2", "url": "https://github.com/all-of-us/workbench/commit/ca606422e0b54c3c0c8890108aaba921229f23b2", "message": "RW-5434 update variable names", "committedDate": "2020-09-10T17:43:18Z", "type": "commit"}, {"oid": "76adf727c34c035d1346d5e1014b7209f2e3445e", "url": "https://github.com/all-of-us/workbench/commit/76adf727c34c035d1346d5e1014b7209f2e3445e", "message": "RW-5434 add help sidebar class", "committedDate": "2020-09-10T17:43:18Z", "type": "commit"}, {"oid": "ee84486fa3c5a9790e26dcc9df86211a7601f653", "url": "https://github.com/all-of-us/workbench/commit/ee84486fa3c5a9790e26dcc9df86211a7601f653", "message": "RW-5434 update cohorts-create test for new UI", "committedDate": "2020-09-10T17:47:50Z", "type": "commit"}, {"oid": "0281d69b5864ea4ceb9e2400d43bebf4541f50bd", "url": "https://github.com/all-of-us/workbench/commit/0281d69b5864ea4ceb9e2400d43bebf4541f50bd", "message": "RW-5434 update export-to-notebook test", "committedDate": "2020-09-10T17:48:47Z", "type": "commit"}, {"oid": "405fa2adf7b65444f146ab054cde1eccc343c359", "url": "https://github.com/all-of-us/workbench/commit/405fa2adf7b65444f146ab054cde1eccc343c359", "message": "RW-5434 update dataset-create test", "committedDate": "2020-09-10T17:48:47Z", "type": "commit"}, {"oid": "308bedc11e00532e19aa6901d7143a56caba0b83", "url": "https://github.com/all-of-us/workbench/commit/308bedc11e00532e19aa6901d7143a56caba0b83", "message": "RW-5434 update cohorts-review test", "committedDate": "2020-09-10T17:50:31Z", "type": "commit"}, {"oid": "d3d53ebda0c82de39733c51fe1c35a03fbf4ffc8", "url": "https://github.com/all-of-us/workbench/commit/d3d53ebda0c82de39733c51fe1c35a03fbf4ffc8", "message": "RW-5434 update tests for latest CB changes", "committedDate": "2020-09-11T04:07:15Z", "type": "commit"}, {"oid": "021b454bd0ba29623128a0e83cb5dda171ba2884", "url": "https://github.com/all-of-us/workbench/commit/021b454bd0ba29623128a0e83cb5dda171ba2884", "message": "RW-5434 lint error", "committedDate": "2020-09-11T05:41:06Z", "type": "commit"}, {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce", "url": "https://github.com/all-of-us/workbench/commit/bd193d9068ba5a924b667668c7ddb70c197f94ce", "message": "RW-5434 changes from feedback", "committedDate": "2020-09-14T14:26:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4NTgxNA==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487985814", "bodyText": "nit: remove await", "author": "aweng98", "createdAt": "2020-09-14T14:40:47Z", "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -124,22 +120,32 @@ export default class CohortCriteriaModal extends Modal {\n    * Click FINISH button.\n    */\n   async clickFinishButton(): Promise<void> {\n-    return this.clickButton(LinkText.Finish, {waitForClose: true});\n+    return Button.findByName(this.page, {normalizeSpace: LinkText.FinishAndReview}).then(button => button.click());\n+  }\n+\n+  async viewAndSaveCriteria(): Promise<void> {\n+    const finishAndReviewButton = await Button.findByName(this.page, {name: LinkText.FinishAndReview});\n+    await finishAndReviewButton.waitUntilEnabled();\n+    await finishAndReviewButton.click();\n+\n+    // Click Save Criteria button in sidebar\n+    const helpSidebar = await new HelpSidebar(this.page);", "originalCommit": "bd193d9068ba5a924b667668c7ddb70c197f94ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAzMjgwNw==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r488032807", "bodyText": "Done.", "author": "dolbeew", "createdAt": "2020-09-14T15:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4NTgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4OTQ0OQ==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487989449", "bodyText": "nit: remove await in class constructor call.", "author": "aweng98", "createdAt": "2020-09-14T14:45:31Z", "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -94,28 +108,10 @@ export default class CohortCriteriaModal extends Modal {\n     const link = await this.waitForPhysicalMeasurementCriteriaLink(criteriaName);\n     await link.click();\n \n-    const selectMenu = await SelectMenu.findByName(this.page, {ancestorLevel: 2}, this);\n-    await selectMenu.clickMenuItem(filterSign);\n-\n-    const numberField = await this.page.waitForXPath(`${this.xpath}//input[@type=\"number\"]`, {visible: true});\n-    await numberField.type(String(filterValue));\n-\n-    await this.clickButton(LinkText.Calculate);\n-    const participantResult = await this.waitForParticipantResult();\n+    const helpSidebar = await new HelpSidebar(this.page);", "originalCommit": "bd193d9068ba5a924b667668c7ddb70c197f94ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAzMjM0OA==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r488032348", "bodyText": "Done.", "author": "dolbeew", "createdAt": "2020-09-14T15:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4OTQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5MTI4MQ==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487991281", "bodyText": "nit: remove ../.. before utils", "author": "aweng98", "createdAt": "2020-09-14T14:48:01Z", "path": "e2e/app/component/help-sidebar.ts", "diffHunk": "@@ -0,0 +1,107 @@\n+import {ElementHandle, Page} from 'puppeteer';\n+\n+import SelectMenu from 'app/component/select-menu';\n+import Container from 'app/container';\n+import Button from 'app/element/button';\n+import {FilterSign} from 'app/page/cohort-search-page';\n+import {LinkText} from 'app/text-labels';\n+import {buildXPath} from 'app/xpath-builders';\n+import {ElementType} from 'app/xpath-options';\n+import {waitForNumericalString} from 'utils/waits-utils';\n+import {waitWhileLoading} from '../../utils/test-utils';", "originalCommit": "bd193d9068ba5a924b667668c7ddb70c197f94ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyODQ0MA==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r488028440", "bodyText": "Done", "author": "dolbeew", "createdAt": "2020-09-14T15:33:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5MTI4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5MjE4OA==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487992188", "bodyText": "old comment. no more modal window, right?", "author": "aweng98", "createdAt": "2020-09-14T14:49:12Z", "path": "e2e/app/component/help-sidebar.ts", "diffHunk": "@@ -0,0 +1,107 @@\n+import {ElementHandle, Page} from 'puppeteer';\n+\n+import SelectMenu from 'app/component/select-menu';\n+import Container from 'app/container';\n+import Button from 'app/element/button';\n+import {FilterSign} from 'app/page/cohort-search-page';\n+import {LinkText} from 'app/text-labels';\n+import {buildXPath} from 'app/xpath-builders';\n+import {ElementType} from 'app/xpath-options';\n+import {waitForNumericalString} from 'utils/waits-utils';\n+import {waitWhileLoading} from '../../utils/test-utils';\n+\n+const defaultXpath = '//*[@id=\"help-sidebar\"]';\n+enum SectionSelectors {\n+  AttributesForm = '//*[@id=\"attributes-form\"]',\n+  ModifiersForm = '//*[@id=\"modifiers-form\"]',\n+  SelectionList = '//*[@id=\"selection-list\"]',\n+}\n+\n+export default class HelpSidebar extends Container {\n+\n+  constructor(page: Page, xpath: string = defaultXpath) {\n+    super(page, xpath);\n+  }\n+\n+  async getPhysicalMeasurementParticipantResult(filterSign: FilterSign, filterValue: number): Promise<string> {\n+    await this.waitUntilSectionVisible(SectionSelectors.AttributesForm);\n+\n+    const selectMenu = await SelectMenu.findByName(this.page, {ancestorLevel: 2}, this);\n+    await selectMenu.clickMenuItem(filterSign);\n+\n+    const numberField = await this.page.waitForXPath(`${this.xpath}//input[@type=\"number\"]`, {visible: true});\n+    await numberField.type(String(filterValue));\n+\n+    await this.clickSidebarButton(LinkText.Calculate);\n+    const participantResult = await this.waitForParticipantResult();\n+\n+    // Find criteria in Selected Criteria Content Box.\n+    const removeSelectedCriteriaIconSelector = buildXPath({type: ElementType.Icon, iconShape: 'times-circle'}, this);\n+    // Before add criteria, first check for nothing in Selected Criteria Content Box.\n+    await this.page.waitForXPath(removeSelectedCriteriaIconSelector,{hidden: true});\n+\n+    await this.clickSidebarButton(LinkText.AddThis);\n+    // After add criteria, should flip to selection list section\n+    await this.waitUntilSectionVisible(SectionSelectors.SelectionList);\n+    // Look for X (remove) icon for indication that add succeeded.\n+    await this.page.waitForXPath(removeSelectedCriteriaIconSelector,{visible: true});\n+\n+    // dialog close after click FINISH button.", "originalCommit": "bd193d9068ba5a924b667668c7ddb70c197f94ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyOTQ1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r488029456", "bodyText": "Nice catch. Fixed.", "author": "dolbeew", "createdAt": "2020-09-14T15:35:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5MjE4OA=="}], "type": "inlineReview"}, {"oid": "200d34e4b4d78e0e098c6e969b214454d6d85362", "url": "https://github.com/all-of-us/workbench/commit/200d34e4b4d78e0e098c6e969b214454d6d85362", "message": "RW-5434 pr comments, add delay", "committedDate": "2020-09-14T15:42:33Z", "type": "commit"}]}