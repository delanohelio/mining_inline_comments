{"pr_number": 4432, "pr_title": "[risk=no] Fix a UI bug: could not edit WS name in the middle of the field", "pr_createdAt": "2020-12-23T22:34:53Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4432", "timeline": [{"oid": "ef27a412d0f85a2b0e3dbe3acbf41c259817c54e", "url": "https://github.com/all-of-us/workbench/commit/ef27a412d0f85a2b0e3dbe3acbf41c259817c54e", "message": "Fix a UI bug: could not edit WS name in the middle of the field", "committedDate": "2020-12-23T22:32:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQwNDg2OQ==", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551404869", "bodyText": "not 100% sure why this change works, but it seems to.  Please LMK if I have misunderstood something here.", "author": "jmthibault79", "createdAt": "2021-01-04T15:59:42Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -1026,7 +1027,7 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n                                 required={!this.isMode(WorkspaceEditMode.Duplicate)}>\n           <FlexRow style={{alignItems: 'baseline'}}>\n             <TextInput type='text' style={styles.textInput} autoFocus placeholder='Workspace Name'\n-              value = {name}\n+              defaultValue = {name}", "originalCommit": "ef27a412d0f85a2b0e3dbe3acbf41c259817c54e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4", "url": "https://github.com/all-of-us/workbench/commit/bc28800a7b8999a73ef35c0562c01bfb5aee4bf4", "message": "workspace prop is empty in create mode - don't destructure it", "committedDate": "2021-01-04T16:09:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQxMjkxOQ==", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551412919", "bodyText": "Now always shows \"Edit workspace oldname\" instead of the continuously changing \"Edit workspace newname\"", "author": "jmthibault79", "createdAt": "2021-01-04T16:11:55Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -614,15 +614,16 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n     }\n \n     renderHeader() {\n-      switch (this.props.routeConfigData.mode) {\n+      // use workspace name from props instead of state here\n+      // because it's a record of the initial value\n+      const {routeConfigData: {mode}, workspace} = this.props;\n+      switch (mode) {\n         case WorkspaceEditMode.Create:\n           return 'Create a new workspace';\n         case WorkspaceEditMode.Edit:\n-          return 'Edit workspace \\\"' + this.state.workspace.name + '\\\"';\n+          return 'Edit workspace \\\"' + workspace.name + '\\\"';", "originalCommit": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU5NDA2MQ==", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551594061", "bodyText": "This can, and probably should remain value - I don't think defaultValue is effecting the behavior. The fix is actually occurring in the renderHeader function where the name is no longer being updated as the user types.\nWhat was happening before was each time the text changed, the header would change causing the children to unmount and remount rather than just re-render. This is because of this line in workspace-edit-section.tsx. The WorkspaceEditSection uses the header prop as the key. Each time the header changes, the key changes causing an unmount/remount.\nThis seems rather unexpected and difficult to trace through the code - I created a techdebt issue to take a closer look to see whether the key is needed", "author": "petesantos", "createdAt": "2021-01-04T21:58:39Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -1026,7 +1027,7 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n                                 required={!this.isMode(WorkspaceEditMode.Duplicate)}>\n           <FlexRow style={{alignItems: 'baseline'}}>\n             <TextInput type='text' style={styles.textInput} autoFocus placeholder='Workspace Name'\n-              value = {name}\n+              defaultValue = {name}", "originalCommit": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY1MDQwOQ==", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551650409", "bodyText": "Thanks!  This makes sense but I would not have guessed it works this way.  It does continue to work with value.", "author": "jmthibault79", "createdAt": "2021-01-05T00:35:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU5NDA2MQ=="}], "type": "inlineReview"}, {"oid": "78c73a5cb3ba1504f8ec5ac5758793ab753efaf0", "url": "https://github.com/all-of-us/workbench/commit/78c73a5cb3ba1504f8ec5ac5758793ab753efaf0", "message": "rv defaultValue chg", "committedDate": "2021-01-05T00:33:52Z", "type": "commit"}]}