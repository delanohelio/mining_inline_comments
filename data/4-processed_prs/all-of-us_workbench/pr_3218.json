{"pr_number": 3218, "pr_title": "[RW-2722][risk=no] Convert CB search group component to React", "pr_createdAt": "2020-03-05T15:33:28Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3218", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4MDM2OA==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388380368", "bodyText": "With this name this variable sounds like it's a boolean. Would it be more accurate to call it something like updateGroupListsCount?", "author": "als364", "createdAt": "2020-03-05T15:46:41Z", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.ts", "diffHunk": "@@ -25,12 +25,13 @@ export class CohortSearchComponent implements OnInit, OnDestroy {\n   error = false;\n   overview = false;\n   criteria = {includes: [], excludes: []};\n-  updateCriteria = {update: 0, recalculate: true};\n+  updateCount = 0;\n   cohort: any;\n   resolve: Function;\n   modalPromise: Promise<boolean> | null = null;\n   modalOpen = false;\n   saving = false;\n+  updateGroupLists = 0;", "originalCommit": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyNDQ4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388924487", "bodyText": "Agreed, adding count on the end makes more sense.", "author": "dolbeew", "createdAt": "2020-03-06T14:13:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4MDM2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5OTIyNw==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388399227", "bodyText": "annoying that codegen strips the underscores out of this. SHOUTY_SNAKE_CASE much easier to read than regular SHOUTYCASE.", "author": "als364", "createdAt": "2020-03-05T16:12:59Z", "path": "ui/src/app/cohort-search/overview/overview.component.tsx", "diffHunk": "@@ -200,17 +203,15 @@ export const ListOverview = withCurrentWorkspace()(\n \n     get hasTemporalError() {\n       const {searchRequest} = this.props;\n-      const activeGroups = searchRequest.includes\n-        .filter(grp => grp.temporal && grp.status === 'active');\n+      const activeGroups = searchRequest.includes.filter(grp => grp.temporal && grp.status === 'active');\n       return activeGroups.some(grp => {\n         const activeItems = grp.items.reduce((acc, it) => {\n           if (it.status === 'active') {\n             acc[it.temporalGroup]++;\n           }\n           return acc;\n         }, [0, 0]);\n-        const inputError = grp.time !== TemporalTime.DURINGSAMEENCOUNTERAS &&\n-          (grp.timeValue === null || grp.timeValue < 0);\n+        const inputError = grp.time !== TemporalTime.DURINGSAMEENCOUNTERAS && (isNaN(parseInt(grp.timeValue, 10)) || grp.timeValue < 0);", "originalCommit": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyOTc3Nw==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388929777", "bodyText": "Yes, definitely agree on this", "author": "dolbeew", "createdAt": "2020-03-06T14:23:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5OTIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwOTM3MQ==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388409371", "bodyText": "any makes it hard to tell what's actually in there - are the contents of item so varied that a nested definition couldn't be done here? like\nitem: {\n    count:  number\n    modifiers: whatever modifiers is\n}", "author": "als364", "createdAt": "2020-03-05T16:28:27Z", "path": "ui/src/app/cohort-search/search-group-item/search-group-item.component.tsx", "diffHunk": "@@ -122,22 +121,20 @@ class SearchGroupItemParameter extends React.Component<{parameter: any}, {toolti\n }\n \n interface Props {\n-  role: keyof SearchRequest;\n   groupId: string;\n   item: any;", "originalCommit": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk0MDM5Nw==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388940397", "bodyText": "There is a swagger generated interface for this, but I originally used any because I needed a couple extra properties. Fixed by creating a new interface ItemProp that extends Item", "author": "dolbeew", "createdAt": "2020-03-06T14:41:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwOTM3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3OTU2NA==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388479564", "bodyText": "I wish this wasn't necessary. I guess you can't set it directly on a <React.Fragment> because it's not in the DOM, and you can't set it on the parent for some reason?", "author": "als364", "createdAt": "2020-03-05T18:27:38Z", "path": "ui/src/app/cohort-search/search-group/search-group.component.tsx", "diffHunk": "@@ -0,0 +1,606 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {SearchGroupItem} from 'app/cohort-search/search-group-item/search-group-item.component';\n+import {criteriaMenuOptionsStore, searchRequestStore, wizardStore} from 'app/cohort-search/search-state.service';\n+import {domainToTitle, generateId, mapGroup, typeToTitle} from 'app/cohort-search/utils';\n+import {Clickable} from 'app/components/buttons';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {isAbortError} from 'app/utils/errors';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {DomainType, SearchRequest, TemporalMention, TemporalTime} from 'generated/fetch';\n+import {InputSwitch} from 'primereact/inputswitch';\n+import {Menu} from 'primereact/menu';\n+import {TieredMenu} from 'primereact/tieredmenu';\n+\n+const styles = reactStyles({\n+  card: {\n+    background: colors.white,\n+    borderColor: 'rgba(215, 215, 215, 0.5)',\n+    borderRadius: '0.2rem',\n+    boxShadow: `0 0.125rem 0.125rem 0 ${colorWithWhiteness(colors.black, 0.85)}`,\n+    margin: '0 0 0.6rem'\n+  },\n+  cardBlock: {\n+    borderBottom: `1px solid ${colors.light}`,\n+    padding: '0.5rem 0.75rem'\n+  },\n+  cardHeader: {\n+    backgroundColor: colorWithWhiteness(colors.light, -0.3),\n+    color: colors.primary,\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    minWidth: '100%',\n+    padding: '0.5rem 0.75rem'\n+  },\n+  overlay: {\n+    background: colors.white,\n+    display: 'table',\n+    opacity: 0.9,\n+    position: 'relative',\n+    textAlign: 'center',\n+    verticalAlign: 'middle',\n+  },\n+  overlayInner: {\n+    color: colors.warning,\n+    display: 'table-cell',\n+    fontSize: '18px',\n+    verticalAlign: 'middle',\n+  },\n+  overlayButton: {\n+    background: 'transparent',\n+    border: 0,\n+    color: colors.accent,\n+    cursor: 'pointer',\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    letterSpacing: 0,\n+    margin: '0.25rem 0',\n+  },\n+  itemOr: {\n+    background: colors.white,\n+    color: colorWithWhiteness(colors.black, 0.75),\n+    float: 'right',\n+    marginRight: '46%',\n+    padding: '0 10px'\n+  },\n+  menu: {\n+    maxWidth: '15rem',\n+    minWidth: '5rem',\n+    width: 'auto'\n+  },\n+  searchItem: {\n+    borderBottom: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    margin: '0 0.5rem',\n+    padding: '0.5rem 0.25rem'\n+  },\n+  menuButton: {\n+    border: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    borderRadius: '0.125rem',\n+    color: colorWithWhiteness(colors.black, 0.45),\n+    fontSize: '12px',\n+    fontWeight: 100,\n+    height: '1.5rem',\n+    letterSpacing: '1px',\n+    lineHeight: '1.5rem',\n+    padding: '0 0.5rem',\n+    textTransform: 'uppercase',\n+    verticalAlign: 'middle'\n+  },\n+  row: {\n+    display: 'flex',\n+    flexWrap: 'wrap',\n+    marginLeft: '-0.5rem',\n+    marginRight: '-0.5rem',\n+  },\n+  col6: {\n+    flex: '0 0 50%',\n+    maxWidth: '50%',\n+    padding: '0 0.5rem',\n+  },\n+  timeInput: {\n+    border: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    borderRadius: '0.1rem',\n+    height: '1.4rem',\n+    marginLeft: '1rem',\n+    width: '2.5rem'\n+  },\n+  inputError: {\n+    background: colorWithWhiteness(colors.danger, 0.85),\n+    border: `1px solid ${colorWithWhiteness(colors.danger, 0.6)}`,\n+    borderRadius: '3px',\n+    color: colorWithWhiteness(colors.dark, .1),\n+    fontSize: '11px',\n+    lineHeight: '16px',\n+    marginBottom: '0.25rem',\n+    padding: '5px 3px'\n+  }\n+});\n+\n+const css = `", "originalCommit": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk1MTI0Mw==", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388951243", "bodyText": "These are custom styles we need to put on elements that we can't access directly since they're generated by PrimeReact components, Menu and InputSwitch in this case. I don't like it either, but It's the only way I know of to do it.", "author": "dolbeew", "createdAt": "2020-03-06T14:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3OTU2NA=="}], "type": "inlineReview"}, {"oid": "7b4dd76a8641b1b10cb283637d1d772acb57dc9c", "url": "https://github.com/all-of-us/workbench/commit/7b4dd76a8641b1b10cb283637d1d772acb57dc9c", "message": "RW-2722 address pr feedback", "committedDate": "2020-03-09T14:51:49Z", "type": "forcePushed"}, {"oid": "956d1d626d5c4f829a6542e5efe5af940861ba18", "url": "https://github.com/all-of-us/workbench/commit/956d1d626d5c4f829a6542e5efe5af940861ba18", "message": "RW-2722 fix temporal input width", "committedDate": "2020-03-10T13:34:13Z", "type": "forcePushed"}, {"oid": "26b0c69be8f261674337c91bc3b2f2f2683ecd5d", "url": "https://github.com/all-of-us/workbench/commit/26b0c69be8f261674337c91bc3b2f2f2683ecd5d", "message": "RW-2722 initial react conversion", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "ad3e71517de36c30302a4bc6b458de3ec3045993", "url": "https://github.com/all-of-us/workbench/commit/ad3e71517de36c30302a4bc6b458de3ec3045993", "message": "RW-2722 complete react conversion", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "c9b241bf128869876c1043936a740e2c1f787a41", "url": "https://github.com/all-of-us/workbench/commit/c9b241bf128869876c1043936a740e2c1f787a41", "message": "RW-2722 code cleanup", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "c24d10384d7d36a11b6cb3b78fc7737fef5a8047", "url": "https://github.com/all-of-us/workbench/commit/c24d10384d7d36a11b6cb3b78fc7737fef5a8047", "message": "RW-2722 fix dropdown menu options and styles", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "7c15292ab50f5b81eaeb771bb64bee686fcb85c8", "url": "https://github.com/all-of-us/workbench/commit/7c15292ab50f5b81eaeb771bb64bee686fcb85c8", "message": "RW-2722 remove unneeded class names", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "1e33666c336f5de9d45075cce2284f3f214735cc", "url": "https://github.com/all-of-us/workbench/commit/1e33666c336f5de9d45075cce2284f3f214735cc", "message": "RW-2722 remove angular files and references", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "b66a80927837eb14f2eb7fbd7bca66ea4abd4e3e", "url": "https://github.com/all-of-us/workbench/commit/b66a80927837eb14f2eb7fbd7bca66ea4abd4e3e", "message": "RW-2722 add ui tests for search-group", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "0146eefe0b2ff7b6b21291fbc6e0d7356a4e1172", "url": "https://github.com/all-of-us/workbench/commit/0146eefe0b2ff7b6b21291fbc6e0d7356a4e1172", "message": "RW-2272 code cleanup", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "2c2f071a07b844f38a48a80aaeb3c35c98d0e890", "url": "https://github.com/all-of-us/workbench/commit/2c2f071a07b844f38a48a80aaeb3c35c98d0e890", "message": "RW-2272 fix temporal issues", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "64c07e6185427e53894bd8783f253440535de964", "url": "https://github.com/all-of-us/workbench/commit/64c07e6185427e53894bd8783f253440535de964", "message": "RW-2272 fix rendering of temporal item groups", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "03218ee1fe4b2cb5e1d5bed81d3eff771d3317b6", "url": "https://github.com/all-of-us/workbench/commit/03218ee1fe4b2cb5e1d5bed81d3eff771d3317b6", "message": "RW-2272 fix search item props updates", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "cb3607d2b632771b4cb6bcb7587b37258cce4b52", "url": "https://github.com/all-of-us/workbench/commit/cb3607d2b632771b4cb6bcb7587b37258cce4b52", "message": "RW-2272 fix group and total count updates", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "ec0a10d5fad695d065a3ccf7503e7525f60c2572", "url": "https://github.com/all-of-us/workbench/commit/ec0a10d5fad695d065a3ccf7503e7525f60c2572", "message": "RW-2722 fix lint error and failing test", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "dd789f4af8f8191bdaf70e6ef5529cda6b3c6062", "url": "https://github.com/all-of-us/workbench/commit/dd789f4af8f8191bdaf70e6ef5529cda6b3c6062", "message": "RW-2722 fix total count with multiple groups", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "0929138e8f062f138c58c1c0922a9e1723014d46", "url": "https://github.com/all-of-us/workbench/commit/0929138e8f062f138c58c1c0922a9e1723014d46", "message": "RW-2722 add error tooltip", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "92e470d21e736be7b6fdfc5c5865edb13915a4b2", "url": "https://github.com/all-of-us/workbench/commit/92e470d21e736be7b6fdfc5c5865edb13915a4b2", "message": "RW-2722 remove unused state properties", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "2aa3d346ac3ed3cdf2c2220d97b90b9e38280767", "url": "https://github.com/all-of-us/workbench/commit/2aa3d346ac3ed3cdf2c2220d97b90b9e38280767", "message": "RW-2722 address pr feedback", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "b3d3e1f225a671b5f4b9d021187bf0b74dd3b7d4", "url": "https://github.com/all-of-us/workbench/commit/b3d3e1f225a671b5f4b9d021187bf0b74dd3b7d4", "message": "RW-2722 fix temporal input width", "committedDate": "2020-03-13T16:47:44Z", "type": "commit"}, {"oid": "b3d3e1f225a671b5f4b9d021187bf0b74dd3b7d4", "url": "https://github.com/all-of-us/workbench/commit/b3d3e1f225a671b5f4b9d021187bf0b74dd3b7d4", "message": "RW-2722 fix temporal input width", "committedDate": "2020-03-13T16:47:44Z", "type": "forcePushed"}]}