{"pr_number": 3288, "pr_title": "[RW-4634][]risk=no]Add custom Chrome startUp flags", "pr_createdAt": "2020-03-23T16:18:21Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3288", "timeline": [{"oid": "fa4a8d89003f48bad23c3b639cce637a51a9c976", "url": "https://github.com/all-of-us/workbench/commit/fa4a8d89003f48bad23c3b639cce637a51a9c976", "message": "Add custom Chrome startUp flags", "committedDate": "2020-03-23T16:14:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3ODgwOA==", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396578808", "bodyText": "--runInBand is same as -maxWorkers=1: Ensure tests are run in serial order in one thread in CircleCi.", "author": "aweng98", "createdAt": "2020-03-23T16:21:11Z", "path": "e2e/package.json", "diffHunk": "@@ -7,9 +7,9 @@\n   \"license\": \"BSD\",\n   \"scripts\": {\n     \"test\": \"WORKBENCH_ENV=dev jest --detectOpenHandles\",\n-    \"test:debug\": \"WORKBENCH_ENV=dev PUPPETEER_HEADLESS=false jest --detectOpenHandles --runInBand\",\n+    \"test:debug\": \"WORKBENCH_ENV=dev PUPPETEER_HEADLESS=false jest --detectOpenHandles --maxWorkers=2\",\n     \"test-local\": \"WORKBENCH_ENV=local jest\",\n-    \"test:ci\": \"cross-env NODE_ENV=development WORKBENCH_ENV=dev INCOGNITO=true jest --ci --maxWorkers=2 --forceExit\",\n+    \"test:ci\": \"cross-env NODE_ENV=development WORKBENCH_ENV=dev INCOGNITO=true jest --ci --runInBand --forceExit\",", "originalCommit": "fa4a8d89003f48bad23c3b639cce637a51a9c976", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3OTkwMQ==", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396579901", "bodyText": "Puppeteer click() is not working sometimes for this button. Changing to call to Document.click() function.", "author": "aweng98", "createdAt": "2020-03-23T16:22:38Z", "path": "e2e/tests/user/registration.spec.ts", "diffHunk": "@@ -61,7 +61,7 @@ describe('User registration tests:', () => {\n     await createAccountPage.fillOutInstitution();\n     nextButton = await createAccountPage.getNextButton();\n     await nextButton.waitUntilEnabled();\n-    await nextButton.click();\n+    await nextButton.clickWithEval();", "originalCommit": "fa4a8d89003f48bad23c3b639cce637a51a9c976", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "941c8c746195f655c85fdb0adde27b301dd49605", "url": "https://github.com/all-of-us/workbench/commit/941c8c746195f655c85fdb0adde27b301dd49605", "message": "adding cross-env", "committedDate": "2020-03-23T18:02:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3OTc2Mw==", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396679763", "bodyText": "I don't see code that's handling this argument, ignoreDefaultArgs. How is it able to continue working if the type was changed form a string array to a boolean?", "author": "ericsong", "createdAt": "2020-03-23T18:47:53Z", "path": "e2e/driver/puppeteer-launch.ts", "diffHunk": "@@ -1,22 +1,15 @@\n import * as puppeteer from 'puppeteer';\n+import {getChromeFlags} from './chrome-startup-flags';\n+\n+const isHeadless = !process.env.PUPPETEER_HEADLESS;\n \n const defaultLaunchOpts = {\n-  headless: !process.env.PUPPETEER_HEADLESS,\n+  headless: isHeadless,\n   slowMo: 10,\n   defaultViewport: null,\n   devtools: false,\n-  ignoreDefaultArgs: ['--disable-extensions'],\n-  args: [\n-    '--no-sandbox',\n-    '--disable-setuid-sandbox',\n-    '--disable-dev-shm-usage',\n-    '--disable-gpu',\n-    '--disable-background-timer-throttling',\n-    '--disable-backgrounding-occluded-windows',\n-    '--disable-renderer-backgrounding',\n-    '--disable-web-security',\n-    '--disable-features=IsolateOrigins,site-per-process',\n-  ]\n+  ignoreDefaultArgs: true,", "originalCommit": "941c8c746195f655c85fdb0adde27b301dd49605", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MjU4MQ==", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396682581", "bodyText": "Because ignoreDefaultArgs takes param either is boolean or Array<string>.\nignoreDefaultArgs <boolean|Array<string>> If true, then do not use puppeteer.defaultArgs(). If an array is given, then filter out the given default arguments. Dangerous option; use with care. Defaults to false.", "author": "aweng98", "createdAt": "2020-03-23T18:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3OTc2Mw=="}], "type": "inlineReview"}]}