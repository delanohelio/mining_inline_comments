{"pr_number": 4376, "pr_title": "[no ticket][risk=no] Puppeteer Combining two CDR modal tests", "pr_createdAt": "2020-12-08T20:09:08Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4376", "timeline": [{"oid": "8fb261151786c6dd00e4a3239cfaebf49a996c6f", "url": "https://github.com/all-of-us/workbench/commit/8fb261151786c6dd00e4a3239cfaebf49a996c6f", "message": "combine two tests", "committedDate": "2020-12-08T20:07:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3NTk2Mw==", "url": "https://github.com/all-of-us/workbench/pull/4376#discussion_r539275963", "bodyText": "This is a different Cancel button from the button above, so I'd prefer a different variable name.  Then both of these can be const.", "author": "jmthibault79", "createdAt": "2020-12-09T12:44:31Z", "path": "e2e/tests/workspace/cdr-version-upgrade.spec.ts", "diffHunk": "@@ -1,69 +1,62 @@\n import WorkspaceCard from 'app/component/workspace-card';\n+import {Page} from 'puppeteer';\n import {createWorkspace, signIn} from 'utils/test-utils';\n import {config} from 'resources/workbench-config';\n import WorkspaceDataPage from 'app/page/workspace-data-page';\n import WorkspaceBase from 'app/page/workspace-base';\n-import WorkspacesPage from 'app/page/workspaces-page';\n import WorkspaceEditPage from 'app/page/workspace-edit-page';\n-import Navigation, {NavLink} from 'app/component/navigation';\n import CdrVersionUpgradeModal from 'app/page/cdr-version-upgrade-modal';\n \n-describe('Workspace CDR Version upgrade', () => {\n+describe('Workspace CDR Version Upgrade modal', () => {\n     beforeEach(async () => {\n         await signIn(page);\n     });\n \n-   test('Clicking the CDR version upgrade flag pops up the upgrade modal', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        await workspaceCard.clickWorkspaceName();\n+   test('Clicking Cancel and Upgrade buttons', async () => {\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n-        expect(await workspacePage.getCdrVersion()).toBe(config.altCdrVersionName);\n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n+      const workspaceName = await workspaceCard.clickWorkspaceName();\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      const cdrVersion = await workspacePage.getCdrVersion();\n+      expect(cdrVersion).toBe(config.altCdrVersionName);\n \n-        // hit cancel\n-        const cancelButton = await modal.getCancelButton();\n-        await cancelButton.click();\n+      let modal = await launchCdrUpgradeModal(page);\n \n-        // new version flag remains\n-        await workspacePage.getNewCdrVersionFlag();\n+      // Clicking the Cancel\n+      let cancelButton = await modal.getCancelButton();\n+      await cancelButton.click();\n \n-        // cleanup\n-        await workspacePage.deleteWorkspace()\n-    });\n-\n-    test('Clicking the CDR version upgrade button opens the Duplicate Workspace Page', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        const workspaceName = await workspaceCard.clickWorkspaceName();\n+      // CDR version flag remains\n+      await workspacePage.getNewCdrVersionFlag();\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      // Clicking the Upgrade button opens the Duplicate Workspace Page\n+      modal = await launchCdrUpgradeModal(page);\n+      const upgradeButton = await modal.getUpgradeButton();\n+      await upgradeButton.click();\n \n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const duplicationPage = new WorkspaceEditPage(page);\n+      const upgradeMessage = await duplicationPage.getCdrVersionUpgradeMessage();\n+      expect(upgradeMessage).toContain(workspaceName);\n+      expect(upgradeMessage).toContain(`${config.altCdrVersionName} to ${config.defaultCdrVersionName}.`);\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      cancelButton = await duplicationPage.getCancelButton();", "originalCommit": "8fb261151786c6dd00e4a3239cfaebf49a996c6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM4NTIzMw==", "url": "https://github.com/all-of-us/workbench/pull/4376#discussion_r539385233", "bodyText": "Done. Thanks.", "author": "aweng98", "createdAt": "2020-12-09T15:08:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3NTk2Mw=="}], "type": "inlineReview"}, {"oid": "460749aa8f1c37dfd8fe1dac3eb52d7214475984", "url": "https://github.com/all-of-us/workbench/commit/460749aa8f1c37dfd8fe1dac3eb52d7214475984", "message": "address PR feedback", "committedDate": "2020-12-09T15:07:19Z", "type": "commit"}]}