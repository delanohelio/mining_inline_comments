{"pr_number": 4157, "pr_title": "[risk=no] Notebook environment checks should fail when the variables are not found", "pr_createdAt": "2020-10-14T02:20:45Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4157", "timeline": [{"oid": "3d676ee7d3f246dea274d6c615861422087d1fdd", "url": "https://github.com/all-of-us/workbench/commit/3d676ee7d3f246dea274d6c615861422087d1fdd", "message": "Python check: actually fail if env vars are missing", "committedDate": "2020-10-14T00:34:08Z", "type": "commit"}, {"oid": "00398abac1460ebbccd0e906ff8e1b597b1f991f", "url": "https://github.com/all-of-us/workbench/commit/00398abac1460ebbccd0e906ff8e1b597b1f991f", "message": "refactor runCodeCell() to include the markdown workaround", "committedDate": "2020-10-14T02:05:38Z", "type": "commit"}, {"oid": "9f244c988480367014dec4388c3171dcac5a1e4c", "url": "https://github.com/all-of-us/workbench/commit/9f244c988480367014dec4388c3171dcac5a1e4c", "message": "Actually fail the R test when env vars are missing", "committedDate": "2020-10-14T02:05:56Z", "type": "commit"}, {"oid": "ab4602d99eec1b2e393a63f7a6782864d2eac3b7", "url": "https://github.com/all-of-us/workbench/commit/ab4602d99eec1b2e393a63f7a6782864d2eac3b7", "message": "not needed", "committedDate": "2020-10-14T02:22:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwNzc5MA==", "url": "https://github.com/all-of-us/workbench/pull/4157#discussion_r504707790", "bodyText": "moved from the r-spec test", "author": "jmthibault79", "createdAt": "2020-10-14T14:08:13Z", "path": "e2e/app/page/notebook-page.ts", "diffHunk": "@@ -168,23 +168,42 @@ export default class NotebookPage extends AuthenticatedPage {\n    * Click Run button in toolbar. Run focused code cell and insert a new code cell below.\n    *\n    * @param {number} cellIndex Code Cell index. (first index is 1). Use -1 to find last cell.\n-   * @param {string} code The code to run.\n-   * @param {string} codeFile The full path to file that contains code to run.\n-   * @param {number} timeOut The timeout time in milliseconds.\n-   * @returns {string} Run output.\n+   * @param opts\n+   *  {string} code The code to run.\n+   *  {string} codeFile The full path to a file that contains the code to run.\n+   *  {number} timeOut The timeout time in milliseconds (default 120 sec).\n+   *  {boolean} markdownWorkaround Convert to Markdown before typing (default false)\n    */\n-  async runCodeCell(cellIndex: number, opts: { code?: string, codeFile?: string, timeOut?: number } = {}): Promise<string> {\n+  async runCodeCell(\n+      cellIndex: number,\n+      opts: { code?: string, codeFile?: string, timeOut?: number, markdownWorkaround?: boolean } = {}): Promise<string> {\n     const cell = cellIndex === -1 ? await this.findLastCell() : await this.findCell(cellIndex);\n-    const cellInput = await cell.focus();\n-    if (opts.code !== undefined) {\n-      await cellInput.type(opts.code);\n-    } else if (opts.codeFile !== undefined) {\n-      const code = fs.readFileSync(opts.codeFile, 'utf8');\n-      await cellInput.type(code);\n+    const inputCell = await cell.focus();\n+\n+    const {code, codeFile, timeOut = 120000, markdownWorkaround = false} = opts;\n+\n+    let codeToRun;\n+    if (code !== undefined) {\n+      codeToRun = code;\n+    } else if (codeFile !== undefined) {\n+      codeToRun = fs.readFileSync(codeFile, 'ascii');\n     }\n-    await cellInput.dispose();\n+\n+    // autoCloseBrackets is true by default for R code cells.\n+    // Puppeteer types in every character of code, resulting in extra brackets.\n+    // Workaround: Type code in Markdown cell, then change to Code cell to run.\n+    if (markdownWorkaround) {", "originalCommit": "ab4602d99eec1b2e393a63f7a6782864d2eac3b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}