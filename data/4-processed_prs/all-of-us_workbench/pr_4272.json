{"pr_number": 4272, "pr_title": "[RW-5766][RW-5851][risk=no] Rework runtime ops store / usage", "pr_createdAt": "2020-11-11T02:05:54Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4272", "timeline": [{"oid": "9e409cb0f1bb25844b8dca097b60a43fd3cb30c0", "url": "https://github.com/all-of-us/workbench/commit/9e409cb0f1bb25844b8dca097b60a43fd3cb30c0", "message": "partway to a pendingRuntime impl", "committedDate": "2020-11-11T02:38:40Z", "type": "commit"}, {"oid": "80c3e94b970e1b80f9c6cb99c1ef4170f0df2371", "url": "https://github.com/all-of-us/workbench/commit/80c3e94b970e1b80f9c6cb99c1ef4170f0df2371", "message": "partway to a pendingRuntime impl", "committedDate": "2020-11-11T02:38:41Z", "type": "commit"}, {"oid": "c9969b6397ec3810d66897bb5a69918362f4165d", "url": "https://github.com/all-of-us/workbench/commit/c9969b6397ec3810d66897bb5a69918362f4165d", "message": "partway to a pendingRuntime impl", "committedDate": "2020-11-11T02:38:42Z", "type": "commit"}, {"oid": "e7965bd6681bb74d469fc0ebdfef1bc8421db85c", "url": "https://github.com/all-of-us/workbench/commit/e7965bd6681bb74d469fc0ebdfef1bc8421db85c", "message": "Mostly there", "committedDate": "2020-11-11T02:38:42Z", "type": "commit"}, {"oid": "a408da0c0766e0520314afa926da9f6154929fa8", "url": "https://github.com/all-of-us/workbench/commit/a408da0c0766e0520314afa926da9f6154929fa8", "message": "working", "committedDate": "2020-11-11T02:38:42Z", "type": "commit"}, {"oid": "73b269d691d2a60a04a1a2a968e6b78682975208", "url": "https://github.com/all-of-us/workbench/commit/73b269d691d2a60a04a1a2a968e6b78682975208", "message": "Revert \"[RW-5851][risk=no] Temporary hack to fix unit test flakiness (#4246)\"\n\nThis reverts commit 862ee0bfb86c128de98ee15c66f24c3d88ac3c89.", "committedDate": "2020-11-11T02:38:43Z", "type": "commit"}, {"oid": "5351f47e59967fe8c2962e71b3f3dc30ec069b5f", "url": "https://github.com/all-of-us/workbench/commit/5351f47e59967fe8c2962e71b3f3dc30ec069b5f", "message": "Test refactorings", "committedDate": "2020-11-11T02:38:43Z", "type": "commit"}, {"oid": "abb128cd1c30e9b23dcab7593462f0d26bc5eda4", "url": "https://github.com/all-of-us/workbench/commit/abb128cd1c30e9b23dcab7593462f0d26bc5eda4", "message": "lint", "committedDate": "2020-11-11T02:38:44Z", "type": "commit"}, {"oid": "1719b18090faa5340e0744fa2519f0bd55ae422a", "url": "https://github.com/all-of-us/workbench/commit/1719b18090faa5340e0744fa2519f0bd55ae422a", "message": "ng test fix", "committedDate": "2020-11-11T02:38:45Z", "type": "commit"}, {"oid": "0997759d023e10fd71d935fb034002121bbef801", "url": "https://github.com/all-of-us/workbench/commit/0997759d023e10fd71d935fb034002121bbef801", "message": "comment fixes", "committedDate": "2020-11-11T02:38:45Z", "type": "commit"}, {"oid": "0997759d023e10fd71d935fb034002121bbef801", "url": "https://github.com/all-of-us/workbench/commit/0997759d023e10fd71d935fb034002121bbef801", "message": "comment fixes", "committedDate": "2020-11-11T02:38:45Z", "type": "forcePushed"}, {"oid": "9d91e61acefb2d82412c1d978124780f39e8ea25", "url": "https://github.com/all-of-us/workbench/commit/9d91e61acefb2d82412c1d978124780f39e8ea25", "message": "revert ng test", "committedDate": "2020-11-11T02:39:40Z", "type": "commit"}, {"oid": "287e859d180c0097e8d0d74a6eb74e3dce4bcad9", "url": "https://github.com/all-of-us/workbench/commit/287e859d180c0097e8d0d74a6eb74e3dce4bcad9", "message": "Test coverage for help sidebar...", "committedDate": "2020-11-11T20:32:20Z", "type": "commit"}, {"oid": "882ffb074a2a0ea9a8a46c8a1954a1a95c94b891", "url": "https://github.com/all-of-us/workbench/commit/882ffb074a2a0ea9a8a46c8a1954a1a95c94b891", "message": "Drop loggers, fix redirect, unindent", "committedDate": "2020-11-12T00:05:31Z", "type": "commit"}, {"oid": "30a644df340a7313e48720747c2876439520e3d4", "url": "https://github.com/all-of-us/workbench/commit/30a644df340a7313e48720747c2876439520e3d4", "message": "Fixes", "committedDate": "2020-11-12T01:10:00Z", "type": "commit"}, {"oid": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64", "url": "https://github.com/all-of-us/workbench/commit/8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64", "message": "handle 404s properly in useRuntime", "committedDate": "2020-11-12T06:25:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzODAwNA==", "url": "https://github.com/all-of-us/workbench/pull/4272#discussion_r522238004", "bodyText": "are you intending on implementing this in this PR? if not, is there an outstanding ticket to represent this work?", "author": "als364", "createdAt": "2020-11-12T16:25:21Z", "path": "ui/src/app/utils/leo-runtime-initializer.tsx", "diffHunk": "@@ -196,76 +186,44 @@ export class LeoRuntimeInitializer {\n     this.targetRuntime = options.targetRuntime;\n   }\n \n-  private async getRuntime(): Promise<Runtime> {\n-    const aborter = new AbortController();\n-    const promise = runtimeApi().getRuntime(this.workspaceNamespace, {signal: aborter.signal});\n-    updateRuntimeOpsStoreForWorkspaceNamespace(this.workspaceNamespace, {\n-      promise: promise,\n-      operation: 'get',\n-      aborter: aborter\n-    });\n-    markRuntimeOperationCompleteForWorkspace(this.workspaceNamespace);\n-    return promise;\n-  }\n-\n   private async createRuntime(): Promise<void> {\n     if (this.createCount >= this.maxCreateCount) {\n       throw new ExceededActionCountError(\n         `Reached max runtime create count (${this.maxCreateCount})`, this.currentRuntime);\n     }\n-    const aborter = new AbortController();\n     let runtime: Runtime;\n     if (serverConfigStore.getValue().enableCustomRuntimes && this.targetRuntime) {\n       runtime = this.targetRuntime;\n     } else {\n+      // In lazy initialization mode, this should default to:", "originalCommit": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0NTYxMQ==", "url": "https://github.com/all-of-us/workbench/pull/4272#discussion_r522345611", "bodyText": "Thanks, forgot to file this. Done and updated comment: https://precisionmedicineinitiative.atlassian.net/browse/RW-5921", "author": "calbach", "createdAt": "2020-11-12T19:03:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzODAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4MjI1MA==", "url": "https://github.com/all-of-us/workbench/pull/4272#discussion_r522282250", "bodyText": "This is in runtime-utils and runtime-panels too - could it be pulled out into a test utils file?", "author": "als364", "createdAt": "2020-11-12T17:24:52Z", "path": "ui/src/app/pages/analysis/notebook-redirect.spec.tsx", "diffHunk": "@@ -28,8 +30,17 @@ describe('NotebookRedirect', () => {\n \n   let runtimeStub: RuntimeApiStub;\n \n-  const mountedComponent = () => {\n-    return mount(<NotebookRedirect/>);\n+  const handleUseEffect = async (component) => {", "originalCommit": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0NDk3Mg==", "url": "https://github.com/all-of-us/workbench/pull/4272#discussion_r522344972", "bodyText": "done", "author": "calbach", "createdAt": "2020-11-12T19:03:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4MjI1MA=="}], "type": "inlineReview"}, {"oid": "2242e327d2bf02fd0ab15ed593cdaaa578d336a7", "url": "https://github.com/all-of-us/workbench/commit/2242e327d2bf02fd0ab15ed593cdaaa578d336a7", "message": "PR feedback", "committedDate": "2020-11-12T18:59:46Z", "type": "commit"}, {"oid": "e7f86084f8198333663da80ca5d5efa2415dbeb8", "url": "https://github.com/all-of-us/workbench/commit/e7f86084f8198333663da80ca5d5efa2415dbeb8", "message": "Missed one handleUseEffect", "committedDate": "2020-11-12T19:01:06Z", "type": "commit"}]}