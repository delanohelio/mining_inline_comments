{"pr_number": 3632, "pr_title": "[risk=no][RW=5014]Initial react router implementation", "pr_createdAt": "2020-06-01T19:37:43Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3632", "timeline": [{"oid": "56d4e4f034558724102a723f626876baa838017e", "url": "https://github.com/all-of-us/workbench/commit/56d4e4f034558724102a723f626876baa838017e", "message": "working example", "committedDate": "2020-04-28T20:26:59Z", "type": "commit"}, {"oid": "b028bb02df1dce7ff0f43c3f752d396c2321d698", "url": "https://github.com/all-of-us/workbench/commit/b028bb02df1dce7ff0f43c3f752d396c2321d698", "message": "Clean up router abstraction", "committedDate": "2020-04-29T17:29:23Z", "type": "commit"}, {"oid": "cd512a54d40fb7654f8797c9a0effe669abceecb", "url": "https://github.com/all-of-us/workbench/commit/cd512a54d40fb7654f8797c9a0effe669abceecb", "message": "Update example and router", "committedDate": "2020-05-06T16:06:54Z", "type": "commit"}, {"oid": "d43ff437167069767d72cf32bb2780edd308277e", "url": "https://github.com/all-of-us/workbench/commit/d43ff437167069767d72cf32bb2780edd308277e", "message": "Merge branch 'master' into psantos/router-initial-implementation", "committedDate": "2020-05-07T17:17:09Z", "type": "commit"}, {"oid": "040c06992f8d806357666ed3064cfab331cf3204", "url": "https://github.com/all-of-us/workbench/commit/040c06992f8d806357666ed3064cfab331cf3204", "message": "Router conceptual impl", "committedDate": "2020-05-28T16:59:46Z", "type": "commit"}, {"oid": "25275ad5a6b54aa7fd14440fe960359ef8cef545", "url": "https://github.com/all-of-us/workbench/commit/25275ad5a6b54aa7fd14440fe960359ef8cef545", "message": "Add types to router", "committedDate": "2020-06-01T15:09:46Z", "type": "commit"}, {"oid": "01e73da53cb9dcf999df88eb9205b136c02c6cf9", "url": "https://github.com/all-of-us/workbench/commit/01e73da53cb9dcf999df88eb9205b136c02c6cf9", "message": "Move cookie router to react-router", "committedDate": "2020-06-01T17:08:29Z", "type": "commit"}, {"oid": "0e6fd64007442113b59df962c56f812f9ee57abf", "url": "https://github.com/all-of-us/workbench/commit/0e6fd64007442113b59df962c56f812f9ee57abf", "message": "Merge remote-tracking branch 'origin/master' into psantos/router-initial-implementation", "committedDate": "2020-06-01T17:16:43Z", "type": "commit"}, {"oid": "b6c6b77857cd5448de53c3e857266c2e1cb32016", "url": "https://github.com/all-of-us/workbench/commit/b6c6b77857cd5448de53c3e857266c2e1cb32016", "message": "Correct merge issues", "committedDate": "2020-06-01T17:27:48Z", "type": "commit"}, {"oid": "8c79e41cfd0fbc1b0f5efbccdd2695e1f95fdf53", "url": "https://github.com/all-of-us/workbench/commit/8c79e41cfd0fbc1b0f5efbccdd2695e1f95fdf53", "message": "merge...", "committedDate": "2020-06-01T17:34:28Z", "type": "commit"}, {"oid": "a4f910aaa44f4ce78f883753fe28b4ef5e8b4dcf", "url": "https://github.com/all-of-us/workbench/commit/a4f910aaa44f4ce78f883753fe28b4ef5e8b4dcf", "message": "more merge...", "committedDate": "2020-06-01T17:36:12Z", "type": "commit"}, {"oid": "7dd4ff98b046879a9d0f47a776d0980b7798292d", "url": "https://github.com/all-of-us/workbench/commit/7dd4ff98b046879a9d0f47a776d0980b7798292d", "message": "Add type to guards", "committedDate": "2020-06-01T19:34:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyOTI2NA==", "url": "https://github.com/all-of-us/workbench/pull/3632#discussion_r433929264", "bodyText": "why \"Sign In\" ?", "author": "jmthibault79", "createdAt": "2020-06-02T14:40:23Z", "path": "ui/src/app/app-routing.module.ts", "diffHunk": "@@ -346,6 +341,10 @@ const routes: Routes = [\n         data: {title: 'Create Workspace', mode: WorkspaceEditMode.Create}\n       }\n     ]\n+  }, {\n+    path: '**',\n+    component: AppRouting,\n+    data: {title: 'Sign In'}", "originalCommit": "7dd4ff98b046879a9d0f47a776d0980b7798292d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk0MTg2Mw==", "url": "https://github.com/all-of-us/workbench/pull/3632#discussion_r433941863", "bodyText": "I left this in accidentally - removed - thanks!", "author": "petesantos", "createdAt": "2020-06-02T14:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyOTI2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzNTk2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3632#discussion_r433935961", "bodyText": "can children be more strongly typed here?  Fragment[] perhaps?", "author": "jmthibault79", "createdAt": "2020-06-02T14:49:26Z", "path": "ui/src/app/components/app-router.tsx", "diffHunk": "@@ -0,0 +1,46 @@\n+import * as fp from 'lodash/fp';\n+import * as React from 'react';\n+import { BrowserRouter, Link, Redirect, Route, Switch, useHistory, useLocation, useParams, useRouteMatch} from 'react-router-dom';\n+\n+const {Fragment} = React;\n+\n+interface Guards {\n+  [index: number]: {\n+    checkGuard: () => boolean;\n+    redirectPath: string;\n+  };\n+}\n+\n+export const usePath = () => {\n+  const {path} = useRouteMatch();\n+  return path;\n+};\n+\n+export const SubRoute = ({children}): React.ReactElement => <Switch>{children}</Switch>;\n+export const AppRouter = ({children}): React.ReactElement => <BrowserRouter><SubRoute>{children}</SubRoute></BrowserRouter>;\n+\n+export const RouteLink = ({path, style = {}, children}): React.ReactElement => <Link style={{...style}} to={path}>{children}</Link>;\n+\n+export const AppRoute = ({path, data = {}, component: Component}): React.ReactElement => {\n+  const routeParams = useParams();\n+  const routeHistory = useHistory();\n+\n+  return <Route path={path} >\n+    <Component urlParams={routeParams} routeHistory={routeHistory} routeConfig={data}/>\n+  </Route>;\n+};\n+\n+export const ProtectedRoutes = (\n+  {path, guards, children}: {path: string, guards: Guards, children: any[] }): React.ReactElement => {", "originalCommit": "7dd4ff98b046879a9d0f47a776d0980b7798292d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk0MjYyNg==", "url": "https://github.com/all-of-us/workbench/pull/3632#discussion_r433942626", "bodyText": "I did mean to update this - I set it to React.ReactNode. That should cover any type of child that react accepts", "author": "petesantos", "createdAt": "2020-06-02T14:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzNTk2MQ=="}], "type": "inlineReview"}, {"oid": "6e7fa2c995677f2371dbcb5a8ce67206606f0a3a", "url": "https://github.com/all-of-us/workbench/commit/6e7fa2c995677f2371dbcb5a8ce67206606f0a3a", "message": "Correct minor issues", "committedDate": "2020-06-02T14:56:33Z", "type": "commit"}, {"oid": "be0cd42a5a191baa64d5f9f23d427b2454b88609", "url": "https://github.com/all-of-us/workbench/commit/be0cd42a5a191baa64d5f9f23d427b2454b88609", "message": "Correct type for react children", "committedDate": "2020-06-02T14:59:35Z", "type": "commit"}]}