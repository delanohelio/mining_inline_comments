{"pr_number": 4306, "pr_title": "Chavanr/e2e cohort review participant detail", "pr_createdAt": "2020-11-18T21:19:25Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4306", "timeline": [{"oid": "66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "url": "https://github.com/all-of-us/workbench/commit/66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "message": "added comments to the participant-detail review test steps", "committedDate": "2020-11-19T16:48:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NDIyMA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527064220", "bodyText": "nit: I don't think we need link text. what do you think of getParticipantId?", "author": "aweng98", "createdAt": "2020-11-19T17:22:23Z", "path": "e2e/app/page/cohort-review-page.ts", "diffHunk": "@@ -45,5 +45,17 @@ export default class CohortReviewPage extends AuthenticatedPage {\n     await waitWhileLoading(this.page);\n     return textContent;\n   }\n+    /**\n+     * Get the participant ID in specified row\n+     * @param {number} rowIndex\n+     * @return {string} Participant text that was clicked on.\n+     */\n+   async getParticipantLinkId(rowIndex: number = 1, colIndex: number = 1): Promise<string> {", "originalCommit": "66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA4ODY0OA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527088648", "bodyText": "this function was more to validate when on clicking gotonextparticipant the participantid on detailpage matches the one that is in cell(3). I've not used this function yet for the validation.", "author": "chavanr2019", "createdAt": "2020-11-19T17:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NDIyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2Nzg1OA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527067858", "bodyText": "are you waiting for a visible element? if yes, need {visible: true}.", "author": "aweng98", "createdAt": "2020-11-19T17:27:46Z", "path": "e2e/app/page/cohort-participant-detail-page.ts", "diffHunk": "@@ -20,8 +21,46 @@ export default class CohortParticipantDetailPage extends AuthenticatedPage {\n     return true;\n   }\n \n+  // get the particpant ID displayed between the two pi-angle button on participant detail page\n+  async getParticipantIDnum(): Promise<string> {\n+    const selector = `//*[@class=\"detail-header\"]//span[contains(., \"Participant \")]`;\n+    const pID = await this.extractParticipantID(selector);\n+    console.log(`Participant ID: ${pID}`);\n+    return pID;\n+  }\n+\n+  // extract only the number of the participant\n+  async extractParticipantID(selector: string): Promise<string> {\n+    const elemt = await this.page.waitForXPath(selector, {visible: true});\n+    const textContent = await getPropValue<string>(elemt, 'textContent');\n+    const regex = new RegExp(/\\d+/);\n+    return (regex.exec(textContent))[0];\n+  }\n+  \n+  // get the back to review set button\n   async getBackToReviewSetButton(): Promise<Button> {\n     return Button.findByName(this.page, {name: LinkText.BackToReviewSet});\n   }\n+ \n+   // click on the pen icon located on the side bar\n+   async clickPenIconHelpSideBar(): Promise<void> {\n+    const clickPenIcon = await this.page.waitForXPath(`//*[@data-test-id=\"help-sidebar-icon-annotations\"]`);", "originalCommit": "66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA4OTgxNA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527089814", "bodyText": "yes it is visible, this icon that's on sidebar on participant detail page.", "author": "chavanr2019", "createdAt": "2020-11-19T18:01:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2Nzg1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MTI1MQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527071251", "bodyText": "put await super.waitForLoad outside of try block because it already takes screenshot when fails.", "author": "aweng98", "createdAt": "2020-11-19T17:32:52Z", "path": "e2e/app/component/annotation-field-modal.ts", "diffHunk": "@@ -0,0 +1,59 @@\n+import {Page} from 'puppeteer';\n+import {savePageToFile, takeScreenshot} from 'utils/save-file-utils'\n+import {LinkText} from 'app/text-labels';\n+import Button from 'app/element/button';\n+import Modal from './modal';\n+import ReactSelect from 'app/element/react-select';\n+import {waitWhileLoading, waitForText} from 'utils/waits-utils';\n+\n+const modalTitle = 'Create a Review-Wide Annotation Field';\n+\n+export enum AnnotationType {\n+    FreeText = 'Free Text',\n+    DropdownList = 'Dropdown List',\n+    Date = 'Date',\n+    TrueFalseCheckBox ='True/False CheckBox',\n+    NumericField = 'Numeric Field'\n+  }\n+\n+export default class AnnotationFieldModal extends Modal {\n+\n+  constructor(page: Page, xpath?: string) {\n+    super(page, xpath);\n+  }\n+\n+  async waitForLoad(): Promise<this> {\n+    try {\n+      await super.waitForLoad();\n+      await waitForText(this.page, modalTitle, {xpath: this.getXpath()});\n+    } catch (e) {\n+      await savePageToFile(this.page);\n+      await takeScreenshot(this.page);\n+      throw new Error(`AnnotationFieldModal waitForLoad() encountered ${e}`);\n+    }\n+    return this;", "originalCommit": "66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5MDg4OA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527090888", "bodyText": "should I put it before  return this;?", "author": "chavanr2019", "createdAt": "2020-11-19T18:02:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MTI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE1MzczMQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527153731", "bodyText": "before try", "author": "aweng98", "createdAt": "2020-11-19T19:46:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MTI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NTE2MA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527775160", "bodyText": "Ok!", "author": "chavanr2019", "createdAt": "2020-11-20T15:39:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MTI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI3ODIyMQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r534278221", "bodyText": "done!", "author": "chavanr2019", "createdAt": "2020-12-02T15:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MTI1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MzEyMw==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527073123", "bodyText": "this is not correct selector. if there is a plus-circle icon outside of sidebar, it will likely find the wrong icon.", "author": "aweng98", "createdAt": "2020-11-19T17:35:41Z", "path": "e2e/app/component/sidebar-content.ts", "diffHunk": "@@ -0,0 +1,64 @@\n+\n+import {Page} from 'puppeteer';\n+import HelpSidebar from 'app/component/help-sidebar';\n+import ClrIconLink from 'app/element/clr-icon-link';\n+import {getPropValue} from 'utils/element-utils';\n+import ReactSelect from 'app/element/react-select';\n+import {waitWhileLoading} from 'utils/waits-utils';\n+\n+\n+const defaultXpath = '//*[@data-test-id=\"sidebar-content\"]';\n+\n+export enum ReviewStatus {\n+  Excluded = 'Excluded',\n+  Included = 'Included',\n+  NeedsFurtherReview = 'Needs Further Review '\n+}\n+\n+export default class SidebarContent extends  HelpSidebar {\n+  \n+\n+    constructor(page: Page, xpath: string = defaultXpath) {\n+      super(page, xpath);\n+    }\n+\n+    async getParticipantID(): Promise<string> {\n+        const selector = `${this.getXpath()}//div[1][text()=\"Participant \"]`;\n+        const pID = await this.extractParticipantDetails(selector);\n+        console.log(`Participant ID: ${pID}`);\n+        return pID;\n+    }\n+\n+    async getParticipantDOB(): Promise<string> {\n+        const selector = `${this.getXpath()}//*[contains(normalize-space(text()), \"DOB\")]/parent::*//span/following-sibling::text()`;\n+        const pidDob = await this.extractParticipantDetails(selector);\n+        console.log(`DOB: ${pidDob}`);\n+        return pidDob;\n+    }\n+\n+    \n+    private async extractParticipantDetails(selector: string): Promise<string> {\n+      const elemt = await this.page.waitForXPath(selector, {visible: true});\n+      const textContent = await getPropValue<string>(elemt, 'textContent');\n+      // const regex = new RegExp(/\\d{1,3}(,?\\d{3})*/); // Match numbers with comma\n+       const regex = new RegExp(/\\d+/);\n+      return (regex.exec(textContent))[0];\n+    }\n+\n+    /**\n+     * select participant status.\n+     * @param {ReviewStatus}  status\n+     */\n+    async selectReviewStatus(status: ReviewStatus): Promise<string> {\n+      const selectMenu = new ReactSelect(this.page, {name:'Choose a Review Status for Participant'});\n+      await selectMenu.selectOption(status);\n+      await waitWhileLoading(this.page);\n+      return selectMenu.getSelectedOption();\n+    }\n+  \n+    async getAnnotationsButton(): Promise<ClrIconLink> {\n+      return ClrIconLink.findByName(this.page, {iconShape: 'plus-circle'});", "originalCommit": "66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5NDM2OQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527094369", "bodyText": "this plus-circle icon is within the <div data-test-id=\"sidebar-content\" >. Do you think it'll still not work?", "author": "chavanr2019", "createdAt": "2020-11-19T18:08:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE1NDI1Ng==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527154256", "bodyText": "problem is that you're not using sidebar anywhere as parent in selector", "author": "aweng98", "createdAt": "2020-11-19T19:47:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NTg3OA==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527775878", "bodyText": "ok! got it. Will update it. Thanks!", "author": "chavanr2019", "createdAt": "2020-11-20T15:40:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI3ODUyNQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r534278525", "bodyText": "done!", "author": "chavanr2019", "createdAt": "2020-12-02T15:54:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3MzEyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NDUxNQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527074515", "bodyText": "click is happening inside function, function name get is not correct. same in next function.", "author": "aweng98", "createdAt": "2020-11-19T17:37:48Z", "path": "e2e/app/page/cohort-participant-detail-page.ts", "diffHunk": "@@ -20,8 +21,46 @@ export default class CohortParticipantDetailPage extends AuthenticatedPage {\n     return true;\n   }\n \n+  // get the particpant ID displayed between the two pi-angle button on participant detail page\n+  async getParticipantIDnum(): Promise<string> {\n+    const selector = `//*[@class=\"detail-header\"]//span[contains(., \"Participant \")]`;\n+    const pID = await this.extractParticipantID(selector);\n+    console.log(`Participant ID: ${pID}`);\n+    return pID;\n+  }\n+\n+  // extract only the number of the participant\n+  async extractParticipantID(selector: string): Promise<string> {\n+    const elemt = await this.page.waitForXPath(selector, {visible: true});\n+    const textContent = await getPropValue<string>(elemt, 'textContent');\n+    const regex = new RegExp(/\\d+/);\n+    return (regex.exec(textContent))[0];\n+  }\n+  \n+  // get the back to review set button\n   async getBackToReviewSetButton(): Promise<Button> {\n     return Button.findByName(this.page, {name: LinkText.BackToReviewSet});\n   }\n+ \n+   // click on the pen icon located on the side bar\n+   async clickPenIconHelpSideBar(): Promise<void> {\n+    const clickPenIcon = await this.page.waitForXPath(`//*[@data-test-id=\"help-sidebar-icon-annotations\"]`);\n+    await clickPenIcon.click();\n+    await this.page.waitForXPath('//*[@data-test-id=\"sidebar-content\"]', {visible: true});\n+    await waitWhileLoading(this.page);\n+  }\n+\n+  // click on pi-angle-right button to go to next participant\n+  async getGoToTheNextParticipant(): Promise<void> {\n+     const iconXpath = '//button[@title =\"Go To the Next Participant\"]';\n+    await this.page.waitForXPath(iconXpath, {visible: true}).then(icon => icon.click());\n+  }", "originalCommit": "66c44f1ac4f8fbeea849919d7a22a1496ba6aaf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5Mjc3Nw==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527092777", "bodyText": "ok! So do you mean I should change the function name to clickGoToNextParticipant?", "author": "chavanr2019", "createdAt": "2020-11-19T18:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE1NDY1Nw==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527154657", "bodyText": "for me, I think goToNextParticipant is good", "author": "aweng98", "createdAt": "2020-11-19T19:47:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NjE3Ng==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r527776176", "bodyText": "sounds good! Thanks!", "author": "chavanr2019", "createdAt": "2020-11-20T15:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI3ODYyMQ==", "url": "https://github.com/all-of-us/workbench/pull/4306#discussion_r534278621", "bodyText": "done!", "author": "chavanr2019", "createdAt": "2020-12-02T15:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NDUxNQ=="}], "type": "inlineReview"}, {"oid": "b5c48c2310cb49e940688fff1553acec32e26fca", "url": "https://github.com/all-of-us/workbench/commit/b5c48c2310cb49e940688fff1553acec32e26fca", "message": "added comments to the cohort-review test steps", "committedDate": "2020-11-19T17:53:25Z", "type": "forcePushed"}, {"oid": "835538ac4e7edbd7e45d8549368f742e383cbd0a", "url": "https://github.com/all-of-us/workbench/commit/835538ac4e7edbd7e45d8549368f742e383cbd0a", "message": "added comments to the cohort-review test steps", "committedDate": "2020-12-01T21:30:51Z", "type": "forcePushed"}, {"oid": "e36c57cb2e4270c882d155ad384572fd1b18e658", "url": "https://github.com/all-of-us/workbench/commit/e36c57cb2e4270c882d155ad384572fd1b18e658", "message": "updated function names", "committedDate": "2020-12-07T22:15:45Z", "type": "forcePushed"}, {"oid": "37792f891783dc258a397ec467c3d1e28f8e0c06", "url": "https://github.com/all-of-us/workbench/commit/37792f891783dc258a397ec467c3d1e28f8e0c06", "message": "created a new file for Annotation-modal", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "c871192c820ba835adf683f8bdf366170174537e", "url": "https://github.com/all-of-us/workbench/commit/c871192c820ba835adf683f8bdf366170174537e", "message": "created a new file for the sidebar-content that displays on clicking the pen-icon", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "8bbc9a0b249f64471eb3f8ebb6f2393517f794e9", "url": "https://github.com/all-of-us/workbench/commit/8bbc9a0b249f64471eb3f8ebb6f2393517f794e9", "message": "created new functions to clickPenIcon, clicktogothe Prior and Next participant", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "8d924e895928855407dd3fbef40fcc5a99411364", "url": "https://github.com/all-of-us/workbench/commit/8d924e895928855407dd3fbef40fcc5a99411364", "message": "added the create button located on the annotation-modal", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "8d1d60577fa835d6c0a196e60648f4e6f71b614c", "url": "https://github.com/all-of-us/workbench/commit/8d1d60577fa835d6c0a196e60648f4e6f71b614c", "message": "function to get the participant ID in specified row in the data table of the cohort review", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "6f715a907c6cf1f883b4ba1340ac2a5ed8ce8ccb", "url": "https://github.com/all-of-us/workbench/commit/6f715a907c6cf1f883b4ba1340ac2a5ed8ce8ccb", "message": "added steps review  the cohort data at participant level", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "59d5012423f0f4519c0dfa480d040861133b13e6", "url": "https://github.com/all-of-us/workbench/commit/59d5012423f0f4519c0dfa480d040861133b13e6", "message": "edited the console log", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "c967362c2ba69babd8c8b35033f016755d2d951d", "url": "https://github.com/all-of-us/workbench/commit/c967362c2ba69babd8c8b35033f016755d2d951d", "message": "update the getGoToThePriorParticipant function", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "c30c4af717332c2f2162911846536f94c1a555ca", "url": "https://github.com/all-of-us/workbench/commit/c30c4af717332c2f2162911846536f94c1a555ca", "message": "added comments to the participant-detail review test steps", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "e6b8b6d07c555d145919660a35bdb38bb3be6ed4", "url": "https://github.com/all-of-us/workbench/commit/e6b8b6d07c555d145919660a35bdb38bb3be6ed4", "message": "added comments to the cohort-review test steps", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "fed677e40de55fe3f9c894e5ae500cedf8e4afcb", "url": "https://github.com/all-of-us/workbench/commit/fed677e40de55fe3f9c894e5ae500cedf8e4afcb", "message": "moved code outside the try block", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "a03ac1e2d05244ccb2d4d98e0b9e6ad6cc5561d2", "url": "https://github.com/all-of-us/workbench/commit/a03ac1e2d05244ccb2d4d98e0b9e6ad6cc5561d2", "message": "added containsText to get the correct plus-circle icon", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "24d83f3d1c0729a751d0e84991d851e960611adc", "url": "https://github.com/all-of-us/workbench/commit/24d83f3d1c0729a751d0e84991d851e960611adc", "message": "updated function names", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "ee153a81614132defd0405f6f1925353f54289e2", "url": "https://github.com/all-of-us/workbench/commit/ee153a81614132defd0405f6f1925353f54289e2", "message": "added the text-labels file", "committedDate": "2020-12-14T15:59:03Z", "type": "commit"}, {"oid": "65f18d657551a2cf7ce3733af28e670d31ae2d86", "url": "https://github.com/all-of-us/workbench/commit/65f18d657551a2cf7ce3733af28e670d31ae2d86", "message": "added second parameter 10", "committedDate": "2020-12-14T16:48:47Z", "type": "commit"}, {"oid": "1422b943d406c7d9198f852045e9d512271798bb", "url": "https://github.com/all-of-us/workbench/commit/1422b943d406c7d9198f852045e9d512271798bb", "message": "revisited console logs and edited", "committedDate": "2020-12-14T17:10:57Z", "type": "commit"}, {"oid": "1422b943d406c7d9198f852045e9d512271798bb", "url": "https://github.com/all-of-us/workbench/commit/1422b943d406c7d9198f852045e9d512271798bb", "message": "revisited console logs and edited", "committedDate": "2020-12-14T17:10:57Z", "type": "forcePushed"}]}