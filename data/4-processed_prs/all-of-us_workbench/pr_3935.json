{"pr_number": 3935, "pr_title": "[RW-4847][RW-5405][risk=low] Upgrade remaining Leo client-side usages", "pr_createdAt": "2020-08-28T01:20:42Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3935", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjMzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479532331", "bodyText": "Also need to update the Welder tags (228 and 259)", "author": "jmthibault79", "createdAt": "2020-08-28T21:00:39Z", "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -23,10 +20,10 @@ produces:\n tags:\n   - name: test\n     description: Test API\n-  - name: cluster\n-    description: Clusters API\n-  - name: notebooks\n-    description: Notebooks API\n+  - name: runtime\n+    description: Runtimes API\n+  - name: proxy", "originalCommit": "f56b433b4d16500c0bc5e11d8092d74bf081b633", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc2NDcwMg==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r481764702", "bodyText": "Sorry, not following - what should be updated? I could potentially move them to the proxy API tag, if that's what you mean, or I could just rename to welder - but this is perhaps out of scope.", "author": "calbach", "createdAt": "2020-09-02T06:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjMzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1NDU0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r482154541", "bodyText": "Right, moving them to the proxy tag", "author": "jmthibault79", "createdAt": "2020-09-02T15:17:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjMzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY4NTM0NA==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r482685344", "bodyText": "Done", "author": "calbach", "createdAt": "2020-09-03T03:44:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjMzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjk5NA==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479532994", "bodyText": "uses the plural everywhere else", "author": "jmthibault79", "createdAt": "2020-08-28T21:02:23Z", "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -23,10 +20,10 @@ produces:\n tags:\n   - name: test\n     description: Test API\n-  - name: cluster\n-    description: Clusters API\n-  - name: notebooks\n-    description: Notebooks API\n+  - name: runtime", "originalCommit": "f56b433b4d16500c0bc5e11d8092d74bf081b633", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMzQ0MA==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479533440", "bodyText": "is this un-deprecated?", "author": "jmthibault79", "createdAt": "2020-08-28T21:03:39Z", "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -47,98 +44,111 @@ securityDefinitions:\n       profile: profile authorization\n \n ##########################################################################################\n-## PATHS\n+## Subset of Leo APIs needed by the frontend. Just leave them here for ease of\n+## access. If we want to consolidate these APIs, we can later decide to migrate\n+## the Welder and Jupyter spec to OAS3 as well, and move typescript codegen.\n ##########################################################################################\n \n-# TODO(calbach): migrate start/stop into new swagger3 spec; currently these are\n-# needed by typescript.\n-\n paths:\n-  '/api/cluster/{googleProject}/{clusterName}/stop':\n+\n+  /api/google/v1/runtimes/{googleProject}/{name}/stop:\n     post:\n-      summary: Stops a Dataproc cluster\n-      description: |\n-        Stops the instances of a Dataproc cluster, but retains any data persisted on disk. The\n-        cluster may be restarted with the /start endpoint.\n-      operationId: stopCluster\n+      summary: Stops a Dataproc cluster or Google Compute Engine instance\n+      description: >\n+        Stops the running compute, but retains any data persisted on disk. The runtime may be restarted with the /start endpoint.\n+      operationId: stopRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtime name\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster stop request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be stopped\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime stop request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be stopped\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-\n-  '/api/cluster/{googleProject}/{clusterName}/start':\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+  /api/google/v1/runtimes/{googleProject}/{name}/start:\n     post:\n-      summary: Starts a Dataproc cluster\n-      description: |\n-        Starts the instances of a stopped Dataproc cluster.\n-      operationId: startCluster\n+      summary: Starts a Dataproc cluster or Google Compute Engine instance\n+      description: Starts the a stopped runtime\n+      operationId: startRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtimeName\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster start request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be started\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime start request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be started\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n \n-  '/notebooks/{googleProject}/{clusterName}/setCookie':\n+  \"/proxy/{googleProject}/{clusterName}/setCookie\":\n     get:\n-      summary: (Deprecated) Sets a browser cookie needed to authorize connections to a Jupyter notebook\n-      description: |\n-        If using Google token-based authorization to a Jupyter notebook, the Leo proxy accepts a\n+      summary: Sets a browser cookie needed to authorize connections to a Dataproc", "originalCommit": "f56b433b4d16500c0bc5e11d8092d74bf081b633", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc2MTA4Mw==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r481761083", "bodyText": "The \"proxy\" endpoint is not deprecated, the /notebooks one was", "author": "calbach", "createdAt": "2020-09-02T06:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMzQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMzg0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479533841", "bodyText": "Is this strictly for clusters?  Update text to \"runtime\" if not", "author": "jmthibault79", "createdAt": "2020-08-28T21:04:44Z", "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -47,98 +44,111 @@ securityDefinitions:\n       profile: profile authorization\n \n ##########################################################################################\n-## PATHS\n+## Subset of Leo APIs needed by the frontend. Just leave them here for ease of\n+## access. If we want to consolidate these APIs, we can later decide to migrate\n+## the Welder and Jupyter spec to OAS3 as well, and move typescript codegen.\n ##########################################################################################\n \n-# TODO(calbach): migrate start/stop into new swagger3 spec; currently these are\n-# needed by typescript.\n-\n paths:\n-  '/api/cluster/{googleProject}/{clusterName}/stop':\n+\n+  /api/google/v1/runtimes/{googleProject}/{name}/stop:\n     post:\n-      summary: Stops a Dataproc cluster\n-      description: |\n-        Stops the instances of a Dataproc cluster, but retains any data persisted on disk. The\n-        cluster may be restarted with the /start endpoint.\n-      operationId: stopCluster\n+      summary: Stops a Dataproc cluster or Google Compute Engine instance\n+      description: >\n+        Stops the running compute, but retains any data persisted on disk. The runtime may be restarted with the /start endpoint.\n+      operationId: stopRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtime name\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster stop request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be stopped\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime stop request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be stopped\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-\n-  '/api/cluster/{googleProject}/{clusterName}/start':\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+  /api/google/v1/runtimes/{googleProject}/{name}/start:\n     post:\n-      summary: Starts a Dataproc cluster\n-      description: |\n-        Starts the instances of a stopped Dataproc cluster.\n-      operationId: startCluster\n+      summary: Starts a Dataproc cluster or Google Compute Engine instance\n+      description: Starts the a stopped runtime\n+      operationId: startRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtimeName\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster start request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be started\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime start request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be started\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n \n-  '/notebooks/{googleProject}/{clusterName}/setCookie':\n+  \"/proxy/{googleProject}/{clusterName}/setCookie\":\n     get:\n-      summary: (Deprecated) Sets a browser cookie needed to authorize connections to a Jupyter notebook\n-      description: |\n-        If using Google token-based authorization to a Jupyter notebook, the Leo proxy accepts a\n+      summary: Sets a browser cookie needed to authorize connections to a Dataproc\n+        cluster", "originalCommit": "f56b433b4d16500c0bc5e11d8092d74bf081b633", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzNjAxNQ==", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479536015", "bodyText": "\"cluster/path\" prefix.  Also update the many cluster references in the \"subset\" Jupyter and Welder sections themselves", "author": "jmthibault79", "createdAt": "2020-08-28T21:10:21Z", "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -1,10 +1,7 @@\n # This file is a hand-crafted combination of Leo and its proxy APIs.\n #  - A subset of Welder (modified for cluster/path prefix): https://github.com/DataBiosphere/welder/blob/master/server/src/main/resources/api-docs.yaml", "originalCommit": "f56b433b4d16500c0bc5e11d8092d74bf081b633", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d55dfc8519266d8c3b91affeaecfc6ce811e5ee", "url": "https://github.com/all-of-us/workbench/commit/4d55dfc8519266d8c3b91affeaecfc6ce811e5ee", "message": "PR feedback", "committedDate": "2020-09-02T04:57:16Z", "type": "forcePushed"}, {"oid": "d48b05ae20b2f2fd28f8f865a7f1610cb2e48f35", "url": "https://github.com/all-of-us/workbench/commit/d48b05ae20b2f2fd28f8f865a7f1610cb2e48f35", "message": "Upgrade remaining UI usages", "committedDate": "2020-09-03T00:01:21Z", "type": "commit"}, {"oid": "999036e28268c54a92cc62d39afb391e792ae56a", "url": "https://github.com/all-of-us/workbench/commit/999036e28268c54a92cc62d39afb391e792ae56a", "message": "comment", "committedDate": "2020-09-03T00:01:21Z", "type": "commit"}, {"oid": "1b3ac34dbab7ab54bb69489892be7d9bc4e2449d", "url": "https://github.com/all-of-us/workbench/commit/1b3ac34dbab7ab54bb69489892be7d9bc4e2449d", "message": "fixes", "committedDate": "2020-09-03T00:01:21Z", "type": "commit"}, {"oid": "7789f4a744dff6ff6ccaf056e6bfab525cafffe6", "url": "https://github.com/all-of-us/workbench/commit/7789f4a744dff6ff6ccaf056e6bfab525cafffe6", "message": "PR feedback", "committedDate": "2020-09-03T00:01:21Z", "type": "commit"}, {"oid": "906cfe3491649ca44bb3326d8fa44cf270258713", "url": "https://github.com/all-of-us/workbench/commit/906cfe3491649ca44bb3326d8fa44cf270258713", "message": "fixes", "committedDate": "2020-09-03T00:01:21Z", "type": "commit"}, {"oid": "6fca5a16d25b932fbfd31979a59f28eb8187bf29", "url": "https://github.com/all-of-us/workbench/commit/6fca5a16d25b932fbfd31979a59f28eb8187bf29", "message": "Proxy rename", "committedDate": "2020-09-03T01:12:52Z", "type": "commit"}, {"oid": "6fca5a16d25b932fbfd31979a59f28eb8187bf29", "url": "https://github.com/all-of-us/workbench/commit/6fca5a16d25b932fbfd31979a59f28eb8187bf29", "message": "Proxy rename", "committedDate": "2020-09-03T01:12:52Z", "type": "forcePushed"}]}