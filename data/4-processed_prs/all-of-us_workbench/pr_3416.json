{"pr_number": 3416, "pr_title": "[RW-4773][risk=no] Clean up and organize api/build.gradle a bit", "pr_createdAt": "2020-04-15T21:58:22Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3416", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2OTk5Mw==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409169993", "bodyText": "I don't disagree that this is probably the ideal end state, but I would not attempt to go down this path without first restructuring the codebase holistically to be more modular with cleaner dependencies. Originally, tools were a separate gradle file. This worked to a certain point and then completely broke down as more service dependencies were pulled in. In the end we wound up merging that into this file: https://precisionmedicineinitiative.atlassian.net/browse/RW-2172", "author": "calbach", "createdAt": "2020-04-15T22:25:35Z", "path": "api/build.gradle", "diffHunk": "@@ -628,15 +684,15 @@ version = '0.1.0'          // Version in generated output\n sourceCompatibility = 1.8\n targetCompatibility = 1.8\n \n-task incrementalHotSwap(type: IncrementalHotSwapTask) {\n+task incrementalHotSwap(type: IncrementalHotSwapTask, dependsOn: 'compileJava') {\n     inputDir = sourceSets.main.java.outputDir\n }\n \n-incrementalHotSwap.dependsOn compileJava\n-\n task listProjectAPIs(type: GenerateAPIListingTask)\n \n \n+// TODO(jaycarlton) move tools-related stuff to its own Gradle project", "originalCommit": "aec133f7a317bc4e6f82657ac8aad3cf7b720097", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU1MzE3Ng==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409553176", "bodyText": "Definitely good to know. I'm pulling a few of the TODOs out as they're mostly too prescriptive and the world may have changed before we get to them.\nThis will be an interesting thing to consider as I'm looking at the structural evolution of some of these things.", "author": "jaycarlton", "createdAt": "2020-04-16T13:25:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2OTk5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTg3Mw==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409171873", "bodyText": "Why the change to omit curly brackets? I'm surprised this is legal", "author": "calbach", "createdAt": "2020-04-15T22:30:37Z", "path": "api/build.gradle", "diffHunk": "@@ -402,36 +464,36 @@ dependencies {\n   compile 'mysql:mysql-connector-java:8.0.16'\n   compile 'com.google.cloud.sql:mysql-socket-factory:1.0.10'\n \n-  compile \"com.google.appengine:appengine:${GAE_VERSION}\"\n-  compile \"com.google.appengine:appengine-api-1.0-sdk:${GAE_VERSION}\"\n+  compile \"com.google.appengine:appengine:$project.ext.GAE_VERSION\"\n+  compile \"com.google.appengine:appengine-api-1.0-sdk:$project.ext.GAE_VERSION\"\n \n-  compile(\"org.springframework.boot:spring-boot-starter-web:${SPRING_BOOT_VERSION}\") {\n+  compile(\"org.springframework.boot:spring-boot-starter-web:$project.ext.SPRING_BOOT_VERSION\") {\n     exclude module: 'spring-boot-starter-tomcat'\n     exclude group: 'org.slf4j', module: 'jul-to-slf4j'\n   }\n-  compile(\"org.springframework.boot:spring-boot-starter-data-jpa:${SPRING_BOOT_VERSION}\") {\n+  compile(\"org.springframework.boot:spring-boot-starter-data-jpa:$project.ext.SPRING_BOOT_VERSION\") {\n     exclude module: 'spring-boot-starter-tomcat'\n     exclude group: 'org.slf4j', module: 'jul-to-slf4j'\n   }\n-  compile(\"org.springframework.boot:spring-boot-starter-actuator:${SPRING_BOOT_VERSION}\") {\n+  compile(\"org.springframework.boot:spring-boot-starter-actuator:$project.ext.SPRING_BOOT_VERSION\") {\n     exclude module: 'spring-boot-starter-tomcat'\n     exclude group: 'org.slf4j', module: 'jul-to-slf4j'\n   }\n \n   compile 'ch.qos.logback:logback-classic:1.2.3'\n \n   compile 'org.springframework.security:spring-security-web:4.2.13.RELEASE'\n-  compile \"org.hibernate:hibernate-core:${HIBERNATE_VERSION}\"\n+  compile \"org.hibernate:hibernate-core:$project.ext.HIBERNATE_VERSION\"\n \n   // Force the Kotlin version, otherwise the Kotlin plugin conflicts with Jackson's\n   // Kotlin dep, resulting in massive logspam.\n-  compile \"org.jetbrains.kotlin:kotlin-reflect:${KOTLIN_VERSION}\"\n+  compile \"org.jetbrains.kotlin:kotlin-reflect:$project.ext.KOTLIN_VERSION\"", "originalCommit": "aec133f7a317bc4e6f82657ac8aad3cf7b720097", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU1NjUxMg==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409556512", "bodyText": "IntelliJ suggests that they're redundant and asks to elide them for me.\n\nFrom the docs\n\nIn addition to ${} placeholders, we can also use a lone $ sign prefixing a dotted expression:\ndef person = [name: 'Guillaume', age: 36]\nassert \"$person.name is $person.age years old\" == 'Guillaume is 36 years old'\nBut only dotted expressions of the form a.b, a.b.c, etc, are valid. Expressions containing parentheses like method calls, curly braces for closures, dots which aren\u2019t part of a property expression or arithmetic operators would be invalid.", "author": "jaycarlton", "createdAt": "2020-04-16T13:30:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTg3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MzA4MA==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409173080", "bodyText": "nit: Not that I don't like reading this, but I'd save the editorialized first person narration for the PR review and just leave the essentials in the code itself.", "author": "calbach", "createdAt": "2020-04-15T22:33:46Z", "path": "api/build.gradle", "diffHunk": "@@ -316,7 +346,38 @@ sourceSets {\n     compileClasspath += generated.output\n     runtimeClasspath += generated.output\n   }\n-  integration {\n+\n+  //\n+  // Custom SourceSets\n+  //\n+  // Sometimes, in order to fight the clean code war, you have to get dirty in a battle.\n+  // Here we use a naming convention with __ word boundaries at start and end\n+  // to avoid confusion. For example, the plugin may define a __tools__Compile configuration\n+  // or a compile__tools__Java task. This \"shields up\" approach makes it obvious where there's\n+  // a dynamically defined symbol name, so usages stick out and it's easier to identify the\n+  // constituent parts. Why four underscores where two might do? Groovy is making me miss C++", "originalCommit": "aec133f7a317bc4e6f82657ac8aad3cf7b720097", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU2MTE0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409561141", "bodyText": "Yeah, people finding their afternoon taking a detour into the build script generally aren't in the most jocular mood.\nBy the way, IntelliJ annotates the directories associated with the source sets in the project pane:", "author": "jaycarlton", "createdAt": "2020-04-16T13:36:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MzA4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3NDI0Ng==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409174246", "bodyText": "s/RW0/RW/", "author": "calbach", "createdAt": "2020-04-15T22:36:36Z", "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,82 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Mainly sets up properties and dependencies.\n+buildscript {\n+  // Project-wide constants.\n+  ext {\n+    ELASTICSEARCH_VERSION = '6.8.3'\n+    GAE_VERSION = '1.9.64'\n+    GSON_VERSION = '2.8.5'\n+    HIBERNATE_VERSION = '5.2.10.Final'\n+    JACKSON_DATABIND_VERSION = '2.9.10.1'\n+    JACKSON_VERSION = '2.9.10'\n+    JODA_VERSION = '2.10'\n+    KOTLIN_VERSION = '1.3.50'\n+    MAPSTRUCT_VERSION = '1.3.1.Final'\n+    MOCKITO_KOTLIN_VERSION = '2.2.0'\n+    OKHTTP_VERSION = '2.7.5'\n+    OPENCENSUS_VERSION = '0.23.0'\n+    SPRINGFOX_VERSION = '2.6.1'\n+    SPRING_BOOT_VERSION = '1.5.22.RELEASE'\n+    SWAGGER_CODEGEN_VERSION = '2.2.3'\n+  }\n+\n+  repositories {\n+    // Bintray's repository - a fast Maven Central mirror & more\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+\n+  // Top-level Gradle project dependencies\n+  dependencies {\n+    classpath 'com.diffplug.spotless:spotless-plugin-gradle:3.23.0'\n+    classpath 'com.google.cloud.tools:appengine-gradle-plugin:1.3.5'\n+    classpath 'gradle.plugin.org.hidetake:gradle-swagger-generator-plugin:2.12.0'\n+    // Note: if you plan to upgrade the version of swagger-codegen beyond 2.2.3, be aware of two\n+    // implicit dependencies: (1) the set of \"generatedCompile\" Gradle dependencies need to be updated\n+    // to match the modules imported by the Swagger codegen templates, and (2) some template files\n+    // are overridden with forked templates within this repo; they will likely need to be re-copied from\n+    // the newer release version and have AoU-specific modifications re-applied.\n+    classpath \"io.swagger:swagger-codegen:$project.ext.SWAGGER_CODEGEN_VERSION\"\n+    classpath 'net.ltgt.gradle:gradle-apt-plugin:0.21'\n+    classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$project.ext.KOTLIN_VERSION\"\n+    classpath \"org.jetbrains.kotlin:kotlin-noarg:$project.ext.KOTLIN_VERSION\"\n+    classpath 'org.owasp:dependency-check-gradle:5.1.0'\n+    classpath \"org.springframework.boot:spring-boot-gradle-plugin:$project.ext.SPRING_BOOT_VERSION\"\n+  }\n+}\n+\n+project.ext['hibernate.version'] = project.ext.HIBERNATE_VERSION\n+\n+// TODO(jaycarlton): migrate to new plugin DSL (RW0-4772)", "originalCommit": "aec133f7a317bc4e6f82657ac8aad3cf7b720097", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3NDM3OQ==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409174379", "bodyText": "Is there a reason not to do this now? Or are you waiting on the new plugin DSL to enable this?", "author": "calbach", "createdAt": "2020-04-15T22:36:58Z", "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,82 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Mainly sets up properties and dependencies.\n+buildscript {\n+  // Project-wide constants.\n+  ext {\n+    ELASTICSEARCH_VERSION = '6.8.3'\n+    GAE_VERSION = '1.9.64'\n+    GSON_VERSION = '2.8.5'\n+    HIBERNATE_VERSION = '5.2.10.Final'\n+    JACKSON_DATABIND_VERSION = '2.9.10.1'\n+    JACKSON_VERSION = '2.9.10'\n+    JODA_VERSION = '2.10'\n+    KOTLIN_VERSION = '1.3.50'\n+    MAPSTRUCT_VERSION = '1.3.1.Final'\n+    MOCKITO_KOTLIN_VERSION = '2.2.0'\n+    OKHTTP_VERSION = '2.7.5'\n+    OPENCENSUS_VERSION = '0.23.0'\n+    SPRINGFOX_VERSION = '2.6.1'\n+    SPRING_BOOT_VERSION = '1.5.22.RELEASE'\n+    SWAGGER_CODEGEN_VERSION = '2.2.3'\n+  }\n+\n+  repositories {\n+    // Bintray's repository - a fast Maven Central mirror & more\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+\n+  // Top-level Gradle project dependencies\n+  dependencies {\n+    classpath 'com.diffplug.spotless:spotless-plugin-gradle:3.23.0'\n+    classpath 'com.google.cloud.tools:appengine-gradle-plugin:1.3.5'\n+    classpath 'gradle.plugin.org.hidetake:gradle-swagger-generator-plugin:2.12.0'\n+    // Note: if you plan to upgrade the version of swagger-codegen beyond 2.2.3, be aware of two\n+    // implicit dependencies: (1) the set of \"generatedCompile\" Gradle dependencies need to be updated\n+    // to match the modules imported by the Swagger codegen templates, and (2) some template files\n+    // are overridden with forked templates within this repo; they will likely need to be re-copied from\n+    // the newer release version and have AoU-specific modifications re-applied.\n+    classpath \"io.swagger:swagger-codegen:$project.ext.SWAGGER_CODEGEN_VERSION\"\n+    classpath 'net.ltgt.gradle:gradle-apt-plugin:0.21'\n+    classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$project.ext.KOTLIN_VERSION\"\n+    classpath \"org.jetbrains.kotlin:kotlin-noarg:$project.ext.KOTLIN_VERSION\"\n+    classpath 'org.owasp:dependency-check-gradle:5.1.0'\n+    classpath \"org.springframework.boot:spring-boot-gradle-plugin:$project.ext.SPRING_BOOT_VERSION\"\n+  }\n+}\n+\n+project.ext['hibernate.version'] = project.ext.HIBERNATE_VERSION\n+\n+// TODO(jaycarlton): migrate to new plugin DSL (RW0-4772)\n+// TODO(jaycarlton): move the plugin apply statements closer to configuration blocks for the plugins", "originalCommit": "aec133f7a317bc4e6f82657ac8aad3cf7b720097", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU2MzUzNw==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409563537", "bodyText": "The DSL seems to recommend all of them together in a plugins block, so doing this wouldn't help with the transition. Killing this one as it's more of a note to self.", "author": "jaycarlton", "createdAt": "2020-04-16T13:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3NDM3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcwMTcyNQ==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409701725", "bodyText": "I'm a little confused about the idea of scoping. Further down in this buildscript section, you describe the repositories as \"buildscript-scoped repositories\". But here we describe \"project-wide constants\". Is there a difference, or are the comments just inconsistent with each other?", "author": "gjuggler", "createdAt": "2020-04-16T16:46:23Z", "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,83 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Sets up properties and dependencies for the build\n+// process itself.\n+buildscript {\n+  // Project-wide constants.", "originalCommit": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc0NTAzMg==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409745032", "bodyText": "I'm confused too. I don't think it makes sense to have an ext block inside a buildscript.\nFor example, when I do ./gradlew properties, these are at the top level with the others:\njaycarlton~/repos/workbench/api (jaycarlton/cleanGradle) $ ./gradlew properties\n\n> Task :properties \n\n------------------------------------------------------------\nRoot project\n------------------------------------------------------------\n\nBootRepackage: class org.springframework.boot.gradle.repackage.RepackageTask\nELASTICSEARCH_VERSION: 6.8.3\nGAE_VERSION: 1.9.64\nGSON_VERSION: 2.8.5\nGenerateReDoc: class org.hidetake.gradle.swagger.generator.GenerateReDoc\nGenerateSwaggerCode: class org.hidetake.gradle.swagger.generator.GenerateSwaggerCode\nGenerateSwaggerUI: class org.hidetake.gradle.swagger.generator.GenerateSwaggerUI\nHIBERNATE_VERSION: 5.2.10.Final\nJACKSON_DATABIND_VERSION: 2.9.10.1\nJACKSON_VERSION: 2.9.10\nJODA_VERSION: 2.10\nKOTLIN_VERSION: 1.3.50\nMAPSTRUCT_VERSION: 1.3.1.Final\nMOCKITO_KOTLIN_VERSION: 2.2.0\nOKHTTP_VERSION: 2.7.5\nOPENCENSUS_VERSION: 0.23.0\nSPRINGFOX_VERSION: 2.6.1\nSPRING_BOOT_VERSION: 1.5.22.RELEASE\nSWAGGER_CODEGEN_VERSION: 2.2.3\n# ...\n\nHowever, when you move this ext closure after the buildscript, the values aren't available yet when the buildscript is parsed. (It's always first I think).", "author": "jaycarlton", "createdAt": "2020-04-16T17:56:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcwMTcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxNDI4OA==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409714288", "bodyText": "How does this relate to buildscript.ext.HIBERNATE_VERSION? If you have a clear idea of what this line is doing / why it exists, a short comment here might help.", "author": "gjuggler", "createdAt": "2020-04-16T17:06:33Z", "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,83 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Sets up properties and dependencies for the build\n+// process itself.\n+buildscript {\n+  // Project-wide constants.\n+  ext {\n+    ELASTICSEARCH_VERSION = '6.8.3'\n+    GAE_VERSION = '1.9.64'\n+    GSON_VERSION = '2.8.5'\n+    HIBERNATE_VERSION = '5.2.10.Final'\n+    JACKSON_DATABIND_VERSION = '2.9.10.1'\n+    JACKSON_VERSION = '2.9.10'\n+    JODA_VERSION = '2.10'\n+    KOTLIN_VERSION = '1.3.50'\n+    MAPSTRUCT_VERSION = '1.3.1.Final'\n+    MOCKITO_KOTLIN_VERSION = '2.2.0'\n+    OKHTTP_VERSION = '2.7.5'\n+    OPENCENSUS_VERSION = '0.23.0'\n+    SPRINGFOX_VERSION = '2.6.1'\n+    SPRING_BOOT_VERSION = '1.5.22.RELEASE'\n+    SWAGGER_CODEGEN_VERSION = '2.2.3'\n+  }\n+\n+  repositories {\n+    // Bintray's repository - a fast Maven Central mirror & more\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+\n+  // Buildscript-specific dependencies (uses buildscript-scoped repositories). This\n+  // closure ensures allows the buildscript dependencies (e.g. for plgins) to be managed\n+  // independently from the main project's application code's dependencies\n+  dependencies {\n+    classpath 'com.diffplug.spotless:spotless-plugin-gradle:3.23.0'\n+    classpath 'com.google.cloud.tools:appengine-gradle-plugin:1.3.5'\n+    classpath 'gradle.plugin.org.hidetake:gradle-swagger-generator-plugin:2.12.0'\n+    // Note: if you plan to upgrade the version of swagger-codegen beyond 2.2.3, be aware of two\n+    // implicit dependencies: (1) the set of \"generatedCompile\" Gradle dependencies need to be updated\n+    // to match the modules imported by the Swagger codegen templates, and (2) some template files\n+    // are overridden with forked templates within this repo; they will likely need to be re-copied from\n+    // the newer release version and have AoU-specific modifications re-applied.\n+    classpath \"io.swagger:swagger-codegen:$project.ext.SWAGGER_CODEGEN_VERSION\"\n+    classpath 'net.ltgt.gradle:gradle-apt-plugin:0.21'\n+    classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$project.ext.KOTLIN_VERSION\"\n+    classpath \"org.jetbrains.kotlin:kotlin-noarg:$project.ext.KOTLIN_VERSION\"\n+    classpath 'org.owasp:dependency-check-gradle:5.1.0'\n+    classpath \"org.springframework.boot:spring-boot-gradle-plugin:$project.ext.SPRING_BOOT_VERSION\"\n+  }\n+}\n+\n+project.ext['hibernate.version'] = project.ext.HIBERNATE_VERSION", "originalCommit": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc0ODQwNw==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409748407", "bodyText": "They're both properties on the Root Project's extra properties container ext, which is provided by the ExtraPropertiesExtension. From ./gradlew properties you get\nhibernate.version: 5.2.10.Final\nHIBERNATE_VERSION: 5.2.10.Final.\nI'll see if I can kill the latter one by referring to the former one. Still no idea why/if it needs to be named this way.", "author": "jaycarlton", "createdAt": "2020-04-16T18:01:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxNDI4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxNTA0Ng==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409715046", "bodyText": "Nice comment \u2013\u00a0thanks for taking the time to make this clear.", "author": "gjuggler", "createdAt": "2020-04-16T17:07:47Z", "path": "api/build.gradle", "diffHunk": "@@ -316,7 +347,36 @@ sourceSets {\n     compileClasspath += generated.output\n     runtimeClasspath += generated.output\n   }\n-  integration {\n+\n+  //\n+  // Custom SourceSets\n+  //\n+  // Here we use a naming convention with __ word boundaries at start and end", "originalCommit": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxODg1NQ==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409718855", "bodyText": "s/movre/more/", "author": "calbach", "createdAt": "2020-04-16T17:14:20Z", "path": "api/build.gradle", "diffHunk": "@@ -316,7 +347,36 @@ sourceSets {\n     compileClasspath += generated.output\n     runtimeClasspath += generated.output\n   }\n-  integration {\n+\n+  //\n+  // Custom SourceSets\n+  //\n+  // Here we use a naming convention with __ word boundaries at start and end\n+  // to avoid confusion. For example, the plugin may define a __tools__Compile configuration\n+  // or a compile__tools__Java task. This approach makes it movre obvious where there's", "originalCommit": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4MTIwMg==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r410481202", "bodyText": "contextual placement of this comment was lost here, since it now seems to refer to all following. Delete if you don't intend to maintain a semantic grouping of dependencies", "author": "calbach", "createdAt": "2020-04-17T21:35:22Z", "path": "api/build.gradle", "diffHunk": "@@ -337,219 +398,223 @@ sourceSets {\n       srcDirs = ['tools/src/main/java']\n     }\n   }\n-  bigQueryTest {\n-    resources {\n-      srcDir \"bigquerytest/resources\"\n-      srcDir \"config/\"\n-      include \"bigquery/**\"\n-      include \"cdm/**\"\n-    }\n-    java {\n-      compileClasspath += main.output + test.output + generated.output\n-      runtimeClasspath += main.output + test.output + generated.output\n-      srcDir file('src/bigquerytest/java')\n-    }\n+}\n+\n+// Artifact configurations derived from base configs. Configuration names\n+// are concatenated by the Java plugin.\n+// https://docs.gradle.org/current/userguide/java_plugin.html#java_source_set_configurations\n+configurations {\n+  __bigQueryTest__Compile.extendsFrom testCompile\n+  __bigQueryTest__Runtime.extendsFrom testRuntime\n+\n+  __integration__Compile.extendsFrom testCompile\n+  __integration__Runtime.extendsFrom testRuntime\n+\n+  __tools__Implementation.extendsFrom implementation\n+  __tools__RuntimeOnly.extendsFrom runtimeOnly\n+\n+  generatedCompile {\n+    exclude group: 'com.google.guava', module:'guava-jdk5'\n   }\n }\n \n-generateApi.dependsOn validateSwagger\n-ideaModule.dependsOn generateApi\n-compileGeneratedJava.dependsOn generateApi\n-ideaModule.dependsOn generateFireCloudClient\n-compileGeneratedJava.dependsOn generateFireCloudClient\n-ideaModule.dependsOn generateNotebooksClient\n-compileGeneratedJava.dependsOn generateNotebooksClient\n-ideaModule.dependsOn generateJiraClient\n-compileGeneratedJava.dependsOn generateJiraClient\n-ideaModule.dependsOn generateMandrillClient\n-compileGeneratedJava.dependsOn generateMandrillClient\n-ideaModule.dependsOn generateMoodleClient\n-compileGeneratedJava.dependsOn generateMoodleClient\n-ideaModule.dependsOn generateRdrClient\n-compileGeneratedJava.dependsOn generateRdrClient\n-ideaModule.dependsOn generateCaptchaClient\n-compileGeneratedJava.dependsOn generateCaptchaClient\n-classes.dependsOn generatedClasses\n-compileJava.dependsOn compileGeneratedJava\n-\n-war.dependsOn compileGeneratedJava\n-war.dependsOn generate_appengine_web_xml\n-war.dependsOn generate_appengine_cron_yaml\n+// Add dependencies to the classes builtin task from the  Java plugin.\n+// \"This is an aggregate task that just depends on other tasks.\n+// Other plugins may attach additional compilation tasks to it.\"\n+// https://docs.gradle.org/current/userguide/java_plugin.html\n+classes.dependsOn 'generatedClasses'\n+\n+def swaggerCodegenTasks = ['generateWorkbenchApi', 'generateFireCloudClient', 'generateNotebooksClient',\n+                           'generateJiraClient', 'generateMandrillClient', 'generateMoodleClient',\n+                           'generateRdrClient', 'generateCaptchaClient']\n \n+// The IDEA plugin generates files that assist the IntelliJ IDE in opening Gradle-defined projects.\n+// https://docs.gradle.org/current/userguide/idea_plugin.html\n+project.tasks.ideaModule.dependsOn(swaggerCodegenTasks)\n+\n+// Java plugin's Generated Source Set gives us the compileGeneratedJava task.\n+// We need to provide it with the swagger-codegen tasks that excrete Java.\n+project.tasks.compileGeneratedJava.dependsOn(swaggerCodegenTasks)\n+\n+project.tasks.war.dependsOn(['compileGeneratedJava', 'generate_appengine_web_xml',\n+        'generate_appengine_cron_yaml'])\n+\n+// Clear out generated Java sorces before cleaning the project.\n clean.doFirst {\n   delete(\"${projectDir}/$swaggerTargetFolder\")\n }\n \n-repositories {   // repositories for Jar's you access in your code\n+repositories {\n   jcenter()\n }\n \n-ext {\n-  mapstructVersion = '1.3.1.Final'\n-}\n-\n+// TODO(jaycarlton): see if there's a way to subdivide this block for readability\n+// To show the dependency tree, try: ./project.rb gradle dependencies --configuration compile\n dependencies {\n+  annotationProcessor \"org.mapstruct:mapstruct-processor:$project.ext.MAPSTRUCT_VERSION\"\n \n-  // To show the dependency tree, try: ./project.rb gradle dependencies --configuration compile\n+  compile \"ch.qos.logback:logback-classic:1.2.3\"\n+  // Force these dependencies to safe versions, Zendesk client depends on this.", "originalCommit": "3a4f97d622cadc4c7bc73745b8059bfba183f362", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwOTgyMQ==", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r410509821", "bodyText": "I made three copies, but, yeah. I don't think it'll be missed.", "author": "jaycarlton", "createdAt": "2020-04-17T23:11:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4MTIwMg=="}], "type": "inlineReview"}, {"oid": "e7f403a6eade95bb9deed721be5f979f8456d044", "url": "https://github.com/all-of-us/workbench/commit/e7f403a6eade95bb9deed721be5f979f8456d044", "message": "cleaning things up so the highlighter doesn't attack me so much", "committedDate": "2020-04-18T19:28:36Z", "type": "commit"}, {"oid": "5f7fad28f8283e46547381868f4dd9bee8842804", "url": "https://github.com/all-of-us/workbench/commit/5f7fad28f8283e46547381868f4dd9bee8842804", "message": "a bit more consolidation", "committedDate": "2020-04-18T19:28:37Z", "type": "commit"}, {"oid": "49f49758e52d08bb5ce25b4df2367b852dfcdaa6", "url": "https://github.com/all-of-us/workbench/commit/49f49758e52d08bb5ce25b4df2367b852dfcdaa6", "message": "restore a couple things", "committedDate": "2020-04-18T19:28:37Z", "type": "commit"}, {"oid": "b9e7728cc52068a37f9960370d157d2c2f8ea328", "url": "https://github.com/all-of-us/workbench/commit/b9e7728cc52068a37f9960370d157d2c2f8ea328", "message": "rename source sets for clarity. more rearranging", "committedDate": "2020-04-18T19:28:37Z", "type": "commit"}, {"oid": "79c79fd7ba2e841ec1e796f477a768ceeec8da42", "url": "https://github.com/all-of-us/workbench/commit/79c79fd7ba2e841ec1e796f477a768ceeec8da42", "message": "more fixes", "committedDate": "2020-04-18T19:28:37Z", "type": "commit"}, {"oid": "59df98ca5447b339903d70ab69130086174956ab", "url": "https://github.com/all-of-us/workbench/commit/59df98ca5447b339903d70ab69130086174956ab", "message": "group & desc", "committedDate": "2020-04-18T19:28:37Z", "type": "commit"}, {"oid": "bea92b4b7e43c32b91a738a1af3a3e679d883dec", "url": "https://github.com/all-of-us/workbench/commit/bea92b4b7e43c32b91a738a1af3a3e679d883dec", "message": "comment & todo fixes", "committedDate": "2020-04-18T19:28:38Z", "type": "commit"}, {"oid": "c3dbcff59be229279f60a38f791666fe0dc309bc", "url": "https://github.com/all-of-us/workbench/commit/c3dbcff59be229279f60a38f791666fe0dc309bc", "message": "alphabetize and a rename", "committedDate": "2020-04-18T19:28:38Z", "type": "commit"}, {"oid": "9709237900f05f05cf0c659ef5a729ed42d557bf", "url": "https://github.com/all-of-us/workbench/commit/9709237900f05f05cf0c659ef5a729ed42d557bf", "message": "restore comments from pre-aphabetizization", "committedDate": "2020-04-18T19:28:38Z", "type": "commit"}, {"oid": "b2e82e53af5a140ad6a73e52bc71ebab0c4b83f5", "url": "https://github.com/all-of-us/workbench/commit/b2e82e53af5a140ad6a73e52bc71ebab0c4b83f5", "message": "kill duplicated value", "committedDate": "2020-04-18T19:28:38Z", "type": "commit"}, {"oid": "199473448dbaf672a5bd2ce7ef9a191cbd92552d", "url": "https://github.com/all-of-us/workbench/commit/199473448dbaf672a5bd2ce7ef9a191cbd92552d", "message": "update missed reference", "committedDate": "2020-04-18T19:28:39Z", "type": "commit"}, {"oid": "1f3b22eba494bbb56b23abc3de7e02c229d87b08", "url": "https://github.com/all-of-us/workbench/commit/1f3b22eba494bbb56b23abc3de7e02c229d87b08", "message": "restore comment", "committedDate": "2020-04-18T19:28:39Z", "type": "commit"}, {"oid": "3738ed4ee633f27c2744eee510ebdfab0865ee37", "url": "https://github.com/all-of-us/workbench/commit/3738ed4ee633f27c2744eee510ebdfab0865ee37", "message": "typo", "committedDate": "2020-04-18T19:28:39Z", "type": "commit"}, {"oid": "62ca52838dbf9599fb8dbeb0113cbd2a1d089d97", "url": "https://github.com/all-of-us/workbench/commit/62ca52838dbf9599fb8dbeb0113cbd2a1d089d97", "message": "restore name; this one didn't change", "committedDate": "2020-04-18T19:28:39Z", "type": "commit"}, {"oid": "bc2827a2e8795f7872b92d8c7a56d45b769f04f9", "url": "https://github.com/all-of-us/workbench/commit/bc2827a2e8795f7872b92d8c7a56d45b769f04f9", "message": "descriptions & cleanup", "committedDate": "2020-04-18T19:28:40Z", "type": "commit"}, {"oid": "d3f19e8d614af93a05e081da0350aa91c983f9c5", "url": "https://github.com/all-of-us/workbench/commit/d3f19e8d614af93a05e081da0350aa91c983f9c5", "message": "cleanup comments", "committedDate": "2020-04-18T19:28:40Z", "type": "commit"}, {"oid": "885c6445ae50aa1271d99df0a54c54945b6ce51d", "url": "https://github.com/all-of-us/workbench/commit/885c6445ae50aa1271d99df0a54c54945b6ce51d", "message": "temporarily remove application test", "committedDate": "2020-04-19T20:13:36Z", "type": "commit"}, {"oid": "885c6445ae50aa1271d99df0a54c54945b6ce51d", "url": "https://github.com/all-of-us/workbench/commit/885c6445ae50aa1271d99df0a54c54945b6ce51d", "message": "temporarily remove application test", "committedDate": "2020-04-19T20:13:36Z", "type": "forcePushed"}, {"oid": "b76258e50a2b7fee7aabc0e9605f2779a0b2d85d", "url": "https://github.com/all-of-us/workbench/commit/b76258e50a2b7fee7aabc0e9605f2779a0b2d85d", "message": "Merge branch 'master' into jaycarlton/cleanGradle", "committedDate": "2020-04-21T16:48:20Z", "type": "commit"}, {"oid": "5bfe2568ce49ac780a02446491cf438a815a6312", "url": "https://github.com/all-of-us/workbench/commit/5bfe2568ce49ac780a02446491cf438a815a6312", "message": "Revert \"temporarily remove application test\"\n\nThis reverts commit 885c6445ae50aa1271d99df0a54c54945b6ce51d.", "committedDate": "2020-04-21T16:48:46Z", "type": "commit"}, {"oid": "50a89681872c017de7b940cb4beba7c08a5fbdde", "url": "https://github.com/all-of-us/workbench/commit/50a89681872c017de7b940cb4beba7c08a5fbdde", "message": "add ticket", "committedDate": "2020-04-21T21:04:30Z", "type": "commit"}]}