{"pr_number": 3019, "pr_title": "[RW-4279][RW-4293][Risk=low] Add db fields for demographic survey", "pr_createdAt": "2020-01-21T19:50:30Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3019", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzEzNg==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369267136", "bodyText": "Nit: methods named \"toggle\" generally mean \"switch from one state to another every time I'm called\", while this method and the one below simply update a field to a given boolean value. A slightly clearer name may be \"updateDisability\" or \"setDisability\".", "author": "gjuggler", "createdAt": "2020-01-21T22:02:24Z", "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -111,16 +109,20 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n   }\n \n   toggleDisability(value) {", "originalCommit": "0de081c8df448fb18f444647303385f67cfa11e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYyMjQ3NA==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369622474", "bodyText": "I may actually just get rid of these and use the updateDemographicAttribute cause its really the exact same thing.", "author": "s-rubenstein", "createdAt": "2020-01-22T15:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzI5Nw==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369267297", "bodyText": "Typing nit: it's never too late to start incorporating some type-safety here, e.g. value --> value: Boolean", "author": "gjuggler", "createdAt": "2020-01-21T22:02:51Z", "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -111,16 +109,20 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n   }\n \n   toggleDisability(value) {", "originalCommit": "0de081c8df448fb18f444647303385f67cfa11e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYyMjU5NA==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369622594", "bodyText": "Will do, if I don't get rid of these methods.", "author": "s-rubenstein", "createdAt": "2020-01-22T15:19:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzQ4MA==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369267480", "bodyText": "What impact does this change have?", "author": "gjuggler", "createdAt": "2020-01-21T22:03:19Z", "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -138,70 +140,75 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       </ListPageHeader>\n \n       {/*Race section*/}\n-      <Section header='1. Race'>\n+      <Section header='Race'>\n         <div style={{display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap'}}>\n           {AccountCreationOptions.race.map((race) => {\n-            return this.createOptionCheckbox(race.label, 'race', race.value);\n+            return this.createOptionCheckbox(race.label, 'race', race.value, race.value.toString());", "originalCommit": "0de081c8df448fb18f444647303385f67cfa11e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYyMjkxMQ==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369622911", "bodyText": "It removes a console error message. If you don't provide keys to react within a map, it complains with red in the console.", "author": "s-rubenstein", "createdAt": "2020-01-22T15:20:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzQ4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2ODM1Mw==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369268353", "bodyText": "Nit: can you make the  fit on one line to be consistent with the \"no\" label? (If it got auto-wrapped, that's fine, but by eye it looks like it might fit.", "author": "gjuggler", "createdAt": "2020-01-21T22:05:25Z", "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -138,70 +140,75 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       </ListPageHeader>\n \n       {/*Race section*/}\n-      <Section header='1. Race'>\n+      <Section header='Race'>\n         <div style={{display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap'}}>\n           {AccountCreationOptions.race.map((race) => {\n-            return this.createOptionCheckbox(race.label, 'race', race.value);\n+            return this.createOptionCheckbox(race.label, 'race', race.value, race.value.toString());\n           })}\n         </div>\n       </Section>\n \n       {/*Ethnicity section*/}\n-      <DropDownSection header='2. Ethnicity' options={AccountCreationOptions.ethnicity}\n+      <DropDownSection header='Ethnicity' options={AccountCreationOptions.ethnicity}\n                        value={demographicSurvey.ethnicity}\n                        onChange={(e) => this.updateDemographicAttribute('ethnicity', e)}/>\n-\n-      {/*Gender section*/}\n-      <Section header='3. Gender'>\n-        <FlexRow style={{flexWrap: 'wrap'}}>\n-          {AccountCreationOptions.gender.map((gender) => {\n-            return this.createOptionCheckbox(gender.label, 'gender', gender.value);\n-          })}\n-        </FlexRow>\n+      <Section header='Do you identify as lesbian, gay, bisexual, transgender, queer (LGBTQ),\n+or another sexual and/or gender minority?'>\n+        <div style={{paddingTop: '0.5rem'}}>\n+          <RadioButton onChange={\n+            (e) => this.toggleIdentifiesAsLgbtq(true)}\n+                       checked={demographicSurvey.identifiesAsLgbtq}\n+                       style={{marginRight: '0.5rem'}}/>\n+          <label style={{paddingRight: '3rem', color: colors.primary}}>\n+            Yes", "originalCommit": "0de081c8df448fb18f444647303385f67cfa11e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYyMzAxMg==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369623012", "bodyText": "Probably! Let me try.", "author": "s-rubenstein", "createdAt": "2020-01-22T15:20:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2ODM1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3MTc0OQ==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369271749", "bodyText": "[Just thinking out loud] Have we encountered scenarios where users attempt to put more text into an input form than our database column width allows? Do we have clear DB design guidelines around choosing between the various text types or lengths for free-form text like this? I suspect 255 is probably enough here, I'm just curious if there is a broader pattern.\n(Based on a quick dig into our codebase, it seems we use varchar more often by far, with one instance of type=\"longtext\" and a few instances of type=\"text\" in the data dictionary schema. It's a clear pattern, but I'm not sure the motivation behind preferring varchar more often than not.)", "author": "gjuggler", "createdAt": "2020-01-21T22:13:48Z", "path": "api/db/changelog/db.changelog-118-update-demographics.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog\n+    xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n+                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n+  <changeSet author=\"srubenst\" id=\"db.changelog-116-update-demographics\">\n+    <addColumn tableName=\"user\">\n+      <column name=\"professional_url\" type=\"varchar(255)\">\n+        <constraints nullable=\"true\"/>\n+      </column>\n+    </addColumn>\n+    <addColumn tableName=\"demographic_survey\">\n+      <column name=\"identifies_as_lgbtq\" type=\"boolean\">\n+        <constraints nullable=\"true\"/>\n+      </column>\n+      <column name=\"lgbtq_identity\" type=\"varchar(255)\">", "originalCommit": "0de081c8df448fb18f444647303385f67cfa11e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYxMjc5Ng==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369612796", "bodyText": "We haven't. I can add some front-end validation on that though. I asked Lou and it sounded like we thought 255 char was probably enough for this. I've been mainly following the DB schema pattern we have established.", "author": "s-rubenstein", "createdAt": "2020-01-22T15:03:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3MTc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3NDE3Mg==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369274172", "bodyText": "It might be worth adding a comment here, and/or in the PR description, referencing https://precisionmedicineinitiative.atlassian.net/browse/RW-4312 (thanks for filing!). I also marked that ticket as blocked by RW-4293 for clarity.", "author": "gjuggler", "createdAt": "2020-01-21T22:19:38Z", "path": "api/db/changelog/db.changelog-118-update-demographics.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog\n+    xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n+                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n+  <changeSet author=\"srubenst\" id=\"db.changelog-116-update-demographics\">", "originalCommit": "0de081c8df448fb18f444647303385f67cfa11e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYxMjQzMA==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369612430", "bodyText": "Threw a comment in there!", "author": "s-rubenstein", "createdAt": "2020-01-22T15:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3NDE3Mg=="}], "type": "inlineReview"}, {"oid": "4b2d2c2ede9f96bb3b5dcbaca1f06720460ddc1c", "url": "https://github.com/all-of-us/workbench/commit/4b2d2c2ede9f96bb3b5dcbaca1f06720460ddc1c", "message": "Fix spotless", "committedDate": "2020-01-22T18:20:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgzMDAxMg==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369830012", "bodyText": "Is it an AC to not export this anymore?", "author": "als364", "createdAt": "2020-01-22T22:06:03Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -193,11 +193,6 @@ private RdrResearcher toRdrResearcher(DbUser dbUser) {\n             RdrExportEnums.sexAtBirthToRdrSexAtBirth(\n                 dbDemographicSurvey.getSexAtBirthEnum().get(0)));\n       }\n-      if (dbDemographicSurvey.getSexualOrientationEnum() != null) {", "originalCommit": "b9f1561b397ee201359d40a9fc6424bf5d42f83c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIxMDIzOQ==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r370210239", "bodyText": "We aren't capturing this data in enum field anymore. I think there's a conversation with the RDR team about importing the new fields that @NehaBroad was leading.", "author": "s-rubenstein", "createdAt": "2020-01-23T16:07:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgzMDAxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgzMDk1Mg==", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369830952", "bodyText": "Given that this is how we're wording it, I agree with Greg's earlier comment that this could be much larger than 255 characters. I'd bump it all the way up to 4000 because storage is cheap and a lot of the time it will be empty anyways.", "author": "als364", "createdAt": "2020-01-22T22:08:13Z", "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -138,70 +144,73 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       </ListPageHeader>\n \n       {/*Race section*/}\n-      <Section header='1. Race'>\n+      <Section header='Race'>\n         <div style={{display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap'}}>\n           {AccountCreationOptions.race.map((race) => {\n-            return this.createOptionCheckbox(race.label, 'race', race.value);\n+            return this.createOptionCheckbox(race.label, 'race', race.value, race.value.toString());\n           })}\n         </div>\n       </Section>\n \n       {/*Ethnicity section*/}\n-      <DropDownSection header='2. Ethnicity' options={AccountCreationOptions.ethnicity}\n+      <DropDownSection header='Ethnicity' options={AccountCreationOptions.ethnicity}\n                        value={demographicSurvey.ethnicity}\n                        onChange={(e) => this.updateDemographicAttribute('ethnicity', e)}/>\n-\n-      {/*Gender section*/}\n-      <Section header='3. Gender'>\n-        <FlexRow style={{flexWrap: 'wrap'}}>\n-          {AccountCreationOptions.gender.map((gender) => {\n-            return this.createOptionCheckbox(gender.label, 'gender', gender.value);\n-          })}\n-        </FlexRow>\n+      <Section header='Do you identify as lesbian, gay, bisexual, transgender, queer (LGBTQ),\n+or another sexual and/or gender minority?'>\n+        <div style={{paddingTop: '0.5rem'}}>\n+          <RadioButton onChange={\n+            (e) => this.updateDemographicAttribute('identifiesAsLgbtq', true)}\n+                       checked={demographicSurvey.identifiesAsLgbtq}\n+                       style={{marginRight: '0.5rem'}}/>\n+          <label style={{paddingRight: '3rem', color: colors.primary}}>\n+            Yes\n+          </label>\n+          <RadioButton onChange={(e) => this.updateDemographicAttribute('identifiesAsLgbtq', false)}\n+                       checked={!demographicSurvey.identifiesAsLgbtq}\n+                       style={{marginRight: '0.5rem'}}/>\n+          <label style={{color: colors.primary}}>No</label>\n+        </div>\n+        <label></label>\n+        <TextInputWithLabel labelText='If yes, please tell us about your LGBTQ+ identity'", "originalCommit": "b9f1561b397ee201359d40a9fc6424bf5d42f83c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f40c2710e14cd0a9f40b1b43031c1025bd255099", "url": "https://github.com/all-of-us/workbench/commit/f40c2710e14cd0a9f40b1b43031c1025bd255099", "message": "WIP New fields", "committedDate": "2020-01-23T16:36:17Z", "type": "commit"}, {"oid": "f0885ab9beedb8396980d5ab99cbe47df356179c", "url": "https://github.com/all-of-us/workbench/commit/f0885ab9beedb8396980d5ab99cbe47df356179c", "message": "Add professional url", "committedDate": "2020-01-23T16:36:17Z", "type": "commit"}, {"oid": "9b76327e5ed0e4dc41dc32b58e1c3d7da6885fad", "url": "https://github.com/all-of-us/workbench/commit/9b76327e5ed0e4dc41dc32b58e1c3d7da6885fad", "message": "Add added fields to display", "committedDate": "2020-01-23T16:36:17Z", "type": "commit"}, {"oid": "8da950c0918989b5cacfad6e694c0568ecbf9992", "url": "https://github.com/all-of-us/workbench/commit/8da950c0918989b5cacfad6e694c0568ecbf9992", "message": "fix tests", "committedDate": "2020-01-23T16:36:17Z", "type": "commit"}, {"oid": "3ba4f6ccdf0db5302f776da2ccebb51597c98e3e", "url": "https://github.com/all-of-us/workbench/commit/3ba4f6ccdf0db5302f776da2ccebb51597c98e3e", "message": "fix linting", "committedDate": "2020-01-23T16:36:17Z", "type": "commit"}, {"oid": "ac2c969da6de287b5122419d525495b9a307f45e", "url": "https://github.com/all-of-us/workbench/commit/ac2c969da6de287b5122419d525495b9a307f45e", "message": "Remove drop table for now", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "dd4f17e80bde8202c3bdcc1c14d6bc27c55d4f4a", "url": "https://github.com/all-of-us/workbench/commit/dd4f17e80bde8202c3bdcc1c14d6bc27c55d4f4a", "message": "Fix tests", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "29bb723947fca9c0bcfd2a7d0d2eba3ac4e4f17d", "url": "https://github.com/all-of-us/workbench/commit/29bb723947fca9c0bcfd2a7d0d2eba3ac4e4f17d", "message": "Add front-end validation", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "c214ec6d94301f6b24f417af37e8ea466d5b91a1", "url": "https://github.com/all-of-us/workbench/commit/c214ec6d94301f6b24f417af37e8ea466d5b91a1", "message": "Fix spotless", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "b779a0ae4b8fbdc5c5ea03a06f8fc30b9d4f1abe", "url": "https://github.com/all-of-us/workbench/commit/b779a0ae4b8fbdc5c5ea03a06f8fc30b9d4f1abe", "message": "remove extra functions", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "cee4c28612f797c9a748c5055f9492a35f91749e", "url": "https://github.com/all-of-us/workbench/commit/cee4c28612f797c9a748c5055f9492a35f91749e", "message": "More pr feedback", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "e7ab8dd19d50fa188d3a473d124f4fb60b665443", "url": "https://github.com/all-of-us/workbench/commit/e7ab8dd19d50fa188d3a473d124f4fb60b665443", "message": "Move to 'text'", "committedDate": "2020-01-23T16:36:42Z", "type": "commit"}, {"oid": "e7ab8dd19d50fa188d3a473d124f4fb60b665443", "url": "https://github.com/all-of-us/workbench/commit/e7ab8dd19d50fa188d3a473d124f4fb60b665443", "message": "Move to 'text'", "committedDate": "2020-01-23T16:36:42Z", "type": "forcePushed"}]}