{"pr_number": 4075, "pr_title": "[RW-5558][risk=no] Make footer for Attributes & Modifiers sidebar sticky", "pr_createdAt": "2020-09-28T15:24:51Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4075", "timeline": [{"oid": "94685ec5ce4e3324c59d1ceb0f5aca1dcc2ea259", "url": "https://github.com/all-of-us/workbench/commit/94685ec5ce4e3324c59d1ceb0f5aca1dcc2ea259", "message": "RW-5558 make attributes footer sticky", "committedDate": "2020-09-28T15:17:34Z", "type": "commit"}, {"oid": "e62f659cf42ab3aaf4904c92e78231187c07c112", "url": "https://github.com/all-of-us/workbench/commit/e62f659cf42ab3aaf4904c92e78231187c07c112", "message": "RW-5558 adjust sticky footer for modifiers", "committedDate": "2020-09-28T15:17:34Z", "type": "commit"}, {"oid": "9d0fb8364c3211e983b9ce59e34d772938f1619e", "url": "https://github.com/all-of-us/workbench/commit/9d0fb8364c3211e983b9ce59e34d772938f1619e", "message": "RW-5558 lint errors", "committedDate": "2020-09-28T16:10:25Z", "type": "commit"}, {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00", "url": "https://github.com/all-of-us/workbench/commit/c4882f48af3a80e1dbb022679870ba17f0958a00", "message": "RW-5558 fix modifiers calculate fn", "committedDate": "2020-09-28T19:02:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MDU4Mw==", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496350583", "bodyText": "nit: can you move the prop out. It will be easier to read", "author": "NehaBroad", "createdAt": "2020-09-29T03:03:22Z", "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {", "originalCommit": "c4882f48af3a80e1dbb022679870ba17f0958a00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMTcwNw==", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496401707", "bodyText": "Done.", "author": "dolbeew", "createdAt": "2020-09-29T04:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MDU4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1NDE0NQ==", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496354145", "bodyText": "nit: can we re-write style condition as disableCalculate ? {....styles.calculateButton, borderColor: colorWithWhiteness(colors.dark, 0.6)} : styles.calculatebutton", "author": "NehaBroad", "createdAt": "2020-09-29T03:17:56Z", "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {\n+  return <div style={{background: colorWithWhiteness(colors.primary, .87), bottom: 0, position: 'sticky'}}>\n+    <FlexRowWrap style={styles.countPreview}>\n+      <div style={styles.resultsContainer}>\n+        <Button id='attributes-calculate'\n+          type='secondaryLight'\n+          disabled={disableCalculate}\n+          style={{...styles.calculateButton, ...(disableCalculate ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}", "originalCommit": "c4882f48af3a80e1dbb022679870ba17f0958a00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMTgwMA==", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496401800", "bodyText": "Done.", "author": "dolbeew", "createdAt": "2020-09-29T04:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1NDE0NQ=="}], "type": "inlineReview"}, {"oid": "6e467a412e476c33bf726209ae81456cae80170c", "url": "https://github.com/all-of-us/workbench/commit/6e467a412e476c33bf726209ae81456cae80170c", "message": "RW-5558 pr feedback", "committedDate": "2020-09-29T05:02:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwNjI3OQ==", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496406279", "bodyText": "Moved this to a separate function since I noticed the calculate function was not using the current values in the form, usually resulting in an empty array getting sent with the request.", "author": "dolbeew", "createdAt": "2020-09-29T05:05:49Z", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -349,10 +346,8 @@ export const ModifierPage = fp.flow(withCurrentWorkspace(), withCurrentCohortSea\n       this.setState({count: null, formState}, () => this.validateValues());\n     }\n \n-    updateMods() {\n-      const {cohortContext} = this.props;\n-      const {formState} = this.state;\n-      cohortContext.item.modifiers = formState.reduce((acc, mod) => {\n+    getModifiersFromForm() {", "originalCommit": "6e467a412e476c33bf726209ae81456cae80170c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwNzM2MQ==", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496407361", "bodyText": "Also update the filter condition here, since 0 values in the number inputs were getting filtered out, resulting in a bad request for the calculate api call.", "author": "dolbeew", "createdAt": "2020-09-29T05:07:25Z", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -361,15 +356,20 @@ export const ModifierPage = fp.flow(withCurrentWorkspace(), withCurrentCohortSea\n               break;\n             case ModifierType.EVENTDATE:\n               const formatted = values.map(val => moment(val, 'YYYY-MM-DD', true).isValid()\n-                    ? moment(val).format('YYYY-MM-DD') : undefined);\n+                ? moment(val).format('YYYY-MM-DD') : undefined);\n               acc.push({name, operator, operands: formatted.filter(val => !!val)});\n               break;\n             default:\n-              acc.push({name, operator, operands: values.filter(val => !!val)});\n+              acc.push({name, operator, operands: values.filter(val => !['', null, undefined].includes(val))});", "originalCommit": "6e467a412e476c33bf726209ae81456cae80170c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d403fb4e76f8cdd65d8b88109481fb13279b8566", "url": "https://github.com/all-of-us/workbench/commit/d403fb4e76f8cdd65d8b88109481fb13279b8566", "message": "RW-5558 prevent attributes and modifiers in the same sidebar", "committedDate": "2020-09-29T15:47:30Z", "type": "commit"}]}