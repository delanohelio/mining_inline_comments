{"pr_number": 3546, "pr_title": "[RW-4878][risk=no] Convert criteria selection list to React", "pr_createdAt": "2020-05-06T15:40:45Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3546", "timeline": [{"oid": "85ffb0181143f5d6bed337fa4c0d51d65e0ee9ca", "url": "https://github.com/all-of-us/workbench/commit/85ffb0181143f5d6bed337fa4c0d51d65e0ee9ca", "message": "RW-4878 initial react conversion", "committedDate": "2020-05-05T21:12:57Z", "type": "commit"}, {"oid": "5a9d3c48934e489f97fbdae073080c8f5758dde8", "url": "https://github.com/all-of-us/workbench/commit/5a9d3c48934e489f97fbdae073080c8f5758dde8", "message": "RW-4878 add styles and tooltips to selection items", "committedDate": "2020-05-05T21:12:57Z", "type": "commit"}, {"oid": "3252b70cd0802fe783fb8d73158d23c12c0482e0", "url": "https://github.com/all-of-us/workbench/commit/3252b70cd0802fe783fb8d73158d23c12c0482e0", "message": "RW-4878 disable finish button for no selections/errors", "committedDate": "2020-05-05T21:12:57Z", "type": "commit"}, {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11", "url": "https://github.com/all-of-us/workbench/commit/b91207bb281db2e3fde0aa276728123cdcc8ec11", "message": "RW-4878 remove angular files, add render test", "committedDate": "2020-05-05T21:12:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NzAxOQ==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420947019", "bodyText": "I'd prefer for this to be named consistently - if the only thing this function does is close the list then name it close throughout.", "author": "als364", "createdAt": "2020-05-06T17:00:07Z", "path": "ui/src/app/cohort-search/modal/modal.component.html", "diffHunk": "@@ -129,43 +128,16 @@\n \n         <div *ngIf=\"wizard.type !== criteriaType.AGE\" class=\"col padding-zero\" [ngClass]=\"sidebarClass\">\n           <div class=\"content right\" *ngIf=\"open\">\n-            <div class=\"panel-right-container\">\n-              <h5 class=\"selection-title\">Selected Criteria</h5>\n-              <div class=\"panel-right selected\">\n-                <crit-list-selection-info\n-                  *ngFor=\"let parameter of selections; let p = index\"\n-                  [index]=\"p\"\n-                  [parameter]=\"parameter\"\n-                  [remove]=\"removeSelection\">\n-                </crit-list-selection-info>\n-              </div>\n-              <div class=\"footer\">\n-                <button type=\"button\"\n-                  (click)=\"close()\"\n-                  class=\"btn btn-link\">\n-                  Cancel\n-                </button>\n-                <button  *ngIf=\"showNext\"\n-                  type=\"button\"\n-                  [disabled]=\"selections.length === 0\"\n-                  (click)=\"mode = 'modifiers'\"\n-                  class=\"btn btn-primary\">\n-                  Next\n-                </button>\n-                <button *ngIf=\"showBack\"\n-                  type=\"button\"\n-                  (click)=\"back()\"\n-                  class=\"btn btn-primary\">\n-                  Back\n-                </button>\n-                <button type=\"button\"\n-                  [disabled]=\"disableFlag\"\n-                  (click)=\"finish()\"\n-                  class=\"btn btn-primary\">\n-                  Finish\n-                </button>\n-              </div>\n-            </div>\n+            <crit-selection-list\n+              [back]=\"back\"\n+              [cancel]=\"close\"", "originalCommit": "b91207bb281db2e3fde0aa276728123cdcc8ec11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU2OTA4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r421569087", "bodyText": "Makes sense, changed to close", "author": "dolbeew", "createdAt": "2020-05-07T14:53:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NzAxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0Nzc1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420947756", "bodyText": "Same with this - why is it named differently in different files?", "author": "als364", "createdAt": "2020-05-06T17:01:16Z", "path": "ui/src/app/cohort-search/modal/modal.component.html", "diffHunk": "@@ -129,43 +128,16 @@\n \n         <div *ngIf=\"wizard.type !== criteriaType.AGE\" class=\"col padding-zero\" [ngClass]=\"sidebarClass\">\n           <div class=\"content right\" *ngIf=\"open\">\n-            <div class=\"panel-right-container\">\n-              <h5 class=\"selection-title\">Selected Criteria</h5>\n-              <div class=\"panel-right selected\">\n-                <crit-list-selection-info\n-                  *ngFor=\"let parameter of selections; let p = index\"\n-                  [index]=\"p\"\n-                  [parameter]=\"parameter\"\n-                  [remove]=\"removeSelection\">\n-                </crit-list-selection-info>\n-              </div>\n-              <div class=\"footer\">\n-                <button type=\"button\"\n-                  (click)=\"close()\"\n-                  class=\"btn btn-link\">\n-                  Cancel\n-                </button>\n-                <button  *ngIf=\"showNext\"\n-                  type=\"button\"\n-                  [disabled]=\"selections.length === 0\"\n-                  (click)=\"mode = 'modifiers'\"\n-                  class=\"btn btn-primary\">\n-                  Next\n-                </button>\n-                <button *ngIf=\"showBack\"\n-                  type=\"button\"\n-                  (click)=\"back()\"\n-                  class=\"btn btn-primary\">\n-                  Back\n-                </button>\n-                <button type=\"button\"\n-                  [disabled]=\"disableFlag\"\n-                  (click)=\"finish()\"\n-                  class=\"btn btn-primary\">\n-                  Finish\n-                </button>\n-              </div>\n-            </div>\n+            <crit-selection-list\n+              [back]=\"back\"\n+              [cancel]=\"close\"\n+              [disableFinish]=\"modifiersDisabled\"", "originalCommit": "b91207bb281db2e3fde0aa276728123cdcc8ec11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU3NTUzOA==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r421575538", "bodyText": "Changed to modifiersDisabled.  I renamed it when I separated the list into the new component and didn't rename in the parent (parent is next to be converted to React, so would've been cleaned up then).", "author": "dolbeew", "createdAt": "2020-05-07T15:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0Nzc1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1MzQ3Ng==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420953476", "bodyText": "Consider using the Button component in buttons.tsx", "author": "als364", "createdAt": "2020-05-06T17:10:27Z", "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -0,0 +1,232 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {attributeDisplay, nameDisplay, typeDisplay} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {Criteria, DomainType} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  buttonContainer: {\n+    display: 'flex',\n+    justifyContent: 'flex-end',\n+    marginTop: '0.5rem',\n+    padding: '0.45rem 0rem'\n+  },\n+  button: {\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  disabled: {\n+    opacity: 0.4,\n+    pointerEvents: 'none'\n+  },\n+  itemInfo: {\n+    width: '100%',\n+    minWidth: 0,\n+    flex: 1,\n+    display: 'flex',\n+    flexFlow: 'row nowrap',\n+    justifyContent: 'flex-start'\n+  },\n+  itemName: {\n+    flex: 1,\n+    overflow: 'hidden',\n+    textOverflow: 'ellipsis',\n+    whiteSpace: 'nowrap'\n+  },\n+  removeSelection: {\n+    background: 'none',\n+    border: 0,\n+    color: colors.danger,\n+    cursor: 'pointer',\n+    marginRight: '0.25rem',\n+    padding: 0\n+  },\n+  selectionContainer: {\n+    background: colors.white,\n+    border: `2px solid ${colors.primary}`,\n+    borderRadius: '5px',\n+    height: 'calc(100% - 150px)',\n+    overflowX: 'hidden',\n+    overflowY: 'auto',\n+    width: '95%',\n+  },\n+  selectionItem: {\n+    display: 'flex',\n+    fontSize: '14px',\n+    padding: '0.2rem 0.5rem 0',\n+    width: '100%',\n+  },\n+  selectionPanel: {\n+    background: colorWithWhiteness(colors.black, 0.95),\n+    height: '100%',\n+    padding: '0.5rem 0 0 1rem',\n+  },\n+  selectionTitle: {\n+    color: colors.primary,\n+    margin: 0,\n+    padding: '0.5rem 0'\n+  }\n+});\n+\n+interface Selection extends Criteria {\n+  parameterId: string;\n+}\n+\n+interface SelectionInfoProps {\n+  index: number;\n+  selection: Selection;\n+  removeSelection: Function;\n+}\n+\n+interface SelectionInfoState {\n+  truncated: boolean;\n+}\n+\n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <div style={styles.selectionItem}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>\n+        <ClrIcon shape='times-circle'/>\n+      </button>\n+      <div style={styles.itemInfo}>\n+        {this.showOr && <strong>OR&nbsp;</strong>}\n+        {!!selection.group && <span>Group&nbsp;</span>}\n+        <TooltipTrigger disabled={!this.state.truncated} content={itemName}>\n+          <div style={styles.itemName} ref={(e) => this.name = e}>\n+            {itemName}\n+          </div>\n+        </TooltipTrigger>\n+      </div>\n+    </div>;\n+  }\n+}\n+\n+interface Props {\n+  back: Function;\n+  cancel: Function;\n+  disableFinish: boolean;\n+  domain: DomainType;\n+  finish: Function;\n+  removeSelection: Function;\n+  selections: Array<Selection>;\n+  setView: Function;\n+  view: string;\n+}\n+\n+export class SelectionList extends React.Component<Props> {\n+  constructor(props: Props) {\n+    super(props);\n+  }\n+\n+  get showModifiers() {\n+    return ![DomainType.PHYSICALMEASUREMENT, DomainType.PERSON, DomainType.SURVEY].includes(this.props.domain);\n+  }\n+\n+  get showNext() {\n+    return this.showModifiers && this.props.view !== 'modifiers';\n+  }\n+\n+  get showBack() {\n+    return this.showModifiers && this.props.view === 'modifiers';\n+  }\n+\n+  render() {\n+    const {back, cancel, disableFinish, finish, removeSelection, selections, setView} = this.props;\n+    return <div style={styles.selectionPanel}>\n+      <h5 style={styles.selectionTitle}>Selected Criteria</h5>\n+      <div style={styles.selectionContainer}>\n+        {selections.map((selection, s) =>\n+          <SelectionInfo key={s}\n+            index={s}\n+            selection={selection}\n+            removeSelection={() => removeSelection(selection)}/>\n+        )}\n+      </div>\n+      <div style={styles.buttonContainer}>\n+        <button style={{...styles.button, background: 'transparent', color: colors.dark, fontSize: '14px'}}", "originalCommit": "b91207bb281db2e3fde0aa276728123cdcc8ec11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU3NzcxMg==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r421577712", "bodyText": "Good idea, switch all 4 buttons here to use Button", "author": "dolbeew", "createdAt": "2020-05-07T15:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1MzQ3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1OTA5Ng==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420959096", "bodyText": "You get most of these styles for free with the Button component.", "author": "als364", "createdAt": "2020-05-06T17:19:01Z", "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -0,0 +1,232 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {attributeDisplay, nameDisplay, typeDisplay} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {Criteria, DomainType} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  buttonContainer: {\n+    display: 'flex',\n+    justifyContent: 'flex-end',\n+    marginTop: '0.5rem',\n+    padding: '0.45rem 0rem'\n+  },\n+  button: {\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  disabled: {\n+    opacity: 0.4,\n+    pointerEvents: 'none'\n+  },\n+  itemInfo: {\n+    width: '100%',\n+    minWidth: 0,\n+    flex: 1,\n+    display: 'flex',\n+    flexFlow: 'row nowrap',\n+    justifyContent: 'flex-start'\n+  },\n+  itemName: {\n+    flex: 1,\n+    overflow: 'hidden',\n+    textOverflow: 'ellipsis',\n+    whiteSpace: 'nowrap'\n+  },\n+  removeSelection: {\n+    background: 'none',\n+    border: 0,\n+    color: colors.danger,\n+    cursor: 'pointer',\n+    marginRight: '0.25rem',\n+    padding: 0\n+  },\n+  selectionContainer: {\n+    background: colors.white,\n+    border: `2px solid ${colors.primary}`,\n+    borderRadius: '5px',\n+    height: 'calc(100% - 150px)',\n+    overflowX: 'hidden',\n+    overflowY: 'auto',\n+    width: '95%',\n+  },\n+  selectionItem: {\n+    display: 'flex',\n+    fontSize: '14px',\n+    padding: '0.2rem 0.5rem 0',\n+    width: '100%',\n+  },\n+  selectionPanel: {\n+    background: colorWithWhiteness(colors.black, 0.95),\n+    height: '100%',\n+    padding: '0.5rem 0 0 1rem',\n+  },\n+  selectionTitle: {\n+    color: colors.primary,\n+    margin: 0,\n+    padding: '0.5rem 0'\n+  }\n+});\n+\n+interface Selection extends Criteria {\n+  parameterId: string;\n+}\n+\n+interface SelectionInfoProps {\n+  index: number;\n+  selection: Selection;\n+  removeSelection: Function;\n+}\n+\n+interface SelectionInfoState {\n+  truncated: boolean;\n+}\n+\n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <div style={styles.selectionItem}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>\n+        <ClrIcon shape='times-circle'/>\n+      </button>\n+      <div style={styles.itemInfo}>\n+        {this.showOr && <strong>OR&nbsp;</strong>}\n+        {!!selection.group && <span>Group&nbsp;</span>}\n+        <TooltipTrigger disabled={!this.state.truncated} content={itemName}>\n+          <div style={styles.itemName} ref={(e) => this.name = e}>\n+            {itemName}\n+          </div>\n+        </TooltipTrigger>\n+      </div>\n+    </div>;\n+  }\n+}\n+\n+interface Props {\n+  back: Function;\n+  cancel: Function;\n+  disableFinish: boolean;\n+  domain: DomainType;\n+  finish: Function;\n+  removeSelection: Function;\n+  selections: Array<Selection>;\n+  setView: Function;\n+  view: string;\n+}\n+\n+export class SelectionList extends React.Component<Props> {\n+  constructor(props: Props) {\n+    super(props);\n+  }\n+\n+  get showModifiers() {\n+    return ![DomainType.PHYSICALMEASUREMENT, DomainType.PERSON, DomainType.SURVEY].includes(this.props.domain);\n+  }\n+\n+  get showNext() {\n+    return this.showModifiers && this.props.view !== 'modifiers';\n+  }\n+\n+  get showBack() {\n+    return this.showModifiers && this.props.view === 'modifiers';\n+  }\n+\n+  render() {\n+    const {back, cancel, disableFinish, finish, removeSelection, selections, setView} = this.props;\n+    return <div style={styles.selectionPanel}>\n+      <h5 style={styles.selectionTitle}>Selected Criteria</h5>\n+      <div style={styles.selectionContainer}>\n+        {selections.map((selection, s) =>\n+          <SelectionInfo key={s}\n+            index={s}\n+            selection={selection}\n+            removeSelection={() => removeSelection(selection)}/>\n+        )}\n+      </div>\n+      <div style={styles.buttonContainer}>\n+        <button style={{...styles.button, background: 'transparent', color: colors.dark, fontSize: '14px'}}\n+          onClick={() => cancel()}>\n+          Cancel\n+        </button>\n+        {this.showNext && <button onClick={() => setView('modifiers')}\n+          style={{\n+            ...styles.button,\n+            ...(selections.length === 0 ? styles.disabled : {}),\n+            background: colors.primary, color: colors.white}}>\n+          Next\n+        </button>}\n+        {this.showBack && <button style={{...styles.button, background: colors.primary, color: colors.white}}", "originalCommit": "b91207bb281db2e3fde0aa276728123cdcc8ec11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU3NzgzNw==", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r421577837", "bodyText": "Switched.", "author": "dolbeew", "createdAt": "2020-05-07T15:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1OTA5Ng=="}], "type": "inlineReview"}, {"oid": "6055ca4aabe2e890d9a8ebe6cb8a9ee75bb56e80", "url": "https://github.com/all-of-us/workbench/commit/6055ca4aabe2e890d9a8ebe6cb8a9ee75bb56e80", "message": "RW-4878 address pr feedback", "committedDate": "2020-05-07T15:07:55Z", "type": "commit"}, {"oid": "5b4856540aca6580b7dec95cb378283564f36802", "url": "https://github.com/all-of-us/workbench/commit/5b4856540aca6580b7dec95cb378283564f36802", "message": "RW-4878 fix test", "committedDate": "2020-05-07T15:21:03Z", "type": "commit"}]}