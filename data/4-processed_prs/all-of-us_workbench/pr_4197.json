{"pr_number": 4197, "pr_title": "[RW-5041][risk=no] Update IngestSyntheticVcfWdl to variantstore changes", "pr_createdAt": "2020-10-21T21:11:52Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4197", "timeline": [{"oid": "ecb9e10e1b4ce8fc3a3adbe99383a9f8e3a0ff85", "url": "https://github.com/all-of-us/workbench/commit/ecb9e10e1b4ce8fc3a3adbe99383a9f8e3a0ff85", "message": "update WDL for variantstore updates", "committedDate": "2020-10-06T19:32:53Z", "type": "commit"}, {"oid": "5c251515d82d0bc5269081ed4389a0ea94e83aff", "url": "https://github.com/all-of-us/workbench/commit/5c251515d82d0bc5269081ed4389a0ea94e83aff", "message": "Merge branch 'master' of github.com:all-of-us/workbench into songe/RW-5041", "committedDate": "2020-10-21T21:05:30Z", "type": "commit"}, {"oid": "6f1a6bb63e6951b42115ca52898855d2ed5bddec", "url": "https://github.com/all-of-us/workbench/commit/6f1a6bb63e6951b42115ca52898855d2ed5bddec", "message": "update wdl w the actual run's WDL", "committedDate": "2020-10-21T21:08:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3OTM1Mw==", "url": "https://github.com/all-of-us/workbench/pull/4197#discussion_r511079353", "bodyText": "This seems potentially flaky. What was wrong with the previous code?", "author": "als364", "createdAt": "2020-10-23T18:45:41Z", "path": "api/genomics/wdl/IngestSyntheticVcfWf.wdl", "diffHunk": "@@ -236,19 +187,21 @@ task CreateImportTsvs {\n         --probe-info-file ~{probe_info_file} \\\n         --ref-version 37\n \n-      mv *.tsv output_tsvs\n+      for i in 1 2 3;", "originalCommit": "6f1a6bb63e6951b42115ca52898855d2ed5bddec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4MDc2Nw==", "url": "https://github.com/all-of-us/workbench/pull/4197#discussion_r511080767", "bodyText": "gsutil cp would sometimes fail and kill the task. This adds a 3x retry loop.", "author": "ericsong", "createdAt": "2020-10-23T18:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3OTM1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4MTc3Mw==", "url": "https://github.com/all-of-us/workbench/pull/4197#discussion_r511081773", "bodyText": "does gsutil -m cp help that at all? I'd prefer that be tried first rather than a retry loop", "author": "als364", "createdAt": "2020-10-23T18:50:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3OTM1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTExMDE5Ng==", "url": "https://github.com/all-of-us/workbench/pull/4197#discussion_r511110196", "bodyText": "Hmm, I feel like it wouldn't since the error I got was a service unavailable response (503) from Google. The general consensus for resolution was to just try again after you get that response since 503s are typically intermittent.\nThat said, I can add the -m flag to this command since it wouldn't hurt.\nUnfortunately, I can't really test it since it fails so rarely that I need to run a large job to reliably trigger the failure mode and that would cost a pretty penny.", "author": "ericsong", "createdAt": "2020-10-23T19:32:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3OTM1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEyMjk1MA==", "url": "https://github.com/all-of-us/workbench/pull/4197#discussion_r511122950", "bodyText": "gotcha.\nis outdir a dir or a bucket?\nI was thinking maybe it would be cleaner to put this into another wdl step, which could then be rerun if need be, but it would probably be too much bitpushing to delocalize and localize just to take advantage of wdl retries", "author": "als364", "createdAt": "2020-10-23T19:50:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3OTM1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ0NjUwMA==", "url": "https://github.com/all-of-us/workbench/pull/4197#discussion_r524446500", "bodyText": "Sorry for the late reply. outdir is typically a GCS bucket but I think it can support directories since Cromwell will sort that out for you automatically.\nI agree about the overhead with pulling it out into another WDL step. It would be nice to utilize Cromwell's built in retries but there's some time/$ costs associated with pushing the files around.", "author": "ericsong", "createdAt": "2020-11-16T17:29:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3OTM1Mw=="}], "type": "inlineReview"}, {"oid": "848c5e07d1078d7b2bc9874fdd67fd3c3318aa78", "url": "https://github.com/all-of-us/workbench/commit/848c5e07d1078d7b2bc9874fdd67fd3c3318aa78", "message": "Update IngestSyntheticVcfWf.wdl", "committedDate": "2020-10-23T19:33:07Z", "type": "commit"}]}