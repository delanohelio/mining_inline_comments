{"pr_number": 3432, "pr_title": "[RW-4784][risk=no] Puppeteer project reorganizing dir structures", "pr_createdAt": "2020-04-17T19:44:49Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3432", "timeline": [{"oid": "ce3c1ba2d9634705160e8e978f36fddd99541d53", "url": "https://github.com/all-of-us/workbench/commit/ce3c1ba2d9634705160e8e978f36fddd99541d53", "message": "reorg dir\n\ncircieci: increase no output timeout\n\nundo change in circleci\n\nsaving", "committedDate": "2020-04-18T16:11:05Z", "type": "forcePushed"}, {"oid": "1556c555465a4fbede5d9bc89c31a108a67f7021", "url": "https://github.com/all-of-us/workbench/commit/1556c555465a4fbede5d9bc89c31a108a67f7021", "message": "reorg dir\n\ncircieci: increase no output timeout\n\nundo change in circleci\n\nsaving\n\nsave-file-utils.ts", "committedDate": "2020-04-18T16:53:54Z", "type": "forcePushed"}, {"oid": "6a40e9b556964cace02e80fe3ab9d4901d6f989e", "url": "https://github.com/all-of-us/workbench/commit/6a40e9b556964cace02e80fe3ab9d4901d6f989e", "message": "rebase", "committedDate": "2020-04-18T16:58:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4NTA5NQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r412185095", "bodyText": "nice", "author": "jmthibault79", "createdAt": "2020-04-21T13:29:34Z", "path": "e2e/app/page/workspaces-page.ts", "diffHunk": "@@ -119,7 +120,7 @@ export default class WorkspacesPage extends WorkspaceEditPage {\n    * @return {string} new workspace name\n    */\n   async fillOutWorkspaceName(): Promise<string> {\n-    const newWorkspaceName = `aoutest-${Math.floor(Math.random() * 1000)}-${Math.floor(Date.now() / 1000)}`;\n+    const newWorkspaceName = makeWorkspaceName();", "originalCommit": "6a40e9b556964cace02e80fe3ab9d4901d6f989e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0MTg4MQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r412241881", "bodyText": "should this also move to utils?", "author": "jmthibault79", "createdAt": "2020-04-21T14:36:43Z", "path": "e2e/tests/app.ts", "diffHunk": "@@ -1,5 +1,5 @@\n import {Page} from 'puppeteer';\n-import GoogleLoginPage from 'app/google-login';\n+import GoogleLoginPage from 'app/page/google-login';\n \n \n export const signIn = async (page: Page) => {", "originalCommit": "6a40e9b556964cace02e80fe3ab9d4901d6f989e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2ODAxMQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413468011", "bodyText": "not sure where to put it. for now, it is utils/app-utils.ts.", "author": "aweng98", "createdAt": "2020-04-23T02:45:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0MTg4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0NDIzMw==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413844233", "bodyText": "sounds good to me!", "author": "jmthibault79", "createdAt": "2020-04-23T14:28:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0MTg4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0NzYzOA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r412247638", "bodyText": "WorkspaceCard extends BaseElement.  Is it a Component or an Element?", "author": "jmthibault79", "createdAt": "2020-04-21T14:43:26Z", "path": "e2e/app/component/workspace-card.ts", "diffHunk": "@@ -1,7 +1,7 @@\n import {ElementHandle, Page} from 'puppeteer';\n import {WorkspaceAccessLevel} from 'app/page-identifiers';\n-import BaseElement from 'app/aou-elements/base-element';", "originalCommit": "6a40e9b556964cace02e80fe3ab9d4901d6f989e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2Mjg0NA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413462844", "bodyText": "\ud83d\udc4d  It should be a Component. I refactored code.", "author": "aweng98", "createdAt": "2020-04-23T02:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0NzYzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0NTUzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413845531", "bodyText": "ok!", "author": "jmthibault79", "createdAt": "2020-04-23T14:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0NzYzOA=="}], "type": "inlineReview"}, {"oid": "62ec482e63129d5bd2bfaf0bd0e9a94f685aef89", "url": "https://github.com/all-of-us/workbench/commit/62ec482e63129d5bd2bfaf0bd0e9a94f685aef89", "message": "refactor and cleanup code", "committedDate": "2020-04-23T02:25:54Z", "type": "forcePushed"}, {"oid": "6a21b28813f18b7265b18b477b6f39ca76e59cae", "url": "https://github.com/all-of-us/workbench/commit/6a21b28813f18b7265b18b477b6f39ca76e59cae", "message": "refactor and cleanup code", "committedDate": "2020-04-23T02:26:57Z", "type": "commit"}, {"oid": "05f6ae3dade2df6ecef4240d3558aabe3c840a1d", "url": "https://github.com/all-of-us/workbench/commit/05f6ae3dade2df6ecef4240d3558aabe3c840a1d", "message": "pr feedback", "committedDate": "2020-04-23T03:47:34Z", "type": "commit"}, {"oid": "05f6ae3dade2df6ecef4240d3558aabe3c840a1d", "url": "https://github.com/all-of-us/workbench/commit/05f6ae3dade2df6ecef4240d3558aabe3c840a1d", "message": "pr feedback", "committedDate": "2020-04-23T03:47:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ4Nzk4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413487987", "bodyText": "@calbach FYI, I got the textarea paste function to work finally.", "author": "aweng98", "createdAt": "2020-04-23T03:49:25Z", "path": "e2e/app/element/base-element.ts", "diffHunk": "@@ -257,4 +257,29 @@ export default class BaseElement {\n     return this.page.evaluate( elem => elem.click(), this.element );\n   }\n \n+  /**\n+   * @param {!<string} key\n+   * @param (string|number) value\n+   * @return {!Promise}\n+   */\n+  async setAttribute(key: string, value: string) {\n+    return await this.element.evaluate((element, k, v) => {\n+      element.setAttribute(k, v);\n+    }, key, value);\n+  }\n+\n+  /**\n+   * Paste texts instead type one char at a time.\n+   * @param text\n+   */\n+  async paste(text: string) {", "originalCommit": "05f6ae3dade2df6ecef4240d3558aabe3c840a1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f7d35a63193dfa4b6bcc6fa2443eed7d57f4e8e0", "url": "https://github.com/all-of-us/workbench/commit/f7d35a63193dfa4b6bcc6fa2443eed7d57f4e8e0", "message": "PR feedback", "committedDate": "2020-04-23T14:25:39Z", "type": "commit"}, {"oid": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "url": "https://github.com/all-of-us/workbench/commit/f3e5711cc6fe4412229a88c6f3750de5dad997cf", "message": "PR feedback", "committedDate": "2020-04-23T14:47:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5ODU2OQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413898569", "bodyText": "what does this change do?", "author": "jmthibault79", "createdAt": "2020-04-23T15:31:05Z", "path": "e2e/app/page/workspace-edit-page.ts", "diffHunk": "@@ -223,7 +223,7 @@ export const FIELD = {\n       type: 'radiobutton',\n       textOption: {textContains: LABEL_ALIAS.YES_FOCUS_ON_UNDERREPRESENTED_POPULATION}\n     },\n-    noOnUnderrepresentedPopulationRadiobutton: {\n+    noUnderrepresentedPopulationRadiobutton: {", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkzNDYzNA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413934634", "bodyText": "typo. ui text string does not contain on word.", "author": "aweng98", "createdAt": "2020-04-23T16:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk3MDc1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413970756", "bodyText": "ok", "author": "jmthibault79", "createdAt": "2020-04-23T17:05:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5ODU2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5OTM4OQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413899389", "bodyText": "is this correct?", "author": "jmthibault79", "createdAt": "2020-04-23T15:32:00Z", "path": "e2e/tests/home/home-page.spec.ts", "diffHunk": "@@ -39,7 +39,7 @@ describe('Home page ui tests', () => {\n       expect(cardName).toMatch(new RegExp(/^[a-zA-Z]+/));\n \n       // check Workspace Action menu for listed actions\n-      const ellipsis = await card.getEllipsis();\n+      const ellipsis = card.getEllipsis();", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkzODY2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413938661", "bodyText": "yes, correct.  It's non-asynchronous method.", "author": "aweng98", "createdAt": "2020-04-23T16:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5OTM4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk3MDg2OA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413970868", "bodyText": "ok", "author": "jmthibault79", "createdAt": "2020-04-23T17:05:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5OTM4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5OTcwMA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413899700", "bodyText": "please explain these 2 changes", "author": "jmthibault79", "createdAt": "2020-04-23T15:32:28Z", "path": "e2e/tests/user/registration-ui.spec.ts", "diffHunk": "@@ -72,6 +72,7 @@ describe('User registration tests:', () => {\n     await (await createAccountPage.getTermsOfUseCheckbox()).check();\n     const agreementPageButton = await createAccountPage.getNextButton();\n     await agreementPageButton.clickWithEval();\n+    await agreementPageButton.dispose();", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk0NjY2MA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413946660", "bodyText": "dispose(): change the object to unusable explicitly instead implicitly relying on Puppeteer tool to do the same job.", "author": "aweng98", "createdAt": "2020-04-23T16:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5OTcwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk3MTAyNA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413971024", "bodyText": "ok", "author": "jmthibault79", "createdAt": "2020-04-23T17:05:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5OTcwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwMDU2OA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413900568", "bodyText": "also these 3 changes", "author": "jmthibault79", "createdAt": "2020-04-23T15:33:29Z", "path": "e2e/tests/user/registration.spec.ts", "diffHunk": "@@ -20,18 +20,21 @@ describe('User registration tests:', () => {\n     let nextButton = await createAccountPage.getNextButton();\n     await nextButton.waitUntilEnabled();\n     await nextButton.click();\n+    await nextButton.dispose();", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwODcyNg==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413908726", "bodyText": "this can use the new SELECTOR instead", "author": "jmthibault79", "createdAt": "2020-04-23T15:43:35Z", "path": "e2e/app/component/workspace-card.ts", "diffHunk": "@@ -41,46 +45,58 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const selector = `.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`;\n+    const selector = `.//*[@data-test-id=\"workspace-card-name\" and normalize-space(text())=\"${workspaceName}\"]`;", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkzMjY4OA==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413932688", "bodyText": "\ud83d\udc4dDone", "author": "aweng98", "createdAt": "2020-04-23T16:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwODcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwOTMyNw==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413909327", "bodyText": "why this change?", "author": "jmthibault79", "createdAt": "2020-04-23T15:44:19Z", "path": "e2e/app/component/workspace-card.ts", "diffHunk": "@@ -41,46 +45,58 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const selector = `.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`;\n+    const selector = `.//*[@data-test-id=\"workspace-card-name\" and normalize-space(text())=\"${workspaceName}\"]`;\n     const allCards = await this.getAllCards(page);\n     for (const card of allCards) {\n-      const children = await card.asElementHandle().$x(selector);\n+      const handle = card.asElementHandle();\n+      const children = await handle.$x(selector);\n       if (children.length > 0) {\n         return card; // matched workspace name, found the Workspace card.\n       }\n-      await card.dispose(); // not it, dispose the ElementHandle.\n+      await handle.dispose(); // not it, dispose the ElementHandle.\n     }\n     return null; // not found\n   }\n \n \n-  constructor(page: Page) {\n-    super(page);\n+  constructor(private readonly page: Page) {", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkzMzMzMw==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413933333", "bodyText": "Because class is no longer extends BaseElement.", "author": "aweng98", "createdAt": "2020-04-23T16:14:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwOTMyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkxMDMyNQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413910325", "bodyText": "use SELECTOR", "author": "jmthibault79", "createdAt": "2020-04-23T15:45:38Z", "path": "e2e/app/component/workspace-card.ts", "diffHunk": "@@ -41,46 +45,58 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const selector = `.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`;\n+    const selector = `.//*[@data-test-id=\"workspace-card-name\" and normalize-space(text())=\"${workspaceName}\"]`;\n     const allCards = await this.getAllCards(page);\n     for (const card of allCards) {\n-      const children = await card.asElementHandle().$x(selector);\n+      const handle = card.asElementHandle();\n+      const children = await handle.$x(selector);\n       if (children.length > 0) {\n         return card; // matched workspace name, found the Workspace card.\n       }\n-      await card.dispose(); // not it, dispose the ElementHandle.\n+      await handle.dispose(); // not it, dispose the ElementHandle.\n     }\n     return null; // not found\n   }\n \n \n-  constructor(page: Page) {\n-    super(page);\n+  constructor(private readonly page: Page) {\n+\n+  }\n+\n+  async findCard(workspaceName: string): Promise<WorkspaceCard | null> {\n+    const selector = `.//*[@data-test-id=\"workspace-card-name\" and normalize-space(text())=\"${workspaceName}\"]`;", "originalCommit": "f3e5711cc6fe4412229a88c6f3750de5dad997cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkzMzc4OQ==", "url": "https://github.com/all-of-us/workbench/pull/3432#discussion_r413933789", "bodyText": "Done", "author": "aweng98", "createdAt": "2020-04-23T16:15:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkxMDMyNQ=="}], "type": "inlineReview"}, {"oid": "975c018a897ee01258d423e72b1f887d4c511b9c", "url": "https://github.com/all-of-us/workbench/commit/975c018a897ee01258d423e72b1f887d4c511b9c", "message": "PR feedback", "committedDate": "2020-04-23T16:37:37Z", "type": "commit"}]}