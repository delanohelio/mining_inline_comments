{"pr_number": 3276, "pr_title": "[RW-4567][RISKNO] Bug with Research Purpose checkbox ", "pr_createdAt": "2020-03-19T19:07:38Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3276", "timeline": [{"oid": "bc2cf3a5d427d2c6c9529be14e35af54bb7396e1", "url": "https://github.com/all-of-us/workbench/commit/bc2cf3a5d427d2c6c9529be14e35af54bb7396e1", "message": "Research purpose bug", "committedDate": "2020-03-19T18:57:32Z", "type": "commit"}, {"oid": "f7d710d848483b9ef4e310480fc3e06e0b7b5ada", "url": "https://github.com/all-of-us/workbench/commit/f7d710d848483b9ef4e310480fc3e06e0b7b5ada", "message": "method name change", "committedDate": "2020-03-19T19:15:33Z", "type": "commit"}, {"oid": "9f6d3783bef548dc4d928f3b38c79e79981ca6bf", "url": "https://github.com/all-of-us/workbench/commit/9f6d3783bef548dc4d928f3b38c79e79981ca6bf", "message": "method name change", "committedDate": "2020-03-19T19:18:11Z", "type": "commit"}, {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "url": "https://github.com/all-of-us/workbench/commit/386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "message": "add some comments", "committedDate": "2020-03-19T19:44:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTAyMQ==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705021", "bodyText": "a little confused by this line. researchPurposeCategoriesSelected takes in a research purpose right? How are we able to pass in the state object here?", "author": "ericsong", "createdAt": "2020-03-20T15:15:15Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -564,6 +574,15 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       return researchPurpose.researchOutcomeList && researchPurpose.researchOutcomeList.length !== 0 ;\n     }\n \n+    updatePrimaryPurpose(cateogry, value) {\n+      this.updateResearchPurpose(cateogry, value);\n+      if (!value && !this.researchPurposeCategoriesSelected(this.state)) {", "originalCommit": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc0MzQzNA==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395743434", "bodyText": "you are right not  sure what happened here but i meant to send this .state.workspace.researchPurpose", "author": "NehaBroad", "createdAt": "2020-03-20T16:14:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTAyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTI3OQ==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705279", "bodyText": "can we add type signatures? I think it would help clear up a question I had below", "author": "ericsong", "createdAt": "2020-03-20T15:15:38Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -354,9 +354,14 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n         return false;\n       }\n       const rp = this.props.workspace.researchPurpose;\n-      return rp.ancestry || rp.controlSet ||\n-          rp.diseaseFocusedResearch || rp.ethics || rp.drugDevelopment ||\n-          rp.methodsDevelopment || rp.populationHealth || rp.socialBehavioral;\n+      return this.researchPurposeCategoriesSelected(rp);\n+    }\n+\n+    researchPurposeCategoriesSelected(researchPurpose) {", "originalCommit": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTQ3OA==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705478", "bodyText": "type signature", "author": "ericsong", "createdAt": "2020-03-20T15:15:56Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -398,12 +403,26 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       </div>;\n     }\n \n+    onResearchPurposeChange(checked) {", "originalCommit": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTUxMg==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705512", "bodyText": "type signature", "author": "ericsong", "createdAt": "2020-03-20T15:15:59Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -398,12 +403,26 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       </div>;\n     }\n \n+    onResearchPurposeChange(checked) {\n+      // If Checkbox is selected expand the research purpose categories\n+      if (checked) {\n+        this.setState({showResearchPurpose: true, selectResearchPurpose: true});\n+        return;\n+      }\n+      this.setState({selectResearchPurpose: false});\n+    }\n+\n+    get researchPurposeCheck() {", "originalCommit": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNjQzMw==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395706433", "bodyText": "nit: I like  new lines for new properties, easier to read IMO", "author": "ericsong", "createdAt": "2020-03-20T15:17:20Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -854,26 +873,35 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n           <FlexRow>\n             <FlexColumn>\n               <FlexColumn  style={styles.researchPurposeRow}>\n+                <FlexRow>\n                 <CheckBox\n                   data-test-id='researchPurpose-checkbox'\n-                  style={{...styles.checkboxStyle, marginLeft: '0.6rem'}}\n-                  label={this.researchPurposeLabel}\n-                  labelStyle={styles.shortDescription}\n-                  checked={this.primaryPurposeIsSelected}\n-                  onChange={v => this.setState({\n-                    selectResearchPurpose: v,\n-                    showResearchPurpose: !this.state.showResearchPurpose})}/>\n-                  {this.state.showResearchPurpose && <FlexColumn>\n+                  manageOwnState={false}\n+                  style={{...styles.checkboxStyle, marginLeft: '0.6rem', marginTop: '0.1rem'}}\n+                  checked={this.researchPurposeCheck}\n+                  onChange={v => this.onResearchPurposeChange(v)}/>\n+                  <div style={{...styles.shortDescription, marginLeft: '-0.5rem'}}>\n+                    <button style={{...styles.shortDescription, border: 'none'}} data-test-id='research-purpose-button'", "originalCommit": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNzE3Ng==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395707176", "bodyText": "nit:  you could combine this with the tag above and use a ternary operator within the className", "author": "ericsong", "createdAt": "2020-03-20T15:18:23Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -854,26 +873,35 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n           <FlexRow>\n             <FlexColumn>\n               <FlexColumn  style={styles.researchPurposeRow}>\n+                <FlexRow>\n                 <CheckBox\n                   data-test-id='researchPurpose-checkbox'\n-                  style={{...styles.checkboxStyle, marginLeft: '0.6rem'}}\n-                  label={this.researchPurposeLabel}\n-                  labelStyle={styles.shortDescription}\n-                  checked={this.primaryPurposeIsSelected}\n-                  onChange={v => this.setState({\n-                    selectResearchPurpose: v,\n-                    showResearchPurpose: !this.state.showResearchPurpose})}/>\n-                  {this.state.showResearchPurpose && <FlexColumn>\n+                  manageOwnState={false}\n+                  style={{...styles.checkboxStyle, marginLeft: '0.6rem', marginTop: '0.1rem'}}\n+                  checked={this.researchPurposeCheck}\n+                  onChange={v => this.onResearchPurposeChange(v)}/>\n+                  <div style={{...styles.shortDescription, marginLeft: '-0.5rem'}}>\n+                    <button style={{...styles.shortDescription, border: 'none'}} data-test-id='research-purpose-button'\n+                            onClick={() => this.setState({showResearchPurpose: !this.state.showResearchPurpose})}>\n+                      Research purpose\n+                      {!this.state.showResearchPurpose &&\n+                      <i className='pi pi-angle-right' style={{verticalAlign: 'middle'}}></i>}\n+                      {this.state.showResearchPurpose &&\n+                      <i className='pi pi-angle-down' style={{verticalAlign: 'middle'}}></i>}", "originalCommit": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d1dff3f230e943710a1d19e41caca25d1b2aa909", "url": "https://github.com/all-of-us/workbench/commit/d1dff3f230e943710a1d19e41caca25d1b2aa909", "message": "added types and extracted icon class - PR Comments", "committedDate": "2020-03-20T16:28:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5OTI4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r398099287", "bodyText": "nit: I would prefer to use else here instead of using a return statement above. I thought this was a bug when I was reading through", "author": "ericsong", "createdAt": "2020-03-25T19:01:58Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -398,12 +404,30 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       </div>;\n     }\n \n+    onResearchPurposeChange(checked: boolean) {\n+      // If Checkbox is selected expand the research purpose categories\n+      if (checked) {\n+        this.setState({showResearchPurpose: true, selectResearchPurpose: true});\n+        return;\n+      }\n+      this.setState({selectResearchPurpose: false});", "originalCommit": "d1dff3f230e943710a1d19e41caca25d1b2aa909", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a41cf72781686713f8a1d624b206b5290063b4ce", "url": "https://github.com/all-of-us/workbench/commit/a41cf72781686713f8a1d624b206b5290063b4ce", "message": "if else PR Comments", "committedDate": "2020-03-26T14:18:22Z", "type": "commit"}]}