{"pr_number": 3013, "pr_title": "[RISK=MEDIUM][no ticket] Add default value to user creation date and last modified time", "pr_createdAt": "2020-01-18T17:22:35Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3013", "timeline": [{"oid": "64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "url": "https://github.com/all-of-us/workbench/commit/64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "message": "Add default value to creation_Time", "committedDate": "2020-01-17T22:17:58Z", "type": "commit"}, {"oid": "d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "url": "https://github.com/all-of-us/workbench/commit/d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "message": "Conflict resolve", "committedDate": "2020-01-17T23:02:50Z", "type": "commit"}, {"oid": "f7c7ed09877ad85ea2c45c682008616edf3f351f", "url": "https://github.com/all-of-us/workbench/commit/f7c7ed09877ad85ea2c45c682008616edf3f351f", "message": "change changesheet name", "committedDate": "2020-01-18T16:12:43Z", "type": "commit"}, {"oid": "1653d41198433f8877df78ba59bc722ca3fb7747", "url": "https://github.com/all-of-us/workbench/commit/1653d41198433f8877df78ba59bc722ca3fb7747", "message": "Add scripts to remove creation_time and last_modified_time from user table and readd them with default values", "committedDate": "2020-01-18T17:14:41Z", "type": "commit"}, {"oid": "ff3e1cf7e1622858eb68286a7cb65239bf26a82c", "url": "https://github.com/all-of-us/workbench/commit/ff3e1cf7e1622858eb68286a7cb65239bf26a82c", "message": "reverting 115 to original script", "committedDate": "2020-01-18T17:24:20Z", "type": "commit"}, {"oid": "c8683901997becd8523f89aa1aec0315a4b901cc", "url": "https://github.com/all-of-us/workbench/commit/c8683901997becd8523f89aa1aec0315a4b901cc", "message": "Merge branch 'master' into nsaxena/RDR/addColoboratorStatus", "committedDate": "2020-01-18T17:34:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDU3OQ==", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368240579", "bodyText": "No, we can't have this. The entire point of Liquibase is that it's idempotent, and if it's at a state, it got there by playing everything before it successfully.\nCan we just restore the database from a backup and run a migration from there?", "author": "jaycarlton", "createdAt": "2020-01-18T18:16:01Z", "path": "api/db/changelog/db.changelog-115-addColumn-user-create-modified.xml", "diffHunk": "@@ -5,12 +5,17 @@\n     xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n   <changeSet author=\"nsaxena\" id=\"db.changelog-115-addColumn-user-create-modified-with-null-constraint-and-default\">\n+    <preConditions onFail=\"MARK_RAN\" > ", "originalCommit": "c8683901997becd8523f89aa1aec0315a4b901cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDc2Ng==", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368240766", "bodyText": "This was not the ideal solution we wanted to do however I had to do this just because i cannot run ALTER commands on test DB and we deleted the entry in databasechangelog for changeset", "author": "NehaBroad", "createdAt": "2020-01-18T18:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MTg0NQ==", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368241845", "bodyText": "That's kinda what I figured.", "author": "jaycarlton", "createdAt": "2020-01-18T18:39:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MTk1MA==", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368241950", "bodyText": "We will definitely need a way to obtain such access for the oncall engineer when needed.", "author": "jaycarlton", "createdAt": "2020-01-18T18:41:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDU3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDY0NA==", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368240644", "bodyText": "We should just delete this changeset and start at 120 if it failed. I think that's more correct. 115 should never be in the history for two different databases with different semantics.", "author": "jaycarlton", "createdAt": "2020-01-18T18:17:14Z", "path": "api/db/changelog/db.changelog-115-addColumn-user-create-modified.xml", "diffHunk": "@@ -5,12 +5,17 @@\n     xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n   <changeSet author=\"nsaxena\" id=\"db.changelog-115-addColumn-user-create-modified-with-null-constraint-and-default\">\n+    <preConditions onFail=\"MARK_RAN\" > \n+      <not>         \n+        <columnExists tableName=\"user\" columnName=\"creation_time\" />\n+      </not>\n+    </preConditions>\n     <addColumn tableName=\"user\">\n-      <column name=\"creation_time\" type=\"datetime\" defaultValueDate=\"1970-01-01 00:00:00\">\n-        <constraints nullable=\"false\" />\n+      <column name=\"creation_time\" type=\"datetime\">", "originalCommit": "c8683901997becd8523f89aa1aec0315a4b901cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MTAwNg==", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368241006", "bodyText": "what do you mean by 120?", "author": "NehaBroad", "createdAt": "2020-01-18T18:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDY0NA=="}], "type": "inlineReview"}]}