{"pr_number": 3958, "pr_title": "[no ticket][risk=no] Puppeteer: workspace-base deleteResource function", "pr_createdAt": "2020-09-02T20:23:52Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3958", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzQ2NA==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487607464", "bodyText": "Do we need console message?", "author": "NehaBroad", "createdAt": "2020-09-14T01:26:02Z", "path": "e2e/app/component/share-modal.ts", "diffHunk": "@@ -25,6 +25,7 @@ export default class ShareModal extends Modal {\n     await ownerOpt.click();\n \n     await this.clickButton(LinkText.Save, {waitForClose: true});\n+    console.log(`Shared workspace to user ${username} with role ${level}`);", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwMzQzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r488003431", "bodyText": "It's really helpful when trying to understand what happens since there are no manual test plans for automated tests.", "author": "aweng98", "createdAt": "2020-09-14T15:03:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzQ2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzU2Mg==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487607562", "bodyText": "nit: page/text-labels", "author": "NehaBroad", "createdAt": "2020-09-14T01:26:32Z", "path": "e2e/app/page/notebook-page.ts", "diffHunk": "@@ -1,11 +1,12 @@\n+import * as fs from 'fs';\n import {Frame, Page} from 'puppeteer';\n import {getPropValue} from 'utils/element-utils';\n import {waitWhileLoading} from 'utils/test-utils';\n import {waitForDocumentTitle} from 'utils/waits-utils';\n+import {ResourceCard} from '../text-labels';", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwNDAzMw==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r488004033", "bodyText": "Fixed", "author": "aweng98", "createdAt": "2020-09-14T15:04:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzU2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzg0MA==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487607840", "bodyText": "Question: resourceCard is resource card list?", "author": "NehaBroad", "createdAt": "2020-09-14T01:28:02Z", "path": "e2e/app/page/workspace-analysis-page.ts", "diffHunk": "@@ -128,7 +110,7 @@ export default class WorkspaceAnalysisPage extends WorkspaceBase {\n    */\n   async duplicateNotebook(notebookName: string): Promise<string> {\n     const resourceCard = new DataResourceCard(this.page);", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwOTg1OQ==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r488009859", "bodyText": "DataResourceCard is one card.", "author": "aweng98", "createdAt": "2020-09-14T15:10:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzg0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODE3OQ==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487608179", "bodyText": "There can also be a utils method that takes in this.page , resource name and card type.\nconst resourceCard = new DataResourceCard(this.page); can move in that util method", "author": "NehaBroad", "createdAt": "2020-09-14T01:29:40Z", "path": "e2e/app/page/workspace-analysis-page.ts", "diffHunk": "@@ -143,7 +125,7 @@ export default class WorkspaceAnalysisPage extends WorkspaceBase {\n   async copyNotebookToWorkspace(notebookName: string, destinationWorkspace: string, destinationNotebookName?: string): Promise<void> {\n     // Open Copy modal.s\n     const resourceCard = new DataResourceCard(this.page);\n-    const notebookCard = await resourceCard.findCard(notebookName, CardType.Notebook);\n+    const notebookCard = await resourceCard.findCard(notebookName, ResourceCard.Notebook);", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODI4OQ==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487608289", "bodyText": "nit: app/component", "author": "NehaBroad", "createdAt": "2020-09-14T01:30:09Z", "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -4,6 +4,9 @@ import {ElementType} from 'app/xpath-options';\n import {Page} from 'puppeteer';\n import {waitWhileLoading} from 'utils/test-utils';\n import {waitForAttributeEquality} from 'utils/waits-utils';\n+import DataResourceCard from '../component/data-resource-card';", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAxMDgwNA==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r488010804", "bodyText": "Fixed.", "author": "aweng98", "createdAt": "2020-09-14T15:12:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODI4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODQxMw==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487608413", "bodyText": "nit: indent for readability", "author": "NehaBroad", "createdAt": "2020-09-14T01:30:51Z", "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -94,5 +97,48 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n     return waitForAttributeEquality(this.page, {xpath: selector}, 'aria-selected', 'true');\n   }\n \n+  /**\n+   * Delete ConceptSet, Dataset or Cohort thru Ellipsis menu located inside the resource card.\n+   * @param {string} resourceName\n+   * @param {ResourceCard} resourceType\n+   */\n+  async deleteResource(resourceName: string, resourceType: ResourceCard): Promise<string[]> {\n+    const resourceCard = new DataResourceCard(this.page);\n+    const card = await resourceCard.findCard(resourceName, resourceType);\n+    if (!card) {\n+      throw new Error(`Failed to find ${resourceType} card \"${resourceName}\"`);\n+    }\n+\n+    await card.clickEllipsisAction(EllipsisMenuAction.Delete, {waitForNav: false});\n+\n+    const modal = new Modal(this.page);\n+    await modal.waitForLoad();\n+    const modalTextContent = await modal.getTextContent();\n+\n+    let link;\n+    switch (resourceType) {\n+    case ResourceCard.Cohort:", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MDk2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r488060961", "bodyText": "Fixed.", "author": "aweng98", "createdAt": "2020-09-14T16:21:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwOTI1MA==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487609250", "bodyText": "Question: If we delete a concept Set or Cohort that is being used in existing dataSet ,there will be another Modal with warning text , is that covered?", "author": "NehaBroad", "createdAt": "2020-09-14T01:35:05Z", "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -94,5 +97,48 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n     return waitForAttributeEquality(this.page, {xpath: selector}, 'aria-selected', 'true');\n   }\n \n+  /**\n+   * Delete ConceptSet, Dataset or Cohort thru Ellipsis menu located inside the resource card.\n+   * @param {string} resourceName\n+   * @param {ResourceCard} resourceType\n+   */\n+  async deleteResource(resourceName: string, resourceType: ResourceCard): Promise<string[]> {\n+    const resourceCard = new DataResourceCard(this.page);\n+    const card = await resourceCard.findCard(resourceName, resourceType);\n+    if (!card) {\n+      throw new Error(`Failed to find ${resourceType} card \"${resourceName}\"`);\n+    }\n+\n+    await card.clickEllipsisAction(EllipsisMenuAction.Delete, {waitForNav: false});\n+\n+    const modal = new Modal(this.page);\n+    await modal.waitForLoad();\n+    const modalTextContent = await modal.getTextContent();\n+\n+    let link;\n+    switch (resourceType) {\n+    case ResourceCard.Cohort:\n+      link = LinkText.DeleteCohort;\n+      break;\n+    case ResourceCard.ConceptSet:\n+      link = LinkText.DeleteConceptSet;", "originalCommit": "809099eb89e7d81c102125359f4846a4e313303f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzExOQ==", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r488063119", "bodyText": "Currently it's covered. I created a new ticket to track work. RW-5589", "author": "aweng98", "createdAt": "2020-09-14T16:24:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwOTI1MA=="}], "type": "inlineReview"}, {"oid": "f0f37fc47e7e92f60a5c6dd90ed5fdd0f9dd0da2", "url": "https://github.com/all-of-us/workbench/commit/f0f37fc47e7e92f60a5c6dd90ed5fdd0f9dd0da2", "message": "workspace-base deleteResource function", "committedDate": "2020-09-14T16:58:38Z", "type": "commit"}, {"oid": "1b8b6e4b66e21debc8006515673481a28ab5b022", "url": "https://github.com/all-of-us/workbench/commit/1b8b6e4b66e21debc8006515673481a28ab5b022", "message": "fix imports", "committedDate": "2020-09-14T16:58:38Z", "type": "commit"}, {"oid": "e0ebd9dda6465c9865791d9f61d8436178527ac3", "url": "https://github.com/all-of-us/workbench/commit/e0ebd9dda6465c9865791d9f61d8436178527ac3", "message": "PR feedback", "committedDate": "2020-09-14T16:58:38Z", "type": "commit"}, {"oid": "e0ebd9dda6465c9865791d9f61d8436178527ac3", "url": "https://github.com/all-of-us/workbench/commit/e0ebd9dda6465c9865791d9f61d8436178527ac3", "message": "PR feedback", "committedDate": "2020-09-14T16:58:38Z", "type": "forcePushed"}]}