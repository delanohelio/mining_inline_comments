{"pr_number": 3918, "pr_title": "[RW-4897][risk=no] Puppeteer user registration test", "pr_createdAt": "2020-08-25T22:37:48Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3918", "timeline": [{"oid": "0bb72d56c2f57b0444e07475db3bfd40103e9027", "url": "https://github.com/all-of-us/workbench/commit/0bb72d56c2f57b0444e07475db3bfd40103e9027", "message": "user registration test", "committedDate": "2020-08-25T22:35:21Z", "type": "commit"}, {"oid": "d33b3369c42c0be1125e6607bddf74745ad47de1", "url": "https://github.com/all-of-us/workbench/commit/d33b3369c42c0be1125e6607bddf74745ad47de1", "message": "enable registration test", "committedDate": "2020-08-25T22:40:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjgxMDkxOQ==", "url": "https://github.com/all-of-us/workbench/pull/3918#discussion_r476810919", "bodyText": "Not really gain anything by having two tests. Combine two into one in order to run it quicker.", "author": "aweng98", "createdAt": "2020-08-25T22:42:44Z", "path": "e2e/tests/user/registration-ui.spec.ts", "diffHunk": "@@ -50,19 +50,6 @@ describe('User registration tests:', () => {\n     // uncheck a checkbox then check NEXT button is again disabled\n     await (await createAccountPage.getTermsOfUseCheckbox()).unCheck();\n     expect(await nextButton.isCursorNotAllowed()).toEqual(true);\n-  });\n-\n-\n-  test('Loading User information page', async () => {", "originalCommit": "d33b3369c42c0be1125e6607bddf74745ad47de1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjgxMTgwMg==", "url": "https://github.com/all-of-us/workbench/pull/3918#discussion_r476811802", "bodyText": "Move NODE_ENV and CI env variables to CircleCI config.yml.", "author": "aweng98", "createdAt": "2020-08-25T22:43:58Z", "path": "e2e/package.json", "diffHunk": "@@ -13,8 +13,8 @@\n     \"test-local:debug\": \"cross-env WORKBENCH_ENV=local PUPPETEER_HEADLESS=false DEBUG=true jest --maxWorkers=2\",\n     \"test-staging\": \"cross-env WORKBENCH_ENV=staging jest --maxWorkers=3\",\n     \"test-staging:debug\": \"cross-env WORKBENCH_ENV=staging PUPPETEER_HEADLESS=false DEBUG=true jest --maxWorkers=1\",\n-    \"test:ci\": \"cross-env NODE_ENV=development CI=true jest --ci --maxWorkers=2\",", "originalCommit": "d33b3369c42c0be1125e6607bddf74745ad47de1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dd72a8e2e948d54882f0a7e580a7d469b6681beb", "url": "https://github.com/all-of-us/workbench/commit/dd72a8e2e948d54882f0a7e580a7d469b6681beb", "message": "config.yml error fix", "committedDate": "2020-08-25T22:45:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg0MTIzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3918#discussion_r476841231", "bodyText": "jest.config.js: const { defaults } = require('jest-config'); throws tslib error without this change.", "author": "aweng98", "createdAt": "2020-08-25T23:14:26Z", "path": "e2e/tsconfig.json", "diffHunk": "@@ -4,7 +4,7 @@\n     \"allowUnreachableCode\": false,\n     \"suppressExcessPropertyErrors\": false,\n     \"moduleResolution\": \"node\",\n-    \"module\": \"commonjs\",\n+    \"module\": \"ES2015\",", "originalCommit": "dd72a8e2e948d54882f0a7e580a7d469b6681beb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc20ba2d8e4efe36a84d27a0318a5ce8a0f48f5f", "url": "https://github.com/all-of-us/workbench/commit/bc20ba2d8e4efe36a84d27a0318a5ce8a0f48f5f", "message": "jest.config.js fix", "committedDate": "2020-08-25T23:43:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg3MzU0NQ==", "url": "https://github.com/all-of-us/workbench/pull/3918#discussion_r476873545", "bodyText": "moduleFileExtensions  default array is: [\"js\", \"json\", \"jsx\", \"ts\", \"tsx\", \"node\"]", "author": "aweng98", "createdAt": "2020-08-25T23:44:52Z", "path": "e2e/jest.config.js", "diffHunk": "@@ -28,21 +31,11 @@ module.exports = {\n     \"/node_modules/\",\n     \"/tsc-out/\"\n   ],\n-  \"testMatch\": [\n-    \"<rootDir>/tests/**/*.spec.ts\"\n-  ],\n+  testMatch: TEST_MODE === \"nightly-integration\" ? [ \"<rootDir>/tests/nightly/**/*.spec.ts\", ] : [ \"<rootDir>/tests(?!\\/nightly)/**/*.spec.ts\", ],\n   \"transformIgnorePatterns\": [\n     \"<rootDir>/node_modules/(?!tests)\"\n   ],\n-  \"moduleFileExtensions\": [\n-    \"ts\",\n-    \"spec.ts\",\n-    \"tsx\",\n-    \"js\",\n-    \"jsx\",\n-    \"json\",\n-    \"node\"\n-  ],\n+  \"moduleFileExtensions\": [ ...defaults.moduleFileExtensions ],", "originalCommit": "bc20ba2d8e4efe36a84d27a0318a5ce8a0f48f5f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQwODQ2Nw==", "url": "https://github.com/all-of-us/workbench/pull/3918#discussion_r477408467", "bodyText": "Here ^.\nSubmit button click and verification were commented out due to captcha verification during initial implementation phase. Sometimes later, Neha added captchaSiteKey  so captcha verification always pass.\nhttps://developers.google.com/recaptcha/docs/faq#id-like-to-run-automated-tests-with-recaptcha.-what-should-i-do", "author": "aweng98", "createdAt": "2020-08-26T15:53:34Z", "path": "e2e/tests/nightly/registration.spec.ts", "diffHunk": "@@ -28,24 +29,39 @@ describe('User registration tests:', () => {\n     await nextButton.clickWithEval();\n \n     // Step 3: Enter user information\n-    await createAccountPage.fillOutUserInformation();\n+    const userId = await createAccountPage.fillOutUserInformation();\n     nextButton = await createAccountPage.getNextButton();\n     await nextButton.waitUntilEnabled();\n     await nextButton.click();\n \n     // Step 4: Enter demographic survey (All Survey Fields are optional)\n     await createAccountPage.fillOutDemographicSurvey();\n \n-    // TODO uncomment after disable recaptcha", "originalCommit": "bc20ba2d8e4efe36a84d27a0318a5ce8a0f48f5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQxMDUzNQ==", "url": "https://github.com/all-of-us/workbench/pull/3918#discussion_r477410535", "bodyText": "test was not disabled or skipped, only the final step (Submit) were commented out to avoid failure.", "author": "aweng98", "createdAt": "2020-08-26T15:56:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQwODQ2Nw=="}], "type": "inlineReview"}]}