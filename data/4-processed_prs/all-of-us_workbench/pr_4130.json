{"pr_number": 4130, "pr_title": "RW-5701 fixing domain_info counts", "pr_createdAt": "2020-10-07T18:48:18Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4130", "timeline": [{"oid": "036b1dca78f5242d8ac80e202ad4b4ee8aa047fa", "url": "https://github.com/all-of-us/workbench/commit/036b1dca78f5242d8ac80e202ad4b4ee8aa047fa", "message": "RW-5701 fixing domain_info counts", "committedDate": "2020-10-07T18:47:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTIzNjI1MQ==", "url": "https://github.com/all-of-us/workbench/pull/4130#discussion_r501236251", "bodyText": "Switched counts back to old code.", "author": "freemabd", "createdAt": "2020-10-07T18:48:46Z", "path": "api/db-cdr/generate-cdr/make-bq-data.sh", "diffHunk": "@@ -455,20 +455,20 @@ set d.standard_concept_count = c.standard_concept_count\n from (select c.domain_id as domain_id, COUNT(DISTINCT c.concept_id) as standard_concept_count\n from \\`$OUTPUT_PROJECT.$OUTPUT_DATASET.cb_criteria\\` c\n join \\`$OUTPUT_PROJECT.$OUTPUT_DATASET.domain_info\\` d2\n-on d2.domain_enum = c.domain_id and c.is_standard = 1 and c.is_selectable = 1\n+on d2.domain_enum = c.domain_id and c.is_standard = 1 and c.is_selectable = 1  and d2.domain_enum != 'PHYSICAL_MEASUREMENT'\n group by c.domain_id) c\n where d.domain_enum = c.domain_id\"\n \n # Set all_concept_count on domain_info for Physical Measurements\n bq --quiet --project=$BQ_PROJECT query --nouse_legacy_sql \\\n \"update \\`$OUTPUT_PROJECT.$OUTPUT_DATASET.domain_info\\` d\n-set d.all_concept_count = c.all_concept_count\n-from (SELECT count(distinct concept_id) as all_concept_count\n-FROM \\`$BQ_PROJECT.$BQ_DATASET.cb_criteria\\`\n-WHERE type = 'PPI'\n-AND domain_id = 'PHYSICAL_MEASUREMENT'\n-AND is_selectable = 1) c\n-where d.domain = 10\"\n+set d.all_concept_count = c.all_concept_count from", "originalCommit": "036b1dca78f5242d8ac80e202ad4b4ee8aa047fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}