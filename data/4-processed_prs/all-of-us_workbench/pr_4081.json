{"pr_number": 4081, "pr_title": "[RW-5614][risk=no] Handle egress events from GCE", "pr_createdAt": "2020-09-28T23:52:16Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4081", "timeline": [{"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269", "url": "https://github.com/all-of-us/workbench/commit/bb5ae56872b94aced411fa3dd77d9970297fb269", "message": "Handle egress events from GCE", "committedDate": "2020-09-28T23:50:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODA1Nw==", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r496298057", "bodyText": "Also while you're here: any initial thoughts on this?\nMy assumptions are:\n\nThe existing egress alerting already covers traffic coming from Dataproc workers nodes.\nThe naming convention for these nodes is not handled anywhere, so we may need to do some more clever mapping here to determine the owner.\nEgress from worker nodes is potentially a big red flag, and if it were easy, I might be in favor of locking it down. There is no real reason to allow worker nodes to send a lot of data out of the cluster", "author": "calbach", "createdAt": "2020-09-28T23:55:06Z", "path": "api/src/main/java/org/pmiops/workbench/actionaudit/auditors/EgressEventAuditorImpl.kt", "diffHunk": "@@ -36,12 +36,21 @@ constructor(\n      * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use\n      * of Dataproc (see https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/metadata).\n      *\n-     * TODO(RW-4848): Update this to account for GCE naming conventions.\n+     * TODO(RW-4848): How do egress alerts interact with worker nodes?", "originalCommit": "bb5ae56872b94aced411fa3dd77d9970297fb269", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjA3Ng==", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r497732076", "bodyText": "All good points \u2013\u00a0nothing I'd add on top of that.", "author": "gjuggler", "createdAt": "2020-09-30T18:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODA1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjU0Mg==", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r497732542", "bodyText": "nit: update comment", "author": "gjuggler", "createdAt": "2020-09-30T18:57:43Z", "path": "api/src/main/java/org/pmiops/workbench/actionaudit/auditors/EgressEventAuditorImpl.kt", "diffHunk": "@@ -36,12 +36,21 @@ constructor(\n      * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use\n      * of Dataproc (see https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/metadata).\n      *\n-     * TODO(RW-4848): Update this to account for GCE naming conventions.\n+     * TODO(RW-4848): How do egress alerts interact with worker nodes?\n      */\n-    private fun dbUserToVmName(dbUser: DbUser): String {\n+    private fun dbUserToDataprocMasterVmName(dbUser: DbUser): String {\n         return dbUser.runtimeName + DATAPROC_MASTER_NODE_SUFFIX\n     }\n \n+    /**\n+     * Converts the AoU-chosen runtime name into the actual VM name as reported by Google Cloud's\n+     * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use", "originalCommit": "bb5ae56872b94aced411fa3dd77d9970297fb269", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg0MDcxNw==", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r497840717", "bodyText": "Oops - thanks. Done.", "author": "calbach", "createdAt": "2020-09-30T22:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjU0Mg=="}], "type": "inlineReview"}, {"oid": "f2ad69350415d1920c193b5f78614f44b2a5a700", "url": "https://github.com/all-of-us/workbench/commit/f2ad69350415d1920c193b5f78614f44b2a5a700", "message": "PR feedback", "committedDate": "2020-09-30T22:40:40Z", "type": "commit"}]}