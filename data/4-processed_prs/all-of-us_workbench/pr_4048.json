{"pr_number": 4048, "pr_title": "[no ticket][risk=no] Puppeteer flaky cohort UI fix", "pr_createdAt": "2020-09-22T22:13:00Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4048", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2Mzg0NA==", "url": "https://github.com/all-of-us/workbench/pull/4048#discussion_r493063844", "bodyText": "I expect this will address the flaky behavior in Cohort tests. Not removing 1 second sleep for now to see if flaky still happens.", "author": "aweng98", "createdAt": "2020-09-22T22:14:59Z", "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -107,6 +107,7 @@ export default class CohortSearchPage extends AuthenticatedPage {\n \n     const link = await this.waitForPhysicalMeasurementCriteriaLink(criteriaName);\n     await link.click();\n+    await waitWhileLoading(this.page);", "originalCommit": "5956bb9b63be3a0358411a69541b75cf0b54e93f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzNjY3OA==", "url": "https://github.com/all-of-us/workbench/pull/4048#discussion_r493636678", "bodyText": "Just curious how adding this here would fix the flakiness? The error seems to happen several steps later in the test.", "author": "dolbeew", "createdAt": "2020-09-23T14:25:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2Mzg0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMDA5OA==", "url": "https://github.com/all-of-us/workbench/pull/4048#discussion_r493900098", "bodyText": "Ah, yes, you're right.\nI did see spinner spinning while watching test playback so I think waitWhileLoading is still needed.", "author": "aweng98", "createdAt": "2020-09-23T21:15:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2Mzg0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAyOTA3Mw==", "url": "https://github.com/all-of-us/workbench/pull/4048#discussion_r494029073", "bodyText": "Sounds good, thanks.", "author": "dolbeew", "createdAt": "2020-09-24T04:19:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2Mzg0NA=="}], "type": "inlineReview"}, {"oid": "136232e8ac7c657f84062d000357439e336e0565", "url": "https://github.com/all-of-us/workbench/commit/136232e8ac7c657f84062d000357439e336e0565", "message": "fix", "committedDate": "2020-09-24T00:55:48Z", "type": "commit"}, {"oid": "136232e8ac7c657f84062d000357439e336e0565", "url": "https://github.com/all-of-us/workbench/commit/136232e8ac7c657f84062d000357439e336e0565", "message": "fix", "committedDate": "2020-09-24T00:55:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk4MDIzMQ==", "url": "https://github.com/all-of-us/workbench/pull/4048#discussion_r493980231", "bodyText": "Fix a bug in selector when only nodeLevel was specified.\ne.g. const selectMenu = await SelectMenu.findByName(this.page, {ancestorLevel: 0}, this);", "author": "aweng98", "createdAt": "2020-09-24T01:01:14Z", "path": "e2e/app/xpath-builders.ts", "diffHunk": "@@ -62,7 +62,7 @@ export function buildXPath(xOpts: XPathOptions, container?: Container): string {\n     selector = `${textExpr}//${type}`;\n     break;\n   case ElementType.Dropdown:\n-    selector = `${textExpr}//*[contains(concat(\" \", normalize-space(@class)),\" p-dropdown\")]`;\n+    selector = `${textExpr}${nodeLevel}//*[contains(concat(\" \", normalize-space(@class), \" \"), \" p-dropdown \")]`;", "originalCommit": "136232e8ac7c657f84062d000357439e336e0565", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk4MTU3MA==", "url": "https://github.com/all-of-us/workbench/pull/4048#discussion_r493981570", "bodyText": "Update because I changed Dropdown in xpath-builders.ts.", "author": "aweng98", "createdAt": "2020-09-24T01:06:55Z", "path": "e2e/app/page/create-account-page.ts", "diffHunk": "@@ -66,12 +66,12 @@ export const FieldSelector = {\n   },\n   InstitutionSelect: {\n     textOption: {\n-      type:ElementType.Dropdown, name:'Select your institution', ancestorLevel:2\n+      type:ElementType.Dropdown, name:'Select your institution', ancestorLevel:1", "originalCommit": "136232e8ac7c657f84062d000357439e336e0565", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}