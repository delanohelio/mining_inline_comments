{"pr_number": 3988, "pr_title": "[RW-5476][risk=no] WDL for RandomizeVcf", "pr_createdAt": "2020-09-10T17:00:18Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3988", "timeline": [{"oid": "46e7f5504a978f02d142b44eae2d47056a657a60", "url": "https://github.com/all-of-us/workbench/commit/46e7f5504a978f02d142b44eae2d47056a657a60", "message": "randomize vcf wdl - untested", "committedDate": "2020-09-02T16:46:44Z", "type": "commit"}, {"oid": "2259e092d415e0819b49cdfd5f3731297b5727a9", "url": "https://github.com/all-of-us/workbench/commit/2259e092d415e0819b49cdfd5f3731297b5727a9", "message": "inputs, options", "committedDate": "2020-09-02T18:17:35Z", "type": "commit"}, {"oid": "ffda8ec28a240e5f0bd749a69bcd0f37e3c0447e", "url": "https://github.com/all-of-us/workbench/commit/ffda8ec28a240e5f0bd749a69bcd0f37e3c0447e", "message": "preemptibles", "committedDate": "2020-09-02T18:33:18Z", "type": "commit"}, {"oid": "e4fbd02cbd7a95a94f8985ebe0e6d2f1f4689fc4", "url": "https://github.com/all-of-us/workbench/commit/e4fbd02cbd7a95a94f8985ebe0e6d2f1f4689fc4", "message": "Add documentation on how to run Cromwell and fix some bugs in randomize wdl", "committedDate": "2020-09-08T17:58:49Z", "type": "commit"}, {"oid": "19783d8d4c0d17d5affec988952fcc6486a36678", "url": "https://github.com/all-of-us/workbench/commit/19783d8d4c0d17d5affec988952fcc6486a36678", "message": "should complete now", "committedDate": "2020-09-10T16:42:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwODI5MA==", "url": "https://github.com/all-of-us/workbench/pull/3988#discussion_r486508290", "bodyText": "We can probably get rid of most of these comments as they're related to Circle", "author": "ericsong", "createdAt": "2020-09-10T17:19:51Z", "path": "api/genomics/wdl/RandomizeVcf/Dockerfile", "diffHunk": "@@ -0,0 +1,39 @@\n+# To build and deploy, from this directory:", "originalCommit": "19783d8d4c0d17d5affec988952fcc6486a36678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUxMjM1NA==", "url": "https://github.com/all-of-us/workbench/pull/3988#discussion_r486512354", "bodyText": "\ud83d\udc4d", "author": "als364", "createdAt": "2020-09-10T17:26:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwODI5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwODY3OA==", "url": "https://github.com/all-of-us/workbench/pull/3988#discussion_r486508678", "bodyText": "should we specify CPU as well?", "author": "ericsong", "createdAt": "2020-09-10T17:20:28Z", "path": "api/genomics/wdl/IngestSyntheticVcfWf.wdl", "diffHunk": "@@ -0,0 +1,84 @@\n+version 1.0\n+\n+workflow IngestSyntheticVcfWf {\n+  input {\n+    File base_vcf\n+    File base_vcf_index\n+    File file_of_sample_names\n+    String output_file\n+  }\n+\n+  call CountSamples {\n+    input:\n+      file_of_sample_names = file_of_sample_names\n+  }\n+\n+  call RandomizeVcf {\n+    input:\n+      base_vcf = base_vcf,\n+      base_vcf_index = base_vcf_index,\n+      file_of_sample_names = file_of_sample_names,\n+      number_of_samples = CountSamples.number_of_samples,\n+      output_file = output_file\n+  }\n+\n+  output {\n+    File randomized_vcf = RandomizeVcf.randomized_vcf\n+  }\n+}\n+\n+task CountSamples {\n+  input {\n+    File file_of_sample_names\n+  }\n+\n+  command <<<\n+    set -euo pipefail\n+\n+    cat ~{file_of_sample_names} | wc -l\n+  >>>\n+\n+  runtime {\n+    memory: \"1 GiB\"\n+    disks: \"local-disk 1 HDD\"\n+    docker: \"ubuntu:latest\"\n+    preemptible: 3\n+  }\n+\n+  output {\n+    Int number_of_samples = read_int(stdout())\n+  }\n+}\n+\n+task RandomizeVcf {\n+  input {\n+    File base_vcf\n+    File base_vcf_index\n+    File file_of_sample_names\n+    Int number_of_samples\n+    String output_file\n+  }\n+\n+  Int disk_size = ceil(2 * number_of_samples * size(base_vcf, \"GB\"))\n+\n+  command <<<\n+    set -euo pipefail\n+\n+    /workbench/api/project.rb randomize-vcf \\\n+    --vcf ~{base_vcf} \\\n+    --sample-names-file ~{file_of_sample_names} \\\n+    --output $(pwd)/~{output_file}\n+\n+  >>>\n+\n+  runtime {\n+    memory: \"4 GiB\"", "originalCommit": "19783d8d4c0d17d5affec988952fcc6486a36678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUxMjMyMQ==", "url": "https://github.com/all-of-us/workbench/pull/3988#discussion_r486512321", "bodyText": "Yeah, probably should", "author": "als364", "createdAt": "2020-09-10T17:26:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUxMzEwNQ==", "url": "https://github.com/all-of-us/workbench/pull/3988#discussion_r486513105", "bodyText": "Actually, yeah, I'll just turn this into an n2-standard-2", "author": "als364", "createdAt": "2020-09-10T17:28:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwODY3OA=="}], "type": "inlineReview"}, {"oid": "4d77e46f96dd7ae77461a174abd25d045472f745", "url": "https://github.com/all-of-us/workbench/commit/4d77e46f96dd7ae77461a174abd25d045472f745", "message": "remove circleci-related comments, standardize vm size", "committedDate": "2020-09-10T17:28:55Z", "type": "commit"}]}