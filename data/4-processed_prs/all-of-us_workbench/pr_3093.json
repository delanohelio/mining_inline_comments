{"pr_number": 3093, "pr_title": "[RW-3177][risk=no] Create/attach billing account flow from billing account dropdown", "pr_createdAt": "2020-02-05T16:47:45Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3093", "timeline": [{"oid": "1d73dd69aaf33d9fb8b941f937bd5353c3016134", "url": "https://github.com/all-of-us/workbench/commit/1d73dd69aaf33d9fb8b941f937bd5353c3016134", "message": "WIP - still needs some styling and GCP logo", "committedDate": "2020-02-04T20:24:18Z", "type": "commit"}, {"oid": "a766ebae0058caa0b55fb8906ae2118c2d4b5f63", "url": "https://github.com/all-of-us/workbench/commit/a766ebae0058caa0b55fb8906ae2118c2d4b5f63", "message": "finish up create new billing account modal", "committedDate": "2020-02-05T16:13:39Z", "type": "commit"}, {"oid": "9500b89fc58573c0765e87cfb36ee50ee760ddd4", "url": "https://github.com/all-of-us/workbench/commit/9500b89fc58573c0765e87cfb36ee50ee760ddd4", "message": "Merge branch 'master' of github.com:all-of-us/workbench into songe/RW-3177", "committedDate": "2020-02-05T16:13:44Z", "type": "commit"}, {"oid": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "url": "https://github.com/all-of-us/workbench/commit/516a5d425045bf421b2983f099aae3aea3e5c5fc", "message": "lint", "committedDate": "2020-02-05T16:46:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzOTA2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375539061", "bodyText": "nit: What's with the filename? \"lockup\"?", "author": "calbach", "createdAt": "2020-02-05T22:16:20Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = ({onClose}) => {\n+  return <Modal width={600} onRequestClose={() => onClose()}>\n+    <ModalTitle>Create a billing account</ModalTitle>\n+\n+    <ModalBody>\n+      <FlexColumn style={{alignItems: 'flex-start'}}>\n+        <img style={{width: '12rem', marginLeft: '-1.2rem'}} src='/assets/images/logo_lockup_cloud_rgb.png'/>", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA0ODg1MA==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r376048850", "bodyText": "not sure but that's what the filename was called from the logo pack. I've renamed it to something less verbose for us.", "author": "ericsong", "createdAt": "2020-02-06T19:54:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzOTA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzOTIzNA==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375539234", "bodyText": "presumably typo: \"by via\"", "author": "calbach", "createdAt": "2020-02-05T22:16:45Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = ({onClose}) => {\n+  return <Modal width={600} onRequestClose={() => onClose()}>\n+    <ModalTitle>Create a billing account</ModalTitle>\n+\n+    <ModalBody>\n+      <FlexColumn style={{alignItems: 'flex-start'}}>\n+        <img style={{width: '12rem', marginLeft: '-1.2rem'}} src='/assets/images/logo_lockup_cloud_rgb.png'/>\n+\n+        <TextColumn>\n+          <div>Billing accounts are managed by via Google Cloud Platform.</div>", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzOTc5Mw==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375539793", "bodyText": "commented on the mocks too, but this is not a sentence, seems like it should be joined with the next link (can wait for Karthik/Lou to address)", "author": "calbach", "createdAt": "2020-02-05T22:18:05Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = ({onClose}) => {\n+  return <Modal width={600} onRequestClose={() => onClose()}>\n+    <ModalTitle>Create a billing account</ModalTitle>\n+\n+    <ModalBody>\n+      <FlexColumn style={{alignItems: 'flex-start'}}>\n+        <img style={{width: '12rem', marginLeft: '-1.2rem'}} src='/assets/images/logo_lockup_cloud_rgb.png'/>\n+\n+        <TextColumn>\n+          <div>Billing accounts are managed by via Google Cloud Platform.</div>\n+          <div>Learn more on how to set up a billing account.</div>\n+        </TextColumn>\n+\n+        <Button type='primary'\n+                style={{fontWeight: 400, padding: '0 18px', height: '40px'}}\n+                onClick={() => onClose()}>\n+          Read Instructions\n+        </Button>\n+      </FlexColumn>\n+    </ModalBody>\n+\n+    <hr style={{width: '100%', backgroundColor: colors.primary, borderWidth: '0px', height: '1px',\n+      marginTop: '1rem',\n+      marginBottom: '0.5rem'}}/>\n+\n+    <ModalFooter style={{marginTop: 0, justifyContent: 'flex-start'}}>\n+      <FlexColumn>\n+        <TextColumn>\n+          <p style={{marginTop: 0}}>If you do not have a Google Cloud billing account.</p>", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0NTI0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375545241", "bodyText": "I made a comment on the mocks. I think this wording is way too imprecise to be useful. Also, since there are several accounts referred to here, I think it will be much more readable to simply inline the current user account name, instead of referring to it generically as \"your aou user account\"", "author": "calbach", "createdAt": "2020-02-05T22:31:33Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = ({onClose}) => {\n+  return <Modal width={600} onRequestClose={() => onClose()}>\n+    <ModalTitle>Create a billing account</ModalTitle>\n+\n+    <ModalBody>\n+      <FlexColumn style={{alignItems: 'flex-start'}}>\n+        <img style={{width: '12rem', marginLeft: '-1.2rem'}} src='/assets/images/logo_lockup_cloud_rgb.png'/>\n+\n+        <TextColumn>\n+          <div>Billing accounts are managed by via Google Cloud Platform.</div>\n+          <div>Learn more on how to set up a billing account.</div>\n+        </TextColumn>\n+\n+        <Button type='primary'\n+                style={{fontWeight: 400, padding: '0 18px', height: '40px'}}\n+                onClick={() => onClose()}>\n+          Read Instructions\n+        </Button>\n+      </FlexColumn>\n+    </ModalBody>\n+\n+    <hr style={{width: '100%', backgroundColor: colors.primary, borderWidth: '0px', height: '1px',\n+      marginTop: '1rem',\n+      marginBottom: '0.5rem'}}/>\n+\n+    <ModalFooter style={{marginTop: 0, justifyContent: 'flex-start'}}>\n+      <FlexColumn>\n+        <TextColumn>\n+          <p style={{marginTop: 0}}>If you do not have a Google Cloud billing account.</p>\n+          <a href='https://cloud.google.com' target='_blank'>Create billing account</a>\n+        </TextColumn>\n+\n+        <TextColumn>\n+          <div>Add your <i>All of Us</i> user account to your existing Google Cloud account.</div>", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0NzM3Mw==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375547373", "bodyText": "This seems like kind of a dead end user flow - is there supposed to be some guidance here around refreshing the page once you've finished these steps? Or perhaps should it reload the billing account list upon closing the modal?", "author": "calbach", "createdAt": "2020-02-05T22:37:07Z", "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -890,8 +901,16 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n             </div>\n             <Dropdown style={{width: '14rem'}}\n                       value={this.state.workspace.billingAccountName}\n-                      options={this.state.billingAccounts.map(a => ({label: a.displayName, value: a.name}))}\n-                      onChange={e => this.setState(fp.set(['workspace', 'billingAccountName'], e.value))}\n+                      options={this.buildBillingAccountOptions()}\n+                      onChange={e => {\n+                        if (e.value === CREATE_BILLING_ACCOUNT_OPTION_VALUE) {\n+                          this.setState({\n+                            showCreateBillingAccountModal: true", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU3NDc1OQ==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r376574759", "bodyText": "I chatted with Lou and Karthik. I think the plan is to add an instruction to the zendesk page, telling the user to refresh.", "author": "ericsong", "createdAt": "2020-02-07T19:46:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0NzM3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0Nzk0Mg==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375547942", "bodyText": "Is this pending getting the right link? CLosing doesn't seem correct here", "author": "calbach", "createdAt": "2020-02-05T22:38:34Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = ({onClose}) => {\n+  return <Modal width={600} onRequestClose={() => onClose()}>\n+    <ModalTitle>Create a billing account</ModalTitle>\n+\n+    <ModalBody>\n+      <FlexColumn style={{alignItems: 'flex-start'}}>\n+        <img style={{width: '12rem', marginLeft: '-1.2rem'}} src='/assets/images/logo_lockup_cloud_rgb.png'/>\n+\n+        <TextColumn>\n+          <div>Billing accounts are managed by via Google Cloud Platform.</div>\n+          <div>Learn more on how to set up a billing account.</div>\n+        </TextColumn>\n+\n+        <Button type='primary'\n+                style={{fontWeight: 400, padding: '0 18px', height: '40px'}}\n+                onClick={() => onClose()}>", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA0NzY5OA==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r376047698", "bodyText": "I was going to ship it w/o the real links (see description) since it was unclear when they would be ready.\nI've added them in since they are now.", "author": "ericsong", "createdAt": "2020-02-06T19:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0Nzk0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0ODA0Nw==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r375548047", "bodyText": "I don't see a close modal button in the screenshot, per the mocks.", "author": "calbach", "createdAt": "2020-02-05T22:38:50Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = ({onClose}) => {\n+  return <Modal width={600} onRequestClose={() => onClose()}>", "originalCommit": "516a5d425045bf421b2983f099aae3aea3e5c5fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6d9ca28d89834709c790d82af27549ba91ecfe6a", "url": "https://github.com/all-of-us/workbench/commit/6d9ca28d89834709c790d82af27549ba91ecfe6a", "message": "add username to modal. update text", "committedDate": "2020-02-06T18:49:18Z", "type": "commit"}, {"oid": "ed94f8722b761a5377cb8fb97d11a09ff3c29be9", "url": "https://github.com/all-of-us/workbench/commit/ed94f8722b761a5377cb8fb97d11a09ff3c29be9", "message": "replace logo. add close icon", "committedDate": "2020-02-06T19:14:03Z", "type": "commit"}, {"oid": "8d2ecd197289c66e48372d8bc32b711481aedf6b", "url": "https://github.com/all-of-us/workbench/commit/8d2ecd197289c66e48372d8bc32b711481aedf6b", "message": "pass in environment specific help url", "committedDate": "2020-02-07T15:24:44Z", "type": "commit"}, {"oid": "3254813ec08e4af8dd77f32edc1f3c4e07272ffc", "url": "https://github.com/all-of-us/workbench/commit/3254813ec08e4af8dd77f32edc1f3c4e07272ffc", "message": "add tip", "committedDate": "2020-02-07T17:04:33Z", "type": "commit"}, {"oid": "4f79d29cdbc0557c9b66ec247eed0194f24acd0f", "url": "https://github.com/all-of-us/workbench/commit/4f79d29cdbc0557c9b66ec247eed0194f24acd0f", "message": "Revert \"add tip\"\n\nThis reverts commit 3254813ec08e4af8dd77f32edc1f3c4e07272ffc.", "committedDate": "2020-02-07T19:39:44Z", "type": "commit"}, {"oid": "11007ba61b2313f0be92d06540a0643cfec8172b", "url": "https://github.com/all-of-us/workbench/commit/11007ba61b2313f0be92d06540a0643cfec8172b", "message": "Merge branch 'songe/RW-3177' of github.com:all-of-us/workbench into songe/RW-3177", "committedDate": "2020-02-07T19:43:31Z", "type": "commit"}, {"oid": "ac51f987cbf577e72f89002354a2edec4459ece6", "url": "https://github.com/all-of-us/workbench/commit/ac51f987cbf577e72f89002354a2edec4459ece6", "message": "use test url", "committedDate": "2020-02-07T19:45:03Z", "type": "commit"}, {"oid": "e2df337a357e593e8f0bc3339020886f36bcb479", "url": "https://github.com/all-of-us/workbench/commit/e2df337a357e593e8f0bc3339020886f36bcb479", "message": "lint", "committedDate": "2020-02-07T20:01:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MjI4Mg==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r376582282", "bodyText": "Shouldn't these go to the Zendesk help URLs? If not, this seems like it should be the same URL as the other link below.", "author": "calbach", "createdAt": "2020-02-07T20:03:58Z", "path": "ui/src/app/pages/workspace/create-billing-account-modal.tsx", "diffHunk": "@@ -0,0 +1,76 @@\n+import {faTimes} from '@fortawesome/free-solid-svg-icons';\n+import {FontAwesomeIcon} from '@fortawesome/react-fontawesome';\n+import {Button} from 'app/components/buttons';\n+import {FlexColumn} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {TextColumn} from 'app/components/text-column';\n+import colors from 'app/styles/colors';\n+import {withUserProfile} from 'app/utils';\n+import {environment} from 'environments/environment';\n+import {Profile} from 'generated/fetch';\n+import * as React from 'react';\n+\n+export const CreateBillingAccountModal = withUserProfile() (\n+  class extends React.Component<{\n+    profileState: {profile: Profile},\n+    onClose: Function\n+  }, {}> {\n+    constructor(props) {\n+      super(props);\n+    }\n+\n+    render() {\n+      return <Modal width={600} onRequestClose={() => this.props.onClose()}>\n+        <ModalTitle style={{marginBottom: '0.7rem'}}>Create a billing account</ModalTitle>\n+\n+        <ModalBody>\n+          <FlexColumn style={{alignItems: 'flex-start'}}>\n+            <img style={{width: '12rem', marginLeft: '-0.7rem'}} src='/assets/images/gcp_logo.png'/>\n+\n+            <TextColumn>\n+              <div>Billing accounts are managed via Google Cloud Platform\u2122 service.</div>\n+              <div>Learn more on how to set up a billing account.</div>\n+            </TextColumn>\n+\n+            <Button type='primary'\n+                    style={{fontWeight: 400, padding: '0 18px', height: '40px'}}\n+                    onClick={() => window.open(environment.createBillingAccountHelpUrl, '_blank')}>\n+              Read Instructions\n+            </Button>\n+          </FlexColumn>\n+        </ModalBody>\n+\n+        <hr style={{width: '100%', backgroundColor: colors.primary, borderWidth: '0px', height: '1px',\n+          marginTop: '1rem',\n+          marginBottom: '0.5rem'}}/>\n+\n+        <ModalFooter style={{marginTop: 0, justifyContent: 'flex-start'}}>\n+          <FlexColumn>\n+            <TextColumn>\n+              <p style={{marginTop: 0}}>Don't already have a Google Cloud account?</p>\n+              <a href='https://cloud.google.com' target='_blank'>Create billing account</a>", "originalCommit": "e2df337a357e593e8f0bc3339020886f36bcb479", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE3NDU3OQ==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r377174579", "bodyText": "Hmm, I think the idea was that the user should be creating a Google account at this step and not a billing account. I will check with Karthik.\nEdit - changed the wording from \"Create billing account\" to \"Create an account\"", "author": "ericsong", "createdAt": "2020-02-10T16:32:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MjI4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4NDk0NA==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r376584944", "bodyText": "Fair amount of duplication here, WDYT about just including the article ID here and then combining the rest in code?", "author": "calbach", "createdAt": "2020-02-07T20:10:29Z", "path": "ui/src/environments/environment.local.ts", "diffHunk": "@@ -15,6 +15,7 @@ export const environment: Environment = {\n   gaUserAgentDimension: 'dimension1',\n   gaLoggedInDimension: 'dimension2',\n   zendeskHelpCenterUrl: 'https://aousupporthelp1580753096.zendesk.com/hc',\n+  createBillingAccountHelpUrl: 'https://aousupporthelp1580753096.zendesk.com/hc/en-us/articles/360039550031-Instructions-to-Create-a-Billing-Account',", "originalCommit": "e2df337a357e593e8f0bc3339020886f36bcb479", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE5NjQyNg==", "url": "https://github.com/all-of-us/workbench/pull/3093#discussion_r377196426", "bodyText": "I was thinking about it but in the end decided that the work required was about the same either way and I didn't want to constrain myself to an abstraction I'm not sure about.\nDuplication here doesn't seem too bad to me. I'm guessing the article IDs will have to change anyways if we change the base url.", "author": "ericsong", "createdAt": "2020-02-10T17:08:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4NDk0NA=="}], "type": "inlineReview"}, {"oid": "6fef3089821470d12ac502a7c0df0810b6ac071e", "url": "https://github.com/all-of-us/workbench/commit/6fef3089821470d12ac502a7c0df0810b6ac071e", "message": "wording change'", "committedDate": "2020-02-10T17:08:31Z", "type": "commit"}]}