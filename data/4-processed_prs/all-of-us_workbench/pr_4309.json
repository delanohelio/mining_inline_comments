{"pr_number": 4309, "pr_title": "[RW-5927][risk=low] Replace feature flags for fitbit and COPE survey for flag with appropriate database metadata flagbuilder", "pr_createdAt": "2020-11-19T03:01:15Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4309", "timeline": [{"oid": "c504dfd28beb0cb964a5e95ee1cf93ee068521c8", "url": "https://github.com/all-of-us/workbench/commit/c504dfd28beb0cb964a5e95ee1cf93ee068521c8", "message": "User cdr version fitbit flag", "committedDate": "2020-11-19T02:58:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU2MjEyNQ==", "url": "https://github.com/all-of-us/workbench/pull/4309#discussion_r526562125", "bodyText": "This is the only intentional change, rest are indentation changes.", "author": "NehaBroad", "createdAt": "2020-11-19T03:03:15Z", "path": "ui/src/app/cohort-search/search-group-list/search-group-list.component.tsx", "diffHunk": "@@ -120,93 +123,97 @@ interface Props {\n   role: keyof SearchRequest;\n   updated: number;\n   updateRequest: Function;\n+  workspace: WorkspaceData;\n+  cdrVersionListResponse: CdrVersionListResponse;\n }\n \n interface State {\n   criteriaMenuOptions: any;\n   index: number;\n   loadingMenuOptions: boolean;\n }\n+const SearchGroupList = fp.flow(withCurrentWorkspace(), withCdrVersions())(\n+  class extends React.Component<Props, State> {\n+    private criteriaMenu: any;\n+    private subscription: Subscription;\n+    constructor(props: Props) {\n+      super(props);\n+      this.state = {\n+        criteriaMenuOptions: {programTypes: [], domainTypes: []},\n+        index: 0,\n+        loadingMenuOptions: false\n+      };\n+    }\n \n-export class SearchGroupList extends React.Component<Props, State> {\n-  private criteriaMenu: any;\n-  private subscription: Subscription;\n-  constructor(props: Props) {\n-    super(props);\n-    this.state = {\n-      criteriaMenuOptions: {programTypes: [], domainTypes: []},\n-      index: 0,\n-      loadingMenuOptions: false\n-    };\n-  }\n-\n-  componentDidMount(): void {\n-    const {role} = this.props;\n-    const {cdrVersionId} = currentWorkspaceStore.getValue();\n-    this.subscription = criteriaMenuOptionsStore.subscribe(options => {\n-      if (role === 'includes' && !options[cdrVersionId]) {\n-        this.getMenuOptions();\n-      } else if (!!options[cdrVersionId]) {\n-        this.setState({criteriaMenuOptions: options[cdrVersionId]});\n+    componentDidMount(): void {\n+      const {role} = this.props;\n+      const {cdrVersionId} = currentWorkspaceStore.getValue();\n+      this.subscription = criteriaMenuOptionsStore.subscribe(options => {\n+        if (role === 'includes' && !options[cdrVersionId]) {\n+          this.getMenuOptions();\n+        } else if (!!options[cdrVersionId]) {\n+          this.setState({criteriaMenuOptions: options[cdrVersionId]});\n+        }\n+      });\n+      if (role === 'excludes') {\n+        this.subscription.add(\n+          searchRequestStore.subscribe(sr => this.setState({index: sr.includes.length + 1})));\n       }\n-    });\n-    if (role === 'excludes') {\n-      this.subscription.add(searchRequestStore.subscribe(sr => this.setState({index: sr.includes.length + 1})));\n     }\n-  }\n \n-  componentWillUnmount(): void {\n-    this.subscription.unsubscribe();\n-  }\n+    componentWillUnmount(): void {\n+      this.subscription.unsubscribe();\n+    }\n \n-  getMenuOptions() {\n-    this.setState({loadingMenuOptions: true});\n-    const {cdrVersionId} = currentWorkspaceStore.getValue();\n-    const criteriaMenuOptions = criteriaMenuOptionsStore.getValue();\n-    cohortBuilderApi().findCriteriaMenuOptions(+cdrVersionId).then(res => {\n-      criteriaMenuOptions[cdrVersionId] = res.items.reduce((acc, opt) => {\n-        const {domain, types} = opt;\n-        if (PROGRAM_TYPES.includes(Domain[domain]) &&\n-          !(!serverConfigStore.getValue().enableFitbit && domain === Domain.FITBIT.toString())) {\n-          const option = {\n-            name: domainToTitle(domain),\n-            domain,\n-            type: types[0].type,\n-            standard: types[0].standardFlags[0].standard,\n-            order: PROGRAM_TYPES.indexOf(Domain[domain])\n-          };\n-          if (domain === Domain[Domain.PERSON]) {\n-            option['children'] = types.map(subopt => ({name: typeToTitle(subopt.type), domain, type: subopt.type}));\n+    getMenuOptions() {\n+      this.setState({loadingMenuOptions: true});\n+      const {workspace, cdrVersionListResponse} = this.props;\n+      const {cdrVersionId} = workspace;\n+      const criteriaMenuOptions = criteriaMenuOptionsStore.getValue();\n+      cohortBuilderApi().findCriteriaMenuOptions(+cdrVersionId).then(res => {\n+        criteriaMenuOptions[cdrVersionId] = res.items.reduce((acc, opt) => {\n+          const {domain, types} = opt;\n+          if (PROGRAM_TYPES.includes(Domain[domain]) &&\n+          !(!getCdrVersion(workspace, cdrVersionListResponse).hasFitbitData && domain === Domain.FITBIT.toString())) {", "originalCommit": "c504dfd28beb0cb964a5e95ee1cf93ee068521c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "59fe928a3c4e7d67b256a8545a1a946366d3c16e", "url": "https://github.com/all-of-us/workbench/commit/59fe928a3c4e7d67b256a8545a1a946366d3c16e", "message": "Flag for Cope Survey", "committedDate": "2020-11-19T16:19:51Z", "type": "commit"}, {"oid": "9b53af424bf7c196bc5480b5eef0d251e0379cbd", "url": "https://github.com/all-of-us/workbench/commit/9b53af424bf7c196bc5480b5eef0d251e0379cbd", "message": "Correct indentation", "committedDate": "2020-11-19T16:23:26Z", "type": "commit"}, {"oid": "3cd346ebcea603b70feba137a20e1721888b8bf0", "url": "https://github.com/all-of-us/workbench/commit/3cd346ebcea603b70feba137a20e1721888b8bf0", "message": "More readable", "committedDate": "2020-11-19T16:26:04Z", "type": "commit"}, {"oid": "164c057afad3a9f8f7fd78786a2b583ad0e7b076", "url": "https://github.com/all-of-us/workbench/commit/164c057afad3a9f8f7fd78786a2b583ad0e7b076", "message": "More readable", "committedDate": "2020-11-19T16:28:56Z", "type": "commit"}, {"oid": "a22a118807636892509e591e09a7543167e50db6", "url": "https://github.com/all-of-us/workbench/commit/a22a118807636892509e591e09a7543167e50db6", "message": "Fix UI Test", "committedDate": "2020-11-19T20:19:27Z", "type": "commit"}]}