{"pr_number": 3680, "pr_title": "[RW-4398][risk=no] Puppeteer new Concept Sets tests", "pr_createdAt": "2020-06-17T02:00:32Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3680", "timeline": [{"oid": "b6f6e9b4c6f77da69fe2b4794c9c89862899b566", "url": "https://github.com/all-of-us/workbench/commit/b6f6e9b4c6f77da69fe2b4794c9c89862899b566", "message": "ran all tests pass", "committedDate": "2020-06-17T02:19:29Z", "type": "forcePushed"}, {"oid": "f0c1109085c780112c93b61ecf18747f68bea76d", "url": "https://github.com/all-of-us/workbench/commit/f0c1109085c780112c93b61ecf18747f68bea76d", "message": "conceptset-create.spec.ts test file", "committedDate": "2020-06-17T13:45:06Z", "type": "commit"}, {"oid": "f0c1109085c780112c93b61ecf18747f68bea76d", "url": "https://github.com/all-of-us/workbench/commit/f0c1109085c780112c93b61ecf18747f68bea76d", "message": "conceptset-create.spec.ts test file", "committedDate": "2020-06-17T13:45:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0MzgzMw==", "url": "https://github.com/all-of-us/workbench/pull/3680#discussion_r441243833", "bodyText": "The modal class value was changed without knowing who changed. It's quick and easy update to make test pass again.", "author": "aweng98", "createdAt": "2020-06-17T02:24:13Z", "path": "e2e/app/page/cohort-criteria-modal.ts", "diffHunk": "@@ -9,7 +9,7 @@ import Dialog, {ButtonLabel} from 'app/component/dialog';\n import SelectMenu from 'app/component/select-menu';\n import Table from 'app/component/table';\n \n-const defaultXpath = '//*[contains(concat(\" \", normalize-space(@class)), \" crit-modal-container\")]';\n+const defaultXpath = '//*[@class=\"modal-container\"]';", "originalCommit": "b6f6e9b4c6f77da69fe2b4794c9c89862899b566", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "10d574f6171198144affbdb59bc4f69c7a6b35b3", "url": "https://github.com/all-of-us/workbench/commit/10d574f6171198144affbdb59bc4f69c7a6b35b3", "message": "revert create-account-page.ts", "committedDate": "2020-06-17T14:28:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgwNTg2NQ==", "url": "https://github.com/all-of-us/workbench/pull/3680#discussion_r441805865", "bodyText": "these 2 functions are nearly identical, so we can use common code", "author": "jmthibault79", "createdAt": "2020-06-17T20:12:39Z", "path": "e2e/app/component/concept-domain-card.ts", "diffHunk": "@@ -0,0 +1,68 @@\n+import {Page} from 'puppeteer';\n+import {waitWhileLoading} from 'utils/test-utils';\n+import Button from 'app/element/button';\n+import Container from 'app/container';\n+\n+export enum Domain {\n+   Conditions = 'Conditions',\n+   DrugExposures = 'Drug Exposures',\n+   Measurements = 'Measurements',\n+   Observations =  'Observations',\n+   Procedures = 'Procedures',\n+}\n+\n+const domainCardSelector = {\n+  cardXpath: '//*[@data-test-id=\"domain-box\"]',\n+}\n+\n+export default class ConceptDomainCard extends Container {\n+\n+  static findDomainCard(page: Page, domain: Domain): ConceptDomainCard {\n+    const selector = `${domainCardSelector.cardXpath}[child::*[@tabindex=\"0\" and @role=\"button\" and text()=\"${domain}\"]]`;\n+    return new ConceptDomainCard(page, selector);\n+  }\n+\n+  private constructor(page: Page, xpath: string) {\n+    super(page, xpath);\n+  }\n+\n+  async clickSelectConceptButton(): Promise<void> {\n+    const selectConceptButton = await this.getSelectConceptButton();\n+    await selectConceptButton.click();\n+    await this.page.waitForXPath('//*[@data-test-id=\"conceptTable\"]', {visible: true});\n+    await waitWhileLoading(this.page);\n+  }\n+\n+   /**\n+    * Find displayed number of Participants in this domain.\n+    */\n+  async getParticipantsCount(): Promise<string> {", "originalCommit": "10d574f6171198144affbdb59bc4f69c7a6b35b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxNjg2Mg==", "url": "https://github.com/all-of-us/workbench/pull/3680#discussion_r441916862", "bodyText": "yes. made a common function\nprivate async extractConceptsCount(selector: string): Promise<string> {\n    const elemt = await this.page.waitForXPath(selector, {visible: true});\n    const textContent = await elemt.getProperty('textContent');\n    const value = (await textContent.jsonValue()).toString();\n    const regex = new RegExp(/\\d{1,3}(,?\\d{3})*/); // Match numbers with comma\n    return (regex.exec(value))[0];\n  }\n\nnew function is called in getConceptsCount() and getParticipantsCount().", "author": "aweng98", "createdAt": "2020-06-18T01:23:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgwNTg2NQ=="}], "type": "inlineReview"}, {"oid": "edbf2930e8971265387bba475751c3233d4a8689", "url": "https://github.com/all-of-us/workbench/commit/edbf2930e8971265387bba475751c3233d4a8689", "message": "PR feedback", "committedDate": "2020-06-18T01:21:16Z", "type": "commit"}]}