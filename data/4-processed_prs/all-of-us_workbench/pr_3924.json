{"pr_number": 3924, "pr_title": "[risk=no][RW-4362] Remove classes and fields relating to the pre-verification institutional affiliation", "pr_createdAt": "2020-08-26T19:51:50Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3924", "timeline": [{"oid": "df6b929247df7b51e957964b7df099e6fe061b75", "url": "https://github.com/all-of-us/workbench/commit/df6b929247df7b51e957964b7df099e6fe061b75", "message": "Remove old-style inst-affile references from ProfileTargetProperty and ProfileAuditorTest", "committedDate": "2020-08-26T19:43:02Z", "type": "commit"}, {"oid": "f63b4fa4e6d8f9edf8311aa8ee567accdb35cc2a", "url": "https://github.com/all-of-us/workbench/commit/f63b4fa4e6d8f9edf8311aa8ee567accdb35cc2a", "message": "rm deprecated institutional-affiliation structures", "committedDate": "2020-08-26T19:43:25Z", "type": "commit"}, {"oid": "631958188442540493202b79ba4cef45088da9a6", "url": "https://github.com/all-of-us/workbench/commit/631958188442540493202b79ba4cef45088da9a6", "message": "rm DbInstitutionalAffiliation and InstitutionalAffiliationMapper", "committedDate": "2020-08-26T19:43:26Z", "type": "commit"}, {"oid": "ac599b3ba2024f9c707b5a51a1100a19dc709a87", "url": "https://github.com/all-of-us/workbench/commit/ac599b3ba2024f9c707b5a51a1100a19dc709a87", "message": "rm missing fields from DbStorageEnums and DemographicSurveyEnum", "committedDate": "2020-08-26T19:43:26Z", "type": "commit"}, {"oid": "260d4ccfb79469bef6b032cf6a0ad08b93144404", "url": "https://github.com/all-of-us/workbench/commit/260d4ccfb79469bef6b032cf6a0ad08b93144404", "message": "update ProfileService to remove old-inst-affil references", "committedDate": "2020-08-26T19:44:17Z", "type": "commit"}, {"oid": "603b07a5de19b4eb2434ad537b4c928bd94589cc", "url": "https://github.com/all-of-us/workbench/commit/603b07a5de19b4eb2434ad537b4c928bd94589cc", "message": "rm old-inst tests from ProfileControllerTest and ProfileServiceTest", "committedDate": "2020-08-26T19:44:53Z", "type": "commit"}, {"oid": "035730e7bc9c78826c8212f2c6603d187c46fc55", "url": "https://github.com/all-of-us/workbench/commit/035730e7bc9c78826c8212f2c6603d187c46fc55", "message": "rm old-inst from account-creation-options.tsx", "committedDate": "2020-08-26T22:06:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5ODcxMQ==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r477698711", "bodyText": "@jaycarlton just to confirm: we're free to alter these, right?  nothing depends on these names?", "author": "jmthibault79", "createdAt": "2020-08-26T23:46:31Z", "path": "api/src/main/java/org/pmiops/workbench/actionaudit/targetproperties/ProfileTargetProperty.kt", "diffHunk": "@@ -17,8 +17,7 @@ constructor(override val propertyName: String, override val extractor: (Profile)\n     DISABLED(\"disabled\", { it.disabled?.toString() }),\n     ABOUT_YOU(\"about_you\", Profile::getAboutYou),\n     AREA_OF_RESEARCH(\"area_of_research\", Profile::getAreaOfResearch),\n-    INSTITUTIONAL_AFFILIATIONS(\"institutional_affiliations\",\n-            { it.institutionalAffiliations?.joinToString(\", \") }),\n+    AFFILIATION(\"affiliation\", { it.verifiedInstitutionalAffiliation?.toString() }),", "originalCommit": "035730e7bc9c78826c8212f2c6603d187c46fc55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQwMDg2Ng==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478400866", "bodyText": "Technically you can change the enum constant name, but NOT the first argument. That's what goes in the property name column in the log, so it's part of the contract.\nThat said, if it's truly a new field, and you don't want to mix the new values with the old ones in a query, we should add a new one and I guess have the old one always return null so it's never changed. I haven't really had to deprecate a property before, so it's worth taking a minute to discuss. Wastes a tiny bit of log space, but it won't knock over BQ.\nMy preference here is to leave the names as-is and in post-processing, take the first one in the list.", "author": "jaycarlton", "createdAt": "2020-08-27T13:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5ODcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ3NzM3MQ==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478477371", "bodyText": "ok, thanks.\nadding a new field makes sense here since the format of the affiliations have changed - it would be confusing to mix them.", "author": "jmthibault79", "createdAt": "2020-08-27T14:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5ODcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MTMxNA==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478561314", "bodyText": "\ud83d\udc4d", "author": "jaycarlton", "createdAt": "2020-08-27T16:53:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5ODcxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5OTY3Mg==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r477699672", "bodyText": "Waiting at least one release cycle before deleting this table", "author": "jmthibault79", "createdAt": "2020-08-26T23:47:07Z", "path": "api/src/main/java/org/pmiops/workbench/db/model/DbInstitutionalAffiliation.java", "diffHunk": "@@ -1,103 +0,0 @@\n-package org.pmiops.workbench.db.model;\n-\n-import javax.persistence.Column;\n-import javax.persistence.Entity;\n-import javax.persistence.GeneratedValue;\n-import javax.persistence.GenerationType;\n-import javax.persistence.Id;\n-import javax.persistence.JoinColumn;\n-import javax.persistence.ManyToOne;\n-import javax.persistence.Table;\n-import javax.persistence.Transient;\n-import org.pmiops.workbench.model.NonAcademicAffiliation;\n-\n-// Deprecated because it refers to old-style Institutional Affiliations, to be deleted in RW-4362\n-// The new-style equivalent is DbVerifiedInstitutionalAffiliation\n-@Deprecated\n-@Entity\n-@Table(name = \"institutional_affiliation\")", "originalCommit": "035730e7bc9c78826c8212f2c6603d187c46fc55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwMTgwNw==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r477701807", "bodyText": "Surprised to see this here - I thought we collected all of these in DbStorageEnums", "author": "jmthibault79", "createdAt": "2020-08-26T23:48:33Z", "path": "api/src/main/java/org/pmiops/workbench/db/model/DemographicSurveyEnum.java", "diffHunk": "@@ -77,35 +74,6 @@\n           .put(Disability.FALSE, (short) 2)\n           .build();\n \n-  private static final BiMap<IndustryRole, Short> CLIENT_TO_STORAGE_INDUSTRY_ROLE =", "originalCommit": "035730e7bc9c78826c8212f2c6603d187c46fc55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNDIxNw==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r477704217", "bodyText": "none of these are applicable to the Verified version", "author": "jmthibault79", "createdAt": "2020-08-26T23:50:08Z", "path": "api/src/test/java/org/pmiops/workbench/api/ProfileControllerTest.java", "diffHunk": "@@ -582,104 +579,6 @@ public void testMe_userBeforeNotLoggedInSuccess() {\n         false);\n   }\n \n-  @Deprecated // to be removed in RW-4362", "originalCommit": "035730e7bc9c78826c8212f2c6603d187c46fc55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQwNDc3NA==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478404774", "bodyText": "Do we have equivalent or better coverage of the new stuff?", "author": "jaycarlton", "createdAt": "2020-08-27T13:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNDIxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQwNjE0Nw==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478406147", "bodyText": "Do we have equivalent coverage of the new stuff?", "author": "jaycarlton", "createdAt": "2020-08-27T13:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNDIxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ3NDY1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478474656", "bodyText": "These are about lists of affiliations - no equivalent concept exists.\nEquivalent feature coverage for the general concept of affiliation already exists", "author": "jmthibault79", "createdAt": "2020-08-27T14:45:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNDIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNTg2Ng==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r477705866", "bodyText": "components referencing these were removed on a previous sweep", "author": "jmthibault79", "createdAt": "2020-08-26T23:51:09Z", "path": "ui/src/app/pages/login/account-creation/account-creation-options.tsx", "diffHunk": "@@ -28,43 +24,6 @@ export const AccountCreationOptions = {\n     {label: 'B.S.', value: Degree.BS},\n     {label: 'B.S.N.', value: Degree.BSN},\n   ],\n-  // BEGIN roles and affiliations for old (pre-verification) institutional affiliation", "originalCommit": "035730e7bc9c78826c8212f2c6603d187c46fc55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQwNTMyNw==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478405327", "bodyText": "I'd say check Rainforest scripts, but that's already retired, right?", "author": "jaycarlton", "createdAt": "2020-08-27T13:08:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ3NTU4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478475587", "bodyText": "This can be demonstrated simply by compilation", "author": "jmthibault79", "createdAt": "2020-08-27T14:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUwMTk4NQ==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478501985", "bodyText": "Right, but if we did have references to these labels in Rainforest scripts or help text, that wouldn't be caught by the compiler. Just double-checking.", "author": "jaycarlton", "createdAt": "2020-08-27T15:22:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNTg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1NTkxNw==", "url": "https://github.com/all-of-us/workbench/pull/3924#discussion_r478555917", "bodyText": "Nothing visible to Rainforest (about these consts) is changing in this PR", "author": "jmthibault79", "createdAt": "2020-08-27T16:44:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzcwNTg2Ng=="}], "type": "inlineReview"}, {"oid": "c0b3c92292d0c272a88a4f44a199eceb8d9ba447", "url": "https://github.com/all-of-us/workbench/commit/c0b3c92292d0c272a88a4f44a199eceb8d9ba447", "message": "restore old INSTITUTIONAL_AFFILIATIONS and deprecate", "committedDate": "2020-08-27T14:51:48Z", "type": "commit"}]}