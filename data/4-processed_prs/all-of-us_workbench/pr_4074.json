{"pr_number": 4074, "pr_title": "[RW-5642][risk=no] work around Swagger inconsistency for Typescript Date types", "pr_createdAt": "2020-09-28T13:20:24Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4074", "timeline": [{"oid": "9233da38744af6ca98fbede58820de88b50c11f6", "url": "https://github.com/all-of-us/workbench/commit/9233da38744af6ca98fbede58820de88b50c11f6", "message": "attempt 1", "committedDate": "2020-09-28T13:19:23Z", "type": "commit"}, {"oid": "7ae92aa19d5c4c66a30fa3b91a7aaee85cd3e97e", "url": "https://github.com/all-of-us/workbench/commit/7ae92aa19d5c4c66a30fa3b91a7aaee85cd3e97e", "message": "fixed", "committedDate": "2020-09-28T15:30:36Z", "type": "commit"}, {"oid": "43e55dfc0a19497fae94c11b4a6404b0886674ec", "url": "https://github.com/all-of-us/workbench/commit/43e55dfc0a19497fae94c11b4a6404b0886674ec", "message": "restore file", "committedDate": "2020-09-28T15:31:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r496118134", "bodyText": "If this is actually what we're getting on the wire, then surely it's a bug with the JSON serialization on the server; I can't imagine this verbose payload is the expect wire format for Swagger. This seems like a serialization of some internal Java object representation, i.e. the JSON serialization (presumably for java8 dateLibrary) with date-time does not work.\nIf it's a serialization issue, then patching over it on the client side seems incorrect to me.\nFor now, it may be easier for consistency to follow the unix millis pattern used in the rest of the API (though I would prefer we eventually switch to a string representation instead per https://precisionmedicineinitiative.atlassian.net/browse/RW-4682):\n      creationTime:\n        type: integer\n        format: int64\n        description: Milliseconds since the UNIX epoch.", "author": "calbach", "createdAt": "2020-09-28T17:30:01Z", "path": "ui/src/app/utils/swagger-date.ts", "diffHunk": "@@ -0,0 +1,33 @@\n+\n+// Inferred structure of JSON object coming down the wire for a date-time in Swagger. It's apparently\n+// not a Date as advertised.\n+export interface DateObjectProps {", "originalCommit": "43e55dfc0a19497fae94c11b4a6404b0886674ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE0ODY4NQ==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r496148685", "bodyText": "While this fix may work - I agree with CH on this. My main concern is what happens when the server side response changes/gets \"fixed\"? I would like to have a solid understanding of what is expected/coming over the wire.", "author": "petesantos", "createdAt": "2020-09-28T18:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk5NDY1MQ==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r496994651", "bodyText": "I agree serialization is the  place to look. i had the perspective that like the Hitchhiker's Guide, if the JSON is wrong, it's definitively wrong.\nYes this is a band aid, but I feel like making breaking changes to the API for a hotfix is worse. The blast radius of the fix will be significantly higher.\nFor the purposes of RW-4682, I've removed Joda already from everything except Cohort Builder, and java.time.OffsetDateTime is now the standard on the backend.\nNote that this serialization was broken (in a different way) before the server-side change, where it was somehow sending a millisecond value instead of the verbose format.\nIn  any case, I'd  prefer to start with this fix, because the audit trail is very difficult to use today if you'er not familiar with Chrome dev tools, and I don't really have more time allocated this sprint for it.", "author": "jaycarlton", "createdAt": "2020-09-29T19:33:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwMDQ4NQ==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r497000485", "bodyText": "How would the blast radius be significantly higher? The server-client communication is already broken and this is the only page that uses the value.", "author": "calbach", "createdAt": "2020-09-29T19:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA1OTUzOQ==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r497059539", "bodyText": "Reverting the change to the Java8 is the main thing I want to avoid, since the reporting stuff uses it in  several places.", "author": "jaycarlton", "createdAt": "2020-09-29T21:06:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA4NjExMA==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r497086110", "bodyText": "My suggestion was to switch the type to int for consistency with our other timestamps.", "author": "calbach", "createdAt": "2020-09-29T22:01:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU0ODUzOA==", "url": "https://github.com/all-of-us/workbench/pull/4074#discussion_r497548538", "bodyText": "Sure, I can do that for now.", "author": "jaycarlton", "createdAt": "2020-09-30T14:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExODEzNA=="}], "type": "inlineReview"}, {"oid": "3ddc4b467b8439f7550a559fd7865a514d8d1408", "url": "https://github.com/all-of-us/workbench/commit/3ddc4b467b8439f7550a559fd7865a514d8d1408", "message": "Merge branch 'master' into jaycarlton/RW-5642", "committedDate": "2020-09-29T11:33:09Z", "type": "commit"}, {"oid": "70b709ce60cfedda4c6ce9fd9d5695748bed0d18", "url": "https://github.com/all-of-us/workbench/commit/70b709ce60cfedda4c6ce9fd9d5695748bed0d18", "message": "Merge branch 'master' into jaycarlton/RW-5642", "committedDate": "2020-09-30T14:20:24Z", "type": "commit"}, {"oid": "754226380e97525d085babb3d5edffae674e8d22", "url": "https://github.com/all-of-us/workbench/commit/754226380e97525d085babb3d5edffae674e8d22", "message": "use epoch millis in response type", "committedDate": "2020-09-30T14:39:14Z", "type": "commit"}, {"oid": "e7c084e78b82a1b099c5469ea863af7ed8370d16", "url": "https://github.com/all-of-us/workbench/commit/e7c084e78b82a1b099c5469ea863af7ed8370d16", "message": "use millis instead of trying to serialize actual date-time object", "committedDate": "2020-09-30T15:22:48Z", "type": "commit"}, {"oid": "e1a74fbf76f0b54425a833664e3f36761a1c2b4d", "url": "https://github.com/all-of-us/workbench/commit/e1a74fbf76f0b54425a833664e3f36761a1c2b4d", "message": "Merge branch 'master' into jaycarlton/RW-5642", "committedDate": "2020-10-01T14:51:21Z", "type": "commit"}, {"oid": "13e2a3835b3e9b658443a2d59e3761e288c2fbdd", "url": "https://github.com/all-of-us/workbench/commit/13e2a3835b3e9b658443a2d59e3761e288c2fbdd", "message": "unit test updates", "committedDate": "2020-10-01T15:01:47Z", "type": "commit"}]}