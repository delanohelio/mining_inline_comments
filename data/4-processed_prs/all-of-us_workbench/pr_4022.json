{"pr_number": 4022, "pr_title": "[no ticket][risk=no] Puppeteer Login class change", "pr_createdAt": "2020-09-17T23:55:31Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4022", "timeline": [{"oid": "5b47d3990486ac41bd537bd4a62eabcb0eaa8ce7", "url": "https://github.com/all-of-us/workbench/commit/5b47d3990486ac41bd537bd4a62eabcb0eaa8ce7", "message": "refactor login function", "committedDate": "2020-09-22T14:08:48Z", "type": "commit"}, {"oid": "4e157e04292acdbe04b7ab8875f3b9e4b02d7510", "url": "https://github.com/all-of-us/workbench/commit/4e157e04292acdbe04b7ab8875f3b9e4b02d7510", "message": "update", "committedDate": "2020-09-22T15:37:43Z", "type": "commit"}, {"oid": "9efb5733c9747b8530f0e740e117ad784ff18722", "url": "https://github.com/all-of-us/workbench/commit/9efb5733c9747b8530f0e740e117ad784ff18722", "message": "log failed requests", "committedDate": "2020-09-22T16:54:23Z", "type": "commit"}, {"oid": "9efb5733c9747b8530f0e740e117ad784ff18722", "url": "https://github.com/all-of-us/workbench/commit/9efb5733c9747b8530f0e740e117ad784ff18722", "message": "log failed requests", "committedDate": "2020-09-22T16:54:23Z", "type": "forcePushed"}, {"oid": "d8284d189fdf7d8dd2602775e81deef797a9545f", "url": "https://github.com/all-of-us/workbench/commit/d8284d189fdf7d8dd2602775e81deef797a9545f", "message": "undo test-setup change", "committedDate": "2020-09-22T19:22:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3OTY1Mg==", "url": "https://github.com/all-of-us/workbench/pull/4022#discussion_r492979652", "bodyText": "Write errors to console if login redirects fail.", "author": "aweng98", "createdAt": "2020-09-22T19:24:35Z", "path": "e2e/app/page/google-login.ts", "diffHunk": "@@ -79,14 +81,24 @@ export default class GoogleLoginPage {\n   async enterPassword(pwd: string) : Promise<void> {\n     const input = await this.password();\n     await input.focus();\n-    await input.type(pwd);\n+    await input.type(pwd, {delay: 15});\n+    await input.dispose();\n   }\n \n   /**\n    * Click Next button to submit login credential.\n    */\n   async submit() : Promise<void> {\n-    return (new Button(this.page, FieldSelector.SubmitButton)).clickAndWait();\n+    const submitButton = new Button(this.page, FieldSelector.SubmitButton);\n+    const [response] = await Promise.all([\n+      this.page.waitForNavigation({waitUntil: ['networkidle2', 'load'], timeout: 180000}),\n+      submitButton.click(),\n+    ]);\n+    const status = response.status();\n+    if (status !== 200) {\n+      console.error(`Login navigation response status: ${status}`);\n+    }", "originalCommit": "d8284d189fdf7d8dd2602775e81deef797a9545f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4NjgyNg==", "url": "https://github.com/all-of-us/workbench/pull/4022#discussion_r492986826", "bodyText": "what does 'networkidle2' mean?", "author": "als364", "createdAt": "2020-09-22T19:38:07Z", "path": "e2e/app/page/google-login.ts", "diffHunk": "@@ -79,14 +81,24 @@ export default class GoogleLoginPage {\n   async enterPassword(pwd: string) : Promise<void> {\n     const input = await this.password();\n     await input.focus();\n-    await input.type(pwd);\n+    await input.type(pwd, {delay: 15});\n+    await input.dispose();\n   }\n \n   /**\n    * Click Next button to submit login credential.\n    */\n   async submit() : Promise<void> {\n-    return (new Button(this.page, FieldSelector.SubmitButton)).clickAndWait();\n+    const submitButton = new Button(this.page, FieldSelector.SubmitButton);\n+    const [response] = await Promise.all([\n+      this.page.waitForNavigation({waitUntil: ['networkidle2', 'load'], timeout: 180000}),", "originalCommit": "d8284d189fdf7d8dd2602775e81deef797a9545f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxMjczNQ==", "url": "https://github.com/all-of-us/workbench/pull/4022#discussion_r493012735", "bodyText": "Both networkidle0 and networkidle2 are ways to determine page load state by checking number of open requests.\nI am experimenting with networkidle2 because sometimes tests fail in Home page after login. But nothing (checking screenshot and html file) wrong can be found. I suspect networkidle0 has bug.", "author": "aweng98", "createdAt": "2020-09-22T20:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4NjgyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5NjExNA==", "url": "https://github.com/all-of-us/workbench/pull/4022#discussion_r492996114", "bodyText": "Why is this getting removed from the try?", "author": "als364", "createdAt": "2020-09-22T19:55:24Z", "path": "e2e/app/page/google-login.ts", "diffHunk": "@@ -107,21 +119,18 @@ export default class GoogleLoginPage {\n     const user = email || config.userEmail;\n     const pwd = paswd || config.userPassword;\n \n+    if (!user || user.trim().length === 0) {", "originalCommit": "d8284d189fdf7d8dd2602775e81deef797a9545f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxODM1Ng==", "url": "https://github.com/all-of-us/workbench/pull/4022#discussion_r493018356", "bodyText": "Problem if any usually happens after click Next button (after entering password).", "author": "aweng98", "createdAt": "2020-09-22T20:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5NjExNA=="}], "type": "inlineReview"}]}