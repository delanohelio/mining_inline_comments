{"pr_number": 5046, "pr_title": "impr iso19139 jsonld formatter", "pr_createdAt": "2020-09-24T20:31:22Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/5046", "timeline": [{"oid": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d", "url": "https://github.com/geonetwork/core-geonetwork/commit/95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d", "message": "split out contacts to multiple roles\nif license is a url, use it else introduce it as a creative work", "committedDate": "2020-09-24T20:26:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgwMjY5Mg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#discussion_r495802692", "bodyText": "This code adds any gmd:contact as provider, in the previous version that element was not processed. To confirm that is ok.", "author": "josegar74", "createdAt": "2020-09-28T09:22:01Z", "path": "schemas/iso19139/src/main/plugin/iso19139/formatter/jsonld/iso19139-to-jsonld.xsl", "diffHunk": "@@ -185,67 +185,45 @@\n \n \n     <!--\n-    TODO: Dispatch in author, contributor, copyrightHolder, editor, funder,\n+    Dispatch in creator, author, contributor, copyrightHolder, editor, funder,\n     producer, provider, sponsor\n-    TODO: sourceOrganization\n-      <xsl:variable name=\"role\" select=\"*/gmd:role/gmd:CI_RoleCode/@codeListValue\" />\n-      <xsl:choose>\n-        <xsl:when test=\"$role='resourceProvider'\">provider</xsl:when>\n-        <xsl:when test=\"$role='custodian'\">provider</xsl:when>\n-        <xsl:when test=\"$role='owner'\">copyrightHolder</xsl:when>\n-        <xsl:when test=\"$role='user'\">user</xsl:when>\n-        <xsl:when test=\"$role='distributor'\">publisher</xsl:when>\n-        <xsl:when test=\"$role='originator'\">sourceOrganization</xsl:when>\n-        <xsl:when test=\"$role='pointOfContact'\">provider</xsl:when>\n-        <xsl:when test=\"$role='principalInvestigator'\">producer</xsl:when>\n-        <xsl:when test=\"$role='processor'\">provider</xsl:when>\n-        <xsl:when test=\"$role='publisher'\">publisher</xsl:when>\n-        <xsl:when test=\"$role='author'\">author</xsl:when>\n-        <xsl:otherwise>provider</xsl:otherwise>\n-      </xsl:choose>\n-\n     -->\n-    \"publisher\": [\n-      <xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*\">\n-        {\n-        <!-- TODO: Id could also be website if set -->\n-        <xsl:variable name=\"id\"\n-                      select=\"gmd:contactInfo/*/gmd:address/*/gmd:electronicMailAddress/*/text()[1]\"/>\n-        \"@id\":\"<xsl:value-of select=\"$id\"/>\",\n-        \"@type\":\"Organization\"\n-        <xsl:for-each select=\"gmd:organisationName\">\n-          ,\"name\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                       select=\".\"/>\n-        </xsl:for-each>\n-        <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:electronicMailAddress\">\n-          ,\"email\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                       select=\".\"/>\n-        </xsl:for-each>\n \n-        <!-- TODO: only if children available -->\n-        ,\"contactPoint\": {\n-          \"@type\" : \"PostalAddress\"\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:country\">\n-            ,\"addressCountry\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:city\">\n-            ,\"addressLocality\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:postalCode\">\n-            ,\"postalCode\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:deliveryPoint\">\n-            ,\"streetAddress\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          }\n-        }\n-        <xsl:if test=\"position() != last()\">,</xsl:if>\n-      </xsl:for-each>\n-    ]\n+    \"author\": [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='author']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    <xsl:if test=\"position() != last()\">,</xsl:if>\n+    </xsl:for-each>],\n+    \"contributor\": [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='processor']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    <xsl:if test=\"position() != last()\">,</xsl:if>\n+    </xsl:for-each>],\n+    \"creator\": [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='pointOfContact' or gmd:role/gmd:CI_RoleCode/@codeListValue='originator']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    <xsl:if test=\"position() != last()\">,</xsl:if>\n+    </xsl:for-each>],\n+    \"provider\" : [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='resourceProvider' or gmd:role/gmd:CI_RoleCode/@codeListValue='custodian']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    </xsl:for-each>\n+    <xsl:for-each select=\"gmd:contact/*\">", "originalCommit": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk1MTkwNg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#discussion_r495951906", "bodyText": "i see the point, true, not sure if interesting to persist the record properties as properties of the dataset", "author": "pvgenuchten", "createdAt": "2020-09-28T13:46:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgwMjY5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgwMzg0OQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#discussion_r495803849", "bodyText": "What is the reason to set the @type to the value CreativeWork?", "author": "josegar74", "createdAt": "2020-09-28T09:23:57Z", "path": "schemas/iso19139/src/main/plugin/iso19139/formatter/jsonld/iso19139-to-jsonld.xsl", "diffHunk": "@@ -331,14 +309,66 @@\n     <xsl:if test=\"count(gmd:identificationInfo/*/gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:otherConstraints[normalize-space(.) != '']) > 0\"> \n       ,\"license\":  [<xsl:for-each \n         select=\"gmd:identificationInfo/*/gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:otherConstraints\">\n-          <xsl:apply-templates mode=\"toJsonLDLocalized\" select=\".\"/>\n+        <xsl:choose>\n+          <xsl:when test=\"starts-with(normalize-space(string-join(gco:CharacterString/text(),'')),'http') or starts-with(normalize-space(string-join(gco:CharacterString/text(),'')),'//')\">\n+            \"<xsl:value-of select=\"normalize-space(string-join(gco:CharacterString/text(),''))\"/>\"\n+          </xsl:when>\n+          <xsl:when test=\"starts-with(string-join(gmx:Anchor/@xlink:href,''),'http') or starts-with(./@xlink:href,'//')\">\n+            \"<xsl:value-of select=\"string-join(gmx:Anchor/@xlink:href,'')\"/>\"\n+          </xsl:when>\n+          <xsl:otherwise>\n+            {\n+              \"@type\": \"CreativeWork\",", "originalCommit": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk0ODY2NQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#discussion_r495948665", "bodyText": "schema.org requires a url of creativework as value for license", "author": "pvgenuchten", "createdAt": "2020-09-28T13:42:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgwMzg0OQ=="}], "type": "inlineReview"}, {"oid": "e6708107ea199c26b518ce9e4e94a86191b99f9a", "url": "https://github.com/geonetwork/core-geonetwork/commit/e6708107ea199c26b518ce9e4e94a86191b99f9a", "message": "adding comment related to metadata contact as suggested by @josegar74", "committedDate": "2020-09-28T13:51:35Z", "type": "commit"}]}