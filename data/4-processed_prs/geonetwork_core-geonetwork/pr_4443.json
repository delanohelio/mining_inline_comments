{"pr_number": 4443, "pr_title": "Stop infinite CSW harvester loop if start > nextRecord", "pr_createdAt": "2020-02-12T09:28:55Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/4443", "timeline": [{"oid": "d66007cb2cfde94976c6ad2b72e49da421512754", "url": "https://github.com/geonetwork/core-geonetwork/commit/d66007cb2cfde94976c6ad2b72e49da421512754", "message": "Stop infinite harvester loop if start > nextRecord\n\nSome server aren't compliant with CSW specification. In some cases they can  return a value\ndifferent of 0 for nextRecord when the harvester has reached the end of the available\nresults.\nThis commit stops the harvesting loop if the value of `nextResult` returned by the server\nis smaller than the current `start` record.\n\nCould be a complement to #3713.", "committedDate": "2020-02-12T09:22:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI4Mjk5Nw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4443#discussion_r378282997", "bodyText": "This is a nice detailed warning", "author": "jodygarnett", "createdAt": "2020-02-12T14:26:20Z", "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/csw/Harvester.java", "diffHunk": "@@ -375,14 +379,19 @@ private void searchAndAlign(CswServer server, Search s, Set<String> uuids,\n                 break;\n             }\n \n+            // Some misbehaving CSW return nextRecord = 1 when start is over numberOfRecordsMatched\n+            // Break the loop if nextRecord is smaller than start.\n+            if (nextRecord != null && nextRecord < start) {\n+                log.warning(String.format(\"Forcing harvest end since nextRecord < start (nextRecord = %d, start = %d)\", nextRecord, start));", "originalCommit": "d66007cb2cfde94976c6ad2b72e49da421512754", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}