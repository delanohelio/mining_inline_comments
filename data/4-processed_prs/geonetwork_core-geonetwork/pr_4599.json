{"pr_number": 4599, "pr_title": "JNDI support improvements", "pr_createdAt": "2020-04-13T17:38:59Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/4599", "timeline": [{"oid": "f10153223a5d56e0dc5bbb85ccc755587a1c4269", "url": "https://github.com/geonetwork/core-geonetwork/commit/f10153223a5d56e0dc5bbb85ccc755587a1c4269", "message": "JNDI support improvements:\n- Add examples for Tomcat configuration.\n- Change Jetty JNDI to use H2 by default.\n- Support different databases (current support was focus on Postgres).", "committedDate": "2020-04-13T17:37:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE2NzQwMw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408167403", "bodyText": "why are we setting this to public?\ncan't we take this value from the jndi configuration?", "author": "pvgenuchten", "createdAt": "2020-04-14T14:10:59Z", "path": "web/src/main/webResources/WEB-INF/config-db/jndi.xml", "diffHunk": "@@ -62,14 +52,12 @@\n         <entry key=\"Data Source\" value-ref=\"jdbcDataSource\"/>\n         <entry key=\"Loose bbox\" value=\"true\"/>\n         <entry key=\"Estimated extends\" value=\"true\"/>\n-        <entry key=\"schema\" value=\"${database.schema}\" />\n+        <entry key=\"schema\" value=\"public\" />", "originalCommit": "f10153223a5d56e0dc5bbb85ccc755587a1c4269", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5MDgwNw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408190807", "bodyText": "I guess we can add as build property, but the previous one used database.schema was not really defined anywhere, so was not working.\nI don't think can be moved to the container JNDI configuration, as this bean seem required by Geotools also. I'm not an expert in this part, @jodygarnett do you know if this could be completely delegated to the container JNDI configuration.\nIf not I can check at least to make it configurable in the build.", "author": "josegar74", "createdAt": "2020-04-14T14:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE2NzQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzOTI5OQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408239299", "bodyText": "GeoTools uses the JNDI name, and whatever database.schema that connection was configured with. See docs.", "author": "jodygarnett", "createdAt": "2020-04-14T15:42:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE2NzQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY1NjYwMQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408656601", "bodyText": "Updated to remove the parameter and rely on the JNDI resource configuration.", "author": "josegar74", "createdAt": "2020-04-15T08:06:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE2NzQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY2MzI5Mg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408663292", "bodyText": "afaik schema needs to be defined on two locations dns?currentschema=aaa, but also on config-spring-geonework.xml, one is used by hibernate, other by upgrade scripts. see also #2889", "author": "pvgenuchten", "createdAt": "2020-04-15T08:18:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE2NzQwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3MDY2NQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408170665", "bodyText": "can we provide some guidance here, like:\n\nmove this file into tomcat/conf folder (I guess this is the step required?)\nfill relevant connection parameters\nread more about jndi in tomcat at ...", "author": "pvgenuchten", "createdAt": "2020-04-14T14:15:22Z", "path": "web/src/main/webResources/WEB-INF/config-db/jndiExamples_tomcat/oracle_JNDI_Example.xml", "diffHunk": "@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright (C) 2001-2016 Food and Agriculture Organization of the\n+  ~ United Nations (FAO-UN), United Nations World Food Programme (WFP)\n+  ~ and United Nations Environment Programme (UNEP)\n+  ~\n+  ~ This program is free software; you can redistribute it and/or modify\n+  ~ it under the terms of the GNU General Public License as published by\n+  ~ the Free Software Foundation; either version 2 of the License, or (at\n+  ~ your option) any later version.\n+  ~\n+  ~ This program is distributed in the hope that it will be useful, but\n+  ~ WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU General Public License\n+  ~ along with this program; if not, write to the Free Software\n+  ~ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA\n+  ~\n+  ~ Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,\n+  ~ Rome - Italy. email: geonetwork@osgeo.org\n+  -->", "originalCommit": "f10153223a5d56e0dc5bbb85ccc755587a1c4269", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5NDEzNw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408194137", "bodyText": "Sounds good, part of these instructions are in README.md file, we can improve it and reference it from the sample files", "author": "josegar74", "createdAt": "2020-04-14T14:45:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3MDY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY1NjkwMQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408656901", "bodyText": "Added additional documentation and example: f101532", "author": "josegar74", "createdAt": "2020-04-15T08:06:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3MDY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY2MzU5OA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408663598", "bodyText": "thanx!", "author": "pvgenuchten", "createdAt": "2020-04-15T08:18:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3MDY2NQ=="}], "type": "inlineReview"}, {"oid": "e9aaad92709f0c70e1c87635f858ffe7cc377774", "url": "https://github.com/geonetwork/core-geonetwork/commit/e9aaad92709f0c70e1c87635f858ffe7cc377774", "message": "JNDI support improvements - remove schema from postgis JNDI datastore, should use the schema configured in the JNDI (https://docs.geotools.org/stable/userguide/library/jdbc/datastore.html#using-jndi)", "committedDate": "2020-04-15T07:42:55Z", "type": "commit"}, {"oid": "ccc7f0fc792c6d5e3f57acec22d6ecf0ec50c1fc", "url": "https://github.com/geonetwork/core-geonetwork/commit/ccc7f0fc792c6d5e3f57acec22d6ecf0ec50c1fc", "message": "JNDI support improvements - additional documentation", "committedDate": "2020-04-15T08:05:37Z", "type": "commit"}]}