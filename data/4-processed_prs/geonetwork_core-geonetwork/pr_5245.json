{"pr_number": 5245, "pr_title": "Use the portal/source label as the name in the menu", "pr_createdAt": "2020-12-07T13:56:45Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/5245", "timeline": [{"oid": "6d02d829382855dabb700dd58f160b05569c41ab", "url": "https://github.com/geonetwork/core-geonetwork/commit/6d02d829382855dabb700dd58f160b05569c41ab", "message": "Use the portal/source name for the menu", "committedDate": "2020-12-07T13:51:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r537540934", "bodyText": "The site API should take care of this https://github.com/geonetwork/core-geonetwork/blob/4.0.x/services/src/main/java/org/fao/geonet/api/site/SiteApi.java#L192-L207\nNode id and name should be set properly https://apps.titellus.net/geonetwork/wise/api/site\nAlso some setup have more than 200 portals and this approach would be slow.", "author": "fxprunayre", "createdAt": "2020-12-07T14:17:47Z", "path": "web-ui/src/main/resources/catalog/js/CatController.js", "diffHunk": "@@ -679,7 +679,17 @@ goog.require('gn_alert');\n               });\n         });\n \n-\n+        // Retreive portal information\n+        var getPortalSources = promiseStart.then(function(value) {", "originalCommit": "6d02d829382855dabb700dd58f160b05569c41ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5NzU4NQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r537597585", "bodyText": "Thanks, will try to rewrite it a bit.\n(200 portals?)", "author": "MichelGabriel", "createdAt": "2020-12-07T15:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwMzI3Mg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r537603272", "bodyText": "It is not really about rewriting something. It should work eg. https://apps.titellus.net/geonetwork/wise/eng/catalog.search#/home maybe something which is not in master or 3 ?", "author": "fxprunayre", "createdAt": "2020-12-07T15:37:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwODU2OQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r537608569", "bodyText": "I mean rewriting the toolbar file.", "author": "MichelGabriel", "createdAt": "2020-12-07T15:44:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwOTQ3OA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r537609478", "bodyText": "The code in \n  \n    \n      core-geonetwork/services/src/main/java/org/fao/geonet/api/site/SiteApi.java\n    \n    \n        Lines 209 to 224\n      in\n      3028d14\n    \n    \n    \n    \n\n        \n          \n           if (!NodeInfo.DEFAULT_NODE.equals(node.getId())) { \n        \n\n        \n          \n               Source source = sourceRepository.findOne(node.getId()); \n        \n\n        \n          \n               if (source != null) { \n        \n\n        \n          \n                   String iso3langCode = languageUtils.getIso3langCode(request.getLocales()); \n        \n\n        \n          \n                   final List<Setting> settings = response.getSettings(); \n        \n\n        \n          \n                   settings.add( \n        \n\n        \n          \n                       new Setting().setName(Settings.NODE_DEFAULT) \n        \n\n        \n          \n                           .setValue(\"false\")); \n        \n\n        \n          \n                   settings.add( \n        \n\n        \n          \n                       new Setting().setName(Settings.NODE) \n        \n\n        \n          \n                           .setValue(source.getUuid())); \n        \n\n        \n          \n                   settings.add( \n        \n\n        \n          \n                       new Setting().setName(Settings.NODE_NAME) \n        \n\n        \n          \n                           .setValue(source != null ? source.getLabel(iso3langCode) : source.getName())); \n        \n\n        \n          \n               } \n        \n\n        \n          \n           } \n        \n    \n  \n\n seem the same\nThe value \"node/name\" of the response for /api/site seem should have the translated node value.", "author": "josegar74", "createdAt": "2020-12-07T15:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODExNDIzMA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r538114230", "bodyText": "I had another look at some code, and saw this line: https://github.com/geonetwork/core-geonetwork/blob/master/services/src/main/java/org/fao/geonet/api/site/SiteApi.java#L209\nIt looks like (I'm no Java developer) the NODE information is only included when you're not on the 'default' node/site. It would have been nice if this information was always there, but maybe there is a good reason not to do so.", "author": "MichelGabriel", "createdAt": "2020-12-08T07:57:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMxOTExOA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5245#discussion_r538319118", "bodyText": "if this information was always there,\n\nYep could be easier.", "author": "fxprunayre", "createdAt": "2020-12-08T12:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MDkzNA=="}], "type": "inlineReview"}, {"oid": "d29d66a09fd714b8add12523dd489db6169e95a6", "url": "https://github.com/geonetwork/core-geonetwork/commit/d29d66a09fd714b8add12523dd489db6169e95a6", "message": "Update SiteApi to return the site name for the default node", "committedDate": "2020-12-17T07:24:59Z", "type": "commit"}, {"oid": "e6980d8c77ddd9cc0f1f0cd0e3b5908b19afcf49", "url": "https://github.com/geonetwork/core-geonetwork/commit/e6980d8c77ddd9cc0f1f0cd0e3b5908b19afcf49", "message": "Merge pull request #4 from GeoCat/master-use-portalname-siteapi-update\n\nUpdate SiteApi to return the site name for the default node", "committedDate": "2020-12-17T07:27:39Z", "type": "commit"}, {"oid": "eee8efbe58f5b731f42855431447ae2bccceb503", "url": "https://github.com/geonetwork/core-geonetwork/commit/eee8efbe58f5b731f42855431447ae2bccceb503", "message": "Revert changes to toolbar and CatController", "committedDate": "2020-12-17T09:02:05Z", "type": "commit"}]}