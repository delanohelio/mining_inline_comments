{"pr_number": 5220, "pr_title": "Fixed unhandled error and its xsl regular expression. Fixed root element in Schematron title translation.", "pr_createdAt": "2020-11-26T20:43:17Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/5220", "timeline": [{"oid": "f8ee2b9767fa25de803370a1a6c43c446b3b80ac", "url": "https://github.com/geonetwork/core-geonetwork/commit/f8ee2b9767fa25de803370a1a6c43c446b3b80ac", "message": "Fixed xsl regular expression due to the parser error message change to translate language text. Pass codelist into the validate-fn.xsl to get multilingual support for topic category list.", "committedDate": "2020-11-26T20:39:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzOTAzMw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5220#discussion_r531539033", "bodyText": "I don't believe you can hard code the reference the gmd:MD_TopicCategoryCode in the enumeration-valid error as the enumeration-valid is used to generate error messages for all kinds of invalid code list.  I believe this has to be a generic error handler for all enumeration-valid.\nThis  will most likely break validations of other code lists.", "author": "ianwallen", "createdAt": "2020-11-27T11:14:53Z", "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "diffHunk": "@@ -186,14 +187,10 @@\n                   </xsl:if>\n                 </xsl:when>\n                 <xsl:when test=\"$errorType = 'enumeration-valid'\">\n-                  <xsl:value-of select=\"$strings/enum1\"/> '<xsl:value-of\n-                  select=\"regex-group(1)\"/>'\n-                  <xsl:value-of select=\"$strings/enum2\"/>\n-                  <xsl:value-of\n-                    select=\"geonet:getTitleWithoutContext($schema, concat(regex-group(3), ':', regex-group(4)), $labels)\"\n-                  /> (<xsl:value-of select=\"concat(regex-group(3), ':', regex-group(4))\"/>).\n+                  <!--The topic category must be found in the following list-->\n                   <xsl:value-of select=\"$strings/enum3\"/>\n-                  <xsl:value-of select=\"regex-group(2)\"/>.\n+                  <!--The code list with translation text-->\n+                  (<xsl:value-of select=\"$codelists//codelist[@name='gmd:MD_TopicCategoryCode']/entry/value\" separator=\", \" />)", "originalCommit": "f8ee2b9767fa25de803370a1a6c43c446b3b80ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTYyMDc1MA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5220#discussion_r531620750", "bodyText": "The variable $strings/enum3 was confused label. It's really the enum element from Strings.xml. It servers as a label instead of the actual list. The enum3 is part of this pull request metadata101/iso19139.ca.HNAP#139\nThe old code used <xsl:value-of select=\"regex-group(2)\"/> as the list to parse. What I found is the list value got passed into this regex-group(2) is the codes from identification.xsd -> xs:simpleType name=\"MD_TopicCategoryCode_Type\". It's not possible to translate it to multi language. Thus I decided to use codelists instead.", "author": "wangf1122", "createdAt": "2020-11-27T14:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzOTAzMw=="}], "type": "inlineReview"}, {"oid": "a9df8527bbac71f0a3ff8882b28bc9c452bcca4a", "url": "https://github.com/geonetwork/core-geonetwork/commit/a9df8527bbac71f0a3ff8882b28bc9c452bcca4a", "message": "Added enumeration-validwithparent, datatype-valid.1.2.3withparent and datatype-valid.1.2.3 error reg expression patterns.", "committedDate": "2020-11-30T15:41:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5NzkzOA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/5220#discussion_r532697938", "bodyText": "I put test code like\nxsl:otherwise\nxsl:messageSkiped $error=<xsl:value-of select=\"$error\"></xsl:value-of></xsl:message>\n<xsl:value-of select=\"$error\"/>\n</xsl:otherwise>\nSo I summarized all skipped patterns:\nSkiped $error='' is not a valid value of union type 'Date_Type'.\nSkiped $error='' is not a valid value of union type 'Date_Type'.\nSkiped $error='' is not a valid value of union type 'Date_Type'. (Element: gco:Date with parent element: gmd:date)\nSkiped $error='' is not a valid value of union type 'Date_Type'. (Element: gco:Date with parent element: gmd:date)\nSkiped $error=Value '' is not facet-valid with respect to enumeration '[farming, biota, boundaries, climatologyMeteorologyAtmosphere, economy, elevation, environment, geoscientificInformation, health, imageryBaseMapsEarthCover, intelligenceMilitary, inlandWaters, location, oceans, planningCadastre, society, structure, transportation, utilitiesCommunication]'. It must be a value from the enumeration. (Element: gmd:MD_TopicCategoryCode with parent element: gmd:topicCategory)\nRealized there are three uncaught errors: enumeration-validwithparent, datatype-valid.1.2.3withparent, datatype-valid.1.2.3. So I added them accordingly.", "author": "wangf1122", "createdAt": "2020-11-30T15:49:26Z", "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "diffHunk": "@@ -97,7 +97,12 @@\n       <!--cvc-type.3.1.3: The value 'DUMMY_DENOMINATOR' of element 'gco:Integer' is not valid. (Element: gco:Integer with parent element: gmd:denominator)-->\n       <rule errorType=\"type.3.1.3withparent\">The value '(.*)' of element '(.*)' is not valid\\. \\(Element: ([a-z]{3}):(.*) with parent element: (.*)\\)</rule>\n       <rule errorType=\"type.3.1.3\">The value '(.*)' of element '(.*)' is not valid\\.</rule>\n-      <rule errorType=\"enumeration-valid\">Value '(.*)' is not facet-valid with respect to enumeration '\\[(.*)\\]'\\. It must be a value from the enumeration\\. \\(Element: ([a-z]{3}):(.*) with parent element: (.*)\\)</rule>\n+      <rule errorType=\"enumeration-validwithparent\">Value '(.*)' is not facet-valid with respect to enumeration '\\[(.*)\\]'\\. It must be a value from the enumeration\\. \\(Element: ([a-z]{3}):(.*) with parent element: (.*)\\)</rule>\n+      <rule errorType=\"enumeration-valid\">Value '(.*)' is not facet-valid with respect to enumeration '\\[(.*)\\]'\\. It must be a value from the enumeration\\.</rule>\n+      <!--datatype-valid.1.2.3: '' is not a valid value of union type 'Date_Type'.-->\n+      <rule errorType=\"datatype-valid.1.2.3withparent\">'(.*)' is not a valid value of union type '(.*)'\\. \\(Element: ([a-z]{3}):(.*) with parent element:(.*)\\)</rule>\n+      <rule errorType=\"datatype-valid.1.2.3\">'(.*)' is not a valid value of union type '(.*)'\\.</rule>\n+\n     </xsl:variable>", "originalCommit": "a9df8527bbac71f0a3ff8882b28bc9c452bcca4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fc26cf949cb6e86526a6261725cad0d8c5404fa3", "url": "https://github.com/geonetwork/core-geonetwork/commit/fc26cf949cb6e86526a6261725cad0d8c5404fa3", "message": "Fixed root element for schematronTranslations", "committedDate": "2020-12-17T17:14:30Z", "type": "commit"}]}