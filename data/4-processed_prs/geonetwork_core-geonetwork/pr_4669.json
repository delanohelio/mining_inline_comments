{"pr_number": 4669, "pr_title": "Set encoding to UTF-8 in metadata notifier requests", "pr_createdAt": "2020-05-08T10:51:27Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/4669", "timeline": [{"oid": "4f81ada590a90ede38a33e0eab6db34c079c2001", "url": "https://github.com/geonetwork/core-geonetwork/commit/4f81ada590a90ede38a33e0eab6db34c079c2001", "message": "Set encoding to UTF-8 in metadata notifier requests, otherwise the xml special chars like accents are not encoded properly", "committedDate": "2020-05-08T10:50:10Z", "type": "commit"}, {"oid": "bc38f0d29fcb3eb60031c90c0a624c852ea85604", "url": "https://github.com/geonetwork/core-geonetwork/commit/bc38f0d29fcb3eb60031c90c0a624c852ea85604", "message": "Add accept-header to avoid the following error if the notifier application runs in Jetty: org.eclipse.jetty.http.BadMessageException: 400: Unable to parse form content", "committedDate": "2020-05-08T12:01:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgyODg2Mw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4669#discussion_r422828863", "bodyText": "I would use StandardCharsets.UTF_8 constant here.", "author": "juanluisrp", "createdAt": "2020-05-11T07:13:08Z", "path": "core/src/main/java/org/fao/geonet/notifier/MetadataNotifierClient.java", "diffHunk": "@@ -77,10 +78,11 @@ private void execute(final MetadataNotifier notifier, List<? extends NameValuePa\n \n             // Create a method instance.\n             HttpPost method = new HttpPost(notifier.getUrl());\n-            final UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data);\n+            final UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));", "originalCommit": "bc38f0d29fcb3eb60031c90c0a624c852ea85604", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzMDczNA==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4669#discussion_r422830734", "bodyText": "Use constants here:\n method.addHeader(org.apache.http.HttpHeaders.ACCEPT_CHARSET, java.nio.charset.StandardCharsets.UTF_8.name());", "author": "juanluisrp", "createdAt": "2020-05-11T07:16:42Z", "path": "core/src/main/java/org/fao/geonet/notifier/MetadataNotifierClient.java", "diffHunk": "@@ -77,10 +78,11 @@ private void execute(final MetadataNotifier notifier, List<? extends NameValuePa\n \n             // Create a method instance.\n             HttpPost method = new HttpPost(notifier.getUrl());\n-            final UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data);\n+            final UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n             final RequestConfig.Builder configBuilder = RequestConfig.custom();\n             configBuilder.setMaxRedirects(3);\n \n+            method.addHeader(\"accept-charset\", \"UTF-8\");", "originalCommit": "bc38f0d29fcb3eb60031c90c0a624c852ea85604", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a2ace7cec5dd544ad4da31d984af586dc4354a0", "url": "https://github.com/geonetwork/core-geonetwork/commit/4a2ace7cec5dd544ad4da31d984af586dc4354a0", "message": "Set encoding to UTF-8 in metadata notifier requests - use constants", "committedDate": "2020-05-11T07:42:09Z", "type": "commit"}]}