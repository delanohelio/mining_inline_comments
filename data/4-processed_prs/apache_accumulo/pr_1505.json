{"pr_number": 1505, "pr_title": "Optimize Tablet volume replacement", "pr_createdAt": "2020-02-11T17:28:20Z", "pr_url": "https://github.com/apache/accumulo/pull/1505", "timeline": [{"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e", "url": "https://github.com/apache/accumulo/commit/29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e", "message": "Optimize Tablet volume replacement\n\n* Stop Tablet constructor from checking every file for volume\nreplacements when feature not used", "committedDate": "2020-02-11T17:22:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg==", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377803422", "bodyText": "Would it make more sense to keep the replacements assignment in this method, but short-circuit the method with a if (replacements.isEmpty()) { return; } line?\nIt seems like this is a smaller change and would keep the logic all together that handles the updates, rather than place the special case of no replacements outside the method.", "author": "ctubbsii", "createdAt": "2020-02-11T18:01:48Z", "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();", "originalCommit": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMDAzMQ==", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377830031", "bodyText": "Well we wouldn't be able to just return because the return value would wipe out the files and logs kept in tabletPaths.  But since that object gets passed I think we could just return it.", "author": "milleruntime", "createdAt": "2020-02-11T18:51:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTczNw==", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377831737", "bodyText": "+1", "author": "ivakegg", "createdAt": "2020-02-11T18:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTg5MA==", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377831890", "bodyText": "Oh, right. I didn't see there was a return value.", "author": "ctubbsii", "createdAt": "2020-02-11T18:55:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTgxMg==", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377831812", "bodyText": "Should the log statement be using parameter substitution?\nlog.trace(\"Using volume replacements: {}\" + replacements);", "author": "EdColeman", "createdAt": "2020-02-11T18:55:12Z", "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();\n+      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate,\n+      List<Pair<Path,Path>> replacements) throws IOException {\n     log.trace(\"Using volume replacements: \" + replacements);", "originalCommit": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzNDU2Nw==", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377834567", "bodyText": "Yeah but I was avoiding making unrelated changes to keep the change to a minimum.", "author": "milleruntime", "createdAt": "2020-02-11T19:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTgxMg=="}], "type": "inlineReview"}, {"oid": "ddd792f022b665cdee83fded2fc2b3dec146b673", "url": "https://github.com/apache/accumulo/commit/ddd792f022b665cdee83fded2fc2b3dec146b673", "message": "PR updates", "committedDate": "2020-02-11T18:58:34Z", "type": "commit"}]}