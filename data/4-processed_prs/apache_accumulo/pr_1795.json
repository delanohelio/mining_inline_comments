{"pr_number": 1795, "pr_title": "Read/Write config files consistently", "pr_createdAt": "2020-11-19T18:09:07Z", "pr_url": "https://github.com/apache/accumulo/pull/1795", "timeline": [{"oid": "e3165181c5eb3827834ccad9142d37e77652f19d", "url": "https://github.com/apache/accumulo/commit/e3165181c5eb3827834ccad9142d37e77652f19d", "message": "Read/Write config files consistently\n\n* Use UTF-8 for all FileReaders and FileWriters\n* Use an InputStreamReader instead of a FileReader for reading class\n  path resources identified with a URL rather than a file name\n* This fixes a failure in some ITs, including VolumeIT, which reads a\n  class path resource, rather than a file\n* Ensure PropertiesConfigurations use read() and write() instead of\n  less convenient getlayout() methods to load/save", "committedDate": "2020-11-19T18:04:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyMjcxNQ==", "url": "https://github.com/apache/accumulo/pull/1795#discussion_r527122715", "bodyText": "It's odd that this constructor throws a more general exception, I would think it would have been the other way around.", "author": "milleruntime", "createdAt": "2020-11-19T18:54:36Z", "path": "minicluster/src/main/java/org/apache/accumulo/cluster/RemoteShellOptions.java", "diffHunk": "@@ -69,8 +70,8 @@ public RemoteShellOptions() {\n       if (f.exists() && f.isFile() && f.canRead()) {\n         FileReader reader = null;\n         try {\n-          reader = new FileReader(f);\n-        } catch (FileNotFoundException e) {\n+          reader = new FileReader(f, UTF_8);\n+        } catch (IOException e) {", "originalCommit": "e3165181c5eb3827834ccad9142d37e77652f19d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEzODkwMg==", "url": "https://github.com/apache/accumulo/pull/1795#discussion_r527138902", "bodyText": "This constructor is newer, so they probably made it less specific because they declared their exceptions too narrowly when they wrote the original method.", "author": "ctubbsii", "createdAt": "2020-11-19T19:21:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyMjcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIxOTcxMw==", "url": "https://github.com/apache/accumulo/pull/1795#discussion_r527219713", "bodyText": "Ah OK, that makes sense.", "author": "milleruntime", "createdAt": "2020-11-19T21:40:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyMjcxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyMzQ3MQ==", "url": "https://github.com/apache/accumulo/pull/1795#discussion_r527123471", "bodyText": "Looks like this changed got dinged by Sec bugs.  Should triage this before committing.", "author": "milleruntime", "createdAt": "2020-11-19T18:55:49Z", "path": "start/src/main/java/org/apache/accumulo/start/classloader/AccumuloClassLoader.java", "diffHunk": "@@ -87,7 +89,7 @@ public static String getAccumuloProperty(String propertyName, String defaultValu\n     }\n     try {\n       var config = new PropertiesConfiguration();\n-      try (var reader = new FileReader(accumuloConfigUrl.getFile())) {\n+      try (var reader = new InputStreamReader(accumuloConfigUrl.openStream(), UTF_8)) {", "originalCommit": "e3165181c5eb3827834ccad9142d37e77652f19d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyNDg2Mg==", "url": "https://github.com/apache/accumulo/pull/1795#discussion_r527124862", "bodyText": "Here is the reference, I don't think it applies: https://find-sec-bugs.github.io/bugs.htm#URLCONNECTION_SSRF_FD", "author": "milleruntime", "createdAt": "2020-11-19T18:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyMzQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEzOTQyMg==", "url": "https://github.com/apache/accumulo/pull/1795#discussion_r527139422", "bodyText": "Yeah, I'm fixing that now. Also, my test didn't pass, so I still need to figure out if this actually fixes the bug I was seeing in the tests.", "author": "ctubbsii", "createdAt": "2020-11-19T19:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEyMzQ3MQ=="}], "type": "inlineReview"}, {"oid": "c94c9794b2bcf3e170b7a7a865e279d4557e0fb0", "url": "https://github.com/apache/accumulo/commit/c94c9794b2bcf3e170b7a7a865e279d4557e0fb0", "message": "Fix VolumeIT and sec-bugs\n\n* Fix VolumeIT\n* Fix spotbugs -P sec-bugs\n* Reorder PropertiesConfiguration Reader/Writer pattern so body of\n  try-with-resources is as small as possible (only when actually\n  reading/writing the file)\n* Make MetricsFileTailer use URL.openStream() rather than try to convert\n  to a File", "committedDate": "2020-11-19T21:44:29Z", "type": "commit"}]}