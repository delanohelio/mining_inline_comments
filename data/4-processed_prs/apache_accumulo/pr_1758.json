{"pr_number": 1758, "pr_title": "Minor cleanup of ZooReaderWriter mutate", "pr_createdAt": "2020-10-30T01:46:57Z", "pr_url": "https://github.com/apache/accumulo/pull/1758", "timeline": [{"oid": "5d5733a660f429549ac0ea1774311de02f6fc2c3", "url": "https://github.com/apache/accumulo/commit/5d5733a660f429549ac0ea1774311de02f6fc2c3", "message": "Minor cleanup of ZooReaderWriter mutate\n\nSeparate out the two distinct use cases for calling\n`ZooReaderWriter.mutate()` into two separate methods, with fewer\nrequired parameters and more clear naming. This also allows for stricter\nnull checking in the parameters that are passed.", "committedDate": "2020-10-30T01:43:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxODk4OQ==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515218989", "bodyText": "Should describe what this method is doing.  While this is an improvement over the previous method, it is not clear that it has anything to do with ACL's.  Perhaps mention it on one of the other methods?  I am not sure but we should describe somewhere what we are doing with the permissions on the node.", "author": "milleruntime", "createdAt": "2020-10-30T16:22:03Z", "path": "core/src/main/java/org/apache/accumulo/fate/zookeeper/ZooReaderWriter.java", "diffHunk": "@@ -138,6 +128,24 @@ public void recursiveCopyPersistentOverwrite(String source, String destination)\n     }, e -> e.code() == Code.BADVERSION); // always retry if bad version\n   }\n \n+  public byte[] createPublicOrMutate(String zPath, byte[] createValue, Mutator mutator)", "originalCommit": "5d5733a660f429549ac0ea1774311de02f6fc2c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMzODk3OA==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515338978", "bodyText": "The original method that I split didn't have a javadoc, presumably because it's only used internally and its function is obvious from the method signature. However, I can add a basic javadoc to both the two new methods to help clarify the purpose, and to make it more obvious what the permissions will be on the created method.", "author": "ctubbsii", "createdAt": "2020-10-30T19:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxODk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0MzU0NA==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515343544", "bodyText": "I was thinking whatever methods end up being the top level or entry methods to these classes would be good.  No need to javadoc all the methods, especially private ones.", "author": "milleruntime", "createdAt": "2020-10-30T19:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxODk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0NDg2NQ==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515344865", "bodyText": "I was only going to add the javadoc to the two I split this original one into. I'm not going to be an overachiever \ud83d\ude3a", "author": "ctubbsii", "createdAt": "2020-10-30T19:54:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxODk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwNjQ3NQ==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515406475", "bodyText": "I ended up updating all the javadocs in this class... \ud83d\ude3a", "author": "ctubbsii", "createdAt": "2020-10-30T22:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxODk4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM1ODIxOA==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515358218", "bodyText": "Feel free to ignore this comment, its very subjective. It would be nice if both mutate methods had the same prefix, for the case when completing in IDE.  Also, if there was javadoc I would drop public from the method name and put that in javadoc.  With those two thoughts, I like the name mutateOrCreate.", "author": "keith-turner", "createdAt": "2020-10-30T20:24:56Z", "path": "core/src/main/java/org/apache/accumulo/fate/zookeeper/ZooReaderWriter.java", "diffHunk": "@@ -138,6 +128,24 @@ public void recursiveCopyPersistentOverwrite(String source, String destination)\n     }, e -> e.code() == Code.BADVERSION); // always retry if bad version\n   }\n \n+  public byte[] createPublicOrMutate(String zPath, byte[] createValue, Mutator mutator)", "originalCommit": "5d5733a660f429549ac0ea1774311de02f6fc2c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwNjIwNQ==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515406205", "bodyText": "Alike minds... I had the same thoughts and shortened the name after adding the javadoc. I'm still a bit torn on mutateOrCreate or createOrMutate, though... I'm not sure I like the implication that we might try to mutate first, if I call it mutateOrCreate, but the argument from auto-complete is a compelling one, so I'll just go with that. \ud83d\ude3a", "author": "ctubbsii", "createdAt": "2020-10-30T22:16:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM1ODIxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxMjA0Ng==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515412046", "bodyText": "I was thinking about the ordering too.  I think it does not matter, because the implication of the OR is that it will only do one of create or mutate.  How it only does one is an implementation detail.  So the fact that the implementation attempts create first is not important to the method name.", "author": "keith-turner", "createdAt": "2020-10-30T22:40:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM1ODIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM2MjUxMQ==", "url": "https://github.com/apache/accumulo/pull/1758#discussion_r515362511", "bodyText": "Nice catch.  Yuck, this should have been using UTF8.  If the current persisted name is encoded w/ something else it likely would not matter w/ the restrictions on what characters could go into a namespace.", "author": "keith-turner", "createdAt": "2020-10-30T20:34:34Z", "path": "server/manager/src/main/java/org/apache/accumulo/master/tableOps/namespace/rename/RenameNamespace.java", "diffHunk": "@@ -62,15 +64,15 @@ public RenameNamespace(NamespaceId namespaceId, String oldName, String newName)\n       final String tap = master.getZooKeeperRoot() + Constants.ZNAMESPACES + \"/\" + namespaceId\n           + Constants.ZNAMESPACE_NAME;\n \n-      zoo.mutate(tap, null, null, current -> {\n-        final String currentName = new String(current);\n+      zoo.mutateExisting(tap, current -> {\n+        final String currentName = new String(current, UTF_8);", "originalCommit": "5d5733a660f429549ac0ea1774311de02f6fc2c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa35cca3836cdc1e767f668f7beee0830ba82fbe", "url": "https://github.com/apache/accumulo/commit/fa35cca3836cdc1e767f668f7beee0830ba82fbe", "message": "Cleanup from code review\n\n* Add javadocs\n* Shorten mutateOrCreate method name\n* Reuse putPersistentData method in mutateOrCreate method and\n  recursiveCopy method\n* Eliminate a private method that was now only used once\n* Remove unused Stat object in getACLs method\n* Clean up test (use static imports for EasyMock for readability)", "committedDate": "2020-10-30T22:42:10Z", "type": "commit"}]}