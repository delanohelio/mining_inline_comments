{"pr_number": 1816, "pr_title": "Fixes #1763 - Flaky test: SimpleTimerTest", "pr_createdAt": "2020-11-30T18:36:54Z", "pr_url": "https://github.com/apache/accumulo/pull/1816", "timeline": [{"oid": "4069a2b21cd6e4ed8574ef9575b3bf3d52d8ac2d", "url": "https://github.com/apache/accumulo/commit/4069a2b21cd6e4ed8574ef9575b3bf3d52d8ac2d", "message": "replaced asserts with loop to recheck test conditions if failed", "committedDate": "2020-11-30T18:00:38Z", "type": "commit"}, {"oid": "fd42721be45078e280da69275b8e6e391af0c301", "url": "https://github.com/apache/accumulo/commit/fd42721be45078e280da69275b8e6e391af0c301", "message": "removed unused import", "committedDate": "2020-11-30T18:06:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgyODg2Mw==", "url": "https://github.com/apache/accumulo/pull/1816#discussion_r532828863", "bodyText": "This is the right strategy (albeit with a few extra parenthesis than necessary on that if statement \ud83d\ude09 )", "author": "ctubbsii", "createdAt": "2020-11-30T19:01:08Z", "path": "server/base/src/test/java/org/apache/accumulo/server/util/time/SimpleTimerTest.java", "diffHunk": "@@ -98,11 +97,15 @@ public void testFailure() throws InterruptedException {\n     assertTrue(r.wasRun);\n   }\n \n-  @Test\n-  public void testSingleton() {\n-    assertEquals(1, SimpleTimer.getInstanceThreadPoolSize());\n-    SimpleTimer t2 = SimpleTimer.getInstance(2);\n-    assertSame(t, t2);\n+  @Test(timeout = 5000)\n+  public void testSingleton() throws InterruptedException {\n+    while (true) {\n+      SimpleTimer t2 = SimpleTimer.getInstance(2);\n+      if((SimpleTimer.getInstanceThreadPoolSize() == 1) && (t == t2)) {\n+        break;\n+      }\n+      Thread.sleep(PAD);\n+    }", "originalCommit": "fd42721be45078e280da69275b8e6e391af0c301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3460b860c0917138733b58748efd783a05bb6f7b", "url": "https://github.com/apache/accumulo/commit/3460b860c0917138733b58748efd783a05bb6f7b", "message": "added loop to most of the tests to catch false fails", "committedDate": "2020-11-30T20:53:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxODMyNQ==", "url": "https://github.com/apache/accumulo/pull/1816#discussion_r532918325", "bodyText": "Just realized that you can simplify this to while (i.get() != 1) { sleep }; you can do similar things for the other tests as well.", "author": "ctubbsii", "createdAt": "2020-11-30T21:35:02Z", "path": "server/base/src/test/java/org/apache/accumulo/server/util/time/SimpleTimerTest.java", "diffHunk": "@@ -70,35 +69,50 @@ public void run() {\n     }\n   }\n \n-  @Test\n+  @Test(timeout = 5000)\n   public void testOneTimeSchedule() throws InterruptedException {\n     AtomicInteger i = new AtomicInteger();\n     Incrementer r = new Incrementer(i);\n     t.schedule(r, DELAY);\n     Thread.sleep(DELAY + PAD);\n-    assertEquals(1, i.get());\n+    while (true) {\n+      if (i.get() == 1) {\n+        break;\n+      }\n+      Thread.sleep(PAD);\n+    }", "originalCommit": "3460b860c0917138733b58748efd783a05bb6f7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMDAwMA==", "url": "https://github.com/apache/accumulo/pull/1816#discussion_r532920000", "bodyText": "Was considering that as well. I will add this change.", "author": "DomGarguilo", "createdAt": "2020-11-30T21:38:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxODMyNQ=="}], "type": "inlineReview"}, {"oid": "cf59109738368655564888a6f37821c2a53fbec4", "url": "https://github.com/apache/accumulo/commit/cf59109738368655564888a6f37821c2a53fbec4", "message": "Simplified the while loops.", "committedDate": "2020-11-30T21:50:48Z", "type": "commit"}]}