{"pr_number": 7173, "pr_title": "Updates to colored group indicator for cited entries", "pr_createdAt": "2020-12-08T16:13:54Z", "pr_url": "https://github.com/JabRef/jabref/pull/7173", "timeline": [{"oid": "42dc97bf2c7f88fdc07ec219d5a0dc451c71f9ad", "url": "https://github.com/JabRef/jabref/commit/42dc97bf2c7f88fdc07ec219d5a0dc451c71f9ad", "message": "Fix matched groups binding\n\nMatched groups should update both on changes in the BibEntry and changes\n in groups.", "committedDate": "2020-12-05T19:42:53Z", "type": "commit"}, {"oid": "9b2c9b1c805e0e4b2cf3b15c0e1534fb6df155a2", "url": "https://github.com/JabRef/jabref/commit/9b2c9b1c805e0e4b2cf3b15c0e1534fb6df155a2", "message": "Code style and typos", "committedDate": "2020-12-07T13:39:37Z", "type": "commit"}, {"oid": "72e75b6ccdfe5d785e3e0da45a6709d35cbe47be", "url": "https://github.com/JabRef/jabref/commit/72e75b6ccdfe5d785e3e0da45a6709d35cbe47be", "message": "Extend TexGroup with Observable", "committedDate": "2020-12-08T20:13:28Z", "type": "commit"}, {"oid": "ca85073afe1dc3afeb130edda0dfeab9fe7fdaf3", "url": "https://github.com/JabRef/jabref/commit/ca85073afe1dc3afeb130edda0dfeab9fe7fdaf3", "message": "Add missed code style change", "committedDate": "2020-12-08T20:18:52Z", "type": "commit"}, {"oid": "55845ceba6b6f1e59c46f42202b5b85a0b3eb86c", "url": "https://github.com/JabRef/jabref/commit/55845ceba6b6f1e59c46f42202b5b85a0b3eb86c", "message": "Revert parts of matched groups binding", "committedDate": "2020-12-14T17:51:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY3OTU1NA==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r542679554", "bodyText": "Here we can change the dependence to only be on StandardField.GROUPS again. It could be argued that this change is out of the scope of this PR and has potential performance effects.", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2020-12-14T19:26:16Z", "path": "src/main/java/org/jabref/gui/maintable/BibEntryTableViewModel.java", "diffHunk": "@@ -68,18 +71,29 @@ public BibEntry getEntry() {\n     }\n \n     private static ObservableValue<List<AbstractGroup>> createMatchedGroupsBinding(BibDatabaseContext database, BibEntry entry) {\n-        Optional<GroupTreeNode> root = database.getMetaData().getGroups();\n-        if (root.isPresent()) {\n-            return EasyBind.map(entry.getFieldBinding(StandardField.GROUPS), field -> {\n-                List<AbstractGroup> groups = root.get().getMatchingGroups(entry)\n-                                                 .stream()\n-                                                 .map(GroupTreeNode::getGroup)\n-                                                 .collect(Collectors.toList());\n-                groups.remove(root.get().getGroup());\n-                return groups;\n-            });\n-        }\n-        return new SimpleObjectProperty<>(Collections.emptyList());\n+        ObservableValue<List<AbstractGroup>> groupsBinding = new ObjectBinding<List<AbstractGroup>>() {\n+            {\n+                bind(entry.getFieldsObservable(), entry.typeProperty());", "originalCommit": "42dc97bf2c7f88fdc07ec219d5a0dc451c71f9ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e5324fabc51b7c430e7ff0db770852d1bc568e86", "url": "https://github.com/JabRef/jabref/commit/e5324fabc51b7c430e7ff0db770852d1bc568e86", "message": "Change data structure of stored listeners", "committedDate": "2020-12-16T15:00:45Z", "type": "commit"}, {"oid": "0520009bed766f41209bc32f3ee26fde81a4140a", "url": "https://github.com/JabRef/jabref/commit/0520009bed766f41209bc32f3ee26fde81a4140a", "message": "Fix managing listeners of Observable groups", "committedDate": "2020-12-16T15:05:08Z", "type": "commit"}, {"oid": "beb1a3e9fa1ba1fe43bc2800afb06e6f8994d2f4", "url": "https://github.com/JabRef/jabref/commit/beb1a3e9fa1ba1fe43bc2800afb06e6f8994d2f4", "message": "Fix display of group count when using TexGroups", "committedDate": "2020-12-16T15:59:47Z", "type": "commit"}, {"oid": "ee7296e49a656927c383b2f395a65cf84679db28", "url": "https://github.com/JabRef/jabref/commit/ee7296e49a656927c383b2f395a65cf84679db28", "message": "Fix use of deprecated setGroup", "committedDate": "2020-12-16T18:52:54Z", "type": "commit"}, {"oid": "20d5e168ed2b923568a5888c551a1bbb3fd5cbe3", "url": "https://github.com/JabRef/jabref/commit/20d5e168ed2b923568a5888c551a1bbb3fd5cbe3", "message": "Remove check for null value", "committedDate": "2020-12-16T18:54:08Z", "type": "commit"}, {"oid": "68a0a5d6f59320a539a71e24079002a286d52daf", "url": "https://github.com/JabRef/jabref/commit/68a0a5d6f59320a539a71e24079002a286d52daf", "message": "Fix execution thread", "committedDate": "2020-12-16T21:32:40Z", "type": "commit"}, {"oid": "a2972a964549f313f9bf80f0bc581cd1b4c101ac", "url": "https://github.com/JabRef/jabref/commit/a2972a964549f313f9bf80f0bc581cd1b4c101ac", "message": "Fix updating entries in selected groups", "committedDate": "2020-12-16T21:49:40Z", "type": "commit"}, {"oid": "3d24c670b28687901cbc12978beb014b77478e3d", "url": "https://github.com/JabRef/jabref/commit/3d24c670b28687901cbc12978beb014b77478e3d", "message": "Fix concurrent modification issue", "committedDate": "2020-12-16T22:08:36Z", "type": "commit"}, {"oid": "ca0c800ab71e85e2ead8132f8bba9e59b2c989b6", "url": "https://github.com/JabRef/jabref/commit/ca0c800ab71e85e2ead8132f8bba9e59b2c989b6", "message": "Merge branch 'master' into fix-for-issue-6394", "committedDate": "2020-12-21T22:37:31Z", "type": "commit"}, {"oid": "21f7aae5398fd6d910a9ba53ba2552aed0978b25", "url": "https://github.com/JabRef/jabref/commit/21f7aae5398fd6d910a9ba53ba2552aed0978b25", "message": "Add MetaData GroupUpdatedEvent without saving", "committedDate": "2020-12-23T13:28:39Z", "type": "commit"}, {"oid": "8501704b6793a3ba5bb5567aa177dff6f9a89afb", "url": "https://github.com/JabRef/jabref/commit/8501704b6793a3ba5bb5567aa177dff6f9a89afb", "message": "Merge branch 'master' into fix-for-issue-6394", "committedDate": "2020-12-23T13:28:59Z", "type": "commit"}, {"oid": "536c96ba94117fa32dc2edd7af20ca60cf0c7c71", "url": "https://github.com/JabRef/jabref/commit/536c96ba94117fa32dc2edd7af20ca60cf0c7c71", "message": "Add a GroupInvalidatedEvent", "committedDate": "2020-12-23T14:05:48Z", "type": "commit"}, {"oid": "54c7e3d0af6e9e61dd5d1cfed3faec4856941860", "url": "https://github.com/JabRef/jabref/commit/54c7e3d0af6e9e61dd5d1cfed3faec4856941860", "message": "Update JavaDoc", "committedDate": "2020-12-23T16:08:07Z", "type": "commit"}, {"oid": "45d8c22f6630a189a9b9c5f7db48ae241809903c", "url": "https://github.com/JabRef/jabref/commit/45d8c22f6630a189a9b9c5f7db48ae241809903c", "message": "Add EventBus adapter\n\nThe intended use is to register javafx.beans.InvalidationListener to\nGroupUpdatedEvent and GroupInvalidatedEvent", "committedDate": "2020-12-23T20:08:28Z", "type": "commit"}, {"oid": "98ca673501817e1a7f868032b2f183355f189c81", "url": "https://github.com/JabRef/jabref/commit/98ca673501817e1a7f868032b2f183355f189c81", "message": "Fix invalidation listener", "committedDate": "2020-12-23T20:09:25Z", "type": "commit"}, {"oid": "410b8fa389cad103246a1e59cc438e3c46a70ca6", "url": "https://github.com/JabRef/jabref/commit/410b8fa389cad103246a1e59cc438e3c46a70ca6", "message": "Fix minor mistakes", "committedDate": "2020-12-23T20:10:23Z", "type": "commit"}, {"oid": "2353e4dd18ef64a0d93b1a4c1da2120db439c12b", "url": "https://github.com/JabRef/jabref/commit/2353e4dd18ef64a0d93b1a4c1da2120db439c12b", "message": "Fix GroupInvalidatedEvent\n\nPosting a GroupUpdatedEvent will now notify listeners of\nGroupInvalidatedEvent as well.", "committedDate": "2020-12-23T20:43:43Z", "type": "commit"}, {"oid": "d754190c0f2a638a0773cef617af638c7140ccef", "url": "https://github.com/JabRef/jabref/commit/d754190c0f2a638a0773cef617af638c7140ccef", "message": "Fix GroupInvalidatedEvent\n\nMissed changes in MetaData", "committedDate": "2020-12-23T20:48:17Z", "type": "commit"}, {"oid": "c7fb44e0f6ef4970378f395001afc995c2387c09", "url": "https://github.com/JabRef/jabref/commit/c7fb44e0f6ef4970378f395001afc995c2387c09", "message": "Refactoring for readability", "committedDate": "2020-12-23T20:49:30Z", "type": "commit"}, {"oid": "338af181de1b5879bd007e9345bd5f6c66e819d6", "url": "https://github.com/JabRef/jabref/commit/338af181de1b5879bd007e9345bd5f6c66e819d6", "message": "Remove empty class", "committedDate": "2020-12-26T15:53:21Z", "type": "commit"}, {"oid": "ced6720216a08d057c8e6d30c6fc0c3c11006875", "url": "https://github.com/JabRef/jabref/commit/ced6720216a08d057c8e6d30c6fc0c3c11006875", "message": "Add JavaDoc to GroupInvalidatedEventBusAdapter", "committedDate": "2020-12-26T16:00:17Z", "type": "commit"}, {"oid": "f64b2158f3d241f963c313d0a5db5582cd3f8d05", "url": "https://github.com/JabRef/jabref/commit/f64b2158f3d241f963c313d0a5db5582cd3f8d05", "message": "Fix CheckStyle\n\nMy CheckStyle preferences were changed. It is now based on the getting\nstarted documentation.", "committedDate": "2020-12-28T14:32:18Z", "type": "commit"}, {"oid": "996b0fe1bb04e31f4a235a1c9fc3e6a099178b2f", "url": "https://github.com/JabRef/jabref/commit/996b0fe1bb04e31f4a235a1c9fc3e6a099178b2f", "message": "Fix using an ObservableOptional root group wrapper", "committedDate": "2020-12-28T19:57:13Z", "type": "commit"}, {"oid": "996329fc136f6c2359e42722a74fa8821fbc9aec", "url": "https://github.com/JabRef/jabref/commit/996329fc136f6c2359e42722a74fa8821fbc9aec", "message": "Refactor for readability", "committedDate": "2020-12-28T20:07:03Z", "type": "commit"}, {"oid": "605b6bdce094282ee2064830b5c243264a80c188", "url": "https://github.com/JabRef/jabref/commit/605b6bdce094282ee2064830b5c243264a80c188", "message": "Drop update for groups other than TexGroup", "committedDate": "2020-12-28T20:09:12Z", "type": "commit"}, {"oid": "73d9af99c25b1f07dfe70c0119c43f400a47568b", "url": "https://github.com/JabRef/jabref/commit/73d9af99c25b1f07dfe70c0119c43f400a47568b", "message": "Change where switch to JavaFX thread occurs", "committedDate": "2020-12-28T21:29:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4NTUwNg==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r550485506", "bodyText": "In the best case, the invalidation would bubble up automatically from the group along the whole tree. So somehing along the following lines:\n\nMake each Group an observable value that is invalidated when it's properties change. Could be done by making AbstractGroup derive from PreboundBinding, change keysUsedInAux to an observable set, and invoke super(keysUsedInAux) in the constructor\nInvalidate the grouptreenode as soon as the group is invalidated. Should be possible by letting TreeNode derive from PreboundBinding, and then use an extractor here https://github.com/JabRef/jabref/blob/master/src/main/java/org/jabref/model/TreeNode.java#L59 to invalidate the list, when one of the nodes changes.\nThen the root should be invalidated whenever one of the groups reports that is invalidate/changed.\n\nHowever, that is more work, so I'm fine with this top-down-approach for now as well.", "author": "tobiasdiez", "createdAt": "2020-12-31T13:41:05Z", "path": "src/main/java/org/jabref/model/groups/TexGroup.java", "diffHunk": "@@ -119,6 +120,7 @@ public Path getFilePath() {\n     public void fileUpdated() {\n         // Reset previous parse result\n         keysUsedInAux = null;\n+        DefaultTaskExecutor.runInJavaFXThread(() -> metaData.groupsBinding().invalidate());", "originalCommit": "73d9af99c25b1f07dfe70c0119c43f400a47568b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NTk0MA==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r550495940", "bodyText": "I think I'll skip making it observable. It feels like a rabbit-hole that I don't believe I have the JavaFX know-how to dig myself out of (yet). Making GroupTreeNode#getMatchingGroups observable after extending with PreboundBinding would be another low hanging fruit.\nThe remaining question would be if from a MVVC point-of-view, does it make more sense to implement the fileUpdate method \n  \n    \n      jabref/src/main/java/org/jabref/model/groups/TexGroup.java\n    \n    \n         Line 119\n      in\n      afdb194\n    \n    \n    \n    \n\n        \n          \n           public void fileUpdated() { \n        \n    \n  \n\n\nin the GroupNodeViewModel, i.e., \"initialize\" it similar to the AutomaticPersonsGroup\n\n  \n    \n      jabref/src/main/java/org/jabref/gui/groups/GroupNodeViewModel.java\n    \n    \n         Line 73\n      in\n      afdb194\n    \n    \n    \n    \n\n        \n          \n           if (groupNode.getGroup() instanceof AutomaticGroup) { \n        \n    \n  \n\n\nand then \"invalidate\" (keysUsedInAux = null) from the ViewModel?", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2020-12-31T14:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4NTUwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc3OTYwNg==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r550779606", "bodyText": "No, it's fine that the texgroup invalidates the root - that's actually good design, as both of these life in the model. You don't want to take care of this through the UI classes (ViewModel).\nCan you please remove the DefaultTaskExecutor.runInJavaFXThread part. The BindingsHelper has a forUI helper method that allows you consume change events on the JavaFX thread.", "author": "tobiasdiez", "createdAt": "2021-01-01T15:42:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4NTUwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgwMDEzNA==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r550800134", "bodyText": "Sure! I'll create an UiThreadOptionalBinding wrapper and add a BindingsHelper#forUI method for it. I might have to make some additional changes so that MetaData can be created without running an update on the UI thread.", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2021-01-01T19:46:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4NTUwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTAyOTUwNQ==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r551029505", "bodyText": "I remember we talked once in a devcall about abandoning the google event bus and using observables or properties instead, but I think this is stuff for some far future changes...", "author": "calixtus", "createdAt": "2021-01-03T16:57:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4NTUwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTA2MTQxMQ==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r551061411", "bodyText": "I might return and look more at it for groups at a later point. I just feel that my JavaFX knowledge is not up to task for it yet. I need to experiment with it more, on something less impactful \ud83d\ude1d", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2021-01-03T22:16:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4NTUwNg=="}], "type": "inlineReview"}, {"oid": "9d4847c0160bea43c35d065bb5762451887dce7c", "url": "https://github.com/JabRef/jabref/commit/9d4847c0160bea43c35d065bb5762451887dce7c", "message": "Add UiThread wrapper for groupsRootBinding", "committedDate": "2021-01-03T20:58:16Z", "type": "commit"}, {"oid": "34c98b32c5c2794dc45cbd0e3a0d89a5e01d8236", "url": "https://github.com/JabRef/jabref/commit/34c98b32c5c2794dc45cbd0e3a0d89a5e01d8236", "message": "Updates CHANGELOG.md", "committedDate": "2021-01-03T22:13:01Z", "type": "commit"}, {"oid": "f4d051d2893f16146fdfb2093386c6369588accf", "url": "https://github.com/JabRef/jabref/commit/f4d051d2893f16146fdfb2093386c6369588accf", "message": "Merge branch 'master' into fix-for-issue-6394", "committedDate": "2021-01-03T23:35:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQwMjU2Mw==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r554402563", "bodyText": "The model and logic packages need to be free of gui stuff. The wrapping on the JavaFX thread should happen right before it is displayed.", "author": "tobiasdiez", "createdAt": "2021-01-09T11:57:53Z", "path": "src/main/java/org/jabref/model/metadata/MetaData.java", "diffHunk": "@@ -9,7 +9,11 @@\n import java.util.Objects;\n import java.util.Optional;\n \n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+\n import org.jabref.architecture.AllowedToUseLogic;\n+import org.jabref.gui.util.uithreadaware.UiThreadOptionalBinding;", "originalCommit": "f4d051d2893f16146fdfb2093386c6369588accf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQwNDUwNw==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r554404507", "bodyText": "@JabRef/developers Our architecture tests don't work anymore?! This is clearly a violation but the tests pass.", "author": "tobiasdiez", "createdAt": "2021-01-09T12:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQwMjU2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQwMzU4MQ==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r554403581", "bodyText": "I would make groupsRoot already an OptionalObjectProperty", "author": "tobiasdiez", "createdAt": "2021-01-09T11:59:55Z", "path": "src/main/java/org/jabref/model/metadata/MetaData.java", "diffHunk": "@@ -51,7 +57,8 @@\n     private final Map<EntryType, String> citeKeyPatterns = new HashMap<>(); // <BibType, Pattern>\n     private final Map<String, String> userFileDirectory = new HashMap<>(); // <User, FilePath>\n     private final Map<String, Path> laTexFileDirectory = new HashMap<>(); // <User, FilePath>\n-    private GroupTreeNode groupsRoot;\n+    private final ObjectProperty<GroupTreeNode> groupsRoot = new SimpleObjectProperty<>(null);", "originalCommit": "f4d051d2893f16146fdfb2093386c6369588accf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjExMjA3OQ==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r556112079", "bodyText": "I'll have to think more about this one. I keep ending up with OptionalWrapper<Optional<GroupTreeNode>> \ud83d\ude1b", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2021-01-12T21:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQwMzU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjEyMTY5OQ==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r556121699", "bodyText": "OptionalObjectProperty<GroupTreeNode> groupsRoot = OptionalObjectProperty.empty();\nOptionalBinding<GroupTreeNode> groupsRootBinding = new OptionalWrapper<>(groupsRoot.orElse(null));\n\nThis is what ends up making the most sense to me. I'll add it to my todo-list for the follow up PR.", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2021-01-12T21:56:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQwMzU4MQ=="}], "type": "inlineReview"}, {"oid": "6c98807db4bbe878efb8278268f2a0dbf182ca59", "url": "https://github.com/JabRef/jabref/commit/6c98807db4bbe878efb8278268f2a0dbf182ca59", "message": "Move the UI thread switch to View-Model", "committedDate": "2021-01-10T23:37:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTE3NDc0Mw==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r555174743", "bodyText": "Should this binding be modified to depend on any changes in the bibentry? #7325 depends on keyword field, instead of group field. Free text search depends on all fields. Should it be in a different PR? Personally I'd prefer if createMatchedGroupsBinding could be changed to return a FilteredList, but that would likely take me a while to implement...", "author": "k3KAW8Pnf7mkmdSMPHz27", "createdAt": "2021-01-11T16:25:50Z", "path": "src/main/java/org/jabref/gui/maintable/BibEntryTableViewModel.java", "diffHunk": "@@ -67,19 +69,15 @@ public BibEntry getEntry() {\n         return entry;\n     }\n \n-    private static ObservableValue<List<AbstractGroup>> createMatchedGroupsBinding(BibDatabaseContext database, BibEntry entry) {\n-        Optional<GroupTreeNode> root = database.getMetaData().getGroups();\n-        if (root.isPresent()) {\n-            return EasyBind.map(entry.getFieldBinding(StandardField.GROUPS), field -> {\n-                List<AbstractGroup> groups = root.get().getMatchingGroups(entry)\n-                                                 .stream()\n-                                                 .map(GroupTreeNode::getGroup)\n-                                                 .collect(Collectors.toList());\n-                groups.remove(root.get().getGroup());\n-                return groups;\n-            });\n-        }\n-        return new SimpleObjectProperty<>(Collections.emptyList());\n+    private static Binding<List<AbstractGroup>> createMatchedGroupsBinding(BibDatabaseContext database, BibEntry entry) {\n+        return new UiThreadBinding<>(EasyBind.combine(entry.getFieldBinding(StandardField.GROUPS), database.getMetaData().groupsBinding(),", "originalCommit": "6c98807db4bbe878efb8278268f2a0dbf182ca59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMwMTAwNg==", "url": "https://github.com/JabRef/jabref/pull/7173#discussion_r555301006", "bodyText": "Yes, I think it's a good idea to listen to changes of the entry. Let's discuss this in a follow-up PR, since this one looks already good.", "author": "tobiasdiez", "createdAt": "2021-01-11T19:55:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTE3NDc0Mw=="}], "type": "inlineReview"}]}