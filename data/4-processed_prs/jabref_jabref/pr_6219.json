{"pr_number": 6219, "pr_title": "Fix edition test", "pr_createdAt": "2020-03-30T09:43:26Z", "pr_url": "https://github.com/JabRef/jabref/pull/6219", "timeline": [{"oid": "73f349dc3395a220d870c3768ebc1a2e50eb2957", "url": "https://github.com/JabRef/jabref/commit/73f349dc3395a220d870c3768ebc1a2e50eb2957", "message": "Fix edition test", "committedDate": "2020-03-30T09:43:07Z", "type": "commit"}, {"oid": "7eef9cd9078fcbb3c8da36e23f5192e4e2b411d5", "url": "https://github.com/JabRef/jabref/commit/7eef9cd9078fcbb3c8da36e23f5192e4e2b411d5", "message": "Fix some formatting", "committedDate": "2020-03-30T09:46:06Z", "type": "commit"}, {"oid": "5cc71c0a8476a3b4ab5beb02b3c7b52b681d85f6", "url": "https://github.com/JabRef/jabref/commit/5cc71c0a8476a3b4ab5beb02b3c7b52b681d85f6", "message": "Merge remote-tracking branch 'upstream/master' into fixEditionTest\n\n* upstream/master:\n  Bump jython-standalone from 2.7.1 to 2.7.2 (#6209)\n  Bump org.beryx.jlink from 2.17.3 to 2.17.4 (#6214)\n  Bump checkstyle from 8.30 to 8.31 (#6215)\n  Fix typos and grammar mistakes in teaching.md (#6216)\n  Delete tests-oracle.yml (#6217)", "committedDate": "2020-03-30T10:16:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MzkzOQ==", "url": "https://github.com/JabRef/jabref/pull/6219#discussion_r400093939", "bodyText": "The error message says that the first LETTER should be capitalized.\nONLY_NUMBERALS tests for numbers. Numbers are not letters.\nThus, I think, testing for numbers is wrong here.\nThe old condidion in plain English (which is IMHO right):\nIn case the edition contains some letters, check that the first letter is capitalized.\nThe new condidion reads:\nIn case the text consists of numbers only, then check if nubmers are DISALLOWED.\n(In other words: If there are numbers and they are disabled)\nThen check whether the first letter is capitalized (side comment: A number is never capitalized (according to the regex at FIRST_LETTER_CAPITALIZED))\nI think, the new condidion does not make sense at it mixes numbers and letters.", "author": "koppor", "createdAt": "2020-03-30T10:42:32Z", "path": "src/main/java/org/jabref/logic/integrity/EditionChecker.java", "diffHunk": "@@ -54,7 +52,7 @@ public EditionChecker(BibDatabaseContext bibDatabaseContext, boolean allowIntege\n             if (!isFirstCharDigit(value) && (!allowIntegerEdition) && !FIRST_LETTER_CAPITALIZED.test(value.trim())) {\n                 return Optional.of(Localization.lang(\"should have the first letter capitalized\"));\n             } else {\n-                if (!ONLY_NUMERALS.test(value.trim()) && !FIRST_LETTER_CAPITALIZED.test(value.trim())) {\n+                if (ONLY_NUMERALS.test(value.trim()) && (!allowIntegerEdition) && !FIRST_LETTER_CAPITALIZED.test(value.trim())) {", "originalCommit": "5cc71c0a8476a3b4ab5beb02b3c7b52b681d85f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5NDIwNQ==", "url": "https://github.com/JabRef/jabref/pull/6219#discussion_r400094205", "bodyText": "Does the code test still work if you revert the change?", "author": "koppor", "createdAt": "2020-03-30T10:43:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MzkzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEwNTI0Mg==", "url": "https://github.com/JabRef/jabref/pull/6219#discussion_r400105242", "bodyText": "The test obviously didn't work. that's why I had to introduce this change and it's due to the short circuit operation.\n\nWe are  in bibtex mode and only have a number (2)\nisFirstCharDigit return true= > Short circuit to else branch\nOnly numerals checks if we have one or more numbers => true\n3.1 Do we  have=> no  => return error message\n3.2  Do we allow numbers?  yes => Is the first one capitalized? Obviously  not, cause it's a number^^ (okay, that can be removed\n\nThose were the failing tests:\n        assertWrong(withMode(createContext(StandardField.EDITION, \"2\"), BibDatabaseMode.BIBTEX));\n        assertCorrect(withMode(createContext(StandardField.EDITION, \"2\"), BibDatabaseMode.BIBTEX), true);", "author": "Siedlerchr", "createdAt": "2020-03-30T11:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MzkzOQ=="}], "type": "inlineReview"}, {"oid": "8329cb93b2f79e1e94272de2ea802fa3ca59eb98", "url": "https://github.com/JabRef/jabref/commit/8329cb93b2f79e1e94272de2ea802fa3ca59eb98", "message": "remove superlous check", "committedDate": "2020-03-30T11:03:38Z", "type": "commit"}, {"oid": "1f9408cb9777a9a84c8a32781ad82ad7895176b5", "url": "https://github.com/JabRef/jabref/commit/1f9408cb9777a9a84c8a32781ad82ad7895176b5", "message": "Rewrite EditionChecker to use return not followed by else", "committedDate": "2020-03-30T19:38:15Z", "type": "commit"}]}