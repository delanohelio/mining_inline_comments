{"pr_number": 5823, "pr_title": "Fix for multiple error messages in messed up source editor", "pr_createdAt": "2020-01-10T10:21:12Z", "pr_url": "https://github.com/JabRef/jabref/pull/5823", "timeline": [{"oid": "33f88ba5489605dd8759b41c03ecae08f1e5bee0", "url": "https://github.com/JabRef/jabref/commit/33f88ba5489605dd8759b41c03ecae08f1e5bee0", "message": "Fix for unknown gray shade in dark theme", "committedDate": "2020-01-10T08:49:58Z", "type": "commit"}, {"oid": "aaf1cdc1b7f0a3fa0df92b08c2e7750e6eedb616", "url": "https://github.com/JabRef/jabref/commit/aaf1cdc1b7f0a3fa0df92b08c2e7750e6eedb616", "message": "Fix for missing import in module system", "committedDate": "2020-01-10T08:51:22Z", "type": "commit"}, {"oid": "d79dc29e3237d4a8b95ff74bc76da6f9d511db6c", "url": "https://github.com/JabRef/jabref/commit/d79dc29e3237d4a8b95ff74bc76da6f9d511db6c", "message": "Fixed multiple error dialogs with the same message", "committedDate": "2020-01-10T09:31:09Z", "type": "commit"}, {"oid": "753aede5c92a7c898f8ebdf4a323fa7d46248cb5", "url": "https://github.com/JabRef/jabref/commit/753aede5c92a7c898f8ebdf4a323fa7d46248cb5", "message": "Refactored FunctionBasedValidators to common interface and harmonised their logic", "committedDate": "2020-01-10T09:36:35Z", "type": "commit"}, {"oid": "e14a3036ea6def21eead7b2e285c65e0211c6b19", "url": "https://github.com/JabRef/jabref/commit/e14a3036ea6def21eead7b2e285c65e0211c6b19", "message": "Fixed storing entry before changing it and validation", "committedDate": "2020-01-10T10:06:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NTI2MQ==", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365185261", "bodyText": "The parent EntryEditorTab already defines currentEntry, which seems to be what you want.", "author": "tobiasdiez", "createdAt": "2020-01-10T11:11:17Z", "path": "src/main/java/org/jabref/gui/entryeditor/SourceTab.java", "diffHunk": "@@ -64,15 +63,17 @@\n     private final BibDatabaseMode mode;\n     private final UndoManager undoManager;\n     private final ObjectProperty<ValidationMessage> sourceIsValid = new SimpleObjectProperty<>();\n-    @SuppressWarnings(\"unchecked\") private final ObservableRuleBasedValidator sourceValidator = new ObservableRuleBasedValidator(sourceIsValid);\n+    private final ObservableRuleBasedValidator sourceValidator = new ObservableRuleBasedValidator();\n     private final ImportFormatPreferences importFormatPreferences;\n     private final FileUpdateMonitor fileMonitor;\n     private final DialogService dialogService;\n     private final StateManager stateManager;\n     private Optional<Pattern> searchHighlightPattern = Optional.empty();\n-    private CodeArea codeArea;\n+    private final CodeArea codeArea;\n     private KeyBindingRepository keyBindingRepository;\n \n+    private BibEntry boundEntry;", "originalCommit": "e14a3036ea6def21eead7b2e285c65e0211c6b19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIxNjIzMg==", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365216232", "bodyText": "changed the Name to previousEntry. Part of the fix for the recreated CodeArea. JabRef needs to keep the previous entry to store it, because the focus event is fired after the new entry is loaded.", "author": "calixtus", "createdAt": "2020-01-10T12:41:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NTI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NzgyOA==", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365187828", "bodyText": "Why did you removed the binding fields -> code area? If the entry changes (e.g. cleanup actions or \"generate bibtex key\" or set special fields like ranked/printed/...), then these changes should be reflected in the source tab, too.", "author": "tobiasdiez", "createdAt": "2020-01-10T11:18:38Z", "path": "src/main/java/org/jabref/gui/entryeditor/SourceTab.java", "diffHunk": "@@ -201,30 +218,13 @@ public boolean shouldShow(BibEntry entry) {\n \n     @Override\n     protected void bindToEntry(BibEntry entry) {\n-        CodeArea codeArea = createSourceEditor();\n-        VirtualizedScrollPane<CodeArea> node = new VirtualizedScrollPane<>(codeArea);\n-        NotificationPane notificationPane = new NotificationPane(node);\n-        notificationPane.setShowFromTop(false);\n-        sourceValidator.getValidationStatus().getMessages().addListener((ListChangeListener<ValidationMessage>) c -> {\n-            if (sourceValidator.getValidationStatus().isValid()) {\n-                notificationPane.hide();\n-            } else {\n-                sourceValidator.getValidationStatus().getHighestMessage().ifPresent(validationMessage -> {\n-                    notificationPane.show(validationMessage.getMessage());//this seems not working\n-                    dialogService.showErrorDialogAndWait(validationMessage.getMessage());\n-                });\n-            }\n-        });\n-        this.setContent(codeArea);\n-        this.codeArea = codeArea;\n-\n-        // Store source for on focus out event in the source code (within its text area)\n-        // and update source code for every change of entry field values\n-        BindingsHelper.bindContentBidirectional(entry.getFieldsObservable(), codeArea.focusedProperty(), onFocus -> {\n-            if (!onFocus) {\n-                storeSource(entry, codeArea.textProperty().getValue());\n-            }\n-        }, fields -> {\n+        if (boundEntry != null) {\n+            storeSource(boundEntry, codeArea.textProperty().getValue());\n+        }\n+\n+        this.boundEntry = entry;\n+\n+        if (entry != null) {", "originalCommit": "e14a3036ea6def21eead7b2e285c65e0211c6b19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIwMTE5MA==", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365201190", "bodyText": "This was part of the fix to the CodeArea problem, @Siedlerchr mentioned. Selecting another entry copied the content of the sourcetab into the new selected entry, so it duplicated your old one and removed the selected one. But I did not think of the binding to the other fields. \ud83e\udd26\u200d\u2642\nI'm going to take a look into this tonight.", "author": "calixtus", "createdAt": "2020-01-10T11:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NzgyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIxNjQ0Mg==", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365216442", "bodyText": "Fixed it.", "author": "calixtus", "createdAt": "2020-01-10T12:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NzgyOA=="}], "type": "inlineReview"}, {"oid": "929b31c86cc3997781cf94c442c07b33a838530c", "url": "https://github.com/JabRef/jabref/commit/929b31c86cc3997781cf94c442c07b33a838530c", "message": "Fixes sync between fields and sourceTab", "committedDate": "2020-01-10T12:38:01Z", "type": "commit"}, {"oid": "4739dcdc461677de81d2d3bc5531bcb6007a207c", "url": "https://github.com/JabRef/jabref/commit/4739dcdc461677de81d2d3bc5531bcb6007a207c", "message": "Fixes test", "committedDate": "2020-01-10T14:37:17Z", "type": "commit"}]}