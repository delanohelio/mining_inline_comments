{"pr_number": 6434, "pr_title": "Fix clear year and month field when converting to biblatex", "pr_createdAt": "2020-05-06T23:51:09Z", "pr_url": "https://github.com/JabRef/jabref/pull/6434", "timeline": [{"oid": "788f395b4c08c2fe3559f0d1f088e8397c2bc3c9", "url": "https://github.com/JabRef/jabref/commit/788f395b4c08c2fe3559f0d1f088e8397c2bc3c9", "message": "ISSUE :: 6224 - allow merging of year and date if identical", "committedDate": "2020-05-06T23:36:57Z", "type": "commit"}, {"oid": "05518d2838c26a108b190c7f7f1f8bf9e0e66571", "url": "https://github.com/JabRef/jabref/commit/05518d2838c26a108b190c7f7f1f8bf9e0e66571", "message": "fix comment", "committedDate": "2020-05-06T23:42:34Z", "type": "commit"}, {"oid": "e1cfa2509d4f523d3c37fdaf72d4b23d7274bd97", "url": "https://github.com/JabRef/jabref/commit/e1cfa2509d4f523d3c37fdaf72d4b23d7274bd97", "message": "Merge branch 'master' of github.com:JabRef/jabref into fix-for-issue-6224", "committedDate": "2020-05-07T11:30:26Z", "type": "commit"}, {"oid": "93de4bcdcd4f430fc2113f123be99c47879c0325", "url": "https://github.com/JabRef/jabref/commit/93de4bcdcd4f430fc2113f123be99c47879c0325", "message": "Updated Changelog.md file with fixed issue", "committedDate": "2020-05-07T11:34:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NjI1OQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421456259", "bodyText": "I think there should also be a check that the information in the date field coincides with the one in year & month. For example, if date = {2004-05} but year = {2005} the year field shouldn't be deleted.", "author": "tobiasdiez", "createdAt": "2020-05-07T12:13:37Z", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,6 +39,12 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If field date is filled it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(newDate -> {\n+                entry.clearField(StandardField.YEAR).ifPresent(changes::add);", "originalCommit": "93de4bcdcd4f430fc2113f123be99c47879c0325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgxOTc1Mw==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421819753", "bodyText": "Is this really the job of this class? The code assures, that there is something in the date field. I don't think that the cleanup class has to check, if the conversion was done right...", "author": "calixtus", "createdAt": "2020-05-07T22:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NjI1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NTcxOA==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421845718", "bodyText": "I agree with @tobiasdiez we should check if the date is equal to the year.\nIf it is a user error, there is no point in removing it and it is always an alert that made a mistake.", "author": "catarinagomespt", "createdAt": "2020-05-07T23:12:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NjI1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NzA5NA==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421457094", "bodyText": "maybe \"where year and month fields were not cleared\" ?", "author": "tobiasdiez", "createdAt": "2020-05-07T12:15:05Z", "path": "CHANGELOG.md", "diffHunk": "@@ -54,6 +54,7 @@ Note that this project **does not** adhere to [Semantic Versioning](http://semve\n - We fixed an issue where JabRef switched to discrete graphics under macOS [#5935](https://github.com/JabRef/jabref/issues/5935)\n - We fixed an issue where the Preferences entry preview will be unexpected modified leads to Value too long exception [#6198](https://github.com/JabRef/jabref/issues/6198)\n - We fixed an issue where custom jstyles for Open/LibreOffice would only be valid if a layout line for the entry type `default` was at the end of the layout section [#6303](https://github.com/JabRef/jabref/issues/6303)\n+- We fixed an issue where clear year and month field when converting to biblatex [#6224](https://github.com/JabRef/jabref/issues/6224)", "originalCommit": "93de4bcdcd4f430fc2113f123be99c47879c0325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgzNTExMw==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421835113", "bodyText": "Done.", "author": "catarinagomespt", "createdAt": "2020-05-07T22:40:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NzA5NA=="}], "type": "inlineReview"}, {"oid": "29ae438c8d9877897f706887b9b077cbfd60864d", "url": "https://github.com/JabRef/jabref/commit/29ae438c8d9877897f706887b9b077cbfd60864d", "message": "Fix changelog.md file", "committedDate": "2020-05-07T12:36:12Z", "type": "commit"}, {"oid": "559e7490cbb3ffcf56899b983296a92a82dda8b5", "url": "https://github.com/JabRef/jabref/commit/559e7490cbb3ffcf56899b983296a92a82dda8b5", "message": "Check If date field is filled and is equal to year it should be removed the year and month fields", "committedDate": "2020-05-08T00:17:13Z", "type": "commit"}, {"oid": "c4a4b1563247fee1d768f8a577687c86e21f4579", "url": "https://github.com/JabRef/jabref/commit/c4a4b1563247fee1d768f8a577687c86e21f4579", "message": "Added unit test: Cleanup With Date Already Present And Equals To Year Removes Year And Month", "committedDate": "2020-05-08T00:19:10Z", "type": "commit"}, {"oid": "e810e1e22b7481b48cd8514bac77d5a0392b0d98", "url": "https://github.com/JabRef/jabref/commit/e810e1e22b7481b48cd8514bac77d5a0392b0d98", "message": "ISSUE :: 6224 - Removed Unused import - java.util.Optional", "committedDate": "2020-05-08T00:39:38Z", "type": "commit"}, {"oid": "8750df7c83ccc3ab3c565d22e69d0d4ce2ff86ea", "url": "https://github.com/JabRef/jabref/commit/8750df7c83ccc3ab3c565d22e69d0d4ce2ff86ea", "message": "ISSUE :: 6224 - Separated org.jabref.model.FieldChange from previous imports", "committedDate": "2020-05-08T00:45:54Z", "type": "commit"}, {"oid": "433e800178b821565de0de49a4bf577596475993", "url": "https://github.com/JabRef/jabref/commit/433e800178b821565de0de49a4bf577596475993", "message": "Merge branch 'master' of github.com:JabRef/jabref into fix-for-issue-6224", "committedDate": "2020-05-08T09:39:37Z", "type": "commit"}, {"oid": "bf164595b211df427825ed84ce7d6909daf33536", "url": "https://github.com/JabRef/jabref/commit/bf164595b211df427825ed84ce7d6909daf33536", "message": "remove checkstyle warning", "committedDate": "2020-05-08T11:42:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422188068", "bodyText": "Can you give the variable year1 a more meaningful name? Sure, everybody understands that, but nevertheless, we try to write exemplary code in JabRef (I know, it's still a loooooong way to go).", "author": "calixtus", "createdAt": "2020-05-08T14:50:43Z", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(yearl -> {", "originalCommit": "bf164595b211df427825ed84ce7d6909daf33536", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwNzU5Mg==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422207592", "bodyText": "you're right, I forgot to change", "author": "catarinagomespt", "createdAt": "2020-05-08T15:25:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwODM2OQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422208369", "bodyText": "Done.", "author": "catarinagomespt", "createdAt": "2020-05-08T15:26:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwODk4MQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422208981", "bodyText": "Done.", "author": "catarinagomespt", "createdAt": "2020-05-08T15:28:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA=="}], "type": "inlineReview"}, {"oid": "0eb590659ab54a9a8b3a70927e1b26524b980aeb", "url": "https://github.com/JabRef/jabref/commit/0eb590659ab54a9a8b3a70927e1b26524b980aeb", "message": "Change variable newYear name", "committedDate": "2020-05-08T15:23:45Z", "type": "commit"}, {"oid": "1628f21355fa3292a2919796bb9b7c5e8cd23c6e", "url": "https://github.com/JabRef/jabref/commit/1628f21355fa3292a2919796bb9b7c5e8cd23c6e", "message": "Merge branch 'master' of github.com:JabRef/jabref into fix-for-issue-6224", "committedDate": "2020-05-09T15:59:45Z", "type": "commit"}, {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883", "url": "https://github.com/JabRef/jabref/commit/5b1c8529c7cbd5a35c0ac61be23884d3a5117883", "message": "Update Changelog.md", "committedDate": "2020-05-09T16:02:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTY3OQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422519679", "bodyText": "This should be 2011-01 to include the month, right?", "author": "tobiasdiez", "createdAt": "2020-05-09T16:56:16Z", "path": "src/test/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanupTest.java", "diffHunk": "@@ -46,6 +46,20 @@ public void cleanupWithDateAlreadyPresentDoesNothing() {\n         assertEquals(Optional.of(\"2012\"), entry.getField(StandardField.DATE));\n     }\n \n+    @Test\n+    public void cleanupWithDateAlreadyPresentAndEqualsToYearRemovesYearAndMonth() {\n+        BibEntry entry = new BibEntry();\n+        entry.setField(StandardField.YEAR, \"2011\");\n+        entry.setField(StandardField.MONTH, \"#jan#\");\n+        entry.setField(StandardField.DATE, \"2011\");\n+\n+        worker.cleanup(entry);\n+\n+        assertEquals(Optional.empty(), entry.getField(StandardField.YEAR));\n+        assertEquals(Optional.empty(), entry.getField(StandardField.MONTH));\n+        assertEquals(Optional.of(\"2011\"), entry.getField(StandardField.DATE));", "originalCommit": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk5NjczMQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r423996731", "bodyText": "Done.", "author": "catarinagomespt", "createdAt": "2020-05-12T19:58:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTY3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422519859", "bodyText": "Adding to @koppor's comment, we have a date class which you can use to parse the date in order to get the year AND the month.", "author": "tobiasdiez", "createdAt": "2020-05-09T16:58:01Z", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "originalCommit": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMDM2Nw==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422530367", "bodyText": "@koppor @tobiasdiez\nPlease confirm that I understood correctly:\nAcceptance Criteria  1:\n\nIf the month + year fields are equal to the month + year in the date field, must clear the month and the year.\nStart:\ndate = \"2020-05\"\nmonth = \"05\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"\"\nyear = \"\"\n\nAcceptance Criteria 2:\n\nIf the month field is different from the month in the date field, does nothing\nStart:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"2020\"\n\nAcceptance Criteria 3:\n\nIf the year field is different from the year in the date field, does nothing\nStart:\ndate = \"2020-05\"\nmonth = \"05\"\nyear = \"2019\"\nResult:\ndate = \"2020-05\"\nmonth = \"05\"\nyear = \"2019\"\n\nAcceptance Criteria 4:\n\nIf the date field has a blank/empty value, must set the date field with year and month values and clear the month + year fields.\nStart:\ndate = \"\"\nmonth = \"05\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"\"\nyear = \"\"\n\nThanks", "author": "catarinagomespt", "createdAt": "2020-05-09T18:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMDcxNg==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422530716", "bodyText": "@koppor @tobiasdiez\nAnother question:\nWhat should happen if we have the following situation?\ndate = \"2020\"\nmonth = \"04\"\nyear = \"2020\"\nResult: ???", "author": "catarinagomespt", "createdAt": "2020-05-09T18:38:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMTA2Mg==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422531062", "bodyText": "I think in scenario 2 + 3 the correct information (the month in 2, the year in 3) can be deleted leaving only differing information behind. Thanks for the detailed specification.", "author": "tobiasdiez", "createdAt": "2020-05-09T18:40:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMjE5OQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422532199", "bodyText": "@tobiasdiez\nJust to make sure I got it right.\nStart:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"\"\nPlease, confirms that the result is correct.", "author": "catarinagomespt", "createdAt": "2020-05-09T18:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMjc4Nw==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422532787", "bodyText": "For inconsistent data: Don't overwrite/move. Keep as is", "author": "Siedlerchr", "createdAt": "2020-05-09T18:56:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzNzM3Mg==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422537372", "bodyText": "@tobiasdiez\n\nAdding to @koppor's comment, we have a date class which you can use to parse the date in order to get the year AND the month.\n\nWhat is the class name?", "author": "catarinagomespt", "createdAt": "2020-05-09T19:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0Mzc1MQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422543751", "bodyText": "https://github.com/JabRef/jabref/blob/master/src/main/java/org/jabref/model/entry/Date.java", "author": "tobiasdiez", "createdAt": "2020-05-09T20:42:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}], "type": "inlineReview"}, {"oid": "05c86c2428ef95a76ae758000189f55ef9e16570", "url": "https://github.com/JabRef/jabref/commit/05c86c2428ef95a76ae758000189f55ef9e16570", "message": "ISSUE :: 6224 - Added month validation and tests", "committedDate": "2020-05-10T20:21:32Z", "type": "commit"}, {"oid": "fb75aa507fb06251808db3d8c790b82028e8e8c1", "url": "https://github.com/JabRef/jabref/commit/fb75aa507fb06251808db3d8c790b82028e8e8c1", "message": "ISSUE :: 6224 - For inconsistent data: Do not overwrite/move", "committedDate": "2020-05-12T19:24:19Z", "type": "commit"}, {"oid": "3541c2f96568650b25d04acc6bdf10faf55fa7e6", "url": "https://github.com/JabRef/jabref/commit/3541c2f96568650b25d04acc6bdf10faf55fa7e6", "message": "ISSUE :: 6224 - Fix Test", "committedDate": "2020-05-12T19:33:31Z", "type": "commit"}, {"oid": "23b9878b3b3334a9d26a3f9f79cc3ab72e345141", "url": "https://github.com/JabRef/jabref/commit/23b9878b3b3334a9d26a3f9f79cc3ab72e345141", "message": "Merge branch 'master' of github.com:JabRef/jabref into fix-for-issue-6224", "committedDate": "2020-05-12T19:33:58Z", "type": "commit"}, {"oid": "935f65616dbc3053eba514326aaea9c1fe13f81f", "url": "https://github.com/JabRef/jabref/commit/935f65616dbc3053eba514326aaea9c1fe13f81f", "message": "ISSUE :: 6224 - Added month checking Test", "committedDate": "2020-05-12T19:38:59Z", "type": "commit"}, {"oid": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645", "url": "https://github.com/JabRef/jabref/commit/c2b1950ef575e4f5b784d93e33c71b0ba3ad5645", "message": "ISSUE :: 6224 - Fix Test", "committedDate": "2020-05-12T19:47:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1NjY0Ng==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424456646", "bodyText": "Could you please adjust the javadoc as well?", "author": "Siedlerchr", "createdAt": "2020-05-13T13:54:34Z", "path": "src/main/java/org/jabref/model/entry/Date.java", "diffHunk": "@@ -54,7 +54,8 @@ public Date(TemporalAccessor date) {\n                 \"MMMM d, uuuu\",\n                 \"MMMM, uuuu\",\n                 \"d.M.uuuu\",\n-                \"uuuu.M.d\", \"uuuu\");\n+                \"uuuu.M.d\", \"uuuu\",\n+                \"MMM, uuuu\");", "originalCommit": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc4MTcwNQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424781705", "bodyText": "Done. Please confirm.", "author": "catarinagomespt", "createdAt": "2020-05-13T23:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1NjY0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NzUwNg==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424467506", "bodyText": "One of the Date.parse method overloads accepts already Optional as parameter, so you can make your code a bit easier and remove the ifPressent checks for Year and month\nso you would have checkDate = Date.parse(entry.getFieldOrAlias(StandardField.YEAR),  entry.getFieldOrAlias(StandardField.Month), Optional.empty())", "author": "Siedlerchr", "createdAt": "2020-05-13T14:09:00Z", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +41,26 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If the year from date field is filled and equal to year it should be removed the year field\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(year -> {", "originalCommit": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY5NTg0MA==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424695840", "bodyText": "@Siedlerchr Thanks for the tip. Already did that.", "author": "catarinagomespt", "createdAt": "2020-05-13T19:58:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NzUwNg=="}], "type": "inlineReview"}, {"oid": "5604f3c6fcd157006e7a8606cc04f115f0aed4fb", "url": "https://github.com/JabRef/jabref/commit/5604f3c6fcd157006e7a8606cc04f115f0aed4fb", "message": "ISSUE :: 6224 - Change Date.parse", "committedDate": "2020-05-13T19:04:24Z", "type": "commit"}, {"oid": "28e9c6d50e4c7436b4d473086f1e4a472eeaa920", "url": "https://github.com/JabRef/jabref/commit/28e9c6d50e4c7436b4d473086f1e4a472eeaa920", "message": "ISSUE :: 6224 - Update Date class", "committedDate": "2020-05-13T19:16:51Z", "type": "commit"}, {"oid": "3c0d2a4caaab6b912252080bfaddf7787bf44276", "url": "https://github.com/JabRef/jabref/commit/3c0d2a4caaab6b912252080bfaddf7787bf44276", "message": "ISSUE :: 6224 - Fix Date", "committedDate": "2020-05-13T19:52:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMTYxMA==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424731610", "bodyText": "Just a quick note,\nThe Optional equals also returns true if both are empty.\nThat could be the case when there is a value in all fields, but it's invalid., eg maybe some random letters.\nCould you please add a test case for that as well. Then you should have all cases covered. I think in practice this doesn't matter but code wise it would be nice to have this edge case covered as well.\nOtherwise it's looking good to me! Thanks again for your ongoing contribution\nhttps://docs.oracle.com/javase/8/docs/api/java/util/Optional.html#equals-java.lang.Object-", "author": "Siedlerchr", "createdAt": "2020-05-13T21:07:42Z", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +41,19 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If the year from date field is filled and equal to year it should be removed the year field\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                Optional<Date> newDate = Date.parse(date);\n+                Optional<Date> checkDate = Date.parse(entry.getFieldOrAlias(StandardField.YEAR),\n+                        entry.getFieldOrAlias(StandardField.MONTH), Optional.empty());\n+", "originalCommit": "3c0d2a4caaab6b912252080bfaddf7787bf44276", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc4MzM0OQ==", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424783349", "bodyText": "@Siedlerchr You are right, if both fields are empty returns true. I added a new test case to cover it.", "author": "catarinagomespt", "createdAt": "2020-05-13T23:14:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMTYxMA=="}], "type": "inlineReview"}, {"oid": "3b910f66b8b61a36cc4402b0e29cee7d599ebbba", "url": "https://github.com/JabRef/jabref/commit/3b910f66b8b61a36cc4402b0e29cee7d599ebbba", "message": "ISSUE :: 6224 - Added new test", "committedDate": "2020-05-13T23:02:20Z", "type": "commit"}, {"oid": "440db8822460e39df663356d5795c50e3f98bc6a", "url": "https://github.com/JabRef/jabref/commit/440db8822460e39df663356d5795c50e3f98bc6a", "message": "Merge branch 'master' of github.com:JabRef/jabref into fix-for-issue-6224", "committedDate": "2020-05-13T23:18:09Z", "type": "commit"}]}