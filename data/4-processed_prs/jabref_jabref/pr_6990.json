{"pr_number": 6990, "pr_title": "Fix DOI fetcher and add documentation on fetcher trust levels", "pr_createdAt": "2020-10-07T20:39:02Z", "pr_url": "https://github.com/JabRef/jabref/pull/6990", "timeline": [{"oid": "9c83714928a9664d0af258a52537544d2e25e2bc", "url": "https://github.com/JabRef/jabref/commit/9c83714928a9664d0af258a52537544d2e25e2bc", "message": "Add documentation on fetcher trust levels", "committedDate": "2020-10-07T20:37:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ3NDg5NQ==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501474895", "bodyText": "This is not entirely correct AFAICT. The problem with getting proceedings instead of the individual paper exists only for Springer.\nOther publishers (such as IEEE) can be added here if a tailored fetcher for them exists that also fetches a PDF for a DOI. Such a tailored fetcher will run in parallel with this class here and get at least the same result, if not a better one, but with a lower TrustLevel (like for Springer DOIs). Therefore, if the DOI at hand leads to one of those publishers, we can skip the DOI search via this class here.", "author": "Toromtomtom", "createdAt": "2020-10-08T06:24:54Z", "path": "src/main/java/org/jabref/logic/importer/fetcher/DoiResolution.java", "diffHunk": "@@ -33,7 +33,10 @@\n     private static final Logger LOGGER = LoggerFactory.getLogger(DoiResolution.class);\n \n     /**\n-     * Hosts for which tailored fetchers exist, so this fetcher is not needed.\n+     * A DOI leads to the page of the paper. We assume that there is the PDF of the paper.\n+     * Thus, the DOI fetcher is ranked highest (see {@link TrustLevel}).\n+     * Some publishers do not publish the PDF of the paper, but the full proceedings on the page\n+     * of the paper. For these publishers, we need to skip the DOI search.", "originalCommit": "9c83714928a9664d0af258a52537544d2e25e2bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUwMTYwNw==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501501607", "bodyText": "We assume that the DOI fetcher returns a DOI if it is (nearly) 100% sure that a DOI is determined. We assume the custom fetchers also return something even if they are not 100% sure (right @stefan-kolb?)\nThis is what I tried to write down at https://github.com/JabRef/jabref/pull/6990/files#diff-d3fe05c852562027c0866670547c8b8a\nIf we trust in general ALL custom fetchers more, we need to switch the numbers for SOURCE and PUBLSIHER in TrustLevel (https://github.com/JabRef/jabref/pull/6990/files#diff-77f5ba02dd7375d532d9c3aee3527dfc)", "author": "koppor", "createdAt": "2020-10-08T07:24:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ3NDg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ4OTg3OA==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r554489878", "bodyText": "We fixed a similarity problem inside the DOIResolution that REALLY caused this issue.", "author": "stefan-kolb", "createdAt": "2021-01-10T00:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ3NDg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUwNDM4NA==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501504384", "bodyText": "It would be good if these trust levels are described in more detail, i.e. what are the criteria.", "author": "tobiasdiez", "createdAt": "2020-10-08T07:29:30Z", "path": "docs/advanced-reading/fetchers.md", "diffHunk": "@@ -14,6 +14,42 @@ Fetchers are the implementation of the [search using online services](https://do\n \n On Windows, you have to log-off and log-on to let IntelliJ know about the environment variable change. Execute the gradle task \"processResources\" in the group \"others\" within IntelliJ to ensure the values have been correctly written. Now, the fetcher tests should run without issues.\n \n+## Fetcher prioritization\n+\n+- all fetchers run in parallel\n+- the result with the highest priority wins\n+- `InterruptedException` | `ExecutionException` | `CancellationException` are ignored\n+\n+### Trust Levels\n+\n+- SOURCE (highest)\n+- PUBLISHER", "originalCommit": "9c83714928a9664d0af258a52537544d2e25e2bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUwNDYyNw==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501504627", "bodyText": "That may change in the future, and I wouldn't add the current levels here (one source of trust: code).", "author": "tobiasdiez", "createdAt": "2020-10-08T07:29:59Z", "path": "docs/advanced-reading/fetchers.md", "diffHunk": "@@ -14,6 +14,42 @@ Fetchers are the implementation of the [search using online services](https://do\n \n On Windows, you have to log-off and log-on to let IntelliJ know about the environment variable change. Execute the gradle task \"processResources\" in the group \"others\" within IntelliJ to ensure the values have been correctly written. Now, the fetcher tests should run without issues.\n \n+## Fetcher prioritization\n+\n+- all fetchers run in parallel\n+- the result with the highest priority wins\n+- `InterruptedException` | `ExecutionException` | `CancellationException` are ignored\n+\n+### Trust Levels\n+\n+- SOURCE (highest)\n+- PUBLISHER\n+- PREPRINT\n+- META_SEARCH\n+- UNKNOWN (lowest)\n+\n+### Current trust levels\n+\n+All fetchers are contained in the package `org.jabref.logic.importer.fetcher`.", "originalCommit": "9c83714928a9664d0af258a52537544d2e25e2bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUwNTQ1OQ==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501505459", "bodyText": "This only applies to download fetcher, right?", "author": "tobiasdiez", "createdAt": "2020-10-08T07:31:39Z", "path": "docs/advanced-reading/fetchers.md", "diffHunk": "@@ -14,6 +14,42 @@ Fetchers are the implementation of the [search using online services](https://do\n \n On Windows, you have to log-off and log-on to let IntelliJ know about the environment variable change. Execute the gradle task \"processResources\" in the group \"others\" within IntelliJ to ensure the values have been correctly written. Now, the fetcher tests should run without issues.\n \n+## Fetcher prioritization\n+\n+- all fetchers run in parallel", "originalCommit": "9c83714928a9664d0af258a52537544d2e25e2bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNzAzNQ==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501537035", "bodyText": "Source as the DOI is always forwarded to the correct publisher page for the paper", "author": "stefan-kolb", "createdAt": "2020-10-08T08:25:42Z", "path": "docs/advanced-reading/fetchers.md", "diffHunk": "@@ -14,6 +14,42 @@ Fetchers are the implementation of the [search using online services](https://do\n \n On Windows, you have to log-off and log-on to let IntelliJ know about the environment variable change. Execute the gradle task \"processResources\" in the group \"others\" within IntelliJ to ensure the values have been correctly written. Now, the fetcher tests should run without issues.\n \n+## Fetcher prioritization\n+\n+- all fetchers run in parallel\n+- the result with the highest priority wins\n+- `InterruptedException` | `ExecutionException` | `CancellationException` are ignored\n+\n+### Trust Levels\n+\n+- SOURCE (highest)\n+- PUBLISHER\n+- PREPRINT\n+- META_SEARCH\n+- UNKNOWN (lowest)\n+\n+### Current trust levels\n+\n+All fetchers are contained in the package `org.jabref.logic.importer.fetcher`.\n+Here we list the trust levels of some of them:\n+\n+- DOI: SOURCE, because it is the ultimate source", "originalCommit": "9c83714928a9664d0af258a52537544d2e25e2bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNzYyOQ==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501537629", "bodyText": "Might be wrong publisher or might search based on string similarity not always on DOI", "author": "stefan-kolb", "createdAt": "2020-10-08T08:26:40Z", "path": "docs/advanced-reading/fetchers.md", "diffHunk": "@@ -14,6 +14,42 @@ Fetchers are the implementation of the [search using online services](https://do\n \n On Windows, you have to log-off and log-on to let IntelliJ know about the environment variable change. Execute the gradle task \"processResources\" in the group \"others\" within IntelliJ to ensure the values have been correctly written. Now, the fetcher tests should run without issues.\n \n+## Fetcher prioritization\n+\n+- all fetchers run in parallel\n+- the result with the highest priority wins\n+- `InterruptedException` | `ExecutionException` | `CancellationException` are ignored\n+\n+### Trust Levels\n+\n+- SOURCE (highest)\n+- PUBLISHER\n+- PREPRINT\n+- META_SEARCH\n+- UNKNOWN (lowest)\n+\n+### Current trust levels\n+\n+All fetchers are contained in the package `org.jabref.logic.importer.fetcher`.\n+Here we list the trust levels of some of them:\n+\n+- DOI: SOURCE, because it is the ultimate source\n+- ScienceDirect: Publisher\n+- Springer: Publisher", "originalCommit": "9c83714928a9664d0af258a52537544d2e25e2bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzOTEwNg==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r501539106", "bodyText": "Also often requires an API_KEY and counts towards the api key usage limit", "author": "Siedlerchr", "createdAt": "2020-10-08T08:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNzYyOQ=="}], "type": "inlineReview"}, {"oid": "0bab0d27d92cec326bd6c0f510b7a1c885aa736c", "url": "https://github.com/JabRef/jabref/commit/0bab0d27d92cec326bd6c0f510b7a1c885aa736c", "message": "Merge remote-tracking branch 'origin/master' into add-fetcher-doc", "committedDate": "2021-01-09T22:02:04Z", "type": "commit"}, {"oid": "9e8417534e1a679b9108f8c88e1d6fca14d218c4", "url": "https://github.com/JabRef/jabref/commit/9e8417534e1a679b9108f8c88e1d6fca14d218c4", "message": "Avoid 'null' as evaluation result if env variable is not defined", "committedDate": "2021-01-09T22:58:08Z", "type": "commit"}, {"oid": "ca98634410d9069c25d0e835f7786e70ca68f0dc", "url": "https://github.com/JabRef/jabref/commit/ca98634410d9069c25d0e835f7786e70ca68f0dc", "message": "Refine documentation", "committedDate": "2021-01-09T22:58:34Z", "type": "commit"}, {"oid": "a39f3dcfc58a1d9a66397f3f70ae8e14ce30abfc", "url": "https://github.com/JabRef/jabref/commit/a39f3dcfc58a1d9a66397f3f70ae8e14ce30abfc", "message": "Improve DOIResolution\n\n- remove similarity of links\n- add citation meta tag <meta name=\"citation_pdf_url\">", "committedDate": "2021-01-10T00:25:09Z", "type": "commit"}, {"oid": "a39f3dcfc58a1d9a66397f3f70ae8e14ce30abfc", "url": "https://github.com/JabRef/jabref/commit/a39f3dcfc58a1d9a66397f3f70ae8e14ce30abfc", "message": "Improve DOIResolution\n\n- remove similarity of links\n- add citation meta tag <meta name=\"citation_pdf_url\">", "committedDate": "2021-01-10T00:25:09Z", "type": "forcePushed"}, {"oid": "b5746a2fb94edbd2cf0c0f6011e8fc55615e25de", "url": "https://github.com/JabRef/jabref/commit/b5746a2fb94edbd2cf0c0f6011e8fc55615e25de", "message": "Fix test\n\nDefault value is \"\" and not \"null\"", "committedDate": "2021-01-10T00:42:19Z", "type": "commit"}, {"oid": "e6e0d68a2606791a639977e5d136567ea3912d2e", "url": "https://github.com/JabRef/jabref/commit/e6e0d68a2606791a639977e5d136567ea3912d2e", "message": "Fix typo", "committedDate": "2021-01-10T00:47:15Z", "type": "commit"}, {"oid": "1a14a4721ea5388bd448eb000d4a5b6940def7f1", "url": "https://github.com/JabRef/jabref/commit/1a14a4721ea5388bd448eb000d4a5b6940def7f1", "message": "Unused imports", "committedDate": "2021-01-10T00:47:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDU3OTc3OQ==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r554579779", "bodyText": "Why was this test removed?", "author": "tobiasdiez", "createdAt": "2021-01-10T15:02:49Z", "path": "src/test/java/org/jabref/logic/importer/fetcher/DoiResolutionTest.java", "diffHunk": "@@ -38,13 +38,13 @@ void linkWithPdfInTitleTag() throws IOException {\n     @Test\n     void linkWithPdfStringLeadsToFulltext() throws IOException {\n         entry.setField(StandardField.DOI, \"10.1002/acr2.11101\");\n-        assertEquals(Optional.of(new URL(\"https://onlinelibrary.wiley.com/doi/epdf/10.1002/acr2.11101\")), finder.findFullText(entry));\n+        assertEquals(Optional.of(new URL(\"https://onlinelibrary.wiley.com/doi/pdf/10.1002/acr2.11101\")), finder.findFullText(entry));\n     }\n \n     @Test\n-    void multipleLinksWithSmallEditDistanceLeadToFulltext() throws IOException {", "originalCommit": "1a14a4721ea5388bd448eb000d4a5b6940def7f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDYzMjAyNA==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r554632024", "bodyText": "Edit distance functionality was removed. Actually it was the reason for the bug.", "author": "stefan-kolb", "createdAt": "2021-01-10T22:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDU3OTc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDYzMjEyNw==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r554632127", "bodyText": "The paper used at that test case is used at another test case.", "author": "koppor", "createdAt": "2021-01-10T22:26:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDU3OTc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMxNzAxNg==", "url": "https://github.com/JabRef/jabref/pull/6990#discussion_r555317016", "bodyText": "Ah ok, now I see. Thanks!", "author": "tobiasdiez", "createdAt": "2021-01-11T20:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDU3OTc3OQ=="}], "type": "inlineReview"}, {"oid": "23b6a6d330b65d330389dc8dfbec995c36ebe0c9", "url": "https://github.com/JabRef/jabref/commit/23b6a6d330b65d330389dc8dfbec995c36ebe0c9", "message": "Merge branch 'master' into add-fetcher-doc", "committedDate": "2021-01-11T20:44:18Z", "type": "commit"}]}