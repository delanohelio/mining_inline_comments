{"pr_number": 5826, "pr_title": "Conversion of group dialog to mvvm-pattern", "pr_createdAt": "2020-01-12T17:05:10Z", "pr_url": "https://github.com/JabRef/jabref/pull/5826", "timeline": [{"oid": "5b40508c3b03e38a9016ada3ad5fbebb996fc588", "url": "https://github.com/JabRef/jabref/commit/5b40508c3b03e38a9016ada3ad5fbebb996fc588", "message": "Converted GroupDialog to mvvm pattern", "committedDate": "2020-01-10T22:17:17Z", "type": "commit"}, {"oid": "8351736a6d4afb27909e86d7a6b2e4362798bb38", "url": "https://github.com/JabRef/jabref/commit/8351736a6d4afb27909e86d7a6b2e4362798bb38", "message": "Added hintTextFlow, some rewording and changed the hierarchicalContext RadioButtons to a ComboBox", "committedDate": "2020-01-12T16:15:08Z", "type": "commit"}, {"oid": "c77cd42d27b7793dc5f030b0bdedaab88812de66", "url": "https://github.com/JabRef/jabref/commit/c77cd42d27b7793dc5f030b0bdedaab88812de66", "message": "Moved GroupDescription-stuff to proper class", "committedDate": "2020-01-12T16:45:47Z", "type": "commit"}, {"oid": "c89eeeaca2ba3f0dadb865813fe11c2d33a3eb9c", "url": "https://github.com/JabRef/jabref/commit/c89eeeaca2ba3f0dadb865813fe11c2d33a3eb9c", "message": "Merge remote-tracking branch 'upstream/master' into group_dialog_mvvm\n\n# Conflicts:\n#\tsrc/main/java/module-info.java", "committedDate": "2020-01-12T16:47:25Z", "type": "commit"}, {"oid": "bdfc99af09c6d362d35e28a2c40ca1b0fff15dce", "url": "https://github.com/JabRef/jabref/commit/bdfc99af09c6d362d35e28a2c40ca1b0fff15dce", "message": "Removed description, fixed ok button and added some minor improvements", "committedDate": "2020-01-18T18:41:53Z", "type": "commit"}, {"oid": "a2c07bac4d5f4cbe26280026eff6e7b0680c5b00", "url": "https://github.com/JabRef/jabref/commit/a2c07bac4d5f4cbe26280026eff6e7b0680c5b00", "message": "Merge remote-tracking branch 'upstream/master' into group_dialog_mvvm\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties", "committedDate": "2020-01-18T18:45:21Z", "type": "commit"}, {"oid": "84bece2a2a60c1f4d42816cb80bde92583a5336c", "url": "https://github.com/JabRef/jabref/commit/84bece2a2a60c1f4d42816cb80bde92583a5336c", "message": "Minor visual adjustments", "committedDate": "2020-01-18T23:07:27Z", "type": "commit"}, {"oid": "3579f6e71acd757b12acb691c30fa29b2528e136", "url": "https://github.com/JabRef/jabref/commit/3579f6e71acd757b12acb691c30fa29b2528e136", "message": "forgotten l10n resources", "committedDate": "2020-01-18T23:18:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxMzQxOQ==", "url": "https://github.com/JabRef/jabref/pull/5826#discussion_r368313419", "bodyText": "I'm not entirely sure if this helps, but maybe worth a try:  In the shared database dialog I initialized this Composite Validator in the ctor and immediately added all validators and that worked without any NPE\n   formValidator = new CompositeValidator();\n    formValidator.addValidators(databaseValidator, hostValidator, portValidator, userValidator);", "author": "Siedlerchr", "createdAt": "2020-01-19T18:45:51Z", "path": "src/main/java/org/jabref/gui/groups/GroupDialogViewModel.java", "diffHunk": "@@ -0,0 +1,469 @@\n+package org.jabref.gui.groups;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.paint.Color;\n+\n+import org.jabref.Globals;\n+import org.jabref.gui.BasePanel;\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.help.HelpAction;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.logic.auxparser.DefaultAuxParser;\n+import org.jabref.logic.help.HelpFile;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.logic.util.io.FileUtil;\n+import org.jabref.model.database.BibDatabase;\n+import org.jabref.model.entry.field.FieldFactory;\n+import org.jabref.model.groups.AbstractGroup;\n+import org.jabref.model.groups.AutomaticGroup;\n+import org.jabref.model.groups.AutomaticKeywordGroup;\n+import org.jabref.model.groups.AutomaticPersonsGroup;\n+import org.jabref.model.groups.ExplicitGroup;\n+import org.jabref.model.groups.GroupHierarchyType;\n+import org.jabref.model.groups.GroupTreeNode;\n+import org.jabref.model.groups.RegexKeywordGroup;\n+import org.jabref.model.groups.SearchGroup;\n+import org.jabref.model.groups.TexGroup;\n+import org.jabref.model.groups.WordKeywordGroup;\n+import org.jabref.model.metadata.MetaData;\n+import org.jabref.model.strings.StringUtil;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+import de.saxsys.mvvmfx.utils.validation.CompositeValidator;\n+import de.saxsys.mvvmfx.utils.validation.FunctionBasedValidator;\n+import de.saxsys.mvvmfx.utils.validation.ValidationMessage;\n+import de.saxsys.mvvmfx.utils.validation.ValidationStatus;\n+import de.saxsys.mvvmfx.utils.validation.Validator;\n+\n+public class GroupDialogViewModel {\n+\n+    // Basic Settings\n+    private final StringProperty nameProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty descriptionProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty iconProperty = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<Color> colorProperty = new SimpleObjectProperty<>();\n+    private final ListProperty<GroupHierarchyType> groupHierarchyListProperty = new SimpleListProperty<>();\n+    private final ObjectProperty<GroupHierarchyType> groupHierarchySelectedProperty = new SimpleObjectProperty<>();\n+\n+    // Type\n+    private final BooleanProperty typeExplicitProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeKeywordsProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeSearchProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeAutoProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeTexProperty = new SimpleBooleanProperty();\n+\n+    // Option Groups\n+    private final StringProperty keywordGroupSearchTermProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty keywordGroupSearchFieldProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty keywordGroupCaseSensitiveProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty keywordGroupRegexProperty = new SimpleBooleanProperty();\n+\n+    private final StringProperty searchGroupSearchTermProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty searchGroupCaseSensitiveProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty searchGroupRegexProperty = new SimpleBooleanProperty();\n+\n+    private final BooleanProperty autoGroupKeywordsOptionProperty = new SimpleBooleanProperty();\n+    private final StringProperty autoGroupKeywordsFieldProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty autoGroupKeywordsDelimiterProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty autoGroupKeywordsHierarchicalDelimiterProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty autoGroupPersonsOptionProperty = new SimpleBooleanProperty();\n+    private final StringProperty autoGroupPersonsFieldProperty = new SimpleStringProperty(\"\");\n+\n+    private final StringProperty texGroupFilePathProperty = new SimpleStringProperty(\"\");\n+\n+    private Validator nameValidator;\n+    private Validator nameContainsDelimiterValidator;\n+    private Validator sameNameValidator;\n+    private Validator keywordRegexValidator;\n+    private Validator keywordSearchTermEmptyValidator;\n+    private Validator searchRegexValidator;\n+    private Validator searchSearchTermEmptyValidator;\n+    private CompositeValidator validator = new CompositeValidator();", "originalCommit": "3579f6e71acd757b12acb691c30fa29b2528e136", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxNjkwOQ==", "url": "https://github.com/JabRef/jabref/pull/5826#discussion_r368316909", "bodyText": "Tried that.\nThe validator works fine, it's the lookupbutton method which doesn't work. The buttons seem to be initialized after the rest of the dialog. Nevertheless, it works now. By adding a listener, the lookupbutton method is now called every time something changes. So... Whatever. ;)", "author": "calixtus", "createdAt": "2020-01-19T19:45:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxMzQxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxNzg1MA==", "url": "https://github.com/JabRef/jabref/pull/5826#discussion_r368317850", "bodyText": "You already pass the JabRefPreferences as parameter", "author": "Siedlerchr", "createdAt": "2020-01-19T20:00:17Z", "path": "src/main/java/org/jabref/gui/groups/GroupDialogViewModel.java", "diffHunk": "@@ -0,0 +1,469 @@\n+package org.jabref.gui.groups;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.paint.Color;\n+\n+import org.jabref.Globals;\n+import org.jabref.gui.BasePanel;\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.help.HelpAction;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.logic.auxparser.DefaultAuxParser;\n+import org.jabref.logic.help.HelpFile;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.logic.util.io.FileUtil;\n+import org.jabref.model.database.BibDatabase;\n+import org.jabref.model.entry.field.FieldFactory;\n+import org.jabref.model.groups.AbstractGroup;\n+import org.jabref.model.groups.AutomaticGroup;\n+import org.jabref.model.groups.AutomaticKeywordGroup;\n+import org.jabref.model.groups.AutomaticPersonsGroup;\n+import org.jabref.model.groups.ExplicitGroup;\n+import org.jabref.model.groups.GroupHierarchyType;\n+import org.jabref.model.groups.GroupTreeNode;\n+import org.jabref.model.groups.RegexKeywordGroup;\n+import org.jabref.model.groups.SearchGroup;\n+import org.jabref.model.groups.TexGroup;\n+import org.jabref.model.groups.WordKeywordGroup;\n+import org.jabref.model.metadata.MetaData;\n+import org.jabref.model.strings.StringUtil;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+import de.saxsys.mvvmfx.utils.validation.CompositeValidator;\n+import de.saxsys.mvvmfx.utils.validation.FunctionBasedValidator;\n+import de.saxsys.mvvmfx.utils.validation.ValidationMessage;\n+import de.saxsys.mvvmfx.utils.validation.ValidationStatus;\n+import de.saxsys.mvvmfx.utils.validation.Validator;\n+\n+public class GroupDialogViewModel {\n+\n+    // Basic Settings\n+    private final StringProperty nameProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty descriptionProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty iconProperty = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<Color> colorProperty = new SimpleObjectProperty<>();\n+    private final ListProperty<GroupHierarchyType> groupHierarchyListProperty = new SimpleListProperty<>();\n+    private final ObjectProperty<GroupHierarchyType> groupHierarchySelectedProperty = new SimpleObjectProperty<>();\n+\n+    // Type\n+    private final BooleanProperty typeExplicitProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeKeywordsProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeSearchProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeAutoProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty typeTexProperty = new SimpleBooleanProperty();\n+\n+    // Option Groups\n+    private final StringProperty keywordGroupSearchTermProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty keywordGroupSearchFieldProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty keywordGroupCaseSensitiveProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty keywordGroupRegexProperty = new SimpleBooleanProperty();\n+\n+    private final StringProperty searchGroupSearchTermProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty searchGroupCaseSensitiveProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty searchGroupRegexProperty = new SimpleBooleanProperty();\n+\n+    private final BooleanProperty autoGroupKeywordsOptionProperty = new SimpleBooleanProperty();\n+    private final StringProperty autoGroupKeywordsFieldProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty autoGroupKeywordsDelimiterProperty = new SimpleStringProperty(\"\");\n+    private final StringProperty autoGroupKeywordsHierarchicalDelimiterProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty autoGroupPersonsOptionProperty = new SimpleBooleanProperty();\n+    private final StringProperty autoGroupPersonsFieldProperty = new SimpleStringProperty(\"\");\n+\n+    private final StringProperty texGroupFilePathProperty = new SimpleStringProperty(\"\");\n+\n+    private Validator nameValidator;\n+    private Validator nameContainsDelimiterValidator;\n+    private Validator sameNameValidator;\n+    private Validator keywordRegexValidator;\n+    private Validator keywordSearchTermEmptyValidator;\n+    private Validator searchRegexValidator;\n+    private Validator searchSearchTermEmptyValidator;\n+    private CompositeValidator validator = new CompositeValidator();\n+\n+    private final DialogService dialogService;\n+    private final JabRefPreferences preferences;\n+    private final BasePanel basePanel;\n+    private final AbstractGroup editedGroup;\n+\n+    private final Character keywordDelimiter;\n+\n+    public GroupDialogViewModel(DialogService dialogService, BasePanel basePanel, JabRefPreferences preferences, AbstractGroup editedGroup) {\n+        this.dialogService = dialogService;\n+        this.preferences = preferences;\n+        this.basePanel = basePanel;\n+        this.editedGroup = editedGroup;\n+\n+        this.keywordDelimiter = Globals.prefs.getKeywordDelimiter();", "originalCommit": "3579f6e71acd757b12acb691c30fa29b2528e136", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxOTc1OA==", "url": "https://github.com/JabRef/jabref/pull/5826#discussion_r368319758", "bodyText": "Thanks. Forgot that in refactoring.", "author": "calixtus", "createdAt": "2020-01-19T20:25:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxNzg1MA=="}], "type": "inlineReview"}, {"oid": "9968373199ec4fb1d14ef74f49a15d3f980ee3ee", "url": "https://github.com/JabRef/jabref/commit/9968373199ec4fb1d14ef74f49a15d3f980ee3ee", "message": "Merge remote-tracking branch 'upstream/master' into group_dialog_mvvm\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties", "committedDate": "2020-01-21T11:08:53Z", "type": "commit"}, {"oid": "64c3c6e9a91713fd7198a12376bc98bbafa080a0", "url": "https://github.com/JabRef/jabref/commit/64c3c6e9a91713fd7198a12376bc98bbafa080a0", "message": "Minor refactoring, and changed comment", "committedDate": "2020-01-21T11:12:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0MzEzMQ==", "url": "https://github.com/JabRef/jabref/pull/5826#discussion_r370943131", "bodyText": "Can you please inline these constructors that use global variables (let the caller care where to get them).", "author": "tobiasdiez", "createdAt": "2020-01-25T16:45:15Z", "path": "src/main/java/org/jabref/gui/groups/GroupDialogView.java", "diffHunk": "@@ -0,0 +1,184 @@\n+package org.jabref.gui.groups;\n+\n+import javafx.application.Platform;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ColorPicker;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.RadioButton;\n+import javafx.scene.control.TextField;\n+\n+import org.jabref.Globals;\n+import org.jabref.JabRefGUI;\n+import org.jabref.gui.BasePanel;\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.IconValidationDecorator;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.groups.AbstractGroup;\n+import org.jabref.model.groups.GroupHierarchyType;\n+import org.jabref.preferences.JabRefPreferences;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+import de.saxsys.mvvmfx.utils.validation.visualization.ControlsFxVisualizer;\n+\n+public class GroupDialogView extends BaseDialog<AbstractGroup> {\n+\n+    // Basic Settings\n+    @FXML private TextField nameField;\n+    @FXML private TextField descriptionField;\n+    @FXML private TextField iconField;\n+    @FXML private ColorPicker colorField;\n+    @FXML private ComboBox<GroupHierarchyType> hierarchicalContextCombo;\n+\n+    // Type\n+    @FXML private RadioButton explicitRadioButton;\n+    @FXML private RadioButton keywordsRadioButton;\n+    @FXML private RadioButton searchRadioButton;\n+    @FXML private RadioButton autoRadioButton;\n+    @FXML private RadioButton texRadioButton;\n+\n+    // Option Groups\n+    @FXML private TextField keywordGroupSearchTerm;\n+    @FXML private TextField keywordGroupSearchField;\n+    @FXML private CheckBox keywordGroupCaseSensitive;\n+    @FXML private CheckBox keywordGroupRegex;\n+\n+    @FXML private TextField searchGroupSearchTerm;\n+    @FXML private CheckBox searchGroupCaseSensitive;\n+    @FXML private CheckBox searchGroupRegex;\n+\n+    @FXML private RadioButton autoGroupKeywordsOption;\n+    @FXML private TextField autoGroupKeywordsField;\n+    @FXML private TextField autoGroupKeywordsDeliminator;\n+    @FXML private TextField autoGroupKeywordsHierarchicalDeliminator;\n+    @FXML private RadioButton autoGroupPersonsOption;\n+    @FXML private TextField autoGroupPersonsField;\n+\n+    @FXML private TextField texGroupFilePath;\n+\n+    private final ControlsFxVisualizer validationVisualizer = new ControlsFxVisualizer();\n+    private final GroupDialogViewModel viewModel;\n+\n+    public GroupDialogView(DialogService dialogService, BasePanel basePanel, JabRefPreferences prefs, AbstractGroup editedGroup) {\n+        viewModel = new GroupDialogViewModel(dialogService, basePanel, prefs, editedGroup);\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        if (editedGroup == null) {\n+            this.setTitle(Localization.lang(\"Add subgroup\"));\n+        } else {\n+            this.setTitle(Localization.lang(\"Edit group\") + \" \" + editedGroup.getName());\n+        }\n+\n+        setResultConverter(viewModel::resultConverter);\n+\n+        getDialogPane().getButtonTypes().setAll(ButtonType.OK, ButtonType.CANCEL);\n+\n+        getDialogPane().getScene().getWindow().sizeToScene();\n+    }\n+\n+    public GroupDialogView(DialogService dialogService, AbstractGroup editedGroup) {", "originalCommit": "64c3c6e9a91713fd7198a12376bc98bbafa080a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a7db26ee64b178e359d69be7bc676b709b0d46b8", "url": "https://github.com/JabRef/jabref/commit/a7db26ee64b178e359d69be7bc676b709b0d46b8", "message": "Refactored constructors, PreferencesService and some minor improvements.", "committedDate": "2020-01-25T20:40:37Z", "type": "commit"}, {"oid": "fd2f2ed6c98793ac8ce8d5eae0f044c9e1f19e2d", "url": "https://github.com/JabRef/jabref/commit/fd2f2ed6c98793ac8ce8d5eae0f044c9e1f19e2d", "message": "Merge remote-tracking branch 'upstream/master' into group_dialog_mvvm\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties", "committedDate": "2020-01-25T20:43:23Z", "type": "commit"}, {"oid": "584abaca4f72a11dd02f07cbdc3312b92e7dd661", "url": "https://github.com/JabRef/jabref/commit/584abaca4f72a11dd02f07cbdc3312b92e7dd661", "message": "Fixed Test", "committedDate": "2020-01-25T20:56:27Z", "type": "commit"}]}