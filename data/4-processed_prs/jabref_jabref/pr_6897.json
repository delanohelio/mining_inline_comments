{"pr_number": 6897, "pr_title": "DOI matching in duplicate check", "pr_createdAt": "2020-09-09T14:35:49Z", "pr_url": "https://github.com/JabRef/jabref/pull/6897", "timeline": [{"oid": "6c8b7d7c05483cef9ff73105930a82c03159b2c6", "url": "https://github.com/JabRef/jabref/commit/6c8b7d7c05483cef9ff73105930a82c03159b2c6", "message": "Add DOI matching with not full coincidence.", "committedDate": "2020-08-08T12:36:17Z", "type": "commit"}, {"oid": "25e34f085b8fa6f7ba97e92cf935e34116991648", "url": "https://github.com/JabRef/jabref/commit/25e34f085b8fa6f7ba97e92cf935e34116991648", "message": "issue 6707\nAdd zero weights for otes and comments.", "committedDate": "2020-08-11T15:57:56Z", "type": "commit"}, {"oid": "8e4714b8fe0c974a90e65e4806dd761547e5ea0f", "url": "https://github.com/JabRef/jabref/commit/8e4714b8fe0c974a90e65e4806dd761547e5ea0f", "message": "issue 6707\nsmall improvements", "committedDate": "2020-08-17T12:57:48Z", "type": "commit"}, {"oid": "b9f412cd09fe69f6aaf31840ad735fe97a192eed", "url": "https://github.com/JabRef/jabref/commit/b9f412cd09fe69f6aaf31840ad735fe97a192eed", "message": "issue 6707\nMoving cleanup's logic to DOI constructor.Add results of generate-authors.sh.", "committedDate": "2020-09-08T18:39:56Z", "type": "commit"}, {"oid": "8a024749c3030cdf22516e9e96f5ae2278d569ff", "url": "https://github.com/JabRef/jabref/commit/8a024749c3030cdf22516e9e96f5ae2278d569ff", "message": "issue 6707\nMoving cleanup's logic to DOI constructor.Add results of generate-authors.sh.\n(revert AUTHORS)", "committedDate": "2020-09-09T04:45:50Z", "type": "commit"}, {"oid": "304b99fb0a9e81021dd0dcfdab1536d0c3b6147a", "url": "https://github.com/JabRef/jabref/commit/304b99fb0a9e81021dd0dcfdab1536d0c3b6147a", "message": "Merge branch 'fix-for-issue-6707' of https://github.com/KunAndrew/jabref into KunAndrew-fix-for-issue-6707\n\n* 'fix-for-issue-6707' of https://github.com/KunAndrew/jabref:\n  issue 6707 Moving cleanup's logic to DOI constructor.Add results of generate-authors.sh. (revert AUTHORS)\n  issue 6707 Moving cleanup's logic to DOI constructor.Add results of generate-authors.sh.\n  issue 6707 small improvements\n  issue 6707 Add zero weights for otes and comments.\n  Add DOI matching with not full coincidence.", "committedDate": "2020-09-09T14:33:15Z", "type": "commit"}, {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a", "url": "https://github.com/JabRef/jabref/commit/3fc1ffa2516e9f417bc929d98df77273a257597a", "message": "remove unnecessary cast", "committedDate": "2020-09-09T14:45:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA4MDMyMw==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486080323", "bodyText": "@KunAndrew  I think you need to adjust the DOI regex pattern:\nOne CrossRef test fails, because of the missing underscore:\nThe DOI cannot be resolved wihtout underscore\norg.opentest4j.AssertionFailedError: expected: <10.1007/11538394_20> but was: <10.1007/1153839420>", "author": "Siedlerchr", "createdAt": "2020-09-10T05:48:50Z", "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "originalCommit": "3fc1ffa2516e9f417bc929d98df77273a257597a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NDYxNg==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486574616", "bodyText": "There should be a comment added which characters are removed and why. Without any comment, this is a \"magic number\" which should be extraced to a constant.", "author": "koppor", "createdAt": "2020-09-10T19:10:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA4MDMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NDExNA==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r495474114", "bodyText": "I removed this addtional regex because it was not really making sense. The DOI class already trims DOIs and also removes other encoding components.", "author": "Siedlerchr", "createdAt": "2020-09-26T16:44:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA4MDMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MzU4OQ==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486573589", "bodyText": "I think, using org.jabref.model.entry.identifier.DOI#equals makes more sense.\nFurthermore, Objects.equals should be used\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return oneDOI.get().getDOI().equalsIgnoreCase(twoDOI.get().getDOI());\n          \n          \n            \n                        return Objects.equals(oneDOI, twoDOI);", "author": "koppor", "createdAt": "2020-09-10T19:08:22Z", "path": "src/main/java/org/jabref/logic/database/DuplicateCheck.java", "diffHunk": "@@ -303,6 +308,19 @@ public boolean isDuplicate(final BibEntry one, final BibEntry two, final BibData\n             return true;\n         }\n \n+        // check DOI\n+        Optional<DOI> oneDOI = one.getDOI();\n+        Optional<DOI> twoDOI = two.getDOI();\n+        if (oneDOI.isPresent() && twoDOI.isPresent()) {\n+            return oneDOI.get().getDOI().equalsIgnoreCase(twoDOI.get().getDOI());", "originalCommit": "3fc1ffa2516e9f417bc929d98df77273a257597a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3Mzc4Ng==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486573786", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return oneISBN.get().equals(twoISBN.get());\n          \n          \n            \n                        return Objects.equals(oneISBN, twoISBN);", "author": "koppor", "createdAt": "2020-09-10T19:08:42Z", "path": "src/main/java/org/jabref/logic/database/DuplicateCheck.java", "diffHunk": "@@ -303,6 +308,19 @@ public boolean isDuplicate(final BibEntry one, final BibEntry two, final BibData\n             return true;\n         }\n \n+        // check DOI\n+        Optional<DOI> oneDOI = one.getDOI();\n+        Optional<DOI> twoDOI = two.getDOI();\n+        if (oneDOI.isPresent() && twoDOI.isPresent()) {\n+            return oneDOI.get().getDOI().equalsIgnoreCase(twoDOI.get().getDOI());\n+        }\n+        // check ISBN\n+        Optional<ISBN> oneISBN = one.getISBN();\n+        Optional<ISBN> twoISBN = two.getISBN();\n+        if (oneISBN.isPresent() && twoISBN.isPresent()) {\n+            return oneISBN.get().equals(twoISBN.get());", "originalCommit": "3fc1ffa2516e9f417bc929d98df77273a257597a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NDczMA==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486574730", "bodyText": "This is the same pattern than above --> please use a constant.", "author": "koppor", "createdAt": "2020-09-10T19:10:26Z", "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");\n         } else {\n             // Short DOI\n             Matcher shortDoiMatcher = EXACT_SHORT_DOI_PATT.matcher(trimmedDoi);\n             if (shortDoiMatcher.find()) {\n-                this.doi = shortDoiMatcher.group(1);\n+                this.doi = shortDoiMatcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "originalCommit": "3fc1ffa2516e9f417bc929d98df77273a257597a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxMzQ2OQ==", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r488413469", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");\n          \n          \n            \n                        this.doi = matcher.group(1).replaceAll(\"[^\\\\w/:-.-_]\", \"\");\n          \n      \n    \n    \n  \n\nVariable name: ILLEGAL_DOI_CHARACTERS --> Pattern.compile?\n(devcall)", "author": "koppor", "createdAt": "2020-09-15T06:20:40Z", "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "originalCommit": "3fc1ffa2516e9f417bc929d98df77273a257597a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d8c08a2af10e089c5c26bd21a2cb5488425e61fe", "url": "https://github.com/JabRef/jabref/commit/d8c08a2af10e089c5c26bd21a2cb5488425e61fe", "message": "Update src/main/java/org/jabref/logic/database/DuplicateCheck.java\n\nCo-authored-by: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-09-26T11:45:15Z", "type": "commit"}, {"oid": "0aee547752717e6a37fbbe23ab3ff9a515e54b14", "url": "https://github.com/JabRef/jabref/commit/0aee547752717e6a37fbbe23ab3ff9a515e54b14", "message": "Update src/main/java/org/jabref/logic/database/DuplicateCheck.java\n\nCo-authored-by: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-09-26T11:45:22Z", "type": "commit"}, {"oid": "074856d7e18d22142be4138b630c3615d7ac49db", "url": "https://github.com/JabRef/jabref/commit/074856d7e18d22142be4138b630c3615d7ac49db", "message": "Update src/main/java/org/jabref/model/entry/identifier/DOI.java\n\nCo-authored-by: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-09-26T11:45:30Z", "type": "commit"}, {"oid": "1102851c158a1fd07c8fa83b0b7e4b2e33aab20f", "url": "https://github.com/JabRef/jabref/commit/1102851c158a1fd07c8fa83b0b7e4b2e33aab20f", "message": "Merge remote-tracking branch 'upstream/master' into KunAndrew-fix-for-issue-6707\n\n* upstream/master: (35 commits)\n  Fix a fetcher test for the ShortDOIService (#6945)\n  Fixes Shared Database: Changes filtering in CoarseChangeFilter to attribute property (#6868)\n  Changed default value of \"search and store files relative to bibtex file\" to true (#6928)\n  Replace comment by just a failure (#6943)\n  Fix: in entry types editor selected field is not removed after first click  (#6941)\n  Fix remove actions for entry types in the editor (#6933)\n  Always use Java 15 (#6929)\n  Update DevDocs: workaround for issues with local openjfx maven libraries (#6931)\n  Fixes bugs in the `regex` cite key pattern modifier (#6893)\n  Add missing author\n  Readability for citation key patterns (#6706)\n  Add new author\n  Reset to master and add default case to switch (#6847)\n  Bump mockito-core from 3.5.10 to 3.5.11 (#6924)\n  Bump byte-buddy-parent from 1.10.14 to 1.10.15 (#6923)\n  Bump org.beryx.jlink from 2.21.4 to 2.22.0 (#6925)\n  Bump xmpbox from 2.0.20 to 2.0.21 (#6926)\n  Bump pascalgn/automerge-action from v0.9.0 to v0.10.0 (#6927)\n  Improve parsing of short DOIs (#6920)\n  Bump junit-vintage-engine from 5.6.2 to 5.7.0 (#6910)\n  ...", "committedDate": "2020-09-26T11:46:25Z", "type": "commit"}, {"oid": "0fa5691901d6f614a9454b662dec987354708670", "url": "https://github.com/JabRef/jabref/commit/0fa5691901d6f614a9454b662dec987354708670", "message": "simplify code\nremove additional regex we already are trimming and normalizing DOIs", "committedDate": "2020-09-26T12:25:31Z", "type": "commit"}, {"oid": "298ec852baa0288f18fef38b70ecc8bb506921c1", "url": "https://github.com/JabRef/jabref/commit/298ec852baa0288f18fef38b70ecc8bb506921c1", "message": "add changelog entry", "committedDate": "2020-09-26T12:39:28Z", "type": "commit"}, {"oid": "3920cd3f566b252eb2964e3d1b4826d3c8f7ef98", "url": "https://github.com/JabRef/jabref/commit/3920cd3f566b252eb2964e3d1b4826d3c8f7ef98", "message": "Merge branch 'master' into KunAndrew-fix-for-issue-6707", "committedDate": "2020-09-26T16:43:11Z", "type": "commit"}]}