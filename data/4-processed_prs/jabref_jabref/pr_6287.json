{"pr_number": 6287, "pr_title": "UI consistency - BibTexStringEditorDialog rework", "pr_createdAt": "2020-04-14T11:41:01Z", "pr_url": "https://github.com/JabRef/jabref/pull/6287", "timeline": [{"oid": "765d4488273f28e8421dc7e347f71a0db950fea7", "url": "https://github.com/JabRef/jabref/commit/765d4488273f28e8421dc7e347f71a0db950fea7", "message": "Fixed KeyPress event", "committedDate": "2019-12-23T11:42:40Z", "type": "commit"}, {"oid": "5973da2c91e51a409f99c0f3cb0e73f2f3cd75df", "url": "https://github.com/JabRef/jabref/commit/5973da2c91e51a409f99c0f3cb0e73f2f3cd75df", "message": "Refactored StringEditor ui for consistency", "committedDate": "2019-12-23T11:42:41Z", "type": "commit"}, {"oid": "6609f6d19e3f4136cdee79c10a1d8ec6b3e0cc20", "url": "https://github.com/JabRef/jabref/commit/6609f6d19e3f4136cdee79c10a1d8ec6b3e0cc20", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2019-12-27T18:24:29Z", "type": "commit"}, {"oid": "90801ed902af3432c2d6eb37068556e34e60d8e8", "url": "https://github.com/JabRef/jabref/commit/90801ed902af3432c2d6eb37068556e34e60d8e8", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-01-02T12:03:16Z", "type": "commit"}, {"oid": "ac89f0f9578af151b41a53ab4266de27cd99e8ab", "url": "https://github.com/JabRef/jabref/commit/ac89f0f9578af151b41a53ab4266de27cd99e8ab", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-01-17T19:22:28Z", "type": "commit"}, {"oid": "c7f74bb4fc6ce29ee7cd9124943e3893a60438e0", "url": "https://github.com/JabRef/jabref/commit/c7f74bb4fc6ce29ee7cd9124943e3893a60438e0", "message": "Prepared inline adding of new items", "committedDate": "2020-01-18T14:50:12Z", "type": "commit"}, {"oid": "61fc08a192a893ba7f814bf754733d975ae0908a", "url": "https://github.com/JabRef/jabref/commit/61fc08a192a893ba7f814bf754733d975ae0908a", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-02-16T14:02:34Z", "type": "commit"}, {"oid": "6307cc90ca5754ba0c683217bb0ac94065d48aa9", "url": "https://github.com/JabRef/jabref/commit/6307cc90ca5754ba0c683217bb0ac94065d48aa9", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-03-16T08:39:58Z", "type": "commit"}, {"oid": "402c8bfc83879be79c5e848a44fc43326b302cf7", "url": "https://github.com/JabRef/jabref/commit/402c8bfc83879be79c5e848a44fc43326b302cf7", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-04-13T17:31:10Z", "type": "commit"}, {"oid": "1a39e092b77f8bc37484185e07fee6161dc9c5d9", "url": "https://github.com/JabRef/jabref/commit/1a39e092b77f8bc37484185e07fee6161dc9c5d9", "message": "Fixed request focus and added commit on lost focus", "committedDate": "2020-04-14T11:22:55Z", "type": "commit"}, {"oid": "a029f5684c5477d42b6fcd55f8cc3566c6b42a93", "url": "https://github.com/JabRef/jabref/commit/a029f5684c5477d42b6fcd55f8cc3566c6b42a93", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-04-14T11:46:08Z", "type": "commit"}, {"oid": "0b37b87851497cbb3ff91b8f6954647e82868bf7", "url": "https://github.com/JabRef/jabref/commit/0b37b87851497cbb3ff91b8f6954647e82868bf7", "message": "Added restoration of deprecated variable names", "committedDate": "2020-04-18T22:40:36Z", "type": "commit"}, {"oid": "51bf06d8dafe151d79029e3c9e81fc67c57865de", "url": "https://github.com/JabRef/jabref/commit/51bf06d8dafe151d79029e3c9e81fc67c57865de", "message": "Removed space in default label name", "committedDate": "2020-04-18T23:10:50Z", "type": "commit"}, {"oid": "ac495f92e86f77e65176664b56b5962b7b4d8394", "url": "https://github.com/JabRef/jabref/commit/ac495f92e86f77e65176664b56b5962b7b4d8394", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-04-21T12:59:03Z", "type": "commit"}, {"oid": "d628826f3166de5139596599b7582bee28f8c9ce", "url": "https://github.com/JabRef/jabref/commit/d628826f3166de5139596599b7582bee28f8c9ce", "message": "Removed dysfunctional listener", "committedDate": "2020-04-21T16:58:32Z", "type": "commit"}, {"oid": "aeaaa50d94d304a4ecd0438a23bb0cd5e8393a61", "url": "https://github.com/JabRef/jabref/commit/aeaaa50d94d304a4ecd0438a23bb0cd5e8393a61", "message": "Changed validation indicator", "committedDate": "2020-04-22T07:38:33Z", "type": "commit"}, {"oid": "b7d93a57e6319d38ca70ee28d0f8301cae1726d8", "url": "https://github.com/JabRef/jabref/commit/b7d93a57e6319d38ca70ee28d0f8301cae1726d8", "message": "l10n", "committedDate": "2020-04-22T09:05:22Z", "type": "commit"}, {"oid": "b6ad4c41f0d091b526770abe2edef126e119e7ad", "url": "https://github.com/JabRef/jabref/commit/b6ad4c41f0d091b526770abe2edef126e119e7ad", "message": "l10n", "committedDate": "2020-04-22T09:36:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA0MzgzNg==", "url": "https://github.com/JabRef/jabref/pull/6287#discussion_r416043836", "bodyText": "This line should probably be outside of the isPresent block as you want to subscribe to the validProperty in either case.", "author": "tobiasdiez", "createdAt": "2020-04-27T18:19:29Z", "path": "src/main/java/org/jabref/gui/util/ViewModelTextFieldTableCellVisualizationFactory.java", "diffHunk": "@@ -30,25 +38,65 @@ public void install(TableColumn<S, T> column, StringConverter<T> stringConverter\n \n     @Override\n     public TextFieldTableCell<S, T> call(TableColumn<S, T> param) {\n-        return new TextFieldTableCell<S, T>(stringConverter) {\n+        return new TextFieldTableCell<>(stringConverter) {\n+\n+            List<Subscription> subscriptions = new ArrayList<>();\n+\n+            @Override\n+            public void startEdit() {\n+                super.startEdit();\n+\n+                // The textfield is lazily created and not already present when a TableCell is created.\n+                lookupTextField().ifPresent(textField -> Platform.runLater(() -> {\n+                    textField.requestFocus();\n+                    textField.selectAll();\n+                }));\n+            }\n+\n+            /**\n+             * As 'textfield' is a private member of TextFieldTableCell we need need to get to it through the backdoor.\n+             *\n+             * @return The TextField containing the editable content of the TableCell\n+             */\n+            private Optional<TextField> lookupTextField() {\n+                if (getGraphic() instanceof TextField) {\n+                    return Optional.of((TextField) getGraphic());\n+                } else {\n+                    // Could be an HBox with some graphic and a TextField if a graphic is specified for the TableCell\n+                    if (getGraphic() instanceof HBox) {\n+                        HBox hbox = (HBox) getGraphic();\n+                        if ((hbox.getChildren().size() > 1) && hbox.getChildren().get(1) instanceof TextField) {\n+                            return Optional.of((TextField) hbox.getChildren().get(1));\n+                        }\n+                    }\n+                    return Optional.empty();\n+                }\n+            }\n \n             @Override\n             public void updateItem(T item, boolean empty) {\n                 super.updateItem(item, empty);\n \n-                if (!empty && (getTableRow() != null)) {\n-                    Object rowItem = getTableRow().getItem();\n+                subscriptions.forEach(Subscription::unsubscribe);\n+                subscriptions.clear();\n \n-                    if (rowItem != null) {\n-                        S vm = (S) rowItem;\n-                        if ((visualizer != null) && (validationStatusProperty != null)) {\n-                            visualizer.initVisualization(validationStatusProperty.apply(vm), this);\n-                        }\n+                S viewModel = getTableRow().getItem();\n+                if (empty || (viewModel == null)) {\n+                    setText(null);\n+                    setGraphic(null);\n+                    setOnMouseClicked(null);\n+                    setTooltip(null);\n+                    setStyle(\"\");\n+                } else {\n+                    if (validationStatusProperty != null) {\n+                        validationStatusProperty.apply(viewModel).getHighestMessage().ifPresent(message -> {\n+                            setTooltip(new Tooltip(message.getMessage()));\n+                            subscriptions.add(BindingsHelper.includePseudoClassWhen(this, INVALID_PSEUDO_CLASS,", "originalCommit": "b6ad4c41f0d091b526770abe2edef126e119e7ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "117d1aec2d3a036378e5607980154d4a52d76c8b", "url": "https://github.com/JabRef/jabref/commit/117d1aec2d3a036378e5607980154d4a52d76c8b", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-04-30T11:11:42Z", "type": "commit"}, {"oid": "217a503b6898359055dc7066e4644de45377cf76", "url": "https://github.com/JabRef/jabref/commit/217a503b6898359055dc7066e4644de45377cf76", "message": "Fixed validation for empty rows", "committedDate": "2020-05-04T12:33:36Z", "type": "commit"}, {"oid": "911f7ab7e0f57415c3f7ce0ea32a2368c4428c7b", "url": "https://github.com/JabRef/jabref/commit/911f7ab7e0f57415c3f7ce0ea32a2368c4428c7b", "message": "Merge remote-tracking branch 'upstream/master' into ui_consistency", "committedDate": "2020-05-04T12:33:47Z", "type": "commit"}, {"oid": "aa2aa636c965da72f5935b11e6e45f347bd67487", "url": "https://github.com/JabRef/jabref/commit/aa2aa636c965da72f5935b11e6e45f347bd67487", "message": "Cleanups", "committedDate": "2020-05-04T12:53:57Z", "type": "commit"}, {"oid": "5790a918804e9385e20931fcc60a8605bf24a928", "url": "https://github.com/JabRef/jabref/commit/5790a918804e9385e20931fcc60a8605bf24a928", "message": "Fixed NPE", "committedDate": "2020-05-04T13:21:50Z", "type": "commit"}, {"oid": "f41e0c05c0d09be8fc0bce48eb479049df45be76", "url": "https://github.com/JabRef/jabref/commit/f41e0c05c0d09be8fc0bce48eb479049df45be76", "message": "Cleanups", "committedDate": "2020-05-04T13:42:41Z", "type": "commit"}]}