{"pr_number": 878, "pr_title": "clean up spring dependencies", "pr_createdAt": "2020-08-03T16:56:51Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU0Njc1MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464546751", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n              api deps.opentelemetrySdk\n          \n      \n    \n    \n  \n\n@trask Would it make sense to add this dependency or do we leave it up to users add the sdk dependency?", "author": "mabdinur", "createdAt": "2020-08-03T17:11:23Z", "path": "gradle/instrumentation-library.gradle", "diffHunk": "@@ -15,7 +15,9 @@ dependencies {\n   // TODO(anuraaga): We currently include common instrumentation logic like decorators in the\n   // bootstrap, but we need to move it out so manual instrumentation does not depend on code from\n   // the agent, like Agent.\n-  api project(':auto-bootstrap')\n+  api project(':auto-bootstrap'){\n+    exclude group: 'org.slf4j', module: 'slf4j-simple'\n+  }\n ", "originalCommit": "d2ea1c44d7c55e514b2b6defc428113b8b6bd7ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NDY4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464664681", "bodyText": "i think leave it to users, since they have to pull in sdk to configure exporters anyways", "author": "trask", "createdAt": "2020-08-03T21:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU0Njc1MQ=="}], "type": "inlineReview"}, {"oid": "521629ffa318a8846fe94e45d7cc9883fb8ce164", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/521629ffa318a8846fe94e45d7cc9883fb8ce164", "message": "clean up spring dependencies", "committedDate": "2020-08-03T19:39:32Z", "type": "commit"}, {"oid": "8d9c934e8c748d8afcd3a0629ef6d60a894b6e62", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8d9c934e8c748d8afcd3a0629ef6d60a894b6e62", "message": "remove duplicate plugins", "committedDate": "2020-08-03T19:57:47Z", "type": "commit"}, {"oid": "8d9c934e8c748d8afcd3a0629ef6d60a894b6e62", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8d9c934e8c748d8afcd3a0629ef6d60a894b6e62", "message": "remove duplicate plugins", "committedDate": "2020-08-03T19:57:47Z", "type": "forcePushed"}, {"oid": "e6a1f372acdc568924ee39e5ecc19070f46d158b", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e6a1f372acdc568924ee39e5ecc19070f46d158b", "message": "cleanup servlet gradle", "committedDate": "2020-08-03T20:06:00Z", "type": "commit"}, {"oid": "2ac2e79f62534e5f31e542653f8d770900c2d5bc", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2ac2e79f62534e5f31e542653f8d770900c2d5bc", "message": "fix exclude", "committedDate": "2020-08-03T20:12:37Z", "type": "commit"}, {"oid": "6421aaae9022f118a1dc12f9b8125073402d6a16", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6421aaae9022f118a1dc12f9b8125073402d6a16", "message": "add missing dependency", "committedDate": "2020-08-03T20:55:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3MTgwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464671805", "bodyText": "i think the shadow jar is only for use by the corresponding auto-instrumentation modules, so i think we don't want to publish the shadow jar for anything under :instrumentation-core\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              noShadowPublish = false", "author": "trask", "createdAt": "2020-08-03T21:28:17Z", "path": "instrumentation-core/servlet/servlet.gradle", "diffHunk": "@@ -1,14 +1,11 @@\n-group = 'io.opentelemetry.instrumentation'\n-\n-apply from: \"$rootDir/gradle/java.gradle\"\n-apply from: \"$rootDir/gradle/publish.gradle\"\n+ext {\n+  noShadowPublish = false", "originalCommit": "6421aaae9022f118a1dc12f9b8125073402d6a16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37796cc93b927bd360e1ac63a54f0907bcc00a49", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/37796cc93b927bd360e1ac63a54f0907bcc00a49", "message": "fix gradle publish", "committedDate": "2020-08-03T22:02:26Z", "type": "commit"}, {"oid": "37796cc93b927bd360e1ac63a54f0907bcc00a49", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/37796cc93b927bd360e1ac63a54f0907bcc00a49", "message": "fix gradle publish", "committedDate": "2020-08-03T22:02:26Z", "type": "forcePushed"}, {"oid": "7c44c408fc0066526d51e56bdcee7c7190c596f6", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/7c44c408fc0066526d51e56bdcee7c7190c596f6", "message": "Update spring-web-3.1.gradle", "committedDate": "2020-08-03T22:06:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY5OTY5NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464699695", "bodyText": "this is used by servlet auto-instrumentation. and i think you'll also need to update those auto-instrumentation to use configuration: 'shadow', and use shaded package name\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              javaSubPackage = ''\n          \n          \n            \n              javaSubPackage = 'servlet'", "author": "trask", "createdAt": "2020-08-03T22:42:47Z", "path": "instrumentation-core/servlet/servlet.gradle", "diffHunk": "@@ -1,14 +1,10 @@\n-group = 'io.opentelemetry.instrumentation'\n-\n-apply from: \"$rootDir/gradle/java.gradle\"\n-apply from: \"$rootDir/gradle/publish.gradle\"\n+ext {\n+  javaSubPackage = ''", "originalCommit": "7c44c408fc0066526d51e56bdcee7c7190c596f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMjc3MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464702771", "bodyText": "maybe something more explicit which disables the shadowJar task in instrumentation-library.gradle, e.g.\nwe could also have lack of javaSubPackage disable the shadowJar task, but don't want people to accidentally forget about shading these dependencies for auto-instrumentation, so think maybe this is safer\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ext {\n          \n          \n            \n              javaSubPackage = ''\n          \n          \n            \n            }\n          \n          \n            \n              noShadow = true", "author": "trask", "createdAt": "2020-08-03T22:52:24Z", "path": "instrumentation-core/spring/spring-web-3.1/spring-web-3.1.gradle", "diffHunk": "@@ -1,25 +1,9 @@\n-group = 'io.opentelemetry.instrumentation'\n+ext {\n+  javaSubPackage = ''\n+}", "originalCommit": "7c44c408fc0066526d51e56bdcee7c7190c596f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwNjcxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464706712", "bodyText": "oh sorry, i accidentally removed the surrounding ext { ... }", "author": "trask", "createdAt": "2020-08-03T23:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcyMTQyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464721429", "bodyText": "I run into this error when I don't define javaSubPackage:\nA problem occurred evaluating script.\n> Could not get unknown property 'javaSubPackage'\n\nIs there a way to disable the shadowJar configuration in instrumentation-library.gradle so that I don't run into this compile time error? A work around would be to just set javaSubPackage to an empty string but that doesn't seem ideal.", "author": "mabdinur", "createdAt": "2020-08-03T23:53:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcyMzc4NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464723785", "bodyText": "there may be a better way, but wrapping parts of instrumentation-library.gradle in conditionals seems to do the trick:\nif (!ext.properties.noShadow) {\n  apply plugin: 'com.github.johnrengelman.shadow'\n}\n\nif (!ext.properties.noShadow) {\n  shadowJar {\n    archiveClassifier = 'agent'\n\n    configurations = []\n\n    relocate \"io.opentelemetry.instrumentation.${javaSubPackage}\", \"io.opentelemetry.auto.instrumentation.${javaSubPackage}.shaded\"\n  }\n}", "author": "trask", "createdAt": "2020-08-04T00:02:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcyNTMxMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464725311", "bodyText": "Awesome thanks!", "author": "mabdinur", "createdAt": "2020-08-04T00:08:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMjc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMjg0NA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/878#discussion_r464702844", "bodyText": "same comment as above", "author": "trask", "createdAt": "2020-08-03T22:52:38Z", "path": "instrumentation-core/spring/spring-webmvc-3.1/spring-webmvc-3.1.gradle", "diffHunk": "@@ -1,24 +1,12 @@\n-group = 'io.opentelemetry.instrumentation'\n-\n-apply from: \"$rootDir/gradle/java.gradle\"\n-apply from: \"$rootDir/gradle/publish.gradle\"\n+ext {\n+  javaSubPackage = ''\n+}", "originalCommit": "7c44c408fc0066526d51e56bdcee7c7190c596f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cc73e9402a97f47b3be5fb9583633955b08cbe5f", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/cc73e9402a97f47b3be5fb9583633955b08cbe5f", "message": "Update instrumentation-core/servlet/servlet.gradle\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>", "committedDate": "2020-08-03T23:02:27Z", "type": "commit"}, {"oid": "9eaf2727b3b92e839c87c9904bec7f1fb693b0de", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9eaf2727b3b92e839c87c9904bec7f1fb693b0de", "message": "Update instrumentation-core/spring/spring-web-3.1/spring-web-3.1.gradle\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>", "committedDate": "2020-08-03T23:03:31Z", "type": "commit"}, {"oid": "6742f2fcfe8bdb7b11ffedc16c47aeb62e61aa19", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6742f2fcfe8bdb7b11ffedc16c47aeb62e61aa19", "message": "Update spring-webmvc-3.1.gradle", "committedDate": "2020-08-03T23:03:59Z", "type": "commit"}, {"oid": "84701e2f19c59f010b8739f14cc886f18920c880", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/84701e2f19c59f010b8739f14cc886f18920c880", "message": "update grpc dependency", "committedDate": "2020-08-03T23:08:03Z", "type": "commit"}, {"oid": "1b3c78cb962ad058c6e506493c88b97d63bcb937", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/1b3c78cb962ad058c6e506493c88b97d63bcb937", "message": "fix noshawdow", "committedDate": "2020-08-03T23:34:41Z", "type": "commit"}, {"oid": "adf33ad5e30c6b49c829afdac5ab05c81bbb19c5", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/adf33ad5e30c6b49c829afdac5ab05c81bbb19c5", "message": "noshawdow check", "committedDate": "2020-08-04T00:11:51Z", "type": "commit"}, {"oid": "241d7d1c8b4168f7b063b3fa715a35dbb9edc891", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/241d7d1c8b4168f7b063b3fa715a35dbb9edc891", "message": "Update spring-boot-autoconfigure.gradle", "committedDate": "2020-08-04T00:13:17Z", "type": "commit"}]}