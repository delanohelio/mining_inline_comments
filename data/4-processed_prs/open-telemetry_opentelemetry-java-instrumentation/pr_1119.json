{"pr_number": 1119, "pr_title": "Only include dependencies from exporters when there are dupes.", "pr_createdAt": "2020-08-28T05:49:13Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1119", "timeline": [{"oid": "a1faf452868a836abf74bb1f03384e137439c767", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a1faf452868a836abf74bb1f03384e137439c767", "message": "Only include dependencies from exporters when there are dupes.", "committedDate": "2020-08-28T05:44:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcxNzIzNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1119#discussion_r479717235", "bodyText": "better to prefer classes that we've used to build/test instrumentation?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              def projectsWithShadowJar = [project(':javaagent-exporters'), project(':instrumentation')]\n          \n          \n            \n              def projectsWithShadowJar = [project(':instrumentation'), project(':javaagent-exporters')]", "author": "trask", "createdAt": "2020-08-30T03:46:47Z", "path": "javaagent/javaagent.gradle", "diffHunk": "@@ -42,8 +42,14 @@ CopySpec isolateSpec(Collection<Project> projectsWithShadowJar) {\n shadowJar {\n   dependsOn ':instrumentation:shadowJar'\n   dependsOn ':javaagent-exporters:shadowJar'\n-  def projectsWithShadowJar = [project(':instrumentation'), project(':javaagent-exporters')]\n+  def projectsWithShadowJar = [project(':javaagent-exporters'), project(':instrumentation')]", "originalCommit": "a1faf452868a836abf74bb1f03384e137439c767", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg1MTM1Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1119#discussion_r479851356", "bodyText": "Yeah that's what I mentioned in the description about reversing order. This order doesn't work, no clue why :( I filed #1135 to follow up since there does seem to be something amiss but would be nice to unblock my aws distro \ud83d\ude05", "author": "anuraaga", "createdAt": "2020-08-31T01:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcxNzIzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcxNzUzOA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1119#discussion_r479717538", "bodyText": "the exporter classloader is only used for loading external exporter jar files\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              // Exclude dependencies pulled in from instrumentation that exist in javaagent-exporters.\n          \n          \n            \n              // Instrumentation is in the agent class loader, which is the parent for the exporter classloader\n          \n          \n            \n              // and will be used, removing duplicates can prevent issues when downstream projects repackage the\n          \n          \n            \n              // jar.\n          \n          \n            \n              // Exclude class files pulled in from the javaagent-exporters project that are also pulled in from the\n          \n          \n            \n              // instrumentation project.\n          \n          \n            \n              // Removing duplicates reduces jar size and can prevent issues when downstream projects repackage\n          \n          \n            \n              // the jar.", "author": "trask", "createdAt": "2020-08-30T03:50:58Z", "path": "javaagent/javaagent.gradle", "diffHunk": "@@ -42,8 +42,14 @@ CopySpec isolateSpec(Collection<Project> projectsWithShadowJar) {\n shadowJar {\n   dependsOn ':instrumentation:shadowJar'\n   dependsOn ':javaagent-exporters:shadowJar'\n-  def projectsWithShadowJar = [project(':instrumentation'), project(':javaagent-exporters')]\n+  def projectsWithShadowJar = [project(':javaagent-exporters'), project(':instrumentation')]\n   with isolateSpec(projectsWithShadowJar)\n+\n+  // Exclude dependencies pulled in from instrumentation that exist in javaagent-exporters.\n+  // Instrumentation is in the agent class loader, which is the parent for the exporter classloader\n+  // and will be used, removing duplicates can prevent issues when downstream projects repackage the\n+  // jar.", "originalCommit": "a1faf452868a836abf74bb1f03384e137439c767", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1ce91881fc2ab112372aa195b94793ddffee5a15", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/1ce91881fc2ab112372aa195b94793ddffee5a15", "message": "Update javaagent/javaagent.gradle\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>", "committedDate": "2020-08-31T01:58:02Z", "type": "commit"}, {"oid": "ed797c344751e70e4b5a11d69e02cf87d5370947", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ed797c344751e70e4b5a11d69e02cf87d5370947", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into only-include-exporter-dependencies-when-dupe", "committedDate": "2020-08-31T02:08:27Z", "type": "commit"}]}