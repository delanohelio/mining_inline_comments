{"pr_number": 1329, "pr_title": "Split out gRPC library instrumentation.", "pr_createdAt": "2020-10-06T06:22:55Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1329", "timeline": [{"oid": "29348d125853dd734d7e0894a5904b036d3c24d1", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/29348d125853dd734d7e0894a5904b036d3c24d1", "message": "Split out gRPC library instrumentation.", "committedDate": "2020-10-06T06:21:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAzMTgyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1329#discussion_r500031829", "bodyText": "This is a regression, but I want to fix forward. Previously auto instrumentation got the address from the channel builder, but it seems weird to force that into library instrumentation too. gRPC does have a remote transport address attribute with some behavior difference between versions. Want to dig into that more as a followup instead of having to add address as a parameter to the interceptor's factories. How does that sound?", "author": "anuraaga", "createdAt": "2020-10-06T06:25:15Z", "path": "instrumentation/grpc-1.5/testing/src/main/groovy/io/opentelemetry/instrumentation/grpc/v1_5/AbstractGrpcTest.groovy", "diffHunk": "@@ -77,8 +85,6 @@ class GrpcTest extends AgentTestRunner {\n             \"${SemanticAttributes.RPC_SYSTEM.key()}\" \"grpc\"\n             \"${SemanticAttributes.RPC_SERVICE.key()}\" \"example.Greeter\"\n             \"${SemanticAttributes.RPC_METHOD.key()}\" \"SayHello\"\n-            \"${SemanticAttributes.NET_PEER_NAME.key()}\" \"localhost\"", "originalCommit": "29348d125853dd734d7e0894a5904b036d3c24d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcxMjcwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1329#discussion_r500712700", "bodyText": "No objection from me, let's create a tracking issue for this if @iNikem does not object.", "author": "trask", "createdAt": "2020-10-07T03:11:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAzMTgyOQ=="}], "type": "inlineReview"}, {"oid": "10831c4902595b667d6e8262d99e381fe170bedb", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/10831c4902595b667d6e8262d99e381fe170bedb", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into separate-grpc-instrumentation", "committedDate": "2020-10-06T08:52:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcxMDYyNg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1329#discussion_r500710626", "bodyText": "are these dependencies needed?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              implementation group: 'javax.annotation', name: 'javax.annotation-api', version: '1.3.2'\n          \n          \n            \n            \n          \n          \n            \n              implementation deps.guava", "author": "trask", "createdAt": "2020-10-07T03:03:16Z", "path": "instrumentation/grpc-1.5/testing/grpc-1.5-testing.gradle", "diffHunk": "@@ -0,0 +1,39 @@\n+plugins {\n+  id \"java-library\"\n+  id \"com.google.protobuf\" version \"0.8.13\"\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+\n+def grpcVersion = '1.5.0'\n+\n+protobuf {\n+  protoc {\n+    // Download compiler rather than using locally installed version:\n+    artifact = 'com.google.protobuf:protoc:3.3.0'\n+  }\n+  plugins {\n+    grpc { artifact = \"io.grpc:protoc-gen-grpc-java:${grpcVersion}\" }\n+  }\n+  generateProtoTasks {\n+    all()*.plugins { grpc {} }\n+  }\n+}\n+\n+dependencies {\n+  compileOnly(project(':instrumentation:grpc-1.5:library'))\n+\n+  api project(':testing-common')\n+\n+  api group: 'io.grpc', name: 'grpc-core', version: grpcVersion\n+  api group: 'io.grpc', name: 'grpc-protobuf', version: grpcVersion\n+  api group: 'io.grpc', name: 'grpc-stub', version: grpcVersion\n+\n+  implementation group: 'javax.annotation', name: 'javax.annotation-api', version: '1.3.2'\n+\n+  implementation deps.guava\n+", "originalCommit": "10831c4902595b667d6e8262d99e381fe170bedb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcxMDgyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1329#discussion_r500710829", "bodyText": "it's amazing to me that this does not create a cyclic dependency\nthe test that uses GrpcHelper does look a bit suspicious (using the same method to verify the status as was used to map the status), maybe better to add an extra spock data column to those test for otelStatus?", "author": "trask", "createdAt": "2020-10-07T03:04:09Z", "path": "instrumentation/grpc-1.5/testing/grpc-1.5-testing.gradle", "diffHunk": "@@ -0,0 +1,39 @@\n+plugins {\n+  id \"java-library\"\n+  id \"com.google.protobuf\" version \"0.8.13\"\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+\n+def grpcVersion = '1.5.0'\n+\n+protobuf {\n+  protoc {\n+    // Download compiler rather than using locally installed version:\n+    artifact = 'com.google.protobuf:protoc:3.3.0'\n+  }\n+  plugins {\n+    grpc { artifact = \"io.grpc:protoc-gen-grpc-java:${grpcVersion}\" }\n+  }\n+  generateProtoTasks {\n+    all()*.plugins { grpc {} }\n+  }\n+}\n+\n+dependencies {\n+  compileOnly(project(':instrumentation:grpc-1.5:library'))", "originalCommit": "10831c4902595b667d6e8262d99e381fe170bedb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcyNTI0Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1329#discussion_r500725243", "bodyText": "Previously I was avoiding having to duplicate the statuscode mapping in the logic, its unit test, and here too. Now it's always one status though so no reason to use the helper :)", "author": "anuraaga", "createdAt": "2020-10-07T04:05:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcxMDgyOQ=="}], "type": "inlineReview"}, {"oid": "cb716777fd5e1a4437af967d2432147501096fa7", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/cb716777fd5e1a4437af967d2432147501096fa7", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into separate-grpc-instrumentation", "committedDate": "2020-10-07T04:02:32Z", "type": "commit"}, {"oid": "24549bf2a9371060b800def3de86f45c06dbc8a1", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/24549bf2a9371060b800def3de86f45c06dbc8a1", "message": "Simpler status", "committedDate": "2020-10-07T04:05:19Z", "type": "commit"}]}