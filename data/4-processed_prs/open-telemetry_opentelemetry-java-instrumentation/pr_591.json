{"pr_number": 591, "pr_title": "Fix khttp sporadic test failure", "pr_createdAt": "2020-06-28T02:05:47Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/591", "timeline": [{"oid": "94d91129b613473e96e7c9b9ce5b5b6947faa1d7", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/94d91129b613473e96e7c9b9ce5b5b6947faa1d7", "message": "Fix khttp sporadic test failure", "committedDate": "2020-06-28T02:04:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDcxNw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/591#discussion_r446590717", "bodyText": "If I'm not mistaken the timeout for khttp is seconds so now we're setting it to 2000s - yeah that'll keep the flakes out ;) But probably meant to convert to secs.\nAlso if the value isn't ever used in assertions, perhaps can only have one timeout in the base class since it's not such a big deal for us to distinguish them when executing requests in tests.", "author": "anuraaga", "createdAt": "2020-06-28T02:26:28Z", "path": "instrumentation/khttp-0.1/src/test/groovy/KHttpClientTest.groovy", "diffHunk": "@@ -21,7 +21,9 @@ class KHttpClientTest extends HttpClientTest {\n \n   @Override\n   int doRequest(String method, URI uri, Map<String, String> headers, Closure callback) {\n-    def response = KHttp.request(method, uri.toString(), headers, Collections.emptyMap(), null, null, null, null, 1)\n+    // khttp applies the same timeout for both connect and read\n+    def timeout = Math.max(CONNECT_TIMEOUT_MS, READ_TIMEOUT_MS)\n+    def response = KHttp.request(method, uri.toString(), headers, Collections.emptyMap(), null, null, null, null, timeout)", "originalCommit": "94d91129b613473e96e7c9b9ce5b5b6947faa1d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDc1Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/591#discussion_r446590756", "bodyText": "https://khttp.readthedocs.io/en/latest/user/quickstart.html#timeouts", "author": "anuraaga", "createdAt": "2020-06-28T02:27:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDcxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5NDE3Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/591#discussion_r446594172", "bodyText": "opened #593, it looks to me like we don't need the read timeout at all", "author": "trask", "createdAt": "2020-06-28T03:19:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDcxNw=="}], "type": "inlineReview"}, {"oid": "d49eb3a8e4e95436aa6bcecf61de5903801e11eb", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d49eb3a8e4e95436aa6bcecf61de5903801e11eb", "message": "Use correct time unit", "committedDate": "2020-06-28T03:01:58Z", "type": "commit"}, {"oid": "a7976128dd95d95e1b24b191b98135f28e3d33ca", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a7976128dd95d95e1b24b191b98135f28e3d33ca", "message": "Merge branch 'master' into fix-sporadic-test-failure", "committedDate": "2020-06-28T06:17:20Z", "type": "commit"}]}