{"pr_number": 563, "pr_title": "Working against otel-java 0.6.0-SNAPSHOT", "pr_createdAt": "2020-06-23T10:58:33Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/563", "timeline": [{"oid": "d7dd259c10789c6147bf5208067abc77a853f7cb", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d7dd259c10789c6147bf5208067abc77a853f7cb", "message": "Working against otel-java 0.6.0-SNAPSHOT", "committedDate": "2020-06-23T10:56:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU4OTQzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/563#discussion_r444589432", "bodyText": "\ud83d\ude04", "author": "trask", "createdAt": "2020-06-24T01:10:00Z", "path": "instrumentation/opentelemetry-api-beta/opentelemetry-api-beta.gradle", "diffHunk": "@@ -1,7 +1,7 @@\n apply from: \"$rootDir/gradle/instrumentation.gradle\"\n \n dependencies {\n-  // this instrumentation needs to be able to be able to reference both the OpenTelemetry API\n+  // this instrumentation needs to be able to reference both the OpenTelemetry API", "originalCommit": "d7dd259c10789c6147bf5208067abc77a853f7cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU5MDA5Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/563#discussion_r444590097", "bodyText": "(in the future) this probably is better in common package, like you did for LabelsShader", "author": "trask", "createdAt": "2020-06-24T01:12:40Z", "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/auto/instrumentation/opentelemetryapi/trace/Bridging.java", "diffHunk": "@@ -100,17 +101,20 @@ public static SpanContext toUnshaded(final io.opentelemetry.trace.SpanContext sh\n     }\n   }\n \n-  public static Map<String, io.opentelemetry.common.AttributeValue> toShaded(\n-      final Map<String, AttributeValue> unshadedAttributes) {\n-    final Map<String, io.opentelemetry.common.AttributeValue> shadedAttributes = new HashMap<>();\n-    for (final Map.Entry<String, AttributeValue> entry : unshadedAttributes.entrySet()) {\n-      final AttributeValue value = entry.getValue();\n-      final io.opentelemetry.common.AttributeValue shadedValue = toShadedOrNull(value);\n-      if (shadedValue != null) {\n-        shadedAttributes.put(entry.getKey(), shadedValue);\n-      }\n-    }\n-    return shadedAttributes;\n+  public static io.opentelemetry.common.Attributes toShaded(final Attributes unshadedAttributes) {", "originalCommit": "d7dd259c10789c6147bf5208067abc77a853f7cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU5MDY1Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/563#discussion_r444590657", "bodyText": "oh ya i never got around to renaming tags to attributes in tests", "author": "trask", "createdAt": "2020-06-24T01:15:06Z", "path": "testing/src/main/groovy/io/opentelemetry/auto/test/asserts/TagsAssert.groovy", "diffHunk": "@@ -18,18 +18,19 @@ package io.opentelemetry.auto.test.asserts\n import groovy.transform.stc.ClosureParams\n import groovy.transform.stc.SimpleType\n import io.opentelemetry.common.AttributeValue\n-\n+import io.opentelemetry.common.ReadableAttributes\n+import io.opentelemetry.common.ReadableKeyValuePairs\n import java.util.regex.Pattern\n \n class TagsAssert {\n-  private final Map<String, AttributeValue> tags\n+  private final ReadableAttributes tags", "originalCommit": "d7dd259c10789c6147bf5208067abc77a853f7cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU5NTQ5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/563#discussion_r444595492", "bodyText": "staring at this way too long... \ud83d\ude02\nhow about this comment instead:\n// the first and second condition in the assert are exactly the same\n// but both are included in order to provide better context in the error message", "author": "trask", "createdAt": "2020-06-24T01:34:41Z", "path": "testing/src/main/groovy/io/opentelemetry/auto/test/asserts/TagsAssert.groovy", "diffHunk": "@@ -82,12 +83,18 @@ class TagsAssert {\n   }\n \n   void assertTagsAllVerified() {\n-    def set = new TreeMap<>(tags).keySet()\n-    set.removeAll(assertedTags)\n-    // The primary goal is to ensure the set is empty.\n-    // tags and assertedTags are included via an \"always true\" comparison\n-    // so they provide better context in the error message.\n-    assert (tags.entrySet() != assertedTags || assertedTags.isEmpty()) && set.isEmpty()\n+    Set<String> allTags = new TreeSet<>()\n+    tags.forEach(new ReadableKeyValuePairs.KeyValueConsumer<AttributeValue>() {\n+      @Override\n+      void consume(String key, AttributeValue value) {\n+        allTags.add(key)\n+      }\n+    })\n+    Set<String> unverifiedTags = new TreeSet(allTags)\n+    unverifiedTags.removeAll(assertedTags)\n+    // tags and assertedTags are included to provide better context in the error message.\n+    //containsAll because we may assert more than span actually has\n+    assert unverifiedTags.isEmpty() && assertedTags.containsAll(allTags)", "originalCommit": "d7dd259c10789c6147bf5208067abc77a853f7cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}