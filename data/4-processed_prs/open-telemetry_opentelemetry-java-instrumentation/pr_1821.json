{"pr_number": 1821, "pr_title": "Introduce test matrix", "pr_createdAt": "2020-12-02T14:31:22Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821", "timeline": [{"oid": "7a03b255520d49f4677f2a45d2c28980ff80fee5", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/7a03b255520d49f4677f2a45d2c28980ff80fee5", "message": "Introduce test matrix and proper WildFly test", "committedDate": "2020-12-02T13:16:58Z", "type": "commit"}, {"oid": "0f890e6bdec0617c5081d570bd068d0ea9715881", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0f890e6bdec0617c5081d570bd068d0ea9715881", "message": "Restore test to old version until matrix is merged", "committedDate": "2020-12-02T13:26:28Z", "type": "commit"}, {"oid": "044bb92480b95bb7abefe8411fbe9bcc399510fe", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/044bb92480b95bb7abefe8411fbe9bcc399510fe", "message": "Add workflow to publish test matrix", "committedDate": "2020-12-02T14:30:57Z", "type": "commit"}, {"oid": "37c6211359a49296e37fcf0d3aba3828ae0db630", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/37c6211359a49296e37fcf0d3aba3828ae0db630", "message": "Satisfy checkstyle", "committedDate": "2020-12-02T15:04:44Z", "type": "commit"}, {"oid": "24da507b91ade2fb2da46f1d1dd7d290e4041020", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/24da507b91ade2fb2da46f1d1dd7d290e4041020", "message": "Polish", "committedDate": "2020-12-02T19:29:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534852920", "bodyText": "Can we use docker build-arg instead of custom templating?\nhttps://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg", "author": "anuraaga", "createdAt": "2020-12-03T07:56:03Z", "path": "smoke-tests/matrix/src/payara-dockerfile.template", "diffHunk": "@@ -0,0 +1,5 @@\n+FROM payara/server-full:@version@", "originalCommit": "24da507b91ade2fb2da46f1d1dd7d290e4041020", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg2MjUzMw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534862533", "bodyText": "Can you use them for FROM? I thought not", "author": "iNikem", "createdAt": "2020-12-03T08:01:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg2NTY2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534865665", "bodyText": "Think so, I've used it in Zipkin before https://github.com/openzipkin/zipkin/blob/master/docker/Dockerfile#L31", "author": "anuraaga", "createdAt": "2020-12-03T08:03:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg2ODAyMA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534868020", "bodyText": "https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact", "author": "vovencij", "createdAt": "2020-12-03T08:04:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk1NDk3Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534954977", "bodyText": "Still struggling to get it working... What's the big difference between gradle token expansion and docker build args?", "author": "iNikem", "createdAt": "2020-12-03T08:54:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk4NzYxNA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534987614", "bodyText": "Fixed", "author": "iNikem", "createdAt": "2020-12-03T09:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk4NzkxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534987912", "bodyText": "Just that it can be more convenient to run docker build locally sometimes. But no big deal.", "author": "anuraaga", "createdAt": "2020-12-03T09:18:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTYwNTIxOA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r535605218", "bodyText": "oh that's cool, hadn't seen that before", "author": "trask", "createdAt": "2020-12-03T20:57:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MjkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MzYwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534853605", "bodyText": "I think this is worth some comments on what it's preparing", "author": "anuraaga", "createdAt": "2020-12-03T07:56:27Z", "path": "smoke-tests/matrix/build.gradle", "diffHunk": "@@ -0,0 +1,100 @@\n+import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage\n+import com.bmuschko.gradle.docker.tasks.image.DockerPushImage\n+import org.apache.tools.ant.filters.ReplaceTokens\n+\n+plugins {\n+  id \"war\"\n+  id \"com.bmuschko.docker-remote-api\" version \"6.6.1\"\n+}\n+\n+compileJava {\n+  options.release.set(8)\n+}\n+\n+repositories {\n+  jcenter()\n+}\n+dependencies {\n+  implementation(\"javax.servlet:javax.servlet-api:3.0.1\")\n+}\n+\n+static def dockerFileName(String template) {\n+  template.replace(\"-dockerfile.template\", \".dockerfile\")\n+}\n+\n+def dockerWorkingDir = new File(project.buildDir, \"docker\")\n+\n+def buildMatrixTask = tasks.create(\"buildMatrix\") {\n+  group = \"build\"\n+  description = \"Builds all Docker images for the test matrix\"\n+}\n+\n+Set<String> matrix = []\n+def pushMatrixTask = tasks.create(\"pushMatrix\", DockerPushImage) {\n+  group = \"publishing\"\n+  description = \"Push all Docker images for the test matrix\"\n+  dependsOn(buildMatrixTask)\n+  images.set(matrix)\n+}\n+\n+def targets = [\n+  \"jetty\"  : [\n+    \"9.4.35\"      : [\"8\", \"11\", \"15\"],\n+    \"10.0.0.beta3\": [\"11\", \"15\"],\n+  ],\n+  \"tomcat\" : [\n+    \"7.0.107\"   : [\"8\"],\n+    \"8.5.60\"    : [\"8\", \"11\"],\n+    \"9.0.40\"    : [\"8\", \"11\"],\n+    \"10.0.0-M10\": [\"8\", \"11\"]\n+  ],\n+  \"payara\" : [\n+    \"5.2020.6\"      : [\"8\"],\n+    \"5.2020.6-jdk11\": [\"11\"]\n+  ],\n+  \"wildfly\": [\n+    \"13.0.0.Final\": [\"8\", \"11\", \"15\"],\n+    \"17.0.1.Final\": [\"8\", \"11\", \"15\"],\n+    \"21.0.0.Final\": [\"8\", \"11\", \"15\"]\n+  ],\n+  \"liberty\": [\n+    \"20.0.0.12\": [\"8\", \"11\", \"15\", \"8-jdk-openj9\", \"11-jdk-openj9\", \"15-jdk-openj9\"]\n+  ]\n+]\n+\n+targets.each { server, data ->", "originalCommit": "24da507b91ade2fb2da46f1d1dd7d290e4041020", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1NTc4Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r534855783", "bodyText": "Nevermind I guess README is enough too", "author": "anuraaga", "createdAt": "2020-12-03T07:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg1MzYwNQ=="}], "type": "inlineReview"}, {"oid": "3b28774dd4dfdd139d40cc7144c909ddce25e4a4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3b28774dd4dfdd139d40cc7144c909ddce25e4a4", "message": "Use docker build args instead of replacing tokens", "committedDate": "2020-12-03T09:17:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTYxOTMwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1821#discussion_r535619308", "bodyText": "this is some really great test coverage that we were missing!!!", "author": "trask", "createdAt": "2020-12-03T21:06:53Z", "path": "smoke-tests/matrix/build.gradle", "diffHunk": "@@ -0,0 +1,93 @@\n+import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage\n+import com.bmuschko.gradle.docker.tasks.image.DockerPushImage\n+\n+plugins {\n+  id \"war\"\n+  id \"com.bmuschko.docker-remote-api\" version \"6.6.1\"\n+}\n+\n+compileJava {\n+  options.release.set(8)\n+}\n+\n+repositories {\n+  jcenter()\n+}\n+dependencies {\n+  implementation(\"javax.servlet:javax.servlet-api:3.0.1\")\n+}\n+\n+def buildMatrixTask = tasks.create(\"buildMatrix\") {\n+  group = \"build\"\n+  description = \"Builds all Docker images for the test matrix\"\n+}\n+\n+Set<String> matrix = []\n+tasks.create(\"pushMatrix\", DockerPushImage) {\n+  group = \"publishing\"\n+  description = \"Push all Docker images for the test matrix\"\n+  dependsOn(buildMatrixTask)\n+  images.set(matrix)\n+}\n+\n+def targets = [\n+  \"jetty\"  : [\n+    \"9.4.35\"      : [\"8\", \"11\", \"15\"],\n+    \"10.0.0.beta3\": [\"11\", \"15\"],\n+  ],\n+  \"tomcat\" : [\n+    \"7.0.107\"   : [\"8\"],\n+    \"8.5.60\"    : [\"8\", \"11\"],\n+    \"9.0.40\"    : [\"8\", \"11\"],\n+    \"10.0.0-M10\": [\"8\", \"11\"]\n+  ],\n+  \"payara\" : [\n+    \"5.2020.6\"      : [\"8\"],\n+    \"5.2020.6-jdk11\": [\"11\"]\n+  ],\n+  \"wildfly\": [\n+    \"13.0.0.Final\": [\"8\", \"11\", \"15\"],\n+    \"17.0.1.Final\": [\"8\", \"11\", \"15\"],\n+    \"21.0.0.Final\": [\"8\", \"11\", \"15\"]\n+  ],\n+  \"liberty\": [\n+    \"20.0.0.12\": [\"8\", \"11\", \"15\", \"8-jdk-openj9\", \"11-jdk-openj9\", \"15-jdk-openj9\"]\n+  ]", "originalCommit": "3b28774dd4dfdd139d40cc7144c909ddce25e4a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}