{"pr_number": 1150, "pr_title": "Fix redisson Nightly build", "pr_createdAt": "2020-09-01T13:55:06Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150", "timeline": [{"oid": "0de38835d9d29eb1852c7ee4e62fd81b82ce3029", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0de38835d9d29eb1852c7ee4e62fd81b82ce3029", "message": "Fix redisson Nightly build", "committedDate": "2020-09-01T13:49:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE2NjkzOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481166939", "bodyText": "We intentionally use latest dep test to check both old versions and new version. I don't think we need to change the test dependency version for standard build.", "author": "anuraaga", "createdAt": "2020-09-01T14:10:52Z", "path": "instrumentation/redisson-3.0/redisson-3.0.gradle", "diffHunk": "@@ -15,5 +15,6 @@ muzzle {\n \n dependencies {\n   library group: 'org.redisson', name: 'redisson', version: '3.0.0'\n+  testImplementation group: 'org.redisson', name: 'redisson', version: '3.4.3'", "originalCommit": "0de38835d9d29eb1852c7ee4e62fd81b82ce3029", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE4ODY5Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481188697", "bodyText": "Yeah, we certainly want to test with the same version that we claim we support :) Meaning 3.0.0 in this case", "author": "iNikem", "createdAt": "2020-09-01T14:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE2NjkzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIwOTIzNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481209235", "bodyText": "What about config the latestDepTestLibrary like  latestDepTestLibrary group: 'org.redisson', name: 'redisson', version: '(,3.4.3)'\nbecause redis://  is a break change. any suggestion? @anuraaga @iNikem", "author": "dengliming", "createdAt": "2020-09-01T15:03:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE2NjkzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyMDMzOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481220339", "bodyText": "Oh shoot - so does that mean that redis:// doesn't work at all on the older versions? That's pretty unfortunate. I can't think of a simpler solution but the brute force is tweaking the Gradle build to set a property affecting the URL when testing latest deps. If this sounds too tricky, let's address it as a follow-up.", "author": "anuraaga", "createdAt": "2020-09-01T15:13:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE2NjkzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI2NTAzNA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481265034", "bodyText": "so does that mean that redis:// doesn't work at all on the older versions?\n\nyes. :( and seems we can set the properties like this.\ntest {\n  systemProperty \"testLatestDeps\", testLatestDeps\n}", "author": "dengliming", "createdAt": "2020-09-01T16:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE2NjkzOQ=="}], "type": "inlineReview"}, {"oid": "40c8415f997cfa14eae9b755d4798c1e906adcd2", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/40c8415f997cfa14eae9b755d4798c1e906adcd2", "message": "Set a property affecting the URL when testing latest deps", "committedDate": "2020-09-01T16:56:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTUxMjE3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481512176", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  address = \"redis://\" + address\n          \n          \n            \n                  // Newer versions of redisson require scheme, older versions forbid it\n          \n          \n            \n                  address = \"redis://\" + address", "author": "anuraaga", "createdAt": "2020-09-02T00:49:54Z", "path": "instrumentation/redisson-3.0/src/test/groovy/RedissonAsyncClientTest.groovy", "diffHunk": "@@ -42,8 +42,13 @@ class RedissonAsyncClientTest extends AgentTestRunner {\n     .port(port).build()\n   @Shared\n   RedissonClient redisson\n+  @Shared\n+  String address = \"localhost:\" + port\n \n   def setupSpec() {\n+    if (\"true\".equals(System.properties.getProperty(\"testLatestDeps\"))) {\n+      address = \"redis://\" + address", "originalCommit": "40c8415f997cfa14eae9b755d4798c1e906adcd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTUxMjI3Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481512277", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  address = \"redis://\" + address\n          \n          \n            \n                  // Newer versions of redisson require scheme, older versions forbid it\n          \n          \n            \n                  address = \"redis://\" + address", "author": "anuraaga", "createdAt": "2020-09-02T00:50:13Z", "path": "instrumentation/redisson-3.0/src/test/groovy/RedissonClientTest.groovy", "diffHunk": "@@ -47,8 +47,13 @@ class RedissonClientTest extends AgentTestRunner {\n     .port(port).build()\n   @Shared\n   RedissonClient redisson\n+  @Shared\n+  String address = \"localhost:\" + port\n \n   def setupSpec() {\n+    if (\"true\".equals(System.properties.getProperty(\"testLatestDeps\"))) {\n+      address = \"redis://\" + address", "originalCommit": "40c8415f997cfa14eae9b755d4798c1e906adcd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "997edfcafb9aaf7a2979855e3ac6b5b3acd11650", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/997edfcafb9aaf7a2979855e3ac6b5b3acd11650", "message": "Add comments", "committedDate": "2020-09-02T02:52:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcyNTU5OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481725599", "bodyText": "You can use java.lang.Boolean#getBoolean", "author": "iNikem", "createdAt": "2020-09-02T05:31:35Z", "path": "instrumentation/redisson-3.0/src/test/groovy/RedissonClientTest.groovy", "diffHunk": "@@ -47,8 +47,14 @@ class RedissonClientTest extends AgentTestRunner {\n     .port(port).build()\n   @Shared\n   RedissonClient redisson\n+  @Shared\n+  String address = \"localhost:\" + port\n \n   def setupSpec() {\n+    if (\"true\".equals(System.properties.getProperty(\"testLatestDeps\"))) {", "originalCommit": "997edfcafb9aaf7a2979855e3ac6b5b3acd11650", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkyMzk0MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1150#discussion_r481923941", "bodyText": "\ud83d\udc4d thanks.", "author": "dengliming", "createdAt": "2020-09-02T09:14:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcyNTU5OQ=="}], "type": "inlineReview"}, {"oid": "28d7bfa1893a5b84294219d380b0020e0a529929", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/28d7bfa1893a5b84294219d380b0020e0a529929", "message": "Fix review", "committedDate": "2020-09-02T09:10:59Z", "type": "commit"}]}