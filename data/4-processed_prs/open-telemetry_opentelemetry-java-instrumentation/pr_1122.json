{"pr_number": 1122, "pr_title": "spring mvc3 - proper span name in case of sec fail (#718)", "pr_createdAt": "2020-08-28T13:25:01Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122", "timeline": [{"oid": "79ded368bda5c63910ff8aea30f0f604b2433307", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/79ded368bda5c63910ff8aea30f0f604b2433307", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-28T13:37:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI5NTQ5Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r479295496", "bodyText": "Make sure to disable wildcard import in IntelliJ both for Java and Groovy", "author": "mateuszrzeszutek", "createdAt": "2020-08-28T13:35:11Z", "path": "instrumentation/spring/spring-webmvc-3.1/spring-webmvc-3.1-auto/src/main/java/io/opentelemetry/instrumentation/auto/springwebmvc/WebApplicationContextInstrumentation.java", "diffHunk": "@@ -17,8 +17,7 @@\n package io.opentelemetry.instrumentation.auto.springwebmvc;\n \n import static io.opentelemetry.javaagent.tooling.ClassLoaderMatcher.hasClassesNamed;\n-import static io.opentelemetry.javaagent.tooling.bytebuddy.matcher.AgentElementMatchers.extendsClass;\n-import static io.opentelemetry.javaagent.tooling.bytebuddy.matcher.AgentElementMatchers.implementsInterface;\n+import static io.opentelemetry.javaagent.tooling.bytebuddy.matcher.AgentElementMatchers.*;", "originalCommit": "b3140c5f1c3674fd8ae4180d3c56e2f7e4ff5a79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxNzY4Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480017683", "bodyText": "Corrected.", "author": "kubawach", "createdAt": "2020-08-31T09:48:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI5NTQ5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwNDMxNw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r479304317", "bodyText": "You can use expect: instead\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                when:\n          \n          \n            \n                def matches = underTest.matches(type)\n          \n          \n            \n            \n          \n          \n            \n                then:\n          \n          \n            \n                matches == true\n          \n          \n            \n                expect:\n          \n          \n            \n                underTest.matches(type)", "author": "mateuszrzeszutek", "createdAt": "2020-08-28T13:44:33Z", "path": "javaagent-tooling/src/test/groovy/io/opentelemetry/javaagent/tooling/matcher/AdditionalLibraryIgnoresMatcherTest.groovy", "diffHunk": "@@ -0,0 +1,60 @@\n+package io.opentelemetry.javaagent.tooling.matcher\n+\n+import net.bytebuddy.description.type.TypeDescription\n+import spock.lang.Specification\n+\n+class AdditionalLibraryIgnoresMatcherTest extends Specification {\n+\n+  def underTest = new AdditionalLibraryIgnoresMatcher();\n+\n+  def \"spring boot - match not instrumented class\"() {\n+\n+    setup:\n+    def type = Mock(TypeDescription)\n+    type.getActualName() >> typeName\n+\n+    when:\n+    def matches = underTest.matches(type)\n+\n+    then:\n+    matches == true", "originalCommit": "79ded368bda5c63910ff8aea30f0f604b2433307", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxNzk5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480017991", "bodyText": "I like to stick to GWT BDD test convention.", "author": "kubawach", "createdAt": "2020-08-31T09:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwNDMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwOTk1Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r479309952", "bodyText": "Typo: INSTRUMNETATION_NAME -> INSTRUMENTATION_NAME\nAlso you have one > too many", "author": "mateuszrzeszutek", "createdAt": "2020-08-28T13:50:31Z", "path": "docs/contributing/running-tests.md", "diffHunk": "@@ -41,3 +41,7 @@ rule will kick in and do the following:\n This works both for tasks named `test` and `latestDepTest`. But currently\n does not work for other custom test tasks, such as those created by test sets\n plugin.\n+\n+#### Executing single test\n+\n+Executing `./gradlew :instrumentation:<INSTRUMNETATION_NAME>>:test --tests <GROOVY TEST FILE NAME>` will run only the selected test.", "originalCommit": "79ded368bda5c63910ff8aea30f0f604b2433307", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxODIwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480018200", "bodyText": "Good catch!", "author": "kubawach", "createdAt": "2020-08-31T09:49:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwOTk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMxMzA3MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r479313071", "bodyText": "Is this change needed?", "author": "mateuszrzeszutek", "createdAt": "2020-08-28T13:53:50Z", "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/AgentInstaller.java", "diffHunk": "@@ -254,13 +254,13 @@ public void onIgnored(\n     @Override\n     public void onComplete(\n         String typeName, ClassLoader classLoader, JavaModule module, boolean loaded) {\n-      //      log.debug(\"onComplete {}\", typeName);\n+        // log.debug(\"onComplete {}\", typeName);", "originalCommit": "79ded368bda5c63910ff8aea30f0f604b2433307", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMxNDQ4NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r479314485", "bodyText": "Make sure that you have correct import settings", "author": "mateuszrzeszutek", "createdAt": "2020-08-28T13:55:20Z", "path": "instrumentation/spring/spring-webmvc-3.1/spring-webmvc-3.1-auto/src/test/groovy/test/filter/FilteredAppConfig.groovy", "diffHunk": "@@ -16,6 +16,8 @@\n \n package test.filter\n \n+import org.springframework.boot.web.embedded.tomcat.TomcatConnectorCustomizer", "originalCommit": "79ded368bda5c63910ff8aea30f0f604b2433307", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxODI4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480018281", "bodyText": "Yep, done.", "author": "kubawach", "createdAt": "2020-08-31T09:49:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMxNDQ4NQ=="}], "type": "inlineReview"}, {"oid": "504c3a8843e82f353ae165d80ac4156becbd6e85", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/504c3a8843e82f353ae165d80ac4156becbd6e85", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-28T13:59:38Z", "type": "forcePushed"}, {"oid": "4951d5c2815ab38e182cd4cc8f8327a4798e79b4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/4951d5c2815ab38e182cd4cc8f8327a4798e79b4", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-28T14:01:50Z", "type": "forcePushed"}, {"oid": "0d65110eedda8a2f99a4fa1a25b44e652c489be4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0d65110eedda8a2f99a4fa1a25b44e652c489be4", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-28T14:10:27Z", "type": "forcePushed"}, {"oid": "da5d155207dc458af46ec68a7f706e483244a75b", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/da5d155207dc458af46ec68a7f706e483244a75b", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-28T20:02:00Z", "type": "forcePushed"}, {"oid": "0ac77c2815011d9dc037a9bbda51eb14a2d2b292", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0ac77c2815011d9dc037a9bbda51eb14a2d2b292", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-28T20:29:19Z", "type": "forcePushed"}, {"oid": "7c7abbadf096e02dc6aa4f1d47b3b5f9b5bc6cc8", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/7c7abbadf096e02dc6aa4f1d47b3b5f9b5bc6cc8", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-31T09:47:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4OTg3MA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480189870", "bodyText": "Any reason for this change?", "author": "iNikem", "createdAt": "2020-08-31T15:01:06Z", "path": "instrumentation/spring/spring-webmvc-3.1/spring-webmvc-3.1-auto/src/main/java/io/opentelemetry/instrumentation/auto/springwebmvc/WebApplicationContextInstrumentation.java", "diffHunk": "@@ -17,15 +17,14 @@\n package io.opentelemetry.instrumentation.auto.springwebmvc;\n \n import static io.opentelemetry.javaagent.tooling.ClassLoaderMatcher.hasClassesNamed;\n-import static io.opentelemetry.javaagent.tooling.bytebuddy.matcher.AgentElementMatchers.extendsClass;", "originalCommit": "7c7abbadf096e02dc6aa4f1d47b3b5f9b5bc6cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMDU2Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480200566", "bodyText": "I blame intelliJ. Will revert.", "author": "kubawach", "createdAt": "2020-08-31T15:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4OTg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MDcyMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480190721", "bodyText": "I am not sure about this change. We usually test the oldest supported version by default and let latestDepTests verify the latest supported version.", "author": "iNikem", "createdAt": "2020-08-31T15:02:36Z", "path": "instrumentation/spring/spring-webmvc-3.1/spring-webmvc-3.1-auto/spring-webmvc-3.1-auto.gradle", "diffHunk": "@@ -39,9 +39,9 @@ dependencies {\n \n   testImplementation group: 'org.spockframework', name: 'spock-spring', version: \"$versions.spock\"\n \n-  testImplementation group: 'org.springframework.boot', name: 'spring-boot-starter-test', version: '1.5.17.RELEASE'\n-  testImplementation group: 'org.springframework.boot', name: 'spring-boot-starter-web', version: '1.5.17.RELEASE'\n-  testImplementation group: 'org.springframework.boot', name: 'spring-boot-starter-security', version: '1.5.17.RELEASE'\n+  testImplementation group: 'org.springframework.boot', name: 'spring-boot-starter-test', version: '2.3.1.RELEASE'", "originalCommit": "7c7abbadf096e02dc6aa4f1d47b3b5f9b5bc6cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwNTIyOA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480205228", "bodyText": "Is it changed to 2.x stream by latestDep? I had to make a few changes around test code (AppConfig, ServletFIlteTest) to make it work (spring boot 2 is in some aspects not compatible with 1.x stream). I assumed it's worth upgrading (in baseline) as boot 2 has been around for more than 2 years now. Let me know what you think about that.", "author": "kubawach", "createdAt": "2020-08-31T15:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MDcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI0Nzc3OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480247779", "bodyText": "I just realised that SB 2.3.1 most certainly does not use Spring MVC 3.1. So after these changes we don't test if we actually support 3.1. And as there are API changes affecting tests, it means we should test them separately but certainly should test them both. So I propose to leave this with old version as it was. And we should add a separate test with more recent versions of Spring MVC. You don't have to add that new test right away, you can add a follow up issue.", "author": "iNikem", "createdAt": "2020-08-31T16:33:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MDcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMDQ5OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r481330499", "bodyText": "Per slack conversation - made slight adjustments for the code to get both boot 1.x and 2.x compatibility.", "author": "kubawach", "createdAt": "2020-09-01T17:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MDcyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MjIyMg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480192222", "bodyText": "Remove that line above. I believe it is obsolete", "author": "iNikem", "createdAt": "2020-08-31T15:05:00Z", "path": "instrumentation/spring/spring-webmvc-3.1/spring-webmvc-3.1-auto/src/test/resources/logback.xml", "diffHunk": "@@ -14,5 +14,6 @@\n   </root>\n \n   <logger name=\"io.opentelemetry.auto\" level=\"debug\"/>\n+  <logger name=\"io.opentelemetry.javaagent\" level=\"debug\"/>", "originalCommit": "7c7abbadf096e02dc6aa4f1d47b3b5f9b5bc6cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMTI1OA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r480201258", "bodyText": "Done.", "author": "kubawach", "createdAt": "2020-08-31T15:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MjIyMg=="}], "type": "inlineReview"}, {"oid": "c1b9606247b4f919b9a0386bda681c4d41ea0684", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c1b9606247b4f919b9a0386bda681c4d41ea0684", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-31T15:22:11Z", "type": "forcePushed"}, {"oid": "9c180767795a724542cbcaad30a7ef671c5b5f8a", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9c180767795a724542cbcaad30a7ef671c5b5f8a", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-31T15:25:52Z", "type": "forcePushed"}, {"oid": "655fbc8970f2c5669023879a5e57ea8fe14b81da", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/655fbc8970f2c5669023879a5e57ea8fe14b81da", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-08-31T15:29:00Z", "type": "forcePushed"}, {"oid": "a9e42e11ca4506fd6cd340375ca7d344bfdc56c7", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a9e42e11ca4506fd6cd340375ca7d344bfdc56c7", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-09-01T17:56:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgxNzUyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r481817523", "bodyText": "Please run ./gradlew spotlessApply and configure your IDE as described here", "author": "iNikem", "createdAt": "2020-09-02T07:12:54Z", "path": "instrumentation/spring/spring-webmvc-3.1/spring-webmvc-3.1-auto/src/test/groovy/test/filter/FilteredAppConfig.groovy", "diffHunk": "@@ -53,6 +41,15 @@ import org.springframework.web.context.request.NativeWebRequest\n import org.springframework.web.servlet.config.annotation.ContentNegotiationConfigurer\n import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter\n \n+import javax.servlet.Filter", "originalCommit": "a9e42e11ca4506fd6cd340375ca7d344bfdc56c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg5MTAyMg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1122#discussion_r481891022", "bodyText": "done!", "author": "kubawach", "createdAt": "2020-09-02T08:37:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgxNzUyMw=="}], "type": "inlineReview"}, {"oid": "2a45da45691e6937d906e17a00a32ecd353a7364", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2a45da45691e6937d906e17a00a32ecd353a7364", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-09-02T08:23:46Z", "type": "forcePushed"}, {"oid": "634c1bb70ab4edc967860730c864f3cfd13037ef", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/634c1bb70ab4edc967860730c864f3cfd13037ef", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-09-02T08:39:28Z", "type": "commit"}, {"oid": "634c1bb70ab4edc967860730c864f3cfd13037ef", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/634c1bb70ab4edc967860730c864f3cfd13037ef", "message": "spring mvc3 - proper span name in case of sec fail (#718)", "committedDate": "2020-09-02T08:39:28Z", "type": "forcePushed"}]}