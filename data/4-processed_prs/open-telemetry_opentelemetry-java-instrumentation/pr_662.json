{"pr_number": 662, "pr_title": "Update to otel-java 0.6.0", "pr_createdAt": "2020-07-10T18:45:17Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662", "timeline": [{"oid": "d7dd259c10789c6147bf5208067abc77a853f7cb", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d7dd259c10789c6147bf5208067abc77a853f7cb", "message": "Working against otel-java 0.6.0-SNAPSHOT", "committedDate": "2020-06-23T10:56:07Z", "type": "commit"}, {"oid": "f50dce4deb8c9af11938e81ad4c2e1e1f12f44fd", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f50dce4deb8c9af11938e81ad4c2e1e1f12f44fd", "message": "Muzzle fix", "committedDate": "2020-06-23T11:39:24Z", "type": "commit"}, {"oid": "2ad48e5e79dbcddd363c8f5462ba8b083152f9a9", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2ad48e5e79dbcddd363c8f5462ba8b083152f9a9", "message": "Better comment", "committedDate": "2020-06-24T13:45:03Z", "type": "commit"}, {"oid": "05f248bf0f6ae87b51bd4cdab2181e1b1ee60801", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/05f248bf0f6ae87b51bd4cdab2181e1b1ee60801", "message": "Merge remote-tracking branch 'upstream/master' into depends-on-otel-java-snapshot", "committedDate": "2020-07-06T12:23:45Z", "type": "commit"}, {"oid": "70b71c10a950da9fd3dea4317143b05ee66f5444", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/70b71c10a950da9fd3dea4317143b05ee66f5444", "message": "Merge remote-tracking branch 'upstream/master' into depends-on-otel-java-snapshot", "committedDate": "2020-07-10T11:22:43Z", "type": "commit"}, {"oid": "3f15b68c3f0f5375b1a2f4046598cb3e9824f127", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3f15b68c3f0f5375b1a2f4046598cb3e9824f127", "message": "Now works with otel-java 0.6.0", "committedDate": "2020-07-10T13:57:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAyNjMxOA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453026318", "bodyText": "\ud83d\udc4d", "author": "trask", "createdAt": "2020-07-10T19:00:31Z", "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/decorator/HttpServerTracer.java", "diffHunk": "@@ -226,8 +226,11 @@ protected Throwable unwrapThrowable(Throwable throwable) {\n   }\n \n   private <C> SpanContext extract(final C carrier, final HttpTextFormat.Getter<C> getter) {\n+    // Using Context.ROOT here may be quite unexpected, but the reason is simple.\n+    // We want either span context extracted from the carrier or invalid one.\n+    // We DO NOT want any span context potentially lingering in the current context.", "originalCommit": "3f15b68c3f0f5375b1a2f4046598cb3e9824f127", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a05d3c2819e0dd4342b06c1f0c6d51fd8814ece1", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a05d3c2819e0dd4342b06c1f0c6d51fd8814ece1", "message": "Fix muzzle", "committedDate": "2020-07-10T19:25:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzOTY0OA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453039648", "bodyText": "Not directly relevant to this PR, but why do we have one of these here, when we have one in the main repo?", "author": "jkwatson", "createdAt": "2020-07-10T19:31:06Z", "path": "auto-exporters/logging/src/main/java/io/opentelemetry/auto/exporters/logging/LoggingExporter.java", "diffHunk": "@@ -17,10 +17,10 @@\n package io.opentelemetry.auto.exporters.logging;\n \n import io.opentelemetry.common.AttributeValue;\n+import io.opentelemetry.common.ReadableKeyValuePairs.KeyValueConsumer;\n import io.opentelemetry.sdk.trace.data.SpanData;\n import io.opentelemetry.sdk.trace.export.SpanExporter;\n import java.util.Collection;\n-import java.util.Map;\n \n public class LoggingExporter implements SpanExporter {", "originalCommit": "a05d3c2819e0dd4342b06c1f0c6d51fd8814ece1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0Mjc3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453042776", "bodyText": "That is a great question. Please, file a bug to us :)", "author": "iNikem", "createdAt": "2020-07-10T19:38:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzOTY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0NTE1Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453045153", "bodyText": "will do. I think yours has much cleaner output, but it's also not using a logging framework, but just using System.out so maybe they're not compatible?", "author": "jkwatson", "createdAt": "2020-07-10T19:44:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzOTY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0MDU0MA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453040540", "bodyText": "import?", "author": "jkwatson", "createdAt": "2020-07-10T19:33:11Z", "path": "instrumentation/opentelemetry-api-beta/src/test/groovy/MeterTest.groovy", "diffHunk": "@@ -96,34 +92,34 @@ class MeterTest extends AgentTestRunner {\n     def instrument = meter.\"$builderMethod\"(\"test\")\n       .setDescription(\"d\")\n       .setUnit(\"u\")\n-      .setConstantLabels([\"m\": \"n\", \"o\": \"p\"])\n+      .setConstantLabels(Labels.of(\"m\", \"n\", \"o\", \"p\"))\n       .build()\n     if (bind) {\n-      instrument = instrument.bind()\n+      instrument = instrument.bind(Labels.empty())\n     }\n     if (bind) {\n       instrument.record(value1)\n       instrument.record(value2)\n     } else {\n-      instrument.record(value1, \"q\", \"r\")\n-      instrument.record(value2, \"q\", \"r\")\n+      instrument.record(value1, Labels.of(\"q\", \"r\"))\n+      instrument.record(value2, Labels.of(\"q\", \"r\"))\n     }\n \n     then:\n-    def metricData = metricData(instrumentationName, \"test\")\n+    def metricData = findMetric(OpenTelemetrySdk.getMeterProvider().getMetricProducer().getAllMetrics(), instrumentationName, \"test\")\n     metricData != null\n     metricData.descriptor.description == \"d\"\n     metricData.descriptor.unit == \"u\"\n     metricData.descriptor.type == SUMMARY\n-    metricData.descriptor.constantLabels == [\"m\": \"n\", \"o\": \"p\"]\n+    metricData.descriptor.constantLabels == io.opentelemetry.common.Labels.of(\"m\", \"n\", \"o\", \"p\")\n     metricData.instrumentationLibraryInfo.name == instrumentationName\n     metricData.instrumentationLibraryInfo.version == \"1.2.3\"\n     metricData.points.size() == 1\n     def point = metricData.points.iterator().next()\n     if (bind) {\n-      point.labels == [\"w\": \"x\", \"y\": \"z\"]\n+      point.labels == io.opentelemetry.common.Labels.of(\"w\", \"x\", \"y\", \"z\")", "originalCommit": "a05d3c2819e0dd4342b06c1f0c6d51fd8814ece1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0MzE5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453043192", "bodyText": "We already have an import for unshaded.io.opentelemetry.common.Labels, which is used for creating instruments.", "author": "iNikem", "createdAt": "2020-07-10T19:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0MDU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0OTY2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/662#discussion_r453049665", "bodyText": "oh I see. carry on, then.", "author": "jkwatson", "createdAt": "2020-07-10T19:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA0MDU0MA=="}], "type": "inlineReview"}]}