{"pr_number": 4475, "pr_title": "[builder] Improve error message for missing bnd.bnd", "pr_createdAt": "2020-12-26T14:29:30Z", "pr_url": "https://github.com/bndtools/bnd/pull/4475", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ5NzQ1Nw==", "url": "https://github.com/bndtools/bnd/pull/4475#discussion_r551497457", "bodyText": "Shouldn't this be:\n} else if (!Files.isRegularFile(javaPath.resolve(Project.BNDFILE))) {", "author": "bjhargrave", "createdAt": "2021-01-04T18:44:28Z", "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -148,6 +148,10 @@\n \t\t\t\t\t\tif (!Files.isSameFile(javaPath.getParent(), wsPath)) {\n \t\t\t\t\t\t\tmsg = \"The project directory: \" + javaPath + \" is not a subdirectory of the bnd workspace \"\n \t\t\t\t\t\t\t\t+ wsPath;\n+\t\t\t\t\t\t} else if (!projPath.append(Project.BNDFILE)", "originalCommit": "8d753053333aed63f03b4a9087c847470adff1de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkxNzk1MA==", "url": "https://github.com/bndtools/bnd/pull/4475#discussion_r551917950", "bodyText": "Yes, that would probably be more efficient and more compact, thanks for the tip.\nI've done this as well as added a few more different checks for weird error-causing conditions that could occur so that I can make the error message even more specific.", "author": "kriegfrj", "createdAt": "2021-01-05T13:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ5NzQ1Nw=="}], "type": "inlineReview"}, {"oid": "95eff319664794252caccc82f9513a641b49ca75", "url": "https://github.com/bndtools/bnd/commit/95eff319664794252caccc82f9513a641b49ca75", "message": "[builder] Improve error message for missing bnd.bnd\n\nFixes #4422.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2021-01-05T12:58:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxMjgxMg==", "url": "https://github.com/bndtools/bnd/pull/4475#discussion_r552012812", "bodyText": "This is unreachable. If the file exists and is not a directory, then it must be a regular file. There are no other choices since you follow symlinks.", "author": "bjhargrave", "createdAt": "2021-01-05T15:42:05Z", "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -148,13 +148,24 @@\n \t\t\t\t\t\tif (!Files.isSameFile(javaPath.getParent(), wsPath)) {\n \t\t\t\t\t\t\tmsg = \"The project directory: \" + javaPath + \" is not a subdirectory of the bnd workspace \"\n \t\t\t\t\t\t\t\t+ wsPath;\n+\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\tPath bndPath = javaPath.resolve(Project.BNDFILE);\n+\n+\t\t\t\t\t\t\tif (!Files.exists(bndPath)) {\n+\t\t\t\t\t\t\t\tmsg = \"The project does not have a \" + Project.BNDFILE + \" file\";\n+\t\t\t\t\t\t\t} else if (!Files.isReadable(bndPath)) {\n+\t\t\t\t\t\t\t\tmsg = Project.BNDFILE + \" is not readable\";\n+\t\t\t\t\t\t\t} else if (Files.isDirectory(bndPath)) {\n+\t\t\t\t\t\t\t\tmsg = Project.BNDFILE + \" is a directory\";\n+\t\t\t\t\t\t\t} else if (!Files.isRegularFile(bndPath)) {\n+\t\t\t\t\t\t\t\tmsg = Project.BNDFILE + \" is not a regular file\";", "originalCommit": "95eff319664794252caccc82f9513a641b49ca75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxNDIzNA==", "url": "https://github.com/bndtools/bnd/pull/4475#discussion_r552014234", "bodyText": "It could be a pipe or a device or some other special file?", "author": "kriegfrj", "createdAt": "2021-01-05T15:44:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxMjgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxOTI2Mw==", "url": "https://github.com/bndtools/bnd/pull/4475#discussion_r552019263", "bodyText": "How could the bnd.bnd path be a special file? I don't see how that could ever be the case. I think you want to test for the normal case first (isRegularFile) and it that fails, then try to make a nice error message.", "author": "bjhargrave", "createdAt": "2021-01-05T15:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxMjgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjM1Mjg3Nw==", "url": "https://github.com/bndtools/bnd/pull/4475#discussion_r552352877", "bodyText": "How could the bnd.bnd path be a special file? I don't see how that could ever be the case. I think you want to test for the normal case first (isRegularFile) and it that fails, then try to make a nice error message.\n\nIt could be a special file if the user does something a bit silly or tries to be a bit smart. Admittedly, this is not an expected scenario. But I think it's a good rule of UI design to be able to handle the user doing something silly and/or unexpected and to give them the most useful feedback possible to help them fix the problem, especially if it is relatively simple and inexpensive to do so. In this case, the cost of the extra test is low (both in execution overhead and code size) and it's not in a performance-critical part of the code, so I'm struggling to see the downside in including it. But if you insist, I will remove the specific check for a directory.\nThere is already a \"nice\" error message (or at least, as nice as it can be) as the default:\n\n  \n    \n      bnd/bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java\n    \n    \n         Line 133\n      in\n      0a3846f\n    \n    \n    \n    \n\n        \n          \n           String msg = \"Cannot find bnd project: check that it is actually a bnd project and is part of the bnd workspace\"; \n        \n    \n  \n\n\nIf none of the other diagnostic checks finds any more specific cause, this is what will be shown. If you can think of a better generic message, or think of more diagnostic tests that could be done, then I'm all ears!", "author": "kriegfrj", "createdAt": "2021-01-06T03:46:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxMjgxMg=="}], "type": "inlineReview"}, {"oid": "96bf537250335e2868b78fe7bea7949d584ffaeb", "url": "https://github.com/bndtools/bnd/commit/96bf537250335e2868b78fe7bea7949d584ffaeb", "message": "[builder] Improve error message for missing bnd.bnd\n\nFixes #4422.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2021-01-06T03:48:55Z", "type": "forcePushed"}, {"oid": "f3f3634e36c3a4ab296e43d91a6157b6c8554c50", "url": "https://github.com/bndtools/bnd/commit/f3f3634e36c3a4ab296e43d91a6157b6c8554c50", "message": "[builder] Improve error message for missing bnd.bnd\n\nFixes #4422.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2021-01-06T03:49:36Z", "type": "commit"}, {"oid": "f3f3634e36c3a4ab296e43d91a6157b6c8554c50", "url": "https://github.com/bndtools/bnd/commit/f3f3634e36c3a4ab296e43d91a6157b6c8554c50", "message": "[builder] Improve error message for missing bnd.bnd\n\nFixes #4422.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2021-01-06T03:49:36Z", "type": "forcePushed"}]}