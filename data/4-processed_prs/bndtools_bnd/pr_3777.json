{"pr_number": 3777, "pr_title": "[doc] Manifest Annotations", "pr_createdAt": "2020-02-14T10:26:13Z", "pr_url": "https://github.com/bndtools/bnd/pull/3777", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyNzU3Mw==", "url": "https://github.com/bndtools/bnd/pull/3777#discussion_r379427573", "bodyText": "This is not entirely true. See https://bnd.bndtools.org/chapters/235-accessor-properties.html.", "author": "bjhargrave", "createdAt": "2020-02-14T13:24:54Z", "path": "docs/_chapters/230-manifest-annotations.md", "diffHunk": "@@ -72,6 +71,26 @@ Require-Capability: \\\n \n The invisible link created between user code and the indirect requirement is a powerful mechanism that enables automatic validation of a bundle closure.\n \n+The actual requirement `filter:` directive is constructed from an `AND` of the `filter()`, `name()`, and `version()` annotation methods. All fields are optional. The name field will create an assertion that the given namespace equals the value of the `name()` annotation method. For example, if the namespace is `com.example.foo` and the `name()` method has the value `bar` then the filter is `(com.example.foo=bar)`. If a version is specified, it will be expanded to a filtered version-range expression.  The convention of using the namespace name as the property key is commonly used in OSGi specification. For example, the filter `(osgi.wiring.package=com.example.foo)` is the filter for an Import-Package `com.example.foo` while `osgi.wiring.package` is the namespace for the packages.\n+\n+The filter will **not** be processed for macros like the `@Header` annotation is. The filter can therefore not refer to any annotation methods in meta-annotated classes. ", "originalCommit": "32a1908ed95bb266dbb7abb3ec88381a16d8a494", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQzOTUwMA==", "url": "https://github.com/bndtools/bnd/pull/3777#discussion_r379439500", "bodyText": "I spent half an hour going over the getFilter() method and I fail to see where -any- macro processing takes place on the filter. Am I missing something?", "author": "pkriens", "createdAt": "2020-02-14T13:51:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyNzU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ0NzcwMw==", "url": "https://github.com/bndtools/bnd/pull/3777#discussion_r379447703", "bodyText": "All results of AnnotationsHeaders are parsed by macros. It's not that the filter itself is processed, but the entire end result is processed here https://github.com/bndtools/bnd/blob/master/biz.aQute.bndlib/src/aQute/bnd/osgi/AnnotationHeaders.java#L979\nIn this way, any string contents of any attribute or value can contain macros.", "author": "rotty3000", "createdAt": "2020-02-14T14:07:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyNzU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ1MTAyMQ==", "url": "https://github.com/bndtools/bnd/pull/3777#discussion_r379451021", "bodyText": "As @bjhargrave referenced, we have an entire feature built around this behaviour (which is tested) :) Furthermore, additional bnd features beyond bundle annotations use this such as SPI Annotations.", "author": "rotty3000", "createdAt": "2020-02-14T14:14:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyNzU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ1MzY0NQ==", "url": "https://github.com/bndtools/bnd/pull/3777#discussion_r379453645", "bodyText": "You are right, they are processed properly. But looking at Tim I was not the only one confused.", "author": "pkriens", "createdAt": "2020-02-14T14:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyNzU3Mw=="}], "type": "inlineReview"}, {"oid": "14e83ce6333e0684c14bf0475047afbb5e92c942", "url": "https://github.com/bndtools/bnd/commit/14e83ce6333e0684c14bf0475047afbb5e92c942", "message": "[docs] The annotation headers are expanded by macros\n\n- Removed statement it could not macro processed\n- Added an example using a macro in the filter\n- Added the ${#key} macro description\n- Referred to the accessor-properties for details\n\n\nSigned-off-by: Peter Kriens <Peter.Kriens@aqute.biz>", "committedDate": "2020-02-14T14:53:18Z", "type": "forcePushed"}, {"oid": "313caecd9e78e542a24f65d212001198d76329ed", "url": "https://github.com/bndtools/bnd/commit/313caecd9e78e542a24f65d212001198d76329ed", "message": "[docs] The annotation headers are expanded by macros\n\n- Added an example using a macro in the filter\n- Added a ${#accessor-property} macro description\n- Referred to the accessor-properties for details\n\n\n\nSigned-off-by: Peter Kriens <Peter.Kriens@aqute.biz>", "committedDate": "2020-02-14T14:57:22Z", "type": "commit"}, {"oid": "313caecd9e78e542a24f65d212001198d76329ed", "url": "https://github.com/bndtools/bnd/commit/313caecd9e78e542a24f65d212001198d76329ed", "message": "[docs] The annotation headers are expanded by macros\n\n- Added an example using a macro in the filter\n- Added a ${#accessor-property} macro description\n- Referred to the accessor-properties for details\n\n\n\nSigned-off-by: Peter Kriens <Peter.Kriens@aqute.biz>", "committedDate": "2020-02-14T14:57:22Z", "type": "forcePushed"}]}