{"pr_number": 4163, "pr_title": "[quickfix] Integration tests for BuildpathQuickFixProcessor", "pr_createdAt": "2020-06-15T08:05:48Z", "pr_url": "https://github.com/bndtools/bnd/pull/4163", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0Mjk3Nw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440142977", "bodyText": "aQute.libg should always be version=project since we conditional package from this project and don't use the jar.", "author": "bjhargrave", "createdAt": "2020-06-15T12:34:17Z", "path": "bndtools.core.test/bnd.bnd", "diffHunk": "@@ -0,0 +1,70 @@\n+# Set javac settings from JDT prefs\n+-include: ${workspace}/cnf/includes/jdt.bnd, ${workspace}/cnf/includes/bndtools.bnd\n+-sub: *.bnd,bnd/*.bnd\n+\n+# These are bundles that are not required for building but for debugging when doing\n+# code inspection.\n+-buildpath.debug: \\\n+\torg.eclipse.osgi,\\\n+\torg.eclipse.core.resources,\\\n+\torg.eclipse.e4.ui.workbench.swt,\\\n+\torg.eclipse.search\n+\n+-conditionalpackage: \\\n+\taQute.lib.*;-split-package:=merge-first, \\\n+\taQute.libg.*;-split-package:=merge-first\n+\n+-buildpath: \\\n+\taQute.libg;version=snapshot,\\", "originalCommit": "d9c59f77e94c0303d9a1c19669696ec665cc1887", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0NTI0OA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440145248", "bodyText": "Do we really want version numbers for the Eclipse deps? This will make it awkward to update the Eclipse base version one day. As in bndtools.core/bnd.bnd, the Eclipse deps should be versionless (or version=latest).", "author": "bjhargrave", "createdAt": "2020-06-15T12:38:40Z", "path": "bndtools.core.test/bnd.bnd", "diffHunk": "@@ -0,0 +1,70 @@\n+# Set javac settings from JDT prefs\n+-include: ${workspace}/cnf/includes/jdt.bnd, ${workspace}/cnf/includes/bndtools.bnd\n+-sub: *.bnd,bnd/*.bnd\n+\n+# These are bundles that are not required for building but for debugging when doing\n+# code inspection.\n+-buildpath.debug: \\\n+\torg.eclipse.osgi,\\\n+\torg.eclipse.core.resources,\\\n+\torg.eclipse.e4.ui.workbench.swt,\\\n+\torg.eclipse.search\n+\n+-conditionalpackage: \\\n+\taQute.lib.*;-split-package:=merge-first, \\\n+\taQute.libg.*;-split-package:=merge-first\n+\n+-buildpath: \\\n+\taQute.libg;version=snapshot,\\\n+\tbndtools.core;version=snapshot,\\\n+\tbndtools.builder;version=snapshot,\\\n+\torg.junit.platform.commons;version=latest,\\\n+\torg.junit.platform.engine;version=latest,\\\n+\tassertj-core;version=latest,\\\n+\torg.opentest4j;version=latest,\\\n+\torg.apiguardian:apiguardian-api;version=latest,\\\n+\torg.junit.jupiter.api;version=latest,\\\n+\torg.junit.jupiter.engine;version=latest,\\\n+\torg.junit.jupiter.params;version=latest,\\\n+\torg.eclipse.jdt.core;version=3.16.0,\\", "originalCommit": "d9c59f77e94c0303d9a1c19669696ec665cc1887", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUwNzU1MQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440507551", "bodyText": "I agree with this - the reason these dependencies have dependencies is because they were added (mostly) using the quick fix processor. I think we need to consider changing the default behaviour of the quick fix processor on this point, and maybe making it configurable.", "author": "kriegfrj", "createdAt": "2020-06-15T23:50:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0NTI0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUwODU0NQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440508545", "bodyText": "Actually, it shouldn't be too awkward to upgrade Eclipse as the version specifiers don't give an upper bound on the version range. As long as we don't go try to backwards to support older versions of Eclipse it should still be able to find the build dependencies. I still agree that we don't need them though.", "author": "kriegfrj", "createdAt": "2020-06-15T23:53:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0NTI0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU2NTAwNA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440565004", "bodyText": "Fixed now.", "author": "kriegfrj", "createdAt": "2020-06-16T03:28:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0NTI0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440172457", "bodyText": "Can we not fold this into \"OSGi Snapshots\"? After all the osgi-test artifacts are from OSGi.", "author": "bjhargrave", "createdAt": "2020-06-15T13:24:35Z", "path": "cnf/ext/repositories.bnd", "diffHunk": "@@ -7,6 +7,11 @@ mavencentral:           https://repo.maven.apache.org/maven2\n         releaseUrl=\"${mavencentral}\";\\\n         index=\"${.}/central.mvn\";\\\n         readOnly=true,\\\n+    aQute.bnd.repository.maven.provider.MavenBndRepository;\\\n+        name=\"Sonatype\";\\\n+        snapshotUrl=\"https://oss.sonatype.org/content/repositories/snapshots/\";\\\n+        index=\"${.}/sonatype.mvn\";\\\n+        readOnly=true,\\", "originalCommit": "d9c59f77e94c0303d9a1c19669696ec665cc1887", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE4Njg5Mg==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440186892", "bodyText": "I kept it separate for resolving - the OSGi Snapshot repo is not included in -runresolve, but Sonatype is. I suppose i could use -runblacklist instead to exclude just those we want to exclude.", "author": "kriegfrj", "createdAt": "2020-06-15T13:46:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE5MzkyNQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440193925", "bodyText": "OK, that makes sense. But then \"Sonatype\" is not a descriptive name for the new repo.", "author": "bjhargrave", "createdAt": "2020-06-15T13:56:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIyNTUwNw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440225507", "bodyText": "It is about as descriptive as \"Maven Central\"...\nIm hoping that the release of osgi-test is not far away and i can add them to Maven Central. Actually, i think i settled on an implementation which didn't use osgi-test so maybe i can ditch it altogether.", "author": "kriegfrj", "createdAt": "2020-06-15T14:40:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIzMTI2MA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440231260", "bodyText": "My point was that you segregated those artifacts into the separate repo so you can use that repo in resolving. I could not see that, so I asked why. Perhaps a name like \"Test Resolve\" or something would better convey the intent of the repo and stop someone else in the future adding something to the repo which we don't want in the test resolve.", "author": "bjhargrave", "createdAt": "2020-06-15T14:48:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUwMjExNg==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440502116", "bodyText": "Sorry, I didn't explain it very well. My point was, as we have a generic \"Maven Central\" repo where we throw all of the bundles that live on Maven Central (and don't belong in another repo), I thought it might be nice to have a generic \"Sonatype\" repo where we throw all of the snapshots that don't live anywhere else. The purpose of segregating was more about keeping the OSGi Snapshot repo out of the resolve (because it seems to exclusively contain build-time-only bundles) than about having a specific repo for resolving the integration test.", "author": "kriegfrj", "createdAt": "2020-06-15T23:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5OTgyNA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r440599824", "bodyText": "I have left this one as it is for now. Longer term (once osgi-test goes into a proper release) we can either move osgi-test into Maven Central, or split Maven Central into \"Maven Central\" and \"Maven Central Testing\" for test-oriented dependencies and make osgi-test a member of that.", "author": "kriegfrj", "createdAt": "2020-06-16T05:47:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyMjI1Ng==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r443322256", "bodyText": "I found that the dependency that I was looking for in osgi-test has an equivalent in aQute.lib.exceptions, so the latest push has removed osgi-test (and the Sonatype repo) completely.", "author": "kriegfrj", "createdAt": "2020-06-22T05:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MjQ1Nw=="}], "type": "inlineReview"}, {"oid": "f46c73fcd5e4207bad4f7358e5486d781722ce5b", "url": "https://github.com/bndtools/bnd/commit/f46c73fcd5e4207bad4f7358e5486d781722ce5b", "message": "[quickfix] Integration tests for BuildpathQuickFixProcessor\n\nPorted from the old ImportPackageQuickFixProcessorTest.\n\nA number of these tests don't quite work properly in the new implementation;\nI have left these in there, but annotated @Disabled so that they don't\ninterfere with the CI output.\n\nFixes #3881.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-16T03:04:41Z", "type": "forcePushed"}, {"oid": "a8d17bbf538fefe8d8b885c993a3331a38b93982", "url": "https://github.com/bndtools/bnd/commit/a8d17bbf538fefe8d8b885c993a3331a38b93982", "message": "[github actions] Change to use xvfb for Ubuntu builds\n\nAllows testing of components that have GUIs.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-23T00:49:34Z", "type": "forcePushed"}, {"oid": "279f70b445374d5a5a1d404cff7ba5bcdb818613", "url": "https://github.com/bndtools/bnd/commit/279f70b445374d5a5a1d404cff7ba5bcdb818613", "message": "[github actions] Change to use xvfb for Ubuntu builds\n\nAllows testing of components that have GUIs.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-23T01:04:25Z", "type": "forcePushed"}, {"oid": "77a32c0c7bf57f22f1ae244ad1d81444428673b3", "url": "https://github.com/bndtools/bnd/commit/77a32c0c7bf57f22f1ae244ad1d81444428673b3", "message": "[github actions] Change to use xvfb for Ubuntu builds\n\nAllows testing of components that have GUIs.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-23T01:10:43Z", "type": "forcePushed"}, {"oid": "9500c2e4ec0593465b304782e0170adca148c4b9", "url": "https://github.com/bndtools/bnd/commit/9500c2e4ec0593465b304782e0170adca148c4b9", "message": "[github actions] Change to use xvfb for Ubuntu builds\n\nAllows testing of components that have GUIs.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-23T01:18:17Z", "type": "forcePushed"}, {"oid": "5c864f8e53d0f6a75291b55f47513cef0fdb8709", "url": "https://github.com/bndtools/bnd/commit/5c864f8e53d0f6a75291b55f47513cef0fdb8709", "message": "[bndtools test] Moved workbench sync code from WorkbenchExtension to Activator\n\nMade the tests bundle lazy. This ensures that it is not started during startup,\nbut by the tester thread when it first tries to load the test class. The start()\nmethod will then block until the workbench is ready.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-24T08:19:20Z", "type": "forcePushed"}, {"oid": "423e12396df9fdd6499e6a49d4b622bd68fcc867", "url": "https://github.com/bndtools/bnd/commit/423e12396df9fdd6499e6a49d4b622bd68fcc867", "message": "[bndtools test] Moved workbench sync code from WorkbenchExtension to Activator\n\nMade the tests bundle lazy. This ensures that it is not started during startup,\nbut by the tester thread when it first tries to load the test class. The start()\nmethod will then block until the workbench is ready.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-24T08:24:03Z", "type": "forcePushed"}, {"oid": "bf3fdabecc966f9f7b8192a30242b31ac9f4a955", "url": "https://github.com/bndtools/bnd/commit/bf3fdabecc966f9f7b8192a30242b31ac9f4a955", "message": "[github actions] Change to use xvfb for Ubuntu builds\n\nAllows testing of components that have GUIs.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-06-25T01:01:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU4NDM5Nw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r448584397", "bodyText": "I am not keen on using this action and these changes to the workflow. See #4208 for my suggested alternate.", "author": "bjhargrave", "createdAt": "2020-07-01T19:55:37Z", "path": ".github/workflows/cibuild.yml", "diffHunk": "@@ -53,9 +50,31 @@ jobs:\n       with:\n         java-version: ${{ matrix.java }}\n     - name: Build\n-      run: |\n-        ./.github/scripts/${{ matrix.script }}\n+       # Can't upgrade this until https://github.com/GabrielBB/xvfb-action/issues/10 is fixed\n+      uses: GabrielBB/xvfb-action@v1.0", "originalCommit": "bf3fdabecc966f9f7b8192a30242b31ac9f4a955", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MzExOQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r448693119", "bodyText": "I have reviewed and approved your alternate solution - agreed, it is better. I didn't realise that xvfb was part of the standard GitHub Actions offering.\nI have also rebased this PR onto yours (minus the commit that changes the workflow).", "author": "kriegfrj", "createdAt": "2020-07-02T01:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU4NDM5Nw=="}], "type": "inlineReview"}, {"oid": "600155e9cdd0d7e0222941d6dba762fd84ffac72", "url": "https://github.com/bndtools/bnd/commit/600155e9cdd0d7e0222941d6dba762fd84ffac72", "message": "[quickfix] Integration tests for BuildpathQuickFixProcessor\n\nPorted from the old ImportPackageQuickFixProcessorTest.\n\nA number of these tests test old features that don't quite work properly in\nthe new implementation or potential features that have not yet been\nimplemented (eg, inner classes). I have left these in there, but annotated\n@Disabled so that they don't interfere with the CI output.\n\nFixes #3881.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-07-01T23:59:21Z", "type": "forcePushed"}, {"oid": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "url": "https://github.com/bndtools/bnd/commit/2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "message": "[quickfix] Integration tests for BuildpathQuickFixProcessor\n\nPorted from the old ImportPackageQuickFixProcessorTest.\n\nA number of these tests test old features that don't quite work properly in\nthe new implementation or potential features that have not yet been\nimplemented (eg, inner classes). I have left these in there, but annotated\n@Disabled so that they don't interfere with the CI output.\n\nFixes #3881.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-07-02T03:48:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyNjU0OA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449126548", "bodyText": "We should not be checking in the .metadata/ folder!?", "author": "bjhargrave", "createdAt": "2020-07-02T16:13:57Z", "path": "bndtools.core.test/.metadata/.plugins/org.eclipse.core.runtime/.settings/org.eclipse.jdt.ui.prefs", "diffHunk": "@@ -0,0 +1,9 @@\n+content_assist_proposals_background=255,255,255", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTMyMw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449141323", "bodyText": "Oops...", "author": "kriegfrj", "createdAt": "2020-07-02T16:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyNjU0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyNzYzMA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449127630", "bodyText": "There is already a testOSGi task defined by the Bnd Gradle plugin. Why are you not just configuring that task? And also you need to use the configuration avoidance style of writing gradle task for this build.", "author": "bjhargrave", "createdAt": "2020-07-02T16:15:37Z", "path": "bndtools.core.test/build.gradle", "diffHunk": "@@ -0,0 +1,37 @@\n+import aQute.bnd.gradle.TestOSGi\n+import org.apache.tools.ant.taskdefs.condition.Os\n+\n+task testosgi(type: TestOSGi) {", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MDE4MQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449140181", "bodyText": "Im not a Gradle expert, so please excuse my ignorance, but what's the \"configuration avoidance \" style? I knew there was already a testOSGi task but I didn't know how to reconfigure it.", "author": "kriegfrj", "createdAt": "2020-07-02T16:37:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyNzYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE2NTk5Mw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449165993", "bodyText": "See \n  \n    \n      bnd/biz.aQute.bnd.gradle/build.gradle\n    \n    \n        Lines 22 to 53\n      in\n      35661c2\n    \n    \n    \n    \n\n        \n          \n           tasks.named('test') { \n        \n\n        \n          \n               inputs.files tasks.named('jar') \n        \n\n        \n          \n               systemProperty 'bnd_version', bnd('bnd_version') \n        \n\n        \n          \n               def source = project.file('testresources') \n        \n\n        \n          \n               def target = project.layout.buildDirectory.dir('testresources') \n        \n\n        \n          \n               doFirst { // copy test resources into build dir \n        \n\n        \n          \n                   project.delete(target) \n        \n\n        \n          \n                   copy { \n        \n\n        \n          \n                       from source \n        \n\n        \n          \n                       into target \n        \n\n        \n          \n                   } \n        \n\n        \n          \n               } \n        \n\n        \n          \n           } \n        \n\n        \n          \n            \n        \n\n        \n          \n           tasks.named('testClasses') { \n        \n\n        \n          \n               def pluginClasspath = { project.files(configurations.runtimeClasspath.allArtifacts.files, \n        \n\n        \n          \n                  configurations.runtimeClasspath.resolvedConfiguration.files) } \n        \n\n        \n          \n               inputs.files(pluginClasspath).withPropertyName('pluginClasspath') \n        \n\n        \n          \n               def pluginClasspathFile = { new File(tasks.getByName('compileTestJava').destinationDir, 'plugin-under-test-metadata.properties') } \n        \n\n        \n          \n               outputs.file(pluginClasspathFile).withPropertyName('pluginClasspathFile') \n        \n\n        \n          \n               doLast { \n        \n\n        \n          \n                   Properties properties = new Properties() \n        \n\n        \n          \n                   properties.setProperty('implementation-classpath', pluginClasspath().asPath) \n        \n\n        \n          \n                   pluginClasspathFile().withOutputStream { \n        \n\n        \n          \n                     properties.store(it, 'plugin-under-test-metadata') \n        \n\n        \n          \n                   } \n        \n\n        \n          \n               } \n        \n\n        \n          \n           } \n        \n\n        \n          \n            \n        \n\n        \n          \n           tasks.named('release') { \n        \n\n        \n          \n             dependsOn 'groovydoc' \n        \n\n        \n          \n           } \n        \n    \n  \n\n for some examples of configuring tasks that avoid executing the configuration when the task is not part of the task graph.", "author": "bjhargrave", "createdAt": "2020-07-02T17:24:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyNzYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MDkyOQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449340929", "bodyText": "Fixed, thanks for the pointer.", "author": "kriegfrj", "createdAt": "2020-07-03T02:03:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyNzYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyODEyNg==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449128126", "bodyText": "Is this the gradle way to do this?", "author": "bjhargrave", "createdAt": "2020-07-02T16:16:23Z", "path": "bndtools.core.test/build.gradle", "diffHunk": "@@ -0,0 +1,37 @@\n+import aQute.bnd.gradle.TestOSGi\n+import org.apache.tools.ant.taskdefs.condition.Os\n+\n+task testosgi(type: TestOSGi) {\n+\t[\n+\t\t'biz.aQute.bndlib',\n+\t\t'biz.aQute.repository',\n+\t\t'biz.aQute.resolve',\n+\t\t'biz.aQute.tester.junit-platform',\n+\t\t'bndtools.api',\n+\t\t'bndtools.builder',\n+\t\t'bndtools.core',\n+\t\t'biz.aQute.tester.junit-platform',\n+\t\t'org.bndtools.headless.build.manager',\n+\t\t'org.bndtools.headless.build.plugin.ant',\n+\t\t'org.bndtools.headless.build.plugin.gradle',\n+\t\t'org.bndtools.templates.template',\n+\t\t'org.bndtools.templating.gitrepo',\n+\t\t'org.bndtools.templating',\n+\t\t'org.bndtools.versioncontrol.ignores.manager',\n+\t\t'org.bndtools.versioncontrol.ignores.plugin.git'\n+\t].each { dependsOn \":$it:jar\" }\n+   description \"Bndtools Core Integration tests\"\n+   group 'test'\n+   inputs.files jar\n+   if (Os.isFamily(Os.FAMILY_WINDOWS)) {", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MDk5MQ==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449140991", "bodyText": "It's the best i found- if you know a better way,  let me know!", "author": "kriegfrj", "createdAt": "2020-07-02T16:38:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyODEyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE3MzkzMA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449173930", "bodyText": "Apparently Os.isFamily(Os.FAMILY_UNIX) returns true on macOS. Which means this if/else construct is broken.\nWe do this elsewhere in the build:\n\n  \n    \n      bnd/maven/build.gradle\n    \n    \n         Line 40\n      in\n      35661c2\n    \n    \n    \n    \n\n        \n          \n           if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {", "author": "bjhargrave", "createdAt": "2020-07-02T17:40:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyODEyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MjU2Mw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449342563", "bodyText": "I'm not sure what \"os.name\" is going to throw at me on the various OSes. Using Os.isFamily() is voted the best solution on this SO thread, though the answer is old. I think it's a bit of an oversight that Gradle doesn't have any built-in support for this.\nI have reorded the if/else so that Mac is tested first and Linux is only used if it's not Mac. I think it's more compact. If you really prefer though, I can hand-craft something based on inspection of os.name (I just don't have a good way to verify it as I don't have access to a Mac to test it on).", "author": "kriegfrj", "createdAt": "2020-07-03T02:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyODEyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyODM3NA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449128374", "bodyText": "The check task already depends on the testOSGi task mentioned above.", "author": "bjhargrave", "createdAt": "2020-07-02T16:16:49Z", "path": "bndtools.core.test/build.gradle", "diffHunk": "@@ -0,0 +1,37 @@\n+import aQute.bnd.gradle.TestOSGi\n+import org.apache.tools.ant.taskdefs.condition.Os\n+\n+task testosgi(type: TestOSGi) {\n+\t[\n+\t\t'biz.aQute.bndlib',\n+\t\t'biz.aQute.repository',\n+\t\t'biz.aQute.resolve',\n+\t\t'biz.aQute.tester.junit-platform',\n+\t\t'bndtools.api',\n+\t\t'bndtools.builder',\n+\t\t'bndtools.core',\n+\t\t'biz.aQute.tester.junit-platform',\n+\t\t'org.bndtools.headless.build.manager',\n+\t\t'org.bndtools.headless.build.plugin.ant',\n+\t\t'org.bndtools.headless.build.plugin.gradle',\n+\t\t'org.bndtools.templates.template',\n+\t\t'org.bndtools.templating.gitrepo',\n+\t\t'org.bndtools.templating',\n+\t\t'org.bndtools.versioncontrol.ignores.manager',\n+\t\t'org.bndtools.versioncontrol.ignores.plugin.git'\n+\t].each { dependsOn \":$it:jar\" }\n+   description \"Bndtools Core Integration tests\"\n+   group 'test'\n+   inputs.files jar\n+   if (Os.isFamily(Os.FAMILY_WINDOWS)) {\n+      bndrun 'test.win32.x86_64.bndrun'\n+   } else if (Os.isFamily(Os.FAMILY_UNIX)) {\n+      bndrun 'test.gtk.linux.x86_64.bndrun'\n+   } else if (Os.isFamily(Os.FAMILY_MAC)) {\n+      bndrun 'test.cocoa.macosx.x86_64.bndrun'\n+   }\n+}\n+\n+check {", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEyOTU2Mw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449129563", "bodyText": "Since this is a test project and should not be released, you need to make sure it is not released.\n-buildrepo:\n-releaserepo:", "author": "bjhargrave", "createdAt": "2020-07-02T16:18:53Z", "path": "bndtools.core.test/bnd.bnd", "diffHunk": "@@ -0,0 +1,52 @@\n+# Set javac settings from JDT prefs\n+-include: ${workspace}/cnf/includes/jdt.bnd, ${workspace}/cnf/includes/bndtools.bnd\n+-sub: *.bnd", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzMDk1OA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449130958", "bodyText": "This whole repo is dual licensed under AL2 OR EPL2. Not sure why you have this license header here.", "author": "bjhargrave", "createdAt": "2020-07-02T16:21:14Z", "path": "bndtools.core.test/src/bndtools/core/test/launch/NullContextPresentationEngine.java", "diffHunk": "@@ -0,0 +1,154 @@\n+/*******************************************************************************\n+ * Copyright (c) 2009, 2015 IBM Corporation and others.\n+ *\n+ * This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License 2.0\n+ * which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMxMzkxNw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449313917", "bodyText": "This is a cut-and-paste error. NullContextPresentationEngine started off life as a clone of https://github.com/eclipse/eclipse.platform.ui/blob/master/tests/org.eclipse.e4.ui.tests/src/org/eclipse/e4/ui/tests/application/HeadlessContextPresentationEngine.java", "author": "kriegfrj", "createdAt": "2020-07-02T23:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzMDk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzMTU4Nw==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449131587", "bodyText": "simple.bnd already has these packages as exported, so we can remove the duplicate Export annotation here.", "author": "bjhargrave", "createdAt": "2020-07-02T16:22:15Z", "path": "bndtools.core.test/src/simple/package-info.java", "diffHunk": "@@ -0,0 +1,3 @@\n+@org.osgi.annotation.bundle.Export", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzMTcwNA==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449131704", "bodyText": "simple.bnd already has these packages as exported, so we can remove the duplicate Export annotation here.", "author": "bjhargrave", "createdAt": "2020-07-02T16:22:25Z", "path": "bndtools.core.test/src/simple/pkg/package-info.java", "diffHunk": "@@ -0,0 +1,3 @@\n+@org.osgi.annotation.bundle.Export", "originalCommit": "2aafa21fa7f7d50df4c8fd30bcdaecc5bedbdb14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMxOTU3Ng==", "url": "https://github.com/bndtools/bnd/pull/4163#discussion_r449319576", "bodyText": "Fair enough, but just curious - what's best practice, to use the annotation or to mark it for export in the .bnd file?", "author": "kriegfrj", "createdAt": "2020-07-03T00:19:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzMTcwNA=="}], "type": "inlineReview"}, {"oid": "2bf5025bb82538e85d4261547d5bf7716eb66e03", "url": "https://github.com/bndtools/bnd/commit/2bf5025bb82538e85d4261547d5bf7716eb66e03", "message": "[quickfix] Integration tests for BuildpathQuickFixProcessor\n\nPorted from the old ImportPackageQuickFixProcessorTest.\n\nA number of these tests test old features that don't quite work properly in\nthe new implementation or potential features that have not yet been\nimplemented (eg, inner classes). I have left these in there, but annotated\n@Disabled so that they don't interfere with the CI output.\n\nFixes #3881.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-07-03T02:13:11Z", "type": "forcePushed"}, {"oid": "e4f30525b48c5c4265bd44c76c3202b2e185faab", "url": "https://github.com/bndtools/bnd/commit/e4f30525b48c5c4265bd44c76c3202b2e185faab", "message": "[quickfix] Integration tests for BuildpathQuickFixProcessor\n\nPorted from the old ImportPackageQuickFixProcessorTest.\n\nA number of these tests test old features that don't quite work properly in\nthe new implementation or potential features that have not yet been\nimplemented (eg, inner classes). I have left these in there, but annotated\n@Disabled so that they don't interfere with the CI output.\n\nFixes #3881.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-07-03T03:15:12Z", "type": "commit"}, {"oid": "e4f30525b48c5c4265bd44c76c3202b2e185faab", "url": "https://github.com/bndtools/bnd/commit/e4f30525b48c5c4265bd44c76c3202b2e185faab", "message": "[quickfix] Integration tests for BuildpathQuickFixProcessor\n\nPorted from the old ImportPackageQuickFixProcessorTest.\n\nA number of these tests test old features that don't quite work properly in\nthe new implementation or potential features that have not yet been\nimplemented (eg, inner classes). I have left these in there, but annotated\n@Disabled so that they don't interfere with the CI output.\n\nFixes #3881.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-07-03T03:15:12Z", "type": "forcePushed"}]}