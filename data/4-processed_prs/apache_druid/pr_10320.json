{"pr_number": 10320, "pr_title": "ExpressionFilter: Use index for expressions of single multi-value columns.", "pr_createdAt": "2020-08-25T05:13:31Z", "pr_url": "https://github.com/apache/druid/pull/10320", "timeline": [{"oid": "5560fc140759f7924933225e8b427a780eb5552b", "url": "https://github.com/apache/druid/commit/5560fc140759f7924933225e8b427a780eb5552b", "message": "ExpressionFilter: Use index for expressions of single multi-value columns.\n\nPreviously, this was disallowed, because expressions treated multi-values\nas nulls. But now, if there's a single multi-value column that can be\nmapped over, it's okay to use the index. Expression selectors already do\nthis.", "committedDate": "2020-08-25T05:12:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE5MjY2Nw==", "url": "https://github.com/apache/druid/pull/10320#discussion_r476192667", "bodyText": "\ud83d\udc4d", "author": "clintropolis", "createdAt": "2020-08-25T05:49:18Z", "path": "processing/src/main/java/org/apache/druid/segment/virtual/ExpressionSelectors.java", "diffHunk": "@@ -226,9 +226,7 @@ public static DimensionSelector makeDimensionSelector(\n       if (capabilities != null\n           && capabilities.getType() == ValueType.STRING\n           && capabilities.isDictionaryEncoded().isTrue()\n-          && !capabilities.hasMultipleValues().isUnknown()\n-          && !exprDetails.hasInputArrays()\n-          && !exprDetails.isOutputArray()\n+          && canMapOverDictionary(exprDetails, capabilities.hasMultipleValues())", "originalCommit": "5560fc140759f7924933225e8b427a780eb5552b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}