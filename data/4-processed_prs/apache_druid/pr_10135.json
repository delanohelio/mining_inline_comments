{"pr_number": 10135, "pr_title": "Fix avg sql aggregator", "pr_createdAt": "2020-07-03T19:32:19Z", "pr_url": "https://github.com/apache/druid/pull/10135", "timeline": [{"oid": "d0dac78fc7f47bc2274443d764d1d21c244d6ade", "url": "https://github.com/apache/druid/commit/d0dac78fc7f47bc2274443d764d1d21c244d6ade", "message": "new average aggregator", "committedDate": "2020-07-03T15:19:17Z", "type": "commit"}, {"oid": "32bf4188d62a7cccd3a23545c0721f5451b7be7c", "url": "https://github.com/apache/druid/commit/32bf4188d62a7cccd3a23545c0721f5451b7be7c", "message": "method to create count aggregator factory", "committedDate": "2020-07-03T15:19:25Z", "type": "commit"}, {"oid": "0a573f7e1688045cded9621b2734ef85b019b455", "url": "https://github.com/apache/druid/commit/0a573f7e1688045cded9621b2734ef85b019b455", "message": "test everything", "committedDate": "2020-07-03T15:19:35Z", "type": "commit"}, {"oid": "ccf36af7410189a455461ba7302241a48b489a2d", "url": "https://github.com/apache/druid/commit/ccf36af7410189a455461ba7302241a48b489a2d", "message": "update other usages", "committedDate": "2020-07-03T15:19:46Z", "type": "commit"}, {"oid": "b5204aa2835754e5902b7500ad1427621a0dc6a9", "url": "https://github.com/apache/druid/commit/b5204aa2835754e5902b7500ad1427621a0dc6a9", "message": "fix style", "committedDate": "2020-07-03T15:22:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTU1MA==", "url": "https://github.com/apache/druid/pull/10135#discussion_r449695550", "bodyText": "as mentioned before cnt is considered nullable now so we need these new branches to handle the change in behaviour.", "author": "damnMeddlingKid", "createdAt": "2020-07-03T20:12:23Z", "path": "sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java", "diffHunk": "@@ -6801,14 +6823,28 @@ public void testMinMaxAvgDailyCountWithLimit() throws Exception\n                         )\n                         .setInterval(querySegmentSpec(Filtration.eternity()))\n                         .setGranularity(Granularities.ALL)\n-                        .setAggregatorSpecs(aggregators(\n-                            new LongMaxAggregatorFactory(\"_a0\", \"a0\"),\n-                            new LongMinAggregatorFactory(\"_a1\", \"a0\"),\n-                            new LongSumAggregatorFactory(\"_a2:sum\", \"a0\"),\n-                            new CountAggregatorFactory(\"_a2:count\"),\n-                            new LongMaxAggregatorFactory(\"_a3\", \"d0\"),\n-                            new CountAggregatorFactory(\"_a4\")\n-                        ))\n+                        .setAggregatorSpecs(\n+                            useDefault\n+                            ? aggregators(\n+                              new LongMaxAggregatorFactory(\"_a0\", \"a0\"),\n+                              new LongMinAggregatorFactory(\"_a1\", \"a0\"),\n+                              new LongSumAggregatorFactory(\"_a2:sum\", \"a0\"),\n+                              new CountAggregatorFactory(\"_a2:count\"),\n+                              new LongMaxAggregatorFactory(\"_a3\", \"d0\"),\n+                              new CountAggregatorFactory(\"_a4\")\n+                            )\n+                            : aggregators(\n+                                new LongMaxAggregatorFactory(\"_a0\", \"a0\"),\n+                                new LongMinAggregatorFactory(\"_a1\", \"a0\"),\n+                                new LongSumAggregatorFactory(\"_a2:sum\", \"a0\"),\n+                                new FilteredAggregatorFactory(", "originalCommit": "b5204aa2835754e5902b7500ad1427621a0dc6a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2d66d5e529ec2d7a293adcbd73c8ee9857b8dbaf", "url": "https://github.com/apache/druid/commit/2d66d5e529ec2d7a293adcbd73c8ee9857b8dbaf", "message": "fix more tests", "committedDate": "2020-07-03T20:41:52Z", "type": "commit"}, {"oid": "18490a1caaebd89150161127595cf115b80ca4f1", "url": "https://github.com/apache/druid/commit/18490a1caaebd89150161127595cf115b80ca4f1", "message": "fix datasketches tests", "committedDate": "2020-07-03T21:42:11Z", "type": "commit"}, {"oid": "18490a1caaebd89150161127595cf115b80ca4f1", "url": "https://github.com/apache/druid/commit/18490a1caaebd89150161127595cf115b80ca4f1", "message": "fix datasketches tests", "committedDate": "2020-07-03T21:42:11Z", "type": "forcePushed"}]}