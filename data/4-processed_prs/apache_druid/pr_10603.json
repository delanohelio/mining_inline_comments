{"pr_number": 10603, "pr_title": "Add new coordinator metrics for coordinator duty runtimes", "pr_createdAt": "2020-11-24T22:33:55Z", "pr_url": "https://github.com/apache/druid/pull/10603", "timeline": [{"oid": "07af4ef5511570b1bbfd7f0a73b2e6f3d4590ee9", "url": "https://github.com/apache/druid/commit/07af4ef5511570b1bbfd7f0a73b2e6f3d4590ee9", "message": "Add new coordinator metrics for duty runtimes", "committedDate": "2020-11-24T22:24:01Z", "type": "commit"}, {"oid": "af55290ca6e8b7d1adcbb7cd8c75a4ddab87d4b6", "url": "https://github.com/apache/druid/commit/af55290ca6e8b7d1adcbb7cd8c75a4ddab87d4b6", "message": "fix spelling for a constant variable value", "committedDate": "2020-11-24T22:32:21Z", "type": "commit"}, {"oid": "15525fbab893b4438fbaedd3663724c71ff720d9", "url": "https://github.com/apache/druid/commit/15525fbab893b4438fbaedd3663724c71ff720d9", "message": "add comment clarifying why the global runtime metric is emitted where it is", "committedDate": "2020-11-24T22:54:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAzNjg4Mw==", "url": "https://github.com/apache/druid/pull/10603#discussion_r530036883", "bodyText": "will it be ok to just use \"duty.getClass().getName()\" for this use case instead of extending the interface?", "author": "himanshug", "createdAt": "2020-11-25T00:47:24Z", "path": "server/src/main/java/org/apache/druid/server/coordinator/DruidCoordinator.java", "diffHunk": "@@ -801,14 +811,24 @@ public void run()\n               && coordLeaderSelector.isLeader()\n               && startingLeaderCounter == coordLeaderSelector.localTerm()) {\n \n+            final long start = System.nanoTime();\n             params = duty.run(params);\n+            final long end = System.nanoTime();\n \n             if (params == null) {\n               // This duty wanted to cancel the run. No log message, since the duty should have logged a reason.\n               return;\n+            } else {\n+              params.getCoordinatorStats().addToDutyStat(\"runtime\", duty.getDutyAlias(), TimeUnit.NANOSECONDS.toMillis(end - start));", "originalCommit": "15525fbab893b4438fbaedd3663724c71ff720d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA0NjU4NQ==", "url": "https://github.com/apache/druid/pull/10603#discussion_r530046585", "bodyText": "ya, I realized that would probably have been better after I looked at what I ended up with for alias values", "author": "capistrant", "createdAt": "2020-11-25T01:19:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAzNjg4Mw=="}], "type": "inlineReview"}, {"oid": "d815f8aea06f30bd17b2698b1b64ac23a38b583a", "url": "https://github.com/apache/druid/commit/d815f8aea06f30bd17b2698b1b64ac23a38b583a", "message": "Remove duty alias in lieu of using the class name for metrics", "committedDate": "2020-11-25T01:33:06Z", "type": "commit"}, {"oid": "ff08d495ca1095fbacada7cde98bfa15e016403a", "url": "https://github.com/apache/druid/commit/ff08d495ca1095fbacada7cde98bfa15e016403a", "message": "fix docs", "committedDate": "2020-11-25T13:18:45Z", "type": "commit"}, {"oid": "ecf99fbe3fce6584d93cc0103163c9f09c828c41", "url": "https://github.com/apache/druid/commit/ecf99fbe3fce6584d93cc0103163c9f09c828c41", "message": "CoordinatorStats tests + add duty stats to accumulate() logic", "committedDate": "2020-11-25T16:08:16Z", "type": "commit"}]}