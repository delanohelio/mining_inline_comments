{"pr_number": 9560, "pr_title": "Instructions to run integration tests against quickstart", "pr_createdAt": "2020-03-25T03:09:35Z", "pr_url": "https://github.com/apache/druid/pull/9560", "timeline": [{"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "url": "https://github.com/apache/druid/commit/fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "message": "Instructions to run integration tests against quickstart", "committedDate": "2020-03-25T03:08:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MTY0MA==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398071640", "bodyText": "How about linking against the quickstart docs so that folks know what is meant by a \"quickstart cluster\"?", "author": "ccaominh", "createdAt": "2020-03-25T18:17:54Z", "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development", "originalCommit": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE4NjQ3MQ==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398186471", "bodyText": "Done", "author": "suneet-s", "createdAt": "2020-03-25T21:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MTY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjE0Ng==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398072146", "bodyText": "Suggestion: Add : at the end\n(similar comment for other occurrences below)", "author": "ccaominh", "createdAt": "2020-03-25T18:18:41Z", "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may\n+not make sense to run the entire test suite against this configuration.\n+\n+Make sure you have at least 6GB of memory available before you run the tests.\n+\n+The tests rely on files in the test/resources folder to exist under the path /resources,\n+so create a symlink to make them available", "originalCommit": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzI2Ng==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398073266", "bodyText": "Having to create a new directory as a child of root seems strange. Is there a way to make it local to the druid repo directory?", "author": "ccaominh", "createdAt": "2020-03-25T18:20:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjE0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE4ODIwMA==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398188200", "bodyText": "Done", "author": "suneet-s", "createdAt": "2020-03-25T21:42:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjE0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzkyMA==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398073920", "bodyText": "Suggestion: Add . at the end", "author": "ccaominh", "createdAt": "2020-03-25T18:21:19Z", "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may\n+not make sense to run the entire test suite against this configuration.\n+\n+Make sure you have at least 6GB of memory available before you run the tests.\n+\n+The tests rely on files in the test/resources folder to exist under the path /resources,\n+so create a symlink to make them available\n+\n+```\n+  ln -s ${DRUID_HOME}/integration-tests/src/test/resources /resources\n+```\n+\n+Set the cluster config file environment variable to the quickstart config\n+```\n+  export CONFIG_FILE=${DRUID_HOME}/integration-tests/quickstart-it.json\n+```\n+Note that quickstart does not run with ssl, so to trick the integration tests\n+we specify the `*_tls_url` in the config to be the same as the http url", "originalCommit": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE4ODI1Ng==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398188256", "bodyText": "Done", "author": "suneet-s", "createdAt": "2020-03-25T21:42:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MjI0Mg==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398082242", "bodyText": "@maytasm3 I was worried about what you mentioned as a top level comment on this PR too. I tried to talk about it here, but maybe the warning is not big and scary enough. Any suggestions on how to make it more prominent? Also I wonder if I should point to the docker setup scripts for the next person who might find a test that fails when run against quickstart.", "author": "suneet-s", "createdAt": "2020-03-25T18:34:22Z", "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may", "originalCommit": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4NTQ4OQ==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398085489", "bodyText": "Other places in the docs use a blockquote like: https://druid.apache.org/docs/latest/querying/lookups.html", "author": "ccaominh", "createdAt": "2020-03-25T18:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MjI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4OTA2NA==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398089064", "bodyText": "I feel the term \"feature\" might be a little misleading. Some of the setup on the docker cluster are just pre-inserted data into the metadata store or certain files place at certain locations. The feature itself like pulling segments from pathSpec in metadatastore is always there. I think as we add more and more IT and/or setup scripts, it will also be hard to knows which can work out of the box on quickstart vs. which can only work on docker cluster. I think it might help if we can list out which groups can work out of the box on quickstart vs. which can only work on docker cluster in the README. In the file with the group definition (TestNGGroup) we can then list out special setup needed (if needed) for those groups.", "author": "maytasm", "createdAt": "2020-03-25T18:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MjI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE5Njk2OA==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398196968", "bodyText": "\ud83d\udc4d Added a note on the setup, but it's kinda hard to know which groups depend on what right now, maybe after using this for a few months the test group will be more complete. I added instructions to this file and the group so that other devs can add more tests to this list.", "author": "suneet-s", "createdAt": "2020-03-25T22:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MjI0Mg=="}], "type": "inlineReview"}, {"oid": "d9b01561d7a7aa81eeef0e0d9186eaa9a8339d2b", "url": "https://github.com/apache/druid/commit/d9b01561d7a7aa81eeef0e0d9186eaa9a8339d2b", "message": "Merge remote-tracking branch 'upstream/master' into quickstart-it", "committedDate": "2020-03-25T21:32:40Z", "type": "commit"}, {"oid": "912762cd48d5f7a45a7d0de1eded35e120b1bccb", "url": "https://github.com/apache/druid/commit/912762cd48d5f7a45a7d0de1eded35e120b1bccb", "message": "Address review comments", "committedDate": "2020-03-25T22:10:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMjUyMA==", "url": "https://github.com/apache/druid/pull/9560#discussion_r398202520", "bodyText": "If you push another commit, there's a small typo here: group os -> group is", "author": "ccaominh", "createdAt": "2020-03-25T22:13:34Z", "path": "integration-tests/src/test/java/org/apache/druid/tests/TestNGGroup.java", "diffHunk": "@@ -33,29 +33,57 @@\n   // This group can only be run individually using -Dgroups=query since it requires specific test data setup.\n   public static final String QUERY = \"query\";\n   public static final String REALTIME_INDEX = \"realtime-index\";\n-  // This group can only be run individually using -Dgroups=security since it requires specific test data setup.\n+\n+  /**\n+   * This group can only be run individually using -Dgroups=security since it requires specific test data setup.\n+   */\n   public static final String SECURITY = \"security\";\n-  // This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+\n+  /**\n+   * This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+   */\n   public static final String S3_DEEP_STORAGE = \"s3-deep-storage\";\n-  // This group is not part of CI. To run this group, gcs configs/credentials for your gcs must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/gcs for env vars to provide.\n-  // The path to the folder that contains your GOOGLE_APPLICATION_CREDENTIALS file must also be pass\n-  // to mvn with -Dresource.file.dir.path=<PATH_TO_FOLDER>\n+\n+  /**\n+   * This group is not part of CI. To run this group, gcs configs/credentials for your gcs must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/gcs for env vars to provide.\n+   * The path to the folder that contains your GOOGLE_APPLICATION_CREDENTIALS file must also be pass\n+   * to mvn with -Dresource.file.dir.path=<PATH_TO_FOLDER>\n+   */\n   public static final String GCS_DEEP_STORAGE = \"gcs-deep-storage\";\n-  // This group is not part of CI. To run this group, azure configs/credentials for your azure must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/azures for env vars to provide.\n+\n+  /**\n+   * This group is not part of CI. To run this group, azure configs/credentials for your azure must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/azures for env vars to provide.\n+   */\n   public static final String AZURE_DEEP_STORAGE = \"azure-deep-storage\";\n-  // This group is not part of CI. To run this group, hadoop configs must be provided in a file. The path of the file\n-  // must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/hdfs for env vars to provide.\n-  // Additionally, hadoop docker must be started by passing -Dstart.hadoop.docker=true to mvn.\n+\n+  /**\n+   * This group is not part of CI. To run this group, hadoop configs must be provided in a file. The path of the file\n+   * must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/hdfs for env vars to provide.\n+   * Additionally, hadoop docker must be started by passing -Dstart.hadoop.docker=true to mvn.\n+   */\n   public static final String HDFS_DEEP_STORAGE = \"hdfs-deep-storage\";\n-  // This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+\n+  /**\n+   * This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+   */\n   public static final String S3_INGESTION = \"s3-ingestion\";\n+\n+  /**\n+   * This group os not part of CI explicitly. It allows you to run all the tests that have been tested with", "originalCommit": "912762cd48d5f7a45a7d0de1eded35e120b1bccb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "66f366409ee2e51af1ec0285276309bb6acc15c4", "url": "https://github.com/apache/druid/commit/66f366409ee2e51af1ec0285276309bb6acc15c4", "message": "actually exclude the test group", "committedDate": "2020-03-25T22:17:17Z", "type": "commit"}, {"oid": "73bc428dcfc814de3d477b2112455ad839024e53", "url": "https://github.com/apache/druid/commit/73bc428dcfc814de3d477b2112455ad839024e53", "message": "Revert \"actually exclude the test group\"\n\nThis reverts commit 66f366409ee2e51af1ec0285276309bb6acc15c4.", "committedDate": "2020-03-26T04:20:27Z", "type": "commit"}, {"oid": "298a4d2f8a5b6478d63bbb9d8fb7cd5a0bb96c18", "url": "https://github.com/apache/druid/commit/298a4d2f8a5b6478d63bbb9d8fb7cd5a0bb96c18", "message": "update comment", "committedDate": "2020-03-26T04:22:12Z", "type": "commit"}]}