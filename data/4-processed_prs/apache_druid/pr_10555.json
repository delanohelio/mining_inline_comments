{"pr_number": 10555, "pr_title": "Fix : Druid throws java.util.concurrent.RejectedExecutionException when ingest task is stopping.", "pr_createdAt": "2020-11-04T07:07:45Z", "pr_url": "https://github.com/apache/druid/pull/10555", "timeline": [{"oid": "46c94bd2daeb3e4700814cb89e44212c0d62ffdd", "url": "https://github.com/apache/druid/commit/46c94bd2daeb3e4700814cb89e44212c0d62ffdd", "message": "check exec status before return Signal", "committedDate": "2020-11-04T06:43:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2OTE2OQ==", "url": "https://github.com/apache/druid/pull/10555#discussion_r517169169", "bodyText": "please add a log line here. It will be hard to debug if someone wrongly shuts down the exec.", "author": "nishantmonu51", "createdAt": "2020-11-04T08:27:20Z", "path": "core/src/main/java/org/apache/druid/java/util/common/concurrent/ScheduledExecutors.java", "diffHunk": "@@ -53,7 +53,11 @@ public static void scheduleWithFixedDelay(\n           public Signal call()\n           {\n             runnable.run(); // (Exceptions are handled for us)\n-            return Signal.REPEAT;\n+            if (exec.isShutdown()) {\n+              return Signal.STOP;", "originalCommit": "46c94bd2daeb3e4700814cb89e44212c0d62ffdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIyODM3Mg==", "url": "https://github.com/apache/druid/pull/10555#discussion_r517228372", "bodyText": "Done. Thanks for reviewing!", "author": "zhangyue19921010", "createdAt": "2020-11-04T10:04:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2OTE2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE5MjI4Ng==", "url": "https://github.com/apache/druid/pull/10555#discussion_r521192286", "bodyText": "@nishantmonu51 Hi nishantmonu51, sorry to bother you. I have tested this change in our Druid cluster. What should I do next ?", "author": "zhangyue19921010", "createdAt": "2020-11-11T08:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2OTE2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyMTIyNw==", "url": "https://github.com/apache/druid/pull/10555#discussion_r528021227", "bodyText": "nit: I would make that a log.warn(..) because debug would hardly be enabled and this log is not gonna pollute the logs, but looks good otherwise.\nthanks.", "author": "himanshug", "createdAt": "2020-11-20T23:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2OTE2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ0ODIxOQ==", "url": "https://github.com/apache/druid/pull/10555#discussion_r528448219", "bodyText": "@himanshug Thanks for your review. I have changed the log level to WARN.", "author": "zhangyue19921010", "createdAt": "2020-11-23T02:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2OTE2OQ=="}], "type": "inlineReview"}, {"oid": "918447443146965658d5522990fc4816c5683f4c", "url": "https://github.com/apache/druid/commit/918447443146965658d5522990fc4816c5683f4c", "message": "add more log", "committedDate": "2020-11-04T08:58:18Z", "type": "commit"}, {"oid": "9d3aec58281804241464101bccf3c0c06111979d", "url": "https://github.com/apache/druid/commit/9d3aec58281804241464101bccf3c0c06111979d", "message": "change log level to debug and add UT", "committedDate": "2020-11-04T13:26:32Z", "type": "commit"}, {"oid": "93a590fb4afa4c85d715681e990200b2a1a8a28e", "url": "https://github.com/apache/druid/commit/93a590fb4afa4c85d715681e990200b2a1a8a28e", "message": "Merge branch 'master' into fix-ScheduledExecutors-submit-bug", "committedDate": "2020-11-23T01:57:51Z", "type": "commit"}, {"oid": "753ec6f8a9e948da6d1a5d667294b21639c724fe", "url": "https://github.com/apache/druid/commit/753ec6f8a9e948da6d1a5d667294b21639c724fe", "message": "change log leverl to warn and merge master", "committedDate": "2020-11-23T01:59:45Z", "type": "commit"}]}