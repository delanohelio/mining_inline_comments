{"pr_number": 9891, "pr_title": "Fix deleting a data node tier causes load rules to display incorrectly", "pr_createdAt": "2020-05-19T02:14:32Z", "pr_url": "https://github.com/apache/druid/pull/9891", "timeline": [{"oid": "a13f3199db34a0f777b4045733878b12651b9734", "url": "https://github.com/apache/druid/commit/a13f3199db34a0f777b4045733878b12651b9734", "message": "Fix Deleting a data node tier causes load rules to malfunction & display incorrectly", "committedDate": "2020-05-19T02:07:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2NTk5Nw==", "url": "https://github.com/apache/druid/pull/9891#discussion_r427465997", "bodyText": "Can you add a test for this in rule-editor.spec.tsx?", "author": "ccaominh", "createdAt": "2020-05-19T17:14:36Z", "path": "web-console/src/components/rule-editor/rule-editor.tsx", "diffHunk": "@@ -102,8 +102,11 @@ export const RuleEditor = React.memo(function RuleEditor(props: RuleEditorProps)\n               onChange(RuleUtil.renameTieredReplicants(rule, tier, e.target.value))\n             }\n           >\n+            <option key={tier} value={tier}>\n+              {tier}\n+            </option>\n             {tiers\n-              .filter(t => t === tier || !tieredReplicants[t])\n+              .filter(t => t !== tier && !tieredReplicants[t])", "originalCommit": "a13f3199db34a0f777b4045733878b12651b9734", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNjU3Mw==", "url": "https://github.com/apache/druid/pull/9891#discussion_r427716573", "bodyText": "Done", "author": "maytasm", "createdAt": "2020-05-20T03:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2NTk5Nw=="}], "type": "inlineReview"}, {"oid": "4ef33d01d8fe13bc250f1c73ecaf45bf8ebe46a4", "url": "https://github.com/apache/druid/commit/4ef33d01d8fe13bc250f1c73ecaf45bf8ebe46a4", "message": "add tests", "committedDate": "2020-05-20T03:09:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE1NzgwMw==", "url": "https://github.com/apache/druid/pull/9891#discussion_r428157803", "bodyText": "CI is flagging the extra indentation for this test\nhttps://travis-ci.org/github/apache/druid/jobs/689087087#L411", "author": "ccaominh", "createdAt": "2020-05-20T16:43:05Z", "path": "web-console/src/components/rule-editor/rule-editor.spec.tsx", "diffHunk": "@@ -36,4 +36,64 @@ describe('rule editor', () => {\n     const { container } = render(ruleEditor);\n     expect(container.firstChild).toMatchSnapshot();\n   });\n+\n+  it('matches snapshot with non existing tier in rule', () => {\n+    const ruleEditor = (\n+      <RuleEditor\n+        rule={{\n+          type: 'loadByInterval',\n+          period: '2010-01-01/2015-01-01',\n+          tieredReplicants: { nonexist: 2 },\n+        }}\n+        tiers={['test1', 'test2', 'test3']}\n+        onChange={() => {}}\n+        onDelete={() => {}}\n+        moveUp={null}\n+        moveDown={null}\n+      />\n+    );\n+    const { container } = render(ruleEditor);\n+    expect(container.firstChild).toMatchSnapshot();\n+  });\n+\n+  it('matches snapshot with existing tier in rule', () => {\n+    const ruleEditor = (\n+      <RuleEditor\n+        rule={{\n+          type: 'loadByInterval',\n+          period: '2010-01-01/2015-01-01',\n+          tieredReplicants: { test1: 2 },\n+        }}\n+        tiers={['test1', 'test2', 'test3']}\n+        onChange={() => {}}\n+        onDelete={() => {}}\n+        moveUp={null}\n+        moveDown={null}\n+      />\n+    );\n+    const { container } = render(ruleEditor);\n+    expect(container.firstChild).toMatchSnapshot();\n+  });\n+\n+    it('matches snapshot with existing tier and non existing tier in rule', () => {\n+      const ruleEditor = (\n+        <RuleEditor\n+          rule={{\n+            type: 'loadByInterval',\n+            period: '2010-01-01/2015-01-01',\n+            tieredReplicants: {\n+              test1: 2,\n+              nonexist: 1,\n+            },\n+          }}\n+          tiers={['test1', 'test2', 'test3']}\n+          onChange={() => {}}\n+          onDelete={() => {}}\n+          moveUp={null}\n+          moveDown={null}\n+        />\n+      );\n+      const { container } = render(ruleEditor);\n+      expect(container.firstChild).toMatchSnapshot();\n+    });", "originalCommit": "4ef33d01d8fe13bc250f1c73ecaf45bf8ebe46a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMzNjI2MQ==", "url": "https://github.com/apache/druid/pull/9891#discussion_r428336261", "bodyText": "Done", "author": "maytasm", "createdAt": "2020-05-20T22:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE1NzgwMw=="}], "type": "inlineReview"}, {"oid": "fcad92d74afa23c4e22f67252d3f5ed172e9179d", "url": "https://github.com/apache/druid/commit/fcad92d74afa23c4e22f67252d3f5ed172e9179d", "message": "fix style", "committedDate": "2020-05-20T22:09:26Z", "type": "commit"}]}