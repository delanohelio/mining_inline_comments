{"pr_number": 10093, "pr_title": "Add groupBy limitSpec to queryCache key", "pr_createdAt": "2020-06-29T12:04:25Z", "pr_url": "https://github.com/apache/druid/pull/10093", "timeline": [{"oid": "8e47a076128b04024cc3e9cb0aa8529829dc5785", "url": "https://github.com/apache/druid/commit/8e47a076128b04024cc3e9cb0aa8529829dc5785", "message": "Add groupBy limitSpec to queryCache key", "committedDate": "2020-06-29T09:59:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzNzI0NQ==", "url": "https://github.com/apache/druid/pull/10093#discussion_r447137245", "bodyText": "Does this also need to consider the havingSpec similar to the ResultLevelCacheKey below?", "author": "suneet-s", "createdAt": "2020-06-29T17:32:06Z", "path": "processing/src/main/java/org/apache/druid/query/groupby/GroupByQueryQueryToolChest.java", "diffHunk": "@@ -524,6 +524,7 @@ public boolean isCacheable(GroupByQuery query, boolean willMergeRunners)\n             .appendCacheables(query.getAggregatorSpecs())\n             .appendCacheables(query.getDimensions())\n             .appendCacheable(query.getVirtualColumns())\n+            .appendCacheable(query.getLimitSpec())", "originalCommit": "8e47a076128b04024cc3e9cb0aa8529829dc5785", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwNjcxMQ==", "url": "https://github.com/apache/druid/pull/10093#discussion_r450006711", "bodyText": "havingSpec is used in post-processing step only, so it should not be required here", "author": "nishantmonu51", "createdAt": "2020-07-06T06:24:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzNzI0NQ=="}], "type": "inlineReview"}, {"oid": "54c0aee0a98574002dd2b5f8281cc48e623b33af", "url": "https://github.com/apache/druid/commit/54c0aee0a98574002dd2b5f8281cc48e623b33af", "message": "Only add limitSpec to cache key if pushdown is set to true", "committedDate": "2020-07-07T07:58:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzOTgwNg==", "url": "https://github.com/apache/druid/pull/10093#discussion_r451039806", "bodyText": "Would you please add another query which has the same spec and CTX_KEY_APPLY_LIMIT_PUSH_DOWN of true in the context, and check the equality of the cache key of the query and query1?", "author": "jihoonson", "createdAt": "2020-07-07T17:48:33Z", "path": "processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryQueryToolChestTest.java", "diffHunk": "@@ -929,6 +930,64 @@ private void doTestCacheStrategy(final ValueType valueType, final Object dimValu\n     Assert.assertEquals(typeAdjustedResult2, fromResultCacheResult);\n   }\n \n+  @Test\n+  public void testQueryCacheKeyWithLimitSpec()\n+  {\n+    final GroupByQuery query1 = GroupByQuery", "originalCommit": "54c0aee0a98574002dd2b5f8281cc48e623b33af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM4NTA5Ng==", "url": "https://github.com/apache/druid/pull/10093#discussion_r452385096", "bodyText": "Oh sorry, I forgot to approve this PR. This comment is not a blocker if you want to do in a follow-up.", "author": "jihoonson", "createdAt": "2020-07-09T17:42:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzOTgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY0MDI4Ng==", "url": "https://github.com/apache/druid/pull/10093#discussion_r453640286", "bodyText": "added test for this.", "author": "nishantmonu51", "createdAt": "2020-07-13T13:15:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzOTgwNg=="}], "type": "inlineReview"}, {"oid": "aee4572cdf63913a38fe7656a43b9cfed77aa475", "url": "https://github.com/apache/druid/commit/aee4572cdf63913a38fe7656a43b9cfed77aa475", "message": "review comment", "committedDate": "2020-07-13T13:14:38Z", "type": "commit"}]}