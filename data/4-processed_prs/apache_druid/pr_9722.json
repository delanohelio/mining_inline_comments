{"pr_number": 9722, "pr_title": "Optimize FileWriteOutBytes to avoid high system cpu usage", "pr_createdAt": "2020-04-18T05:43:50Z", "pr_url": "https://github.com/apache/druid/pull/9722", "timeline": [{"oid": "c33551d11a0e9ee5cdb4dcbb2f02e0d3ccc864cf", "url": "https://github.com/apache/druid/commit/c33551d11a0e9ee5cdb4dcbb2f02e0d3ccc864cf", "message": "optimize FileWriteOutBytes to avoid high sys cpu", "committedDate": "2020-04-18T05:32:07Z", "type": "commit"}, {"oid": "149e08c091d06cae25b5d2ba375ae3a846c605b2", "url": "https://github.com/apache/druid/commit/149e08c091d06cae25b5d2ba375ae3a846c605b2", "message": "optimize FileWriteOutBytes to avoid high sys cpu -- remove IOException", "committedDate": "2020-04-18T06:56:56Z", "type": "commit"}, {"oid": "965f74214820fb8768aea549a0498ef376f02cc8", "url": "https://github.com/apache/druid/commit/965f74214820fb8768aea549a0498ef376f02cc8", "message": "optimize FileWriteOutBytes to avoid high sys cpu -- remove IOException in writeOutBytes.size", "committedDate": "2020-04-18T13:23:29Z", "type": "commit"}, {"oid": "2abef0304950bc621842395aa8d7ff84cf4a3b83", "url": "https://github.com/apache/druid/commit/2abef0304950bc621842395aa8d7ff84cf4a3b83", "message": "Revert \"optimize FileWriteOutBytes to avoid high sys cpu -- remove IOException in writeOutBytes.size\"\n\nThis reverts commit 965f7421", "committedDate": "2020-04-18T15:43:54Z", "type": "commit"}, {"oid": "e9157029efd4145bf713882ce7e5244a250dc1e8", "url": "https://github.com/apache/druid/commit/e9157029efd4145bf713882ce7e5244a250dc1e8", "message": "Revert \"optimize FileWriteOutBytes to avoid high sys cpu -- remove IOException\"\n\nThis reverts commit 149e08c0", "committedDate": "2020-04-18T15:44:17Z", "type": "commit"}, {"oid": "a610003437bf476aafad7f45b6f04700cb3b6dca", "url": "https://github.com/apache/druid/commit/a610003437bf476aafad7f45b6f04700cb3b6dca", "message": "optimize FileWriteOutBytes to avoid high sys cpu -- avoid IOEception never thrown check", "committedDate": "2020-04-18T16:16:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMjg1NQ==", "url": "https://github.com/apache/druid/pull/9722#discussion_r412402855", "bodyText": "I think this is cleaner\n  public long size()\n  {\n    return writeOutBytes;\n  }", "author": "suneet-s", "createdAt": "2020-04-21T18:43:35Z", "path": "processing/src/main/java/org/apache/druid/segment/writeout/FileWriteOutBytes.java", "diffHunk": "@@ -105,8 +110,8 @@ public void write(byte[] b, int off, int len) throws IOException\n   @Override\n   public long size() throws IOException\n   {\n-    flush();\n-    return ch.size();\n+    flushIfNeeded(0); // To avoid check the declared IOException never thrown error", "originalCommit": "a610003437bf476aafad7f45b6f04700cb3b6dca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYzOTQ4NQ==", "url": "https://github.com/apache/druid/pull/9722#discussion_r412639485", "bodyText": "Thanks for point out that. I added this line of code on purpose, or The declared exception <code>IOException</code> is never thrown error will block ci. And I attempt to remove throws IOException from method signature, but new error occurs! Do you have any suggestions?", "author": "viongpanzi", "createdAt": "2020-04-22T03:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMjg1NQ=="}], "type": "inlineReview"}, {"oid": "93dadcf927c6df341058d4c49ba5a331f4266bf0", "url": "https://github.com/apache/druid/commit/93dadcf927c6df341058d4c49ba5a331f4266bf0", "message": "Merge remote-tracking branch 'upstream/master' into pr_9722", "committedDate": "2020-04-21T20:18:12Z", "type": "commit"}, {"oid": "69954723bddf223ae1eddb5387de10bcd88b8e7a", "url": "https://github.com/apache/druid/commit/69954723bddf223ae1eddb5387de10bcd88b8e7a", "message": "Fix size counting to handle IOE in FileWriteOutBytes + tests", "committedDate": "2020-04-21T21:38:47Z", "type": "commit"}, {"oid": "73c9572731aa0e0bb2434654406bc67d0d2fe5e6", "url": "https://github.com/apache/druid/commit/73c9572731aa0e0bb2434654406bc67d0d2fe5e6", "message": "Merge remote-tracking branch 'upstream/master' into feature-optimize-file-write-out\n\npull FileWriteOutBytesTest from upstream", "committedDate": "2020-04-22T03:56:55Z", "type": "commit"}, {"oid": "cf81212b0248384d8a8a38c72e03eaed98f68199", "url": "https://github.com/apache/druid/commit/cf81212b0248384d8a8a38c72e03eaed98f68199", "message": "Merge branch 'pr_9741' into feature-optimize-file-write-out\n\nmerge tests from pr_9741", "committedDate": "2020-04-22T06:14:20Z", "type": "commit"}, {"oid": "290973536d2566e5e2ecc62507940e7dfc2bf3f5", "url": "https://github.com/apache/druid/commit/290973536d2566e5e2ecc62507940e7dfc2bf3f5", "message": "remove unused throws IOException in WriteOutBytes.size()", "committedDate": "2020-04-22T16:22:12Z", "type": "commit"}, {"oid": "2f6602aaf1660d4d9036d11e410f5879fa078457", "url": "https://github.com/apache/druid/commit/2f6602aaf1660d4d9036d11e410f5879fa078457", "message": "Merge remote-tracking branch 'upstream/master' into feature-optimize-file-write-out", "committedDate": "2020-04-22T16:36:08Z", "type": "commit"}, {"oid": "e7876c7bb3897b3565d7d6869f80e0383d08cd23", "url": "https://github.com/apache/druid/commit/e7876c7bb3897b3565d7d6869f80e0383d08cd23", "message": "Remove redundant throws IOExcpetion clauses", "committedDate": "2020-04-22T20:56:52Z", "type": "commit"}, {"oid": "b50f6315cf4c44d8035cf3971790786e5f1b7652", "url": "https://github.com/apache/druid/commit/b50f6315cf4c44d8035cf3971790786e5f1b7652", "message": "Parameterize IndexMergeBenchmark", "committedDate": "2020-04-23T00:55:10Z", "type": "commit"}]}