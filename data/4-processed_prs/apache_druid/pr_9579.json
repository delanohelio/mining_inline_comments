{"pr_number": 9579, "pr_title": "Add Apache Ranger Authorization", "pr_createdAt": "2020-03-28T12:37:56Z", "pr_url": "https://github.com/apache/druid/pull/9579", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3MjYxNQ==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399772615", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final Logger LOG = new Logger(RangerAuthorizer.class);\n          \n          \n            \n              private static final Logger log = new Logger(RangerAuthorizer.class);", "author": "Fokko", "createdAt": "2020-03-29T09:46:41Z", "path": "extensions-core/druid-ranger-security/src/main/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizer.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import org.apache.druid.java.util.common.IAE;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.security.Access;\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Authorizer;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.ranger.plugin.audit.RangerDefaultAuditHandler;\n+import org.apache.ranger.plugin.policyengine.RangerAccessRequestImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResourceImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResult;\n+import org.apache.ranger.plugin.service.RangerBasePlugin;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+@JsonTypeName(\"ranger\")\n+public class RangerAuthorizer implements Authorizer\n+{\n+  private static final Logger LOG = new Logger(RangerAuthorizer.class);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3MjY4NQ==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399772685", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOG.warn(\"Hadoop config \" + hadoopConfig + \" not found\");\n          \n          \n            \n                    LOG.warn(\"Hadoop config %s not found\", hadoopConfig);", "author": "Fokko", "createdAt": "2020-03-29T09:47:23Z", "path": "extensions-core/druid-ranger-security/src/main/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizer.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import org.apache.druid.java.util.common.IAE;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.security.Access;\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Authorizer;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.ranger.plugin.audit.RangerDefaultAuditHandler;\n+import org.apache.ranger.plugin.policyengine.RangerAccessRequestImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResourceImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResult;\n+import org.apache.ranger.plugin.service.RangerBasePlugin;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+@JsonTypeName(\"ranger\")\n+public class RangerAuthorizer implements Authorizer\n+{\n+  private static final Logger LOG = new Logger(RangerAuthorizer.class);\n+\n+  public static final String RANGER_DRUID_SERVICETYPE = \"druid\";\n+  public static final String RANGER_DRUID_APPID = \"druid\";\n+\n+  public static final String RANGER_DRUID_DEFAULT_HADOOP_CONF = \"druid-ranger-site.xml\";\n+\n+  private RangerBasePlugin rangerPlugin;\n+  private boolean useUgi;\n+\n+  @JsonCreator\n+  public RangerAuthorizer(\n+      @JsonProperty(\"keytab\") String keytab,\n+      @JsonProperty(\"principal\") String principal,\n+      @JsonProperty(\"use_ugi\") boolean useUgi,\n+      @JsonProperty(\"hadoop_config\") String hadoopConfig)\n+  {\n+    Configuration configuration = new Configuration();\n+\n+    this.useUgi = useUgi;\n+\n+    if (hadoopConfig != null) {\n+      URL url = configuration.getResource(hadoopConfig);\n+      if (url == null) {\n+        LOG.warn(\"Hadoop config \" + hadoopConfig + \" not found\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3Mjc3NA==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399772774", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOG.debug(\"Trying to load Hadoop config from \" + url + \" (can be null)\");\n          \n          \n            \n                    LOG.debug(\"Trying to load Hadoop config from %s (can be null) from %s\", url, RANGER_DRUID_DEFAULT_HADOOP_CONF);", "author": "Fokko", "createdAt": "2020-03-29T09:48:09Z", "path": "extensions-core/druid-ranger-security/src/main/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizer.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import org.apache.druid.java.util.common.IAE;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.security.Access;\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Authorizer;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.ranger.plugin.audit.RangerDefaultAuditHandler;\n+import org.apache.ranger.plugin.policyengine.RangerAccessRequestImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResourceImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResult;\n+import org.apache.ranger.plugin.service.RangerBasePlugin;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+@JsonTypeName(\"ranger\")\n+public class RangerAuthorizer implements Authorizer\n+{\n+  private static final Logger LOG = new Logger(RangerAuthorizer.class);\n+\n+  public static final String RANGER_DRUID_SERVICETYPE = \"druid\";\n+  public static final String RANGER_DRUID_APPID = \"druid\";\n+\n+  public static final String RANGER_DRUID_DEFAULT_HADOOP_CONF = \"druid-ranger-site.xml\";\n+\n+  private RangerBasePlugin rangerPlugin;\n+  private boolean useUgi;\n+\n+  @JsonCreator\n+  public RangerAuthorizer(\n+      @JsonProperty(\"keytab\") String keytab,\n+      @JsonProperty(\"principal\") String principal,\n+      @JsonProperty(\"use_ugi\") boolean useUgi,\n+      @JsonProperty(\"hadoop_config\") String hadoopConfig)\n+  {\n+    Configuration configuration = new Configuration();\n+\n+    this.useUgi = useUgi;\n+\n+    if (hadoopConfig != null) {\n+      URL url = configuration.getResource(hadoopConfig);\n+      if (url == null) {\n+        LOG.warn(\"Hadoop config \" + hadoopConfig + \" not found\");\n+      } else {\n+        configuration.addResource(url);\n+      }\n+    } else {\n+      URL url = configuration.getResource(RANGER_DRUID_DEFAULT_HADOOP_CONF);\n+      if (LOG.isDebugEnabled()) {\n+        LOG.debug(\"Trying to load Hadoop config from \" + url + \" (can be null)\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3MjkzOA==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399772938", "bodyText": "I would structure it a bit differently:\nfinal URL url;\nif (hadoopConfig != null) {\n  url = configuration.getResource(hadoopConfig);\n  if (url == null) {\n    LOG.warn(\"Hadoop config %s not found\", hadoopConfig);\n  }\n} else {\n  url = configuration.getResource(RANGER_DRUID_DEFAULT_HADOOP_CONF);\n  if (LOG.isDebugEnabled()) {\n    LOG.debug(\"Trying to load Hadoop config from %s (can be null) from %s\", url, RANGER_DRUID_DEFAULT_HADOOP_CONF);\n  }\n}\nif (url != null) {\n  configuration.addResource(url);\n}", "author": "Fokko", "createdAt": "2020-03-29T09:49:31Z", "path": "extensions-core/druid-ranger-security/src/main/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizer.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import org.apache.druid.java.util.common.IAE;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.security.Access;\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Authorizer;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.ranger.plugin.audit.RangerDefaultAuditHandler;\n+import org.apache.ranger.plugin.policyengine.RangerAccessRequestImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResourceImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResult;\n+import org.apache.ranger.plugin.service.RangerBasePlugin;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+@JsonTypeName(\"ranger\")\n+public class RangerAuthorizer implements Authorizer\n+{\n+  private static final Logger LOG = new Logger(RangerAuthorizer.class);\n+\n+  public static final String RANGER_DRUID_SERVICETYPE = \"druid\";\n+  public static final String RANGER_DRUID_APPID = \"druid\";\n+\n+  public static final String RANGER_DRUID_DEFAULT_HADOOP_CONF = \"druid-ranger-site.xml\";\n+\n+  private RangerBasePlugin rangerPlugin;\n+  private boolean useUgi;\n+\n+  @JsonCreator\n+  public RangerAuthorizer(\n+      @JsonProperty(\"keytab\") String keytab,\n+      @JsonProperty(\"principal\") String principal,\n+      @JsonProperty(\"use_ugi\") boolean useUgi,\n+      @JsonProperty(\"hadoop_config\") String hadoopConfig)\n+  {\n+    Configuration configuration = new Configuration();\n+\n+    this.useUgi = useUgi;\n+\n+    if (hadoopConfig != null) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3MzY0MA==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399773640", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private RangerBasePlugin rangerPlugin;\n          \n          \n            \n              private final RangerBasePlugin rangerPlugin;", "author": "Fokko", "createdAt": "2020-03-29T09:55:53Z", "path": "extensions-core/druid-ranger-security/src/main/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizer.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import org.apache.druid.java.util.common.IAE;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.security.Access;\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Authorizer;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.ranger.plugin.audit.RangerDefaultAuditHandler;\n+import org.apache.ranger.plugin.policyengine.RangerAccessRequestImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResourceImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResult;\n+import org.apache.ranger.plugin.service.RangerBasePlugin;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+@JsonTypeName(\"ranger\")\n+public class RangerAuthorizer implements Authorizer\n+{\n+  private static final Logger LOG = new Logger(RangerAuthorizer.class);\n+\n+  public static final String RANGER_DRUID_SERVICETYPE = \"druid\";\n+  public static final String RANGER_DRUID_APPID = \"druid\";\n+\n+  public static final String RANGER_DRUID_DEFAULT_HADOOP_CONF = \"druid-ranger-site.xml\";\n+\n+  private RangerBasePlugin rangerPlugin;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3MzY1OA==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399773658", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private boolean useUgi;\n          \n          \n            \n              private final boolean useUgi;", "author": "Fokko", "createdAt": "2020-03-29T09:56:08Z", "path": "extensions-core/druid-ranger-security/src/main/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizer.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import org.apache.druid.java.util.common.IAE;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.security.Access;\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Authorizer;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.ranger.plugin.audit.RangerDefaultAuditHandler;\n+import org.apache.ranger.plugin.policyengine.RangerAccessRequestImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResourceImpl;\n+import org.apache.ranger.plugin.policyengine.RangerAccessResult;\n+import org.apache.ranger.plugin.service.RangerBasePlugin;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+@JsonTypeName(\"ranger\")\n+public class RangerAuthorizer implements Authorizer\n+{\n+  private static final Logger LOG = new Logger(RangerAuthorizer.class);\n+\n+  public static final String RANGER_DRUID_SERVICETYPE = \"druid\";\n+  public static final String RANGER_DRUID_APPID = \"druid\";\n+\n+  public static final String RANGER_DRUID_DEFAULT_HADOOP_CONF = \"druid-ranger-site.xml\";\n+\n+  private RangerBasePlugin rangerPlugin;\n+  private boolean useUgi;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDExMQ==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399774111", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            in Apache Druid, configuring the connection the Apache Ranger and providing the service definition for Druid to Apache Ranger. \n          \n          \n            \n            in Apache Druid, configuring the connection to Apache Ranger and providing the service definition for Druid to Apache Ranger.", "author": "Fokko", "createdAt": "2020-03-29T10:00:21Z", "path": "docs/development/extensions-core/druid-ranger-security.md", "diffHunk": "@@ -0,0 +1,86 @@\n+---\n+id: druid-ranger-security\n+title: \"Apache Ranger Security\"\n+---\n+\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one\n+  ~ or more contributor license agreements.  See the NOTICE file\n+  ~ distributed with this work for additional information\n+  ~ regarding copyright ownership.  The ASF licenses this file\n+  ~ to you under the Apache License, Version 2.0 (the\n+  ~ \"License\"); you may not use this file except in compliance\n+  ~ with the License.  You may obtain a copy of the License at\n+  ~\n+  ~   http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing,\n+  ~ software distributed under the License is distributed on an\n+  ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+  ~ KIND, either express or implied.  See the License for the\n+  ~ specific language governing permissions and limitations\n+  ~ under the License.\n+  -->\n+  \n+This Apache Druid extension adds:\n+\n+- an Authorizer which implements access control for the Druid metastore against Apache Ranger\n+\n+Make sure to [include](../../development/extensions.md#loading-extensions) `druid-ranger-security` as an extension.\n+\n+Please see [Authentication and Authorization](../../design/auth.md) for more information on the extension interfaces being implemented.\n+\n+## Configuration\n+\n+Support for Apache Ranger authorization consists of three elements: configuration of the extension \n+in Apache Druid, configuring the connection the Apache Ranger and providing the service definition for Druid to Apache Ranger. ", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDE4NA==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399774184", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            the contents of those files is beyond the scope of this document. Depending your needs you will \n          \n          \n            \n            the contents of those files are beyond the scope of this document. Depending on your needs you will", "author": "Fokko", "createdAt": "2020-03-29T10:00:54Z", "path": "docs/development/extensions-core/druid-ranger-security.md", "diffHunk": "@@ -0,0 +1,86 @@\n+---\n+id: druid-ranger-security\n+title: \"Apache Ranger Security\"\n+---\n+\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one\n+  ~ or more contributor license agreements.  See the NOTICE file\n+  ~ distributed with this work for additional information\n+  ~ regarding copyright ownership.  The ASF licenses this file\n+  ~ to you under the Apache License, Version 2.0 (the\n+  ~ \"License\"); you may not use this file except in compliance\n+  ~ with the License.  You may obtain a copy of the License at\n+  ~\n+  ~   http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing,\n+  ~ software distributed under the License is distributed on an\n+  ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+  ~ KIND, either express or implied.  See the License for the\n+  ~ specific language governing permissions and limitations\n+  ~ under the License.\n+  -->\n+  \n+This Apache Druid extension adds:\n+\n+- an Authorizer which implements access control for the Druid metastore against Apache Ranger\n+\n+Make sure to [include](../../development/extensions.md#loading-extensions) `druid-ranger-security` as an extension.\n+\n+Please see [Authentication and Authorization](../../design/auth.md) for more information on the extension interfaces being implemented.\n+\n+## Configuration\n+\n+Support for Apache Ranger authorization consists of three elements: configuration of the extension \n+in Apache Druid, configuring the connection the Apache Ranger and providing the service definition for Druid to Apache Ranger. \n+\n+### Properties to configure the extension in Apache Druid\n+|Property|Description|Default|required|\n+|--------|-----------|-------|--------|\n+|`druid.auth.ranger.keytab`|Defines the keytab to be used while authenticating against Apache Ranger to obtain policies and provide auditing|null|No|\n+|`druid.auth.ranger.principal`|Defines the principal to be used while authenticating against Apache Ranger to obtain policies and provide auditing|null|No|\n+|`druid.auth.ranger.use_ugi`|Determines if groups that the authenticated user belongs to should be obtained from Hadoop's UserGroupInformation|null|No|\n+|`druid.auth.ranger.hadoop_config`|If defined, loads extra configuration for Hadoop's UserGroupInformation from this file|ranger-druid-site.xml|No|\n+\n+### Configuring the connection to Apache Ranger\n+\n+The Apache Ranger authorization extension will read several configuration files. Discussing the\n+the contents of those files is beyond the scope of this document. Depending your needs you will ", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDIxNQ==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399774215", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            that you will need to put in the classpath. For auditing the configuration is in `ranger-druid-audit.xml`.\n          \n          \n            \n            that you will need to put in the classpath. For auditing, the configuration is in `ranger-druid-audit.xml`.", "author": "Fokko", "createdAt": "2020-03-29T10:01:25Z", "path": "docs/development/extensions-core/druid-ranger-security.md", "diffHunk": "@@ -0,0 +1,86 @@\n+---\n+id: druid-ranger-security\n+title: \"Apache Ranger Security\"\n+---\n+\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one\n+  ~ or more contributor license agreements.  See the NOTICE file\n+  ~ distributed with this work for additional information\n+  ~ regarding copyright ownership.  The ASF licenses this file\n+  ~ to you under the Apache License, Version 2.0 (the\n+  ~ \"License\"); you may not use this file except in compliance\n+  ~ with the License.  You may obtain a copy of the License at\n+  ~\n+  ~   http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing,\n+  ~ software distributed under the License is distributed on an\n+  ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+  ~ KIND, either express or implied.  See the License for the\n+  ~ specific language governing permissions and limitations\n+  ~ under the License.\n+  -->\n+  \n+This Apache Druid extension adds:\n+\n+- an Authorizer which implements access control for the Druid metastore against Apache Ranger\n+\n+Make sure to [include](../../development/extensions.md#loading-extensions) `druid-ranger-security` as an extension.\n+\n+Please see [Authentication and Authorization](../../design/auth.md) for more information on the extension interfaces being implemented.\n+\n+## Configuration\n+\n+Support for Apache Ranger authorization consists of three elements: configuration of the extension \n+in Apache Druid, configuring the connection the Apache Ranger and providing the service definition for Druid to Apache Ranger. \n+\n+### Properties to configure the extension in Apache Druid\n+|Property|Description|Default|required|\n+|--------|-----------|-------|--------|\n+|`druid.auth.ranger.keytab`|Defines the keytab to be used while authenticating against Apache Ranger to obtain policies and provide auditing|null|No|\n+|`druid.auth.ranger.principal`|Defines the principal to be used while authenticating against Apache Ranger to obtain policies and provide auditing|null|No|\n+|`druid.auth.ranger.use_ugi`|Determines if groups that the authenticated user belongs to should be obtained from Hadoop's UserGroupInformation|null|No|\n+|`druid.auth.ranger.hadoop_config`|If defined, loads extra configuration for Hadoop's UserGroupInformation from this file|ranger-druid-site.xml|No|\n+\n+### Configuring the connection to Apache Ranger\n+\n+The Apache Ranger authorization extension will read several configuration files. Discussing the\n+the contents of those files is beyond the scope of this document. Depending your needs you will \n+need to create them. The minimum you will need to have is a `ranger-druid-security.xml` file \n+that you will need to put in the classpath. For auditing the configuration is in `ranger-druid-audit.xml`.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDM5MQ==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399774391", "bodyText": "I think we can remove this line.", "author": "Fokko", "createdAt": "2020-03-29T10:03:01Z", "path": "extensions-core/druid-ranger-security/src/test/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizerTest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.druid.server.security.ResourceType;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class RangerAuthorizerTest\n+{\n+  static RangerAuthorizer rangerAuthorizer = null;\n+\n+  private static final AuthenticationResult alice = new AuthenticationResult(\"alice\", null, null, null);\n+  private static final AuthenticationResult bob = new AuthenticationResult(\"bob\", null, null, null);\n+\n+  private static final Resource aliceDatasource = new Resource(\"alice-datasource\", ResourceType.DATASOURCE);\n+  private static final Resource aliceConfig = new Resource(\"config\", ResourceType.CONFIG);\n+  private static final Resource aliceState = new Resource(\"state\", ResourceType.STATE);\n+\n+  @BeforeClass\n+  public static void setupBeforeClass()\n+  {\n+    Map<String, String> config = new HashMap<>();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDQ1Mw==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399774453", "bodyText": "Can we also check if something isn't allowed? :)", "author": "Fokko", "createdAt": "2020-03-29T10:03:30Z", "path": "extensions-core/druid-ranger-security/src/test/java/org/apache/druid/security/ranger/authorizer/RangerAuthorizerTest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.ranger.authorizer;\n+\n+import org.apache.druid.server.security.Action;\n+import org.apache.druid.server.security.AuthenticationResult;\n+import org.apache.druid.server.security.Resource;\n+import org.apache.druid.server.security.ResourceType;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class RangerAuthorizerTest\n+{\n+  static RangerAuthorizer rangerAuthorizer = null;\n+\n+  private static final AuthenticationResult alice = new AuthenticationResult(\"alice\", null, null, null);\n+  private static final AuthenticationResult bob = new AuthenticationResult(\"bob\", null, null, null);\n+\n+  private static final Resource aliceDatasource = new Resource(\"alice-datasource\", ResourceType.DATASOURCE);\n+  private static final Resource aliceConfig = new Resource(\"config\", ResourceType.CONFIG);\n+  private static final Resource aliceState = new Resource(\"state\", ResourceType.STATE);\n+\n+  @BeforeClass\n+  public static void setupBeforeClass()\n+  {\n+    Map<String, String> config = new HashMap<>();\n+    rangerAuthorizer = new RangerAuthorizer(null, null, false, null);\n+  }\n+\n+  @Test\n+  public void testOperations()", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4Njk1OQ==", "url": "https://github.com/apache/druid/pull/9579#discussion_r399786959", "bodyText": "It isn't really required (there is one however), as we would be testing the logic of Apache Ranger rather than the extension. Deny is the default. The test coverage for this function is complete.", "author": "bolkedebruin", "createdAt": "2020-03-29T11:55:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDQ1Mw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1NDQ2Nw==", "url": "https://github.com/apache/druid/pull/9579#discussion_r400554467", "bodyText": "Would you please update the version to 0.19.0-SNAPSHOT?", "author": "jihoonson", "createdAt": "2020-03-30T23:28:09Z", "path": "extensions-core/druid-ranger-security/pom.xml", "diffHunk": "@@ -0,0 +1,389 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one\n+  ~ or more contributor license agreements.  See the NOTICE file\n+  ~ distributed with this work for additional information\n+  ~ regarding copyright ownership.  The ASF licenses this file\n+  ~ to you under the Apache License, Version 2.0 (the\n+  ~ \"License\"); you may not use this file except in compliance\n+  ~ with the License.  You may obtain a copy of the License at\n+  ~\n+  ~   http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing,\n+  ~ software distributed under the License is distributed on an\n+  ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+  ~ KIND, either express or implied.  See the License for the\n+  ~ specific language governing permissions and limitations\n+  ~ under the License.\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <groupId>org.apache.druid.extensions</groupId>\n+    <artifactId>druid-ranger-security</artifactId>\n+    <name>druid-ranger-security</name>\n+    <description>druid-ranger-security</description>\n+\n+    <parent>\n+        <groupId>org.apache.druid</groupId>\n+        <artifactId>druid</artifactId>\n+        <version>0.18.0-SNAPSHOT</version>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e0787e48238a2ebf61f90f1cb12996310623960a", "url": "https://github.com/apache/druid/commit/e0787e48238a2ebf61f90f1cb12996310623960a", "message": "Add Apache Ranger Authorization\n\nThis adds support for Apache Ranger authorization.", "committedDate": "2020-03-31T17:24:57Z", "type": "commit"}, {"oid": "5bf6599d7e7a2fe5ba5bd48fb0057737ff8d46df", "url": "https://github.com/apache/druid/commit/5bf6599d7e7a2fe5ba5bd48fb0057737ff8d46df", "message": "Fix documentation", "committedDate": "2020-03-31T17:24:57Z", "type": "commit"}, {"oid": "56082a53b1bacb23d20e52beb47a593b3d7e229a", "url": "https://github.com/apache/druid/commit/56082a53b1bacb23d20e52beb47a593b3d7e229a", "message": "Spelling fixes", "committedDate": "2020-03-31T17:24:57Z", "type": "commit"}, {"oid": "89bdcb098263f0693e915c9fa30cde3c58e4c8fa", "url": "https://github.com/apache/druid/commit/89bdcb098263f0693e915c9fa30cde3c58e4c8fa", "message": "Fix license check issue and set to 0.19-SNAPSHOT", "committedDate": "2020-03-31T17:24:57Z", "type": "commit"}, {"oid": "89bdcb098263f0693e915c9fa30cde3c58e4c8fa", "url": "https://github.com/apache/druid/commit/89bdcb098263f0693e915c9fa30cde3c58e4c8fa", "message": "Fix license check issue and set to 0.19-SNAPSHOT", "committedDate": "2020-03-31T17:24:57Z", "type": "forcePushed"}, {"oid": "cbbbf2473a2b00434b36168696c0e5ec6086b8f0", "url": "https://github.com/apache/druid/commit/cbbbf2473a2b00434b36168696c0e5ec6086b8f0", "message": "More license fixes", "committedDate": "2020-03-31T18:27:39Z", "type": "commit"}, {"oid": "6bc8813b92819e3861815a209ee871231e49fb08", "url": "https://github.com/apache/druid/commit/6bc8813b92819e3861815a209ee871231e49fb08", "message": "More license fixes", "committedDate": "2020-03-31T20:18:32Z", "type": "commit"}, {"oid": "0cc1252a4368244aa7cad787975d9ac08bbf8e83", "url": "https://github.com/apache/druid/commit/0cc1252a4368244aa7cad787975d9ac08bbf8e83", "message": "Fix transient dependency", "committedDate": "2020-03-31T20:22:43Z", "type": "commit"}, {"oid": "af887747b6af47751e9a9e9d945f10cb346e3e39", "url": "https://github.com/apache/druid/commit/af887747b6af47751e9a9e9d945f10cb346e3e39", "message": "Fix dependencies and licenses", "committedDate": "2020-04-01T09:24:50Z", "type": "commit"}, {"oid": "3f3ac420258a7812e093388e16c2c9e43bb71521", "url": "https://github.com/apache/druid/commit/3f3ac420258a7812e093388e16c2c9e43bb71521", "message": "Fix licenses", "committedDate": "2020-04-02T10:52:43Z", "type": "commit"}, {"oid": "95b5e9618944a070af2d153dafc09c629bc7f7c5", "url": "https://github.com/apache/druid/commit/95b5e9618944a070af2d153dafc09c629bc7f7c5", "message": "Fix small license issue", "committedDate": "2020-04-02T11:02:32Z", "type": "commit"}, {"oid": "9b9042f64f2111980cea5d9792964e45dbea8ead", "url": "https://github.com/apache/druid/commit/9b9042f64f2111980cea5d9792964e45dbea8ead", "message": "Fix double item", "committedDate": "2020-04-02T11:03:06Z", "type": "commit"}, {"oid": "a536044c4081e7030a312596d6da4fff6a331360", "url": "https://github.com/apache/druid/commit/a536044c4081e7030a312596d6da4fff6a331360", "message": "Small usability improvement", "committedDate": "2020-04-04T08:29:31Z", "type": "commit"}, {"oid": "206bb41d72ff0aab027f072a17b21054c4673965", "url": "https://github.com/apache/druid/commit/206bb41d72ff0aab027f072a17b21054c4673965", "message": "Remove possible NPE", "committedDate": "2020-04-04T13:28:01Z", "type": "commit"}, {"oid": "0b6ce1a3df05a6eda06296da868934863b5b730b", "url": "https://github.com/apache/druid/commit/0b6ce1a3df05a6eda06296da868934863b5b730b", "message": "Fix identation. *sigh* intellij", "committedDate": "2020-04-04T14:24:44Z", "type": "commit"}, {"oid": "f44f1d2dd6b78cb8654a15ae9701895a8db92951", "url": "https://github.com/apache/druid/commit/f44f1d2dd6b78cb8654a15ae9701895a8db92951", "message": "Spelling fix", "committedDate": "2020-04-04T14:30:57Z", "type": "commit"}]}