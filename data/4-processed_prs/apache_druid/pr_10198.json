{"pr_number": 10198, "pr_title": "Fix timeseries query constructor when postAggregator has an expression reading timestamp result column", "pr_createdAt": "2020-07-18T03:23:52Z", "pr_url": "https://github.com/apache/druid/pull/10198", "timeline": [{"oid": "a4b323eceb0939e5bb606fbc00771aad3379419a", "url": "https://github.com/apache/druid/commit/a4b323eceb0939e5bb606fbc00771aad3379419a", "message": "Fix timeseries query constructor when postAggregator has an expression reading timestamp result column", "committedDate": "2020-07-18T03:07:05Z", "type": "commit"}, {"oid": "3712395410d5c83966b7d5badf8cd85d894d2472", "url": "https://github.com/apache/druid/commit/3712395410d5c83966b7d5badf8cd85d894d2472", "message": "fix npe", "committedDate": "2020-07-18T20:15:43Z", "type": "commit"}, {"oid": "d4481f3eb40e040df7d6d6dfa7bff1cae8baaba3", "url": "https://github.com/apache/druid/commit/d4481f3eb40e040df7d6d6dfa7bff1cae8baaba3", "message": "Fix postAgg referencing timestampResultField and add a test for it", "committedDate": "2020-07-20T21:54:27Z", "type": "commit"}, {"oid": "ccb816ad85ec64987acfa5d7b65eff17ce609402", "url": "https://github.com/apache/druid/commit/ccb816ad85ec64987acfa5d7b65eff17ce609402", "message": "fix test", "committedDate": "2020-07-21T04:01:05Z", "type": "commit"}, {"oid": "912b8798b7f18482f001072749465ab67bee5979", "url": "https://github.com/apache/druid/commit/912b8798b7f18482f001072749465ab67bee5979", "message": "doc", "committedDate": "2020-07-21T05:06:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NzAwOA==", "url": "https://github.com/apache/druid/pull/10198#discussion_r458377008", "bodyText": "Hmm, I'm not sure that this additional content about timestampResultField is adding anything to the docs, really\u2026\nI'm in favor of removing it for now, for the following reasons:\n\nThis doesn't tell people much (it isn't clear what the parameter does, exactly).\nThe parameter is an internal thing that we don't expect people to use directly.\nMentioning it here distracts people from what they really need to know in this doc section, namely: learning what Druid SQL uses Timeseries queries for.\n\nIt could make sense to include some content in the \"Interpreting EXPLAIN PLAN output\" section, though. But I'm not sure if it's worth it.", "author": "gianm", "createdAt": "2020-07-21T20:45:36Z", "path": "docs/querying/sql.md", "diffHunk": "@@ -629,7 +629,9 @@ Druid SQL uses four different native query types.\n period)`, have no other grouping expressions, no HAVING or LIMIT clauses, no nesting, and either no ORDER BY, or an\n ORDER BY that orders by same expression as present in GROUP BY. It also uses Timeseries for \"grand total\" queries that\n have aggregation functions but no GROUP BY. This query type takes advantage of the fact that Druid segments are sorted\n-by time.\n+by time. The SQL planner can inject `timestampResultField` in the query context when there is a grouping key. This", "originalCommit": "912b8798b7f18482f001072749465ab67bee5979", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAzOTU1MA==", "url": "https://github.com/apache/druid/pull/10198#discussion_r459039550", "bodyText": "Btw, the rest of this patch LGTM, other than the doc stuff mentioned here.", "author": "gianm", "createdAt": "2020-07-22T19:43:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NzAwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDIxNDEyOA==", "url": "https://github.com/apache/druid/pull/10198#discussion_r460214128", "bodyText": "OK, I agree. It could be better to make it as a user-facing configuration before documenting it. I think it can be more structured such as an explicit field in timeseries query spec to access timestamp instead of query context field if it should be a user-facing configuration.", "author": "jihoonson", "createdAt": "2020-07-24T18:16:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NzAwOA=="}], "type": "inlineReview"}, {"oid": "c81aae3f7fd708bb97d812471bacd72f645e2f45", "url": "https://github.com/apache/druid/commit/c81aae3f7fd708bb97d812471bacd72f645e2f45", "message": "revert doc", "committedDate": "2020-07-24T18:12:13Z", "type": "commit"}]}