{"pr_number": 1555, "pr_title": "Issue #1404: Implemented tests for ToolGroupApiService", "pr_createdAt": "2020-11-10T09:55:03Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1555", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYzMDAxMQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r520630011", "bodyText": "Maybe  you can replace 1 with something like private static final int READ_PERMISSION for better readability (as I did in the tests on DataStorageApiService). Or, in case you only check the READ permission mask, you can replace 1 with AclPermission.READ.getMask() (as it done in the Gitlab project). The same at line 195.", "author": "YouKofan", "createdAt": "2020-11-10T15:01:23Z", "path": "api/src/test/java/com/epam/pipeline/acl/docker/ToolGroupApiServiceTest.java", "diffHunk": "@@ -0,0 +1,412 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.docker;\n+\n+import com.epam.pipeline.entity.pipeline.DockerRegistry;\n+import com.epam.pipeline.entity.pipeline.Tool;\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+import com.epam.pipeline.manager.docker.DockerRegistryManager;\n+import com.epam.pipeline.manager.pipeline.ToolGroupManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import com.epam.pipeline.test.creator.docker.DockerCreatorUtils;\n+import com.epam.pipeline.test.creator.docker.ToolCreatorUtils;\n+import com.epam.pipeline.test.creator.docker.ToolGroupCreatorUtils;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.core.context.SecurityContextHolder;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.List;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID_2;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.TEST_STRING;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+\n+public class ToolGroupApiServiceTest extends AbstractAclTest {\n+\n+\n+    private static final String TOOL_GROUP_MANAGER = \"TOOL_GROUP_MANAGER\";\n+    private final ToolGroup toolGroup = ToolGroupCreatorUtils.getToolGroup(ID, SIMPLE_USER);\n+    private final ToolGroup anotherToolGroup = ToolGroupCreatorUtils.getToolGroup(ID, ANOTHER_SIMPLE_USER);\n+    private final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, SIMPLE_USER);\n+    private final Tool tool = ToolCreatorUtils.getTool(ANOTHER_SIMPLE_USER);\n+\n+    @Autowired\n+    private ToolGroupApiService toolGroupApiService;\n+\n+    @Autowired\n+    private ToolGroupManager mockToolGroupManager;\n+\n+    @Autowired\n+    private AuthManager mockAuthManager;\n+\n+    @Autowired\n+    private DockerRegistryManager mockDockerRegistryManager;\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER, roles = TOOL_GROUP_MANAGER)\n+    public void shouldCreateToolGroupForManagerWhenPermissionGranted() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+        doReturn(SIMPLE_USER).when(mockAuthManager).getAuthorizedUser();\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyCreateToolGroupWithInvalidRole() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER)\n+    public void shouldDenyCreateToolGroupWhenPermissionIsNotGranted() {\n+        initAclEntity(dockerRegistry);\n+        doReturn(SIMPLE_USER).when(mockAuthManager).getAuthorizedUser();\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldUpdateToolGroupWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(SIMPLE_USER).when(mockAuthManager).getAuthorizedUser();\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyUpdateWhenPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.update(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupsByRegistryIdForAdmin() {\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).isEqualTo(toolGroups);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupsByRegistryIdWhenPermissionIsGranted() {\n+        initAclEntity(anotherToolGroup, AclPermission.READ);\n+        doReturn(SIMPLE_USER).when(mockAuthManager).getAuthorizedUser();\n+        final List<ToolGroup> toolGroups = mutableListOf(anotherToolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        final List<ToolGroup> returnedTollGroups = toolGroupApiService.loadByRegistryId(ID);\n+\n+        assertThat(returnedTollGroups).isEqualTo(toolGroups);\n+        assertThat(returnedTollGroups.get(0).getMask()).isEqualTo(1);", "originalCommit": "f035951b1ffefcd99927996ea522a67ccad86b88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI3ODk4MQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r521278981", "bodyText": "To my mind it would be better to overload the method?\nCould we add final to method arguments?", "author": "ekazachkova", "createdAt": "2020-11-11T11:00:35Z", "path": "api/src/test/java/com/epam/pipeline/test/creator/docker/ToolGroupCreatorUtils.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.test.creator.docker;\n+\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+\n+public final class ToolGroupCreatorUtils {\n+\n+    private ToolGroupCreatorUtils() {\n+\n+    }\n+\n+    public static ToolGroup getToolGroup() {\n+        final ToolGroup toolGroup = new ToolGroup();\n+        toolGroup.setId(ID);\n+        toolGroup.setRegistryId(ID);\n+        return toolGroup;\n+    }\n+\n+    public static ToolGroup getToolGroup(Long id, String owner) {", "originalCommit": "f035951b1ffefcd99927996ea522a67ccad86b88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI3OTU5Mg==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r521279592", "bodyText": "Could you please remove an extra empty line?", "author": "ekazachkova", "createdAt": "2020-11-11T11:01:49Z", "path": "api/src/test/java/com/epam/pipeline/acl/docker/ToolGroupApiServiceTest.java", "diffHunk": "@@ -0,0 +1,412 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.docker;\n+\n+import com.epam.pipeline.entity.pipeline.DockerRegistry;\n+import com.epam.pipeline.entity.pipeline.Tool;\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+import com.epam.pipeline.manager.docker.DockerRegistryManager;\n+import com.epam.pipeline.manager.pipeline.ToolGroupManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import com.epam.pipeline.test.creator.docker.DockerCreatorUtils;\n+import com.epam.pipeline.test.creator.docker.ToolCreatorUtils;\n+import com.epam.pipeline.test.creator.docker.ToolGroupCreatorUtils;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.core.context.SecurityContextHolder;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.List;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID_2;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.TEST_STRING;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+\n+public class ToolGroupApiServiceTest extends AbstractAclTest {\n+", "originalCommit": "f035951b1ffefcd99927996ea522a67ccad86b88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMwODU5NQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r521308595", "bodyText": "Could you add test for AclTree annotation for this test class too?", "author": "ekazachkova", "createdAt": "2020-11-11T11:58:53Z", "path": "api/src/test/java/com/epam/pipeline/acl/docker/ToolGroupApiServiceTest.java", "diffHunk": "@@ -0,0 +1,412 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.docker;\n+\n+import com.epam.pipeline.entity.pipeline.DockerRegistry;\n+import com.epam.pipeline.entity.pipeline.Tool;\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+import com.epam.pipeline.manager.docker.DockerRegistryManager;\n+import com.epam.pipeline.manager.pipeline.ToolGroupManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import com.epam.pipeline.test.creator.docker.DockerCreatorUtils;\n+import com.epam.pipeline.test.creator.docker.ToolCreatorUtils;\n+import com.epam.pipeline.test.creator.docker.ToolGroupCreatorUtils;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.core.context.SecurityContextHolder;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.List;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID_2;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.TEST_STRING;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+\n+public class ToolGroupApiServiceTest extends AbstractAclTest {", "originalCommit": "f035951b1ffefcd99927996ea522a67ccad86b88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f979c63c0e7cb36986ef900237c8acada5af979f", "url": "https://github.com/epam/cloud-pipeline/commit/f979c63c0e7cb36986ef900237c8acada5af979f", "message": "Issue #1404: Added common methods fro AclTree tests", "committedDate": "2020-11-20T15:25:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMwNTYwNw==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r533305607", "bodyText": "Remove empty line, please", "author": "ekazachkova", "createdAt": "2020-12-01T10:39:35Z", "path": "api/src/test/java/com/epam/pipeline/acl/docker/ToolGroupApiServiceTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.docker;\n+\n+import com.epam.pipeline.entity.pipeline.DockerRegistry;\n+import com.epam.pipeline.entity.pipeline.Tool;\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+import com.epam.pipeline.manager.docker.DockerRegistryManager;\n+import com.epam.pipeline.manager.pipeline.ToolGroupManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import com.epam.pipeline.test.creator.docker.DockerCreatorUtils;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID_2;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.READ_PERMISSION;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.TEST_STRING;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+\n+public class ToolGroupApiServiceTest extends AbstractAclTest {\n+\n+    private static final String TOOL_GROUP_MANAGER = \"TOOL_GROUP_MANAGER\";\n+    private final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+    private final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+    private final Tool tool = DockerCreatorUtils.getTool(ANOTHER_SIMPLE_USER);\n+    private final Tool toolWithoutPermission = DockerCreatorUtils.getTool(ID_2, ANOTHER_SIMPLE_USER);\n+    private final List<Tool> tools = Arrays.asList(tool, toolWithoutPermission);\n+    private final ToolGroupWithIssues toolGroupWithIssues = DockerCreatorUtils.getToolGroupWithIssues();\n+\n+    @Autowired\n+    private ToolGroupApiService toolGroupApiService;\n+\n+    @Autowired\n+    private ToolGroupManager mockToolGroupManager;\n+\n+    @Autowired\n+    private DockerRegistryManager mockDockerRegistryManager;\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER, roles = TOOL_GROUP_MANAGER)\n+    public void shouldCreateToolGroupForManagerWhenPermissionGranted() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldDenyCreateToolGroupWithInvalidRole() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDenyCreateToolGroupWhenPermissionIsNotGranted() {\n+        initAclEntity(dockerRegistry);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldUpdateToolGroupWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(SIMPLE_USER)\n+    public void shouldDenyUpdateWhenPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.update(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupsByRegistryIdForAdmin() {\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).isEqualTo(toolGroups);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupsByRegistryIdWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        final List<ToolGroup> returnedTollGroups = toolGroupApiService.loadByRegistryId(ID);\n+\n+        assertThat(returnedTollGroups).isEqualTo(toolGroups);\n+        assertThat(returnedTollGroups.get(0).getMask()).isEqualTo(READ_PERMISSION);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolsGroupsByRegistryIdWhichPermissionIsGranted() {\n+        final ToolGroup anotherToolGroup = DockerCreatorUtils.getToolGroup(ID_2, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        initAclEntity(anotherToolGroup);\n+        doReturn(mutableListOf(toolGroup, anotherToolGroup)).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).hasSize(1).contains(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldDenyLoadToolGroupsByRegistryIdWhichPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).isEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupsByRegistryNameOrIdForAdmin() {\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryNameOrId(TEST_STRING);\n+\n+        assertThat(toolGroupApiService.loadByRegistryNameOrId(TEST_STRING)).isEqualTo(toolGroups);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupsByRegistryNameOrIdWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryNameOrId(TEST_STRING);\n+\n+        final List<ToolGroup> returnedTollGroups = toolGroupApiService.loadByRegistryNameOrId(TEST_STRING);\n+\n+        assertThat(returnedTollGroups).isEqualTo(toolGroups);\n+        assertThat(returnedTollGroups.get(0).getMask()).isEqualTo(READ_PERMISSION);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolsGroupsByRegistryNameOrIdWhichPermissionIsGranted() {\n+        final ToolGroup anotherToolGroup = DockerCreatorUtils.getToolGroup(ID_2, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        initAclEntity(anotherToolGroup);\n+        doReturn(mutableListOf(toolGroup, anotherToolGroup))\n+                .when(mockToolGroupManager).loadByRegistryNameOrId(TEST_STRING);\n+\n+        assertThat(toolGroupApiService.loadByRegistryNameOrId(TEST_STRING)).hasSize(1).contains(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(SIMPLE_USER)\n+    public void shouldDenyLoadToolGroupsByRegistryNameOrIdWhichPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThat(toolGroupApiService.loadByRegistryNameOrId(TEST_STRING)).isEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).load(ID);\n+\n+        assertThat(toolGroupApiService.load(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadToolGroup() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(dockerRegistry);\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        doReturn(toolGroup).when(mockToolGroupManager).load(ID);\n+\n+        assertThat(toolGroupApiService.load(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupHierarchy() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        toolGroup.setTools(tools);\n+        initToolGroupAclTree();\n+        doReturn(toolGroup).when(mockToolGroupManager).load(ID);\n+\n+        final ToolGroup returnedToolGroup = toolGroupApiService.load(ID);\n+\n+        assertToolGroupAclTree(returnedToolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadToolsWithIssuesCount() {\n+        doReturn(toolGroupWithIssues).when(mockToolGroupManager).loadToolsWithIssuesCount(ID);\n+\n+        assertThat(toolGroupApiService.loadToolsWithIssuesCount(ID)).isEqualTo(toolGroupWithIssues);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolsWithIssuesCountHierarchy() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        final ToolGroupWithIssues toolGroupWithIssues =\n+                DockerCreatorUtils.getToolGroupWithIssues(ID_2, ANOTHER_SIMPLE_USER);\n+        toolGroupWithIssues.setParent(dockerRegistry);\n+        toolGroupWithIssues.setTools(tools);\n+        initToolGroupAclTree();\n+        doReturn(toolGroupWithIssues).when(mockToolGroupManager).loadToolsWithIssuesCount(ID);\n+\n+        final ToolGroupWithIssues returnedToolGroup = toolGroupApiService.loadToolsWithIssuesCount(ID);\n+\n+        assertToolGroupAclTree(returnedToolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadByNameOrId() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(dockerRegistry);\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        assertThat(toolGroupApiService.loadByNameOrId(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupHierarchyByNameOrId() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        toolGroup.setTools(tools);\n+        initToolGroupAclTree();\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+\n+        final ToolGroup returnedToolGroup = toolGroupApiService.loadByNameOrId(TEST_STRING);\n+\n+        assertToolGroupAclTree(returnedToolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadPrivate() {\n+        doReturn(toolGroup).when(mockToolGroupManager).loadPrivate(ID);\n+\n+        assertThat(toolGroupApiService.loadPrivate(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreatePrivateForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).createPrivate(ID);\n+\n+        assertThat(toolGroupApiService.createPrivate(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldCreatePrivateWhenPermissionIsGranted() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        dockerRegistry.setGroups(mutableListOf(toolGroup));\n+        doReturn(dockerRegistry).when(mockDockerRegistryManager).getDockerRegistryTree(ID);\n+        doReturn(toolGroup).when(mockToolGroupManager).createPrivate(ID);\n+\n+        assertThat(toolGroupApiService.createPrivate(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyCreatePrivateWhenPermissionIsNotGranted() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup);\n+        dockerRegistry.setGroups(mutableListOf(toolGroup));\n+        initAclEntity(dockerRegistry);\n+        doReturn(dockerRegistry).when(mockDockerRegistryManager).getDockerRegistryTree(ID);\n+        doReturn(toolGroup).when(mockToolGroupManager).createPrivate(ID);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.createPrivate(ID));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+\n+        assertThat(toolGroupApiService.delete(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDeleteToolGroupForManagerWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+        mockSecurityContext();\n+\n+        assertThat(toolGroupApiService.delete(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyDeleteToolGroupWithInvalidRole() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.delete(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER)\n+    public void shouldDenyDeleteToolGroupWhenPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+        mockSecurityContext();\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.delete(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteForceToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+\n+        assertThat(toolGroupApiService.deleteForce(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyDeleteForceToolGroupWithInvalidRole() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setTools(mutableListOf(tool));\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        initAclEntity(tool, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.deleteForce(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDeleteForceToolGroupForManagerWhenChildPermissionIsGranted() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setTools(mutableListOf(tool));\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        initAclEntity(tool, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+        mockSecurityContext();\n+\n+        assertThat(toolGroupApiService.deleteForce(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+", "originalCommit": "f979c63c0e7cb36986ef900237c8acada5af979f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzNTk4NQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r533335985", "bodyText": "typo: returnedTollGroups -> returnedToolGroups", "author": "ekazachkova", "createdAt": "2020-12-01T11:25:35Z", "path": "api/src/test/java/com/epam/pipeline/acl/docker/ToolGroupApiServiceTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.docker;\n+\n+import com.epam.pipeline.entity.pipeline.DockerRegistry;\n+import com.epam.pipeline.entity.pipeline.Tool;\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+import com.epam.pipeline.manager.docker.DockerRegistryManager;\n+import com.epam.pipeline.manager.pipeline.ToolGroupManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import com.epam.pipeline.test.creator.docker.DockerCreatorUtils;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID_2;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.READ_PERMISSION;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.TEST_STRING;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+\n+public class ToolGroupApiServiceTest extends AbstractAclTest {\n+\n+    private static final String TOOL_GROUP_MANAGER = \"TOOL_GROUP_MANAGER\";\n+    private final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+    private final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+    private final Tool tool = DockerCreatorUtils.getTool(ANOTHER_SIMPLE_USER);\n+    private final Tool toolWithoutPermission = DockerCreatorUtils.getTool(ID_2, ANOTHER_SIMPLE_USER);\n+    private final List<Tool> tools = Arrays.asList(tool, toolWithoutPermission);\n+    private final ToolGroupWithIssues toolGroupWithIssues = DockerCreatorUtils.getToolGroupWithIssues();\n+\n+    @Autowired\n+    private ToolGroupApiService toolGroupApiService;\n+\n+    @Autowired\n+    private ToolGroupManager mockToolGroupManager;\n+\n+    @Autowired\n+    private DockerRegistryManager mockDockerRegistryManager;\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER, roles = TOOL_GROUP_MANAGER)\n+    public void shouldCreateToolGroupForManagerWhenPermissionGranted() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldDenyCreateToolGroupWithInvalidRole() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDenyCreateToolGroupWhenPermissionIsNotGranted() {\n+        initAclEntity(dockerRegistry);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldUpdateToolGroupWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(SIMPLE_USER)\n+    public void shouldDenyUpdateWhenPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.update(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupsByRegistryIdForAdmin() {\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).isEqualTo(toolGroups);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupsByRegistryIdWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        final List<ToolGroup> returnedTollGroups = toolGroupApiService.loadByRegistryId(ID);", "originalCommit": "f979c63c0e7cb36986ef900237c8acada5af979f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA2MjM5NQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r534062395", "bodyText": "and this line too", "author": "ekazachkova", "createdAt": "2020-12-02T10:34:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzNTk4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM3NjY1Mw==", "url": "https://github.com/epam/cloud-pipeline/pull/1555#discussion_r533376653", "bodyText": "Could we add assertion for tool mask?", "author": "ekazachkova", "createdAt": "2020-12-01T12:38:10Z", "path": "api/src/test/java/com/epam/pipeline/acl/docker/ToolGroupApiServiceTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.docker;\n+\n+import com.epam.pipeline.entity.pipeline.DockerRegistry;\n+import com.epam.pipeline.entity.pipeline.Tool;\n+import com.epam.pipeline.entity.pipeline.ToolGroup;\n+import com.epam.pipeline.entity.pipeline.ToolGroupWithIssues;\n+import com.epam.pipeline.manager.docker.DockerRegistryManager;\n+import com.epam.pipeline.manager.pipeline.ToolGroupManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import com.epam.pipeline.test.creator.docker.DockerCreatorUtils;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.ID_2;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.READ_PERMISSION;\n+import static com.epam.pipeline.test.creator.CommonCreatorConstants.TEST_STRING;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+\n+public class ToolGroupApiServiceTest extends AbstractAclTest {\n+\n+    private static final String TOOL_GROUP_MANAGER = \"TOOL_GROUP_MANAGER\";\n+    private final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+    private final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+    private final Tool tool = DockerCreatorUtils.getTool(ANOTHER_SIMPLE_USER);\n+    private final Tool toolWithoutPermission = DockerCreatorUtils.getTool(ID_2, ANOTHER_SIMPLE_USER);\n+    private final List<Tool> tools = Arrays.asList(tool, toolWithoutPermission);\n+    private final ToolGroupWithIssues toolGroupWithIssues = DockerCreatorUtils.getToolGroupWithIssues();\n+\n+    @Autowired\n+    private ToolGroupApiService toolGroupApiService;\n+\n+    @Autowired\n+    private ToolGroupManager mockToolGroupManager;\n+\n+    @Autowired\n+    private DockerRegistryManager mockDockerRegistryManager;\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER, roles = TOOL_GROUP_MANAGER)\n+    public void shouldCreateToolGroupForManagerWhenPermissionGranted() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).create(toolGroup);\n+\n+        assertThat(toolGroupApiService.create(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldDenyCreateToolGroupWithInvalidRole() {\n+        initAclEntity(dockerRegistry, AclPermission.WRITE);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDenyCreateToolGroupWhenPermissionIsNotGranted() {\n+        initAclEntity(dockerRegistry);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.create(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldUpdateToolGroupWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).updateToolGroup(toolGroup);\n+\n+        assertThat(toolGroupApiService.update(toolGroup)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(SIMPLE_USER)\n+    public void shouldDenyUpdateWhenPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.update(toolGroup));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupsByRegistryIdForAdmin() {\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).isEqualTo(toolGroups);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupsByRegistryIdWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        final List<ToolGroup> returnedTollGroups = toolGroupApiService.loadByRegistryId(ID);\n+\n+        assertThat(returnedTollGroups).isEqualTo(toolGroups);\n+        assertThat(returnedTollGroups.get(0).getMask()).isEqualTo(READ_PERMISSION);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolsGroupsByRegistryIdWhichPermissionIsGranted() {\n+        final ToolGroup anotherToolGroup = DockerCreatorUtils.getToolGroup(ID_2, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        initAclEntity(anotherToolGroup);\n+        doReturn(mutableListOf(toolGroup, anotherToolGroup)).when(mockToolGroupManager).loadByRegistryId(ID);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).hasSize(1).contains(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldDenyLoadToolGroupsByRegistryIdWhichPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThat(toolGroupApiService.loadByRegistryId(ID)).isEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupsByRegistryNameOrIdForAdmin() {\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryNameOrId(TEST_STRING);\n+\n+        assertThat(toolGroupApiService.loadByRegistryNameOrId(TEST_STRING)).isEqualTo(toolGroups);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupsByRegistryNameOrIdWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        final List<ToolGroup> toolGroups = mutableListOf(toolGroup);\n+        doReturn(toolGroups).when(mockToolGroupManager).loadByRegistryNameOrId(TEST_STRING);\n+\n+        final List<ToolGroup> returnedTollGroups = toolGroupApiService.loadByRegistryNameOrId(TEST_STRING);\n+\n+        assertThat(returnedTollGroups).isEqualTo(toolGroups);\n+        assertThat(returnedTollGroups.get(0).getMask()).isEqualTo(READ_PERMISSION);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolsGroupsByRegistryNameOrIdWhichPermissionIsGranted() {\n+        final ToolGroup anotherToolGroup = DockerCreatorUtils.getToolGroup(ID_2, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        initAclEntity(anotherToolGroup);\n+        doReturn(mutableListOf(toolGroup, anotherToolGroup))\n+                .when(mockToolGroupManager).loadByRegistryNameOrId(TEST_STRING);\n+\n+        assertThat(toolGroupApiService.loadByRegistryNameOrId(TEST_STRING)).hasSize(1).contains(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(SIMPLE_USER)\n+    public void shouldDenyLoadToolGroupsByRegistryNameOrIdWhichPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+\n+        assertThat(toolGroupApiService.loadByRegistryNameOrId(TEST_STRING)).isEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).load(ID);\n+\n+        assertThat(toolGroupApiService.load(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadToolGroup() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(dockerRegistry);\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        doReturn(toolGroup).when(mockToolGroupManager).load(ID);\n+\n+        assertThat(toolGroupApiService.load(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupHierarchy() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        toolGroup.setTools(tools);\n+        initToolGroupAclTree();\n+        doReturn(toolGroup).when(mockToolGroupManager).load(ID);\n+\n+        final ToolGroup returnedToolGroup = toolGroupApiService.load(ID);\n+\n+        assertToolGroupAclTree(returnedToolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadToolsWithIssuesCount() {\n+        doReturn(toolGroupWithIssues).when(mockToolGroupManager).loadToolsWithIssuesCount(ID);\n+\n+        assertThat(toolGroupApiService.loadToolsWithIssuesCount(ID)).isEqualTo(toolGroupWithIssues);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolsWithIssuesCountHierarchy() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        final ToolGroupWithIssues toolGroupWithIssues =\n+                DockerCreatorUtils.getToolGroupWithIssues(ID_2, ANOTHER_SIMPLE_USER);\n+        toolGroupWithIssues.setParent(dockerRegistry);\n+        toolGroupWithIssues.setTools(tools);\n+        initToolGroupAclTree();\n+        doReturn(toolGroupWithIssues).when(mockToolGroupManager).loadToolsWithIssuesCount(ID);\n+\n+        final ToolGroupWithIssues returnedToolGroup = toolGroupApiService.loadToolsWithIssuesCount(ID);\n+\n+        assertToolGroupAclTree(returnedToolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadByNameOrId() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(dockerRegistry);\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        assertThat(toolGroupApiService.loadByNameOrId(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadToolGroupHierarchyByNameOrId() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setParent(dockerRegistry);\n+        toolGroup.setTools(tools);\n+        initToolGroupAclTree();\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+\n+        final ToolGroup returnedToolGroup = toolGroupApiService.loadByNameOrId(TEST_STRING);\n+\n+        assertToolGroupAclTree(returnedToolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadPrivate() {\n+        doReturn(toolGroup).when(mockToolGroupManager).loadPrivate(ID);\n+\n+        assertThat(toolGroupApiService.loadPrivate(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreatePrivateForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).createPrivate(ID);\n+\n+        assertThat(toolGroupApiService.createPrivate(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldCreatePrivateWhenPermissionIsGranted() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup, AclPermission.READ);\n+        dockerRegistry.setGroups(mutableListOf(toolGroup));\n+        doReturn(dockerRegistry).when(mockDockerRegistryManager).getDockerRegistryTree(ID);\n+        doReturn(toolGroup).when(mockToolGroupManager).createPrivate(ID);\n+\n+        assertThat(toolGroupApiService.createPrivate(ID)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyCreatePrivateWhenPermissionIsNotGranted() {\n+        final DockerRegistry dockerRegistry = DockerCreatorUtils.getDockerRegistry(ID, ANOTHER_SIMPLE_USER);\n+        initAclEntity(toolGroup);\n+        dockerRegistry.setGroups(mutableListOf(toolGroup));\n+        initAclEntity(dockerRegistry);\n+        doReturn(dockerRegistry).when(mockDockerRegistryManager).getDockerRegistryTree(ID);\n+        doReturn(toolGroup).when(mockToolGroupManager).createPrivate(ID);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.createPrivate(ID));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+\n+        assertThat(toolGroupApiService.delete(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDeleteToolGroupForManagerWhenPermissionIsGranted() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+        mockSecurityContext();\n+\n+        assertThat(toolGroupApiService.delete(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyDeleteToolGroupWithInvalidRole() {\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.delete(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER)\n+    public void shouldDenyDeleteToolGroupWhenPermissionIsNotGranted() {\n+        initAclEntity(toolGroup);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, false);\n+        mockSecurityContext();\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.delete(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteForceToolGroupForAdmin() {\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+\n+        assertThat(toolGroupApiService.deleteForce(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldDenyDeleteForceToolGroupWithInvalidRole() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setTools(mutableListOf(tool));\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        initAclEntity(tool, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.deleteForce(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDeleteForceToolGroupForManagerWhenChildPermissionIsGranted() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setTools(mutableListOf(tool));\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        initAclEntity(tool, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+        mockSecurityContext();\n+\n+        assertThat(toolGroupApiService.deleteForce(TEST_STRING)).isEqualTo(toolGroup);\n+    }\n+\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER, username = SIMPLE_USER)\n+    public void shouldDenyDeleteForceToolGroupForManagerWhenChildPermissionIsNotGranted() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setTools(mutableListOf(tool));\n+        initAclEntity(toolGroup, AclPermission.WRITE);\n+        initAclEntity(tool);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+        mockSecurityContext();\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.deleteForce(TEST_STRING));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = TOOL_GROUP_MANAGER)\n+    public void shouldDenyDeleteForceToolGroupForManagerWhenPermissionIsNotGranted() {\n+        final ToolGroup toolGroup = DockerCreatorUtils.getToolGroup(ANOTHER_SIMPLE_USER);\n+        toolGroup.setTools(mutableListOf(tool));\n+        initAclEntity(toolGroup);\n+        initAclEntity(tool, AclPermission.WRITE);\n+        doReturn(toolGroup).when(mockToolGroupManager).loadByNameOrId(TEST_STRING);\n+        doReturn(toolGroup).when(mockToolGroupManager).delete(TEST_STRING, true);\n+        mockSecurityContext();\n+\n+        assertThrows(AccessDeniedException.class, () -> toolGroupApiService.deleteForce(TEST_STRING));\n+    }\n+\n+    private void initToolGroupAclTree() {\n+        initAclEntity(dockerRegistry);\n+        initAclEntity(tool, AclPermission.READ);\n+        initAclEntity(toolWithoutPermission);\n+    }\n+\n+    private void assertToolGroupAclTree(final ToolGroup returnedToolGroup) {\n+        assertThat(returnedToolGroup.getParent()).isEqualTo(dockerRegistry);\n+        assertThat(returnedToolGroup.getLeaves()).hasSize(1);\n+        assertThat(returnedToolGroup.getLeaves().get(0)).isEqualTo(tool);", "originalCommit": "f979c63c0e7cb36986ef900237c8acada5af979f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fe7d4238774bc58691200ce01a6d93aaa2b27185", "url": "https://github.com/epam/cloud-pipeline/commit/fe7d4238774bc58691200ce01a6d93aaa2b27185", "message": "Issue #1404: ToolGroupApiService moved to acl package, existing ToolGroupApiServiceTest removed", "committedDate": "2020-12-07T11:49:57Z", "type": "commit"}, {"oid": "5673996ce052737cb3b0c56f41ca8fdb6ecdfa2d", "url": "https://github.com/epam/cloud-pipeline/commit/5673996ce052737cb3b0c56f41ca8fdb6ecdfa2d", "message": "Issue #1404: Implemented tests for ToolGroupApiService", "committedDate": "2020-12-07T11:49:57Z", "type": "commit"}, {"oid": "eddf66060897974d1eb33ae3b4fa12d740994ff9", "url": "https://github.com/epam/cloud-pipeline/commit/eddf66060897974d1eb33ae3b4fa12d740994ff9", "message": "Issue #1404: Added tests for AclTree", "committedDate": "2020-12-07T11:52:05Z", "type": "commit"}, {"oid": "dbaaead3e89394e6882c5b40953f63afebc2282f", "url": "https://github.com/epam/cloud-pipeline/commit/dbaaead3e89394e6882c5b40953f63afebc2282f", "message": "Issue #1404: Added common methods fro AclTree tests", "committedDate": "2020-12-07T11:52:14Z", "type": "commit"}, {"oid": "ab12cfbd7f78261809fcb7de2f584533292e778f", "url": "https://github.com/epam/cloud-pipeline/commit/ab12cfbd7f78261809fcb7de2f584533292e778f", "message": "Issue #1404: Added mask assertion", "committedDate": "2020-12-07T11:56:37Z", "type": "commit"}, {"oid": "ab12cfbd7f78261809fcb7de2f584533292e778f", "url": "https://github.com/epam/cloud-pipeline/commit/ab12cfbd7f78261809fcb7de2f584533292e778f", "message": "Issue #1404: Added mask assertion", "committedDate": "2020-12-07T11:56:37Z", "type": "forcePushed"}]}