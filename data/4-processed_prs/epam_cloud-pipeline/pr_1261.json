{"pr_number": 1261, "pr_title": "add 3153 test and update LaunchCluster tests", "pr_createdAt": "2020-08-06T08:11:08Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1261", "timeline": [{"oid": "416b226098610bbaf23e9a3d1a35ea06fcb3bc64", "url": "https://github.com/epam/cloud-pipeline/commit/416b226098610bbaf23e9a3d1a35ea06fcb3bc64", "message": "add 3153 test and update LaunchCluster tests\n\nSigned-off-by: Mariia_Tolstaia <Mariia_Tolstaia@epam.com>", "committedDate": "2020-08-05T12:56:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5OTU1Nw==", "url": "https://github.com/epam/cloud-pipeline/pull/1261#discussion_r466299557", "bodyText": "Let's extract to constant, please", "author": "kamyshova", "createdAt": "2020-08-06T09:53:03Z", "path": "e2e/gui/src/test/java/com/epam/pipeline/autotests/LaunchClusterTest.java", "diffHunk": "@@ -421,6 +442,67 @@ public void hybridAutoScaledClusterCPUDeadlock() {\n                 .ensure(STATUS, text(String.valueOf(Integer.parseInt(getRunId()) + 1)));\n     }\n \n+    @Test\n+    @TestCase({\"EPMCMBIBPC-3153\"})\n+    public void hybridAutoScaledCluster() {\n+        String cpu = library()\n+                .createPipeline(Template.SHELL, getPipelineName())\n+                .clickOnPipeline(getPipelineName())\n+                .firstVersion()\n+                .runPipeline()\n+                .setDefaultLaunchOptions()\n+                .getCPU();\n+        onLaunchPage()\n+                .enableClusterLaunch()\n+                .clusterSettingsForm(autoScaledSettingForm)\n+                .enableHybridClusterSelect()\n+                .ok()\n+                .setCommand(String.format(\"qsub -b y -pe local %s sleep 15m && sleep infinity\", Integer.parseInt(cpu) + 1))\n+                .launch(this)\n+                .shouldContainRun(getPipelineName(), getRunId())\n+                .showLog(getRunId())\n+                .expandTab(PARAMETERS)\n+                .ensure(configurationParameter(\"CP_CAP_AUTOSCALE\", \"true\"), exist)\n+                .ensure(configurationParameter(\"CP_CAP_AUTOSCALE_WORKERS\", \"1\"), exist)\n+                .ensure(configurationParameter(\"CP_CAP_AUTOSCALE_HYBRID\", \"true\"), exist)\n+                .waitForSshLink()\n+                .ssh(shell -> shell\n+                        .execute(\"qhost\")\n+                        .assertOutputContains(\"HOSTNAME\", \"global\", String.format(\"%s-%s lx-amd64\",\n+                                getPipelineName().toLowerCase(), getRunId()))\n+                        .sleep(20, SECONDS)\n+                        .execute(\"qstat\")\n+                        .assertPageContains(\"sleep\", \" 1 \")\n+                        .assertPageContains(\"sleep\", \" qw \")\n+                        .assertPageContains(\"sleep\", String.format(\" %s \", Integer.parseInt(cpu) + 1))", "originalCommit": "416b226098610bbaf23e9a3d1a35ea06fcb3bc64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ1OTkxMg==", "url": "https://github.com/epam/cloud-pipeline/pull/1261#discussion_r466459912", "bodyText": "Done", "author": "maryvictol", "createdAt": "2020-08-06T14:36:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5OTU1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5OTY3MA==", "url": "https://github.com/epam/cloud-pipeline/pull/1261#discussion_r466299670", "bodyText": "The same as above", "author": "kamyshova", "createdAt": "2020-08-06T09:53:18Z", "path": "e2e/gui/src/test/java/com/epam/pipeline/autotests/LaunchClusterTest.java", "diffHunk": "@@ -421,6 +442,67 @@ public void hybridAutoScaledClusterCPUDeadlock() {\n                 .ensure(STATUS, text(String.valueOf(Integer.parseInt(getRunId()) + 1)));\n     }\n \n+    @Test\n+    @TestCase({\"EPMCMBIBPC-3153\"})\n+    public void hybridAutoScaledCluster() {\n+        String cpu = library()\n+                .createPipeline(Template.SHELL, getPipelineName())\n+                .clickOnPipeline(getPipelineName())\n+                .firstVersion()\n+                .runPipeline()\n+                .setDefaultLaunchOptions()\n+                .getCPU();\n+        onLaunchPage()\n+                .enableClusterLaunch()\n+                .clusterSettingsForm(autoScaledSettingForm)\n+                .enableHybridClusterSelect()\n+                .ok()\n+                .setCommand(String.format(\"qsub -b y -pe local %s sleep 15m && sleep infinity\", Integer.parseInt(cpu) + 1))\n+                .launch(this)\n+                .shouldContainRun(getPipelineName(), getRunId())\n+                .showLog(getRunId())\n+                .expandTab(PARAMETERS)\n+                .ensure(configurationParameter(\"CP_CAP_AUTOSCALE\", \"true\"), exist)\n+                .ensure(configurationParameter(\"CP_CAP_AUTOSCALE_WORKERS\", \"1\"), exist)\n+                .ensure(configurationParameter(\"CP_CAP_AUTOSCALE_HYBRID\", \"true\"), exist)\n+                .waitForSshLink()\n+                .ssh(shell -> shell\n+                        .execute(\"qhost\")\n+                        .assertOutputContains(\"HOSTNAME\", \"global\", String.format(\"%s-%s lx-amd64\",\n+                                getPipelineName().toLowerCase(), getRunId()))\n+                        .sleep(20, SECONDS)\n+                        .execute(\"qstat\")\n+                        .assertPageContains(\"sleep\", \" 1 \")\n+                        .assertPageContains(\"sleep\", \" qw \")\n+                        .assertPageContains(\"sleep\", String.format(\" %s \", Integer.parseInt(cpu) + 1))\n+                        .close());\n+        String nestedRunID = navigationMenu()\n+                                .runs()\n+                                .activeRuns()\n+                                .showLog(getRunId())\n+                                .waitForNestedRunsLink()\n+                                .getNestedRunID(1);\n+        runsMenu()\n+                .activeRuns()\n+                .showLog(getRunId())\n+                .clickOnNestedRunLink()\n+                .instanceParameters(instance ->\n+                        instance.ensure(TYPE, text(C.DEFAULT_INSTANCE.substring(0, C.DEFAULT_INSTANCE.indexOf(\".\"))))\n+                        .ensure(TYPE, not(text(C.DEFAULT_INSTANCE.substring(C.DEFAULT_INSTANCE.indexOf(\".\")))))\n+                )\n+                .waitForSshLink()\n+                .ssh(shell -> shell\n+                        .execute(\"qhost\")\n+                        .assertOutputContains(\"HOSTNAME\", \"global\", String.format(\"%s-%s lx-amd64\",\n+                                getPipelineName().toLowerCase(), getRunId()), String.format(\"pipeline-%s\",\n+                                nestedRunID))\n+                        .sleep(20, SECONDS)\n+                        .execute(\"qstat\")\n+                        .assertPageContains(\"sleep\", \" r \")\n+                        .assertPageContains(\"sleep\", String.format(\"main.q@pipeline-%s\", nestedRunID))", "originalCommit": "416b226098610bbaf23e9a3d1a35ea06fcb3bc64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ2MDA1Mw==", "url": "https://github.com/epam/cloud-pipeline/pull/1261#discussion_r466460053", "bodyText": "Done", "author": "maryvictol", "createdAt": "2020-08-06T14:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5OTY3MA=="}], "type": "inlineReview"}, {"oid": "0a2403bbb035a5fb61720fbbdefceac3eb76b835", "url": "https://github.com/epam/cloud-pipeline/commit/0a2403bbb035a5fb61720fbbdefceac3eb76b835", "message": "Merge branch 'develop' into 3153_launchCluster_autotest", "committedDate": "2020-08-06T13:48:01Z", "type": "commit"}, {"oid": "cb84b9d7eb48e4622043b0592ccf0b7fb1397e92", "url": "https://github.com/epam/cloud-pipeline/commit/cb84b9d7eb48e4622043b0592ccf0b7fb1397e92", "message": "small fix LauchCluster tests\n\nSigned-off-by: Mariia_Tolstaia <Mariia_Tolstaia@epam.com>", "committedDate": "2020-08-06T14:31:46Z", "type": "commit"}]}