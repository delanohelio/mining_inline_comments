{"pr_number": 1591, "pr_title": "Issue 1404: Implemented tests for PreferenceApiService", "pr_createdAt": "2020-11-23T11:52:24Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1591", "timeline": [{"oid": "28fd36dccda37185dd35df176b68b7f9804a0f34", "url": "https://github.com/epam/cloud-pipeline/commit/28fd36dccda37185dd35df176b68b7f9804a0f34", "message": "Issue #1404: Moved PreferenceApiService to acl package, removed old tests", "committedDate": "2020-11-23T10:23:59Z", "type": "commit"}, {"oid": "b4c66c21dec3f7067e8eeb4554d225b72fd02c43", "url": "https://github.com/epam/cloud-pipeline/commit/b4c66c21dec3f7067e8eeb4554d225b72fd02c43", "message": "Issue #1404: Implemented tests for PreferenceApiService", "committedDate": "2020-11-23T10:27:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg4NjI0Mg==", "url": "https://github.com/epam/cloud-pipeline/pull/1591#discussion_r530886242", "bodyText": "Let's use PreferenceCreatorUtils.getPreference instead of constructor here.", "author": "tcibinan", "createdAt": "2020-11-26T09:27:04Z", "path": "api/src/test/java/com/epam/pipeline/acl/preference/PreferenceApiServiceTest.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.preference;\n+\n+import com.epam.pipeline.entity.preference.Preference;\n+import com.epam.pipeline.manager.preference.PreferenceManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static com.epam.pipeline.test.creator.preferences.PreferenceCreatorUtils.getPreference;\n+import static com.epam.pipeline.util.CustomAssertions.assertThrows;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.verify;\n+\n+public class PreferenceApiServiceTest extends AbstractAclTest {\n+\n+    private final Preference preference = getPreference();\n+    private final List<Preference> preferenceList = Collections.singletonList(preference);\n+\n+    @Autowired\n+    private PreferenceApiService preferenceApiService;\n+\n+    @Autowired\n+    private PreferenceManager mockPreferenceManager;\n+\n+    @Autowired\n+    private AuthManager mockAuthManager;\n+\n+    @Test\n+    public void shouldLoadAll() {\n+        doReturn(preferenceList).when(mockPreferenceManager).loadAll();\n+        doReturn(true).when(mockAuthManager).isAdmin();\n+\n+        assertThat(preferenceApiService.loadAll()).isEqualTo(preferenceList);\n+    }\n+\n+    @Test\n+    public void shouldLoadVisible() {\n+        doReturn(preferenceList).when(mockPreferenceManager).loadVisible();\n+\n+        assertThat(preferenceApiService.loadAll()).isEqualTo(preferenceList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdatePreferencesForAdmin() {\n+        doReturn(preferenceList).when(mockPreferenceManager).update(preferenceList);\n+\n+        assertThat(preferenceApiService.update(preferenceList)).isEqualTo(preferenceList);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldDenyUpdatePreferencesForNotAdmin() {\n+        assertThrows(AccessDeniedException.class, () -> preferenceApiService.update(preferenceList));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadPreferenceForAdmin() {\n+        doReturn(Optional.of(preference)).when(mockPreferenceManager).load(TEST_NAME);\n+\n+        assertThat(preferenceApiService.load(TEST_NAME)).isEqualTo(preference);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER)\n+    public void shouldLoadVisiblePreferenceForNotAdmin() {\n+        final Preference visiblePreference = new Preference();", "originalCommit": "b4c66c21dec3f7067e8eeb4554d225b72fd02c43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c3ba4e57d901de3015046709bb3889c80b91f386", "url": "https://github.com/epam/cloud-pipeline/commit/c3ba4e57d901de3015046709bb3889c80b91f386", "message": "Issue #1404: Constructor calls replaced with util methods", "committedDate": "2020-11-26T10:43:06Z", "type": "commit"}, {"oid": "5ef19d35ade5b3ea06309b0e3c5bca8b2854fbf5", "url": "https://github.com/epam/cloud-pipeline/commit/5ef19d35ade5b3ea06309b0e3c5bca8b2854fbf5", "message": "Issue #1404: ACL tests preference package - fix RunApiServiceTest", "committedDate": "2020-12-08T14:07:17Z", "type": "commit"}, {"oid": "9ff6b17ba8f189f167f52cc4d19d7764cb7457cc", "url": "https://github.com/epam/cloud-pipeline/commit/9ff6b17ba8f189f167f52cc4d19d7764cb7457cc", "message": "Merge branch 'develop' into issue_1404_implement_tests_for_acl_layer_preference", "committedDate": "2020-12-08T14:08:54Z", "type": "commit"}]}