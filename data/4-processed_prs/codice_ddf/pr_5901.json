{"pr_number": 5901, "pr_title": "DDF-5900 split interfaces and classes for security APIs", "pr_createdAt": "2020-03-16T21:29:35Z", "pr_url": "https://github.com/codice/ddf/pull/5901", "timeline": [{"oid": "77c929a8a1e2ab248991ad430ea171026ef5a597", "url": "https://github.com/codice/ddf/commit/77c929a8a1e2ab248991ad430ea171026ef5a597", "message": "DDF-5900 split interfaces and classes for security APIs", "committedDate": "2020-03-17T15:59:13Z", "type": "forcePushed"}, {"oid": "d806793c84229813d299f5bf6aa462989e7219bd", "url": "https://github.com/codice/ddf/commit/d806793c84229813d299f5bf6aa462989e7219bd", "message": "DDF-5900 split interfaces and classes for security APIs", "committedDate": "2020-03-17T16:23:04Z", "type": "forcePushed"}, {"oid": "c235d56fee430391defdfb2e6acbfd20ae36a9b8", "url": "https://github.com/codice/ddf/commit/c235d56fee430391defdfb2e6acbfd20ae36a9b8", "message": "DDF-5900 split interfaces and classes for security APIs", "committedDate": "2020-03-17T18:24:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4OTIwNQ==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r393989205", "bodyText": "\u2753 Are these error messages getting propagated to an end user? If not, can we be more specific? Otherwise, I understand the reason for being vague.", "author": "Lambeaux", "createdAt": "2020-03-17T21:46:01Z", "path": "platform/security/filter/security-filter-login/src/main/java/org/codice/ddf/security/filter/login/LoginFilter.java", "diffHunk": "@@ -124,6 +125,9 @@ public void doFilter(\n         (X509Certificate[]) httpRequest.getAttribute(\"javax.servlet.request.X509Certificate\"));\n     token.setRequestURI(httpRequest.getRequestURI());\n \n+    if (securityManager == null) {\n+      throw new AuthenticationException(\"Unable to authenticate user, system is not available.\");", "originalCommit": "c235d56fee430391defdfb2e6acbfd20ae36a9b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4OTI3Mg==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r393989272", "bodyText": "\u2753 Are these error messages getting propagated to an end user? If not, can we be more specific? Otherwise, I understand the reason for being vague.", "author": "Lambeaux", "createdAt": "2020-03-17T21:46:09Z", "path": "platform/security/filter/security-filter-login/src/main/java/org/codice/ddf/security/filter/login/LoginFilter.java", "diffHunk": "@@ -190,6 +194,9 @@ public void doFilter(\n    * @param subject Subject to attach to request\n    */\n   private void addToSession(HttpServletRequest httpRequest, Subject subject) {\n+    if (sessionFactory == null) {\n+      throw new SessionException(\"Unable to store user's session.\");", "originalCommit": "c235d56fee430391defdfb2e6acbfd20ae36a9b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4OTM0Nw==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r393989347", "bodyText": "\u2753 Are these error messages getting propagated to an end user? If not, can we be more specific? Otherwise, I understand the reason for being vague.", "author": "Lambeaux", "createdAt": "2020-03-17T21:46:19Z", "path": "platform/security/filter/security-filter-web-sso/src/main/java/org/codice/ddf/security/filter/websso/WebSSOFilter.java", "diffHunk": "@@ -208,6 +210,9 @@ private HandlerResult checkForPreviousResultOnSession(HttpServletRequest httpReq\n           Hashing.sha256().hashString(requestedSessionId, StandardCharsets.UTF_8).toString());\n     }\n     if (session == null && requestedSessionId != null) {\n+      if (sessionFactory == null) {\n+        throw new SessionException(\"Unable to verify user's session.\");", "originalCommit": "c235d56fee430391defdfb2e6acbfd20ae36a9b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ad1f46835852dc55c4870f184b3eb20fa9dc8277", "url": "https://github.com/codice/ddf/commit/ad1f46835852dc55c4870f184b3eb20fa9dc8277", "message": "DDF-5900 split interfaces and classes for security APIs", "committedDate": "2020-03-18T22:19:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5OTUyNw==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r393799527", "bodyText": "\u2753 The availability of the security manager is optional here but in code, if we don't have it set we throw an exception. Is this here so we don't have issues resolving the dependency?", "author": "blen-desta", "createdAt": "2020-03-17T16:15:04Z", "path": "platform/security/interceptor/security-interceptor-guest/src/main/resources/OSGI-INF/blueprint/blueprint.xml", "diffHunk": "@@ -17,7 +17,7 @@\n            xmlns=\"http://www.osgi.org/xmlns/blueprint/v1.0.0\"\n            xsi:schemaLocation=\"http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd\"\n >\n-    <reference id=\"securityManager\" interface=\"ddf.security.service.SecurityManager\"/>\n+    <reference id=\"securityManager\" interface=\"ddf.security.service.SecurityManager\" availability=\"optional\"/>", "originalCommit": "77c929a8a1e2ab248991ad430ea171026ef5a597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4NzQwMA==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396687400", "bodyText": "Correct. This lets the services come up independently, but if you try to use any of them before they are all done resolving things, then you will get an exception. This is how most of the services should behave. It allows for things to start up faster and resolves race conditions.", "author": "stustison", "createdAt": "2020-03-23T19:00:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5OTUyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2NzY5MA==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396767690", "bodyText": "Any reason why this is a singleton instead of an osgi service?", "author": "bakejeyner", "createdAt": "2020-03-23T21:28:21Z", "path": "platform/platform-http-proxy/src/main/java/org/codice/ddf/platform/http/proxy/HttpProxy.java", "diffHunk": "@@ -126,8 +126,8 @@ Properties getProperties() throws IOException {\n                 + CXF_CONFIG);\n     Properties properties = new Properties();\n     if (paxConfig.exists() && cxfConfig.exists()) {\n-      properties.putAll(PropertiesLoader.loadProperties(paxConfig.getAbsolutePath()));\n-      properties.putAll(PropertiesLoader.loadProperties(cxfConfig.getAbsolutePath()));\n+      properties.putAll(PropertiesLoader.getInstance().loadProperties(paxConfig.getAbsolutePath()));\n+      properties.putAll(PropertiesLoader.getInstance().loadProperties(cxfConfig.getAbsolutePath()));", "originalCommit": "ad1f46835852dc55c4870f184b3eb20fa9dc8277", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc5Njg5OA==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396796898", "bodyText": "Not really any reason. This is simply removing the duplicated PropertiesLoader that was in the security api and using the one in platform-util instead", "author": "stustison", "createdAt": "2020-03-23T22:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2NzY5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2ODkyMQ==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396768921", "bodyText": "I see the PropertiesLoader's methods toMap() and loadProperties used in conjunction a couple of times. Would it make sense to expose a new method that does both of those steps in one?", "author": "bakejeyner", "createdAt": "2020-03-23T21:30:48Z", "path": "platform/security/claims/security-claims-attributequerycommon/src/main/java/org/codice/ddf/security/claims/attributequery/common/AttributeQueryClaimsHandler.java", "diffHunk": "@@ -318,7 +318,9 @@ public void setDestination(String destination) {\n   public void setAttributeMapLocation(String attributeMapLocation) {\n     if (StringUtils.isNotBlank(attributeMapLocation)\n         && !attributeMapLocation.equals(this.attributeMapLocation)) {\n-      attributeMap = PropertiesLoader.toMap(PropertiesLoader.loadProperties(attributeMapLocation));\n+      attributeMap =\n+          PropertiesLoader.getInstance()\n+              .toMap(PropertiesLoader.getInstance().loadProperties(attributeMapLocation));", "originalCommit": "ad1f46835852dc55c4870f184b3eb20fa9dc8277", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc5NzA4OQ==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396797089", "bodyText": "It might, yeah. That'd be a different PR though.", "author": "stustison", "createdAt": "2020-03-23T22:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2ODkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2OTM1OQ==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396769359", "bodyText": "\ud83c\udf89", "author": "bakejeyner", "createdAt": "2020-03-23T21:31:41Z", "path": "platform/security/core/security-core-impl/pom.xml", "diffHunk": "@@ -140,17 +302,17 @@\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.05</minimum>\n+                                            <minimum>0.56</minimum>", "originalCommit": "ad1f46835852dc55c4870f184b3eb20fa9dc8277", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc5MTczNQ==", "url": "https://github.com/codice/ddf/pull/5901#discussion_r396791735", "bodyText": "\u2753 :nitpick: wonder why this extra newline wasn't picked up by the formatter", "author": "bakejeyner", "createdAt": "2020-03-23T22:21:01Z", "path": "platform/security/core/security-core-impl/src/test/groovy/ddf/security/samlp/impl/EntityInformationSpec.groovy", "diffHunk": "@@ -1,14 +1,14 @@\n package ddf.security.samlp.impl\n \n-import ddf.security.samlp.MetadataConfigurationParser\n+", "originalCommit": "ad1f46835852dc55c4870f184b3eb20fa9dc8277", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e01055746977f6a3cf52097450c85e12612fd68f", "url": "https://github.com/codice/ddf/commit/e01055746977f6a3cf52097450c85e12612fd68f", "message": "DDF-5900 split interfaces and classes for security APIs", "committedDate": "2020-03-26T19:43:17Z", "type": "commit"}, {"oid": "e01055746977f6a3cf52097450c85e12612fd68f", "url": "https://github.com/codice/ddf/commit/e01055746977f6a3cf52097450c85e12612fd68f", "message": "DDF-5900 split interfaces and classes for security APIs", "committedDate": "2020-03-26T19:43:17Z", "type": "forcePushed"}]}