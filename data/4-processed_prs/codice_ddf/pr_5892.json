{"pr_number": 5892, "pr_title": "[2.19.x] DDF-UI-111 Fixed drawn geometries and result geometries over anti-meridian", "pr_createdAt": "2020-03-11T17:31:39Z", "pr_url": "https://github.com/codice/ddf/pull/5892", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzODgyNw==", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391638827", "bodyText": "what do you need this negative local variable for? I think the logic would still be the same if you got rid of it", "author": "cassandrabailey293", "createdAt": "2020-03-12T13:58:42Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -78,24 +78,47 @@ const GeometryView = Marionette.ItemView.extend({\n       this.stopListening(this.options.clusterCollection)\n     }\n   },\n+  adjustPoints(type, coordinates) {\n+    coordinates.forEach((coord, index) => {\n+      if(index + 1 < coordinates.length) {\n+        let negative = false", "originalCommit": "6bbd072fff6e8e393a192bd28a06adc78392f968", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTM0OQ==", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391639349", "bodyText": "\u270f\ufe0f maybe we can take this commented line out?", "author": "cassandrabailey293", "createdAt": "2020-03-12T13:59:29Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -78,24 +78,47 @@ const GeometryView = Marionette.ItemView.extend({\n       this.stopListening(this.options.clusterCollection)\n     }\n   },\n+  adjustPoints(type, coordinates) {\n+    coordinates.forEach((coord, index) => {\n+      if(index + 1 < coordinates.length) {\n+        let negative = false\n+        const east = Number(coordinates[index + 1][0])\n+        const west = Number(coordinates[index][0])\n+        if(east - west < -180) {\n+          negative = true\n+          coordinates[index + 1][0] = east + 360\n+        } else if(!negative && east - west > 180) {\n+          coordinates[index][0] = west + 360\n+        }\n+      }\n+    })\n+    // If the geo is a polygon, ensure that the first and last coordinate are the same\n+    if(type.includes('Polygon')) {\n+      coordinates[0][0] = coordinates[coordinates.length - 1][0]\n+    }\n+    return coordinates\n+  },\n   handleGeometry(geometry) {\n     switch (geometry.type) {\n       case 'Point':\n         this.handlePoint(geometry.coordinates)\n         break\n       case 'Polygon':\n         geometry.coordinates.forEach(polygon => {\n+          polygon = this.adjustPoints(geometry.type, polygon)\n           this.handlePoint(polygon[0])\n           this.handleLine(polygon)\n           //this.handlePolygon(polygon);", "originalCommit": "6bbd072fff6e8e393a192bd28a06adc78392f968", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTc0Ng==", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391639746", "bodyText": "though it seems odd that case Polygon would not be calling handlePolygon", "author": "cassandrabailey293", "createdAt": "2020-03-12T14:00:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0MDA4Ng==", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391640086", "bodyText": "\u270f\ufe0f same question about getting rid of the commented out line", "author": "cassandrabailey293", "createdAt": "2020-03-12T14:00:31Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -108,6 +131,7 @@ const GeometryView = Marionette.ItemView.extend({\n       case 'MultiPolygon':\n         geometry.coordinates.forEach(multipolygon => {\n           multipolygon.forEach(polygon => {\n+            polygon = this.adjustPoints(geometry.type, polygon)\n             this.handlePoint(polygon[0])\n             this.handleLine(polygon)\n             //this.handlePolygon(polygon);", "originalCommit": "6bbd072fff6e8e393a192bd28a06adc78392f968", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "90ae2707cd2fb9810191ce54b3e7f37a601272f1", "url": "https://github.com/codice/ddf/commit/90ae2707cd2fb9810191ce54b3e7f37a601272f1", "message": "DDF-UI-111 fixed drawn geometries and result geometries over antimeridian", "committedDate": "2020-03-16T21:55:24Z", "type": "commit"}, {"oid": "1f057e39cc105b43f0b613fb41e46d7c642565b6", "url": "https://github.com/codice/ddf/commit/1f057e39cc105b43f0b613fb41e46d7c642565b6", "message": "address comments and format", "committedDate": "2020-03-16T22:30:16Z", "type": "commit"}, {"oid": "1f057e39cc105b43f0b613fb41e46d7c642565b6", "url": "https://github.com/codice/ddf/commit/1f057e39cc105b43f0b613fb41e46d7c642565b6", "message": "address comments and format", "committedDate": "2020-03-16T22:30:16Z", "type": "forcePushed"}]}