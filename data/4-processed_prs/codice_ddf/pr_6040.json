{"pr_number": 6040, "pr_title": "[2.19.x] DDF-UI-199 Added error messaging for west = east", "pr_createdAt": "2020-05-04T19:44:55Z", "pr_url": "https://github.com/codice/ddf/pull/6040", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5NjM0NQ==", "url": "https://github.com/codice/ddf/pull/6040#discussion_r420396345", "bodyText": "can we split up this triple ternary for readability?", "author": "bdeining", "createdAt": "2020-05-05T20:48:03Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/utils/validation/validation.tsx", "diffHunk": "@@ -270,68 +271,134 @@ function validateLinePolygon(mode: string, currentValue: string) {\n   }\n }\n \n-function validateBoundingBox(value: any) {\n-  let north\n-  let south\n-  if (value.isDms) {\n-    const coordinateNorth = parseDmsCoordinate(value.north)\n-    const coordinateSouth = parseDmsCoordinate(value.south)\n-    north = coordinateNorth\n-      ? dmsCoordinateToDD({\n-          ...coordinateNorth,\n-          direction: value.dmsNorthDirection,\n-        })\n-      : null\n-    south = coordinateSouth\n-      ? dmsCoordinateToDD({\n-          ...coordinateSouth,\n-          direction: value.dmsSouthDirection,\n-        })\n-      : null\n-  } else if (value.isUsng) {\n-    const upperLeftCoord = converter.USNGtoLL(value.upperLeft, true)\n-    const lowerRightCoord = converter.USNGtoLL(value.lowerRight, true)\n-    north = upperLeftCoord.lat\n-    south = lowerRightCoord.lat\n-  } else if (value.isUtmUps) {\n-    let northPole = value.upperLeft.hemisphere.toUpperCase() === 'NORTHERN'\n-    const upperLeftParts = {\n-      easting: parseFloat(value.upperLeft.easting),\n-      northing: parseFloat(value.upperLeft.northing),\n-      zoneNumber: value.upperLeft.zoneNumber,\n-      hemisphere: value.upperLeft.hemisphere,\n-      northPole,\n-    }\n-    upperLeftParts.northing =\n-      upperLeftParts.zoneNumber === 0 || northPole\n-        ? upperLeftParts.northing\n-        : upperLeftParts.northing - NORTHING_OFFSET\n-    north = Number(converter.UTMUPStoLL(upperLeftParts).lat.toFixed(5))\n-    northPole = value.lowerRight.hemisphere.toUpperCase() === 'NORTHERN'\n-    const lowerRightParts = {\n-      easting: parseFloat(value.lowerRight.easting),\n-      northing: parseFloat(value.lowerRight.northing),\n-      zoneNumber: value.lowerRight.zoneNumber,\n-      hemisphere: value.lowerRight.hemisphere,\n-      northPole,\n+function getDdCoords(value: any) {\n+  return {\n+    north: Number(value.north),\n+    south: Number(value.south),\n+    west: Number(value.west),\n+    east: Number(value.east),\n+  }\n+}\n+\n+function getDmsCoords(value: any) {\n+  const coordinateNorth = parseDmsCoordinate(value.north)\n+  const coordinateSouth = parseDmsCoordinate(value.south)\n+  const coordinateWest = parseDmsCoordinate(value.west)\n+  const coordinateEast = parseDmsCoordinate(value.east)\n+  let north, south, west, east\n+  if (coordinateNorth) {\n+    north = dmsCoordinateToDD({\n+      ...coordinateNorth,\n+      direction: value.dmsNorthDirection,\n+    })\n+  }\n+  if (coordinateSouth) {\n+    south = dmsCoordinateToDD({\n+      ...coordinateSouth,\n+      direction: value.dmsSouthDirection,\n+    })\n+  }\n+  if (coordinateWest) {\n+    west = dmsCoordinateToDD({\n+      ...coordinateWest,\n+      direction: value.dmsWestDirection,\n+    })\n+  }\n+  if (coordinateEast) {\n+    east = dmsCoordinateToDD({\n+      ...coordinateEast,\n+      direction: value.dmsEastDirection,\n+    })\n+  }\n+  return { north, south, west, east }\n+}\n+\n+function getUsngCoords(upperLeft: any, lowerRight: any) {\n+  const upperLeftCoord = converter.USNGtoLL(upperLeft, true)\n+  const lowerRightCoord = converter.USNGtoLL(lowerRight, true)\n+  return {\n+    north: upperLeftCoord.lat.toFixed(5),\n+    south: lowerRightCoord.lat.toFixed(5),\n+    west: upperLeftCoord.lon.toFixed(5),\n+    east: lowerRightCoord.lon.toFixed(5),\n+  }\n+}\n+\n+function getUtmUpsCoords(upperLeft: any, lowerRight: any) {\n+  const upperLeftParts = {\n+    easting: parseFloat(upperLeft.easting),\n+    northing: parseFloat(upperLeft.northing),\n+    zoneNumber: upperLeft.zoneNumber,\n+    hemisphere: upperLeft.hemisphere,\n+    northPole: upperLeft.hemisphere.toUpperCase() === 'NORTHERN',\n+  }\n+  const lowerRightParts = {\n+    easting: parseFloat(lowerRight.easting),\n+    northing: parseFloat(lowerRight.northing),\n+    zoneNumber: lowerRight.zoneNumber,\n+    hemisphere: lowerRight.hemisphere,\n+    northPole: lowerRight.hemisphere.toUpperCase() === 'NORTHERN',\n+  }\n+  upperLeftParts.northing =\n+    upperLeftParts.zoneNumber === 0 || upperLeftParts.northPole\n+      ? upperLeftParts.northing\n+      : upperLeftParts.northing - NORTHING_OFFSET\n+  lowerRightParts.northing =\n+    lowerRightParts.zoneNumber === 0 || lowerRightParts.northPole\n+      ? lowerRightParts.northing\n+      : lowerRightParts.northing - NORTHING_OFFSET\n+  const north = Number(converter.UTMUPStoLL(upperLeftParts).lat.toFixed(5))\n+  const south = Number(converter.UTMUPStoLL(lowerRightParts).lat.toFixed(5))\n+  const west = Number(converter.UTMUPStoLL(upperLeftParts).lon.toFixed(5))\n+  const east = Number(converter.UTMUPStoLL(lowerRightParts).lon.toFixed(5))\n+  return { north, south, west, east }\n+}\n+\n+function validateLatitudes(north: any, south: any, isUsngOrUtmUps: boolean) {\n+  if (!isNaN(south) && !isNaN(north) && south >= north) {\n+    return {\n+      error: true,\n+      message: isUsngOrUtmUps\n+        ? 'Upper left coordinate must be located above lower right coordinate'\n+        : 'North value must be greater than south value',\n     }\n-    lowerRightParts.northing =\n-      lowerRightParts.zoneNumber === 0 || northPole\n-        ? lowerRightParts.northing\n-        : lowerRightParts.northing - NORTHING_OFFSET\n-    south = Number(converter.UTMUPStoLL(lowerRightParts).lat.toFixed(5))\n-  } else {\n-    north = Number(value.north)\n-    south = Number(value.south)\n   }\n-  if (south !== null && north !== null && south >= north) {\n+  return initialErrorState\n+}\n+\n+function validateLongitudes(west: any, east: any, isUsngOrUtmUps: boolean) {\n+  if (!isNaN(west) && !isNaN(east) && west === east) {\n     return {\n       error: true,\n-      message:\n-        value.isUsng || value.isUtmUps\n-          ? 'Upper left coordinate must be located above lower right coordinate'\n-          : 'North value must be greater than south value',\n+      message: isUsngOrUtmUps\n+        ? 'Left bound cannot equal right bound'\n+        : 'West value cannot equal east value',\n+    }\n+  }\n+  return initialErrorState\n+}\n+\n+function validateBoundingBox(key: string, value: any) {\n+  const { north, south, west, east } = value.isDms\n+    ? getDmsCoords(value)", "originalCommit": "309fc0cf7b3559ab314929be415ec466c65ad349", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3MDAwMw==", "url": "https://github.com/codice/ddf/pull/6040#discussion_r421670003", "bodyText": "\u2753 why is validateLongitudes being called here?", "author": "cassandrabailey293", "createdAt": "2020-05-07T17:25:18Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/utils/validation/validation.tsx", "diffHunk": "@@ -270,68 +271,134 @@ function validateLinePolygon(mode: string, currentValue: string) {\n   }\n }\n \n-function validateBoundingBox(value: any) {\n-  let north\n-  let south\n-  if (value.isDms) {\n-    const coordinateNorth = parseDmsCoordinate(value.north)\n-    const coordinateSouth = parseDmsCoordinate(value.south)\n-    north = coordinateNorth\n-      ? dmsCoordinateToDD({\n-          ...coordinateNorth,\n-          direction: value.dmsNorthDirection,\n-        })\n-      : null\n-    south = coordinateSouth\n-      ? dmsCoordinateToDD({\n-          ...coordinateSouth,\n-          direction: value.dmsSouthDirection,\n-        })\n-      : null\n-  } else if (value.isUsng) {\n-    const upperLeftCoord = converter.USNGtoLL(value.upperLeft, true)\n-    const lowerRightCoord = converter.USNGtoLL(value.lowerRight, true)\n-    north = upperLeftCoord.lat\n-    south = lowerRightCoord.lat\n-  } else if (value.isUtmUps) {\n-    let northPole = value.upperLeft.hemisphere.toUpperCase() === 'NORTHERN'\n-    const upperLeftParts = {\n-      easting: parseFloat(value.upperLeft.easting),\n-      northing: parseFloat(value.upperLeft.northing),\n-      zoneNumber: value.upperLeft.zoneNumber,\n-      hemisphere: value.upperLeft.hemisphere,\n-      northPole,\n-    }\n-    upperLeftParts.northing =\n-      upperLeftParts.zoneNumber === 0 || northPole\n-        ? upperLeftParts.northing\n-        : upperLeftParts.northing - NORTHING_OFFSET\n-    north = Number(converter.UTMUPStoLL(upperLeftParts).lat.toFixed(5))\n-    northPole = value.lowerRight.hemisphere.toUpperCase() === 'NORTHERN'\n-    const lowerRightParts = {\n-      easting: parseFloat(value.lowerRight.easting),\n-      northing: parseFloat(value.lowerRight.northing),\n-      zoneNumber: value.lowerRight.zoneNumber,\n-      hemisphere: value.lowerRight.hemisphere,\n-      northPole,\n+function getDdCoords(value: any) {\n+  return {\n+    north: Number(value.north),\n+    south: Number(value.south),\n+    west: Number(value.west),\n+    east: Number(value.east),\n+  }\n+}\n+\n+function getDmsCoords(value: any) {\n+  const coordinateNorth = parseDmsCoordinate(value.north)\n+  const coordinateSouth = parseDmsCoordinate(value.south)\n+  const coordinateWest = parseDmsCoordinate(value.west)\n+  const coordinateEast = parseDmsCoordinate(value.east)\n+  let north, south, west, east\n+  if (coordinateNorth) {\n+    north = dmsCoordinateToDD({\n+      ...coordinateNorth,\n+      direction: value.dmsNorthDirection,\n+    })\n+  }\n+  if (coordinateSouth) {\n+    south = dmsCoordinateToDD({\n+      ...coordinateSouth,\n+      direction: value.dmsSouthDirection,\n+    })\n+  }\n+  if (coordinateWest) {\n+    west = dmsCoordinateToDD({\n+      ...coordinateWest,\n+      direction: value.dmsWestDirection,\n+    })\n+  }\n+  if (coordinateEast) {\n+    east = dmsCoordinateToDD({\n+      ...coordinateEast,\n+      direction: value.dmsEastDirection,\n+    })\n+  }\n+  return { north, south, west, east }\n+}\n+\n+function getUsngCoords(upperLeft: any, lowerRight: any) {\n+  const upperLeftCoord = converter.USNGtoLL(upperLeft, true)\n+  const lowerRightCoord = converter.USNGtoLL(lowerRight, true)\n+  return {\n+    north: upperLeftCoord.lat.toFixed(5),\n+    south: lowerRightCoord.lat.toFixed(5),\n+    west: upperLeftCoord.lon.toFixed(5),\n+    east: lowerRightCoord.lon.toFixed(5),\n+  }\n+}\n+\n+function getUtmUpsCoords(upperLeft: any, lowerRight: any) {\n+  const upperLeftParts = {\n+    easting: parseFloat(upperLeft.easting),\n+    northing: parseFloat(upperLeft.northing),\n+    zoneNumber: upperLeft.zoneNumber,\n+    hemisphere: upperLeft.hemisphere,\n+    northPole: upperLeft.hemisphere.toUpperCase() === 'NORTHERN',\n+  }\n+  const lowerRightParts = {\n+    easting: parseFloat(lowerRight.easting),\n+    northing: parseFloat(lowerRight.northing),\n+    zoneNumber: lowerRight.zoneNumber,\n+    hemisphere: lowerRight.hemisphere,\n+    northPole: lowerRight.hemisphere.toUpperCase() === 'NORTHERN',\n+  }\n+  upperLeftParts.northing =\n+    upperLeftParts.zoneNumber === 0 || upperLeftParts.northPole\n+      ? upperLeftParts.northing\n+      : upperLeftParts.northing - NORTHING_OFFSET\n+  lowerRightParts.northing =\n+    lowerRightParts.zoneNumber === 0 || lowerRightParts.northPole\n+      ? lowerRightParts.northing\n+      : lowerRightParts.northing - NORTHING_OFFSET\n+  const north = Number(converter.UTMUPStoLL(upperLeftParts).lat.toFixed(5))\n+  const south = Number(converter.UTMUPStoLL(lowerRightParts).lat.toFixed(5))\n+  const west = Number(converter.UTMUPStoLL(upperLeftParts).lon.toFixed(5))\n+  const east = Number(converter.UTMUPStoLL(lowerRightParts).lon.toFixed(5))\n+  return { north, south, west, east }\n+}\n+\n+function validateLatitudes(north: any, south: any, isUsngOrUtmUps: boolean) {\n+  if (!isNaN(south) && !isNaN(north) && south >= north) {\n+    return {\n+      error: true,\n+      message: isUsngOrUtmUps\n+        ? 'Upper left coordinate must be located above lower right coordinate'\n+        : 'North value must be greater than south value',\n     }\n-    lowerRightParts.northing =\n-      lowerRightParts.zoneNumber === 0 || northPole\n-        ? lowerRightParts.northing\n-        : lowerRightParts.northing - NORTHING_OFFSET\n-    south = Number(converter.UTMUPStoLL(lowerRightParts).lat.toFixed(5))\n-  } else {\n-    north = Number(value.north)\n-    south = Number(value.south)\n   }\n-  if (south !== null && north !== null && south >= north) {\n+  return initialErrorState\n+}\n+\n+function validateLongitudes(west: any, east: any, isUsngOrUtmUps: boolean) {\n+  if (!isNaN(west) && !isNaN(east) && west === east) {\n     return {\n       error: true,\n-      message:\n-        value.isUsng || value.isUtmUps\n-          ? 'Upper left coordinate must be located above lower right coordinate'\n-          : 'North value must be greater than south value',\n+      message: isUsngOrUtmUps\n+        ? 'Left bound cannot equal right bound'\n+        : 'West value cannot equal east value',\n+    }\n+  }\n+  return initialErrorState\n+}\n+\n+function validateBoundingBox(key: string, value: any) {\n+  const { north, south, west, east } = value.isDms\n+    ? getDmsCoords(value)\n+    : value.isUsng\n+      ? getUsngCoords(value.upperLeft, value.lowerRight)\n+      : value.isUtmUps\n+        ? getUtmUpsCoords(value.upperLeft, value.lowerRight)\n+        : getDdCoords(value)\n+  const isUsngOrUtmUps = value.isUsng || value.isUtmUps\n+  if (key.toLowerCase().includes('lon')) {\n+    const { error, message } = validateLongitudes(west, east, isUsngOrUtmUps)\n+    if (error) {\n+      return { error, message }\n+    }\n+    return validateLatitudes(north, south, isUsngOrUtmUps)\n+  } else {\n+    const { error, message } = validateLatitudes(north, south, isUsngOrUtmUps)\n+    if (error) {\n+      return { error, message }\n     }\n+    return validateLongitudes(west, east, isUsngOrUtmUps)", "originalCommit": "309fc0cf7b3559ab314929be415ec466c65ad349", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0NTM2Ng==", "url": "https://github.com/codice/ddf/pull/6040#discussion_r422245366", "bodyText": "If the key is 'lat' but there are no issues with the latitudes, we still want to display an error message if east = west, which is what validateLongitudes checks for", "author": "hayleynorton", "createdAt": "2020-05-08T16:38:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3MDAwMw=="}], "type": "inlineReview"}, {"oid": "ea0f96261b5e5d2515130fc65e6a819a12b19758", "url": "https://github.com/codice/ddf/commit/ea0f96261b5e5d2515130fc65e6a819a12b19758", "message": "DDF-UI-199 added error messaging for west = east", "committedDate": "2020-05-11T16:17:26Z", "type": "commit"}, {"oid": "883b22d3d86ba22d85c6802d2a54c3bd84c04e10", "url": "https://github.com/codice/ddf/commit/883b22d3d86ba22d85c6802d2a54c3bd84c04e10", "message": "DDF-UI-199 addressed comments", "committedDate": "2020-05-11T16:17:27Z", "type": "commit"}, {"oid": "883b22d3d86ba22d85c6802d2a54c3bd84c04e10", "url": "https://github.com/codice/ddf/commit/883b22d3d86ba22d85c6802d2a54c3bd84c04e10", "message": "DDF-UI-199 addressed comments", "committedDate": "2020-05-11T16:17:27Z", "type": "forcePushed"}, {"oid": "8dcfa80c9fb49a40c11a26b83ea36c01f3187b2e", "url": "https://github.com/codice/ddf/commit/8dcfa80c9fb49a40c11a26b83ea36c01f3187b2e", "message": "DDF-UI-199 added opposite set of coords to validation calls", "committedDate": "2020-05-11T21:49:30Z", "type": "commit"}]}