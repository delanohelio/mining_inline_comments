{"pr_number": 5806, "pr_title": "[2.19.x] DDF-5495 refactor extension for Table Export behavior", "pr_createdAt": "2020-01-30T00:41:26Z", "pr_url": "https://github.com/codice/ddf/pull/5806", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk5OTg2Mw==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r372999863", "bodyText": "\u2753 Do we still need EndpointUtil in this class?", "author": "cassandrabailey293", "createdAt": "2020-01-30T15:00:52Z", "path": "catalog/ui/catalog-ui-search/src/main/java/org/codice/ddf/catalog/ui/query/handlers/CqlTransformHandler.java", "diffHunk": "@@ -38,8 +38,9 @@\n import org.apache.tika.mime.MimeTypeException;\n import org.apache.tika.mime.MimeTypes;\n import org.codice.ddf.catalog.ui.metacard.transform.CsvTransform;\n-import org.codice.ddf.catalog.ui.query.cql.CqlQueryResponse;\n-import org.codice.ddf.catalog.ui.query.cql.CqlRequest;\n+import org.codice.ddf.catalog.ui.query.utility.CqlQueryResponse;\n+import org.codice.ddf.catalog.ui.query.utility.CqlRequest;\n+import org.codice.ddf.catalog.ui.util.CqlQueryUtil;\n import org.codice.ddf.catalog.ui.util.EndpointUtil;", "originalCommit": "1777c3ac350e61be0512a170ec862bb5b8ba86e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA3ODUyMQ==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r373078521", "bodyText": "yeah other functions from endpointUtil are used https://github.com/codice/ddf/pull/5806/files/1777c3ac350e61be0512a170ec862bb5b8ba86e3#diff-cc5f97af83867437776fddd13f08d36bR124", "author": "andrewzimmer", "createdAt": "2020-01-30T17:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk5OTg2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNjM4Mg==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r373026382", "bodyText": "missing copyright headers", "author": "bdeining", "createdAt": "2020-01-30T15:43:01Z", "path": "catalog/ui/catalog-ui-search-api/src/main/java/org/codice/ddf/catalog/ui/query/utility/MetacardAttribute.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package org.codice.ddf.catalog.ui.query.utility;\n+", "originalCommit": "1777c3ac350e61be0512a170ec862bb5b8ba86e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA3Nzg5Mw==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r373077893", "bodyText": "added", "author": "andrewzimmer", "createdAt": "2020-01-30T17:08:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNjM4Mg=="}], "type": "inlineReview"}, {"oid": "7d2698f07f7e0ab8b15495497c12b847ecb3a355", "url": "https://github.com/codice/ddf/commit/7d2698f07f7e0ab8b15495497c12b847ecb3a355", "message": "DDF-5495 refactor extension for Table Export behavior", "committedDate": "2020-01-31T20:52:48Z", "type": "commit"}, {"oid": "df3df0ab609b734e6ab3e4ddb724cf4218c2b607", "url": "https://github.com/codice/ddf/commit/df3df0ab609b734e6ab3e4ddb724cf4218c2b607", "message": "DDF-5495 add headers", "committedDate": "2020-01-31T20:52:48Z", "type": "commit"}, {"oid": "cc289002388eefcfb65cb001712293e98c9796ab", "url": "https://github.com/codice/ddf/commit/cc289002388eefcfb65cb001712293e98c9796ab", "message": "DDF-5495 rebase", "committedDate": "2020-01-31T21:46:52Z", "type": "commit"}, {"oid": "cc289002388eefcfb65cb001712293e98c9796ab", "url": "https://github.com/codice/ddf/commit/cc289002388eefcfb65cb001712293e98c9796ab", "message": "DDF-5495 rebase", "committedDate": "2020-01-31T21:46:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwNjY1NA==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r374406654", "bodyText": "we might want to mark the interfaces as experimental\n\n  \n    \n      ddf/catalog/core/catalog-core-attachment/src/main/java/org/codice/ddf/attachment/AttachmentInfo.java\n    \n    \n         Line 18\n      in\n      b054ac2\n    \n    \n    \n    \n\n        \n          \n           /**", "author": "bdeining", "createdAt": "2020-02-03T23:50:22Z", "path": "catalog/ui/catalog-ui-search-api/src/main/java/org/codice/ddf/catalog/ui/query/utility/CqlQueryResponse.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package org.codice.ddf.catalog.ui.query.utility;\n+\n+import ddf.catalog.operation.QueryResponse;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+public interface CqlQueryResponse {", "originalCommit": "cc289002388eefcfb65cb001712293e98c9796ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyODMyMA==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r374828320", "bodyText": "\u2753 How about CqlQueries and CqlQueriesImpl instead? It's minor but this will surprise anyone not familiar with Java conventions.", "author": "Lambeaux", "createdAt": "2020-02-04T17:55:53Z", "path": "catalog/ui/catalog-ui-search/src/main/java/org/codice/ddf/catalog/ui/util/CqlQueryUtil.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package org.codice.ddf.catalog.ui.util;\n+\n+import com.google.common.base.Stopwatch;\n+import ddf.action.ActionRegistry;\n+import ddf.catalog.CatalogFramework;\n+import ddf.catalog.data.Result;\n+import ddf.catalog.federation.FederationException;\n+import ddf.catalog.filter.FilterAdapter;\n+import ddf.catalog.filter.FilterBuilder;\n+import ddf.catalog.operation.QueryRequest;\n+import ddf.catalog.operation.QueryResponse;\n+import ddf.catalog.operation.impl.QueryResponseImpl;\n+import ddf.catalog.source.SourceUnavailableException;\n+import ddf.catalog.source.UnsupportedQueryException;\n+import ddf.catalog.util.impl.QueryFunction;\n+import ddf.catalog.util.impl.ResultIterable;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+import org.codice.ddf.catalog.ui.query.cql.CqlQueryResponseImpl;\n+import org.codice.ddf.catalog.ui.query.utility.CqlQueryResponse;\n+import org.codice.ddf.catalog.ui.query.utility.CqlQueryUtility;\n+import org.codice.ddf.catalog.ui.query.utility.CqlRequest;\n+import org.codice.ddf.catalog.ui.transformer.TransformerDescriptors;\n+\n+public class CqlQueryUtil implements CqlQueryUtility {", "originalCommit": "cc289002388eefcfb65cb001712293e98c9796ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyOTA1Mw==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r374829053", "bodyText": "\ud83d\udc4d Nice. Splitting this stuff up helps us be more selective about what we depend on.", "author": "Lambeaux", "createdAt": "2020-02-04T17:57:14Z", "path": "catalog/ui/catalog-ui-search/src/main/resources/OSGI-INF/blueprint/provides.xml", "diffHunk": "@@ -33,7 +33,11 @@ Services (OSGi) that catalog-ui-search PROVIDES to DDF\n \n     <!-- Exposing endpoint util as a service to allow for system templates to be managed through\n     the means of a Karaf command (reference injection) -->\n-    <service ref=\"endpointUtil\" interface=\"org.codice.ddf.catalog.ui.api.EndpointUtility\"/>\n+    <service ref=\"endpointUtil\"\n+             interface=\"org.codice.ddf.catalog.ui.query.utility.EndpointUtility\"/>\n+\n+    <service ref=\"cqlQueryUtil\"\n+             interface=\"org.codice.ddf.catalog.ui.query.utility.CqlQueryUtility\"/>", "originalCommit": "cc289002388eefcfb65cb001712293e98c9796ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyOTYzNQ==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r374829635", "bodyText": "\ud83d\udc4d Nice. Splitting stuff up also makes wiring things together for unit / component tests a lot easier. We were able to kill two arguments here.", "author": "Lambeaux", "createdAt": "2020-02-04T17:58:21Z", "path": "catalog/ui/catalog-ui-search/src/test/java/org/codice/ddf/catalog/ui/forms/SearchFormsSymbolsIT.java", "diffHunk": "@@ -158,8 +158,6 @@\n           FILTER_BUILDER,\n           null, // No interaction\n           null, // No interaction\n-          null, // No interaction\n-          null, // No interaction", "originalCommit": "cc289002388eefcfb65cb001712293e98c9796ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgzNjE5NA==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r374836194", "bodyText": "\u2753 Are these absolutely necessary dependencies for the API? I know we use some Geotools interfaces but does that require the entire suite? Also, what Spark classes are we using in our APIs? If possible we should write the interfaces such that none of these (with the exception of the core Geotools interfaces) are used (but they're fine in the impl).", "author": "Lambeaux", "createdAt": "2020-02-04T18:11:24Z", "path": "catalog/ui/catalog-ui-search-api/pom.xml", "diffHunk": "@@ -38,6 +38,16 @@\n             <artifactId>platform-util</artifactId>\n             <version>${project.version}</version>\n         </dependency>\n+        <dependency>\n+            <groupId>org.codice.thirdparty</groupId>\n+            <artifactId>geotools-suite</artifactId>\n+            <version>${org.geotools.bundle.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.sparkjava</groupId>\n+            <artifactId>spark-core</artifactId>\n+            <version>${spark.version}</version>\n+        </dependency>", "originalCommit": "cc289002388eefcfb65cb001712293e98c9796ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "488526f1e0d04a426f9b121488e15242cf55b1c8", "url": "https://github.com/codice/ddf/commit/488526f1e0d04a426f9b121488e15242cf55b1c8", "message": "DDF-5495 address comments", "committedDate": "2020-02-04T21:07:28Z", "type": "commit"}, {"oid": "7bc6e1c6e05715e408f2ea6e48312fce09c755e4", "url": "https://github.com/codice/ddf/commit/7bc6e1c6e05715e408f2ea6e48312fce09c755e4", "message": "DDF-5495 refactor CqlRequest", "committedDate": "2020-02-05T02:09:59Z", "type": "commit"}, {"oid": "98afa25dfdaf73ea793727460046aaccbd24031f", "url": "https://github.com/codice/ddf/commit/98afa25dfdaf73ea793727460046aaccbd24031f", "message": "DDF-5495 move CsvTransform to api", "committedDate": "2020-02-06T19:14:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA2OTg3MA==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r376069870", "bodyText": "\ud83d\udc4d Nice! I noticed the dependencies in this pom are gone.", "author": "Lambeaux", "createdAt": "2020-02-06T20:40:12Z", "path": "catalog/ui/catalog-ui-search-api/pom.xml", "diffHunk": "@@ -56,7 +56,8 @@\n                         <Export-Package>\n                             org.codice.ddf.catalog.ui.metacard.workspace.transformer,\n                             org.codice.ddf.catalog.ui.splitter,\n-                            org.codice.ddf.catalog.ui.subscription\n+                            org.codice.ddf.catalog.ui.subscription,\n+                            org.codice.ddf.catalog.ui.query.utility", "originalCommit": "98afa25dfdaf73ea793727460046aaccbd24031f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MTY4OA==", "url": "https://github.com/codice/ddf/pull/5806#discussion_r376071688", "bodyText": "\ud83d\udc4d", "author": "Lambeaux", "createdAt": "2020-02-06T20:44:14Z", "path": "catalog/ui/catalog-ui-search/pom.xml", "diffHunk": "@@ -465,9 +465,6 @@\n                         <Export-Package>\n                             org.codice.ddf.catalog.ui.metacard.internal,\n                             org.codice.ddf.catalog.ui.alias,\n-                            org.codice.ddf.catalog.ui.api,\n-                            org.codice.ddf.catalog.ui.query.cql,\n-                            org.codice.ddf.catalog.ui.metacard.transform,", "originalCommit": "98afa25dfdaf73ea793727460046aaccbd24031f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}