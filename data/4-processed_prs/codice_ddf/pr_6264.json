{"pr_number": 6264, "pr_title": "Upgrade to Solr 8.6.1", "pr_createdAt": "2020-08-25T00:00:33Z", "pr_url": "https://github.com/codice/ddf/pull/6264", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxODk1NQ==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476018955", "bodyText": "\u270f\ufe0f  ... You may have to ** enable ** file sharing... instead of past tense.", "author": "Lambeaux", "createdAt": "2020-08-25T00:58:10Z", "path": "distribution/docker/solrcloud/README.md", "diffHunk": "@@ -1,22 +1,31 @@\n # DDF SolrCloud Docker Compose\n-This docker compose will start one Zookeeper and two DDF compatible SolrCloud nodes exposed to the local host.\n+Docker compose will start one Zookeeper and two DDF compatible SolrCloud nodes exposed to the local host.\n \n ## How to use this\n \n-Note: You may be asked to enabled file sharing in Docker with this directory on Windows or MacOS.\n-\n-To run:\n-```\n-docker-compose up\n-```\n+Note: You may have to enabled file sharing in Docker with this directory on Windows or MacOS.", "originalCommit": "6f9c7b2791d4c65154fe2233195589d9d86ac811", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc3MjIwNA==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476772204", "bodyText": "That is what I get for tweaking the sentence last minute but not rereading the whole sentence after doing that.", "author": "pklinef", "createdAt": "2020-08-25T21:51:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxODk1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyMzUzMQ==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476023531", "bodyText": "\u2753 Just want to ensure I'm understanding this correctly. The docker-maven-plugin is handling the interpolation of these props right?", "author": "Lambeaux", "createdAt": "2020-08-25T01:05:06Z", "path": "distribution/docker/solr-docker/src/main/docker/Dockerfile", "diffHunk": "@@ -13,7 +13,7 @@ RUN unzip /jars/solr-schema-${project.version}.jar -d /prep\n # Final Image Stage\n FROM solr:${solr.version}\n # Copy solr libs\n-COPY maven/jts-core-1.15.0.jar /opt/solr/server/solr-webapp/webapp/WEB-INF/lib/\n+COPY maven/jts-core-${jts.spatial4j.version}.jar /opt/solr/server/solr-webapp/webapp/WEB-INF/lib/", "originalCommit": "6f9c7b2791d4c65154fe2233195589d9d86ac811", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2ODg5Ng==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476768896", "bodyText": "That is correct.", "author": "pklinef", "createdAt": "2020-08-25T21:47:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyMzUzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNjUzMA==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476026530", "bodyText": "\u2753 What are the implications of this? Just force quit some orphaned docker process and try again? If this doesn't fail, how will I know I orphaned something or am otherwise stuck in an invalid development state?\nIf the cleanup still occurs regardless of failure, then \ud83d\udc4d", "author": "Lambeaux", "createdAt": "2020-08-25T01:09:41Z", "path": "distribution/docker/solrcloud/pom.xml", "diffHunk": "@@ -0,0 +1,132 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either\n+ * version 3 of the License, or any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ * See the GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ *\n+ **/\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>ddf.distribution</groupId>\n+        <artifactId>docker</artifactId>\n+        <version>2.26.0-SNAPSHOT</version>\n+    </parent>\n+    <artifactId>ddf-solrcloud</artifactId>\n+    <groupId>ddf.distribution.docker</groupId>\n+    <packaging>pom</packaging>\n+    <name>DDF :: Distribution :: Docker :: SolrCloud</name>\n+\n+    <build>\n+        <resources>\n+            <resource>\n+                <directory>src/main/resources-filtered</directory>\n+                <filtering>true</filtering>\n+            </resource>\n+            <resource>\n+                <directory>src/main/resources</directory>\n+                <filtering>false</filtering>\n+            </resource>\n+        </resources>\n+        <plugins>\n+            <plugin>\n+                <artifactId>maven-clean-plugin</artifactId>\n+                <version>3.1.0</version>\n+                <configuration>\n+                    <!-- avoid directory clean failures on Windows due to exec command holding onto directory lock -->\n+                    <failOnError>false</failOnError>", "originalCommit": "6f9c7b2791d4c65154fe2233195589d9d86ac811", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc3MTUyNg==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476771526", "bodyText": "Only the directory is not deleted.  All files in the classes directory is deleted.  I does retry multiple times before continuing.  This is because of how Windows creates a lock on the directory when executing docker compose from that directory.  Without this you would have to stop your SolrCloud every time you do a build of this module on Windows.\nThis is the suggested solution on the Maven Clean Plugin FAQ.\nhttp://maven.apache.org/plugins/maven-clean-plugin/faq.html", "author": "pklinef", "createdAt": "2020-08-25T21:51:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNjUzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjczNjUyOQ==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476736529", "bodyText": "\u2753 Why do we use a separate Jetty version for Solr? As far as I can tell, Solr just ends up using the version that's provided by Karaf", "author": "SmithJosh", "createdAt": "2020-08-25T21:05:02Z", "path": "pom.xml", "diffHunk": "@@ -215,7 +215,7 @@\n         <jboss-logging.version>3.3.1.Final</jboss-logging.version>\n         <jcodec.version>0.2.0_1</jcodec.version>\n         <jdom.bundle.version>1.1_4</jdom.bundle.version>\n-        <jetty.solr.version>9.4.19.v20190610</jetty.solr.version>", "originalCommit": "6f9c7b2791d4c65154fe2233195589d9d86ac811", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2ODI1NA==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r476768254", "bodyText": "Solr runs outside of DDF.  This jetty version is used for tests that start the MiniSolrCloudCluster which requires the Solr version of Jetty to be available to that JUnit class.", "author": "pklinef", "createdAt": "2020-08-25T21:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjczNjUyOQ=="}], "type": "inlineReview"}, {"oid": "3ddc663bd68f63b553bd51fe4413babdfc7e427b", "url": "https://github.com/codice/ddf/commit/3ddc663bd68f63b553bd51fe4413babdfc7e427b", "message": "Upgrade to Solr 8.6.1\n\n- Converted solrcloud directory to maven module for version properties\n  and executing docker compose commands.", "committedDate": "2020-08-26T23:37:58Z", "type": "forcePushed"}, {"oid": "2822252815969176351176ce0f838be61dbd8cba", "url": "https://github.com/codice/ddf/commit/2822252815969176351176ce0f838be61dbd8cba", "message": "Upgrade to Solr 8.6.1\n\n- Converted solrcloud directory to maven module for version properties\n  and executing docker compose commands.", "committedDate": "2020-08-27T23:55:23Z", "type": "forcePushed"}, {"oid": "4341224fe09b4683e291da5db9c91a13e7abae33", "url": "https://github.com/codice/ddf/commit/4341224fe09b4683e291da5db9c91a13e7abae33", "message": "Upgrade to Solr 8.6.1\n\n- Converted solrcloud directory to maven module for version properties\n  and executing docker compose commands.", "committedDate": "2020-08-27T23:59:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNjEyNw==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r479436127", "bodyText": "\u2754 Just curious, How did you come up with 50 lines for tailing the logs?", "author": "shaundmorris", "createdAt": "2020-08-28T17:17:38Z", "path": "distribution/docker/solrcloud/pom.xml", "diffHunk": "@@ -0,0 +1,132 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either\n+ * version 3 of the License, or any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ * See the GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ *\n+ **/\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>ddf.distribution</groupId>\n+        <artifactId>docker</artifactId>\n+        <version>2.26.0-SNAPSHOT</version>\n+    </parent>\n+    <artifactId>ddf-solrcloud</artifactId>\n+    <groupId>ddf.distribution.docker</groupId>\n+    <packaging>pom</packaging>\n+    <name>DDF :: Distribution :: Docker :: SolrCloud</name>\n+\n+    <build>\n+        <resources>\n+            <resource>\n+                <directory>src/main/resources-filtered</directory>\n+                <filtering>true</filtering>\n+            </resource>\n+            <resource>\n+                <directory>src/main/resources</directory>\n+                <filtering>false</filtering>\n+            </resource>\n+        </resources>\n+        <plugins>\n+            <plugin>\n+                <artifactId>maven-clean-plugin</artifactId>\n+                <version>3.1.0</version>\n+                <configuration>\n+                    <!-- avoid directory clean failures on Windows due to exec command holding onto directory lock -->\n+                    <failOnError>false</failOnError>\n+                </configuration>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.codehaus.mojo</groupId>\n+                <artifactId>exec-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>up</id>\n+                        <goals>\n+                            <goal>exec</goal>\n+                        </goals>\n+                        <configuration>\n+                            <executable>docker-compose</executable>\n+                            <arguments>\n+                                <argument>up</argument>\n+                                <argument>-d</argument>\n+                            </arguments>\n+                            <workingDirectory>${project.build.outputDirectory}</workingDirectory>\n+                        </configuration>\n+                    </execution>\n+                    <execution>\n+                        <id>logs</id>\n+                        <goals>\n+                            <goal>exec</goal>\n+                        </goals>\n+                        <configuration>\n+                            <executable>docker-compose</executable>\n+                            <arguments>\n+                                <argument>logs</argument>\n+                                <argument>--tail=50</argument>", "originalCommit": "4341224fe09b4683e291da5db9c91a13e7abae33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMzM5MQ==", "url": "https://github.com/codice/ddf/pull/6264#discussion_r479513391", "bodyText": "I used to use 100 but that tends to be way more context than I ever needed when tailing the logs initially.  So I reduced it to 50 so it did not spam the terminal as much.  Nothing scientific.  Just want to provide enough context in case the tail of the logs starts in the middle of stack trace for example.", "author": "pklinef", "createdAt": "2020-08-28T20:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNjEyNw=="}], "type": "inlineReview"}, {"oid": "60e95f61a22651a51c9301d16d27af7e0696f8ab", "url": "https://github.com/codice/ddf/commit/60e95f61a22651a51c9301d16d27af7e0696f8ab", "message": "Upgrade to Solr 8.6.1\n\n- Converted solrcloud directory to maven module for version properties\n  and executing docker compose commands.", "committedDate": "2020-08-28T20:12:06Z", "type": "commit"}, {"oid": "60e95f61a22651a51c9301d16d27af7e0696f8ab", "url": "https://github.com/codice/ddf/commit/60e95f61a22651a51c9301d16d27af7e0696f8ab", "message": "Upgrade to Solr 8.6.1\n\n- Converted solrcloud directory to maven module for version properties\n  and executing docker compose commands.", "committedDate": "2020-08-28T20:12:06Z", "type": "forcePushed"}]}