{"pr_number": 6068, "pr_title": "DDF-6049 Move SecureWebSocketServlet into DDF", "pr_createdAt": "2020-05-18T22:12:19Z", "pr_url": "https://github.com/codice/ddf/pull/6068", "timeline": [{"oid": "c7d66045259c444afd11c1a82a4d81bd33307eb7", "url": "https://github.com/codice/ddf/commit/c7d66045259c444afd11c1a82a4d81bd33307eb7", "message": "DDF-6049 Move SecureWebSocketServlet into DDF", "committedDate": "2020-05-18T22:10:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNDU2Mw==", "url": "https://github.com/codice/ddf/pull/6068#discussion_r426934563", "bodyText": "Looks like this comment no longer applies", "author": "SmithJosh", "createdAt": "2020-05-18T22:52:23Z", "path": "platform/security/servlet/security-servlet-web-socket/src/main/java/org/codice/ddf/security/servlet/web/socket/SecureWebSocketServlet.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package org.codice.ddf.security.servlet.web.socket;\n+\n+import ddf.security.SecurityConstants;\n+import ddf.security.Subject;\n+import java.io.IOException;\n+import java.util.concurrent.ExecutorService;\n+import javax.servlet.http.HttpSession;\n+import org.eclipse.jetty.websocket.api.Session;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketClose;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketConnect;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketError;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage;\n+import org.eclipse.jetty.websocket.servlet.ServletUpgradeRequest;\n+import org.eclipse.jetty.websocket.servlet.WebSocketServlet;\n+import org.eclipse.jetty.websocket.servlet.WebSocketServletFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class SecureWebSocketServlet extends WebSocketServlet {\n+\n+  private static final Logger LOGGER = LoggerFactory.getLogger(SecureWebSocketServlet.class);\n+\n+  private final WebSocket ws;\n+\n+  private final ExecutorService executor;\n+\n+  public SecureWebSocketServlet(ExecutorService executor, WebSocket ws) {\n+    this.ws = ws;\n+    this.executor = executor;\n+  }\n+\n+  @Override\n+  public void destroy() {\n+    executor.shutdown();\n+  }\n+\n+  /*\n+   Pass the TokenHolder into the WebSocket, in order to know when the user has logged out. Can't\n+   pass the Session because Jetty won't let anything check session attributes unless there's a\n+   request (excluding WebSocket requests) being actively fulfilled for that session.\n+  */", "originalCommit": "c7d66045259c444afd11c1a82a4d81bd33307eb7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMzNzE5Ng==", "url": "https://github.com/codice/ddf/pull/6068#discussion_r429337196", "bodyText": "This might need to be changed now. Try rebasing and see if this actually needs impl.", "author": "stustison", "createdAt": "2020-05-22T16:18:35Z", "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -528,6 +528,13 @@ org.ops4j.pax.web.default.realmname=DDF\n         <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n+    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n+             description=\"Defines a secure web socket servlet type.\">\n+        <feature>security-core-impl</feature>", "originalCommit": "c7d66045259c444afd11c1a82a4d81bd33307eb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUwNTUzNQ==", "url": "https://github.com/codice/ddf/pull/6068#discussion_r430505535", "bodyText": "\ud83d\udc4d I'll see if CI fails on it first. Scared of building atm", "author": "bakejeyner", "createdAt": "2020-05-26T15:33:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMzNzE5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgyMDczNQ==", "url": "https://github.com/codice/ddf/pull/6068#discussion_r430820735", "bodyText": "Manually verified it is now using artifacts from security-core-api. Making the change.", "author": "bakejeyner", "createdAt": "2020-05-27T02:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMzNzE5Ng=="}], "type": "inlineReview"}, {"oid": "8c599259b122ef44ab9a6a09d0ef705ad7cf74a2", "url": "https://github.com/codice/ddf/commit/8c599259b122ef44ab9a6a09d0ef705ad7cf74a2", "message": "Change security-core-impl to security-core-api in web-socket-servlet feature", "committedDate": "2020-05-27T02:20:43Z", "type": "forcePushed"}, {"oid": "d009bec71a7770da74644f08619be8a1236ce9ca", "url": "https://github.com/codice/ddf/commit/d009bec71a7770da74644f08619be8a1236ce9ca", "message": "Change security-core-impl to security-core-api in web-socket-servlet feature", "committedDate": "2020-05-27T05:20:19Z", "type": "commit"}, {"oid": "d009bec71a7770da74644f08619be8a1236ce9ca", "url": "https://github.com/codice/ddf/commit/d009bec71a7770da74644f08619be8a1236ce9ca", "message": "Change security-core-impl to security-core-api in web-socket-servlet feature", "committedDate": "2020-05-27T05:20:19Z", "type": "forcePushed"}]}