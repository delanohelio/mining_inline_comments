{"pr_number": 5876, "pr_title": "DDF-5875 Adds original tags to DeletedMetacard", "pr_createdAt": "2020-03-04T19:53:55Z", "pr_url": "https://github.com/codice/ddf/pull/5876", "timeline": [{"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92", "url": "https://github.com/codice/ddf/commit/cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92", "message": "DDF-5875 Adds original tags to DeletedMetacard\n\n - You can now search for deleted metacards original tags by querying the field", "committedDate": "2020-03-04T19:53:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwMjI1Mw==", "url": "https://github.com/codice/ddf/pull/5876#discussion_r387902253", "bodyText": "Nice. I like this test even though this case is rare \u2705 Good stuff.", "author": "vinamartin", "createdAt": "2020-03-04T19:59:56Z", "path": "catalog/core/catalog-core-versioning/versioning-common/src/test/groovy/ddf/catalog/core/versioning/impl/DeletedMetacardImplSpec.groovy", "diffHunk": "@@ -0,0 +1,88 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ * <p>\n+ * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser\n+ * General Public License as published by the Free Software Foundation, either version 3 of the\n+ * License, or any later version.\n+ * <p>\n+ * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without\n+ * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details. A copy of the GNU Lesser General Public License\n+ * is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package ddf.catalog.core.versioning.impl\n+\n+import ddf.catalog.core.versioning.DeletedMetacard\n+import ddf.catalog.data.Metacard\n+import ddf.catalog.data.impl.AttributeImpl\n+import ddf.catalog.data.impl.MetacardImpl\n+import org.apache.shiro.subject.Subject\n+import org.apache.shiro.util.ThreadContext\n+import spock.lang.Specification\n+\n+\n+class DeletedMetacardImplSpec extends Specification {\n+\n+    void setup() {\n+        ThreadContext.bind(Mock(Subject))\n+\n+    }\n+\n+    void cleanup() {\n+        ThreadContext.unbindSubject()\n+    }\n+\n+    def \"Tags of metacard being deleted are stored in the deleted metacard\"() {\n+        setup:\n+        def id = \"OriginalMetacardId\"\n+        def title = \"Title\"\n+        def tags = ['a-special-tag', 'a-second-special-tag'] as Set\n+        Metacard metacard = new MetacardImpl().with {\n+            setAttribute(ID, id)\n+            setAttribute(TITLE, title)\n+            setAttribute(new AttributeImpl(TAGS, new ArrayList<>(tags)))\n+            return it\n+        }\n+\n+        when: \"deleted metacards are created from a metacard with specific tags\"\n+        def deletedMetacard = new DeletedMetacardImpl(\n+                \"DeletedMetacardId\",\n+                id,\n+                \"UserSubjectName\",\n+                \"VersionMetacardId\",\n+                metacard)\n+\n+        then: \"deleted metacards have those specific tags for searchability\"\n+        deletedMetacard.\n+                getAttribute(DeletedMetacard.DELETED_METACARD_TAGS)?.\n+                values?.\n+                containsAll(tags)\n+\n+        when: \"deleted metacard has no tags (which would be odd)\"\n+        Metacard metacardNoTags = new MetacardImpl().with {\n+            setAttribute(ID, id)\n+            setAttribute(TITLE, title)\n+            return it\n+        }\n+\n+        def deletedMetacardNoTags = new DeletedMetacardImpl(\n+                \"DeletedMetacardId\",\n+                id,\n+                \"UserSubjectName\",\n+                \"VersionMetacardId\",\n+                metacardNoTags)\n+        then: \"nothing bad happens and there is no deleted_metacard_tags\"", "originalCommit": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}