{"pr_number": 6001, "pr_title": "DDF-6000 Add additional logging with getting an AccessToken", "pr_createdAt": "2020-04-16T20:50:06Z", "pr_url": "https://github.com/codice/ddf/pull/6001", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY5Mzc2OA==", "url": "https://github.com/codice/ddf/pull/6001#discussion_r414693768", "bodyText": "This warning is still a little bit unclear but i am not sure how to make it clearer that the password should not be encrypted at this point.", "author": "ryeats", "createdAt": "2020-04-24T16:09:46Z", "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -360,6 +369,23 @@ private String getNewAccessToken(\n     return accessToken;\n   }\n \n+  private void sanitizeFormParameters(Form formParam) {\n+    MultivaluedMap<String, String> formParamMap = formParam.asMap();\n+    List<String> passwords = formParamMap.get(PASSWORD);\n+    if (passwords != null && passwords.size() == 1) {\n+      String password = passwords.get(0);\n+      if (isEncrypted(password)) {\n+        LOGGER.warn(\"Trying to use an encrypted password to retrieve system access token.\");", "originalCommit": "eae2bdbe13b6f411dc1986dd6f3608f56c7babad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQyNjQ4Ng==", "url": "https://github.com/codice/ddf/pull/6001#discussion_r417426486", "bodyText": "\u270f\ufe0f There should probably still be a DEBUG message about the failure to receive the token and this trace message and the sanitizeFormParameters call should all be wrapped in a conditional check if LOGGER.isTraceEnabled(). Otherwise, we're going to sanitize every time this occurs but almost never log it.", "author": "coyotesqrl", "createdAt": "2020-04-29T15:56:00Z", "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -326,7 +329,13 @@ private String getNewAccessToken(\n     }\n \n     if (response.getStatus() != HttpStatus.SC_OK) {\n-      LOGGER.debug(\"Unable to retrieve system access token. {}\", body);\n+      sanitizeFormParameters(formParam);", "originalCommit": "eae2bdbe13b6f411dc1986dd6f3608f56c7babad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "158e6eb32cfc16fa5e1e858f6efc2e97e359d7e5", "url": "https://github.com/codice/ddf/commit/158e6eb32cfc16fa5e1e858f6efc2e97e359d7e5", "message": "DDF-6000 Add additional logging to OAuthSecurityImpl after sanitizing password", "committedDate": "2020-04-29T19:16:45Z", "type": "commit"}, {"oid": "158e6eb32cfc16fa5e1e858f6efc2e97e359d7e5", "url": "https://github.com/codice/ddf/commit/158e6eb32cfc16fa5e1e858f6efc2e97e359d7e5", "message": "DDF-6000 Add additional logging to OAuthSecurityImpl after sanitizing password", "committedDate": "2020-04-29T19:16:45Z", "type": "forcePushed"}]}