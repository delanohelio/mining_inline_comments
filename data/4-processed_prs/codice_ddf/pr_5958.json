{"pr_number": 5958, "pr_title": "[2.19.x] DDF-UI-146 Add error messaging for when bounding box south >= north", "pr_createdAt": "2020-04-01T22:23:53Z", "pr_url": "https://github.com/codice/ddf/pull/5958", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMTEwMA==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405121100", "bodyText": "very happy to see this function gone \ud83d\udc4d", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:22:24Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/location-old/location-old.js", "diffHunk": "@@ -32,41 +31,6 @@ const northingOffset = 10000000\n const usngPrecision = 6\n const Direction = dmsUtils.Direction\n \n-function convertToValid(key, model) {", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMjI4Nw==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405122287", "bodyText": "\u2753  out of scope for this ticket, but what happens when east and west are flipped? Not sure which one is supposed to be \"greater\", or if that logic applies at all for east and west", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:24:36Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/js/widgets/cesium.bbox.js", "diffHunk": "@@ -221,7 +221,7 @@ Draw.BboxView = Marionette.View.extend({\n     if (\n       rectangle &&\n       !_.isUndefined(rectangle) &&\n-      (rectangle.north !== rectangle.south && rectangle.east !== rectangle.west)\n+      (rectangle.north > rectangle.south && rectangle.east !== rectangle.west)", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEzMzc2MQ==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405133761", "bodyText": "So east and west can be flipped because of the anti-meridian. But even with a bounding box not over the anti-meridian, it doesn't seem to matter if east and west are flipped on both 2D and 3D maps \ud83e\udd37\u200d\u2640", "author": "hayleynorton", "createdAt": "2020-04-07T21:48:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI1MTgxOA==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r406251818", "bodyText": "sounds good to me!", "author": "cassandrabailey293", "createdAt": "2020-04-09T14:37:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMjI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNDAxMQ==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405124011", "bodyText": "why do we only want to call the validateGeo function when there is no error? if there was some other error, like you entered a value too large, and it defaulted to 90, but your north was still less than your south, we'd want to show the north < south error, right?", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:28:04Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/location/bounding-box.js", "diffHunk": "@@ -31,45 +31,38 @@ const {\n const DirectionInput = require('../../component/location-new/geo-components/direction.js')\n const { Direction } = require('../../component/location-new/utils/dms-utils.js')\n \n-const minimumDifference = 0.0001\n-\n const BoundingBoxLatLonDd = props => {\n-  const {\n-    north,\n-    east,\n-    south,\n-    west,\n-    setState,\n-    mapEast,\n-    mapWest,\n-    mapSouth,\n-    mapNorth,\n-  } = props\n+  const { north, east, south, west, setState } = props\n   const [ddError, setDdError] = useState(initialErrorStateWithDefault)\n-  const westMax = parseFloat(mapEast) - minimumDifference\n-  const eastMin = parseFloat(mapWest) + minimumDifference\n-  const northMin = parseFloat(mapSouth) + minimumDifference\n-  const southMax = parseFloat(mapNorth) - minimumDifference\n \n   useEffect(\n     () => {\n       if (props.drawing) {\n         setDdError(initialErrorStateWithDefault)\n       }\n+      if (!ddError.error) {", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEzNzAxOA==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405137018", "bodyText": "So in that case you laid out, it won't change to the north less than south error until onBlur. But this is to protect against clearing out other errors when north is not less than south. Since the same error state is being used for all errors, we don't want to clear out errors when north is greater than south yet there may be some other error, like invalid UTM/UPS or latitude cannot be empty", "author": "hayleynorton", "createdAt": "2020-04-07T21:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNDAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI1MjU0Nw==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r406252547", "bodyText": "ohh i see okay, so we want all other errors to take precedence basically. fine by me", "author": "cassandrabailey293", "createdAt": "2020-04-09T14:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNDAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNDc3Nw==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405124777", "bodyText": "same question as above, why are we checking if theres no error?", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:29:34Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/location/bounding-box.js", "diffHunk": "@@ -31,45 +31,38 @@ const {\n const DirectionInput = require('../../component/location-new/geo-components/direction.js')\n const { Direction } = require('../../component/location-new/utils/dms-utils.js')\n \n-const minimumDifference = 0.0001\n-\n const BoundingBoxLatLonDd = props => {\n-  const {\n-    north,\n-    east,\n-    south,\n-    west,\n-    setState,\n-    mapEast,\n-    mapWest,\n-    mapSouth,\n-    mapNorth,\n-  } = props\n+  const { north, east, south, west, setState } = props\n   const [ddError, setDdError] = useState(initialErrorStateWithDefault)\n-  const westMax = parseFloat(mapEast) - minimumDifference\n-  const eastMin = parseFloat(mapWest) + minimumDifference\n-  const northMin = parseFloat(mapSouth) + minimumDifference\n-  const southMax = parseFloat(mapNorth) - minimumDifference\n \n   useEffect(\n     () => {\n       if (props.drawing) {\n         setDdError(initialErrorStateWithDefault)\n       }\n+      if (!ddError.error) {\n+        setDdError(validateGeo('bbox', { north, south }))\n+      }\n     },\n     [props.east, props.west, props.south, props.north]\n   )\n \n   function validateDd(key, value) {\n     const label = key.includes('east') || key.includes('west') ? 'lon' : 'lat'\n     const { error, message, defaultValue } = validateGeo(label, value)\n-    if (defaultValue) {\n-      setDdError({ error, message, defaultValue })\n-      setState({ [key]: defaultValue })\n-    } else {\n-      setState({ [key]: value })\n+    setDdError({ error, message, defaultValue })\n+    if (!error && label === 'lat') {", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNjA4NA==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405126084", "bodyText": "\u270f\ufe0f  doesnt really matter but we could change this to isDms or something, so it's more obvious it's a boolean", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:32:31Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/location/bounding-box.js", "diffHunk": "@@ -142,6 +135,17 @@ const BoundingBoxLatLonDms = props => {\n       if (props.drawing) {\n         setDmsError(initialErrorStateWithDefault)\n       }\n+      if (!dmsError.error) {\n+        setDmsError(\n+          validateGeo('bbox', {\n+            dms: true,", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNzA5Nw==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405127097", "bodyText": "are we preserving the old logic where the \"coordinates cannot be empty\" error will only show up after clicking out?", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:34:36Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/location/bounding-box.js", "diffHunk": "@@ -150,22 +154,24 @@ const BoundingBoxLatLonDms = props => {\n     const label =\n       key.includes('East') || key.includes('West') ? 'dmsLon' : 'dmsLat'\n     const { error, message, defaultValue } = validateGeo(label, value)\n-    if (type === 'blur') {\n-      setDmsError({\n-        error: value !== undefined && value.length === 0,\n-        message,\n-        defaultValue,\n-      })\n-    } else if (defaultValue) {\n-      setDmsError({\n-        error,\n-        message,\n-        defaultValue,\n-      })\n+    setDmsError({", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0MzEyMQ==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405643121", "bodyText": "Good catch, I just pushed a commit that brought that back", "author": "hayleynorton", "createdAt": "2020-04-08T16:11:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNzA5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNzYwOQ==", "url": "https://github.com/codice/ddf/pull/5958#discussion_r405127609", "bodyText": "nice refactor \ud83d\udc4d", "author": "cassandrabailey293", "createdAt": "2020-04-07T21:35:40Z", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/location/bounding-box.js", "diffHunk": "@@ -304,13 +371,10 @@ const BoundingBoxUtmUps = props => {\n                 setState({ ['utmUpsUpperLeftEasting']: value })\n               }\n               onBlur={() =>\n-                setUpperLeftError(\n-                  validateGeo('utmUpsEasting', {\n-                    utmUpsEasting: utmUpsUpperLeftEasting,\n-                    utmUpsNorthing: utmUpsUpperLeftNorthing,\n-                    zoneNumber: utmUpsUpperLeftZone,\n-                    hemisphere: utmUpsUpperLeftHemisphere,\n-                  })\n+                validateUtmUps(", "originalCommit": "31dd014424a4caf16093095d287d4951e5a1939d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "583bc42146feaded009df9d09612282841011e1b", "url": "https://github.com/codice/ddf/commit/583bc42146feaded009df9d09612282841011e1b", "message": "DDF-UI-146 addressed comments", "committedDate": "2020-04-08T19:30:24Z", "type": "forcePushed"}, {"oid": "093befbd6ae57c1a5e21336e8f1f790abc647355", "url": "https://github.com/codice/ddf/commit/093befbd6ae57c1a5e21336e8f1f790abc647355", "message": "DDF-UI-146 added error messaging when south >= north", "committedDate": "2020-04-20T16:26:22Z", "type": "commit"}, {"oid": "0855fa2080c8cacd323d8079045294e6353b711a", "url": "https://github.com/codice/ddf/commit/0855fa2080c8cacd323d8079045294e6353b711a", "message": "DDF-UI-146 addressed comments", "committedDate": "2020-04-20T16:26:22Z", "type": "commit"}, {"oid": "2f53af9c7fd6bc20c8832d40fb88a2d714b2f7b4", "url": "https://github.com/codice/ddf/commit/2f53af9c7fd6bc20c8832d40fb88a2d714b2f7b4", "message": "DDF-UI-146 added null check for south and north values", "committedDate": "2020-04-20T16:26:22Z", "type": "commit"}, {"oid": "f90603b453df2e738ff0c9358f09a296494ee3d3", "url": "https://github.com/codice/ddf/commit/f90603b453df2e738ff0c9358f09a296494ee3d3", "message": "DDF-UI-146 fix UtmUps bugs", "committedDate": "2020-04-20T16:26:22Z", "type": "commit"}, {"oid": "fd482b8fe6c7e8837d23e440a196574c79c24704", "url": "https://github.com/codice/ddf/commit/fd482b8fe6c7e8837d23e440a196574c79c24704", "message": "bug fixes", "committedDate": "2020-04-20T16:26:22Z", "type": "forcePushed"}, {"oid": "8a5272dcf9a2ee6da70e1163e1c5e42d5e3f37f2", "url": "https://github.com/codice/ddf/commit/8a5272dcf9a2ee6da70e1163e1c5e42d5e3f37f2", "message": "bug fixes", "committedDate": "2020-04-20T16:34:07Z", "type": "commit"}, {"oid": "8a5272dcf9a2ee6da70e1163e1c5e42d5e3f37f2", "url": "https://github.com/codice/ddf/commit/8a5272dcf9a2ee6da70e1163e1c5e42d5e3f37f2", "message": "bug fixes", "committedDate": "2020-04-20T16:34:07Z", "type": "forcePushed"}]}