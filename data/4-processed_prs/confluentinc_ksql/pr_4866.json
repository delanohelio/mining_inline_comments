{"pr_number": 4866, "pr_title": "docs: scalar funcs update", "pr_createdAt": "2020-03-23T10:41:53Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4866", "timeline": [{"oid": "90e2e20e6da4f85d75030669981a3e2a825e1623", "url": "https://github.com/confluentinc/ksql/commit/90e2e20e6da4f85d75030669981a3e2a825e1623", "message": "docs: scalar funcs update\n\nFix links in doc and improve docs around EXTRACTJSONFIELD", "committedDate": "2020-03-23T10:41:19Z", "type": "commit"}, {"oid": "f6d2ee28f8adaa8ce9639fbafb38777796f19638", "url": "https://github.com/confluentinc/ksql/commit/f6d2ee28f8adaa8ce9639fbafb38777796f19638", "message": "test: add test around out of bounds array access", "committedDate": "2020-03-23T10:55:33Z", "type": "commit"}, {"oid": "7059841c616b682eb384ccad03ebae22dc39ce22", "url": "https://github.com/confluentinc/ksql/commit/7059841c616b682eb384ccad03ebae22dc39ce22", "message": "chore: historic plans", "committedDate": "2020-03-23T16:33:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYwOTI4MQ==", "url": "https://github.com/confluentinc/ksql/pull/4866#discussion_r396609281", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `EXTRACTJSONFIELD(message, '$.log.cloud')` will return the STRING `gcp836Csd`.\n          \n          \n            \n            `EXTRACTJSONFIELD(message, '$.log.cloud')` returns the STRING `gcp836Csd`.", "author": "JimGalasyn", "createdAt": "2020-03-23T17:02:51Z", "path": "docs-md/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -263,27 +253,43 @@ CONCAT\n \r\n `CONCAT(col1, '_hello')`\r\n \r\n-Concatenate two strings.\r\n+Concatenate two or more strings.\r\n \r\n EXTRACTJSONFIELD\r\n ----------------\r\n \r\n `EXTRACTJSONFIELD(message, '$.log.cloud')`\r\n \r\n-Given a string column in JSON format, extract the field that matches.\r\n-For example EXTRACTJSONFIELD is necessary in the following JSON:\r\n+Given a STRING that contains JSON data, extract the value at the specified [JSONPath](https://jsonpath.com/).\r\n+\r\n+For example, given a STRING containing the following JSON:\r\n \r\n ```json\r\n-{\"foo\": \\\"{\\\"bar\\\": \\\"quux\\\"}\\\"}\r\n+{\r\n+   \"log\": {\r\n+      \"cloud\": \"gcp836Csd\",\r\n+      \"app\": \"ksProcessor\",\r\n+      \"instance\": 4\r\n+   }\r\n+}\r\n ```\r\n \r\n-In cases where the column is really an object but declared as a STRING,\r\n-you can use the `STRUCT` type, which is easier to work with. For example,\r\n-`STRUCT` works in the following case:\r\n+`EXTRACTJSONFIELD(message, '$.log.cloud')` will return the STRING `gcp836Csd`.\r", "originalCommit": "7059841c616b682eb384ccad03ebae22dc39ce22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYwOTg2OA==", "url": "https://github.com/confluentinc/ksql/pull/4866#discussion_r396609868", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                format, For example a JSON field within an Avro encoded message.\n          \n          \n            \n                format, for example, a JSON field within an Avro-encoded message.", "author": "JimGalasyn", "createdAt": "2020-03-23T17:03:42Z", "path": "docs-md/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -263,27 +253,43 @@ CONCAT\n \r\n `CONCAT(col1, '_hello')`\r\n \r\n-Concatenate two strings.\r\n+Concatenate two or more strings.\r\n \r\n EXTRACTJSONFIELD\r\n ----------------\r\n \r\n `EXTRACTJSONFIELD(message, '$.log.cloud')`\r\n \r\n-Given a string column in JSON format, extract the field that matches.\r\n-For example EXTRACTJSONFIELD is necessary in the following JSON:\r\n+Given a STRING that contains JSON data, extract the value at the specified [JSONPath](https://jsonpath.com/).\r\n+\r\n+For example, given a STRING containing the following JSON:\r\n \r\n ```json\r\n-{\"foo\": \\\"{\\\"bar\\\": \\\"quux\\\"}\\\"}\r\n+{\r\n+   \"log\": {\r\n+      \"cloud\": \"gcp836Csd\",\r\n+      \"app\": \"ksProcessor\",\r\n+      \"instance\": 4\r\n+   }\r\n+}\r\n ```\r\n \r\n-In cases where the column is really an object but declared as a STRING,\r\n-you can use the `STRUCT` type, which is easier to work with. For example,\r\n-`STRUCT` works in the following case:\r\n+`EXTRACTJSONFIELD(message, '$.log.cloud')` will return the STRING `gcp836Csd`.\r\n \r\n-```json\r\n-{\"foo\": {\"bar\": \"quux\"}}.\r\n-```\r\n+If the requested JSONPath does not exist, the function returns NULL.\r\n+\r\n+The result of EXTRACTJSONFIELD is always a STRING. Use `CAST` to convert the result to another\r\n+type. For example, `CAST(EXTRACTJSONFIELD(message, '$.log.instance') AS INT)` will extract the\r\n+instance number from the above JSON object as a INT.\r\n+\r\n+!!! note\r\n+    EXTRACTJSONFIELD is useful for extracting data from JSON where either the schema of the JSON\r\n+    data is not static, or where the JSON data is embedded in a row encoded using a different\r\n+    format, For example a JSON field within an Avro encoded message.\r", "originalCommit": "7059841c616b682eb384ccad03ebae22dc39ce22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYxMDkyNw==", "url": "https://github.com/confluentinc/ksql/pull/4866#discussion_r396610927", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Where the whole row is encoded as JSON of a known schema or structure, use the `JSON` format and\n          \n          \n            \n                If the whole row is encoded as JSON with a known schema or structure, use the `JSON` format and", "author": "JimGalasyn", "createdAt": "2020-03-23T17:05:20Z", "path": "docs-md/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -263,27 +253,43 @@ CONCAT\n \r\n `CONCAT(col1, '_hello')`\r\n \r\n-Concatenate two strings.\r\n+Concatenate two or more strings.\r\n \r\n EXTRACTJSONFIELD\r\n ----------------\r\n \r\n `EXTRACTJSONFIELD(message, '$.log.cloud')`\r\n \r\n-Given a string column in JSON format, extract the field that matches.\r\n-For example EXTRACTJSONFIELD is necessary in the following JSON:\r\n+Given a STRING that contains JSON data, extract the value at the specified [JSONPath](https://jsonpath.com/).\r\n+\r\n+For example, given a STRING containing the following JSON:\r\n \r\n ```json\r\n-{\"foo\": \\\"{\\\"bar\\\": \\\"quux\\\"}\\\"}\r\n+{\r\n+   \"log\": {\r\n+      \"cloud\": \"gcp836Csd\",\r\n+      \"app\": \"ksProcessor\",\r\n+      \"instance\": 4\r\n+   }\r\n+}\r\n ```\r\n \r\n-In cases where the column is really an object but declared as a STRING,\r\n-you can use the `STRUCT` type, which is easier to work with. For example,\r\n-`STRUCT` works in the following case:\r\n+`EXTRACTJSONFIELD(message, '$.log.cloud')` will return the STRING `gcp836Csd`.\r\n \r\n-```json\r\n-{\"foo\": {\"bar\": \"quux\"}}.\r\n-```\r\n+If the requested JSONPath does not exist, the function returns NULL.\r\n+\r\n+The result of EXTRACTJSONFIELD is always a STRING. Use `CAST` to convert the result to another\r\n+type. For example, `CAST(EXTRACTJSONFIELD(message, '$.log.instance') AS INT)` will extract the\r\n+instance number from the above JSON object as a INT.\r\n+\r\n+!!! note\r\n+    EXTRACTJSONFIELD is useful for extracting data from JSON where either the schema of the JSON\r\n+    data is not static, or where the JSON data is embedded in a row encoded using a different\r\n+    format, For example a JSON field within an Avro encoded message.\r\n+    Where the whole row is encoded as JSON of a known schema or structure, use the `JSON` format and\r", "originalCommit": "7059841c616b682eb384ccad03ebae22dc39ce22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYxMTQzMw==", "url": "https://github.com/confluentinc/ksql/pull/4866#discussion_r396611433", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                the example above could be defined using something similar to\n          \n          \n            \n                the example above could be defined using a statement similar to this:", "author": "JimGalasyn", "createdAt": "2020-03-23T17:06:06Z", "path": "docs-md/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -263,27 +253,43 @@ CONCAT\n \r\n `CONCAT(col1, '_hello')`\r\n \r\n-Concatenate two strings.\r\n+Concatenate two or more strings.\r\n \r\n EXTRACTJSONFIELD\r\n ----------------\r\n \r\n `EXTRACTJSONFIELD(message, '$.log.cloud')`\r\n \r\n-Given a string column in JSON format, extract the field that matches.\r\n-For example EXTRACTJSONFIELD is necessary in the following JSON:\r\n+Given a STRING that contains JSON data, extract the value at the specified [JSONPath](https://jsonpath.com/).\r\n+\r\n+For example, given a STRING containing the following JSON:\r\n \r\n ```json\r\n-{\"foo\": \\\"{\\\"bar\\\": \\\"quux\\\"}\\\"}\r\n+{\r\n+   \"log\": {\r\n+      \"cloud\": \"gcp836Csd\",\r\n+      \"app\": \"ksProcessor\",\r\n+      \"instance\": 4\r\n+   }\r\n+}\r\n ```\r\n \r\n-In cases where the column is really an object but declared as a STRING,\r\n-you can use the `STRUCT` type, which is easier to work with. For example,\r\n-`STRUCT` works in the following case:\r\n+`EXTRACTJSONFIELD(message, '$.log.cloud')` will return the STRING `gcp836Csd`.\r\n \r\n-```json\r\n-{\"foo\": {\"bar\": \"quux\"}}.\r\n-```\r\n+If the requested JSONPath does not exist, the function returns NULL.\r\n+\r\n+The result of EXTRACTJSONFIELD is always a STRING. Use `CAST` to convert the result to another\r\n+type. For example, `CAST(EXTRACTJSONFIELD(message, '$.log.instance') AS INT)` will extract the\r\n+instance number from the above JSON object as a INT.\r\n+\r\n+!!! note\r\n+    EXTRACTJSONFIELD is useful for extracting data from JSON where either the schema of the JSON\r\n+    data is not static, or where the JSON data is embedded in a row encoded using a different\r\n+    format, For example a JSON field within an Avro encoded message.\r\n+    Where the whole row is encoded as JSON of a known schema or structure, use the `JSON` format and\r\n+    define the structure as the source's columns.  For example, a stream of JSON objects similar to\r\n+    the example above could be defined using something similar to\r", "originalCommit": "7059841c616b682eb384ccad03ebae22dc39ce22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7ad4acce80e931e8bdca9689c23b089f95288921", "url": "https://github.com/confluentinc/ksql/commit/7ad4acce80e931e8bdca9689c23b089f95288921", "message": "Update docs-md/developer-guide/ksqldb-reference/scalar-functions.md\n\nCo-Authored-By: Jim Galasyn <jim.galasyn@confluent.io>", "committedDate": "2020-03-23T17:32:03Z", "type": "commit"}, {"oid": "afbd8762272f4265f41d7c9f9953ced471e28880", "url": "https://github.com/confluentinc/ksql/commit/afbd8762272f4265f41d7c9f9953ced471e28880", "message": "Update docs-md/developer-guide/ksqldb-reference/scalar-functions.md\n\nCo-Authored-By: Jim Galasyn <jim.galasyn@confluent.io>", "committedDate": "2020-03-23T17:32:12Z", "type": "commit"}, {"oid": "fee16d5b96659323665976d41dfdb8155dd54d3c", "url": "https://github.com/confluentinc/ksql/commit/fee16d5b96659323665976d41dfdb8155dd54d3c", "message": "Update docs-md/developer-guide/ksqldb-reference/scalar-functions.md\n\nCo-Authored-By: Jim Galasyn <jim.galasyn@confluent.io>", "committedDate": "2020-03-23T17:32:19Z", "type": "commit"}, {"oid": "37c0b3feb31348553e1cdc625f8008d0a8621d6d", "url": "https://github.com/confluentinc/ksql/commit/37c0b3feb31348553e1cdc625f8008d0a8621d6d", "message": "Update docs-md/developer-guide/ksqldb-reference/scalar-functions.md\n\nCo-Authored-By: Jim Galasyn <jim.galasyn@confluent.io>", "committedDate": "2020-03-23T17:32:25Z", "type": "commit"}, {"oid": "0bbac5fcfc81354d94aef4af12ce28ffc7e807cc", "url": "https://github.com/confluentinc/ksql/commit/0bbac5fcfc81354d94aef4af12ce28ffc7e807cc", "message": "Merge branch 'master' into scalar_functions", "committedDate": "2020-03-23T17:33:29Z", "type": "commit"}]}