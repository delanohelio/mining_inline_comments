{"pr_number": 6031, "pr_title": "feat: DistributingExecutor fails DDL statement if CommandRunner DEGRADED", "pr_createdAt": "2020-08-14T20:22:06Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6031", "timeline": [{"oid": "09356e8b37725a1c2c8d948f0c6a326c116d2602", "url": "https://github.com/confluentinc/ksql/commit/09356e8b37725a1c2c8d948f0c6a326c116d2602", "message": "feat: move deserialization to CommandRunner and introduce DEGRADED to CommandRunnerStatus", "committedDate": "2020-08-14T07:27:24Z", "type": "commit"}, {"oid": "4332b8774bbc2bbc2f7fbfd5e17bfb6087848107", "url": "https://github.com/confluentinc/ksql/commit/4332b8774bbc2bbc2f7fbfd5e17bfb6087848107", "message": "chore: refactor DistributingExecutor to use CommandRunner instead of CommandQueue", "committedDate": "2020-08-15T22:21:43Z", "type": "forcePushed"}, {"oid": "90927a56961e4a253466e3c8701a7d2ef61bcce1", "url": "https://github.com/confluentinc/ksql/commit/90927a56961e4a253466e3c8701a7d2ef61bcce1", "message": "chore: refactor DistributingExecutor to use CommandRunner instead of CommandQueue", "committedDate": "2020-08-15T22:56:41Z", "type": "forcePushed"}, {"oid": "ca1d143caf7c474773be66c6447f200b7ca23fa0", "url": "https://github.com/confluentinc/ksql/commit/ca1d143caf7c474773be66c6447f200b7ca23fa0", "message": "chore: refactor DistributingExecutor to use CommandRunner instead of CommandQueue", "committedDate": "2020-08-17T05:43:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1ODQ3NQ==", "url": "https://github.com/confluentinc/ksql/pull/6031#discussion_r471858475", "bodyText": "can we abstract this out as a Supplier<Boolean> instead?", "author": "rodesai", "createdAt": "2020-08-18T01:16:16Z", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/computation/DistributingExecutor.java", "diffHunk": "@@ -61,14 +62,15 @@\n \n   public DistributingExecutor(\n       final KsqlConfig ksqlConfig,\n-      final CommandQueue commandQueue,\n+      final CommandRunner commandRunner,", "originalCommit": "ca1d143caf7c474773be66c6447f200b7ca23fa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQyNjE5Ng==", "url": "https://github.com/confluentinc/ksql/pull/6031#discussion_r472426196", "bodyText": "done", "author": "stevenpyzhang", "createdAt": "2020-08-18T19:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1ODQ3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1OTI4OA==", "url": "https://github.com/confluentinc/ksql/pull/6031#discussion_r471859288", "bodyText": "I'd drop the references to CommandRunner or command topic here as they are implementation details of the server that we shouldn't leak in the error message. How about something like:\nFailed to process KSQL statement. The server has encountered an incompatible entry in its log and cannot process further statements. This is most likely due to the service being rolled back to an earlier version.", "author": "rodesai", "createdAt": "2020-08-18T01:19:25Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/DefaultErrorMessages.java", "diffHunk": "@@ -19,6 +19,15 @@\n \n public class DefaultErrorMessages implements ErrorMessages {\n \n+  static String COMMAND_RUNNER_DEGRADED_ERROR_MESSAGE =", "originalCommit": "ca1d143caf7c474773be66c6447f200b7ca23fa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQyNjcxOQ==", "url": "https://github.com/confluentinc/ksql/pull/6031#discussion_r472426719", "bodyText": "I've updated the error message. I'm going to reuse COMMAND_RUNNER_DEGRADED_ERROR_MESSAGE for adding warnings later on to all responses from the KsqlResource so I moved \"Failed to process KSQL statement\" to the DistributingExecutor.", "author": "stevenpyzhang", "createdAt": "2020-08-18T19:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1OTI4OA=="}], "type": "inlineReview"}, {"oid": "4f5ce5f5a60329dcebf3027cceca1d13eee1ed5c", "url": "https://github.com/confluentinc/ksql/commit/4f5ce5f5a60329dcebf3027cceca1d13eee1ed5c", "message": "rohan comment", "committedDate": "2020-08-18T18:54:06Z", "type": "commit"}, {"oid": "5ba66a381eae1774462249b17e1c0c9f11468275", "url": "https://github.com/confluentinc/ksql/commit/5ba66a381eae1774462249b17e1c0c9f11468275", "message": "rohan comment", "committedDate": "2020-08-18T19:20:17Z", "type": "forcePushed"}, {"oid": "dae4eee5a9625404ccdcb8b742ab35400792e226", "url": "https://github.com/confluentinc/ksql/commit/dae4eee5a9625404ccdcb8b742ab35400792e226", "message": "fix test", "committedDate": "2020-08-18T20:16:25Z", "type": "commit"}, {"oid": "b668a51f897aeefecf2b07d269bb59c6a6c2a0a9", "url": "https://github.com/confluentinc/ksql/commit/b668a51f897aeefecf2b07d269bb59c6a6c2a0a9", "message": "rohan comment", "committedDate": "2020-08-18T20:16:42Z", "type": "forcePushed"}, {"oid": "d5aba943a40f9126bcda43d0b774b2846ca98538", "url": "https://github.com/confluentinc/ksql/commit/d5aba943a40f9126bcda43d0b774b2846ca98538", "message": "more feedback", "committedDate": "2020-08-19T17:46:40Z", "type": "commit"}, {"oid": "5110d66e3416abb4bc92582590e59a3e601b2b45", "url": "https://github.com/confluentinc/ksql/commit/5110d66e3416abb4bc92582590e59a3e601b2b45", "message": "pass deserializer to queuedcommand for command", "committedDate": "2020-08-19T20:28:05Z", "type": "commit"}, {"oid": "b846bea62a7af8997cd873b259ac9c36e79bf90b", "url": "https://github.com/confluentinc/ksql/commit/b846bea62a7af8997cd873b259ac9c36e79bf90b", "message": "chore: refactor DistributingExecutor to use CommandRunner instead of CommandQueue", "committedDate": "2020-08-19T20:36:33Z", "type": "commit"}, {"oid": "86ff9377b48962bff665351418e64120b1e65561", "url": "https://github.com/confluentinc/ksql/commit/86ff9377b48962bff665351418e64120b1e65561", "message": "rohan comment", "committedDate": "2020-08-19T20:36:34Z", "type": "commit"}, {"oid": "86ff9377b48962bff665351418e64120b1e65561", "url": "https://github.com/confluentinc/ksql/commit/86ff9377b48962bff665351418e64120b1e65561", "message": "rohan comment", "committedDate": "2020-08-19T20:36:34Z", "type": "forcePushed"}, {"oid": "34a184dbd3682f80657491ec9189b0e6c3dfca33", "url": "https://github.com/confluentinc/ksql/commit/34a184dbd3682f80657491ec9189b0e6c3dfca33", "message": "Merge branch 'master' into distributing-executor-check-degraded", "committedDate": "2020-08-20T04:56:40Z", "type": "commit"}]}