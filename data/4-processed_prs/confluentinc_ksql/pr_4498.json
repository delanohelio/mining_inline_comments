{"pr_number": 4498, "pr_title": "feat: New API - get pull queries plugged into backend", "pr_createdAt": "2020-02-09T21:01:10Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4498", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NzkyMg==", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377477922", "bodyText": "To check my understanding: the problem with circular dependencies in this PR is that the new ksql-api module wants access to PullQueryExecutor and related files from ksql-rest-app, but that's not possible right now because ksql-rest-app depends on ksql-api, yes? And the reason you say this is temporary is because once the new API work is done, ksql-api and ksql-rest-app will be unified into a single module? Or did you have other plans", "author": "vcrfxia", "createdAt": "2020-02-11T07:39:25Z", "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/PullQueryExecutorDelegate.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.server.execution;\n+\n+import io.confluent.ksql.api.plugin.PullQueryApiExecutor;\n+import io.confluent.ksql.api.plugin.TableRows;\n+import io.confluent.ksql.parser.tree.Query;\n+import io.confluent.ksql.query.QueryId;\n+import io.confluent.ksql.rest.entity.TableRowsEntity;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.services.ServiceContext;\n+import io.confluent.ksql.statement.ConfiguredStatement;\n+import java.util.List;\n+\n+/**\n+ * Wrapper to break circular dependencies between modules. This is temporary until we migrate all", "originalCommit": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwNzQ3Mg==", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377507472", "bodyText": "Specifically, we need to call PullQueryExecutor from ksql-api, but that returns TableRowsEntity which is in ksql-rest-model. ksql-api can't depend on ksql-rest-model, as ksql-rest-app depends on ksql-rest-model and ksql-api. If it did depend on ksql-rest-model there would be a circular dep.", "author": "purplefox", "createdAt": "2020-02-11T09:02:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NzkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwNzc4MQ==", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377507781", "bodyText": "This is temporary as ksql-rest-app and ksql-rest-model will disappear when KLIP-15 is complete.", "author": "purplefox", "createdAt": "2020-02-11T09:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NzkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3ODI4OA==", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377478288", "bodyText": "This change to call queryHandle::start in a worker thread is unrelated to the addition of pull query support, right? (Just an improvement from the PR this one builds on?)", "author": "vcrfxia", "createdAt": "2020-02-11T07:40:55Z", "path": "ksql-api/src/main/java/io/confluent/ksql/api/server/BlockingQueryPublisher.java", "diffHunk": "@@ -132,7 +128,16 @@ protected void maybeSend() {\n \n   @Override\n   protected void afterSubscribe() {\n-    queryHandle.start();\n+    // Run async as it can block\n+    executeOnWorker(queryHandle::start);", "originalCommit": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwNzkyNg==", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377507926", "bodyText": "Yep", "author": "purplefox", "createdAt": "2020-02-11T09:03:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3ODI4OA=="}], "type": "inlineReview"}, {"oid": "cd104d0bfb9aa714680d7e328fc2a86c038f1d0f", "url": "https://github.com/confluentinc/ksql/commit/cd104d0bfb9aa714680d7e328fc2a86c038f1d0f", "message": "pull queries", "committedDate": "2020-02-11T22:06:07Z", "type": "commit"}, {"oid": "cd104d0bfb9aa714680d7e328fc2a86c038f1d0f", "url": "https://github.com/confluentinc/ksql/commit/cd104d0bfb9aa714680d7e328fc2a86c038f1d0f", "message": "pull queries", "committedDate": "2020-02-11T22:06:07Z", "type": "forcePushed"}]}