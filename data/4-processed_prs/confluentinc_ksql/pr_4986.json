{"pr_number": 4986, "pr_title": "Primary keys", "pr_createdAt": "2020-04-03T11:36:47Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4986", "timeline": [{"oid": "f8a869a64a0707a8deaf2f8357e404ed274c4469", "url": "https://github.com/confluentinc/ksql/commit/f8a869a64a0707a8deaf2f8357e404ed274c4469", "message": "feat: support `PRIMARY KEY` on table vs `KEY` on streams\n\nfixes: https://github.com/confluentinc/ksql/issues/3681\n\nThe commit introduces `PRIMARY KEY` columns into the ksqlDB syntax for tables. Streams will continue to have `KEY` columns. For example,\n\n```sql\nCREATE TABLE ORDERS (ID BIGINT PRIMARY KEY, USER_ID BIGINT, ...\n--vs\nCREATE STREAM ORDER_UPDATES (ID BIGINT KEY, USER_ID BIGINT, ...\n```\n\nThis change in syntax differentiates the key handling semantics for tables vs streams:\n\nA ksqlDB TABLE works much like tables in other SQL systems. Each row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL.\nA message in the underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the table,\nor _delete_ the row if the message's value is NULL, as long as the earlier row does not have a later timestamp / `ROWTIME`.\n\nA ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique. A stream can store its data in either `KEY` or `VALUE` columns.\nBoth `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same key.\n\nThe table below contrasts key handling for streams and tables:\n\n|                          |  STREAM                                                       | TABLE                                                             |\n| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\n| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\n| NON NULL key constraint  | No                                                            | Yes                                                               |\n:                          :                                                               : Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored :\n| Unique key constraint    | No                                                            | Yes                                                               |\n:                          : Messages with the same key as another have no special meaning : Later messages with the same key _replace_ earlier                :\n| Tombstones               | No                                                            | Yes                                                               |\n:                          : Messages with NULL values are ignored                         : NULL message values are treated as a _tombstone_                  :\n:                          :                                                               : Any existing row with a matching key is deleted                   :\n| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |", "committedDate": "2020-04-03T11:29:39Z", "type": "commit"}, {"oid": "81d7b4923e4ee3effd0477068169ad395e5bae41", "url": "https://github.com/confluentinc/ksql/commit/81d7b4923e4ee3effd0477068169ad395e5bae41", "message": "docs: doc updates for PRIMITIVE KEYS", "committedDate": "2020-04-03T11:30:15Z", "type": "commit"}, {"oid": "a9f9abbbbe238b508d8c2f12cdd1fc14f3376a04", "url": "https://github.com/confluentinc/ksql/commit/a9f9abbbbe238b508d8c2f12cdd1fc14f3376a04", "message": "test: test updates for primitive keys", "committedDate": "2020-04-03T11:31:41Z", "type": "commit"}, {"oid": "c740468d4efe6e07e50ec670f6ecf323c045e67c", "url": "https://github.com/confluentinc/ksql/commit/c740468d4efe6e07e50ec670f6ecf323c045e67c", "message": "chore: updated historical query plans", "committedDate": "2020-04-03T11:32:10Z", "type": "commit"}, {"oid": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "url": "https://github.com/confluentinc/ksql/commit/ce5e8f0b1033ce1ed0b34809101b57da87407d05", "message": "docs: fix table layout", "committedDate": "2020-04-03T11:38:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzExNzQ3NA==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403117474", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\n          \n          \n            \n            A ksqlDB STREAM is a stream of _facts_. Each fact is immutable and unique.", "author": "JimGalasyn", "createdAt": "2020-04-03T16:14:58Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyMDAzMQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403120031", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\n          \n          \n            \n            | Tombstones               | No <br> Messages with NULL values are ignored.                | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted.|", "author": "JimGalasyn", "createdAt": "2020-04-03T16:17:44Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyMDc3Nw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403120777", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\n          \n          \n            \n            | NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored.|", "author": "JimGalasyn", "createdAt": "2020-04-03T16:18:38Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyMTIwMQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403121201", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\n          \n          \n            \n            | NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored.|", "author": "JimGalasyn", "createdAt": "2020-04-03T16:19:06Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyMzA5NQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403123095", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\n          \n          \n            \n            key. This situation is handled differently by a [ksqlDB TABLE](./create-table), as shown in the following table.", "author": "JimGalasyn", "createdAt": "2020-04-03T16:21:24Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyMzU5Mw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403123593", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * `column_name`: the name of the column. If unquoted the name must be a valid\n          \n          \n            \n             * `column_name`: the name of the column. If unquoted, the name must be a valid", "author": "JimGalasyn", "createdAt": "2020-04-03T16:21:57Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyNTE4NA==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403125184", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\n          \n          \n            \n               [SQL identifier](../../concepts/schemas#valid-identifiers) and ksqlDB converts it to uppercase.", "author": "JimGalasyn", "createdAt": "2020-04-03T16:23:57Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0Mjg1NQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403242855", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\n          \n          \n            \n               identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars` ```.", "author": "JimGalasyn", "createdAt": "2020-04-03T18:52:28Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r\n+   The name can be quoted if case needs to be preserved or if the name is not a valid SQL\r\n+   identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0MzI5Mg==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403243292", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               If a column is not marked as a `KEY` column ksqlDB will load it from the Kafka message's value.\n          \n          \n            \n               If a column is not marked as a `KEY` column, ksqlDB loads it from the Kafka message's value.", "author": "JimGalasyn", "createdAt": "2020-04-03T18:53:15Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r\n+   The name can be quoted if case needs to be preserved or if the name is not a valid SQL\r\n+   identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\r\n+ * `data_type`: the SQL type of the column. Columns can be any of the\r\n+   [data types](../syntax-reference.md#ksqldb-data-types) supported by ksqlDB.\r\n+ * `KEY`: columns that are stored in the Kafka message's key should be marked as `KEY` columns.\r\n+   If a column is not marked as a `KEY` column ksqlDB will load it from the Kafka message's value.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0Njk0Nw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403246947", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\n          \n          \n            \n            underlying Kafka topic that has the same key as an existing row will _replace_ the earlier row in the", "author": "JimGalasyn", "createdAt": "2020-04-03T18:58:33Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0ODIyNw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403248227", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\n          \n          \n            \n            a later timestamp / `ROWTIME`. This situation is handled differently by a [ksqlDB STREAM](./create-stream), as shown in the following table.", "author": "JimGalasyn", "createdAt": "2020-04-03T19:00:01Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0ODU0Mw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403248543", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\n          \n          \n            \n            | NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored.|", "author": "JimGalasyn", "createdAt": "2020-04-03T19:00:26Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0ODg4OA==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403248888", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\n          \n          \n            \n            | Unique key constraint    | No <br> Messages with the same key as another have no special meaning.| Yes <br> Later messages with the same key _replace_ earlier.|", "author": "JimGalasyn", "createdAt": "2020-04-03T19:00:53Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI0OTgyMg==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403249822", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\n          \n          \n            \n            | Tombstones               | No <br> Messages with NULL values are ignored.                | Yes <br> NULL message values are treated as a _tombstone_. <br> Any existing row with a matching key is deleted. |", "author": "JimGalasyn", "createdAt": "2020-04-03T19:02:07Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1MDAxOA==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403250018", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * `column_name`: the name of the column. If unquoted the name must be a valid\n          \n          \n            \n             * `column_name`: the name of the column. If unquoted, the name must be a valid", "author": "JimGalasyn", "createdAt": "2020-04-03T19:02:29Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1MDc1Nw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403250757", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\n          \n          \n            \n               [SQL identifier](../../concepts/schemas#valid-identifiers) and and ksqlDB converts it to uppercase.", "author": "JimGalasyn", "createdAt": "2020-04-03T19:03:23Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1MTQyMw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403251423", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\n          \n          \n            \n               identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars` ```.", "author": "JimGalasyn", "createdAt": "2020-04-03T19:04:13Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r\n+   The name can be quoted if case needs to be preserved or if the name is not a valid SQL\r\n+   identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1MTcyMA==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403251720", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               `PRIMARY KEY` columns. If a column is not marked as a `PRIMARY KEY` column ksqlDB will load it\n          \n          \n            \n               `PRIMARY KEY` columns. If a column is not marked as a `PRIMARY KEY` column, ksqlDB loads it", "author": "JimGalasyn", "createdAt": "2020-04-03T19:04:43Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r\n+   The name can be quoted if case needs to be preserved or if the name is not a valid SQL\r\n+   identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\r\n+ * `data_type`: the SQL type of the column. Columns can be any of the\r\n+   [data types](../syntax-reference.md#ksqldb-data-types) supported by ksqlDB.\r\n+ * `PRIMARY KEY`: columns that are stored in the Kafka message's key should be marked as\r\n+   `PRIMARY KEY` columns. If a column is not marked as a `PRIMARY KEY` column ksqlDB will load it\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1MjE3Mw==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403252173", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               are NON NULL. Any records in the Kafka topic with NULL key columns will be dropped.\n          \n          \n            \n               is NON NULL. Any records in the Kafka topic with NULL key columns are dropped.", "author": "JimGalasyn", "createdAt": "2020-04-03T19:05:42Z", "path": "docs-md/developer-guide/ksqldb-reference/create-table.md", "diffHunk": "@@ -10,25 +10,44 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE TABLE table_name ( { column_name data_type } [, ...] )\r\n+CREATE TABLE table_name ( { column_name data_type (PRIMARY KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new table with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new table with the specified columns and properties.\r\n+\r\n+A ksqlDB TABLE works much like tables in other SQL systems. A table has zero or more rows. Each\r\n+row is identified by its `PRIMARY KEY`. `PRIMARY KEY` values can not be NULL. A message in the\r\n+underlying Kafka topic with the same key as an existing row will _replace_ the earlier row in the\r\n+table, or _delete_ the row if the message's value is NULL, as long as the earlier row does not have\r\n+a later timestamp / `ROWTIME`. The table below contrasts this to a [ksqlDB STREAM](./create-stream):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r\n+| Unique key constraint    | No <br> Messages with the same key as another have no special meaning | Yes <br> Later messages with the same key _replace_ earlier |\r\n+| Tombstones               | No <br> Messages with NULL values are ignored                 | Yes <br> NULL message values are treated as a _tombstone_ <br> Any existing row with a matching key is deleted |\r\n+\r\n+Each column is defined by:\r\n+ * `column_name`: the name of the column. If unquoted the name must be a valid\r\n+   [SQL identifier](../../concepts/schemas#valid-identifiers) and will be converted to uppercase.\r\n+   The name can be quoted if case needs to be preserved or if the name is not a valid SQL\r\n+   identifier, for example ``` `mixedCaseId` ``` or ``` `$with@invalid!chars`.\r\n+ * `data_type`: the SQL type of the column. Columns can be any of the\r\n+   [data types](../syntax-reference.md#ksqldb-data-types) supported by ksqlDB.\r\n+ * `PRIMARY KEY`: columns that are stored in the Kafka message's key should be marked as\r\n+   `PRIMARY KEY` columns. If a column is not marked as a `PRIMARY KEY` column ksqlDB will load it\r\n+   from the Kafka message's value. Unlike a stream's `KEY` column, a table's `PRIMARY KEY` column\r\n+   are NON NULL. Any records in the Kafka topic with NULL key columns will be dropped.\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODY4MQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403868681", "bodyText": "This is true for now (since we only support unwrapped primitive keys), but it won't be true in the future if we support single-element wrapped keys right?", "author": "rodesai", "createdAt": "2020-04-06T07:02:24Z", "path": "docs-md/developer-guide/ksqldb-reference/create-stream.md", "diffHunk": "@@ -13,16 +13,37 @@ Synopsis\n --------\r\n \r\n ```sql\r\n-CREATE STREAM stream_name ( { column_name data_type } [, ...] )\r\n+CREATE STREAM stream_name ( { column_name data_type (KEY) } [, ...] )\r\n   WITH ( property_name = expression [, ...] );\r\n ```\r\n \r\n Description\r\n -----------\r\n \r\n-Create a new stream with the specified columns and properties. Columns\r\n-can be any of the [data types](../syntax-reference.md#ksqldb-data-types) supported by\r\n-ksqlDB.\r\n+Create a new stream with the specified columns and properties.\r\n+\r\n+A ksqlDB STREAM is a stream of _facts_. Each _fact_ is immutable and is unique.\r\n+A stream can store its data in either `KEY` or `VALUE` columns.\r\n+Both `KEY` and `VALUE` columns can be NULL. No special processing is done if two rows have the same\r\n+key. The table below contrasts this to a [ksqlDB TABLE](./create-table):\r\n+\r\n+|                          |  STREAM                                                       | TABLE                                                             |\r\n+| ------------------------ | --------------------------------------------------------------| ----------------------------------------------------------------- |\r\n+| Key column type          | `KEY`                                                         | `PRIMARY KEY`                                                     |\r\n+| NON NULL key constraint  | No                                                            | Yes <br> Messages in the Kafka topic with a NULL `PRIMARY KEY` are ignored |\r", "originalCommit": "ce5e8f0b1033ce1ed0b34809101b57da87407d05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk2MTE5OA==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r403961198", "bodyText": "In a strict SQL sense this should remain true for wrapped and multi-column primary keys. Primary key columns in SQL must be NON NULL.\nThe main reason for this is that an SQL NULL is not comparable to another SQL NULL, i.e. NULL = NULL returns false.  So a NULL value in a primary key could never be matched.", "author": "big-andy-coates", "createdAt": "2020-04-06T09:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODY4MQ=="}], "type": "inlineReview"}, {"oid": "42ad42f7a7328ebeebff1caa94cc513af980d9ff", "url": "https://github.com/confluentinc/ksql/commit/42ad42f7a7328ebeebff1caa94cc513af980d9ff", "message": "chore: use 'primary key' when output schemas in CLI", "committedDate": "2020-04-06T13:13:00Z", "type": "commit"}, {"oid": "8fa7128a490c8ae76fccce719a89e92fa385654e", "url": "https://github.com/confluentinc/ksql/commit/8fa7128a490c8ae76fccce719a89e92fa385654e", "message": "docs: jim's requested changes", "committedDate": "2020-04-06T13:21:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Mzg2MQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r404453861", "bodyText": "nit: we should start with the error message (Streams do not support ...) and then give what failed (thinking about cases where only number of chars are returned)", "author": "agavra", "createdAt": "2020-04-06T23:45:06Z", "path": "ksqldb-parser/src/main/java/io/confluent/ksql/parser/tree/CreateStream.java", "diffHunk": "@@ -83,4 +88,25 @@ public String toString() {\n         .add(\"properties\", getProperties())\n         .toString();\n   }\n+\n+  private static void throwOnPrimaryKeys(final TableElements elements) {\n+    final String badEs = elements.stream()\n+        .filter(e -> e.getNamespace().isKey() && e.getNamespace() != Namespace.KEY)\n+        .map(badE ->\n+            badE.getLocation().map(NodeLocation::asPrefix).orElse(\"\") + badE.getName())\n+        .collect(Collectors.joining(System.lineSeparator()));\n+\n+    if (!badEs.isEmpty()) {\n+      throw new KsqlException(\"The following columns are defined as PRIMARY KEY columns. \"\n+          + \"Streams do not support PRIMARY KEY columns, only KEY columns.\"", "originalCommit": "f8a869a64a0707a8deaf2f8357e404ed274c4469", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4MTA3Ng==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r404681076", "bodyText": "done", "author": "big-andy-coates", "createdAt": "2020-04-07T09:49:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Mzg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Mzk5MQ==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r404453991", "bodyText": "ditto", "author": "agavra", "createdAt": "2020-04-06T23:45:27Z", "path": "ksqldb-parser/src/main/java/io/confluent/ksql/parser/tree/CreateTable.java", "diffHunk": "@@ -83,4 +88,25 @@ public String toString() {\n         .add(\"properties\", getProperties())\n         .toString();\n   }\n+\n+  private static void throwOnNonPrimaryKeys(final TableElements elements) {\n+    final String badEs = elements.stream()\n+        .filter(e -> e.getNamespace().isKey() && e.getNamespace() != Namespace.PRIMARY_KEY)\n+        .map(badE ->\n+            badE.getLocation().map(NodeLocation::asPrefix).orElse(\"\") + badE.getName())\n+        .collect(Collectors.joining(System.lineSeparator()));\n+\n+    if (!badEs.isEmpty()) {\n+      throw new KsqlException(\"The following columns are defined as KEY columns. \"\n+          + \"Tables do not support KEY columns, only PRIMARY KEY columns.\"", "originalCommit": "f8a869a64a0707a8deaf2f8357e404ed274c4469", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4MTExMg==", "url": "https://github.com/confluentinc/ksql/pull/4986#discussion_r404681112", "bodyText": "done", "author": "big-andy-coates", "createdAt": "2020-04-07T09:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Mzk5MQ=="}], "type": "inlineReview"}, {"oid": "18f44b67d5b7b25aa10a9ecfddaf2d3d9ed80d9f", "url": "https://github.com/confluentinc/ksql/commit/18f44b67d5b7b25aa10a9ecfddaf2d3d9ed80d9f", "message": "chore: updated error message", "committedDate": "2020-04-07T09:41:44Z", "type": "commit"}, {"oid": "ebfc67d4077af9999cdd8e382b5cf5f9f5532164", "url": "https://github.com/confluentinc/ksql/commit/ebfc67d4077af9999cdd8e382b5cf5f9f5532164", "message": "chore: updated error message", "committedDate": "2020-04-07T09:46:26Z", "type": "commit"}, {"oid": "d38cf3e83752618a04d7c7afc92b9b498e43ba6f", "url": "https://github.com/confluentinc/ksql/commit/d38cf3e83752618a04d7c7afc92b9b498e43ba6f", "message": "chore: fix findbugs in test", "committedDate": "2020-04-07T10:27:14Z", "type": "commit"}]}