{"pr_number": 4932, "pr_title": "docs: migration instructions for KSQL 5.4 to ksqlDB 5.5 (DOCS-3744)", "pr_createdAt": "2020-03-30T17:28:47Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4932", "timeline": [{"oid": "b420bf16bd768d01f07214abb7e9e603b571edf4", "url": "https://github.com/confluentinc/ksql/commit/b420bf16bd768d01f07214abb7e9e603b571edf4", "message": "docs: migration instructions for KSQL 5.4 to ksqlDB 5.5 (DOCS-3744)", "committedDate": "2020-03-30T17:26:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3MjI1Nw==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r400472257", "bodyText": "could be role bindings if you use rbac, acls if you use acls, or skip if you don't use authorization.\nRole-bindings should be assigned to the ksql service principal.", "author": "stan-confluent", "createdAt": "2020-03-30T20:26:31Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -6,26 +6,80 @@ Upgrading KSQL\n Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n capacity to take over temporarily for unavailable, restarting servers.\n \n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" \n+   ```\n+\n+#. List your application's streams, tables, and types. Don't use the EXTENDED\n+   option. Go through each list, and find the the last CREATE statement for each\n+   stream/table/type name. Order the CREATE statements so they show the correct\n+   dependencies.\n+   \n+#. Make other compatibility-related changes, as shown in the\n+   `upgrade guide <https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade>`__.\n+\n+#. Stop the ``ksql`` service.\n+\n+#. Uninstall the v5.4 ksql rpm package.\n+\n+#. Install the v5.5 ksqldb rpm package.\n+\n+#. Copy the v5.4 configuration file to the v5.5 ksqldb configuration\n+   folder, which is located at ``${CONFLUENT_HOME}/etc/ksqldb``:\n+\n+   ```bash\n+   cp /etc/ksql/ksql-server.properties /etc/ksqldb/ksql-server.properties\n+   ```\n+\n+#. Change the ``ksql.service.id`` in the property file, for example, from\n+   ``default_`` to ``ksqldb_``.\n+\n+#. Create role bindings for the ``ksql`` service principal. For more information,\n+   see :ref:`ksql-rbac`.\n+\n+#. Create three new role bindings:", "originalCommit": "b420bf16bd768d01f07214abb7e9e603b571edf4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3MzIzNw==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r400473237", "bodyText": "5.4 -> 5.5 is not a rolling restart, ie you'll need to shut down all ksql instances and then start up all ksqldb instances, meaning there will be downtime - but please double check with ksql folks.", "author": "stan-confluent", "createdAt": "2020-03-30T20:28:18Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -6,26 +6,80 @@ Upgrading KSQL\n Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n capacity to take over temporarily for unavailable, restarting servers.\n \n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command", "originalCommit": "b420bf16bd768d01f07214abb7e9e603b571edf4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NDI3Mg==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r400474272", "bodyText": "can confirm", "author": "agavra", "createdAt": "2020-03-30T20:29:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3MzIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NDA1Mg==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r400474052", "bodyText": "Would be good to include general 5.4 ksql to 5.5 ksqldb upgrade info from https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/ - or have a link to that upgrade doc at the beginning of 5.4->5.5 section", "author": "stan-confluent", "createdAt": "2020-03-30T20:29:33Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -6,26 +6,80 @@ Upgrading KSQL\n Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n capacity to take over temporarily for unavailable, restarting servers.\n \n+Upgrading to ksqlDB 5.5 from KSQL 5.4", "originalCommit": "b420bf16bd768d01f07214abb7e9e603b571edf4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "url": "https://github.com/confluentinc/ksql/commit/2ed5e20e2bea66e9af952111af9919bbe6d19525", "message": "docs: incorporate feedback", "committedDate": "2020-03-31T20:23:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM5OTE2NQ==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402399165", "bodyText": "I'm not sure about using this command. I might have a mix of CREATE & DROP statements that end up on dropped streams, The user will need to walk through that list and figure out which streams and tables do not exist anymore.\nAlso, what's the difference between this step and the next one that says List your application's streams ...?  Isn't the same?", "author": "spena", "createdAt": "2020-04-02T15:21:40Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -1,31 +1,97 @@\n .. _upgrading-ksql:\n \n-Upgrading KSQL\n-==============\n+Upgrading ksqlDB\n+================\n \n-Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n-capacity to take over temporarily for unavailable, restarting servers.\n+Upgrade one server at a time in a \"rolling restart\". The remaining servers\n+should have sufficient spare capacity to take over temporarily for unavailable,\n+restarting servers.\n+\n+For general guidance on upgrading, see\n+[Upgrade ksqlDB](https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/).\n+\n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+.. important::\n+\n+   The upgrade from KSQL 5.4 to ksqlDB 5.5 is not a rolling restart. You must\n+   shut down all KSQL instances and then start up all ksqlDB instances, so there\n+   will be downtime.\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" ", "originalCommit": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNzYyNA==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402427624", "bodyText": "#4971 just as an FYI - also it might be OK to have users replay the CREATE/DROP pairings because they'll end up in the same state", "author": "agavra", "createdAt": "2020-04-02T16:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM5OTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5NzY3Ng==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402597676", "bodyText": "See my other comment :)", "author": "stan-confluent", "createdAt": "2020-04-02T21:09:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM5OTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAyODYzOQ==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r405028639", "bodyText": "I reworked the instructions for getting the SQL statements to be more like https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade.", "author": "JimGalasyn", "createdAt": "2020-04-07T18:37:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM5OTE2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxMzQ1Mw==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402413453", "bodyText": "Which command are you recommending here? I just used DESCRIBE without EXTENDED. However, there is no CREATE statement in the DESCRIBE command.\nksql> describe ps1;\n\nName                 : PS1\n Field   | Type                      \n\n ROWTIME | BIGINT           (system) \n ROWKEY  | VARCHAR(STRING)  (system) \n ID      | INTEGER                   \n\nFor runtime statistics and query details run: DESCRIBE EXTENDED <Stream,Table>;\n\nShould we say the user needs to re-create the CREATE statement based on the displayed schema?", "author": "spena", "createdAt": "2020-04-02T15:40:50Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -1,31 +1,97 @@\n .. _upgrading-ksql:\n \n-Upgrading KSQL\n-==============\n+Upgrading ksqlDB\n+================\n \n-Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n-capacity to take over temporarily for unavailable, restarting servers.\n+Upgrade one server at a time in a \"rolling restart\". The remaining servers\n+should have sufficient spare capacity to take over temporarily for unavailable,\n+restarting servers.\n+\n+For general guidance on upgrading, see\n+[Upgrade ksqlDB](https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/).\n+\n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+.. important::\n+\n+   The upgrade from KSQL 5.4 to ksqlDB 5.5 is not a rolling restart. You must\n+   shut down all KSQL instances and then start up all ksqlDB instances, so there\n+   will be downtime.\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" \n+   ```\n+\n+#. List your application's streams, tables, and types. Don't use the EXTENDED\n+   option. Go through each list, and find the the last CREATE statement for each\n+   stream/table/type name. Order the CREATE statements so they show the correct\n+   dependencies.", "originalCommit": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5NzQyMA==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402597420", "bodyText": "From what I've seen, neither DESCRIBE nor DESCRIBE EXTENDED print the CREATE statements for streams/tables, only for persistent queries, in 5.4. In 5.5, DESCRIBE EXTENDED does print CREATE statements for all the streams/tables - which is why I personally first printed all the streams/tables that are present in the system via list; then dumped the topic and found a corresponding CREATE statement for each stream/table so that I could re-create them.", "author": "stan-confluent", "createdAt": "2020-04-02T21:08:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxMzQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMzMjU5NA==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r403332594", "bodyText": "@stan-confluent Is it safe to say that you did something like what @big-andy-coates  recommends here? If so, I'll use his procedure.", "author": "JimGalasyn", "createdAt": "2020-04-03T20:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxMzQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAyMzA5MQ==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r405023091", "bodyText": "I reworked the steps to be like the procedure here: https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade.", "author": "JimGalasyn", "createdAt": "2020-04-07T18:28:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxMzQ1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMjYzMQ==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402422631", "bodyText": "Should this be a sub-section of the previous step in case the user has RBAC or ACLs enabled? If not, then this step is not essential for users without security.\nAlso, what permissions des ksql need? write, read, describe?", "author": "spena", "createdAt": "2020-04-02T15:53:31Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -1,31 +1,97 @@\n .. _upgrading-ksql:\n \n-Upgrading KSQL\n-==============\n+Upgrading ksqlDB\n+================\n \n-Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n-capacity to take over temporarily for unavailable, restarting servers.\n+Upgrade one server at a time in a \"rolling restart\". The remaining servers\n+should have sufficient spare capacity to take over temporarily for unavailable,\n+restarting servers.\n+\n+For general guidance on upgrading, see\n+[Upgrade ksqlDB](https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/).\n+\n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+.. important::\n+\n+   The upgrade from KSQL 5.4 to ksqlDB 5.5 is not a rolling restart. You must\n+   shut down all KSQL instances and then start up all ksqlDB instances, so there\n+   will be downtime.\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" \n+   ```\n+\n+#. List your application's streams, tables, and types. Don't use the EXTENDED\n+   option. Go through each list, and find the the last CREATE statement for each\n+   stream/table/type name. Order the CREATE statements so they show the correct\n+   dependencies.\n+   \n+#. Make other compatibility-related changes, as shown in the\n+   `upgrade guide <https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade>`__.\n+\n+#. Stop the ``ksql`` service.\n+\n+#. Uninstall the ksql 5.4 DEB or RPM package.\n+\n+#. Install the ksqldb 5.5 DEB or RPM package.\n+\n+#. Copy the version 5.4 configuration file to the ksqldb 5.5 configuration\n+   folder, which is located at ``${CONFLUENT_HOME}/etc/ksqldb``:\n+\n+   ```bash\n+   cp /etc/ksql/ksql-server.properties /etc/ksqldb/ksql-server.properties\n+   ```\n+\n+#. Change the ``ksql.service.id`` in the property file, for example, from\n+   ``default_`` to ``ksqldb_``.\n+\n+#. Set up security for your ksqlDB app. ksqlDB supports using\n+   :ref:`role-based access control (RBAC) <ksql-rbac>`,\n+   :ref:`ACLs <config-security-ksql-acl>`, and no authorization.\n+\n+#. Create three new role bindings or assign ACLs for the ``ksql`` service\n+   principal:\n+\n+   - Topic: ``__consumer_offsets``\n+   - Topic: ``__transaction_state``\n+   - TransactionalId: ``ksqldb_``. Use the value that you set in the\n+     configuration file.", "originalCommit": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY0MTEzNQ==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402641135", "bodyText": "@spena @stan-confluent Are these new role bindings for 5.5? I don't have them documented. @stan-confluent , can you post the rbac commands that you used?", "author": "JimGalasyn", "createdAt": "2020-04-02T22:51:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMjYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA5MDMxNw==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r405090317", "bodyText": "Sorry, I don't have the commands - did it via the UI. I granted the ResourceOwner permissions, but I think DeveloperWrite (+ possibly DeveloperManager) would work too - here's the source of truth:\nhttps://github.com/confluentinc/ksql/pull/3660/files#diff-b2344446085218073ba234df216f085d\nYou can see which roles would grant you these permissions here - https://github.com/confluentinc/ce-kafka/blob/master/ce-rbac/src/main/resources/default_rbac_roles.json", "author": "stan-confluent", "createdAt": "2020-04-07T20:25:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMjYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyOTM4OA==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r405729388", "bodyText": "@stan-confluent @spena I added the ACLs and role bindings, let me know if they're in the ballpark.", "author": "JimGalasyn", "createdAt": "2020-04-08T18:30:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMjYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMzgxNw==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402423817", "bodyText": "Could you put an example of how to run the file? Also, the first step didn't mention writing the list of statements to a file.", "author": "spena", "createdAt": "2020-04-02T15:55:00Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -1,31 +1,97 @@\n .. _upgrading-ksql:\n \n-Upgrading KSQL\n-==============\n+Upgrading ksqlDB\n+================\n \n-Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n-capacity to take over temporarily for unavailable, restarting servers.\n+Upgrade one server at a time in a \"rolling restart\". The remaining servers\n+should have sufficient spare capacity to take over temporarily for unavailable,\n+restarting servers.\n+\n+For general guidance on upgrading, see\n+[Upgrade ksqlDB](https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/).\n+\n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+.. important::\n+\n+   The upgrade from KSQL 5.4 to ksqlDB 5.5 is not a rolling restart. You must\n+   shut down all KSQL instances and then start up all ksqlDB instances, so there\n+   will be downtime.\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" \n+   ```\n+\n+#. List your application's streams, tables, and types. Don't use the EXTENDED\n+   option. Go through each list, and find the the last CREATE statement for each\n+   stream/table/type name. Order the CREATE statements so they show the correct\n+   dependencies.\n+   \n+#. Make other compatibility-related changes, as shown in the\n+   `upgrade guide <https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade>`__.\n+\n+#. Stop the ``ksql`` service.\n+\n+#. Uninstall the ksql 5.4 DEB or RPM package.\n+\n+#. Install the ksqldb 5.5 DEB or RPM package.\n+\n+#. Copy the version 5.4 configuration file to the ksqldb 5.5 configuration\n+   folder, which is located at ``${CONFLUENT_HOME}/etc/ksqldb``:\n+\n+   ```bash\n+   cp /etc/ksql/ksql-server.properties /etc/ksqldb/ksql-server.properties\n+   ```\n+\n+#. Change the ``ksql.service.id`` in the property file, for example, from\n+   ``default_`` to ``ksqldb_``.\n+\n+#. Set up security for your ksqlDB app. ksqlDB supports using\n+   :ref:`role-based access control (RBAC) <ksql-rbac>`,\n+   :ref:`ACLs <config-security-ksql-acl>`, and no authorization.\n+\n+#. Create three new role bindings or assign ACLs for the ``ksql`` service\n+   principal:\n+\n+   - Topic: ``__consumer_offsets``\n+   - Topic: ``__transaction_state``\n+   - TransactionalId: ``ksqldb_``. Use the value that you set in the\n+     configuration file.\n+\n+#. Start the ``ksqldb`` service.\n+\n+#. Run the file that you prepared previously.", "originalCommit": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNTA2NA==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402425064", "bodyText": "Should this be part of the step of copying the configuration files to ksqldb? I think it should be there as the users are starting ksql at that point, then they will find out this extra step to copy other configs.", "author": "spena", "createdAt": "2020-04-02T15:56:44Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -1,31 +1,97 @@\n .. _upgrading-ksql:\n \n-Upgrading KSQL\n-==============\n+Upgrading ksqlDB\n+================\n \n-Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n-capacity to take over temporarily for unavailable, restarting servers.\n+Upgrade one server at a time in a \"rolling restart\". The remaining servers\n+should have sufficient spare capacity to take over temporarily for unavailable,\n+restarting servers.\n+\n+For general guidance on upgrading, see\n+[Upgrade ksqlDB](https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/).\n+\n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+.. important::\n+\n+   The upgrade from KSQL 5.4 to ksqlDB 5.5 is not a rolling restart. You must\n+   shut down all KSQL instances and then start up all ksqlDB instances, so there\n+   will be downtime.\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" \n+   ```\n+\n+#. List your application's streams, tables, and types. Don't use the EXTENDED\n+   option. Go through each list, and find the the last CREATE statement for each\n+   stream/table/type name. Order the CREATE statements so they show the correct\n+   dependencies.\n+   \n+#. Make other compatibility-related changes, as shown in the\n+   `upgrade guide <https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade>`__.\n+\n+#. Stop the ``ksql`` service.\n+\n+#. Uninstall the ksql 5.4 DEB or RPM package.\n+\n+#. Install the ksqldb 5.5 DEB or RPM package.\n+\n+#. Copy the version 5.4 configuration file to the ksqldb 5.5 configuration\n+   folder, which is located at ``${CONFLUENT_HOME}/etc/ksqldb``:\n+\n+   ```bash\n+   cp /etc/ksql/ksql-server.properties /etc/ksqldb/ksql-server.properties\n+   ```\n+\n+#. Change the ``ksql.service.id`` in the property file, for example, from\n+   ``default_`` to ``ksqldb_``.\n+\n+#. Set up security for your ksqlDB app. ksqlDB supports using\n+   :ref:`role-based access control (RBAC) <ksql-rbac>`,\n+   :ref:`ACLs <config-security-ksql-acl>`, and no authorization.\n+\n+#. Create three new role bindings or assign ACLs for the ``ksql`` service\n+   principal:\n+\n+   - Topic: ``__consumer_offsets``\n+   - Topic: ``__transaction_state``\n+   - TransactionalId: ``ksqldb_``. Use the value that you set in the\n+     configuration file.\n+\n+#. Start the ``ksqldb`` service.\n+\n+#. Run the file that you prepared previously.\n+\n+.. note::\n+\n+    In addition to copying the properties file from ``ksql`` to ``ksqldb``, you may\n+    need to copy other configs, like log4j and systemd overrides, depending on how\n+    you have customized your deployment.", "originalCommit": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMDI5Mg==", "url": "https://github.com/confluentinc/ksql/pull/4932#discussion_r402430292", "bodyText": "for RPM - you can just use yum swap (not sure if we want to mention that here though because I guess what you have would work)", "author": "agavra", "createdAt": "2020-04-02T16:04:05Z", "path": "docs/installation/upgrading.rst", "diffHunk": "@@ -1,31 +1,97 @@\n .. _upgrading-ksql:\n \n-Upgrading KSQL\n-==============\n+Upgrading ksqlDB\n+================\n \n-Upgrade one KSQL server at a time (i.e. rolling restart). The remaining KSQL servers should have sufficient spare\n-capacity to take over temporarily for unavailable, restarting servers.\n+Upgrade one server at a time in a \"rolling restart\". The remaining servers\n+should have sufficient spare capacity to take over temporarily for unavailable,\n+restarting servers.\n+\n+For general guidance on upgrading, see\n+[Upgrade ksqlDB](https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/).\n+\n+Upgrading to ksqlDB 5.5 from KSQL 5.4\n+-------------------------------------\n+\n+.. important::\n+\n+   The upgrade from KSQL 5.4 to ksqlDB 5.5 is not a rolling restart. You must\n+   shut down all KSQL instances and then start up all ksqlDB instances, so there\n+   will be downtime.\n+\n+#. Prepare a list of SQL statements for migration. One way is to dump the command\n+   topic.\n+\n+   ```bash\n+   ./bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic _confluent-ksql-default__command_topic --from-beginning | jq \".statement\" \n+   ```\n+\n+#. List your application's streams, tables, and types. Don't use the EXTENDED\n+   option. Go through each list, and find the the last CREATE statement for each\n+   stream/table/type name. Order the CREATE statements so they show the correct\n+   dependencies.\n+   \n+#. Make other compatibility-related changes, as shown in the\n+   `upgrade guide <https://docs.ksqldb.io/en/latest/operate-and-deploy/installation/upgrading/#how-to-upgrade>`__.\n+\n+#. Stop the ``ksql`` service.\n+\n+#. Uninstall the ksql 5.4 DEB or RPM package.\n+\n+#. Install the ksqldb 5.5 DEB or RPM package.", "originalCommit": "2ed5e20e2bea66e9af952111af9919bbe6d19525", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "00d9182c30f9c1fdc8f50f03aa772591eb83eca6", "url": "https://github.com/confluentinc/ksql/commit/00d9182c30f9c1fdc8f50f03aa772591eb83eca6", "message": "docs: incorporate feedback", "committedDate": "2020-04-03T17:49:01Z", "type": "commit"}, {"oid": "b0a390056e0cd15a81b244b5f29aa4c091c43ce7", "url": "https://github.com/confluentinc/ksql/commit/b0a390056e0cd15a81b244b5f29aa4c091c43ce7", "message": "docs: incorporate feedback; rework steps for creating SQL file", "committedDate": "2020-04-07T18:25:25Z", "type": "commit"}, {"oid": "76ddb7f863a11b193f98f26784c43eb6fa52899b", "url": "https://github.com/confluentinc/ksql/commit/76ddb7f863a11b193f98f26784c43eb6fa52899b", "message": "docs: add ACLs and role bindings", "committedDate": "2020-04-08T18:29:25Z", "type": "commit"}]}