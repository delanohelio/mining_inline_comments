{"pr_number": 6727, "pr_title": "fix: catch stack overflow error when parsing/preparing statements", "pr_createdAt": "2020-12-05T00:31:53Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6727", "timeline": [{"oid": "c59d7df1695743c73250b2e4421119f777f4ea1c", "url": "https://github.com/confluentinc/ksql/commit/c59d7df1695743c73250b2e4421119f777f4ea1c", "message": "fix: catch stack overflow error when parsing/preparing statements", "committedDate": "2020-12-05T00:31:37Z", "type": "commit"}, {"oid": "947b3d3a5865f7f2f3940d7b44a373333d10ad29", "url": "https://github.com/confluentinc/ksql/commit/947b3d3a5865f7f2f3940d7b44a373333d10ad29", "message": "add QTT", "committedDate": "2020-12-08T17:46:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY4MzU2Mw==", "url": "https://github.com/confluentinc/ksql/pull/6727#discussion_r538683563", "bodyText": "nit: might make sense to include the GH ticket in the error message so that users can understand which part and what to do about it (namely, make the nested parenthesis less nested)", "author": "agavra", "createdAt": "2020-12-08T18:15:01Z", "path": "ksqldb-parser/src/main/java/io/confluent/ksql/parser/AstBuilder.java", "diffHunk": "@@ -1474,9 +1474,13 @@ private static OptionalInt getLimit(final LimitClauseContext limitContext) {\n   }\n \n   private static Set<SourceName> getSources(final ParseTree parseTree) {\n-    final SourceAccumulator accumulator = new SourceAccumulator();\n-    accumulator.visit(parseTree);\n-    return accumulator.getSources();\n+    try {\n+      final SourceAccumulator accumulator = new SourceAccumulator();\n+      accumulator.visit(parseTree);\n+      return accumulator.getSources();\n+    } catch (StackOverflowError e) {\n+      throw new KsqlException(\"Error processing statement: Statement is too large to parse.\");", "originalCommit": "947b3d3a5865f7f2f3940d7b44a373333d10ad29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0NjE0Mw==", "url": "https://github.com/confluentinc/ksql/pull/6727#discussion_r538746143", "bodyText": "I updated the error messages to suggest that nested expressions could be causing the error.", "author": "stevenpyzhang", "createdAt": "2020-12-08T19:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY4MzU2Mw=="}], "type": "inlineReview"}, {"oid": "49374480f2d228eb5b30a0c0617bbaa014adf2b3", "url": "https://github.com/confluentinc/ksql/commit/49374480f2d228eb5b30a0c0617bbaa014adf2b3", "message": "update error message", "committedDate": "2020-12-08T19:25:42Z", "type": "commit"}, {"oid": "41ff83c53af7a6d4b4c5b32438ce0b30b41ea233", "url": "https://github.com/confluentinc/ksql/commit/41ff83c53af7a6d4b4c5b32438ce0b30b41ea233", "message": "temp", "committedDate": "2020-12-08T20:51:22Z", "type": "forcePushed"}, {"oid": "5b53318f9f70d4b8a752c6eee7ac6982c8c0c06c", "url": "https://github.com/confluentinc/ksql/commit/5b53318f9f70d4b8a752c6eee7ac6982c8c0c06c", "message": "temp", "committedDate": "2020-12-08T21:22:11Z", "type": "forcePushed"}, {"oid": "45e7efefc458f90a733d5b9dedeb1c1a4b64d468", "url": "https://github.com/confluentinc/ksql/commit/45e7efefc458f90a733d5b9dedeb1c1a4b64d468", "message": "update test", "committedDate": "2020-12-09T17:00:17Z", "type": "commit"}, {"oid": "45e7efefc458f90a733d5b9dedeb1c1a4b64d468", "url": "https://github.com/confluentinc/ksql/commit/45e7efefc458f90a733d5b9dedeb1c1a4b64d468", "message": "update test", "committedDate": "2020-12-09T17:00:17Z", "type": "forcePushed"}]}