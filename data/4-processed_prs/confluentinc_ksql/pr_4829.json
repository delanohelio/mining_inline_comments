{"pr_number": 4829, "pr_title": "feat: add COALESCE function", "pr_createdAt": "2020-03-19T16:49:40Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4829", "timeline": [{"oid": "02f6b247f7821acc7f96502c4366a0f7714bd526", "url": "https://github.com/confluentinc/ksql/commit/02f6b247f7821acc7f96502c4366a0f7714bd526", "message": "feat: add COALESCE function\n\nThe `COALESCE` function takes one or more parameters and returns the first that is non-null.\n\nAll parameters must be of the same type.\n\nThis function supersedes the existing `IFNULL` function, which only worked for strings and one accepted two parameters.", "committedDate": "2020-03-19T16:48:27Z", "type": "commit"}, {"oid": "259fbd5d401ceda270b79b43d367d16245d4d709", "url": "https://github.com/confluentinc/ksql/commit/259fbd5d401ceda270b79b43d367d16245d4d709", "message": "test: add test using coalesce in PARTITION BY", "committedDate": "2020-03-19T17:14:41Z", "type": "commit"}, {"oid": "9162c228143fd8589b1197f89a6ef9afb0f24cd7", "url": "https://github.com/confluentinc/ksql/commit/9162c228143fd8589b1197f89a6ef9afb0f24cd7", "message": "chore: log deprecation on first use of IFNULL", "committedDate": "2020-03-19T17:25:17Z", "type": "commit"}, {"oid": "4b46930c4ac099bbabb930b82d0c1e0b9890805f", "url": "https://github.com/confluentinc/ksql/commit/4b46930c4ac099bbabb930b82d0c1e0b9890805f", "message": "chore: changes requested by Nick", "committedDate": "2020-03-19T17:57:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI0OTM5OQ==", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r395249399", "bodyText": "sorry, i realize i should have seen this array_length function going in separately but adding the docs here has called it to my attention :)   - not sure we should return zero for a null input array, that conflicts with the result for an empty array. I would expect that array_length(null) returns NULL.  From what i can see in a quick google around, that looks to be more common but it's not well documented in many places.", "author": "blueedgenick", "createdAt": "2020-03-19T18:53:27Z", "path": "docs-md/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -186,6 +189,15 @@ The square root of a value.\n Collections\r\n ===========\r\n \r\n+ARRAY_LENGTH\r\n+------------\r\n+\r\n+`ARRAY_LENGTH(ARRAY[1, 2, 3])`\r\n+\r\n+Given an array, return the number of elements in the array.\r\n+\r\n+If the supplied parameter is null the method returns 0.\r\n+\r", "originalCommit": "4b46930c4ac099bbabb930b82d0c1e0b9890805f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU0NDYzMA==", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r395544630", "bodyText": "not sure we should return zero for a null input array,\n\nI was mulling this over myself.  As you've raised it to... consider it done!", "author": "big-andy-coates", "createdAt": "2020-03-20T10:19:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI0OTM5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU0ODcyOA==", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r395548728", "bodyText": "Pull the ARRAY_LENGTH stuff out into different PR now that it's growing:\n#4848", "author": "big-andy-coates", "createdAt": "2020-03-20T10:27:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI0OTM5OQ=="}], "type": "inlineReview"}, {"oid": "f8090246ce25791c44acc94fb9003b5476f0f0d7", "url": "https://github.com/confluentinc/ksql/commit/f8090246ce25791c44acc94fb9003b5476f0f0d7", "message": "chore: remove ARRAY_LENGTH docs\n\nMoved to separate PR.", "committedDate": "2020-03-20T10:29:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzY0Nw==", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r396623647", "bodyText": "can we add a test for COALESCE(some_column) (e.g. no constants)", "author": "agavra", "createdAt": "2020-03-23T17:23:24Z", "path": "ksqldb-functional-tests/src/test/resources/query-validation-tests/null.json", "diffHunk": "@@ -76,6 +76,42 @@\n         \"type\": \"io.confluent.ksql.util.KsqlStatementException\",\n         \"message\": \"Comparison with NULL not supported: NULL <> NULL\"\n       }\n+    },\n+    {\n+      \"name\": \"coalesce\",\n+      \"statements\": [\n+        \"CREATE STREAM INPUT (COL0 INT KEY, COL1 STRING, COL2 ARRAY<INT>) WITH (kafka_topic='test_topic', value_format='JSON');\",\n+        \"CREATE STREAM OUTPUT AS SELECT COALESCE(COL0, 10, 20) AS A, COALESCE(COL1, 'x') AS B, COALESCE(COL2, ARRAY[10, 20]) AS C FROM INPUT;\"", "originalCommit": "f8090246ce25791c44acc94fb9003b5476f0f0d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyOTM5NA==", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r396629394", "bodyText": "done", "author": "big-andy-coates", "createdAt": "2020-03-23T17:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzY0Nw=="}], "type": "inlineReview"}, {"oid": "9929ed44b0e873315b420f317f112a9a92245ff2", "url": "https://github.com/confluentinc/ksql/commit/9929ed44b0e873315b420f317f112a9a92245ff2", "message": "chore: almog's requested changes", "committedDate": "2020-03-23T17:31:22Z", "type": "commit"}]}