{"pr_number": 6752, "pr_title": "chore: ungate multi-column keys from the feature flag", "pr_createdAt": "2020-12-09T22:06:19Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6752", "timeline": [{"oid": "de3e2e247911c908052ea0b3d06944297938b6c4", "url": "https://github.com/confluentinc/ksql/commit/de3e2e247911c908052ea0b3d06944297938b6c4", "message": "chore: ungate multi-col keys + some docs", "committedDate": "2020-12-09T23:14:01Z", "type": "commit"}, {"oid": "e0a16bcf3e71175ce725551c3cd0bb39c9a0c24a", "url": "https://github.com/confluentinc/ksql/commit/e0a16bcf3e71175ce725551c3cd0bb39c9a0c24a", "message": "chore: historical tests", "committedDate": "2020-12-09T23:14:02Z", "type": "commit"}, {"oid": "3d57cff816ce5ef643ed62dee410f6c4d7b3f7c9", "url": "https://github.com/confluentinc/ksql/commit/3d57cff816ce5ef643ed62dee410f6c4d7b3f7c9", "message": "chore: fix up some tests", "committedDate": "2020-12-09T23:14:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyMDQ5Nw==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539720497", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively while value \n          \n          \n            \n            Key columns for a stream have a `KEY` suffix. Key columns for a table have a `PRIMARY KEY` suffix. Value", "author": "JimGalasyn", "createdAt": "2020-12-09T23:17:45Z", "path": "docs/concepts/schemas.md", "diffHunk": "@@ -17,17 +17,17 @@ key and value of the underlying {{ site.ak }} topic message.\n A column is defined by a combination of its [name](#valid-identifiers), its [SQL data type](#sql-data-types),\r\n and possibly a namespace.\r\n \r\n-Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively.\r\n-ksqlDB supports a single key column only.\r\n+Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively while value \r", "originalCommit": "853f649e73259591ac92f12c86b64a086bdca969", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc6496754b860b163338199a8df302573b322195", "url": "https://github.com/confluentinc/ksql/commit/bc6496754b860b163338199a8df302573b322195", "message": "chore: more historical tests", "committedDate": "2020-12-09T23:18:10Z", "type": "commit"}, {"oid": "bc6496754b860b163338199a8df302573b322195", "url": "https://github.com/confluentinc/ksql/commit/bc6496754b860b163338199a8df302573b322195", "message": "chore: more historical tests", "committedDate": "2020-12-09T23:18:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyMTMzOQ==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539721339", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            columns have no namespace suffix. There can be multiple columns in either namespace, given that\n          \n          \n            \n            columns have no namespace suffix. There can be multiple columns in either namespace, if", "author": "JimGalasyn", "createdAt": "2020-12-09T23:19:38Z", "path": "docs/concepts/schemas.md", "diffHunk": "@@ -17,17 +17,17 @@ key and value of the underlying {{ site.ak }} topic message.\n A column is defined by a combination of its [name](#valid-identifiers), its [SQL data type](#sql-data-types),\r\n and possibly a namespace.\r\n \r\n-Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively.\r\n-ksqlDB supports a single key column only.\r\n+Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively while value \r\n+columns have no namespace suffix. There can be multiple columns in either namespace, given that\r", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyMjY1NA==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539722654", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            the underlying serialization format supports it (the `KAFKA` format, for example, does not).\n          \n          \n            \n            the underlying serialization format supports it.\n          \n          \n            \n            \n          \n          \n            \n            !!! note \n          \n          \n            \n                The `KAFKA` format doesn't support multi-column keys.", "author": "JimGalasyn", "createdAt": "2020-12-09T23:22:23Z", "path": "docs/concepts/schemas.md", "diffHunk": "@@ -17,17 +17,17 @@ key and value of the underlying {{ site.ak }} topic message.\n A column is defined by a combination of its [name](#valid-identifiers), its [SQL data type](#sql-data-types),\r\n and possibly a namespace.\r\n \r\n-Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively.\r\n-ksqlDB supports a single key column only.\r\n+Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively while value \r\n+columns have no namespace suffix. There can be multiple columns in either namespace, given that\r\n+the underlying serialization format supports it (the `KAFKA` format, for example, does not).\r", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyMzA2NQ==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539723065", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, the following example statement declares a stream with several\n          \n          \n            \n            For example, the following statement declares a stream with multiple", "author": "JimGalasyn", "createdAt": "2020-12-09T23:23:14Z", "path": "docs/concepts/schemas.md", "diffHunk": "@@ -17,17 +17,17 @@ key and value of the underlying {{ site.ak }} topic message.\n A column is defined by a combination of its [name](#valid-identifiers), its [SQL data type](#sql-data-types),\r\n and possibly a namespace.\r\n \r\n-Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively.\r\n-ksqlDB supports a single key column only.\r\n+Key columns have a `KEY` or `PRIMARY KEY` suffix for streams and tables, respectively while value \r\n+columns have no namespace suffix. There can be multiple columns in either namespace, given that\r\n+the underlying serialization format supports it (the `KAFKA` format, for example, does not).\r\n \r\n-Value columns have no namespace suffix. There can be one or more value columns.\r\n-\r\n-For example, the following example statement declares a stream with a single\r\n-key column and several value columns:\r\n+For example, the following example statement declares a stream with several\r", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyNDQxNA==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539724414", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ksqlDB assumes that any single key is unwrapped, i.e. not contained within an outer\n          \n          \n            \n            ksqlDB assumes that any single key is unwrapped, which mean that it's not contained in an outer", "author": "JimGalasyn", "createdAt": "2020-12-09T23:26:27Z", "path": "docs/developer-guide/serialization.md", "diffHunk": "@@ -429,10 +439,14 @@ Single field (un)wrapping\n \n ### (de)serialization of single keys\n \n-At this time, ksqlDB supports only a single key column and that key columns\n-must be unwrapped, i.e. not contained within a outer record or object. See\n-the next two sections on single values for more information about wrapped\n-and unwrapped data.\n+ksqlDB assumes that any single key is unwrapped, i.e. not contained within an outer", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyNTA1OQ==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539725059", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (e.g. `CREATE STREAM K1 INT KEY, K2 INT KEY, C1 INT`) is wrapped, i.e is a record\n          \n          \n            \n            (for example, `CREATE STREAM K1 INT KEY, K2 INT KEY, C1 INT`) _is_ wrapped, which means that it is a record", "author": "JimGalasyn", "createdAt": "2020-12-09T23:27:45Z", "path": "docs/developer-guide/serialization.md", "diffHunk": "@@ -429,10 +439,14 @@ Single field (un)wrapping\n \n ### (de)serialization of single keys\n \n-At this time, ksqlDB supports only a single key column and that key columns\n-must be unwrapped, i.e. not contained within a outer record or object. See\n-the next two sections on single values for more information about wrapped\n-and unwrapped data.\n+ksqlDB assumes that any single key is unwrapped, i.e. not contained within an outer\n+record or object. Conversely, ksqlDB assumes that any key with multiple columns\n+(e.g. `CREATE STREAM K1 INT KEY, K2 INT KEY, C1 INT`) is wrapped, i.e is a record", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyNTMwMw==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539725303", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To declare a single column key that is wrapped, you may specify a `STRUCT` type\n          \n          \n            \n            To declare a single-column key that's wrapped, specify a `STRUCT` type", "author": "JimGalasyn", "createdAt": "2020-12-09T23:28:24Z", "path": "docs/developer-guide/serialization.md", "diffHunk": "@@ -429,10 +439,14 @@ Single field (un)wrapping\n \n ### (de)serialization of single keys\n \n-At this time, ksqlDB supports only a single key column and that key columns\n-must be unwrapped, i.e. not contained within a outer record or object. See\n-the next two sections on single values for more information about wrapped\n-and unwrapped data.\n+ksqlDB assumes that any single key is unwrapped, i.e. not contained within an outer\n+record or object. Conversely, ksqlDB assumes that any key with multiple columns\n+(e.g. `CREATE STREAM K1 INT KEY, K2 INT KEY, C1 INT`) is wrapped, i.e is a record\n+with each column as a field within the key. \n+\n+To declare a single column key that is wrapped, you may specify a `STRUCT` type", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyNTc0Ng==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r539725746", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            with a single column (e.g. `K STRUCT<F1 INT> KEY`). See the next two sections \n          \n          \n            \n            with a single column. for example, `K STRUCT<F1 INT> KEY`. See the next two sections", "author": "JimGalasyn", "createdAt": "2020-12-09T23:29:25Z", "path": "docs/developer-guide/serialization.md", "diffHunk": "@@ -429,10 +439,14 @@ Single field (un)wrapping\n \n ### (de)serialization of single keys\n \n-At this time, ksqlDB supports only a single key column and that key columns\n-must be unwrapped, i.e. not contained within a outer record or object. See\n-the next two sections on single values for more information about wrapped\n-and unwrapped data.\n+ksqlDB assumes that any single key is unwrapped, i.e. not contained within an outer\n+record or object. Conversely, ksqlDB assumes that any key with multiple columns\n+(e.g. `CREATE STREAM K1 INT KEY, K2 INT KEY, C1 INT`) is wrapped, i.e is a record\n+with each column as a field within the key. \n+\n+To declare a single column key that is wrapped, you may specify a `STRUCT` type\n+with a single column (e.g. `K STRUCT<F1 INT> KEY`). See the next two sections ", "originalCommit": "bc6496754b860b163338199a8df302573b322195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7d5e9d4834a6401dd93f45b3b70e8db7ba512e3", "url": "https://github.com/confluentinc/ksql/commit/e7d5e9d4834a6401dd93f45b3b70e8db7ba512e3", "message": "Apply Jim's Suggestions\n\nCo-authored-by: Jim Galasyn <jim.galasyn@confluent.io>", "committedDate": "2020-12-09T23:32:35Z", "type": "commit"}, {"oid": "c60f6cbdd4a687b7b015307cd50b45334d04610f", "url": "https://github.com/confluentinc/ksql/commit/c60f6cbdd4a687b7b015307cd50b45334d04610f", "message": "Fix weird spacing GitHub added", "committedDate": "2020-12-09T23:33:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE5OTc1MQ==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r540199751", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                registers new schemas with {{ site.sr }}, as necessary while `JSON` requires you\n          \n          \n            \n                registers new schemas with {{ site.sr }} as necessary, while `JSON` requires you", "author": "vcrfxia", "createdAt": "2020-12-10T14:12:31Z", "path": "docs/concepts/schemas.md", "diffHunk": "@@ -106,9 +111,10 @@ Avro-formatted data. If you want to use Protobuf- or JSON-formatted data,\n substitute `PROTOBUF`, `JSON` or `JSON_SR` for `AVRO` in each statement.\r\n \r\n !!! note\r\n-    ksqlDB handles the `JSON` and `JSON_SR` formats differently. While the\r\n-    `JSON` format is capable of _reading_ the schema from {{ site.sr }},\r\n-    `JSON_SR` both reads and registers new schemas, as necessary.\r\n+    ksqlDB handles the `JSON` and `JSON_SR` formats differently. `JSON_SR` reads and \r\n+    registers new schemas with {{ site.sr }}, as necessary while `JSON` requires you\r", "originalCommit": "c60f6cbdd4a687b7b015307cd50b45334d04610f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIwMDIxNg==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r540200216", "bodyText": "Is it valid to have spaces here? I thought the default delimiter was a comma (with no space)?", "author": "vcrfxia", "createdAt": "2020-12-10T14:13:09Z", "path": "docs/developer-guide/serialization.md", "diffHunk": "@@ -127,11 +129,11 @@ split into columns.\n For example, given a SQL statement such as:\n \n ```sql\n-CREATE STREAM x (ID BIGINT, NAME STRING, AGE INT) WITH (VALUE_FORMAT='DELIMITED', ...);\n+CREATE STREAM x (ORGID BIGINT KEY, ID BIGINT KEY, NAME STRING, AGE INT) WITH (FORMAT='DELIMITED', ...);\n ```\n \n-ksqlDB splits a value of `120, bob, 49` into the three fields with `ID` of\n-`120`, `NAME` of `bob` and `AGE` of `49`.\n+ksqlDB splits a key of `120, 21` and a value of `bob, 49` into the four fields (two keys and two values) ", "originalCommit": "c60f6cbdd4a687b7b015307cd50b45334d04610f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMzMjQ3Nw==", "url": "https://github.com/confluentinc/ksql/pull/6752#discussion_r540332477", "bodyText": "I think you are right!", "author": "agavra", "createdAt": "2020-12-10T16:53:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIwMDIxNg=="}], "type": "inlineReview"}, {"oid": "d978895e116e50e8bc3c603a78e3c83879a88fa1", "url": "https://github.com/confluentinc/ksql/commit/d978895e116e50e8bc3c603a78e3c83879a88fa1", "message": "chore: minor changes to docs", "committedDate": "2020-12-10T16:54:16Z", "type": "commit"}]}