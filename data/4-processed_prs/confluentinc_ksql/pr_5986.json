{"pr_number": 5986, "pr_title": "docs: add suppress buffer config docs", "pr_createdAt": "2020-08-11T22:27:51Z", "pr_url": "https://github.com/confluentinc/ksql/pull/5986", "timeline": [{"oid": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "url": "https://github.com/confluentinc/ksql/commit/782e7d6a28ebced78c8759c899cb3d3f335051b3", "message": "docs: add suppress buffer config docs", "committedDate": "2020-08-11T22:26:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkyNzA2MA==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r468927060", "bodyText": "I prefer the previous, straight-to-the-point doc. I don't think config documentation should be prescriptive of how someone should use the config, but rather descriptive of what the config does. The SET command is well documented elsewhere, so I'm not sure it should be added here as well.", "author": "agavra", "createdAt": "2020-08-11T23:50:54Z", "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java", "diffHunk": "@@ -311,9 +311,12 @@\n   public static final String KSQL_SUPPRESS_BUFFER_SIZE_BYTES = \"ksql.suppress.buffer.size.bytes\";\n   public static final Long KSQL_SUPPRESS_BUFFER_SIZE_BYTES_DEFAULT = -1L;\n   public static final String KSQL_SUPPRESS_BUFFER_SIZE_BYTES_DOC =\n-      \"Bound the number of bytes that the \"\n-      + \"buffer can use for suppression. Negative size means the buffer will be unbounded. If the \"\n-      + \"buffer exceeds its max capacity, a StreamsException stating this is thrown\";\n+      \"Config to control the maximum number of bytes used in the suppress buffer for a query.\\n\"\n+      + \"This can be overridden per query, from the CLI using the `SET` command.\\n\"\n+      + \"By default, the amount is unbounded, which can result in out of memory errors. If a \"\n+      + \"bound is desired a good heuristic is to set the buffer max size to be equal to the heap \"\n+      + \"memory divided by the max number of persistent queries. If the bound is exceeds its max \"\n+      + \"capacity, a StreamsException stating this is thrown.\";", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM5NzcwOQ==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469397709", "bodyText": "Oh okay I will revert it to the previous docs, I was just trying emulate the style of the docs for some of the other configs I saw.", "author": "nae701", "createdAt": "2020-08-12T16:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkyNzA2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE0NjI4MQ==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469146281", "bodyText": "Not sure we should talk about exceptions being thrown in user documentation.\nFrom a user perspective what will happen?  I'm assuming the query will be terminated?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n          \n          \n            \n            a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max \n          \n          \n            \n            number of persistent queries. If the bound is exceeds its max capacity, a StreamsException \n          \n          \n            \n            stating this is thrown.\n          \n          \n            \n            By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n          \n          \n            \n            a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max \n          \n          \n            \n            number of persistent queries. If the bound is exceeds its max capacity, the query will be terminated.", "author": "big-andy-coates", "createdAt": "2020-08-12T09:58:12Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.\n+\n+This can be overridden per query, from the CLI using the `SET` command. \n+\n+By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n+a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max \n+number of persistent queries. If the bound is exceeds its max capacity, a StreamsException \n+stating this is thrown.", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQxODg3OQ==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469418879", "bodyText": "If the buffer exceeds its max capacity it will gracefully shut down the application. I will add this instead of streams exception thanks", "author": "nae701", "createdAt": "2020-08-12T17:20:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE0NjI4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ3Mjg2NA==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469472864", "bodyText": "I take this back, I spoke with Almog and this shuts down only the kafka streams application, so the query is terminated but the ksqldb application should still run", "author": "nae701", "createdAt": "2020-08-12T18:55:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE0NjI4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NDYyNQ==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469374625", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Config to control the maximum number of bytes used in the suppress buffer for a query.\n          \n          \n            \n            Sets the maximum number of bytes used in the suppress buffer for a query.", "author": "JimGalasyn", "createdAt": "2020-08-12T16:07:29Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NDg3Mg==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469374872", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This can be overridden per query, from the CLI using the `SET` command. \n          \n          \n            \n            You can override this setting per query by using the SET command.", "author": "JimGalasyn", "createdAt": "2020-08-12T16:07:52Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.\n+\n+This can be overridden per query, from the CLI using the `SET` command. ", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NjA1OA==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469376058", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n          \n          \n            \n            By default, the size is unbounded, which can result in out of memory errors. If you need an upper limit,", "author": "JimGalasyn", "createdAt": "2020-08-12T16:09:38Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.\n+\n+This can be overridden per query, from the CLI using the `SET` command. \n+\n+By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NjY5OQ==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469376699", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max \n          \n          \n            \n            we recommend setting the buffer maximum size to the heap memory divided by the maximum", "author": "JimGalasyn", "createdAt": "2020-08-12T16:10:36Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.\n+\n+This can be overridden per query, from the CLI using the `SET` command. \n+\n+By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n+a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max ", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NzQwOA==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469377408", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            number of persistent queries. If the bound is exceeds its max capacity, a StreamsException \n          \n          \n            \n            number of persistent queries. If the maximum capacity is exceeded, a `StreamsException`", "author": "JimGalasyn", "createdAt": "2020-08-12T16:11:42Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.\n+\n+This can be overridden per query, from the CLI using the `SET` command. \n+\n+By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n+a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max \n+number of persistent queries. If the bound is exceeds its max capacity, a StreamsException ", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NzU0Mw==", "url": "https://github.com/confluentinc/ksql/pull/5986#discussion_r469377543", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            stating this is thrown.\n          \n          \n            \n            is thrown.", "author": "JimGalasyn", "createdAt": "2020-08-12T16:11:53Z", "path": "docs/operate-and-deploy/installation/server-config/config-reference.md", "diffHunk": "@@ -347,6 +347,17 @@ the pull query REST endpoint (by including it in the request e.g: `\"streamsPrope\n By default, any amount of lag is allowed. For using this functionality, the server must be configured with `ksql.heartbeat.enable=true` and \n `ksql.lag.reporting.enable=true`, so the servers can exchange lag information between themselves ahead of time, to validate pull queries against the allowed lag. \n \n+### ksql.suppress.buffer.size.bytes\n+\n+Config to control the maximum number of bytes used in the suppress buffer for a query.\n+\n+This can be overridden per query, from the CLI using the `SET` command. \n+\n+By default, the amount is unbounded, which can result in out of memory errors. If a bound is desired\n+a good heuristic is to set the buffer max size to be equal to the heap memory divided by the max \n+number of persistent queries. If the bound is exceeds its max capacity, a StreamsException \n+stating this is thrown.", "originalCommit": "782e7d6a28ebced78c8759c899cb3d3f335051b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0dd39d9ce621f4804541642e00b632c6f268fa5", "url": "https://github.com/confluentinc/ksql/commit/f0dd39d9ce621f4804541642e00b632c6f268fa5", "message": "docs: revert to previous straight forward suppress buffer config docs", "committedDate": "2020-08-12T17:18:55Z", "type": "commit"}, {"oid": "30d011e4e7fd9612824ac02f8606d8bfc96d39f9", "url": "https://github.com/confluentinc/ksql/commit/30d011e4e7fd9612824ac02f8606d8bfc96d39f9", "message": "docs: clarify and fix feedback", "committedDate": "2020-08-12T22:01:21Z", "type": "commit"}]}