{"pr_number": 6549, "pr_title": "build: st-4518 Fix release script to work with changes made from nano versioning. still using beta artifacts.", "pr_createdAt": "2020-10-30T02:27:03Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6549", "timeline": [{"oid": "b51425c0bf5b5354af18e5f3b876ef2f571be815", "url": "https://github.com/confluentinc/ksql/commit/b51425c0bf5b5354af18e5f3b876ef2f571be815", "message": "build: st-4518 Fix release script to work with changes made from nano versioning. still using beta artifacts.", "committedDate": "2020-10-30T02:37:03Z", "type": "forcePushed"}, {"oid": "64d36a0f284c83efc0ee47778a179f67ff8164b0", "url": "https://github.com/confluentinc/ksql/commit/64d36a0f284c83efc0ee47778a179f67ff8164b0", "message": "build: st-4518 Fix release script to work with changes made from nano versioning. still using beta artifacts.", "committedDate": "2020-10-30T02:45:00Z", "type": "commit"}, {"oid": "64d36a0f284c83efc0ee47778a179f67ff8164b0", "url": "https://github.com/confluentinc/ksql/commit/64d36a0f284c83efc0ee47778a179f67ff8164b0", "message": "build: st-4518 Fix release script to work with changes made from nano versioning. still using beta artifacts.", "committedDate": "2020-10-30T02:45:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2OTk0MQ==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515169941", "bodyText": "def newPomFile = pomFile.replaceFirst(parentVersionPattern, \"\\$1${config.cp_version}\\$2\")\n\nIs the \\$1 groovy syntax to reference matched groups?", "author": "andrewegel", "createdAt": "2020-10-30T15:11:49Z", "path": "Jenkinsfile", "diffHunk": "@@ -208,12 +210,22 @@ def job = {\n                                 sh \"docker pull ${config.dockerRegistry}${dockerRepo}:${config.cp_version}-latest\"\n                             }\n \n+                            // We need to replace the parent version range before we can run any maven commands\n+                            def pomFile = readFile('pom.xml')\n+                            def parentVersionPattern = Pattern.compile(/(.*<parent>.*<groupId>io.confluent\\S*<\\/groupId>.*<version>)\\[\\d+\\.\\d+\\.\\d+-\\d+\\,\\s+\\d+\\.\\d+\\.\\d+-\\d+\\)(<\\/version>.*<\\/parent>.*)/, Pattern.DOTALL)\n+                            // Groovy regex replaces the groups we didn't match, so we print the beginning of the file, our version, and the rest of the file.\n+                            def newPomFile = pomFile.replaceFirst(parentVersionPattern, \"\\$1${config.cp_version}\\$2\")", "originalCommit": "64d36a0f284c83efc0ee47778a179f67ff8164b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMzA3NQ==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r520033075", "bodyText": "yes", "author": "elismaga", "createdAt": "2020-11-09T18:39:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2OTk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE3MDY4Ng==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515170686", "bodyText": "I think somewhere else in this Jenkinsfile we mark the root pom as an artifact, since we're re-writing it here, should we mark that as the artifact?", "author": "andrewegel", "createdAt": "2020-10-30T15:13:00Z", "path": "Jenkinsfile", "diffHunk": "@@ -208,12 +210,22 @@ def job = {\n                                 sh \"docker pull ${config.dockerRegistry}${dockerRepo}:${config.cp_version}-latest\"\n                             }\n \n+                            // We need to replace the parent version range before we can run any maven commands\n+                            def pomFile = readFile('pom.xml')\n+                            def parentVersionPattern = Pattern.compile(/(.*<parent>.*<groupId>io.confluent\\S*<\\/groupId>.*<version>)\\[\\d+\\.\\d+\\.\\d+-\\d+\\,\\s+\\d+\\.\\d+\\.\\d+-\\d+\\)(<\\/version>.*<\\/parent>.*)/, Pattern.DOTALL)\n+                            // Groovy regex replaces the groups we didn't match, so we print the beginning of the file, our version, and the rest of the file.\n+                            def newPomFile = pomFile.replaceFirst(parentVersionPattern, \"\\$1${config.cp_version}\\$2\")\n+                            writeFile(file: 'pom.xml', text: newPomFile)", "originalCommit": "64d36a0f284c83efc0ee47778a179f67ff8164b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE3MTEyMw==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515171123", "bodyText": "I wonder if we should be factoring this out into function jenkins-common?", "author": "andrewegel", "createdAt": "2020-10-30T15:13:39Z", "path": "Jenkinsfile", "diffHunk": "@@ -208,12 +210,22 @@ def job = {\n                                 sh \"docker pull ${config.dockerRegistry}${dockerRepo}:${config.cp_version}-latest\"\n                             }\n \n+                            // We need to replace the parent version range before we can run any maven commands\n+                            def pomFile = readFile('pom.xml')\n+                            def parentVersionPattern = Pattern.compile(/(.*<parent>.*<groupId>io.confluent\\S*<\\/groupId>.*<version>)\\[\\d+\\.\\d+\\.\\d+-\\d+\\,\\s+\\d+\\.\\d+\\.\\d+-\\d+\\)(<\\/version>.*<\\/parent>.*)/, Pattern.DOTALL)", "originalCommit": "64d36a0f284c83efc0ee47778a179f67ff8164b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515237782", "bodyText": "Hey @elismaga (and the rest of the tools team since Eli is OOO), this version bump is a problem for us since the previous version 6.1.0-beta201006024150 has been qualified for our release, but not this new one. Do we have options to release with the old version?", "author": "vcrfxia", "createdAt": "2020-10-30T16:52:33Z", "path": "Jenkinsfile", "diffHunk": "@@ -1,8 +1,10 @@\n+import java.util.regex.Pattern\n+\n def baseConfig = {\n     owner = 'ksql'\n     slackChannel = '#ksql-alerts'\n     ksql_db_version = \"0.14.0\"  // next version to be released\n-    cp_version = \"6.1.0-beta201006024150\"  // must be a beta version from the packaging build\n+    cp_version = \"6.1.0-beta201020194508\"  // must be a beta version from the packaging build", "originalCommit": "64d36a0f284c83efc0ee47778a179f67ff8164b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI0OTg5Ng==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515249896", "bodyText": "Instead of updating the release pipeline to work with nano-versioning (which the PR description suggests requires this version bump), would it work to temporarily back out the nano-versioning changes from the branch we're building against in order to keep the older dependency version?", "author": "vcrfxia", "createdAt": "2020-10-30T17:11:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1MjA1MA==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515252050", "bodyText": "(To clarify: I think it makes sense to merge this PR in preparation for future ksqlDB releases, but I'd also like to explore/understand alternatives for the release that's currently in flight since needing to qualify a new beta dependency would delay the release fairly substantially. Ideally we'd find a workaround to accommodate the old dependency for the current release, then merge this PR including the version bump for future releases.)", "author": "vcrfxia", "createdAt": "2020-10-30T17:14:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NDU4Mg==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515254582", "bodyText": "Stepping back a bit: I don't understand why this version bump is needed in light of the regex replace below that replaces the nanoversion in the pom with the CP version. Is the version bump only needed so that the new properties (for ksql and schema registry versions) are found? If so, can we remove those and not bump the version for now, then bump the version and add those back in in a subsequent PR?", "author": "vcrfxia", "createdAt": "2020-10-30T17:18:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMxNjExNA==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515316114", "bodyText": "I'm not familiar with the ksql release process so apologies in advance, but would it be a possibility if we instead cherrypick the nanoversioning rollout changes on top of the old 6.1.0-beta201006024150? Or would qualifying that take just as long as qualifying the newer version?", "author": "gracechensd", "createdAt": "2020-10-30T19:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMyNTMzNA==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515325334", "bodyText": "6.1.0-beta201006024150 is a beta packaging build produced by the tools team. Someone from your team can probably comment more authoritatively than I can on how difficult it is to cherry-pick and reproduce beta artifacts?", "author": "vcrfxia", "createdAt": "2020-10-30T19:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM3NTY4Mw==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r515375683", "bodyText": "I do not image that would be easy to cherrypick nanoversion change to the old beta version, I guess we could try just add the regex part and removed the version bump part.", "author": "xli1996", "createdAt": "2020-10-30T20:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjExNTY2OQ==", "url": "https://github.com/confluentinc/ksql/pull/6549#discussion_r552115669", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                cp_version = \"6.1.0-beta201020194508\"  // must be a beta version from the packaging build\n          \n          \n            \n                cp_version = \"6.2.0-beta201122193350\"  // must be a beta version from the packaging build", "author": "rodesai", "createdAt": "2021-01-05T18:30:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNzc4Mg=="}], "type": "inlineReview"}, {"oid": "6f69708300fcdc74636222228558951eef21f5d9", "url": "https://github.com/confluentinc/ksql/commit/6f69708300fcdc74636222228558951eef21f5d9", "message": "set cp version to version for 0.15", "committedDate": "2021-01-05T18:30:36Z", "type": "commit"}, {"oid": "590056c6fa51418022dca4cb32fee0f2d7692f04", "url": "https://github.com/confluentinc/ksql/commit/590056c6fa51418022dca4cb32fee0f2d7692f04", "message": "Merge branch 'ksql-db-release' into ksql_release_nano_with_beta_fix", "committedDate": "2021-01-05T18:31:39Z", "type": "commit"}]}