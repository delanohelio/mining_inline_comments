{"pr_number": 4551, "pr_title": "feat: enhance `PRINT TOPIC`'s format detection", "pr_createdAt": "2020-02-13T12:27:09Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4551", "timeline": [{"oid": "81275a44ac8b707dfcc96dc30689c6eeb18bf8a0", "url": "https://github.com/confluentinc/ksql/commit/81275a44ac8b707dfcc96dc30689c6eeb18bf8a0", "message": "feat: enhance `PRINT TOPIC`'s format detection\n\nfixes: https://github.com/confluentinc/ksql/issues/4258\n\nWith this change `PRINT TOPIC` has enhanced detection for the key and value formats of a topic.\nThe command starts with a list of known formats for both the key and the value and refines this\nlist as it sees more data.\n\nAs the list of possible formats is refined over time the command will output the reduced list.\nFor example, you may see output such as:\n\n```\nksql> PRINT some_topic FROM BEGINNING;\nKey format: JSON or SESSION(KAFKA_STRING) or HOPPING(KAFKA_STRING) or TUMBLING(KAFKA_STRING) or KAFKA_STRING\nValue format: JSON or KAFKA_STRING\nrowtime: 12/21/18 23:58:42 PM PSD, key: stream/CLICKSTREAM/create, value: {statement\":\"CREATE STREAM clickstream (_time bigint,time varchar, ip varchar, request varchar, status int, userid int, bytes bigint, agent varchar) with (kafka_topic = 'clickstream', value_format = 'json');\",\"streamsProperties\":{}}\nrowtime: 12/21/18 23:58:42 PM PSD, key: table/EVENTS_PER_MIN/create, value: {\"statement\":\"create table events_per_min as select userid, count(*) as events from clickstream window  TUMBLING (size 10 second) group by userid EMIT CHANGES;\",\"streamsProperties\":{}}\nKey format: KAFKA_STRING\n...\n```\n\nIn the last line of the above output the command has narrowed the key format down as it has proceeded more data.\n\nThe command has also been updated to only detect valid UTF8 encoded text as type `JSON` or `KAFKA_STRING`.\nThis is inline with how KSQL would later deserialize the data.\n\nIf no known format can successfully deserialize the data it is printed as a combination of ASCII characters and hex encoded bytes.", "committedDate": "2020-02-13T12:26:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ0MDgyMg==", "url": "https://github.com/confluentinc/ksql/pull/4551#discussion_r379440822", "bodyText": "typo: \"KAFA_STRING\"", "author": "purplefox", "createdAt": "2020-02-14T13:54:20Z", "path": "docs-md/developer-guide/ksqldb-reference/print.md", "diffHunk": "@@ -51,13 +55,19 @@ the key and value formats at the top of the output.\n Your output should resemble:\r\n \r\n ```\r\n-    Key format: KAFKA (INTEGER)\r\n-    Value format: JSON\r\n+    Key format: JSON or SESSION(KAFKA_STRING) or HOPPING(KAFKA_STRING) or TUMBLING(KAFKA_STRING) or KAFKA_STRING\r\n+    Value format: JSON or KAFKA_STRING\r\n     rowtime: 12/21/18 23:58:42 PM PSD, key: stream/CLICKSTREAM/create, value: {statement\":\"CREATE STREAM clickstream (_time bigint,time varchar, ip varchar, request varchar, status int, userid int, bytes bigint, agent varchar) with (kafka_topic = 'clickstream', value_format = 'json');\",\"streamsProperties\":{}}\r\n     rowtime: 12/21/18 23:58:42 PM PSD, key: table/EVENTS_PER_MIN/create, value: {\"statement\":\"create table events_per_min as select userid, count(*) as events from clickstream window  TUMBLING (size 10 second) group by userid EMIT CHANGES;\",\"streamsProperties\":{}}\r\n     ^CTopic printing ceased\r\n ```\r\n \r\n+The key format for this topic is `KAFKA_STRING`. However, the `PRINT` command does not know this and\r\n+has attempted to determine the format of the key by inspecting the data. It has determined that the\r\n+format may be `KAFA_STRING`, but it could also be `JSON` or a windowed `KAFKA_STRING`.\r", "originalCommit": "81275a44ac8b707dfcc96dc30689c6eeb18bf8a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0f5dc11d404ddd1b8eb38c97db2c5427c4dea10", "url": "https://github.com/confluentinc/ksql/commit/f0f5dc11d404ddd1b8eb38c97db2c5427c4dea10", "message": "chore: typo", "committedDate": "2020-02-14T14:57:28Z", "type": "commit"}]}