{"pr_number": 2678, "pr_title": "1812110: Expose artemis port with SELinux boolean; ENT-2190", "pr_createdAt": "2020-04-09T12:12:24Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2678", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NjkzMg==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406176932", "bodyText": "Do we want to define the port as a variable somewhere so it's not hard coded? Is that even a thing we can do?", "author": "Ceiu", "createdAt": "2020-04-09T12:44:13Z", "path": "server/candlepin.spec.tmpl", "diffHunk": "@@ -170,6 +172,7 @@ for selinuxvariant in %{selinux_variants}\n do\n   /usr/sbin/semodule -s $selinuxvariant -i %{_datadir}/selinux/$selinuxvariant/%{modulename}.pp &> /dev/null || :\n done\n+/usr/sbin/semanage port -a -t candlepin_activemq_port_t -p tcp 61613 &> /dev/null || :", "originalCommit": "fa1ddb879d350ada833c7005ec5f7fe184b4af57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4MDIwMw==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406180203", "bodyText": "Given that this is in the spec file, I don't know where/how you would create a variable for it, except the spec file itself, but it would be only for readability/aesthetic reasons, not functional.", "author": "nikosmoum", "createdAt": "2020-04-09T12:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NjkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4MTkyMw==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406181923", "bodyText": "Oh yeah... missed that. It looks like bash scripting; though I can't quite figure out exactly what that double pipe is doing at the end. Is that just to suppress any error output from the command?", "author": "Ceiu", "createdAt": "2020-04-09T12:53:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NjkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4Njc1Mw==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406186753", "bodyText": "It is running bash commands, since this is inside a #raw block: https://stackoverflow.com/questions/16357755/meaning-of-colon-in-bash-after-a-double-pipe#comment23436601_16357803\nAlso, other commands were using it, so I added without much thought", "author": "nikosmoum", "createdAt": "2020-04-09T13:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NjkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NzY2Mg==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406177662", "bodyText": "Indentation is a bit wonky here", "author": "Ceiu", "createdAt": "2020-04-09T12:45:37Z", "path": "server/selinux/candlepin.te", "diffHunk": "@@ -1,10 +1,19 @@\n-policy_module(candlepin, 1.0.0)\n+policy_module(candlepin, 1.1.0)\n \n ########################################\n #\n # Declarations\n #\n \n+## <desc>\n+##      <p>\n+##\t    Allow tomcat to bind to the port used\n+##\t    by candlepin's embedded activemq artemis,\n+##\t    labeled candlepin_activemq_port_t\n+##\t    </p>\n+## </desc>", "originalCommit": "fa1ddb879d350ada833c7005ec5f7fe184b4af57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI1ODg5NA==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406258894", "bodyText": "fixed", "author": "nikosmoum", "createdAt": "2020-04-09T14:46:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NzY2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3ODMxMQ==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406178311", "bodyText": "Indentation again. Looks like a tab instead of spaces?", "author": "Ceiu", "createdAt": "2020-04-09T12:46:50Z", "path": "server/selinux/candlepin.te", "diffHunk": "@@ -103,3 +115,7 @@ allow tomcat_t candlepin_var_lib_t:file { manage_file_perms };\n allow tomcat_t candlepin_var_log_t:dir { manage_dir_perms };\n allow tomcat_t candlepin_var_log_t:file { manage_file_perms };\n allow tomcat_t postgresql_port_t:tcp_socket name_connect;\n+\n+tunable_policy(`candlepin_can_bind_activemq_port',`\n+\tallow tomcat_t candlepin_activemq_port_t:tcp_socket name_bind;", "originalCommit": "fa1ddb879d350ada833c7005ec5f7fe184b4af57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI1ODk0Mg==", "url": "https://github.com/candlepin/candlepin/pull/2678#discussion_r406258942", "bodyText": "fixed", "author": "nikosmoum", "createdAt": "2020-04-09T14:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3ODMxMQ=="}], "type": "inlineReview"}, {"oid": "a820b16e8249f15fe39379c0a6aa4808df37b167", "url": "https://github.com/candlepin/candlepin/commit/a820b16e8249f15fe39379c0a6aa4808df37b167", "message": "1812110: Expose artemis port with SELinux boolean\n\n- Declare SELinux boolean 'candlepin_can_bind_activemq_port'\n  (that is by default off), which allows tomcat to bind to\n  port 61613 (declared as 'candlepin_activemq_port_t') when\n  turned on.", "committedDate": "2020-04-09T14:31:43Z", "type": "forcePushed"}, {"oid": "440c5ac49c08d8c574c81552ea2b8e7367cb3cdc", "url": "https://github.com/candlepin/candlepin/commit/440c5ac49c08d8c574c81552ea2b8e7367cb3cdc", "message": "1812110: Expose artemis port with SELinux boolean\n\n- Declare SELinux boolean 'candlepin_can_bind_activemq_port'\n  (that is by default off), which allows tomcat to bind to\n  port 61613 (declared as 'candlepin_activemq_port_t') when\n  turned on.", "committedDate": "2020-04-09T14:45:24Z", "type": "commit"}, {"oid": "440c5ac49c08d8c574c81552ea2b8e7367cb3cdc", "url": "https://github.com/candlepin/candlepin/commit/440c5ac49c08d8c574c81552ea2b8e7367cb3cdc", "message": "1812110: Expose artemis port with SELinux boolean\n\n- Declare SELinux boolean 'candlepin_can_bind_activemq_port'\n  (that is by default off), which allows tomcat to bind to\n  port 61613 (declared as 'candlepin_activemq_port_t') when\n  turned on.", "committedDate": "2020-04-09T14:45:24Z", "type": "forcePushed"}]}